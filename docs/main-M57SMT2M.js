import{b as Jk,c as eA,f as p6,g as tA}from"./chunk-EA6DTDFA.js";import{a as he,b as ot,d as pt,e as ki,f as qm,g as d6}from"./chunk-WMVSLYLA.js";var h_=pt(m_=>{"use strict";Object.defineProperty(m_,"__esModule",{value:!0});var f_=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}};m_.default=f_});var y_=pt(Yh=>{"use strict";var EF=Yh&&Yh.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Yh,"__esModule",{value:!0});var Cee=EF((tA(),d6(p6))),Iee=EF(h_()),g_=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=Cee.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=Object.assign({},this.headers),this.headers[n]=e,this}then(n,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var s,a,l;let c=null,u=null,d=null,p=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){let y=await i.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=y:u=JSON.parse(y))}let h=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),g=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");h&&g&&g.length>1&&(d=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,p=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let h=await i.text();try{c=JSON.parse(h),Array.isArray(c)&&i.status===404&&(u=[],c=null,p=200,f="OK")}catch{i.status===404&&h===""?(p=204,f="No Content"):c={message:h}}if(c&&this.isMaybeSingle&&(!((l=c?.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,p=200,f="OK"),c&&this.shouldThrowOnError)throw new Iee.default(c)}return{error:c,data:u,count:d,status:p,statusText:f}});return this.shouldThrowOnError||(o=o.catch(i=>{var s,a,l;return{error:{message:`${(s=i?.name)!==null&&s!==void 0?s:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),o.then(n,e)}};Yh.default=g_});var v_=pt(Zh=>{"use strict";var See=Zh&&Zh.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Zh,"__esModule",{value:!0});var Tee=See(y_()),x_=class extends Tee.default{select(n){let e=!1,r=(n??"*").split("").map(o=>/\s/.test(o)&&!e?"":(o==='"'&&(e=!e),o)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:e=!0,nullsFirst:r,foreignTable:o,referencedTable:i=o}={}){let s=i?`${i}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:r=e}={}){let o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,e,{foreignTable:r,referencedTable:o=r}={}){let i=typeof o>"u"?"offset":`${o}.offset`,s=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(s,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:e=!1,settings:r=!1,buffers:o=!1,wal:i=!1,format:s="text"}={}){var a;let l=[n?"analyze":null,e?"verbose":null,r?"settings":null,o?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`,s==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Zh.default=x_});var u0=pt(Qh=>{"use strict";var Eee=Qh&&Qh.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Qh,"__esModule",{value:!0});var _ee=Eee(v_()),b_=class extends _ee.default{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}in(n,e){let r=Array.from(new Set(e)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${r})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:r,type:o}={}){let i="";o==="plain"?i="pl":o==="phrase"?i="ph":o==="websearch"&&(i="w");let s=r===void 0?"":`(${r})`;return this.url.searchParams.append(n,`${i}fts${s}.${e}`),this}match(n){return Object.entries(n).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(n,e,r){return this.url.searchParams.append(n,`not.${e}.${r}`),this}or(n,{foreignTable:e,referencedTable:r=e}={}){let o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,e,r){return this.url.searchParams.append(n,`${e}.${r}`),this}};Qh.default=b_});var C_=pt(eg=>{"use strict";var Dee=eg&&eg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(eg,"__esModule",{value:!0});var Jh=Dee(u0()),w_=class{constructor(n,{headers:e={},schema:r,fetch:o}){this.url=n,this.headers=e,this.schema=r,this.fetch=o}select(n,{head:e=!1,count:r}={}){let o=e?"HEAD":"GET",i=!1,s=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),new Jh.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:e,defaultToNull:r=!0}={}){let o="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(n)){let s=n.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(s.length>0){let a=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Jh.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:e,ignoreDuplicates:r=!1,count:o,defaultToNull:i=!0}={}){let s="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),o&&a.push(`count=${o}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(n)){let l=n.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){let c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Jh.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:e}={}){let r="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),e&&o.push(`count=${e}`),this.headers.Prefer=o.join(","),new Jh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){let e="DELETE",r=[];return n&&r.push(`count=${n}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Jh.default({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};eg.default=w_});var _F=pt(d0=>{"use strict";Object.defineProperty(d0,"__esModule",{value:!0});d0.version=void 0;d0.version="0.0.0-automated"});var DF=pt(p0=>{"use strict";Object.defineProperty(p0,"__esModule",{value:!0});p0.DEFAULT_HEADERS=void 0;var Nee=_F();p0.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Nee.version}`}});var kF=pt(tg=>{"use strict";var NF=tg&&tg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tg,"__esModule",{value:!0});var kee=NF(C_()),Aee=NF(u0()),Ree=DF(),I_=class t{constructor(n,{headers:e={},schema:r,fetch:o}={}){this.url=n,this.headers=Object.assign(Object.assign({},Ree.DEFAULT_HEADERS),e),this.schemaName=r,this.fetch=o}from(n){let e=new URL(`${this.url}/${n}`);return new kee.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new t(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,e={},{head:r=!1,get:o=!1,count:i}={}){let s,a=new URL(`${this.url}/rpc/${n}`),l;r||o?(s=r?"HEAD":"GET",Object.entries(e).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{a.searchParams.append(u,d)})):(s="POST",l=e);let c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new Aee.default({method:s,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};tg.default=I_});var $F=pt(ir=>{"use strict";var Pp=ir&&ir.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ir,"__esModule",{value:!0});ir.PostgrestError=ir.PostgrestBuilder=ir.PostgrestTransformBuilder=ir.PostgrestFilterBuilder=ir.PostgrestQueryBuilder=ir.PostgrestClient=void 0;var AF=Pp(kF());ir.PostgrestClient=AF.default;var RF=Pp(C_());ir.PostgrestQueryBuilder=RF.default;var OF=Pp(u0());ir.PostgrestFilterBuilder=OF.default;var MF=Pp(v_());ir.PostgrestTransformBuilder=MF.default;var FF=Pp(y_());ir.PostgrestBuilder=FF.default;var PF=Pp(h_());ir.PostgrestError=PF.default;ir.default={PostgrestClient:AF.default,PostgrestQueryBuilder:RF.default,PostgrestFilterBuilder:OF.default,PostgrestTransformBuilder:MF.default,PostgrestBuilder:FF.default,PostgrestError:PF.default}});var tL=pt((Xf,eL)=>{"use strict";var Joe=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},rd=Joe();eL.exports=Xf=rd.fetch;rd.fetch&&(Xf.default=rd.fetch.bind(rd));Xf.Headers=rd.Headers;Xf.Request=rd.Request;Xf.Response=rd.Response});var nL=pt(()=>{"use strict"});var UL=pt((zL,uD)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(zL,typeof uD=="object"&&uD,typeof define=="function"&&define)});var GL=pt((jL,dD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(jL,typeof dD=="object"&&dD,typeof define=="function"&&define)});var HL=pt((WL,pD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(WL,typeof pD=="object"&&pD,typeof define=="function"&&define)});var KL=pt((qL,fD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(qL,typeof fD=="object"&&fD,typeof define=="function"&&define)});var YL=pt((XL,mD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,m=-32;m<y;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(XL,typeof mD=="object"&&mD,typeof define=="function"&&define)});var QL=pt((ZL,hD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(ZL,typeof hD=="object"&&hD,typeof define=="function"&&define)});var Gb=pt(()=>{"use strict"});var JL=pt((nje,Wb)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(w,b,S){var E=[];b=b==!0?{entropy:!0}:b||{};var D=g(h(b.entropy?[w,x(t)]:w??y(),3),E),O=new f(E),R=function(){for(var P=O.g(o),U=a,j=0;P<l;)P=(P+j)*r,U*=r,j=O.g(1);for(;P>=c;)P/=2,U/=2,j>>>=1;return(P+j)/U};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(x(O.S),t),(b.pass||S||function(P,U,j,W){return W&&(W.S&&m(W,O),P.state=function(){return m(O,{})}),j?(n[s]=P,U):P})(R,D,"global"in b?b.global:this==n,b.state)}n["seed"+s]=p;function f(w){var b,S=w.length,E=this,D=0,O=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+w[D%S]+(b=R[D])],R[O]=b;(E.g=function(P){for(var U,j=0,W=E.i,K=E.j,H=E.S;P--;)U=H[W=u&W+1],j=j*r+H[u&(H[W]=H[K=u&K+U])+(H[K]=U)];return E.i=W,E.j=K,j})(r)}function m(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function h(w,b){var S=[],E=typeof w,D;if(b&&E=="object")for(D in w)try{S.push(h(w[D],b-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,b){for(var S=w+"",E,D=0;D<S.length;)b[u&D]=u&(E^=b[u&D]*19)+S.charCodeAt(D++);return x(b)}function y(){try{var w;return d&&(w=d.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),x(w)}catch{var b=e.navigator,S=b&&b.plugins;return[+new Date,e,S,e.screen,x(t)]}}function x(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),typeof Wb=="object"&&Wb.exports){Wb.exports=p;try{d=Gb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var tV=pt((rje,eV)=>{"use strict";var kae=UL(),Aae=GL(),Rae=HL(),Oae=KL(),Mae=YL(),Fae=QL(),md=JL();md.alea=kae;md.xor128=Aae;md.xorwow=Rae;md.xorshift7=Oae;md.xor4096=Mae;md.tychei=Fae;eV.exports=md});var kU=pt((NU,EN)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(NU,typeof EN=="object"&&EN,typeof define=="function"&&define)});var RU=pt((AU,_N)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(AU,typeof _N=="object"&&_N,typeof define=="function"&&define)});var MU=pt((OU,DN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(OU,typeof DN=="object"&&DN,typeof define=="function"&&define)});var PU=pt((FU,NN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(FU,typeof NN=="object"&&NN,typeof define=="function"&&define)});var LU=pt(($U,kN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,m=-32;m<y;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})($U,typeof kN=="object"&&kN,typeof define=="function"&&define)});var BU=pt((VU,AN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(VU,typeof AN=="object"&&AN,typeof define=="function"&&define)});var zU=pt((Jbt,Gw)=>{"use strict";(function(t,n){var e=(0,eval)("this"),r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(w,b,S){var E=[];b=b==!0?{entropy:!0}:b||{};var D=g(h(b.entropy?[w,x(t)]:w??y(),3),E),O=new f(E),R=function(){for(var P=O.g(o),U=a,j=0;P<l;)P=(P+j)*r,U*=r,j=O.g(1);for(;P>=c;)P/=2,U/=2,j>>>=1;return(P+j)/U};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(x(O.S),t),(b.pass||S||function(P,U,j,W){return W&&(W.S&&m(W,O),P.state=function(){return m(O,{})}),j?(n[s]=P,U):P})(R,D,"global"in b?b.global:this==n,b.state)}n["seed"+s]=p;function f(w){var b,S=w.length,E=this,D=0,O=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+w[D%S]+(b=R[D])],R[O]=b;(E.g=function(P){for(var U,j=0,W=E.i,K=E.j,H=E.S;P--;)U=H[W=u&W+1],j=j*r+H[u&(H[W]=H[K=u&K+U])+(H[K]=U)];return E.i=W,E.j=K,j})(r)}function m(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function h(w,b){var S=[],E=typeof w,D;if(b&&E=="object")for(D in w)try{S.push(h(w[D],b-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,b){for(var S=w+"",E,D=0;D<S.length;)b[u&D]=u&(E^=b[u&D]*19)+S.charCodeAt(D++);return x(b)}function y(){try{var w;return d&&(w=d.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),x(w)}catch{var b=e.navigator,S=b&&b.plugins;return[+new Date,e,S,e.screen,x(t)]}}function x(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),typeof Gw=="object"&&Gw.exports){Gw.exports=p;try{d=Gb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var RN=pt((ewt,UU)=>{"use strict";var Qde=kU(),Jde=RU(),epe=MU(),tpe=PU(),npe=LU(),rpe=BU(),kd=zU();kd.alea=Qde;kd.xor128=Jde;kd.xorwow=epe;kd.xorshift7=tpe;kd.xor4096=npe;kd.tychei=rpe;UU.exports=kd});var Q4=pt((Z4,pk)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(Z4,typeof pk=="object"&&pk,typeof define=="function"&&define)});var eG=pt((J4,fk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(J4,typeof fk=="object"&&fk,typeof define=="function"&&define)});var nG=pt((tG,mk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(tG,typeof mk=="object"&&mk,typeof define=="function"&&define)});var oG=pt((rG,hk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(rG,typeof hk=="object"&&hk,typeof define=="function"&&define)});var sG=pt((iG,gk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,m=-32;m<y;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(iG,typeof gk=="object"&&gk,typeof define=="function"&&define)});var lG=pt((aG,yk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(aG,typeof yk=="object"&&yk,typeof define=="function"&&define)});var cG=pt((gAt,sC)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(w,b,S){var E=[];b=b==!0?{entropy:!0}:b||{};var D=g(h(b.entropy?[w,x(t)]:w??y(),3),E),O=new f(E),R=function(){for(var P=O.g(o),U=a,j=0;P<l;)P=(P+j)*r,U*=r,j=O.g(1);for(;P>=c;)P/=2,U/=2,j>>>=1;return(P+j)/U};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(x(O.S),t),(b.pass||S||function(P,U,j,W){return W&&(W.S&&m(W,O),P.state=function(){return m(O,{})}),j?(n[s]=P,U):P})(R,D,"global"in b?b.global:this==n,b.state)}n["seed"+s]=p;function f(w){var b,S=w.length,E=this,D=0,O=E.i=E.j=0,R=E.S=[];for(S||(w=[S++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+w[D%S]+(b=R[D])],R[O]=b;(E.g=function(P){for(var U,j=0,W=E.i,K=E.j,H=E.S;P--;)U=H[W=u&W+1],j=j*r+H[u&(H[W]=H[K=u&K+U])+(H[K]=U)];return E.i=W,E.j=K,j})(r)}function m(w,b){return b.i=w.i,b.j=w.j,b.S=w.S.slice(),b}function h(w,b){var S=[],E=typeof w,D;if(b&&E=="object")for(D in w)try{S.push(h(w[D],b-1))}catch{}return S.length?S:E=="string"?w:w+"\0"}function g(w,b){for(var S=w+"",E,D=0;D<S.length;)b[u&D]=u&(E^=b[u&D]*19)+S.charCodeAt(D++);return x(b)}function y(){try{var w;return d&&(w=d.randomBytes)?w=w(r):(w=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(w)),x(w)}catch{var b=e.navigator,S=b&&b.plugins;return[+new Date,e,S,e.screen,x(t)]}}function x(w){return String.fromCharCode.apply(0,w)}if(g(n.random(),t),typeof sC=="object"&&sC.exports){sC.exports=p;try{d=Gb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var dG=pt((yAt,uG)=>{"use strict";var gme=Q4(),yme=eG(),xme=nG(),vme=oG(),bme=sG(),wme=lG(),Rd=cG();Rd.alea=gme;Rd.xor128=yme;Rd.xorwow=xme;Rd.xorshift7=vme;Rd.xor4096=bme;Rd.tychei=wme;uG.exports=Rd});function rA(t,n){return Object.is(t,n)}var Fn=null,Km=!1,ZI=1,Fr=Symbol("SIGNAL");function vt(t){let n=Fn;return Fn=t,n}function oA(){return Fn}function f6(){return Km}var qc={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function jy(t){if(Km)throw new Error("");if(Fn===null)return;Fn.consumerOnSignalRead(t);let n=Fn.nextProducerIndex++;if(Wy(Fn),n<Fn.producerNode.length&&Fn.producerNode[n]!==t&&Xm(Fn)){let e=Fn.producerNode[n];Gy(e,Fn.producerIndexOfThis[n])}Fn.producerNode[n]!==t&&(Fn.producerNode[n]=t,Fn.producerIndexOfThis[n]=Xm(Fn)?cA(t,Fn,n):0),Fn.producerLastReadVersion[n]=t.version}function m6(){ZI++}function iA(t){if(!(Xm(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===ZI)){if(!t.producerMustRecompute(t)&&!Zm(t)){nA(t);return}t.producerRecomputeValue(t),nA(t)}}function sA(t){if(t.liveConsumerNode===void 0)return;let n=Km;Km=!0;try{for(let e of t.liveConsumerNode)e.dirty||lA(e)}finally{Km=n}}function aA(){return Fn?.consumerAllowSignalWrites!==!1}function lA(t){t.dirty=!0,sA(t),t.consumerMarkedDirty?.(t)}function nA(t){t.dirty=!1,t.lastCleanEpoch=ZI}function jd(t){return t&&(t.nextProducerIndex=0),vt(t)}function Ym(t,n){if(vt(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(Xm(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)Gy(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Zm(t){Wy(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(iA(e),r!==e.version))return!0}return!1}function Gd(t){if(Wy(t),Xm(t))for(let n=0;n<t.producerNode.length;n++)Gy(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function cA(t,n,e){if(uA(t),t.liveConsumerNode.length===0&&dA(t))for(let r=0;r<t.producerNode.length;r++)t.producerIndexOfThis[r]=cA(t.producerNode[r],t,r);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function Gy(t,n){if(uA(t),t.liveConsumerNode.length===1&&dA(t))for(let r=0;r<t.producerNode.length;r++)Gy(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];Wy(o),o.producerIndexOfThis[r]=n}}function Xm(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Wy(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function uA(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function dA(t){return t.producerNode!==void 0}function pA(t){let n=Object.create(h6);n.computation=t;let e=()=>{if(iA(n),jy(n),n.value===Uy)throw n.error;return n.value};return e[Fr]=n,e}var KI=Symbol("UNSET"),XI=Symbol("COMPUTING"),Uy=Symbol("ERRORED"),h6=ot(he({},qc),{value:KI,dirty:!0,error:null,equal:rA,kind:"computed",producerMustRecompute(t){return t.value===KI||t.value===XI},producerRecomputeValue(t){if(t.value===XI)throw new Error("Detected cycle in computations.");let n=t.value;t.value=XI;let e=jd(t),r,o=!1;try{r=t.computation(),vt(null),o=n!==KI&&n!==Uy&&r!==Uy&&t.equal(n,r)}catch(i){r=Uy,t.error=i}finally{Ym(t,e)}if(o){t.value=n;return}t.value=r,t.version++}});function g6(){throw new Error}var fA=g6;function mA(){fA()}function hA(t){fA=t}var y6=null;function gA(t){let n=Object.create(QI);n.value=t;let e=()=>(jy(n),n.value);return e[Fr]=n,e}function Hy(t,n){aA()||mA(),t.equal(t.value,n)||(t.value=n,x6(t))}function yA(t,n){aA()||mA(),Hy(t,n(t.value))}var QI=ot(he({},qc),{equal:rA,value:void 0,kind:"signal"});function x6(t){t.version++,m6(),sA(t),y6?.()}function xA(t,n,e){let r=Object.create(v6);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;let o=l=>{r.cleanupFn=l};function i(l){return l.fn===null&&l.schedule===null}function s(l){i(l)||(Gd(l),l.cleanupFn(),l.fn=null,l.schedule=null,l.cleanupFn=YI)}let a=()=>{if(r.fn===null)return;if(f6())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(r.dirty=!1,r.hasRun&&!Zm(r))return;r.hasRun=!0;let l=jd(r);try{r.cleanupFn(),r.cleanupFn=YI,r.fn(o)}finally{Ym(r,l)}};return r.ref={notify:()=>lA(r),run:a,cleanup:()=>r.cleanupFn(),destroy:()=>s(r),[Fr]:r},r.ref}var YI=()=>{},v6=ot(he({},qc),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule!==null&&t.schedule(t.ref)},hasRun:!1,cleanupFn:YI});function Ye(t){return typeof t=="function"}function Wd(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var qy=Wd(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function Qm(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var Sn=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Ye(r))try{r()}catch(i){n=i instanceof qy?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{vA(i)}catch(s){n=n??[],s instanceof qy?n=[...n,...s.errors]:n.push(s)}}if(n)throw new qy(n)}}add(n){var e;if(n&&n!==this)if(this.closed)vA(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&Qm(e,n)}remove(n){let{_finalizers:e}=this;e&&Qm(e,n),n instanceof t&&n._removeParent(this)}};Sn.EMPTY=(()=>{let t=new Sn;return t.closed=!0,t})();var JI=Sn.EMPTY;function Ky(t){return t instanceof Sn||t&&"closed"in t&&Ye(t.remove)&&Ye(t.add)&&Ye(t.unsubscribe)}function vA(t){Ye(t)?t():t.unsubscribe()}var ni={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Hd={setTimeout(t,n,...e){let{delegate:r}=Hd;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=Hd;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Xy(t){Hd.setTimeout(()=>{let{onUnhandledError:n}=ni;if(n)n(t);else throw t})}function Jm(){}var bA=eS("C",void 0,void 0);function wA(t){return eS("E",void 0,t)}function CA(t){return eS("N",t,void 0)}function eS(t,n,e){return{kind:t,value:n,error:e}}var Kc=null;function qd(t){if(ni.useDeprecatedSynchronousErrorHandling){let n=!Kc;if(n&&(Kc={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=Kc;if(Kc=null,e)throw r}}else t()}function IA(t){ni.useDeprecatedSynchronousErrorHandling&&Kc&&(Kc.errorThrown=!0,Kc.error=t)}var Xc=class extends Sn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Ky(n)&&n.add(this)):this.destination=C6}static create(n,e,r){return new Kd(n,e,r)}next(n){this.isStopped?nS(CA(n),this):this._next(n)}error(n){this.isStopped?nS(wA(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?nS(bA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},b6=Function.prototype.bind;function tS(t,n){return b6.call(t,n)}var rS=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Yy(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Yy(r)}else Yy(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Yy(e)}}},Kd=class extends Xc{constructor(n,e,r){super();let o;if(Ye(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&ni.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&tS(n.next,i),error:n.error&&tS(n.error,i),complete:n.complete&&tS(n.complete,i)}):o=n}this.destination=new rS(o)}};function Yy(t){ni.useDeprecatedSynchronousErrorHandling?IA(t):Xy(t)}function w6(t){throw t}function nS(t,n){let{onStoppedNotification:e}=ni;e&&Hd.setTimeout(()=>e(t,n))}var C6={closed:!0,next:Jm,error:w6,complete:Jm};var Xd=typeof Symbol=="function"&&Symbol.observable||"@@observable";function to(t){return t}function oS(...t){return iS(t)}function iS(t){return t.length===0?to:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var bt=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=S6(e)?e:new Kd(e,r,o);return qd(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=SA(r),new r((o,i)=>{let s=new Kd({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[Xd](){return this}pipe(...e){return iS(e)(this)}toPromise(e){return e=SA(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return t.create=n=>new t(n),t})();function SA(t){var n;return(n=t??ni.Promise)!==null&&n!==void 0?n:Promise}function I6(t){return t&&Ye(t.next)&&Ye(t.error)&&Ye(t.complete)}function S6(t){return t&&t instanceof Xc||I6(t)&&Ky(t)}function sS(t){return Ye(t?.lift)}function wt(t){return n=>{if(sS(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ft(t,n,e,r,o){return new aS(t,n,e,r,o)}var aS=class extends Xc{constructor(n,e,r,o,i,s){super(n),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){n.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function Yd(){return wt((t,n)=>{let e=null;t._refCount++;let r=ft(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var Zd=class extends bt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,sS(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new Sn;let e=this.getSubject();n.add(this.source.subscribe(ft(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=Sn.EMPTY)}return n}refCount(){return Yd()(this)}};var TA=Wd(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Pn=(()=>{class t extends bt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new Zy(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new TA}next(e){qd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){qd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){qd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?JI:(this.currentObservers=null,i.push(e),new Sn(()=>{this.currentObservers=null,Qm(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new bt;return e.source=this,e}}return t.create=(n,e)=>new Zy(n,e),t})(),Zy=class extends Pn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:JI}};var tr=class extends Pn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var Pr=new bt(t=>t.complete());function EA(t){return t&&Ye(t.schedule)}function _A(t){return t[t.length-1]}function Qy(t){return Ye(_A(t))?t.pop():void 0}function rl(t){return EA(_A(t))?t.pop():void 0}function NA(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})}function DA(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function Yc(t){return this instanceof Yc?(this.v=t,this):new Yc(t)}function kA(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){r[f]&&(o[f]=function(h){return new Promise(function(g,y){i.push([f,h,g,y])>1||l(f,h)})},m&&(o[f]=m(o[f])))}function l(f,m){try{c(r[f](m))}catch(h){p(i[0][3],h)}}function c(f){f.value instanceof Yc?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function p(f,m){f(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function AA(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof DA=="function"?DA(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}var Jy=t=>t&&typeof t.length=="number"&&typeof t!="function";function ex(t){return Ye(t?.then)}function tx(t){return Ye(t[Xd])}function nx(t){return Symbol.asyncIterator&&Ye(t?.[Symbol.asyncIterator])}function rx(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function T6(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var ox=T6();function ix(t){return Ye(t?.[ox])}function sx(t){return kA(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield Yc(e.read());if(o)return yield Yc(void 0);yield yield Yc(r)}}finally{e.releaseLock()}})}function ax(t){return Ye(t?.getReader)}function Tn(t){if(t instanceof bt)return t;if(t!=null){if(tx(t))return E6(t);if(Jy(t))return _6(t);if(ex(t))return D6(t);if(nx(t))return RA(t);if(ix(t))return N6(t);if(ax(t))return k6(t)}throw rx(t)}function E6(t){return new bt(n=>{let e=t[Xd]();if(Ye(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _6(t){return new bt(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function D6(t){return new bt(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Xy)})}function N6(t){return new bt(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function RA(t){return new bt(n=>{A6(t,n).catch(e=>n.error(e))})}function k6(t){return RA(sx(t))}function A6(t,n){var e,r,o,i;return NA(this,void 0,void 0,function*(){try{for(e=AA(t);r=yield e.next(),!r.done;){let s=r.value;if(n.next(s),n.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function $r(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function lx(t,n=0){return wt((e,r)=>{e.subscribe(ft(r,o=>$r(r,t,()=>r.next(o),n),()=>$r(r,t,()=>r.complete(),n),o=>$r(r,t,()=>r.error(o),n)))})}function cx(t,n=0){return wt((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function OA(t,n){return Tn(t).pipe(cx(n),lx(n))}function MA(t,n){return Tn(t).pipe(cx(n),lx(n))}function FA(t,n){return new bt(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function PA(t,n){return new bt(e=>{let r;return $r(e,n,()=>{r=t[ox](),$r(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>Ye(r?.return)&&r.return()})}function ux(t,n){if(!t)throw new Error("Iterable cannot be null");return new bt(e=>{$r(e,n,()=>{let r=t[Symbol.asyncIterator]();$r(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function $A(t,n){return ux(sx(t),n)}function LA(t,n){if(t!=null){if(tx(t))return OA(t,n);if(Jy(t))return FA(t,n);if(ex(t))return MA(t,n);if(nx(t))return ux(t,n);if(ix(t))return PA(t,n);if(ax(t))return $A(t,n)}throw rx(t)}function fn(t,n){return n?LA(t,n):Tn(t)}function He(...t){let n=rl(t);return fn(t,n)}function Qd(t,n){let e=Ye(t)?t:()=>t,r=o=>o.error(e());return new bt(n?o=>n.schedule(r,0,o):r)}function lS(t){return!!t&&(t instanceof bt||Ye(t.lift)&&Ye(t.subscribe))}var ps=Wd(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function tt(t,n){return wt((e,r)=>{let o=0;e.subscribe(ft(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:R6}=Array;function O6(t,n){return R6(n)?t(...n):t(n)}function dx(t){return tt(n=>O6(t,n))}var{isArray:M6}=Array,{getPrototypeOf:F6,prototype:P6,keys:$6}=Object;function px(t){if(t.length===1){let n=t[0];if(M6(n))return{args:n,keys:null};if(L6(n)){let e=$6(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function L6(t){return t&&typeof t=="object"&&F6(t)===P6}function fx(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function mx(...t){let n=rl(t),e=Qy(t),{args:r,keys:o}=px(t);if(r.length===0)return fn([],n);let i=new bt(V6(r,n,o?s=>fx(o,s):to));return e?i.pipe(dx(e)):i}function V6(t,n,e=to){return r=>{VA(n,()=>{let{length:o}=t,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)VA(n,()=>{let c=fn(t[l],n),u=!1;c.subscribe(ft(r,d=>{i[l]=d,u||(u=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function VA(t,n,e){t?$r(e,t,n):n()}function BA(t,n,e,r,o,i,s,a){let l=[],c=0,u=0,d=!1,p=()=>{d&&!l.length&&!c&&n.complete()},f=h=>c<r?m(h):l.push(h),m=h=>{i&&n.next(h),c++;let g=!1;Tn(e(h,u++)).subscribe(ft(n,y=>{o?.(y),i?f(y):n.next(y)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){let y=l.shift();s?$r(n,s,()=>m(y)):m(y)}p()}catch(y){n.error(y)}}))};return t.subscribe(ft(n,f,()=>{d=!0,p()})),()=>{a?.()}}function $n(t,n,e=1/0){return Ye(n)?$n((r,o)=>tt((i,s)=>n(r,i,o,s))(Tn(t(r,o))),e):(typeof n=="number"&&(e=n),wt((r,o)=>BA(r,o,t,e)))}function cS(t=1/0){return $n(to,t)}function zA(){return cS(1)}function Jd(...t){return zA()(fn(t,rl(t)))}function hx(t){return new bt(n=>{Tn(t()).subscribe(n)})}function uS(...t){let n=Qy(t),{args:e,keys:r}=px(t),o=new bt(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let d=!1;Tn(e[u]).subscribe(ft(i,p=>{d||(d=!0,c--),a[u]=p},()=>l--,void 0,()=>{(!l||!d)&&(c||i.next(r?fx(r,a):a),i.complete())}))}});return n?o.pipe(dx(n)):o}function no(t,n){return wt((e,r)=>{let o=0;e.subscribe(ft(r,i=>t.call(n,i,o++)&&r.next(i)))})}function ol(t){return wt((n,e)=>{let r=null,o=!1,i;r=n.subscribe(ft(e,void 0,void 0,s=>{i=Tn(t(s,ol(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function UA(t,n,e,r,o){return(i,s)=>{let a=e,l=n,c=0;i.subscribe(ft(s,u=>{let d=c++;l=a?t(l,u,d):(a=!0,u),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function il(t,n){return Ye(n)?$n(t,n,1):$n(t,1)}function sl(t){return wt((n,e)=>{let r=!1;n.subscribe(ft(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function fs(t){return t<=0?()=>Pr:wt((n,e)=>{let r=0;n.subscribe(ft(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function gx(t=B6){return wt((n,e)=>{let r=!1;n.subscribe(ft(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function B6(){return new ps}function Zc(t){return wt((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function ms(t,n){let e=arguments.length>=2;return r=>r.pipe(t?no((o,i)=>t(o,i,r)):to,fs(1),e?sl(n):gx(()=>new ps))}function ep(t){return t<=0?()=>Pr:wt((n,e)=>{let r=[];n.subscribe(ft(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function dS(t,n){let e=arguments.length>=2;return r=>r.pipe(t?no((o,i)=>t(o,i,r)):to,ep(1),e?sl(n):gx(()=>new ps))}function pS(t,n){return wt(UA(t,n,arguments.length>=2,!0))}function fS(...t){let n=rl(t);return wt((e,r)=>{(n?Jd(t,e,n):Jd(t,e)).subscribe(r)})}function ro(t,n){return wt((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(ft(r,l=>{o?.unsubscribe();let c=0,u=i++;Tn(t(l,u)).subscribe(o=ft(r,d=>r.next(n?n(l,d,u,c++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function mS(t){return wt((n,e)=>{Tn(t).subscribe(ft(e,()=>e.complete(),Jm)),!e.closed&&n.subscribe(e)})}function Gn(t,n,e){let r=Ye(t)||n||e?{next:t,error:n,complete:e}:t;return r?wt((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(ft(i,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),i.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):to}var ER="https://g.co/ng/security#xss",Ee=class extends Error{code;constructor(n,e){super(nv(n,e)),this.code=n}};function nv(t,n){return`${`NG0${Math.abs(t)}`}${n?": "+n:""}`}var _R=Symbol("InputSignalNode#UNSET"),z6=ot(he({},QI),{transformFn:void 0,applyValueToInputSignal(t,n){Hy(t,n)}});function DR(t,n){let e=Object.create(z6);e.value=t,e.transformFn=n?.transform;function r(){if(jy(e),e.value===_R)throw new Ee(-950,!1);return e.value}return r[Fr]=e,r}function ph(t){return{toString:t}.toString()}var yx="__parameters__";function U6(t){return function(...e){if(t){let r=t(...e);for(let o in r)this[o]=r[o]}}}function NR(t,n,e){return ph(()=>{let r=U6(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,c,u){let d=l.hasOwnProperty(yx)?l[yx]:Object.defineProperty(l,yx,{value:[]})[yx];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var Jc=globalThis;function Kt(t){for(let n in t)if(t[n]===Kt)return n;throw Error("Could not find renamed property on target object.")}function j6(t,n){for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Ir(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Ir).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let n=t.toString();if(n==null)return""+n;let e=n.indexOf(`
`);return e===-1?n:n.substring(0,e)}function _S(t,n){return t==null||t===""?n===null?"":n:n==null||n===""?t:t+" "+n}var G6=Kt({__forward_ref__:Kt});function nr(t){return t.__forward_ref__=nr,t.toString=function(){return Ir(this())},t}function Cr(t){return kR(t)?t():t}function kR(t){return typeof t=="function"&&t.hasOwnProperty(G6)&&t.__forward_ref__===nr}function ke(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Cs(t){return{providers:t.providers||[],imports:t.imports||[]}}function rv(t){return jA(t,RR)||jA(t,OR)}function AR(t){return rv(t)!==null}function jA(t,n){return t.hasOwnProperty(n)?t[n]:null}function W6(t){let n=t&&(t[RR]||t[OR]);return n||null}function GA(t){return t&&(t.hasOwnProperty(WA)||t.hasOwnProperty(H6))?t[WA]:null}var RR=Kt({\u0275prov:Kt}),WA=Kt({\u0275inj:Kt}),OR=Kt({ngInjectableDef:Kt}),H6=Kt({ngInjectorDef:Kt}),Re=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=ke({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function MR(t){return t&&!!t.\u0275providers}var q6=Kt({\u0275cmp:Kt}),K6=Kt({\u0275dir:Kt}),X6=Kt({\u0275pipe:Kt}),Y6=Kt({\u0275mod:Kt}),_x=Kt({\u0275fac:Kt}),rh=Kt({__NG_ELEMENT_ID__:Kt}),HA=Kt({__NG_ENV_ID__:Kt});function hs(t){return typeof t=="string"?t:t==null?"":String(t)}function Z6(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():hs(t)}function Q6(t,n){let e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Ee(-200,t)}function mT(t,n){throw new Ee(-201,!1)}var st=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(st||{}),DS;function FR(){return DS}function Lr(t){let n=DS;return DS=t,n}function PR(t,n,e){let r=rv(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&st.Optional)return null;if(n!==void 0)return n;mT(t,"Injector")}var J6={},oh=J6,NS="__NG_DI_FLAG__",Dx="ngTempTokenPath",eK="ngTokenPath",tK=/\n/gm,nK="\u0275",qA="__source",op;function rK(){return op}function al(t){let n=op;return op=t,n}function oK(t,n=st.Default){if(op===void 0)throw new Ee(-203,!1);return op===null?PR(t,void 0,n):op.get(t,n&st.Optional?null:void 0,n)}function $e(t,n=st.Default){return(FR()||oK)(Cr(t),n)}function ue(t,n=st.Default){return $e(t,ov(n))}function ov(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function kS(t){let n=[];for(let e=0;e<t.length;e++){let r=Cr(t[e]);if(Array.isArray(r)){if(r.length===0)throw new Ee(900,!1);let o,i=st.Default;for(let s=0;s<r.length;s++){let a=r[s],l=iK(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}n.push($e(o,i))}else n.push($e(r))}return n}function $R(t,n){return t[NS]=n,t.prototype[NS]=n,t}function iK(t){return t[NS]}function sK(t,n,e,r){let o=t[Dx];throw n[qA]&&o.unshift(n[qA]),t.message=aK(`
`+t.message,o,e,r),t[eK]=o,t[Dx]=null,t}function aK(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==nK?t.slice(2):t;let o=Ir(n);if(Array.isArray(n))o=n.map(Ir).join(" -> ");else if(typeof n=="object"){let i=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Ir(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(tK,`
  `)}`}var LR=$R(NR("Optional"),8);var lK=$R(NR("SkipSelf"),4);function tu(t,n){let e=t.hasOwnProperty(_x);return e?t[_x]:null}function hT(t,n){t.forEach(e=>Array.isArray(e)?hT(e,n):n(e))}function VR(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function Nx(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function cK(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(o===1)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;){let i=o-2;t[o]=t[i],o--}t[n]=e,t[n+1]=r}}function gT(t,n,e){let r=fh(t,n);return r>=0?t[r|1]=e:(r=~r,cK(t,r,n,e)),r}function hS(t,n){let e=fh(t,n);if(e>=0)return t[e|1]}function fh(t,n){return uK(t,n,1)}function uK(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=t[i<<e];if(n===s)return i<<e;s>n?o=i:r=i+1}return~(o<<e)}var sp={},Vr=[],ap=new Re(""),BR=new Re("",-1),zR=new Re(""),kx=class{get(n,e=oh){if(e===oh){let r=new Error(`NullInjectorError: No provider for ${Ir(n)}!`);throw r.name="NullInjectorError",r}return e}};function UR(t,n){let e=t[Y6]||null;if(!e&&n===!0)throw new Error(`Type ${Ir(t)} does not have '\u0275mod' property.`);return e}function nu(t){return t[q6]||null}function jR(t){return t[K6]||null}function GR(t){return t[X6]||null}function WR(t){let n=nu(t)||jR(t)||GR(t);return n!==null&&n.standalone}function gp(t){return{\u0275providers:t}}function dK(...t){return{\u0275providers:HR(!0,t),\u0275fromNgModule:!0}}function HR(t,...n){let e=[],r=new Set,o,i=s=>{e.push(s)};return hT(n,s=>{let a=s;AS(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&qR(o,i),e}function qR(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];yT(o,i=>{n(i,r)})}}function AS(t,n,e,r){if(t=Cr(t),!t)return!1;let o=null,i=GA(t),s=!i&&nu(t);if(!i&&!s){let l=t.ngModule;if(i=GA(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=t}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)AS(c,n,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let c;try{hT(i.imports,u=>{AS(u,n,e,r)&&(c||=[],c.push(u))})}finally{}c!==void 0&&qR(c,n)}if(!a){let c=tu(o)||(()=>new o);n({provide:o,useFactory:c,deps:Vr},o),n({provide:zR,useValue:o,multi:!0},o),n({provide:ap,useValue:()=>$e(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let c=t;yT(l,u=>{n(u,c)})}}else return!1;return o!==t&&t.providers!==void 0}function yT(t,n){for(let e of t)MR(e)&&(e=e.\u0275providers),Array.isArray(e)?yT(e,n):n(e)}var pK=Kt({provide:String,useValue:Kt});function KR(t){return t!==null&&typeof t=="object"&&pK in t}function fK(t){return!!(t&&t.useExisting)}function mK(t){return!!(t&&t.useFactory)}function lp(t){return typeof t=="function"}function hK(t){return!!t.useClass}var iv=new Re(""),wx={},gK={},gS;function xT(){return gS===void 0&&(gS=new kx),gS}var Br=class{},ih=class extends Br{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,OS(n,s=>this.processProvider(s)),this.records.set(BR,tp(void 0,this)),o.has("environment")&&this.records.set(Br,tp(void 0,this));let i=this.records.get(iv);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(zR,Vr,st.Self))}destroy(){th(this),this._destroyed=!0;let n=vt(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),vt(n)}}onDestroy(n){return th(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){th(this);let e=al(this),r=Lr(void 0),o;try{return n()}finally{al(e),Lr(r)}}get(n,e=oh,r=st.Default){if(th(this),n.hasOwnProperty(HA))return n[HA](this);r=ov(r);let o,i=al(this),s=Lr(void 0);try{if(!(r&st.SkipSelf)){let l=this.records.get(n);if(l===void 0){let c=wK(n)&&rv(n);c&&this.injectableDefInScope(c)?l=tp(RS(n),wx):l=null,this.records.set(n,l)}if(l!=null)return this.hydrate(n,l)}let a=r&st.Self?xT():this.parent;return e=r&st.Optional&&e===oh?null:e,a.get(n,e)}catch(a){if(a.name==="NullInjectorError"){if((a[Dx]=a[Dx]||[]).unshift(Ir(n)),i)throw a;return sK(a,n,"R3InjectorError",this.source)}else throw a}finally{Lr(s),al(i)}}resolveInjectorInitializers(){let n=vt(null),e=al(this),r=Lr(void 0),o;try{let i=this.get(ap,Vr,st.Self);for(let s of i)s()}finally{al(e),Lr(r),vt(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Ir(r));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Cr(n);let e=lp(n)?n:Cr(n&&n.provide),r=xK(n);if(!lp(n)&&n.multi===!0){let o=this.records.get(e);o||(o=tp(void 0,wx,!0),o.factory=()=>kS(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){let r=vt(null);try{return e.value===wx&&(e.value=gK,e.value=e.factory()),typeof e.value=="object"&&e.value&&bK(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{vt(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=Cr(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function RS(t){let n=rv(t),e=n!==null?n.factory:tu(t);if(e!==null)return e;if(t instanceof Re)throw new Ee(204,!1);if(t instanceof Function)return yK(t);throw new Ee(204,!1)}function yK(t){if(t.length>0)throw new Ee(204,!1);let e=W6(t);return e!==null?()=>e.factory(t):()=>new t}function xK(t){if(KR(t))return tp(void 0,t.useValue);{let n=XR(t);return tp(n,wx)}}function XR(t,n,e){let r;if(lp(t)){let o=Cr(t);return tu(o)||RS(o)}else if(KR(t))r=()=>Cr(t.useValue);else if(mK(t))r=()=>t.useFactory(...kS(t.deps||[]));else if(fK(t))r=()=>$e(Cr(t.useExisting));else{let o=Cr(t&&(t.useClass||t.provide));if(vK(t))r=()=>new o(...kS(t.deps));else return tu(o)||RS(o)}return r}function th(t){if(t.destroyed)throw new Ee(205,!1)}function tp(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function vK(t){return!!t.deps}function bK(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function wK(t){return typeof t=="function"||typeof t=="object"&&t instanceof Re}function OS(t,n){for(let e of t)Array.isArray(e)?OS(e,n):e&&MR(e)?OS(e.\u0275providers,n):n(e)}function rr(t,n){t instanceof ih&&th(t);let e,r=al(t),o=Lr(void 0);try{return n()}finally{al(r),Lr(o)}}function YR(){return FR()!==void 0||rK()!=null}function ZR(t){if(!YR())throw new Ee(-203,!1)}function CK(t){return typeof t=="function"}var Is=0,Ct=1,qe=2,Sr=3,ii=4,si=5,Ax=6,Rx=7,To=8,sh=9,gs=10,gn=11,ah=12,KA=13,yp=14,Ri=15,cp=16,np=17,up=18,sv=19,QR=20,ll=21,Cx=22,ru=23,oo=24,Eo=25,JR=1;var ou=7,Ox=8,Mx=9,So=10;function cl(t){return Array.isArray(t)&&typeof t[JR]=="object"}function Ss(t){return Array.isArray(t)&&t[JR]===!0}function vT(t){return(t.flags&4)!==0}function du(t){return t.componentOffset>-1}function av(t){return(t.flags&1)===1}function ys(t){return!!t.template}function Fx(t){return(t[qe]&512)!==0}function mh(t){return(t[qe]&256)===256}var MS=class{previousValue;currentValue;firstChange;constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function eO(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}var ai=(()=>{let t=()=>tO;return t.ngInherit=!0,t})();function tO(t){return t.type.prototype.ngOnChanges&&(t.setInput=SK),IK}function IK(){let t=rO(this),n=t?.current;if(n){let e=t.previous;if(e===sp)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function SK(t,n,e,r,o){let i=this.declaredInputs[r],s=rO(t)||TK(t,{previous:sp,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[i];a[i]=new MS(c&&c.currentValue,e,l===sp),eO(t,n,o,e)}var nO="__ngSimpleChanges__";function rO(t){return t[nO]||null}function TK(t,n){return t[nO]=n}var XA=null;var Io=function(t,n,e){XA?.(t,n,e)},EK="svg",_K="math";function Oi(t){for(;Array.isArray(t);)t=t[Is];return t}function oO(t,n){return Oi(n[t])}function li(t,n){return Oi(n[t.index])}function iO(t,n){return t.data[n]}function DK(t,n){return t[n]}function Mi(t,n){let e=n[t];return cl(e)?e:e[Is]}function bT(t){return(t[qe]&128)===128}function NK(t){return Ss(t[Sr])}function dp(t,n){return n==null?null:t[n]}function sO(t){t[np]=0}function wT(t){t[qe]&1024||(t[qe]|=1024,bT(t)&&hh(t))}function kK(t,n){for(;t>0;)n=n[yp],t--;return n}function lv(t){return!!(t[qe]&9216||t[oo]?.dirty)}function FS(t){t[gs].changeDetectionScheduler?.notify(9),t[qe]&64&&(t[qe]|=1024),lv(t)&&hh(t)}function hh(t){t[gs].changeDetectionScheduler?.notify(0);let n=iu(t);for(;n!==null&&!(n[qe]&8192||(n[qe]|=8192,!bT(n)));)n=iu(n)}function aO(t,n){if(mh(t))throw new Ee(911,!1);t[ll]===null&&(t[ll]=[]),t[ll].push(n)}function AK(t,n){if(t[ll]===null)return;let e=t[ll].indexOf(n);e!==-1&&t[ll].splice(e,1)}function iu(t){let n=t[Sr];return Ss(n)?n[Sr]:n}function RK(t){return t[Rx]??=[]}function OK(t){return t.cleanup??=[]}var lt={lFrame:gO(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var PS=!1;function MK(){return lt.lFrame.elementDepthCount}function FK(){lt.lFrame.elementDepthCount++}function PK(){lt.lFrame.elementDepthCount--}function lO(){return lt.bindingsEnabled}function $K(){return lt.skipHydrationRootTNode!==null}function LK(t){return lt.skipHydrationRootTNode===t}function VK(){lt.skipHydrationRootTNode=null}function It(){return lt.lFrame.lView}function Hn(){return lt.lFrame.tView}function Me(t){return lt.lFrame.contextLView=t,t[To]}function Fe(t){return lt.lFrame.contextLView=null,t}function Tr(){let t=cO();for(;t!==null&&t.type===64;)t=t.parent;return t}function cO(){return lt.lFrame.currentTNode}function BK(){let t=lt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function pu(t,n){let e=lt.lFrame;e.currentTNode=t,e.isParent=n}function CT(){return lt.lFrame.isParent}function uO(){lt.lFrame.isParent=!1}function dO(){return PS}function Px(t){let n=PS;return PS=t,n}function IT(){let t=lt.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function pO(){return lt.lFrame.bindingIndex}function zK(t){return lt.lFrame.bindingIndex=t}function cv(){return lt.lFrame.bindingIndex++}function uv(t){let n=lt.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function UK(){return lt.lFrame.inI18n}function jK(t,n){let e=lt.lFrame;e.bindingIndex=e.bindingRootIndex=t,$S(n)}function GK(){return lt.lFrame.currentDirectiveIndex}function $S(t){lt.lFrame.currentDirectiveIndex=t}function WK(t){let n=lt.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function fO(t){lt.lFrame.currentQueryIndex=t}function HK(t){let n=t[Ct];return n.type===2?n.declTNode:n.type===1?t[si]:null}function mO(t,n,e){if(e&st.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&st.Host);)if(o=HK(i),o===null||(i=i[yp],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=lt.lFrame=hO();return r.currentTNode=n,r.lView=t,!0}function ST(t){let n=hO(),e=t[Ct];lt.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function hO(){let t=lt.lFrame,n=t===null?null:t.child;return n===null?gO(t):n}function gO(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function yO(){let t=lt.lFrame;return lt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var xO=yO;function TT(){let t=yO();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function qK(t){return(lt.lFrame.contextLView=kK(t,lt.lFrame.contextLView))[To]}function Ts(){return lt.lFrame.selectedIndex}function su(t){lt.lFrame.selectedIndex=t}function dv(){let t=lt.lFrame;return iO(t.tView,t.selectedIndex)}function KK(){return lt.lFrame.currentNamespace}var vO=!0;function pv(){return vO}function fv(t){vO=t}function XK(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let s=tO(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function mv(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),l&&(t.viewHooks??=[]).push(-e,l),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),u!=null&&(t.destroyHooks??=[]).push(e,u)}}function Ix(t,n,e){bO(t,n,3,e)}function Sx(t,n,e,r){(t[qe]&3)===e&&bO(t,n,e,r)}function yS(t,n){let e=t[qe];(e&3)===n&&(e&=16383,e+=1,t[qe]=e)}function bO(t,n,e,r){let o=r!==void 0?t[np]&65535:0,i=r??-1,s=n.length-1,a=0;for(let l=o;l<s;l++)if(typeof n[l+1]=="number"){if(a=n[l],r!=null&&a>=r)break}else n[l]<0&&(t[np]+=65536),(a<i||i==-1)&&(YK(t,e,n,l),t[np]=(t[np]&4294901760)+l+2),l++}function YA(t,n){Io(4,t,n);let e=vt(null);try{n.call(t)}finally{vt(e),Io(5,t,n)}}function YK(t,n,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=t[s];o?t[qe]>>14<t[np]>>16&&(t[qe]&3)===n&&(t[qe]+=16384,YA(a,i)):YA(a,i)}var ip=-1,au=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,r){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=r}};function ZK(t){return t instanceof au}function QK(t){return(t.flags&8)!==0}function JK(t){return(t.flags&16)!==0}function e9(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,i)}else{let i=o,s=e[++r];t9(i)?t.setProperty(n,i,s):t.setAttribute(n,i,s),r++}}return r}function wO(t){return t===3||t===4||t===6}function t9(t){return t.charCodeAt(0)===64}function pp(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?ZA(t,e,o,null,n[++r]):ZA(t,e,o,null,null))}}return t}function ZA(t,n,e,r,o){let i=0,s=t.length;if(n===-1)s=-1;else for(;i<t.length;){let a=t[i++];if(typeof a=="number"){if(a===n){s=-1;break}else if(a>n){s=i-1;break}}}for(;i<t.length;){let a=t[i];if(typeof a=="number")break;if(a===e){if(r===null){o!==null&&(t[i+1]=o);return}else if(r===t[i+1]){t[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}s!==-1&&(t.splice(s,0,n),i=s+1),t.splice(i++,0,e),r!==null&&t.splice(i++,0,r),o!==null&&t.splice(i++,0,o)}var xS={},LS=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=ov(r);let o=this.injector.get(n,xS,r);return o!==xS||e===xS?o:this.parentInjector.get(n,e,r)}};function CO(t){return t!==ip}function $x(t){return t&32767}function n9(t){return t>>16}function Lx(t,n){let e=n9(t),r=n;for(;e>0;)r=r[yp],e--;return r}var VS=!0;function Vx(t){let n=VS;return VS=t,n}var r9=256,IO=r9-1,SO=5,o9=0,Ai={};function i9(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(rh)&&(r=e[rh]),r==null&&(r=e[rh]=o9++);let o=r&IO,i=1<<o;n.data[t+(o>>SO)]|=i}function Bx(t,n){let e=TO(t,n);if(e!==-1)return e;let r=n[Ct];r.firstCreatePass&&(t.injectorIndex=n.length,vS(r.data,t),vS(n,null),vS(r.blueprint,null));let o=ET(t,n),i=t.injectorIndex;if(CO(o)){let s=$x(o),a=Lx(o,n),l=a[Ct].data;for(let c=0;c<8;c++)n[i+c]=a[s+c]|l[s+c]}return n[i+8]=o,i}function vS(t,n){t.push(0,0,0,0,0,0,0,0,n)}function TO(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function ET(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=kO(o),r===null)return ip;if(e++,o=o[yp],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return ip}function BS(t,n,e){i9(t,n,e)}function s9(t,n){if(n==="class")return t.classes;if(n==="style")return t.styles;let e=t.attrs;if(e){let r=e.length,o=0;for(;o<r;){let i=e[o];if(wO(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<r&&typeof e[o]=="string";)o++;else{if(i===n)return e[o+1];o=o+2}}}return null}function EO(t,n,e){if(e&st.Optional||t!==void 0)return t;mT(n,"NodeInjector")}function _O(t,n,e,r){if(e&st.Optional&&r===void 0&&(r=null),!(e&(st.Self|st.Host))){let o=t[sh],i=Lr(void 0);try{return o?o.get(n,r,e&st.Optional):PR(n,r,e&st.Optional)}finally{Lr(i)}}return EO(r,n,e)}function DO(t,n,e,r=st.Default,o){if(t!==null){if(n[qe]&2048&&!(r&st.Self)){let s=d9(t,n,e,r,Ai);if(s!==Ai)return s}let i=NO(t,n,e,r,Ai);if(i!==Ai)return i}return _O(n,e,r,o)}function NO(t,n,e,r,o){let i=c9(e);if(typeof i=="function"){if(!mO(n,t,r))return r&st.Host?EO(o,e,r):_O(n,e,r,o);try{let s;if(s=i(r),s==null&&!(r&st.Optional))mT(e);else return s}finally{xO()}}else if(typeof i=="number"){let s=null,a=TO(t,n),l=ip,c=r&st.Host?n[Ri][si]:null;for((a===-1||r&st.SkipSelf)&&(l=a===-1?ET(t,n):n[a+8],l===ip||!JA(r,!1)?a=-1:(s=n[Ct],a=$x(l),n=Lx(l,n)));a!==-1;){let u=n[Ct];if(QA(i,a,u.data)){let d=a9(a,n,e,s,r,c);if(d!==Ai)return d}l=n[a+8],l!==ip&&JA(r,n[Ct].data[a+8]===c)&&QA(i,a,n)?(s=u,a=$x(l),n=Lx(l,n)):a=-1}}return o}function a9(t,n,e,r,o,i){let s=n[Ct],a=s.data[t+8],l=r==null?du(a)&&VS:r!=s&&(a.type&3)!==0,c=o&st.Host&&i===a,u=l9(a,s,e,l,c);return u!==null?zx(n,s,u,a):Ai}function l9(t,n,e,r,o){let i=t.providerIndexes,s=n.data,a=i&1048575,l=t.directiveStart,c=t.directiveEnd,u=i>>20,d=r?a:a+u,p=o?a+u:c;for(let f=d;f<p;f++){let m=s[f];if(f<l&&e===m||f>=l&&m.type===e)return f}if(o){let f=s[l];if(f&&ys(f)&&f.type===e)return l}return null}function zx(t,n,e,r){let o=t[e],i=n.data;if(ZK(o)){let s=o;s.resolving&&Q6(Z6(i[e]));let a=Vx(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?Lr(s.injectImpl):null,u=mO(t,r,st.Default);try{o=t[e]=s.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&XK(e,i[e],n)}finally{c!==null&&Lr(c),Vx(a),s.resolving=!1,xO()}}return o}function c9(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(rh)?t[rh]:void 0;return typeof n=="number"?n>=0?n&IO:u9:n}function QA(t,n,e){let r=1<<t;return!!(e[n+(t>>SO)]&r)}function JA(t,n){return!(t&st.Self)&&!(t&st.Host&&n)}var eu=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return DO(this._tNode,this._lView,n,ov(r),e)}};function u9(){return new eu(Tr(),It())}function _o(t){return ph(()=>{let n=t.prototype.constructor,e=n[_x]||zS(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[_x]||zS(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function zS(t){return kR(t)?()=>{let n=zS(Cr(t));return n&&n()}:tu(t)}function d9(t,n,e,r,o){let i=t,s=n;for(;i!==null&&s!==null&&s[qe]&2048&&!Fx(s);){let a=NO(i,s,e,r|st.Self,Ai);if(a!==Ai)return a;let l=i.parent;if(!l){let c=s[QR];if(c){let u=c.get(e,Ai,r);if(u!==Ai)return u}l=kO(s),s=s[yp]}i=l}return o}function kO(t){let n=t[Ct],e=n.type;return e===2?n.declTNode:e===1?t[si]:null}function _T(t){return s9(Tr(),t)}function eR(t,n=null,e=null,r){let o=AO(t,n,e,r);return o.resolveInjectorInitializers(),o}function AO(t,n=null,e=null,r,o=new Set){let i=[e||Vr,dK(t)];return r=r||(typeof t=="object"?void 0:Ir(t)),new ih(i,n||xT(),r||null,o)}var Wn=class t{static THROW_IF_NOT_FOUND=oh;static NULL=new kx;static create(n,e){if(Array.isArray(n))return eR({name:""},e,n,"");{let r=n.name??"";return eR({name:r},n.parent,n.providers,r)}}static \u0275prov=ke({token:t,providedIn:"any",factory:()=>$e(BR)});static __NG_ELEMENT_ID__=-1};var p9=new Re("");p9.__NG_ELEMENT_ID__=t=>{let n=Tr();if(n===null)throw new Ee(204,!1);if(n.type&2)return n.value;if(t&st.Optional)return null;throw new Ee(204,!1)};var RO=!1,xp=(()=>{class t{static __NG_ELEMENT_ID__=f9;static __NG_ENV_ID__=e=>e}return t})(),Ux=class extends xp{_lView;constructor(n){super(),this._lView=n}onDestroy(n){return aO(this._lView,n),()=>AK(this._lView,n)}};function f9(){return new Ux(It())}var lu=class{},hv=new Re("",{providedIn:"root",factory:()=>!1});var OO=new Re(""),DT=new Re(""),Es=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new tr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=ke({token:t,providedIn:"root",factory:()=>new t})}return t})();var US=class extends Pn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,YR()&&(this.destroyRef=ue(xp,{optional:!0})??void 0,this.pendingTasks=ue(Es,{optional:!0})??void 0)}emit(n){let e=vt(null);try{super.next(n)}finally{vt(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),s=r;if(n&&typeof n=="object"){let l=n;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return n instanceof Sn&&n.add(a),a}wrapInTimeout(n){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{n(e),r!==void 0&&this.pendingTasks?.remove(r)})}}},Bt=US;function lh(...t){}function MO(t){let n,e;function r(){t=lh;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{t(),r()})),()=>r()}function tR(t){return queueMicrotask(()=>t()),()=>{t=lh}}var NT="isAngularZone",jx=NT+"_ID",m9=0,En=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Bt(!1);onMicrotaskEmpty=new Bt(!1);onStable=new Bt(!1);onError=new Bt(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=RO}=n;if(typeof Zone>"u")throw new Ee(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,y9(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(NT)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new Ee(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new Ee(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,n,h9,lh,lh);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},h9={};function kT(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function g9(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){MO(()=>{t.callbackScheduled=!1,jS(t),t.isCheckStableRunning=!0,kT(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),jS(t)}function y9(t){let n=()=>{g9(t)},e=m9++;t._inner=t._inner.fork({name:"angular",properties:{[NT]:!0,[jx]:e,[jx+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(x9(l))return r.invokeTask(i,s,a,l);try{return nR(t),r.invokeTask(i,s,a,l)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),rR(t)}},onInvoke:(r,o,i,s,a,l,c)=>{try{return nR(t),r.invoke(i,s,a,l,c)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!v9(l)&&n(),rR(t)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,jS(t),kT(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function jS(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function nR(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function rR(t){t._nesting--,kT(t)}var Gx=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Bt;onMicrotaskEmpty=new Bt;onStable=new Bt;onError=new Bt;run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}};function x9(t){return FO(t,"__ignore_ng_zone__")}function v9(t){return FO(t,"__scheduler_tick__")}function FO(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var xs=class{_console=console;handleError(n){this._console.error("ERROR",n)}},b9=new Re("",{providedIn:"root",factory:()=>{let t=ue(En),n=ue(xs);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function oR(t,n){return DR(t,n)}function w9(t){return DR(_R,t)}var PO=(oR.required=w9,oR);function C9(){return gv(Tr(),It())}function gv(t,n){return new Do(li(t,n))}var Do=(()=>{class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=C9}return t})();var iR=new Set;function pl(t){iR.has(t)||(iR.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function I9(t){return typeof t=="function"&&t[Fr]!==void 0}function io(t,n){pl("NgSignals");let e=gA(t),r=e[Fr];return n?.equal&&(r.equal=n.equal),e.set=o=>Hy(r,o),e.update=o=>yA(r,o),e.asReadonly=S9.bind(e),e}function S9(){let t=this[Fr];if(t.readonlyFn===void 0){let n=()=>this();n[Fr]=t,t.readonlyFn=n}return t.readonlyFn}function $O(t){return I9(t)&&typeof t.set=="function"}function LO(t){return(t.flags&128)===128}var VO=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(VO||{}),BO=new Map,T9=0;function E9(){return T9++}function _9(t){BO.set(t[sv],t)}function GS(t){BO.delete(t[sv])}var sR="__ngContext__";function fu(t,n){cl(n)?(t[sR]=n[sv],_9(n)):t[sR]=n}function zO(t){return jO(t[ah])}function UO(t){return jO(t[ii])}function jO(t){for(;t!==null&&!Ss(t);)t=t[ii];return t}var WS;function GO(t){WS=t}function D9(){if(WS!==void 0)return WS;if(typeof document<"u")return document;throw new Ee(210,!1)}var AT=new Re("",{providedIn:"root",factory:()=>N9}),N9="ng",RT=new Re(""),No=new Re("",{providedIn:"platform",factory:()=>"unknown"});var OT=new Re("",{providedIn:"root",factory:()=>D9().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var k9="h",A9="b";var WO=!1,R9=new Re("",{providedIn:"root",factory:()=>WO});var HO=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(HO||{}),yv=new Re("");var O9=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=ke({token:t,providedIn:"root",factory:()=>new t})}return t})();var M9=()=>null;function qO(t,n,e=!1){return M9(t,n,e)}function KO(t,n){let e=t.contentQueries;if(e!==null){let r=vt(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=t.data[s];fO(i),a.contentQueries(2,n[s],s)}}}finally{vt(r)}}}function HS(t,n,e){fO(0);let r=vt(null);try{n(t,e)}finally{vt(r)}}function MT(t,n,e){if(vT(n)){let r=vt(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let s=o;s<i;s++){let a=t.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{vt(r)}}}var Fi=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Fi||{});var xx;function F9(){if(xx===void 0&&(xx=null,Jc.trustedTypes))try{xx=Jc.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return xx}function aR(t){return F9()?.createScriptURL(t)||t}var Wx=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ER})`}};function vp(t){return t instanceof Wx?t.changingThisBreaksApplicationSecurity:t}function FT(t,n){let e=P9(t);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${ER})`)}return e===n}function P9(t){return t instanceof Wx&&t.getTypeName()||null}var $9=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function XO(t){return t=String(t),t.match($9)?t:"unsafe:"+t}var xv=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(xv||{});function L9(t){let n=ZO();return n?n.sanitize(xv.URL,t)||"":FT(t,"URL")?vp(t):XO(hs(t))}function V9(t){let n=ZO();if(n)return aR(n.sanitize(xv.RESOURCE_URL,t)||"");if(FT(t,"ResourceURL"))return aR(vp(t));throw new Ee(904,!1)}function B9(t,n){return n==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||n==="href"&&(t==="base"||t==="link")?V9:L9}function YO(t,n,e){return B9(n,e)(t)}function ZO(){let t=It();return t&&t[gs].sanitizer}var z9=/^>|^->|<!--|-->|--!>|<!-$/g,U9=/(<|>)/g,j9="\u200B$1\u200B";function G9(t){return t.replace(z9,n=>n.replace(U9,j9))}function QO(t){return t instanceof Function?t():t}var ul=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(ul||{});function W9(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}var JO="ng-template";function H9(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&W9(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if(PT(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function PT(t){return t.type===4&&t.value!==JO}function q9(t,n,e){let r=t.type===4&&!e?JO:t.value;return n===r}function K9(t,n,e){let r=4,o=t.attrs,i=o!==null?Z9(o):0,s=!1;for(let a=0;a<n.length;a++){let l=n[a];if(typeof l=="number"){if(!s&&!ri(r)&&!ri(l))return!1;if(s&&ri(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!q9(t,l,e)||l===""&&n.length===1){if(ri(r))return!1;s=!0}}else if(r&8){if(o===null||!H9(t,o,l,e)){if(ri(r))return!1;s=!0}}else{let c=n[++a],u=X9(l,o,PT(t),e);if(u===-1){if(ri(r))return!1;s=!0;continue}if(c!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),r&2&&c!==d){if(ri(r))return!1;s=!0}}}}return ri(r)||s}function ri(t){return(t&1)===0}function X9(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let s=n[o];if(s===t)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=n[++o];for(;typeof a=="string";)a=n[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return Q9(n,t)}function Y9(t,n,e=!1){for(let r=0;r<n.length;r++)if(K9(t,n[r],e))return!0;return!1}function Z9(t){for(let n=0;n<t.length;n++){let e=t[n];if(wO(e))return n}return t.length}function Q9(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function lR(t,n){return t?":not("+n.trim()+")":n}function J9(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let s=t[e];if(typeof s=="string")if(r&2){let a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!ri(s)&&(n+=lR(i,o),o=""),r=s,i=i||!ri(r);e++}return o!==""&&(n+=lR(i,o)),n}function e7(t){return t.map(J9).join(",")}function t7(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!ri(o))break;o=i}r++}return e.length&&n.push(1,...e),n}var zr={};function n7(t,n){return t.createText(n)}function r7(t,n,e){t.setValue(n,e)}function o7(t,n){return t.createComment(G9(n))}function eM(t,n,e){return t.createElement(n,e)}function Hx(t,n,e,r,o){t.insertBefore(n,e,r,o)}function tM(t,n,e){t.appendChild(n,e)}function cR(t,n,e,r,o){r!==null?Hx(t,n,e,r,o):tM(t,n,e)}function i7(t,n,e){t.removeChild(null,n,e)}function s7(t,n,e){t.setAttribute(n,"style",e)}function a7(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function nM(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&e9(t,n,r),o!==null&&a7(t,n,o),i!==null&&s7(t,n,i)}function B(t=1){rM(Hn(),It(),Ts()+t,!1)}function rM(t,n,e,r){if(!r)if((n[qe]&3)===3){let i=t.preOrderCheckHooks;i!==null&&Ix(n,i,e)}else{let i=t.preOrderHooks;i!==null&&Sx(n,i,0,e)}su(e)}function re(t,n=st.Default){let e=It();if(e===null)return $e(t,n);let r=Tr();return DO(r,e,Cr(t),n)}function oM(t,n,e,r,o,i){let s=vt(null);try{let a=null;o&ul.SignalBased&&(a=n[r][Fr]),a!==null&&a.transformFn!==void 0&&(i=a.transformFn(i)),o&ul.HasDecoratorInputTransform&&(i=t.inputTransforms[r].call(n,i)),t.setInput!==null?t.setInput(n,a,i,e,r):eO(n,a,r,i)}finally{vt(s)}}function $T(t,n,e,r,o,i,s,a,l,c,u){let d=n.blueprint.slice();return d[Is]=o,d[qe]=r|4|128|8|64|1024,(c!==null||t&&t[qe]&2048)&&(d[qe]|=2048),sO(d),d[Sr]=d[yp]=t,d[To]=e,d[gs]=s||t&&t[gs],d[gn]=a||t&&t[gn],d[sh]=l||t&&t[sh]||null,d[si]=i,d[sv]=E9(),d[Ax]=u,d[QR]=c,d[Ri]=n.type==2?t[Ri]:d,d}function iM(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function sM(t,n,e,r,o){let i=Ts(),s=r&2;try{su(-1),s&&n.length>Eo&&rM(t,n,Eo,!1),Io(s?2:0,o),e(r,o)}finally{su(i),Io(s?3:1,o)}}function LT(t,n,e){lO()&&(fu(li(e,n),n),aM(t,n,e))}function aM(t,n,e){x7(t,n,e),(e.flags&64)===64&&v7(t,n,e)}function VT(t,n,e=li){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(n,t):t[s];t[o++]=a}}}function l7(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=BT(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function BT(t,n,e,r,o,i,s,a,l,c,u){let d=Eo+r,p=d+o,f=c7(d,p),m=typeof c=="function"?c():c;return f[Ct]={type:t,blueprint:f,template:e,queries:null,viewQuery:a,declTNode:n,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:m,incompleteFirstPass:!1,ssrId:u}}function c7(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:zr);return e}function u7(t,n,e,r){let i=r.get(R9,WO)||e===Fi.ShadowDom,s=t.selectRootElement(n,i);return d7(s),s}function d7(t){p7(t)}var p7=()=>null;function uR(t,n,e,r,o){for(let i in n){if(!n.hasOwnProperty(i))continue;let s=n[i];if(s===void 0)continue;r??={};let a,l=ul.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}t===0?dR(r,e,c,a,l):dR(r,e,c,a)}return r}function dR(t,n,e,r,o){let i;t.hasOwnProperty(e)?(i=t[e]).push(n,r):i=t[e]=[n,r],o!==void 0&&i.push(o)}function f7(t,n,e){let r=n.directiveStart,o=n.directiveEnd,i=t.data,s=n.attrs,a=[],l=null,c=null;for(let u=r;u<o;u++){let d=i[u],p=e?e.get(d):null,f=p?p.inputs:null,m=p?p.outputs:null;l=uR(0,d.inputs,u,l,f),c=uR(1,d.outputs,u,c,m);let h=l!==null&&s!==null&&!PT(n)?R7(l,u,s):null;a.push(h)}l!==null&&(l.hasOwnProperty("class")&&(n.flags|=8),l.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=a,n.inputs=l,n.outputs=c}function m7(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function zT(t,n,e,r,o,i,s,a){let l=li(n,e),c=n.inputs,u;!a&&c!=null&&(u=c[r])?(GT(t,e,u,r,o),du(n)&&h7(e,n.index)):n.type&3?(r=m7(r),o=s!=null?s(o,n.value||"",r):o,i.setProperty(l,r,o)):n.type&12}function h7(t,n){let e=Mi(n,t);e[qe]&16||(e[qe]|=64)}function UT(t,n,e,r){if(lO()){let o=r===null?null:{"":-1},i=w7(t,e);if(i!==null){let[s,a]=cM(t,e,i);lM(t,n,e,s,o,a)}o&&I7(e,r,o)}e.mergedAttrs=pp(e.mergedAttrs,e.attrs)}function lM(t,n,e,r,o,i){for(let c=0;c<r.length;c++)BS(Bx(e,n),t,r[c].type);T7(e,t.data.length,r.length);for(let c=0;c<r.length;c++){let u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=iM(t,n,r.length,null);for(let c=0;c<r.length;c++){let u=r[c];e.mergedAttrs=pp(e.mergedAttrs,u.hostAttrs),E7(t,e,n,l,u),S7(l,u,o),u.contentQueries!==null&&(e.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(e.flags|=64);let d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),l++}f7(t,e,i)}function g7(t,n,e,r,o){let i=o.hostBindings;if(i){let s=t.hostBindingOpCodes;s===null&&(s=t.hostBindingOpCodes=[]);let a=~n.index;y7(s)!=a&&s.push(a),s.push(e,r,i)}}function y7(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function x7(t,n,e){let r=e.directiveStart,o=e.directiveEnd;du(e)&&D7(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||Bx(e,n);let i=e.initialInputs;for(let s=r;s<o;s++){let a=t.data[s],l=zx(n,t,s,e);if(fu(l,n),i!==null&&A7(n,s-r,l,a,e,i),ys(a)){let c=Mi(e.index,n);c[To]=zx(n,t,s,e)}}}function v7(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=GK();try{su(i);for(let a=r;a<o;a++){let l=t.data[a],c=n[a];$S(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&b7(l,c)}}finally{su(-1),$S(s)}}function b7(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function w7(t,n){let e=t.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];Y9(n,i.selectors,!1)&&(r??=[],ys(i)?r.unshift(i):r.push(i))}return r}function cM(t,n,e){let r=[],o=null;for(let i of e)i.findHostDirectiveDefs!==null&&(o??=new Map,i.findHostDirectiveDefs(i,r,o)),ys(i)&&(r.push(i),C7(t,n,r.length-1));return du(n)?r.push(...e.slice(1)):r.push(...e),[r,o]}function C7(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function I7(t,n,e){if(n){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new Ee(-301,!1);r.push(n[o],i)}}}function S7(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;ys(n)&&(e[""]=t)}}function T7(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function E7(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=tu(o.type,!0)),s=new au(i,ys(o),re);t.blueprint[r]=s,e[r]=s,g7(t,n,r,iM(t,e,o.hostVars,zr),o)}function _7(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function D7(t,n,e){let r=li(n,t),o=l7(e),i=t[gs].rendererFactory,s=jT(t,$T(t,o,null,_7(e),r,n,null,i.createRenderer(r,e),null,null,null));return t[n.index]=s}function N7(t,n,e,r,o,i){let s=li(t,n);k7(n[gn],s,i,t.value,e,r,o)}function k7(t,n,e,r,o,i,s){if(i==null)t.removeAttribute(n,o,e);else{let a=s==null?hs(i):s(i,r||"",o);t.setAttribute(n,o,a,e)}}function A7(t,n,e,r,o,i){let s=i[n];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],u=s[a++],d=s[a++];oM(r,e,l,c,u,d)}}function R7(t,n,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(t.hasOwnProperty(i)){r===null&&(r=[]);let s=t[i];for(let a=0;a<s.length;a+=3)if(s[a]===n){r.push(i,s[a+1],s[a+2],e[o+1]);break}}o+=2}return r}function uM(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function jT(t,n){return t[ah]?t[KA][ii]=n:t[ah]=n,t[KA]=n,n}function dM(t,n){let e=t[sh],r=e?e.get(xs,null):null;r&&r.handleError(n)}function GT(t,n,e,r,o){for(let i=0;i<e.length;){let s=e[i++],a=e[i++],l=e[i++],c=n[s],u=t.data[s];oM(u,c,r,a,l,o)}}function O7(t,n){let e=Mi(n,t),r=e[Ct];M7(r,e);let o=e[Is];o!==null&&e[Ax]===null&&(e[Ax]=qO(o,e[sh])),WT(r,e,e[To])}function M7(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function WT(t,n,e){ST(n);try{let r=t.viewQuery;r!==null&&HS(1,r,e);let o=t.template;o!==null&&sM(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[up]?.finishViewCreation(t),t.staticContentQueries&&KO(t,n),t.staticViewQueries&&HS(2,t.viewQuery,e);let i=t.components;i!==null&&F7(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[qe]&=-5,TT()}}function F7(t,n){for(let e=0;e<n.length;e++)O7(t,n[e])}var vs=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(vs||{}),P7;function HT(t,n){return P7(t,n)}function pM(t){return(t.flags&32)===32}function rp(t,n,e,r,o){if(r!=null){let i,s=!1;Ss(r)?i=r:cl(r)&&(s=!0,r=r[Is]);let a=Oi(r);t===0&&e!==null?o==null?tM(n,e,a):Hx(n,e,a,o||null,!0):t===1&&e!==null?Hx(n,e,a,o||null,!0):t===2?i7(n,a,s):t===3&&n.destroyNode(a),i!=null&&X7(n,t,i,e,o)}}function $7(t,n){fM(t,n),n[Is]=null,n[si]=null}function L7(t,n,e,r,o,i){r[Is]=o,r[si]=n,bv(t,r,e,1,o,i)}function fM(t,n){n[gs].changeDetectionScheduler?.notify(10),bv(t,n,n[gn],2,null,null)}function V7(t){let n=t[ah];if(!n)return bS(t[Ct],t);for(;n;){let e=null;if(cl(n))e=n[ah];else{let r=n[So];r&&(e=r)}if(!e){for(;n&&!n[ii]&&n!==t;)cl(n)&&bS(n[Ct],n),n=n[Sr];n===null&&(n=t),cl(n)&&bS(n[Ct],n),e=n&&n[ii]}n=e}}function B7(t,n,e,r){let o=So+r,i=e.length;r>0&&(e[o-1][ii]=n),r<i-So?(n[ii]=e[o],VR(e,So+r,n)):(e.push(n),n[ii]=null),n[Sr]=e;let s=n[cp];s!==null&&e!==s&&mM(s,n);let a=n[up];a!==null&&a.insertView(t),FS(n),n[qe]|=128}function mM(t,n){let e=t[Mx],r=n[Sr];if(cl(r))t[qe]|=2;else{let o=r[Sr][Ri];n[Ri]!==o&&(t[qe]|=2)}e===null?t[Mx]=[n]:e.push(n)}function qT(t,n){let e=t[Mx],r=e.indexOf(n);e.splice(r,1)}function qS(t,n){if(t.length<=So)return;let e=So+n,r=t[e];if(r){let o=r[cp];o!==null&&o!==t&&qT(o,r),n>0&&(t[e-1][ii]=r[ii]);let i=Nx(t,So+n);$7(r[Ct],r);let s=i[up];s!==null&&s.detachView(i[Ct]),r[Sr]=null,r[ii]=null,r[qe]&=-129}return r}function hM(t,n){if(mh(n))return;let e=n[gn];e.destroyNode&&bv(t,n,e,3,null,null),V7(n)}function bS(t,n){if(mh(n))return;let e=vt(null);try{n[qe]&=-129,n[qe]|=256,n[oo]&&Gd(n[oo]),U7(t,n),z7(t,n),n[Ct].type===1&&n[gn].destroy();let r=n[cp];if(r!==null&&Ss(n[Sr])){r!==n[Sr]&&qT(r,n);let o=n[up];o!==null&&o.detachView(t)}GS(n)}finally{vt(e)}}function z7(t,n){let e=t.cleanup,r=n[Rx];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(n[Rx]=null);let o=n[ll];if(o!==null){n[ll]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=n[ru];if(i!==null){n[ru]=null;for(let s of i)s.destroy()}}function U7(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof au)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];Io(4,a,l);try{l.call(a)}finally{Io(5,a,l)}}else{Io(4,o,i);try{i.call(o)}finally{Io(5,o,i)}}}}}function j7(t,n,e){return G7(t,n.parent,e)}function G7(t,n,e){let r=n;for(;r!==null&&r.type&168;)n=r,r=n.parent;if(r===null)return e[Is];if(du(r)){let{encapsulation:o}=t.data[r.directiveStart+r.componentOffset];if(o===Fi.None||o===Fi.Emulated)return null}return li(r,e)}function W7(t,n,e){return q7(t,n,e)}function H7(t,n,e){return t.type&40?li(t,e):null}var q7=H7,pR;function vv(t,n,e,r){let o=j7(t,r,n),i=n[gn],s=r.parent||n[si],a=W7(s,r,n);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)cR(i,o,e[l],a,!1);else cR(i,o,e,a,!1);pR!==void 0&&pR(i,r,n,e,o)}function nh(t,n){if(n!==null){let e=n.type;if(e&3)return li(n,t);if(e&4)return KS(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return nh(t,r);{let o=t[n.index];return Ss(o)?KS(-1,o):Oi(o)}}else{if(e&128)return nh(t,n.next);if(e&32)return HT(n,t)()||Oi(t[n.index]);{let r=gM(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=iu(t[Ri]);return nh(o,r)}else return nh(t,n.next)}}}return null}function gM(t,n){if(n!==null){let r=t[Ri][si],o=n.projection;return r.projection[o]}return null}function KS(t,n){let e=So+t+1;if(e<n.length){let r=n[e],o=r[Ct].firstChild;if(o!==null)return nh(r,o)}return n[ou]}function KT(t,n,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&n===0&&(a&&fu(Oi(a),r),e.flags|=2),!pM(e))if(l&8)KT(t,n,e.child,r,o,i,!1),rp(n,t,o,a,i);else if(l&32){let c=HT(e,r),u;for(;u=c();)rp(n,t,o,u,i);rp(n,t,o,a,i)}else l&16?K7(t,n,r,e,o,i):rp(n,t,o,a,i);e=s?e.projectionNext:e.next}}function bv(t,n,e,r,o,i){KT(e,r,t.firstChild,n,o,i,!1)}function K7(t,n,e,r,o,i){let s=e[Ri],l=s[si].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];rp(n,t,o,u,i)}else{let c=l,u=s[Sr];LO(r)&&(c.flags|=128),KT(t,n,c,u,o,i,!0)}}function X7(t,n,e,r,o){let i=e[ou],s=Oi(e);i!==s&&rp(n,t,r,i,o);for(let a=So;a<e.length;a++){let l=e[a];bv(l[Ct],l,t,n,r,i)}}function Y7(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:vs.DashCase;o==null?t.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=vs.Important),t.setStyle(e,r,o,i))}}function Z7(t,n,e,r){let o=vt(null);try{let i=n.tView,a=t[qe]&4096?4096:16,l=$T(t,i,e,a,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=t[n.index];l[cp]=c;let u=t[up];return u!==null&&(l[up]=u.createEmbeddedView(i)),WT(i,l,e),l}finally{vt(o)}}function fR(t,n){return!n||n.firstChild===null||LO(t)}function Q7(t,n,e,r=!0){let o=n[Ct];if(B7(o,n,t,e),r){let s=KS(e,t),a=n[gn],l=a.parentNode(t[ou]);l!==null&&L7(o,t[si],a,n,l,s)}let i=n[Ax];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function qx(t,n,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=n[e.index];i!==null&&r.push(Oi(i)),Ss(i)&&J7(i,r);let s=e.type;if(s&8)qx(t,n,e.child,r);else if(s&32){let a=HT(e,n),l;for(;l=a();)r.push(l)}else if(s&16){let a=gM(n,e);if(Array.isArray(a))r.push(...a);else{let l=iu(n[Ri]);qx(l[Ct],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function J7(t,n){for(let e=So;e<t.length;e++){let r=t[e],o=r[Ct].firstChild;o!==null&&qx(r[Ct],r,o,n)}t[ou]!==t[Is]&&n.push(t[ou])}var yM=[];function eX(t){return t[oo]??tX(t)}function tX(t){let n=yM.pop()??Object.create(rX);return n.lView=t,n}function nX(t){t.lView[oo]!==t&&(t.lView=null,yM.push(t))}var rX=ot(he({},qc),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{hh(t.lView)},consumerOnSignalRead(){this.lView[oo]=this}});function oX(t){let n=t[oo]??Object.create(iX);return n.lView=t,n}var iX=ot(he({},qc),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=iu(t.lView);for(;n&&!xM(n[Ct]);)n=iu(n);n&&wT(n)},consumerOnSignalRead(){this.lView[oo]=this}});function xM(t){return t.type!==2}function vM(t){if(t[ru]===null)return;let n=!0;for(;n;){let e=!1;for(let r of t[ru])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));n=e&&!!(t[qe]&8192)}}var sX=100;function bM(t,n=!0,e=0){let o=t[gs].rendererFactory,i=!1;i||o.begin?.();try{aX(t,e)}catch(s){throw n&&dM(t,s),s}finally{i||o.end?.()}}function aX(t,n){let e=dO();try{Px(!0),XS(t,n);let r=0;for(;lv(t);){if(r===sX)throw new Ee(103,!1);r++,XS(t,1)}}finally{Px(e)}}function lX(t,n,e,r){if(mh(n))return;let o=n[qe],i=!1,s=!1;ST(n);let a=!0,l=null,c=null;i||(xM(t)?(c=eX(n),l=jd(c)):oA()===null?(a=!1,c=oX(n),l=jd(c)):n[oo]&&(Gd(n[oo]),n[oo]=null));try{sO(n),zK(t.bindingStartIndex),e!==null&&sM(t,n,e,2,r);let u=(o&3)===3;if(!i)if(u){let f=t.preOrderCheckHooks;f!==null&&Ix(n,f,null)}else{let f=t.preOrderHooks;f!==null&&Sx(n,f,0,null),yS(n,0)}if(s||cX(n),vM(n),wM(n,0),t.contentQueries!==null&&KO(t,n),!i)if(u){let f=t.contentCheckHooks;f!==null&&Ix(n,f)}else{let f=t.contentHooks;f!==null&&Sx(n,f,1),yS(n,1)}dX(t,n);let d=t.components;d!==null&&IM(n,d,0);let p=t.viewQuery;if(p!==null&&HS(2,p,r),!i)if(u){let f=t.viewCheckHooks;f!==null&&Ix(n,f)}else{let f=t.viewHooks;f!==null&&Sx(n,f,2),yS(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[Cx]){for(let f of n[Cx])f();n[Cx]=null}i||(n[qe]&=-73)}catch(u){throw i||hh(n),u}finally{c!==null&&(Ym(c,l),a&&nX(c)),TT()}}function wM(t,n){for(let e=zO(t);e!==null;e=UO(e))for(let r=So;r<e.length;r++){let o=e[r];CM(o,n)}}function cX(t){for(let n=zO(t);n!==null;n=UO(n)){if(!(n[qe]&2))continue;let e=n[Mx];for(let r=0;r<e.length;r++){let o=e[r];wT(o)}}}function uX(t,n,e){let r=Mi(n,t);CM(r,e)}function CM(t,n){bT(t)&&XS(t,n)}function XS(t,n){let r=t[Ct],o=t[qe],i=t[oo],s=!!(n===0&&o&16);if(s||=!!(o&64&&n===0),s||=!!(o&1024),s||=!!(i?.dirty&&Zm(i)),s||=!1,i&&(i.dirty=!1),t[qe]&=-9217,s)lX(r,t,r.template,t[To]);else if(o&8192){vM(t),wM(t,1);let a=r.components;a!==null&&IM(t,a,1)}}function IM(t,n,e){for(let r=0;r<n.length;r++)uX(t,n[r],e)}function dX(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)su(~o);else{let i=o,s=e[++r],a=e[++r];jK(s,i);let l=n[i];Io(24,l),a(2,l),Io(25,l)}}}finally{su(-1)}}function XT(t,n){let e=dO()?64:1088;for(t[gs].changeDetectionScheduler?.notify(n);t;){t[qe]|=e;let r=iu(t);if(Fx(t)&&!r)return t;t=r}return null}var cu=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let n=this._lView,e=n[Ct];return qx(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[To]}get dirty(){return!!(this._lView[qe]&9280)||!!this._lView[oo]?.dirty}set context(n){this._lView[To]=n}get destroyed(){return mh(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Sr];if(Ss(n)){let e=n[Ox],r=e?e.indexOf(this):-1;r>-1&&(qS(n,r),Nx(e,r))}this._attachedToViewContainer=!1}hM(this._lView[Ct],this._lView)}onDestroy(n){aO(this._lView,n)}markForCheck(){XT(this._cdRefInjectingView||this._lView,4)}markForRefresh(){wT(this._cdRefInjectingView||this._lView)}detach(){this._lView[qe]&=-129}reattach(){FS(this._lView),this._lView[qe]|=128}detectChanges(){this._lView[qe]|=1024,bM(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ee(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=Fx(this._lView),e=this._lView[cp];e!==null&&!n&&qT(e,this._lView),fM(this._lView[Ct],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Ee(902,!1);this._appRef=n;let e=Fx(this._lView),r=this._lView[cp];r!==null&&!e&&mM(r,this._lView),FS(this._lView)}},wv=(()=>{class t{static __NG_ELEMENT_ID__=mX}return t})(),pX=wv,fX=class extends pX{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=Z7(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new cu(o)}};function mX(){return hX(Tr(),It())}function hX(t,n){return t.type&4?new fX(n,t,gv(t,n)):null}function gh(t,n,e,r,o){let i=t.data[n];if(i===null)i=gX(t,n,e,r,o),UK()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=BK();i.injectorIndex=s===null?-1:s.injectorIndex}return pu(i,!0),i}function gX(t,n,e,r,o){let i=cO(),s=CT(),a=s?i:i&&i.parent,l=t.data[n]=xX(t,a,e,n,r,o);return yX(t,l,i,s),l}function yX(t,n,e,r){t.firstChild===null&&(t.firstChild=n),e!==null&&(r?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function xX(t,n,e,r,o,i){let s=n?n.injectorIndex:-1,a=0;return $K()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var vTe=new RegExp(`^(\\d+)*(${A9}|${k9})*(.*)`);var vX=()=>null;function mR(t,n){return vX(t,n)}var YS=class{},Kx=class{},ZS=class{resolveComponentFactory(n){throw Error(`No component factory found for ${Ir(n)}.`)}},fp=class{static NULL=new ZS},mp=class{},ci=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>bX()}return t})();function bX(){let t=It(),n=Tr(),e=Mi(n.index,t);return(cl(e)?e:t)[gn]}var wX=(()=>{class t{static \u0275prov=ke({token:t,providedIn:"root",factory:()=>null})}return t})();function Xx(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let s=0;s<n.length;s++){let a=n[s];if(typeof a=="number")i=a;else if(i==1)o=_S(o,a);else if(i==2){let l=a,c=n[++s];r=_S(r,l+": "+c+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}var Yx=class extends fp{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=nu(n);return new ch(e,this.ngModule)}};function hR(t,n){let e=[];for(let r in t){if(!t.hasOwnProperty(r))continue;let o=t[r];if(o===void 0)continue;let i=Array.isArray(o),s=i?o[0]:o,a=i?o[1]:ul.None;n?e.push({propName:s,templateName:r,isSignal:(a&ul.SignalBased)!==0}):e.push({propName:s,templateName:r})}return e}function CX(t){let n=t.toLowerCase();return n==="svg"?EK:n==="math"?_K:null}var ch=class extends Kx{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let n=this.componentDef,e=n.inputTransforms,r=hR(n.inputs,!0);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return hR(this.componentDef.outputs,!1)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=e7(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,r,o){let i=vt(null);try{o=o||this.ngModule;let s=o instanceof Br?o:o?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new LS(n,s):n,l=a.get(mp,null);if(l===null)throw new Ee(407,!1);let c=a.get(wX,null),u=a.get(lu,null),d={rendererFactory:l,sanitizer:c,changeDetectionScheduler:u},p=l.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",m=r?u7(p,r,this.componentDef.encapsulation,a):eM(p,f,CX(f)),h=512;this.componentDef.signals?h|=4096:this.componentDef.onPush||(h|=16);let g=null;m!==null&&(g=qO(m,a,!0));let y=BT(0,null,null,1,0,null,null,null,null,null,null),x=$T(null,y,null,h,null,null,d,p,a,null,g);x[Eo]=m,ST(x);let w=null;try{let b=r?["ng-version","19.1.4"]:t7(this.componentDef.selectors[0]),S=gh(y,Eo,2,"#host",b),[E,D]=cM(y,S,[this.componentDef]);lM(y,x,S,E,{},D);for(let O of E)S.mergedAttrs=pp(S.mergedAttrs,O.hostAttrs);S.mergedAttrs=pp(S.mergedAttrs,b),Xx(S,S.mergedAttrs,!0),m&&(nM(p,m,S),fu(m,x)),e!==void 0&&IX(S,this.ngContentSelectors,e),aM(y,x,S),MT(y,S,x),mv(y,S),w=Mi(S.index,x),x[To]=w[To],WT(y,x,null)}catch(b){throw w!==null&&GS(w),GS(x),b}finally{TT()}return new QS(this.componentType,x)}finally{vt(i)}}},QS=class extends YS{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=iO(e[Ct],Eo),this.location=gv(this._tNode,e),this.instance=Mi(this._tNode.index,e)[To],this.hostView=this.changeDetectorRef=new cu(e,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let i=this._rootLView;GT(i[Ct],i,o,n,e),this.previousInputValues.set(n,e);let s=Mi(this._tNode.index,i);XT(s,1)}}get injector(){return new eu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function IX(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var bp=(()=>{class t{static __NG_ELEMENT_ID__=SX}return t})();function SX(){let t=Tr();return EX(t,It())}var TX=bp,SM=class extends TX{_lContainer;_hostTNode;_hostLView;constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return gv(this._hostTNode,this._hostLView)}get injector(){return new eu(this._hostTNode,this._hostLView)}get parentInjector(){let n=ET(this._hostTNode,this._hostLView);if(CO(n)){let e=Lx(n,this._hostLView),r=$x(n),o=e[Ct].data[r+8];return new eu(o,e)}else return new eu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=gR(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-So}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=mR(this._lContainer,n.ssrId),a=n.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,fR(this._hostTNode,s)),a}createComponent(n,e,r,o,i){let s=n&&!CK(n),a;if(s)a=e;else{let m=e||{};a=m.index,r=m.injector,o=m.projectableNodes,i=m.environmentInjector||m.ngModuleRef}let l=s?n:new ch(nu(n)),c=r||this.parentInjector;if(!i&&l.ngModule==null){let h=(s?c:this.parentInjector).get(Br,null);h&&(i=h)}let u=nu(l.componentType??{}),d=mR(this._lContainer,u?.id??null),p=d?.firstChild??null,f=l.create(c,o,p,i);return this.insertImpl(f.hostView,a,fR(this._hostTNode,d)),f}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(NK(o)){let a=this.indexOf(n);if(a!==-1)this.detach(a);else{let l=o[Sr],c=new SM(l,l[si],l[Sr]);c.detach(c.indexOf(n))}}let i=this._adjustIndex(e),s=this._lContainer;return Q7(s,o,i,r),n.attachToViewContainerRef(),VR(wS(s),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=gR(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=qS(this._lContainer,e);r&&(Nx(wS(this._lContainer),e),hM(r[Ct],r))}detach(n){let e=this._adjustIndex(n,-1),r=qS(this._lContainer,e);return r&&Nx(wS(this._lContainer),e)!=null?new cu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function gR(t){return t[Ox]}function wS(t){return t[Ox]||(t[Ox]=[])}function EX(t,n){let e,r=n[t.index];return Ss(r)?e=r:(e=uM(r,n,null,t),n[t.index]=e,jT(n,e)),DX(e,n,t,r),new SM(e,t,n)}function _X(t,n){let e=t[gn],r=e.createComment(""),o=li(n,t),i=e.parentNode(o);return Hx(e,i,r,e.nextSibling(o),!1),r}var DX=AX,NX=()=>!1;function kX(t,n,e){return NX(t,n,e)}function AX(t,n,e,r){if(t[ou])return;let o;e.type&8?o=Oi(r):o=_X(n,e),t[ou]=o}var dl=class{},uh=class{};var JS=class extends dl{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Yx(this);constructor(n,e,r,o=!0){super(),this.ngModuleType=n,this._parent=e;let i=UR(n);this._bootstrapComponents=QO(i.bootstrap),this._r3Injector=AO(n,e,[{provide:dl,useValue:this},{provide:fp,useValue:this.componentFactoryResolver},...r],Ir(n),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},eT=class extends uh{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new JS(this.moduleType,n,[])}};var Zx=class extends dl{injector;componentFactoryResolver=new Yx(this);instance=null;constructor(n){super();let e=new ih([...n.providers,{provide:dl,useValue:this},{provide:fp,useValue:this.componentFactoryResolver}],n.parent||xT(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function YT(t,n,e=null){return new Zx({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var RX=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=HR(!1,e.type),o=r.length>0?YT([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=ke({token:t,providedIn:"environment",factory:()=>new t($e(Br))})}return t})();function Mt(t){return ph(()=>{let n=EM(t),e=ot(he({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===VO.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?o=>o.get(RX).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Fi.Emulated,styles:t.styles||Vr,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&pl("NgStandalone"),_M(e);let r=t.dependencies;return e.directiveDefs=xR(r,!1),e.pipeDefs=xR(r,!0),e.id=FX(e),e})}function OX(t){return nu(t)||jR(t)}function MX(t){return t!==null}function _s(t){return ph(()=>({type:t.type,bootstrap:t.bootstrap||Vr,declarations:t.declarations||Vr,imports:t.imports||Vr,exports:t.exports||Vr,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function yR(t,n){if(t==null)return sp;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,s,a=ul.None;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i):(i=o,s=o),n?(e[i]=a!==ul.None?[r,a]:r,n[i]=s):e[i]=r}return e}function Nt(t){return ph(()=>{let n=EM(t);return _M(n),n})}function TM(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function EM(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||sp,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||Vr,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:yR(t.inputs,n),outputs:yR(t.outputs),debugInfo:null}}function _M(t){t.features?.forEach(n=>n(t))}function xR(t,n){if(!t)return null;let e=n?GR:OX;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(MX)}function FX(t){let n=0,e=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,e,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let i of r.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function PX(t){return Object.getPrototypeOf(t.prototype).constructor}function _n(t){let n=PX(t.type),e=!0,r=[t];for(;n;){let o;if(ys(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Ee(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);let s=t;s.inputs=vx(t.inputs),s.inputTransforms=vx(t.inputTransforms),s.declaredInputs=vx(t.declaredInputs),s.outputs=vx(t.outputs);let a=o.hostBindings;a&&zX(t,a);let l=o.viewQuery,c=o.contentQueries;if(l&&VX(t,l),c&&BX(t,c),$X(t,o),j6(t.outputs,o.outputs),ys(o)&&o.data.animation){let u=t.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(t),a===_n&&(e=!1)}}n=Object.getPrototypeOf(n)}LX(r)}function $X(t,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;let r=n.inputs[e];if(r!==void 0&&(t.inputs[e]=r,t.declaredInputs[e]=n.declaredInputs[e],n.inputTransforms!==null)){let o=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(o))continue;t.inputTransforms??={},t.inputTransforms[o]=n.inputTransforms[o]}}}function LX(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){let o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=pp(o.hostAttrs,e=pp(e,o.hostAttrs))}}function vx(t){return t===sp?{}:t===Vr?[]:t}function VX(t,n){let e=t.viewQuery;e?t.viewQuery=(r,o)=>{n(r,o),e(r,o)}:t.viewQuery=n}function BX(t,n){let e=t.contentQueries;e?t.contentQueries=(r,o,i)=>{n(r,o,i),e(r,o,i)}:t.contentQueries=n}function zX(t,n){let e=t.hostBindings;e?t.hostBindings=(r,o)=>{n(r,o),e(r,o)}:t.hostBindings=n}function ZT(t){let n=t.inputConfig,e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r];Array.isArray(o)&&o[3]&&(e[r]=o[3])}t.inputTransforms=e}function DM(t){return jX(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function UX(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{let e=t[Symbol.iterator](),r;for(;!(r=e.next()).done;)n(r.value)}}function jX(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function NM(t,n,e){return t[n]=e}function bs(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function QT(t,n,e,r){let o=bs(t,n,e);return bs(t,n+1,r)||o}function kM(t,n,e,r,o){let i=QT(t,n,e,r);return bs(t,n+2,o)||i}function GX(t,n,e,r,o,i,s,a,l){let c=n.consts,u=gh(n,t,4,s||null,a||null);UT(n,e,u,dp(c,l)),mv(n,u);let d=u.tView=BT(2,u,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return n.queries!==null&&(n.queries.template(n,u),d.queries=n.queries.embeddedTView(u)),u}function WX(t,n,e,r,o,i,s,a,l,c){let u=e+Eo,d=n.firstCreatePass?GX(u,n,t,r,o,i,s,a,l):n.data[u];pu(d,!1);let p=HX(n,t,d,e);pv()&&vv(n,t,p,d),fu(p,t);let f=uM(p,t,p,d);return t[u]=f,jT(t,f),kX(f,d,t),av(d)&&LT(n,t,d),l!=null&&VT(t,d,c),d}function ce(t,n,e,r,o,i,s,a){let l=It(),c=Hn(),u=dp(c.consts,i);return WX(l,c,t,n,e,r,o,u,s,a),ce}var HX=qX;function qX(t,n,e,r){return fv(!0),n[gn].createComment("")}var JT=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var AM=new Re("");function mu(t){return!!t&&typeof t.then=="function"}function RM(t){return!!t&&typeof t.subscribe=="function"}var OM=new Re("");var MM=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=ue(OM,{optional:!0})??[];injector=ue(Wn);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=rr(this.injector,o);if(mu(i))e.push(i);else if(RM(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),FM=(()=>{class t{static \u0275prov=ke({token:t,providedIn:"root",factory:()=>new Qx})}return t})(),Qx=class{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){let e=n.zone,r=this.queues.get(e);r.has(n)&&(r.delete(n),this.queuedEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(n)||(this.queuedEffectCount++,r.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,e]of this.queues)n===null?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(let e of n)n.delete(e),this.queuedEffectCount--,e.run()}},Cv=new Re("");function KX(){hA(()=>{throw new Ee(600,!1)})}function XX(t){return t.isBoundToModule}var YX=10;function ZX(t,n,e){try{let r=e();return mu(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var ws=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ue(b9);afterRenderManager=ue(O9);zonelessEnabled=ue(hv);rootEffectScheduler=ue(FM);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Pn;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=ue(Es).hasPendingTasks.pipe(tt(e=>!e));constructor(){ue(yv,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=ue(Br);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){let o=e instanceof Kx;if(!this._injector.get(MM).done){let p=!o&&WR(e),f=!1;throw new Ee(405,f)}let s;o?s=e:s=this._injector.get(fp).resolveComponentFactory(e),this.componentTypes.push(s.componentType);let a=XX(s)?void 0:this._injector.get(dl),l=r||s.selector,c=s.create(Wn.NULL,[],l,a),u=c.location.nativeElement,d=c.injector.get(AM,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),Tx(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(HO.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new Ee(101,!1);let e=vt(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,vt(e),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(mp,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let e=0;for(;this.dirtyFlags!==0&&e++<YX;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)QX(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>lv(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;Tx(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Cv,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Tx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ee(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Tx(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function QX(t,n,e,r){if(!e&&!lv(t))return;bM(t,n,e&&!r?0:1)}function wp(t,n,e,r){let o=It(),i=cv();if(bs(o,i,n)){let s=Hn(),a=dv();N7(a,o,t,n,e,r)}return wp}function PM(t,n,e,r){return bs(t,cv(),e)?n+hs(e)+r:zr}function JX(t,n,e,r,o,i){let s=pO(),a=QT(t,s,e,o);return uv(2),a?n+hs(e)+r+hs(o)+i:zr}function eY(t,n,e,r,o,i,s,a){let l=pO(),c=kM(t,l,e,o,s);return uv(3),c?n+hs(e)+r+hs(o)+i+hs(s)+a:zr}function bx(t,n){return t<<17|n<<2}function uu(t){return t>>17&32767}function tY(t){return(t&2)==2}function nY(t,n){return t&131071|n<<17}function tT(t){return t|2}function hp(t){return(t&131068)>>2}function CS(t,n){return t&-131069|n<<2}function rY(t){return(t&1)===1}function nT(t){return t|1}function oY(t,n,e,r,o,i){let s=i?n.classBindings:n.styleBindings,a=uu(s),l=hp(s);t[r]=e;let c=!1,u;if(Array.isArray(e)){let d=e;u=d[1],(u===null||fh(d,u)>0)&&(c=!0)}else u=e;if(o)if(l!==0){let p=uu(t[a+1]);t[r+1]=bx(p,a),p!==0&&(t[p+1]=CS(t[p+1],r)),t[a+1]=nY(t[a+1],r)}else t[r+1]=bx(a,0),a!==0&&(t[a+1]=CS(t[a+1],r)),a=r;else t[r+1]=bx(l,0),a===0?a=r:t[l+1]=CS(t[l+1],r),l=r;c&&(t[r+1]=tT(t[r+1])),vR(t,u,r,!0),vR(t,u,r,!1),iY(n,u,t,r,i),s=bx(a,l),i?n.classBindings=s:n.styleBindings=s}function iY(t,n,e,r,o){let i=o?t.residualClasses:t.residualStyles;i!=null&&typeof n=="string"&&fh(i,n)>=0&&(e[r+1]=nT(e[r+1]))}function vR(t,n,e,r){let o=t[e+1],i=n===null,s=r?uu(o):hp(o),a=!1;for(;s!==0&&(a===!1||i);){let l=t[s],c=t[s+1];sY(l,n)&&(a=!0,t[s+1]=r?nT(c):tT(c)),s=r?uu(c):hp(c)}a&&(t[e+1]=r?tT(o):nT(o))}function sY(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?fh(t,n)>=0:!1}var oi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function aY(t){return t.substring(oi.key,oi.keyEnd)}function lY(t){return cY(t),$M(t,LM(t,0,oi.textEnd))}function $M(t,n){let e=oi.textEnd;return e===n?-1:(n=oi.keyEnd=uY(t,oi.key=n,e),LM(t,n,e))}function cY(t){oi.key=0,oi.keyEnd=0,oi.value=0,oi.valueEnd=0,oi.textEnd=t.length}function LM(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function uY(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}function X(t,n,e){let r=It(),o=cv();if(bs(r,o,n)){let i=Hn(),s=dv();zT(i,s,r,t,n,r[gn],e,!1)}return X}function rT(t,n,e,r,o){let i=n.inputs,s=o?"class":"style";GT(t,e,i[s],s,r)}function Cp(t,n,e){return BM(t,n,e,!1),Cp}function Pi(t,n){return BM(t,n,null,!0),Pi}function VM(t){pY(xY,dY,t,!0)}function dY(t,n){for(let e=lY(n);e>=0;e=$M(n,e))gT(t,aY(n),!0)}function BM(t,n,e,r){let o=It(),i=Hn(),s=uv(2);if(i.firstUpdatePass&&UM(i,t,s,r),n!==zr&&bs(o,s,n)){let a=i.data[Ts()];jM(i,a,o,o[gn],t,o[s+1]=bY(n,e),r,s)}}function pY(t,n,e,r){let o=Hn(),i=uv(2);o.firstUpdatePass&&UM(o,null,i,r);let s=It();if(e!==zr&&bs(s,i,e)){let a=o.data[Ts()];if(GM(a,r)&&!zM(o,i)){let l=r?a.classesWithoutHost:a.stylesWithoutHost;l!==null&&(e=_S(l,e||"")),rT(o,a,s,e,r)}else vY(o,a,s,s[gn],s[i+1],s[i+1]=yY(t,n,e),r,i)}}function zM(t,n){return n>=t.expandoStartIndex}function UM(t,n,e,r){let o=t.data;if(o[e+1]===null){let i=o[Ts()],s=zM(t,e);GM(i,r)&&n===null&&!s&&(n=!1),n=fY(o,i,n,r),oY(o,i,n,e,s,r)}}function fY(t,n,e,r){let o=WK(t),i=r?n.residualClasses:n.residualStyles;if(o===null)(r?n.classBindings:n.styleBindings)===0&&(e=IS(null,t,n,e,r),e=dh(e,n.attrs,r),i=null);else{let s=n.directiveStylingLast;if(s===-1||t[s]!==o)if(e=IS(o,t,n,e,r),i===null){let l=mY(t,n,r);l!==void 0&&Array.isArray(l)&&(l=IS(null,t,n,l[1],r),l=dh(l,n.attrs,r),hY(t,n,r,l))}else i=gY(t,n,r)}return i!==void 0&&(r?n.residualClasses=i:n.residualStyles=i),e}function mY(t,n,e){let r=e?n.classBindings:n.styleBindings;if(hp(r)!==0)return t[uu(r)]}function hY(t,n,e,r){let o=e?n.classBindings:n.styleBindings;t[uu(o)]=r}function gY(t,n,e){let r,o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++){let s=t[i].hostAttrs;r=dh(r,s,e)}return dh(r,n.attrs,e)}function IS(t,n,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=n[a],r=dh(r,i.hostAttrs,o),i!==t);)a++;return t!==null&&(e.directiveStylingLast=a),r}function dh(t,n,e){let r=e?1:2,o=-1;if(n!==null)for(let i=0;i<n.length;i++){let s=n[i];typeof s=="number"?o=s:o===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),gT(t,s,e?!0:n[++i]))}return t===void 0?null:t}function yY(t,n,e){if(e==null||e==="")return Vr;let r=[],o=vp(e);if(Array.isArray(o))for(let i=0;i<o.length;i++)t(r,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&t(r,i,o[i]);else typeof o=="string"&&n(r,o);return r}function xY(t,n,e){let r=String(n);r!==""&&!r.includes(" ")&&gT(t,r,e)}function vY(t,n,e,r,o,i,s,a){o===zr&&(o=Vr);let l=0,c=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let p=l<o.length?o[l+1]:void 0,f=c<i.length?i[c+1]:void 0,m=null,h;u===d?(l+=2,c+=2,p!==f&&(m=d,h=f)):d===null||u!==null&&u<d?(l+=2,m=u):(c+=2,m=d,h=f),m!==null&&jM(t,n,e,r,m,h,s,a),u=l<o.length?o[l]:null,d=c<i.length?i[c]:null}}function jM(t,n,e,r,o,i,s,a){if(!(n.type&3))return;let l=t.data,c=l[a+1],u=rY(c)?bR(l,n,e,o,hp(c),s):void 0;if(!Jx(u)){Jx(i)||tY(c)&&(i=bR(l,null,e,o,a,s));let d=oO(Ts(),e);Y7(r,s,d,o,i)}}function bR(t,n,e,r,o,i){let s=n===null,a;for(;o>0;){let l=t[o],c=Array.isArray(l),u=c?l[1]:l,d=u===null,p=e[o+1];p===zr&&(p=d?Vr:void 0);let f=d?hS(p,r):u===r?p:void 0;if(c&&!Jx(f)&&(f=hS(l,r)),Jx(f)&&(a=f,s))return a;let m=t[o+1];o=s?uu(m):hp(m)}if(n!==null){let l=i?n.residualClasses:n.residualStyles;l!=null&&(a=hS(l,r))}return a}function Jx(t){return t!==void 0}function bY(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Ir(vp(t)))),t}function GM(t,n){return(t.flags&(n?8:16))!==0}function wY(t,n,e,r,o,i){let s=n.consts,a=dp(s,o),l=gh(n,t,2,r,a);return UT(n,e,l,dp(s,i)),l.attrs!==null&&Xx(l,l.attrs,!1),l.mergedAttrs!==null&&Xx(l,l.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,l),l}function I(t,n,e,r){let o=It(),i=Hn(),s=Eo+t,a=o[gn],l=i.firstCreatePass?wY(s,i,o,n,e,r):i.data[s],c=CY(i,o,l,a,n,t);o[s]=c;let u=av(l);return pu(l,!0),nM(a,c,l),!pM(l)&&pv()&&vv(i,o,c,l),MK()===0&&fu(c,o),FK(),u&&(LT(i,o,l),MT(i,l,o)),r!==null&&VT(o,l),I}function C(){let t=Tr();CT()?uO():(t=t.parent,pu(t,!1));let n=t;LK(n)&&VK(),PK();let e=Hn();return e.firstCreatePass&&(mv(e,t),vT(t)&&e.queries.elementEnd(t)),n.classesWithoutHost!=null&&QK(n)&&rT(e,n,It(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&JK(n)&&rT(e,n,It(),n.stylesWithoutHost,!1),C}function q(t,n,e,r){return I(t,n,e,r),C(),q}var CY=(t,n,e,r,o,i)=>(fv(!0),eM(r,o,KK()));function IY(t,n,e,r,o){let i=n.consts,s=dp(i,r),a=gh(n,t,8,"ng-container",s);s!==null&&Xx(a,s,!0);let l=dp(i,o);return UT(n,e,a,l),n.queries!==null&&n.queries.elementStart(n,a),a}function Iv(t,n,e){let r=It(),o=Hn(),i=t+Eo,s=o.firstCreatePass?IY(i,o,r,n,e):o.data[i];pu(s,!0);let a=SY(o,r,s,t);return r[i]=a,pv()&&vv(o,r,a,s),fu(a,r),av(s)&&(LT(o,r,s),MT(o,s,r)),e!=null&&VT(r,s),Iv}function Sv(){let t=Tr(),n=Hn();return CT()?uO():(t=t.parent,pu(t,!1)),n.firstCreatePass&&(mv(n,t),vT(t)&&n.queries.elementEnd(t)),Sv}var SY=(t,n,e,r)=>(fv(!0),o7(n[gn],""));function Ft(){return It()}var Qc=void 0;function TY(t){let n=t,e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return e===1&&r===0?1:5}var EY=["en",[["a","p"],["AM","PM"],Qc],[["AM","PM"],Qc,Qc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Qc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Qc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Qc,"{1} 'at' {0}",Qc],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",TY],SS={};function ko(t){let n=_Y(t),e=wR(n);if(e)return e;let r=n.split("-")[0];if(e=wR(r),e)return e;if(r==="en")return EY;throw new Ee(701,!1)}function wR(t){return t in SS||(SS[t]=Jc.ng&&Jc.ng.common&&Jc.ng.common.locales&&Jc.ng.common.locales[t]),SS[t]}var wn=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(wn||{});function _Y(t){return t.toLowerCase().replace(/_/g,"-")}var ev="en-US";var DY=ev;function NY(t){typeof t=="string"&&(DY=t.toLowerCase().replace(/_/g,"-"))}var kY=(t,n,e)=>{};function ye(t,n,e,r){let o=It(),i=Hn(),s=Tr();return WM(i,o,o[gn],s,t,n,r),ye}function AY(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=n[Rx],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function WM(t,n,e,r,o,i,s){let a=av(r),c=t.firstCreatePass&&OK(t),u=n[To],d=RK(n),p=!0;if(r.type&3||s){let h=li(r,n),g=s?s(h):h,y=d.length,x=s?b=>s(Oi(b[r.index])):r.index,w=null;if(!s&&a&&(w=AY(t,n,o,r.index)),w!==null){let b=w.__ngLastListenerFn__||w;b.__ngNextListenerFn__=i,w.__ngLastListenerFn__=i,p=!1}else{i=IR(r,n,u,i),kY(h,o,i);let b=e.listen(g,o,i);d.push(i,b),c&&c.push(o,x,y,y+1)}}else i=IR(r,n,u,i);let f=r.outputs,m;if(p&&f!==null&&(m=f[o])){let h=m.length;if(h)for(let g=0;g<h;g+=2){let y=m[g],x=m[g+1],S=n[y][x].subscribe(i),E=d.length;d.push(i,S),c&&c.push(o,r.index,E,-(E+1))}}}function CR(t,n,e,r){let o=vt(null);try{return Io(6,n,e),e(r)!==!1}catch(i){return dM(t,i),!1}finally{Io(7,n,e),vt(o)}}function IR(t,n,e,r){return function o(i){if(i===Function)return r;let s=du(t)?Mi(t.index,n):n;XT(s,5);let a=CR(n,e,r,i),l=o.__ngNextListenerFn__;for(;l;)a=CR(n,e,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function fe(t=1){return qK(t)}function eE(t,n,e){return HM(t,"",n,"",e),eE}function HM(t,n,e,r,o){let i=It(),s=PM(i,n,e,r);if(s!==zr){let a=Hn(),l=dv();zT(a,l,i,t,s,i[gn],o,!1)}return HM}function RY(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}function T(t,n=""){let e=It(),r=Hn(),o=t+Eo,i=r.firstCreatePass?gh(r,o,1,n,null):r.data[o],s=OY(r,e,i,n,t);e[o]=s,pv()&&vv(r,e,s,i),pu(i,!1)}var OY=(t,n,e,r,o)=>(fv(!0),n7(n[gn],r));function dn(t){return Ke("",t,""),dn}function Ke(t,n,e){let r=It(),o=PM(r,t,n,e);return o!==zr&&tE(r,Ts(),o),Ke}function yh(t,n,e,r,o){let i=It(),s=JX(i,t,n,e,r,o);return s!==zr&&tE(i,Ts(),s),yh}function xh(t,n,e,r,o,i,s){let a=It(),l=eY(a,t,n,e,r,o,i,s);return l!==zr&&tE(a,Ts(),l),xh}function tE(t,n,e){let r=oO(n,t);r7(t[gn],r,e)}function Ds(t,n,e){$O(n)&&(n=n());let r=It(),o=cv();if(bs(r,o,n)){let i=Hn(),s=dv();zT(i,s,r,t,n,r[gn],e,!1)}return Ds}function fl(t,n){let e=$O(t);return e&&t.set(n),e}function Ns(t,n){let e=It(),r=Hn(),o=Tr();return WM(r,e,e[gn],o,t,n),Ns}function MY(t,n,e){let r=Hn();if(r.firstCreatePass){let o=ys(t);oT(e,r.data,r.blueprint,o,!0),oT(n,r.data,r.blueprint,o,!1)}}function oT(t,n,e,r,o){if(t=Cr(t),Array.isArray(t))for(let i=0;i<t.length;i++)oT(t[i],n,e,r,o);else{let i=Hn(),s=It(),a=Tr(),l=lp(t)?t:Cr(t.provide),c=XR(t),u=a.providerIndexes&1048575,d=a.directiveStart,p=a.providerIndexes>>20;if(lp(t)||!t.multi){let f=new au(c,o,re),m=ES(l,n,o?u:u+p,d);m===-1?(BS(Bx(a,s),i,l),TS(i,t,n.length),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(f),s.push(f)):(e[m]=f,s[m]=f)}else{let f=ES(l,n,u+p,d),m=ES(l,n,u,u+p),h=f>=0&&e[f],g=m>=0&&e[m];if(o&&!g||!o&&!h){BS(Bx(a,s),i,l);let y=$Y(o?PY:FY,e.length,o,r,c);!o&&g&&(e[m].providerFactory=y),TS(i,t,n.length,0),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(y),s.push(y)}else{let y=qM(e[o?m:f],c,!o&&r);TS(i,t,f>-1?f:m,y)}!o&&r&&g&&e[m].componentProviders++}}}function TS(t,n,e,r){let o=lp(n),i=hK(n);if(o||i){let l=(i?Cr(n.useClass):n).prototype.ngOnDestroy;if(l){let c=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){let u=c.indexOf(e);u===-1?c.push(e,[r,l]):c[u+1].push(r,l)}else c.push(e,l)}}}function qM(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function ES(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function FY(t,n,e,r){return iT(this.multi,[])}function PY(t,n,e,r){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=zx(e,e[Ct],this.providerFactory.index,r);i=a.slice(0,s),iT(o,i);for(let l=s;l<a.length;l++)i.push(a[l])}else i=[],iT(o,i);return i}function iT(t,n){for(let e=0;e<t.length;e++){let r=t[e];n.push(r())}return n}function $Y(t,n,e,r,o){let i=new au(t,e,re);return i.multi=[],i.index=n,i.componentProviders=0,qM(i,o,r&&!e),i}function Er(t,n=[]){return e=>{e.providersResolver=(r,o)=>MY(r,o?o(t):t,n)}}function Ip(t,n,e,r,o){return XM(It(),IT(),t,n,e,r,o)}function hu(t,n,e,r,o,i){return LY(It(),IT(),t,n,e,r,o,i)}function KM(t,n){let e=t[n];return e===zr?void 0:e}function XM(t,n,e,r,o,i,s){let a=n+e;return QT(t,a,o,i)?NM(t,a+2,s?r.call(s,o,i):r(o,i)):KM(t,a+2)}function LY(t,n,e,r,o,i,s,a){let l=n+e;return kM(t,l,o,i,s)?NM(t,l+3,a?r.call(a,o,i,s):r(o,i,s)):KM(t,l+3)}function gu(t,n){let e=Hn(),r,o=t+Eo;e.firstCreatePass?(r=VY(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks??=[]).push(o,r.onDestroy)):r=e.data[o];let i=r.factory||(r.factory=tu(r.type,!0)),s,a=Lr(re);try{let l=Vx(!1),c=i();return Vx(l),RY(e,It(),o,c),c}finally{Lr(a)}}function VY(t,n){if(n)for(let e=n.length-1;e>=0;e--){let r=n[e];if(t===r.name)return r}}function yu(t,n,e,r){let o=t+Eo,i=It(),s=DK(i,o);return BY(i,o)?XM(i,IT(),n,s.transform,e,r,s):s.transform(e,r)}function BY(t,n){return t[Ct].data[n].pure}var sT=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},nE=(()=>{class t{compileModuleSync(e){return new eT(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=UR(e),i=QO(o.declarations).reduce((s,a)=>{let l=nu(a);return l&&s.push(new ch(l)),s},[]);return new sT(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var zY=(()=>{class t{zone=ue(En);changeDetectionScheduler=ue(lu);applicationRef=ue(ws);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function UY({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new En(ot(he({},jY()),{scheduleInRootZone:e})),[{provide:En,useFactory:t},{provide:ap,multi:!0,useFactory:()=>{let r=ue(zY,{optional:!0});return()=>r.initialize()}},{provide:ap,multi:!0,useFactory:()=>{let r=ue(GY);return()=>{r.initialize()}}},n===!0?{provide:OO,useValue:!0}:[],{provide:DT,useValue:e??RO}]}function jY(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var GY=(()=>{class t{subscription=new Sn;initialized=!1;zone=ue(En);pendingTasks=ue(Es);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{En.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{En.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var YM=(()=>{class t{appRef=ue(ws);taskService=ue(Es);ngZone=ue(En);zonelessEnabled=ue(hv);tracing=ue(yv,{optional:!0});disableScheduling=ue(OO,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new Sn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(jx):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ue(DT,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Gx||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?tR:MO;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(jx+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,tR(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function ZM(){return pl("NgZoneless"),gp([{provide:lu,useExisting:YM},{provide:En,useClass:Gx},{provide:hv,useValue:!0},{provide:DT,useValue:!1},[]])}function WY(){return typeof $localize<"u"&&$localize.locale||ev}var Tv=new Re("",{providedIn:"root",factory:()=>ue(Tv,st.Optional|st.SkipSelf)||WY()});var aT=new Re(""),HY=new Re("");function eh(t){return!t.moduleRef}function qY(t){let n=eh(t)?t.r3Injector:t.moduleRef.injector,e=n.get(En);return e.run(()=>{eh(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=n.get(xs,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),eh(t)){let i=()=>n.destroy(),s=t.platformInjector.get(aT);s.add(i),n.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>t.moduleRef.destroy(),s=t.platformInjector.get(aT);s.add(i),t.moduleRef.onDestroy(()=>{Tx(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(i)})}return ZX(r,e,()=>{let i=n.get(MM);return i.runInitializers(),i.donePromise.then(()=>{let s=n.get(Tv,ev);if(NY(s||ev),!n.get(HY,!0))return eh(t)?n.get(ws):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(eh(t)){let l=n.get(ws);return t.rootComponent!==void 0&&l.bootstrap(t.rootComponent),l}else return KY(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function KY(t,n){let e=t.injector.get(ws);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(e);else throw new Ee(-403,!1);n.push(t)}var Ex=null;function XY(t=[],n){return Wn.create({name:n,providers:[{provide:iv,useValue:"platform"},{provide:aT,useValue:new Set([()=>Ex=null])},...t]})}function YY(t=[]){if(Ex)return Ex;let n=XY(t);return Ex=n,KX(),ZY(n),n}function ZY(t){let n=t.get(RT,null);rr(t,()=>{n?.forEach(e=>e())})}var zt=(()=>{class t{static __NG_ELEMENT_ID__=QY}return t})();function QY(t){return JY(Tr(),It(),(t&16)===16)}function JY(t,n,e){if(du(t)&&!e){let r=Mi(t.index,n);return new cu(r,r)}else if(t.type&175){let r=n[Ri];return new cu(r,n)}return null}var lT=class{constructor(){}supports(n){return DM(n)}create(n){return new cT(n)}},eZ=(t,n)=>n,cT=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||eZ}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<SR(r,o,i)?e:r,a=SR(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let c=a-o,u=l-o;if(c!=u){for(let p=0;p<c;p++){let f=p<i.length?i[p]:i[p]=0,m=f+p;u<=m&&m<c&&(i[p]=f+1)}let d=s.previousIndex;i[d]=u-c}}a!==l&&n(s,a,l)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!DM(n))throw new Ee(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)i=n[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,UX(n,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):(n=this._linkedRecords===null?null:this._linkedRecords.get(r,o),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new uT(e,r),i,o)),n}_verifyReinsertion(n,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let o=n._prevRemoved,i=n._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){let o=e===null?this._itHead:e._next;return n._next=o,n._prev=e,o===null?this._itTail=n:o._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new tv),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,r=n._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new tv),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},uT=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},dT=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){let e=n._prevDup,r=n._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},tv=class{map=new Map;put(n){let e=n.trackById,r=this.map.get(e);r||(r=new dT,this.map.set(e,r)),r.add(n)}get(n,e){let r=n,o=this.map.get(r);return o?o.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function SR(t,n,e){let r=t.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}function TR(){return new rE([new lT])}var rE=(()=>{class t{factories;static \u0275prov=ke({token:t,providedIn:"root",factory:TR});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||TR()),deps:[[t,new lK,new LR]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new Ee(901,!1)}}return t})();function QM(t){try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=YY(r),i=[UY({}),{provide:lu,useExisting:YM},...e||[]],s=new Zx({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return qY({r3Injector:s.injector,platformInjector:o,rootComponent:n})}catch(n){return Promise.reject(n)}}function xu(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function ml(t,n){pl("NgSignals");let e=pA(t);return n?.equal&&(e[Fr].equal=n.equal),e}function $i(t){let n=vt(null);try{return t()}finally{vt(n)}}var JM=(()=>{class t{view;node;constructor(e,r){this.view=e,this.node=r}static __NG_ELEMENT_ID__=tZ}return t})();function tZ(){return new JM(It(),Tr())}var nZ=!1,rZ=(()=>{class t extends Qx{pendingTasks=ue(Es);taskId=null;schedule(e){super.schedule(e),this.taskId===null&&(this.taskId=this.pendingTasks.add(),queueMicrotask(()=>this.flush()))}flush(){try{super.flush()}finally{this.taskId!==null&&(this.pendingTasks.remove(this.taskId),this.taskId=null)}}static \u0275prov=ke({token:t,providedIn:"root",factory:()=>new t})}return t})(),pT=class{scheduler;effectFn;zone;injector;unregisterOnDestroy;watcher;constructor(n,e,r,o,i,s){this.scheduler=n,this.effectFn=e,this.zone=r,this.injector=i,this.watcher=xA(a=>this.runEffect(a),()=>this.schedule(),s),this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}runEffect(n){try{this.effectFn(n)}catch(e){this.injector.get(xs,null,{optional:!0})?.handleError(e)}}run(){this.watcher.run()}schedule(){this.scheduler.schedule(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function oZ(){}function iZ(t,n){pl("NgSignals"),!n?.injector&&ZR(oZ);let e=n?.injector??ue(Wn),r=n?.manualCleanup!==!0?e.get(xp):null,o=new pT(e.get(rZ),t,typeof Zone>"u"?null:Zone.current,r,e,n?.allowSignalWrites??!1),i=e.get(zt,null,{optional:!0});return!i||!(i._lView[qe]&8)?o.watcher.notify():(i._lView[Cx]??=[]).push(o.watcher.notify),o}var sZ=nZ;var fT=class{[Fr];constructor(n){this[Fr]=n}destroy(){this[Fr].destroy()}};function vh(t,n){if(sZ)return iZ(t,n);pl("NgSignals"),!n?.injector&&ZR(vh);let e=n?.injector??ue(Wn),r=n?.manualCleanup!==!0?e.get(xp):null,o,i=e.get(JM,null,{optional:!0}),s=e.get(lu);return i!==null&&!n?.forceRoot?(o=cZ(i.view,s,t),r instanceof Ux&&r._lView===i.view&&(r=null)):o=uZ(t,e.get(FM),s),o.injector=e,r!==null&&(o.onDestroyFn=r.onDestroy(()=>o.destroy())),new fT(o)}var e2=ot(he({},qc),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:lh,run(){if(this.dirty=!1,this.hasRun&&!Zm(this))return;this.hasRun=!0;let t=r=>(this.cleanupFns??=[]).push(r),n=jd(this),e=Px(!1);try{this.maybeCleanup(),this.fn(t)}finally{Px(e),Ym(this,n)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),aZ=ot(he({},e2),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(13)},destroy(){Gd(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),lZ=ot(he({},e2),{consumerMarkedDirty(){this.view[qe]|=8192,hh(this.view),this.notifier.notify(14)},destroy(){Gd(this),this.onDestroyFn(),this.maybeCleanup(),this.view[ru]?.delete(this)}});function cZ(t,n,e){let r=Object.create(lZ);return r.view=t,r.zone=typeof Zone<"u"?Zone.current:null,r.notifier=n,r.fn=e,t[ru]??=new Set,t[ru].add(r),r.consumerMarkedDirty(r),r}function uZ(t,n,e){let r=Object.create(aZ);return r.fn=t,r.scheduler=n,r.notifier=e,r.zone=typeof Zone<"u"?Zone.current:null,r.scheduler.schedule(r),r.notifier.notify(13),r}var a2=null;function As(){return a2}function l2(t){a2??=t}var Mv=class{};var Ur=new Re(""),c2=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>ue(dZ),providedIn:"platform"})}return t})();var dZ=(()=>{class t extends c2{_location;_history;_doc=ue(Ur);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return As().getBaseHref(this._doc)}onPopState(e){let r=As().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=As().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function u2(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function t2(t){let n=t.match(/#|\?|$/),e=n&&n.index||t.length,r=e-(t[e-1]==="/"?1:0);return t.slice(0,r)+t.slice(e)}function vu(t){return t&&t[0]!=="?"?"?"+t:t}var Tp=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>ue(d2),providedIn:"root"})}return t})(),pZ=new Re(""),d2=(()=>{class t extends Tp{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ue(Ur).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return u2(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+vu(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+vu(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+vu(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||t)($e(c2),$e(pZ,8))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var bh=(()=>{class t{_subject=new Pn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=hZ(t2(n2(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+vu(r))}normalize(e){return t.stripTrailingSlash(mZ(this._basePath,n2(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+vu(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+vu(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=vu;static joinWithSlash=u2;static stripTrailingSlash=t2;static \u0275fac=function(r){return new(r||t)($e(Tp))};static \u0275prov=ke({token:t,factory:()=>fZ(),providedIn:"root"})}return t})();function fZ(){return new bh($e(Tp))}function mZ(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function n2(t){return t.replace(/\/index.html$/,"")}function hZ(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}var _r=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(_r||{}),Xt=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Xt||{}),so=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(so||{}),hl={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function gZ(t){return ko(t)[wn.LocaleId]}function yZ(t,n,e){let r=ko(t),o=[r[wn.DayPeriodsFormat],r[wn.DayPeriodsStandalone]],i=Ao(o,n);return Ao(i,e)}function xZ(t,n,e){let r=ko(t),o=[r[wn.DaysFormat],r[wn.DaysStandalone]],i=Ao(o,n);return Ao(i,e)}function vZ(t,n,e){let r=ko(t),o=[r[wn.MonthsFormat],r[wn.MonthsStandalone]],i=Ao(o,n);return Ao(i,e)}function bZ(t,n){let r=ko(t)[wn.Eras];return Ao(r,n)}function Ev(t,n){let e=ko(t);return Ao(e[wn.DateFormat],n)}function _v(t,n){let e=ko(t);return Ao(e[wn.TimeFormat],n)}function Dv(t,n){let r=ko(t)[wn.DateTimeFormat];return Ao(r,n)}function Pv(t,n){let e=ko(t),r=e[wn.NumberSymbols][n];if(typeof r>"u"){if(n===hl.CurrencyDecimal)return e[wn.NumberSymbols][hl.Decimal];if(n===hl.CurrencyGroup)return e[wn.NumberSymbols][hl.Group]}return r}function p2(t){if(!t[wn.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[wn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function wZ(t){let n=ko(t);return p2(n),(n[wn.ExtraData][2]||[]).map(r=>typeof r=="string"?oE(r):[oE(r[0]),oE(r[1])])}function CZ(t,n,e){let r=ko(t);p2(r);let o=[r[wn.ExtraData][0],r[wn.ExtraData][1]],i=Ao(o,n)||[];return Ao(i,e)||[]}function Ao(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function oE(t){let[n,e]=t.split(":");return{hours:+n,minutes:+e}}var IZ=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Nv={},SZ=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function TZ(t,n,e,r){let o=MZ(t);n=ks(e,n)||n;let s=[],a;for(;n;)if(a=SZ.exec(n),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;n=u}else{s.push(n);break}let l=o.getTimezoneOffset();r&&(l=m2(r,l),o=OZ(o,r,!0));let c="";return s.forEach(u=>{let d=AZ(u);c+=d?d(o,e,l):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function Fv(t,n,e){let r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function ks(t,n){let e=gZ(t);if(Nv[e]??={},Nv[e][n])return Nv[e][n];let r="";switch(n){case"shortDate":r=Ev(t,so.Short);break;case"mediumDate":r=Ev(t,so.Medium);break;case"longDate":r=Ev(t,so.Long);break;case"fullDate":r=Ev(t,so.Full);break;case"shortTime":r=_v(t,so.Short);break;case"mediumTime":r=_v(t,so.Medium);break;case"longTime":r=_v(t,so.Long);break;case"fullTime":r=_v(t,so.Full);break;case"short":let o=ks(t,"shortTime"),i=ks(t,"shortDate");r=kv(Dv(t,so.Short),[o,i]);break;case"medium":let s=ks(t,"mediumTime"),a=ks(t,"mediumDate");r=kv(Dv(t,so.Medium),[s,a]);break;case"long":let l=ks(t,"longTime"),c=ks(t,"longDate");r=kv(Dv(t,so.Long),[l,c]);break;case"full":let u=ks(t,"fullTime"),d=ks(t,"fullDate");r=kv(Dv(t,so.Full),[u,d]);break}return r&&(Nv[e][n]=r),r}function kv(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return n!=null&&r in n?n[r]:e})),t}function ui(t,n,e="-",r,o){let i="";(t<0||o&&t<=0)&&(o?t=-t+1:(t=-t,i=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),i+s}function EZ(t,n){return ui(t,3).substring(0,n)}function Dn(t,n,e=0,r=!1,o=!1){return function(i,s){let a=_Z(t,i);if((e>0||a>-e)&&(a+=e),t===3)a===0&&e===-12&&(a=12);else if(t===6)return EZ(a,n);let l=Pv(s,hl.MinusSign);return ui(a,n,l,r,o)}}function _Z(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}function tn(t,n,e=_r.Format,r=!1){return function(o,i){return DZ(o,i,t,n,e,r)}}function DZ(t,n,e,r,o,i){switch(e){case 2:return vZ(n,o,r)[t.getMonth()];case 1:return xZ(n,o,r)[t.getDay()];case 0:let s=t.getHours(),a=t.getMinutes();if(i){let c=wZ(n),u=CZ(n,o,r),d=c.findIndex(p=>{if(Array.isArray(p)){let[f,m]=p,h=s>=f.hours&&a>=f.minutes,g=s<m.hours||s===m.hours&&a<m.minutes;if(f.hours<m.hours){if(h&&g)return!0}else if(h||g)return!0}else if(p.hours===s&&p.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return yZ(n,o,r)[s<12?0:1];case 3:return bZ(n,r)[t.getFullYear()<=0?0:1];default:let l=e;throw new Error(`unexpected translation type ${l}`)}}function Av(t){return function(n,e,r){let o=-1*r,i=Pv(e,hl.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case 0:return(o>=0?"+":"")+ui(s,2,i)+ui(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+ui(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+ui(s,2,i)+":"+ui(Math.abs(o%60),2,i);case 3:return r===0?"Z":(o>=0?"+":"")+ui(s,2,i)+":"+ui(Math.abs(o%60),2,i);default:throw new Error(`Unknown zone width "${t}"`)}}}var NZ=0,Ov=4;function kZ(t){let n=Fv(t,NZ,1).getDay();return Fv(t,0,1+(n<=Ov?Ov:Ov+7)-n)}function f2(t){let n=t.getDay(),e=n===0?-3:Ov-n;return Fv(t.getFullYear(),t.getMonth(),t.getDate()+e)}function iE(t,n=!1){return function(e,r){let o;if(n){let i=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+i)/7)}else{let i=f2(e),s=kZ(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return ui(o,t,Pv(r,hl.MinusSign))}}function Rv(t,n=!1){return function(e,r){let i=f2(e).getFullYear();return ui(i,t,Pv(r,hl.MinusSign),n)}}var sE={};function AZ(t){if(sE[t])return sE[t];let n;switch(t){case"G":case"GG":case"GGG":n=tn(3,Xt.Abbreviated);break;case"GGGG":n=tn(3,Xt.Wide);break;case"GGGGG":n=tn(3,Xt.Narrow);break;case"y":n=Dn(0,1,0,!1,!0);break;case"yy":n=Dn(0,2,0,!0,!0);break;case"yyy":n=Dn(0,3,0,!1,!0);break;case"yyyy":n=Dn(0,4,0,!1,!0);break;case"Y":n=Rv(1);break;case"YY":n=Rv(2,!0);break;case"YYY":n=Rv(3);break;case"YYYY":n=Rv(4);break;case"M":case"L":n=Dn(1,1,1);break;case"MM":case"LL":n=Dn(1,2,1);break;case"MMM":n=tn(2,Xt.Abbreviated);break;case"MMMM":n=tn(2,Xt.Wide);break;case"MMMMM":n=tn(2,Xt.Narrow);break;case"LLL":n=tn(2,Xt.Abbreviated,_r.Standalone);break;case"LLLL":n=tn(2,Xt.Wide,_r.Standalone);break;case"LLLLL":n=tn(2,Xt.Narrow,_r.Standalone);break;case"w":n=iE(1);break;case"ww":n=iE(2);break;case"W":n=iE(1,!0);break;case"d":n=Dn(2,1);break;case"dd":n=Dn(2,2);break;case"c":case"cc":n=Dn(7,1);break;case"ccc":n=tn(1,Xt.Abbreviated,_r.Standalone);break;case"cccc":n=tn(1,Xt.Wide,_r.Standalone);break;case"ccccc":n=tn(1,Xt.Narrow,_r.Standalone);break;case"cccccc":n=tn(1,Xt.Short,_r.Standalone);break;case"E":case"EE":case"EEE":n=tn(1,Xt.Abbreviated);break;case"EEEE":n=tn(1,Xt.Wide);break;case"EEEEE":n=tn(1,Xt.Narrow);break;case"EEEEEE":n=tn(1,Xt.Short);break;case"a":case"aa":case"aaa":n=tn(0,Xt.Abbreviated);break;case"aaaa":n=tn(0,Xt.Wide);break;case"aaaaa":n=tn(0,Xt.Narrow);break;case"b":case"bb":case"bbb":n=tn(0,Xt.Abbreviated,_r.Standalone,!0);break;case"bbbb":n=tn(0,Xt.Wide,_r.Standalone,!0);break;case"bbbbb":n=tn(0,Xt.Narrow,_r.Standalone,!0);break;case"B":case"BB":case"BBB":n=tn(0,Xt.Abbreviated,_r.Format,!0);break;case"BBBB":n=tn(0,Xt.Wide,_r.Format,!0);break;case"BBBBB":n=tn(0,Xt.Narrow,_r.Format,!0);break;case"h":n=Dn(3,1,-12);break;case"hh":n=Dn(3,2,-12);break;case"H":n=Dn(3,1);break;case"HH":n=Dn(3,2);break;case"m":n=Dn(4,1);break;case"mm":n=Dn(4,2);break;case"s":n=Dn(5,1);break;case"ss":n=Dn(5,2);break;case"S":n=Dn(6,1);break;case"SS":n=Dn(6,2);break;case"SSS":n=Dn(6,3);break;case"Z":case"ZZ":case"ZZZ":n=Av(0);break;case"ZZZZZ":n=Av(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=Av(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=Av(2);break;default:return null}return sE[t]=n,n}function m2(t,n){t=t.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function RZ(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function OZ(t,n,e){let r=e?-1:1,o=t.getTimezoneOffset(),i=m2(n,o);return RZ(t,r*(i-o))}function MZ(t){if(r2(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[o,i=1,s=1]=t.split("-").map(a=>+a);return Fv(o,i-1,s)}let e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(IZ))return FZ(r)}let n=new Date(t);if(!r2(n))throw new Error(`Unable to convert "${t}" into a date`);return n}function FZ(t){let n=new Date(0),e=0,r=0,o=t[8]?n.setUTCFullYear:n.setFullYear,i=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),o.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,l=Number(t[6]||0),c=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return i.call(n,s,a,l,c),n}function r2(t){return t instanceof Date&&!isNaN(t.valueOf())}function $v(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var aE=/\s+/,o2=[],Li=(()=>{class t{_ngEl;_renderer;initialClasses=o2;rawClass;stateMap=new Map;constructor(e,r){this._ngEl=e,this._renderer=r}set klass(e){this.initialClasses=e!=null?e.trim().split(aE):o2}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(aE):e}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let r of e)this._updateState(r,!0);else if(e!=null)for(let r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){let o=this.stateMap.get(e);o!==void 0?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){e=e.trim(),e.length>0&&e.split(aE).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(r){return new(r||t)(re(Do),re(ci))};static \u0275dir=Nt({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var lE=class{$implicit;ngForOf;index;count;constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},jr=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new lE(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),i2(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);i2(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(re(bp),re(wv),re(rE))};static \u0275dir=Nt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function i2(t,n){t.context.$implicit=n.item}var xn=(()=>{class t{_viewContainer;_context=new cE;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){s2("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){s2("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(re(bp),re(wv))};static \u0275dir=Nt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),cE=class{$implicit=null;ngIf=null};function s2(t,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${Ir(n)}'.`)}function PZ(t,n){return new Ee(2100,!1)}var $Z="mediumDate",LZ=new Re(""),VZ=new Re(""),Ep=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,r,o){this.locale=e,this.defaultTimezone=r,this.defaultOptions=o}transform(e,r,o,i){if(e==null||e===""||e!==e)return null;try{let s=r??this.defaultOptions?.dateFormat??$Z,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return TZ(e,s,i||this.locale,a)}catch(s){throw PZ(t,s.message)}}static \u0275fac=function(r){return new(r||t)(re(Tv,16),re(LZ,24),re(VZ,24))};static \u0275pipe=TM({name:"date",type:t,pure:!0})}return t})();var rn=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_s({type:t});static \u0275inj=Cs({})}return t})(),dE="browser",BZ="server";function Gr(t){return t===dE}function pE(t){return t===BZ}var Sp=class{};var Ih=class{},Sh=class{},Rs=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=e.slice(r+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.addHeaderEntry(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new t;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,e);let o=(n.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=n.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(n,e){let r=n.toLowerCase();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(e):this.headers.set(r,[e])}setHeaderEntries(n,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var hE=class{encodeKey(n){return h2(n)}encodeValue(n){return h2(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function zZ(t,n){let e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],l=e.get(s)||[];l.push(a),e.set(s,l)}),e}var UZ=/%(\d[a-f0-9])/gi,jZ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function h2(t){return encodeURIComponent(t).replace(UZ,(n,e)=>jZ[e]??n)}function Lv(t){return`${t}`}var yl=class t{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new hE,n.fromString){if(n.fromObject)throw new Ee(2805,!1);this.map=zZ(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let r=n.fromObject[e],o=Array.isArray(r)?r.map(Lv):[Lv(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(r=>{let o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new t({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push(Lv(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let r=this.map.get(n.param)||[],o=r.indexOf(Lv(n.value));o!==-1&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var gE=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function GZ(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function g2(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function y2(t){return typeof Blob<"u"&&t instanceof Blob}function x2(t){return typeof FormData<"u"&&t instanceof FormData}function WZ(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var wh="Content-Type",Vv="Accept",vE="X-Request-URL",C2="text/plain",I2="application/json",S2=`${I2}, ${C2}, */*`,Ch=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(n,e,r,o){this.url=e,this.method=n.toUpperCase();let i;if(GZ(this.method)||o?(this.body=r!==void 0?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new Rs,this.context??=new gE,!this.params)this.params=new yl,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),l=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||g2(this.body)||y2(this.body)||x2(this.body)||WZ(this.body)?this.body:this.body instanceof yl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||x2(this.body)?null:y2(this.body)?this.body.type||null:g2(this.body)?null:typeof this.body=="string"?C2:this.body instanceof yl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?I2:null}clone(n={}){let e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=n.transferCache??this.transferCache,s=n.body!==void 0?n.body:this.body,a=n.withCredentials??this.withCredentials,l=n.reportProgress??this.reportProgress,c=n.headers||this.headers,u=n.params||this.params,d=n.context??this.context;return n.setHeaders!==void 0&&(c=Object.keys(n.setHeaders).reduce((p,f)=>p.set(f,n.setHeaders[f]),c)),n.setParams&&(u=Object.keys(n.setParams).reduce((p,f)=>p.set(f,n.setParams[f]),u)),new t(e,r,s,{params:u,headers:c,context:d,reportProgress:l,responseType:o,withCredentials:a,transferCache:i})}},xl=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(xl||{}),Th=class{headers;status;statusText;url;ok;type;constructor(n,e=200,r="OK"){this.headers=n.headers||new Rs,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},Bv=class t extends Th{constructor(n={}){super(n)}type=xl.ResponseHeader;clone(n={}){return new t({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Eh=class t extends Th{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=xl.Response;clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},gl=class extends Th{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},T2=200,HZ=204;function fE(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}var qZ=(()=>{class t{handler;constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof Ch)i=e;else{let l;o.headers instanceof Rs?l=o.headers:l=new Rs(o.headers);let c;o.params&&(o.params instanceof yl?c=o.params:c=new yl({fromObject:o.params})),i=new Ch(e,r,o.body!==void 0?o.body:null,{headers:l,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let s=He(i).pipe(il(l=>this.handler.handle(l)));if(e instanceof Ch||o.observe==="events")return s;let a=s.pipe(no(l=>l instanceof Eh));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(tt(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Ee(2806,!1);return l.body}));case"blob":return a.pipe(tt(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Ee(2807,!1);return l.body}));case"text":return a.pipe(tt(l=>{if(l.body!==null&&typeof l.body!="string")throw new Ee(2808,!1);return l.body}));case"json":default:return a.pipe(tt(l=>l.body))}case"response":return a;default:throw new Ee(2809,!1)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:new yl().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,fE(o,r))}post(e,r,o={}){return this.request("POST",e,fE(o,r))}put(e,r,o={}){return this.request("PUT",e,fE(o,r))}static \u0275fac=function(r){return new(r||t)($e(Ih))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),KZ=/^\)\]\}',?\n/;function v2(t){if(t.url)return t.url;let n=vE.toLocaleLowerCase();return t.headers.get(n)}var E2=new Re(""),mE=(()=>{class t{fetchImpl=ue(yE,{optional:!0})?.fetch??((...e)=>globalThis.fetch(...e));ngZone=ue(En);handle(e){return new bt(r=>{let o=new AbortController;return this.doRequest(e,o.signal,r).then(xE,i=>r.error(new gl({error:i}))),()=>o.abort()})}async doRequest(e,r,o){let i=this.createRequestInit(e),s;try{let f=this.ngZone.runOutsideAngular(()=>this.fetchImpl(e.urlWithParams,he({signal:r},i)));XZ(f),o.next({type:xl.Sent}),s=await f}catch(f){o.error(new gl({error:f,status:f.status??0,statusText:f.statusText,url:e.urlWithParams,headers:f.headers}));return}let a=new Rs(s.headers),l=s.statusText,c=v2(s)??e.urlWithParams,u=s.status,d=null;if(e.reportProgress&&o.next(new Bv({headers:a,status:u,statusText:l,url:c})),s.body){let f=s.headers.get("content-length"),m=[],h=s.body.getReader(),g=0,y,x,w=typeof Zone<"u"&&Zone.current;await this.ngZone.runOutsideAngular(async()=>{for(;;){let{done:S,value:E}=await h.read();if(S)break;if(m.push(E),g+=E.length,e.reportProgress){x=e.responseType==="text"?(x??"")+(y??=new TextDecoder).decode(E,{stream:!0}):void 0;let D=()=>o.next({type:xl.DownloadProgress,total:f?+f:void 0,loaded:g,partialText:x});w?w.run(D):D()}}});let b=this.concatChunks(m,g);try{let S=s.headers.get(wh)??"";d=this.parseBody(e,b,S)}catch(S){o.error(new gl({error:S,headers:new Rs(s.headers),status:s.status,statusText:s.statusText,url:v2(s)??e.urlWithParams}));return}}u===0&&(u=d?T2:0),u>=200&&u<300?(o.next(new Eh({body:d,headers:a,status:u,statusText:l,url:c})),o.complete()):o.error(new gl({error:d,headers:a,status:u,statusText:l,url:c}))}parseBody(e,r,o){switch(e.responseType){case"json":let i=new TextDecoder().decode(r).replace(KZ,"");return i===""?null:JSON.parse(i);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:o});case"arraybuffer":return r.buffer}}createRequestInit(e){let r={},o=e.withCredentials?"include":void 0;if(e.headers.forEach((i,s)=>r[i]=s.join(",")),e.headers.has(Vv)||(r[Vv]=S2),!e.headers.has(wh)){let i=e.detectContentTypeHeader();i!==null&&(r[wh]=i)}return{body:e.serializeBody(),method:e.method,headers:r,credentials:o}}concatChunks(e,r){let o=new Uint8Array(r),i=0;for(let s of e)o.set(s,i),i+=s.length;return o}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),yE=class{};function xE(){}function XZ(t){t.then(xE,xE)}function YZ(t,n){return n(t)}function ZZ(t,n,e){return(r,o)=>rr(e,()=>n(r,i=>t(i,o)))}var _2=new Re(""),QZ=new Re(""),JZ=new Re("",{providedIn:"root",factory:()=>!0});var b2=(()=>{class t extends Ih{backend;injector;chain=null;pendingTasks=ue(Es);contributeToStability=ue(JZ);constructor(e,r){super(),this.backend=e,this.injector=r}handle(e){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(_2),...this.injector.get(QZ,[])]));this.chain=r.reduceRight((o,i)=>ZZ(o,i,this.injector),YZ)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(Zc(()=>this.pendingTasks.remove(r)))}else return this.chain(e,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||t)($e(Sh),$e(Br))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})();var eQ=/^\)\]\}',?\n/,tQ=RegExp(`^${vE}:`,"m");function nQ(t){return"responseURL"in t&&t.responseURL?t.responseURL:tQ.test(t.getAllResponseHeaders())?t.getResponseHeader(vE):null}var w2=(()=>{class t{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new Ee(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?fn(r.\u0275loadImpl()):He(null)).pipe(ro(()=>new bt(i=>{let s=r.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((h,g)=>s.setRequestHeader(h,g.join(","))),e.headers.has(Vv)||s.setRequestHeader(Vv,S2),!e.headers.has(wh)){let h=e.detectContentTypeHeader();h!==null&&s.setRequestHeader(wh,h)}if(e.responseType){let h=e.responseType.toLowerCase();s.responseType=h!=="json"?h:"text"}let a=e.serializeBody(),l=null,c=()=>{if(l!==null)return l;let h=s.statusText||"OK",g=new Rs(s.getAllResponseHeaders()),y=nQ(s)||e.url;return l=new Bv({headers:g,status:s.status,statusText:h,url:y}),l},u=()=>{let{headers:h,status:g,statusText:y,url:x}=c(),w=null;g!==HZ&&(w=typeof s.response>"u"?s.responseText:s.response),g===0&&(g=w?T2:0);let b=g>=200&&g<300;if(e.responseType==="json"&&typeof w=="string"){let S=w;w=w.replace(eQ,"");try{w=w!==""?JSON.parse(w):null}catch(E){w=S,b&&(b=!1,w={error:E,text:w})}}b?(i.next(new Eh({body:w,headers:h,status:g,statusText:y,url:x||void 0})),i.complete()):i.error(new gl({error:w,headers:h,status:g,statusText:y,url:x||void 0}))},d=h=>{let{url:g}=c(),y=new gl({error:h,status:s.status||0,statusText:s.statusText||"Unknown Error",url:g||void 0});i.error(y)},p=!1,f=h=>{p||(i.next(c()),p=!0);let g={type:xl.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),e.responseType==="text"&&s.responseText&&(g.partialText=s.responseText),i.next(g)},m=h=>{let g={type:xl.UploadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),i.next(g)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),e.reportProgress&&(s.addEventListener("progress",f),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:xl.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),e.reportProgress&&(s.removeEventListener("progress",f),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(r){return new(r||t)($e(Sp))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),D2=new Re(""),rQ="XSRF-TOKEN",oQ=new Re("",{providedIn:"root",factory:()=>rQ}),iQ="X-XSRF-TOKEN",sQ=new Re("",{providedIn:"root",factory:()=>iQ}),zv=class{},aQ=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o}getToken(){if(this.platform==="server")return null;let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=$v(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(r){return new(r||t)($e(Ur),$e(No),$e(oQ))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})();function lQ(t,n){let e=t.url.toLowerCase();if(!ue(D2)||t.method==="GET"||t.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return n(t);let r=ue(zv).getToken(),o=ue(sQ);return r!=null&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var N2=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(N2||{});function cQ(t,n){return{\u0275kind:t,\u0275providers:n}}function k2(...t){let n=[qZ,w2,b2,{provide:Ih,useExisting:b2},{provide:Sh,useFactory:()=>ue(E2,{optional:!0})??ue(w2)},{provide:_2,useValue:lQ,multi:!0},{provide:D2,useValue:!0},{provide:zv,useClass:aQ}];for(let e of t)n.push(...e.\u0275providers);return gp(n)}function A2(){return cQ(N2.Fetch,[mE,{provide:E2,useExisting:mE},{provide:Sh,useExisting:mE}])}var wE=class extends Mv{supportsDOMEvents=!0},CE=class t extends wE{static makeCurrent(){l2(new t)}onAndCancel(n,e,r,o){return n.addEventListener(e,r,o),()=>{n.removeEventListener(e,r,o)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=uQ();return e==null?null:dQ(e)}resetBaseElement(){_h=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return $v(document.cookie,n)}},_h=null;function uQ(){return _h=_h||document.querySelector("base"),_h?_h.getAttribute("href"):null}function dQ(t){return new URL(t,document.baseURI).pathname}var pQ=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),IE=new Re(""),$2=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new Ee(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||t)($e(IE),$e(En))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),jv=class{_doc;constructor(n){this._doc=n}manager},Uv="ng-app-id";function R2(t){for(let n of t)n.remove()}function O2(t,n){let e=n.createElement("style");return e.textContent=t,e}function fQ(t,n,e,r){let o=t.head?.querySelectorAll(`style[${Uv}="${n}"],link[${Uv}="${n}"]`);if(o)for(let i of o)i.removeAttribute(Uv),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function SE(t,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}var L2=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=pE(i),fQ(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,O2);r?.forEach(o=>this.addUsage(o,this.external,SE))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(R2(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])R2(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,O2(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,SE(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(Uv,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||t)($e(Ur),$e(AT),$e(OT,8),$e(No))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),bE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},EE=/%COMP%/g;var V2="%COMP%",mQ=`_nghost-${V2}`,hQ=`_ngcontent-${V2}`,gQ=!0,yQ=new Re("",{providedIn:"root",factory:()=>gQ});function xQ(t){return hQ.replace(EE,t)}function vQ(t){return mQ.replace(EE,t)}function B2(t,n){return n.map(e=>e.replace(EE,t))}var M2=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=pE(a),this.defaultRenderer=new Dh(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Fi.ShadowDom&&(r=ot(he({},r),{encapsulation:Fi.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof Gv?o.applyToHost(e):o instanceof Nh&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,p=this.tracingService;switch(r.encapsulation){case Fi.Emulated:i=new Gv(l,c,r,this.appId,u,s,a,d,p);break;case Fi.ShadowDom:return new TE(l,c,e,r,s,a,this.nonce,d,p);default:i=new Nh(l,c,r,u,s,a,d,p);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||t)($e($2),$e(L2),$e(AT),$e(yQ),$e(Ur),$e(No),$e(En),$e(OT),$e(yv,8))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),Dh=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,r,o,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(bE[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(F2(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(F2(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){e.remove()}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new Ee(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=bE[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=bE[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(vs.DashCase|vs.Important)?n.style.setProperty(e,r,o&vs.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&vs.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r,o){if(typeof n=="string"&&(n=As().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${e}`);let i=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,e,i)),this.eventManager.addEventListener(n,e,i,o)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function F2(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var TE=class extends Dh{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,l,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=B2(o.id,u);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let d=o.getExternalStyles?.();if(d)for(let p of d){let f=SE(p,i);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Nh=class extends Dh{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let u=r.styles;this.styles=c?B2(c,u):u,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Gv=class extends Nh{contentAttr;hostAttr;constructor(n,e,r,o,i,s,a,l,c){let u=o+"-"+r.id;super(n,e,r,i,s,a,l,c,u),this.contentAttr=xQ(u),this.hostAttr=vQ(u)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}},bQ=(()=>{class t extends jv{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||t)($e(Ur))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})(),P2=["alt","control","meta","shift"],wQ={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},CQ={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},IQ=(()=>{class t extends jv{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>As().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),P2.forEach(c=>{let u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=wQ[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),P2.forEach(s=>{if(s!==o){let a=CQ[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||t)($e(Ur))};static \u0275prov=ke({token:t,factory:t.\u0275fac})}return t})();function z2(t,n){return QM(he({rootComponent:t},SQ(n)))}function SQ(t){return{appProviders:[...NQ,...t?.providers??[]],platformProviders:DQ}}function TQ(){CE.makeCurrent()}function EQ(){return new xs}function _Q(){return GO(document),document}var DQ=[{provide:No,useValue:dE},{provide:RT,useValue:TQ,multi:!0},{provide:Ur,useFactory:_Q,deps:[]}];var NQ=[{provide:iv,useValue:"root"},{provide:xs,useFactory:EQ,deps:[]},{provide:IE,useClass:bQ,multi:!0,deps:[Ur,En,No]},{provide:IE,useClass:IQ,multi:!0,deps:[Ur]},M2,L2,$2,{provide:mp,useExisting:M2},{provide:Sp,useClass:pQ,deps:[]},[]];var U2=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||t)($e(Ur))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var nt="primary",Gh=Symbol("RouteTitle"),AE=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function Rp(t){return new AE(t)}function AQ(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=t[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function RQ(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!Vi(t[e],n[e]))return!1;return!0}function Vi(t,n){let e=t?RE(t):void 0,r=n?RE(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!Y2(t[o],n[o]))return!1;return!0}function RE(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function Y2(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function Z2(t){return t.length>0?t[t.length-1]:null}function bl(t){return lS(t)?t:mu(t)?fn(Promise.resolve(t)):He(t)}var OQ={exact:J2,subset:eF},Q2={exact:MQ,subset:FQ,ignored:()=>!0};function j2(t,n,e){return OQ[e.paths](t.root,n.root,e.matrixParams)&&Q2[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function MQ(t,n){return Vi(t,n)}function J2(t,n,e){if(!wu(t.segments,n.segments)||!qv(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!J2(t.children[r],n.children[r],e))return!1;return!0}function FQ(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>Y2(t[e],n[e]))}function eF(t,n,e){return tF(t,n,n.segments,e)}function tF(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!wu(o,e)||n.hasChildren()||!qv(o,e,r))}else if(t.segments.length===e.length){if(!wu(t.segments,e)||!qv(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!eF(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!wu(t.segments,o)||!qv(t.segments,o,r)||!t.children[nt]?!1:tF(t.children[nt],n,i,r)}}function qv(t,n,e){return n.every((r,o)=>Q2[e](t[o].parameters,r.parameters))}var Ms=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Pt([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Rp(this.queryParams),this._queryParamMap}toString(){return LQ.serialize(this)}},Pt=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Kv(this)}},bu=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=Rp(this.parameters),this._parameterMap}toString(){return rF(this)}};function PQ(t,n){return wu(t,n)&&t.every((e,r)=>Vi(e.parameters,n[r].parameters))}function wu(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function $Q(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===nt&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==nt&&(e=e.concat(n(o,r)))}),e}var o_=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>new Fh,providedIn:"root"})}return t})(),Fh=class{parse(n){let e=new ME(n);return new Ms(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${kh(n.root,!0)}`,r=zQ(n.queryParams),o=typeof n.fragment=="string"?`#${VQ(n.fragment)}`:"";return`${e}${r}${o}`}},LQ=new Fh;function Kv(t){return t.segments.map(n=>rF(n)).join("/")}function kh(t,n){if(!t.hasChildren())return Kv(t);if(n){let e=t.children[nt]?kh(t.children[nt],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==nt&&r.push(`${o}:${kh(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=$Q(t,(r,o)=>o===nt?[kh(t.children[nt],!1)]:[`${o}:${kh(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[nt]!=null?`${Kv(t)}/${e[0]}`:`${Kv(t)}/(${e.join("//")})`}}function nF(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Wv(t){return nF(t).replace(/%3B/gi,";")}function VQ(t){return encodeURI(t)}function OE(t){return nF(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Xv(t){return decodeURIComponent(t)}function G2(t){return Xv(t.replace(/\+/g,"%20"))}function rF(t){return`${OE(t.path)}${BQ(t.parameters)}`}function BQ(t){return Object.entries(t).map(([n,e])=>`;${OE(n)}=${OE(e)}`).join("")}function zQ(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${Wv(e)}=${Wv(o)}`).join("&"):`${Wv(e)}=${Wv(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var UQ=/^[^\/()?;#]+/;function _E(t){let n=t.match(UQ);return n?n[0]:""}var jQ=/^[^\/()?;=#]+/;function GQ(t){let n=t.match(jQ);return n?n[0]:""}var WQ=/^[^=?&#]+/;function HQ(t){let n=t.match(WQ);return n?n[0]:""}var qQ=/^[^&#]+/;function KQ(t){let n=t.match(qQ);return n?n[0]:""}var ME=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Pt([],{}):new Pt([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[nt]=new Pt(n,e)),r}parseSegment(){let n=_E(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new Ee(4009,!1);return this.capture(n),new bu(Xv(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=GQ(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=_E(this.remaining);o&&(r=o,this.capture(r))}n[Xv(e)]=Xv(r)}parseQueryParam(n){let e=HQ(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=KQ(this.remaining);s&&(r=s,this.capture(r))}let o=G2(e),i=G2(r);if(n.hasOwnProperty(o)){let s=n[o];Array.isArray(s)||(s=[s],n[o]=s),s.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=_E(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new Ee(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=nt);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[nt]:new Pt([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new Ee(4011,!1)}};function oF(t){return t.segments.length>0?new Pt([],{[nt]:t}):t}function iF(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=iF(o);if(r===nt&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))n[s]=a;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new Pt(t.segments,n);return XQ(e)}function XQ(t){if(t.numberOfChildren===1&&t.children[nt]){let n=t.children[nt];return new Pt(t.segments.concat(n.segments),n.children)}return t}function Cu(t){return t instanceof Ms}function YQ(t,n,e=null,r=null){let o=sF(t);return aF(o,n,e,r)}function sF(t){let n;function e(i){let s={};for(let l of i.children){let c=e(l);s[l.outlet]=c}let a=new Pt(i.url,s);return i===t&&(n=a),a}let r=e(t.root),o=oF(r);return n??o}function aF(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return DE(o,o,o,e,r);let i=ZQ(n);if(i.toRoot())return DE(o,o,new Pt([],{}),e,r);let s=QQ(i,o,t),a=s.processChildren?Rh(s.segmentGroup,s.index,i.commands):cF(s.segmentGroup,s.index,i.commands);return DE(o,s.segmentGroup,a,e,r)}function Yv(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function Ph(t){return typeof t=="object"&&t!=null&&t.outlets}function DE(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([l,c])=>{i[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;t===n?s=e:s=lF(t,n,e);let a=oF(iF(s));return new Ms(a,i,o)}function lF(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=lF(i,n,e)}),new Pt(t.segments,r)}var Zv=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Yv(r[0]))throw new Ee(4003,!1);let o=r.find(Ph);if(o&&o!==Z2(r))throw new Ee(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ZQ(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new Zv(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?n++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new Zv(e,n,r)}var Np=class{segmentGroup;processChildren;index;constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function QQ(t,n,e){if(t.isAbsolute)return new Np(n,!0,0);if(!e)return new Np(n,!1,NaN);if(e.parent===null)return new Np(e,!0,0);let r=Yv(t.commands[0])?0:1,o=e.segments.length-1+r;return JQ(e,o,t.numberOfDoubleDots)}function JQ(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Ee(4005,!1);o=r.segments.length}return new Np(r,!1,o-i)}function eJ(t){return Ph(t[0])?t[0].outlets:{[nt]:t}}function cF(t,n,e){if(t??=new Pt([],{}),t.segments.length===0&&t.hasChildren())return Rh(t,n,e);let r=tJ(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new Pt(t.segments.slice(0,r.pathIndex),{});return i.children[nt]=new Pt(t.segments.slice(r.pathIndex),t.children),Rh(i,0,o)}else return r.match&&o.length===0?new Pt(t.segments,{}):r.match&&!t.hasChildren()?FE(t,n,e):r.match?Rh(t,0,o):FE(t,n,e)}function Rh(t,n,e){if(e.length===0)return new Pt(t.segments,{});{let r=eJ(e),o={};if(Object.keys(r).some(i=>i!==nt)&&t.children[nt]&&t.numberOfChildren===1&&t.children[nt].segments.length===0){let i=Rh(t.children[nt],n,e);return new Pt(t.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=cF(t.children[i],n,s))}),Object.entries(t.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new Pt(t.segments,o)}}function tJ(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let s=t.segments[o],a=e[r];if(Ph(a))break;let l=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!H2(l,c,s))return i;r+=2}else{if(!H2(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function FE(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(Ph(i)){let l=nJ(i.outlets);return new Pt(r,l)}if(o===0&&Yv(e[0])){let l=t.segments[n];r.push(new bu(l.path,W2(e[0]))),o++;continue}let s=Ph(i)?i.outlets[nt]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&Yv(a)?(r.push(new bu(s,W2(a))),o+=2):(r.push(new bu(s,{})),o++)}return new Pt(r,{})}function nJ(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=FE(new Pt([],{}),0,r))}),n}function W2(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function H2(t,n,e){return t==e.path&&Vi(n,e.parameters)}var Oh="imperative",or=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(or||{}),Ro=class{id;url;constructor(n,e){this.id=n,this.url=e}},$h=class extends Ro{type=or.NavigationStart;navigationTrigger;restoredState;constructor(n,e,r="imperative",o=null){super(n,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},vl=class extends Ro{urlAfterRedirects;type=or.NavigationEnd;constructor(n,e,r){super(n,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},lo=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(lo||{}),PE=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(PE||{}),Os=class extends Ro{reason;code;type=or.NavigationCancel;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Iu=class extends Ro{reason;code;type=or.NavigationSkipped;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}},Lh=class extends Ro{error;target;type=or.NavigationError;constructor(n,e,r,o){super(n,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Qv=class extends Ro{urlAfterRedirects;state;type=or.RoutesRecognized;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},$E=class extends Ro{urlAfterRedirects;state;type=or.GuardsCheckStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},LE=class extends Ro{urlAfterRedirects;state;shouldActivate;type=or.GuardsCheckEnd;constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},VE=class extends Ro{urlAfterRedirects;state;type=or.ResolveStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},BE=class extends Ro{urlAfterRedirects;state;type=or.ResolveEnd;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},zE=class{route;type=or.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},UE=class{route;type=or.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},jE=class{snapshot;type=or.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},GE=class{snapshot;type=or.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},WE=class{snapshot;type=or.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},HE=class{snapshot;type=or.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Vh=class{},Op=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function rJ(t,n){return t.providers&&!t._injector&&(t._injector=YT(t.providers,n,`Route: ${t.path}`)),t._injector??n}function di(t){return t.outlet||nt}function oJ(t,n){let e=t.filter(r=>di(r)===n);return e.push(...t.filter(r=>di(r)!==n)),e}function Wh(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var qE=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Wh(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new i0(this.rootInjector)}},i0=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new qE(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||t)($e(Br))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Jv=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=KE(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=KE(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=XE(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return XE(n,this._root).map(e=>e.value)}};function KE(t,n){if(t===n.value)return n;for(let e of n.children){let r=KE(t,e);if(r)return r}return null}function XE(t,n){if(t===n.value)return[n];for(let e of n.children){let r=XE(t,e);if(r.length)return r.unshift(n),r}return[]}var ao=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function Dp(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var e0=class extends Jv{snapshot;constructor(n,e){super(n),this.snapshot=e,i_(this,n)}toString(){return this.snapshot.toString()}};function uF(t){let n=iJ(t),e=new tr([new bu("",{})]),r=new tr({}),o=new tr({}),i=new tr({}),s=new tr(""),a=new pi(e,r,i,s,o,nt,t,n.root);return a.snapshot=n.root,new e0(new ao(a,[]),n)}function iJ(t){let n={},e={},r={},o="",i=new kp([],n,r,o,e,nt,t,null,{});return new n0("",new ao(i,[]))}var pi=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,r,o,i,s,a,l){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(tt(c=>c[Gh]))??He(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(tt(n=>Rp(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(tt(n=>Rp(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function t0(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:he(he({},n.params),t.params),data:he(he({},n.data),t.data),resolve:he(he(he(he({},t.data),n.data),o?.data),t._resolvedData)}:r={params:he({},t.params),data:he({},t.data),resolve:he(he({},t.data),t._resolvedData??{})},o&&pF(o)&&(r.resolve[Gh]=o.title),r}var kp=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Gh]}constructor(n,e,r,o,i,s,a,l,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Rp(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Rp(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},n0=class extends Jv{url;constructor(n,e){super(e),this.url=n,i_(this,e)}toString(){return dF(this._root)}};function i_(t,n){n.value._routerState=t,n.children.forEach(e=>i_(t,e))}function dF(t){let n=t.children.length>0?` { ${t.children.map(dF).join(", ")} } `:"";return`${t.value}${n}`}function NE(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,Vi(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),Vi(n.params,e.params)||t.paramsSubject.next(e.params),RQ(n.url,e.url)||t.urlSubject.next(e.url),Vi(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function YE(t,n){let e=Vi(t.params,n.params)&&PQ(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||YE(t.parent,n.parent))}function pF(t){return typeof t.title=="string"||t.title===null}var sJ=new Re(""),s_=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=nt;activateEvents=new Bt;deactivateEvents=new Bt;attachEvents=new Bt;detachEvents=new Bt;routerOutletData=PO(void 0);parentContexts=ue(i0);location=ue(bp);changeDetector=ue(zt);inputBinder=ue(a_,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ee(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ee(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ee(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Ee(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new ZE(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Nt({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[ai]})}return t})(),ZE=class t{route;childContexts;parent;outletData;__ngOutletInjector(n){return new t(this.route,this.childContexts,n,this.outletData)}constructor(n,e,r,o){this.route=n,this.childContexts=e,this.parent=r,this.outletData=o}get(n,e){return n===pi?this.route:n===i0?this.childContexts:n===sJ?this.outletData:this.parent.get(n,e)}},a_=new Re("");function aJ(t,n,e){let r=Bh(t,n._root,e?e._root:void 0);return new e0(r,n)}function Bh(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=lJ(t,n,e);return new ao(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>Bh(t,a)),s}}let r=cJ(n.value),o=n.children.map(i=>Bh(t,i));return new ao(r,o)}}function lJ(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return Bh(t,r,o);return Bh(t,r)})}function cJ(t){return new pi(new tr(t.url),new tr(t.params),new tr(t.queryParams),new tr(t.fragment),new tr(t.data),t.outlet,t.component,t)}var zh=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},fF="ngNavigationCancelingError";function r0(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Cu(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=mF(!1,lo.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function mF(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[fF]=!0,e.cancellationCode=n,e}function uJ(t){return hF(t)&&Cu(t.url)}function hF(t){return!!t&&t[fF]}var dJ=(t,n,e,r)=>tt(o=>(new QE(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),QE=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),NE(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=Dp(e);n.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Dp(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Dp(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=Dp(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new HE(i.value.snapshot))}),n.children.length&&this.forwardEvent(new GE(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(NE(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),NE(a.route.value),this.activateChildRoutes(n,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(n,null,s.children)}else this.activateChildRoutes(n,null,r)}},o0=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},Ap=class{component;route;constructor(n,e){this.component=n,this.route=e}};function pJ(t,n,e){let r=t._root,o=n?n._root:null;return Ah(r,o,e,[r.value])}function fJ(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function Fp(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!AR(t)?t:n.get(t):r}function Ah(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Dp(n);return t.children.forEach(s=>{mJ(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>Mh(a,e.getContext(s),o)),o}function mJ(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=hJ(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new o0(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?Ah(t,n,a?a.children:null,r,o):Ah(t,n,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Ap(a.outlet.component,s))}else s&&Mh(n,a,o),o.canActivateChecks.push(new o0(r)),i.component?Ah(t,null,a?a.children:null,r,o):Ah(t,null,e,r,o);return o}function hJ(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!wu(t.url,n.url);case"pathParamsOrQueryParamsChange":return!wu(t.url,n.url)||!Vi(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!YE(t,n)||!Vi(t.queryParams,n.queryParams);case"paramsChange":default:return!YE(t,n)}}function Mh(t,n,e){let r=Dp(t),o=t.value;Object.entries(r).forEach(([i,s])=>{o.component?n?Mh(s,n.children.getContext(i),e):Mh(s,null,e):Mh(s,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new Ap(n.outlet.component,o)):e.canDeactivateChecks.push(new Ap(null,o)):e.canDeactivateChecks.push(new Ap(null,o))}function Hh(t){return typeof t=="function"}function gJ(t){return typeof t=="boolean"}function yJ(t){return t&&Hh(t.canLoad)}function xJ(t){return t&&Hh(t.canActivate)}function vJ(t){return t&&Hh(t.canActivateChild)}function bJ(t){return t&&Hh(t.canDeactivate)}function wJ(t){return t&&Hh(t.canMatch)}function gF(t){return t instanceof ps||t?.name==="EmptyError"}var Hv=Symbol("INITIAL_VALUE");function Mp(){return ro(t=>mx(t.map(n=>n.pipe(fs(1),fS(Hv)))).pipe(tt(n=>{for(let e of n)if(e!==!0){if(e===Hv)return Hv;if(e===!1||CJ(e))return e}return!0}),no(n=>n!==Hv),fs(1)))}function CJ(t){return Cu(t)||t instanceof zh}function IJ(t,n){return $n(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?He(ot(he({},e),{guardsResult:!0})):SJ(s,r,o,t).pipe($n(a=>a&&gJ(a)?TJ(r,i,t,n):He(a)),tt(a=>ot(he({},e),{guardsResult:a})))})}function SJ(t,n,e,r){return fn(t).pipe($n(o=>kJ(o.component,o.route,e,n,r)),ms(o=>o!==!0,!0))}function TJ(t,n,e,r){return fn(n).pipe(il(o=>Jd(_J(o.route.parent,r),EJ(o.route,r),NJ(t,o.path,e),DJ(t,o.route,e))),ms(o=>o!==!0,!0))}function EJ(t,n){return t!==null&&n&&n(new WE(t)),He(!0)}function _J(t,n){return t!==null&&n&&n(new jE(t)),He(!0)}function DJ(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return He(!0);let o=r.map(i=>hx(()=>{let s=Wh(n)??e,a=Fp(i,s),l=xJ(a)?a.canActivate(n,t):rr(s,()=>a(n,t));return bl(l).pipe(ms())}));return He(o).pipe(Mp())}function NJ(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(s=>fJ(s)).filter(s=>s!==null).map(s=>hx(()=>{let a=s.guards.map(l=>{let c=Wh(s.node)??e,u=Fp(l,c),d=vJ(u)?u.canActivateChild(r,t):rr(c,()=>u(r,t));return bl(d).pipe(ms())});return He(a).pipe(Mp())}));return He(i).pipe(Mp())}function kJ(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return He(!0);let s=i.map(a=>{let l=Wh(n)??o,c=Fp(a,l),u=bJ(c)?c.canDeactivate(t,n,e,r):rr(l,()=>c(t,n,e,r));return bl(u).pipe(ms())});return He(s).pipe(Mp())}function AJ(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return He(!0);let i=o.map(s=>{let a=Fp(s,t),l=yJ(a)?a.canLoad(n,e):rr(t,()=>a(n,e));return bl(l)});return He(i).pipe(Mp(),yF(r))}function yF(t){return oS(Gn(n=>{if(typeof n!="boolean")throw r0(t,n)}),tt(n=>n===!0))}function RJ(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return He(!0);let i=o.map(s=>{let a=Fp(s,t),l=wJ(a)?a.canMatch(n,e):rr(t,()=>a(n,e));return bl(l)});return He(i).pipe(Mp(),yF(r))}var Uh=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},jh=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function _p(t){return Qd(new Uh(t))}function OJ(t){return Qd(new Ee(4e3,!1))}function MJ(t){return Qd(mF(!1,lo.GuardRejected))}var JE=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return He(r);if(o.numberOfChildren>1||!o.children[nt])return OJ(`${n.redirectTo}`);o=o.children[nt]}}applyRedirectCommands(n,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,params:f,data:m,title:h}=o,g=rr(i,()=>a({params:f,data:m,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,title:h}));if(g instanceof Ms)throw new jh(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e[0]==="/")throw new jh(s);return s}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new Ms(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(n,l,r,o)}),new Pt(i,s)}createSegments(n,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new Ee(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},e_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function FJ(t,n,e,r,o){let i=xF(t,n,e);return i.matched?(r=rJ(n,r),RJ(r,n,e,o).pipe(tt(s=>s===!0?i:he({},e_)))):He(i)}function xF(t,n,e){if(n.path==="**")return PJ(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?he({},e_):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||AQ)(e,t,n);if(!o)return he({},e_);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?he(he({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function PJ(t){return{matched:!0,parameters:t.length>0?Z2(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function q2(t,n,e,r){return e.length>0&&VJ(t,e,r)?{segmentGroup:new Pt(n,LJ(r,new Pt(e,t.children))),slicedSegments:[]}:e.length===0&&BJ(t,e,r)?{segmentGroup:new Pt(t.segments,$J(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new Pt(t.segments,t.children),slicedSegments:e}}function $J(t,n,e,r){let o={};for(let i of e)if(s0(t,n,i)&&!r[di(i)]){let s=new Pt([],{});o[di(i)]=s}return he(he({},r),o)}function LJ(t,n){let e={};e[nt]=n;for(let r of t)if(r.path===""&&di(r)!==nt){let o=new Pt([],{});e[di(r)]=o}return e}function VJ(t,n,e){return e.some(r=>s0(t,n,r)&&di(r)!==nt)}function BJ(t,n,e){return e.some(r=>s0(t,n,r))}function s0(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function zJ(t,n,e){return n.length===0&&!t.children[e]}var t_=class{};function UJ(t,n,e,r,o,i,s="emptyOnly"){return new n_(t,n,e,r,o,s,i).recognize()}var jJ=31,n_=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,r,o,i,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new JE(this.urlSerializer,this.urlTree)}noMatchError(n){return new Ee(4002,`'${n.segmentGroup}'`)}recognize(){let n=q2(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(tt(({children:e,rootSnapshot:r})=>{let o=new ao(r,e),i=new n0("",o),s=YQ(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(n){let e=new kp([],Object.freeze({}),Object.freeze(he({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),nt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,nt,e).pipe(tt(r=>({children:r,rootSnapshot:e})),ol(r=>{if(r instanceof jh)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Uh?this.noMatchError(r):r}))}processSegmentGroup(n,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r,i):this.processSegment(n,e,r,r.segments,o,!0,i).pipe(tt(s=>s instanceof ao?[s]:[]))}processChildren(n,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return fn(i).pipe(il(s=>{let a=r.children[s],l=oJ(e,s);return this.processSegmentGroup(n,l,a,s,o)}),pS((s,a)=>(s.push(...a),s)),sl(null),dS(),$n(s=>{if(s===null)return _p(r);let a=vF(s);return GJ(a),He(a)}))}processSegment(n,e,r,o,i,s,a){return fn(e).pipe(il(l=>this.processSegmentAgainstRoute(l._injector??n,e,l,r,o,i,s,a).pipe(ol(c=>{if(c instanceof Uh)return He(null);throw c}))),ms(l=>!!l),ol(l=>{if(gF(l))return zJ(r,o,i)?He(new t_):_p(r);throw l}))}processSegmentAgainstRoute(n,e,r,o,i,s,a,l){return di(r)!==s&&(s===nt||!s0(o,i,r))?_p(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,s,l):_p(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:p}=xF(e,o,i);if(!l)return _p(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>jJ&&(this.allowRedirects=!1));let f=new kp(i,c,Object.freeze(he({},this.urlTree.queryParams)),this.urlTree.fragment,K2(o),di(o),o.component??o._loadedComponent??null,o,X2(o)),m=t0(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(m.params),f.data=Object.freeze(m.data);let h=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,f,n);return this.applyRedirects.lineralizeSegments(o,h).pipe($n(g=>this.processSegment(n,r,e,g.concat(p),s,!1,a)))}matchSegmentAgainstRoute(n,e,r,o,i,s){let a=FJ(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(ro(l=>l.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(ro(({routes:c})=>{let u=r._loadedInjector??n,{parameters:d,consumedSegments:p,remainingSegments:f}=l,m=new kp(p,d,Object.freeze(he({},this.urlTree.queryParams)),this.urlTree.fragment,K2(r),di(r),r.component??r._loadedComponent??null,r,X2(r)),h=t0(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(h.params),m.data=Object.freeze(h.data);let{segmentGroup:g,slicedSegments:y}=q2(e,p,f,c);if(y.length===0&&g.hasChildren())return this.processChildren(u,c,g,m).pipe(tt(w=>new ao(m,w)));if(c.length===0&&y.length===0)return He(new ao(m,[]));let x=di(r)===i;return this.processSegment(u,c,g,y,x?nt:i,!0,m).pipe(tt(w=>new ao(m,w instanceof ao?[w]:[])))}))):_p(e)))}getChildConfig(n,e,r){return e.children?He({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?He({routes:e._loadedRoutes,injector:e._loadedInjector}):AJ(n,e,r,this.urlSerializer).pipe($n(o=>o?this.configLoader.loadChildren(n,e).pipe(Gn(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):MJ(e))):He({routes:[],injector:n})}};function GJ(t){t.sort((n,e)=>n.value.outlet===nt?-1:e.value.outlet===nt?1:n.value.outlet.localeCompare(e.value.outlet))}function WJ(t){let n=t.value.routeConfig;return n&&n.path===""}function vF(t){let n=[],e=new Set;for(let r of t){if(!WJ(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=vF(r.children);n.push(new ao(r.value,o))}return n.filter(r=>!e.has(r))}function K2(t){return t.data||{}}function X2(t){return t.resolve||{}}function HJ(t,n,e,r,o,i){return $n(s=>UJ(t,n,e,r,s.extractedUrl,o,i).pipe(tt(({state:a,tree:l})=>ot(he({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function qJ(t,n){return $n(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return He(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let c of bF(l))s.add(c);let a=0;return fn(s).pipe(il(l=>i.has(l)?KJ(l,r,t,n):(l.data=t0(l,l.parent,t).resolve,He(void 0))),Gn(()=>a++),ep(1),$n(l=>a===s.size?He(e):Pr))})}function bF(t){let n=t.children.map(e=>bF(e)).flat();return[t,...n]}function KJ(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!pF(o)&&(i[Gh]=o.title),XJ(i,t,n,r).pipe(tt(s=>(t._resolvedData=s,t.data=t0(t,t.parent,e).resolve,null)))}function XJ(t,n,e,r){let o=RE(t);if(o.length===0)return He({});let i={};return fn(o).pipe($n(s=>YJ(t[s],n,e,r).pipe(ms(),Gn(a=>{if(a instanceof zh)throw r0(new Fh,a);i[s]=a}))),ep(1),tt(()=>i),ol(s=>gF(s)?Pr:Qd(s)))}function YJ(t,n,e,r){let o=Wh(n)??r,i=Fp(t,o),s=i.resolve?i.resolve(n,e):rr(o,()=>i(n,e));return bl(s)}function kE(t){return ro(n=>{let e=t(n);return e?fn(e).pipe(tt(()=>n)):He(n)})}var wF=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===nt);return r}getResolvedTitleForRoute(e){return e.data[Gh]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>ue(ZJ),providedIn:"root"})}return t})(),ZJ=(()=>{class t extends wF{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)($e(U2))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),l_=new Re("",{providedIn:"root",factory:()=>({})}),QJ=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=Mt({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&q(0,"router-outlet")},dependencies:[s_],encapsulation:2})}return t})();function c_(t){let n=t.children&&t.children.map(c_),e=n?ot(he({},t),{children:n}):he({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==nt&&(e.component=QJ),e}var u_=new Re(""),JJ=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=ue(nE);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return He(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=bl(e.loadComponent()).pipe(tt(CF),Gn(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),Zc(()=>{this.componentLoaders.delete(e)})),o=new Zd(r,()=>new Pn).pipe(Yd());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return He({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=eee(r,this.compiler,e,this.onLoadEndListener).pipe(Zc(()=>{this.childrenLoaders.delete(r)})),s=new Zd(i,()=>new Pn).pipe(Yd());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function eee(t,n,e,r){return bl(t.loadChildren()).pipe(tt(CF),$n(o=>o instanceof uh||Array.isArray(o)?He(o):fn(n.compileModuleAsync(o))),tt(o=>{r&&r(t);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(u_,[],{optional:!0,self:!0}).flat()),{routes:s.map(c_),injector:i}}))}function tee(t){return t&&typeof t=="object"&&"default"in t}function CF(t){return tee(t)?t.default:t}var d_=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>ue(nee),providedIn:"root"})}return t})(),nee=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),ree=new Re("");var oee=new Re(""),iee=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Pn;transitionAbortSubject=new Pn;configLoader=ue(JJ);environmentInjector=ue(Br);destroyRef=ue(xp);urlSerializer=ue(o_);rootContexts=ue(i0);location=ue(bh);inputBindingEnabled=ue(a_,{optional:!0})!==null;titleStrategy=ue(wF);options=ue(l_,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=ue(d_);createViewTransition=ue(ree,{optional:!0});navigationErrorHandler=ue(oee,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>He(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new zE(o)),r=o=>this.events.next(new UE(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(ot(he(he({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new tr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Oh,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(no(i=>i.id!==0),tt(i=>ot(he({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),ro(i=>{let s=!1,a=!1;return He(i).pipe(ro(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",lo.SupersededByNewNavigation),Pr;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?ot(he({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&u!=="reload"){let d="";return this.events.next(new Iu(l.id,this.urlSerializer.serialize(l.rawUrl),d,PE.IgnoredSameUrlNavigation)),l.resolve(!1),Pr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return He(l).pipe(ro(d=>{let p=this.transitions?.getValue();return this.events.next(new $h(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?Pr:Promise.resolve(d)}),HJ(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Gn(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=ot(he({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let p=new Qv(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:p,source:f,restoredState:m,extras:h}=l,g=new $h(d,this.urlSerializer.serialize(p),f,m);this.events.next(g);let y=uF(this.rootComponentType).snapshot;return this.currentTransition=i=ot(he({},l),{targetSnapshot:y,urlAfterRedirects:p,extras:ot(he({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,He(i)}else{let d="";return this.events.next(new Iu(l.id,this.urlSerializer.serialize(l.extractedUrl),d,PE.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Pr}}),Gn(l=>{let c=new $E(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),tt(l=>(this.currentTransition=i=ot(he({},l),{guards:pJ(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),IJ(this.environmentInjector,l=>this.events.next(l)),Gn(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw r0(this.urlSerializer,l.guardsResult);let c=new LE(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),no(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",lo.GuardRejected),!1)),kE(l=>{if(l.guards.canActivateChecks.length)return He(l).pipe(Gn(c=>{let u=new VE(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),ro(c=>{let u=!1;return He(c).pipe(qJ(this.paramsInheritanceStrategy,this.environmentInjector),Gn({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",lo.NoDataFromResolver)}}))}),Gn(c=>{let u=new BE(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),kE(l=>{let c=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(Gn(p=>{u.component=p}),tt(()=>{})));for(let p of u.children)d.push(...c(p));return d};return mx(c(l.targetSnapshot.root)).pipe(sl(null),fs(1))}),kE(()=>this.afterPreactivation()),ro(()=>{let{currentSnapshot:l,targetSnapshot:c}=i,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?fn(u).pipe(tt(()=>i)):He(i)}),tt(l=>{let c=aJ(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=ot(he({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),Gn(()=>{this.events.next(new Vh)}),dJ(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),fs(1),Gn({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new vl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),mS(this.transitionAbortSubject.pipe(Gn(l=>{throw l}))),Zc(()=>{!s&&!a&&this.cancelNavigationTransition(i,"",lo.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),ol(l=>{if(this.destroyed)return i.resolve(!1),Pr;if(a=!0,hF(l))this.events.next(new Os(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),uJ(l)?this.events.next(new Op(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let c=new Lh(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let u=rr(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof zh){let{message:d,cancellationCode:p}=r0(this.urlSerializer,u);this.events.next(new Os(i.id,this.urlSerializer.serialize(i.extractedUrl),d,p)),this.events.next(new Op(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return Pr}))}))}cancelNavigationTransition(e,r,o){let i=new Os(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function see(t){return t!==Oh}var aee=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>ue(lee),providedIn:"root"})}return t})(),r_=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},lee=(()=>{class t extends r_{static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),IF=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:()=>ue(cee),providedIn:"root"})}return t})(),cee=(()=>{class t extends IF{location=ue(bh);urlSerializer=ue(o_);options=ue(l_,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=ue(d_);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Ms;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=uF(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof $h)this.stateMemento=this.createStateMemento();else if(e instanceof Iu)this.rawUrlTree=r.initialUrl;else if(e instanceof Qv){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else e instanceof Vh?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):e instanceof Os&&(e.code===lo.GuardRejected||e.code===lo.NoDataFromResolver)?this.restoreHistory(r):e instanceof Lh?this.restoreHistory(r,!0):e instanceof vl&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=e instanceof Ms?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,s=he(he({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",s)}else{let i=he(he({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function uee(t,n){t.events.pipe(no(e=>e instanceof vl||e instanceof Os||e instanceof Lh||e instanceof Iu),tt(e=>e instanceof vl||e instanceof Iu?0:(e instanceof Os?e.code===lo.Redirect||e.code===lo.SupersededByNewNavigation:!1)?2:1),no(e=>e!==2),fs(1)).subscribe(()=>{n()})}var dee={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},pee={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},co=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=ue(JT);stateManager=ue(IF);options=ue(l_,{optional:!0})||{};pendingTasks=ue(Es);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=ue(iee);urlSerializer=ue(o_);location=ue(bh);urlHandlingStrategy=ue(d_);_events=new Pn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=ue(aee);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=ue(u_,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!ue(a_,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new Sn;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof Os&&r.code!==lo.Redirect&&r.code!==lo.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof vl)this.navigated=!0;else if(r instanceof Op){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=he({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||see(o.source)},s);this.scheduleNavigation(a,Oh,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}mee(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Oh,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=he({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(c_),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=he(he({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let p=o?o.snapshot:this.routerState.snapshot.root;d=sF(p)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),d=this.currentUrlTree.root}return aF(d,e,u,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Cu(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,Oh,null,r)}navigate(e,r={skipLocationChange:!1}){return fee(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=he({},dee):r===!1?o=he({},pee):o=r,Cu(e))return j2(this.currentUrlTree,e,o);let i=this.parseUrl(e);return j2(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,p)=>{a=d,l=p});let u=this.pendingTasks.add();return uee(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function fee(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new Ee(4008,!1)}function mee(t){return!(t instanceof Vh)&&!(t instanceof Op)}var Bi=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Pn;constructor(e,r,o,i,s,a){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a;let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof vl&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Cu(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,r,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||r||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.href=e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;let r=this.href===null?null:YO(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(e,r){let o=this.renderer,i=this.el.nativeElement;r!==null?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return this.routerLinkInput===null?null:Cu(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(r){return new(r||t)(re(co),re(pi),_T("tabindex"),re(ci),re(Do),re(Tp))};static \u0275dir=Nt({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,o){r&1&&ye("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),r&2&&wp("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",xu],skipLocationChange:[2,"skipLocationChange","skipLocationChange",xu],replaceUrl:[2,"replaceUrl","replaceUrl",xu],routerLink:"routerLink"},features:[ZT,ai]})}return t})();var hee=new Re("");function SF(t,...n){return gp([{provide:u_,multi:!0,useValue:t},[],{provide:pi,useFactory:gee,deps:[co]},{provide:Cv,multi:!0,useFactory:yee},n.map(e=>e.\u0275providers)])}function gee(t){return t.routerState.root}function yee(){let t=ue(Wn);return n=>{let e=t.get(ws);if(n!==e.components[0])return;let r=t.get(co),o=t.get(xee);t.get(vee)===1&&r.initialNavigation(),t.get(bee,null,st.Optional)?.setUpPreloading(),t.get(hee,null,st.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var xee=new Re("",{factory:()=>new Pn}),vee=new Re("",{providedIn:"root",factory:()=>1});var bee=new Re("");var TF=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-OBK227YL.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)};var Kh=class extends Error{constructor(n,e="FunctionsError",r){super(n),this.name=e,this.context=r}},a0=class extends Kh{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}},l0=class extends Kh{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}},c0=class extends Kh{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}},p_=function(t){return t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2",t}(p_||{});var wee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Xh=class{constructor(n,{headers:e={},customFetch:r,region:o=p_.Any}={}){this.url=n,this.headers=e,this.region=o,this.fetch=TF(r)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,e={}){var r;return wee(this,void 0,void 0,function*(){try{let{headers:o,method:i,body:s}=e,a={},{region:l}=e;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;s&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=s):typeof s=="string"?(a["Content-Type"]="text/plain",c=s):typeof FormData<"u"&&s instanceof FormData?c=s:(a["Content-Type"]="application/json",c=JSON.stringify(s)));let u=yield this.fetch(`${this.url}/${n}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:c}).catch(m=>{throw new a0(m)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new l0(u);if(!u.ok)throw new c0(u);let p=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return p==="application/json"?f=yield u.json():p==="application/octet-stream"?f=yield u.blob():p==="text/event-stream"?f=u:p==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(o){return{data:null,error:o}}})}};var LF=qm($F(),1),{PostgrestClient:VF,PostgrestQueryBuilder:w_e,PostgrestFilterBuilder:C_e,PostgrestTransformBuilder:I_e,PostgrestBuilder:S_e,PostgrestError:Oee}=LF.default;var BF="2.11.2";var zF={"X-Client-Info":`realtime-js/${BF}`},UF="1.0.0",f0=1e4,jF=1e3,$p=function(t){return t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed",t}($p||{}),uo=function(t){return t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving",t}(uo||{}),Oo=function(t){return t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token",t}(Oo||{}),S_=function(t){return t.websocket="websocket",t}(S_||{}),Su=function(t){return t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed",t}(Su||{});var m0=class{constructor(){this.HEADER_LENGTH=1}decode(n,e){return n.constructor===ArrayBuffer?e(this._binaryDecode(n)):e(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){let e=new DataView(n),r=new TextDecoder;return this._decodeBroadcast(n,e,r)}_decodeBroadcast(n,e,r){let o=e.getUint8(1),i=e.getUint8(2),s=this.HEADER_LENGTH+2,a=r.decode(n.slice(s,s+o));s=s+o;let l=r.decode(n.slice(s,s+i));s=s+i;let c=JSON.parse(r.decode(n.slice(s,n.byteLength)));return{ref:null,topic:a,event:l,payload:c}}};var Lp=class{constructor(n,e){this.callback=n,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var on=function(t){return t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange",t}(on||{}),E_=(t,n,e={})=>{var r;let o=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(n).reduce((i,s)=>(i[s]=Mee(s,t,n,o),i),{})},Mee=(t,n,e,r)=>{let o=n.find(a=>a.name===t),i=o?.type,s=e[t];return i&&!r.includes(i)?GF(i,s):T_(s)},GF=(t,n)=>{if(t.charAt(0)==="_"){let e=t.slice(1,t.length);return Lee(n,e)}switch(t){case on.bool:return Fee(n);case on.float4:case on.float8:case on.int2:case on.int4:case on.int8:case on.numeric:case on.oid:return Pee(n);case on.json:case on.jsonb:return $ee(n);case on.timestamp:return Vee(n);case on.abstime:case on.date:case on.daterange:case on.int4range:case on.int8range:case on.money:case on.reltime:case on.text:case on.time:case on.timestamptz:case on.timetz:case on.tsrange:case on.tstzrange:return T_(n);default:return T_(n)}},T_=t=>t,Fee=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Pee=t=>{if(typeof t=="string"){let n=parseFloat(t);if(!Number.isNaN(n))return n}return t},$ee=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(n){return console.log(`JSON parse error: ${n}`),t}return t},Lee=(t,n)=>{if(typeof t!="string")return t;let e=t.length-1,r=t[e];if(t[0]==="{"&&r==="}"){let i,s=t.slice(1,e);try{i=JSON.parse("["+s+"]")}catch{i=s?s.split(","):[]}return i.map(a=>GF(n,a))}return t},Vee=t=>typeof t=="string"?t.replace(" ","T"):t,h0=t=>{let n=t;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};var Vp=class{constructor(n,e,r={},o=f0){this.channel=n,this.event=e,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,e){var r;return this._hasReceived(n)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:n,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let n=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:e}){this.recHooks.filter(r=>r.status===n).forEach(r=>r.callback(e))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}};var ng=class t{constructor(n,e){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,o,i,s),this.pendingDiffs.forEach(l=>{this.state=t.syncDiff(this.state,l,i,s)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t.syncDiff(this.state,o,i,s),a())}),this.onJoin((o,i,s)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:i,newPresences:s})}),this.onLeave((o,i,s)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:i,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,e,r,o){let i=this.cloneDeep(n),s=this.transformState(e),a={},l={};return this.map(i,(c,u)=>{s[c]||(l[c]=u)}),this.map(s,(c,u)=>{let d=i[c];if(d){let p=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),h=d.filter(g=>p.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),h.length>0&&(l[c]=h)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,o)}static syncDiff(n,e,r,o){let{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(i,(a,l)=>{var c;let u=(c=n[a])!==null&&c!==void 0?c:[];if(n[a]=this.cloneDeep(l),u.length>0){let d=n[a].map(f=>f.presence_ref),p=u.filter(f=>d.indexOf(f.presence_ref)<0);n[a].unshift(...p)}r(a,u,l)}),this.map(s,(a,l)=>{let c=n[a];if(!c)return;let u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),n[a]=c,o(a,c,l),c.length===0&&delete n[a]}),n}static map(n,e){return Object.getOwnPropertyNames(n).map(r=>e(r,n[r]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((e,r)=>{let o=n[r];return"metas"in o?e[r]=o.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=o,e},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var Fs=function(t){return t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR",t}(Fs||{});var rg=class t{constructor(n,e={config:{}},r){this.topic=n,this.params=e,this.socket=r,this.bindings={},this.state=uo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Vp(this,Oo.join,this.params,this.timeout),this.rejoinTimer=new Lp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=uo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=uo.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=uo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=uo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Oo.reply,{},(o,i)=>{this._trigger(this._replyEventName(i),o)}),this.presence=new ng(this),this.broadcastEndpointURL=h0(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(n,e=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:s,private:a}}=this.params;this._onError(u=>n?.(Fs.CHANNEL_ERROR,u)),this._onClose(()=>n?.(Fs.CLOSED));let l={},c={broadcast:i,presence:s,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){n?.(Fs.SUBSCRIBED);return}else{let p=this.bindings.postgres_changes,f=(d=p?.length)!==null&&d!==void 0?d:0,m=[];for(let h=0;h<f;h++){let g=p[h],{filter:{event:y,schema:x,table:w,filter:b}}=g,S=u&&u[h];if(S&&S.event===y&&S.schema===x&&S.table===w&&S.filter===b)m.push(Object.assign(Object.assign({},g),{id:S.id}));else{this.unsubscribe(),n?.(Fs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,n&&n(Fs.SUBSCRIBED);return}}).receive("error",u=>{n?.(Fs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{n?.(Fs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,e={}){return await this.send({type:"presence",event:"track",payload:n},e.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,e,r){return this._on(n,e,r)}async send(n,e={}){var r,o;if(!this._canPush()&&n.type==="broadcast"){let{event:i,payload:s}=n,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s,private:this.private}]})};try{let c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var s,a,l;let c=this._push(n.type,n,e.timeout||this.timeout);n.type==="broadcast"&&!(!((l=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=uo.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Oo.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let o=new Vp(this,Oo.leave,{},n);o.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}async _fetchWithTimeout(n,e,r){let o=new AbortController,i=setTimeout(()=>o.abort(),r),s=await this.socket.fetch(n,Object.assign(Object.assign({},e),{signal:o.signal}));return clearTimeout(i),s}_push(n,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Vp(this,n,e,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(n,e,r){return e}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,e,r){var o,i;let s=n.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Oo;if(r&&[a,l,c,u].indexOf(s)>=0&&r!==this._joinRef())return;let p=this._onMessage(s,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var m,h,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(h=f.filter)===null||h===void 0?void 0:h.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===s}).map(f=>f.callback(p,r)):(i=this.bindings[s])===null||i===void 0||i.filter(f=>{var m,h,g,y,x,w;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in f){let b=f.id,S=(m=f.filter)===null||m===void 0?void 0:m.event;return b&&((h=e.ids)===null||h===void 0?void 0:h.includes(b))&&(S==="*"||S?.toLocaleLowerCase()===((g=e.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let b=(x=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||x===void 0?void 0:x.toLocaleLowerCase();return b==="*"||b===((w=e?.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===s}).map(f=>{if(typeof p=="object"&&"ids"in p){let m=p.data,{schema:h,table:g,commit_timestamp:y,type:x,errors:w}=m;p=Object.assign(Object.assign({},{schema:h,table:g,commit_timestamp:y,eventType:x,new:{},old:{},errors:w}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===uo.closed}_isJoined(){return this.state===uo.joined}_isJoining(){return this.state===uo.joining}_isLeaving(){return this.state===uo.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,e,r){let o=n.toLocaleLowerCase(),i={type:o,filter:e,callback:r};return this.bindings[o]?this.bindings[o].push(i):this.bindings[o]=[i],this}_off(n,e){let r=n.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var i;return!(((i=o.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&t.isEqual(o.filter,e))}),this}static isEqual(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(let r in n)if(n[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Oo.close,{},n)}_onError(n){this._on(Oo.error,{},e=>n(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=uo.joining,this.joinPush.resend(n))}_getPayloadRecords(n){let e={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(e.new=E_(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(e.old=E_(n.columns,n.old_record)),e}};var zee=()=>{},Uee=typeof WebSocket<"u",jee=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,og=class{constructor(n,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=zF,this.params={},this.timeout=f0,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=zee,this.conn=null,this.sendBuffer=[],this.serializer=new m0,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...a)=>import("./chunk-OBK227YL.js").then(({default:l})=>l(...a)):s=fetch,(...a)=>s(...a)},this.endPoint=`${n}/${S_.websocket}`,this.httpEndpoint=h0(n),e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let o=(r=e?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e?.encode?e.encode:(i,s)=>s(JSON.stringify(i)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Lp(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch),e?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=e?.worker||!1,this.workerUrl=e?.workerUrl}this.accessToken=e?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Uee){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new __(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-KXFMP4GI.js").then(({default:n})=>{this.conn=new n(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:UF}))}disconnect(n,e){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){let e=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){let n=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),n}log(n,e,r){this.logger(n,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case $p.connecting:return Su.Connecting;case $p.open:return Su.Open;case $p.closing:return Su.Closing;default:return Su.Closed}}isConnected(){return this.connectionState()===Su.Open}channel(n,e={config:{}}){let r=new rg(`realtime:${n}`,e,this);return this.channels.push(r),r}push(n){let{topic:e,event:r,payload:o,ref:i}=n,s=()=>{this.encode(n,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${r} (${i})`,o),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(n=null){let e=n||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(o=>{e&&o.updateJoinPayload({access_token:e}),o.joinedOnce&&o._isJoined()&&o._push(Oo.access_token,{access_token:e})})}}async sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(jF,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let e=this.channels.find(r=>r.topic===n&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${n}"`),e.unsubscribe())}_remove(n){this.channels=this.channels.filter(e=>e._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_onConnMessage(n){this.decode(n.data,e=>{let{topic:r,event:o,payload:i,ref:s}=e;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${o} ${s&&"("+s+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,i,s)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(Oo.error))}_appendParams(n,e){if(Object.keys(e).length===0)return n;let r=n.match(/\?/)?"&":"?",o=new URLSearchParams(e);return`${n}${r}${o}`}_workerObjectUrl(n){let e;if(n)e=n;else{let r=new Blob([jee],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}};var __=class{constructor(n,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=$p.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=r.close}};var Bp=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function Nn(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var g0=class extends Bp{constructor(n,e){super(n),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},Tu=class extends Bp{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};var Gee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},x0=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-OBK227YL.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},WF=()=>Gee(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-OBK227YL.js")).Response:Response}),y0=t=>{if(Array.isArray(t))return t.map(e=>y0(e));if(typeof t=="function"||t!==Object(t))return t;let n={};return Object.entries(t).forEach(([e,r])=>{let o=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));n[o]=y0(r)}),n};var Eu=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},D_=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Wee=(t,n,e)=>Eu(void 0,void 0,void 0,function*(){let r=yield WF();t instanceof r&&!e?.noResolveJson?t.json().then(o=>{n(new g0(D_(o),t.status||500))}).catch(o=>{n(new Tu(D_(o),o))}):n(new Tu(D_(t),t))}),Hee=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},n?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),e))};function ig(t,n,e,r,o,i){return Eu(this,void 0,void 0,function*(){return new Promise((s,a)=>{t(e,Hee(n,r,o,i)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>Wee(l,a,r))})})}function zp(t,n,e,r){return Eu(this,void 0,void 0,function*(){return ig(t,"GET",n,e,r)})}function zi(t,n,e,r,o){return Eu(this,void 0,void 0,function*(){return ig(t,"POST",n,r,o,e)})}function HF(t,n,e,r,o){return Eu(this,void 0,void 0,function*(){return ig(t,"PUT",n,r,o,e)})}function qF(t,n,e,r){return Eu(this,void 0,void 0,function*(){return ig(t,"HEAD",n,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function v0(t,n,e,r,o){return Eu(this,void 0,void 0,function*(){return ig(t,"DELETE",n,r,o,e)})}var Hr=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},qee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},KF={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},b0=class{constructor(n,e={},r,o){this.url=n,this.headers=e,this.bucketId=r,this.fetch=x0(o)}uploadOrUpdate(n,e,r,o){return Hr(this,void 0,void 0,function*(){try{let i,s=Object.assign(Object.assign({},KF),o),a=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(s.upsert)}),l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let c=this._removeEmptyFolders(e),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:n,body:i,headers:a},s?.duplex?{duplex:s.duplex}:{})),p=yield d.json();return d.ok?{data:{path:c,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(Nn(i))return{data:null,error:i};throw i}})}upload(n,e,r){return Hr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,e,r)})}uploadToSignedUrl(n,e,r,o){return Hr(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(n),s=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let l,c=Object.assign({upsert:KF.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(l){if(Nn(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(n,e){return Hr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(n),o=Object.assign({},this.headers);e?.upsert&&(o["x-upsert"]="true");let i=yield zi(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),s=new URL(this.url+i.url),a=s.searchParams.get("token");if(!a)throw new Bp("No token returned by API");return{data:{signedUrl:s.toString(),path:n,token:a},error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}update(n,e,r){return Hr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,e,r)})}move(n,e,r){return Hr(this,void 0,void 0,function*(){try{return{data:yield zi(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}copy(n,e,r){return Hr(this,void 0,void 0,function*(){try{return{data:{path:(yield zi(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}createSignedUrl(n,e,r){return Hr(this,void 0,void 0,function*(){try{let o=this._getFinalPath(n),i=yield zi(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}createSignedUrls(n,e,r){return Hr(this,void 0,void 0,function*(){try{let o=yield zi(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:n},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${i}`):null})),error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}download(n,e){return Hr(this,void 0,void 0,function*(){let o=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),s=i?`?${i}`:"";try{let a=this._getFinalPath(n);return{data:yield(yield zp(this.fetch,`${this.url}/${o}/${a}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Nn(a))return{data:null,error:a};throw a}})}info(n){return Hr(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{let r=yield zp(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:y0(r),error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}exists(n){return Hr(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{return yield qF(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Nn(r)&&r instanceof Tu){let o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(n,e){let r=this._getFinalPath(n),o=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&o.push(i);let a=typeof e?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(e?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(n){return Hr(this,void 0,void 0,function*(){try{return{data:yield v0(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}list(n,e,r){return Hr(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},qee),e),{prefix:n||""});return{data:yield zi(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){let e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};var XF="2.7.1";var YF={"X-Client-Info":`storage-js/${XF}`};var Up=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},w0=class{constructor(n,e={},r){this.url=n,this.headers=Object.assign(Object.assign({},YF),e),this.fetch=x0(r)}listBuckets(){return Up(this,void 0,void 0,function*(){try{return{data:yield zp(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(Nn(n))return{data:null,error:n};throw n}})}getBucket(n){return Up(this,void 0,void 0,function*(){try{return{data:yield zp(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}createBucket(n,e={public:!1}){return Up(this,void 0,void 0,function*(){try{return{data:yield zi(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}updateBucket(n,e){return Up(this,void 0,void 0,function*(){try{return{data:yield HF(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}emptyBucket(n){return Up(this,void 0,void 0,function*(){try{return{data:yield zi(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}deleteBucket(n){return Up(this,void 0,void 0,function*(){try{return{data:yield v0(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}};var sg=class extends w0{constructor(n,e={},r){super(n,e,r)}from(n){return new b0(this.url,this.headers,n,this.fetch)}};var ZF="2.48.1";var ag="";typeof Deno<"u"?ag="deno":typeof document<"u"?ag="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ag="react-native":ag="node";var Kee={"X-Client-Info":`supabase-js-${ag}/${ZF}`},QF={headers:Kee},JF={schema:"public"},eP={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tP={};tA();var Xee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Yee=t=>{let n;return t?n=t:typeof fetch>"u"?n=Jk:n=fetch,(...e)=>n(...e)},Zee=()=>typeof Headers>"u"?eA:Headers,nP=(t,n,e)=>{let r=Yee(e),o=Zee();return(i,s)=>Xee(void 0,void 0,void 0,function*(){var a;let l=(a=yield n())!==null&&a!==void 0?a:t,c=new o(s?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},s),{headers:c}))})};var Qee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})};function rP(t){return t.replace(/\/$/,"")}function oP(t,n){let{db:e,auth:r,realtime:o,global:i}=t,{db:s,auth:a,realtime:l,global:c}=n,u={db:Object.assign(Object.assign({},s),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),o),global:Object.assign(Object.assign({},c),i),accessToken:()=>Qee(this,void 0,void 0,function*(){return""})};return t.accessToken?u.accessToken=t.accessToken:delete u.accessToken,u}var C0="2.67.3";var iP="http://localhost:9999",sP="supabase.auth.token";var aP={"X-Client-Info":`gotrue-js/${C0}`},N_=10;var lg="X-Supabase-Api-Version",k_={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function lP(t){return Math.round(Date.now()/1e3)+t}function cP(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=Math.random()*16|0;return(t=="x"?n:n&3|8).toString(16)})}var fi=()=>typeof window<"u"&&typeof document<"u",_u={tested:!1,writable:!1},wl=()=>{if(!fi())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(_u.tested)return _u.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),_u.tested=!0,_u.writable=!0}catch{_u.tested=!0,_u.writable=!1}return _u.writable};function uP(t){let n={},e=new URL(t);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((o,i)=>{n[i]=o})}catch{}return e.searchParams.forEach((r,o)=>{n[o]=r}),n}var I0=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-OBK227YL.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},dP=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",A_=async(t,n,e)=>{await t.setItem(n,JSON.stringify(e))},ug=async(t,n)=>{let e=await t.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch{return e}},dg=async(t,n)=>{await t.removeItem(n)};function Jee(t){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,o,i,s,a,l,c,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)s=n.indexOf(t.charAt(u++)),a=n.indexOf(t.charAt(u++)),l=n.indexOf(t.charAt(u++)),c=n.indexOf(t.charAt(u++)),r=s<<2|a>>4,o=(a&15)<<4|l>>2,i=(l&3)<<6|c,e=e+String.fromCharCode(r),l!=64&&o!=0&&(e=e+String.fromCharCode(o)),c!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}var cg=class t{constructor(){this.promise=new t.promiseConstructor((n,e)=>{this.resolve=n,this.reject=e})}};cg.promiseConstructor=Promise;function R_(t){let n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=t.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(Jee(r))}async function pP(t){return await new Promise(n=>{setTimeout(()=>n(null),t)})}function fP(t,n){return new Promise((r,o)=>{(async()=>{for(let i=0;i<1/0;i++)try{let s=await t(i);if(!n(i,null,s)){r(s);return}}catch(s){if(!n(i,s)){o(s);return}}})()})}function ete(t){return("0"+t.toString(16)).substr(-2)}function tte(){let n=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,o="";for(let i=0;i<56;i++)o+=e.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(n),Array.from(n,ete).join("")}async function nte(t){let e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",e),o=new Uint8Array(r);return Array.from(o).map(i=>String.fromCharCode(i)).join("")}function rte(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ote(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let e=await nte(t);return rte(e)}async function Du(t,n,e=!1){let r=tte(),o=r;e&&(o+="/PASSWORD_RECOVERY"),await A_(t,`${n}-code-verifier`,o);let i=await ote(r);return[i,r===i?"plain":"s256"]}var ite=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function mP(t){let n=t.headers.get(lg);if(!n||!n.match(ite))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}var pg=class extends Error{constructor(n,e,r){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}};function Qe(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var S0=class extends pg{constructor(n,e,r){super(n,e,r),this.name="AuthApiError",this.status=e,this.code=r}};function hP(t){return Qe(t)&&t.name==="AuthApiError"}var jp=class extends pg{constructor(n,e){super(n),this.name="AuthUnknownError",this.originalError=e}},Ps=class extends pg{constructor(n,e,r,o){super(n,r,o),this.name=e,this.status=r}},Mo=class extends Ps{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function gP(t){return Qe(t)&&t.name==="AuthSessionMissingError"}var Gp=class extends Ps{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Nu=class extends Ps{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}},ku=class extends Ps{constructor(n,e=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function yP(t){return Qe(t)&&t.name==="AuthImplicitGrantRedirectError"}var fg=class extends Ps{constructor(n,e=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Wp=class extends Ps{constructor(n,e){super(n,"AuthRetryableFetchError",e,void 0)}};function T0(t){return Qe(t)&&t.name==="AuthRetryableFetchError"}var mg=class extends Ps{constructor(n,e,r){super(n,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}};var ste=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},Au=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),ate=[502,503,504];async function xP(t){var n;if(!dP(t))throw new Wp(Au(t),0);if(ate.includes(t.status))throw new Wp(Au(t),t.status);let e;try{e=await t.json()}catch(i){throw new jp(Au(i),i)}let r,o=mP(t);if(o&&o.getTime()>=k_["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new mg(Au(e),t.status,((n=e.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(r==="session_not_found")throw new Mo}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,s)=>i&&typeof s=="string",!0))throw new mg(Au(e),t.status,e.weak_password.reasons);throw new S0(Au(e),t.status||500,r)}var lte=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),e))};async function dt(t,n,e,r){var o;let i=Object.assign({},r?.headers);i[lg]||(i[lg]=k_["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let s=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(s.redirect_to=r.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await cte(t,n,e+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function cte(t,n,e,r,o,i){let s=lte(n,r,o,i),a;try{a=await t(e,Object.assign({},s))}catch(l){throw console.error(l),new Wp(Au(l),0)}if(a.ok||await xP(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await xP(l)}}function $s(t){var n;let e=null;ute(t)&&(e=Object.assign({},t),t.expires_at||(e.expires_at=lP(t.expires_in)));let r=(n=t.user)!==null&&n!==void 0?n:t;return{data:{session:e,user:r},error:null}}function O_(t){let n=$s(t);return!n.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(n.data.weak_password=t.weak_password),n}function Ui(t){var n;return{data:{user:(n=t.user)!==null&&n!==void 0?n:t},error:null}}function vP(t){return{data:t,error:null}}function bP(t){let{action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i}=t,s=ste(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i},l=Object.assign({},s);return{data:{properties:a,user:l},error:null}}function wP(t){return t}function ute(t){return t.access_token&&t.refresh_token&&t.expires_in}var dte=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},Hp=class{constructor({url:n="",headers:e={},fetch:r}){this.url=n,this.headers=e,this.fetch=I0(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,e="global"){try{return await dt(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Qe(r))return{data:null,error:r};throw r}}async inviteUserByEmail(n,e={}){try{return await dt(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Ui})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async generateLink(n){try{let{options:e}=n,r=dte(n,["options"]),o=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await dt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:bP,redirectTo:e?.redirectTo})}catch(e){if(Qe(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(n){try{return await dt(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:Ui})}catch(e){if(Qe(e))return{data:{user:null},error:e};throw e}}async listUsers(n){var e,r,o,i,s,a,l;try{let c={nextPage:null,lastPage:0,total:0},u=await dt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=n?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=n?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:wP});if(u.error)throw u.error;let d=await u.json(),p=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{let h=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=h}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Qe(c))return{data:{users:[]},error:c};throw c}}async getUserById(n){try{return await dt(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:Ui})}catch(e){if(Qe(e))return{data:{user:null},error:e};throw e}}async updateUserById(n,e){try{return await dt(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:e,headers:this.headers,xform:Ui})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async deleteUser(n,e=!1){try{return await dt(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:e},xform:Ui})}catch(r){if(Qe(r))return{data:{user:null},error:r};throw r}}async _listFactors(n){try{let{data:e,error:r}=await dt(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:e,error:r}}catch(e){if(Qe(e))return{data:null,error:e};throw e}}async _deleteFactor(n){try{return{data:await dt(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(e){if(Qe(e))return{data:null,error:e};throw e}}};var CP={getItem:t=>wl()?globalThis.localStorage.getItem(t):null,setItem:(t,n)=>{wl()&&globalThis.localStorage.setItem(t,n)},removeItem:t=>{wl()&&globalThis.localStorage.removeItem(t)}};function M_(t={}){return{getItem:n=>t[n]||null,setItem:(n,e)=>{t[n]=e},removeItem:n=>{delete t[n]}}}function IP(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var Ru={debug:!!(globalThis&&wl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},hg=class extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}},E0=class extends hg{};async function F_(t,n,e){Ru.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,n);let r=new globalThis.AbortController;return n>0&&setTimeout(()=>{r.abort(),Ru.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Ru.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await e()}finally{Ru.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(n===0)throw Ru.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new E0(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Ru.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}IP();var pte={url:iP,storageKey:sP,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:aP,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},gg=30*1e3,SP=3;async function TP(t,n,e){return await e()}var P_=(()=>{class t{constructor(e){var r,o;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&fi()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},pte),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Hp({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=I0(i.fetch),this.lock=i.lock||TP,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:fi()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=F_:this.lock=TP,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:wl()?this.storage=CP:(this.memoryStorage={},this.storage=M_(this.memoryStorage)):(this.memoryStorage={},this.storage=M_(this.memoryStorage)),fi()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${C0}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r=uP(window.location.href),o="none";if(this._isImplicitGrantCallback(r)?o="implicit":await this._isPKCECallback(r)&&(o="pkce"),fi()&&this.detectSessionInUrl&&o!=="none"){let{data:i,error:s}=await this._getSessionFromURL(r,o);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),yP(s)){let c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Qe(r)?{error:r}:{error:new jp("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,o,i;try{let s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:$s}),{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(Qe(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,o,i;try{let s;if("email"in e){let{email:d,password:p,options:f}=e,m=null,h=null;this.flowType==="pkce"&&([m,h]=await Du(this.storage,this.storageKey)),s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:h},xform:$s})}else if("phone"in e){let{phone:d,password:p,options:f}=e;s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(o=f?.data)!==null&&o!==void 0?o:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:$s})}else throw new Nu("You must provide either an email or phone number and a password");let{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(Qe(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){let{email:s,password:a,options:l}=e;r=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:O_})}else if("phone"in e){let{phone:s,password:a,options:l}=e;r=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:O_})}else throw new Nu("You must provide either an email or phone number and a password");let{data:o,error:i}=r;return i?{data:{user:null,session:null},error:i}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new Gp}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:i})}catch(r){if(Qe(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,o,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let r=await ug(this.storage,`${this.storageKey}-code-verifier`),[o,i]=(r??"").split("/");try{let{data:s,error:a}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:o},xform:$s});if(await dg(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Gp}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:a})}catch(s){if(Qe(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:r,provider:o,token:i,access_token:s,nonce:a}=e,l=await dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:$s}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Gp}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(r){if(Qe(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,o,i,s,a;try{if("email"in e){let{email:l,options:c}=e,u=null,d=null;this.flowType==="pkce"&&([u,d]=await Du(this.storage,this.storageKey));let{error:p}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:l,options:c}=e,{data:u,error:d}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Nu("You must provide either an email or phone number.")}catch(l){if(Qe(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,o;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(o=e.options)===null||o===void 0?void 0:o.captchaToken);let{data:a,error:l}=await dt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:$s});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");let c=a.session,u=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(Qe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var r,o,i;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await Du(this.storage,this.storageKey)),await dt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&o!==void 0?o:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:vP})}catch(s){if(Qe(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:r},error:o}=e;if(o)throw o;if(!r)throw new Mo;let{error:i}=await dt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Qe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let r=`${this.url}/resend`;if("email"in e){let{email:o,type:i,options:s}=e,{error:a}=await dt(this.fetch,"POST",r,{headers:this.headers,body:{email:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:o,type:i,options:s}=e,{data:a,error:l}=await dt(this.fetch,"POST",r,{headers:this.headers,body:{phone:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:l}}throw new Nu("You must provide either an email or phone number and a type")}catch(r){if(Qe(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await o,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let o=r();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=await ug(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let o=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",e.expires_at),!o){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Ui}):await this._useSession(async r=>{var o,i,s;let{data:a,error:l}=r;if(l)throw l;return!(!((o=a.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Mo}:await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:Ui})})}catch(r){if(Qe(r))return gP(r)&&(await this._removeSession(),await dg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async o=>{let{data:i,error:s}=o;if(s)throw s;if(!i.session)throw new Mo;let a=i.session,l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await Du(this.storage,this.storageKey));let{data:u,error:d}=await dt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:Ui});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(o){if(Qe(o))return{data:{user:null},error:o};throw o}}_decodeJWT(e){return R_(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Mo;let r=Date.now()/1e3,o=r,i=!0,s=null,a=R_(e.access_token);if(a.exp&&(o=a.exp,i=o<=r),i){let{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};s=l}else{let{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:o-r,expires_at:o},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(Qe(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var o;if(!e){let{data:a,error:l}=r;if(l)throw l;e=(o=a.session)!==null&&o!==void 0?o:void 0}if(!e?.refresh_token)throw new Mo;let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Qe(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!fi())throw new ku("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ku(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new fg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ku("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new fg("No code detected.");let{data:w,error:b}=await this._exchangeCodeForSession(e.code);if(b)throw b;let S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:w.session,redirectType:null},error:null}}let{provider_token:o,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!a||!u)throw new ku("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(l),f=d+p;c&&(f=parseInt(c));let m=f-d;m*1e3<=gg&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${p}s`);let h=f-p;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,f,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,f,d);let{data:g,error:y}=await this._getUser(s);if(y)throw y;let x={provider_token:o,provider_refresh_token:i,access_token:s,expires_in:p,expires_at:f,refresh_token:a,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:x,redirectType:e.type},error:null}}catch(o){if(Qe(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let r=await ug(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{error:s};let a=(o=i.session)===null||o===void 0?void 0:o.access_token;if(a){let{error:l}=await this.admin.signOut(a,e);if(l&&!(hP(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await dg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let r=cP(),o={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,o),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:o}}}async _emitInitialSession(e){return await this._useSession(async r=>{var o,i;try{let{data:{session:s},error:a}=r;if(a)throw a;await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let o=null,i=null;this.flowType==="pkce"&&([o,i]=await Du(this.storage,this.storageKey,!0));try{return await dt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(Qe(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:r,error:o}=await this.getUser();if(o)throw o;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(Qe(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{let{data:o,error:i}=await this._useSession(async s=>{var a,l,c,u,d;let{data:p,error:f}=s;if(f)throw f;let m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await dt(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=p.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return fi()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:e.provider,url:o?.url},error:null}}catch(o){if(Qe(o))return{data:{provider:e.provider,url:null},error:o};throw o}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)throw a;return await dt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(o=s.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(Qe(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let o=Date.now();return await fP(async i=>(i>0&&await pP(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await dt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:$s})),(i,s)=>{let a=200*Math.pow(2,i);return s&&T0(s)&&Date.now()+a-o<gg})}catch(o){if(this._debug(r,"error",o),Qe(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){let o=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",o),fi()&&!r.skipBrowserRedirect&&window.location.assign(o),{data:{provider:e,url:o},error:null}}async _recoverAndRefresh(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=await ug(this.storage,this.storageKey);if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}let i=Math.round(Date.now()/1e3),s=((e=o.expires_at)!==null&&e!==void 0?e:1/0)<i+N_;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${N_}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=await this._callRefreshToken(o.refresh_token);a&&(console.error(a),T0(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,o;if(!e)throw new Mo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new cg;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Mo;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),Qe(s)){let a={session:null,error:s};return T0(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,o=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:e,session:r});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){s.push(c)}});if(await Promise.all(a),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await A_(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await dg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&fi()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),gg);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async r=>{let{data:{session:o}}=r;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((o.expires_at*1e3-e)/gg);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${gg}ms, refresh threshold is ${SP} ticks`),i<=SP&&await this._callRefreshToken(o.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof hg)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!fi()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,o){let i=[`provider=${encodeURIComponent(r)}`];if(o?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&i.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){let[s,a]=await Du(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(l.toString())}if(o?.queryParams){let s=new URLSearchParams(o.queryParams);i.push(s.toString())}return o?.skipBrowserRedirect&&i.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await dt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Qe(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)return{data:null,error:a};let l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await dt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(Qe(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{data:null,error:s};let{data:a,error:l}=await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(r){if(Qe(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Qe(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){let{data:r,error:o}=await this._challenge({factorId:e.factorId});return o?{data:null,error:o}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){let{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};let o=e?.factors||[],i=o.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=o.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:o,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,o;let{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),l=null;a.aal&&(l=a.aal);let c=l;((o=(r=i.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(c="aal2");let d=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}}return t.nextInstanceID=0,t})();var fte=P_,$_=fte;var _0=class extends $_{constructor(n){super(n)}};var mte=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},D0=class{constructor(n,e,r){var o,i,s;if(this.supabaseUrl=n,this.supabaseKey=e,!n)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let a=rP(n);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:JF,realtime:tP,auth:Object.assign(Object.assign({},eP),{storageKey:l}),global:QF},u=oP(r??{},c);this.storageKey=(o=u.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=u.auth)!==null&&s!==void 0?s:{},this.headers,u.global.fetch),this.fetch=nP(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new VF(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Xh(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new sg(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},r={}){return this.rest.rpc(n,e,r)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,e;return mte(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,storageKey:i,flowType:s,lock:a,debug:l},c,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _0({url:this.authUrl,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,flowType:s,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new og(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(n,e,r){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var EP=(t,n,e)=>new D0(t,n,e);var N0={API_URL:"https://jsgltiaidlacvchyjjha.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzZ2x0aWFpZGxhY3ZjaHlqamhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2NjIzNDIsImV4cCI6MjA1NTIzODM0Mn0.bPtRMhXapLzUgPEIf6GoW9r52umh0F1YZhG1bfLyb0s",supabase_LocalStorage_key:"sb-jsgltiaidlacvchyjjha-auth-token"};var Ut=class t{constructor(n){this.platformId=n;this.supabase=EP(N0.API_URL,N0.anon_key,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),this.initializeAuthState()}supabase;user=io(null);currentUsername=io(null);loginStatus=io(null);ngOnInit(){this.initializeAuthState()}initializeAuthState(){if(!Gr(this.platformId))return;let n=this.getStoredSession();n&&this.updateSession(n),this.refreshSessionFromApi(),this.supabase.auth.onAuthStateChange((e,r)=>{this.updateSession(r)})}getStoredSession(){try{let n=localStorage.getItem(N0.supabase_LocalStorage_key);if(!n)return null;let e=JSON.parse(n);if(!e||!e.expires_at)return null;let r=e.expires_at*1e3;return Date.now()>=r?null:e}catch(n){return console.error("Error parsing stored session",n),null}}async refreshSessionFromApi(){try{let{data:n,error:e}=await this.supabase.auth.getSession();if(e)throw e;this.updateSession(n.session)}catch(n){console.error("Failed to refresh session:",n),this.updateSession(null)}}updateSession(n){if(n){this.user.set(n.user);let e=n.user?.identities?.[0]?.identity_data?.firstname||null;this.currentUsername.set(e),this.loginStatus.set(!0)}else this.user.set(null),this.currentUsername.set(null),this.loginStatus.set(!1)}initializeApp(){return new Promise(n=>{if(!Gr(this.platformId))return this.loginStatus.set(!1),n(!1);let e=this.getStoredSession();e&&this.updateSession(e),this.supabase.auth.getSession().then(({data:r,error:o})=>{o?(console.error("Failed to get session:",o),this.updateSession(null)):this.updateSession(r.session),this.supabase.auth.onAuthStateChange((i,s)=>{this.updateSession(s)}),n(!0)})})}async signIn(n,e){try{let{error:r}=await this.supabase.auth.signInWithPassword({email:n,password:e});if(r)throw r;return{success:!0}}catch(r){return console.error("Sign in error:",r),{success:!1,error:r}}}async signOut(){try{let{error:n}=await this.supabase.auth.signOut();if(n)throw n;return this.clearStorages(),this.updateSession(null),{success:!0}}catch(n){return console.error("Sign out error:",n),{success:!1,error:n}}}async signUp(n,e,r,o){let{error:i}=await this.supabase.auth.signUp({email:n,password:e,options:{data:{firstname:r,lastname:o}}});if(i)throw i}clearStorages(){Gr(this.platformId)&&(localStorage.clear(),sessionStorage.clear())}async addTradeLog(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");n.userid=r.id;let{data:o,error:i}=await this.supabase.from(e).insert([n]);if(i)throw console.error("Error inserting trade log: ",i),i;return Gr(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async getTradeLogs(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=!1,o=null;if(Gr(this.platformId)){r=sessionStorage.getItem(`${n}_refresh`)==="yes";let a=sessionStorage.getItem(n);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade logs:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(n).select("*").eq("userid",e.id);if(s)throw console.error("Error fetching trade logs:",s),s;return Gr(this.platformId)&&(sessionStorage.setItem(n,JSON.stringify(i)),sessionStorage.removeItem(`${n}_refresh`)),i}async updateTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(i)throw console.error("Error updating trade log: ",i),i;return Gr(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async deleteTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).delete().eq("tradeid",n);if(i)throw console.error("Error deleting trade log: ",i),i;return Gr(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async loadQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminLoadQuestions(){let{data:n,error:e}=await this.supabase.from("adminquestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminSaveQuestions(n){let e=null;for(let r of n.filter(o=>o.isModified))if(r.question_id){let{data:o,error:i}=await this.supabase.from("adminquestions").update({question_text:r.question_text,active:r.active}).eq("question_id",r.question_id).select().single();if(i){console.error("Error updating question:",i),e=i;break}else r.updated_at=o.updated_at,r.isModified=!1}else{let{data:o,error:i}=await this.supabase.from("adminquestions").insert([{question_text:r.question_text,active:r.active}]).select().single();if(i){console.error("Error inserting question:",i),e=i;break}else r.question_id=o.question_id,r.created_at=o.created_at,r.updated_at=o.updated_at,r.isModified=!1}return{error:e}}async deleteQuestion(n){let{error:e}=await this.supabase.from("adminquestions").delete().eq("question_id",n.question_id);return{error:e}}async getActiveQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");return{data:n,error:e}}async submitUserAnswers(n){let{error:e}=await this.supabase.from("answers").insert(n);return{error:e}}supaScream(){return"SupaScream"}static \u0275fac=function(e){return new(e||t)($e(No))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})};function hte(t,n){if(t&1&&(I(0,"div",8)(1,"div",9)(2,"div",10)(3,"h5",11),T(4),C(),I(5,"p",13),T(6),C(),I(7,"a",14),T(8),C()()()()),t&2){let e=n.$implicit;B(4),dn(e.title),B(2),dn(e.description),B(),X("routerLink",e.link),B(),dn(e.buttonText)}}var k0=class t{constructor(n){this.supabaseService=n;this.userFirstName=this.supabaseService.currentUsername()}userFirstName;steps=[{title:"Step 1: Daily Emotional Check-in",description:"Understand your emotional state before making trading decisions.",buttonText:"Begin Emotional Check-in",link:"/emotions"},{title:"Step 2: Pre-Trade Log",description:"Document your trading plan before executing any trades.",buttonText:"Create Pre-Trade Log",link:"/pretradelog"},{title:"Step 3: Post-Trade Log",description:"Record results and analyze your trading performance.",buttonText:"Complete Post-Trade Log",link:"/posttradelog"},{title:"Step 4: Reflection & Meditation",description:"Clear your mind with mindfulness practices.",buttonText:"Start Reflection",link:"/reflection"}];static \u0275fac=function(e){return new(e||t)(re(Ut))};static \u0275cmp=Mt({type:t,selectors:[["app-landing-page"]],decls:24,vars:1,consts:[[1,"container","mt-4"],[1,"text-center","mb-4"],[1,"text-center"],[1,"container","text-center","mt-5"],[1,"row"],["class","col-12",4,"ngFor","ngForOf"],[1,"container","text-center"],[1,"mb-4"],[1,"col-12"],[1,"card","h-100"],[1,"card-body"],[1,"card-title"],["routerLink","/meditation",1,"btn","btn-secondary","btn-tr"],[1,"card-text"],[1,"btn","btn-primary","btn-tr",3,"routerLink"]],template:function(e,r){e&1&&(I(0,"div",0)(1,"h2",1),T(2,"Begin Your Trading Transformation"),C(),I(3,"h3",1),T(4,"Your Daily Trading Routine"),C(),I(5,"p",2),T(6," Welcome to your personalized trading journey. Each day follows a structured approach designed to build discipline and improve your trading performance. "),C(),I(7,"div",3)(8,"div",4),ce(9,hte,9,4,"div",5),C()(),q(10,"hr"),I(11,"div",6)(12,"h2",7),T(13,"Additional Resources"),C(),I(14,"div",4)(15,"div",8)(16,"div",9)(17,"div",10)(18,"h5",11),T(19,"Meditation Hub"),C(),I(20,"p"),T(21,"Clear your mind and reduce emotional reactivity with guided meditations."),C(),I(22,"a",12),T(23,"Visit Meditation Hub"),C()()()()()()()),e&2&&(B(9),X("ngForOf",r.steps))},dependencies:[Bi,rn,jr],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:8px}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.75rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-custom[_ngcontent-%COMP%]{border-radius:20px;font-weight:600}@media (max-width: 576px){.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.btn-custom[_ngcontent-%COMP%]{padding:.5rem 1rem}}"]})};var Dr=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return new Promise(o=>{rr(this.injector,()=>{vh(()=>{this.supabaseService.loginStatus()&&o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()||o(this.router.createUrlTree([""],{queryParams:{returnUrl:e.url}}))},100)})}static \u0275fac=function(e){return new(e||t)($e(Ut),$e(co),$e(Wn))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})};var A0=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return r?!1:r?new Promise(o=>{rr(this.injector,()=>{vh(()=>{this.supabaseService.loginStatus()||o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()&&o(this.router.createUrlTree(["/home"]))},100)}):!0}static \u0275fac=function(e){return new(e||t)($e(Ut),$e(co),$e(Wn))};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})};var PP=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||t)(re(ci),re(Do))};static \u0275dir=Nt({type:t})}return t})(),Zp=(()=>{class t extends PP{static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,features:[_n]})}return t})(),Tl=new Re(""),gte={provide:Tl,useExisting:nr(()=>Ig),multi:!0},Ig=(()=>{class t extends Zp{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){r&1&&ye("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Er([gte]),_n]})}return t})(),yte={provide:Tl,useExisting:nr(()=>pr),multi:!0};function xte(){let t=As()?As().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var vte=new Re(""),pr=(()=>{class t extends PP{_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!xte())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||t)(re(ci),re(Do),re(vte,8))};static \u0275dir=Nt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&ye("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[Er([yte]),_n]})}return t})();function Cl(t){return t==null||(typeof t=="string"||Array.isArray(t))&&t.length===0}function $P(t){return t!=null&&typeof t.length=="number"}var El=new Re(""),Qp=new Re(""),bte=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ce=class{static min(n){return LP(n)}static max(n){return VP(n)}static required(n){return wte(n)}static requiredTrue(n){return Cte(n)}static email(n){return Ite(n)}static minLength(n){return Ste(n)}static maxLength(n){return Tte(n)}static pattern(n){return Ete(n)}static nullValidator(n){return O0(n)}static compose(n){return WP(n)}static composeAsync(n){return HP(n)}};function LP(t){return n=>{if(Cl(n.value)||Cl(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function VP(t){return n=>{if(Cl(n.value)||Cl(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}function wte(t){return Cl(t.value)?{required:!0}:null}function Cte(t){return t.value===!0?null:{required:!0}}function Ite(t){return Cl(t.value)||bte.test(t.value)?null:{email:!0}}function Ste(t){return n=>Cl(n.value)||!$P(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}function Tte(t){return n=>$P(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}function Ete(t){if(!t)return O0;let n,e;return typeof t=="string"?(e="",t.charAt(0)!=="^"&&(e+="^"),e+=t,t.charAt(t.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),r=>{if(Cl(r.value))return null;let o=r.value;return n.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}function O0(t){return null}function BP(t){return t!=null}function zP(t){return mu(t)?fn(t):t}function UP(t){let n={};return t.forEach(e=>{n=e!=null?he(he({},n),e):n}),Object.keys(n).length===0?null:n}function jP(t,n){return n.map(e=>e(t))}function _te(t){return!t.validate}function GP(t){return t.map(n=>_te(n)?n:e=>n.validate(e))}function WP(t){if(!t)return null;let n=t.filter(BP);return n.length==0?null:function(e){return UP(jP(e,n))}}function j_(t){return t!=null?WP(GP(t)):null}function HP(t){if(!t)return null;let n=t.filter(BP);return n.length==0?null:function(e){let r=jP(e,n).map(zP);return uS(r).pipe(tt(UP))}}function G_(t){return t!=null?HP(GP(t)):null}function _P(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function qP(t){return t._rawValidators}function KP(t){return t._rawAsyncValidators}function L_(t){return t?Array.isArray(t)?t:[t]:[]}function M0(t,n){return Array.isArray(t)?t.includes(n):t===n}function DP(t,n){let e=L_(n);return L_(t).forEach(o=>{M0(e,o)||e.push(o)}),e}function NP(t,n){return L_(n).filter(e=>!M0(t,e))}var F0=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=j_(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=G_(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},Nr=class extends F0{name;get formDirective(){return null}get path(){return null}},Il=class extends F0{_parent=null;name=null;valueAccessor=null},P0=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Dte={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},yNe=ot(he({},Dte),{"[class.ng-submitted]":"isSubmitted"}),qr=(()=>{class t extends P0{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(re(Il,2))};static \u0275dir=Nt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&Pi("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[_n]})}return t})(),ji=(()=>{class t extends P0{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(re(Nr,10))};static \u0275dir=Nt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){r&2&&Pi("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[_n]})}return t})();var yg="VALID",R0="INVALID",qp="PENDING",xg="DISABLED",Sl=class{},$0=class extends Sl{value;source;constructor(n,e){super(),this.value=n,this.source=e}},bg=class extends Sl{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},wg=class extends Sl{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},Kp=class extends Sl{status;source;constructor(n,e){super(),this.status=n,this.source=e}},V_=class extends Sl{source;constructor(n){super(),this.source=n}},B_=class extends Sl{source;constructor(n){super(),this.source=n}};function W_(t){return(z0(t)?t.validators:t)||null}function Nte(t){return Array.isArray(t)?j_(t):t||null}function H_(t,n){return(z0(n)?n.asyncValidators:t)||null}function kte(t){return Array.isArray(t)?G_(t):t||null}function z0(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function XP(t,n,e){let r=t.controls;if(!(n?Object.keys(r):r).length)throw new Ee(1e3,"");if(!r[e])throw new Ee(1001,"")}function YP(t,n,e){t._forEachChild((r,o)=>{if(e[o]===void 0)throw new Ee(1002,"")})}var Xp=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return $i(this.statusReactive)}set status(n){$i(()=>this.statusReactive.set(n))}_status=ml(()=>this.statusReactive());statusReactive=io(void 0);get valid(){return this.status===yg}get invalid(){return this.status===R0}get pending(){return this.status==qp}get disabled(){return this.status===xg}get enabled(){return this.status!==xg}errors;get pristine(){return $i(this.pristineReactive)}set pristine(n){$i(()=>this.pristineReactive.set(n))}_pristine=ml(()=>this.pristineReactive());pristineReactive=io(!0);get dirty(){return!this.pristine}get touched(){return $i(this.touchedReactive)}set touched(n){$i(()=>this.touchedReactive.set(n))}_touched=ml(()=>this.touchedReactive());touchedReactive=io(!1);get untouched(){return!this.touched}_events=new Pn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(DP(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(DP(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(NP(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(NP(n,this._rawAsyncValidators))}hasValidator(n){return M0(this._rawValidators,n)}hasAsyncValidator(n){return M0(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(ot(he({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new wg(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),e&&n.emitEvent!==!1&&this._events.next(new wg(!1,r))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(ot(he({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new bg(!1,r))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),e&&n.emitEvent!==!1&&this._events.next(new bg(!0,r))}markAsPending(n={}){this.status=qp;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Kp(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(ot(he({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=xg,this.errors=null,this._forEachChild(o=>{o.disable(ot(he({},n),{onlySelf:!0}))}),this._updateValue();let r=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new $0(this.value,r)),this._events.next(new Kp(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(ot(he({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=yg,this._forEachChild(r=>{r.enable(ot(he({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(ot(he({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===yg||this.status===qp)&&this._runAsyncValidator(r,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new $0(this.value,e)),this._events.next(new Kp(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(ot(he({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?xg:yg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=qp,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=zP(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new Kp(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,r)}_initObservables(){this.valueChanges=new Bt,this.statusChanges=new Bt}_calculateStatus(){return this._allControlsDisabled()?xg:this.errors?R0:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(qp)?qp:this._anyControlsHaveStatus(R0)?R0:yg}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),o&&this._events.next(new bg(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new wg(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){z0(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=Nte(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=kte(this._rawAsyncValidators)}},Yp=class extends Xp{constructor(n,e,r){super(W_(e),H_(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){YP(this,!0,n),Object.keys(n).forEach(r=>{XP(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(r=>{let o=this.controls[r];o&&o.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,o)=>{r.reset(n?n[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>r._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var z_=class extends Yp{};var Jp=new Re("",{providedIn:"root",factory:()=>Sg}),Sg="always";function U0(t,n){return[...n.path,t]}function L0(t,n,e=Sg){q_(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),Rte(t,n),Mte(t,n),Ote(t,n),Ate(t,n)}function kP(t,n,e=!0){let r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),B0(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function V0(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function Ate(t,n){if(n.valueAccessor.setDisabledState){let e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}function q_(t,n){let e=qP(t);n.validator!==null?t.setValidators(_P(e,n.validator)):typeof e=="function"&&t.setValidators([e]);let r=KP(t);n.asyncValidator!==null?t.setAsyncValidators(_P(r,n.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let o=()=>t.updateValueAndValidity();V0(n._rawValidators,o),V0(n._rawAsyncValidators,o)}function B0(t,n){let e=!1;if(t!==null){if(n.validator!==null){let o=qP(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.validator);i.length!==o.length&&(e=!0,t.setValidators(i))}}if(n.asyncValidator!==null){let o=KP(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.asyncValidator);i.length!==o.length&&(e=!0,t.setAsyncValidators(i))}}}let r=()=>{};return V0(n._rawValidators,r),V0(n._rawAsyncValidators,r),e}function Rte(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&ZP(t,n)})}function Ote(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&ZP(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function ZP(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Mte(t,n){let e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}function QP(t,n){t==null,q_(t,n)}function Fte(t,n){return B0(t,n)}function JP(t,n){if(!t.hasOwnProperty("model"))return!1;let e=t.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function Pte(t){return Object.getPrototypeOf(t.constructor)===Zp}function e$(t,n){t._syncPendingControls(),n.forEach(e=>{let r=e.control;r.updateOn==="submit"&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function t$(t,n){if(!n)return null;Array.isArray(n);let e,r,o;return n.forEach(i=>{i.constructor===pr?e=i:Pte(i)?r=i:o=i}),o||r||e||null}function $te(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}var Lte={provide:Nr,useExisting:nr(()=>K_)},vg=Promise.resolve(),K_=(()=>{class t extends Nr{callSetDisabledState;get submitted(){return $i(this.submittedReactive)}_submitted=ml(()=>this.submittedReactive());submittedReactive=io(!1);_directives=new Set;form;ngSubmit=new Bt;options;constructor(e,r,o){super(),this.callSetDisabledState=o,this.form=new Yp({},j_(e),G_(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){vg.then(()=>{let r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),L0(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){vg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){vg.then(()=>{let r=this._findContainer(e.path),o=new Yp({});QP(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){vg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){vg.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),e$(this.form,this._directives),this.ngSubmit.emit(e),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(r){return new(r||t)(re(El,10),re(Qp,10),re(Jp,8))};static \u0275dir=Nt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&ye("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Er([Lte]),_n]})}return t})();function AP(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function RP(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var Cg=class extends Xp{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,r){super(W_(e),H_(r,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),z0(e)&&(e.nonNullable||e.initialValueIsDefault)&&(RP(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){AP(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){AP(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){RP(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var Vte=t=>t instanceof Cg,Bte=(()=>{class t extends Nr{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return U0(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,standalone:!1,features:[_n]})}return t})();var zte={provide:Il,useExisting:nr(()=>Ou)},OP=Promise.resolve(),Ou=(()=>{class t extends Il{_changeDetectorRef;callSetDisabledState;control=new Cg;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Bt;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=t$(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),JP(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){L0(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){OP.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&xu(r);OP.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?U0(e,this._parent):[e]}static \u0275fac=function(r){return new(r||t)(re(Nr,9),re(El,10),re(Qp,10),re(Tl,10),re(zt,8),re(Jp,8))};static \u0275dir=Nt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Er([zte]),_n,ai]})}return t})(),Gi=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275dir=Nt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})(),Ute={provide:Tl,useExisting:nr(()=>Mu),multi:!0},Mu=(()=>{class t extends Zp{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&ye("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Er([Ute]),_n]})}return t})(),jte={provide:Tl,useExisting:nr(()=>Tg),multi:!0};var Gte=(()=>{class t{_accessors=[];add(e,r){this._accessors.push([e,r])}remove(e){for(let r=this._accessors.length-1;r>=0;--r)if(this._accessors[r][1]===e){this._accessors.splice(r,1);return}}select(e){this._accessors.forEach(r=>{this._isSameGroup(r,e)&&r[1]!==e&&r[1].fireUncheck(e.value)})}_isSameGroup(e,r){return e[0].control?e[0]._parent===r._control._parent&&e[1].name===r.name:!1}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Tg=(()=>{class t extends Zp{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=ue(Jp,{optional:!0})??Sg;constructor(e,r,o,i){super(e,r),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get(Il),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(r){return new(r||t)(re(ci),re(Do),re(Gte),re(Wn))};static \u0275dir=Nt({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(r,o){r&1&&ye("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Er([jte]),_n]})}return t})();var n$=new Re("");var Wte={provide:Nr,useExisting:nr(()=>Wi)},Wi=(()=>{class t extends Nr{callSetDisabledState;get submitted(){return $i(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=ml(()=>this._submittedReactive());_submittedReactive=io(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Bt;constructor(e,r,o){super(),this.callSetDisabledState=o,this._setValidators(e),this._setAsyncValidators(r)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(B0(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let r=this.form.get(e.path);return L0(r,e,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),r}getControl(e){return this.form.get(e.path)}removeControl(e){kP(e.control||null,e,!1),$te(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,r){this.form.get(e.path).setValue(r)}onSubmit(e){return this._submittedReactive.set(!0),e$(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new V_(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new B_(this.form))}_updateDomValue(){this.directives.forEach(e=>{let r=e.control,o=this.form.get(e.path);r!==o&&(kP(r||null,e),Vte(o)&&(L0(o,e,this.callSetDisabledState),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let r=this.form.get(e.path);QP(r,e),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let r=this.form.get(e.path);r&&Fte(r,e)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){q_(this.form,this),this._oldForm&&B0(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(r){return new(r||t)(re(El,10),re(Qp,10),re(Jp,8))};static \u0275dir=Nt({type:t,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&ye("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Er([Wte]),_n,ai]})}return t})(),Hte={provide:Nr,useExisting:nr(()=>j0)},j0=(()=>{class t extends Bte{name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}_checkParentType(){r$(this._parent)}static \u0275fac=function(r){return new(r||t)(re(Nr,13),re(El,10),re(Qp,10))};static \u0275dir=Nt({type:t,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Er([Hte]),_n]})}return t})(),qte={provide:Nr,useExisting:nr(()=>G0)},G0=(()=>{class t extends Nr{_parent;name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}ngOnInit(){this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return U0(this.name==null?this.name:this.name.toString(),this._parent)}_checkParentType(){r$(this._parent)}static \u0275fac=function(r){return new(r||t)(re(Nr,13),re(El,10),re(Qp,10))};static \u0275dir=Nt({type:t,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Er([qte]),_n]})}return t})();function r$(t){return!(t instanceof j0)&&!(t instanceof Wi)&&!(t instanceof G0)}var Kte={provide:Il,useExisting:nr(()=>Ls)},Ls=(()=>{class t extends Il{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new Bt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,r,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=t$(this,i)}ngOnChanges(e){this._added||this._setUpControl(),JP(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return U0(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||t)(re(Nr,13),re(El,10),re(Qp,10),re(Tl,10),re(n$,8))};static \u0275dir=Nt({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Er([Kte]),_n,ai]})}return t})(),Xte={provide:Tl,useExisting:nr(()=>_l),multi:!0};function o$(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function Yte(t){return t.split(":")[0]}var _l=(()=>{class t extends Zp{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=o$(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=Yte(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&ye("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Er([Xte]),_n]})}return t})(),ef=(()=>{class t{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(o$(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(re(Do),re(ci),re(_l,9))};static \u0275dir=Nt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),Zte={provide:Tl,useExisting:nr(()=>i$),multi:!0};function MP(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function Qte(t){return t.split(":")[0]}var i$=(()=>{class t extends Zp{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);o.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);o.push(c)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=Qte(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&ye("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Er([Zte]),_n]})}return t})(),tf=(()=>{class t{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(MP(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(MP(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(re(Do),re(ci),re(i$,9))};static \u0275dir=Nt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function s$(t){return typeof t=="number"?t:parseFloat(t)}var a$=(()=>{class t{_validator=O0;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):O0,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Nt({type:t,features:[ai]})}return t})(),Jte={provide:El,useExisting:nr(()=>X_),multi:!0},X_=(()=>{class t extends a${max;inputName="max";normalizeInput=e=>s$(e);createValidator=e=>VP(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&wp("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[Er([Jte]),_n]})}return t})(),ene={provide:El,useExisting:nr(()=>Eg),multi:!0},Eg=(()=>{class t extends a${min;inputName="min";normalizeInput=e=>s$(e);createValidator=e=>LP(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=_o(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&wp("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[Er([ene]),_n]})}return t})();var l$=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=_s({type:t});static \u0275inj=Cs({})}return t})(),U_=class extends Xp{constructor(n,e,r){super(W_(e),H_(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,r={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,e={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,r={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),e&&(this.controls.splice(o,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){YP(this,!1,n),n.forEach((r,o)=>{XP(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((r,o)=>{r.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,r)=>r._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,r)=>{n(e,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function FP(t){return!!t&&(t.asyncValidators!==void 0||t.validators!==void 0||t.updateOn!==void 0)}var Dl=(()=>{class t{useNonNullable=!1;get nonNullable(){let e=new t;return e.useNonNullable=!0,e}group(e,r=null){let o=this._reduceControls(e),i={};return FP(r)?i=r:r!==null&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new Yp(o,i)}record(e,r=null){let o=this._reduceControls(e);return new z_(o,r)}control(e,r,o){let i={};return this.useNonNullable?(FP(r)?i=r:(i.validators=r,i.asyncValidators=o),new Cg(e,ot(he({},i),{nonNullable:!0}))):new Cg(e,r,o)}array(e,r,o){let i=e.map(s=>this._createControl(s));return new U_(i,r,o)}_reduceControls(e){let r={};return Object.keys(e).forEach(o=>{r[o]=this._createControl(e[o])}),r}_createControl(e){if(e instanceof Cg)return e;if(e instanceof Xp)return e;if(Array.isArray(e)){let r=e[0],o=e.length>1?e[1]:null,i=e.length>2?e[2]:null;return this.control(r,o,i)}else return this.control(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var nf=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Jp,useValue:e.callSetDisabledState??Sg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=_s({type:t});static \u0275inj=Cs({imports:[l$]})}return t})(),Hi=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:n$,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:Jp,useValue:e.callSetDisabledState??Sg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=_s({type:t});static \u0275inj=Cs({imports:[l$]})}return t})();var sr=[];for(let t=0;t<256;++t)sr.push((t+256).toString(16).slice(1));function c$(t,n=0){return(sr[t[n+0]]+sr[t[n+1]]+sr[t[n+2]]+sr[t[n+3]]+"-"+sr[t[n+4]]+sr[t[n+5]]+"-"+sr[t[n+6]]+sr[t[n+7]]+"-"+sr[t[n+8]]+sr[t[n+9]]+"-"+sr[t[n+10]]+sr[t[n+11]]+sr[t[n+12]]+sr[t[n+13]]+sr[t[n+14]]+sr[t[n+15]]).toLowerCase()}var Y_,tne=new Uint8Array(16);function Z_(){if(!Y_){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Y_=crypto.getRandomValues.bind(crypto)}return Y_(tne)}var nne=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Q_={randomUUID:nne};function rne(t,n,e){if(Q_.randomUUID&&!n&&!t)return Q_.randomUUID();t=t||{};let r=t.random??t.rng?.()??Z_();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let o=0;o<16;++o)n[e+o]=r[o];return n}return c$(r)}var Pu=rne;var one=(t,n)=>({"text-success":t,"text-danger":n});function ine(t,n){if(t&1&&(I(0,"div",138),q(1,"div",139),C()),t&2){let e=fe();B(),Cp("width",e.calculateFormProgress()+"%")}}function sne(t,n){if(t&1&&(I(0,"span",140),T(1),C()),t&2){let e=fe();B(),Ke("",e.calculateFormProgress(),"% Complete")}}function ane(t,n){t&1&&(I(0,"div",141),T(1," Account name is required "),C())}function lne(t,n){t&1&&(I(0,"div",141),T(1," Please select an instrument type "),C())}function cne(t,n){t&1&&(I(0,"div",141),T(1," Trade symbol is required "),C())}function une(t,n){t&1&&(I(0,"div",141),T(1," Please select trade direction "),C())}function dne(t,n){t&1&&(I(0,"div",141),T(1," Time frame selection is required "),C())}function pne(t,n){t&1&&(I(0,"div",141),T(1," Please select an analysis type "),C())}function fne(t,n){t&1&&(I(0,"div",141),T(1," Strategy name is required "),C())}function mne(t,n){t&1&&(I(0,"div",141),T(1," Order type is required "),C())}function hne(t,n){t&1&&(I(0,"div",141),T(1," Entry criteria is required (min 10 characters) "),C())}function gne(t,n){t&1&&(I(0,"div",141),T(1," Exit strategy is required (min 10 characters) "),C())}function yne(t,n){t&1&&(I(0,"div",141),T(1," Valid account balance is required "),C())}function xne(t,n){t&1&&(I(0,"div",141),T(1," Position size is required "),C())}function vne(t,n){t&1&&(I(0,"div",141),T(1," Valid entry price is required "),C())}function bne(t,n){t&1&&(I(0,"div",141),T(1," Entry date/time is required "),C())}function wne(t,n){t&1&&(I(0,"div",141),T(1," Stop loss price is required "),C())}function Cne(t,n){t&1&&(I(0,"div",141),T(1," Take profit price is required "),C())}function Ine(t,n){t&1&&(I(0,"div",141),T(1," Risk percentage is required "),C())}function Sne(t,n){t&1&&(I(0,"div",142),q(1,"i",143),T(2," Risk exceeds recommended 2% "),C())}function Tne(t,n){t&1&&(I(0,"div",141),T(1," Estimated reward is required "),C())}function Ene(t,n){t&1&&(I(0,"div",141),T(1," Please select your emotional state "),C())}function _ne(t,n){t&1&&(I(0,"div",142),q(1,"i",143),T(2," Consider if this emotional state might negatively impact your decision making "),C())}function Dne(t,n){t&1&&(I(0,"div",144),T(1," Please rate your confidence "),C())}function Nne(t,n){t&1&&(I(0,"div",141),T(1," Please identify potential biases (min 5 characters) "),C())}function kne(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Trade Setup"),C())}function Ane(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Strategy Details"),C())}function Rne(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Risk Management"),C())}function One(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Psychological Analysis"),C())}function Mne(t,n){if(t&1&&(I(0,"div",145),q(1,"i",146),I(2,"strong"),T(3,"Please fix the errors highlighted above before submitting."),C(),I(4,"ul",147),ce(5,kne,2,0,"li",148)(6,Ane,2,0,"li",148)(7,Rne,2,0,"li",148)(8,One,2,0,"li",148),C()()),t&2){let e=fe();B(5),X("ngIf",e.hasErrors("tradeSetup")),B(),X("ngIf",e.hasErrors("strategyDetails")),B(),X("ngIf",e.hasErrors("riskManagement")),B(),X("ngIf",e.hasErrors("psychologicalAnalysis"))}}function Fne(t,n){if(t&1){let e=Ft();I(0,"button",149),ye("click",function(){Me(e);let o=fe();return Fe(o.onCancel())}),q(1,"i",150),T(2,"Cancel "),C()}}function Pne(t,n){if(t&1&&(I(0,"div",151),q(1,"i",152),T(2),C()),t&2){let e=fe();B(2),Ke("",e.message," ")}}function $ne(t,n){if(t&1&&(I(0,"div",153),q(1,"i",146),T(2),C()),t&2){let e=fe();B(2),Ke("",e.errorMessage," ")}}var rf=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r}tradeLogData=null;formSubmitted=new Bt;cancel=new Bt;preTradeTableName="pretrade";postTradeTableName="posttrade";preTradeForm;postTradeForm;showEmotionalSection=!1;message="";errorMessage="";formSubmitMarker=!1;ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=Pu();this.preTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[this.tradeLogData?.createdtime??new Date().toISOString()],accountname:[this.tradeLogData?.accountname??"",Ce.required],instrumenttype:[this.tradeLogData?.instrumenttype??"",Ce.required],analysistype:[this.tradeLogData?.analysistype??"",Ce.required],tradesymbol:[this.tradeLogData?.tradesymbol??"",Ce.required],tradetype:[this.tradeLogData?.tradetype??"Long",Ce.required],timeframe:[this.tradeLogData?.timeframe??"Day",Ce.required],strategyname:[this.tradeLogData?.strategyname??""],typeoforder:[this.tradeLogData?.typeoforder??"",Ce.required],entrycriteria:[this.tradeLogData?.entrycriteria??""],exitstrategy:[this.tradeLogData?.exitstrategy??""],entrydatetime:[this.tradeLogData?.entrydatetime??""],entryprice:[this.tradeLogData?.entryprice??""],accountbalance:[this.tradeLogData?.accountbalance??null,[Ce.required,Ce.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",Ce.required],estimatedrisk:[this.tradeLogData?.estimatedrisk??null,Ce.required],estimatedpnl:[this.tradeLogData?.estimatedpnl??null,Ce.required],estimatedstoploss:[this.tradeLogData?.estimatedstoploss??null,Ce.required],estimatedtakeprofit:[this.tradeLogData?.estimatedtakeprofit??null,Ce.required],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],tradeconfidence:[this.tradeLogData?.tradeconfidence??"1"],isopen:!0,emotionalstatebefore:[this.tradeLogData?.emotionalstatebefore??"",Ce.required],potentialbiases:[this.tradeLogData?.potentialbiases??"",Ce.required],notes:[this.tradeLogData?.notes??""],updatedtime:[new Date().toISOString()]})}toggleEmotionalSection(){this.showEmotionalSection=!this.showEmotionalSection}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.preTradeForm.patchValue({setupscreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.preTradeForm.invalid){this.preTradeForm.markAllAsTouched();return}let n=this.preTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.preTradeTableName):await this.supabaseService.addTradeLog(n,this.preTradeTableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.preTradeForm.reset(),this.preTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.preTradeTableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateFormProgress(){let e=0;return this.preTradeForm.get("accountname")?.valid&&e++,this.preTradeForm.get("instrumenttype")?.valid&&e++,this.preTradeForm.get("tradesymbol")?.valid&&e++,this.preTradeForm.get("tradetype")?.valid&&e++,this.preTradeForm.get("timeframe")?.valid&&e++,this.preTradeForm.get("analysistype")?.valid&&e++,this.preTradeForm.get("strategyname")?.valid&&e++,this.preTradeForm.get("typeoforder")?.valid&&e++,this.preTradeForm.get("entrycriteria")?.valid&&e++,this.preTradeForm.get("exitstrategy")?.valid&&e++,this.preTradeForm.get("accountbalance")?.valid&&e++,this.preTradeForm.get("positionsize")?.valid&&e++,this.preTradeForm.get("entryprice")?.valid&&e++,this.preTradeForm.get("entrydatetime")?.valid&&e++,this.preTradeForm.get("estimatedstoploss")?.valid&&e++,this.preTradeForm.get("estimatedtakeprofit")?.valid&&e++,this.preTradeForm.get("estimatedrisk")?.valid&&e++,this.preTradeForm.get("estimatedpnl")?.valid&&e++,this.preTradeForm.get("emotionalstatebefore")?.valid&&e++,this.preTradeForm.get("tradeConfidence")?.valid&&e++,this.preTradeForm.get("potentialbiases")?.valid&&e++,Math.round(e/18*100)}calculateRiskRewardRatio(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?"N/A":`1:${(e/n).toFixed(2)}`}isGoodRiskReward(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?!1:e/n>=2}isNegativeEmotionalState(){let n=this.preTradeForm.get("emotionalstatebefore")?.value;return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}hasErrors(n){switch(n){case"tradeSetup":return this.preTradeForm.get("accountname")?.invalid||this.preTradeForm.get("instrumenttype")?.invalid||this.preTradeForm.get("tradesymbol")?.invalid||this.preTradeForm.get("tradetype")?.invalid||this.preTradeForm.get("timeframe")?.invalid||this.preTradeForm.get("analysistype")?.invalid||!1;case"strategyDetails":return this.preTradeForm.get("strategyname")?.invalid||this.preTradeForm.get("typeoforder")?.invalid||this.preTradeForm.get("entrycriteria")?.invalid||this.preTradeForm.get("exitstrategy")?.invalid||!1;case"riskManagement":return this.preTradeForm.get("accountbalance")?.invalid||this.preTradeForm.get("positionsize")?.invalid||this.preTradeForm.get("entryprice")?.invalid||this.preTradeForm.get("entrydatetime")?.invalid||this.preTradeForm.get("estimatedstoploss")?.invalid||this.preTradeForm.get("estimatedtakeprofit")?.invalid||this.preTradeForm.get("estimatedrisk")?.invalid||this.preTradeForm.get("estimatedpnl")?.invalid||!1;case"psychologicalAnalysis":return this.preTradeForm.get("emotionalstatebefore")?.invalid||this.preTradeForm.get("tradeConfidence")?.invalid||this.preTradeForm.get("potentialbiases")?.invalid||!1;default:return!1}}static \u0275fac=function(e){return new(e||t)(re(Dl),re(Ut),re(zt))};static \u0275cmp=Mt({type:t,selectors:[["app-pre-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:332,vars:40,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["routerLink","/pretrades"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","entrycriteria",1,"form-label"],["id","entrycriteria","formControlName","entrycriteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)","rows","3",1,"form-control"],[1,"form-text"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Define your profit targets and stop loss levels","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],["type","button","data-bs-toggle","tooltip","title","Calculate based on risk",1,"btn","btn-outline-secondary"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Planned entry price",1,"form-control"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","estimatedstoploss",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedstoploss","formControlName","estimatedstoploss","placeholder","Stop loss price level",1,"form-control"],["for","estimatedtakeprofit",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedtakeprofit","formControlName","estimatedtakeprofit","placeholder","Target price level",1,"form-control"],[1,"mb-3"],[1,"col-md-4"],["for","estimatedrisk",1,"form-label"],["type","number","step","0.01","min","0","max","100","id","estimatedrisk","formControlName","estimatedrisk","placeholder","1-2% recommended",1,"form-control"],["class","text-warning mt-1 small",4,"ngIf"],["for","estimatedpnl",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedpnl","formControlName","estimatedpnl","placeholder","Expected % gain",1,"form-control"],[1,"form-label"],["type","text","readonly","",1,"form-control","bg-light",3,"value"],[1,"form-text",3,"ngClass"],[1,"bi","bi-5-circle","me-2"],["for","emotionalstatebefore",1,"form-label"],["id","emotionalstatebefore","formControlName","emotionalstatebefore",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],[1,"form-label","d-block"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","tradeconfidence","id","confidence1","value","1",1,"btn-check"],["for","confidence1",1,"btn","btn-outline-danger"],["type","radio","formControlName","tradeconfidence","id","confidence2","value","2",1,"btn-check"],["for","confidence2",1,"btn","btn-outline-warning"],["type","radio","formControlName","tradeconfidence","id","confidence3","value","3",1,"btn-check"],["for","confidence3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","tradeconfidence","id","confidence4","value","4",1,"btn-check"],["for","confidence4",1,"btn","btn-outline-primary"],["type","radio","formControlName","tradeconfidence","id","confidence5","value","5",1,"btn-check"],["for","confidence5",1,"btn","btn-outline-success"],[1,"form-text","text-center","mt-1"],["class","text-danger mt-1 small text-center",4,"ngIf"],["for","potentialbiases",1,"form-label"],["id","potentialbiases","formControlName","potentialbiases","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO, overconfidence)","rows","3",1,"form-control"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"text-warning","mt-1","small"],[1,"bi","bi-exclamation-triangle"],[1,"text-danger","mt-1","small","text-center"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(I(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),T(5,"Dashboard"),C()(),I(6,"li",3)(7,"a",5),T(8,"Pre-Trade Logs"),C()(),I(9,"li",6),T(10,"Pre-Trading Journal"),C()()(),I(11,"div",7)(12,"div",8)(13,"h2",9),T(14),C(),I(15,"p",10),T(16,"Document your strategy before entering positions to maintain discipline and clarity"),C()(),I(17,"div",11),ce(18,ine,2,2,"div",12)(19,sne,2,1,"span",13),C()(),I(20,"form",14),ye("ngSubmit",function(){return r.onSubmit()}),I(21,"div",15)(22,"div",16)(23,"h5",17),q(24,"i",18),T(25,"Trade Setup "),C(),I(26,"span",19),T(27,"Required"),C()(),I(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),T(32,"Account Name"),C(),I(33,"div",24)(34,"span",25),q(35,"i",26),C(),q(36,"input",27),C(),ce(37,ane,2,0,"div",28),C(),I(38,"div",22)(39,"label",29),T(40,"Instrument Type"),C(),I(41,"select",30)(42,"option",31),T(43,"Choose instrument type"),C(),I(44,"option",32),T(45,"Forex"),C(),I(46,"option",33),T(47,"Stocks"),C(),I(48,"option",34),T(49,"Futures"),C(),I(50,"option",35),T(51,"Crypto"),C(),I(52,"option",36),T(53,"Options"),C(),I(54,"option",37),T(55,"ETF"),C(),I(56,"option",38),T(57,"Other"),C()(),ce(58,lne,2,0,"div",28),C(),I(59,"div",22)(60,"label",39),T(61,"Trade Symbol"),C(),I(62,"div",24)(63,"span",25),q(64,"i",40),C(),q(65,"input",41),C(),ce(66,cne,2,0,"div",28),C(),I(67,"div",22)(68,"label",42),T(69,"Trade Direction"),C(),I(70,"div",43),q(71,"input",44),I(72,"label",45),T(73,"Long"),C(),q(74,"input",46),I(75,"label",47),T(76,"Short"),C()(),ce(77,une,2,0,"div",28),C(),I(78,"div",22)(79,"label",48),T(80,"Time Frame"),C(),I(81,"select",49)(82,"option",31),T(83,"Select time frame"),C(),I(84,"option",50),T(85,"Scalp (minutes)"),C(),I(86,"option",51),T(87,"Day Trade (hours)"),C(),I(88,"option",52),T(89,"Swing (days-weeks)"),C(),I(90,"option",53),T(91,"Position (weeks-months)"),C(),I(92,"option",54),T(93,"Long Term (months+)"),C()(),ce(94,dne,2,0,"div",28),C(),I(95,"div",22)(96,"label",55),T(97,"Analysis Type"),C(),I(98,"select",56)(99,"option",31),T(100,"Choose analysis method"),C(),I(101,"option",57),T(102,"Technical"),C(),I(103,"option",58),T(104,"Fundamental"),C(),I(105,"option",59),T(106,"Both"),C(),I(107,"option",60),T(108,"Sentiment"),C(),I(109,"option",38),T(110,"Other"),C()(),ce(111,pne,2,0,"div",28),C()()()(),I(112,"div",15)(113,"div",16)(114,"h5",17),q(115,"i",61),T(116,"Strategy Details "),C(),I(117,"span",19),T(118,"Required"),C()(),I(119,"div",20)(120,"div",21)(121,"div",22)(122,"label",62),T(123,"Strategy Name"),C(),q(124,"input",63),ce(125,fne,2,0,"div",28),C(),I(126,"div",22)(127,"label",64),T(128,"Type of Order"),C(),I(129,"select",65)(130,"option",31),T(131,"Choose order type"),C(),I(132,"option",66),T(133,"Market"),C(),I(134,"option",67),T(135,"Limit"),C(),I(136,"option",68),T(137,"Stop"),C(),I(138,"option",69),T(139,"Stop Limit"),C(),I(140,"option",70),T(141,"Trailing Stop"),C()(),ce(142,mne,2,0,"div",28),C(),I(143,"div",71)(144,"label",72),T(145,"Entry Criteria "),I(146,"span",10),T(147,"(Why are you taking this trade?)"),C()(),q(148,"textarea",73),I(149,"div",74),T(150,"Be specific about what signals or conditions must be met for entry."),C(),ce(151,hne,2,0,"div",28),C(),I(152,"div",71)(153,"label",75),T(154,"Exit Strategy "),I(155,"span",10),T(156,"(How will you close this position?)"),C()(),q(157,"textarea",76),I(158,"div",74),T(159,"Include both profit-taking and loss-cutting criteria."),C(),ce(160,gne,2,0,"div",28),C()()()(),I(161,"div",15)(162,"div",16)(163,"h5",17),q(164,"i",77),T(165,"Risk Management "),C(),I(166,"span",19),T(167,"Required"),C()(),I(168,"div",20)(169,"div",21)(170,"div",22)(171,"label",78),T(172,"Account Balance"),C(),I(173,"div",24)(174,"span",25),T(175,"$"),C(),q(176,"input",79),C(),ce(177,yne,2,0,"div",28),C(),I(178,"div",22)(179,"label",80),T(180,"Position Size"),C(),I(181,"div",24),q(182,"input",81),I(183,"button",82),T(184,"Calculate"),C()(),ce(185,xne,2,0,"div",28),C(),I(186,"div",22)(187,"label",83),T(188,"Entry Price"),C(),I(189,"div",24)(190,"span",25),T(191,"$"),C(),q(192,"input",84),C(),ce(193,vne,2,0,"div",28),C(),I(194,"div",22)(195,"label",85),T(196,"Entry Date/Time"),C(),q(197,"input",86),ce(198,bne,2,0,"div",28),C(),I(199,"div",22)(200,"label",87),T(201,"Stop Loss Price"),C(),I(202,"div",24)(203,"span",25),T(204,"$"),C(),q(205,"input",88),C(),ce(206,wne,2,0,"div",28),C(),I(207,"div",22)(208,"label",89),T(209,"Take Profit Price"),C(),I(210,"div",24)(211,"span",25),T(212,"$"),C(),q(213,"input",90),C(),ce(214,Cne,2,0,"div",28),C(),I(215,"div",71),q(216,"hr"),I(217,"h6",91),T(218,"Risk/Reward Analysis"),C()(),I(219,"div",92)(220,"label",93),T(221,"Risk Per Trade"),C(),I(222,"div",24),q(223,"input",94),I(224,"span",25),T(225,"%"),C()(),I(226,"div",74),T(227,"Percentage of account at risk"),C(),ce(228,Ine,2,0,"div",28)(229,Sne,3,0,"div",95),C(),I(230,"div",92)(231,"label",96),T(232,"Estimated Reward"),C(),I(233,"div",24),q(234,"input",97),I(235,"span",25),T(236,"%"),C()(),ce(237,Tne,2,0,"div",28),C(),I(238,"div",92)(239,"label",98),T(240,"Risk/Reward Ratio"),C(),I(241,"div",24),q(242,"input",99),I(243,"span",25),T(244,"R:R"),C()(),I(245,"div",100),q(246,"i"),T(247),C()()()()(),I(248,"div",15)(249,"div",16)(250,"h5",17),q(251,"i",101),T(252,"Psychological Analysis "),C(),I(253,"span",19),T(254,"Required"),C()(),I(255,"div",20)(256,"div",21)(257,"div",22)(258,"label",102),T(259,"Current Emotional State"),C(),I(260,"select",103)(261,"option",31),T(262,"How are you feeling?"),C(),I(263,"option",104),T(264,"Calm & Focused"),C(),I(265,"option",105),T(266,"Excited"),C(),I(267,"option",106),T(268,"Anxious"),C(),I(269,"option",107),T(270,"Frustrated"),C(),I(271,"option",108),T(272,"Overconfident"),C(),I(273,"option",109),T(274,"Fearful"),C(),I(275,"option",110),T(276,"Neutral"),C(),I(277,"option",38),T(278,"Other"),C()(),ce(279,Ene,2,0,"div",28)(280,_ne,3,0,"div",95),C(),I(281,"div",22)(282,"label",111),T(283,"Trading Confidence"),C(),I(284,"div",112),q(285,"input",113),I(286,"label",114),T(287,"1"),C(),q(288,"input",115),I(289,"label",116),T(290,"2"),C(),q(291,"input",117),I(292,"label",118),T(293,"3"),C(),q(294,"input",119),I(295,"label",120),T(296,"4"),C(),q(297,"input",121),I(298,"label",122),T(299,"5"),C()(),I(300,"div",123),T(301,"Low (1) to High (5)"),C(),ce(302,Dne,2,0,"div",124),C(),I(303,"div",71)(304,"label",125),T(305,"Potential Biases"),C(),q(306,"textarea",126),I(307,"div",74),T(308,"Identifying biases helps improve future decision making"),C(),ce(309,Nne,2,0,"div",28),C()()()(),I(310,"div",15)(311,"div",16)(312,"h5",17),q(313,"i",127),T(314,"Additional Notes "),C(),I(315,"span",128),T(316,"Optional"),C()(),I(317,"div",20)(318,"div",21)(319,"div",71)(320,"label",129),T(321,"Notes"),C(),q(322,"textarea",130),C()()()(),ce(323,Mne,9,4,"div",131),I(324,"div",132),ce(325,Fne,3,0,"button",133),I(326,"div")(327,"button",134),q(328,"i",135),T(329),C()()(),ce(330,Pne,3,1,"div",136)(331,$ne,3,1,"div",137),C()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,y,x,w,b,S,E,D,O,R;B(14),dn(r.tradeLogData?"Edit Pre-Trading Journal":"Create Pre-Trading Journal"),B(4),X("ngIf",!r.tradeLogData),B(),X("ngIf",!r.tradeLogData),B(),X("formGroup",r.preTradeForm),B(17),X("ngIf",((o=r.preTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.preTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.preTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),B(21),X("ngIf",((i=r.preTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.preTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.preTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),B(8),X("ngIf",((s=r.preTradeForm.get("tradesymbol"))==null?null:s.invalid)&&(((s=r.preTradeForm.get("tradesymbol"))==null?null:s.dirty)||((s=r.preTradeForm.get("tradesymbol"))==null?null:s.touched)||r.formSubmitMarker)),B(11),X("ngIf",((a=r.preTradeForm.get("tradetype"))==null?null:a.invalid)&&(((a=r.preTradeForm.get("tradetype"))==null?null:a.dirty)||((a=r.preTradeForm.get("tradetype"))==null?null:a.touched)||r.formSubmitMarker)),B(17),X("ngIf",((l=r.preTradeForm.get("timeframe"))==null?null:l.invalid)&&(((l=r.preTradeForm.get("timeframe"))==null?null:l.dirty)||((l=r.preTradeForm.get("timeframe"))==null?null:l.touched)||r.formSubmitMarker)),B(17),X("ngIf",((c=r.preTradeForm.get("analysistype"))==null?null:c.invalid)&&(((c=r.preTradeForm.get("analysistype"))==null?null:c.dirty)||((c=r.preTradeForm.get("analysistype"))==null?null:c.touched)||r.formSubmitMarker)),B(14),X("ngIf",((u=r.preTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.preTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.preTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),B(17),X("ngIf",((d=r.preTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.preTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.preTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),B(9),X("ngIf",((p=r.preTradeForm.get("entrycriteria"))==null?null:p.invalid)&&(((p=r.preTradeForm.get("entrycriteria"))==null?null:p.dirty)||((p=r.preTradeForm.get("entrycriteria"))==null?null:p.touched)||r.formSubmitMarker)),B(9),X("ngIf",((f=r.preTradeForm.get("exitstrategy"))==null?null:f.invalid)&&(((f=r.preTradeForm.get("exitstrategy"))==null?null:f.dirty)||((f=r.preTradeForm.get("exitstrategy"))==null?null:f.touched)||r.formSubmitMarker)),B(17),X("ngIf",((m=r.preTradeForm.get("accountbalance"))==null?null:m.invalid)&&(((m=r.preTradeForm.get("accountbalance"))==null?null:m.dirty)||((m=r.preTradeForm.get("accountbalance"))==null?null:m.touched)||r.formSubmitMarker)),B(8),X("ngIf",((h=r.preTradeForm.get("positionsize"))==null?null:h.invalid)&&(((h=r.preTradeForm.get("positionsize"))==null?null:h.dirty)||((h=r.preTradeForm.get("positionsize"))==null?null:h.touched)||r.formSubmitMarker)),B(8),X("ngIf",((g=r.preTradeForm.get("entryprice"))==null?null:g.invalid)&&(((g=r.preTradeForm.get("entryprice"))==null?null:g.dirty)||((g=r.preTradeForm.get("entryprice"))==null?null:g.touched)||r.formSubmitMarker)),B(5),X("ngIf",((y=r.preTradeForm.get("entrydatetime"))==null?null:y.invalid)&&(((y=r.preTradeForm.get("entrydatetime"))==null?null:y.dirty)||((y=r.preTradeForm.get("entrydatetime"))==null?null:y.touched)||r.formSubmitMarker)),B(8),X("ngIf",((x=r.preTradeForm.get("estimatedstoploss"))==null?null:x.invalid)&&(((x=r.preTradeForm.get("estimatedstoploss"))==null?null:x.dirty)||((x=r.preTradeForm.get("estimatedstoploss"))==null?null:x.touched)||r.formSubmitMarker)),B(8),X("ngIf",((w=r.preTradeForm.get("estimatedtakeprofit"))==null?null:w.invalid)&&(((w=r.preTradeForm.get("estimatedtakeprofit"))==null?null:w.dirty)||((w=r.preTradeForm.get("estimatedtakeprofit"))==null?null:w.touched)||r.formSubmitMarker)),B(14),X("ngIf",((b=r.preTradeForm.get("estimatedrisk"))==null?null:b.invalid)&&(((b=r.preTradeForm.get("estimatedrisk"))==null?null:b.dirty)||((b=r.preTradeForm.get("estimatedrisk"))==null?null:b.touched)||r.formSubmitMarker)),B(),X("ngIf",((S=r.preTradeForm.get("estimatedrisk"))==null?null:S.value)>2),B(8),X("ngIf",((E=r.preTradeForm.get("estimatedpnl"))==null?null:E.invalid)&&(((E=r.preTradeForm.get("estimatedpnl"))==null?null:E.dirty)||((E=r.preTradeForm.get("estimatedpnl"))==null?null:E.touched)||r.formSubmitMarker)),B(5),X("value",r.calculateRiskRewardRatio()),B(3),X("ngClass",Ip(37,one,r.isGoodRiskReward(),!r.isGoodRiskReward())),B(),VM(r.isGoodRiskReward()?"bi bi-check-circle":"bi bi-x-circle"),B(),Ke(" ",r.isGoodRiskReward()?"Good risk/reward ratio":"Risk/reward should be at least 1:2"," "),B(32),X("ngIf",((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.invalid)&&(((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.dirty)||((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.touched)||r.formSubmitMarker)),B(),X("ngIf",r.isNegativeEmotionalState()),B(22),X("ngIf",((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.invalid)&&(((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.dirty)||((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.touched)||r.formSubmitMarker)),B(7),X("ngIf",((R=r.preTradeForm.get("potentialbiases"))==null?null:R.invalid)&&(((R=r.preTradeForm.get("potentialbiases"))==null?null:R.dirty)||((R=r.preTradeForm.get("potentialbiases"))==null?null:R.touched)||r.formSubmitMarker)),B(14),X("ngIf",r.formSubmitMarker&&r.preTradeForm.invalid),B(2),X("ngIf",r.tradeLogData),B(4),Ke("",r.tradeLogData?"Update":"Submit"," "),B(),X("ngIf",r.message),B(),X("ngIf",r.errorMessage)}},dependencies:[rn,Li,xn,Hi,Gi,ef,tf,pr,Mu,_l,Tg,qr,ji,Eg,X_,Wi,Ls,Bi],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function Lne(t,n){t&1&&(I(0,"div",12),T(1,"Loading trade logs..."),C())}function Vne(t,n){if(t&1&&(I(0,"div",13),T(1),C()),t&2){let e=fe();B(),dn(e.errorMessage)}}function Bne(t,n){if(t&1){let e=Ft();I(0,"div",16)(1,"div",17),ye("click",function(){let o=Me(e).$implicit,i=fe(2);return Fe(i.openEditModal(o))}),I(2,"div",18),q(3,"i",19),T(4," Planned "),C(),I(5,"div",20),ye("click",function(o){let i=Me(e).$implicit,s=fe(2);return Fe(s.onDeleteTradeLog(i,o))}),q(6,"i",21),C(),I(7,"div",22)(8,"h4",23),T(9),C(),I(10,"h5",24),T(11),C(),I(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),T(16,"Analysis:"),C(),T(17),C(),I(18,"div",27)(19,"strong"),T(20,"Order:"),C(),T(21),C()(),I(22,"div",26)(23,"div",27)(24,"strong"),T(25,"Stop Loss:"),C(),T(26),C(),I(27,"div",27)(28,"strong"),T(29,"Take Profit:"),C(),T(30),C()(),I(31,"div",26)(32,"div",27)(33,"strong"),T(34,"Risk:"),C(),T(35),C(),I(36,"div",27)(37,"strong"),T(38,"Est. PnL:"),C(),T(39),C()(),I(40,"div",28)(41,"div",29)(42,"strong"),T(43,"Account:"),C(),T(44),C()()(),I(45,"div",30)(46,"small",31),T(47),gu(48,"date"),C()()()()()}if(t&2){let e=n.$implicit;B(9),dn(e.tradesymbol),B(2),yh(" ",e.tradetype," | ",e.instrumenttype," "),B(6),Ke(" ",e.analysistype," "),B(4),Ke(" ",e.typeoforder," "),B(5),Ke(" ",e.estimatedstoploss," "),B(4),Ke(" ",e.estimatedtakeprofit," "),B(5),Ke(" ",e.estimatedrisk," "),B(4),Ke(" ",e.estimatedpnl," "),B(5),Ke(" ",e.accountname," "),B(3),dn(yu(48,11,e.createdtime,"medium"))}}function zne(t,n){if(t&1&&(I(0,"div",14),ce(1,Bne,49,14,"div",15),C()),t&2){let e=fe();B(),X("ngForOf",e.tradeLogs)}}function Une(t,n){t&1&&(I(0,"div",32),T(1," No trade logs found. "),C())}function jne(t,n){if(t&1){let e=Ft();I(0,"div",33),ye("click",function(o){Me(e);let i=fe();return Fe(i.closeModalOnOverlayClick(o))}),I(1,"div",34),ye("click",function(o){return Me(e),Fe(o.stopPropagation())}),I(2,"app-pre-trade-log",35),ye("formSubmitted",function(){Me(e);let o=fe();return Fe(o.onFormSubmitted())})("cancel",function(){Me(e);let o=fe();return Fe(o.closeModal())}),C()()()}if(t&2){let e=fe();B(2),X("tradeLogData",e.selectedTradeLog)}}var W0=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="pretrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName)}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(re(Ut),re(zt))};static \u0275cmp=Mt({type:t,selectors:[["app-pre-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/pretradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click"],[1,"trade-status-indicator","status-planned"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(I(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),T(5,"Dashboard"),C()(),I(6,"li",5),T(7,"Pre-Trade Logs"),C(),I(8,"li",3)(9,"a",6),T(10,"Pre-Trading Journal"),C()()()(),I(11,"h2"),T(12,"Pre Trade Logs"),C(),ce(13,Lne,2,0,"div",7)(14,Vne,2,1,"div",8)(15,zne,2,1,"div",9)(16,Une,2,0,"div",10),C(),ce(17,jne,3,1,"div",11)),e&2&&(B(13),X("ngIf",r.loading),B(),X("ngIf",r.errorMessage),B(),X("ngIf",r.tradeLogs&&r.tradeLogs.length),B(),X("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),B(),X("ngIf",r.showModal))},dependencies:[Bi,rn,jr,xn,Ep,rf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease;border-left:4px solid #6c757d!important}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-planned[_ngcontent-%COMP%]{background-color:#6c757d}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0})};function Gne(t,n){if(t&1&&(I(0,"div",131),q(1,"div",132),C()),t&2){let e=fe();B(),Cp("width",e.calculateFormProgress()+"%")}}function Wne(t,n){if(t&1&&(I(0,"span",133),T(1),C()),t&2){let e=fe();B(),Ke("",e.calculateFormProgress(),"% Complete")}}function Hne(t,n){t&1&&(I(0,"div",134),T(1," Account name is required "),C())}function qne(t,n){t&1&&(I(0,"div",134),T(1," Please select an instrument type "),C())}function Kne(t,n){t&1&&(I(0,"div",134),T(1," Please select an analysis type "),C())}function Xne(t,n){t&1&&(I(0,"div",134),T(1," Trade symbol is required "),C())}function Yne(t,n){t&1&&(I(0,"div",134),T(1," Please select trade direction "),C())}function Zne(t,n){t&1&&(I(0,"div",134),T(1," Time frame selection is required "),C())}function Qne(t,n){t&1&&(I(0,"div",134),T(1," Strategy name is required "),C())}function Jne(t,n){t&1&&(I(0,"div",134),T(1," Order type is required "),C())}function ere(t,n){t&1&&(I(0,"div",134),T(1," Entry date/time is required "),C())}function tre(t,n){t&1&&(I(0,"div",134),T(1," Exit date/time is required "),C())}function nre(t,n){t&1&&(I(0,"div",134),T(1," Valid entry price is required "),C())}function rre(t,n){t&1&&(I(0,"div",134),T(1," Valid exit price is required "),C())}function ore(t,n){t&1&&(I(0,"div",134),T(1," Position size is required "),C())}function ire(t,n){t&1&&(I(0,"div",134),T(1," Please select trade outcome "),C())}function sre(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Trade Details"),C())}function are(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Strategy Information"),C())}function lre(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Trade Execution"),C())}function cre(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Trade Outcome"),C())}function ure(t,n){t&1&&(I(0,"li"),T(1,"Complete all required fields in Post-Trade Analysis"),C())}function dre(t,n){if(t&1&&(I(0,"div",135),q(1,"i",136),I(2,"strong"),T(3,"Please fix the errors highlighted above before submitting."),C(),I(4,"ul",137),ce(5,sre,2,0,"li",138)(6,are,2,0,"li",138)(7,lre,2,0,"li",138)(8,cre,2,0,"li",138)(9,ure,2,0,"li",138),C()()),t&2){let e=fe();B(5),X("ngIf",e.hasErrors("tradeDetails")),B(),X("ngIf",e.hasErrors("strategyInformation")),B(),X("ngIf",e.hasErrors("tradeExecution")),B(),X("ngIf",e.hasErrors("tradeOutcome")),B(),X("ngIf",e.hasErrors("postTradeAnalysis"))}}function pre(t,n){if(t&1){let e=Ft();I(0,"button",99),ye("click",function(){Me(e);let o=fe();return Fe(o.onCancel())}),q(1,"i",139),T(2,"Cancel "),C()}}function fre(t,n){if(t&1&&(I(0,"div",140),q(1,"i",141),T(2),C()),t&2){let e=fe();B(2),Ke("",e.message," ")}}function mre(t,n){if(t&1&&(I(0,"div",142),q(1,"i",136),T(2),C()),t&2){let e=fe();B(2),Ke("",e.errorMessage," ")}}var of=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabaseService=r}tradeLogData=null;formSubmitted=new Bt;cancel=new Bt;tableName="posttrade";postTradeForm;message="";errorMessage="";formSubmitMarker=!1;tradeOutcomes=["Win","Loss","Breakeven"];tradeDirections=["Long","Short"];ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=Pu();this.postTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[new Date().toISOString(),Ce.required],accountname:[this.tradeLogData?.accountname,[Ce.required,Ce.maxLength(255)]],accountbalance:[this.tradeLogData?.accountbalance??""],instrumenttype:[this.tradeLogData?.instrumenttype??"",[Ce.required,Ce.maxLength(50)]],analysistype:[this.tradeLogData?.analysistype??"",[Ce.required,Ce.maxLength(100)]],tradesymbol:[this.tradeLogData?.tradesymbol??"",[Ce.required,Ce.maxLength(50)]],tradetype:[this.tradeLogData?.tradetype??"",[Ce.required,Ce.maxLength(50)]],timeframe:[this.tradeLogData?.timeframe??"",[Ce.required,Ce.maxLength(50)]],entrydatetime:[this.tradeLogData?.entrydatetime??"",Ce.required],strategyname:[this.tradeLogData?.strategyname??"",[Ce.required,Ce.maxLength(255)]],typeoforder:[this.tradeLogData?.typeoforder??"",[Ce.required,Ce.maxLength(50)]],exitstrategy:[this.tradeLogData?.exitstrategy??""],entryprice:[this.tradeLogData?.entryprice??"",[Ce.required,Ce.min(0)]],exitprice:[this.tradeLogData?.exitprice??"",[Ce.required,Ce.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",[Ce.required,Ce.maxLength(50)]],exitdatetime:[this.tradeLogData?.exitdatetime??"",Ce.required],tradeoutcome:[this.tradeLogData?.tradeoutcome??"",Ce.required],profitlossamount:[this.tradeLogData?.profitlossamount??""],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],emotionalstateafter:[this.tradeLogData?.emotionalstateafter??""],emotionalimpactondecision:[this.tradeLogData?.emotionalimpactondecision??""],whatwentwell:[this.tradeLogData?.whatwentwell??""],whatcouldimprove:[this.tradeLogData?.whatcouldimprove??""],notes:[this.tradeLogData?.notes??""],isopen:[this.tradeLogData?.isopen??!0,Ce.required],updatedtime:[new Date().toDateString(),Ce.required]})}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.postTradeForm.patchValue({setupScreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.postTradeForm.invalid){this.postTradeForm.markAllAsTouched();return}let n=this.postTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.tableName):await this.supabaseService.addTradeLog(n,this.tableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.postTradeForm.reset(),this.postTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.tableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateProfitLoss(){let n=this.postTradeForm.get("entryprice")?.value,e=this.postTradeForm.get("exitprice")?.value,r=parseFloat(this.postTradeForm.get("positionsize")?.value),o=this.postTradeForm.get("tradetype")?.value;if(n&&e&&r&&o){let i=0;o==="Long"?i=(e-n)*r:o==="Short"&&(i=(n-e)*r),this.postTradeForm.get("profitlossamount")?.setValue(i.toFixed(2)),i>0?this.postTradeForm.get("tradeoutcome")?.setValue("Win"):i<0?this.postTradeForm.get("tradeoutcome")?.setValue("Loss"):this.postTradeForm.get("tradeoutcome")?.setValue("Breakeven")}}calculateFormProgress(){let n=Object.keys(this.postTradeForm.controls).filter(r=>this.postTradeForm.get(r)?.validator!==null),e=n.filter(r=>this.postTradeForm.get(r)?.valid);return Math.round(e.length/n.length*100)}hasErrors(n){let e=!1,r={tradeDetails:["accountname","instrumenttype","analysistype","tradesymbol","tradetype","timeframe"],strategyInformation:["strategyname","typeoforder"],tradeExecution:["entrydatetime","exitdatetime","entryprice","exitprice","positionsize"],tradeOutcome:["tradeoutcome"],postTradeAnalysis:["emotionalstateafter","whatwentwell","whatcouldimprove"]};return r[n]&&r[n].forEach(o=>{this.postTradeForm.get(o)?.invalid&&(e=!0)}),e}static \u0275fac=function(e){return new(e||t)(re(Dl),re(zt),re(Ut))};static \u0275cmp=Mt({type:t,selectors:[["app-post-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:299,vars:23,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["routerLink","/posttrades"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Describe the exit strategy you implemented","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","exitdatetime",1,"form-label"],["type","datetime-local","id","exitdatetime","formControlName","exitdatetime",1,"form-control"],[1,"col-md-4"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Actual entry price",1,"form-control"],["for","exitprice",1,"form-label"],["type","number","id","exitprice","formControlName","exitprice","step","0.01","min","0","placeholder","Actual exit price",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],[1,"bi","bi-4-circle","me-2"],["for","tradeoutcome",1,"form-label"],["role","group","aria-label","Trade outcome",1,"btn-group","w-100"],["type","radio","name","tradeoutcome","id","tradeoutcome_win","value","Win","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_win",1,"btn","btn-outline-success"],["type","radio","name","tradeoutcome","id","tradeoutcome_loss","value","Loss","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_loss",1,"btn","btn-outline-danger"],["type","radio","name","tradeoutcome","id","tradeoutcome_breakeven","value","Breakeven","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_breakeven",1,"btn","btn-outline-warning"],["for","profitlossamount",1,"form-label"],["type","number","step","0.01","id","profitlossamount","formControlName","profitlossamount","placeholder","e.g. 50.25 or -30.50",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-6-circle","me-2"],["for","emotionalstateafter",1,"form-label"],["id","emotionalstateafter","formControlName","emotionalstateafter",1,"form-select"],["value","Satisfied"],["value","Excited"],["value","Relieved"],["value","Disappointed"],["value","Frustrated"],["value","Neutral"],["value","Angry"],["for","emotionalimpactondecision",1,"form-label"],["id","emotionalimpactondecision","formControlName","emotionalimpactondecision","placeholder","How did your emotions affect your trading decisions?","rows","3",1,"form-control"],["for","whatwentwell",1,"form-label"],["id","whatwentwell","formControlName","whatwentwell","placeholder","What aspects of this trade did you execute correctly?","rows","3",1,"form-control"],["for","whatcouldimprove",1,"form-label"],["id","whatcouldimprove","formControlName","whatcouldimprove","placeholder","What could you have done better in this trade?","rows","3",1,"form-control"],["for","isopen",1,"form-label"],[1,"form-check","form-switch"],["type","checkbox","id","isopen","formControlName","isopen",1,"form-check-input"],["for","isopen",1,"form-check-label"],[1,"bi","bi-7-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(I(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),T(5,"Dashboard"),C()(),I(6,"li",3)(7,"a",5),T(8,"Trade Logs"),C()(),I(9,"li",6),T(10,"Post-Trading Journal"),C()()(),I(11,"div",7)(12,"div",8)(13,"h2",9),T(14),C(),I(15,"p",10),T(16,"Document your completed trades to analyze performance and improve your strategy"),C()(),I(17,"div",11),ce(18,Gne,2,2,"div",12)(19,Wne,2,1,"span",13),C()(),I(20,"form",14),ye("ngSubmit",function(){return r.onSubmit()}),I(21,"div",15)(22,"div",16)(23,"h5",17),q(24,"i",18),T(25,"Trade Details "),C(),I(26,"span",19),T(27,"Required"),C()(),I(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),T(32,"Account Name"),C(),I(33,"div",24)(34,"span",25),q(35,"i",26),C(),q(36,"input",27),C(),ce(37,Hne,2,0,"div",28),C(),I(38,"div",22)(39,"label",29),T(40,"Account Balance"),C(),I(41,"div",24)(42,"span",25),T(43,"$"),C(),q(44,"input",30),C()(),I(45,"div",22)(46,"label",31),T(47,"Instrument Type"),C(),I(48,"select",32)(49,"option",33),T(50,"Choose instrument type"),C(),I(51,"option",34),T(52,"Forex"),C(),I(53,"option",35),T(54,"Stocks"),C(),I(55,"option",36),T(56,"Futures"),C(),I(57,"option",37),T(58,"Crypto"),C(),I(59,"option",38),T(60,"Options"),C(),I(61,"option",39),T(62,"ETF"),C(),I(63,"option",40),T(64,"Other"),C()(),ce(65,qne,2,0,"div",28),C(),I(66,"div",22)(67,"label",41),T(68,"Analysis Type"),C(),I(69,"select",42)(70,"option",33),T(71,"Choose analysis method"),C(),I(72,"option",43),T(73,"Technical"),C(),I(74,"option",44),T(75,"Fundamental"),C(),I(76,"option",45),T(77,"Both"),C(),I(78,"option",46),T(79,"Sentiment"),C(),I(80,"option",40),T(81,"Other"),C()(),ce(82,Kne,2,0,"div",28),C(),I(83,"div",22)(84,"label",47),T(85,"Trade Symbol"),C(),I(86,"div",24)(87,"span",25),q(88,"i",48),C(),q(89,"input",49),C(),ce(90,Xne,2,0,"div",28),C(),I(91,"div",22)(92,"label",50),T(93,"Trade Direction"),C(),I(94,"div",51),q(95,"input",52),I(96,"label",53),T(97,"Long"),C(),q(98,"input",54),I(99,"label",55),T(100,"Short"),C()(),ce(101,Yne,2,0,"div",28),C(),I(102,"div",22)(103,"label",56),T(104,"Time Frame"),C(),I(105,"select",57)(106,"option",33),T(107,"Select time frame"),C(),I(108,"option",58),T(109,"Scalp (minutes)"),C(),I(110,"option",59),T(111,"Day Trade (hours)"),C(),I(112,"option",60),T(113,"Swing (days-weeks)"),C(),I(114,"option",61),T(115,"Position (weeks-months)"),C(),I(116,"option",62),T(117,"Long Term (months+)"),C()(),ce(118,Zne,2,0,"div",28),C()()()(),I(119,"div",15)(120,"div",16)(121,"h5",17),q(122,"i",63),T(123,"Strategy Information "),C(),I(124,"span",19),T(125,"Required"),C()(),I(126,"div",20)(127,"div",21)(128,"div",22)(129,"label",64),T(130,"Strategy Name"),C(),q(131,"input",65),ce(132,Qne,2,0,"div",28),C(),I(133,"div",22)(134,"label",66),T(135,"Type of Order"),C(),I(136,"select",67)(137,"option",33),T(138,"Choose order type"),C(),I(139,"option",68),T(140,"Market"),C(),I(141,"option",69),T(142,"Limit"),C(),I(143,"option",70),T(144,"Stop"),C(),I(145,"option",71),T(146,"Stop Limit"),C(),I(147,"option",72),T(148,"Trailing Stop"),C()(),ce(149,Jne,2,0,"div",28),C(),I(150,"div",73)(151,"label",74),T(152,"Exit Strategy Used"),C(),q(153,"textarea",75),C()()()(),I(154,"div",15)(155,"div",16)(156,"h5",17),q(157,"i",76),T(158,"Trade Execution "),C(),I(159,"span",19),T(160,"Required"),C()(),I(161,"div",20)(162,"div",21)(163,"div",22)(164,"label",77),T(165,"Entry Date/Time"),C(),q(166,"input",78),ce(167,ere,2,0,"div",28),C(),I(168,"div",22)(169,"label",79),T(170,"Exit Date/Time"),C(),q(171,"input",80),ce(172,tre,2,0,"div",28),C(),I(173,"div",81)(174,"label",82),T(175,"Entry Price"),C(),I(176,"div",24)(177,"span",25),T(178,"$"),C(),q(179,"input",83),C(),ce(180,nre,2,0,"div",28),C(),I(181,"div",81)(182,"label",84),T(183,"Exit Price"),C(),I(184,"div",24)(185,"span",25),T(186,"$"),C(),q(187,"input",85),C(),ce(188,rre,2,0,"div",28),C(),I(189,"div",81)(190,"label",86),T(191,"Position Size"),C(),I(192,"div",24),q(193,"input",87),C(),ce(194,ore,2,0,"div",28),C()()()(),I(195,"div",15)(196,"div",16)(197,"h5",17),q(198,"i",88),T(199,"Trade Outcome "),C(),I(200,"span",19),T(201,"Required"),C()(),I(202,"div",20)(203,"div",21)(204,"div",22)(205,"label",89),T(206,"Trade Result"),C(),I(207,"div",90),q(208,"input",91),I(209,"label",92),T(210,"Win"),C(),q(211,"input",93),I(212,"label",94),T(213,"Loss"),C(),q(214,"input",95),I(215,"label",96),T(216,"Breakeven"),C()(),ce(217,ire,2,0,"div",28),C(),I(218,"div",22)(219,"label",97),T(220,"Profit/Loss Amount"),C(),I(221,"div",24)(222,"span",25),T(223,"$"),C(),q(224,"input",98),I(225,"button",99),ye("click",function(){return r.calculateProfitLoss()}),T(226," Calculate "),C()()()()()(),I(227,"div",15)(228,"div",16)(229,"h5",17),q(230,"i",100),T(231,"Post-Trade Analysis "),C(),I(232,"span",19),T(233,"Required"),C()(),I(234,"div",20)(235,"div",21)(236,"div",22)(237,"label",101),T(238,"Emotional State After Trade"),C(),I(239,"select",102)(240,"option",33),T(241,"How do you feel now?"),C(),I(242,"option",103),T(243,"Satisfied"),C(),I(244,"option",104),T(245,"Excited"),C(),I(246,"option",105),T(247,"Relieved"),C(),I(248,"option",106),T(249,"Disappointed"),C(),I(250,"option",107),T(251,"Frustrated"),C(),I(252,"option",108),T(253,"Neutral"),C(),I(254,"option",109),T(255,"Angry"),C(),I(256,"option",40),T(257,"Other"),C()()(),I(258,"div",73)(259,"label",110),T(260,"Emotional Impact on Decisions"),C(),q(261,"textarea",111),C(),I(262,"div",73)(263,"label",112),T(264,"What Went Well"),C(),q(265,"textarea",113),C(),I(266,"div",73)(267,"label",114),T(268,"Areas for Improvement"),C(),q(269,"textarea",115),C(),I(270,"div",22)(271,"label",116),T(272,"Trade Status"),C(),I(273,"div",117),q(274,"input",118),I(275,"label",119),T(276,"This position is still open"),C()()()()()(),I(277,"div",15)(278,"div",16)(279,"h5",17),q(280,"i",120),T(281,"Additional Notes "),C(),I(282,"span",121),T(283,"Optional"),C()(),I(284,"div",20)(285,"div",21)(286,"div",73)(287,"label",122),T(288,"Notes"),C(),q(289,"textarea",123),C()()()(),ce(290,dre,10,5,"div",124),I(291,"div",125),ce(292,pre,3,0,"button",126),I(293,"div")(294,"button",127),q(295,"i",128),T(296),C()()(),ce(297,fre,3,1,"div",129)(298,mre,3,1,"div",130),C()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,y;B(14),dn(r.tradeLogData?"Edit Post-Trading Journal":"Create Post-Trading Journal"),B(4),X("ngIf",!r.tradeLogData),B(),X("ngIf",!r.tradeLogData),B(),X("formGroup",r.postTradeForm),B(17),X("ngIf",((o=r.postTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.postTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.postTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),B(28),X("ngIf",((i=r.postTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.postTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.postTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),B(17),X("ngIf",((s=r.postTradeForm.get("analysistype"))==null?null:s.invalid)&&(((s=r.postTradeForm.get("analysistype"))==null?null:s.dirty)||((s=r.postTradeForm.get("analysistype"))==null?null:s.touched)||r.formSubmitMarker)),B(8),X("ngIf",((a=r.postTradeForm.get("tradesymbol"))==null?null:a.invalid)&&(((a=r.postTradeForm.get("tradesymbol"))==null?null:a.dirty)||((a=r.postTradeForm.get("tradesymbol"))==null?null:a.touched)||r.formSubmitMarker)),B(11),X("ngIf",((l=r.postTradeForm.get("tradetype"))==null?null:l.invalid)&&(((l=r.postTradeForm.get("tradetype"))==null?null:l.dirty)||((l=r.postTradeForm.get("tradetype"))==null?null:l.touched)||r.formSubmitMarker)),B(17),X("ngIf",((c=r.postTradeForm.get("timeframe"))==null?null:c.invalid)&&(((c=r.postTradeForm.get("timeframe"))==null?null:c.dirty)||((c=r.postTradeForm.get("timeframe"))==null?null:c.touched)||r.formSubmitMarker)),B(14),X("ngIf",((u=r.postTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.postTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.postTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),B(17),X("ngIf",((d=r.postTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.postTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.postTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),B(18),X("ngIf",((p=r.postTradeForm.get("entrydatetime"))==null?null:p.invalid)&&(((p=r.postTradeForm.get("entrydatetime"))==null?null:p.dirty)||((p=r.postTradeForm.get("entrydatetime"))==null?null:p.touched)||r.formSubmitMarker)),B(5),X("ngIf",((f=r.postTradeForm.get("exitdatetime"))==null?null:f.invalid)&&(((f=r.postTradeForm.get("exitdatetime"))==null?null:f.dirty)||((f=r.postTradeForm.get("exitdatetime"))==null?null:f.touched)||r.formSubmitMarker)),B(8),X("ngIf",((m=r.postTradeForm.get("entryprice"))==null?null:m.invalid)&&(((m=r.postTradeForm.get("entryprice"))==null?null:m.dirty)||((m=r.postTradeForm.get("entryprice"))==null?null:m.touched)||r.formSubmitMarker)),B(8),X("ngIf",((h=r.postTradeForm.get("exitprice"))==null?null:h.invalid)&&(((h=r.postTradeForm.get("exitprice"))==null?null:h.dirty)||((h=r.postTradeForm.get("exitprice"))==null?null:h.touched)||r.formSubmitMarker)),B(6),X("ngIf",((g=r.postTradeForm.get("positionsize"))==null?null:g.invalid)&&(((g=r.postTradeForm.get("positionsize"))==null?null:g.dirty)||((g=r.postTradeForm.get("positionsize"))==null?null:g.touched)||r.formSubmitMarker)),B(23),X("ngIf",((y=r.postTradeForm.get("tradeoutcome"))==null?null:y.invalid)&&(((y=r.postTradeForm.get("tradeoutcome"))==null?null:y.dirty)||((y=r.postTradeForm.get("tradeoutcome"))==null?null:y.touched)||r.formSubmitMarker)),B(73),X("ngIf",r.formSubmitMarker&&r.postTradeForm.invalid),B(2),X("ngIf",r.tradeLogData),B(4),Ke("",r.tradeLogData?"Update":"Submit"," "),B(),X("ngIf",r.message),B(),X("ngIf",r.errorMessage)}},dependencies:[rn,xn,Hi,Gi,ef,tf,pr,Mu,Ig,_l,Tg,qr,ji,Eg,Wi,Ls,Bi],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};var hre=(t,n,e)=>({"open-trade":t,"win-trade":n,"loss-trade":e}),gre=(t,n,e)=>({"status-open":t,"status-win":n,"status-loss":e}),yre=(t,n,e)=>({"bi-clock-history":t,"bi-check-circle":n,"bi-x-circle":e}),xre=(t,n,e)=>({"text-success":t,"text-danger":n,"text-secondary":e});function vre(t,n){t&1&&(I(0,"div",12),T(1,"Loading trade logs..."),C())}function bre(t,n){if(t&1&&(I(0,"div",13),T(1),C()),t&2){let e=fe();B(),dn(e.errorMessage)}}function wre(t,n){if(t&1){let e=Ft();I(0,"div",16)(1,"div",17),ye("click",function(){let o=Me(e).$implicit,i=fe(2);return Fe(i.openEditModal(o))}),I(2,"div",18),q(3,"i",19),T(4),C(),I(5,"div",20),ye("click",function(o){let i=Me(e).$implicit,s=fe(2);return Fe(s.onDeleteTradeLog(i,o))}),q(6,"i",21),C(),I(7,"div",22)(8,"h4",23),T(9),C(),I(10,"h5",24),T(11),C(),I(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),T(16,"Strategy:"),C(),T(17),C(),I(18,"div",27)(19,"strong"),T(20,"Analysis:"),C(),T(21),C()(),I(22,"div",26)(23,"div",27)(24,"strong"),T(25,"Entry:"),C(),T(26),C(),I(27,"div",27)(28,"strong"),T(29,"Exit:"),C(),T(30),C()(),I(31,"div",26)(32,"div",27)(33,"strong"),T(34,"Date:"),C(),T(35),gu(36,"date"),C(),I(37,"div",27)(38,"strong"),T(39,"Account:"),C(),T(40),C()(),I(41,"div",28)(42,"div",29)(43,"strong"),T(44,"P/L:"),C(),I(45,"span",30),T(46),C()()()(),I(47,"div",31)(48,"small",32),T(49),gu(50,"date"),C()()()()()}if(t&2){let e=n.$implicit;B(),X("ngClass",hu(23,hre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),B(),X("ngClass",hu(27,gre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),B(),X("ngClass",hu(31,yre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),B(),Ke(" ",e.isopen?"In Progress":e.tradeoutcome," "),B(5),dn(e.tradesymbol),B(2),xh(" ",e.tradetype," | ",e.instrumenttype," | ",e.timeframe," "),B(6),Ke(" ",e.strategyname," "),B(4),Ke(" ",e.analysistype," "),B(5),Ke(" ",e.entryprice," "),B(4),Ke(" ",e.isopen?"Pending":e.exitprice," "),B(5),Ke(" ",yu(36,17,e.entrydatetime,"shortDate")," "),B(5),Ke(" ",e.accountname," "),B(5),X("ngClass",hu(35,xre,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss",e.isopen)),B(),Ke(" ",e.isopen?"Trade in progress":e.profitlossamount," "),B(3),dn(yu(50,20,e.createdtime,"medium"))}}function Cre(t,n){if(t&1&&(I(0,"div",14),ce(1,wre,51,39,"div",15),C()),t&2){let e=fe();B(),X("ngForOf",e.tradeLogs)}}function Ire(t,n){t&1&&(I(0,"div",33),T(1," No trade logs found. "),C())}function Sre(t,n){if(t&1){let e=Ft();I(0,"div",34),ye("click",function(o){Me(e);let i=fe();return Fe(i.closeModalOnOverlayClick(o))}),I(1,"div",35),ye("click",function(o){return Me(e),Fe(o.stopPropagation())}),I(2,"app-post-trade-log",36),ye("formSubmitted",function(){Me(e);let o=fe();return Fe(o.onFormSubmitted())})("cancel",function(){Me(e);let o=fe();return Fe(o.closeModal())}),C()()()}if(t&2){let e=fe();B(2),X("tradeLogData",e.selectedTradeLog)}}var H0=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="posttrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.detectChanges()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName),this.cdr.detectChanges()}catch(n){console.error("Error fetching trade logs",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(re(Ut),re(zt))};static \u0275cmp=Mt({type:t,selectors:[["app-post-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/posttradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[3,"ngClass"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(I(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),T(5,"Dashboard"),C()(),I(6,"li",5),T(7,"Post-Trade Logs"),C(),I(8,"li",3)(9,"a",6),T(10,"Post-Trading Journal"),C()()()(),I(11,"h2"),T(12,"Post Trade Logs"),C(),ce(13,vre,2,0,"div",7)(14,bre,2,1,"div",8)(15,Cre,2,1,"div",9)(16,Ire,2,0,"div",10),C(),ce(17,Sre,3,1,"div",11)),e&2&&(B(13),X("ngIf",r.loading),B(),X("ngIf",r.errorMessage),B(),X("ngIf",r.tradeLogs&&r.tradeLogs.length),B(),X("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),B(),X("ngIf",r.showModal))},dependencies:[Bi,rn,Li,jr,xn,Ep,of],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.open-trade[_ngcontent-%COMP%]{border-left:4px solid #17a2b8!important}.win-trade[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.loss-trade[_ngcontent-%COMP%]{border-left:4px solid #dc3545!important}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-open[_ngcontent-%COMP%]{background-color:#17a2b8}.status-win[_ngcontent-%COMP%]{background-color:#28a745}.status-loss[_ngcontent-%COMP%]{background-color:#dc3545}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"]})};var Tre=(t,n)=>({"alert-success":t,"alert-danger":n});function Ere(t,n){if(t&1&&(I(0,"div",9),T(1),C()),t&2){let e=fe();X("ngClass",Ip(2,Tre,e.messageType==="success",e.messageType==="error")),B(),Ke(" ",e.message," ")}}function _re(t,n){if(t&1){let e=Ft();I(0,"tr",10)(1,"td")(2,"input",11),Ns("ngModelChange",function(o){let i=Me(e).$implicit;return fl(i.question_text,o)||(i.question_text=o),Fe(o)}),ye("change",function(){let o=Me(e).$implicit,i=fe();return Fe(i.onQuestionChange(o))}),C(),I(3,"button",12),ye("click",function(){let o=Me(e).$implicit,i=fe();return Fe(i.deleteQuestion(o))}),T(4," Delete "),C()(),I(5,"td")(6,"div",13)(7,"input",14),Ns("ngModelChange",function(o){let i=Me(e).$implicit;return fl(i.active,o)||(i.active=o),Fe(o)}),ye("change",function(){let o=Me(e).$implicit,i=fe();return Fe(i.onQuestionChange(o))}),C()()()()}if(t&2){let e=n.$implicit;B(2),Ds("ngModel",e.question_text),B(5),Ds("ngModel",e.active)}}var q0=class t{constructor(n,e){this.cdr=n;this.supabaseService=e}questions=[];newQuestionText="";message="";messageType="success";async ngOnInit(){this.questions=await this.supabaseService.adminLoadQuestions(),this.cdr.markForCheck()}onQuestionChange(n){n.isModified=!0}addQuestion(){if(!this.newQuestionText.trim())return;let n={question_text:this.newQuestionText.trim(),active:!0,isModified:!0};this.questions.push(n),this.newQuestionText="",this.cdr.detectChanges()}async saveChanges(){let{error:n}=await this.supabaseService.adminSaveQuestions(this.questions);n?(console.error("Error saving questions:",n),this.showMessage("Error saving questions","error")):this.showMessage("Questions saved successfully","success"),this.cdr.detectChanges()}async deleteQuestion(n){if(!n.question_id){this.questions=this.questions.filter(r=>r!==n),this.showMessage("Question removed locally","success"),this.cdr.markForCheck();return}let{error:e}=await this.supabaseService.deleteQuestion(n);e?(console.error("Error deleting question:",e),this.showMessage("Error deleting question","error")):(this.questions=this.questions.filter(r=>r.question_id!==n.question_id),this.showMessage("Question deleted successfully","success")),this.cdr.markForCheck()}showMessage(n,e){this.message=n,this.messageType=e,setTimeout(()=>{this.message="",this.cdr.markForCheck()},4e3)}hasChanges(){return this.questions.some(n=>n.isModified)}static \u0275fac=function(e){return new(e||t)(re(zt),re(Ut))};static \u0275cmp=Mt({type:t,selectors:[["app-admin-emotion-dashboard"]],decls:22,vars:4,consts:[[1,"container","mt-4"],["class","alert",3,"ngClass",4,"ngIf"],[1,"table"],["class","question-row",4,"ngFor","ngForOf"],[1,"mb-3"],["type","text","placeholder","Enter question",1,"form-control",3,"ngModelChange","ngModel"],[1,"mb-3","d-flex","justify-content-between","align-items-center"],[1,"btn","btn-tr","btn-primary","mt-2",3,"click"],[1,"btn","btn-tr","mt-2",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"question-row"],["type","text",1,"form-control",3,"ngModelChange","change","ngModel"],["type","button",1,"btn","btn-danger","btn-tr","btn-sm","delete-button",3,"click"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"]],template:function(e,r){e&1&&(I(0,"div",0),ce(1,Ere,2,5,"div",1),I(2,"h1"),T(3,"Admin Dashboard - Manage Questions"),C(),I(4,"table",2)(5,"thead")(6,"tr")(7,"th"),T(8,"Question Text"),C(),I(9,"th"),T(10,"Active"),C()()(),I(11,"tbody"),ce(12,_re,8,2,"tr",3),C()(),I(13,"div",4)(14,"h4"),T(15,"Add New Question"),C(),I(16,"input",5),Ns("ngModelChange",function(i){return fl(r.newQuestionText,i)||(r.newQuestionText=i),i}),C()(),I(17,"div",6)(18,"button",7),ye("click",function(){return r.addQuestion()}),T(19,"Add Question"),C(),I(20,"button",8),ye("click",function(){return r.saveChanges()}),T(21,"Save Changes"),C()()()),e&2&&(B(),X("ngIf",r.message),B(11),X("ngForOf",r.questions),B(4),Ds("ngModel",r.newQuestionText),B(4),X("disabled",!r.hasChanges()))},dependencies:[nf,pr,Ig,qr,Ou,rn,Li,jr,xn],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.question-row[_ngcontent-%COMP%]{position:relative}.delete-button[_ngcontent-%COMP%]{display:none;position:absolute;right:10px;top:50%;transform:translateY(-50%)}.question-row[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{display:block}.alert[_ngcontent-%COMP%]{padding:10px 20px;margin-bottom:15px;border-radius:4px;text-align:center}"]})};var Dre=(t,n)=>({"alert-success":t,"alert-danger":n});function Nre(t,n){if(t&1&&(I(0,"div",4),T(1),C()),t&2){let e=fe();X("ngClass",Ip(2,Dre,e.messageType==="success",e.messageType==="error")),B(),Ke(" ",e.message," ")}}function kre(t,n){if(t&1){let e=Ft();I(0,"div",5)(1,"label",6),T(2),C(),I(3,"textarea",7),Ns("ngModelChange",function(o){let i=Me(e).$implicit;return fl(i.answer,o)||(i.answer=o),Fe(o)}),T(4,"        "),C()()}if(t&2){let e=n.$implicit;B(2),dn(e.question_text),B(),eE("name",e.question_id),Ds("ngModel",e.answer)}}var K0=class t{constructor(n,e,r){this.supabaseService=n;this.cdr=e;this.router=r}questions=[];message="";messageType="success";ngOnInit(){this.loadQuestions()}async loadQuestions(){let{data:n,error:e}=await this.supabaseService.getActiveQuestions();e?(console.error("Error loading questions:",e),this.message="Error loading questions.",this.messageType="error"):n&&(this.questions=n),this.cdr.markForCheck()}allQuestionsAnswered(){return this.questions.every(n=>n.answer&&n.answer.trim().length>0)}async submitAnswers(){if(!this.allQuestionsAnswered()){this.message="Please answer all questions before submitting.",this.messageType="error",this.cdr.markForCheck();return}let n=this.supabaseService.user()?.id;if(!n){this.message="User not authenticated.",this.messageType="error",this.cdr.markForCheck();return}let e=this.questions.map(o=>({question_id:o.question_id,answer:o.answer.trim(),user_id:n})),{error:r}=await this.supabaseService.submitUserAnswers(e);r?(console.error("Error submitting answers:",r),this.message="Error submitting answers.",this.messageType="error"):(this.message="Answers submitted successfully. redirecting in 5 seconds.",this.messageType="success"),this.cdr.markForCheck(),setTimeout(()=>{this.router.navigateByUrl("/home")},5e3)}static \u0275fac=function(e){return new(e||t)(re(Ut),re(zt),re(co))};static \u0275cmp=Mt({type:t,selectors:[["app-user-emotion-questionnaire"]],decls:8,vars:3,consts:[[1,"container","mt-4"],["class","alert",3,"ngClass",4,"ngIf"],["class","mb-3",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-primary",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"mb-3"],[1,"form-label"],["rows","3","placeholder","Type your answer here...",1,"form-control",3,"ngModelChange","ngModel","name"]],template:function(e,r){e&1&&(I(0,"div",0),ce(1,Nre,2,5,"div",1),I(2,"h1"),T(3,"User Emotion Questionnaire"),C(),I(4,"form"),ce(5,kre,5,3,"div",2),I(6,"button",3),ye("click",function(){return r.submitAnswers()}),T(7," Submit Answers "),C()()()),e&2&&(B(),X("ngIf",r.message),B(4),X("ngForOf",r.questions),B(),X("disabled",!r.allQuestionsAnswered()))},dependencies:[nf,Gi,pr,qr,ji,Ou,K_,rn,Li,jr,xn],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.alert[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}h1[_ngcontent-%COMP%]{margin-bottom:20px}"]})};function Are(t,n){if(t&1&&(I(0,"div",13),T(1),C()),t&2){let e=fe();B(),Ke(" ",e.errorMessage," ")}}function Rre(t,n){t&1&&(I(0,"div",28),T(1," A valid email is required. "),C())}function Ore(t,n){t&1&&(I(0,"div",28),T(1," Password must be at least 6 characters. "),C())}function Mre(t,n){if(t&1){let e=Ft();I(0,"form",14),ye("ngSubmit",function(){Me(e);let o=fe();return Fe(o.onSubmit())}),I(1,"div",15)(2,"label",16),T(3,"Email"),C(),q(4,"input",17),ce(5,Rre,2,0,"div",18),C(),I(6,"div",15)(7,"label",19),T(8,"Password"),C(),q(9,"input",20),ce(10,Ore,2,0,"div",18),I(11,"div",21)(12,"a",22),T(13,"Forgot password?"),C()()(),I(14,"div",23)(15,"button",24),T(16,"Continue"),C()(),I(17,"div",25)(18,"p",26),T(19,"Don't have an account? "),I(20,"a",27),ye("click",function(){Me(e);let o=fe();return Fe(o.setActiveTab("signup"))}),T(21,"Sign up"),C()()()()}if(t&2){let e,r,o=fe();X("formGroup",o.signinForm),B(5),X("ngIf",((e=o.signinForm.get("email"))==null?null:e.invalid)&&((e=o.signinForm.get("email"))==null?null:e.touched)),B(5),X("ngIf",((r=o.signinForm.get("password"))==null?null:r.invalid)&&((r=o.signinForm.get("password"))==null?null:r.touched)),B(5),X("disabled",o.signinForm.invalid)}}function Fre(t,n){t&1&&(I(0,"small",43),T(1," First name is required "),C())}function Pre(t,n){t&1&&(I(0,"small",43),T(1," Last name is required "),C())}function $re(t,n){t&1&&(I(0,"small",43),T(1," Valid email is required "),C())}function Lre(t,n){t&1&&(I(0,"small",43),T(1," Password must be at least 6 characters "),C())}function Vre(t,n){t&1&&(I(0,"small",43),T(1," Passwords do not match "),C())}function Bre(t,n){if(t&1){let e=Ft();I(0,"form",14),ye("ngSubmit",function(){Me(e);let o=fe();return Fe(o.onSignupSubmit())}),I(1,"div",29)(2,"div",30)(3,"label",31),T(4,"First Name"),C(),q(5,"input",32),ce(6,Fre,2,0,"small",33),C(),I(7,"div",30)(8,"label",34),T(9,"Last Name"),C(),q(10,"input",35),ce(11,Pre,2,0,"small",33),C()(),I(12,"div",15)(13,"label",36),T(14,"Email"),C(),q(15,"input",37),ce(16,$re,2,0,"small",33),C(),I(17,"div",15)(18,"label",38),T(19,"Password"),C(),q(20,"input",39),ce(21,Lre,2,0,"small",33),C(),I(22,"div",15)(23,"label",40),T(24,"Confirm Password"),C(),q(25,"input",41),ce(26,Vre,2,0,"small",33),C(),I(27,"div",23)(28,"button",24),T(29,"Create Account"),C()(),I(30,"div",25)(31,"p",26),T(32,"Already have an account? "),I(33,"a",42),ye("click",function(){Me(e);let o=fe();return Fe(o.setActiveTab("login"))}),T(34,"Login"),C()()()()}if(t&2){let e,r,o,i,s,a=fe();X("formGroup",a.signupForm),B(6),X("ngIf",((e=a.signupForm.get("firstname"))==null?null:e.invalid)&&((e=a.signupForm.get("firstname"))==null?null:e.touched)),B(5),X("ngIf",((r=a.signupForm.get("lastname"))==null?null:r.invalid)&&((r=a.signupForm.get("lastname"))==null?null:r.touched)),B(5),X("ngIf",((o=a.signupForm.get("email"))==null?null:o.invalid)&&((o=a.signupForm.get("email"))==null?null:o.touched)),B(5),X("ngIf",((i=a.signupForm.get("password"))==null?null:i.invalid)&&((i=a.signupForm.get("password"))==null?null:i.touched)),B(5),X("ngIf",a.signupForm.hasError("mismatch")&&((s=a.signupForm.get("confirmPassword"))==null?null:s.touched)),B(2),X("disabled",a.signupForm.invalid)}}var X0=class t{constructor(n,e,r,o){this.fb=n;this.router=e;this.route=r;this.supabaseService=o;this.signinForm=this.fb.group({email:["",[Ce.required,Ce.email]],password:["",[Ce.required,Ce.minLength(6)]]}),this.signupForm=this.fb.group({firstname:["",Ce.required],lastname:["",Ce.required],email:["",[Ce.required,Ce.email]],password:["",[Ce.required,Ce.minLength(6)]],confirmPassword:["",Ce.required]},{validators:this.passwordMatchValidator})}activeTab="login";signinForm;signupForm;errorMessage=null;ngOnInit(){this.route.queryParams.subscribe(n=>{n.mode==="signup"&&(this.activeTab="signup")})}passwordMatchValidator(n){let e=n.get("password")?.value,r=n.get("confirmPassword")?.value;return e===r?null:{mismatch:!0}}setActiveTab(n){this.activeTab=n,this.errorMessage=null}async onSubmit(){if(this.signinForm.invalid){this.signinForm.markAllAsTouched();return}let{email:n,password:e}=this.signinForm.getRawValue();try{if(await this.supabaseService.signIn(n,e),!this.supabaseService.currentUsername()){this.errorMessage="Login failed. Please try again.";return}this.signinForm.reset();let r=this.route.snapshot.queryParams.returnUrl||"/home";this.router.navigateByUrl(r)}catch(r){this.errorMessage=r.message||"An unexpected error occurred."}}onSignupSubmit(){if(this.signupForm.invalid){this.signupForm.markAllAsTouched();return}let{email:n,password:e,firstname:r,lastname:o}=this.signupForm.getRawValue();this.supabaseService.signUp(n,e,r,o).then(()=>{this.signupForm.reset(),this.router.navigateByUrl("/home")}).catch(i=>{this.errorMessage=i.message||"An unexpected error occurred.",console.error(i)})}static \u0275fac=function(e){return new(e||t)(re(Dl),re(co),re(pi),re(Ut))};static \u0275cmp=Mt({type:t,selectors:[["app-login-signup"]],decls:20,vars:7,consts:[[1,"auth-container"],[1,"auth-card"],[1,"text-center","mb-4"],[1,"logo-circle","mx-auto"],["src","/trading-rehab-logo.png","alt","Logo",1,"img-fluid"],[1,"brand-name","mt-3"],[1,"brand-tagline"],[1,"auth-tabs","d-flex","justify-content-center","mb-4"],[1,"tabs-container"],[1,"tab",3,"click"],[1,"mx-2","tab-separator"],["class","alert alert-danger mb-3",4,"ngIf"],["class","auth-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"alert","alert-danger","mb-3"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Enter your email",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Enter your password",1,"form-control"],[1,"d-flex","justify-content-end","mt-2"],["href","#",1,"forgot-link"],[1,"d-grid","gap-2","mt-4"],["type","submit",1,"btn","btn-tr","btn-primary","btn-md",3,"disabled"],[1,"text-center","mt-4"],[1,"mb-0"],["href","javascript:void(0)",1,"signup-link",3,"click"],[1,"text-danger","small","mt-1"],[1,"row"],[1,"col-md-6","mb-3"],["for","firstname",1,"form-label"],["type","text","id","firstname","formControlName","firstname","placeholder","First name",1,"form-control"],["class","text-danger",4,"ngIf"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","placeholder","Last name",1,"form-control"],["for","signup-email",1,"form-label"],["type","email","id","signup-email","formControlName","email","placeholder","Enter your email",1,"form-control"],["for","signup-password",1,"form-label"],["type","password","id","signup-password","formControlName","password","placeholder","Create a password",1,"form-control"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm your password",1,"form-control"],["href","javascript:void(0)",1,"login-link",3,"click"],[1,"text-danger"]],template:function(e,r){e&1&&(I(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),q(4,"img",4),C(),I(5,"h2",5),T(6,"TRADING REHAB"),C(),I(7,"p",6),T(8,"Where Disciplined Trading Begins"),C()(),I(9,"div",7)(10,"div",8)(11,"span",9),ye("click",function(){return r.setActiveTab("login")}),T(12,"Login"),C(),I(13,"span",10),T(14,"\u2022"),C(),I(15,"span",9),ye("click",function(){return r.setActiveTab("signup")}),T(16,"Sign Up"),C()()(),ce(17,Are,2,1,"div",11)(18,Mre,22,4,"form",12)(19,Bre,35,7,"form",12),C()()),e&2&&(B(11),Pi("active",r.activeTab==="login"),B(4),Pi("active",r.activeTab==="signup"),B(2),X("ngIf",r.errorMessage),B(),X("ngIf",r.activeTab==="login"),B(),X("ngIf",r.activeTab==="signup"))},dependencies:[rn,xn,Hi,Gi,pr,qr,ji,Wi,Ls],styles:['.auth-container[_ngcontent-%COMP%]{min-height:100vh;background:conic-gradient(#eaeafd,#9c9ce4,#eaeafd);display:flex;align-items:center;justify-content:center}.auth-card[_ngcontent-%COMP%]{background-color:transparent;border-radius:12px;width:100%;max-width:450px;padding:30px}.logo-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:transparent;position:relative;display:flex;align-items:center;justify-content:center;margin:0 auto}.dots-circle[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;position:relative;background-image:radial-gradient(circle,#5046e5 3px,transparent 3px);background-size:15px 15px;transform:rotate(45deg)}.brand-name[_ngcontent-%COMP%]{font-weight:700;font-size:24px;margin-bottom:5px;letter-spacing:.5px}.brand-tagline[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.tabs-container[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-bottom:1px solid #eee;padding-bottom:5px}.tab[_ngcontent-%COMP%]{padding:8px 15px;cursor:pointer;color:#888;font-weight:500;font-size:16px;transition:color .2s}.tab.active[_ngcontent-%COMP%]{color:#5046e5;border-bottom:2px solid #5046e5}.tab-separator[_ngcontent-%COMP%]{color:#ccc}.auth-form[_ngcontent-%COMP%]{margin-top:10px}.form-control[_ngcontent-%COMP%]{height:auto;padding:12px 15px;border-radius:8px;border:1px solid #ddd;transition:border-color .2s,box-shadow .2s}.form-control[_ngcontent-%COMP%]:focus{border-color:#5046e5;box-shadow:0 0 0 .2rem #5046e526}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#555;margin-bottom:8px}.forgot-link[_ngcontent-%COMP%]{font-size:14px;color:#5046e5;text-decoration:none}.forgot-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.signup-link[_ngcontent-%COMP%], .login-link[_ngcontent-%COMP%]{color:#5046e5;font-weight:500;text-decoration:none}.signup-link[_ngcontent-%COMP%]:hover, .login-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn-primary[_ngcontent-%COMP%]{background-color:#5046e5;border-color:#5046e5;padding:12px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover, .btn-primary[_ngcontent-%COMP%]:focus{background-color:#4238d0;border-color:#4238d0}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#a8a4e0;border-color:#a8a4e0}.separator[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#888;font-size:14px}.separator[_ngcontent-%COMP%]:before, .separator[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #ddd}.separator[_ngcontent-%COMP%]:before{margin-right:1em}.separator[_ngcontent-%COMP%]:after{margin-left:1em}.google-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#fff;border:1px solid #ddd;color:#333;padding:12px;font-weight:500}.google-btn[_ngcontent-%COMP%]:hover{background-color:#f8f8f8;color:#333}@media (max-width: 576px){.auth-card[_ngcontent-%COMP%]{padding:20px 15px}.brand-name[_ngcontent-%COMP%]{font-size:20px}.form-control[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{padding:10px}}']})};function zre(t,n){if(t&1){let e=Ft();I(0,"div",29)(1,"div",30)(2,"div",2),q(3,"input",31),C(),I(4,"div",2),q(5,"input",32),C(),I(6,"div",2),q(7,"input",33),C(),I(8,"div",2),q(9,"input",34),C()(),I(10,"div",35)(11,"div",2),q(12,"input",36),C(),I(13,"div",2),q(14,"input",37),C(),I(15,"div",2),q(16,"input",38),C()(),I(17,"div",35)(18,"div",2),q(19,"input",39),C(),I(20,"div",2),q(21,"input",40),C(),I(22,"div",2),q(23,"input",41),C()(),I(24,"button",42),ye("click",function(){let o=Me(e).index,i=fe(2);return Fe(i.removePlannedTrade(o))}),T(25,"Remove"),C()()}if(t&2){let e=n.index;X("formGroupName",e)}}function Ure(t,n){if(t&1){let e=Ft();I(0,"div",26)(1,"h5"),T(2,"Planned Trades"),C(),ce(3,zre,26,1,"div",27),I(4,"button",28),ye("click",function(){Me(e);let o=fe();return Fe(o.addPlannedTrade())}),T(5,"Add Planned Trade"),C()()}if(t&2){let e=fe();B(3),X("ngForOf",e.plannedTrades.controls)}}function jre(t,n){t&1&&(I(0,"div",35)(1,"div",2),q(2,"input",45),C()())}function Gre(t,n){if(t&1){let e=Ft();I(0,"div",29)(1,"div",30)(2,"div",2),q(3,"input",31),C(),I(4,"div",2),q(5,"input",32),C(),I(6,"div",2),q(7,"input",33),C(),I(8,"div",2),q(9,"input",34),C()(),I(10,"div",35)(11,"div",2),q(12,"input",36),C(),I(13,"div",2),q(14,"input",37),C(),I(15,"div",2),q(16,"input",38),C()(),I(17,"div",35)(18,"div",2),q(19,"input",39),C(),I(20,"div",2),q(21,"input",40),C(),I(22,"div",2),q(23,"input",41),C()(),ce(24,jre,3,0,"div",44),I(25,"button",42),ye("click",function(){let o=Me(e).index,i=fe(2);return Fe(i.removeExecutingTrade(o))}),T(26,"Remove"),C()()}if(t&2){let e=n.$implicit,r=n.index;X("formGroupName",r),B(24),X("ngIf",e.get("profit"))}}function Wre(t,n){if(t&1){let e=Ft();I(0,"div",43)(1,"h5"),T(2,"Executing Trades"),C(),ce(3,Gre,27,2,"div",27),I(4,"button",28),ye("click",function(){Me(e);let o=fe();return Fe(o.addExecutingTrade())}),T(5,"Add Executing Trade"),C()()}if(t&2){let e=fe();B(3),X("ngForOf",e.executingTrades.controls)}}function Hre(t,n){t&1&&(I(0,"div",46)(1,"h5"),T(2,"Emotion Before Trade"),C(),I(3,"div",30)(4,"div",47)(5,"label",48),T(6,"Emotional State"),C(),q(7,"input",49),C(),I(8,"div",47)(9,"label",48),T(10,"Trade Confidence"),C(),q(11,"input",50),C(),I(12,"div",47)(13,"label",48),T(14,"Reflection"),C(),q(15,"input",51),C()()())}function qre(t,n){t&1&&(I(0,"div",52)(1,"h5"),T(2,"Profit"),C(),I(3,"div",30)(4,"div",47)(5,"label",48),T(6,"Realized Profit"),C(),q(7,"input",53),C(),I(8,"div",47)(9,"label",48),T(10,"Unrealized Profit"),C(),q(11,"input",54),C(),I(12,"div",47)(13,"label",48),T(14,"Total Profit"),C(),q(15,"input",55),C()()())}function Kre(t,n){t&1&&(I(0,"div",56)(1,"h5"),T(2,"Emotion After"),C(),q(3,"input",57)(4,"input",58)(5,"input",59),C())}var sf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabase=r}tradeData;mode="create";formSubmitted=new Bt;cancel=new Bt;tradeForm;tableName="tradejournal";ngOnInit(){this.initForm()}ngOnChanges(n){n.tradeData&&!n.tradeData.firstChange&&(this.populateForm(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)}),this.tradeData&&(this.mode="edit"))}initForm(){let n=this.mode==="create"?Pu():this.tradeData?.tradeid;this.tradeForm=this.fb.group({tradeid:n,userid:this.supabase.user()?.id,updated_time:new Date().toISOString(),account_name:["",Ce.required],trade_symbol:["",Ce.required],trade_analysis:[""],trade_instrument:[""],type_of_order:[""],market_condition:[""],trade_status:["Planned"],strategy_name:[""],entry_criteria:[""],exit_criteria:[""],planned_trade:this.fb.array([]),executing_trades:this.fb.array([]),realized_profit:[0,Ce.required],unrealized_profit:[0,Ce.required],planned_profit:[0,Ce.required],emotion_before:this.fb.group({emotional_state_before:[""],trade_confidence_before:[""],reflection_before:[""]}),emotion_after:this.fb.group({emotional_state_after:[""],trade_confidence_after:[""],reflection_after:[""]}),notes:[""]}),this.tradeForm.get("trade_status")?.valueChanges.subscribe(e=>{this.handleStatusChange(e)}),this.handleStatusChange("Planned"),this.tradeData&&(this.populateForm(),this.mode="edit")}get plannedTrades(){return this.tradeForm.get("planned_trade")}get executingTrades(){return this.tradeForm.get("executing_trades")}newTradeGroup(n=!1){let e={entry_price:[""],exit_price:[""],stop_loss:[""],trade_direction:[""],entry_time:[""],exit_time:[""],exit:[""],position_size:[""],contracts:[""],contract_multiplier:[""]};return n&&(e.profit=[""]),this.fb.group(e)}addPlannedTrade(){this.plannedTrades.push(this.newTradeGroup())}removePlannedTrade(n){this.plannedTrades.removeAt(n)}addExecutingTrade(){this.executingTrades.push(this.newTradeGroup(!0))}removeExecutingTrade(n){this.executingTrades.removeAt(n)}populateForm(){this.tradeData&&(this.tradeForm.patchValue(this.tradeData),this.plannedTrades.clear(),this.executingTrades.clear(),this.tradeData.planned_trade?.forEach(n=>{this.plannedTrades.push(this.fb.group(n))}),this.tradeData.executing_trades?.forEach(n=>{this.executingTrades.push(this.fb.group(n))}),this.handleStatusChange(this.tradeData.trade_status))}handleStatusChange(n){let e=this.tradeForm.get("emotion_after"),r=this.tradeForm.get("emotion_before");n==="Planned"?(this.executingTrades.disable(),e.disable(),r.enable()):n==="Executing"?(this.executingTrades.enable(),e.disable(),r.enable(),this.executingTrades.length===0&&this.plannedTrades.length>0&&this.plannedTrades.controls.forEach(o=>{this.executingTrades.push(this.fb.group(o.value))})):n==="Completed"&&(this.executingTrades.enable(),e.enable(),r.disable()),this.cdr.markForCheck(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)})}async onSubmit(){if(this.tradeForm.valid){let n=this.tradeForm.getRawValue();console.log("Trade submitted:",n);try{this.mode==="create"?await this.supabase.addTradeLog(n,this.tableName):this.mode==="edit"&&await this.supabase.updateTradeLog(n,this.tableName),this.formSubmitted.emit()}catch(e){console.error("Error submitting trade:",e)}}else console.log("Invalid form")}onCancel(){this.cancel.emit()}static \u0275fac=function(e){return new(e||t)(re(Dl),re(zt),re(Ut))};static \u0275cmp=Mt({type:t,selectors:[["app-individual-trade"]],inputs:{tradeData:"tradeData",mode:"mode"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},features:[ai],decls:67,vars:7,consts:[[1,"p-4",3,"ngSubmit","formGroup"],[1,"row","mb-3"],[1,"col"],["formControlName","trade_symbol",1,"form-control"],["formControlName","account_name",1,"form-control"],["formControlName","trade_analysis",1,"form-control"],["formControlName","trade_instrument",1,"form-control"],["formControlName","type_of_order",1,"form-control"],[1,"mb-3"],["formControlName","market_condition",1,"form-control"],["formControlName","trade_status",1,"form-control"],["value","Planned"],["value","Executing"],["value","Completed"],["formControlName","strategy_name",1,"form-control"],["formControlName","entry_criteria",1,"form-control"],["formControlName","exit_criteria",1,"form-control"],["formArrayName","planned_trade",4,"ngIf"],["formArrayName","executing_trades",4,"ngIf"],["formGroupName","emotion_before","class","mt-3",4,"ngIf"],["class","border p-3 mt-4 mb-4",4,"ngIf"],["formGroupName","emotion_after","class","border p-3 mt-4 mb-4",4,"ngIf"],["formControlName","notes",1,"form-control"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-secondary","me-2",3,"click"],["type","submit",1,"btn","btn-primary","mt-3"],["formArrayName","planned_trade"],["class","border p-3 mb-3",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-secondary",3,"click"],[1,"border","p-3","mb-3",3,"formGroupName"],[1,"row"],["placeholder","Entry Price","formControlName","entry_price",1,"form-control"],["placeholder","Exit Price","formControlName","exit_price",1,"form-control"],["placeholder","Stop Loss","formControlName","stop_loss",1,"form-control"],["placeholder","Direction","formControlName","trade_direction",1,"form-control"],[1,"row","mt-2"],["placeholder","Entry Time","formControlName","entry_time",1,"form-control"],["placeholder","Exit Time","formControlName","exit_time",1,"form-control"],["placeholder","Exit","formControlName","exit",1,"form-control"],["placeholder","Position Size","formControlName","position_size",1,"form-control"],["placeholder","Contracts","formControlName","contracts",1,"form-control"],["placeholder","Multiplier","formControlName","contract_multiplier",1,"form-control"],["type","button",1,"btn","btn-danger","btn-sm","mt-2",3,"click"],["formArrayName","executing_trades"],["class","row mt-2",4,"ngIf"],["placeholder","Profit","formControlName","profit",1,"form-control"],["formGroupName","emotion_before",1,"mt-3"],[1,"col-md-4","mb-3"],[1,"form-label"],["formControlName","emotional_state_before",1,"form-control"],["type","number","formControlName","trade_confidence_before",1,"form-control"],["formControlName","reflection_before",1,"form-control"],[1,"border","p-3","mt-4","mb-4"],["type","number","formControlName","realized_profit",1,"form-control"],["type","number","formControlName","unrealized_profit",1,"form-control"],["type","number","formControlName","planned_profit",1,"form-control"],["formGroupName","emotion_after",1,"border","p-3","mt-4","mb-4"],["placeholder","Emotional State","formControlName","emotional_state_after",1,"form-control","mb-2"],["placeholder","Confidence","formControlName","trade_confidence_after",1,"form-control","mb-2"],["placeholder","Reflection","formControlName","reflection_after",1,"form-control","mb-2"]],template:function(e,r){if(e&1&&(I(0,"h2"),T(1,"Trade Form"),C(),I(2,"form",0),ye("ngSubmit",function(){return r.onSubmit()}),I(3,"div",1)(4,"div",2)(5,"label"),T(6,"Trade Symbol"),C(),q(7,"input",3),C(),I(8,"div",2)(9,"label"),T(10,"Trade Analysis"),C(),q(11,"input",4),C(),I(12,"div",2)(13,"label"),T(14,"Account Name"),C(),q(15,"input",5),C()(),I(16,"div",1)(17,"div",2)(18,"label"),T(19,"Trade Instrument"),C(),q(20,"input",6),C(),I(21,"div",2)(22,"label"),T(23,"Type of Order"),C(),q(24,"input",7),C()(),I(25,"div",8)(26,"label"),T(27,"Market Condition"),C(),q(28,"textarea",9),C(),I(29,"div",1)(30,"div",2)(31,"label"),T(32,"Trade Status"),C(),I(33,"select",10)(34,"option",11),T(35,"Planned"),C(),I(36,"option",12),T(37,"Executing"),C(),I(38,"option",13),T(39,"Completed"),C()()(),I(40,"div",2)(41,"label"),T(42,"Strategy Name"),C(),q(43,"input",14),C()(),I(44,"div",1)(45,"div",2)(46,"label"),T(47,"Entry Criteria"),C(),q(48,"textarea",15),C(),I(49,"div",2)(50,"label"),T(51,"Exit Criteria"),C(),q(52,"textarea",16),C()(),ce(53,Ure,6,1,"div",17)(54,Wre,6,1,"div",18)(55,Hre,16,0,"div",19)(56,qre,16,0,"div",20)(57,Kre,6,0,"div",21),I(58,"div",8)(59,"label"),T(60,"Notes"),C(),q(61,"textarea",22),C(),I(62,"div",23)(63,"button",24),ye("click",function(){return r.onCancel()}),T(64,"Cancel"),C(),I(65,"button",25),T(66),C()()()),e&2){let o,i,s,a,l;B(2),X("formGroup",r.tradeForm),B(51),X("ngIf",((o=r.tradeForm.get("trade_status"))==null?null:o.value)==="Planned"),B(),X("ngIf",((i=r.tradeForm.get("trade_status"))==null?null:i.value)!=="Planned"),B(),X("ngIf",((s=r.tradeForm.get("trade_status"))==null?null:s.value)!=="Completed"),B(),X("ngIf",((a=r.tradeForm.get("trade_status"))==null?null:a.value)==="Completed"),B(),X("ngIf",((l=r.tradeForm.get("trade_status"))==null?null:l.value)==="Completed"),B(9),Ke(" ",r.mode==="edit"?"Update Trade":"Save Trade"," ")}},dependencies:[rn,jr,xn,Hi,Gi,ef,tf,pr,Mu,_l,qr,ji,Wi,Ls,j0,G0],encapsulation:2})};var Xre=(t,n,e)=>({"status-planned":t,"status-executing":n,"status-completed":e});function Yre(t,n){t&1&&(I(0,"div",14),T(1,"Loading trade logs..."),C())}function Zre(t,n){if(t&1&&(I(0,"div",15),T(1),C()),t&2){let e=fe();B(),dn(e.errorMessage)}}function Qre(t,n){if(t&1){let e=Ft();I(0,"div",18)(1,"div",19),ye("click",function(){let o=Me(e).$implicit,i=fe(2);return Fe(i.openEditModal(o))}),I(2,"div",20),q(3,"i",21),T(4),C(),I(5,"div",22),ye("click",function(o){let i=Me(e).$implicit,s=fe(2);return Fe(s.onDeleteTradeLog(i,o))}),q(6,"i",23),C(),I(7,"div",24)(8,"h4",25),T(9),C(),I(10,"h5",26),T(11),C(),I(12,"div",27)(13,"div",28)(14,"strong"),T(15,"Account Name:"),C(),T(16),C(),I(17,"div",28)(18,"strong"),T(19,"Analysis:"),C(),T(20),C(),I(21,"div",28)(22,"strong"),T(23,"Profit:"),C(),T(24),C()(),I(25,"div",29)(26,"small",30),T(27),gu(28,"date"),C()()()()()}if(t&2){let e=n.$implicit;B(2),X("ngClass",hu(14,Xre,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),B(2),Ke(" ",e.trade_status," "),B(5),dn(e.trade_symbol),B(2),yh(" ",e.trade_instrument," | ",e.type_of_order," "),B(5),Ke(" ",e.account_name," "),B(4),Ke(" ",e.trade_analysis," "),B(4),xh(" Realized: ",e.realized_profit," | Unrealized: ",e.unrealized_profit," | Planned: ",e.planned_profit," "),B(3),Ke("Last modified: ",yu(28,11,e.updated_time,"medium"),"")}}function Jre(t,n){if(t&1&&(I(0,"div",16),ce(1,Qre,29,18,"div",17),C()),t&2){let e=fe();B(),X("ngForOf",e.tradeLogs)}}function eoe(t,n){t&1&&(I(0,"div",31),T(1," No trade logs found. "),C())}function toe(t,n){if(t&1){let e=Ft();I(0,"div",32),ye("click",function(o){Me(e);let i=fe();return Fe(i.closeModalOnOverlayClick(o))}),I(1,"div",33),ye("click",function(o){return Me(e),Fe(o.stopPropagation())}),I(2,"app-individual-trade",34),ye("formSubmitted",function(){Me(e);let o=fe();return Fe(o.onFormSubmitted())})("cancel",function(){Me(e);let o=fe();return Fe(o.closeModal())}),C()()()}if(t&2){let e=fe();B(2),X("tradeData",e.selectedTradeLog)("mode",e.selectedTradeLog?"edit":"create")}}var Y0=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="tradejournal";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName),this.cdr.markForCheck()}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}openAddModal(){this.selectedTradeLog=null,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal(),this.cdr.markForCheck()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(re(Ut),re(zt))};static \u0275cmp=Mt({type:t,selectors:[["app-trade-journal"]],decls:19,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"d-flex","justify-content-end","mb-3"],[1,"btn","btn-tr","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"mb-2"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeData","mode"]],template:function(e,r){e&1&&(I(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),T(5,"Dashboard"),C()(),I(6,"li",5),T(7,"Trade Journal"),C()()(),I(8,"h2"),T(9,"Trade Journal"),C(),ce(10,Yre,2,0,"div",6)(11,Zre,2,1,"div",7),I(12,"div",8)(13,"button",9),ye("click",function(){return r.openAddModal()}),q(14,"i",10),T(15," Add "),C()(),ce(16,Jre,2,1,"div",11)(17,eoe,2,0,"div",12),C(),ce(18,toe,3,2,"div",13)),e&2&&(B(10),X("ngIf",r.loading),B(),X("ngIf",r.errorMessage),B(5),X("ngIf",r.tradeLogs&&r.tradeLogs.length),B(),X("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),B(),X("ngIf",r.showModal))},dependencies:[Hi,rn,Li,jr,xn,Ep,sf],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:5px;color:#fff;font-size:.9rem}.status-planned[_ngcontent-%COMP%]{background-color:#007bff}.status-executing[_ngcontent-%COMP%]{background-color:#ffc107}.status-completed[_ngcontent-%COMP%]{background-color:#28a745}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;display:none;color:red;cursor:pointer}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;max-width:800px;width:100%;position:relative;max-height:90vh;overflow-y:auto}"]})};var Z0=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Mt({type:t,selectors:[["app-meditation-hub"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(I(0,"h1",0),T(1,"Meditation Coming soon"),C())},encapsulation:2})};var Q0=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Mt({type:t,selectors:[["app-analytics"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(I(0,"h1",0),T(1,"Analytics Coming soon"),C())},encapsulation:2})};var $u=class{constructor(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)}set(n,e){this.dataIdsCount++,this.data.set(n,e)}has(n){return this.data.has(n)}delete(n){return this.dataIdsCount--,this.data.delete(n)}numDataIds(){return this.dataIdsCount}},Vs=class{refCount(n){return Fo("refCount")}incRef(n){return Fo("incRef")}timerAvailable(){return!0}time(n){return Fo("time")}read(n){return Fo("read")}readSync(n){return Fo("readSync")}numDataIds(){return Fo("numDataIds")}disposeData(n,e){return Fo("disposeData")}write(n,e,r){return Fo("write")}move(n,e,r,o,i){return Fo("move")}memory(){return Fo("memory")}floatPrecision(){return Fo("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return Fo("dispose")}};function Fo(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function u$(t){let n=t.length,e=0,r=0;for(;n>0;)r=Math.random()*n|0,n--,e=t[n],t[n]=t[r],t[r]=e}function noe(t,n){if(t.length!==n.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${n.length}`);let e=t.length,r,o,i=0;for(;e>0;)i=Math.random()*e|0,e--,r=t[e],o=n[e],t[e]=t[i],n[e]=n[i],t[i]=r,n[i]=o}function af(t,n,e){return Math.max(t,Math.min(n,e))}function roe(t){return t%2===0?t:t+1}function ooe(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function ioe(t,n){let e=Math.random();return n*e+(1-e)*t}function soe(t,n){let e=0;for(let r=0;r<t.length;r++){let o=Number(t[r])-Number(n[r]);e+=o*o}return e}function M(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function J0(t,n,e=""){M(qi(t,n),()=>e+` Shapes ${t} and ${n} must match`)}function _g(t){M(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Nl(t,n=[],e=!1){if(n==null&&(n=[]),Array.isArray(t)||Kr(t)&&!e)for(let r=0;r<t.length;++r)Nl(t[r],n,e);else n.push(t);return n}function kt(t){if(t.length===0)return 1;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];return n}function aoe(t){return t.length===0}function qi(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function mt(t){return t%1===0}function loe(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let n=Math.exp(2*t);return(n-1)/(n+1)}}function coe(t){let n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function uoe(t){let n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return u$(n),n}function Vu(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function doe(t,n=r=>0,e){return new Promise((r,o)=>{let i=0,s=()=>{if(t()){r();return}i++;let a=n(i);if(e!=null&&i>=e){o();return}setTimeout(s,a)};s()})}function poe(t,n){let e=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(n>0&&n!==e)throw Error(`Size(${n}) must match the product of shape ${t}`);return t}if(e===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(n%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${n} / ${e}`);let o=t.slice();return o[r]=n/e,o}function vn(t,n){let e=n.length;return t=t==null?n.map((r,o)=>o):[].concat(t),M(t.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${t}`),M(t.every(r=>mt(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?e+r:r)}function J_(t,n){let e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:vn(n,t).sort(),s=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[s]==null||i[s]>a)&&t[a]===1&&(e.push(t[a]),r.push(a)),i[s]<=a&&s++}t[a]!==1&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function foe(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);return e}function e1(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else if(t==="string")e=new Array(n);else throw new Error(`Unknown data type ${t}`);return e}function t1(t,n){for(let e=0;e<t.length;e++){let r=t[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${n} being uploaded contains ${r}.`)}}function n1(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function moe(t,n){return!(n==="complex64"||n==="float32"&&t!=="complex64"||n==="int32"&&t!=="float32"&&t!=="complex64"||n==="bool"&&t==="bool")}function Kr(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function eb(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function r1(t){if(t==null)return 0;let n=0;return t.forEach(e=>n+=e.length),n}function lf(t){return typeof t=="string"||t instanceof String}function d$(t){return typeof t=="boolean"}function p$(t){return typeof t=="number"}function cf(t){return Array.isArray(t)?cf(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":p$(t)?"float32":lf(t)?"string":d$(t)?"bool":"float32"}function uf(t){return!!(t&&t.constructor&&t.call&&t.apply)}function df(t,n){for(let e=n;e<t;++e)if(t%e===0)return e;return t}function Ki(t){let n=t.length;if(n<2)return[];let e=new Array(n-1);e[n-2]=t[n-1];for(let r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function f$(t,n,e,r=!1){let o=new Array;if(n.length===1){let i=n[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[t+s]}else{let i=n[0],s=n.slice(1),a=s.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)o[l]=f$(t+l*a,s,e,r)}return o}function Lu(t,n,e=!1){if(t.length===0)return n[0];let r=t.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==n.length)throw new Error(`[${t}] does not match the input size ${n.length}${e?" for a complex tensor":""}.`);return f$(0,t,n,e)}function Dg(t,n){let e=pf(t,n);for(let r=0;r<e.length;r++)e[r]=1;return e}function pf(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${n}`)}function hoe(t,n){let e=t.reduce((r,o)=>r*o,1);if(n==null||n==="float32")return Lu(t,new Float32Array(e));if(n==="int32")return Lu(t,new Int32Array(e));if(n==="bool")return Lu(t,new Uint8Array(e));throw new Error(`Unknown data type ${n}`)}function Ng(t){t.forEach(n=>{M(Number.isInteger(n)&&n>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function goe(t,n,e){if(n===0)return 0;if(n===1)return t[0];let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function yoe(t,n,e){if(n===0)return[];if(n===1)return[t];let r=new Array(n);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}function kg(t){return t&&t.then&&typeof t.then=="function"}var m$="tfjsflags",Ag=class{constructor(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=voe,this.populateURLFlags()}setPlatform(n,e){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=n,this.platform=e}registerFlag(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){let o=this.urlFlags[n];console.warn(`Setting feature override from URL ${n}: ${o}.`),this.set(n,o)}}async getAsync(n){return n in this.flags?this.flags[n]:(this.flags[n]=await this.evaluateFlag(n),this.flags[n])}get(n){if(n in this.flags)return this.flags[n];let e=this.evaluateFlag(n);if(kg(e))throw new Error(`Flag ${n} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[n]=e,this.flags[n]}getNumber(n){return this.get(n)}getBool(n){return this.get(n)}getFlags(){return this.flags}get features(){return this.flags}set(n,e){if(this.flagRegistry[n]==null)throw new Error(`Cannot set flag ${n} as it has not been registered.`);this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)}evaluateFlag(n){if(this.flagRegistry[n]==null)throw new Error(`Cannot evaluate flag '${n}': no evaluation function found.`);return this.flagRegistry[n].evaluationFn()}setFlags(n){this.flags=Object.assign({},n)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let n=this.getQueryParams(this.global.location.search);m$ in n&&n[m$].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=woe(o,i)})}};function voe(t){let n={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(boe(n,r[0],r[1]),r.join("="))),n}function boe(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function woe(t,n){if(n=n.toLowerCase(),n==="true"||n==="false")return n==="true";if(`${+n}`===n)return+n;throw new Error(`Could not parse value flag value ${n} for flag ${t}.`)}function G(){return o1}var o1=null;function h$(t){o1=t}var i1;function s1(){if(i1==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");i1=t}return i1}function Coe(){let t=s1();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Rg(t,n){let e=Coe();if(e.has(t))return e.get(t);{let r=n();return e.set(t,r),e.get(t)}}var kl="Abs",Bs="Acos",zs="Acosh",mi="Add",ff="AddN",mf="All",hf="Any",Al="ArgMax",Rl="ArgMin",Us="Asin",js="Asinh",Gs="Atan",Ws="Atanh",Hs="Atan2",Ol="AvgPool",gf="AvgPoolGrad",Ml="AvgPool3D",yf="AvgPool3DGrad",Fl="BatchMatMul",Pl="BatchToSpaceND",tb="Bincount",g$="BroadcastTo",Xi="Cast",qs="Ceil",Ks="ClipByValue",xf="Complex",$l="ComplexAbs",Ll="Concat",Vl="Conv2D",vf="Conv2DBackpropFilter",Bl="Conv2DBackpropInput",zl="Conv3D",bf="Conv3DBackpropFilterV2",wf="Conv3DBackpropInputV2",Xs="Cos",Ys="Cosh",Ul="Cumsum",nb="CropAndResize",rb="DenseBincount",Cf="DepthToSpace",jl="DepthwiseConv2dNative",If="DepthwiseConv2dNativeBackpropFilter",Sf="DepthwiseConv2dNativeBackpropInput",ob="Diag",Gl="Dilation2D",Og="Dilation2DBackpropInput",Mg="Dilation2DBackpropFilter",Zs="RealDiv",ib="Einsum",Qs="Elu",Tf="EluGrad",Js="Erf",Bu="Equal",ea="Exp",Wl="ExpandDims",ta="Expm1",Ef="FFT",_f="Fill",sb="FlipLeftRight",na="Floor",ra="FloorDiv",Hl="FusedBatchNorm",ql="GatherV2",ab="GatherNd",zu="Greater",oa="GreaterEqual",Yi="Identity",Df="IFFT",Nf="Imag",ia="IsFinite",sa="IsInf",aa="IsNan",Kl="LeakyRelu",Uu="Less",ju="LessEqual",lb="LinSpace",la="Log",ca="Log1p",Gu="LogicalAnd",Wu="LogicalNot",Hu="LogicalOr",y$="LogSoftmax",Xl="LRN",kf="LRNGrad",Yl="Max",ua="Maximum",Zl="MaxPool",Af="MaxPoolGrad",Ql="MaxPool3D",Rf="MaxPool3DGrad",cb="MaxPoolWithArgmax",Jl="Mean",ec="Min",da="Minimum",tc="MirrorPad",pa="Mod",ub="Multinomial",fa="Multiply",nc="Neg",qu="NotEqual",db="NonMaxSuppressionV3",pb="NonMaxSuppressionV4",fb="NonMaxSuppressionV5",rc="OnesLike",oc="OneHot",ic="Pack",sc="PadV2";var ma="Pow",ac="Prelu",Of="Prod",Mf="Range",Ff="Real",ha="Reciprocal",ga="Relu",lc="Reshape",cc="ResizeNearestNeighbor",Pf="ResizeNearestNeighborGrad",uc="ResizeBilinear",$f="ResizeBilinearGrad",ya="Relu6",dc="Reverse",xa="Round",va="Rsqrt",mb="ScatterNd",pc="Select",ba="Selu",fc="Slice",wa="Sin",Ca="Sinh",Ia="Sign",Sa="Sigmoid",Ta="Softplus",Ea="Sqrt",mc="Sum",hc="SpaceToBatchND",gc="SplitV",yc="Softmax",hb="SparseFillEmptyRows",gb="SparseReshape",yb="SparseToDense",_a="SquaredDifference",Lf="Square",Vf="StridedSlice",Da="Sub",Na="Tan",ka="Tanh",Zi="Tile",Bf="TopK",xb="Transform",xc="Transpose",zf="Unique",vc="Unpack",bc="UnsortedSegmentSum",wc="ZerosLike",Aa="Step",x$="FromPixels",vb="RotateWithOffset",Ku="_FusedMatMul",Xu="FusedConv2D",Yu="FusedDepthwiseConv2D";var bb=Rg("kernelRegistry",()=>new Map),a1=Rg("gradRegistry",()=>new Map);function l1(t,n){let e=b$(t,n);return bb.get(e)}function c1(t){return a1.get(t)}function u1(t){let n=bb.entries(),e=[];for(;;){let{done:r,value:o}=n.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===t&&e.push(s)}return e}function wb(t){let{kernelName:n,backendName:e}=t,r=b$(n,e);bb.has(r)&&console.warn(`The kernel '${n}' for backend '${e}' is already registered`),bb.set(r,t)}function v$(t){let{kernelName:n}=t;a1.has(n)&&G().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${n}'`),a1.set(n,t)}function b$(t,n){return`${n}_${t}`}var v={};ki(v,{arraysEqual:()=>qi,assert:()=>M,assertNonNegativeIntegerDimensions:()=>Ng,assertNonNull:()=>_g,assertShapesMatch:()=>J0,bytesFromStringArray:()=>r1,bytesPerElement:()=>eb,checkConversionForErrors:()=>t1,clamp:()=>af,computeStrides:()=>Ki,createScalarValue:()=>Ioe,createShuffledIndices:()=>uoe,decodeString:()=>Gf,distSquared:()=>soe,encodeString:()=>jf,fetch:()=>Toe,flatten:()=>Nl,getArrayFromDType:()=>e1,getTypedArrayFromDType:()=>foe,hasEncodingLoss:()=>moe,indexToLoc:()=>yoe,inferDtype:()=>cf,inferFromImplicitShape:()=>poe,isBoolean:()=>d$,isFunction:()=>uf,isInt:()=>mt,isNumber:()=>p$,isPromise:()=>kg,isScalarShape:()=>aoe,isString:()=>lf,isTypedArray:()=>Kr,isValidDtype:()=>n1,locToIndex:()=>goe,makeOnesTypedArray:()=>Dg,makeZerosNestedTypedArray:()=>hoe,makeZerosTypedArray:()=>pf,nearestDivisor:()=>df,nearestLargerEven:()=>roe,now:()=>Zu,parseAxisParam:()=>vn,randUniform:()=>ioe,repeatedTry:()=>doe,rightPad:()=>Vu,shuffle:()=>u$,shuffleCombo:()=>noe,sizeFromShape:()=>kt,sizeToSquarishShape:()=>coe,squeezeShape:()=>J_,sum:()=>ooe,tanh:()=>loe,toNestedArray:()=>Lu,toTypedArray:()=>Uf});function Ioe(t,n){return n==="string"?jf(t):Uf([t],n)}function Soe(t,n){return t instanceof Float32Array&&n==="float32"||t instanceof Int32Array&&n==="int32"||t instanceof Uint8Array&&n==="bool"}function Uf(t,n){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Nl(t)),G().getBool("DEBUG")&&t1(t,n),Soe(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){let e=new Uint8Array(t.length);for(let r=0;r<e.length;++r)Math.round(t[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${n}`)}function Zu(){return G().platform.now()}function Toe(t,n){return G().platform.fetch(t,n)}function jf(t,n="utf-8"){return n=n||"utf-8",G().platform.encode(t,n)}function Gf(t,n="utf-8"){return n=n||"utf-8",G().platform.decode(t,n)}var Cb=class{constructor(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new d1)}profileKernel(n,e,r){let o,i=()=>{o=r()},s,a=Zu();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let c of o)c.dataSync();s=Promise.resolve({kernelMs:Zu()-a})}if(G().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let u=o[c];u.data().then(d=>{Eoe(d,u.dtype,n)})}return{kernelName:n,outputs:o,inputs:e,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(n){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=n;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function Eoe(t,n,e){if(n!=="float32")return!1;for(let r=0;r<t.length;r++){let o=t[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var d1=class{logKernelProfile(n,e,r,o,i,s){let a=typeof o=="number"?Vu(`${o}ms`,9):o.error,l=Vu(n,25),c=e.rank,u=e.size,d=Vu(e.shape.toString(),14),p="";for(let f in i){let m=i[f];if(m!=null){let h=m.shape||e.shape,g=h.length;p+=`${f}: ${g}D ${g>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function w$(t,n,e){let r={},o={};for(let l=0;l<n.length;l++)r[n[l].id]=!0;for(let l=0;l<t.length;l++){let c=t[l],u=c.inputs;for(let d in u){let p=u[d],f=!1;for(let m=0;m<n.length;m++)if(r[p.id]){c.outputs.forEach(h=>r[h.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}let i={};i[e.id]=!0;let s={};for(let l=t.length-1;l>=0;l--){let c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(let p in u)i[u[p].id]=!0,s[c.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let c=t[l];if(o[c.id]&&s[c.id]){let u={};for(let p in c.inputs){let f=c.inputs[p];r[f.id]&&(u[p]=f)}let d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function C$(t,n,e,r){for(let o=n.length-1;o>=0;o--){let i=n[o],s=[];if(i.outputs.forEach(l=>{let c=t[l.id];c!=null?s.push(c):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);let u=i.inputs[l];if(!qi(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{let d=t[u.id];t[u.id]=r(d,c),d.dispose()}}}}var I$=20,Fg=3,p1=7;function S$(t,n,e,r){let o=Ki(n),i=_oe(t,n,e,o),s=n.length,a=Ib(t,n,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${n}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function _oe(t,n,e,r){let o=kt(n),i=r[r.length-1],s=new Array(i).fill(0),a=n.length,l=e==="complex64"?$g(t):t;if(a>1)for(let c=0;c<o/i;c++){let u=c*i;for(let d=0;d<i;d++)s[d]=Math.max(s[d],Pg(l[u+d],0,e).length)}return s}function Pg(t,n,e){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(p1))} + ${parseFloat(t[1].toFixed(p1))}j`:lf(t)?r=`'${t}'`:e==="bool"?r=T$(t):r=parseFloat(t.toFixed(p1)).toString(),Vu(r,n)}function T$(t){return t===0?"false":"true"}function Ib(t,n,e,r,o,i=!0){let s=e==="complex64"?2:1,a=n[0],l=n.length;if(l===0){if(e==="complex64"){let h=$g(t);return[Pg(h[0],0,e)]}return e==="bool"?[T$(t[0])]:[t[0].toString()]}if(l===1){if(a>I$){let g=Fg*s,y=Array.from(t.slice(0,g)),x=Array.from(t.slice((a-Fg)*s,a*s));return e==="complex64"&&(y=$g(y),x=$g(x)),["["+y.map((w,b)=>Pg(w,o[b],e)).join(", ")+", ..., "+x.map((w,b)=>Pg(w,o[a-Fg+b],e)).join(", ")+"]"]}return["["+(e==="complex64"?$g(t):Array.from(t)).map((g,y)=>Pg(g,o[y],e)).join(", ")+"]"]}let c=n.slice(1),u=r.slice(1),d=r[0]*s,p=[];if(a>I$){for(let h=0;h<Fg;h++){let g=h*d,y=g+d;p.push(...Ib(t.slice(g,y),c,e,u,o,!1))}p.push("...");for(let h=a-Fg;h<a;h++){let g=h*d,y=g+d;p.push(...Ib(t.slice(g,y),c,e,u,o,h===a-1))}}else for(let h=0;h<a;h++){let g=h*d,y=g+d;p.push(...Ib(t.slice(g,y),c,e,u,o,h===a-1))}let f=l===2?",":"";p[0]="["+p[0]+f;for(let h=1;h<p.length-1;h++)p[h]=" "+p[h]+f;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":m),p}function $g(t){let n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var Tt=class{constructor(n,e,r){if(this.dtype=e,this.shape=n.slice(),this.size=kt(n),r!=null){let o=r.length;M(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||e1(e,this.size),this.strides=Ki(n)}set(n,...e){e.length===0&&(e=[0]),M(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=n}get(...n){n.length===0&&(n=[0]);let e=0;for(let o of n){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${n}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=this.strides[o]*n[o];return this.values[r]}locToIndex(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];let e=n[n.length-1];for(let r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e}indexToLoc(n){if(this.rank===0)return[];if(this.rank===1)return[n];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e}get rank(){return this.shape.length}toTensor(){return Qi().makeTensor(this.values,this.shape,this.dtype)}},Qi=null,Wf=null,Doe=null;function E$(t){Qi=t}function _$(t){Wf=t}function D$(t){Doe=t}var ct=class{constructor(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=kt(n),this.strides=Ki(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let n=await this.data();return Wf.buffer(this.shape,this.dtype,n)}bufferSync(){return Wf.buffer(this.shape,this.dtype,this.dataSync())}async array(){let n=await this.data();return Lu(this.shape,n,this.dtype==="complex64")}arraySync(){return Lu(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let n=Qi().read(this.dataId);if(this.dtype==="string"){let e=await n;try{return e.map(r=>Gf(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return n}dataSync(){this.throwIfDisposed();let n=Qi().readSync(this.dataId);if(this.dtype==="string")try{return n.map(e=>Gf(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n}async bytes(){this.throwIfDisposed();let n=await Qi().read(this.dataId);return this.dtype==="string"?n:new Uint8Array(n.buffer)}dispose(){this.isDisposed||(Qi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(n=!1){return Wf.print(this,n)}clone(){return this.throwIfDisposed(),Wf.clone(this)}toString(n=!1){let e=this.dataSync();return S$(e,this.shape,this.dtype,n)}cast(n){return this.throwIfDisposed(),Wf.cast(this,n)}variable(n=!0,e,r){return this.throwIfDisposed(),Qi().makeVariable(this,n,e,r)}};Object.defineProperty(ct,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function F(){return Rg("Tensor",()=>ct)}F();var Ra=class extends ct{constructor(n,e,r,o){super(n.shape,n.dtype,n.dataId,o),this.trainable=e,this.name=r}assign(n){if(n.dtype!==this.dtype)throw new Error(`dtype of the new value (${n.dtype}) and previous value (${this.dtype}) must match`);if(!qi(n.shape,this.shape))throw new Error(`shape of the new value (${n.shape}) and previous value (${this.shape}) must match`);Qi().disposeTensor(this),this.dataId=n.dataId,Qi().incRef(this,null)}dispose(){Qi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Ra,Symbol.hasInstance,{value:t=>t instanceof ct&&t.assign!=null&&t.assign instanceof Function});var N$=function(t){return t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64",t}(N$||{}),k$=function(t){return t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64",t}(k$||{}),A$=function(t){return t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64",t}(A$||{}),R$=function(t){return t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64",t}(R$||{}),Noe={float32:A$,int32:N$,bool:k$,complex64:R$};function Cn(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error(`Can not upcast ${t} with ${n}`)}return Noe[t][n]}function Qu(t){return Cn(t,"int32")}function Xe(t,n){if(t.dtype===n.dtype)return[t,n];let e=Cn(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function Sb(t){let n=[];return O$(t,n,new Set),n}function O$(t,n,e){if(t==null)return;if(t instanceof ct){n.push(t);return}if(!koe(t))return;let r=t;for(let o in r){let i=r[o];e.has(i)||(e.add(i),O$(i,n,e))}}function koe(t){return Array.isArray(t)||typeof t=="object"}function f1(t){return t.kernelName!=null}var Tb=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(n=>n.name)))}}}dispose(){for(let n in this.registeredVariables)this.registeredVariables[n].dispose()}},Roe=(()=>{class t{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Tb}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(await this.initializeBackend(o).success){await this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(console.warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Cb(this.backendInstance),!0}setupRegisteredKernels(){u1(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){u1(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof Vs)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return console.warn(`Initialization of backend ${e} failed`),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return t.nextTensorId++}nextVariableId(){return t.nextVariableId++}clone(e){let r=k.runKernel(Yi,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",c={x:a},u={dtype:l};return k.runKernel(Xi,c,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(!(l1(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(c=>{s+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,u=f1(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(f1(e)){let{kernelName:h,inputs:g,attrs:y}=e;this.backendName==null&&this.backend;let x=l1(h,this.backendName);M(x!=null,()=>`Cannot find registered kernel '${h}' for backend '${this.backendName}'`),l=()=>{let w=this.backend.numDataIds();c=x.kernelFunc({inputs:g,attrs:y,backend:this.backend});let b=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,w,b);let S=b.map(E=>{if(E.rank!=null)return E;let{dataId:D,shape:O,dtype:R}=E;return this.makeTensorFromDataId(D,O,R)});if(i){let E=this.getTensorsForGradient(h,g,S);o=this.saveTensorsForBackwardMode(E)}return S}}else{let{forwardFunc:h}=e,g=y=>{i&&(o=y.map(x=>this.keep(this.clone(x))))};l=()=>{let y=this.backend.numDataIds();c=this.tidy(()=>h(this.backend,g));let x=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,y,x),x}}let{inputs:d,attrs:p}=e,f=f1(e)?null:e.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(m=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),r=m.outputs)}),i&&this.addTapeNode(u,d,r,f,o,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(h=>d[h]!=null?d[h].shape:null),outputShapes:r.map(h=>h.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(c)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=c1(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(M(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(u=>r[u])):l=s.map(u=>r[u]);let c=o.filter((u,d)=>a[d]);return l.concat(c)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&lf(e[0])&&(s=e.map(c=>jf(c)));let a=i.write(s,r,o),l=new ct(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let c=this.state.tensorInfo.get(a),u=r1(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s=new ct(r,o,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new Ra(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*eb(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof Ra||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*eb(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},c=c1(e);c!=null&&(i=c.gradFunc),i!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){let f=o[p],m=pf(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return d}),i(u.length>1?u:u[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=Sb(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(M(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));M(s instanceof ct,()=>"The result y returned by f() must be a tensor.");let a=w$(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??Ooe(s.shape),C$(l,a,u=>this.tidy(u),Moe);let c=r.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let d of u.saved)d.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return M(uf(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{M(r.every(l=>l instanceof ct),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,c)=>{i[c]=l});let s=(l,c)=>(o=e(...r,c),M(o.value instanceof ct,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),M(uf(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,c)=>{let u=o.gradFunc(l,c),d=Array.isArray(u)?u:[u];M(d.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),M(d.every(f=>f instanceof ct),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return d.forEach((f,m)=>{p[m]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){let r=Zu(),o=await this.backend.time(e);return o.wallMs=Zu()-r,o}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Tb;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return t.nextTensorId=0,t.nextVariableId=0,t})();function Ooe(t){let n=Dg(kt(t),"float32");return k.makeTensor(n,t,"float32")}function m1(){let t=s1();if(t._tfengine==null){let n=new Ag(t);t._tfengine=new Roe(n)}return h$(t._tfengine.ENV),E$(()=>t._tfengine),t._tfengine}var k=m1();function Moe(t,n){let e={a:t,b:n};return k.runKernel(mi,e)}var Cc={};ki(Cc,{isBrowser:()=>h1,isMobile:()=>Poe});function Foe(){return typeof navigator<"u"&&navigator!=null}function Poe(t){if(t||Foe()){if(t||(t=navigator),t.product==="ReactNative")return!0;let n=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function h1(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var hi=G();hi.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});hi.registerFlag("IS_BROWSER",()=>h1());hi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");hi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));hi.registerFlag("PROD",()=>!1);hi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>hi.getBool("DEBUG"));hi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);hi.registerFlag("IS_TEST",()=>!1);hi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);hi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);function Ju(t,n){let e=t;if(Kr(t))return n==="string"?[]:[t.length];if(!Array.isArray(t))return[];let r=[];for(;Array.isArray(e)||Kr(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&G().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&F$(t,r,[]),r}function F$(t,n,e){if(e=e||[],!Array.isArray(t)&&!Kr(t)){M(n.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);return}M(n.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${t.length} elements`),M(t.length===n[0],()=>`Element arr[${e.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);let r=n.slice(1);for(let o=0;o<t.length;++o)F$(t[o],r,e.concat(o))}function M$(t,n,e,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==n||t==="numeric"&&n==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${t} tensor, but got ${n} tensor`)}}function N(t,n,e,r="numeric"){if(t instanceof ct)return M$(r,t.dtype,n,e),t;let o=cf(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),M$(r,o,n,e),t==null||!Kr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${n}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=Ju(t,o);!Kr(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?Uf(t,o):Nl(t,[],!0);return k.makeTensor(a,i,o)}function Eb(t,n,e,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${n} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,s)=>N(i,`${n}[${s}]`,e,r))}var $oe="__op";function A(t){let n=Object.keys(t);if(n.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${n.length} keys.`);let e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+$oe;let o=(...i)=>{k.startScope(e);try{let s=r(...i);return kg(s)&&console.error("Cannot return a Promise inside of tidy."),k.endScope(s),s}catch(s){throw k.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function Loe(t,n){let e=N(t,"real","complex"),r=N(n,"imag","complex");J0(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return k.runKernel(xf,o)}var gi=A({complex_:Loe});function Ic(t,n,e,r){if(r==null&&(r=cf(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Kr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Ng(n);let o=kt(n),i=kt(e);M(o===i,()=>`Based on the provided shape, [${n}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==kt(n.slice(s)):!0;M(e[s]===n[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${n}). `)}}return!Kr(t)&&!Array.isArray(t)&&(t=[t]),n=n||e,t=r!=="string"?Uf(t,r):Nl(t,[],!0),k.makeTensor(t,n,r)}function Sc(t,n,e){let r=Ju(t,e);return Ic(t,n,r,e)}var Lg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var _b=4;async function $$(t,n){let e=[],r=[],o=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(t)?t[s].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let u=new Promise(async d=>{let p=await l.bytes(),f=p.reduce((g,y)=>g+y.length,0)+_b*p.length,m=new Uint8Array(f),h=0;for(let g=0;g<p.length;g++){let y=p[g],x=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(x,h),h+=_b,m.set(y,h),h+=y.length}d(m)});r.push(u)}else r.push(l.data());n!=null&&(c.group=n),e.push(c)}let i=await Promise.all(r);return{data:Voe(i),specs:e}}function Db(t,n){let e={},r,o=0;for(let i of n){let s=i.name,a=i.dtype,l=i.shape,c=kt(l),u;if("quantization"in i){let d=i.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${i.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${i.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let p=Lg[d.dtype],f=t.slice(o,o+c*p),m=d.dtype==="uint8"?new Uint8Array(f):new Uint16Array(f);if(a==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){u=new Float32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=g*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=joe()),u=r(m);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(a==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);u=new Int32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=Math.round(g*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*p}else if(a==="string"){let d=kt(i.shape);u=[];for(let p=0;p<d;p++){let f=new Uint32Array(t.slice(o,o+_b))[0];o+=_b;let m=new Uint8Array(t.slice(o,o+f));u.push(m),o+=f}}else{let d=Lg[a],p=t.slice(o,o+c*d);if(a==="float32")u=new Float32Array(p);else if(a==="int32")u=new Int32Array(p);else if(a==="bool")u=new Uint8Array(p);else if(a==="complex64"){u=new Float32Array(p);let f=new Float32Array(u.length/2),m=new Float32Array(u.length/2);for(let y=0;y<f.length;y++)f[y]=u[y*2],m[y]=u[y*2+1];let h=Sc(f,l,"float32"),g=Sc(m,l,"float32");e[s]=gi(h,g),h.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*d}a!=="complex64"&&(e[s]=Sc(u,l,a))}return e}function Voe(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let n=0,e=[];t.forEach(i=>{if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(n),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var g1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function P$(t){return g1?Buffer.byteLength(t):new Blob([t]).size}function L$(t){if(g1)return Buffer.from(t).toString("base64");let n=new Uint8Array(t),e="";for(let r=0,o=n.length;r<o;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function V$(t){if(g1){let r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;++r)e.set([n.charCodeAt(r)],r);return e.buffer}function Hf(t){if(t.length===1)return t[0];let n=0;t.forEach(o=>{n+=o.byteLength});let e=new Uint8Array(n),r=0;return t.forEach(o=>{e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function y1(t){let n="/";for(t=t.trim();t.endsWith(n);)t=t.slice(0,t.length-1);let e=t.split(n);return e[e.length-1]}function Ji(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:P$(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:P$(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function Boe(){let t=e=>{let r=e<<13,o=0;for(;!(r&8388608);)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},n=new Uint32Array(2048);n[0]=0;for(let e=1;e<1024;e++)n[e]=t(e);for(let e=1024;e<2048;e++)n[e]=939524096+(e-1024<<13);return n}function zoe(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let n=1;n<31;n++)t[n]=n<<23;for(let n=33;n<63;n++)t[n]=2147483648+(n-32<<23);return t}function Uoe(){let t=new Uint32Array(64);for(let n=0;n<64;n++)t[n]=1024;return t[0]=t[32]=0,t}function joe(){let t=Boe(),n=zoe(),e=Uoe();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=t[e[a>>10]+(a&1023)]+n[a>>10];i[s]=l}return new Float32Array(o)}}var kn=class t{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerSaveRouter(n){t.getInstance().saveRouters.push(n)}static registerLoadRouter(n){t.getInstance().loadRouters.push(n)}static getSaveHandlers(n){return t.getHandlers(n,"save")}static getLoadHandlers(n,e){return t.getHandlers(n,"load",e)}static getHandlers(n,e,r){let o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(s=>{let a=s(n,r);a!==null&&o.push(a)}),o}},B$=t=>kn.registerSaveRouter(t),z$=t=>kn.registerLoadRouter(t),U$=t=>kn.getSaveHandlers(t),j$=(t,n)=>kn.getLoadHandlers(t,n);var x1="tensorflowjs",v1=1,ed="models_store",Tc="model_info_store";function G$(){if(!G().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function b1(t){let n=t.result;n.createObjectStore(ed,{keyPath:"modelPath"}),n.createObjectStore(Tc,{keyPath:"modelPath"})}var td=(()=>{class t{constructor(e){if(this.indexedDB=G$(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(x1,v1);s.onupgradeneeded=()=>b1(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(ed,"readonly"),u=l.objectStore(ed).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>a.close()}else{let l=Ji(r),c=a.transaction(Tc,"readwrite"),u=c.objectStore(Tc),d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l}),p;d.onsuccess=()=>{p=a.transaction(ed,"readwrite");let m=p.objectStore(ed).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l});m.onsuccess=()=>o({modelArtifactsInfo:l}),m.onerror=h=>{u=c.objectStore(Tc);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(m.error)),g.onerror=y=>(a.close(),i(m.error))}},d.onerror=f=>(a.close(),i(d.error)),c.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return t.URL_SCHEME="indexeddb://",t})(),W$=t=>G().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(td.URL_SCHEME)?Goe(t.slice(td.URL_SCHEME.length)):null;kn.registerSaveRouter(W$);kn.registerLoadRouter(W$);function Goe(t){return new td(t)}function Woe(t){return t.startsWith(td.URL_SCHEME)?t.slice(td.URL_SCHEME.length):t}var Nb=class{constructor(){this.indexedDB=G$()}async listModels(){return new Promise((n,e)=>{let r=this.indexedDB.open(x1,v1);r.onupgradeneeded=()=>b1(r),r.onsuccess=()=>{let o=r.result,i=o.transaction(Tc,"readonly"),a=i.objectStore(Tc).getAll();a.onsuccess=()=>{let l={};for(let c of a.result)l[c.modelPath]=c.modelArtifactsInfo;n(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})}async removeModel(n){return n=Woe(n),new Promise((e,r)=>{let o=this.indexedDB.open(x1,v1);o.onupgradeneeded=()=>b1(o),o.onsuccess=()=>{let i=o.result,s=i.transaction(Tc,"readwrite"),a=s.objectStore(Tc),l=a.get(n),c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${n}' in IndexedDB.`));{let u=a.delete(n),d=()=>{c=i.transaction(ed,"readwrite");let f=c.objectStore(ed).delete(n);f.onsuccess=()=>e(l.result.modelArtifactsInfo),f.onerror=m=>r(l.error)};u.onsuccess=d,u.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=u=>(i.close(),r(l.error)),s.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})}};var Oa="/",qf="tensorflowjs_models",H$="info",Hoe="model_topology",qoe="weight_specs",Koe="weight_data",Xoe="model_metadata";function q$(t){return{info:[qf,t,H$].join(Oa),topology:[qf,t,Hoe].join(Oa),weightSpecs:[qf,t,qoe].join(Oa),weightData:[qf,t,Koe].join(Oa),modelMetadata:[qf,t,Xoe].join(Oa)}}function Yoe(t){let n=t.split(Oa);if(n.length<3)throw new Error(`Invalid key format: ${t}`);return n.slice(1,n.length-1).join(Oa)}function Zoe(t){return t.startsWith(nd.URL_SCHEME)?t.slice(nd.URL_SCHEME.length):t}var nd=(()=>{class t{constructor(e){if(!G().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=q$(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=Ji(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,L$(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=V$(a),r}}return t.URL_SCHEME="localstorage://",t})(),K$=t=>G().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(nd.URL_SCHEME)?Qoe(t.slice(nd.URL_SCHEME.length)):null;kn.registerSaveRouter(K$);kn.registerLoadRouter(K$);function Qoe(t){return new nd(t)}var kb=class{constructor(){M(G().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),M(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let n={},e=qf+Oa,r=Oa+H$;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=Yoe(i);n[s]=JSON.parse(this.LS.getItem(i))}}return n}async removeModel(n){n=Zoe(n);let e=q$(n);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${n}'`);let r=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),r}};var Kf="://",yi=class t{constructor(){this.managers={}}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerManager(n,e){M(n!=null,()=>"scheme must not be undefined or null."),n.endsWith(Kf)&&(n=n.slice(0,n.indexOf(Kf))),M(n.length>0,()=>"scheme must not be an empty string.");let r=t.getInstance();M(r.managers[n]==null,()=>`A model store manager is already registered for scheme '${n}'.`),r.managers[n]=e}static getManager(n){let e=this.getInstance().managers[n];if(e==null)throw new Error(`Cannot find model manager for scheme '${n}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}};function Ab(t){if(t.indexOf(Kf)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${yi.getSchemes().join(",")}`);return{scheme:t.split(Kf)[0],path:t.split(Kf)[1]}}async function X$(t,n,e=!1){M(t!==n,()=>`Old path and new path are the same: '${t}'`);let r=kn.getLoadHandlers(t);M(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),M(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);let o=r[0],i=kn.getSaveHandlers(n);M(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${n}.`),M(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${n}.`);let s=i[0],a=Ab(t).scheme,l=Ab(t).path,c=a===Ab(t).scheme,u=await o.load();e&&c&&await yi.getManager(a).removeModel(l);let d=await s.save(u);return e&&!c&&await yi.getManager(a).removeModel(l),d.modelArtifactsInfo}async function Y$(){let t=yi.getSchemes(),n={};for(let e of t){let r=await yi.getManager(e).listModels();for(let o in r){let i=e+Kf+o;n[i]=r[o]}}return n}async function Z$(t){let n=Ab(t);return yi.getManager(n.scheme).removeModel(n.path)}async function Q$(t,n){return X$(t,n,!1)}async function J$(t,n){return X$(t,n,!0)}var w1=class{fetch(n,e){return fetch(n,e)}now(){return performance.now()}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)}decode(n,e){return new TextDecoder(e).decode(n)}};if(G().get("IS_BROWSER")){G().setPlatform("browser",new w1);try{yi.registerManager(nd.URL_SCHEME,new kb)}catch{}try{yi.registerManager(td.URL_SCHEME,new Nb)}catch{}}var eie={importFetch:()=>tL()},C1;var I1=class{constructor(){this.util=nL(),this.textEncoder=new this.util.TextEncoder}fetch(n,e){return G().global.fetch!=null?G().global.fetch(n,e):(C1==null&&(C1=eie.importFetch()),C1(n,e))}now(){let n=process.hrtime();return n[0]*1e3+n[1]/1e6}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(n)}decode(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)}};G().get("IS_NODE")&&G().setPlatform("node",new I1);function Ie(t,n="float32",e){return n=n||"float32",Ng(t),new Tt(t,n,e)}function tie(t,n){let e=N(t,"x","cast");if(!n1(n))throw new Error(`Failed to cast to unknown dtype ${n}`);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:n};return k.runKernel(Xi,r,o)}var se=A({cast_:tie});function nie(t){let e={x:N(t,"x","clone","string_or_numeric")};return k.runKernel(Yi,e)}var xi=A({clone_:nie});function rL(t,n=!1){console.log(t.toString(n))}m1();var rie={buffer:Ie,cast:se,clone:xi,print:rL};_$(rie);var Po={};ki(Po,{browserFiles:()=>iL,browserHTTPRequest:()=>cL,concatenateArrayBuffers:()=>Hf,copyModel:()=>Q$,decodeWeights:()=>Db,encodeWeights:()=>$$,fromMemory:()=>uL,getLoadHandlers:()=>j$,getModelArtifactsInfoForJSON:()=>Ji,getSaveHandlers:()=>U$,http:()=>Ob,isHTTPScheme:()=>Rb,listModels:()=>Y$,loadWeights:()=>sL,moveModel:()=>J$,registerLoadRouter:()=>z$,registerSaveRouter:()=>B$,removeModel:()=>Z$,weightsLoaderFactory:()=>D1,withSaveHandler:()=>dL});var oie="model",iie=".json",sie=".weights.bin";function oL(t){return new Promise(n=>setTimeout(n)).then(t)}var S1=(()=>{class t{constructor(e){if(!G().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),(e==null||e.length===0)&&(e=oie),this.modelTopologyFileName=e+iie,this.weightDataFileName=e+sie}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer);let s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=s,await oL(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await oL(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Ji(e)}}}}return t.URL_SCHEME="downloads://",t})(),T1=class{constructor(n){if(n==null||n.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${n}`);this.files=n}async load(){let n=this.files[0],e=this.files.slice(1);return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=JSON.parse(s.target.result),l=a.modelTopology;if(l==null){o(new Error(`modelTopology field is missing from file ${n.name}`));return}e.length===0&&r({modelTopology:l});let c=a.weightsManifest;if(c==null){o(new Error(`weightManifest field is missing from file ${n.name}`));return}let u;try{u=this.checkManifestAndWeightFiles(c,e)}catch(m){o(m);return}let d=[],p=[],f=[];c.forEach(m=>{m.paths.forEach(h=>{p.push(h),f.push(null)}),d.push(...m.weights)}),c.forEach(m=>{m.paths.forEach(h=>{let g=new FileReader;g.onload=y=>{let x=y.target.result,w=p.indexOf(h);if(f[w]=x,f.indexOf(null)===-1){let b={modelTopology:l,weightSpecs:d,weightData:Hf(f),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};a.signature!=null&&(b.signature=a.signature),a.userDefinedMetadata!=null&&(b.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(b.modelInitializer=a.modelInitializer),r(b)}},g.onerror=y=>o(`Failed to weights data from file of path '${h}'.`),g.readAsArrayBuffer(u[h])})})},i.onerror=s=>o(`Failed to read model topology and weights manifest JSON from file '${n.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(n)})}checkManifestAndWeightFiles(n,e){let r=[],o=e.map(s=>y1(s.name)),i={};for(let s of n)s.paths.forEach(a=>{let l=y1(a);if(r.indexOf(l)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${l}'`);if(r.push(l),o.indexOf(l)===-1)throw new Error(`Weight file with basename '${l}' is not provided.`);i[a]=e[o.indexOf(l)]});if(r.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${e.length}).`);return i}},aie=t=>G().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(S1.URL_SCHEME)?lie(t.slice(S1.URL_SCHEME.length)):null;kn.registerSaveRouter(aie);function lie(t="model"){return new S1(t)}function iL(t){return new T1(t)}function E1(t,n,e,r){s(t),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(c=>{let u=e+ ++o/t.length*(r-e);return n(u),c}),l);function s(l){M(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){M(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),M(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),M(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}async function _1(t,n){n==null&&(n={});let e=n.fetchFunc==null?G().platform.fetch:n.fetchFunc,r=t.map(d=>e(d,n.requestInit,{isBinary:!0})),a=(n.onProgress==null?await Promise.all(r):await E1(r,n.onProgress,0,.5)).map(d=>d.arrayBuffer());return n.onProgress==null?await Promise.all(a):await E1(a,n.onProgress,.5,1)}async function sL(t,n="",e,r){return D1(s=>_1(s,{requestInit:r}))(t,n,e)}function D1(t){return async(n,e="",r)=>{let o=n.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(n.forEach((f,m)=>{let h=0;f.weights.forEach(g=>{let y="quantization"in g?g.quantization.dtype:g.dtype,x=Lg[y]*kt(g.shape),w=()=>{o[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:g,groupOffset:h,sizeBytes:x})};r!=null?r.forEach((b,S)=>{b===g.name&&(w(),s[S]=!0)}):w(),a.push(g.name),h+=x})}),!s.every(f=>f)){let f=r.filter((m,h)=>!s[h]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((f,m,h)=>(m&&f.push(h),f),[]),c=[];l.forEach(f=>{n[f].paths.forEach(m=>{let h=e+(e.endsWith("/")?"":"/")+m;c.push(h)})});let u=await t(c),d={},p=0;return l.forEach(f=>{let m=n[f].paths.length,h=0;for(let b=0;b<m;b++)h+=u[p+b].byteLength;let g=new ArrayBuffer(h),y=new Uint8Array(g),x=0;for(let b=0;b<m;b++){let S=new Uint8Array(u[p+b]);y.set(S,x),x+=S.byteLength}i[f].forEach(b=>{let S=g.slice(b.groupOffset,b.groupOffset+b.sizeBytes),E=Db(S,[b.manifestEntry]);for(let D in E)d[D]=E[D]}),p+=m}),d}}var cie="application/octet-stream",uie="application/json",aL=(()=>{class t{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(M(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=G().platform.fetch,M(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&M(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(i)],{type:uie}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:cie}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:Ji(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let g=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?g+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":g+=" Please make sure the server is serving valid JSON for this request.",new Error(g)}let o=r.modelTopology,i=r.weightsManifest,s=r.generatedBy,a=r.convertedBy,l=r.format,c=r.signature,u=r.userDefinedMetadata;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let d,p;i!=null&&([d,p]=await this.loadWeights(i));let f={modelTopology:o,weightSpecs:d,weightData:p,generatedBy:s,convertedBy:a,format:l};c!=null&&(f.signature=c),u!=null&&(f.userDefinedMetadata=u);let m=r.modelInitializer;return m&&(f.modelInitializer=m),f}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=die(r),s=this.weightPathPrefix||o,a=[];for(let d of e)a.push(...d.weights);let l=[],c=[];for(let d of e)for(let p of d.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(p)):l.push(s+p+i);this.weightUrlConverter&&l.push(...await Promise.all(c));let u=await _1(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,Hf(u)]}}return t.URL_SCHEME_REGEX=/^https?:\/\//,t})();function die(t){let n=t.lastIndexOf("/"),e=t.lastIndexOf("?"),r=t.substring(0,n),o=e>n?t.substring(e):"";return[r+"/",o]}function Rb(t){return t.match(aL.URL_SCHEME_REGEX)!=null}var lL=(t,n)=>{if(typeof fetch>"u"&&(n==null||n.fetchFunc==null))return null;{let e=!0;if(Array.isArray(t)?e=t.every(r=>Rb(r)):e=Rb(t),e)return Ob(t,n)}return null};kn.registerSaveRouter(lL);kn.registerLoadRouter(lL);function Ob(t,n){return new aL(t,n)}function cL(t,n){return Ob(t,n)}var Vg=class{constructor(n){this.modelArtifacts=n}async load(){return this.modelArtifacts}},N1=class{constructor(n){this.saveHandler=n}async save(n){return this.saveHandler(n)}};function uL(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new Vg(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vg({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Vg({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))}function dL(t){return new N1(t)}function pie(t,n,e=!1,r=!1){let o=N(t,"a","matMul"),i=N(n,"b","matMul");[o,i]=Xe(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return k.runKernel(Fl,s,a)}var ht=A({matMul_:pie});function fie(t,n,e=1,r=0){if(n<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${n}`);let i={indices:N(t,"indices","oneHot","int32")},s={depth:n,onValue:e,offValue:r};return k.runKernel(oc,i,s)}var Yf=A({oneHot_:fie});function mie(t,n){let e=N(t,"x","transpose");if(n==null&&(n=e.shape.map((i,s)=>s).reverse()),M(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of perm ${n}.`),n.forEach(i=>{M(i>=0&&i<e.rank,()=>`All entries in 'perm' must be between 0 and ${e.rank-1} but got ${n}`)}),e.rank<=1)return e.clone();let r={x:e},o={perm:n};return k.runKernel(xc,r,o)}var rt=A({transpose_:mie});function hie(t,n){let e=t.shape.length,r=n.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(n.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${n.shape[r-1]} vs. ${e}`);if(kt(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=n.shape,i=o[o.length-1],s=1;for(let d=0;d<o.length-1;++d)s*=o[d];let a=t.shape,l=o.slice();l.pop();let c=1;for(let d=i;d<e;++d)c*=a[d],l.push(a[d]);let u=[...Ki(t.shape).map(d=>d/c),1].slice(0,i);return[l,s,c,u]}function pL(t,n,e){let r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${n.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(t.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+t.length-r)throw new Error(i+` update.rank != ${o+t.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==n.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${n.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==t[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${t[s+o]})`)}function gie(t,n,e){if(n.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${n.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(n.size===0)throw new Error(`Indices specified for empty output. indices shape: ${n.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}pL(e,n,t)}function yie(t,n,e){let r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,s=1;for(let d=o;d<i;++d)s*=e[d];let a=o<1?1:o,l=kt(n.shape)/a,c=[...Ki(e.slice(0,o)),1],u=kt(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}var qn={};ki(qn,{assertParamsValid:()=>xie,computeFlatOffset:()=>bie,computeOutShape:()=>fL,getNormalizedAxes:()=>yL,isSliceContinous:()=>vie,maskToAxes:()=>Mb,parseSliceParams:()=>k1,sliceInfo:()=>wie,startForAxis:()=>wL,startIndicesWithElidedDims:()=>xL,stopForAxis:()=>CL,stopIndicesWithElidedDims:()=>vL,stridesForAxis:()=>bL,stridesWithElidedDims:()=>mL});function xie(t,n,e){let r=t.shape.length;M(r===n.length,()=>`Error in slice${r}D: Length of begin ${n} must match the rank of the array (${r}).`),M(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)M(n[o]+e[o]<=t.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${n[o]+e[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function Mb(t){let n=[],e=0;for(;t>0;)t&1&&n.push(e),t/=2,e++;return n}function fL(t,n,e){let r=[];for(let o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function mL(t,n,e,r){let o=[...t];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[n]=1:(o.splice(n,0,1),o.pop());return o}function hL(t,n,e){return e<=t?e:e-(n-1)}function gL(t,n){let e=[];for(let r=0;r<t;r++)e.push(n+r);return e}function yL(t,n,e,r,o,i,s,a,l){let c=t.length,u=new Array(c),d=new Array(c),p=new Array(c);if(n.length&&e>0){let f=n[0],m=e+1;u=xL(s,f,m,r,t),d=vL(a,f,m,o,t),p=mL(i,f,m,t)}else for(let f=0;f<c;f++)u[f]=wL(s,r,i,t,f,l),d[f]=CL(a,o,i,t,f,l),p[f]=bL(i,f,l);return{begin:u,end:d,strides:p}}function xL(t,n,e,r,o){let i=[...o],s=gL(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=hL(n,e,a),c=r[l];t&1<<l&&(c=0),i[a]=c}return i}function vL(t,n,e,r,o){let i=[...o],s=gL(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=hL(n,e,a),c=r[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=af(0,i[a],o[a])}return i}function bL(t,n,e){let r=t[n];return(e&1<<n||r==null)&&(r=1),r}function wL(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=af(0,s,l-1),s}function CL(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=af(0,s,l):s=af(-1,s,l-1),s}function vie(t,n,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function bie(t,n){let e=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function k1(t,n,e){let r,o=t.shape.length;typeof n=="number"?r=[n,...new Array(o-1).fill(0)]:n.length<o?r=n.concat(new Array(o-n.length).fill(0)):r=n.slice(),r.forEach(s=>{M(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(M(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function wie(t,n,e,r,o,i,s,a,l){let c=n.slice(),u=e.slice(),d=r;r==null&&(d=new Array(c.length));let p=Mb(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(s!==0&&a!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(s!==0&&l!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let f=t.length-c.length,m=Mb(a),h=t.slice();m.forEach(D=>{c[D]=0,u[D]=1,h.splice(D,0,1)});let{begin:g,end:y,strides:x}=yL(h,p,f,c,u,d,o,i,s);c=g,u=y,d=x;let w=Mb(l);w.forEach(D=>{u[D]=c[D]+1,d[D]=1});let b=fL(c,u,d),S=b.filter((D,O)=>w.indexOf(O)===-1);return{nonStrided:d.every(D=>D===1),$begin:c,$end:u,$strides:d,size:b,newShape:h,outShape:S}}var Z={};ki(Z,{Serializable:()=>Bg,SerializationMap:()=>Fb,registerClass:()=>kr});var Bg=class{getClassName(){return this.constructor.className}static fromConfig(n,e){return new n(e)}},Fb=class t{constructor(){this.classNameMap={}}static getMap(){return t.instance==null&&(t.instance=new t),t.instance}static register(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]}};function kr(t){M(t.className!=null,()=>"Class being registered does not have the static className property defined."),M(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),M(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Fb.register(t)}function Cie(t){G().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}D$(Cie);function Ma(){return k}function zg(){return k.memory()}function z(t,n){return k.tidy(t,n)}function Oe(t){Sb(t).forEach(e=>e.dispose())}function An(t){return k.keep(t)}function Pb(t,n,e=1){return k.registerBackend(t,n,e)}function IL(){return k.backend}function Iie(t,n){let e=N(t,"a","add"),r=N(n,"b","add");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(mi,o)}var ee=A({add_:Iie});function Sie(t,n){let e=N(t,"a","floorDiv"),r=N(n,"b","floorDiv");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(ra,o)}var $b=A({floorDiv_:Sie});function Tie(t,n){let e=N(t,"a","div"),r=N(n,"b","div");if([e,r]=Xe(e,r),e.dtype==="int32"&&r.dtype==="int32")return $b(e,r);let o={a:e,b:r},i={};return k.runKernel(Zs,o,i)}var pe=A({div_:Tie});function Eie(t,n){let e=N(t,"a","mul"),r=N(n,"b","mul");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(fa,o)}var L=A({mul_:Eie});function _ie(t){let n=N(t,"x","abs");if(n.dtype==="complex64"){let e={x:n};return k.runKernel($l,e)}else{let e={x:n};return k.runKernel(kl,e)}}var bn=A({abs_:_ie});function Die(t){let e={x:N(t,"x","acos")};return k.runKernel(Bs,e)}var A1=A({acos_:Die});function Nie(t){let e={x:N(t,"x","acosh")};return k.runKernel(zs,e)}var R1=A({acosh_:Nie});function kie(t,n=null,e=!1){let o={x:N(t,"x","all","bool")},i={axis:n,keepDims:e};return k.runKernel(mf,o,i)}var Ug=A({all_:kie});function Aie(t,n=null,e=!1){let o={x:N(t,"x","any","bool")},i={axis:n,keepDims:e};return k.runKernel(hf,o,i)}var Zf=A({any_:Aie});function Rie(t,n=0){let r={x:N(t,"x","argMax")},o={axis:n};return k.runKernel(Al,r,o)}var Qf=A({argMax_:Rie});function Oie(t,n=0){let r={x:N(t,"x","argMin")},o={axis:n};return k.runKernel(Rl,r,o)}var SL=A({argMin_:Oie});function Mie(t){let e={x:N(t,"x","asin")};return k.runKernel(Us,e)}var O1=A({asin_:Mie});function Fie(t){let e={x:N(t,"x","asinh")};return k.runKernel(js,e)}var M1=A({asinh_:Fie});function Pie(t){let e={x:N(t,"x","atan")};return k.runKernel(Gs,e)}var F1=A({atan_:Pie});function $ie(t,n){let e=N(t,"a","atan2"),r=N(n,"b","atan2");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(Hs,o)}var TL=A({atan2_:$ie});function Lie(t){let e={x:N(t,"x","atanh")};return k.runKernel(Ws,e)}var P1=A({atanh_:Lie});function Vie(t,n,e,r,o="NHWC",i){let s=t[3],a=[...n,s],l=_L(o);return id(t,a,e,i,r,null,null,l)}function L1(t,n,e,r,o,i,s="channelsLast"){let[a,l]=Lb(n),c;if(s==="channelsLast")c=[a,l,t[3],t[3]];else if(s==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return id(t,c,e,r,o,i,!1,s)}function Bie(t,n,e,r,o,i,s="NDHWC"){let[a,l,c]=$1(n),u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return EL(t,u,e,r,o,!1,d,i)}function id(t,n,e,r,o,i,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);let[p,f,,m]=n,[h,g]=Lb(e),[y,x]=Lb(r),w=Jf(p,y),b=Jf(f,x),{padInfo:S,outHeight:E,outWidth:D}=jie(o,c,u,h,g,w,b,i,a),O=s?m*d:m,R;return a==="channelsFirst"?R=[l,O,E,D]:a==="channelsLast"&&(R=[l,E,D,O]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:E,outWidth:D,outChannels:O,padInfo:S,strideHeight:h,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:w,effectiveFilterWidth:b,dilationHeight:y,dilationWidth:x,inShape:t,outShape:R,filterShape:n}}function EL(t,n,e,r,o,i=!1,s="channelsLast",a){let[l,c,u,d,p]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,p]=t;else if(s==="channelsFirst")[l,p,c,u,d]=t;else throw new Error(`Unknown dataFormat ${s}`);let[f,m,h,,g]=n,[y,x,w]=$1(e),[b,S,E]=$1(r),D=Jf(f,b),O=Jf(m,S),R=Jf(h,E),{padInfo:P,outDepth:U,outHeight:j,outWidth:W}=Gie(o,c,u,d,y,x,w,D,O,R,a),K=i?g*p:g,H;return s==="channelsFirst"?H=[l,K,U,j,W]:s==="channelsLast"&&(H=[l,U,j,W,K]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:p,outDepth:U,outHeight:j,outWidth:W,outChannels:K,padInfo:P,strideDepth:y,strideHeight:x,strideWidth:w,filterDepth:f,filterHeight:m,filterWidth:h,effectiveFilterDepth:D,effectiveFilterHeight:O,effectiveFilterWidth:R,dilationDepth:b,dilationHeight:S,dilationWidth:E,inShape:t,outShape:H,filterShape:n}}function zie(t,n,e,r,o){r==null&&(r=V1(t,n,e));let i=t[0],s=t[1],a=od((i-n+2*r)/e+1,o),l=od((s-n+2*r)/e+1,o);return[a,l]}function Uie(t,n,e,r,o,i){o==null&&(o=V1(t,n,r));let s=t[0],a=t[1],l=t[2],c=od((s-n+2*o)/r+1,i),u=od((a-n+2*o)/r+1,i),d=od((l-n+2*o)/r+1,i);return[c,u,d,e]}function V1(t,n,e,r=1){let o=Jf(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function Lb(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function $1(t){return typeof t=="number"?[t,t,t]:t}function Jf(t,n){return n<=1?t:t+(t-1)*(n-1)}function jie(t,n,e,r,o,i,s,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let f=zie([n,e],i,r,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(n/r),d=Math.ceil(e/o);let p=Math.max(0,(u-1)*r+i-n),f=Math.max(0,(d-1)*o+s-e),m=Math.floor(p/2),h=p-m,g=Math.floor(f/2),y=f-g;c={top:m,bottom:h,left:g,right:y,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((n-i+1)/r),d=Math.ceil((e-s+1)/o);else if(typeof t=="object"){let p=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];c={top:p,bottom:f,left:m,right:h,type:p===0&&f===0&&m===0&&h===0?"VALID":"EXPLICIT"},u=od((n-i+p+f)/r+1,a),d=od((e-s+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function Gie(t,n,e,r,o,i,s,a,l,c,u){let d,p,f,m;if(typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=Uie([n,e,r,1],a,1,o,t,u);p=g[0],f=g[1],m=g[2]}else if(t==="same"){p=Math.ceil(n/o),f=Math.ceil(e/i),m=Math.ceil(r/s);let h=(p-1)*o+a-n,g=(f-1)*i+l-e,y=(m-1)*s+c-r,x=Math.floor(h/2),w=h-x,b=Math.floor(g/2),S=g-b,E=Math.floor(y/2),D=y-E;d={top:b,bottom:S,left:E,right:D,front:x,back:w,type:"SAME"}}else if(t==="valid")d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((n-a+1)/o),f=Math.ceil((e-l+1)/i),m=Math.ceil((r-c+1)/s);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:p,outHeight:f,outWidth:m}}function od(t,n){if(!n)return Math.trunc(t);switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${n}`)}}function mo(t){let[n,e,r]=Lb(t);return n===1&&e===1&&r===1}function Ln(t,n){return mo(t)||mo(n)}function _L(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function Wie(t,n){let r={x:N(t,"x","reshape","string_or_numeric")},o={shape:n};return k.runKernel(lc,r,o)}var V=A({reshape_:Wie});function Hie(t,n,e,r,o){let i=N(t,"x","avgPool","float32"),s=1;M(Ln(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=V(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),o!=null&&M(mt(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(Ol,c,u);return d=se(d,i.dtype),l?V(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var sd=A({avgPool_:Hie});function qie(t,n,e,r,o,i="NDHWC"){let s=N(t,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&M(mt(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(Ml,c,u);return d=se(d,a.dtype),l?V(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var B1=A({avgPool3d_:qie});function Kie(t,n=0){M(t.length>=1,()=>"Pass at least one tensor to concat");let e=Eb(t,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return xi(e[0]);let r=e,o={axis:n};return k.runKernel(Ll,r,o)}var $t=A({concat_:Kie});function Xie(t){let e={x:N(t,"x","sigmoid")};return k.runKernel(Sa,e)}var $o=A({sigmoid_:Xie});function Yie(t,n,e){let r=N(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:n,size:e};return k.runKernel(fc,o,i)}var it=A({slice_:Yie});function Zie(t){let e={x:N(t,"x","tanh")};return k.runKernel(ka,e)}var em=A({tanh_:Zie});function Qie(t,n,e){let r=N(t,"x","batchToSpaceND"),o=n.reduce((a,l)=>a*l);M(r.rank>=1+n.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${n.length}`),M(e.length===n.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${n.length}`),M(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${n.join(" * ")} === ${o}`);let i={x:r},s={blockShape:n,crops:e};return k.runKernel(Pl,i,s)}var tm=A({batchToSpaceND_:Qie});function DL(t){let n;return t.rank===0||t.rank===1?n=V(t,[1,1,1,t.size]):t.rank===2?n=V(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?n=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]):n=t,n}function Jie(t,n,e,r,o,i){i==null&&(i=.001);let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;r!=null&&(u=N(r,"offset","batchNorm")),M(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),M(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),M(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:DL(s),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},m=k.runKernel(Hl,p,f);return V(m,s.shape)}var Ec=A({batchNorm_:Jie});function ese(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),M(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),M(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Ec(s,a,l,u,c,i)}var z1=A({batchNorm2d_:ese});function tse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),M(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),M(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Ec(s,a,l,u,c,i)}var U1=A({batchNorm3d_:tse});function nse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),M(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),M(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Ec(s,a,l,u,c,i)}var j1=A({batchNorm4d_:nse});function rse(t,n){let e=N(t,"broadcastTo","x"),r=e.shape;if(n.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${n}].`);if(n.length<e.rank)throw new Error(`broadcastTo(): shape.length=${n.length} < input.rank=${e.rank}.`);if(n.length>e.rank){let c=e.shape.slice();for(;c.length<n.length;)c.unshift(1);e=V(e,c)}let o=e.shape,i=Array.from(n);for(let c=n.length-1;c>=0;c--)if(o[c]===n[c])i[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${n}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return xi(e);let a={x:e},l={reps:i};return k.runKernel(Zi,a,l)}var nm=A({broadcastTo_:rse});function ose(t){let e={x:N(t,"x","ceil")};return k.runKernel(qs,e)}var G1=A({ceil_:ose});function ise(t,n,e){let r=N(t,"x","clipByValue");M(n<=e,()=>`Error in clip: min (${n}) must be less than or equal to max (${e}).`);let o={x:r},i={clipValueMin:n,clipValueMax:e};return k.runKernel(Ks,o,i)}var Vn=A({clipByValue_:ise});function sse(t){return $t(t,0)}var W1=A({concat1d_:sse});function ase(t,n){return $t(t,n)}var H1=A({concat2d_:ase});function lse(t,n){return $t(t,n)}var q1=A({concat3d_:lse});function cse(t,n){return $t(t,n)}var K1=A({concat4d_:cse});function use(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","conv2d"),l=N(n,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),s!=null&&M(mt(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d=o==="NHWC"?c.shape[3]:c.shape[1];M(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),M(Ln(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},m=k.runKernel(Vl,p,f);return u?V(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Xr=A({conv2d_:use});function dse(t,n,e,r,o="NWC",i=1,s){let a=N(t,"x","conv1d"),l=N(n,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=V(a,[1,a.shape[0],a.shape[1]])),M(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),M(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),s!=null&&M(mt(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),M(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),M(Ln(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),M(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let d=V(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=V(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=Xr(p,d,[1,e],r,"NHWC",[1,i],s);return u?V(g,[g.shape[2],g.shape[3]]):V(g,[g.shape[0],g.shape[2],g.shape[3]])}var jg=A({conv1d_:dse});function pse(t,n,e,r,o,i="NHWC",s){M(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let a=t,l=n,c=!1;n.rank===3&&(c=!0,l=V(n,[1,n.shape[0],n.shape[1],n.shape[2]]),a=[1,t[0],t[1],t[2]]),M(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),M(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),M(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];M(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),M(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),s!=null&&M(mt(o),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let p={dy:l,filter:e},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},m=k.runKernel(Bl,p,f);return c?V(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var rm=A({conv2DBackpropInput_:pse});function fse(t,n,e,r,o,i){let s=N(t,"x","conv2dTranspose"),a=N(n,"filter","conv2dTranspose");return rm(e,s,a,r,o,"NHWC",i)}var Gg=A({conv2dTranspose_:fse});function mse(t,n,e,r,o="NDHWC",i=[1,1,1]){let s=N(t,"x","conv3d"),a=N(n,"filter","conv3d"),l=s,c=!1;s.rank===4&&(c=!0,l=V(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),M(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),M(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),M(Ln(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),M(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let u={x:l,filter:a},d={strides:e,pad:r,dataFormat:o,dilations:i},p=k.runKernel(zl,u,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var X1=A({conv3d_:mse});function hse(t,n,e,r,o){M(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let i=t,s=n,a=!1;n.rank===4&&(a=!0,s=V(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);let l=i[4],c=s.shape[4];M(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),M(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),M(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),M(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),M(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let u={dy:s,filter:e},d={pad:o,strides:r,inputShape:i},p=k.runKernel(wf,u,d);return a?V(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Vb=A({conv3DBackpropInput_:hse});function gse(t,n,e,r,o){let i=N(t,"x","conv3dTranspose"),s=N(n,"filter","conv3dTranspose");return Vb(e,i,s,r,o)}var Y1=A({conv3dTranspose_:gse});function yse(t){let e={x:N(t,"x","cos")};return k.runKernel(Xs,e)}var ad=A({cos_:yse});function xse(t){let e={x:N(t,"x","cosh")};return k.runKernel(Ys,e)}var Wg=A({cosh_:xse});function vse(t,n=0,e=!1,r=!1){let i={x:N(t,"x","cumsum")},s={axis:n,exclusive:e,reverse:r};return k.runKernel(Ul,i,s)}var Bb=A({cumsum_:vse});function bse(t,n,e="NHWC"){let r=N(t,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];M(o*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${n}  for depthToSpace with input shape
    ${r.shape}`),M(i*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${n} for depthToSpace with input shape
        ${r.shape}`),M(s%(n*n)===0,()=>`Dimension size must be evenly divisible by ${n*n} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:n,dataFormat:e};return k.runKernel(Cf,a,l)}var NL=A({depthToSpace_:bse});function wse(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","depthwiseConv2d"),l=N(n,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`),M(c.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),s!=null&&M(mt(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d={x:c,filter:l},p={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},f=k.runKernel(jl,d,p);return u?V(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Pa=A({depthwiseConv2d_:wse});function Cse(t,n,e,r,o=[1,1],i="NHWC"){let s=N(t,"x","dilation2d"),a=N(n,"filter","dilation2d");M(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),M(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),M(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,c=!1;s.rank===3&&(l=V(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0);let u={x:l,filter:a},d={strides:e,pad:r,dilations:o},p=k.runKernel(Gl,u,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var kL=A({dilation2d_:Cse});function Ise(t,n){let e=t.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=t[i]||1;(n[n.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function At(t,n){let e=[];for(let r=0;r<n.length;r++){let o=t[t.length-r-1],i=n.length-r-1,s=n[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function Ue(t,n){let e=[],r=Math.max(t.length,n.length);for(let o=0;o<r;o++){let i=t[t.length-o-1];i==null&&(i=1);let s=n[n.length-o-1];if(s==null&&(s=1),i===1)e.unshift(s);else if(s===1)e.unshift(i);else if(i!==s){let a=`Operands could not be broadcast together with shapes ${t} and ${n}.`;throw Error(a)}else e.unshift(i)}return e}function Sse(t,n){let e=N(t,"a","equal"),r=N(n,"b","equal");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Bu,o)}var Lo=A({equal_:Sse});function Tse(t,n,e){let r=N(n,"a","where"),o=N(e,"b","where"),i=N(t,"condition","where","bool"),s=Ue(Ue(i.shape,r.shape),o.shape),a=nm(i,s),l=nm(r,s),c=nm(o,s),u={condition:a,t:l,e:c};return k.runKernel(pc,u)}var sn=A({where_:Tse});function Ese(t){let e={x:N(t,"x","zerosLike")};return k.runKernel(wc,e)}var Se=A({zerosLike_:Ese});function _se(t,n){let e=N(t,"a","div"),r=N(n,"b","div");[e,r]=Xe(e,r);let o=pe(e,r),i=Se(o),s=Lo(r,i);return sn(s,i,o)}var AL=A({divNoNan_:_se});function Dse(t,n){let e=N(t,"t1","dot"),r=N(n,"t2","dot");M((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(M(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=V(e,[1,-1]),a=V(r,[-1,1]),l=ht(s,a);return V(l,[])}else if(e.rank===1&&r.rank===2){let s=V(e,[1,-1]),a=V(r,[r.shape[0],r.shape[1]]),l=ht(s,a);return V(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=V(r,[-1,1]),a=ht(e,s);return V(a,[a.size])}else{let s=V(r,[r.shape[0],r.shape[1]]);return ht(e,s)}}var RL=A({dot_:Dse});function Nse(t){let e={x:N(t,"x","elu")};return k.runKernel(Qs,e)}var $a=A({elu_:Nse});function kse(t){let n=N(t,"x","erf");M(n.dtype==="int32"||n.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),n.dtype==="int32"&&(n=se(n,"float32"));let e={x:n};return k.runKernel(Js,e)}var Z1=A({erf_:kse});function Ase(t){let e={x:N(t,"x","exp")};return k.runKernel(ea,e)}var fr=A({exp_:Ase});function Rse(t,n=0){let e=N(t,"x","expandDims","string_or_numeric");M(n<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:n};return k.runKernel(Wl,r,o)}var Kn=A({expandDims_:Rse});function Ose(t){let e={x:N(t,"x","expm1")};return k.runKernel(ta,e)}var Q1=A({expm1_:Ose});function Mse(t,n){let e=N(t,"x","tile","string_or_numeric");M(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${n}.`);let r={x:e},o={reps:n};return k.runKernel(Zi,r,o)}var vi=A({tile_:Mse});function Fse(t,n,e,r="float32"){n==null&&(n=t);let o=Ie([t,n],r),i=t<=n?t:n;for(let a=0;a<i;++a)o.set(1,a,a);let s=V(o.toTensor(),[t,n]);if(e==null)return s;if(e.length===1)return vi(Kn(s,0),[e[0],1,1]);if(e.length===2)return vi(Kn(Kn(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return vi(Kn(Kn(Kn(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var om=A({eye_:Fse});function Hg(t,n,e){let r={shape:t,value:n,dtype:e};return k.runKernel(_f,{},r)}function Pse(t){let e={x:N(t,"x","floor")};return k.runKernel(na,e)}var La=A({floor_:Pse});function $se(t,n,e=0,r=0){let o=N(t,"x","gather"),i=N(n,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return k.runKernel(ql,s,a)}var ld=A({gather_:$se});function Lse(t,n){let e=N(t,"a","greater"),r=N(n,"b","greater");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(zu,o)}var Bn=A({greater_:Lse});function Vse(t,n){let e=N(t,"a","greaterEqual"),r=N(n,"b","greaterEqual");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(oa,o)}var ho=A({greaterEqual_:Vse});function Bse(t){let e={input:N(t,"input","imag")};return k.runKernel(Nf,e)}var zb=A({imag_:Bse});function zse(t){let e={x:N(t,"x","isFinite")};return k.runKernel(ia,e)}var J1=A({isFinite_:zse});function Use(t){let e={x:N(t,"x","isInf")};return k.runKernel(sa,e)}var eD=A({isInf_:Use});function jse(t){let e={x:N(t,"x","isNaN")};return k.runKernel(aa,e)}var tD=A({isNaN_:jse});function Gse(t,n=.2){let r={x:N(t,"x","leakyRelu")},o={alpha:n};return k.runKernel(Kl,r,o)}var cd=A({leakyRelu_:Gse});function Wse(t,n){let e=N(t,"a","less"),r=N(n,"b","less");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Uu,o)}var Ub=A({less_:Wse});function Hse(t,n){let e=N(t,"a","lessEqual"),r=N(n,"b","lessEqual");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(ju,o)}var es=A({lessEqual_:Hse});function qse(t,n=5,e=1,r=1,o=.5){let i=N(t,"x","localResponseNormalization");M(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),M(mt(n),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${n}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=V(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},c={depthRadius:n,bias:e,alpha:r,beta:o},u=k.runKernel(Xl,l,c);return a?V(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var OL=A({localResponseNormalization_:qse});function Kse(t){let e={x:N(t,"x","log")};return k.runKernel(la,e)}var mr=A({log_:Kse});function Xse(t){let e={x:N(t,"x","log1p")};return k.runKernel(ca,e)}var nD=A({log1p_:Xse});function rD(t,n){M(uf(t),()=>"The f passed in variableGrads(f) must be a function"),M(n==null||Array.isArray(n)&&n.every(c=>c instanceof Ra),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=n!=null;if(!e){n=[];for(let c in k.registeredVariables)n.push(k.registeredVariables[c])}let r=e?n.filter(c=>!c.trainable):null,o=n.length;n=n.filter(c=>c.trainable),M(n.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=k.gradients(t,n,null,i);M(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),M(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return n.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:s,grads:l}}function go(t){return k.customGrad(t)}function Yse(t){let e={x:N(t,"x","neg")};return k.runKernel(nc,e)}var gt=A({neg_:Yse});function Zse(t){let e={x:N(t,"x","softplus")};return k.runKernel(Ta,e)}var ts=A({softplus_:Zse});function Qse(t){let n=N(t,"x","logSigmoid");return go(r=>({value:gt(ts(gt(r))),gradFunc:s=>L(s,$o(gt(r)))}))(n)}var oD=A({logSigmoid_:Qse});function Jse(t,n=null,e=!1){let o={x:N(t,"x","max")},i={reductionIndices:n,keepDims:e};return k.runKernel(Yl,o,i)}var zn=A({max_:Jse});function eae(t,n){let e=N(t,"a","sub"),r=N(n,"b","sub");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(Da,o)}var we=A({sub_:eae});function tae(t,n=null,e=!1){let r=N(t,"x","sum");r.dtype==="bool"&&(r=se(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(mc,o,i)}var ve=A({sum_:tae});function nae(t,n=-1){let e=N(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${n}`);return go((o,i)=>{let a=zn(o,n,!0),l=we(o,a),c=we(se(l,"float32"),mr(ve(fr(l),n,!0)));return i([c]),{value:c,gradFunc:(d,p)=>{let[f]=p,m=!0,h=fr(f);return we(d,L(ve(d,n,m),h))}}})(e)}var qg=A({logSoftmax_:nae});function iD(t,n){for(let e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function ML(t,n,e){let r=t.length+n.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(t[i++]):o.push(n[s++]);return o}function sD(t,n){let e=[],r=t.length;for(let i=0;i<r;i++)n.indexOf(i)===-1&&e.push(t[i]);let o=n.map(i=>t[i]);return[e,o]}function ns(t,n){let e=n.map(r=>1);return ML(t,e,n)}function rae(t,n,e){M(iD(n,e),()=>`${t} supports only inner-most axes for now. Got axes ${n} and rank-${e} input.`)}function aD(t,n){if(iD(t,n))return null;let e=[];for(let r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(r=>e.push(r)),e}function Kg(t){return t.map((n,e)=>[e,n]).sort((n,e)=>n[1]-e[1]).map(n=>n[0])}function oae(t,n){let e=[];for(let r=n-t;r<n;++r)e.push(r);return e}function iae(t,n=null,e=!1){let r=N(t,"x","logSumExp"),o=vn(n,r.shape),i=zn(r,o,!0),s=we(r,i),a=fr(s),l=ve(a,o),c=mr(l),u=ee(V(i,c.shape),c);if(e){let d=ns(u.shape,o);return V(u,d)}return u}var FL=A({logSumExp_:iae});function sae(t,n){let e=N(t,"a","logicalAnd","bool"),r=N(n,"b","logicalAnd","bool");Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Gu,o)}var ar=A({logicalAnd_:sae});function aae(t){let e={x:N(t,"x","logicalNot","bool")};return k.runKernel(Wu,e)}var im=A({logicalNot_:aae});function lae(t,n){let e=N(t,"a","logicalOr","bool"),r=N(n,"b","logicalOr","bool");Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Hu,o)}var jb=A({logicalOr_:lae});function cae(t,n){let e=N(t,"a","logicalXor","bool"),r=N(n,"b","logicalXor","bool");return Ue(e.shape,r.shape),ar(jb(t,n),im(ar(t,n)))}var PL=A({logicalXor_:cae});function uae(t,n,e,r,o){let i=N(t,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=V(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),M(Ln(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),o!=null&&M(mt(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(Zl,c,u);return l?V(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ud=A({maxPool_:uae});function dae(t,n=[1,1,1],e,r,o,i="NDHWC"){let s=N(t,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&M(mt(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(Ql,c,u);return l?V(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var cD=A({maxPool3d_:dae});function pae(t,n){let e=N(t,"a","maximum"),r=N(n,"b","maximum");[e,r]=Xe(e,r),e.dtype==="bool"&&(e=se(e,"int32"),r=se(r,"int32")),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(ua,o)}var Yr=A({maximum_:pae});function fae(t,n=null,e=!1){let o={x:N(t,"x","mean")},i={axis:n,keepDims:e};return k.runKernel(Jl,o,i)}var jt=A({mean_:fae});function Lt(t,n="float32"){if(n==="complex64"){let r=Lt(t,"float32"),o=Lt(t,"float32");return gi(r,o)}let e=pf(kt(t),n);return k.makeTensor(e,t,n)}function Zr(t,n="float32"){if(n==="complex64"){let r=Zr(t,"float32"),o=Lt(t,"float32");return gi(r,o)}let e=Dg(kt(t),n);return k.makeTensor(e,t,n)}function mae(t,n=null,e=!1){let o={x:N(t,"x","min")},i={axis:n,keepDims:e};return k.runKernel(ec,o,i)}var Dc=A({min_:mae});function hae(t,n){let e=N(t,"a","minimum"),r=N(n,"b","minimum");[e,r]=Xe(e,r),e.dtype==="bool"&&(e=se(e,"int32"),r=se(r,"int32")),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(da,o)}var dd=A({minimum_:hae});function gae(t,n,e){M(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=N(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");M(n.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${n.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)M(n[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),M(n[a][0]>=0&&n[a][0]<=r.shape[a]-o&&n[a][1]>=0&&n[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:n,mode:e},s={x:r};return k.runKernel(tc,s,i)}var $L=A({mirrorPad_:gae});function yae(t,n){let e=N(t,"a","mod"),r=N(n,"b","mod");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(pa,o)}var LL=A({mod_:yae});function xae(t){let n=N(t,"x","square"),e={};return k.runKernel("Square",{x:n},e)}var Ge=A({square_:xae});function vae(t,n=null,e=!1){t=N(t,"x","moments");let r=vn(n,t.shape),o=jt(t,r,e),i=o.shape;e||(i=ns(o.shape,r));let s=Ge(we(se(t,"float32"),V(o,i))),a=jt(s,r,e);return{mean:o,variance:a}}var sm=A({moments_:vae});function bae(t,n){let e=N(t,"a","notEqual"),r=N(n,"b","notEqual");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(qu,o)}var Nc=A({notEqual_:bae});function wae(t){let e={x:N(t,"x","onesLike")};return k.runKernel(rc,e)}var Rn=A({onesLike_:wae});function Cae(t,n,e=0){let r=N(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:n,constantValue:e},i={x:r};return k.runKernel(sc,i,o)}var pd=A({pad_:Cae});function Iae(t,n,e){let r=N(t,"x","spaceToBatchND");M(r.rank>=1+n.length,()=>`input rank ${r.rank} should be > than [blockShape] ${n.length}`),M(e.length===n.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${n.length}`),M(r.shape.reduce((s,a,l)=>l>0&&l<=n.length?s&&(a+e[l-1][0]+e[l-1][1])%n[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${n.toString()}`);let o={x:r},i={blockShape:n,paddings:e};return k.runKernel(hc,o,i)}var am=A({spaceToBatchND_:Iae});function Sae(t,n,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=N(t,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2]])),M(Ln(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let c=L1(a.shape,n,i,o,r),u=[c.dilationHeight,c.dilationWidth],d;r==="same"?d=Eae([c.filterHeight,c.filterWidth],u):d=[[0,0],[0,0]];let p=u[0]===1&&u[1]===1,[f,m]=Tae([c.inHeight,c.inWidth],u,d),h=p?r:"valid",g=p?a:am(a,u,f),x=(e==="avg"?()=>sd(g,n,i,h):()=>ud(g,n,i,h))(),w=p?x:tm(x,u,m);return l?V(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function Tae(t,n,e){let r=e.map(u=>u[0]),o=e.map(u=>u[1]),i=t.concat(r,o),s=n.map((u,d)=>(u-i[d]%u)%u),a=o.map((u,d)=>u+s[d]),l=n.map((u,d)=>[r[d],a[d]]),c=n.map((u,d)=>[0,s[d]]);return[l,c]}function Eae(t,n){let r=t.map((s,a)=>s+(s-1)*(n[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var VL=A({pool_:Sae});function _ae(t,n){let e=N(t,"base","pow"),r=N(n,"exp","pow");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(ma,o)}var Vo=A({pow_:_ae});function Dae(t,n){let e=N(t,"x","prelu"),r=N(n,"alpha","prelu"),o={x:e,alpha:r};return k.runKernel(ac,o)}var fd=A({prelu_:Dae});function Nae(t,n=null,e=!1){let r=N(t,"x","prod");r.dtype==="bool"&&(r=se(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(Of,o,i)}var BL=A({prod_:Nae});var gD=qm(tV());var lm=class{constructor(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=gD.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let n,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(n))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(n)}convertValue(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)}isValidTruncated(n){return n<=this.upper&&n>=this.lower}};var Hb=class{constructor(n=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${n} - ${e} <= 1 and dtype is not float`);this.random=gD.alea(o)}convertValue(n){return this.canReturnFloat()?n:Math.round(n)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Pae(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new lm(n,e,r,!1,o),s=Ie(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var qb=A({randomNormal_:Pae});function $ae(t,n=0,e=1,r="float32",o){let i=Ie(t,r),s=new Hb(n,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var Va=A({randomUniform_:$ae});function yD(t,n,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:n,step:e,dtype:r};return k.runKernel(Mf,{},o)}function Lae(t){let e={input:N(t,"input","real")};return k.runKernel(Ff,e)}var Xg=A({real_:Lae});function Vae(t){let e={x:N(t,"x","reciprocal")};return k.runKernel(ha,e)}var xD=A({reciprocal_:Vae});function Bae(t){let e={x:N(t,"x","relu")};return k.runKernel(ga,e)}var Bo=A({relu_:Bae});function zae(t){let e={x:N(t,"x","relu6")};return k.runKernel(ya,e)}var Kb=A({relu6_:zae});function Uae(t,n){let r={x:N(t,"x","reverse")},o={dims:n};return k.runKernel(dc,r,o)}var yo=A({reverse_:Uae});function jae(t){let e={x:N(t,"x","round")};return k.runKernel(xa,e)}var vD=A({round_:jae});function Gae(t){let e={x:N(t,"x","rsqrt")};return k.runKernel(va,e)}var Yg=A({rsqrt_:Gae});function Ne(t,n){if((Kr(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Kr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Ic(t,[],[],n)}function Wae(t){let e={x:N(t,"x","selu")};return k.runKernel(ba,e)}var Zg=A({selu_:Wae});function Hae(t,n,e,r,o,i=[1,1],s="NHWC"){let a=N(t,"x","separableConv2d"),l=N(n,"depthwiseFilter","separableConv2d"),c=N(e,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=V(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");M(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),M(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),M(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),M(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),M(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let p=l.shape[2],f=l.shape[3];M(c.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`);let m=Pa(u,l,r,o,s,i),g=Xr(m,c,1,"valid",s);return d?V(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Qg=A({separableConv2d_:Hae});function qae(t){let e={x:N(t,"x","sign")};return k.runKernel(Ia,e)}var bD=A({sign_:qae});function Kae(t){let e={x:N(t,"x","sin")};return k.runKernel(wa,e)}var Jg=A({sin_:Kae});function Xae(t){let e={x:N(t,"x","sinh")};return k.runKernel(Ca,e)}var ey=A({sinh_:Xae});function Yae(t,n,e){let r=N(t,"x","slice1d");return M(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),it(r,[n],[e])}var ty=A({slice1d_:Yae});function Zae(t,n,e){let r=N(t,"x","slice2d");return M(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),it(r,n,e)}var Xb=A({slice2d_:Zae});function Qae(t,n,e){let r=N(t,"x","slice3d");return M(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),it(r,n,e)}var ny=A({slice3d_:Qae});function Jae(t,n,e){let r=N(t,"x","slice4d");return M(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),it(r,n,e)}var cm=A({slice4d_:Jae});function ele(t,n=-1){let e=N(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${n}`);let r={logits:e},o={dim:n};return k.runKernel(yc,r,o)}var hd=A({softmax_:ele});function tle(t){M(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Ef,n)}var ry=A({fft_:tle});function nle(t){M(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Df,n)}var um=A({ifft_:nle});function rle(t){let n=t.shape[t.shape.length-1],e=t.size/n,r;if(n<=2){let o=V(t,[e,n]);r=um(o)}else{let o=[e,2*(n-1)],i=V(Xg(t),[e,n]),s=V(zb(t),[e,n]),a=yo(it(i,[0,1],[e,n-2]),1),l=L(yo(it(s,[0,1],[e,n-2]),1),Ne(-1)),c=$t([i,a],1),u=$t([s,l],1),d=V(gi(c,u),[o[0],o[1]]);r=um(d)}if(r=Xg(r),t.rank===3&&t.shape[0]!==0){let o=r,i=t.shape[0];r=V(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var wD=A({irfft_:rle});function ole(t,n,e=0){let o={x:N(t,"x","split")},i={numOrSizeSplits:n,axis:e};return k.runKernel(gc,o,i)}var Un=A({split_:ole});function ile(t,n){M(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let e=t.shape[t.shape.length-1],r=t.size/e,o;if(n!=null&&n<e){let m=t.shape.map(g=>0),h=t.shape.map(g=>g);h[t.shape.length-1]=n,o=it(t,m,h),e=n}else if(n!=null&&n>e){let m=t.shape.map(h=>h);m[t.shape.length-1]=n-e,o=$t([t,Lt(m)],t.shape.length-1),e=n}else o=t;let i=Se(o),s=V(gi(o,i),[r,e]),a=ry(s),l=Math.floor(e/2)+1,c=Xg(a),u=zb(a),d=Un(c,[l,e-l],c.shape.length-1),p=Un(u,[l,e-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,V(gi(d[0],p[0]),f)}var CD=A({rfft_:ile});function sle(t){let e={x:N(t,"x","sqrt")};return k.runKernel(Ea,e)}var Vt=A({sqrt_:sle});function ale(t,n){let e=N(t,"a","squaredDifference"),r=N(n,"b","squaredDifference");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r},i={};return k.runKernel(_a,o,i)}var nV=A({squaredDifference_:ale});function lle(t,n){let e=N(t,"x","squeeze");return V(e,J_(e.shape,n).newShape)}var gd=A({squeeze_:lle});function cle(t,n=0){let e=Eb(t,"tensors","stack","string_or_numeric");M(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&M(n<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:n};return k.runKernel(ic,r,o)}var Xn=A({stack_:cle});function ule(t,n=0){let r={x:N(t,"x","step")},o={alpha:n};return k.runKernel(Aa,r,o)}var bi=A({step_:ule});function dle(t,n,e,r,o=0,i=0,s=0,a=0,l=0){let u={x:N(t,"x","stridedSlice")},d={begin:n,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return k.runKernel(Vf,u,d)}var ID=A({stridedSlice_:dle});function ple(t){let e={x:N(t,"x","tan")};return k.runKernel(Na,e)}var SD=A({tan_:ple});function zo(t,n){_g(t);let e=Ju(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Ic(t,null,e,n)}function kc(t,n,e){if(_g(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=Ju(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Ic(t,n,r,e)}function fle(t,n=1,e=!0){let r=N(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(n>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${n}`);let i={x:r},s={k:n,sorted:e},[a,l]=k.runKernel(Bf,i,s);return{values:a,indices:l}}var rV=A({topk_:fle});function mle(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new lm(n,e,r,!0,o),s=Ie(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var oy=A({truncatedNormal_:mle});function hle(t,n=0){let e=N(t,"x","unique","string_or_numeric");M(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:n},[i,s]=k.runKernel(zf,r,o);return{values:i,indices:s}}var oV=A({unique_:hle});function gle(t,n,e){let r=N(t,"x","unsortedSegmentSum"),o=N(n,"segmentIds","unsortedSegmentSum","int32");M(mt(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return k.runKernel(bc,i,s)}var Yb=A({unsortedSegmentSum_:gle});function yle(t,n=0){let e=N(t,"x","unstack","string_or_numeric");M(n>=-e.shape.length&&n<e.shape.length,()=>`Axis = ${n} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:n};return k.runKernel(vc,r,o)}var Ar=A({unstack_:yle});function TD(t,n=!0,e,r){return k.makeVariable(t,n,e,r)}function iV(t,n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(i);let r=Ie(t,"int32"),o=Ie([e.length,t.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*t.length;o.values.set(s,a)}return o.toTensor()}function xle(t,n="euclidean",e=null,r=!1){t=N(t,"x","norm");let o=sV(t,n,e),i=o.shape;if(r){let s=vn(e,t.shape);i=ns(o.shape,s)}return V(o,i)}function sV(t,n,e=null){if(t.rank===0)return bn(t);if(t.rank!==1&&e===null)return sV(V(t,[-1]),n,e);if(t.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(n===1)return ve(bn(t),e);if(n===1/0)return zn(bn(t),e);if(n===-1/0)return Dc(bn(t),e);if(n==="euclidean"||n===2)return Vt(ve(Vo(bn(t),Ne(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}if(Array.isArray(e)&&e.length===2){if(n===1)return zn(ve(bn(t),e[0]),e[1]-1);if(n===1/0)return zn(ve(bn(t),e[1]),e[0]);if(n===-1/0)return Dc(ve(bn(t),e[1]),e[0]);if(n==="fro"||n==="euclidean")return Vt(ve(Ge(t),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var dm=A({norm_:xle});function aV(t,n){if(n==null)return t.shape.slice();if(qi(t.shape,n))return n;if(t.shape.length===n.length){let e=[];for(let r=0;r<t.shape.length;r++)n[r]==null&&t.shape[r]!=null?e.push(t.shape[r]):e.push(n[r]);return e}return n}function vle(t,n,e,r){let o=N(t,"x","dropout");if(M(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),M(n>=0&&n<1,()=>`rate must be a float in the range [0, 1), but got ${n}.`),n===0)return t instanceof ct?o.clone():o;let i=aV(o,e),s=1-n,a=pe(La(ee(Va(i,0,1,"float32",r),s)),s);return L(o,a)}var lV=A({dropout_:vle});var wd={};ki(wd,{conv2d:()=>cV,depthwiseConv2d:()=>uV,matMul:()=>dV});function ble(t,n,e,r,o,i="NHWC",s){let a=t;t.rank===3&&(a=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=V(n,[1,n.shape[0],n.shape[1],n.shape[2]])),M(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),M(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),M(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];M(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),M(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),s!=null&&M(mt(o),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let d={x:a,dy:l},p={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return k.runKernel(vf,d,p)}var pm=A({conv2DBackpropFilter_:ble});function yd(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return L(t,bi(n));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function xd(t,n){let e=n,r=At(t.shape,n.shape);return r.length>0&&(e=ve(e,r)),V(e,t.shape)}function vd(t,n,e,r){if(n==="linear")return t;if(n==="relu")return Bo(t);if(n==="elu")return $a(t);if(n==="relu6")return Kb(t);if(n==="prelu")return fd(t,e);if(n==="leakyrelu")return cd(t,r);if(n==="sigmoid")return $o(t);throw new Error(`Unknown fused activation ${n}.`)}var bd=(t,n)=>!(t>0)||n==="linear";function wle({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",bd(k.state.gradientDepth,l)===!1){let S=Xr(t,n,e,r,o,i,s);return a!=null&&(S=ee(S,a)),vd(S,l,c,u)}let d=N(t,"x","conv2d"),p=N(n,"filter","conv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=V(d,[1,d.shape[0],d.shape[1],d.shape[2]])),M(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),M(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),s!=null&&M(mt(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),M(f.shape[3]===p.shape[2],()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${p.shape[2]}.`),M(Ln(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),M(o==="NHWC",()=>`Error in conv2d: got dataFormat of ${o} but only NHWC is currently supported.`);let h=id(f.shape,p.shape,e,i,r,s),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Xe(g,d),Ue(h.outShape,g.shape));let y;c!=null&&(y=N(c,"prelu weights","fused conv2d"));let x=(S,E)=>{let[D,O,R,P]=E,U=yd(S,R,l);M(mo(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let j=rm(O.shape,U,D,e,r),W=pm(O,U,D.shape,e,r),K=[j,W];if(P!=null){let H=xd(P,U);K.push(H)}return K},w={x:f,filter:p,bias:g,preluActivationWeights:y},b={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?go((E,D,O)=>{let R=k.runKernel(Xu,w,b);return O([D,E,R]),m&&(R=V(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:x}})(f,p):go((E,D,O,R)=>{let P=k.runKernel(Xu,w,b);return R([D,E,P,O]),m&&(P=V(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:x}})(f,p,g)}var cV=A({fusedConv2d_:wle});function Cle(t,n,e,r,o,i=[1,1],s){let a=t;t.rank===3&&(a=V(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=V(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return k.runKernel(If,c,u)}var Zb=A({depthwiseConv2dNativeBackpropFilter_:Cle});function Ile(t,n,e,r,o,i=[1,1],s){let a=n,l=!1;n.rank===3&&(l=!0,a=V(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={dy:a,filter:e},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:t},d=k.runKernel(Sf,c,u);return l?V(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Qb=A({depthwiseConv2dNativeBackpropInput_:Ile});function Sle({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(bd(k.state.gradientDepth,l)===!1){let S=Pa(t,n,e,r,o,i,s);return a!=null&&(S=ee(S,a)),vd(S,l,c,u)}let d=N(t,"x","depthwiseConv2d"),p=N(n,"filter","depthwiseConv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=V(d,[1,d.shape[0],d.shape[1],d.shape[2]])),M(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),M(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),M(f.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),M(Ln(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),s!=null&&M(mt(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${s} but got pad ${r}.`);let h=id(f.shape,p.shape,e,i,r,s,!0),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Xe(g,d),Ue(h.outShape,g.shape));let y;c!=null&&(y=N(c,"prelu weights","fused depthwiseConv2d"));let x=(S,E)=>{M(mo(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[D,O,R,P]=E,U=yd(S,R,l),j=Qb(O.shape,U,D,e,r,i,s),W=Zb(O,U,D.shape,e,r,i,s);if(P!=null){let K=xd(g,U);return[j,W,K]}return[j,W]},w={x:f,filter:p,bias:g,preluActivationWeights:y},b={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?go((E,D,O)=>{let R=k.runKernel(Yu,w,b);return O([D,E,R]),m&&(R=V(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:x}})(f,p):go((E,D,O,R)=>{let P=k.runKernel(Yu,w,b);return R([D,E,P,O]),m&&(P=V(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:x}})(f,p,g)}var uV=A({fusedDepthwiseConv2d_:Sle});function Tle({a:t,b:n,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a}){if(bd(k.state.gradientDepth,i)===!1){let P=ht(t,n,e,r);return o!=null&&(P=ee(P,o)),vd(P,i,s,a)}let l=N(t,"a","fused matMul"),c=N(n,"b","fused matMul");[l,c]=Xe(l,c);let u=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=e?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],m=l.shape.slice(0,-2),h=c.shape.slice(0,-2),g=kt(m),y=kt(h);M(l.rank>=2&&c.rank>=2&&l.rank===c.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${l.rank} and ${c.rank}.`),M(qi(m,h),()=>`Error in fused matMul: outer dimensions (${m}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} must match.`),M(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let x=l.shape.slice(0,-2).concat([p,f]),w=e?V(l,[g,u,p]):V(l,[g,p,u]),b=r?V(c,[y,f,d]):V(c,[y,d,f]),S;o!=null&&(S=N(o,"bias","fused matMul"),[S]=Xe(S,l),Ue(x,S.shape));let E;s!=null&&(E=N(s,"prelu weights","fused matMul"));let D=(P,U)=>{let[j,W,K,H]=U,Y=yd(V(P,K.shape),K,i),ne,J;if(!e&&!r?(ne=ht(Y,W,!1,!0),J=ht(j,Y,!0,!1)):!e&&r?(ne=ht(Y,W,!1,!1),J=ht(Y,j,!0,!1)):e&&!r?(ne=ht(W,Y,!1,!0),J=ht(j,Y,!1,!1)):(ne=ht(W,Y,!0,!0),J=ht(Y,j,!0,!0)),o!=null){let te=xd(H,Y);return[ne,J,te]}else return[ne,J]},O={a:w,b,bias:S,preluActivationWeights:E},R={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?go((U,j,W)=>{let K=k.runKernel(Ku,O,R);return W([U,j,K]),{value:V(K,x),gradFunc:D}})(w,b):go((U,j,W,K)=>{let H=k.runKernel(Ku,O,R);return K([U,j,H,W]),{value:V(H,x),gradFunc:D}})(w,b,S)}var dV=A({fusedMatMul_:Tle});function pV(t,n,e){let r=Ele(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function Ele(t,n,e){return Dle(t,n,e||_le)}function _le(t,n){return t>n?1:t<n?-1:0}function Dle(t,n,e){let r=0,o=t.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(n,t[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function mV(t,n,e,r,o){return ED(t,n,e,r,o,0)}function hV(t,n,e,r,o,i){return ED(t,n,e,r,o,0,!1,i,!0)}function gV(t,n,e,r,o,i){return ED(t,n,e,r,o,i,!0)}function ED(t,n,e,r,o,i,s=!1,a=!1,l=!1){let c=[];for(let g=0;g<n.length;g++)n[g]>o&&c.push({score:n[g],boxIndex:g,suppressBeginIndex:0});c.sort(fV);let u=i>0?-.5/i:0,d=[],p=[];for(;d.length<e&&c.length>0;){let g=c.pop(),{score:y,boxIndex:x,suppressBeginIndex:w}=g;if(y<o)break;let b=!1;for(let S=d.length-1;S>=w;--S){let E=Nle(t,x,d[S]);if(E>=r){b=!0;break}if(g.score=g.score*kle(r,u,E),g.score<=o)break}g.suppressBeginIndex=d.length,b||(g.score===y?(d.push(x),p.push(g.score)):g.score>o&&pV(c,g,fV))}let f=d.length,m=e-f;a&&m>0&&(d.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));let h={selectedIndices:d};return s&&(h.selectedScores=p),l&&(h.validOutputs=f),h}function Nle(t,n,e){let r=t.subarray(n*4,n*4+4),o=t.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(a-i)*(l-s),m=(d-c)*(p-u);if(f<=0||m<=0)return 0;let h=Math.max(i,c),g=Math.max(s,u),y=Math.min(a,d),x=Math.min(l,p),w=Math.max(y-h,0)*Math.max(x-g,0);return w/(f+m-w)}function kle(t,n,e){let r=Math.exp(n*e*e);return e<=t?r:0}function fV(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function Ale(t,n,e=!1,r=!1){let o=N(t,"images","resizeBilinear");M(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),M(n.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${n}.`),M(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=V(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(uc,a,l);return s?V(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var yV=A({resizeBilinear_:Ale});function Rle(t,n,e=!1,r=!1){let o=N(t,"images","resizeNearestNeighbor");M(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),M(n.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${n}.`),M(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),M(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=V(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(cc,a,l);return s?V(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var xV=A({resizeNearestNeighbor_:Rle});function Ole(t,n,e){M(n%1===0,()=>`bandPart(): numLower must be an integer, got ${n}.`),M(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`);let r=N(t,"a","bandPart");M(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2);if(!(n<=i))throw new Error(`bandPart(): numLower (${n}) must not be greater than the number of rows (${i}).`);if(!(e<=s))throw new Error(`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`);n<0&&(n=i),e<0&&(e=s);let a=V(yD(0,i,1,"int32"),[-1,1]),l=yD(0,s,1,"int32"),c=we(a,l),u=ar(es(c,Ne(+n,"int32")),ho(c,Ne(-e,"int32"))),d=Lt([i,s],r.dtype);return V(Xn(Ar(V(r,[-1,i,s])).map(p=>sn(u,p,d))),o)}var vV=A({bandPart_:Ole});function Mle(t){let n;if(Array.isArray(t)){n=!1,M(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let i=1;i<t.length;++i)M(t[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${o})`)}else n=!0,t=Un(t,t.shape[0],0).map(o=>gd(o,[0]));M(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let e=[],r=t;for(let o=0;o<t.length;++o)e.push(k.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=L(ve(L(e[s],i)),e[s]);i=we(i,a)}return pe(i,dm(i,"euclidean"))}));return n?Xn(e,0):e}var bV=A({gramSchmidt_:Mle});function Fle(t,n=!1){if(M(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return wV(t,n);{let e=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),r=Ar(V(t,[e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[c,u]=wV(l,n);o.push(c),i.push(u)});let s=V(Xn(o,0),t.shape),a=V(Xn(i,0),t.shape);return[s,a]}}function wV(t,n=!1){return k.tidy(()=>{M(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let e=t.shape[0],r=t.shape[1],o=om(e),i=xi(t),s=kc([[1]],[1,1]),a=xi(s),l=e>=r?r:e;for(let c=0;c<l;++c){let u=i,d=a,p=o;[a,i,o]=k.tidy(()=>{let f=it(i,[c,c],[e-c,1]),m=dm(f),h=it(i,[c,c],[1,1]),g=sn(Bn(h,0),kc([[-1]]),kc([[1]])),y=we(h,L(g,m)),x=pe(f,y);x.shape[0]===1?a=xi(s):a=$t([s,it(x,[1,0],[x.shape[0]-1,x.shape[1]])],0);let w=gt(pe(ht(g,y),m)),b=it(i,[c,0],[e-c,r]),S=L(w,a),E=rt(a);if(c===0)i=we(b,ht(S,ht(E,b)));else{let R=we(b,ht(S,ht(E,b)));i=$t([it(i,[0,0],[c,r]),R],0)}let D=rt(S),O=it(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=we(O,ht(ht(O,a),D));else{let R=we(O,ht(ht(O,a),D));o=$t([it(o,[0,0],[e,c]),R],1)}return[a,i,o]}),Oe([u,d,p])}return!n&&e>r&&(o=it(o,[0,0],[e,r]),i=it(i,[0,0],[r,r])),[o,i]})}var CV=A({qr_:Fle});var IV={bandPart:vV,gramSchmidt:bV,qr:CV};var Yn=class extends Bg{minimize(n,e=!1,r){let{value:o,grads:i}=this.computeGradients(n,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return Oe(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(n,e){return rD(n,e)}dispose(){this.iterations_!=null&&Oe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ne(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(n){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(n){return this.iterations_=(await n[0].tensor.data())[0],n.slice(1)}};Object.defineProperty(Yn,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var _D=(()=>{class t extends Yn{constructor(e,r,o=null){super(),this.learningRate=e,this.rho=r,this.epsilon=o,this.accumulatedGrads=[],this.accumulatedUpdates=[],o==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accum_grad`,variable:z(()=>Se(s).variable(a))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${o}/accum_var`,variable:z(()=>Se(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedGrads[i].variable,u=this.accumulatedUpdates[i].variable;z(()=>{let d=ee(L(c,this.rho),L(Ge(l),1-this.rho)),p=L(pe(Vt(ee(u,this.epsilon)),Vt(ee(c,this.epsilon))),l),f=ee(L(u,this.rho),L(Ge(p),1-this.rho));c.assign(d),u.assign(f);let m=ee(L(p,-this.learningRate),s);s.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Oe(this.accumulatedGrads.map(e=>e.variable)),Oe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,o=!1;this.accumulatedGrads=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedUpdates=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}}return t.className="Adadelta",t})();kr(_D);var DD=(()=>{class t extends Yn{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accumulator`,variable:z(()=>Hg(s.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[i].tensor:e[o];if(a==null)return;let l=this.accumulatedGrads[i].variable;z(()=>{let c=ee(l,Ge(a));l.assign(c);let u=ee(L(pe(a,Vt(ee(c,k.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Oe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}}return t.className="Adagrad",t})();kr(DD);var ND=(()=>{class t extends Yn{constructor(e,r,o,i=null){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],z(()=>{this.accBeta1=Ne(r).variable(),this.accBeta2=Ne(o).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);z(()=>{let o=we(1,this.accBeta1),i=we(1,this.accBeta2);r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:z(()=>Se(l).variable(c))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${s}/v`,variable:z(()=>Se(l).variable(c))});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,f=ee(L(d,this.beta1),L(u,1-this.beta1)),m=ee(L(p,this.beta2),L(Ge(u),1-this.beta2)),h=pe(f,o),g=pe(m,i);d.assign(f),p.assign(m);let y=ee(L(pe(h,ee(Vt(g),this.epsilon)),-this.learningRate),l);l.assign(y)}),this.accBeta1.assign(L(this.accBeta1,this.beta1)),this.accBeta2.assign(L(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Oe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Oe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),z(()=>{this.accBeta1.assign(Vo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Vo(this.beta2,this.iterations_+1))});let r=e.length/2,o=!1;this.accumulatedFirstMoment=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}}return t.className="Adam",t})();kr(ND);var kD=(()=>{class t extends Yn{constructor(e,r,o,i=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],z(()=>{this.iteration=Ne(0).variable(),this.accBeta1=Ne(r).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);z(()=>{let o=we(1,this.accBeta1),i=pe(-this.learningRate,ee(L(this.iteration,this.decay),1));r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:Se(l).variable(c)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${s}/v`,variable:Se(l).variable(c)});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,f=ee(L(d,this.beta1),L(u,1-this.beta1)),m=L(p,this.beta2),h=bn(u),g=Yr(m,h);d.assign(f),p.assign(g);let y=ee(L(pe(i,o),pe(f,ee(g,this.epsilon))),l);l.assign(y)}),this.iteration.assign(ee(this.iteration,1)),this.accBeta1.assign(L(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Oe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Oe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}}return t.className="Adamax",t})();kr(kD);var iy=(()=>{class t extends Yn{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=Array.isArray(e)?e[i].tensor:e[o];if(s==null)return;let a=k.registeredVariables[o];z(()=>{let l=ee(L(this.c,s),a);a.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=An(Ne(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}}return t.className="SGD",t})();kr(iy);var AD=(()=>{class t extends iy{constructor(e,r,o=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=o,this.accumulations=[],this.m=Ne(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${o}/momentum`,variable:z(()=>Se(s).variable(!1))});let a=this.accumulations[i].variable,l=Array.isArray(e)?e[i].tensor:e[o];l!=null&&z(()=>{let c,u=ee(L(this.m,a),l);this.useNesterov?c=ee(L(this.c,ee(l,L(u,this.m))),s):c=ee(L(this.c,u),s),a.assign(u),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Oe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}}return t.className="Momentum",t})();kr(AD);var RD=(()=>{class t extends Yn{constructor(e,r=.9,o=0,i=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=o,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=k.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${o}/rms`,variable:z(()=>Se(s).variable(a))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${o}/momentum`,variable:z(()=>Se(s).variable(a))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${o}/mg`,variable:z(()=>Se(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedMeanSquares[i].variable,u=this.accumulatedMoments[i].variable;z(()=>{let d=ee(L(c,this.decay),L(Ge(l),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[i].variable,f=ee(L(p,this.decay),L(l,1-this.decay)),m=pe(L(l,this.learningRate),Vt(we(d,ee(Ge(f),this.epsilon)))),h=ee(L(u,this.momentum),m);c.assign(d),p.assign(f),u.assign(h);let g=we(s,h);s.assign(g)}else{let p=ee(L(c,this.decay),L(Ge(l),1-this.decay)),f=ee(L(u,this.momentum),pe(L(l,this.learningRate),Vt(ee(p,this.epsilon))));c.assign(p),u.assign(f);let m=we(s,f);s.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Oe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Oe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Oe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,o=!1;this.accumulatedMeanSquares=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedMoments=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}}return t.className="RMSProp",t})();kr(RD);var rs=class{static sgd(n){return new iy(n)}static momentum(n,e,r=!1){return new AD(n,e,r)}static rmsprop(n,e=.9,r=0,o=null,i=!1){return new RD(n,e,r,o,i)}static adam(n=.001,e=.9,r=.999,o=null){return new ND(n,e,r,o)}static adadelta(n=.001,e=.95,r=null){return new _D(n,e,r)}static adamax(n=.002,e=.9,r=.999,o=null,i=0){return new kD(n,e,r,o,i)}static adagrad(n,e=.1){return new DD(n,e)}};var Cd={sgd:rs.sgd,momentum:rs.momentum,adadelta:rs.adadelta,adagrad:rs.adagrad,rmsprop:rs.rmsprop,adamax:rs.adamax,adam:rs.adam};var Ple=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function sy(){return new Promise(t=>Ple(()=>t()))}var _={};ki(_,{ERF_A1:()=>qle,ERF_A2:()=>Kle,ERF_A3:()=>Xle,ERF_A4:()=>Yle,ERF_A5:()=>Zle,ERF_P:()=>Hle,PARALLELIZE_THRESHOLD:()=>Jb,SELU_SCALE:()=>MD,SELU_SCALEALPHA:()=>OD,applyActivation:()=>vd,assertAndGetBroadcastShape:()=>Ue,assertAxesAreInnerMostDims:()=>rae,assertParamsConsistent:()=>$le,assignToTypedArray:()=>ice,axesAreInnerMostDims:()=>iD,calculateShapes:()=>yie,checkEinsumDimSizes:()=>dce,combineLocations:()=>ML,complexWithEvenIndex:()=>nce,complexWithOddIndex:()=>rce,computeConv2DInfo:()=>id,computeConv3DInfo:()=>EL,computeDefaultPad:()=>V1,computeDilation2DInfo:()=>Vie,computeOptimalWindowSize:()=>Vle,computeOutAndReduceShapes:()=>sD,computeOutShape:()=>Lle,computePool2DInfo:()=>L1,computePool3DInfo:()=>Bie,convertConv2DDataFormat:()=>_L,decodeEinsumEquation:()=>cce,eitherStridesOrDilationsAreOne:()=>Ln,expandShapeToKeepDim:()=>ns,exponent:()=>ace,exponents:()=>sce,fromStringArrayToUint8:()=>bce,fromUint8ToStringArray:()=>vce,getAxesPermutation:()=>aD,getBroadcastDims:()=>Ise,getComplexWithIndex:()=>oce,getEinsumComputePath:()=>pce,getEinsumPermutation:()=>uce,getFusedBiasGradient:()=>xd,getFusedDyActivation:()=>yd,getImageCenter:()=>Ble,getInnerMostAxes:()=>oae,getPermuted:()=>Ule,getReductionAxes:()=>At,getReshaped:()=>zle,getReshapedPermuted:()=>jle,getSliceBeginCoords:()=>Gle,getSliceSize:()=>Wle,getUndoAxesPermutation:()=>Kg,isIdentityPermutation:()=>fce,log:()=>Jle,mergeRealAndImagArrays:()=>ece,prepareAndValidate:()=>hie,prepareSplitSize:()=>hce,segment_util:()=>PD,shouldFuse:()=>bd,slice_util:()=>qn,splitRealAndImagArrays:()=>tce,tupleValuesAreOne:()=>mo,upcastType:()=>Cn,validateInput:()=>gie,validateUpdateShape:()=>pL,warn:()=>Qle});function $le(t,n){let e=t[0].length;t.forEach((o,i)=>{M(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),M(n>=0&&n<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=t[0];t.forEach((o,i)=>{for(let s=0;s<e;s++)M(s===n||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function Lle(t,n){let e=t[0].slice();for(let r=1;r<t.length;r++)e[n]+=t[r][n];return e}var Jb=30;function Vle(t){return t<=Jb?t:df(t,Math.floor(Math.sqrt(t)))}function Ble(t,n,e){let r=e*(typeof t=="number"?t:t[0]),o=n*(typeof t=="number"?t:t[1]);return[r,o]}function zle(t,n,e,r=!0){let o=[];if(r)o=o.concat(n.slice(0)),o.push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let i=n.length;for(let s=0;s<i;++s)o=o.concat([t[s+1]/n[s],n[s]]);o=o.concat(t.slice(i+1))}return o}function Ule(t,n,e=!0){let r=[];if(e){r.push(n);for(let o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<t;++s)s>=n*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function jle(t,n,e,r=!0){let o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(let i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function Gle(t,n){let e=[0];for(let r=0;r<n;++r)e.push(t[r][0]);return e}function Wle(t,n,e){let r=t.slice(0,1);for(let o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}var OD=1.7580993408473768,MD=1.0507009873554805;var Hle=.3275911,qle=.254829592,Kle=-.284496736,Xle=1.421413741,Yle=-1.453152027,Zle=1.061405429;function Qle(...t){G().getBool("IS_TEST")||console.warn(...t)}function Jle(...t){G().getBool("IS_TEST")||console.log(...t)}function ece(t,n){if(t.length!==n.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${n.length}.`);let e=new Float32Array(t.length*2);for(let r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function tce(t){let n=new Float32Array(t.length/2),e=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=t[r],e[r/2]=t[r+1];return{real:n,imag:e}}function nce(t){let n=Math.ceil(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=0;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function rce(t){let n=Math.floor(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=2;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function oce(t,n){let e=t[n*2],r=t[n*2+1];return{real:e,imag:r}}function ice(t,n,e,r){t[r*2]=n,t[r*2+1]=e}function sce(t,n){let e=new Float32Array(t/2),r=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let i=(n?2:-2)*Math.PI*(o/t);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function ace(t,n,e){let r=(e?2:-2)*Math.PI*(t/n),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var FD="->",lce=/->/g,SV=",",TV="...";function cce(t,n){t=t.replace(/\s/g,"");let e=(t.length-t.replace(lce,"").length)/FD.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${FD}").`);let[r,o]=t.split(FD);M(r.indexOf(TV)===-1,()=>`The ellipsis notation ("${TV}") is not supported yet.`);let i=r.split(SV),s=i.length;if(n!==s)throw new Error(`Expected ${s} input tensors, received ${n}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let p=0;p<o.length;++p){let f=o[p];if(!i.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<r.length;++p){let f=r[p];a.indexOf(f)===-1&&f!==SV&&a.push(f)}let l=new Array(i.length);for(let p=0;p<s;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let f=0;f<i[p].length;++f)l[p].push(a.indexOf(i[p][f]))}let c=a.length,u=o.length,d=[];for(let p=u;p<c;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function uce(t,n){let e=new Array(t);e.fill(-1);for(let o=0;o<n.length;++o)e[n[o]]=o;let r=[];for(let o=0;o<t;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function dce(t,n,e){let r=new Array(t);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<n[o].length;++s)r[n[o][s]]===void 0?r[n[o][s]]=i[s]:M(r[n[o][s]]===i[s],()=>`Expected dimension ${r[n[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function pce(t,n){let e=t,r=[],o=0;t.length===0&&e.push(-1),o=t.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=mce(n,a);for(let c of l)i.indexOf(c)===-1&&(r[s].push(c),i.push(c))}return{path:e,steps:r}}function fce(t){return t.every((n,e)=>n===e)}function mce(t,n){let e=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(n)!==-1||n===-1)&&e.push(r);return e}function hce(t,n,e=0){let r=[];if(typeof n=="number")M(t.shape[e]%n===0,()=>"Number of splits must evenly divide the axis."),r=new Array(n).fill(t.shape[e]/n);else{let o=n.reduce((s,a)=>(a===-1&&(s+=1),s),0);M(o<=1,()=>"There should be only one negative value in split array.");let i=n.indexOf(-1);if(i!==-1){let s=n.reduce((a,l)=>l>0?a+l:a);n[i]=t.shape[e]-s}M(t.shape[e]===n.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=n}return r}var PD={};ki(PD,{collectGatherOpShapeInfo:()=>xce,computeOutShape:()=>yce,segOpComputeOptimalWindowSize:()=>gce});function gce(t,n){let e=!1,r;for(t<=Jb?(r=t,e=!0):r=df(t,Math.floor(Math.sqrt(t)));!e;)r>n||r===t?e=!0:r=df(t,r+1);return r}function yce(t,n,e){let r=[],o=t.length;for(let i=0;i<o;i++)i!==n?r.push(t[i]):r.push(e);return r}function xce(t,n,e,r){let o=n.shape.length,i=t.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let d=0;d<r;++d)if(t.shape[d]!==n.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${n.shape[d]}.`);let s=t.shape[e],a=[],l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=r;d<e;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=r;d<o;d++)a.push(n.shape[d]);for(let d=e+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}function vce(t){try{return t.map(n=>Gf(n))}catch(n){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${n}`)}}function bce(t){return t.map(n=>jf(n))}var Zn={};ki(Zn,{nonMaxSuppressionV3Impl:()=>mV,nonMaxSuppressionV4Impl:()=>hV,nonMaxSuppressionV5Impl:()=>gV,whereImpl:()=>iV});var ew={kernelName:kl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,bi(se(e,"float32"),-1))}}};var EV={kernelName:Bs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Ge(se(e,"float32")),o=Vt(we(Ne(1),r));return gt(pe(t,o))}}}};var _V={kernelName:zs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Vt(we(Ge(se(e,"float32")),1));return pe(t,r)}}}};var DV={kernelName:mi,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=t,l=At(e.shape,o);return l.length>0&&(a=ve(a,l)),V(a,e.shape)},b:()=>{let a=t,l=At(r.shape,o);return l.length>0&&(a=ve(a,l)),V(a,r.shape)}}}};var NV={kernelName:ff,saveAllInputs:!0,gradFunc:(t,n)=>{let e={};return n.forEach((r,o)=>{e[o]=()=>t.clone()}),e}};var kV={kernelName:Al,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Se(e)}}};var AV={kernelName:Rl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Se(e)}}};var RV={kernelName:Us,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,Vt(we(Ne(1),Ge(se(e,"float32")))))}}};var OV={kernelName:js,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Vt(ee(Ne(1),Ge(se(e,"float32"))));return pe(t,r)}}}};var MV={kernelName:Hs,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=ee(Ge(e),Ge(r)),l=L(t,pe(r,a)),c=At(e.shape,o);return c.length>0&&(l=ve(l,c)),V(l,e.shape)},b:()=>{let a=ee(Ge(e),Ge(r)),l=gt(L(t,pe(e,a))),c=At(r.shape,o);return c.length>0&&(l=ve(l,c)),V(l,r.shape)}}}};var FV={kernelName:Gs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,ee(Ge(se(e,"float32")),1))}}};var PV={kernelName:Ws,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,we(Ne(1),Ge(se(e,"float32"))))}}};function wce(t,n,e,r,o,i){let s=N(t,"dy","avgPool3dGrad"),a=N(n,"input","avgPool3dGrad"),l=s,c=a,u=!1;a.rank===4&&(u=!0,l=V(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),M(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),M(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),i!=null&&M(mt(o),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let d={dy:l,input:c},p={filterSize:e,strides:r,pad:o,dimRoundingMode:i},f=k.runKernel(yf,d,p);return u?V(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var $V=A({avgPool3dGrad_:wce});var LV={kernelName:Ml,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>$V(t,r,o,i,s,a)}}};function Cce(t,n,e,r,o){let i=N(t,"dy","avgPoolGrad"),s=N(n,"input","avgPoolGrad");M(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,c=!1;s.rank===3&&(c=!0,a=V(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=V(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),M(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:l,input:a},d={filterSize:e,strides:r,pad:o},p=k.runKernel(gf,u,d);return c?V(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var VV=A({avgPoolGrad_:Cce});var BV={kernelName:Ol,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s}=e;return{x:()=>VV(t,r,o,i,s)}}};var zV={kernelName:Fl,inputsToSave:["a","b"],gradFunc:(t,n,e)=>{let[r,o]=n,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>ht(t,o,!1,!0),b:()=>ht(r,t,!0,!1)}:!i&&s?{a:()=>ht(t,o,!1,!1),b:()=>ht(t,r,!0,!1)}:i&&!s?{a:()=>ht(o,t,!1,!0),b:()=>ht(r,t,!1,!1)}:{a:()=>ht(o,t,!0,!0),b:()=>ht(t,r,!0,!0)}}};var UV={kernelName:Pl,gradFunc:(t,n,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>am(t,r,o)}}};var jV={kernelName:g$,gradFunc:(t,n,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>ve(t,a,!0)}}};var GV={kernelName:Xi,gradFunc:t=>({x:()=>t.clone()})};var WV={kernelName:qs,gradFunc:t=>({x:()=>Se(t)})};var HV={kernelName:Ks,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>sn(ar(ho(r,o),es(r,i)),t,Se(t))}}};var qV={kernelName:$l,inputsToSave:["x"],gradFunc:ew.gradFunc};var KV={kernelName:Ll,saveAllInputs:!0,gradFunc:(t,n,e)=>{let r=n.map(l=>l.shape),{axis:o}=e,i=vn(o,n[0].shape)[0],s=r.map(l=>l[i]);return Un(t,s,i).map(l=>()=>l)}};var XV={kernelName:Vl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return M(mo(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>rm(r.shape,t,o,s,a,l),filter:()=>pm(r,t,o.shape,s,a,l)}}};var YV={kernelName:Bl,inputsToSave:["dy","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>Xr(t,o,i,s,a,1,l),filter:()=>pm(t,r,o.shape,i,s,a,l)}}};function Ice(t,n,e,r,o){let i=t;t.rank===4&&(i=V(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let s=n;s.rank===4&&(s=V(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]])),M(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),M(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),M(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),M(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),M(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return k.runKernel(bf,a,l)}var ZV=A({conv3DBackpropFilter_:Ice});var QV={kernelName:zl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i}=e;M(mo(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=n;return{x:()=>Vb(s.shape,t,a,o,i),filter:()=>ZV(s,t,a.shape,o,i)}}};var JV={kernelName:Xs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(gt(Jg(se(e,"float32"))),t)}}};var e3={kernelName:Ys,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(ey(se(e,"float32")),t)}}};var t3={kernelName:Ul,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=aD([o],r.rank),l=Bb(t,o,i,!s);return a!=null&&(l=rt(l,a)),l}}}};var n3={kernelName:jl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];M(mo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,c]=n;return M(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),M(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),M(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),M(Ln(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),s!=null&&M(mt(i),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`),{x:()=>Qb(l.shape,t,c,o,i,r,s),filter:()=>Zb(l,t,c.shape,o,i,r,s)}}};var r3={kernelName:Gl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,i={x:r,filter:o,dy:t},s={x:r,filter:o,dy:t};return{x:()=>k.runKernel(Og,i,e),filter:()=>k.runKernel(Mg,s,e)}}};var o3={kernelName:Qs,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n,r={dy:t,y:e};return{x:()=>k.runKernel(Tf,r)}}};var i3={kernelName:Js,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=L(fr(gt(Ge(e))),2/Math.sqrt(Math.PI));return{x:()=>L(t,r)}}};var s3={kernelName:ea,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,e)}}};var a3={kernelName:Wl,inputsToSave:["input"],gradFunc:(t,n)=>{let[e]=n;return{input:()=>V(t,e.shape)}}};var l3={kernelName:ta,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,fr(e))}}};var c3={kernelName:na,gradFunc:t=>({x:()=>Se(t)})};var u3={kernelName:ra,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=pe(t,se(r,"float32")),l=At(e.shape,o);return l.length>0?V(ve(a,l),e.shape):a},b:()=>{let a=L(t,se(e,"float32")),l=At(r.shape,o);l.length>0&&(a=V(ve(a,l),r.shape));let c=Ge(r);return gt(pe(a,se(c,"float32")))}}}};var d3={kernelName:Hl,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,n,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=n,l=a??Ne(1),c=At(i.shape,o.shape),u=[];if(i.rank===1){for(let b=0;b<o.shape.length-1;++b)u.push(o.shape[b]);u.push(1)}let d=we(o,i),p=L(t,l),f=Yg(ee(s,Ne(r))),m=L(L(L(f,f),f),Ne(-.5));return{x:()=>i.rank===1?V(L(L(t,vi(V(f,[1,1,1,i.shape[0]]),u)),l),o.shape):V(L(L(t,f),l),o.shape),mean:()=>{let b=L(L(f,Ne(-1)),p);return i.rank===1&&(b=ve(b,c)),V(b,i.shape)},variance:()=>{let b=L(L(m,d),p);return i.rank===1&&(b=ve(b,c)),V(b,i.shape)},scale:()=>{let b=L(d,f),S=L(t,b);return i.rank===1&&(S=ve(S,c)),V(S,i.shape)},offset:()=>{let b=t;return i.rank===1&&(b=ve(b,c)),V(b,i.shape)}}}};var m3={kernelName:ql,inputsToSave:["x","indices"],gradFunc:(t,n,e)=>{let[r,o]=n,{axis:i}=e,s=vn(i,r.shape)[0];return{x:()=>{let l=r.shape,c=o.size,u=l.slice(0,s),d=u.length,p=l.slice(i,l.length).slice(1),f=p.length,m=p3(0,d),h=p3(d+1,d+1+f),g=f3([u,[c],p]),y=V(t,g),x=V(o,[c]),w=f3([[d],m,h]),b=rt(y,w),S=Yb(b,x,r.shape[s]),E=Kg(w);return S=rt(S,E),S},indices:()=>o}}};function p3(t,n){let e=[];for(let r=t;r<n;++r)e.push(r);return e}function f3(t){let n=[];for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var h3={kernelName:oa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>Se(e),b:()=>Se(r)}}};var g3={kernelName:Yi,gradFunc:t=>({x:()=>se(t,"float32")})};var y3={kernelName:ia,gradFunc:t=>({x:()=>Se(t)})};var x3={kernelName:sa,gradFunc:t=>({x:()=>Se(t)})};var v3={kernelName:aa,gradFunc:t=>({x:()=>Se(t)})};var b3={kernelName:Kl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{alpha:o}=e,i=Bn(r,0);return{x:()=>sn(i,t,L(t,o))}}};var w3={kernelName:ca,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,ee(e,1))}}};var C3={kernelName:la,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,se(e,"float32"))}}};var I3={kernelName:y$,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e;return{logits:()=>{let s=fr(r);return we(t,L(ve(t,o,!0),s))}}}};function Sce(t,n,e,r=5,o=1,i=1,s=.5){let a={x:t,y:n,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return k.runKernel(kf,a,l)}var S3=A({localResponseNormalizationBackprop_:Sce});var T3={kernelName:Xl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>S3(r,o,t,i,s,a,l)}}};function tw(t,n,e,r){return n.rank<e.rank&&(n=V(n,ns(n.shape,r))),t.rank<e.rank&&(t=V(t,ns(t.shape,r))),{x:()=>L(t,se(Lo(e,n),t.dtype))}}var $D={kernelName:Yl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{reductionIndices:o}=r,i=n[0],s=n[1],a=vn(o,i.shape),l=tw(t,s,i,a);return{x:()=>l.x()}}};var E3={kernelName:ua,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>L(t,se(ho(e,r),"float32")),b:()=>L(t,se(Ub(e,r),"float32"))}}};function Tce(t,n,e,r,o,i,s){let a=N(t,"dy","maxPool3dGrad"),l=N(n,"input","maxPool3dGrad"),c=N(e,"output","maxPool3dGrad"),u=a,d=l,p=c,f=!1;l.rank===4&&(f=!0,u=V(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=V(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=V(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),M(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),M(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),M(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),s!=null&&M(mt(i),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let m={dy:u,input:d,output:p},h={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=k.runKernel(Rf,m,h);return f?V(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var _3=A({maxPool3dGrad_:Tce});var D3={kernelName:Ql,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>_3(t,r,o,i,s,a,l)}}};function Ece(t,n,e,r,o,i,s){let a=N(t,"dy","maxPoolGrad"),l=N(n,"input","maxPoolGrad"),c=N(e,"output","maxPoolGrad");M(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),M(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),M(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),s!=null&&M(mt(i),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return k.runKernel(Af,u,d)}var N3=A({maxPoolGrad_:Ece});var k3={kernelName:Zl,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a}=e;return{x:()=>N3(t,r,o,i,s,a)}}};var A3={kernelName:Jl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=vn(o,r.shape),a=sD(r.shape,i)[1],l=kt(a);return{x:()=>{let u=r.shape.slice();i.forEach(f=>{u[f]=1});let d=V(t,u);return pe(L(d,Zr(r.shape,"float32")),l)}}}};var R3={kernelName:ec,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{axis:o}=r,[i,s]=n,a=vn(o,i.shape),l=tw(t,s,i,a);return{x:()=>l.x()}}};var O3={kernelName:da,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>L(t,se(es(e,r),"float32")),b:()=>L(t,se(Bn(e,r),"float32"))}}};var M3={kernelName:tc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>it(t,i,r.shape)}}};var F3={kernelName:pa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=At(e.shape,o);return a.length>0?V(ve(t,a),e.shape):t},b:()=>{let a=L(t,gt(La(pe(e,r)))),l=At(r.shape,o);return l.length>0?V(ve(a,l),r.shape):a}}}};var P3={kernelName:fa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=L(t,se(r,"float32")),l=At(e.shape,o);return l.length>0?V(ve(a,l),e.shape):a},b:()=>{let a=L(t,se(e,"float32")),l=At(r.shape,o);return l.length>0?V(ve(a,l),r.shape):a}}}};var $3={kernelName:nc,gradFunc:t=>({x:()=>gt(t)})};var L3={kernelName:oc,inputsToSave:["indices"],gradFunc:(t,n)=>{let e=n[0];return{indices:()=>Lt(e.shape,"float32")}}};var V3={kernelName:rc,gradFunc:t=>({x:()=>Se(t)})};var B3={kernelName:ic,saveAllInputs:!0,gradFunc:(t,n,e)=>{let{axis:r}=e;return Ar(t,r).map(i=>()=>i)}};var LD={kernelName:sc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>it(t,i,r.shape)}}};var z3={kernelName:ma,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,n)=>{let[e,r,o]=n,i=e,s=r,a=Ue(i.shape,s.shape);return{a:()=>{let u=se(s,"float32"),d=L(t,L(u,Vo(i,we(u,Ne(1))))),p=At(i.shape,a);return p.length>0&&(d=ve(d,p)),V(d,i.shape)},b:()=>{let u=Bn(i,0),d=sn(u,mr(i),Se(i)),p=L(t,L(o,d)),f=At(s.shape,a);return f.length>0&&(p=ve(p,f)),V(p,s.shape)}}}};var U3={kernelName:ac,inputsToSave:["x","alpha"],gradFunc:(t,n)=>{let[e,r]=n,o=Bn(e,0);return{x:()=>sn(o,t,L(t,r)),alpha:()=>{let i=sn(o,Se(t),L(t,e)),s=At(r.shape,t.shape);return s.length>0&&(i=ve(i,s)),V(i,r.shape)}}}};var j3={kernelName:Zs,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=pe(t,se(r,"float32")),l=At(e.shape,o);return l.length>0?V(ve(a,l),e.shape):a},b:()=>{let a=L(t,se(e,"float32")),l=At(r.shape,o);l.length>0&&(a=V(ve(a,l),r.shape));let c=Ge(r);return gt(pe(a,se(c,"float32")))}}}};var G3={kernelName:ha,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,gt(Ge(e)))}}};var W3={kernelName:ya,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=L(es(e,6),bi(e));return{x:()=>L(t,se(r,"float32"))}}};var H3={kernelName:ga,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,se(bi(e),"float32"))}}};var q3={kernelName:lc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,e.shape)}}};var K3={kernelName:uc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel($f,o,e)}}};var X3={kernelName:cc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(Pf,o,e)}}};var Y3={kernelName:dc,gradFunc:(t,n,e)=>{let{dims:r}=e,o=vn(r,t.shape);return{x:()=>yo(t,o)}}};var Z3={kernelName:xa,gradFunc:t=>({x:()=>Se(t)})};var Q3={kernelName:va,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>gt(pe(t,L(Vo(e,1.5),2)))}}};var J3={kernelName:pc,inputsToSave:["condition"],gradFunc:(t,n)=>{let[e]=n;return{condition:()=>se(Se(e),"float32"),t:()=>L(t,se(e,t.dtype)),e:()=>L(t,se(im(e),t.dtype))}}};var eB={kernelName:ba,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Bn(e,Ne(0)),o=Ne(OD),i=Ne(MD),s=L(t,i),a=L(L(t,o),fr(se(e,"float32")));return sn(r,s,a)}}}};var tB={kernelName:Sa,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,L(e,we(Ne(1),e)))}}};var nB={kernelName:Ia,gradFunc:t=>({x:()=>Se(t)})};var rB={kernelName:wa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(ad(se(e,"float32")),t)}}};var oB={kernelName:Ca,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(Wg(se(e,"float32")),t)}}};var iB={kernelName:fc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{begin:o,size:i}=e,s=r.shape,[a,l]=k1(r,o,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>pd(t,c)}}};var sB={kernelName:yc,outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{dim:o}=e,i=!0,s=L(t,r);return{logits:()=>we(s,L(ve(s,[o],i),r))}}};var aB={kernelName:Ta,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,$o(e))}}};var VD={kernelName:hc,gradFunc:(t,n,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>tm(t,r,o)}}};var BD={kernelName:gc,gradFunc:(t,n,e)=>{let{axis:r}=e;return{x:()=>$t(t,r)}}};var lB={kernelName:Ea,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,L(Vt(se(e,"float32")),2))}}};var cB={kernelName:Lf,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(t,L(se(e,"float32"),2))}}};var uB={kernelName:_a,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ne(2);return{a:()=>L(t,L(o,we(e,r))),b:()=>L(t,L(o,we(r,e)))}}};var dB={kernelName:Aa,gradFunc:t=>({x:()=>Se(t)})};var pB={kernelName:Da,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=t,l=At(e.shape,o);return l.length>0&&(a=ve(a,l)),V(a,e.shape)},b:()=>{let a=t,l=At(r.shape,o);return l.length>0&&(a=ve(a,l)),V(gt(a),r.shape)}}}};var fB={kernelName:mc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,o=r.shape.slice(),{axis:i}=e;vn(i,r.shape).forEach(c=>{o[c]=1});let a=V(t,o),l=L(a,Zr(r.shape,"float32"));return{x:()=>l}}};var mB={kernelName:Na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>pe(t,Ge(ad(e)))}}};var hB={kernelName:ka,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>L(we(Ne(1),Ge(e)),t)}}};var gB={kernelName:Zi,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{reps:o}=e;return{x:()=>{let s=Se(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=ee(s,it(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=ee(s,it(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)s=ee(s,it(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)s=ee(s,it(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var yB={kernelName:xc,gradFunc:(t,n,e)=>{let r=e,{perm:o}=r,i=Kg(o);return{x:()=>rt(t,i)}}};var xB={kernelName:vc,gradFunc:(t,n,e)=>{let r=e,{axis:o}=r;return{value:()=>Xn(t,o)}}};var vB={kernelName:bc,inputsToSave:["segmentIds"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>_ce(t,e)}}};function _ce(t,n){let e=Yr(n,Se(n)),r=ld(t,e),o=ho(n,Ne(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=Kn(o,a+1);o=ar(o,Zr(r.shape,"bool"));let s=Se(r);return sn(o,r,s)}var bB={kernelName:wc,gradFunc:t=>({x:()=>Se(t)})};var Dce=[ew,EV,_V,DV,NV,kV,AV,RV,OV,MV,FV,PV,LV,BV,zV,UV,jV,GV,WV,HV,qV,KV,YV,XV,QV,JV,e3,t3,n3,r3,j3,o3,i3,s3,a3,l3,u3,c3,d3,m3,h3,g3,y3,x3,v3,b3,w3,C3,I3,T3,$D,$D,E3,D3,k3,A3,R3,O3,M3,F3,P3,$3,L3,V3,B3,LD,LD,z3,U3,G3,W3,H3,q3,K3,X3,Y3,Z3,Q3,J3,eB,tB,nB,rB,oB,iB,sB,aB,VD,VD,BD,BD,lB,uB,cB,dB,pB,fB,mB,hB,gB,yB,xB,vB,bB];for(let t of Dce)v$(t);F().prototype.abs=function(){return this.throwIfDisposed(),bn(this)};F().prototype.acos=function(){return this.throwIfDisposed(),A1(this)};F().prototype.acosh=function(){return this.throwIfDisposed(),R1(this)};F().prototype.add=function(t){return this.throwIfDisposed(),ee(this,t)};F().prototype.all=function(t,n){return this.throwIfDisposed(),Ug(this,t,n)};F().prototype.any=function(t,n){return this.throwIfDisposed(),Zf(this,t,n)};F().prototype.argMax=function(t){return this.throwIfDisposed(),Qf(this,t)};F().prototype.argMin=function(t){return this.throwIfDisposed(),SL(this,t)};F().prototype.asScalar=function(){return this.throwIfDisposed(),M(this.size===1,()=>"The array must have only 1 element."),V(this,[])};F().prototype.asType=function(t){return this.throwIfDisposed(),se(this,t)};F().prototype.as1D=function(){return this.throwIfDisposed(),V(this,[this.size])};F().prototype.as2D=function(t,n){return this.throwIfDisposed(),V(this,[t,n])};F().prototype.as3D=function(t,n,e){return this.throwIfDisposed(),V(this,[t,n,e])};F().prototype.as4D=function(t,n,e,r){return this.throwIfDisposed(),V(this,[t,n,e,r])};F().prototype.as5D=function(t,n,e,r,o){return this.throwIfDisposed(),V(this,[t,n,e,r,o])};F().prototype.asin=function(){return this.throwIfDisposed(),O1(this)};F().prototype.asinh=function(){return this.throwIfDisposed(),M1(this)};F().prototype.atan=function(){return this.throwIfDisposed(),F1(this)};F().prototype.atan2=function(t){return this.throwIfDisposed(),TL(this,t)};F().prototype.atanh=function(){return this.throwIfDisposed(),P1(this)};F().prototype.avgPool=function(t,n,e,r){return this.throwIfDisposed(),sd(this,t,n,e,r)};F().prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),tm(this,t,n)};F().prototype.batchNorm=function(t,n,e,r,o){return this.throwIfDisposed(),Ec(this,t,n,e,r,o)};F().prototype.broadcastTo=function(t){return this.throwIfDisposed(),nm(this,t)};F().prototype.cast=function(t){return this.throwIfDisposed(),se(this,t)};F().prototype.ceil=function(){return this.throwIfDisposed(),G1(this)};F().prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Vn(this,t,n)};F().prototype.concat=function(t,n){return this.throwIfDisposed(),t instanceof ct&&(t=[t]),$t([this,...t],n)};F().prototype.conv1d=function(t,n,e,r,o,i){return this.throwIfDisposed(),jg(this,t,n,e,r,o,i)};F().prototype.conv2dTranspose=function(t,n,e,r,o){return this.throwIfDisposed(),Gg(this,t,n,e,r,o)};F().prototype.conv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Xr(this,t,n,e,r,o,i)};F().prototype.cos=function(){return this.throwIfDisposed(),ad(this)};F().prototype.cosh=function(){return this.throwIfDisposed(),Wg(this)};F().prototype.cumsum=function(t,n,e){return this.throwIfDisposed(),Bb(this,t,n,e)};F().prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),NL(this,t,n)};F().prototype.depthwiseConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Pa(this,t,n,e,r,o,i)};F().prototype.dilation2d=function(t,n,e,r,o){return this.throwIfDisposed(),kL(this,t,n,e,r,o)};F().prototype.divNoNan=function(t){return this.throwIfDisposed(),AL(this,t)};F().prototype.div=function(t){return this.throwIfDisposed(),pe(this,t)};F().prototype.dot=function(t){return this.throwIfDisposed(),RL(this,t)};F().prototype.elu=function(){return this.throwIfDisposed(),$a(this)};F().prototype.equal=function(t){return this.throwIfDisposed(),Lo(this,t)};F().prototype.erf=function(){return this.throwIfDisposed(),Z1(this)};F().prototype.exp=function(){return this.throwIfDisposed(),fr(this)};F().prototype.expandDims=function(t){return this.throwIfDisposed(),Kn(this,t)};F().prototype.expm1=function(){return this.throwIfDisposed(),Q1(this)};F().prototype.fft=function(){return this.throwIfDisposed(),ry(this)};F().prototype.flatten=function(){return this.throwIfDisposed(),V(this,[this.size])};F().prototype.floor=function(){return this.throwIfDisposed(),La(this)};F().prototype.floorDiv=function(t){return this.throwIfDisposed(),$b(this,t)};F().prototype.gather=function(t,n){return this.throwIfDisposed(),ld(this,t,n)};F().prototype.greaterEqual=function(t){return this.throwIfDisposed(),ho(this,t)};F().prototype.greater=function(t){return this.throwIfDisposed(),Bn(this,t)};F().prototype.ifft=function(){return this.throwIfDisposed(),um(this)};F().prototype.irfft=function(){return this.throwIfDisposed(),wD(this)};F().prototype.isFinite=function(){return this.throwIfDisposed(),J1(this)};F().prototype.isInf=function(){return this.throwIfDisposed(),eD(this)};F().prototype.isNaN=function(){return this.throwIfDisposed(),tD(this)};F().prototype.leakyRelu=function(t){return this.throwIfDisposed(),cd(this,t)};F().prototype.lessEqual=function(t){return this.throwIfDisposed(),es(this,t)};F().prototype.less=function(t){return this.throwIfDisposed(),Ub(this,t)};F().prototype.localResponseNormalization=function(t,n,e,r){return this.throwIfDisposed(),OL(this,t,n,e,r)};F().prototype.logSigmoid=function(){return this.throwIfDisposed(),oD(this)};F().prototype.logSoftmax=function(t){return this.throwIfDisposed(),qg(this,t)};F().prototype.logSumExp=function(t,n){return this.throwIfDisposed(),FL(this,t,n)};F().prototype.log=function(){return this.throwIfDisposed(),mr(this)};F().prototype.log1p=function(){return this.throwIfDisposed(),nD(this)};F().prototype.logicalAnd=function(t){return this.throwIfDisposed(),ar(this,t)};F().prototype.logicalNot=function(){return this.throwIfDisposed(),im(this)};F().prototype.logicalOr=function(t){return this.throwIfDisposed(),jb(this,t)};F().prototype.logicalXor=function(t){return this.throwIfDisposed(),PL(this,t)};F().prototype.matMul=function(t,n,e){return this.throwIfDisposed(),ht(this,t,n,e)};F().prototype.maxPool=function(t,n,e,r){return this.throwIfDisposed(),ud(this,t,n,e,r)};F().prototype.max=function(t,n){return this.throwIfDisposed(),zn(this,t,n)};F().prototype.maximum=function(t){return this.throwIfDisposed(),Yr(this,t)};F().prototype.mean=function(t,n){return this.throwIfDisposed(),jt(this,t,n)};F().prototype.min=function(t,n){return this.throwIfDisposed(),Dc(this,t,n)};F().prototype.minimum=function(t){return this.throwIfDisposed(),dd(this,t)};F().prototype.mirrorPad=function(t,n){return this.throwIfDisposed(),$L(this,t,n)};F().prototype.mod=function(t){return this.throwIfDisposed(),LL(this,t)};F().prototype.mul=function(t){return this.throwIfDisposed(),L(this,t)};F().prototype.neg=function(){return this.throwIfDisposed(),gt(this)};F().prototype.norm=function(t,n,e){return this.throwIfDisposed(),dm(this,t,n,e)};F().prototype.notEqual=function(t){return this.throwIfDisposed(),Nc(this,t)};F().prototype.oneHot=function(t,n=1,e=0){return this.throwIfDisposed(),Yf(this,t,n,e)};F().prototype.onesLike=function(){return this.throwIfDisposed(),Rn(this)};F().prototype.pad=function(t,n){return this.throwIfDisposed(),pd(this,t,n)};F().prototype.pool=function(t,n,e,r,o){return this.throwIfDisposed(),VL(this,t,n,e,r,o)};F().prototype.pow=function(t){return this.throwIfDisposed(),Vo(this,t)};F().prototype.prelu=function(t){return this.throwIfDisposed(),fd(this,t)};F().prototype.prod=function(t,n){return this.throwIfDisposed(),BL(this,t,n)};F().prototype.reciprocal=function(){return this.throwIfDisposed(),xD(this)};F().prototype.relu=function(){return this.throwIfDisposed(),Bo(this)};F().prototype.relu6=function(){return this.throwIfDisposed(),Kb(this)};F().prototype.reshapeAs=function(t){return this.throwIfDisposed(),V(this,t.shape)};F().prototype.reshape=function(t){return this.throwIfDisposed(),V(this,t)};F().prototype.resizeBilinear=function(t,n,e){return this.throwIfDisposed(),yV(this,t,n,e)};F().prototype.resizeNearestNeighbor=function(t,n,e){return this.throwIfDisposed(),xV(this,t,n,e)};F().prototype.reverse=function(t){return this.throwIfDisposed(),yo(this,t)};F().prototype.rfft=function(){return this.throwIfDisposed(),CD(this)};F().prototype.round=function(){return this.throwIfDisposed(),vD(this)};F().prototype.rsqrt=function(){return this.throwIfDisposed(),Yg(this)};F().prototype.selu=function(){return this.throwIfDisposed(),Zg(this)};F().prototype.separableConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Qg(this,t,n,e,r,o,i)};F().prototype.sigmoid=function(){return this.throwIfDisposed(),$o(this)};F().prototype.sign=function(){return this.throwIfDisposed(),bD(this)};F().prototype.sin=function(){return this.throwIfDisposed(),Jg(this)};F().prototype.sinh=function(){return this.throwIfDisposed(),ey(this)};F().prototype.slice=function(t,n){return this.throwIfDisposed(),it(this,t,n)};F().prototype.softmax=function(t){return this.throwIfDisposed(),hd(this,t)};F().prototype.softplus=function(){return this.throwIfDisposed(),ts(this)};F().prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),am(this,t,n)};F().prototype.split=function(t,n){return this.throwIfDisposed(),Un(this,t,n)};F().prototype.sqrt=function(){return this.throwIfDisposed(),Vt(this)};F().prototype.square=function(){return this.throwIfDisposed(),Ge(this)};F().prototype.squaredDifference=function(t){return this.throwIfDisposed(),nV(this,t)};F().prototype.squeeze=function(t){return this.throwIfDisposed(),gd(this,t)};F().prototype.stack=function(t,n){this.throwIfDisposed();let e=t instanceof ct?[this,t]:[this,...t];return Xn(e,n)};F().prototype.step=function(t){return this.throwIfDisposed(),bi(this,t)};F().prototype.stridedSlice=function(t,n,e,r,o,i,s,a){return this.throwIfDisposed(),ID(this,t,n,e,r,o,i,s,a)};F().prototype.sub=function(t){return this.throwIfDisposed(),we(this,t)};F().prototype.sum=function(t,n){return this.throwIfDisposed(),ve(this,t,n)};F().prototype.tan=function(){return this.throwIfDisposed(),SD(this)};F().prototype.tanh=function(){return this.throwIfDisposed(),em(this)};F().prototype.tile=function(t){return this.throwIfDisposed(),vi(this,t)};F().prototype.toBool=function(){return this.throwIfDisposed(),se(this,"bool")};F().prototype.toFloat=function(){return this.throwIfDisposed(),se(this,"float32")};F().prototype.toInt=function(){return this.throwIfDisposed(),se(this,"int32")};F().prototype.topk=function(t,n){return this.throwIfDisposed(),rV(this,t,n)};F().prototype.transpose=function(t){return this.throwIfDisposed(),rt(this,t)};F().prototype.unique=function(t){return this.throwIfDisposed(),oV(this,t)};F().prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Yb(this,t,n)};F().prototype.unstack=function(t){return this.throwIfDisposed(),Ar(this,t)};F().prototype.where=function(t,n){return this.throwIfDisposed(),sn(t,this,n)};F().prototype.zerosLike=function(){return this.throwIfDisposed(),Se(this)};var zD;function mn(){return zD==null&&(zD=IL().epsilon()),zD}function hr(){return"channelsLast"}var xo=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},gr=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},$=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},_e=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},nw=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}};function jo(t,n){if(Array.isArray(t)){let e=[];for(let r=0;r<n;r++)e=e.concat(t);return e}else{let e=new Array(n);return e.fill(t),e}}function vo(t,n){if(!t)throw new nw(n)}function jD(t,n){let e=0;for(let r of t)r===n&&e++;return e}function On(t){return t.length===1?t[0]:t}function Et(t){return Array.isArray(t)?t:[t]}function Go(t){let e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Ba(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(n,e)=>e.toUpperCase())}var Uo={};function fm(t){if(t==null)return null;let n={};return n.className=t.getClassName(),n.config=t.getConfig(),n}function UD(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(n=>UD(n));else{let n=Object.keys(t);for(let e of n){let r=t[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[e]=r.value:UD(r))}}}function os(t,n={},e={},r="object",o=!1){if(typeof t=="string"){let i=t,s;if(i in e)s=e[i];else if(i in Uo)s=Uo[i];else if(s=n[i],s==null)throw new $(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=t;if(i.className==null||i.config==null)throw new $(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in Uo?[a,l]=Uo.className:s in n&&([a,l]=n[s]),a==null)throw new $(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let c={};for(let f of Object.keys(Uo))c[f]=Uo[f];for(let f of Object.keys(e))c[f]=e[f];let u=i.config;u.customObjects=c;let d=Object.assign({},Uo);for(let f of Object.keys(e))Uo[f]=e[f];UD(i.config);let p=l(a,i.config,e,o);return Uo=Object.assign({},d),p}else{let c=Object.assign({},Uo);for(let d of Object.keys(e))Uo[d]=e[d];let u=new a(i.config);return Uo=Object.assign({},c),u}}}function Nce(t,n){return t<n?-1:t>n?1:0}function ay(t,n){return-1*Nce(t,n)}function Wo(t){if(t==null)return t;let n=[];for(let e of t)n.indexOf(e)===-1&&n.push(e);return n}function wB(t){if(t==null)throw new $(`Invalid value in obj: ${JSON.stringify(t)}`);for(let n in t)if(t.hasOwnProperty(n))return!1;return!0}function is(t,n,e){if(e!=null&&t.indexOf(e)<0)throw new $(`${e} is not a valid ${n}.  Valid values are ${t} or null/undefined.`)}function rw(t,n,e=0,r=1/0){return vo(e>=0),vo(r>=e),Array.isArray(t)&&t.length>=e&&t.length<=r&&t.every(o=>typeof o===n)}function an(t,n){Array.isArray(t)?(v.assert(t.length>0,()=>`${n} is unexpectedly an empty array.`),t.forEach((e,r)=>an(e,`element ${r+1} of ${n}`))):v.assert(Number.isInteger(t)&&t>0,()=>`Expected ${n} to be a positive integer, but got ${CB(t)}.`)}function CB(t){return t===null?"null":Array.isArray(t)?"["+t.map(n=>CB(n)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function IB(t,n){let e=v.now(),r;return(...i)=>{let s=v.now();return s-e<n||(e=s,r=t(...i)),r}}function ow(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}function GD(t,n){return z(()=>Vt(ve(L(t,t),n,!0)))}var Id=class extends Z.Serializable{getConfig(){return{}}},EB=(()=>{class t extends Id{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>{let r=GD(e,this.axis),o=Vn(r,0,this.maxValue);return L(e,pe(o,ee(mn(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return t.className="MaxNorm",t})();Z.registerClass(EB);var _B=(()=>{class t extends Id{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>pe(e,ee(mn(),GD(e,this.axis))))}getConfig(){return{axis:this.axis}}}return t.className="UnitNorm",t})();Z.registerClass(_B);var DB=(()=>{class t extends Id{apply(e){return Bo(e)}}return t.className="NonNeg",t})();Z.registerClass(DB);var NB=(()=>{class t extends Id{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>{let r=GD(e,this.axis),o=ee(L(this.rate,Vn(r,this.minValue,this.maxValue)),L(1-this.rate,r));return L(e,pe(o,ee(mn(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return t.className="MinMaxNorm",t})();Z.registerClass(NB);var SB={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Yt(t){return fm(t)}function TB(t,n={}){return os(t,Z.SerializationMap.getMap().classNameMap,n,"constraint")}function Zt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in SB?SB[t]:t,config:{}};return TB(e)}else return t instanceof Id?t:TB(t)}var kB=["channelsFirst","channelsLast"],AB=["nearest","bilinear"],RB=["valid","same","causal"],OB=["max","avg"],MB=["sum","mul","concat","ave"];var mm=new Map;function Gt(t){is(kB,"DataFormat",t)}function PB(t){is(AB,"InterpolationFormat",t)}function yr(t){is(RB,"PaddingMode",t)}function WD(t){is(OB,"PoolMode",t)}var ly=[],FB="/";function Ci(t,n){ly.push(t);try{let e=n();return ly.pop(),e}catch(e){throw ly.pop(),e}}function Ace(){return ly.length===0?"":ly.join(FB)+FB}function iw(t){if(!$B(t))throw new Error("Not a valid tensor name: '"+t+"'");return Ace()+t}function sw(t){if(!$B(t))throw new Error("Not a valid tensor name: '"+t+"'");mm.has(t)||mm.set(t,0);let n=mm.get(t);if(mm.set(t,mm.get(t)+1),n>0){let e=`${t}_${n}`;return mm.set(e,1),e}else return t}var Rce=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function $B(t){return!!t.match(Rce)}function LB(t){return t===parseInt(t.toString(),10)}function Ho(t,n,e){n==null&&(n=0),e==null&&(e=t.length);let r=1;for(let o=n;o<e;++o)r*=t[o];return r}function VB(t){return t=Array.isArray(t)?new Float32Array(t):t,zo(t)}function Sd(t){return Dc(VB(t)).dataSync()[0]}function Ii(t){return zn(VB(t)).dataSync()[0]}function lr(t,n){if(n<t)throw new $(`end (${n}) < begin (${t}) is forbidden.`);let e=[];for(let r=t;r<n;++r)e.push(r);return e}function Ua(t,n){return t.asType(n)}function ja(t,n=-1){let e=t.shape.slice();return n<0&&(n=e.length+n+1),e.splice(n,0,1),t.reshape(e)}function BB(t,n){return z(()=>{if(t.shape.length!==2)throw new $(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let e=ja(t,1);return lw(e,[1,n,1])})}function zB(t){let n=[Ho(t.shape)];return t.reshape(n)}function UB(t){if(t.rank<=1)throw new $(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let n=[t.shape[0],Ho(t.shape,1)];return t.reshape(n)}function za(t,n,e){return z(()=>{switch(t.rank){case 1:return ty(t,n,e);case 2:return Xb(t,[n,0],[e,t.shape[1]]);case 3:return ny(t,[n,0,0],[e,t.shape[1],t.shape[2]]);case 4:return cm(t,[n,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3]]);case 5:return it(t,[n,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return it(t,[n,0,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new $(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function HD(t,n,e){return z(()=>{switch(t.rank){case 1:return ty(t,n,e);case 2:return Xb(t,[0,n],[t.shape[0],e]);case 3:return ny(t,[0,0,n],[t.shape[0],t.shape[1],e]);case 4:return cm(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],e]);default:throw new $(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function cy(t,n,e,r){return z(()=>{switch(t.rank){case 1:return ty(t,n,e);case 2:switch(r){case 1:return za(t,n,e);case 2:return HD(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return za(t,n,e);case 2:return ny(t,[0,n,0],[t.shape[0],e,t.shape[2]]);case 3:return HD(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return za(t,n,e);case 2:return cm(t,[0,n,0,0],[t.shape[0],e,t.shape[2],t.shape[3]]);case 3:return cm(t,[0,0,n,0],[t.shape[0],t.shape[1],e,t.shape[3]]);case 4:return HD(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}default:throw new $(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function hm(t,n=-1){let e;return n<0&&(e=t[0].rank,e!==0?n=e:n=0),n===t[0].rank&&(n=-1),$t(t,n)}function KD(t,n){switch(t.rank){case 1:return W1([t,n]);case 2:return H1([t,n],0);case 3:return q1([t,n],0);case 4:return K1([t,n],0);default:throw new $(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function lw(t,n){if(Array.isArray(n)||(n=[n]),t.rank!==n.length)throw new $(`The length of input n (${n.length}) does not match the number of dimensions in input x (${t.rank})`);return vi(t,n)}function gm(t,n=0,e=1,r,o){return qb(t,n,e,r,o)}function qo(t,n,e,r){if(t.rank<2||n.rank<2)throw new _e(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${n.shape}`);if(n.rank>=3){let o=t.shape.slice(-1)[0],i=n.shape.slice(-2)[0];if(o!==i)throw new _e(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${n.shape}`)}if(t.rank===2&&n.rank===2)return wd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?qD(t.rank,r,hr()):null,activation:e});{let o=t.shape.slice(),i=o.pop();t=t.reshape([-1,i]);let s=n.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:n.rank},(m,h)=>h===0?n.rank-2:h<=n.rank-2?h-1:h);n=n.transpose(u).reshape([l,-1]);let d=[...o,...c];return wd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?qD(t.rank,r,hr()):null,activation:e}).reshape(d)}}function cw(t,n,e){return z(()=>(Array.isArray(n)?n=zo(n,"int32"):n=n.toInt(),ld(t,n,e)))}function Td(t){return L(t,t)}function qD(t,n,e){let r=n.shape;if(n.rank!==1&&n.rank!==t)throw new $(`Unexpected bias dimensions: ${n.rank}; expected it to be 1 or ${t}`);if(t===5){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1,1]):n.reshape([1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===4){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1]):n.reshape([1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===3){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1]):n.reshape([1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,r[0]]):n.reshape([1].concat(r))}else if(t<3)return n;throw new $(`Unsupported input rank by biasAdd: ${n.rank}`)}function xr(t,n,e){return z(()=>(e==null&&(e=hr()),Gt(e),t.add(qD(t.rank,n,e))))}function jB(t,n=1){if(n!==1)throw new _e(`Support for alpha values other than 1 (${n}) is not implemented yet.`);return $a(t)}function GB(t){return z(()=>pe(t,bn(t).add(1)))}function uw(t,n,e,r){return z(()=>lV(t,n,e,r))}function WB(t){return z(()=>{let n=ee(.5,L(.2,t));return Vn(n,0,1)})}function Ac(t,n,e=!1){return e?t():n()}var HB=["fanIn","fanOut","fanAvg"],qB=["normal","uniform","truncatedNormal"];function Oce(t){is(HB,"FanMode",t)}function Mce(t){is(qB,"Distribution",t)}var br=class extends Z.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},YB=(()=>{class t extends br{apply(e,r){return Lt(e,r)}}return t.className="Zeros",t})();Z.registerClass(YB);var dw=(()=>{class t extends br{apply(e,r){return Zr(e,r)}}return t.className="Ones",t})();Z.registerClass(dw);var ZB=(()=>{class t extends br{constructor(e){if(super(),typeof e!="object")throw new $(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new $(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return z(()=>L(Ne(this.value),Zr(e,r)))}getConfig(){return{value:this.value}}}return t.className="Constant",t})();Z.registerClass(ZB);var QB=(()=>{class t extends br{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return Va(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return t.className="RandomUniform",t})();Z.registerClass(QB);var JB=(()=>{class t extends br{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new _e(`randomNormal does not support dType ${r}.`);return gm(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="RandomNormal",t})();Z.registerClass(JB);var ez=(()=>{class t extends br{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new _e(`truncatedNormal does not support dType ${r}.`);return oy(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="TruncatedNormal",t})();Z.registerClass(ez);var tz=(()=>{class t extends br{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return z(()=>{if(e.length!==2||e[0]!==e[1])throw new $("Identity matrix initializer can only be used for 2D square matrices.");return L(this.gain,om(e[0]))})}getConfig(){return{gain:this.gain}}}return t.className="Identity",t})();Z.registerClass(tz);function Fce(t,n="channelsLast"){let e,r;if(Gt(n),t.length===2)e=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(n==="channelsFirst"){let o=Ho(t,2);e=t[1]*o,r=t[0]*o}else if(n==="channelsLast"){let o=Ho(t,0,t.length-2);e=t[t.length-2]*o,r=t[t.length-1]*o}}else{let o=Ho(t);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var Qr=(()=>{class t extends br{constructor(e){if(super(),e.scale<0)throw new $(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Oce(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Mce(this.distribution),this.seed=e.seed}apply(e,r){let o=Fce(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new _e(`${this.getClassName()} does not support dType ${r}.`);return oy(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return Va(e,-l,l,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return t.className="VarianceScaling",t})();Z.registerClass(Qr);var XD=(()=>{class t extends Qr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qr.className}}return t.className="GlorotUniform",t})();Z.registerClass(XD);var YD=(()=>{class t extends Qr{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qr.className}}return t.className="GlorotNormal",t})();Z.registerClass(YD);var ZD=(()=>{class t extends Qr{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qr.className}}return t.className="HeNormal",t})();Z.registerClass(ZD);var QD=(()=>{class t extends Qr{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qr.className}}return t.className="HeUniform",t})();Z.registerClass(QD);var JD=(()=>{class t extends Qr{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Qr.className}}return t.className="LeCunNormal",t})();Z.registerClass(JD);var eN=(()=>{class t extends Qr{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Qr.className}}return t.className="LeCunNormal",t})();Z.registerClass(eN);var nz=(()=>{class t extends br{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new _e("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return z(()=>{if(e.length<2)throw new _e("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let o=e[0]>e[1]?[e[1],e[0]]:e,i=gm(o,0,1,"float32"),s=IV.gramSchmidt(i);return e[0]>e[1]&&(s=s.transpose()),L(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}}return t.className="Orthogonal",t})();Z.registerClass(nz);var KB={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function XB(t,n={}){return os(t,Z.SerializationMap.getMap().classNameMap,n,"initializer")}function Rt(t){return fm(t)}function St(t){if(typeof t=="string"){let n=t in KB?KB[t]:t;if(n==="GlorotNormal")return new YD;if(n==="GlorotUniform")return new XD;if(n==="HeNormal")return new ZD;if(n==="HeUniform")return new QD;if(n==="LeCunNormal")return new JD;if(n==="LeCunUniform")return new eN;{let e={};return e.className=n,e.config={},XB(e)}}else return t instanceof br?t:XB(t)}var $ce=0;function fw(){return $ce++}var pw={};function Rc(t=""){return t in pw||(pw[t]=0),pw[t]+=1,t+pw[t].toString()}function mw(t){return Array.isArray(t)&&Array.isArray(t[0])}function ym(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Le(t){let n;if(Array.isArray(t)){if(t.length!==1)throw new $(`Expected Tensor length to be 1; got ${t.length}`);n=t[0]}else n=t;return n}function Ze(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new $(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function xm(t){let n=0;for(let e of t)e.shape.length===0?n+=1:n+=e.shape.reduce((r,o)=>r*o);return n}var oz="Variable",uy=class{constructor(n,e="float32",r=oz,o=!0,i=null){this.dtype=e??"float32",this.shape=n.shape,this.id=fw(),r=r??oz,this.originalName=iw(r),this.name=sw(this.originalName),this.trainable_=o,this.constraint=i,this.val=TD(n,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(n){return this.assertNotDisposed(),Vce(this.val,n),this.val.id!==n.id&&(this.val.assign(n),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(n){this.trainable_=n,this.val.trainable=n}};function Vce(t,n){if(t.shape.toString()!==n.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(n.shape))}function dy(t){return t.map(n=>n.read())}function vm(t){t.forEach(n=>{n[0].write(n[1])})}var _t=class{constructor(n){this.dtype=n.dtype,this.shape=n.shape,n.shape!=null?this.ndim=n.shape.length:this.ndim=n.ndim,this.maxNDim=n.maxNDim,this.minNDim=n.minNDim,this.axes=n.axes||{}}},cr=class{constructor(n,e,r,o,i,s,a){this.dtype=n,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=fw(),s!=null&&(this.originalName=iw(s),this.name=sw(this.originalName)),this.rank=e.length}},Bce=0,Ga=class{constructor(n,e){this.callArgs=e,this.id=Bce++,this.outboundLayer=n.outboundLayer,this.inboundLayers=n.inboundLayers,this.nodeIndices=n.nodeIndices,this.tensorIndices=n.tensorIndices,this.inputTensors=n.inputTensors,this.outputTensors=n.outputTensors,this.inputMasks=n.inputMasks,this.outputMasks=n.outputMasks,this.inputShapes=n.inputShapes,this.outputShapes=n.outputShapes;for(let r of n.inboundLayers)r?.outboundNodes.push(this);n.outboundLayer.inboundNodes.push(this)}getConfig(){let n=[];for(let e of this.inboundLayers)e!=null?n.push(e.name):n.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},zce=0,ze=class extends Z.Serializable{constructor(n={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=zce++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=n.name;if(!e){let r=this.getClassName();e=Go(r)+"_"+Rc(r)}if(this.name=e,this.trainable_=n.trainable==null?!0:n.trainable,n.inputShape!=null||n.batchInputShape!=null){let r;if(n.batchInputShape!=null)r=n.batchInputShape;else if(n.inputShape!=null){let i=null;n.batchSize!=null&&(i=n.batchSize),r=[i].concat(n.inputShape)}this.batchInputShape=r;let o=n.dtype;o==null&&(o=n.inputDType),o==null&&(o="float32"),this.dtype=o}n.weights!=null?this.initialWeights=n.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(n,e){return n.name+"_ib-"+e.toString()}getNodeAtIndex(n,e){if(this.inboundNodes.length===0)throw new gr(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=n)throw new $(`Asked to get ${e} at node ${n}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[n]}getInputAt(n){return On(this.getNodeAtIndex(n,"input").inputTensors)}getOutputAt(n){return On(this.getNodeAtIndex(n,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new xo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new xo(`Layer ${this.name} is not connected, no input to return.`);return On(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new xo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new xo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return On(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(n=>n())}get updates(){return this._updates}get built(){return this._built}set built(n){this._built=n}get trainable(){return this.trainable_}set trainable(n){this._trainableWeights.forEach(e=>e.trainable=n),this.trainable_=n}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(n=>n.trainable):[]}set trainableWeights(n){this._trainableWeights=n}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(n=>!n.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(n){this._nonTrainableWeights=n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(n){if(n=Et(n),this.inputSpec==null||this.inputSpec.length===0)return;let e=Et(this.inputSpec);if(n.length!==e.length)throw new $(`Layer ${this.name} expects ${e.length} inputs, but it received ${n.length} input tensors. Input received: ${n}`);for(let r=0;r<n.length;r++){let o=n[r],i=e[r];if(i==null)continue;let s=o.rank;if(i.ndim!=null&&s!==i.ndim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(i.maxNDim!=null&&s>i.maxNDim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(i.minNDim!=null&&s<i.minNDim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new $(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){let a=o.shape;for(let l in i.axes){let c=Number(l),u=i.axes[l],d=c>=0?a[c]:a[a.length+c];if(u!=null&&[u,null].indexOf(d)===-1)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${a}.`)}}if(i.shape!=null)for(let a=0;a<i.shape.length;++a){let l=i.shape[a],c=o.shape[a];if(l!=null&&c!=null&&l!==c)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(n,e){return n}invokeCallHook(n,e){this._callHook!=null&&this._callHook(n,e)}setCallHook(n){this._callHook=n}clearCallHook(){this._callHook=null}apply(n,e){e=e||{},this.assertNotDisposed();let r=Et(n),o=!0;for(let s of r)if(!(s instanceof cr)){o=!1;break}let i=!0;for(let s of r)if(s instanceof cr){i=!1;break}if(o===i)throw new $("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ci(this.name,()=>{if(!this.built){this.assertInputCompatibility(n);let s=[];for(let a of Et(n))s.push(a.shape);this.build(On(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(n),i){let s=this.call(n,e),a=Et(s),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=On(l),this.activityRegularizer!=null)throw new _e("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=Uce(n),a=this.computeOutputShape(s),l,c=jce(n);if(this.warnOnIncompatibleInputShape(Array.isArray(n)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new cr(c,u,this,Et(n),e,this.name,d)):l=new cr(c,a,this,Et(n),e,this.name),this.addInboundNode(n,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new _e("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(n){if(this.batchInputShape!=null)if(n.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(n)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&n[o]!=null&&n[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(n)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new xo(`The layer ${this.name} has never been called and thus has no defined output shape.`);let n=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);n.indexOf(r)===-1&&n.push(r)}if(n.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new xo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new gr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return xm(this.weights)}build(n){this.built=!0}getWeights(n=!1){return dy(n?this.trainableWeights:this.weights)}setWeights(n){z(()=>{let e=this.weights;if(e.length!==n.length)throw new $(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${n.length}, but the layer was expecting ${e.length} weights. Provided weights: ${n}...`);if(e.length===0)return;let r=[],o=dy(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=n[i];if(!v.arraysEqual(s.shape,l.shape))throw new $(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}vm(r)})}addWeight(n,e,r,o,i,s,a){if(this._addedWeightNames.indexOf(n)!==-1)throw new $(`Duplicate weight name ${n} for layer ${this.name}`);this._addedWeightNames.push(n),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=St("zeros"));let l=o.apply(e,r),c=new uy(l,r,n,s,a);return l.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),s==null&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(n){this.fastWeightInitDuringBuild=n}addLoss(n){n==null||Array.isArray(n)&&n.length===0||(n=Et(n),this._losses!==void 0&&this._losses!==null&&this.losses.push(...n))}computeOutputShape(n){return n}computeMask(n,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(n,e,r,o,i,s,a=null){let l=Et(n);e=Et(e),r=Et(r),o=Et(o),i=ym(i),s=ym(s);let c=[],u=[],d=[];for(let p of l)c.push(p.sourceLayer),u.push(p.nodeIndex),d.push(p.tensorIndex);new Ga({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let p=0;p<e.length;p++)e[p].sourceLayer=this,e[p].nodeIndex=this.inboundNodes.length-1,e[p].tensorIndex=p}getConfig(){let n={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(n.batchInputShape=this.batchInputShape),this.dtype!=null&&(n.dtype=this.dtype),n}disposeWeights(){return this.weights.forEach(n=>n.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let n=0;return--this._refCount===0&&(n=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:n}}};function Uce(t){t=Et(t);let n=[];for(let e of t)n.push(e.shape);return On(n)}function jce(t){return"float32"}function tN(t,n,e){if((n==null||e!=null&&e>0)&&(n=t.sourceLayer,e=t.nodeIndex),n.inboundNodes.length===0)return[t];{let r=n.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=tN(s,a,l);for(let u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}var Ed=(()=>{class t extends ze{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Rc("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new $("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new $("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new $("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new cr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new Ga({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new $(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return t.className="InputLayer",t})();Z.registerClass(Ed);function nN(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new $("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let n=t.batchShape;t.shape!=null&&n==null&&(n=[null].concat(t.shape));let e=t.dtype;return e==null&&(e="float32"),new Ed({batchInputShape:n,name:t.name,dtype:e,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}async function Wa(t){if(t==null)return;let n=[],e=[],r=[];for(let o in t){let i=t[o];if(typeof i!="number"){let s=i;n.push(s.data()),e.push(o),r.push(s)}}if(n.length>0){let o=await Promise.all(n);for(let i=0;i<o.length;++i)t[e[i]]=o[i][0];Oe(r)}}function hw(t){if(t!=null)for(let n in t){let e=t[n];typeof e!="number"&&e.dispose()}}var Gce=125,Oc=class{constructor(){this.validationData=null}setParams(n){this.params=n}async onEpochBegin(n,e){}async onEpochEnd(n,e){}async onBatchBegin(n,e){}async onBatchEnd(n,e){}async onTrainBegin(n){}async onTrainEnd(n){}setModel(n){}},gw=class{constructor(n,e=10){n==null&&(n=[]),this.callbacks=n,this.queueLength=e}append(n){this.callbacks.push(n)}setParams(n){for(let e of this.callbacks)e.setParams(n)}setModel(n){for(let e of this.callbacks)e.setModel(n)}async onEpochBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochBegin(n,e)}async onEpochEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochEnd(n,e)}async onBatchBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchBegin(n,e)}async onBatchEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchEnd(n,e)}async onTrainBegin(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainBegin(n)}async onTrainEnd(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainEnd(n)}},rN=class extends Oc{constructor(){super()}async onEpochBegin(n){this.seen=0,this.totals={}}async onBatchEnd(n,e){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=z(()=>ee(this.totals[o],L(i,r)));this.totals[o]=a,s?.dispose()}}}async onEpochEnd(n,e){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:z(()=>{let o=L(pe(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),An(e[r])}))}},yw=class extends Oc{async onTrainBegin(n){this.epoch=[],this.history={}}async onEpochEnd(n,e){e==null&&(e={}),this.epoch.push(n);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])}async syncData(){let n=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];n.push(l.data()),e.push(i),r.push(a)}}let o=await Promise.all(n);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]}},xw=class extends Oc{constructor(n,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Gce),this.yieldEvery==="never"&&n.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");v.isNumber(this.yieldEvery)&&(this.maybeWait=IB(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=n.onTrainBegin,this.trainEnd=n.onTrainEnd,this.epochBegin=n.onEpochBegin,this.epochEnd=n.onEpochEnd,this.batchBegin=n.onBatchBegin,this.batchEnd=n.onBatchEnd,this.yield=n.onYield}async maybeWait(n,e,r){let o=[];this.yield!=null&&(await Wa(r),o.push(this.yield(n,e,r))),o.push(sy()),await Promise.all(o)}async onEpochBegin(n,e){this.currentEpoch=n,this.epochBegin!=null&&(await Wa(e),await this.epochBegin(n,e))}async onEpochEnd(n,e){let r=[];this.epochEnd!=null&&(await Wa(e),r.push(this.epochEnd(n,e))),this.yieldEvery==="epoch"&&r.push(sy()),await Promise.all(r)}async onBatchBegin(n,e){this.batchBegin!=null&&(await Wa(e),await this.batchBegin(n,e))}async onBatchEnd(n,e){let r=[];this.batchEnd!=null&&(await Wa(e),r.push(this.batchEnd(n,e))),this.yieldEvery==="batch"?r.push(sy()):v.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,n,e)),await Promise.all(r)}async onTrainBegin(n){this.trainBegin!=null&&(await Wa(n),await this.trainBegin(n))}async onTrainEnd(n){this.trainEnd!=null&&(await Wa(n),await this.trainEnd(n))}};function vw(t,n){return t==null&&(t={}),t instanceof Oc?[t]:Array.isArray(t)&&t[0]instanceof Oc?t:Et(t).map(r=>new xw(r,n))}var iz=(()=>{class t{constructor(){}static registerCallbackConstructor(e,r){v.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),t.checkForDuplicate(r),t.constructors[e]==null&&(t.constructors[e]=[]),t.constructors[e].push(r)}static checkForDuplicate(e){for(let r in t.constructors)t.constructors[+r].forEach(i=>{if(i===e)throw new $("Duplicate callback constructor.")})}static clear(){t.constructors={}}static createCallbacks(e){let r=[];for(let o in t.constructors){let i=+o;e>=i&&r.push(...t.constructors[i])}return r.map(o=>new o)}}return t.constructors={},t})();function bw(t,n,e,r,o,i,s,a,l){let c=new yw,u=[new rN,...iz.createCallbacks(n)];t!=null&&u.push(...t),u.push(c);let d=new gw(u);return d.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:n,doValidation:a,metrics:l}),{callbackList:d,history:c}}function Rr(t,n={},e=!1){return os(t,Z.SerializationMap.getMap().classNameMap,n,"layer",e)}function py(t,n){return z(()=>{t.dtype!=="float32"&&(t=t.asType("float32"));let e=ve(Td(t),n,!0),r=Hg(e.shape,mn()),o=Vt(Yr(e,r));return pe(t,o)})}function _d(t,n){return z(()=>jt(Td(we(n,t)),-1))}function my(t,n){return z(()=>jt(bn(we(n,t)),-1))}function hy(t,n){return z(()=>{let e=we(t,n),r=Vn(bn(t),mn(),Number.MAX_VALUE),o=bn(pe(e,r));return L(100,jt(o,-1))})}function Wce(t,n){return z(()=>{let e=Vn(n,mn(),Number.MAX_VALUE),r=mr(ee(1,e)),o=Vn(t,mn(),Number.MAX_VALUE),i=mr(ee(1,o));return jt(Td(we(r,i)),-1)})}function Hce(t,n){return z(()=>{let e=Yr(0,we(1,L(t,n)));return jt(Td(e),-1)})}function qce(t,n){return z(()=>{let e=Yr(0,we(1,L(t,n)));return jt(e,-1)})}function Kce(t,n){return z(()=>{let e=ve(L(t,n),-1),r=zn(L(we(1,t),n),-1);return Yr(0,ee(1,we(r,e)))})}function Xce(t,n){return z(()=>{let e=Math.log(2),r=we(n,t),o=we(ee(r,ts(L(-2,r))),e);return jt(o,-1)})}function Dd(t,n,e=!1){return z(()=>{if(e)n=hd(n);else{let r=ve(n,n.shape.length-1,!0);n=pe(n,r)}return n=Vn(n,mn(),1-mn()),gt(ve(L(t.toFloat(),mr(n)),n.shape.length-1))})}function bm(t,n,e=!1){return z(()=>{let r=La(zB(t)).toInt();n=Vn(n,mn(),1-mn());let o=n.shape,i=Yf(r,o[o.length-1]).reshape(o);return Dd(i,n,e)})}function Yce(t,n){if(!v.arraysEqual(t.shape,n.shape))throw new $(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(n.shape)}`);return z(()=>{let e=n.relu(),r=n.abs().neg();return e.sub(n.mul(t)).add(r.exp().log1p())})}function wm(t,n){return z(()=>{let e;return e=Vn(n,mn(),1-mn()),e=mr(pe(e,we(1,e))),jt(Yce(t,e),-1)})}function Zce(t,n){return z(()=>{let e=Vn(t,mn(),1),r=Vn(n,mn(),1);return ve(L(t,mr(pe(e,r))),-1)})}function Qce(t,n){return z(()=>{let e=mr(ee(mn(),n));return jt(we(n,L(t,e)),-1)})}function ww(t,n){return z(()=>{let e=py(t,-1),r=py(n,-1),o=L(e,r);return gt(ve(o,-1))})}var fy={meanSquaredError:_d,meanAbsoluteError:my,meanAbsolutePercentageError:hy,meanSquaredLogarithmicError:Wce,squaredHinge:Hce,hinge:qce,categoricalHinge:Kce,logcosh:Xce,categoricalCrossentropy:Dd,sparseCategoricalCrossentropy:bm,binaryCrossentropy:wm,kullbackLeiblerDivergence:Zce,poisson:Qce,cosineProximity:ww};function Cw(t){if(typeof t=="string"){if(t in fy)return fy[t];let n=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new $(n)}else return t}function Sw(t,n){return z(()=>{let e=L(.5,Rn(n)),r=Ua(Bn(n,e),t.dtype);return jt(Lo(t,r),-1)})}function Tw(t,n){return z(()=>Ua(Lo(Qf(t,-1),Qf(n,-1)),"float32"))}function Jce(t,n){return z(()=>ar(t.equal(1),n.equal(1)).sum().cast("float32"))}function eue(t,n){return z(()=>ar(t.equal(0),n.equal(1)).sum().cast("float32"))}function az(t,n){return z(()=>{let e=Jce(t,n),r=eue(t,n),o=e.add(r);return sn(Bn(o,0),e.div(o),0).cast("float32")})}function oN(t,n){return wm(t,n)}function iN(t,n){return t.rank===n.rank&&(t=t.squeeze([t.rank-1])),n=n.argMax(-1),n.dtype!==t.dtype&&(n=n.asType(t.dtype)),Lo(t,n).asType("float32")}var tue=_d,nue=_d,rue=my,oue=my,iue=hy,sue=hy,Ew=Dd,aue=ww,sN=bm,Iw={binaryAccuracy:Sw,categoricalAccuracy:Tw,precision:az,categoricalCrossentropy:Ew,sparseCategoricalCrossentropy:sN,mse:tue,MSE:nue,mae:rue,MAE:oue,mape:iue,MAPE:sue,cosine:aue};function lz(t){if(typeof t=="string"&&t in Iw)return Iw[t];if(typeof t!="string"&&t!=null)return t;throw new $(`Unknown metric ${t}`)}function gy(t){if(vo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let n;for(let e of Object.keys(fy))if(fy[e]===t){n=e;break}if(n!==void 0)return n;for(let e of Object.keys(Iw))if(Iw[e]===t){n=e;break}return n!==void 0?n:t.name}}function uz(t){let n={Adagrad:()=>Cd.adagrad(.01),Adadelta:()=>Cd.adadelta(1,.95,mn()),Adam:()=>Cd.adam(.001,.9,.999,mn()),Adamax:()=>Cd.adamax(.002,.9,.999,mn(),0),RMSProp:()=>Cd.rmsprop(.001,.9,0,mn()),SGD:()=>Cd.sgd(.01)};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new $(`Unknown Optimizer ${t}`)}function lN(t,n,e=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!aN(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(t);r.length>1048576&&console.warn(`User-defined metadata of model "${n}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function aN(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let n=Object.keys(t);for(let e of n)if(typeof e!="string"||!aN(t[e]))return!1;return!0}else if(Array.isArray(t)){for(let n of t)if(!aN(n))return!1;return!0}else return!1;else{let n=typeof t;return n==="string"||n==="number"||n==="boolean"}}function dz(t,n,e,r=console.log){let o=uue(t),i=["Layer (type)","Output shape","Param #"];o?(n=n||65,e=e||[.45,.85,1]):(n=n||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(n*u)));let s;if(!o){i.push("Receives inputs"),s=[];for(let u in t.nodesByDepth)s.push(...t.nodesByDepth[u])}r("_".repeat(n)),_w(i,e,r),r("=".repeat(n));let a=t.layers;for(let u=0;u<a.length;++u)o?due(a[u],e,r):pue(a[u],e,s,r),r((u===a.length-1?"=":"_").repeat(n));t.checkTrainableWeightsConsistency();let l=cue(t),c=xm(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(n))}function cue(t){let n;return t.collectedTrainableWeights!=null?n=xm(t.collectedTrainableWeights):n=xm(t.trainableWeights),n}function uue(t){let n=!0,e=[],r=[];for(let o in t.nodesByDepth)e.push(t.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){n=!1;break}r.push(...o)}if(n)for(let o of t.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){n=!1;break}else i=!0;if(!n)break}return n}function _w(t,n,e=console.log){let r="";for(let o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=t[o],r=r.slice(0,n[o]),r+=" ".repeat(n[o]-r.length);e(r)}function due(t,n,e){let r;try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}let o=t.name,i=t.getClassName(),s=[`${o} (${i})`,r,t.countParams().toString()];_w(s,n,e)}function pue(t,n,e,r){let o;try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let u of t.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(u)===-1))for(let d=0;d<u.inboundLayers.length;++d){let p=u.inboundLayers[d].name,f=u.nodeIndices[d],m=u.tensorIndices[d];i.push(`${p}[${f}][${m}]`)}let s=t.name,a=t.getClassName(),l=i.length===0?"":i[0],c=[`${s} (${a})`,o,t.countParams().toString(),l];_w(c,n,r);for(let u=1;u<i.length;++u)_w(["","","",i[u]],n,r)}function pz(t,n,e){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&n===0&&typeof e=="string"}function Cm(t,n){if(t===null)return null;if(typeof t=="string")return Ba(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];pz(n,o,i)?e.push(i):e.push(Cm(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=Ba(r);e[i]=Cm(o,i)}}return e}}function Dw(t,n){if(t==null)return null;if(typeof t=="string")return Go(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];pz(n,o,i)?e.push(i):e.push(Dw(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r],i=Go(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=Dw(o,r)}return e}}var Im="3.6.0";function fue(t,n){if(t.dtype==null||t.dtype===n.dtype)return n;try{return se(n,t.dtype)}catch{throw new $(`The dtype of the feed (${n.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var ss=class t{constructor(n){if(this.id2Value={},this.id2Mask={},this.name2Id={},n instanceof t)for(let e in n.id2Value)this.id2Value[e]=n.id2Value[e],e in n.id2Mask&&(this.id2Mask[e]=n.id2Mask[e]);else{if(n==null)return;for(let e of n)this.add(e.key,e.value)}}add(n,e,r){if(this.id2Value[n.id]==null)this.id2Value[n.id]=fue(n,e),this.name2Id[n.name]=n.id,r!=null&&(this.id2Mask[n.id]=r);else throw new $(`Duplicate key: name=${n.name}, id=${n.id}`);return this}addFeed(n){this.add(n.key,n.value)}hasKey(n){return this.id2Value[n.id]!=null}names(){return Object.keys(this.name2Id)}getValue(n){if(n instanceof cr){if(this.id2Value[n.id]==null)throw new $(`Nonexistent key: ${n.name}`);return this.id2Value[n.id]}else{let e=this.name2Id[n];if(e==null)throw new $(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Value[e]}}getMask(n){if(n instanceof cr){if(this.id2Value[n.id]==null)throw new $(`Nonexistent key: ${n.name}`);return this.id2Mask[n.id]}else{let e=this.name2Id[n];if(e==null)throw new $(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Oe(this.id2Mask)}},cN={},fz={};function Nd(t,n,e,r){let o=e==null?!1:e.training,i=Array.isArray(t),s=i?t:[t],a=s.map(m=>m.name),l=[],c=n.names();for(let m of a)c.indexOf(m)!==-1?l.push(n.getValue(m)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let u=a.join(",")+"|"+n.names().join(","),d,p;if(cN[u]==null){let m=mue(s,n);d=m.sorted,p=m.recipientCounts,cN[u]=d,fz[u]=p}d=cN[u],p={},o||Object.assign(p,fz[u]);let f=new ss(n);for(let m=0;m<d.length;++m){if(r!=null){let R=zg().numTensors;R>r.maxNumTensors&&(r.maxNumTensors=R),R<r.minNumTensors&&(r.minNumTensors=R)}let h=d[m],g=h.sourceLayer;if(g instanceof Ed)continue;let y=[],x=[],w=[],b=!1;for(let R of h.inputs){let P=f.getValue(R),U=f.getMask(R);y.push(P),x.push(U),U!=null&&(b=!0),o||(p[R.name]--,p[R.name]===0&&!n.hasKey(R)&&a.indexOf(R.name)===-1&&!P.isDisposed&&R.sourceLayer.stateful!==!0&&w.push(P))}b&&(e=e||{},e.mask=x[0]);let S=Et(g.apply(y,e)),E=null;g.supportsMasking&&(E=g.computeMask(y,x));let D=gue(h),O=Array.isArray(D)?D:[D];for(let R=0;R<O.length;++R){f.hasKey(O[R])||f.add(O[R],S[R],Array.isArray(E)?E[0]:E);let P=a.indexOf(O[R].name);P!==-1&&(l[P]=S[R])}o||Oe(w)}return f.disposeMasks(),i?l:l[0]}function mue(t,n){v.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(t.length===1){let o=mz(t[0],n);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of t){let{sorted:s,recipientMap:a}=mz(i,n);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:e,recipientCounts:hue(r)}}function hue(t){let n={};for(let e in t)n[e]=t[e].size;return n}function mz(t,n){let e=new Set,r=[],o={};for(let a of n.names())e.add(a);let i=[],s=[];for(i.push(t);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:o}}function gue(t){let n;if(t.sourceLayer.inboundNodes.length===1)n=t.sourceLayer.output;else{let e=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(let o of t.sourceLayer.inboundNodes[r].outputTensors)if(o.id===t.id){e=r;break}n=t.sourceLayer.getOutputAt(e)}return n}var Nw=class t extends ze{constructor(n){if(super({}),this.containerNodes=new Set,this.name=n.name,this.name==null){let x=this.getClassName().toLowerCase();this.name=Rc(x)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(n.inputs)?this.inputs=n.inputs.slice():this.inputs=[n.inputs],Array.isArray(n.outputs)?this.outputs=n.outputs.slice():this.outputs=[n.outputs],Wo(this.inputs).length!==this.inputs.length)throw new $(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(x=>x.name)}`);Wo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(x=>x.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let x of this.outputs){let w=x.sourceLayer,b=x.nodeIndex,S=x.tensorIndex;this.outputLayers.push(w),this.outputLayersNodeIndices.push(b),this.outputLayersTensorIndices.push(S)}for(let x of this.inputs){let w=x.sourceLayer,b=x.nodeIndex,S=x.tensorIndex;vo(b===0,"input layer has >1 nodes"),vo(S===0,"input layer has >1 tensors"),this.inputLayers.push(w),this.inputLayersNodeIndices.push(b),this.inputLayersTensorIndices.push(S)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let x=0;x<this.inputLayers.length;x++){let w=this.inputLayers[x];if(!(w instanceof Ed))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${n.inputs}. Input ${x} (0-based) originates from layer type ${w.getClassName()}.`);this.inputNames.push(w.name),this.feedInputShapes.push(w.batchInputShape),this.feedInputNames.push(w.name)}for(let x of this.outputLayers)this.outputNames.push(x.name);this.internalInputShapes=this.inputs.map(x=>x.shape),this.internalOutputShapes=this.outputs.map(x=>x.shape);let e={},r={},o={},i={},s={},a=[],l=(x,w,b,S,E,D)=>{(S==null||E==null||D==null)&&(S=x.sourceLayer,E=x.nodeIndex,D=x.tensorIndex);let O=S.inboundNodes[E];if(b.indexOf(O)!==-1)throw new gr(`The tensor ${x.name} at layer "${S.name}" is part of a cycle.`);if(w.indexOf(O)!==-1)return;this.containerNodes.add(t.nodeKey(S,E)),S.id in s||(s[S.id]=Object.keys(s).length),b.indexOf(O)===-1&&b.push(O);let R=O.inboundLayers.length;for(let P=0;P<R;P++){let U=O.inputTensors[P],j=O.inboundLayers[P],W=O.nodeIndices[P],K=O.tensorIndices[P];l(U,w,b,j,W,K)}for(w.push(O);b.indexOf(O)>=0;)b.splice(b.indexOf(O),1);a.push(O)},c=[],u=[];for(let x of this.outputs)l(x,c,u);let d=a.slice().reverse();for(let x of d){r[x.id]=x,x.id in e||(e[x.id]=0);let w=e[x.id],b=o[x.outboundLayer.id]==null?0:o[x.outboundLayer.id];w=Math.max(w,b),o[x.outboundLayer.id]=w,i[x.outboundLayer.id]=x.outboundLayer,e[x.id]=w;for(let S=0;S<x.inboundLayers.length;S++){let E=x.inboundLayers[S],D=x.nodeIndices[S],O=E.inboundNodes[D],R=e[O.id]==null?0:e[O.id];e[O.id]=Math.max(w+1,R),r[O.id]=O}}let p={};for(let x in e){let w=e[x];w in p||(p[w]=[]),p[w].push(r[x])}let f={};for(let x in o){let w=o[x];w in f||(f[w]=[]),f[w].push(i[x])}let m=Object.keys(f).map(x=>parseInt(x,10)).sort(ay);this.layers=[];for(let x of m){let w=f[x];w.sort((b,S)=>{let E=s[b.id],D=s[S.id];return E<D?-1:E>D?1:0});for(let b of w)b instanceof t&&this.internalContainerRefs.push(b),this.layers.push(b)}this.layersByDepth=f,m=Object.keys(p).map(x=>parseInt(x,10)).sort(ay);let h=this.inputs.slice(),g=[];for(let x of m)for(let w of p[x]){let b=w.outboundLayer;if(b!=null){for(let S of w.inputTensors)if(h.indexOf(S)===-1)throw new gr(`Graph disconnected: cannot obtain value for tensor ${S} at layer "${b.name}". The following previous layers were accessed without issue: ${g}`);for(let S of w.outputTensors)h.push(S);g.push(b.name)}}this.nodesByDepth=p;let y=this.layers.map(x=>x.name);for(let x of y){let w=y.filter(b=>b===x).length;if(w!==1)throw new gr(`The name "${x}" is used ${w} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Ga({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(x=>null),outputMasks:this.outputs.map(x=>null),inputShapes:this.inputs.map(x=>x.shape),outputShapes:this.outputs.map(x=>x.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let n={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)n.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)n.numDisposedVariables+=e.dispose().numDisposedVariables}return n.refCountAfterDispose=this._refCount,n}get trainable(){return this.trainable_}set trainable(n){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=n)}),this.trainable_=n}get trainableWeights(){if(this._trainableWeights.length>0)throw new $("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let n=[];for(let e of this.layers)n=n.concat(e.trainableWeights);return n}get nonTrainableWeights(){let n=[];for(let e of this.layers)n.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(n)}return n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(n,e=!0){let r={},o=0;for(let s of this.layers)for(let a of s.weights){if(r[a.originalName]!=null)throw new $(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,o++}let i=[];for(let s in n){let a=s;if(r[s]==null){let l=s.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[a]!=null)i.push([r[a],n[s]]);else if(e)throw new $(`Provided weight data has no target variable: ${s}`);delete r[a]}if(e){let s=[];for(let a in r)s.push(a);if(s.length>0)throw new $(`${s.length} of ${o} weights are not set: ${s}`)}vm(i)}updatedConfig(){let n=this.getConfig(),e={};return e.className=this.getClassName(),e.config=n,e.kerasVersion=`tfjs-layers ${Im}`,e.backend="TensorFlow.js",e}toJSON(n,e=!0){let r=Dw(this.updatedConfig());return e?JSON.stringify(r):r}call(n,e){return z(()=>{n=Et(n);let r=new ss;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],n[o]);return Nd(this.outputs,r,e)})}computeMask(n,e){return z(()=>{n=Et(n);let r;return e==null?r=jo(null,n.length):r=Et(e),this.runInternalGraph(n,r)[1]})}computeOutputShape(n){let e=ym(n);if(e.length!==this.inputLayers.length)throw new $(`Invalid inputShape argument ${n}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],c=e[a],u=l.name+"_0_0";r[u]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(ay);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let c of l){let u=c.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(u.id)!==-1)continue;let d=[];for(let h=0;h<c.inboundLayers.length;h++){let g=c.inboundLayers[h],y=c.nodeIndices[h],x=c.tensorIndices[h],w=`${g.name}_${y}_${x}`,b=r[w];d.push(b)}let p=u.computeOutputShape(On(d)),f=ym(p),m=u.inboundNodes.indexOf(c);for(let h=0;h<f.length;h++){let g=`${u.name}_${m}_${h}`;r[g]=f[h]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){let l=s[a];vo(l in r),i.push(r[l])}return On(i)}runInternalGraph(n,e){e==null&&(e=jo(null,n.length));let r={};for(let l=0;l<this.inputs.length;++l){let c=this.inputs[l],u=n[l],d=e[l];r[c.id]=[u,d]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(ay);for(let l of o){let c=this.nodesByDepth[l];for(let u of c){let d=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,m=new Array;for(let h of p)h.id in r&&m.push(r[h.id]);if(m.length===p.length){let h={},g,y,x,w;if(u.callArgs!=null&&(h=u.callArgs),m.length===1){let[b,S]=m[0];h.mask==null&&(h.mask=S),x=Et(d.call(b,h)),w=Et(d.computeMask(b,S)),g=[b],y=[S]}else g=m.map(b=>b[0]),y=m.map(b=>b[1]),h.mask==null&&(h.mask=y),x=Et(d.call(g,h)),w=Et(d.computeMask(g,y));if(d.activityRegularizer)throw new _e("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let b=0;b<f.length;++b){let S=f[b],E=x[b],D=w[b];r[S.id]=[E,D]}}}}let i=[],s=[],a=[];for(let l of this.outputs){vo(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[c,u]=r[l.id];a.push(c.shape),i.push(c),s.push(u)}return[i,s,a]}buildNodeConversionMap(n){let e={},r;for(let o of this.layers){r=o instanceof t?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=t.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(n,e){if(e!=null){if(this.layers.length<=e)throw new $(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}else if(n==null)throw new $("Provide either a layer name or layer index");for(let r of this.layers)if(r.name===n)return r;throw new $(`No such layer: ${n}`)}calculateLosses(){return z(()=>{let n=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=t.nodeKey(e,r);this.containerNodes.has(o)&&n.push(...e.calculateLosses())}return n})}getConfig(){let n={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){let p=s.inboundNodes[d],f=t.nodeKey(s,d),m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){let h=[];for(let g=0;g<p.inboundLayers.length;g++){let y=p.inboundLayers[g],x=p.nodeIndices[g],w=p.tensorIndices[g],b=t.nodeKey(y,x),S=e[b];S==null&&(S=0),h.push([y.name,S,w,m])}c.push(h)}}}let u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}n.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.inputLayersTensorIndices[s];o.push([a.name,u,d])}n.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.outputLayersTensorIndices[s];i.push([a.name,u,d])}return n.outputLayers=i,n}static fromConfig(n,e,r={},o=!1){let i={},s={};function a(g,y){g.name in s?s[g.name].push(y):s[g.name]=[y]}function l(g,y){let x=[],w;for(let b of y){let S=b[0],E=b[1],D=b[2];if(w=b[3]==null?{}:b[3],!(S in i)){a(g,y);return}let O=i[S];if(O.inboundNodes.length<=E){a(g,y);return}let R=O.inboundNodes[E];x.push(R.outputTensors[D])}x.length>0&&g.apply(On(x),w)}function c(g){let y=g.name,x=Rr(g,e.customObjects!=null?e.customObjects:{});x.setFastWeightInitDuringBuild(o),i[y]=x,g.inboundNodes.forEach(b=>{if(!(b instanceof Array))throw new $(`Corrupted configuration, expected array for nodeData: ${b}`);a(x,b)})}let u=e.name,d=e.layers;for(let g of d)c(g);for(;!wB(s);)for(let g of d){let y=i[g.name];if(y.name in s){let x=s[y.name];delete s[y.name];for(let w of x)l(y,w)}}let p=[],f=[],m=e.inputLayers;for(let g of m){let y=g[0],x=g[1],w=g[2];vo(y in i);let S=i[y].inboundNodes[x].outputTensors;p.push(S[w])}let h=e.outputLayers;for(let g of h){let y=g[0],x=g[1],w=g[2];vo(y in i);let S=i[y].inboundNodes[x].outputTensors;f.push(S[w])}return new n({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new $("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let n of this.layers)if(n.stateful)return!0;return!1}resetStates(){z(()=>{this.layers.forEach(n=>{n.stateful&&n.resetStates()})})}};function yue(t,n,e){let r=n.length;if(t==null||Array.isArray(t)&&t.length===0)return n.map(o=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&n[0]in t?[t[n[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${e} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return n.forEach(i=>{i in t?o.push(t[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${n} keys. Provided ${e} not understood: ${JSON.stringify(t)}`)}function kw(t,n){return yue(t,n,"classWeight")}async function Aw(t,n,e,r){if(n!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=z(()=>{if(t.shape.length===1)return t.clone();if(t.shape.length===2){if(t.shape[1]>1)return t.argMax(1);if(t.shape[1]===1)return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await o.data());Oe(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),zo(s,"float32")}else return null}function hz(t,n){return L(t,n)}var xue=32;function xz(t,n){let e,r,o=n;e=o.xs,r=o.ys,v.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${n}`);let i=gz("input",t.inputNames,e),s=gz("output",t.outputNames,r),a=i[0].shape[0];v.assert(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),v.assert(s.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)v.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<s.length;l++)v.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:s}}function gz(t,n,e){if(e instanceof ct)return[e];if(Array.isArray(e))return v.assert(e.length===n.length,()=>`Received an array of ${e.length} Tensors, but expected ${n.length} to match the ${t} keys ${n}.`),e;{let r=[];for(let o of n){if(e[o]==null)throw new $(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);r.push(e[o])}return r}}function vue(t){if(t.length===3)throw new _e("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function vz(t,n,e){let r=e.batchesPerEpoch!=null;if(v.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),v.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),v.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),v.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),v.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(yz(e.validationData))v.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=vue(e.validationData);i=g.xs,s=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();let u=vw(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:p,history:f}=bw(u,d,e.epochs,null,null,bue(n,e),null,o,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,h=await n.iterator();for(;m<e.epochs;){let g={};await p.onEpochBegin(m);let y=0,x=0;for(r||(h=await n.iterator());!r||y<e.batchesPerEpoch;){let w=await h.next();if(r&&w.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(w.value!=null){let{xs:b,ys:S}=xz(t,w.value),E={};E.batch=x,E.size=b[0].shape[0],await p.onBatchBegin(x,E);let D=[];if(e.classWeight!=null){let P=kw(e.classWeight,t.outputNames);for(let U=0;U<P.length;++U)D.push(await Aw(S[U],null,P[U]))}let O=b.concat(S).concat(D),R=a(O);Oe(O);for(let P=0;P<l.length;++P){let U=l[P],j=R[P];E[U]=j,An(j)}await p.onBatchEnd(x,E),hw(E),x++,y++}if(r?y>=e.batchesPerEpoch:w.done){if(o){let b;yz(e.validationData)?b=Et(await t.evaluateDataset(e.validationData,{batches:e.validationBatches})):b=Et(t.evaluate(i,s,{batchSize:e.validationBatchSize==null?xue:e.validationBatchSize,verbose:0}));for(let S=0;S<t.metricsNames.length;++S)g[`val_${t.metricsNames[S]}`]=b[S]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,g),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function bue(t,n){let e=null;return n.batchesPerEpoch!=null?e=n.batchesPerEpoch:Number.isFinite(t.size)&&(e=t.size),e}function yz(t){return typeof t.iterator=="function"}function wue(t){return typeof t.next=="function"}async function bz(t,n,e){e=e||{};let r=e.batches!=null,o=t.testFunction,i=[];if(e.verbose>0)throw new _e("Verbose mode is not implemented yet.");v.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=wue(n)?n:await n.iterator(),a=0,l=0;for(;!r||l<e.batches;){let c=await s.next();if(i=z(()=>{if(c.value){let{xs:u,ys:d}=xz(t,c.value),p=u.concat(d),f=z(()=>o(p));if(Oe(p),l===0)for(let h=0;h<f.length;++h)i.push(Ne(0));let m=p[0].shape[0];for(let h=0;h<f.length;++h){let g=f[h],y=i[h];i[h]=z(()=>ee(i[h],L(m,g))),l>0&&Oe(y)}Oe(f),a+=m,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){let u=i[c];i[c]=pe(i[c],a),Oe(u)}return On(i)}function Rw(t){v.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Sm(t,n,e){return t==null?[null]:Array.isArray(t)?t.map(r=>za(r,n,e-n)):za(t,n,e-n)}function Ow(t,n){return z(()=>t==null?null:Array.isArray(t)?t.map(e=>Ow(e,n)):cw(t,n.dtype==="int32"?n:n.toInt()))}function Mw(t,n){let e=[],r=0,o=null;for(;r<t;)o=r+n,o>=t&&(o=t),e.push([r,o]),r=o;return e}async function Cue(t,n,e,r,o,i,s,a,l,c,u,d,p,f,m){o==null&&(o=32),i==null&&(i=1),u==null&&(u=!0),p==null&&(p=0);let h=!1;if(l!=null&&c!=null&&(h=!0),m!=null&&(h=!0,f==null))throw new $("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=t.checkNumSamples(e,o,f,"steps_per_epoch"),y;g!=null&&(y=lr(0,g)),s==null&&(s=1);let{callbackList:x,history:w}=bw(a,s,i,p,g,f,o,h,d);x.setModel(t),t.history=w,await x.onTrainBegin(),t.stopTraining_=!1;for(let b=p;b<i;++b){await x.onEpochBegin(b);let S={};if(f!=null)throw new _e("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new _e("batch shuffling is not implemneted yet");u&&v.shuffle(y);let E=zo(y),D=Mw(g,o);for(let O=0;O<D.length;++O){let R={};if(await x.onBatchBegin(O,R),z(()=>{let P=D[O][0],U=D[O][1],j=za(E,P,U-P);R.batch=O,R.size=U-P;let W=Ow(e,j),K=n(W);for(let H=0;H<r.length;++H){let Y=r[H],ne=K[H];R[Y]=ne,An(ne)}if(O===D.length-1&&h){let H=t.testLoop(l,c,o);for(let Y=0;Y<r.length;++Y){let ne=r[Y],J=H[Y];An(J),S["val_"+ne]=J}}}),await x.onBatchEnd(O,R),hw(R),t.stopTraining_)break}E.dispose()}if(await x.onEpochEnd(b,S),t.stopTraining_)break}return await x.onTrainEnd(),await t.history.syncData(),t.history}async function wz(t,n,e,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;let o,i,s,a,l,c,u;try{let d=r.batchSize==null?32:r.batchSize;Rw(d);let f=await t.standardizeUserData(n,e,r.sampleWeight,r.classWeight,!1,d);o=f[0],i=f[1],u=f[2];let m=!1,h;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)s=r.validationData[0],a=r.validationData[1];else throw r.validationData.length===3?new _e("validationData including sample weights is not supported yet."):new $(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);let O=await t.standardizeUserData(s,a,null,null,!0,d);l=O[0],c=O[1],h=l.concat(c)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;let D=Math.floor(o[0].shape[0]*(1-r.validationSplit)),O=o[0].shape[0];l=Sm(o,D,O),o=Sm(o,0,D),c=Sm(i,D,O),i=Sm(i,0,D),h=l.concat(c)}else r.validationSteps!=null&&(m=!0);let g=o.concat(i).concat(u);t.checkTrainableWeightsConsistency();let y=t.makeTrainFunction(),x=t.getDedupedMetricsNames(),w,b;m?(t.makeTestFunction(),w=t.testFunction,b=x.slice().concat(x.map(D=>"val_"+D))):(w=null,h=[],b=x.slice());let S=vw(r.callbacks,r.yieldEvery);return await Cue(t,y,g,x,d,r.epochs,r.verbose,S,w,h,r.shuffle,b,r.initialEpoch,null,null)}finally{t.isTraining=!1,Mc(o,n),Mc(i,e),Mc(l,s),Mc(c,a),u!=null&&Oe(u)}}function uN(t){let n=[];t instanceof ct&&(t=[t]);for(let e=0;e<t.length;++e){let r=t[e];if(r.rank===1)n.push(ja(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(r)}}return n}function Mc(t,n){if(t==null)return;let e=[];if(n instanceof ct)e.push(n.id);else if(Array.isArray(n))n.forEach(o=>e.push(o.id));else if(n!=null)for(let o in n){let i=n[o];e.push(i.id)}let r=[];if(t instanceof ct)e.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(t!=null)for(let o in t){let i=t[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function Iue(t){return t instanceof ct}function dN(t){return Array.isArray(t)}function Cz(t){return!Iue(t)&&!dN(t)}function Iz(t,n,e,r=!0,o=""){if(n==null||n.length===0){if(t!=null){let s=!1;if(dN(t)&&t.length>0)s=!0;else if(Cz(t)){for(let a in t)if(t.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new $(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return n.map(s=>null);let i;if(Cz(t)){t=t,i=[];for(let s of n){if(t[s]==null)throw new $(`No data provided for "${s}". Need data for each key in: ${n}`);i.push(t[s])}}else if(dN(t)){if(t=t,t.length!==n.length)throw new $(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${n.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,n.length>1)throw new $(`The model ${o} expects ${n.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=uN(i),e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new $(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u>=0&&c!==u)throw new $(`Error when checking ${o}: expected ${n[s]} to have shape [${e[s]}], but got array with shape [${a.shape}].`)}}return i}function Sue(t,n,e){let r=Wo(t.map(i=>i.shape[0]));r.sort();let o=Wo(n.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new $(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(o.length>1)throw new $(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!v.arraysEqual(r,o))throw new $(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function Tue(t,n,e){let r=[_d,wm,Dd];for(let o=0;o<t.length;++o){let i=t[o],s=n[o],a=e[o];if(s!=null){if(s===Dd&&i.shape[i.shape.length-1]===1)throw new $(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){let d=l[u],p=c[u];if(p!=null&&d!==p)throw new $(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Sz(t,n,e,r=!0,o=""){let i;if(Array.isArray(t)){if(t.length!==n.length)throw new $(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${n.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(n.length>1)throw new $(`The model expects ${n.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new $(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u!==c)throw new $(`Error when checking ${o}: expected ${n[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Eue(t,n){if(t==null||Array.isArray(t)&&t.length===0)return n.map(r=>[]);let e;if(typeof t=="string"||typeof t=="function")e=[t];else if(Array.isArray(t)||typeof t=="object")e=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(e))return n.map(r=>e);{let r=[];for(let o of n){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var _ue="layers-model",Ha=(()=>{class t extends Nw{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new $("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");dz(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=uz(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Yn))throw new $("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new $(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(Cw(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new $(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>Cw(l))}else{let a=Cw(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ci("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=Eue(e.metrics,this.outputNames),s=(a,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,a])};Ci("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(u=>{let d="",p,f,m;for(let h of u){if(typeof h=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(h)!==-1){let y=this.internalOutputShapes[a];y[y.length-1]===1||this.lossFunctions[a]===wm?["accuracy","acc"].indexOf(h)!==-1?f=Sw:["crossentropy","ce"].indexOf(h)!==-1&&(f=oN):this.lossFunctions[a]===bm?["accuracy","acc"].indexOf(h)!==-1?f=iN:["crossentropy","ce"].indexOf(h)!==-1&&(f=sN):["accuracy","acc"].indexOf(h)!==-1?f=Tw:["crossentropy","ce"].indexOf(h)!==-1&&(f=Ew);let x;["accuracy","acc"].indexOf(h)!==-1?x="acc":["crossentropy","ce"].indexOf(h)!==-1&&(x="ce"),m=f,p=d+x}else m=lz(h),p=d+gy(h);let g;Ci(p,()=>{g=m}),s(a,p,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;Rw(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,u=this.testLoop(c,l,i,o.verbose,o.steps);return On(u)}finally{Mc(a[0],e),Mc(a[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),bz(this,e,r)}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new $(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new $(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new $("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new ss;if(e instanceof ct&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new $(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let u=e[c.name];if(u==null)throw new $(`No value is provided for the model's input ${c.name}`);a.add(c,u)}let l=Nd(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=jo(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let c=a.indexOf(e[l]);if(c!==-1&&(r[l]=s[c],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new $(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return z(()=>{let i=this.checkNumSamples(e);if(o)throw new _e("Verbose predictLoop() is not implemented yet.");let s=Mw(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)z(()=>{let u=s[l][0],d=s[l][1],p=Sm(e,u,d),f=[];if(Array.isArray(p))for(let h=0;h<p.length;++h)f.push({key:this.inputs[h],value:p[h]});else f.push({key:this.inputs[0],value:p});let m=new ss(f);return Nd(this.outputs,m)}).forEach((u,d)=>a[d].push(u));return On(a.map(l=>$t(l,0)))})}predict(e,r={}){let o=uN(e);Sz(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return Rw(i),this.predictLoop(o,i)}finally{Mc(o,e)}}predictOnBatch(e){Sz(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new gr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===bm?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=Iz(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=Iz(r,this.feedOutputNames,s,!1,"target"),Sue(e,r,null),Tue(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new $(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,o,i,s=!0,a){let[l,c]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(i!=null){let d=kw(i,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(await Aw(c[p],null,d[p]))}return[l,c,u]}testLoop(e,r,o,i=0,s){return z(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new _e("Verbose mode is not implemented yet.");if(s!=null)throw new _e("steps mode in testLoop() is not implemented yet");{let c=Mw(a,o),u=zo(lr(0,a));for(let d=0;d<c.length;++d){let p=c[d][0],f=c[d][1],m=za(u,p,f-p),h=Ow(r,m),g=e(h);if(d===0)for(let y=0;y<g.length;++y)l.push(Ne(0));for(let y=0;y<g.length;++y){let x=g[y];l[y]=ee(l[y],L(f-p,x))}}for(let d=0;d<l.length;++d)l[d]=pe(l[d],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(jD(e,i)>1){let a=jD(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let p=[];for(let g=0;g<this.inputs.length;++g)p.push({key:this.inputs[g],value:o[g]});let f=new ss(p),m=Nd(this.outputs,f,{training:!0}),h;for(let g=0;g<this.lossFunctions.length;++g){let y=this.lossFunctions[g],x=y(i[g],m[g]);s[g]!=null&&(x=hz(x,s[g]));let w=jt(x);r.push(w),g===0?h=x:h=ee(h,x)}for(let g=0;g<this.metricsTensors.length;++g){let y;if(this.outputs.length>1&&g<this.outputs.length)y=r[g];else{let x=this.metricsTensors[g][0],w=this.metricsTensors[g][1];y=jt(x(i[w],m[w]))}An(y),a.push(y)}return h=jt(h),this.calculateLosses().forEach(g=>{h=ee(h,g)}),h},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>z(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:i[u]});let l=new ss(a),c=Nd(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],p=jt(d(s[u],c[u]));u===0?o=p:o=ee(o,p),r.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=jt(d(s[p],c[p]));r.push(f)}return r})}async fit(e,r,o={}){return wz(this,e,r,o)}async fitDataset(e,r){return vz(this,e,r)}async trainOnBatch(e,r){let o=await this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),c=[];for(let u of l){let d=await u.data();c.push(d[0])}return Oe(l),On(c)}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=zg().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-zg().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Go(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>Go(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=Go(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Go(gy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Go(gy(e)));{let e={};for(let r in this.metrics)e[r]=Go(gy(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=Cm(e.optimizer_config),o=Rr(r),i;if(typeof e.loss=="string")i=Ba(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>Ba(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=Ba(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>Ba(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=Ba(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}async save(e,r){if(typeof e=="string"){let u=Po.getSaveHandlers(e);if(u.length===0)throw new $(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new $(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new $("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=await Po.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:_ue,generatedBy:`TensorFlow.js tfjs-layers v${Im}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:d,specs:p}=await Po.encodeWeights(await this.optimizer.getWeights(),u);o.specs.push(...p),o.data=Po.concatenateArrayBuffers([o.data,d])}return this.userDefinedMetadata!=null&&(lN(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)}setUserDefinedMetadata(e){lN(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return t.className="Model",t})();Z.registerClass(Ha);var Due=(()=>{class t extends Ha{}return t.className="Functional",t})();Z.registerClass(Due);async function Tz(t,n){if(n==null&&(n={}),typeof t=="string"){let e=Po.getLoadHandlers(t,n);if(e.length===0)e.push(Po.browserHTTPRequest(t,n));else if(e.length>1)throw new $(`Found more than one (${e.length}) load handlers for URL '${t}'`);t=e[0]}return Nue(t,void 0,n)}async function Nue(t,n,e){if(e==null&&(e={}),t.load==null)throw new $("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await t.load(),o=r.modelTopology;o.model_config!=null&&(o=o.model_config);let i=e.strict==null?!0:e.strict,s=r.weightData!=null&&r.weightSpecs!=null&&i,a=Rr(Cm(o),n,s),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new $("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:c,optimizerWeights:u}=kue(r.weightData,r.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Oe(c),Oe(u.map(d=>d.tensor))}return a}function kue(t,n){let e=Po.decodeWeights(t,n),r={},o=[];return n.forEach(i=>{i.group==="optimizer"?o.push({name:i.name,tensor:e[i.name]}):r[i.name]=e[i.name]}),{modelWeights:r,optimizerWeights:o}}var pN=(()=>{class t extends Ha{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Rc("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new $(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof t||e instanceof Ha,o;if(r){if(o=e,o.outputs.length!==1)throw new $("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new $("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new $("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=nN({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new $(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new $("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=tN(this.outputs[0])}this.inboundNodes=[],new Ga({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:jo(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Ze(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ha({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}async evaluateDataset(e,r){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,o={}){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.fit(e,r,o)}async fitDataset(e,r){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new $("Legacy serialization format not supported yet.");s=r}else v.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof t))throw new _e(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=Rr(c,void 0,i);i&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new $("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new $("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return t.className="Sequential",t})();Z.registerClass(pN);function fN(t,n){return n==null&&(n={}),Tz(t,n)}var ur=class extends Z.Serializable{getConfig(){return{}}},Aue=(()=>{class t extends ur{apply(e,r=1){return jB(e,r)}}return t.className="elu",t})();Z.registerClass(Aue);var Rue=(()=>{class t extends ur{apply(e){return Zg(e)}}return t.className="selu",t})();Z.registerClass(Rue);var Oue=(()=>{class t extends ur{apply(e){return Bo(e)}}return t.className="relu",t})();Z.registerClass(Oue);var Mue=(()=>{class t extends ur{apply(e){return z(()=>dd(6,Bo(e)))}}return t.className="relu6",t})();Z.registerClass(Mue);var Fue=(()=>{class t extends ur{apply(e){return e}}return t.className="linear",t})();Z.registerClass(Fue);var Pue=(()=>{class t extends ur{apply(e){return $o(e)}}return t.className="sigmoid",t})();Z.registerClass(Pue);var $ue=(()=>{class t extends ur{apply(e){return WB(e)}}return t.className="hardSigmoid",t})();Z.registerClass($ue);var Lue=(()=>{class t extends ur{apply(e){return ts(e)}}return t.className="softplus",t})();Z.registerClass(Lue);var Vue=(()=>{class t extends ur{apply(e){return GB(e)}}return t.className="softsign",t})();Z.registerClass(Vue);var Bue=(()=>{class t extends ur{apply(e){return em(e)}}return t.className="tanh",t})();Z.registerClass(Bue);var hN=(()=>{class t extends ur{apply(e,r=-1){return hd(e,r)}}return t.className="softmax",t})();Z.registerClass(hN);var zue=(()=>{class t extends ur{apply(e,r=-1){return qg(e,r)}}return t.className="logSoftmax",t})();Z.registerClass(zue);var Uue=(()=>{class t extends ur{apply(e,r=1){return z(()=>$o(e.mul(r)).mul(e))}}return t.className="swish",t})();Z.registerClass(Uue);var jue=(()=>{class t extends ur{apply(e){return z(()=>L(e,em(ts(e))))}}return t.className="mish",t})();Z.registerClass(jue);function Si(t){return t.getClassName()}function mN(t,n={}){return os(t,Z.SerializationMap.getMap().classNameMap,n,"activation")}function Ti(t){if(t==null){let n={};return n.className="linear",n.config={},mN(n)}if(typeof t=="string"){let n={};return n.className=t,n.config={},mN(n)}else return t instanceof ur?t:mN(t)}function Gue(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var Fw=class extends Z.Serializable{},Dz=(()=>{class t extends Fw{constructor(e){super(),Gue(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return z(()=>{let r=Lt([1]);return this.hasL1&&(r=ee(r,ve(L(this.l1,bn(e))))),this.hasL2&&(r=ee(r,ve(L(this.l2,Td(e))))),r.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return t.className="L1L2",t})();Z.registerClass(Dz);var Ez={l1l2:"L1L2"};function xt(t){return fm(t)}function _z(t,n={}){return os(t,Z.SerializationMap.getMap().classNameMap,n,"regularizer")}function Dt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in Ez?Ez[t]:t,config:{}};return _z(e)}else return t instanceof Fw?t:_z(t)}var Nz=(()=>{class t extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=Le(e);let o=Bo(e);return this.maxValue!=null&&(o=Vn(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ReLU",t})();Z.registerClass(Nz);var kz=(()=>{class t extends ze{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Le(e);return cd(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LeakyReLU",t})();Z.registerClass(kz);var Az=(()=>{class t extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=St(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Dt(e.alphaRegularizer),this.alphaConstraint=Zt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new $(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ze(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new _t({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=Le(e),fd(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Rt(this.alphaInitializer),alphaRegularizer:xt(this.alphaRegularizer),alphaConstraint:Yt(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return t.className="PReLU",t})();Z.registerClass(Az);var Rz=(()=>{class t extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new _e(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Le(e);return $a(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ELU",t})();Z.registerClass(Rz);var Oz=(()=>{class t extends ze{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=Le(e);return o.mul(Ua(o.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ThresholdedReLU",t})();Z.registerClass(Oz);var Mz=(()=>{class t extends ze{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new hN().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let o=Le(e);return this.softmax(o,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Softmax",t})();Z.registerClass(Mz);function Fc(t,n,e){if(typeof t=="number")return jo(t,n);if(t.length!==n)throw new $(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${t.length} elements.`);for(let r=0;r<n;++r){let o=t[r];if(!LB(o))throw new $(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Or(t,n,e,r,o=1){if(t==null)return t;let i=n+(n-1)*(o-1),s;return e==="same"?s=t:s=t-i+1,Math.floor((s+r-1)/r)}function Ei(t,n,e,r){if(t==null)return null;if(r==="valid")t=t*n+Ii([e-n,0]);else if(r==="same")t=t*n;else throw new $(`Unsupport padding mode: ${r}.`);return t}function xy(t,n){return z(()=>(Gt(n),n==="channelsFirst"?rt(t,[0,2,3,1]):t))}function gN(t,n){return z(()=>(Gt(n),n==="channelsFirst"?rt(t,[0,2,3,4,1]):t))}function Hue(t,n,e,r=1,o="valid",i,s=1){return z(()=>{if(i==null&&(i=hr()),Gt(i),t.shape.length!==3)throw new $(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(n.shape.length!==3)throw new $(`The kernel for a conv1dWithBias operation should be 3, but is ${n.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new $(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=rt(t,[0,2,1])),o==="causal")throw new _e("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=jg(t,n,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=xr(a,e)),a})}function Fz(t,n,e,r=[1,1],o="valid",i,s,a=null){return z(()=>{if(i==null&&(i=hr()),Gt(i),t.rank!==3&&t.rank!==4)throw new $(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(n.rank!==3&&n.rank!==4)throw new $(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=xy(t,i);if(o==="causal")throw new _e("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=wd.conv2d({x:l,filter:n,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=rt(l,[0,3,1,2])),l})}function que(t,n,e,r=[1,1,1],o="valid",i,s){return z(()=>{if(i==null&&(i=hr()),Gt(i),t.rank!==4&&t.rank!==5)throw new $(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(n.rank!==4&&n.rank!==5)throw new $(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=gN(t,i);if(o==="causal")throw new _e("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=X1(a,n,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=xr(a,e)),i==="channelsFirst"&&(a=rt(a,[0,4,1,2,3])),a})}var yy=class t extends ze{constructor(n,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(e),this.rank=n,an(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new _e(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Fc(e.kernelSize,n,"kernelSize"),this.strides=Fc(e.strides==null?1:e.strides,n,"strides"),this.padding=e.padding==null?"valid":e.padding,yr(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),this.activation=Ti(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=St(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Zt(e.biasConstraint),this.biasRegularizer=Dt(e.biasRegularizer),this.activityRegularizer=Dt(e.activityRegularizer),this.dilationRate=Fc(e.dilationRate==null?1:e.dilationRate,n,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new $(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new $(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new $(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(n){if(vo("kernelSize"in n,"required key 'kernelSize' not in config"),typeof n.kernelSize!="number"&&!rw(n.kernelSize,"number",1,3))throw new $(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(n.kernelSize)}.`)}getConfig(){let n={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Si(this.activation),useBias:this.useBias,biasInitializer:Rt(this.biasInitializer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),biasConstraint:Yt(this.biasConstraint)},e=super.getConfig();return Object.assign(n,e),n}},Tm=class t extends yy{constructor(n,e){super(n,e),this.kernel=null,t.verifyArgs(e),this.filters=e.filters,an(this.filters,"filters"),this.kernelInitializer=St(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Zt(e.kernelConstraint),this.kernelRegularizer=Dt(e.kernelRegularizer)}build(n){n=Ze(n);let e=this.dataFormat==="channelsFirst"?1:n.length-1;if(n[e]==null)throw new $(`The channel dimension of the input should be defined. Found ${n[e]}`);let r=n[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(n,e){return z(()=>{n=Le(n);let r,o=this.bias==null?null:this.bias.read(),i=ow(this.activation.getClassName());if(i!=null&&this.rank===2)r=Fz(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=Hue(n,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=Fz(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=que(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new _e("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(n){n=Ze(n);let e=[],r=this.dataFormat==="channelsLast"?n.slice(1,n.length-1):n.slice(2);for(let i=0;i<r.length;++i){let s=Or(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[n[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let n={filters:this.filters,kernelInitializer:Rt(this.kernelInitializer),kernelRegularizer:xt(this.kernelRegularizer),kernelConstraint:Yt(this.kernelConstraint)},e=super.getConfig();return Object.assign(n,e),n}static verifyArgs(n){if(!("filters"in n)||typeof n.filters!="number"||n.filters<1)throw new $(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(n.filters)}`)}},yN=(()=>{class t extends Tm{constructor(e){super(2,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!rw(e.kernelSize,"number",1,2))throw new $(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv2D",t})();Z.registerClass(yN);var xN=(()=>{class t extends Tm{constructor(e){super(3,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new $(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv3D",t})();Z.registerClass(xN);var Pz=(()=>{class t extends yN{constructor(e){if(super(e),this.inputSpec=[new _t({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new $(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ze(e),e.length!==4)throw new $("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new $("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new _t({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{let o=Le(e);if(o.shape.length!==4)throw new $(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let c=i[a],u=i[l],d=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],m=this.strides[1],h=Ei(c,f,d,this.padding),g=Ei(u,m,p,this.padding),y=[s,h,g,this.filters];this.dataFormat!=="channelsLast"&&(o=rt(o,[0,2,3,1]));let x=Gg(o,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=rt(x,[0,3,1,2])),this.bias!=null&&(x=xr(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=Ze(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return r[o]=this.filters,r[i]=Ei(r[i],c,a,this.padding),r[s]=Ei(r[s],u,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv2DTranspose",t})();Z.registerClass(Pz);var $z=(()=>{class t extends xN{constructor(e){if(super(e),this.inputSpec=[new _t({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new $(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ze(e),e.length!==5)throw new $("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new $("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new _t({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{let o=Le(e);if(o.shape.length!==5)throw new $(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,c;this.dataFormat==="channelsFirst"?(c=2,a=3,l=4):(c=1,a=2,l=3);let u=i[c],d=i[a],p=i[l],f=this.kernelSize[0],m=this.kernelSize[1],h=this.kernelSize[2],g=this.strides[0],y=this.strides[1],x=this.strides[2],w=Ei(u,g,f,this.padding),b=Ei(d,y,m,this.padding),S=Ei(p,x,h,this.padding),E=[s,w,b,S,this.filters];this.dataFormat!=="channelsLast"&&(o=rt(o,[0,2,3,4,1]));let D=Y1(o,this.kernel.read(),E,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=rt(D,[0,4,1,2,3])),this.bias!==null&&(D=xr(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=Ze(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],f=this.strides[2];return r[o]=this.filters,r[i]=Ei(r[i],d,l,this.padding),r[s]=Ei(r[s],p,c,this.padding),r[a]=Ei(r[a],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv3DTranspose",t})();Z.registerClass($z);var Kue=(()=>{class t extends Tm{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new $("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new $("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new $(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=St(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Dt(r.depthwiseRegularizer),this.depthwiseConstraint=Zt(r.depthwiseConstraint),this.pointwiseInitializer=St(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Dt(r.pointwiseRegularizer),this.pointwiseConstraint=Zt(r.pointwiseConstraint)}build(e){if(e=Ze(e),e.length<this.rank+2)throw new $(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new $(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new _t({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{e=Le(e);let o;if(this.rank===1)throw new _e("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=rt(e,[0,2,3,1])),o=Qg(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=xr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=rt(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Rt(this.depthwiseInitializer),e.pointwiseInitializer=Rt(this.pointwiseInitializer),e.depthwiseRegularizer=xt(this.depthwiseRegularizer),e.pointwiseRegularizer=xt(this.pointwiseRegularizer),e.depthwiseConstraint=Yt(this.depthwiseConstraint),e.pointwiseConstraint=Yt(this.pointwiseConstraint),e}}return t.className="SeparableConv",t})(),Lz=(()=>{class t extends Kue{constructor(e){super(2,e)}}return t.className="SeparableConv2D",t})();Z.registerClass(Lz);var Vz=(()=>{class t extends Tm{constructor(e){super(1,e),t.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!rw(e.kernelSize,"number",1,1))throw new $(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv1D",t})();Z.registerClass(Vz);var Bz=(()=>{class t extends ze{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return z(()=>{if(e=Le(e),this.dataFormat==="channelsLast"){let o=cy(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return cy(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=cy(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return cy(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Cropping2D",t})();Z.registerClass(Bz);var zz=(()=>{class t extends ze{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,PB(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return z(()=>{let o=Le(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=rt(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a]);return rt(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="UpSampling2D",t})();Z.registerClass(zz);function Xue(t,n,e=[1,1],r="valid",o,i){return z(()=>{o==null&&(o=hr()),Gt(o);let s=xy(t,o);if(t.rank!==4)throw new $(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(n.rank!==4)throw new $(`depthwiseKernel is required to be 4-D, but is instead ${n.rank}-D`);return s=Pa(s,n,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=rt(s,[0,3,1,2])),s})}var Uz=(()=>{class t extends yy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=St(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Zt(e.depthwiseConstraint),this.depthwiseRegularizer=Dt(e.depthwiseRegularizer)}build(e){if(e=Ze(e),e.length<4)throw new $(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new $(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{e=Le(e);let o=Xue(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=xr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=Ze(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=Or(r,this.kernelSize[0],this.padding,this.strides[0]),a=Or(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Rt(this.depthwiseInitializer),e.depthwiseRegularizer=xt(this.depthwiseRegularizer),e.depthwiseConstraint=Yt(this.depthwiseRegularizer),e}}return t.className="DepthwiseConv2D",t})();Z.registerClass(Uz);function vN(t,n,e,r){if(Array.isArray(t)){if(n!=null||e!=null)throw new $("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(n=t.slice(1,t.length)),t=t[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return n=o(n),e=o(e),{inputs:t,initialState:n,constants:e}}function bN(t,n,e,r=!1,o,i,s=!1,a=!1){return z(()=>{let l=n.shape.length;if(l<3)throw new $(`Input should be at least 3D, but is ${l}D.`);let c=[1,0].concat(lr(2,l));if(n=rt(n,c),i!=null)throw new _e("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=o.asType("bool").asType("float32"),o.rank===l-1&&(o=Kn(o,-1)),o=rt(o,c)),r&&(n=yo(n,0),o!=null&&(o=yo(o,0)));let u=[],d,p=e,f=n.shape[0],m=Ar(n),h;o!=null&&(h=Ar(o));for(let y=0;y<f;++y){let x=m[y],w=z(()=>t(x,p));if(o==null)d=w[0],p=w[1];else{let b=z(()=>{let S=h[y],E=Rn(S).sub(S),D=w[0].mul(S).add(p[0].mul(E)),O=p.map((R,P)=>w[1][P].mul(S).add(R.mul(E)));return{output:D,newStates:O}});d=b.output,p=b.newStates}a&&u.push(d)}let g;return a&&(g=Xn(u,1)),[d,g,p]})}var $c=(()=>{class t extends ze{constructor(e){super(e);let r;if(e.cell==null)throw new $("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new IN({cells:e.cell}):r=e.cell,r.stateSize==null)throw new $("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new _t({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return lr(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){mw(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return z(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new _e("Constants support is not implemented in RNN yet.");mw(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new _t({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!v.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new $(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new _t({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){z(()=>{if(!this.stateful)throw new xo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new $("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Lt([o,i])):this.states_=[Lt([o,this.cell.stateSize])];else if(e==null)Oe(this.states_),this.keptStates!=null&&(Oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Lt([o,i])):this.states_[0]=Lt([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new $(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Oe(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!v.arraysEqual(s.shape,l))throw new $(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>An(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=vN(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new _t({shape:u.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof cr){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return z(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=Le(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new $(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},u=bN((h,g)=>{let y=this.cell.call([h].concat(g),l);return[y[0],y.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),d=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,i);let m=this.returnSequences?p:d;return this.returnState?[m].concat(f):m})}getInitialState(e){return z(()=>{let r=Lt(e.shape);return r=ve(r,[1,2]),r=ja(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?lw(r,[1,o]):r):this.cell.stateSize>1?[lw(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===t.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign({},o,e,r)}static fromConfig(e,r,o={}){let i=r.cell,s=Rr(i,o);return new e(Object.assign(r,{cell:s}))}}return t.className="RNN",t})();Z.registerClass($c);var Pc=class extends ze{},wN=(()=>{class t extends Pc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,an(this.units,"units"),this.activation=Ti(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=St(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=St(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=St(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Dt(e.kernelRegularizer),this.recurrentRegularizer=Dt(e.recurrentRegularizer),this.biasRegularizer=Dt(e.biasRegularizer),this.kernelConstraint=Zt(e.kernelConstraint),this.recurrentConstraint=Zt(e.recurrentConstraint),this.biasConstraint=Zt(e.biasConstraint),this.dropout=Sd([1,Ii([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Sd([1,Ii([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ze(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{if(e=e,e.length!==2)throw new $(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=qa({ones:()=>Rn(e),rate:this.dropout,training:i})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=qa({ones:()=>Rn(o),rate:this.recurrentDropout,training:i}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=qo(L(e,a),this.kernel.read()):s=qo(e,this.kernel.read()),this.bias!=null&&(s=xr(s,this.bias.read())),l!=null&&(o=L(o,l));let c=ee(s,qo(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Si(this.activation),useBias:this.useBias,kernelInitializer:Rt(this.kernelInitializer),recurrentInitializer:Rt(this.recurrentInitializer),biasInitializer:Rt(this.biasInitializer),kernelRegularizer:xt(this.kernelRegularizer),recurrentRegularizer:xt(this.recurrentRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,r)}}return t.className="SimpleRNNCell",t})();Z.registerClass(wN);var jz=(()=>{class t extends $c{constructor(e){e.cell=new wN(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return t.className="SimpleRNN",t})();Z.registerClass(jz);var CN=(()=>{class t extends Pc{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new $("GRUCell does not support reset_after parameter set to true.");this.units=e.units,an(this.units,"units"),this.activation=Ti(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Ti(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=St(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=St(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=St(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Dt(e.kernelRegularizer),this.recurrentRegularizer=Dt(e.recurrentRegularizer),this.biasRegularizer=Dt(e.biasRegularizer),this.kernelConstraint=Zt(e.kernelConstraint),this.recurrentConstraint=Zt(e.recurrentConstraint),this.biasConstraint=Zt(e.biasConstraint),this.dropout=Sd([1,Ii([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Sd([1,Ii([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ze(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{if(e=e,e.length!==2)throw new $(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=qa({ones:()=>Rn(e),rate:this.dropout,training:o,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=qa({ones:()=>Rn(i),rate:this.recurrentDropout,training:o,count:3}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,c,u;0<this.dropout&&this.dropout<1&&(e=L(e,s[0]));let d=qo(e,this.kernel.read());this.useBias&&(d=xr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=L(i,a[0]));let p=this.recurrentKernel.read(),[f,m]=Un(p,[2*this.units,this.units],p.rank-1),h=qo(i,f),[g,y,x]=Un(d,3,d.rank-1),[w,b]=Un(h,2,h.rank-1);l=this.recurrentActivation.apply(ee(g,w)),c=this.recurrentActivation.apply(ee(y,b));let S=qo(L(c,i),m);u=this.activation.apply(ee(x,S));let E=ee(L(l,i),L(ee(1,gt(l)),u));return[E,E]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Si(this.activation),recurrentActivation:Si(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Rt(this.kernelInitializer),recurrentInitializer:Rt(this.recurrentInitializer),biasInitializer:Rt(this.biasInitializer),kernelRegularizer:xt(this.kernelRegularizer),recurrentRegularizer:xt(this.recurrentRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,r)}}return t.className="GRUCell",t})();Z.registerClass(CN);var Gz=(()=>{class t extends $c{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new CN(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="GRU",t})();Z.registerClass(Gz);var vy=(()=>{class t extends Pc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,an(this.units,"units"),this.activation=Ti(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Ti(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=St(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=St(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=St(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Dt(e.kernelRegularizer),this.recurrentRegularizer=Dt(e.recurrentRegularizer),this.biasRegularizer=Dt(e.biasRegularizer),this.kernelConstraint=Zt(e.kernelConstraint),this.recurrentConstraint=Zt(e.recurrentConstraint),this.biasConstraint=Zt(e.biasConstraint),this.dropout=Sd([1,Ii([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Sd([1,Ii([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Ze(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends br{apply(c,u){let d=s.apply([a]),p=new dw().apply([a]),f=s.apply([a*2]);return KD(KD(d,p),f)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return z(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new $(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=qa({ones:()=>Rn(e),rate:this.dropout,training:o,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=qa({ones:()=>Rn(i),rate:this.recurrentDropout,training:o,count:4}));let a=this.dropoutMask,l=this.recurrentDropoutMask,c,u,d,p;0<this.dropout&&this.dropout<1&&(e=L(e,a[0]));let f=qo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=L(i,l[0])),f=ee(f,qo(i,this.recurrentKernel.read())),this.useBias&&(f=xr(f,this.bias.read()));let[m,h,g,y]=Un(f,4,f.rank-1);c=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(h),d=ee(L(u,s),L(c,this.activation.apply(g))),p=this.recurrentActivation.apply(y);let x=L(p,this.activation.apply(d));return[x,x,d]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Si(this.activation),recurrentActivation:Si(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Rt(this.kernelInitializer),recurrentInitializer:Rt(this.recurrentInitializer),biasInitializer:Rt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:xt(this.kernelRegularizer),recurrentRegularizer:xt(this.recurrentRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),recurrentConstraint:Yt(this.recurrentConstraint),biasConstraint:Yt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,r)}}return t.className="LSTMCell",t})();Z.registerClass(vy);var Wz=(()=>{class t extends $c{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new vy(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="LSTM",t})();Z.registerClass(Wz);var IN=(()=>{class t extends Pc{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return z(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let c=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){mw(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{Ci(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign({},e,i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push(Rr(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return dy(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}vm(r)}}return t.className="StackedRNNCells",t})();Z.registerClass(IN);function qa(t){let{ones:n,rate:e,training:r=!1,count:o=1}=t,i=()=>uw(n(),e),s=()=>Ac(i,n,r);return!o||o<=1?An(s().clone()):Array(o).fill(void 0).map(s).map(l=>An(l.clone()))}var Yue=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e};var Zue=(()=>{class t extends $c{constructor(e){if(e.unroll)throw new _e("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new _e("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new _t({ndim:5})]}call(e,r){return z(()=>{if(this.cell.dropoutMask!=null&&(Oe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Oe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new $("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return z(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=Lt(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){z(()=>{if(!this.stateful)throw new xo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new $("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Lt(s)):this.states_=[Lt(s)];else if(e==null)Oe(this.states_),this.keptStates!=null&&(Oe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Lt(s)):this.states_[0]=Lt(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new $(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Oe(this.states_);for(let l=0;l<this.states_.length;++l){let c=e[l],u=s;if(!v.arraysEqual(c.shape,u))throw new $(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>An(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,c=r==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=Or(u,i[0],s,a[0],l[0]),f=Or(d,i[1],s,a[1],l[1]);return[...e.slice(0,2),...c?[o,p,f]:[p,f,o]]}}return t.className="ConvRNN2D",t})(),SN=(()=>{class t extends vy{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign({},e,{units:r})),this.filters=r,an(this.filters,"filters"),this.kernelSize=Fc(o,2,"kernelSize"),this.kernelSize.forEach(c=>an(c,"kernelSize")),this.strides=Fc(i||1,2,"strides"),this.strides.forEach(c=>an(c,"strides")),this.padding=s||"valid",yr(this.padding),this.dataFormat=a||"channelsLast",Gt(this.dataFormat),this.dilationRate=Fc(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>an(c,"dilationRate"))}build(e){var r;e=Ze(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new $(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;c=new(r=class extends br{apply(f,m){let h=u.apply([d]),g=Zr([d]),y=u.apply([d*2]);return hm([h,g,y])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return z(()=>{if(e.length!==3)throw new $(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=qa({ones:()=>Rn(i),rate:this.dropout,training:o,count:l}));let c=this.dropoutMask,u=(ae,de,le)=>!de||!de[le]?ae:L(de[le],ae),d=u(i,c,0),p=u(i,c,1),f=u(i,c,2),m=u(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=qa({ones:()=>Rn(s),rate:this.recurrentDropout,training:o,count:l}));let h=this.recurrentDropoutMask,g=u(s,h,0),y=u(s,h,1),x=u(s,h,2),w=u(s,h,3),b=3,[S,E,D,O]=Un(this.kernel.read(),l,b),[R,P,U,j]=this.useBias?Un(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,S,R,this.padding),p=this.inputConv(p,E,P,this.padding),f=this.inputConv(f,D,U,this.padding),m=this.inputConv(m,O,j,this.padding);let[W,K,H,Y]=Un(this.recurrentKernel.read(),l,b);g=this.recurrentConv(g,W),y=this.recurrentConv(y,K),x=this.recurrentConv(x,H),w=this.recurrentConv(w,Y);let ne=this.recurrentActivation.apply(ee(d,g)),J=this.recurrentActivation.apply(ee(p,y)),te=ee(L(J,a),L(ne,this.activation.apply(ee(f,x)))),oe=L(this.recurrentActivation.apply(ee(m,w)),this.activation.apply(te));return[oe,oe,te]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=Yue(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},o,i)}inputConv(e,r,o,i){let s=Xr(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?xr(s,o,this.dataFormat):s}recurrentConv(e,r){return Xr(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return t.className="ConvLSTM2DCell",t})();Z.registerClass(SN);var Hz=(()=>{class t extends Zue{constructor(e){let r=new SN(e);super(Object.assign({},e,{cell:r}))}static fromConfig(e,r){return new e(r)}}return t.className="ConvLSTM2D",t})();Z.registerClass(Hz);var TN=(()=>{class t extends ze{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return Ac(()=>uw(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return t.className="Dropout",t})();Z.registerClass(TN);var qz=(()=>{class t extends TN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return t.className="SpatialDropout1D",t})();Z.registerClass(qz);var Kz=(()=>{class t extends ze{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,an(this.units,"units"),this.activation=Ti(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=St(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=St(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Zt(e.kernelConstraint),this.biasConstraint=Zt(e.biasConstraint),this.kernelRegularizer=Dt(e.kernelRegularizer),this.biasRegularizer=Dt(e.biasRegularizer),this.activityRegularizer=Dt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ze(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Ze(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),i=ow(this.activation.getClassName()),s;return i!=null?s=qo(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=qo(o,this.kernel.read()),this.bias!=null&&(s=xr(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Si(this.activation),useBias:this.useBias,kernelInitializer:Rt(this.kernelInitializer),biasInitializer:Rt(this.biasInitializer),kernelRegularizer:xt(this.kernelRegularizer),biasRegularizer:xt(this.biasRegularizer),activityRegularizer:xt(this.activityRegularizer),kernelConstraint:Yt(this.kernelConstraint),biasConstraint:Yt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dense",t})();Z.registerClass(Kz);var Xz=(()=>{class t extends ze{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ze(e);for(let r of e.slice(1))if(r==null)throw new $(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Ho(e,1)]}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=o.transpose(i)}return UB(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return t.className="Flatten",t})();Z.registerClass(Xz);var Yz=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.activation=Ti(e.activation)}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return this.activation.apply(o)})}getConfig(){let e={activation:Si(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Activation",t})();Z.registerClass(Yz);var Zz=(()=>{class t extends ze{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return z(()=>(e=Le(e),BB(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return t.className="RepeatVector",t})();Z.registerClass(Zz);var Qz=(()=>{class t extends ze{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let c=0;c<i.length;++c){let u=i[c];if(this.isUnknown(u))if(a===null)a=c;else throw new $("Can only specifiy one unknown dimension.");else s*=u}let l=Ho(e);if(a!==null){if(s===0||l%s!==0)throw new $(o);i[a]=l/s}else if(l!==s)throw new $(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return o.reshape(s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Reshape",t})();Z.registerClass(Qz);var Jz=(()=>{class t extends ze{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=lr(1,e.dims.length+1);if(!v.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new _t({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ze(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return rt(Le(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Permute",t})();Z.registerClass(Jz);var eU=(()=>{class t extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=Le(e);return Zf(Nc(o,this.maskValue),-1)}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),a=Zf(Nc(o,this.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})}}return t.className="Masking",t})();Z.registerClass(eU);var tU=(()=>{class t extends ze{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(Et(e.inputLength))}this.inputDim=e.inputDim,an(this.inputDim,"inputDim"),this.outputDim=e.outputDim,an(this.outputDim,"outputDim"),this.embeddingsInitializer=St(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Dt(e.embeddingsRegularizer),this.activityRegularizer=Dt(e.activityRegularizer),this.embeddingsConstraint=Zt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return z(()=>this.maskZero?(e=Le(e),Nc(e,Se(e))):null)}computeOutputShape(e){if(e=Ze(e),this.inputLength==null)return[...e,this.outputDim];let r=Et(this.inputLength);if(r.length!==e.length-1)throw new $(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new $(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return o.dtype!=="int32"&&(o=Ua(o,"int32")),cw(this.embeddings.read(),o.as1D()).reshape(Ze(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Rt(this.embeddingsInitializer),embeddingsRegularizer:xt(this.embeddingsRegularizer),activityRegularizer:xt(this.activityRegularizer),embeddingsConstraint:Yt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Embedding",t})();Z.registerClass(tU);var Ka=class extends ze{constructor(n){super(n||{}),this.supportsMasking=!0}mergeFunction(n){throw new _e}computeElementwiseOpOutputShape(n,e){if(n==null||e==null)return null;if(n.length<e.length)return this.computeElementwiseOpOutputShape(e,n);if(e.length===0)return n;let r=n.slice(0,n.length-e.length);for(let o=0;o<e.length;++o){let i=n[n.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new $("Operands could not be broadcast together with shapes "+JSON.stringify(n)+" "+JSON.stringify(e));r.push(i)}}return r}build(n){if(Array.isArray(n)&&!Array.isArray(n[0])&&(n=[Ze(n)]),n=n,n.length<2)throw new $(`A merge layer should be called on an Array of at least 2 inputs. Got ${n.length} input(s).`);let e=[];for(let i of n)i!=null&&i[0]!==null&&e.push(i[0]);if(e=Wo(e),e.length>1)throw new $(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(n)}.`);let r=n[0]==null?null:n[0].slice(1);for(let i=1;i<n.length;++i){let s=n[i]==null?null:n[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=n.map(i=>i.length);n.indexOf(null)===-1&&Wo(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(n,e){return z(()=>{if(n=n,this.reshapeRequired){let r=[],o=n.map(i=>i.rank);if(o.indexOf(null)===-1){let i=Ii(o);for(let s of n){let a=s.rank;for(let l=0;l<i-a;++l)s=ja(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of n){let c=l.rank;if(c==null){let u=l.shape,d=u[0],p=u.slice(1).concat([d]),f=l.reshape([d].concat(Ho(u.slice(1))));f=rt(f,[1,0]),f=f.reshape(p),r.push(f),i=!0}else if(c>1){let u=lr(1,c).concat([0]);r.push(rt(l,u)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=rt(s.reshape([-1,u]),[1,0]).reshape(d)}else if(a>1){let l=[a-1].concat(lr(0,a-1));s=rt(s,l)}}return s}}else return this.mergeFunction(n)})}computeOutputShape(n){n=n;let e;n[0]==null?e=null:e=n[0].slice(1);for(let o=1;o<n.length;++o){let i=n[o]==null?null:n[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of n)o!=null&&o[0]!==null&&r.push(o[0]);return r=Wo(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(n,e){return z(()=>{if(e==null)return null;if(!Array.isArray(e))throw new $("`mask` should be an Array");if(!Array.isArray(n))throw new $("`inputs` should be an Array");if(e.length!==n.length)throw new $(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${n.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:Kn(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=ar(r,e[o]);return r})}},nU=(()=>{class t extends Ka{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=ee(r,e[o]);return r})}}return t.className="Add",t})();Z.registerClass(nU);var rU=(()=>{class t extends Ka{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=L(r,e[o]);return r})}}return t.className="Multiply",t})();Z.registerClass(rU);var oU=(()=>{class t extends Ka{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=ee(r,e[o]);return L(1/e.length,r)})}}return t.className="Average",t})();Z.registerClass(oU);var iU=(()=>{class t extends Ka{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=Yr(r,e[o]);return r})}}return t.className="Maximum",t})();Z.registerClass(iU);var sU=(()=>{class t extends Ka{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=dd(r,e[o]);return r})}}return t.className="Minimum",t})();Z.registerClass(sU);var aU=(()=>{class t extends Ka{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new $("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(v.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new $("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return z(()=>hm(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new $("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new $("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new $("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new $(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return z(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(Rn(e[a]).asType("bool")):r[a].rank<e[a].rank?i.push(Kn(r[a],-1)):i.push(r[a]);let s=$t(i,this.axis);return Ug(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Concatenate",t})();Z.registerClass(aU);function by(t,n){for(;t<0;)t+=n;return t}function Que(t,n,e){if(t.shape.length>3||n.shape.length>3)throw new _e("batchDot is not implemented for tensors of 4D or higher rank yet");if(v.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),v.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${n.shape.length}`),typeof e=="number"&&(e=[e,e]),t.dtype==="complex64"||n.dtype==="complex64")throw new _e("batchDot is not implemented for complex64-type Tensors yet.");let r=t.shape.length,o=n.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return z(()=>{let s;if(r>o){s=r-o;let l=[];for(let c=0;c<s;++c)l.push(1);n=n.reshape(n.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let c=0;c<s;++c)l.push(1);t=t.reshape(t.shape.concat(l))}else s=0;let a;if(t.shape.length===2&&n.shape.length===2)i[0]===i[1]?a=t.mul(n).sum(i[0]):a=t.transpose([1,0]).mul(n).sum(i[1]);else{let l=i[0]!==t.shape.length-1,c=i[1]===n.shape.length-1;a=t.matMul(n,l,c)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let c=[];for(let u=l;u<l+s;++u)c.push(u);a=a.squeeze(c)}return a.shape.length===1&&(a=a.expandDims(1)),a})}var lU=(()=>{class t extends Ka{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){v.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new _e("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new $(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new $(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>by(s,e[a].shape.length)):i=[by(this.axes,r.shape.length),by(this.axes,o.shape.length)],this.normalize&&(r=py(r,i[0]),o=py(o,i[1])),Que(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[by(this.axes,e.length),by(this.axes,r.length)],o}computeOutputShape(e){v.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new _e("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dot",t})();Z.registerClass(lU);var cU=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return Ac(()=>gm(o.shape,0,this.stddev).add(o),()=>o,r.training||!1)})}}return t.className="GaussianNoise",t})();Z.registerClass(cU);var uU=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return this.rate>0&&this.rate<1?Ac(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return o.mul(gm(o.shape,1,s))},()=>o,r.training||!1):o})}}return t.className="GaussianDropout",t})();Z.registerClass(uU);var dU=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Le(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return z(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return Ac(()=>{let s=Le(e),c=-1.6732632423543772*1.0507009873554805,u=ho(Va(o),this.rate);u=Ua(u,"float32");let d=((1-this.rate)*(1+this.rate*c**2))**-.5,p=-d*c*this.rate;return s.mul(u).add(u.add(-1).mul(c)).mul(d).add(p)},()=>Le(e),r.training||!1)}return e})}}return t.className="AlphaDropout",t})();Z.registerClass(dU);function wy(t,n,e,r,o,i=.001){let s;if(t.rank===2)s=z1(t,n,e,r,o,i);else if(t.rank===3)s=U1(t,n,e,r,o,i);else if(t.rank===4)s=j1(t,n,e,r,o,i);else throw new _e(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return s}function Jue(t,n,e,r,o=.001){return z(()=>{let i=sm(t,r),s=i.mean,a=i.variance;return[wy(t,s,a,e,n,o),s,a]})}function ede(t,n,e,r,o=.001){return z(()=>{let i=sm(t,r),s=i.mean,a=i.variance,l=[];for(let m of lr(0,t.rank))r.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let c=s.reshape(l),u=a.reshape(l),d=n==null?null:n.reshape(l),p=e==null?null:e.reshape(l);return[wy(t,c,u,p,d,o),s,a]})}function tde(t,n,e,r,o=.001){return v.arraysEqual(r.slice().sort(),lr(0,t.rank-1))?Jue(t,n,e,r,o):ede(t,n,e,r,o)}var pU=(()=>{class t extends ze{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=St(e.betaInitializer||"zeros"),this.gammaInitializer=St(e.gammaInitializer||"ones"),this.movingMeanInitializer=St(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=St(e.movingVarianceInitializer||"ones"),this.betaConstraint=Zt(e.betaConstraint),this.gammaConstraint=Zt(e.gammaConstraint),this.betaRegularizer=Dt(e.betaRegularizer),this.gammaRegularizer=Dt(e.gammaRegularizer)}build(e){e=Ze(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new $(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new _t({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return z(()=>{let o=r.training==null?!1:r.training,i=Le(e),s=i.shape,a=s.length,l=lr(0,a),c=this.axis>=0?this.axis:this.axis+a;l.splice(c,1);let u=jo(1,a);u[c]=s[c];let d=l.slice();d.sort();let p=!v.arraysEqual(d,lr(0,a).slice(0,a-1)),f=()=>{if(p){let w=this.movingMean.read().reshape(u),b=this.movingVariance.read().reshape(u),S=this.center?this.beta.read().reshape(u):null,E=this.scale?this.gamma.read().reshape(u):null;return wy(i,w,b,S,E,this.epsilon)}else return wy(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return f();let[m,h,g]=tde(i,this.gamma.read(),this.beta.read(),l,this.epsilon),y=(w,b,S)=>{z(()=>{let E=1-S,D=w.read(),O=D.sub(b).mul(E);w.write(D.sub(O))})};return(()=>{y(this.movingMean,h,this.momentum),y(this.movingVariance,g,this.momentum)})(),m})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Rt(this.betaInitializer),gammaInitializer:Rt(this.gammaInitializer),movingMeanInitializer:Rt(this.movingMeanInitializer),movingVarianceInitializer:Rt(this.movingVarianceInitializer),betaRegularizer:xt(this.betaRegularizer),gammaRegularizer:xt(this.gammaRegularizer),betaConstraint:Yt(this.betaConstraint),gammaConstraint:Yt(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BatchNormalization",t})();Z.registerClass(pU);var fU=(()=>{class t extends ze{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=St(e.betaInitializer||"zeros"),this.gammaInitializer=St(e.gammaInitializer||"ones"),this.betaRegularizer=Dt(e.betaRegularizer),this.gammaRegularizer=Dt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ze(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Wo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=Le(e),i=o.shape,s=i.length;return z(()=>{let{mean:l,variance:c}=sm(o,this.axis,!0),u=jo(1,s);for(let g of this.axis)u[g]=i[g];let d=g=>g!=null&&g.shape.length!==s&&this.axis!==[s-1]?g.reshape(u):g,p=d(this.gamma.read()),f=d(this.beta.read()),m=[],h=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(m.push(i[g]),h.push(1)):(m.push(1),h.push(i[g]));return l=l.tile(m),c=c.tile(m),p=p.tile(h),f=f.tile(h),wy(o,l,c,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Rt(this.betaInitializer),gammaInitializer:Rt(this.gammaInitializer),betaRegularizer:xt(this.betaRegularizer),gammaRegularizer:xt(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LayerNormalization",t})();Z.registerClass(fU);function nde(t,n,e){return z(()=>{if(t.rank!==4)throw new $(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(n==null&&(n=[[1,1],[1,1]]),n.length!==2||n[0].length!==2||n[1].length!==2)throw new $("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=hr()),e!=="channelsLast"&&e!=="channelsFirst")throw new $(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],n[0],n[1]]:r=[[0,0],n[0],n[1],[0,0]],pd(t,r)})}var mU=(()=>{class t extends ze{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?hr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new $(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new $(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new $(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new _t({ndim:4})]}computeOutputShape(e){e=Ze(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return z(()=>nde(Le(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ZeroPadding2D",t})();Z.registerClass(mU);function zw(t,n,e,r,o,i){return z(()=>{Gt(o),WD(i),yr(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=hr()),i==null&&(i="max"),t=xy(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=ud(t,n,e,a):s=sd(t,n,e,a),o==="channelsFirst"&&(s=rt(s,[0,3,1,2])),s})}function hU(t,n,e,r,o,i){return z(()=>{Gt(o),WD(i),yr(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=hr()),i==null&&(i="max"),t=gN(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=cD(t,n,e,a):s=B1(t,n,e,a),o==="channelsFirst"&&(s=rt(s,[0,4,1,2,3])),s})}var Pw=class extends ze{constructor(n){if(n.poolSize==null&&(n.poolSize=2),super(n),typeof n.poolSize=="number")this.poolSize=[n.poolSize];else if(Array.isArray(n.poolSize)&&n.poolSize.length===1&&typeof n.poolSize[0]=="number")this.poolSize=n.poolSize;else throw new $(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.poolSize)}`);if(an(this.poolSize,"poolSize"),n.strides==null)this.strides=this.poolSize;else if(typeof n.strides=="number")this.strides=[n.strides];else if(Array.isArray(n.strides)&&n.strides.length===1&&typeof n.strides[0]=="number")this.strides=n.strides;else throw new $(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.strides)}`);an(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,yr(this.padding),this.inputSpec=[new _t({ndim:3})]}computeOutputShape(n){n=Ze(n);let e=Or(n[1],this.poolSize[0],this.padding,this.strides[0]);return[n[0],e,n[2]]}call(n,e){return z(()=>{this.invokeCallHook(n,e),n=ja(Le(n),2);let r=this.poolingFunction(Le(n),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return gd(r,[2])})}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(n,e),n}},gU=(()=>{class t extends Pw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Gt(s),yr(i),zw(e,r,o,i,s,"max")}}return t.className="MaxPooling1D",t})();Z.registerClass(gU);var yU=(()=>{class t extends Pw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Gt(s),yr(i),zw(e,r,o,i,s,"avg")}}return t.className="AveragePooling1D",t})();Z.registerClass(yU);var $w=class extends ze{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==2)throw new $(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides];an(this.poolSize,"poolSize"),an(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Gt(this.dataFormat),yr(this.padding),this.inputSpec=[new _t({ndim:4})]}computeOutputShape(n){n=Ze(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2];return e=Or(e,this.poolSize[0],this.padding,this.strides[0]),r=Or(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r]:[n[0],e,r,n[3]]}call(n,e){return z(()=>(this.invokeCallHook(n,e),this.poolingFunction(Le(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},xU=(()=>{class t extends $w{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Gt(s),yr(i),zw(e,r,o,i,s,"max")}}return t.className="MaxPooling2D",t})();Z.registerClass(xU);var vU=(()=>{class t extends $w{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Gt(s),yr(i),zw(e,r,o,i,s,"avg")}}return t.className="AveragePooling2D",t})();Z.registerClass(vU);var Lw=class extends ze{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==3)throw new $(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides,n.strides];an(this.poolSize,"poolSize"),an(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Gt(this.dataFormat),yr(this.padding),this.inputSpec=[new _t({ndim:5})]}computeOutputShape(n){n=Ze(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2],o=this.dataFormat==="channelsFirst"?n[4]:n[3];return e=Or(e,this.poolSize[0],this.padding,this.strides[0]),r=Or(r,this.poolSize[1],this.padding,this.strides[1]),o=Or(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r,o]:[n[0],e,r,o,n[4]]}call(n,e){return z(()=>(this.invokeCallHook(n,e),this.poolingFunction(Le(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},bU=(()=>{class t extends Lw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Gt(s),yr(i),hU(e,r,o,i,s,"max")}}return t.className="MaxPooling3D",t})();Z.registerClass(bU);var wU=(()=>{class t extends Lw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Gt(s),yr(i),hU(e,r,o,i,s,"avg")}}return t.className="AveragePooling3D",t})();Z.registerClass(wU);var Vw=class extends ze{constructor(n){super(n),this.inputSpec=[new _t({ndim:3})]}computeOutputShape(n){return[n[0],n[2]]}call(n,e){throw new _e}},CU=(()=>{class t extends Vw{constructor(e){super(e||{})}call(e,r){return z(()=>{let o=Le(e);return jt(o,1)})}}return t.className="GlobalAveragePooling1D",t})();Z.registerClass(CU);var IU=(()=>{class t extends Vw{constructor(e){super(e||{})}call(e,r){return z(()=>{let o=Le(e);return zn(o,1)})}}return t.className="GlobalMaxPooling1D",t})();Z.registerClass(IU);var Bw=class extends ze{constructor(n){super(n),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Gt(this.dataFormat),this.inputSpec=[new _t({ndim:4})]}computeOutputShape(n){return n=n,this.dataFormat==="channelsLast"?[n[0],n[3]]:[n[0],n[1]]}call(n,e){throw new _e}getConfig(){let n={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},SU=(()=>{class t extends Bw{call(e,r){return z(()=>{let o=Le(e);return this.dataFormat==="channelsLast"?jt(o,[1,2]):jt(o,[2,3])})}}return t.className="GlobalAveragePooling2D",t})();Z.registerClass(SU);var TU=(()=>{class t extends Bw{call(e,r){return z(()=>{let o=Le(e);return this.dataFormat==="channelsLast"?zn(o,[1,2]):zn(o,[2,3])})}}return t.className="GlobalMaxPooling2D",t})();Z.registerClass(TU);var Uw=class extends ze{constructor(n){super(n),this.layer=n.layer}build(n){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(n){this.layer!=null&&(this.layer.trainable=n)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(n){this.layer.setWeights(n)}getConfig(){let n={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(n,e),n}setFastWeightInitDuringBuild(n){super.setFastWeightInitDuringBuild(n),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(n)}static fromConfig(n,e,r={}){let o=e.layer,i=Rr(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new n(s)}},EU=(()=>{class t extends Uw{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ze(e),e.length<3)throw new $(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ze(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return z(()=>(e=Le(e),bN((a,l)=>[Le(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return t.className="TimeDistributed",t})();Z.registerClass(EU);function rde(t){is(MB,"BidirectionalMergeMode",t)}var ode="concat",_U=(()=>{class t extends Uw{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=Rr(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=Rr(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?ode:e.mergeMode,rde(this.mergeMode),e.weights)throw new _e("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):On(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=vN(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let u=o.length;if(u%2>0)throw new $("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let d=o.map(p=>new _t({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(i!=null)throw new _e("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof cr;for(let u of a)if(u instanceof cr!==c)throw new $("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return z(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),u=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=yo(s,1));let l;return this.mergeMode==="concat"?l=hm([i,s]):this.mergeMode==="sum"?l=ee(i,s):this.mergeMode==="ave"?l=L(.5,ee(i,s)):this.mergeMode==="mul"?l=L(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ci(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ci(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=Rr(r.layer);if(delete r.layer,r.numConstants!=null)throw new _e("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return t.className="Bidirectional",t})();Z.registerClass(_U);var DU;(function(t){let n;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(DU||(DU={}));var cpe=qm(RN());var ape=qm(RN());var kwt=Symbol("out"),Awt=Symbol("field"),Rwt=Symbol("quote"),Owt=Symbol("quoteafterquote"),Mwt=Symbol("quoteinquote");function Q(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&v.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the CPU backend.`)})}var bpe=Zn.whereImpl,GU=(()=>{class t extends Vs{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new $u(this,Ma())}nextDataId(){return t.nextDataId++}write(e,r,o){this.firstUse&&(this.firstUse=!1,G().get("IS_NODE")&&_.warn(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&v.isString(o[0])){let s=o.map(a=>v.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return _.mergeRealAndImagArrays(i,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>v.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ie(e.shape,e.dtype,o)}makeOutput(e,r,o){let i=this.write(e,r,o);return Ma().makeTensorFromDataId(i,r,o,this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=v.now();return e(),{kernelMs:v.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Q([e],"where");let r=this.readSync(e.dataId);return bpe(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return t.nextDataId=0,t})();var JN={};ki(JN,{addImpl:()=>FN,bincountImpl:()=>Dm,bincountReduceImpl:()=>Ww,ceilImpl:()=>PN,concatImpl:()=>Hw,expImpl:()=>$N,expm1Impl:()=>VN,floorImpl:()=>BN,gatherV2Impl:()=>qw,greaterImpl:()=>zN,lessImpl:()=>UN,linSpaceImpl:()=>Kw,logImpl:()=>jN,maxImpl:()=>Xw,maximumImpl:()=>GN,minimumImpl:()=>WN,multiplyImpl:()=>Cy,negImpl:()=>HN,notEqualImpl:()=>qN,prodImpl:()=>KN,rangeImpl:()=>Yw,rsqrtImpl:()=>XN,simpleAbsImpl:()=>MN,sliceImpl:()=>YN,sparseFillEmptyRowsImpl:()=>Zw,sparseReshapeImpl:()=>Qw,squaredDifferenceImpl:()=>ZN,stridedSliceImpl:()=>Jw,subImpl:()=>QN,tileImpl:()=>eC,topKImpl:()=>tC,transposeImpl:()=>Nm,uniqueImpl:()=>nC});function MN(t){let n=new Float32Array(t.length);for(let e=0;e<t.length;++e)n[e]=Math.abs(t[e]);return n}var wpe=t=>{let{x:n}=t.inputs,e=t.backend;Q(n,"abs");let r=new Float32Array(v.sizeFromShape(n.shape)),o=e.data.get(n.dataId).values;return r=MN(o),e.makeOutput(r,n.shape,"float32")},WU={kernelName:kl,backendName:"cpu",kernelFunc:wpe};function Je(t){return(n,e,r,o,i)=>{let s=_.assertAndGetBroadcastShape(n,e),a=s.length,l=v.computeStrides(s),c=v.sizeFromShape(s),u=v.getTypedArrayFromDType(i,c),d=n.length,p=e.length,f=v.computeStrides(n),m=v.computeStrides(e),h=_.getBroadcastDims(n,s),g=_.getBroadcastDims(e,s);if(h.length+g.length===0)for(let y=0;y<u.length;++y)u[y]=t(r[y%r.length],o[y%o.length]);else for(let y=0;y<u.length;++y){let x=v.indexToLoc(y,a,l),w=x.slice(-d);h.forEach(D=>w[D]=0);let b=v.locToIndex(w,d,f),S=x.slice(-p);g.forEach(D=>S[D]=0);let E=v.locToIndex(S,p,m);u[y]=t(r[b],o[E])}return[u,s]}}function In(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var HU={kernelName:xf,backendName:"cpu",kernelFunc:In};function Em(t,n,e="float32"){if(e==="complex64"){let o=Em(t,n,"float32"),i=Em(t,n,"float32");return In({inputs:{real:o,imag:i},backend:t})}let r=v.makeZerosTypedArray(v.sizeFromShape(n),e);return t.makeTensorInfo(n,e,r)}function Jn(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var qU={kernelName:Yi,backendName:"cpu",kernelFunc:Jn};function Ko(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var KU={kernelName:Ff,backendName:"cpu",kernelFunc:Ko};function Xo(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return Jn({inputs:{x:o},backend:e});let s=Em(e,o.shape,o.dtype),a=Xo({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=In({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=Ko({inputs:{input:o},backend:e}),a=Xo({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!v.hasEncodingLoss(o.dtype,i)){let s=Jn({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32"){let s=e.data.get(o.dataId).values,a=Int32Array.from(s);return e.makeTensorInfo(o.shape,"int32",a)}if(i==="bool"){let s=e.data.get(o.dataId).values,a=v.toTypedArray([0],o.dtype),[l,c]=Je((u,d)=>u!==d?1:0)(o.shape,[],s,a,"bool");return e.makeTensorInfo(c,"bool",l)}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var XU={kernelName:Xi,backendName:"cpu",kernelFunc:Xo};function ut(t,n,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;Q([s,a],t);let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let c=Xo({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,m=l.data.get(p.dataId).values,h=Xo({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(h.dataId),y=g.complexTensorInfos.real,x=g.complexTensorInfos.imag,w=l.data.get(y.dataId).values,b=l.data.get(x.dataId).values,[S,E,D]=e(s.shape,a.shape,f,m,w,b),O=l.makeTensorInfo(D,"float32",S),R=l.makeTensorInfo(D,"float32",E),P=In({inputs:{real:O,imag:R},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(O),l.disposeIntermediateTensorInfo(R),P}else{let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}}}function _m(t){return(n,e,r,o,i,s)=>{let a=_.assertAndGetBroadcastShape(n,e),l=v.sizeFromShape(a),c=a.length,u=v.computeStrides(a),d=v.getTypedArrayFromDType("float32",l),p=v.getTypedArrayFromDType("float32",l),f=_.getBroadcastDims(n,a),m=_.getBroadcastDims(e,a),h=_.mergeRealAndImagArrays(r,o),g=_.mergeRealAndImagArrays(i,s),y=n.length,x=v.computeStrides(n),w=e.length,b=v.computeStrides(e);if(f.length+m.length===0)for(let S=0;S<d.length;S++){let E=S%h.length,D=S%g.length,O=t(h[E*2],h[E*2+1],g[D*2],g[D*2+1]);d[S]=O.real,p[S]=O.imag}else for(let S=0;S<d.length;S++){let E=v.indexToLoc(S,c,u),D=E.slice(-y);f.forEach(j=>D[j]=0);let O=v.locToIndex(D,y,x),R=E.slice(-w);m.forEach(j=>R[j]=0);let P=v.locToIndex(R,w,b),U=t(h[O*2],h[O*2+1],g[P*2],g[P*2+1]);d[S]=U.real,p[S]=U.imag}return[d,p,a]}}var FN=Je((t,n)=>t+n),Cpe=_m((t,n,e,r)=>({real:t+e,imag:n+r})),Xa=ut(mi,FN,Cpe),YU={kernelName:mi,backendName:"cpu",kernelFunc:Xa};function Dm(t,n,e,r,o){let i=v.sizeFromShape(r),s=v.makeZerosTypedArray(o,e);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=n[a]:s[l]+=1)}return s}function Ww(t,n,e,r=!1){let o=t.shape[0],i=t.shape[1],s=Ie([o,e],n.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?s.set(1,a,c):n.size>0?s.set(s.get(a,c)+n.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}function Yo(t){return(n,e,r)=>{let o=v.getTypedArrayFromDType(e,n.length);for(let i=0;i<n.length;++i)o[i]=t(n[i],r);return o}}function Ae(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(Q(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=v.sizeFromShape(s.shape),u=e||s.dtype,d=v.getArrayFromDType(u,c);for(let p=0;p<c;++p)d[p]=n(l[p],o);return a.makeTensorInfo(s.shape,u,d)}}function Zo(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(Q(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=e||s.dtype,u=n(l,c,o);return a.makeTensorInfo(s.shape,c,u)}}var PN=Yo(t=>Math.ceil(t)),Ipe=Zo(qs,PN),ZU={kernelName:qs,backendName:"cpu",kernelFunc:Ipe};function Hw(t,n,e,r){let o=v.getArrayFromDType(e,v.sizeFromShape(n));if(r&&e!=="string"){let i=0;t.forEach(s=>{let a=v.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;t.forEach(s=>{let a=e==="string"?_.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let c=0;c<s.shape[0];++c){let u=c*n[1]+i;for(let d=0;d<s.shape[1];++d)o[u+d]=a[l++]}i+=s.shape[1]})}return o}var $N=Yo(t=>Math.exp(t)),LN=Zo(ea,$N),QU={kernelName:ea,backendName:"cpu",kernelFunc:LN};var VN=Yo(t=>Math.expm1(t)),Spe=Zo(ta,VN),JU={kernelName:ta,backendName:"cpu",kernelFunc:Spe};var BN=Yo(t=>Math.floor(t)),Tpe=Zo(na,BN),ej={kernelName:na,backendName:"cpu",kernelFunc:Tpe};function qw(t,n,e){let r=Ie(e,t.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],c=n.locToIndex([a,l]);s[2]=n.values[c];let u=t.locToIndex(s);r.values[o]=t.values[u]}return r}var zN=Je((t,n)=>t>n?1:0),Epe=ut(zu,zN,null,"bool"),tj={kernelName:zu,backendName:"cpu",kernelFunc:Epe};var UN=Je((t,n)=>t<n?1:0),_pe=ut(Uu,UN,null,"bool"),nj={kernelName:Uu,backendName:"cpu",kernelFunc:_pe};function Kw(t,n,e){let r=(n-t)/(e-1),o=v.makeZerosTypedArray(e,"float32");o[0]=t;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var jN=Yo(t=>Math.log(t)),Dpe=Zo(la,jN),rj={kernelName:la,backendName:"cpu",kernelFunc:Dpe};function Xw(t,n,e,r){let o=v.getTypedArrayFromDType(r,v.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*n,a=t[s];for(let l=0;l<n;++l){let c=t[s+l];c>a&&(a=c)}o[i]=a}return o}var GN=Je((t,n)=>Math.max(t,n)),Npe=ut(ua,GN),oj={kernelName:ua,backendName:"cpu",kernelFunc:Npe};var WN=Je((t,n)=>Math.min(t,n)),kpe=ut(da,WN),ij={kernelName:da,backendName:"cpu",kernelFunc:kpe};var Cy=Je((t,n)=>t*n),Ape=_m((t,n,e,r)=>({real:t*e-n*r,imag:t*r+n*e})),Ad=ut(fa,Cy,Ape),sj={kernelName:fa,backendName:"cpu",kernelFunc:Ad};function HN(t,n,e){let r=v.createScalarValue(-1,e);return Cy([],n,r,t,e)}function Rpe(t){let{inputs:n,backend:e}=t,{x:r}=n;Q(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=HN(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var aj={kernelName:nc,backendName:"cpu",kernelFunc:Rpe};var qN=Je((t,n)=>t!==n?1:0),Ope=ut(qu,qN,null,"bool"),lj={kernelName:qu,backendName:"cpu",kernelFunc:Ope};function Nm(t,n,e,r,o){let i=n.length,s=v.sizeFromShape(n),a=v.computeStrides(n),l=v.computeStrides(o),c=v.getTypedArrayFromDType(e,v.sizeFromShape(o));for(let u=0;u<s;++u){let d=v.indexToLoc(u,i,a),p=new Array(d.length);for(let m=0;m<p.length;m++)p[m]=d[r[m]];let f=v.locToIndex(p,i,l);c[f]=t[u]}return c}function pn(t){let{inputs:n,attrs:e,backend:r}=t,{x:o}=n,{perm:i}=e;Q(o,"transpose");let s=o.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=o.shape[i[d]];let l=r.data.get(o.dataId).values,c=Nm(l,o.shape,o.dtype,i,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var cj={kernelName:xc,backendName:"cpu",kernelFunc:pn};function KN(t,n,e,r){let[o,i]=_.computeOutAndReduceShapes(t,r),s=Cn(n,"int32"),a=v.makeZerosTypedArray(v.sizeFromShape(o),s),l=v.sizeFromShape(i);for(let c=0;c<a.length;++c){let u=c*l,d=1;for(let p=0;p<l;++p)d*=e[u+p];a[c]=d}return{outVals:a,outShape:o,outDtype:s}}function Mpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"prod");let a=o.shape.length,l=v.parseAxisParam(i,o.shape),c=_.getAxesPermutation(l,a),u=l,d=o,p=[];c!=null&&(d=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),p.push(d),u=_.getInnerMostAxes(u.length,a));let f=e.data.get(d.dataId).values,{outVals:m,outShape:h,outDtype:g}=KN(d.shape,d.dtype,f,u),y=h;return s&&(y=_.expandShapeToKeepDim(h,l)),p.forEach(x=>e.disposeIntermediateTensorInfo(x)),e.makeTensorInfo(y,g,m)}var uj={kernelName:Of,backendName:"cpu",kernelFunc:Mpe};function Yw(t,n,e,r){let o=t===n,i=t<n&&e<0,s=n<t&&e>1;if(o||i||s)return v.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((n-t)/e)),l=v.makeZerosTypedArray(a,r);n<t&&e===1&&(e=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+e;return l}var XN=Yo(t=>1/Math.sqrt(t)),Fpe=Zo(va,XN),dj={kernelName:va,backendName:"cpu",kernelFunc:Fpe};function YN(t,n,e,r,o){let i=qn.isSliceContinous(r,n,e),s=v.sizeFromShape(e),a=v.computeStrides(r);if(i){let d=qn.computeFlatOffset(n,a);return o==="string"?t.slice(d,d+s):t.subarray(d,d+s)}let l=o==="string"?_.fromUint8ToStringArray(t):t,c=Ie(r,o,l),u=Ie(e,o);for(let d=0;d<u.size;++d){let p=u.indexToLoc(d),f=p.map((m,h)=>m+n[h]);u.set(c.get(...f),...p)}return o==="string"?_.fromStringArrayToUint8(u.values):u.values}function Qo(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r;Q(o,"slice");let[a,l]=qn.parseSliceParams(o,i,s);qn.assertParamsValid(o,a,l);let c=e.data.get(o.dataId).values,u=YN(c,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,u)}var pj={kernelName:fc,backendName:"cpu",kernelFunc:Qo};function Zw(t,n,e,r,o,i,s){let a=n[0],l=i[0],c=new Array(l),u=new Array(a),d=n[1];if(l===0){if(a!==0)throw new Error(`Received SparseTensor with denseShape[0] = 0 but
         indices.shape[0] = ${a}`);let g=v.getArrayFromDType(e,0),y=v.getArrayFromDType(o,0);return[g,[0,d],y,c,u]}let p=!0,f=0,m=new Array(l).fill(0);for(let g=0;g<a;++g){let y=t[g*d];if(y<0)throw new Error(`indices(${g}, 0) is invalid: ${y} < 0`);if(y>=l)throw new Error(`indices(${g}, 0) is invalid: ${y} >= ${l}`);++m[y],p=p&&y>=f,f=y}let h=!0;for(let g=0;g<l;++g){let y=m[g]===0;c[g]=y,h=h&&!y,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(h&&p){let g=t,y=r;for(let x=0;x<a;++x)u[x]=x;return[g,[a,d],y,c,u]}else{let g=m[l-1],y=v.getArrayFromDType(e,g*d),x=v.getArrayFromDType(o,g),w=new Array(l).fill(0);for(let b=0;b<a;++b){let S=t[b*d],E=w[S],D=(S===0?0:m[S-1])+E;w[S]++;for(let O=0;O<d;++O)y[D*d+O]=t[b*d+O];x[D]=r[b],u[b]=D}for(let b=0;b<l;++b)if(w[b]===0){let E=b===0?0:m[b-1];y[E*d+0]=b;for(let D=1;D<d;++D)y[E*d+D]=0;x[E]=s}return[y,[a,d],x,c,u]}}function Qw(t,n,e,r,o){let i=v.sizeFromShape(r),s=n[0],a=o.length,l=[],c=1,u=-1;for(let g=0;g<a;++g){let y=o[g];if(y===-1){if(u!==-1)throw new Error(`only one output dimension may be -1, not both ${u} and ${g}`);u=g,l.push(1)}else{if(y<0)throw new Error(`size ${g} must be non-negative, not ${y}`);c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");let g=Math.trunc(i/c);if(c*g!==i)throw new Error(`Input to reshape is a SparseTensor with ${i}
          dense values, but the requested shape requires a multiple of ${c}. inputShape=${r} outputShape= ${l}`);l[u]=g}let d=v.sizeFromShape(l);if(d!==i)throw new Error(`Input to reshape is a tensor with ${i} dense values, but the requested shape has ${d}. inputShape=${r} outputShape=${l}`);let p=r.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}let m=[];if(a>0){m[a-1]=1;for(let g=a-2;g>=0;--g)m[g]=m[g+1]*l[g+1]}let h=v.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let y=0;for(let x=0;x<p;++x)y+=t[g*p+x]*f[x];for(let x=0;x<a;++x)h[g*a+x]=Math.trunc(y/m[x]),y%=m[x]}return[h,[s,a],l]}var ZN=Je((t,n)=>{let e=t-n;return e*e}),Ppe=ut(_a,ZN),fj={kernelName:_a,backendName:"cpu",kernelFunc:Ppe};function Jw(t,n,e,r){let o=Ie(t,n.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(n.get(...a),...s)}return o}var QN=Je((t,n)=>t-n),$pe=_m((t,n,e,r)=>({real:t-e,imag:n-r})),Iy=ut(Da,QN,$pe),mj={kernelName:Da,backendName:"cpu",kernelFunc:Iy};function eC(t,n){let e=new Array(t.rank);for(let o=0;o<e.length;o++)e[o]=t.shape[o]*n[o];let r=Ie(e,t.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(t.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%t.shape[l];let a=t.locToIndex(s);r.values[o]=t.values[a]}return r}function tC(t,n,e,r,o){let i=n[n.length-1],[s,a]=[t.length/i,i],l=v.getTypedArrayFromDType(e,s*r),c=v.getTypedArrayFromDType("int32",s*r);for(let d=0;d<s;d++){let p=d*a,f=t.subarray(p,p+a),m=[];for(let x=0;x<f.length;x++)m.push({value:f[x],index:x});m.sort((x,w)=>w.value-x.value);let h=d*r,g=l.subarray(h,h+r),y=c.subarray(h,h+r);for(let x=0;x<r;x++)g[x]=m[x].value,y[x]=m[x].index}let u=n.slice();return u[u.length-1]=r,[Ie(u,e,l),Ie(u,"int32",c)]}function nC(t,n,e,r){let o=v.parseAxisParam(n,e)[0],i=[1,e[0],1];for(let m=0;m<o;m++)i[0]*=e[m];i[1]=e[o];for(let m=o+1;m<e.length;m++)i[2]*=e[m];let s={},a=new Int32Array(e[o]),l=new Tt(i,r,t),c=[],u=i[0]===1&&i[2]===1;for(let m=0;m<e[o];m++){let h;if(u)h=t[m].toString();else{let g=[];for(let y=0;y<i[0];y++)for(let x=0;x<i[2];x++)g.push(l.get(y,m,x));h=g.join(",")}if(s[h]!==void 0)a[m]=s[h];else{let g=Object.keys(s).length;s[h]=g,a[m]=g,c.push(m)}}let d=i.slice();d[1]=Object.keys(s).length;let p=new Tt(d,r);c.forEach((m,h)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)p.set(l.get(g,m,y),g,h,y)});let f=e.slice();return f[o]=d[1],{outputValues:p.values,outputShape:f,indices:a}}Pb("cpu",()=>new GU,1);var ek=Ae(Qs,t=>t>=0?t:Math.exp(t)-1),hj={kernelName:Qs,backendName:"cpu",kernelFunc:ek};function tk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r;Q([o],"leakyRelu");let s=v.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=v.getTypedArrayFromDType("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",l)}var gj={kernelName:Kl,backendName:"cpu",kernelFunc:tk};var Lpe=Je((t,n)=>t<0?n*t:t);function nk(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n;Q([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=Lpe(r.shape,o.shape,i,s,r.dtype);return e.makeTensorInfo(l,r.dtype,a)}var yj={kernelName:ac,backendName:"cpu",kernelFunc:nk};var rk=Ae(ga,t=>Math.max(0,t)),xj={kernelName:ga,backendName:"cpu",kernelFunc:rk};var ok=Ae(ya,t=>Math.min(Math.max(0,t),6)),vj={kernelName:ya,backendName:"cpu",kernelFunc:ok};var ik=Ae(Sa,t=>1/(1+Math.exp(-t))),bj={kernelName:Sa,backendName:"cpu",kernelFunc:ik};function km(t,n,e,r,o){if(e==="linear")return Jn({inputs:{x:n},backend:t});if(e==="relu")return rk({inputs:{x:n},backend:t});if(e==="elu")return ek({inputs:{x:n},backend:t});if(e==="relu6")return ok({inputs:{x:n},backend:t});if(e==="prelu")return nk({inputs:{x:n,alpha:r},backend:t});if(e==="leakyrelu")return tk({inputs:{x:n},backend:t,attrs:{alpha:o}});if(e==="sigmoid")return ik({inputs:{x:n},backend:t});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function et(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=v.sizeFromShape(o.shape),a=v.inferFromImplicitShape(i,s),l=v.sizeFromShape(a);v.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var wj={kernelName:lc,backendName:"cpu",kernelFunc:et};function sk(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;Q([o,i],"matMul");let l=o.shape.length,c=i.shape.length,u=s?o.shape[l-2]:o.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],p=s?o.shape[l-1]:o.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],m=o.shape.slice(0,-2),h=i.shape.slice(0,-2),g=v.sizeFromShape(m),y=v.sizeFromShape(h),x=g===y||g===1||y===1;v.assert(l>=2&&c>=2&&x,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${h}).`);let b=(g>y?o.shape.slice(0,-2):i.shape.slice(0,-2)).concat([p,f]);v.assert(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let S=s?[g,u,p]:[g,p,u],E=a?[y,f,d]:[y,d,f],D=et({inputs:{x:o},backend:e,attrs:{shape:S}}),O=et({inputs:{x:i},backend:e,attrs:{shape:E}}),R=s?D.shape[1]:D.shape[2],P=s?D.shape[2]:D.shape[1],U=a?O.shape[1]:O.shape[2],j=Math.max(g,y),W=e.data.get(D.dataId).values,K=e.data.get(O.dataId).values,H=v.computeStrides(D.shape),Y=v.computeStrides(O.shape),[ne,J,te]=s?[H[0],1,H[1]]:[H[0],H[1],1],[oe,ae,de]=a?[1,Y[1],Y[0]]:[Y[1],1,Y[0]],le=P*U,me=Ie([j,P,U],D.dtype),ge=me.values,xe=e.blockSize;for(let Te=0;Te<j;Te++)for(let Pe=0;Pe<P;Pe+=xe)for(let Ve=0;Ve<U;Ve+=xe)for(let We=0;We<R;We+=xe){let at=Math.min(Pe+xe,P),Ot=Math.min(Ve+xe,U),un=Math.min(We+xe,R);for(let Jt=Pe;Jt<at;Jt++)for(let Ht=Ve;Ht<Ot;Ht++){let qt=0;for(let en=We;en<un;en++){let hn=Math.min(Te,g-1)*ne,us=Math.min(Te,y-1)*de,jn=W[hn+Jt*J+en*te],Ni=K[en*oe+Ht*ae+us];qt+=jn*Ni}ge[Te*le+(Jt*U+Ht)]+=qt}}return e.disposeIntermediateTensorInfo(D),e.disposeIntermediateTensorInfo(O),e.makeTensorInfo(b,me.dtype,me.values)}var Cj={kernelName:Fl,backendName:"cpu",kernelFunc:sk};function Vpe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r,p,f,m,h=[];p=sk({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:e}),s&&(f=Xa({inputs:{a:p,b:s},backend:e}),h.push(p),p=f),u&&(m=km(e,p,u,a,d),h.push(p),p=m);for(let y of h)e.disposeIntermediateTensorInfo(y);return p}var Ij={kernelName:Ku,backendName:"cpu",kernelFunc:Vpe};var Bpe=Ae(Bs,t=>Math.acos(t)),Sj={kernelName:Bs,backendName:"cpu",kernelFunc:Bpe};var zpe=Ae(zs,t=>Math.acosh(t)),Tj={kernelName:zs,backendName:"cpu",kernelFunc:zpe};function Upe(t){let{inputs:n,backend:e}=t,r=n;Q(n,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=Ie(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var Ej={kernelName:ff,backendName:"cpu",kernelFunc:Upe};function jpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"all");let a=v.parseAxisParam(i,o.shape),l=a,c=_.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=_.getInnerMostAxes(l.length,o.shape.length)),_.assertAxesAreInnerMostDims("all",l,u.shape.length);let[d,p]=_.computeOutAndReduceShapes(u.shape,l),f=v.sizeFromShape(p),m=v.makeZerosTypedArray(v.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){let x=y*f,w=h[x];for(let b=0;b<f;++b){let S=h[x+b];w=w&&S}m[y]=w}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let y=_.expandShapeToKeepDim(d,a),x=et({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),x}return g}var _j={kernelName:mf,backendName:"cpu",kernelFunc:jpe};function Gpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"any");let a=v.parseAxisParam(i,o.shape),l=a,c=_.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=_.getInnerMostAxes(l.length,o.shape.length)),_.assertAxesAreInnerMostDims("any",l,u.shape.length);let[d,p]=_.computeOutAndReduceShapes(u.shape,l),f=v.sizeFromShape(p),m=v.makeZerosTypedArray(v.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){let x=y*f,w=h[x];for(let b=0;b<f;++b){let S=h[x+b];w=w||S}m[y]=w}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let y=_.expandShapeToKeepDim(d,a),x=et({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),x}return g}var Dj={kernelName:hf,backendName:"cpu",kernelFunc:Gpe};function Wpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Q(o,"argMax");let s=v.parseAxisParam(i,o.shape),a=_.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=pn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=_.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],_.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[u,d]=_.computeOutAndReduceShapes(l.shape,s),p=v.sizeFromShape(u),f=v.makeZerosTypedArray(p,"int32"),m=v.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let y=g*m,x=h[y],w=0;for(let b=0;b<m;++b){let S=h[y+b];S>x&&(x=S,w=b)}f[g]=w}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var Nj={kernelName:Al,backendName:"cpu",kernelFunc:Wpe};function Hpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Q(o,"argMin");let s=v.parseAxisParam(i,o.shape),a=_.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=pn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=_.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],_.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[u,d]=_.computeOutAndReduceShapes(l.shape,s),p=v.sizeFromShape(u),f=v.makeZerosTypedArray(p,"int32"),m=v.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let y=g*m,x=h[y],w=0;for(let b=0;b<m;++b){let S=h[y+b];S<x&&(x=S,w=b)}f[g]=w}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var kj={kernelName:Rl,backendName:"cpu",kernelFunc:Hpe};var qpe=Ae(Us,t=>Math.asin(t)),Aj={kernelName:Us,backendName:"cpu",kernelFunc:qpe};var Kpe=Ae(js,t=>Math.asinh(t)),Rj={kernelName:js,backendName:"cpu",kernelFunc:Kpe};var Xpe=Ae(Gs,t=>Math.atan(t)),Oj={kernelName:Gs,backendName:"cpu",kernelFunc:Xpe};var Ype=Je((t,n)=>Math.atan2(t,n)),Zpe=ut(Hs,Ype),Mj={kernelName:Hs,backendName:"cpu",kernelFunc:Zpe};var Qpe=Ae(Ws,t=>Math.atanh(t)),Fj={kernelName:Ws,backendName:"cpu",kernelFunc:Qpe};function Am(t,n,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=o.padInfo.top,f=o.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Ie(o.outShape,e),g=h.values,y=o.outShape[1]*o.outShape[2]*o.outShape[3],x=o.outShape[2]*o.outShape[3],w=o.outShape[3];for(let b=0;b<o.batchSize;++b){let S=b*y,E=b*r[0];for(let D=0;D<o.inChannels;++D)for(let O=0;O<o.outHeight;++O){let R=O*s-p,P=Math.max(0,R),U=Math.min(o.inHeight,u+R),j=S+O*x;for(let W=0;W<o.outWidth;++W){let K=W*a-f,H=Math.max(0,K),Y=Math.min(o.inWidth,d+K),ne=m,J=0,te=0;for(let ae=P;ae<U;ae+=l){let de=E+ae*r[1];for(let le=H;le<Y;le+=c){let me=de+le*r[2],ge=t[me+D];i==="max"&&ge>ne?ne=ge:i==="avg"&&(J+=ge,te++)}if(isNaN(ne))break}let oe=j+W*w+D;g[oe]=i==="avg"?J/te:ne}}}return h}function rC(t,n,e,r,o=!1,i=!1){let s=Ie(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left,h=Ie(n,e,t);for(let g=0;g<r.batchSize;++g)for(let y=0;y<r.inChannels;++y)for(let x=0;x<r.outHeight;++x){let w=x*a-f,b=w;for(;b<0;)b+=c;let S=Math.min(r.inHeight,d+w);for(let E=0;E<r.outWidth;++E){let D=E*l-m,O=D;for(;O<0;)O+=u;let R=Math.min(r.inWidth,p+D),P=Number.NEGATIVE_INFINITY,U=-1;for(let j=b;j<S;j+=c){let W=j-w;for(let K=O;K<R;K+=u){let H=K-D,Y=h.get(g,j,K,y);Y>P&&(P=Y,o?U=i?((g*r.inHeight+j)*r.inWidth+K)*r.inChannels+y:(j*r.inWidth+K)*r.inChannels+y:U=W*p+H)}}s.set(U,g,x,E,y)}}return s}function oC(t,n,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,g=o.padInfo.top,y=o.padInfo.left,x=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Ie(o.outShape,e),b=w.values,S=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],E=o.outShape[2]*o.outShape[3]*o.outShape[4],D=o.outShape[3]*o.outShape[4],O=o.outShape[4];for(let R=0;R<o.batchSize;++R){let P=R*S,U=R*r[0];for(let j=0;j<o.inChannels;++j)for(let W=0;W<o.outDepth;++W){let K=W*s-h,H=K;for(;H<0;)H+=c;let Y=Math.min(o.inDepth,p+K),ne=P+W*E;for(let J=0;J<o.outHeight;++J){let te=J*a-g,oe=te;for(;oe<0;)oe+=u;let ae=Math.min(o.inHeight,f+te),de=ne+J*D;for(let le=0;le<o.outWidth;++le){let me=le*l-y,ge=me;for(;ge<0;)ge+=d;let xe=Math.min(o.inWidth,m+me),Te=de+le*O,Pe=x,Ve=0,We=0;for(let Ot=H;Ot<Y;Ot+=c){let un=U+Ot*r[1];for(let Jt=oe;Jt<ae;Jt+=u){let Ht=un+Jt*r[2];for(let qt=ge;qt<xe;qt+=d){let en=Ht+qt*r[3],hn=t[en+j];if(i==="max"&&hn>Pe?Pe=hn:i==="avg"&&(Ve+=hn,We++),isNaN(Pe))break}if(isNaN(Pe))break}if(isNaN(Pe))break}let at=Te+j;b[at]=i==="avg"?Ve/We:Pe}}}}return w}function Pj(t,n){let e=Ie(n.outShape,"int32"),r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,u=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,f=n.padInfo.top,m=n.padInfo.left;for(let h=0;h<n.batchSize;++h)for(let g=0;g<n.inChannels;++g)for(let y=0;y<n.outDepth;++y){let x=y*r-p,w=x;for(;w<0;)w+=s;let b=Math.min(n.inDepth,c+x);for(let S=0;S<n.outHeight;++S){let E=S*o-f,D=E;for(;D<0;)D+=a;let O=Math.min(n.inHeight,u+E);for(let R=0;R<n.outWidth;++R){let P=R*i-m,U=P;for(;U<0;)U+=l;let j=Math.min(n.inWidth,d+P),W=Number.NEGATIVE_INFINITY,K=-1;for(let H=w;H<b;H+=s){let Y=H-x;for(let ne=D;ne<O;ne+=a){let J=ne-E;for(let te=U;te<j;te+=l){let oe=te-P,ae=t.get(h,H,ne,te,g);ae>=W&&(W=ae,K=Y*u*d+J*u+oe)}}}e.set(K,h,y,S,R,g)}}}return e}function Jpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Q(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;v.assert(_.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=_.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&v.arraysEqual(u.inShape,u.outShape))d=Jn({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=v.computeStrides(o.shape),m=Am(p,o.shape,o.dtype,f,u,"avg");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var $j={kernelName:Ol,backendName:"cpu",kernelFunc:Jpe};function efe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;Q(o,"avgPool3d");let u=_.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=oC(d,o.shape,o.dtype,v.computeStrides(o.shape),u,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var Lj={kernelName:Ml,backendName:"cpu",kernelFunc:efe};function tfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;Q([o,i],"avgPool3DGrad");let u=_.computePool3DInfo(i.shape,s,a,1,l,c),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.filterDepth,h=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,x=u.dilationHeight,w=u.dilationWidth,b=u.effectiveFilterDepth,S=u.effectiveFilterHeight,E=u.effectiveFilterWidth,D=b-1-u.padInfo.front,O=E-1-u.padInfo.left,R=S-1-u.padInfo.top,P=Ie(i.shape,"float32"),U=1/(m*h*g),j=e.bufferSync(o);for(let W=0;W<u.batchSize;++W)for(let K=0;K<u.inChannels;++K)for(let H=0;H<u.inDepth;++H)for(let Y=0;Y<u.inHeight;++Y)for(let ne=0;ne<u.inWidth;++ne){let J=H-D,te=Y-R,oe=ne-O,ae=0;for(let de=0;de<b;de+=y){let le=(J+de)/d;if(!(le<0||le>=u.outDepth||Math.floor(le)!==le))for(let me=0;me<S;me+=x){let ge=(te+me)/p;if(!(ge<0||ge>=u.outHeight||Math.floor(ge)!==ge))for(let xe=0;xe<E;xe+=w){let Te=(oe+xe)/f;if(Te<0||Te>=u.outWidth||Math.floor(Te)!==Te)continue;let Pe=j.get(W,le,ge,Te,K);ae+=Pe}}}P.set(ae*U,W,H,Y,ne,K)}return e.makeTensorInfo(P.shape,P.dtype,P.values)}var Vj={kernelName:yf,backendName:"cpu",kernelFunc:tfe};function nfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;Q([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=_.computePool2DInfo(s.shape,a,l,1,c),d=u.strideHeight,p=u.strideWidth,f=u.filterHeight,m=u.filterWidth,h=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,x=u.effectiveFilterWidth,w=x-1-u.padInfo.left,b=y-1-u.padInfo.top,S=Ie(s.shape,"float32"),E=1/(f*m),D=e.data.get(o.dataId).values,O=Ie(o.shape,"float32",D);for(let R=0;R<u.batchSize;++R)for(let P=0;P<u.inChannels;++P)for(let U=0;U<u.inHeight;++U)for(let j=0;j<u.inWidth;++j){let W=U-b,K=j-w,H=0;for(let Y=0;Y<y;Y+=h){let ne=(W+Y)/d;if(!(ne<0||ne>=u.outHeight||Math.floor(ne)!==ne))for(let J=0;J<x;J+=g){let te=(K+J)/p;if(te<0||te>=u.outWidth||Math.floor(te)!==te)continue;let oe=O.get(R,ne,te,P);H+=oe}}S.set(H*E,R,U,j,P)}return e.makeTensorInfo(S.shape,S.dtype,S.values)}var Bj={kernelName:gf,backendName:"cpu",kernelFunc:nfe};function rfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,scale:i,offset:s,mean:a,variance:l}=n;v.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),v.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),v.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Q([o,a,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,p=e.data.get(l.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),m=s?e.data.get(s.dataId).values:new Float32Array([0]),h=new Float32Array(u.length),g=m.length,y=f.length,x=p.length,w=d.length,b=0,S=0,E=0,D=0;for(let O=0;O<u.length;++O)h[O]=m[b++]+(u[O]-d[S++])*f[E++]/Math.sqrt(p[D++]+c),b>=g&&(b=0),S>=w&&(S=0),E>=y&&(E=0),D>=x&&(D=0);return e.makeTensorInfo(o.shape,o.dtype,h)}var zj={kernelName:Hl,backendName:"cpu",kernelFunc:rfe};function ofe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;Q([o],"batchToSpaceND");let a=i.reduce((y,x)=>y*x),l=_.getReshaped(o.shape,i,a),c=_.getPermuted(l.length,i.length),u=_.getReshapedPermuted(o.shape,i,a),d=_.getSliceBeginCoords(s,i.length),p=_.getSliceSize(u,s,i.length),f=et({inputs:{x:o},backend:e,attrs:{shape:l}}),m=pn({inputs:{x:f},backend:e,attrs:{perm:c}}),h=et({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Qo({inputs:{x:h},backend:e,attrs:{begin:d,size:p}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var Uj={kernelName:Pl,backendName:"cpu",kernelFunc:ofe};function ife(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=Dm(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var jj={kernelName:tb,backendName:"cpu",kernelFunc:ife};var sfe=Ae(Ks,(t,n)=>{let e=n;return t>e.clipValueMax?e.clipValueMax:t<e.clipValueMin?e.clipValueMin:t}),Gj={kernelName:Ks,backendName:"cpu",kernelFunc:sfe};var afe=t=>{let{x:n}=t.inputs,e=t.backend,r=new Float32Array(v.sizeFromShape(n.shape)),o=e.data.get(n.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let c=0;c<a.length;c++){let u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return e.makeOutput(r,n.shape,"float32")},Wj={kernelName:$l,backendName:"cpu",kernelFunc:afe};function as(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var Hj={kernelName:Nf,backendName:"cpu",kernelFunc:as};function Lc(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=v.parseAxisParam(o,n[0].shape)[0],s=_.computeOutShape(n.map(h=>h.shape),i);if(v.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(h=>v.sizeFromShape(h.shape)>0);if(a.length===1)return Jn({inputs:{x:a[0]},backend:e});let l=a.map(h=>h.shape);if(_.assertParamsConsistent(l,i),a[0].dtype==="complex64"){let h=a.map(b=>Ko({inputs:{input:b},backend:e})),g=a.map(b=>as({inputs:{input:b},backend:e})),y=Lc({inputs:h,backend:e,attrs:{axis:i}}),x=Lc({inputs:g,backend:e,attrs:{axis:i}}),w=In({inputs:{real:y,imag:x},backend:e});return h.forEach(b=>e.disposeIntermediateTensorInfo(b)),g.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),w}let c=a.map(h=>{let y=[-1,v.sizeFromShape(h.shape.slice(i))];return et({inputs:{x:h},backend:e,attrs:{shape:y}})}),u=c.map(h=>({vals:e.data.get(h.dataId).values,shape:h.shape}));s=_.computeOutShape(c.map(h=>h.shape),1);let d=c[0].shape[0]===1,p=Hw(u,s,n[0].dtype,d),f=_.computeOutShape(a.map(h=>h.shape),i),m=e.makeTensorInfo(f,n[0].dtype,p);return c.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var qj={kernelName:Ll,backendName:"cpu",kernelFunc:Lc};function ak(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;Q([o,i],"conv2d");let d=_.convertConv2DDataFormat(l),p=_.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f=p.filterHeight,m=p.filterWidth,h=p.dilationHeight,g=p.dilationWidth,y=p.padInfo.left,x=p.padInfo.top,w=p.dataFormat==="channelsLast",b=new Tt(p.outShape,o.dtype),S=v.computeStrides(o.shape),E=v.computeStrides(i.shape),D=S[0],O=w?S[1]:S[2],R=w?S[2]:1,P=w?1:S[1],U=b.strides[0],j=w?b.strides[1]:b.strides[2],W=w?b.strides[2]:1,K=w?1:b.strides[1],H=e.data.get(o.dataId).values,Y=e.data.get(i.dataId).values,ne=b.values;for(let J=0;J<p.batchSize;++J){let te=J*D,oe=J*U;for(let ae=0;ae<p.outHeight;++ae){let de=oe+ae*j,le=ae*p.strideHeight-x;for(let me=0;me<f;++me){let ge=le+me*h;if(ge<0||ge>=p.inHeight)continue;let xe=me*E[0],Te=te+ge*O;for(let Pe=0;Pe<p.outWidth;++Pe){let Ve=de+Pe*W,We=Pe*p.strideWidth-y;for(let at=0;at<m;++at){let Ot=We+at*g;if(Ot<0||Ot>=p.inWidth)continue;let un=xe+at*E[1],Jt=Te+Ot*R,Ht=un;for(let qt=0;qt<p.inChannels;++qt){let en=H[Jt+qt*P];for(let hn=0;hn<p.outChannels;++hn)ne[Ve+hn*K]+=en*Y[Ht+hn];Ht+=p.outChannels}}}}}}return e.makeTensorInfo(b.shape,b.dtype,ne)}var Kj={kernelName:Vl,backendName:"cpu",kernelFunc:ak};function lfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;Q([o,i],"conv2dBackpropFilter");let d=_.convertConv2DDataFormat(l),p=_.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),{strideHeight:f,strideWidth:m,filterHeight:h,filterWidth:g}=p,y=p.dataFormat==="channelsLast",x=new Tt(p.filterShape,"float32"),w=p.padInfo.left,b=p.padInfo.top,S=e.data.get(o.dataId).values,E=e.data.get(i.dataId).values,D=new Tt(o.shape,o.dtype,S),O=new Tt(i.shape,i.dtype,E);for(let R=0;R<h;++R){let P=Math.max(0,Math.ceil((b-R)/f)),U=Math.min(p.outHeight,(p.inHeight+b-R)/f);for(let j=0;j<g;++j){let W=Math.max(0,Math.ceil((w-j)/m)),K=Math.min(p.outWidth,(p.inWidth+w-j)/m);for(let H=0;H<p.inChannels;++H)for(let Y=0;Y<p.outChannels;++Y){let ne=0;for(let J=0;J<p.batchSize;++J)for(let te=P;te<U;++te){let oe=R+te*f-b;for(let ae=W;ae<K;++ae){let de=j+ae*m-w;y?ne+=D.get(J,oe,de,H)*O.get(J,te,ae,Y):ne+=D.get(J,H,oe,de)*O.get(J,Y,te,ae)}}x.set(ne,R,j,H,Y)}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var Xj={kernelName:vf,backendName:"cpu",kernelFunc:lfe};function cfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;Q([o,i],"conv2dBackpropInput");let d=v.computeStrides(i.shape),p=v.computeStrides(o.shape),f=_.convertConv2DDataFormat(c),m=_.computeConv2DInfo(s,i.shape,a,1,l,u,!1,f),h=new Tt(m.inShape,"float32"),g=h.values,y=e.data.get(o.dataId).values,x=e.data.get(i.dataId).values,[w,b,S]=d,{batchSize:E,filterHeight:D,filterWidth:O,inChannels:R,inHeight:P,inWidth:U,outChannels:j,outHeight:W,outWidth:K,strideHeight:H,strideWidth:Y}=m;f=m.dataFormat;let ne=D-1-m.padInfo.top,J=O-1-m.padInfo.left,te=f==="channelsLast",oe=h.strides[0],ae=te?h.strides[1]:h.strides[2],de=te?h.strides[2]:1,le=te?1:h.strides[1],me=p[0],ge=te?p[1]:p[2],xe=te?p[2]:1,Te=te?1:p[1];for(let Pe=0;Pe<E;++Pe)for(let Ve=0;Ve<R;++Ve)for(let We=0;We<P;++We){let at=We-ne,Ot=Math.max(0,Math.ceil(at/H)),un=Math.min(W,(D+at)/H);for(let Jt=0;Jt<U;++Jt){let Ht=Jt-J,qt=Math.max(0,Math.ceil(Ht/Y)),en=Math.min(K,(O+Ht)/Y),hn=0;for(let jn=Ot;jn<un;++jn){let Ni=jn*H-at;for(let eo=qt;eo<en;++eo){let Hc=eo*Y-Ht,ti=me*Pe+ge*jn+xe*eo,ds=w*(D-1-Ni)+b*(O-1-Hc)+S*Ve;for(let el=0;el<j;++el){let tl=y[ti+Te*el],nl=x[ds+el];hn+=tl*nl}}}let us=oe*Pe+ae*We+de*Jt+le*Ve;g[us]=hn}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var Yj={kernelName:Bl,backendName:"cpu",kernelFunc:cfe};function ufe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r;Q([o,i],"conv3d");let c=_.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:h,padInfo:g}=c,y=g.front,x=g.left,w=g.top,b=new Tt(c.outShape,o.dtype),S=e.data.get(o.dataId).values,E=e.data.get(i.dataId).values,D=b.values,O=v.computeStrides(o.shape),R=v.computeStrides(i.shape);for(let P=0;P<c.batchSize;++P){let U=P*O[0],j=P*b.strides[0];for(let W=0;W<c.outDepth;++W){let K=j+W*b.strides[1],H=W*c.strideDepth-y;for(let Y=0;Y<u;++Y){let ne=H+Y*f;if(ne<0||ne>=c.inDepth)continue;let J=Y*R[0],te=U+ne*O[1];for(let oe=0;oe<c.outHeight;++oe){let ae=K+oe*b.strides[2],de=oe*c.strideHeight-w;for(let le=0;le<d;++le){let me=de+le*m;if(me<0||me>=c.inHeight)continue;let ge=J+le*R[1],xe=te+me*O[2];for(let Te=0;Te<c.outWidth;++Te){let Pe=ae+Te*c.outChannels,Ve=Te*c.strideWidth-x;for(let We=0;We<p;++We){let at=Ve+We*h;if(at<0||at>=c.inWidth)continue;let Ot=ge+We*R[2],un=xe+at*c.inChannels,Jt=Ot;for(let Ht=0;Ht<c.inChannels;++Ht){let qt=S[un+Ht];for(let en=0;en<c.outChannels;++en)D[Pe+en]+=qt*E[Jt+en];Jt+=c.outChannels}}}}}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var Zj={kernelName:zl,backendName:"cpu",kernelFunc:ufe};function dfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r;Q([o,i],"conv3dBackpropFilterV2");let c=v.computeStrides(o.shape),u=v.computeStrides(i.shape),d=_.computeConv3DInfo(o.shape,l,s,1,a),p=d.strideDepth,f=d.strideHeight,m=d.strideWidth,h=d.filterDepth,g=d.filterHeight,y=d.filterWidth,x=new Tt(d.filterShape,"float32"),w=x.values,[b,S,E,D]=x.strides,O=e.data.get(i.dataId).values,[R,P,U,j]=u,W=e.data.get(o.dataId).values,[K,H,Y,ne]=c,J=d.padInfo.front,te=d.padInfo.left,oe=d.padInfo.top;for(let ae=0;ae<h;++ae){let de=Math.max(0,Math.ceil((J-ae)/p)),le=Math.min(d.outDepth,(d.inDepth+J-ae)/p),me=ae*b;for(let ge=0;ge<g;++ge){let xe=Math.max(0,Math.ceil((oe-ge)/f)),Te=Math.min(d.outHeight,(d.inHeight+oe-ge)/f),Pe=ge*S+me;for(let Ve=0;Ve<y;++Ve){let We=Math.max(0,Math.ceil((te-Ve)/m)),at=Math.min(d.outWidth,(d.inWidth+te-Ve)/m),Ot=Ve*E+Pe;for(let un=0;un<d.inChannels;++un){let Jt=un*D+Ot;for(let Ht=0;Ht<d.outChannels;++Ht){let qt=0;for(let en=0;en<d.batchSize;++en){let hn=en*K,us=en*R;for(let jn=de;jn<le;++jn){let eo=(ae+jn*p-J)*H+hn,Hc=jn*P+us;for(let ti=xe;ti<Te;++ti){let el=(ge+ti*f-oe)*Y+eo,tl=ti*U+Hc;for(let nl=We;nl<at;++nl){let HI=(Ve+nl*m-te)*ne+el,qI=nl*j+tl;qt+=W[HI+un]*O[qI+Ht]}}}}w[Jt+Ht]=qt}}}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var Qj={kernelName:bf,backendName:"cpu",kernelFunc:dfe};function pfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r;Q([o],"conv3dBackpropInputV2");let c=v.computeStrides(o.shape),u=v.computeStrides(i.shape),d=_.computeConv3DInfo(l,i.shape,a,1,s),p=new Tt(d.inShape,"float32"),f=p.values,[m,h,g,y]=p.strides,x=e.data.get(o.dataId).values,[w,b,S,E]=c,D=e.data.get(i.dataId).values,[O,R,P,U]=u,{batchSize:j,filterDepth:W,filterHeight:K,filterWidth:H,inChannels:Y,inDepth:ne,inHeight:J,inWidth:te,outChannels:oe,outDepth:ae,outHeight:de,outWidth:le,strideDepth:me,strideHeight:ge,strideWidth:xe}=d,Te=W-1-d.padInfo.front,Pe=K-1-d.padInfo.top,Ve=H-1-d.padInfo.left;for(let We=0;We<j;++We)for(let at=0;at<Y;++at)for(let Ot=0;Ot<ne;++Ot){let un=Ot-Te,Jt=Math.max(0,Math.ceil(un/me)),Ht=Math.min(ae,(W+un)/me);for(let qt=0;qt<J;++qt){let en=qt-Pe,hn=Math.max(0,Math.ceil(en/ge)),us=Math.min(de,(K+en)/ge);for(let jn=0;jn<te;++jn){let Ni=jn-Ve,eo=Math.max(0,Math.ceil(Ni/xe)),Hc=Math.min(le,(H+Ni)/xe),ti=0;for(let ds=Jt;ds<Ht;++ds){let el=ds*me-un;for(let tl=hn;tl<us;++tl){let nl=tl*ge-en;for(let Hm=eo;Hm<Hc;++Hm){let HI=Hm*xe-Ni,qI=w*We+b*ds+S*tl+E*Hm,l6=O*(W-1-el)+R*(K-1-nl)+P*(H-1-HI)+U*at;for(let zy=0;zy<oe;++zy){let c6=x[qI+zy],u6=D[l6+zy];ti+=c6*u6}}}}f[m*We+h*Ot+g*qt+y*jn+at]=ti}}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var Jj={kernelName:wf,backendName:"cpu",kernelFunc:pfe};var ffe=Ae(Xs,t=>Math.cos(t)),e4={kernelName:Xs,backendName:"cpu",kernelFunc:ffe};var mfe=Ae(Ys,t=>Math.cosh(t)),t4={kernelName:Ys,backendName:"cpu",kernelFunc:mfe};function hfe(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,p,f]=o.shape,m=i.shape[0],[h,g]=a,y=Ie([m,h,g,f],"float32"),x=e.data.get(i.dataId).values,w=e.data.get(s.dataId).values,b=e.data.get(o.dataId).values,S=v.computeStrides(o.shape),E=v.computeStrides(y.shape);for(let D=0;D<m;D++){let O=D*4,R=x[O],P=x[O+1],U=x[O+2],j=x[O+3],W=w[D];if(W>=u)continue;let K=h>1?(U-R)*(d-1)/(h-1):0,H=g>1?(j-P)*(p-1)/(g-1):0;for(let Y=0;Y<h;Y++){let ne=h>1?R*(d-1)+Y*K:.5*(R+U)*(d-1);if(ne<0||ne>d-1){for(let J=0;J<g;J++)for(let te=0;te<f;te++){let oe=te+J*E[2]+Y*E[1]+D*E[0];y.values[oe]=c}continue}if(l==="bilinear"){let J=Math.floor(ne),te=Math.ceil(ne),oe=ne-J;for(let ae=0;ae<g;ae++){let de=g>1?P*(p-1)+ae*H:.5*(P+j)*(p-1);if(de<0||de>p-1){for(let xe=0;xe<f;xe++){let Te=xe+ae*E[2]+Y*E[1]+D*E[0];y.values[Te]=c}continue}let le=Math.floor(de),me=Math.ceil(de),ge=de-le;for(let xe=0;xe<f;xe++){let Te=xe+le*S[2]+J*S[1]+W*S[0],Pe=b[Te];Te=xe+me*S[2]+J*S[1]+W*S[0];let Ve=b[Te];Te=xe+le*S[2]+te*S[1]+W*S[0];let We=b[Te];Te=xe+me*S[2]+te*S[1]+W*S[0];let at=b[Te],Ot=Pe+(Ve-Pe)*ge,un=We+(at-We)*ge;Te=xe+ae*E[2]+Y*E[1]+D*E[0],y.values[Te]=Ot+(un-Ot)*oe}}}else for(let J=0;J<g;++J){let te=g>1?P*(p-1)+J*H:.5*(P+j)*(p-1);if(te<0||te>p-1){for(let de=0;de<f;de++){let le=de+J*E[2]+Y*E[1]+D*E[0];y.values[le]=c}continue}let oe=Math.round(te),ae=Math.round(ne);for(let de=0;de<f;de++){let le=de+oe*S[2]+ae*S[1]+W*S[0],me=de+J*E[2]+Y*E[1]+D*E[0];y.values[me]=b[le]}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}var n4={kernelName:nb,backendName:"cpu",kernelFunc:hfe};function gfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;Q(o,"cumsum");let l=_.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=pn({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=_.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=Cn(c.dtype,"int32"),p=v.makeZerosTypedArray(v.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],h=a?(y,x)=>y+m-x-1:(y,x)=>y+x;for(let y=0;y<f.length;y+=m)for(let x=0;x<m;x++){let w=h(y,x);if(x===0)p[w]=s?0:f[w];else{let b=h(y,x-1);p[w]=s?f[b]+p[b]:f[w]+p[b]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let y=_.getUndoAxesPermutation(l),x=pn({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),x}return g}var r4={kernelName:Ul,backendName:"cpu",kernelFunc:gfe};function yfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Dm(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=Ww(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var o4={kernelName:rb,backendName:"cpu",kernelFunc:yfe};function xfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;v.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`),v.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*i,p=c*i,f=u/(i*i),m=e.data.get(o.dataId).values,h=new Float32Array(a*d*p*f),g=0;for(let y=0;y<a;++y)for(let x=0;x<d;++x){let w=Math.floor(x/i),b=x%i;for(let S=0;S<p;++S){let E=Math.floor(S/i),D=S%i,O=(b*i+D)*f;for(let R=0;R<f;++R){let U=R+O+u*(E+c*(w+l*y));h[g++]=m[U]}}}return e.makeTensorInfo([a,d,p,f],o.dtype,h)}var i4={kernelName:Cf,backendName:"cpu",kernelFunc:xfe};function lk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r;Q([o,i],"depthwiseConv2DNative");let u=v.computeStrides(o.shape),d=v.computeStrides(i.shape),p=l;p==null&&(p=[1,1]),v.assert(_.eitherStridesOrDilationsAreOne(s,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`);let f=_.computeConv2DInfo(o.shape,i.shape,s,p,a,c,!0),{filterHeight:m,filterWidth:h,dilationHeight:g,dilationWidth:y,padInfo:x}=f,w=x.left,b=x.top,S=f.outChannels/f.inChannels,E=new Tt(f.outShape,o.dtype),D=e.data.get(o.dataId).values,O=e.data.get(i.dataId).values,R=E.values;for(let P=0;P<f.batchSize;++P){let U=P*u[0],j=P*E.strides[0];for(let W=0;W<f.outHeight;++W){let K=j+W*E.strides[1],H=W*f.strideHeight-b;for(let Y=0;Y<m;++Y){let ne=H+Y*g;if(ne<0||ne>=f.inHeight)continue;let J=Y*d[0],te=U+ne*u[1];for(let oe=0;oe<f.outWidth;++oe){let ae=K+oe*E.strides[2],de=oe*f.strideWidth-w;for(let le=0;le<h;++le){let me=de+le*y;if(me<0||me>=f.inWidth)continue;let ge=J+le*d[1],xe=te+me*f.inChannels,Te=ae,Pe=ge;for(let Ve=0;Ve<f.inChannels;++Ve){let We=D[xe+Ve];for(let at=0;at<S;++at)R[Te+at]+=We*O[Pe+at];Te+=S,Pe+=S}}}}}}return e.makeTensorInfo(E.shape,E.dtype,E.values)}var s4={kernelName:jl,backendName:"cpu",kernelFunc:lk};function vfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;Q([o,i],"depthwiseConv2dNativeBackpropFilter");let d=_.computeConv2DInfo(o.shape,u,s,a,l,c,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:h}=d,g=new Tt(d.filterShape,"float32"),y=d.padInfo.left,x=d.padInfo.top,w=d.outChannels/d.inChannels,b=e.data.get(o.dataId).values,S=new Tt(o.shape,o.dtype,b),E=e.data.get(i.dataId).values,D=new Tt(i.shape,i.dtype,E);for(let O=0;O<m;++O){let R=Math.max(0,Math.ceil((x-O)/p)),P=Math.min(d.outHeight,(d.inHeight+x-O)/p);for(let U=0;U<h;++U){let j=Math.max(0,Math.ceil((y-U)/f)),W=Math.min(d.outWidth,(d.inWidth+y-U)/f);for(let K=0;K<d.outChannels;++K){let H=Math.trunc(K/w),Y=K%w,ne=0;for(let J=0;J<d.batchSize;++J)for(let te=R;te<P;++te){let oe=O+te*p-x;for(let ae=j;ae<W;++ae){let de=U+ae*f-y;ne+=S.get(J,oe,de,H)*D.get(J,te,ae,K)}}g.set(ne,O,U,H,Y)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var a4={kernelName:If,backendName:"cpu",kernelFunc:vfe};function bfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;Q([o,i],"depthwiseConv2DNativeBackpropInput");let d=v.computeStrides(o.shape),p=v.computeStrides(i.shape),f=_.computeConv2DInfo(u,i.shape,s,a,l,c,!0),m=new Tt(f.inShape,"float32"),h=m.values,[g,y,x]=m.strides,w=e.data.get(o.dataId).values,[b,S,E]=d,D=e.data.get(i.dataId).values,[O,R,P]=p,{batchSize:U,filterHeight:j,filterWidth:W,inChannels:K,inHeight:H,inWidth:Y,outChannels:ne,outHeight:J,outWidth:te,strideHeight:oe,strideWidth:ae}=f,de=j-1-f.padInfo.top,le=W-1-f.padInfo.left,me=ne/K;for(let ge=0;ge<U;++ge)for(let xe=0;xe<K;++xe)for(let Te=0;Te<H;++Te){let Pe=Te-de,Ve=Math.max(0,Math.ceil(Pe/oe)),We=Math.min(J,(j+Pe)/oe);for(let at=0;at<Y;++at){let Ot=at-le,un=Math.max(0,Math.ceil(Ot/ae)),Jt=Math.min(te,(W+Ot)/ae),Ht=0;for(let qt=Ve;qt<We;++qt){let en=qt*oe-Pe;for(let hn=un;hn<Jt;++hn){let us=hn*ae-Ot,jn=b*ge+S*qt+E*hn,Ni=O*(j-1-en)+R*(W-1-us)+P*xe;for(let eo=0;eo<me;++eo){let Hc=xe*me+eo,ti=w[jn+Hc],ds=D[Ni+eo];Ht+=ti*ds}}}h[g*ge+y*Te+x*at+xe]=Ht}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var l4={kernelName:Sf,backendName:"cpu",kernelFunc:bfe};function wfe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=v.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=Ie([o,o],r.dtype),a=s.values;for(let c=0;c<i.length;c++)a[c*o+c]=i[c];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var c4={kernelName:ob,backendName:"cpu",kernelFunc:wfe};var u4={kernelName:Gl,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o}=t,{strides:i,pad:s,dilations:a}=e,l=n,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:f,inHeight:m,inWidth:h,inChannels:g,outHeight:y,outWidth:x,padInfo:w,strideHeight:b,strideWidth:S,filterHeight:E,filterWidth:D,dilationHeight:O,dilationWidth:R,outShape:P}=_.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),U=v.sizeFromShape(P),j=P.length,W=v.getArrayFromDType(r.dtype,U);for(let H=0;H<f;++H)for(let Y=0;Y<y;++Y){let ne=Y*b-w.top;for(let J=0;J<x;++J){let te=J*S-w.left;for(let oe=0;oe<g;++oe){let ae=Number.MIN_SAFE_INTEGER;for(let le=0;le<E;++le){let me=ne+le*O;if(me>=0&&me<m)for(let ge=0;ge<D;++ge){let xe=te+ge*R;if(xe>=0&&xe<h){let Te=v.locToIndex([H,me,xe,oe],u,v.computeStrides(r.shape)),Pe=v.locToIndex([le,ge,oe],p,v.computeStrides(o.shape)),Ve=c[Te]+d[Pe];Ve>ae&&(ae=Ve)}}}let de=v.locToIndex([H,Y,J,oe],j,v.computeStrides(P));W[de]=ae}}}return{dataId:l.write(v.toTypedArray(W,r.dtype),P,r.dtype),shape:P,dtype:r.dtype}}};var d4={kernelName:Mg,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=v.toNestedArray(r.shape,c.data.get(r.dataId).values),d=v.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:y,padInfo:x,strideHeight:w,strideWidth:b,filterHeight:S,filterWidth:E,dilationHeight:D,dilationWidth:O,outShape:R}=_.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);v.assert(i.rank===R.length,()=>`Error in ${Mg}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let P=v.toNestedArray(R,c.data.get(i.dataId).values),U=v.makeZerosNestedTypedArray(o.shape,o.dtype);for(let W=0;W<p;++W)for(let K=0;K<g;++K){let H=K*w-x.top;for(let Y=0;Y<y;++Y){let ne=Y*b-x.left;for(let J=0;J<h;++J){let te=Number.MIN_SAFE_INTEGER,oe=0,ae=0;for(let de=0;de<S;++de){let le=H+de*D;if(le>=0&&le<f)for(let me=0;me<E;++me){let ge=ne+me*O;if(ge>=0&&ge<m){let xe=u[W][le][ge][J]+d[de][me][J];xe>te&&(te=xe,oe=de,ae=me)}}}U[oe][ae][J]+=P[W][K][Y][J]}}}return{dataId:c.write(v.toTypedArray(U,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var p4={kernelName:Og,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=v.toNestedArray(r.shape,c.data.get(r.dataId).values),d=v.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:y,padInfo:x,strideHeight:w,strideWidth:b,filterHeight:S,filterWidth:E,dilationHeight:D,dilationWidth:O,outShape:R}=_.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);v.assert(i.rank===R.length,()=>`Error in ${Og}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let P=v.toNestedArray(R,c.data.get(i.dataId).values),U=v.makeZerosNestedTypedArray(r.shape,r.dtype);for(let W=0;W<p;++W)for(let K=0;K<g;++K){let H=K*w-x.top;for(let Y=0;Y<y;++Y){let ne=Y*b-x.left;for(let J=0;J<h;++J){let te=Number.MIN_SAFE_INTEGER,oe=H<0?0:H,ae=ne<0?0:ne;for(let de=0;de<S;++de){let le=H+de*D;if(le>=0&&le<f)for(let me=0;me<E;++me){let ge=ne+me*O;if(ge>=0&&ge<m){let xe=u[W][le][ge][J]+d[de][me][J];xe>te&&(te=xe,oe=le,ae=ge)}}}U[W][oe][ae][J]+=P[W][K][Y][J]}}}return{dataId:c.write(v.toTypedArray(U,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function Ya(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"sum");let a;o.dtype==="bool"?a=Xo({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=Jn({inputs:{x:o},backend:e});let l=a.shape.length,c=v.parseAxisParam(i,a.shape),u=_.getAxesPermutation(c,l),d=c,p=a;u!=null&&(p=pn({inputs:{x:a},backend:e,attrs:{perm:u}}),d=_.getInnerMostAxes(d.length,l)),_.assertAxesAreInnerMostDims("sum",d,p.shape.length);let[f,m]=_.computeOutAndReduceShapes(p.shape,d),h=_.upcastType(p.dtype,"int32"),g=Em(e,f,h),y=v.sizeFromShape(m),x=e.data.get(g.dataId).values,w=e.data.get(p.dataId).values;for(let b=0;b<x.length;++b){let S=b*y,E=0;for(let D=0;D<y;++D)E+=w[S+D];x[b]=E}if(s){let b=_.expandShapeToKeepDim(g.shape,c),S=g;g=et({inputs:{x:g},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(S)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(p),g}var f4={kernelName:mc,backendName:"cpu",kernelFunc:Ya};function Cfe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=_.decodeEinsumEquation(o,i.length);_.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=_.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:y,expandDims:x}=_.getEinsumPermutation(f,l[g]),w;_.isIdentityPermutation(y)?w=i[g]:(w=pn({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),m.push(w));let b=w.shape.slice();for(let S=0;S<x.length;++S)b.splice(x[S],0,1);v.arraysEqual(w.shape,b)||(w=et({inputs:{x:w},backend:e,attrs:{shape:b}}),m.push(w)),p===null?p=w:(p=Ad({inputs:{a:w,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=Ya({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var m4={kernelName:ib,backendName:"cpu",kernelFunc:Cfe};function Ife(t){let{inputs:n,backend:e}=t,{dy:r,y:o}=n;Q([r,o],"eluGrad");let i=new Float32Array(v.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let c=s[l];c>=1?i[l]=a[l]:i[l]=a[l]*(c+1)}return e.makeTensorInfo(o.shape,"float32",i)}var h4={kernelName:Tf,backendName:"cpu",kernelFunc:Ife};var Sfe=Je((t,n)=>t===n?1:0),ck=ut(Bu,Sfe,null,"bool"),g4={kernelName:Bu,backendName:"cpu",kernelFunc:ck};var Tfe=_.ERF_P,Efe=_.ERF_A1,_fe=_.ERF_A2,Dfe=_.ERF_A3,Nfe=_.ERF_A4,kfe=_.ERF_A5,Afe=Ae(Js,t=>{let n=Math.sign(t),e=Math.abs(t),r=1/(1+Tfe*e);return n*(1-((((kfe*r+Nfe)*r+Dfe)*r+_fe)*r+Efe)*r*Math.exp(-e*e))}),y4={kernelName:Js,backendName:"cpu",kernelFunc:Afe};function Rm(t){let{inputs:n,backend:e,attrs:r}=t,{input:o}=n,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(v.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),et({inputs:{x:o},backend:e,attrs:{shape:a}})}var x4={kernelName:Wl,backendName:"cpu",kernelFunc:Rm};var Rfe=Je((t,n)=>t/n),Sy=ut(Zs,Rfe),Ty={kernelName:Zs,backendName:"cpu",kernelFunc:Sy};function iC(t,n,e){let r=t.shape,o=r[0],i=r[1],s=e.data.get(t.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[o,i],u=v.sizeFromShape(c),d=v.getTypedArrayFromDType("float32",u),p=v.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let y=Qo({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),x=Qo({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),w=In({inputs:{real:y,imag:x},backend:e}),{real:b,imag:S}=Ofe(w,n,e),E=_.mergeRealAndImagArrays(b,S);for(let D=0;D<i;D++){let O=_.getComplexWithIndex(E,D);d[g*i+D]=O.real,p[g*i+D]=O.imag}e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(w)}let f=e.makeTensorInfo(c,"float32",d),m=e.makeTensorInfo(c,"float32",p),h=In({inputs:{real:f,imag:m},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),h}function Ofe(t,n,e){let r=v.sizeFromShape(t.shape),o=e.data.get(t.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(Mfe(r)){let a=uk(i,s,r,n,e),l=[t.shape[0],t.shape[1]];if(n){let c=e.makeTensorInfo(l,"float32",a.real),u=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",v.createScalarValue(r,"float32")),p=Jn({inputs:{x:d},backend:e}),f=Ty.kernelFunc({inputs:{a:c,b:d},backend:e}),m=Ty.kernelFunc({inputs:{a:u,b:p},backend:e}),h=e.data.get(f.dataId).values,g=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),{real:h,imag:g}}return a}else{let a=_.mergeRealAndImagArrays(i,s),l=Ffe(a,r,n);return _.splitRealAndImagArrays(l)}}function Mfe(t){return(t&t-1)===0}function uk(t,n,e,r,o){if(e===1)return{real:t,imag:n};let i=_.mergeRealAndImagArrays(t,n),s=e/2,a=_.complexWithEvenIndex(i),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),p=o.makeTensorInfo(u,"float32",c),f=In({inputs:{real:d,imag:p},backend:o}),m=_.complexWithOddIndex(i),h=m.real,g=m.imag,y=[h.length],x=o.makeTensorInfo(y,"float32",h),w=o.makeTensorInfo(y,"float32",g),b=In({inputs:{real:x,imag:w},backend:o}),S=uk(l,c,s,r,o),E=S.real,D=S.imag,O=[E.length],R=o.makeTensorInfo(O,"float32",E),P=o.makeTensorInfo(O,"float32",D),U=In({inputs:{real:R,imag:P},backend:o}),j=uk(h,g,s,r,o),W=j.real,K=j.imag,H=[W.length],Y=o.makeTensorInfo(H,"float32",W),ne=o.makeTensorInfo(H,"float32",K),J=In({inputs:{real:Y,imag:ne},backend:o}),te=_.exponents(e,r),oe=[te.real.length],ae=o.makeTensorInfo(oe,"float32",te.real),de=o.makeTensorInfo(oe,"float32",te.imag),le=In({inputs:{real:ae,imag:de},backend:o}),me=Ad({inputs:{a:le,b:J},backend:o}),ge=Xa({inputs:{a:U,b:me},backend:o}),xe=Iy({inputs:{a:U,b:me},backend:o}),Te=Ko({inputs:{input:ge},backend:o}),Pe=Ko({inputs:{input:xe},backend:o}),Ve=as({inputs:{input:ge},backend:o}),We=as({inputs:{input:xe},backend:o}),at=Lc({inputs:[Te,Pe],backend:o,attrs:{axis:0}}),Ot=Lc({inputs:[Ve,We],backend:o,attrs:{axis:0}}),un=o.data.get(at.dataId).values,Jt=o.data.get(Ot.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(x),o.disposeIntermediateTensorInfo(w),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(R),o.disposeIntermediateTensorInfo(P),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(ne),o.disposeIntermediateTensorInfo(J),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(de),o.disposeIntermediateTensorInfo(le),o.disposeIntermediateTensorInfo(me),o.disposeIntermediateTensorInfo(ge),o.disposeIntermediateTensorInfo(xe),o.disposeIntermediateTensorInfo(Te),o.disposeIntermediateTensorInfo(Ve),o.disposeIntermediateTensorInfo(Pe),o.disposeIntermediateTensorInfo(We),o.disposeIntermediateTensorInfo(at),o.disposeIntermediateTensorInfo(Ot),{real:un,imag:Jt}}function Ffe(t,n,e){let r=new Float32Array(n*2);for(let o=0;o<n;o++){let i=0,s=0;for(let a=0;a<n;a++){let l=_.exponent(o*a,n,e),c=_.getComplexWithIndex(t,a);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}e&&(i/=n,s/=n),_.assignToTypedArray(r,i,s,o)}return r}function Pfe(t){let{inputs:n,backend:e}=t,{input:r}=n,o=v.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=et({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=iC(a,!1,e),c=et({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var v4={kernelName:Ef,backendName:"cpu",kernelFunc:Pfe};function Ey(t){let{backend:n,attrs:e}=t,{shape:r,value:o,dtype:i}=e,s=i||v.inferDtype(o),a=v.getArrayFromDType(s,v.sizeFromShape(r));return $fe(a,o,s),n.makeTensorInfo(r,s,a)}var b4={kernelName:_f,backendName:"cpu",kernelFunc:Ey};function $fe(t,n,e){t.fill(n)}var w4={kernelName:sb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,o=e,i=v.getTypedArrayFromDType(r.dtype,v.sizeFromShape(r.shape)),[s,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let p=0;p<s;p++){let f=p*l*a*c;for(let m=0;m<a;m++){let h=m*(l*c);for(let g=0;g<l;g++){let y=g*c;for(let x=0;x<c;x++){let b=[s,m,g,x][2],S=Math.round(l-b),E=f+h+y+x,D=u[E];if(S>=0&&S<l){let O=S*c,R=f+h+O+x;D=u[R]}i[E]=D}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var Lfe=Je((t,n)=>Math.floor(t/n)),Vfe=ut(ra,Lfe,null,"int32"),C4={kernelName:ra,backendName:"cpu",kernelFunc:Vfe};function Bfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=ak({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=Xa({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=km(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var I4={kernelName:Xu,backendName:"cpu",kernelFunc:Bfe};function zfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=lk({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=Xa({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=km(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var S4={kernelName:Yu,backendName:"cpu",kernelFunc:zfe};function Ufe(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=v.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,c,u,d]=_.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(l,r.dtype,[]);let p=Ie([c,u],r.dtype),f=e.data.get(o.dataId).values,m=e.data.get(r.dataId).values;for(let h=0;h<c;h++){let g=[],y=0;for(let x=0;x<a;x++){let w=f[h*a+x];y+=w*d[x],g.push(w)}if(y<0||y>=i/u)throw new Error(`Invalid indices: ${g} does not index into ${r.shape}`);for(let x=0;x<u;x++)p.values[h*u+x]=m[y*u+x]}return e.makeTensorInfo(l,p.dtype,p.values)}var T4={kernelName:ab,backendName:"cpu",kernelFunc:Ufe};function jfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r;Q([o,i],"gatherV2");let l=a;a==null&&(l=0);let c=v.sizeFromShape(i.shape),u=v.parseAxisParam(s,o.shape)[0],d=_.segment_util.collectGatherOpShapeInfo(o,i,u,l),p=et({inputs:{x:o},backend:e,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=et({inputs:{x:i},backend:e,attrs:{shape:[d.batchSize,c/d.batchSize]}}),m=[d.batchSize,d.outerSize,c/d.batchSize,d.sliceSize],h=e.bufferSync(f),g=e.bufferSync(p),y=qw(g,h,m);return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.makeTensorInfo(d.outputShape,y.dtype,y.values)}var E4={kernelName:ql,backendName:"cpu",kernelFunc:jfe};var Gfe=Je((t,n)=>t>=n?1:0),Wfe=ut(oa,Gfe,null,"bool"),_4={kernelName:oa,backendName:"cpu",kernelFunc:Wfe};function Hfe(t){let{inputs:n,backend:e}=t,{input:r}=n,o=v.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=et({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=iC(a,!0,e),c=et({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var D4={kernelName:Df,backendName:"cpu",kernelFunc:Hfe};var qfe=Ae(ia,t=>Number.isFinite(t)?1:0,"bool"),N4={kernelName:ia,backendName:"cpu",kernelFunc:qfe};var Kfe=Ae(sa,t=>Math.abs(t)===1/0?1:0,"bool"),k4={kernelName:sa,backendName:"cpu",kernelFunc:Kfe};var Xfe=Ae(aa,t=>Number.isNaN(t)?1:0,"bool"),A4={kernelName:aa,backendName:"cpu",kernelFunc:Xfe};var Yfe=Je((t,n)=>t<=n?1:0),Zfe=ut(ju,Yfe,null,"bool"),R4={kernelName:ju,backendName:"cpu",kernelFunc:Zfe};function Qfe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=Kw(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var O4={kernelName:lb,backendName:"cpu",kernelFunc:Qfe};var Jfe=Ae(ca,t=>Math.log1p(t)),M4={kernelName:ca,backendName:"cpu",kernelFunc:Jfe};var eme=Je((t,n)=>t&&n),tme=ut(Gu,eme,null,"bool"),F4={kernelName:Gu,backendName:"cpu",kernelFunc:tme};var nme=Ae(Wu,t=>t?0:1,"bool"),P4={kernelName:Wu,backendName:"cpu",kernelFunc:nme};var rme=Je((t,n)=>t||n),ome=ut(Hu,rme,null,"bool"),$4={kernelName:Hu,backendName:"cpu",kernelFunc:ome};function ime(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r;Q(o,"LRN");let c=o.shape[3],u=c-1,d=e.data.get(o.dataId).values,p=v.sizeFromShape(o.shape),f=new Float32Array(p);function m(h){let g=h%c,y=h-g+Math.max(0,g-i),x=h-g+Math.min(g+i,u),w=0;for(;y<=x;y++){let b=d[y];w+=b*b}return w}for(let h=0;h<p;h++){let g=m(h),y=d[h]*Math.pow(s+a*g,-l);f[h]=y}return e.makeTensorInfo(o.shape,o.dtype,f)}var L4={kernelName:Xl,backendName:"cpu",kernelFunc:ime};function sme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r;Q(s,"LRNGrad");let d=v.sizeFromShape(s.shape),p=s.shape[3],f=e.data.get(s.dataId).values,m=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values,g=new Float32Array(d),y=d;for(let x=0;x<y;x++){let w=x%p,b=x-w+Math.max(0,w-a),S=x-w+Math.min(p,w+a+1),E=0;for(let D=b;D<S;D++)E+=Math.pow(m[D],2);E=c*E+l;for(let D=b;D<S;D++){let O=-2*c*u*m[D]*h[x]/E;x===D&&(O+=Math.pow(E,-u)),O*=f[x],g[D]+=O}}return e.makeTensorInfo(s.shape,o.dtype,g)}var V4={kernelName:kf,backendName:"cpu",kernelFunc:sme};function dk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,c=l.length,u=v.parseAxisParam(i,l),d=u,p=_.getAxesPermutation(d,c),f=a.data.get(o.dataId).values;if(p!=null){let b=new Array(c);for(let S=0;S<b.length;S++)b[S]=l[p[S]];f=Nm(f,l,o.dtype,p,b),d=_.getInnerMostAxes(d.length,c),l=b}Q(o,"max"),_.assertAxesAreInnerMostDims("max",d,c);let[m,h]=_.computeOutAndReduceShapes(l,d),g=v.sizeFromShape(h),y=Xw(f,g,m,o.dtype),x=a.write(y,m,o.dtype),w=m;return s&&(w=_.expandShapeToKeepDim(m,u)),{dataId:x,shape:w,dtype:o.dtype}}var B4={kernelName:Yl,backendName:"cpu",kernelFunc:dk};function ame(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Q(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;v.assert(_.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=_.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&v.arraysEqual(u.inShape,u.outShape))d=Jn({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=v.computeStrides(o.shape),m=Am(p,o.shape,o.dtype,f,u,"max");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var z4={kernelName:Zl,backendName:"cpu",kernelFunc:ame};function lme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;Q(o,"maxPool3d");let u=_.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=oC(d,o.shape,o.dtype,v.computeStrides(o.shape),u,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var U4={kernelName:Ql,backendName:"cpu",kernelFunc:lme};function cme(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;Q([o,i],"maxPool3DGrad");let u=_.computePool3DInfo(i.shape,s,a,1,l,c),d=e.bufferSync(i),p=Pj(d,u),f=u.strideDepth,m=u.strideHeight,h=u.strideWidth,g=u.dilationDepth,y=u.dilationHeight,x=u.dilationWidth,w=u.effectiveFilterDepth,b=u.effectiveFilterHeight,S=u.effectiveFilterWidth,E=w-1-u.padInfo.front,D=S-1-u.padInfo.left,O=b-1-u.padInfo.top,R=Ie(i.shape,"float32"),P=e.bufferSync(o);for(let U=0;U<u.batchSize;++U)for(let j=0;j<u.inChannels;++j)for(let W=0;W<u.inDepth;++W)for(let K=0;K<u.inHeight;++K)for(let H=0;H<u.inWidth;++H){let Y=W-E,ne=K-O,J=H-D,te=0;for(let oe=0;oe<w;oe+=g){let ae=(Y+oe)/f;if(!(ae<0||ae>=u.outDepth||Math.floor(ae)!==ae))for(let de=0;de<b;de+=y){let le=(ne+de)/m;if(!(le<0||le>=u.outHeight||Math.floor(le)!==le))for(let me=0;me<S;me+=x){let ge=(J+me)/h;if(ge<0||ge>=u.outWidth||Math.floor(ge)!==ge)continue;let xe=w*b*S-1-p.get(U,ae,le,ge,j),Te=oe*b*S+de*S+me,Pe=xe===Te?1:0;if(Pe===0)continue;let Ve=P.get(U,ae,le,ge,j);te+=Ve*Pe}}}R.set(te,U,W,K,H,j)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}var j4={kernelName:Rf,backendName:"cpu",kernelFunc:cme};function ume(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;Q([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=_.computePool2DInfo(a.shape,l,c,1,u,d),f=e.data.get(a.dataId).values,m=Ie(p.outShape,a.dtype,rC(f,a.shape,a.dtype,p).values),h=p.strideHeight,g=p.strideWidth,y=p.dilationHeight,x=p.dilationWidth,w=p.effectiveFilterHeight,b=p.effectiveFilterWidth,S=b-1-p.padInfo.left,E=w-1-p.padInfo.top,D=Ie(a.shape,"float32"),O=e.data.get(o.dataId).values,R=Ie(o.shape,"float32",O);for(let P=0;P<p.batchSize;++P)for(let U=0;U<p.inChannels;++U)for(let j=0;j<p.inHeight;++j)for(let W=0;W<p.inWidth;++W){let K=j-E,H=W-S,Y=0;for(let ne=0;ne<w;ne+=y){let J=(K+ne)/h;if(!(J<0||J>=p.outHeight||Math.floor(J)!==J))for(let te=0;te<b;te+=x){let oe=(H+te)/g;if(oe<0||oe>=p.outWidth||Math.floor(oe)!==oe)continue;let ae=w*b-1-m.get(P,J,oe,U),de=ne*b+te,le=ae===de?1:0;if(le===0)continue;let me=R.get(P,J,oe,U);Y+=me*le}}D.set(Y,P,j,W,U)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}var G4={kernelName:Af,backendName:"cpu",kernelFunc:ume};function W4(t,n,e,r,o){let i=v.computeStrides(n),s=Am(t,n,e,i,o,"max"),a=rC(t,n,e,o,!0,r);return[s.values,a.values]}var H4={kernelName:cb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;Q(r,"MaxPoolWithArgmax");let c=l.data.get(r.dataId).values,u=_.computePool2DInfo(r.shape,o,i,[1,1],s),[d,p]=W4(c,r.shape,r.dtype,a,u),f=l.write(d,u.outShape,r.dtype),m=l.write(p,u.outShape,r.dtype);return[{dataId:f,shape:u.outShape,dtype:r.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};function dme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=v.parseAxisParam(i,o.shape),c=_.computeOutAndReduceShapes(o.shape,a)[1],u=v.sizeFromShape(c),d=[],p=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(p);let f=Xo({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});d.push(f);let m=Sy({inputs:{a:f,b:p},backend:e});d.push(m);let h=Ya({inputs:{x:m},backend:e,attrs:{axis:i,keepDims:s}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),h}var q4={kernelName:Jl,backendName:"cpu",kernelFunc:dme};function pme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Q(o,"min");let a=v.parseAxisParam(i,o.shape),l=a,c=_.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=_.getInnerMostAxes(l.length,o.shape.length)),_.assertAxesAreInnerMostDims("min",l,u.shape.length);let[d,p]=_.computeOutAndReduceShapes(u.shape,l),f=v.sizeFromShape(p),m=v.makeZerosTypedArray(v.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){let x=y*f,w=h[x];for(let b=0;b<f;++b){let S=h[x+b];S<w&&(w=S)}m[y]=w}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let y=_.expandShapeToKeepDim(d,a),x=et({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),x}return g}var K4={kernelName:ec,backendName:"cpu",kernelFunc:pme};function fme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,mode:s}=r;Q(o,"mirrorPad");let a=i.map((w,b)=>w[0]+o.shape[b]+w[1]),l=i.map(w=>w[0]),c=i.map((w,b)=>w[0]+o.shape[b]),u=s==="reflect"?0:1,d=e.data.get(o.dataId).values,p=o.shape.length,f=v.computeStrides(o.shape),m=v.sizeFromShape(a),h=a.length,g=v.computeStrides(a),y=v.getTypedArrayFromDType(o.dtype,m);for(let w=0;w<m;w++){let b=v.indexToLoc(w,h,g);for(let E=0;E<h;E++)b[E]<l[E]?b[E]=l[E]*2-b[E]-u:b[E]>=c[E]&&(b[E]=(c[E]-1)*2-b[E]+u);b=b.map((E,D)=>E-l[D]);let S=v.locToIndex(b,p,f);y[w]=d[S]}return{dataId:e.write(y,a,o.dtype),shape:a,dtype:o.dtype}}var X4={kernelName:tc,backendName:"cpu",kernelFunc:fme};var mme=Je((t,n)=>{let e=t%n;return t<0&&n<0||t>=0&&n>=0?e:(e+n)%n}),hme=ut(pa,mme),Y4={kernelName:pa,backendName:"cpu",kernelFunc:hme};var fG=qm(dG());function xk(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=v.parseAxisParam([a],o.shape),c=dk({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=_.expandShapeToKeepDim(c.shape,l),d=et({inputs:{x:c},backend:e,attrs:{shape:u}}),p=Iy({inputs:{a:o,b:d},backend:e}),f=LN({inputs:{x:p},backend:e}),m=Ya({inputs:{x:f},backend:e,attrs:{axis:l,keepDims:!1}}),h=et({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Sy({inputs:{a:f,b:h},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var pG={kernelName:yc,backendName:"cpu",kernelFunc:xk};function Cme(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r;Q(o,"multinomial");let l=a?o:xk({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,p=[c,i],f=v.makeZerosTypedArray(v.sizeFromShape(p),"int32");for(let m=0;m<c;++m){let h=m*u,g=new Float32Array(u-1);g[0]=d[h];for(let w=1;w<g.length;++w)g[w]=g[w-1]+d[h+w];let y=fG.alea(s.toString()),x=m*i;for(let w=0;w<i;++w){let b=y();f[x+w]=g.length;for(let S=0;S<g.length;S++)if(b<g[S]){f[x+w]=S;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(p,"int32",f)}var mG={kernelName:ub,backendName:"cpu",kernelFunc:Cme};var Ime=Zn.nonMaxSuppressionV3Impl;function Sme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;Q(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,{selectedIndices:d}=Ime(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var hG={kernelName:db,backendName:"cpu",kernelFunc:Sme};var Tme=Zn.nonMaxSuppressionV4Impl;function Eme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;Q(o,"NonMaxSuppressionPadded");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=Tme(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var gG={kernelName:pb,backendName:"cpu",kernelFunc:Eme};var _me=Zn.nonMaxSuppressionV5Impl;function Dme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;Q(o,"NonMaxSuppressionWithScore");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:y}=_me(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var yG={kernelName:fb,backendName:"cpu",kernelFunc:Dme};function Nme(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r;Q(o,"oneHot");let l=v.sizeFromShape(o.shape),c=new Float32Array(l*i);c.fill(a);let u=e.data.get(o.dataId).values;for(let d=0;d<l;++d)u[d]>=0&&u[d]<i&&(c[d*i+u[d]]=s);return e.makeTensorInfo([...o.shape,i],"int32",c)}var xG={kernelName:oc,backendName:"cpu",kernelFunc:Nme};function _y(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=Ko({inputs:{input:r},backend:e}),i=_y({inputs:{x:o},backend:e}),s=as({inputs:{input:r},backend:e}),a=_y({inputs:{x:s},backend:e}),l=In({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Ey({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var vG={kernelName:wc,backendName:"cpu",kernelFunc:_y};function bG(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=Ko({inputs:{input:r},backend:e}),i=bG({inputs:{x:o},backend:e}),s=as({inputs:{input:r},backend:e}),a=_y({inputs:{x:s},backend:e}),l=In({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Ey({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var wG={kernelName:rc,backendName:"cpu",kernelFunc:bG};function vk(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return Rm({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{v.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),v.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=Rm({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Lc({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var CG={kernelName:ic,backendName:"cpu",kernelFunc:vk};function kme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;Q(o,"pad");let a=i.map((x,w)=>x[0]+o.shape[w]+x[1]),l=i.map(x=>x[0]),c=e.data.get(o.dataId).values,u=v.sizeFromShape(o.shape),d=o.shape.length,p=v.computeStrides(o.shape),f=v.sizeFromShape(a),m=a.length,h=v.computeStrides(a),g=v.getTypedArrayFromDType(o.dtype,f);s!==0&&g.fill(s);for(let x=0;x<u;x++){let b=v.indexToLoc(x,d,p).map((E,D)=>E+l[D]),S=v.locToIndex(b,m,h);g[S]=c[x]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var aC={kernelName:sc,backendName:"cpu",kernelFunc:kme};var Ame=Je((t,n)=>Math.pow(t,n)),Rme=ut(ma,Ame),IG={kernelName:ma,backendName:"cpu",kernelFunc:Rme};function Ome(t){let{backend:n,attrs:e}=t,{start:r,stop:o,dtype:i,step:s}=e,a=Yw(r,o,s,i);return n.makeTensorInfo([a.length],i,a)}var SG={kernelName:Mf,backendName:"cpu",kernelFunc:Ome};var Mme=Ae(ha,t=>1/t),TG={kernelName:ha,backendName:"cpu",kernelFunc:Mme};function Fme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Q(o,"resizeBilinear");let l=v.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(v.sizeFromShape([d,c,u,m])),y=[i&&c>1?p-1:p,i&&u>1?f-1:f],x=[i&&c>1?c-1:c,i&&u>1?u-1:u],w=0,b=y[0]/x[0],S=y[1]/x[1];for(let E=0;E<d;E++)for(let D=0;D<c;D++){let O;s?O=b*(D+.5)-.5:O=b*D;let R=Math.max(0,Math.floor(O)),P=O-R,U=Math.min(p-1,Math.ceil(O)),j=E*l[0]+R*l[1],W=E*l[0]+U*l[1];for(let K=0;K<u;K++){let H;s?H=S*(K+.5)-.5:H=S*K;let Y=Math.max(0,Math.floor(H)),ne=H-Y,J=Math.min(f-1,Math.ceil(H)),te=j+Y*l[2],oe=W+Y*l[2],ae=j+J*l[2],de=W+J*l[2];for(let le=0;le<m;le++){let me=h[te+le],ge=h[oe+le],xe=h[ae+le],Te=h[de+le],Pe=me+(xe-me)*ne,Ve=ge+(Te-ge)*ne,We=Pe+(Ve-Pe)*P;g[w++]=We}}}return e.makeTensorInfo([d,c,u,m],"float32",g)}var EG={kernelName:uc,backendName:"cpu",kernelFunc:Fme};function Pme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Q([i,o],"resizeBilinearGrad");let a=v.computeStrides(o.shape),[l,c,u,d]=o.shape,[,p,f]=i.shape,m=new Float32Array(l*c*u*d),h=[s&&p>1?c-1:c,s&&f>1?u-1:u],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],y=h[0]/g[0],x=h[1]/g[1],w=e.data.get(i.dataId).values,b=0;for(let S=0;S<l;S++){let E=S*a[0];for(let D=0;D<p;D++){let O=D*y,R=Math.floor(O),P=Math.min(Math.ceil(O),c-1),U=E+R*a[1],j=E+P*a[1],W=O-R,K=1-W;for(let H=0;H<f;H++){let Y=H*x,ne=Math.floor(Y),J=Math.min(Math.ceil(Y),u-1),te=Y-ne,oe=1-te,ae=U+ne*a[2],de=U+J*a[2],le=j+ne*a[2],me=j+J*a[2],ge=K*oe,xe=K*te,Te=W*oe,Pe=W*te;for(let Ve=0;Ve<d;Ve++){let We=w[b++];m[ae+Ve]+=We*ge,m[de+Ve]+=We*xe,m[le+Ve]+=We*Te,m[me+Ve]+=We*Pe}}}}return e.makeTensorInfo([l,u,c,d],"float32",m)}var _G={kernelName:$f,backendName:"cpu",kernelFunc:Pme};function $me(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Q(o,"resizeNearestNeighbor");let l=v.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(d*c*u*m),y=[i&&c>1?p-1:p,i&&u>1?f-1:f],x=[i&&c>1?c-1:c,i&&u>1?u-1:u],w=y[0]/x[0],b=y[1]/x[1],S=0;for(let E=0;E<d;E++){let D=E*l[0];for(let O=0;O<c;O++){let R=s?w*(O+.5):w*O,P=Math.min(p-1,i?Math.round(R):Math.floor(R));s&&(P=Math.max(0,P));let U=D+P*l[1];for(let j=0;j<u;j++){let W=s?b*(j+.5):b*j,K=Math.min(f-1,i?Math.round(W):Math.floor(W));s&&(K=Math.max(0,K));let H=U+K*l[2];for(let Y=0;Y<m;Y++){let ne=h[H+Y];g[S++]=ne}}}}return e.makeTensorInfo([d,c,u,m],o.dtype,g)}var DG={kernelName:cc,backendName:"cpu",kernelFunc:$me};function Lme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Q([i,o],"resizeNearestNeighborGrad");let a=v.computeStrides(o.shape),l=v.computeStrides(i.shape),[c,u,d,p]=o.shape,[,f,m]=i.shape,h=new Float32Array(c*u*d*p),g=e.data.get(i.dataId).values,y=[s&&f>1?u-1:u,s&&m>1?d-1:d],x=[s&&f>1?f-1:f,s&&m>1?m-1:m],w=y[0]/x[0],b=y[1]/x[1],S=1/w,E=1/b,D=Math.ceil(S)*2+2,O=Math.ceil(E)*2+2;for(let R=0;R<c;R++){let P=R*a[0];for(let U=0;U<u;U++){let j=P+U*a[1],W=Math.floor(U*S),K=Math.floor(W-D/2);for(let H=0;H<d;H++){let Y=j+H*a[2],ne=Math.floor(H*E),J=Math.floor(ne-O/2);for(let te=0;te<p;te++){let oe=0;for(let ae=0;ae<D;ae++){let de=ae+K;if(de<0||de>=f)continue;let le=P+de*l[1],me=de*w,ge=Math.min(u-1,s?Math.round(me):Math.floor(me));if(U===ge)for(let xe=0;xe<O;xe++){let Te=xe+J;if(Te<0||Te>=m)continue;let Pe=le+Te*l[2],Ve=Te*b,We=Math.min(d-1,s?Math.round(Ve):Math.floor(Ve));H===We&&(oe+=g[Pe+te])}}h[Y+te]=oe}}}}return e.makeTensorInfo(o.shape,o.dtype,h)}var NG={kernelName:Pf,backendName:"cpu",kernelFunc:Lme};function Vme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r;Q(o,"reverse");let s=o.shape.length,a=v.parseAxisParam(i,o.shape);if(s===0)return Jn({inputs:{x:o},backend:e});let l=new Tt(o.shape,o.dtype),c=e.bufferSync(o);for(let u=0;u<l.size;u++){let d=l.indexToLoc(u),p=d.slice();a.forEach(f=>p[f]=o.shape[f]-1-p[f]),l.set(c.get(...p),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var kG={kernelName:dc,backendName:"cpu",kernelFunc:Vme};var AG={kernelName:vb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=v.getTypedArrayFromDType(r.dtype,v.sizeFromShape(r.shape)),[c,u,d,p]=r.shape,[f,m]=_.getImageCenter(s,u,d),h=255,g=Math.sin(o),y=Math.cos(o),x=a.data.get(r.dataId).values;for(let b=0;b<c;b++){let S=b*d*u*p;for(let E=0;E<u;E++){let D=E*(d*p);for(let O=0;O<d;O++){let R=O*p;for(let P=0;P<p;P++){let U=[c,E,O,P],j=U[2],W=U[1],K=(j-f)*y-(W-m)*g,H=(j-f)*g+(W-m)*y;K=Math.round(K+f),H=Math.round(H+m);let Y=i;if(typeof i!="number"&&(P===3?Y=h:Y=i[P]),K>=0&&K<d&&H>=0&&H<u){let J=H*(d*p),te=K*p,oe=S+J+te+P;Y=x[oe]}let ne=S+D+R+P;l[ne]=Y}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var Bme=Ae(xa,t=>{let n=Math.floor(t);return t-n<.5?Math.floor(t):t-n>.5?Math.ceil(t):n%2===0?n:n+1}),RG={kernelName:xa,backendName:"cpu",kernelFunc:Bme};function lC(t,n,e,r,o,i,s,a,l,c){let u=[r/o,o],d=t.values,p=n.values;if(r===0)return Ie(e,n.dtype);let f=Ie(u,n.dtype);f.values.fill(l);for(let m=0;m<i;m++){let h=[],g=0;for(let y=0;y<s;y++){let x=d[m*s+y];h.push(x),g+=x*a[y]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${h} does not index into ${e}`);for(let y=0;y<o;y++)c?f.values[g*o+y]+=p[m*o+y]:f.values[g*o+y]=n.rank===0?p[0]:p[m*o+y]}return f}function zme(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=_.calculateShapes(i,o,s),p=!0,f=e.bufferSync(o),m=e.bufferSync(i),h=lC(f,m,s,d,c,l,a,u,0,p);return e.makeTensorInfo(s,h.dtype,h.values)}var OG={kernelName:mb,backendName:"cpu",kernelFunc:zme};function Ume(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n;Q([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Cn(o.dtype,i.dtype),d=v.makeZerosTypedArray(v.sizeFromShape(o.shape),u),p=0,f=s===0||s>1||o.shape.length===1?1:v.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<f;h++)a[m]===1?d[p++]=l[m]:d[p++]=c[m];return e.makeTensorInfo(o.shape,u,d)}var MG={kernelName:pc,backendName:"cpu",kernelFunc:Ume};var jme=_.SELU_SCALEALPHA,Gme=_.SELU_SCALE,Wme=Ae(ba,t=>t>=0?Gme*t:jme*(Math.exp(t)-1)),FG={kernelName:ba,backendName:"cpu",kernelFunc:Wme};var Hme=Ae(Ia,t=>t<0?-1:t>0?1:0),PG={kernelName:Ia,backendName:"cpu",kernelFunc:Hme};var qme=Ae(wa,t=>Math.sin(t)),$G={kernelName:wa,backendName:"cpu",kernelFunc:qme};var Kme=Ae(Ca,t=>Math.sinh(t)),LG={kernelName:Ca,backendName:"cpu",kernelFunc:Kme};var Xme=11920928955078125e-23,VG=Math.log(Xme)+2,Yme=Ae(Ta,t=>{let n=t>-VG,e=t<VG,r=Math.exp(t),o;return e?o=r:n?o=t:o=Math.log(1+r),o}),BG={kernelName:Ta,backendName:"cpu",kernelFunc:Yme};function Zme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;Q([o],"spaceToBatchND");let a=v.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let E=1+i.length;E<o.shape.length;++E)l.push([0,0]);let c=aC.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),u=_.getReshaped(c.shape,i,a,!1),d=_.getPermuted(u.length,i.length,!1),p=_.getReshapedPermuted(c.shape,i,a,!1),h=et({inputs:{x:c},backend:e,attrs:{shape:u}}),x=pn({inputs:{x:h},backend:e,attrs:{perm:d}}),S=et({inputs:{x},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(x),S}var zG={kernelName:hc,backendName:"cpu",kernelFunc:Zme};function Qme(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=e.data.get(s.dataId).values[0],[d,p,f,m,h]=Zw(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var UG={kernelName:hb,backendName:"cpu",kernelFunc:Qme};function Jme(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[c,u,d]=Qw(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var jG={kernelName:gb,backendName:"cpu",kernelFunc:Jme};function ehe(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=_.calculateShapes(i,o,a),f=!1,m=e.bufferSync(o),h=e.bufferSync(i),g=e.data.get(s.dataId).values[0],y=lC(m,h,a,p,u,c,l,d,g,f);return e.makeTensorInfo(a,y.dtype,y.values)}var GG={kernelName:yb,backendName:"cpu",kernelFunc:ehe};function the(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=v.parseAxisParam(s,o.shape)[0],l=_.prepareSplitSize(o,i,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{let p=[...u];p[a]=d;let f=Qo({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[a]+=d,f})}var WG={kernelName:gc,backendName:"cpu",kernelFunc:the};var nhe=Ae(Ea,t=>Math.sqrt(t)),HG={kernelName:Ea,backendName:"cpu",kernelFunc:nhe};var qG={kernelName:Lf,backendName:"cpu",kernelFunc:({inputs:t,backend:n})=>{let{x:e}=t,r=n;Q(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var rhe=Ae(Aa,(t,n)=>{let e=n;return isNaN(t)?NaN:t>0?1:e.alpha}),KG={kernelName:Aa,backendName:"cpu",kernelFunc:rhe};function ohe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r;Q(o,"stridedSlice");let{nonStrided:f,$begin:m,$strides:h,size:g,newShape:y,outShape:x}=qn.sliceInfo(o.shape,i,s,a,l,c,u,d,p),w=et({inputs:{x:o},backend:e,attrs:{shape:y}}),b;if(f){let E=Qo({inputs:{x:w},backend:e,attrs:{begin:m,size:g}});b=et({inputs:{x:E},backend:e,attrs:{shape:x}}),e.disposeIntermediateTensorInfo(E)}else if(x.some(E=>E===0))b=e.makeTensorInfo(x,o.dtype,[]);else{let E=e.bufferSync(w),D=Jw(x,E,h,m);b=e.makeTensorInfo(D.shape,D.dtype,D.values)}let S=et({inputs:{x:b},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(b),S}var XG={kernelName:Vf,backendName:"cpu",kernelFunc:ohe};var ihe=Ae(Na,t=>Math.tan(t)),YG={kernelName:Na,backendName:"cpu",kernelFunc:ihe};var she=Ae(ka,t=>Math.tanh(t)),ZG={kernelName:ka,backendName:"cpu",kernelFunc:she};function ahe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;Q(o,"tile");let s=eC(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var QG={kernelName:Zi,backendName:"cpu",kernelFunc:ahe};function lhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r;Q(o,"topk");let a=e.data.get(o.dataId).values,[l,c]=tC(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var JG={kernelName:Bf,backendName:"cpu",kernelFunc:lhe};function che(t){let{inputs:n,attrs:e,backend:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=e,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],y=v.computeStrides(o.shape),x=y[0],w=y[1],b=y[2],S=v.getTypedArrayFromDType(o.dtype,v.sizeFromShape(g));S.fill(l);let E=r.data.get(o.dataId).values,D=r.data.get(i.dataId).values;for(let R=0;R<u;++R){let P=i.shape[0]===1?D:D.subarray(R*8,R*8+8);for(let U=0;U<m;++U)for(let j=0;j<h;++j)for(let W=0;W<f;++W){let K,H=P[6]*j+P[7]*U+1;if(H===0)continue;let Y=(P[0]*j+P[1]*U+P[2])/H,ne=(P[3]*j+P[4]*U+P[5])/H,J=eW(Y,p,a),te=eW(ne,d,a);switch(s){case"nearest":K=mhe(E,d,p,x,w,b,R,te,J,W,l);break;case"bilinear":K=hhe(E,d,p,x,w,b,R,te,J,W,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let oe=R*x+U*w+j*b+W;S[oe]=K}return r.makeTensorInfo(g,o.dtype,S)}return{dataId:r.write(S,g,o.dtype),shape:o.shape,dtype:o.dtype}}var tW={kernelName:xb,backendName:"cpu",kernelFunc:che};function eW(t,n,e){switch(e){case"reflect":return uhe(t,n);case"wrap":return dhe(t,n);case"nearest":return fhe(t,n);case"constant":default:return phe(t,n)}}function uhe(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=2*n;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-n?e+r:-e-1}else if(e>n-1)if(n<=1)e=0;else{let r=2*n;e-=r*Math.trunc(e/r),e>=n&&(e=r-e-1)}return v.clamp(0,e,n-1)}function dhe(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=n-1;e+=n*(Math.trunc(-e/r)+1)}else if(e>n-1)if(n<=1)e=0;else{let r=n-1;e-=n*Math.trunc(e/r)}return v.clamp(0,e,n-1)}function phe(t,n){return t}function fhe(t,n){return v.clamp(0,t,n-1)}function Dy(t,n,e,r,o,i,s,a,l,c,u){let d=s*r+a*o+l*i+c;return 0<=a&&a<n&&0<=l&&l<e?t[d]:u}function mhe(t,n,e,r,o,i,s,a,l,c,u){let d=Math.round(a),p=Math.round(l);return Dy(t,n,e,r,o,i,s,d,p,c,u)}function hhe(t,n,e,r,o,i,s,a,l,c,u){let d=Math.floor(a),p=Math.floor(l),f=d+1,m=p+1,h=(m-l)*Dy(t,n,e,r,o,i,s,d,p,c,u)+(l-p)*Dy(t,n,e,r,o,i,s,d,m,c,u),g=(m-l)*Dy(t,n,e,r,o,i,s,f,p,c,u)+(l-p)*Dy(t,n,e,r,o,i,s,f,m,c,u);return(f-a)*h+(a-d)*g}function ghe(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;Q(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=nC(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var nW={kernelName:zf,backendName:"cpu",kernelFunc:ghe};function yhe(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),c=0;for(let f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);let u=new Array(s).fill(0),d=o.shape.slice();d[i]=1;let p=new Array(a);for(let f=0;f<p.length;f++){u[i]=f;let m=Qo({inputs:{x:o},backend:e,attrs:{begin:u,size:d}});p[f]=et({inputs:{x:m},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(m)}return p}var rW={kernelName:vc,backendName:"cpu",kernelFunc:yhe};function xhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r;Q(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,c=[],u=[],d=a-l,p=i;for(let m=0;m<d;++m){let h=Rm({inputs:{input:p},backend:e,attrs:{dim:m+1}});p=h,u.push(h)}for(let m=0;m<s;++m){let h=v.createScalarValue(m,"int32"),g=e.makeTensorInfo([],"int32",h),y=ck({inputs:{a:g,b:p},backend:e}),x=Xo({inputs:{x:y},backend:e,attrs:{dtype:"float32"}}),w=Ad({inputs:{a:x,b:o},backend:e}),b=Ya({inputs:{x:w},backend:e,attrs:{axis:0,keepDims:!1}});c.push(b),u.push(g),u.push(y),u.push(x),u.push(w),u.push(b)}let f=vk({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var oW={kernelName:bc,backendName:"cpu",kernelFunc:xhe};var vhe=[Ij,WU,Sj,Tj,YU,Ej,_j,Dj,Nj,kj,Aj,Rj,Oj,Mj,Fj,$j,Lj,Vj,Bj,Cj,zj,Uj,jj,XU,ZU,Gj,HU,Wj,qj,Xj,Yj,Kj,Qj,Jj,Zj,e4,t4,n4,r4,o4,i4,s4,a4,l4,c4,u4,p4,d4,Ty,m4,hj,h4,g4,y4,QU,x4,JU,v4,b4,w4,ej,C4,I4,S4,T4,E4,tj,_4,qU,D4,Hj,N4,k4,A4,gj,nj,R4,O4,rj,M4,F4,P4,$4,L4,V4,oj,z4,U4,j4,G4,H4,B4,q4,K4,ij,X4,Y4,mG,sj,aj,hG,gG,yG,lj,xG,wG,CG,aC,IG,yj,uj,SG,KU,TG,xj,vj,wj,EG,_G,DG,NG,kG,AG,RG,dj,OG,MG,FG,bj,PG,$G,LG,pj,pG,BG,zG,UG,jG,GG,WG,HG,qG,fj,KG,XG,mj,f4,YG,ZG,QG,JG,cj,tW,nW,rW,oW,vG];for(let t of vhe)wb(t);var Od={},bk={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function iW(t,n){Od[t]=n}function bo(t){if(!(t in Od)){let e=whe(t);if(e!==null)Od[t]=e;else return console.log("Could not get context for WebGL version",t),null}let n=Od[t];return n.isContextLost()?(delete Od[t],bo(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Od[t])}function bhe(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function whe(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=bhe(t);return n.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete Od[t]},!1),t===1?n.getContext("webgl",bk)||n.getContext("experimental-webgl",bk):n.getContext("webgl2",bk)}var Md=function(t){return t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH",t}(Md||{}),dr=function(t){return t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD",t}(dr||{}),er=function(t){return t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",t}(er||{});function Fd(t,n){return[n,t]}function sW(t,n){return t*n}function Vc(t){let n=v.sizeFromShape(t),e=Math.ceil(n/4);return v.sizeToSquarishShape(e)}function ls(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function aW(t,n){let[e,r]=ls(t,n);return e*r*4}function Ny(t,n){let e=t,r,o,i,s,a,l,c,u,d,p;return G().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,c=4,u=1,d=e.HALF_FLOAT,p=e.FLOAT):(r=t.RGBA,o=t.RGBA,i=t.RGBA,s=e.RGBA,a=t.RGBA,c=4,u=4,d=n!=null?n.HALF_FLOAT_OES:null,p=t.FLOAT),l=t.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:p}}function De(t,n){let e=n();return G().getBool("DEBUG")&&Che(t),e}function Che(t){let n=t.getError();if(n!==t.NO_ERROR)throw new Error("WebGL Error: "+The(t,n))}var Ihe=596e-10,She=65504;function lW(t){return!!(G().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Ihe<Math.abs(t)&&Math.abs(t)<She)}function The(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${n}`}}function ky(t,n){return Za(t,()=>t.getExtension(n),'Extension "'+n+'" not supported on this browser.')}function cW(t,n){let e=Za(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(De(t,()=>t.shaderSource(e,n)),De(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function uW(t,n){let e=Za(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(De(t,()=>t.shaderSource(e,n)),De(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw _he(n,t.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var Ehe=/ERROR: [0-9]+:([0-9]+):/g;function _he(t,n){let e=Ehe.exec(n);if(e==null){console.log(`Couldn't parse line number in error: ${n}`),console.log(t);return}let r=+e[1],o=t.split(`
`),i=o.length.toString().length+2,s=o.map((d,p)=>v.rightPad((p+1).toString(),i)+d),a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);let l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join(`
`)),console.log(n.split(`
`)[0]),console.log(`%c ${v.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function dW(t){return Za(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function pW(t,n){if(De(t,()=>t.linkProgram(n)),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function uC(t,n){if(De(t,()=>t.validateProgram(n)),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function fW(t,n){let e=Za(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return De(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),De(t,()=>t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function mW(t,n){let e=Za(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return De(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)),De(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function hW(t){return Za(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function gW(t,n){let e=G().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){let r=`[${t}x${n}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e){let r=`[${t}x${n}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function yW(t){return Za(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Tk(t,n,e,r,o,i,s){let a=t.getAttribLocation(n,e);return a===-1?!1:(De(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),De(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,i,s)),De(t,()=>t.enableVertexAttribArray(a)),!0)}function Dhe(t,n,e){khe(t,e),De(t,()=>t.activeTexture(t.TEXTURE0+e)),De(t,()=>t.bindTexture(t.TEXTURE_2D,n))}function xW(t,n,e){return Za(t,()=>t.getUniformLocation(n,e),'uniform "'+e+'" not present in program.')}function vW(t,n,e){return t.getUniformLocation(n,e)}function bW(t,n,e,r){De(t,()=>Dhe(t,n,r)),De(t,()=>t.uniform1i(e,r))}function dC(t,n,e){De(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),De(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0))}function Ek(t,n){De(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),De(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Ay(t){let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Nhe(t,n))}function Nhe(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${n}`}}function Za(t,n,e){let r=De(t,()=>n());if(r==null)throw new Error(e);return r}function khe(t,n){let e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Bc(t,n=2){return v.sizeFromShape(t.slice(0,t.length-n))}function zc(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function pC(t){let n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[Bc(t),...zc(t)]),n}function wW(t,n=!1){let e=G().getNumber("WEBGL_MAX_TEXTURE_SIZE");n&&(e=e*2,t=t.map((o,i)=>i>=t.length-2?v.nearestLargerEven(t[i]):t[i]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=v.squeezeShape(t).newShape);let r=v.sizeFromShape(t);if(t.length<=1&&r<=e)return[1,r];if(t.length===2&&t[0]<=e&&t[1]<=e)return t;if(t.length===3&&t[0]*t[1]<=e&&t[2]<=e)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=e&&t[1]*t[2]<=e)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=e&&t[3]<=e)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=e&&t[1]*t[2]*t[3]<=e)return[t[0],t[1]*t[2]*t[3]];if(n){let o=Bc(t),i=2,s=2;return t.length&&([i,s]=zc(t)),r=o*(i/2)*(s/2),v.sizeToSquarishShape(r).map(a=>a*2)}return v.sizeToSquarishShape(r)}function cC(t){return t%2===0}function Pd(t,n){if(t=t.slice(-2),n=n.slice(-2),v.arraysEqual(t,n)||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){let e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||cC(e)&&cC(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&cC(t[0])&&cC(n[0])}var Ck,Ik;function CW(t){if(Ck==null){let n=bo(t);Ck=n.getParameter(n.MAX_TEXTURE_SIZE)}return Ck}function IW(t){if(Ik==null){let n=bo(t);Ik=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ik)}function SW(t){if(t===0)return 0;let n,e=bo(t);return wo(e,"EXT_disjoint_timer_query_webgl2")&&t===2?n=2:wo(e,"EXT_disjoint_timer_query")?n=1:n=0,n}function wo(t,n){return t.getExtension(n)!=null}function _k(t){try{if(bo(t)!=null)return!0}catch(n){return console.log("Error when getting WebGL context: ",n),!1}return!1}function TW(t){if(t===0)return!1;let n=bo(t);if(t===1){if(!wo(n,"OES_texture_float"))return!1}else if(!wo(n,"EXT_color_buffer_float"))return!1;return Sk(n)}function EW(t){if(t===0)return!1;let n=bo(t);if(t===1){if(!wo(n,"OES_texture_float")||!wo(n,"WEBGL_color_buffer_float"))return!1}else{if(wo(n,"EXT_color_buffer_float"))return Sk(n);let r="EXT_color_buffer_half_float";if(wo(n,r)){let o=n.getExtension(r);return Ahe(n,o)}return!1}return Sk(n)}function Sk(t){let n=Ny(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(i),s}function Ahe(t,n){let e=Ny(t,n),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function _W(t){return t!==2?!1:bo(t).fenceSync!=null}function cs(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&v.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the WebGL backend.`)})}var Be=G();Be.registerFlag("HAS_WEBGL",()=>Be.getNumber("WEBGL_VERSION")>0);Be.registerFlag("WEBGL_VERSION",()=>_k(2)?2:_k(1)?1:0);Be.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Be.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Be.get("WEBGL_VERSION")===2);Be.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Be.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Be.registerFlag("WEBGL_PACK",()=>Be.getBool("HAS_WEBGL"));Be.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_CLIP",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_REDUCE",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_LAZILY_UNPACK",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_CONV_IM2COL",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>CW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>IW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=Be.getNumber("WEBGL_VERSION");return t===0?0:SW(t)});Be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Cc.isMobile());Be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>TW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Be.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>EW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_FENCE_API_ENABLED",()=>_W(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Be.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Be.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Cc.isMobile()&&Be.getBool("IS_CHROME")?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});function Qt(){let t,n,e,r,o,i,s,a,l,c;return G().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function _i(t,n,e="index"){let r=v.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * ${o}`:`index -= ${t[i]} * ${o}`;return`${s}; ${a};`}).join("")}function Om(t){let n=v.computeStrides(t).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${n[0]} + coords.y * ${n[1]} + coords.z;
  }
`}var mC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var hC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Md.DENSE;let e=Vc(n),r=Qt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${_i(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var gC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Md.DENSE;let e=Vc(n),r=Qt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${_i(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var yC=class{constructor(n){this.variableNames=["A"],this.outTexUsage=dr.DOWNLOAD;let e=Qt();this.outputShape=n,this.userCode=`
      ${mC}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var xC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=dr.DOWNLOAD;let e=Qt();this.outputShape=n,this.userCode=`
      ${mC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var vC=class{constructor(n,e,r=!1){this.variableNames=["A"];let o=Qt(),[i,s]=e;this.outputShape=n;let a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${Om(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${s};
        int c = imod(flatIndex, ${s});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
        vec4 values = ${o.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}};var bC=class{constructor(n,e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let o=Qt(),[i,s]=e;this.outputShape=n;let a="",l="result";r&&(l="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let d=c*2+u;a+=`
          localCoords = coords;
          if(localCoords[2] + ${u} < ${n[2]}) {
            localCoords[2] += ${u};
            if(localCoords[1] + ${c} < ${n[1]}) {
              localCoords[1] += ${c};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${s};
              c = imod(flatIndex, ${s});
              uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
              values = ${o.texture2D}(A, uv);

              if(offset == 0) {
                result[${d}] = values[0];
              } else if(offset == 1) {
                result[${d}] = values[1];
              } else if(offset == 2) {
                result[${d}] = values[2];
              } else {
                result[${d}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${Om(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${a}

        ${o.output} = ${l};
      }
    `}};function DW(t){let n=Qt(),e=`${n.version}
    precision highp float;
    ${n.attribute} vec3 clipSpacePos;
    ${n.attribute} vec2 uv;
    ${n.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return cW(t,e)}function NW(t){let n=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return fW(t,n)}function kW(t){let n=new Uint16Array([0,1,2,2,1,3]);return mW(t,n)}function Ry(t,n,e,r,o,i){gW(n,e);let s=hW(t),a=t.TEXTURE_2D;return De(t,()=>t.bindTexture(a,s)),De(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),De(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),De(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),De(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),De(t,()=>t.texImage2D(a,0,r,n,e,0,o,i,null)),De(t,()=>t.bindTexture(t.TEXTURE_2D,null)),s}function Dk(t){return t.internalFormatFloat}function AW(t,n,e,r){let[o,i]=Fd(n,e);return Ry(t,o,i,Dk(r),r.textureFormatFloat,t.FLOAT)}function Nk(t){return t.internalFormatHalfFloat}function RW(t,n,e,r){let[o,i]=Fd(n,e);return Ry(t,o,i,Nk(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function kk(t){return t.downloadTextureFormat}function OW(t,n,e,r){let[o,i]=Fd(n,e);return Ry(t,o,i,kk(r),t.RGBA,t.UNSIGNED_BYTE)}function Ak(t){return t.internalFormatPackedFloat}function MW(t,n,e,r){let[o,i]=ls(n,e);return Ry(t,o,i,Ak(r),t.RGBA,t.FLOAT)}function Rk(t){return t.internalFormatPackedHalfFloat}function FW(t,n,e,r){let[o,i]=ls(n,e);return Ry(t,o,i,Rk(r),t.RGBA,r.textureTypeHalfFloat)}function PW(t,n,e){return De(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),Tk(t,n,"clipSpacePos",e,3,20,0)&&Tk(t,n,"uv",e,2,20,12)}function $W(t,n,e,r,o,i){De(t,()=>t.bindTexture(t.TEXTURE_2D,n));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(e*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),s.set(o),De(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,e,r,0,t.RGBA,a,s)),De(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function LW(t,n,e){De(t,()=>t.bindTexture(t.TEXTURE_2D,n)),e.data instanceof Uint8Array?De(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e.data)):De(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)),De(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function VW(t,n,e,r){let o=t.createBuffer();De(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*n*e;return De(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),De(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,0)),De(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function BW(t,n,e){let r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function zW(t,n,e,r){let[o,i]=Fd(n,e),s=4,a=new Uint8Array(sW(n*e,s));return De(t,()=>t.readPixels(0,0,o,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function UW(t,n,e,r,o,i,s,a){let l=t,c=new Float32Array(aW(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,n),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function jW(t,n,e){let r=new Float32Array(n*e*4);return De(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,r)),r}var wC=class{constructor(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let e=G().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,iW(e,n)):this.gl=bo(e);let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(G().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=ky(this.gl,i),wo(this.gl,s))this.textureHalfFloatExtension=ky(this.gl,s);else if(G().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),wo(this.gl,o))this.colorBufferHalfFloatExtension=ky(this.gl,o);else if(G().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",wo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(wo(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=NW(this.gl),this.indexBuffer=kW(this.gl),this.framebuffer=yW(this.gl),this.textureConfig=Ny(this.gl,this.textureHalfFloatExtension)}get debug(){return G().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let n=this.gl;De(n,()=>n.finish()),De(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),De(n,()=>n.deleteFramebuffer(this.framebuffer)),De(n,()=>n.bindBuffer(n.ARRAY_BUFFER,null)),De(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)),De(n,()=>n.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(n,e){return this.throwIfDisposed(),AW(this.gl,n,e,this.textureConfig)}createFloat16MatrixTexture(n,e){return this.throwIfDisposed(),RW(this.gl,n,e,this.textureConfig)}createUnsignedBytesMatrixTexture(n,e){return this.throwIfDisposed(),OW(this.gl,n,e,this.textureConfig)}uploadPixelDataToTexture(n,e){this.throwIfDisposed(),LW(this.gl,n,e)}uploadDenseMatrixToTexture(n,e,r,o){this.throwIfDisposed(),$W(this.gl,n,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(n,e){return this.throwIfDisposed(),FW(this.gl,n,e,this.textureConfig)}createPackedMatrixTexture(n,e){return this.throwIfDisposed(),MW(this.gl,n,e,this.textureConfig)}deleteMatrixTexture(n){this.throwIfDisposed(),this.outputTexture===n&&(Ek(this.gl,this.framebuffer),this.outputTexture=null),De(this.gl,()=>this.gl.deleteTexture(n))}downloadByteEncodedFloatMatrixFromOutputTexture(n,e,r){return this.downloadMatrixDriver(n,()=>zW(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(n,e,r,o,i,s){return UW(this.gl,n,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(n,e){return BW(this.gl,n,e)}createBufferFromTexture(n,e,r){this.bindTextureToFrameBuffer(n);let o=VW(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let n=this.createFence(this.gl);return this.pollFence(n)}createFence(n){let e,r;if(G().getBool("WEBGL_FENCE_API_ENABLED")){let o=n,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(n,e,r){return this.downloadMatrixDriver(n,()=>jW(this.gl,e,r))}createProgram(n){this.throwIfDisposed();let e=this.gl,r=uW(e,n);this.vertexShader==null&&(this.vertexShader=DW(e));let o=dW(e);return De(e,()=>e.attachShader(o,this.vertexShader)),De(e,()=>e.attachShader(o,r)),pW(e,o),this.debug&&uC(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=PW(e,this.program,this.vertexBuffer)),o}deleteProgram(n){this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&De(this.gl,()=>this.gl.deleteProgram(n))}setProgram(n){this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&uC(this.gl,this.program),De(this.gl,()=>this.gl.useProgram(n))}getUniformLocation(n,e,r=!0){return this.throwIfDisposed(),r?xW(this.gl,n,e):vW(this.gl,n,e)}getAttributeLocation(n,e){return this.throwIfDisposed(),De(this.gl,()=>this.gl.getAttribLocation(n,e))}getUniformLocationNoThrow(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)}setInputMatrixTexture(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),bW(this.gl,n,e,r)}setOutputMatrixTexture(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)}setOutputPackedMatrixTexture(n,e,r){this.throwIfDisposed();let[o,i]=ls(e,r);this.setOutputMatrixTextureDriver(n,o,i)}setOutputMatrixWriteRegion(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)}setOutputPackedMatrixWriteRegion(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&uC(this.gl,this.program),Ay(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let n=this.gl;this.debug&&this.debugValidate(),De(n,()=>n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),De(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=ky(this.gl,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let n=this.getQueryTimerExtensionWebGL1(),e=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),e}endQuery(){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(n){return await v.repeatedTry(()=>this.disposed||this.isQueryAvailable(n,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(n,G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(n,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(n,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(n){return new Promise(e=>{this.addItemToPoll(()=>n.isFencePassed(),()=>e())})}pollItems(){let n=Ohe(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=n;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(n+1)}addItemToPoll(n,e){this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),!(this.itemsToPoll.length>1)&&v.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(n){this.throwIfDisposed(),dC(this.gl,n,this.framebuffer),this.debug&&Ay(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(dC(this.gl,this.outputTexture,this.framebuffer),this.debug&&Ay(this.gl)):Ek(this.gl,this.framebuffer)}downloadMatrixDriver(n,e){this.bindTextureToFrameBuffer(n);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(n,e,r){this.throwIfDisposed();let o=this.gl;dC(o,n,this.framebuffer),this.debug&&Ay(o),this.outputTexture=n,De(o,()=>o.viewport(0,0,e,r)),De(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(n,e,r,o){this.throwIfDisposed(),De(this.gl,()=>this.gl.scissor(n,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function Ohe(t){let n=0;for(;n<t.length&&t[n]();++n);return n-1}var{getBroadcastDims:GW}=_;function WW(t,n,e,r){let o=[];t.forEach(m=>{let h=v.sizeFromShape(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?o.push(`uniform float ${m.name}${h>1?`[${h}]`:""};`):(o.push(`uniform sampler2D ${m.name};`),o.push(`uniform int offset${m.name};`))});let i=o.join(`
`),s=t.map(m=>Mhe(m,n,r)).join(`
`),a=n.texShape,l=Qt(),c=$he(l),u,d,p=Bhe(l);return n.isPacked?(u=Fhe(n.logicalShape,a),d=Vhe(l)):(u=Phe(n.logicalShape,a),d=Lhe(l)),r&&(p+=Ghe),[p,c,d,i,u,s,e].join(`
`)}function Fm(t){let n=t.shapeInfo.logicalShape;switch(n.length){case 0:return nge(t);case 1:return oge(t);case 2:return sge(t);case 3:return lge(t);case 4:return uge(t);case 5:return dge(t);case 6:return pge(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function HW(t){switch(t.shapeInfo.logicalShape.length){case 0:return tge(t);case 1:return rge(t);case 2:return ige(t);case 3:return age(t);default:return cge(t)}}function Mhe(t,n,e=!1){let r="";e?r+=HW(t):r+=Fm(t);let o=t.shapeInfo.logicalShape,i=n.logicalShape;return o.length<=i.length&&(e?r+=fge(t,n):r+=mge(t,n)),r}function Fhe(t,n){switch(t.length){case 0:return qW();case 1:return Whe(t,n);case 2:return Jhe(t,n);case 3:return qhe(t,n);default:return Xhe(t,n)}}function Phe(t,n){switch(t.length){case 0:return qW();case 1:return Hhe(t,n);case 2:return ege(t,n);case 3:return Khe(t,n);case 4:return Yhe(t,n);case 5:return Zhe(t,n);case 6:return Qhe(t,n);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function $he(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Lhe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Vhe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Bhe(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${zhe}
    ${Uhe}
    ${jhe}
  `}var zhe=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Uhe=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,jhe=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Ghe=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function qW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Whe(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${e[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return 2 * (resTexRC.x * ${e[1]} + resTexRC.y);
    }
  `}function Hhe(t,n){return n[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${n[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return resTexRC.x * ${n[1]} + resTexRC.y;
    }
  `}function qhe(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function Khe(t,n){let e=_i(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec3(r, c, d);
    }
  `}function Xhe(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,s="",a="b, r, c";for(let l=2;l<t.length-1;l++)i*=t[t.length-l-1],s=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+s,a=`b${l}, `+a;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${a});
    }
  `}function Yhe(t,n){let e=_i(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec4(r, c, d, d2);
    }
  `}function Zhe(t,n){let e=_i(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${n[0]},
                             ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Qhe(t,n){let e=_i(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Jhe(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(v.arraysEqual(t,n))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `;let r=Math.ceil(t[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function ege(t,n){return v.arraysEqual(t,n)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `:t[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function $d(t){return`offset${t}`}function tge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Qt();return`
    vec4 ${e}() {
      return ${r.texture2D}(${n}, halfCR);
    }
  `}function nge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${e}() {return ${n};}`;let[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${e}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let[i,s]=t.shapeInfo.texShape,a=$d(n);return`
    float ${e}() {
      vec2 uv = uvFromFlat(${i}, ${s}, ${a});
      return sampleTexture(${n}, uv);
    }
  `}function rge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Qt();return`
    vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function oge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${e}(int index) {
        ${Pm(t)}
      }
    `;let r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${e}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let s=$d(n);return i===1?`
      float ${e}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?`
      float ${e}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${e}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${s});
      return sampleTexture(${n}, uv);
    }
  `}function ige(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=o[0],s=o[1],a=Qt();if(o!=null&&v.arraysEqual(n,o))return`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${i}.0);

        return ${a.texture2D}(${e}, uv);
      }
    `;let l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${a.texture2D}(${e}, uv);
    }
  `}function sge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape;if(o!=null&&v.arraysEqual(n,o)){let d=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${e}, uv);
    }
  `}let{newShape:i,keptDims:s}=v.squeezeShape(n),a=i;if(a.length<n.length){let d=$m(t,a),p=["row","col"];return`
      ${Fm(d)}
      float ${r}(int row, int col) {
        return ${r}(${Lm(p,s)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Pm(t)}
      }
    `;let l=o[0],c=o[1],u=$d(e);return c===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${e}, uv);
    }
  `:l===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${e}, uv);
    }
  `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${u};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${e}, uv);
  }
`}function age(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){let d=n.slice(1),p=[1,2],f=$m(t,d),m=["b","row","col"];return`
        ${HW(f)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Lm(m,p)});
        }
      `}let s=i[0],a=i[1],l=Math.ceil(n[2]/2),c=l*Math.ceil(n[1]/2),u=Qt();return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${s}, ${a}, ${c}, ${l}, b, row, col);
      return ${u.texture2D}(${e}, uv);
    }
  `}function lge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[1]*n[2],i=n[2],{newShape:s,keptDims:a}=v.squeezeShape(n),l=s;if(l.length<n.length){let m=$m(t,l),h=["row","col","depth"];return`
        ${Fm(m)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Lm(h,a)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Pm(t)}
      }
    `;let c=t.shapeInfo.texShape,u=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===o&&p==null)return`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${u}.0);
          return sampleTexture(${e}, uv);
        }
      `;if(d===i&&p==null)return`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${u}.0);
      return sampleTexture(${e}, uv);
    }
  `;let f=$d(e);return`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${u}, ${d}, index);
        return sampleTexture(${e}, uv);
      }
  `}function cge(t){let n=t.shapeInfo.logicalShape,e=n.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],a=s[0],l=s[1],c=Math.ceil(n[e-1]/2),u=c*Math.ceil(n[e-2]/2),d="int b, int row, int col",p=`b * ${u} + (row / 2) * ${c} + (col / 2)`;for(let m=2;m<e-1;m++)d=`int b${m}, `+d,u*=n[e-m-1],p=`b${m} * ${u} + `+p;let f=Qt();return`
    vec4 ${o}(${d}) {
      int index = ${p};
      int texR = index / ${l};
      int texC = index - texR * ${l};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${a});
      return ${f.texture2D}(${r}, uv);
    }
  `}function uge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[3],i=n[2]*o,s=n[1]*i,{newShape:a,keptDims:l}=v.squeezeShape(n);if(a.length<n.length){let m=$m(t,a),h=["row","col","depth","depth2"];return`
      ${Fm(m)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Lm(h,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${s}, ${i}, ${o}, 1)));
        ${Pm(t)}
      }
    `;let c=t.shapeInfo.flatOffset,u=t.shapeInfo.texShape,d=u[0],p=u[1];if(p===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let f=$d(e);return`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${f});
      return sampleTexture(${e}, uv);
    }
  `}function dge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[4],i=n[3]*o,s=n[2]*i,a=n[1]*s,{newShape:l,keptDims:c}=v.squeezeShape(n);if(l.length<n.length){let h=$m(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Fm(h)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${Lm(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${Pm(t)}
      }
    `;let u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]},
               ${n[2]*n[3]}, ${n[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=$d(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function pge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=v.squeezeShape(n);if(o.length<n.length){let g=$m(t,o),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Fm(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${Lm(y,i)});
      }
    `}let s=n[5],a=n[4]*s,l=n[3]*a,c=n[2]*l,u=n[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${Pm(t)}
      }
    `;let d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];if(m===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]*n[4]},
               ${n[2]*n[3]*n[4]},
               ${n[3]*n[4]},
               ${n[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=$d(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${h};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function Pm(t){let n=t.name,e=v.sizeFromShape(t.shapeInfo.logicalShape);return e<2?`return ${n};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${n}[i];
      }
    }
  `}function fge(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=n.logicalShape.length,a=GW(t.shapeInfo.logicalShape,n.logicalShape),l=je(s),c=s-i,u,d=["x","y","z","w","u","v"];i===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(x=>`coords.${d[x+c]} = 0;`).join(`
`);let p="";s<2&&i>0?p="coords":p=t.shapeInfo.logicalShape.map((x,w)=>`coords.${d[w+c]}`).join(", ");let f="return outputValue;",h=v.sizeFromShape(t.shapeInfo.logicalShape)===1,y=v.sizeFromShape(n.logicalShape)===1;if(i===1&&!h&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!y)s===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){let x=i-2,w=i-1;a.indexOf(x)>-1&&a.indexOf(w)>-1?f="return vec4(outputValue.x);":a.indexOf(x)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(w)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${f}
    }
  `}function mge(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&v.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=je(l),u=GW(t.shapeInfo.logicalShape,n.logicalShape),d=l-a,p,f=["x","y","z","w","u","v"];a===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(h=>`coords.${f[h+d]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${m});
    }
  `}function je(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function $m(t,n){let e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function Lm(t,n){return n.map(e=>t[e]).join(", ")}function XW(t,n,e,r){let o=n.userCode,i=e.map((f,m)=>{let h={logicalShape:f.shape,texShape:f.isUniform?null:f.texData.texShape,isUniform:f.isUniform,isPacked:f.isUniform?!1:f.texData.isPacked,flatOffset:null};return f.texData!=null&&f.texData.slice!=null&&f.texData.slice.flatOffset>0&&(h.flatOffset=f.texData.slice.flatOffset),{name:n.variableNames[m],shapeInfo:h}}),s=i.map(f=>f.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=WW(i,a,o,n.packedInputs),c=t.createProgram(l),u=null,d=t.getUniformLocation(c,"NAN",!1);G().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(c,"INFINITY",!1));let p={};for(let f=0;f<n.variableNames.length;f++){let m=n.variableNames[f],h=!1;p[m]=t.getUniformLocation(c,m,h),p[`offset${m}`]=t.getUniformLocation(c,`offset${m}`,h)}return{program:n,source:l,webGLProgram:c,uniformLocations:p,inShapeInfos:s,outShapeInfo:a,infLoc:u,nanLoc:d}}function KW(t,n){if(t.length!==n.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${n.length} inputs`);t.forEach((e,r)=>{let o=e.logicalShape,i=n[r],s=i.shape;if(!v.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!v.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function YW(t,n,e,r,o){KW(n.inShapeInfos,e),KW([n.outShapeInfo],[r]);let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,s[0],s[1]):t.setOutputMatrixTexture(i,s[0],s[1]),t.setProgram(n.webGLProgram),G().getNumber("WEBGL_VERSION")===1&&n.infLoc!==null&&t.gl.uniform1f(n.infLoc,1/0),n.nanLoc!==null&&t.gl.uniform1f(n.nanLoc,NaN),e.forEach((a,l)=>{let c=n.program.variableNames[l],u=n.uniformLocations[c],d=n.uniformLocations[`offset${c}`];if(u!=null){if(a.isUniform){if(v.sizeFromShape(a.shape)<2)t.gl.uniform1f(u,a.uniformValues[0]);else{let p=a.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}return}a.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,a.texData.slice.flatOffset),t.setInputMatrixTexture(a.texData.texture,u,l)}}),o?.(t,n.webGLProgram),t.executeProgram()}function ZW(t,n,e){let r="";n.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0,l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`});let o=t.userCode,i=t.constructor.name;return i+="_"+r+"_"+o,i}var{addImpl:QW,bincountImpl:CC,bincountReduceImpl:JW,ceilImpl:eH,concatImpl:tH,expImpl:nH,expm1Impl:rH,floorImpl:oH,gatherV2Impl:iH,greaterImpl:sH,lessImpl:aH,linSpaceImpl:lH,logImpl:cH,maxImpl:uH,maximumImpl:dH,minimumImpl:pH,multiplyImpl:fH,negImpl:mH,prodImpl:hH,rangeImpl:gH,rsqrtImpl:yH,simpleAbsImpl:IC,sliceImpl:xH,sparseFillEmptyRowsImpl:vH,sparseReshapeImpl:bH,stridedSliceImpl:wH,subImpl:CH,tileImpl:IH,topKImpl:SH,transposeImpl:Ld,uniqueImpl:TH}=JN;function Ok(t,n){return["x","y","z","w","u","v"].slice(0,n).map(e=>`${t}.${e}`)}function ln(t,n){return n===1?[t]:Ok(t,n)}function EH(t,n){if(t===1)return"rc";let e="";for(let r=0;r<t;r++)e+=n[r],r<t-1&&(e+=",");return e}var SC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;let e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=ln("rc",e),o=je(e),i=xge(e,n,r),s=vge(e,n[n.length-1],n[n.length-2],r),a=bge(n,r);this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${a}));
          }
        }
      `}}};function yge(t,n){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<t;s++)i=`${n[n.length-1-s]},`+i;e.push(i)}return e}function xge(t,n,e){if(t===1)return`rc > ${n[0]}`;let r="";for(let o=t-2;o<t;o++)r+=`${e[o]} >= ${n[o]}`,o<t-1&&(r+="||");return r}function vge(t,n,e,r){if(t===1)return"";let o=r.slice(-2);return`
    int r = ${o[0]};
    int c = ${o[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${n};
    bool rEdge = rp1 >= ${e};
  `}function bge(t,n){let e=t.length,r=yge(e,n);return e===1?`getA(rc),
            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${r[0]}),
          cEdge ? 0. : getA(${r[1]}),
          rEdge ? 0. : getA(${r[2]}),
          rEdge || cEdge ? 0. : getA(${r[3]})`}var Vm=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${wge(e)}
      ${Om(n)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${n[1]};
        int cols = ${n[2]};

        ${r}

        setOutput(result);
      }
    `}};function wge(t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${_i(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var TC=class{constructor(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(n,e,r){let o=DH(e,r),i=NH(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=_H(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].shift();return this.usedTextures[i].push(l),l}let a;return o===er.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===er.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===er.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===er.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===er.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(n,e,r,o){if(this.freeTextures==null)return;let i=DH(r,o),s=NH(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=_H(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=G().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(n),this._numBytesAllocated-=a):(this.freeTextures[s].push(n),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[s],u=c.indexOf(n);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(u,1),this.log()}log(){if(!this.logEnabled)return;let n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${n})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let n in this.freeTextures)this.freeTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(let n in this.usedTextures)this.usedTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function Cge(t,n){let e=t;if(n===e.R32F)return 4;if(n===e.R16F)return 2;if(n===e.RGBA32F)return 16;if(n===t.RGBA)return 16;if(n===e.RGBA16F)return 8;throw new Error(`Unknown internal format ${n}`)}function _H(t,n,e,r,o){let i=Ige(n,r),s;if(o){let[l,c]=ls(t[0],t[1]);s=l*c}else{let[l,c]=Fd(t[0],t[1]);s=l*c}let a=Cge(e,i);return s*a}function Ige(t,n){switch(t){case er.PACKED_2X2_FLOAT32:return Ak(n);case er.PACKED_2X2_FLOAT16:return Rk(n);case er.UNPACKED_FLOAT32:return Dk(n);case er.UNPACKED_FLOAT16:return Nk(n);case er.PACKED_4X1_UNSIGNED_BYTE:return kk(n);default:throw new Error(`Unknown physical texture type ${t}`)}}function Sge(t){return G().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?er.PACKED_2X2_FLOAT32:er.UNPACKED_FLOAT32:t?er.PACKED_2X2_FLOAT16:er.UNPACKED_FLOAT16}function DH(t,n){if(t===dr.UPLOAD)return er.PACKED_2X2_FLOAT32;if(t===dr.RENDER||t==null)return Sge(n);if(t===dr.DOWNLOAD||t===dr.PIXELS)return er.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function NH(t,n,e){return`${t[0]}_${t[1]}_${n}_${e}`}var wr=class{constructor(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Mn="if (isnan(x)) return x;",kH="return x;",Mk="return abs(x);";var AH="return (x >= 0.0) ? x : (exp(x) - 1.0);",RH=Mn+`
  return (x < 0.0) ? 0.0 : x;
`,OH=Mn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Oy="return x;",MH="return 1.0 / (1.0 + exp(-1.0 * x));";var PH="return x;",$H=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,LH=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,VH=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,BH="return 1.0 / (1.0 + exp(-1.0 * x));",Jo=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var EC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;let e=n.length,r=ln("rc",e),o=je(e),i=EH(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Ege=Zn.whereImpl,_ge=1e-7,Dge=1e-4,_C={};function Nge(t){return t in _C||(_C[t]={}),_C[t]}var kge=128,Age=600;function Rge(){return G().global.screen==null?1024:G().global.screen.height*G().global.screen.width*window.devicePixelRatio*Age/1024/1024}var zH=(()=>{class t extends Vs{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!G().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){let r=bo(G().getNumber("WEBGL_VERSION"));this.binaryCache=Nge(G().getNumber("WEBGL_VERSION")),this.gpgpu=new wC(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new TC(this.gpgpu),this.numMBBeforeWarning=Rge(),this.texData=new $u(this,Ma())}nextDataId(){return t.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,r,o){if((G().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||G().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:dr.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(G().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:dr.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:c}=r;if(a!=null){let f;c?f=new Jo(l,Oy):f=new wr(l,Oy);let m=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),h=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),h}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let u=this.activeTimers!=null,d;u&&(d=v.now());let p;if(i==="complex64"){let f=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);p=_.mergeRealAndImagArrays(f,m)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=v.now()-d),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let h=this.pendingRead.get(e);return new Promise(g=>h.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:c}=r;if(s!=null){let h;c?h=new Jo(i,Oy):h=new wr(i,Oy);let g=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:a}],a),y=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(o!=null)return this.convertAndCacheOnCPU(e);if(!G().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&G().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(a!=="complex64"&&G().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);let h=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(h.texture,...Vc(i))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){let h=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=h[0],y=h[1];p=_.mergeRealAndImagArrays(g,y)}else if(u==null)p=this.getValuesFromTexture(e);else{let h=v.sizeFromShape(i);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,h)}d!=null&&this.disposeIntermediateTensorInfo(d);let f=this.convertAndCacheOnCPU(e,p),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(h=>h(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ma().removeDataId(e,this),this.pendingDeletes--),f}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>v.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ie(e.shape,e.dtype,o)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!lW(o))throw G().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=v.sizeFromShape(r);if(G().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),m=this.texData.get(f.dataId),h=this.gpgpu.downloadMatrixFromPackedTexture(m.texture,...Vc(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),h}let a=G().getBool("WEBGL_PACK")&&i===!0,l=a?pC(r):r,c=a?new xC(l):new yC(l),u=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=v.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=v.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=await Promise.all(s);l.kernelMs=v.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:v.now(),endMs:null}}endTimer(e){return G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=v.now(),e)}async getQueryTime(e){if(G().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=kge){return G().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&v.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){_.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Ege(e.shape,r)}packedUnaryOp(e,r,o){let i=new Jo(e.shape,r),s=this.compileAndRun(i,[e],o);return Ma().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=IC(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(G().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Mk,e.dtype);let r=new wr(e.shape,Mk),o=this.compileAndRun(r,[e]);return Ma().makeTensorFromDataId(o.dataId,o.shape,o.dtype)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&v.isString(o[0])){let s=o.map(a=>v.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){let{dataId:i}=this.makeTensorInfo(e,r,o);return Ma().makeTensorFromDataId(i,e,r,this)}unpackTensor(e){let r=new EC(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new SC(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[Bc(e.shape),...zc(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[Bc(r),...zc(r)],a=new Vm(s,o),c=this.runWebGLProgram(a,[i],e.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}}decode(e){let r=this.texData.get(e),{isPacked:o,shape:i,dtype:s}=r,a=pC(i),l;o?l=new gC(a):l=new hC(a);let u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],s,null,!0);return{dtype:s,shape:i,dataId:u.dataId}}runWebGLProgram(e,r,o,i,s=!1){let a=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Md.DENSE){let y=Vc(e.outputShape);l.texShape=y.map(x=>x*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),v.sizeFromShape(a.shape)===0)return l.values=v.getTypedArrayFromDType(a.dtype,0),a;let c=[],u=r.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let x=this.texData.get(y.dataId);if(x.texture==null){if(!e.packedInputs&&v.sizeFromShape(y.shape)<=G().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:x.values};e.packedInputs&&(x.isPacked=!0,x.shape=y.shape)}else if(!!x.isPacked!=!!e.packedInputs)y=x.isPacked?this.unpackTensor(y):this.packTensor(y),c.push(y),x=this.texData.get(y.dataId);else if(x.isPacked&&!Pd(x.shape,y.shape)){let w=y,b=y.shape;y.shape=x.shape,y=this.packedReshape(y,b),c.push(y),x=this.texData.get(y.dataId),w.shape=b}return this.uploadToGPU(y.dataId),{shape:y.shape,texData:x,isUniform:!1}});this.uploadToGPU(a.dataId);let d={shape:a.shape,texData:l,isUniform:!1},p=ZW(e,u,d),f=this.getAndSaveBinary(p,()=>XW(this.gpgpu,e,u,d)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),YW(this.gpgpu,f,u,d,i),c.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let g=G().get("WEBGL_FLUSH_THRESHOLD");if(g>0){let y=v.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!G().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(G().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=z(()=>{if(!G().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=G().getBool("DEBUG");G().set("DEBUG",!1);let r=this.abs(Ne(1e-8)).dataSync()[0];if(G().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?_ge:Dge}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:c}=r;if(a!=null)return;let u=this.activeTimers!=null,d;u&&(d=v.now());let p=r.texShape;if(p==null&&(p=wW(o,c),r.texShape=p),s!=null){let f=pC(o),m,h=p[1],g=p[0],y=s instanceof Uint8Array;c?([h,g]=ls(p[0],p[1]),m=new bC(f,[g,h],y)):m=new vC(f,[g,h],y);let x=this.makeTensorInfo([g,h],i);y?this.texData.get(x.dataId).usage=dr.PIXELS:this.texData.get(x.dataId).usage=dr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(x.dataId),h,g,s);let b=this.runWebGLProgram(m,[x],i,null,!0),S=this.texData.get(b.dataId);r.texture=S.texture,r.texShape=S.texShape,r.isPacked=S.isPacked,r.usage=S.usage,this.disposeIntermediateTensorInfo(x),this.texData.delete(b.dataId),r.values=null,u&&(this.uploadWaitMs+=v.now()-d)}else{let f=this.acquireTexture(p,l,i,c);r.texture=f}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return this.releaseGPUData(e),r!=null&&(o.values=Oge(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*v.bytesPerElement(r)}}return t.nextDataId=0,t})();function Oge(t,n){if(n==="float32"||n==="complex64")return t;if(n==="int32"||n==="bool"){let e=n==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<e.length;++r)e[r]=Math.round(t[r]);return e}else throw new Error(`Unknown dtype ${n}`)}Cc.isBrowser()&&Pb("webgl",()=>new zH,2);var DC=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var Co=class{constructor(n,e,r){this.variableNames=["A","B"],this.outputShape=_.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOperation(float a, float b) {
        ${n}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var Uc=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;var ei=class{constructor(n,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=_.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length,s="";if(o)if(i===0||v.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${je(i)} coords = getOutputCoords();
        `,i===1)s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=ln("coords",i);s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${n}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function cn(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var UH={kernelName:Yi,backendName:"webgl",kernelFunc:cn};function Mr(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=cn({inputs:{x:r},backend:e}),l=cn({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var jH={kernelName:xf,backendName:"webgl",kernelFunc:Mr};var Fk="return (a < 0.) ? b * a : a;",Pk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Mge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r,s=e.makeTensorInfo([],"float32",v.createScalarValue(i,"float32")),a=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(Pk,o.shape,s.shape):new Co(Fk,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],o.dtype);return e.disposeIntermediateTensorInfo(s),l}var GH={kernelName:Kl,backendName:"webgl",kernelFunc:Mge};var $k="return (a < 0.) ? b * a : a;",Lk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Fge(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n,i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(Lk,r.shape,o.shape):new Co($k,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)}var WH={kernelName:ac,backendName:"webgl",kernelFunc:Fge};var NC="if (isnan(x)) return x;",HH=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,qH=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function be({opSnippet:t,packedOpSnippet:n,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let d=a.texData.get(s.dataId),p=e(d.values,l);return a.makeTensorInfo(s.shape,l,p)}let c=G().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&n!=null,u;return c?u=new Jo(s.shape,n):u=new wr(s.shape,t),a.runWebGLProgram(u,[s],l)}}function yt({opSnippet:t,packedOpSnippet:n,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:c}=s,u=a;if(r&&l.dtype==="complex64"){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,y]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(w=>{let[b,S]=w,E={dataId:b.dataId,dtype:b.dtype,shape:l.shape},D={dataId:S.dataId,dtype:S.dtype,shape:c.shape},O=new Co(t,l.shape,c.shape);return u.runWebGLProgram(O,[E,D],Cn(b.dtype,S.dtype))}),x=Mr({inputs:{real:g,imag:y},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(y),x}let d=i||Cn(l.dtype,c.dtype);if(u.shouldExecuteOnCPU([l,c])&&o!=null){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,y]=o(l.shape,c.shape,m.values,h.values,d),x=u.makeTensorInfo(y,d),w=u.texData.get(x.dataId);return w.values=g,x}let p=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&n!=null,f;return p?f=new ei(n,l.shape,c.shape,e):f=new Co(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function jc(t,n=!1){if(t==="linear")return n?PH:kH;if(t==="relu")return n?LH:RH;if(t==="elu")return n?$H:AH;if(t==="relu6")return n?VH:OH;if(t==="prelu")return n?Lk:$k;if(t==="leakyrelu")return n?Pk:Fk;if(t==="sigmoid")return n?BH:MH;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var Bm=class{constructor(n,e,r,o=!1,i=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;let u=o?n[1]:n[2],d=Math.ceil(u/2),p=o?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");let x=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let w="rc.x",b="rc.x";n[0]<e[0]?w=`int(min(float(rc.x), ${n[0]-1}.))`:e[0]<n[0]&&(b=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`
      ${g}

      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${d}; i++) {
          int batchA = ${w};
          int batchB = ${b};
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${x}

        ${y}

        setOutput(result);
      }
    `}};var Vk={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},My=class{constructor(n,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=_.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${n}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var KH="return a * b;";function Fy(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=_.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),c=new My(Vk.REAL,r.shape,o.shape),u=new My(Vk.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Mr({inputs:{real:p,imag:f},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[c,u]=fH(r.shape,o.shape,a.values,l.values,i),d=e.makeTensorInfo(u,i),p=e.texData.get(d.dataId);return p.values=c,d}let s;return G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new ei(KH,r.shape,o.shape):s=new Co(KH,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var XH={kernelName:fa,backendName:"webgl",kernelFunc:Fy};function YH(t,n,e){let r=[Bc(t.shape),...zc(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},i=[Bc(n),...zc(n)],s=new Vm(i,r),l=e.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}}function ie(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=e,a=v.sizeFromShape(o.shape),l=v.inferFromImplicitShape(i,a),c=v.sizeFromShape(l);v.assert(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=s.texData.get(o.dataId);return u.isPacked&&!Pd(o.shape,l)&&!(u.texture!==null&&Pd(u.shape,l))?YH(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var ZH={kernelName:lc,backendName:"webgl",kernelFunc:ie};var Py=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,c="sumValue += dot(values, ones);";if(e!=null){let d=1/e;c=`sumValue += dot(values * ${v.isInt(d)?d.toPrecision(2):d}, ones);`}let u="";i%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var kC=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let u=Math.floor(r/4)*4,d=r%4,p=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function $ge(t){let n=[];for(;n.length===0||n[n.length-1].outSize!==1;){let e=n.length?n[n.length-1].outSize:t[1],r=_.computeOptimalWindowSize(e);n.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return n}function Jr(t,n,e,r){let o=$ge(t.shape),i=t;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:c}=o[s],u,d;e==="mean"?u=s===0?new Py({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new Py({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new kC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},e),d=i,i=r.runWebGLProgram(u,[i],n),d.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(d)}return i}var AC=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[e[s]];this.outputShape=r,this.rank=r.length;let o=je(this.rank),i=Lge(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function Lge(t){let n=t.length;if(n>6)throw Error(`Transpose for rank ${n} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(n);for(let o=0;o<t.length;o++)r[t[o]]=e[o];return r.join()}var RC=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(n.length);for(let u=0;u<r.length;u++)r[u]=n[e[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=je(this.rank),i=Ok("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function Gc(t,n,e){let r=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new RC(t.shape,n):new AC(t.shape,n);return e.runWebGLProgram(r,[t],t.dtype)}function QH(t,n,e,r){let o=n,i=t.shape.length,s=v.parseAxisParam(o,t.shape),a=s,l=_.getAxesPermutation(a,i),c=l!=null,u=t;c&&(u=Gc(t,l,r),a=_.getInnerMostAxes(a.length,i)),_.assertAxesAreInnerMostDims("sum",a,i);let[d,p]=_.computeOutAndReduceShapes(u.shape,a),f=d;e&&(f=_.expandShapeToKeepDim(d,s));let m=v.sizeFromShape(p),g=v.sizeFromShape(t.shape)/m,y=ie({inputs:{x:u},attrs:{shape:[g,m]},backend:r}),x=Qu(t.dtype),w=Jr(y,x,"sum",r),b=ie({inputs:{x:w},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(w),c&&r.disposeIntermediateTensorInfo(u),b}function Vd(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;return QH(o,i,s,e)}var JH={kernelName:mc,backendName:"webgl",kernelFunc:Vd};function Wt(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];let c;if(s.shouldExecuteOnCPU([o])){let d=s.texData.get(o.dataId).values,p=Ld(d,o.shape,o.dtype,i,l);c=s.makeTensorInfo(l,o.dtype);let f=s.texData.get(c.dataId);f.values=p}else c=Gc(o,i,s);return c}var eq={kernelName:xc,backendName:"webgl",kernelFunc:Wt};var Bk=1e3;function Bd({a:t,b:n,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=t.shape.length,u=n.shape.length,d=e?t.shape[c-2]:t.shape[c-1],p=r?n.shape[u-1]:n.shape[u-2],f=e?t.shape[c-1]:t.shape[c-2],m=r?n.shape[u-2]:n.shape[u-1],h=t.shape.slice(0,-2),g=n.shape.slice(0,-2),y=v.sizeFromShape(h),x=v.sizeFromShape(g),w=y===x||y===1||x===1;v.assert(c>=2&&u>=2&&w,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${h}) and (${g}).`);let S=(y>x?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([f,m]);v.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${t.shape} and ${n.shape} and transposeA=${e} and transposeB=${r} must match.`);let E=e?[y,d,f]:[y,f,d],D=r?[x,m,p]:[x,p,m],O=ie({inputs:{x:t},backend:o,attrs:{shape:E}}),R=ie({inputs:{x:n},backend:o,attrs:{shape:D}}),P=[O,R],U=Math.max(y,x),j=e?O.shape[1]:O.shape[2],W=i!=null,K=s!=null,H=l==="leakyrelu",Y=l!=null?jc(l,!0):null,ne=W||K||H||Y!=null,J;if((f===1||m===1)&&j>Bk&&ne===!1){let oe=O,ae=R;e&&(oe=Wt({inputs:{x:O},backend:o,attrs:{perm:[0,2,1]}}),P.push(oe)),r&&(ae=Wt({inputs:{x:R},backend:o,attrs:{perm:[0,2,1]}}),P.push(ae));let de=m!==1,le=m===1,me=oe;de&&(me=ie({inputs:{x:oe},backend:o,attrs:{shape:[U,j,1]}}),P.push(me));let ge=m===1?2:1,xe=ae;le&&(xe=ie({inputs:{x:ae},backend:o,attrs:{shape:[U,1,j]}}),P.push(xe));let Te=Fy({inputs:{a:me,b:xe},backend:o});J=Vd({inputs:{x:Te},backend:o,attrs:{axis:ge,keepDims:!0}}),P.push(Te)}else{let oe=Cn(t.dtype,n.dtype),ae=new Bm(E,D,[U,f,m],e,r,W,Y,K,H),de=[O,R];if(i!=null&&de.push(i),K&&de.push(s),H){let le=o.makeTensorInfo([],"float32",v.createScalarValue(a,"float32"));de.push(le),P.push(le)}J=o.runWebGLProgram(ae,de,oe)}let te=ie({inputs:{x:J},backend:o,attrs:{shape:S}});P.push(J);for(let oe of P)o.disposeIntermediateTensorInfo(oe);return te}function Vge(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return Bd({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var tq={kernelName:Ku,backendName:"webgl",kernelFunc:Vge};var nq="return abs(x);";function Bge(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=IC(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return G().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Jo(r.shape,nq):o=new wr(r.shape,nq),e.runWebGLProgram(o,[r],r.dtype)}var rq={kernelName:kl,backendName:"webgl",kernelFunc:Bge};var zge=Mn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Uge=be({opSnippet:zge}),oq={kernelName:Bs,backendName:"webgl",kernelFunc:Uge};var jge=Mn+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Gge=be({opSnippet:jge}),iq={kernelName:zs,backendName:"webgl",kernelFunc:Gge};var sq="return a + b;",Wge=yt({opSnippet:sq,packedOpSnippet:sq,supportsComplex:!0,cpuKernelImpl:QW}),aq={kernelName:mi,backendName:"webgl",kernelFunc:Wge};var OC=class{constructor(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var MC=class{constructor(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function FC(t){let{inputs:n,backend:e}=t,r=n;if(r.length===1)return cn({inputs:{x:r[0]},backend:e});if(r.length>G().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=FC({inputs:r.slice(0,l),backend:e}),u=FC({inputs:r.slice(l),backend:e});return FC({inputs:[c,u],backend:e})}let o=r.map(l=>l.dtype).reduce((l,c)=>Cn(l,c)),i=r.map(l=>l.shape),a=G().getBool("WEBGL_PACK")?new MC(r[0].shape,i):new OC(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var lq={kernelName:ff,backendName:"webgl",kernelFunc:FC};function Hge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),c=l,u=_.getAxesPermutation(c,a),d=o;u!=null&&(d=Wt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=_.getInnerMostAxes(c.length,a)),_.assertAxesAreInnerMostDims("all",c,a);let[p,f]=_.computeOutAndReduceShapes(d.shape,c),m=v.sizeFromShape(f),h=ie({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=Jr(h,h.dtype,"all",e),y;if(s){let x=_.expandShapeToKeepDim(p,l);y=ie({inputs:{x:g},backend:e,attrs:{shape:x}})}else y=ie({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var cq={kernelName:mf,backendName:"webgl",kernelFunc:Hge};function qge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),c=l,u=_.getAxesPermutation(c,a),d=o;u!=null&&(d=Wt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=_.getInnerMostAxes(c.length,a)),_.assertAxesAreInnerMostDims("any",c,a);let[p,f]=_.computeOutAndReduceShapes(d.shape,c),m=v.sizeFromShape(f),h=ie({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=Jr(h,h.dtype,"any",e),y;if(s){let x=_.expandShapeToKeepDim(p,l);y=ie({inputs:{x:g},backend:e,attrs:{shape:x}})}else y=ie({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var uq={kernelName:hf,backendName:"webgl",kernelFunc:qge};var PC=class{constructor(n,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=n;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var $C=class{constructor(n,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,v.assert(n.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,c=je(l),u=ln("coords",l),d,p;if(s===1){p=l+1;let O=je(p);d=`
        ${O} sourceLocR = ${O}(${u.join()}, 0);
        ++${u[l-1]};
        ${O} sourceLocG = ${O}(${u.join()}, 0);
        ++${u[l-2]};
        ${O} sourceLocA = ${O}(${u.join()}, 0);
        --${u[l-1]};
        ${O} sourceLocB = ${O}(${u.join()}, 0);
        --${u[l-2]};`}else p=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;let f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],h=f.map(O=>"int "+O),g=ln("sourceLocR",p-1).concat("inIdx.r"),y=ln("sourceLocG",p-1).concat("inIdx.g"),x=ln("sourceLocB",p-1).concat("inIdx.b"),w=ln("sourceLocA",p-1).concat("inIdx.a"),b=r==="max"?"greaterThan":"lessThan",S=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${w.join()})));`,E=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${x.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${w.join()}) : 0.)`,D=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${E};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${S}
          vec4 candidate = ${E};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${b}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function dq(t,n,e,r=null){let o=n.shape[0],i=n.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=_.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new PC(a,e,r==null),c=[n];r!=null&&c.push(r);let u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;let d=dq(t,n,e,u);return t.disposeIntermediateTensorInfo(u),d}function pq(t,n,e,r=null){let o=r!=null?r.shape:n.shape,i=o[o.length-1],s=_.computeOptimalWindowSize(i),a=new $C(o,s,e,r==null),l=r==null?[n]:[n,r],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===n.shape.length){let u=pq(t,n,e,c);return t.disposeIntermediateTensorInfo(c),u}return c}function LC(t,n,e,r){let o=[e];if(_.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,n.shape.length),!G().getBool("WEBGL_PACK_REDUCE")||n.shape.length<=2){let i=[],[s,a]=_.computeOutAndReduceShapes(n.shape,o),l=v.sizeFromShape(a),c=ie({inputs:{x:n},backend:t,attrs:{shape:[-1,l]}});i.push(c);let u=dq(t,c,r);i.push(u);let d=ie({inputs:{x:u},backend:t,attrs:{shape:s}});return i.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}return pq(t,n,r)}function Kge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=v.parseAxisParam(i,o.shape),a=_.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Wt({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=_.getInnerMostAxes(s.length,l.shape.length)),_.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=LC(e,l,s[0],"max");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var fq={kernelName:Al,backendName:"webgl",kernelFunc:Kge};function Xge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=v.parseAxisParam(i,o.shape),a=_.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Wt({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=_.getInnerMostAxes(s.length,l.shape.length)),_.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=LC(e,l,s[0],"min");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var mq={kernelName:Rl,backendName:"webgl",kernelFunc:Xge};var Yge=Mn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Zge=be({opSnippet:Yge}),hq={kernelName:Us,backendName:"webgl",kernelFunc:Zge};var Qge=Mn+"return log(x + sqrt(x * x + 1.0));",Jge=be({opSnippet:Qge}),gq={kernelName:js,backendName:"webgl",kernelFunc:Jge};var eye=Mn+`
  return atan(x);
`,tye=be({opSnippet:eye}),yq={kernelName:Gs,backendName:"webgl",kernelFunc:tye};var nye=HH+`
  return atan(a, b);
`,rye=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+qH+`
  return result;
`,oye=yt({opSnippet:nye,packedOpSnippet:rye}),xq={kernelName:Hs,backendName:"webgl",kernelFunc:oye};var iye=Mn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,sye=be({opSnippet:iye}),vq={kernelName:Ws,backendName:"webgl",kernelFunc:sye};var Di=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;let h=e==="avg",g=`((batch  * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + d`,y=`(xR * ${n.inWidth} + xC) * ${n.inChannels} + d`,x="0.0";if(h||(x="-1.0 / 1e-20"),r){let O=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${O} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:y:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let w="max",b=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(b="avgValue / count");let S=Math.floor(s/4)*4,E=s%4,D=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${w}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${x};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${x});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${S}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${S};
          if (${E===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${E===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${E===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${b});
      }
    `}},Wc=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideDepth,l=n.strideHeight,c=n.strideWidth,u=n.dilationDepth,d=n.dilationHeight,p=n.dilationWidth,f=n.effectiveFilterDepth,m=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.front,y=n.padInfo.top,x=n.padInfo.left;this.outputShape=n.outShape;let w=e==="avg",b="0.0";if(w||(b="-1.0 / 1e-20"),r){let P=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${y}, ${x});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${n.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${P} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${n.inDepth} + xD) * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`((xD * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let S="max",E=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(E="avgValue / count");let D=Math.floor(s/4)*4,O=s%4,R=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${y}, ${x});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${D};
            if (${O===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${O===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${O===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${R}
            }
          }
          setOutput(${E});
        }
      }
    `}};function aye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;cs(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;v.assert(_.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=_.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&v.arraysEqual(u.inShape,u.outShape))return cn({inputs:{x:o},backend:e});let d=new Di(u,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}var bq={kernelName:Ol,backendName:"webgl",kernelFunc:aye};function lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=_.computePool3DInfo(o.shape,i,s,u,a,l,c),p=new Wc(d,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var wq={kernelName:Ml,backendName:"webgl",kernelFunc:lye};var VC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=l-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},BC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,h=p-1-n.padInfo.top,g=f-1-n.padInfo.left,y=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function cye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=_.computePool3DInfo(s.shape,a,l,d,c,u),f=new BC(p);return e.runWebGLProgram(f,[o],s.dtype)}var Cq={kernelName:yf,backendName:"webgl",kernelFunc:cye};function uye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;cs([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=_.computePool2DInfo(s.shape,a,l,1,c),d=new VC(u);return e.runWebGLProgram(d,[o],s.dtype)}var Iq={kernelName:gf,backendName:"webgl",kernelFunc:uye};function dye(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;return Bd({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var Sq={kernelName:Fl,backendName:"webgl",kernelFunc:dye};var zC=class{constructor(n,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],_.assertAndGetBroadcastShape(n,e),_.assertAndGetBroadcastShape(n,r);let a="0.0";o!=null&&(_.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(_.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var UC=class{constructor(n,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],_.assertAndGetBroadcastShape(n,e),_.assertAndGetBroadcastShape(n,r);let a="vec4(0.0)";o!=null&&(_.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(_.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var pye=({inputs:t,backend:n,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=t;v.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),v.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),v.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let c=[r,o,i],u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));let p=G().getBool("WEBGL_PACK_NORMALIZATION")?new UC(r.shape,o.shape,i.shape,u,d,l):new zC(r.shape,o.shape,i.shape,u,d,l);return n.runWebGLProgram(p,c,c[0].dtype)},Tq={kernelName:Hl,backendName:"webgl",kernelFunc:pye};var jC=class{constructor(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;let e=je(this.rank),r=`uniform int start[${this.rank}];`,o=fye(this.rank),i,s=n.map((a,l)=>`sourceLoc.${zk[l]} = start[${l}] + coords.${zk[l]};`);i=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      ${r}
      void main() {
        ${i}
        setOutput(getSource(${o}));
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}},zk=["x","y","z","w","u","v"];function fye(t){if(t===1)return"sourceLoc";if(t<=6)return zk.slice(0,t).map(n=>"sourceLoc."+n).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var GC=class{constructor(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;let e=je(this.rank),r=ln("coords",this.rank),o=ln("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${n[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${n.map((u,d)=>`start[${d}]`).join()});`:n.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}};function mye(t,n,e,r){let o=r.texData.get(t.dataId),i=r.makeTensorInfo(e,t.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=t.dtype;let a=qn.computeFlatOffset(n,v.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function Qa(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r,[a,l]=qn.parseSliceParams(o,i,s);if(qn.assertParamsValid(o,a,l),v.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.texData.get(o.dataId),p=xH(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}let{isPacked:c}=e.texData.get(o.dataId),u=qn.isSliceContinous(o.shape,a,l);if(c||!u){let d=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new GC(l):new jC(l),p=d.getCustomSetupFunc(a);return e.runWebGLProgram(d,[o],o.dtype,p)}return e.uploadToGPU(o.dataId),mye(o,a,l,e)}var Eq={kernelName:fc,backendName:"webgl",kernelFunc:Qa};var hye=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;v.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((x,w)=>x*w),l=_.getReshaped(o.shape,i,a),c=_.getPermuted(l.length,i.length),u=_.getReshapedPermuted(o.shape,i,a),d=_.getSliceBeginCoords(s,i.length),p=_.getSliceSize(u,s,i.length),f=[],m=ie({inputs:{x:o},backend:e,attrs:{shape:l}}),h=Wt({inputs:{x:m},backend:e,attrs:{perm:c}}),g=ie({inputs:{x:h},backend:e,attrs:{shape:u}}),y=Qa({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(m),f.push(h),f.push(g),f.forEach(x=>e.disposeIntermediateTensorInfo(x)),y},_q={kernelName:Pl,backendName:"webgl",kernelFunc:hye};function gye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),c=CC(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var Dq={kernelName:tb,backendName:"webgl",kernelFunc:gye};var yye="return float(a != b);",Uk=yt({opSnippet:yye,dtype:"bool"}),Nq={kernelName:qu,backendName:"webgl",kernelFunc:Uk};function Ja(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return cn({inputs:{x:o.complexTensorInfos.real},backend:e})}var kq={kernelName:Ff,backendName:"webgl",kernelFunc:Ja};var xye="return float(int(x));";function Aq(t,n){let e=new wr(t.shape,xye),r=n.runWebGLProgram(e,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function jk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return cn({inputs:{x:o},backend:e});let s=Lt(o.shape),a=jk({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Mr({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=Ja({inputs:{input:o},backend:e}),a=jk({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!v.hasEncodingLoss(o.dtype,i)){let s=cn({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32")return Aq(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",v.getTypedArrayFromDType("bool",1)),l=Uk({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var Rq={kernelName:Xi,backendName:"webgl",kernelFunc:jk};var Oq="return ceil(x);",vye=be({opSnippet:Oq,packedOpSnippet:Oq,cpuKernelImpl:eH}),Mq={kernelName:qs,backendName:"webgl",kernelFunc:vye};var WC=class{constructor(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};var HC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};function bye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{clipValueMin:i,clipValueMax:s}=r,a;G().getBool("WEBGL_PACK_CLIP")?a=new HC(o.shape):a=new WC(o.shape);let l=a.getCustomSetupFunc(i,s);return e.runWebGLProgram(a,[o],o.dtype,l)}var Fq={kernelName:Ks,backendName:"webgl",kernelFunc:bye};var qC=class{constructor(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function Pq(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}}function wye(t){let{inputs:n,backend:e}=t,{x:r}=n,o=e.texData.get(r.dataId),i=new qC(r.shape),s=[Pq(r,o.complexTensorInfos.real),Pq(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var $q={kernelName:$l,backendName:"webgl",kernelFunc:wye};var KC=class{constructor(n){this.outputShape=[],this.outputShape=_.computeOutShape(n,1),this.variableNames=n.map((s,a)=>`T${a}`);let e=new Array(n.length-1);e[0]=n[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+n[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var YC=class{constructor(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=_.computeOutShape(n,e);let r=this.outputShape,o=r.length,i=je(o),s=ln("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=n.map((h,g)=>`T${g}`);let l=new Array(n.length-1);l[0]=n[0][e];for(let h=1;h<l.length;h++)l[h]=l[h-1]+n[h][e];let c=a[e],u=a.slice(-2),d=a.join(),p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let h=1;h<l.length;h++){let g=l[h-1];p+=`
        if (${c} < ${l[h]}  && ${c} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${XC(a,c,g)}),
            vec2(${XC(u,c,g)}));
        }`}let f=l.length,m=l[l.length-1];p+=`
        return getChannel(
          getT${f}(${XC(a,c,m)}),
          vec2(${XC(u,c,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function XC(t,n,e){let r=t.indexOf(n);return t.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function zd(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return cn({inputs:{x:o.complexTensorInfos.imag},backend:e})}var Lq={kernelName:Nf,backendName:"webgl",kernelFunc:zd};function Ud(t,n,e){let r=t[0].dtype;if(r==="complex64"){let u=t.map(h=>Ja({inputs:{input:h},backend:e})),d=t.map(h=>zd({inputs:{input:h},backend:e})),p=Ud(u,n,e),f=Ud(d,n,e),m=Mr({inputs:{real:p,imag:f},backend:e});return u.forEach(h=>e.disposeIntermediateTensorInfo(h)),d.forEach(h=>e.disposeIntermediateTensorInfo(h)),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}let o=e.shouldExecuteOnCPU(t);if(r==="string"&&(o=!0),o){let u=t.map(y=>{let w=[-1,v.sizeFromShape(y.shape.slice(n))];return ie({inputs:{x:y},backend:e,attrs:{shape:w}})}),d=u.map(y=>({vals:e.readSync(y.dataId),shape:y.shape})),p=_.computeOutShape(u.map(y=>y.shape),1),f=u[0].shape[0]===1,m=tH(d,p,r,f),h=_.computeOutShape(t.map(y=>y.shape),n),g=e.makeTensorInfo(h,r,m);return u.forEach(y=>e.disposeIntermediateTensorInfo(y)),g}if(t.length>G().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(t.length/2),d=Ud(t.slice(0,u),n,e),p=Ud(t.slice(u),n,e),f=Ud([d,p],n,e);return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),f}if(G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){let u=new YC(t.map(d=>d.shape),n);return e.runWebGLProgram(u,t,r)}let{tensors2D:i,outShape:s}=Cye(t,n,e),a=new KC(i.map(u=>u.shape)),l=e.runWebGLProgram(a,i,r);i.forEach(u=>e.disposeIntermediateTensorInfo(u));let c=ie({inputs:{x:l},attrs:{shape:s},backend:e});return e.disposeIntermediateTensorInfo(l),c}function Cye(t,n,e){let r=_.computeOutShape(t.map(i=>i.shape),n);return{tensors2D:t.map(i=>ie({inputs:{x:i},attrs:{shape:[-1,v.sizeFromShape(i.shape.slice(n))]},backend:e})),outShape:r}}function Gk(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=v.parseAxisParam(o,n[0].shape)[0],s=_.computeOutShape(n.map(c=>c.shape),i);if(v.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(c=>v.sizeFromShape(c.shape)>0);if(a.length===1)return cn({inputs:{x:a[0]},backend:e});let l=a.map(c=>c.shape);return _.assertParamsConsistent(l,i),Ud(a,i,e)}var Vq={kernelName:Ll,backendName:"webgl",kernelFunc:Gk};var zm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4,g=n.dataFormat==="channelsLast",y=g?1:2,x=g?2:3,w=g?3:1,b="",S="";r&&(o?b=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?b=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:b=`
          float activation(float x) {
            ${r}
          }
        `,S="result = activation(result);");let E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${b}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${w}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${x}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${n.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${E}
        ${S}
        setOutput(result);
      }
    `}},ZC=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let e=n.padInfo.front,r=n.padInfo.top,o=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var QC=class{constructor(n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let{filterWidth:o,inChannels:i,strideWidth:s,strideHeight:a,padInfo:l,outWidth:c,dilationWidth:u,dilationHeight:d,dataFormat:p}=r,{left:f,top:m}=l,h=i*o,g=Qt(),y=p==="channelsLast",x=y?0:1,w=y?1:2,b="";for(let S=0;S<=1;S++)for(let E=0;E<=1;E++)b+=`
          blockIndex = rc.y + ${E};
          pos = rc.x + ${S};

          if(blockIndex < ${n[1]} && pos < ${n[0]}) {
            offsetY = int(blockIndex / (${c})) * ${a} - ${m};
            d0 = offsetY + ${d} * (pos / ${h});

            if(d0 < ${e[x]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${c}.) * ${s}. - ${f}.);
              d1 = offsetX + ${u} * (int(mod(float(pos), ${h}.) / ${i}.));

              if(d1 < ${e[w]} && d1 >= 0) {

                ch = int(mod(float(pos), ${i}.));

                if (${y}) {
                  innerDims = vec2(d1, ch);
                  result[${S*2+E}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${S*2+E}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${b}

        ${g.output} = result;
      }
    `}};function JC({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=t.shape,c=r.texData.get(t.dataId),u=e.inChannels,d=l[0]*l[1]*l[2],p=e.outChannels,f=e.dataFormat==="channelsLast",m=!1,h=!1,g,y=[],x=(d===1||p===1)&&u>Bk,w=l[2]%2!==0&&!!c.isPacked;if(x||!G().getBool("WEBGL_LAZILY_UNPACK")||!G().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!w){let b=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],S=ie({inputs:{x:t},backend:r,attrs:{shape:[1,b,e.inChannels]}}),E=ie({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=Bd({a:S,b:E,transposeA:m,transposeB:h,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=ie({inputs:{x:D},backend:r,attrs:{shape:e.outShape}}),y.push(S),y.push(E),y.push(D)}else{let b=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),S={dataId:t.dataId,shape:[1,b,e.inChannels],dtype:t.dtype},E=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,v.assert(Pd(c.shape,S.shape),()=>`packed reshape ${c.shape} to ${S.shape} isn't free`);let D=ie({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});y.push(D);let O=Bd({a:S,b:D,backend:r,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),R=r.texData.get(O.dataId);v.assert(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=E,R.shape=e.outShape,g=cn({inputs:{x:O},backend:r}),g.shape=e.outShape,y.push(O)}for(let b of y)r.disposeIntermediateTensorInfo(b);return g}function eI({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:p,dataFormat:f}=e,m=f==="channelsLast",h=l*c*u,g=p*d,y=[h,g],x=!0,w=!1,b=[],S=ie({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),E=ie({inputs:{x:n},backend:r,attrs:{shape:[1,h,v.sizeFromShape(n.shape)/h]}});b.push(S),b.push(E);let D=new QC(y,S.shape,e),O=r.runWebGLProgram(D,[S],"float32"),R=ie({inputs:{x:O},backend:r,attrs:{shape:[1,y[0],y[1]]}});b.push(O),b.push(R);let P=o!=null,U=i!=null,j=a==="leakyrelu",W=a?jc(a,!0):null,K=new Bm(R.shape,E.shape,[1,g,e.outChannels],x,w,P,W,U,j),H=[R,E];if(o&&H.push(o),U&&H.push(i),j){let te=r.makeTensorInfo([],"float32",v.createScalarValue(s,"float32"));H.push(te),b.push(te)}let Y=r.runWebGLProgram(K,H,"float32"),ne=m?[1,p,d,e.outChannels]:[1,e.outChannels,p,d],J=ie({inputs:{x:Y},backend:r,attrs:{shape:ne}});b.push(Y);for(let te of b)r.disposeIntermediateTensorInfo(te);return J}function Iye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=_.convertConv2DDataFormat(l),p=_.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=JC({x:o,filter:i,convInfo:p,backend:e});else if(G().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)f=eI({x:o,filter:i,convInfo:p,backend:e});else{let h=new zm(p);f=e.runWebGLProgram(h,[o,i],"float32")}let m=ie({inputs:{x:f},backend:e,attrs:{shape:p.outShape}});return e.disposeIntermediateTensorInfo(f),m}var Bq={kernelName:Vl,backendName:"webgl",kernelFunc:Iye};var tI=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              if (${s}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},nI=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,l=r-1-n.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${n.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},rI=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yF = 0; yF < ${n.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${n.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${n.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${n.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},oI=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=e-1-n.padInfo.front,c=r-1-n.padInfo.top,u=o-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${n.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${n.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Sye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=_.convertConv2DDataFormat(l),p=_.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new tI(p);return e.runWebGLProgram(f,[o,i],"float32")}var zq={kernelName:vf,backendName:"webgl",kernelFunc:Sye};function Tye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=_.convertConv2DDataFormat(c),p=_.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d),f=new nI(p);return e.runWebGLProgram(f,[o,i],"float32")}var Uq={kernelName:Bl,backendName:"webgl",kernelFunc:Tye};function Eye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=_.computeConv3DInfo(o.shape,i.shape,s,l,a),u=new ZC(c);return e.runWebGLProgram(u,[o,i],"float32")}var jq={kernelName:zl,backendName:"webgl",kernelFunc:Eye};function _ye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r,c=_.computeConv3DInfo(o.shape,l,s,1,a),u=new rI(c);return e.runWebGLProgram(u,[o,i],"float32")}var Gq={kernelName:bf,backendName:"webgl",kernelFunc:_ye};function Dye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r,c=_.computeConv3DInfo(l,i.shape,a,1,s),u=new oI(c);return e.runWebGLProgram(u,[o,i],"float32")}var Wq={kernelName:wf,backendName:"webgl",kernelFunc:Dye};var Nye=NC+`
  return cos(x);
`,kye=be({opSnippet:Nye}),Hq={kernelName:Xs,backendName:"webgl",kernelFunc:kye};var Aye=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Rye=be({opSnippet:Aye}),qq={kernelName:Ys,backendName:"webgl",kernelFunc:Rye};var iI=class{constructor(n,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,c]=n,[u]=e,[d,p]=r;this.outputShape=[u,d,p,c];let f=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[g,y,x]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[w,b,S]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${w});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${b};

        float in_y = ${x};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${S};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var Oye=t=>{let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,u=new iI(o.shape,i.shape,a,l,c);return e.runWebGLProgram(u,[o,i,s],"float32")},Kq={kernelName:nb,backendName:"webgl",kernelFunc:Oye};var $y=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=n;let o=n.length,i=e?"0.0":`getX(${Xq(o,"coords")})`,s=n[n.length-1],a="",l="";e?(a=r?`end != ${s-1}`:"end != 0",l=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${s}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${je(o)} coords = getOutputCoords();
        int end = ${Yq(o,"coords")};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${l};
          ${Yq(o,"coords")} = idx;
          val += getX(${Xq(o,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.index==null&&(this.index=e.getUniformLocation(r,"index")),e.gl.uniform1f(this.index,n)}}};function Xq(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.x, ${n}.y`;if(t===3)return`${n}.x, ${n}.y, ${n}.z`;if(t===4)return`${n}.x, ${n}.y, ${n}.z, ${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Yq(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.y`;if(t===3)return`${n}.z`;if(t===4)return`${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Mye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r,l=o.shape.length,c=_.getAxesPermutation([i],l),u=o;c!=null&&(u=Wt({inputs:{x:o},backend:e,attrs:{perm:c}}));let d=_.getInnerMostAxes(1,l)[0];if(d!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${o.shape.length-1} but got axis=${i}`);let p=u.shape[d],f=cn({inputs:{x:u},backend:e});for(let m=0;m<=Math.ceil(Math.log2(p))-1;m++){let h=new $y(u.shape,!1,a),g=h.getCustomSetupFunc(m),y=f;f=e.runWebGLProgram(h,[f],f.dtype,g),e.disposeIntermediateTensorInfo(y)}if(s){let m=new $y(u.shape,s,a),h=f;f=e.runWebGLProgram(m,[f],f.dtype),e.disposeIntermediateTensorInfo(h)}if(c!=null){let m=_.getUndoAxesPermutation(c),h=Wt({inputs:{x:f},backend:e,attrs:{perm:m}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(u),h}return f}var Zq={kernelName:Ul,backendName:"webgl",kernelFunc:Mye};function Fye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=CC(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=JW(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var Qq={kernelName:rb,backendName:"webgl",kernelFunc:Fye};var sI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Pye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;v.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),m=s==="NHWC"?[a,d,p,f]:[a,f,d,p],h=new sI(m,i,s);return e.runWebGLProgram(h,[o],o.dtype)}var Jq={kernelName:Cf,backendName:"webgl",kernelFunc:Pye};var Um=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.inHeight,a=n.inWidth,l=n.padInfo.top,c=n.padInfo.left,u=n.strideHeight,d=n.strideWidth,p=n.dilationHeight,f=n.dilationWidth,m=n.filterHeight,h=n.filterWidth,g=n.outChannels/n.inChannels,y="",x="";r&&(o?y=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?y=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:y=`
          float activation(float x) {
            ${r}
          }
        `,x="result = activation(result);");let w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      const ivec2 strides = ivec2(${u}, ${d});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${g};
        int q = d2 - d1 * ${g};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${s}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${a}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${w}
        ${x}
        setOutput(result);
      }
    `}};var jm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;let s=n.outChannels/n.inChannels,a=n.inHeight,l=n.inWidth,c=n.padInfo.top,u=n.padInfo.left,d=n.strideHeight,p=n.strideWidth,f=n.dilationHeight,m=n.dilationWidth,h=n.filterHeight,g=n.filterWidth,y=g,x=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let E=0;E<g;E++)x+=`
          vec4 xTexelC${E*2};
          int xTexelC${E*2}Ready;
          vec4 xC${E};`;for(let E=0;E<h;E++){for(let D=0;D<g;D++)x+=`
          xTexelC${D*2} = vec4(0.0);
          xTexelC${D*2}Ready = 0;
          xC${D} = vec4(0.0);`;x+=`
        xR = xRCorner + ${E*f};
        if (xR >=0 && xR < ${a}) {
      `;for(let D=0;D<(y+1)/2;D++){let O=D*2,R=O*m;if(x+=`
          xC = xCCorner + ${R};
          `,p===1){if(O<g&&(u%2===1?(x+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }
              `,m===1&&R>0?x+=`
                xC${O} = vec4(xTexelC${R-2}.zw, xTexelC${R}.xy);
                `:x+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < ${l}) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      previous.zw = vec2(0.0);
                    }

                    xC${O} = vec4(previous.zw, xTexelC${R}.xy);
                  } else {
                    xC${O} = vec4(0.0, 0.0, xTexelC${R}.xy);
                  }
                  `):x+=`
                if (xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xC${O} = xTexelC${R};
                `,R+1<g)){let P=u%2===0?v.nearestLargerEven(m):m;m%2===0&&u%2===1||m%2!==0&&u%2!==1?(x+=`
                  xCOffset = xC + ${u%2} + ${P};

                  if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                    xTexelC${R+2} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      xTexelC${R+2}.zw = vec2(0.0);
                    }
                    xTexelC${R+2}Ready = 1;
                  }
                  `,m>1&&(x+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                      xTexelC${R} = getX(batch, xR, xCOffset, d1);
                      xTexelC${R}Ready = 1;
                    }
                    `),x+=`
                  xC${O+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.xy);
                  `):P===1?x+=`
                    xC${O+1} = xTexelC${R};
                    `:x+=`
                    xCOffset = xC + ${P};

                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                      xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= ${l}) {
                        xTexelC${R+2}.zw = vec2(0.0);
                      }
                      xTexelC${R+2}Ready = 1;
                    }

                    xC${O+1} = xTexelC${R+2};
                    `}}else R<g&&(u%2===1?(x+=`
                xCOffset = xC + 1 - ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.0);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${O} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
              `,R+1<g&&(x+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + ${p};
                  if(xCOffset >= 0 && xCOffset < ${l}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${O+1} = vec4(xTexelC${R+2}.xy, final.xy);
                `)):(x+=`
                if(xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xCOffset = xC + ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${O} = vec4(
                  xTexelC${R}.xy, xTexelC${R+2}.xy);
              `,R+1<g&&(x+=`
                  xC${O+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
                `)));O<g&&(x+=`
            wTexel = getW(${E}, ${R}, d1, q);
            dotProd += xC${O} * vec4(wTexel.xz, wTexel.xz);
          `,R+1<g&&(x+=`
              wTexel = getW(${E}, ${R+1}, d1, q);
              dotProd += xC${O+1} * vec4(wTexel.xz, wTexel.xz);
            `))}x+=`
        }
      `}let w="",b="";r&&(o?w=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?w=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:w=`vec4 activation(vec4 x) {
          ${r}
        }`,b="result = activation(result);");let S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${w}

      const ivec2 strides = ivec2(${d}, ${p});
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${x}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${S}
        ${b}
        setOutput(result);
      }
    `}};function $ye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r,u=l;u==null&&(u=[1,1]),v.assert(_.eitherStridesOrDilationsAreOne(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let d=_.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!0),p;return G().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new jm(d):p=new Um(d),e.runWebGLProgram(p,[o,i],"float32")}var e5={kernelName:jl,backendName:"webgl",kernelFunc:$ye};var aI=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},lI=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,a=r-1-n.padInfo.left,l=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=_.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new aI(d);return e.runWebGLProgram(p,[o,i],"float32")}var t5={kernelName:If,backendName:"webgl",kernelFunc:Lye};function Vye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=_.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new lI(d);return e.runWebGLProgram(p,[o,i],"float32")}var n5={kernelName:Sf,backendName:"webgl",kernelFunc:Vye};var cI=class{constructor(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function Bye(t){let{inputs:n,backend:e}=t,{x:r}=n,o=[...r.shape,...r.shape],i=v.sizeFromShape(r.shape),s=ie({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new cI(i),l=e.runWebGLProgram(a,[s],s.dtype),c=ie({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),c}var r5={kernelName:ob,backendName:"webgl",kernelFunc:Bye};var uI=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=n,{top:d,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function zye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=_.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u,d=new uI(c);u=e.runWebGLProgram(d,[o,i],"float32");let p=ie({inputs:{x:u},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(u),p}var o5={kernelName:Gl,backendName:"webgl",kernelFunc:zye};function Uye(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=_.decodeEinsumEquation(o,i.length);_.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=_.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:y,expandDims:x}=_.getEinsumPermutation(f,l[g]),w;_.isIdentityPermutation(y)?w=i[g]:(w=Wt({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),m.push(w));let b=w.shape.slice();for(let S=0;S<x.length;++S)b.splice(x[S],0,1);v.arraysEqual(w.shape,b)||(w=ie({inputs:{x:w},backend:e,attrs:{shape:b}}),m.push(w)),p===null?p=w:(p=Fy({inputs:{a:w,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=Vd({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var i5={kernelName:ib,backendName:"webgl",kernelFunc:Uye};var jye="return (x >= 0.0) ? x : (exp(x) - 1.0);",Gye=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Wye=be({opSnippet:jye,packedOpSnippet:Gye}),s5={kernelName:Qs,backendName:"webgl",kernelFunc:Wye};var Hye="return (b >= 1.0) ? a : a * (b + 1.0);",qye=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Kye=t=>{let{inputs:n,backend:e}=t,{dy:r,y:o}=n,i=G().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ei(qye,r.shape,o.shape):new Co(Hye,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},a5={kernelName:Tf,backendName:"webgl",kernelFunc:Kye};var Xye=`
  return vec4(equal(a, b));
`,Yye="return float(a == b);",Zye=yt({opSnippet:Yye,packedOpSnippet:Xye,dtype:"bool"}),l5={kernelName:Bu,backendName:"webgl",kernelFunc:Zye};var Qye=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${_.ERF_P};
  float a1 = ${_.ERF_A1};
  float a2 = ${_.ERF_A2};
  float a3 = ${_.ERF_A3};
  float a4 = ${_.ERF_A4};
  float a5 = ${_.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Jye=be({opSnippet:Qye}),c5={kernelName:Js,backendName:"webgl",kernelFunc:Jye};var u5="return exp(x);",Wk=be({opSnippet:u5,packedOpSnippet:u5,cpuKernelImpl:nH}),d5={kernelName:ea,backendName:"webgl",kernelFunc:Wk};function dI(t){let{inputs:n,attrs:e,backend:r}=t,{dim:o}=e,{input:i}=n,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(v.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),ie({inputs:{x:i},backend:r,attrs:{shape:a}})}var p5={kernelName:Wl,backendName:"webgl",kernelFunc:dI};var f5="return exp(x) - 1.0;",exe=be({opSnippet:f5,packedOpSnippet:f5,cpuKernelImpl:rH}),m5={kernelName:ta,backendName:"webgl",kernelFunc:exe};var Ly=class{constructor(n,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(n==="real")a="return real * expR - imag * expI;";else if(n==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${n}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function pI(t,n,e){let r=e.texData.get(t.dataId),o=v.sizeFromShape(t.shape),i=t.shape[t.shape.length-1],s=o/i,a=ie({inputs:{x:t},backend:e,attrs:{shape:[s,i]}}),l=a.shape,c=new Ly("real",l,n),u=new Ly("imag",l,n),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Mr({inputs:{real:p,imag:f},backend:e});e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f);let h=ie({inputs:{x:m},backend:e,attrs:{shape:t.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(m),h}function txe(t){let{inputs:n,backend:e}=t,{input:r}=n;return pI(r,!1,e)}var h5={kernelName:Ef,backendName:"webgl",kernelFunc:txe};var fI=class{constructor(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};function Vy(t){let{backend:n,attrs:e}=t,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||v.inferDtype(o),i==="string"){let s=v.getArrayFromDType(i,v.sizeFromShape(r));return s.fill(o),n.makeTensorInfo(r,i,s)}else{let s=new fI(r,o),a=s.getCustomSetupFunc(o);return n.runWebGLProgram(s,[],i,a)}}var g5={kernelName:_f,backendName:"webgl",kernelFunc:Vy};var mI=class{constructor(n){this.variableNames=["Image"],this.outputShape=[];let e=n[2];this.outputShape=n,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var y5={kernelName:sb,backendName:"webgl",kernelFunc:({inputs:t,backend:n})=>{let{image:e}=t,r=n,o=new mI(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var x5="return floor(x);",nxe=be({opSnippet:x5,packedOpSnippet:x5,cpuKernelImpl:oH}),v5={kernelName:na,backendName:"webgl",kernelFunc:nxe};var rxe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,oxe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,ixe=yt({opSnippet:rxe,packedOpSnippet:oxe,dtype:"int32"}),b5={kernelName:ra,backendName:"webgl",kernelFunc:ixe};var hI=class{constructor(n){this.variableNames=["A"];let e=Qt(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var gI=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=Qt(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var w5={kernelName:x$,backendName:"webgl",kernelFunc:sxe},Gm;function sxe(t){let{inputs:n,backend:e,attrs:r}=t,{pixels:o}=n,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,i];(a||s)&&(Gm==null&&(Gm=document.createElement("canvas").getContext("2d")),Gm.canvas.width=l,Gm.canvas.height=c,Gm.drawImage(o,0,0,l,c),o=Gm.canvas);let p=e.makeTensorInfo(u,"int32");e.texData.get(p.dataId).usage=dr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);let f=G().getBool("WEBGL_PACK")?new gI(d):new hI(d),m=e.runWebGLProgram(f,[p],"int32");return e.disposeData(p.dataId),m}function axe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=_.convertConv2DDataFormat(u),g=_.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,h),y,x=[];if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=JC({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(G().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)y=eI({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{let b=s!=null,S=a!=null,E=f==="leakyrelu",D=f?jc(f,!1):null,O=new zm(g,b,D,S,E),R=[o,i];if(s&&R.push(s),a&&R.push(a),E){let P=e.makeTensorInfo([],"float32",v.createScalarValue(m,"float32"));R.push(P),x.push(P)}y=e.runWebGLProgram(O,R,"float32")}let w=ie({inputs:{x:y},backend:e,attrs:{shape:g.outShape}});return x.push(y),x.forEach(b=>e.disposeIntermediateTensorInfo(b)),w}var C5={kernelName:Xu,backendName:"webgl",kernelFunc:axe};function lxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[],h=u;h==null&&(h=[1,1]),v.assert(_.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let g=_.computeConv2DInfo(o.shape,i.shape,l,h,c,d,!0),y=G().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,x=p?jc(p,y):null,w=[o,i],b=s!=null,S=a!=null,E=p==="leakyrelu";if(b&&w.push(s),S&&w.push(a),E){let R=e.makeTensorInfo([],"float32",v.createScalarValue(f,"float32"));w.push(R),m.push(R)}let D;y?D=new jm(g,b,x,S,E):D=new Um(g,b,x,S,E);let O=e.runWebGLProgram(D,w,"float32");return m.forEach(R=>e.disposeIntermediateTensorInfo(R)),O}var I5={kernelName:Yu,backendName:"webgl",kernelFunc:lxe};var yI=class{constructor(n,e,r){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;let o=je(e.length),i=je(r.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${o} strides = ${o}(${this.strides});
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${s};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}};function cxe(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=o.shape,s=i[i.length-1],[a,l,c,u]=_.prepareAndValidate(r,o),d=ie({inputs:{x:o},backend:e,attrs:{shape:[l,s]}}),p=ie({inputs:{x:r},backend:e,attrs:{shape:[v.sizeFromShape(r.shape)/c,c]}}),f=new yI(s,u,[l,c]),m=e.runWebGLProgram(f,[p,d],p.dtype),h=ie({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),h}var S5={kernelName:ab,backendName:"webgl",kernelFunc:cxe};var xI=class{constructor(n,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=je(this.rank),o=uxe(n,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}};function uxe(t,n){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<t.length;o++)o===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${e[o]}`);return r.join()}function dxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r,l=v.parseAxisParam(s,o.shape)[0],c=_.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=v.sizeFromShape(i.shape),d=[],p=ie({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=ie({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let m=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let x=e.bufferSync(f),w=e.bufferSync(p),b=iH(w,x,m);return d.forEach(S=>e.disposeIntermediateTensorInfo(S)),e.makeTensorInfo(c.outputShape,b.dtype,b.values)}let h=new xI(p.shape,m),g=e.runWebGLProgram(h,[p,f],p.dtype);d.push(g);let y=ie({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(x=>e.disposeIntermediateTensorInfo(x)),y}var T5={kernelName:ql,backendName:"webgl",kernelFunc:dxe};var pxe="return float(a > b);",fxe=`
  return vec4(greaterThan(a, b));
`,mxe=yt({opSnippet:pxe,packedOpSnippet:fxe,cpuKernelImpl:sH,dtype:"bool"}),E5={kernelName:zu,backendName:"webgl",kernelFunc:mxe};var hxe="return float(a >= b);",gxe=`
  return vec4(greaterThanEqual(a, b));
`,yxe=yt({opSnippet:hxe,packedOpSnippet:gxe,dtype:"bool"}),_5={kernelName:oa,backendName:"webgl",kernelFunc:yxe};function xxe(t){let{inputs:n,backend:e}=t,{input:r}=n;return pI(r,!0,e)}var D5={kernelName:Df,backendName:"webgl",kernelFunc:xxe};var vxe="return float(!isnan(x) && !isinf(x));",bxe=be({opSnippet:vxe,dtype:"bool"}),N5={kernelName:ia,backendName:"webgl",kernelFunc:bxe};var wxe="return float(isinf(x));",Cxe=be({opSnippet:wxe,dtype:"bool"}),k5={kernelName:sa,backendName:"webgl",kernelFunc:Cxe};var Ixe="return float(isnan(x));",Sxe=be({opSnippet:Ixe,dtype:"bool"}),A5={kernelName:aa,backendName:"webgl",kernelFunc:Sxe};var Txe="return float(a < b);",Exe=`
  return vec4(lessThan(a, b));
`,_xe=yt({opSnippet:Txe,packedOpSnippet:Exe,cpuKernelImpl:aH,dtype:"bool"}),R5={kernelName:Uu,backendName:"webgl",kernelFunc:_xe};var Dxe="return float(a <= b);",Nxe=`
  return vec4(lessThanEqual(a, b));
`,kxe=yt({opSnippet:Dxe,packedOpSnippet:Nxe,dtype:"bool"}),O5={kernelName:ju,backendName:"webgl",kernelFunc:kxe};function Axe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=lH(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var M5={kernelName:lb,backendName:"webgl",kernelFunc:Axe};var Rxe=`if (x < 0.0) return NAN;
  return log(x);`,Oxe=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,Mxe=be({opSnippet:Rxe,packedOpSnippet:Oxe,cpuKernelImpl:cH}),F5={kernelName:la,backendName:"webgl",kernelFunc:Mxe};var Fxe="return log(1.0 + x);",Pxe=be({opSnippet:Fxe}),P5={kernelName:ca,backendName:"webgl",kernelFunc:Pxe};var $xe="return float(a >= 1.0 && b >= 1.0);",Lxe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Vxe=yt({opSnippet:$xe,packedOpSnippet:Lxe,dtype:"bool"}),$5={kernelName:Gu,backendName:"webgl",kernelFunc:Vxe};var Bxe="return float(!(x >= 1.0));",zxe=be({opSnippet:Bxe}),L5={kernelName:Wu,backendName:"webgl",kernelFunc:zxe};var Uxe="return float(a >= 1.0 || b >= 1.0);",jxe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Gxe=yt({opSnippet:Uxe,packedOpSnippet:jxe,dtype:"bool"}),V5={kernelName:Hu,backendName:"webgl",kernelFunc:Gxe};var vI=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var bI=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var Wxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c=G().getBool("WEBGL_PACK_NORMALIZATION")?new bI(o.shape,i,s,a,l):new vI(o.shape,i,s,a,l);return e.runWebGLProgram(c,[o],o.dtype)},B5={kernelName:Xl,backendName:"webgl",kernelFunc:Wxe};var wI=class{constructor(n,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var Hxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new wI(o.shape,a,l,c,u);return e.runWebGLProgram(d,[o,i,s],o.dtype)},z5={kernelName:kf,backendName:"webgl",kernelFunc:Hxe};function U5(t,n,e,r){let o=v.sizeFromShape(n),s=v.sizeFromShape(t.shape)/o,a=ie({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=Jr(a,t.dtype,"max",r),c=ie({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function Hk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),c=l,u=_.getAxesPermutation(c,a),d=u!=null,p=e.shouldExecuteOnCPU([o]),f=o;if(d){if(p){let w=e.texData.get(f.dataId).values,b=new Array(a);for(let D=0;D<b.length;D++)b[D]=o.shape[u[D]];let S=Ld(w,o.shape,o.dtype,u,b);f=e.makeTensorInfo(b,o.dtype);let E=e.texData.get(f.dataId);E.values=S}else f=Gc(o,u,e);c=_.getInnerMostAxes(c.length,a)}_.assertAxesAreInnerMostDims("max",c,a);let[m,h]=_.computeOutAndReduceShapes(f.shape,c),g=m;s&&(g=_.expandShapeToKeepDim(m,l));let y;if(p){let w=e.texData.get(f.dataId).values,b=uH(w,v.sizeFromShape(h),g,o.dtype);y=e.makeTensorInfo(g,o.dtype);let S=e.texData.get(y.dataId);S.values=b}else y=U5(f,h,g,e);return d&&e.disposeIntermediateTensorInfo(f),y}var j5={kernelName:Yl,backendName:"webgl",kernelFunc:Hk};var qxe=DC+`
  return max(a, b);
`,Kxe=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Uc+`
  return result;
`,Xxe=yt({opSnippet:qxe,packedOpSnippet:Kxe,cpuKernelImpl:dH}),G5={kernelName:ua,backendName:"webgl",kernelFunc:Xxe};function Yxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;cs(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;v.assert(_.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=_.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&v.arraysEqual(u.inShape,u.outShape))return cn({inputs:{x:o},backend:e});let d=new Di(u,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}var W5={kernelName:Zl,backendName:"webgl",kernelFunc:Yxe};function Zxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=_.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new Wc(d,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var H5={kernelName:Ql,backendName:"webgl",kernelFunc:Zxe};var CI=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideHeight,r=n.strideWidth,o=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,a=i-1-n.padInfo.top,l=s-1-n.padInfo.left,c=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},II=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterDepth,c=n.effectiveFilterHeight,u=n.effectiveFilterWidth,d=l-1-n.padInfo.front,p=c-1-n.padInfo.top,f=u-1-n.padInfo.left,m=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Qxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=_.computePool3DInfo(s.shape,a,l,d,c,u),f=new Wc(p,"max",!0),m=e.runWebGLProgram(f,[s],s.dtype),h=new II(p),g=e.runWebGLProgram(h,[o,m],s.dtype);return e.disposeIntermediateTensorInfo(m),g}var q5={kernelName:Rf,backendName:"webgl",kernelFunc:Qxe};function Jxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;cs([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=_.computePool2DInfo(a.shape,l,c,1,u,d),f=!0,m=new Di(p,"max",f),h=e.runWebGLProgram(m,[a],a.dtype),g=new CI(p),y=e.runWebGLProgram(g,[o,h],a.dtype);return e.disposeIntermediateTensorInfo(h),y}var K5={kernelName:Af,backendName:"webgl",kernelFunc:Jxe};function X5(t,n,e,r){let o=new Di(e,"max",!1),i=r.runWebGLProgram(o,[t],"float32");o=new Di(e,"max",!0,!0,n);let s=r.runWebGLProgram(o,[t],"float32");return[i,s]}var Y5={kernelName:cb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;v.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];v.assert(_.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=_.computePool2DInfo(r.shape,o,i,c,s),[d,p]=X5(r,a,u,l);return[d,p]}};function Z5(t,n,e,r){let o=v.sizeFromShape(n),s=v.sizeFromShape(t.shape)/o,a=ie({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=Jr(a,"float32","mean",r),c=ie({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}var Q5={kernelName:Jl,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{keepDims:o,axis:i}=n,s=e,a=r.shape.length,l=v.parseAxisParam(i,r.shape),c=l,u=_.getAxesPermutation(c,a),d=u!=null,p=s.shouldExecuteOnCPU([r]),f=[],m=r;if(d){if(p){let b=s.texData.get(m.dataId).values,S=new Array(a);for(let O=0;O<S.length;O++)S[O]=r.shape[u[O]];let E=Ld(b,r.shape,r.dtype,u,S);m=s.makeTensorInfo(S,r.dtype);let D=s.texData.get(m.dataId);D.values=E}else m=Gc(r,u,s);f.push(m),c=_.getInnerMostAxes(c.length,a)}_.assertAxesAreInnerMostDims("sum",c,a);let[h,g]=_.computeOutAndReduceShapes(m.shape,c),y=h;o&&(y=_.expandShapeToKeepDim(h,l));let x=Z5(m,g,y,s);for(let w of f)s.disposeIntermediateTensorInfo(w);return x}};function eve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=v.parseAxisParam(i,o.shape),c=l,u=_.getAxesPermutation(c,a),d=o;u!=null&&(d=Wt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=_.getInnerMostAxes(c.length,o.shape.length)),_.assertAxesAreInnerMostDims("min",c,a);let[p,f]=_.computeOutAndReduceShapes(d.shape,c),m=v.sizeFromShape(f),h=ie({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=Jr(h,h.dtype,"min",e),y;if(s){let x=_.expandShapeToKeepDim(p,l);y=ie({inputs:{x:g},backend:e,attrs:{shape:x}})}else y=ie({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var J5={kernelName:ec,backendName:"webgl",kernelFunc:eve};var tve=DC+`
  return min(a, b);
`,nve=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Uc+`
  return result;
`,rve=yt({opSnippet:tve,packedOpSnippet:nve,cpuKernelImpl:pH}),e8={kernelName:da,backendName:"webgl",kernelFunc:rve};var SI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((u,d)=>u[0]+n[d]+u[1]);let o=n.length,i=je(o),s=e.map(u=>u[0]).join(","),a=e.map((u,d)=>u[0]+n[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var TI=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,h)=>m[0]+n[h]+m[1]);let o=n.length,i=je(o),s=e.map(m=>m[0]).join(","),a=e.map((m,h)=>m[0]+n[h]).join(","),l=ln("rc",o),c=ln("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1,f="";if(o===1){let m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{let m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var ove=({inputs:t,backend:n,attrs:e})=>{let{x:r}=t,{paddings:o,mode:i}=e,s=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new TI(r.shape,o,i):new SI(r.shape,o,i);return n.runWebGLProgram(s,[r],r.dtype)},t8={kernelName:tc,backendName:"webgl",kernelFunc:ove};var ive=`if (b == 0.0) return NAN;
  return mod(a, b);`,sve=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+Uc+`
  return result;
`,ave=yt({opSnippet:ive,packedOpSnippet:sve}),n8={kernelName:pa,backendName:"webgl",kernelFunc:ave};var EI=class{constructor(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.seedLoc==null&&(this.seedLoc=e.getUniformLocation(r,"seed")),e.gl.uniform1f(this.seedLoc,n)}}};var lve=`
if (a == b) {
  return 1.0;
};
return a / b;`,cve=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,qk=yt({opSnippet:lve,packedOpSnippet:cve,checkOutOfBounds:!0}),r8={kernelName:Zs,backendName:"webgl",kernelFunc:qk};var o8="return a - b;",Kk=yt({opSnippet:o8,packedOpSnippet:o8,supportsComplex:!0,cpuKernelImpl:CH}),i8={kernelName:Da,backendName:"webgl",kernelFunc:Kk};function Xk(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=v.parseAxisParam([i],o.shape),a=Hk({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=_.expandShapeToKeepDim(a.shape,s),c=ie({inputs:{x:a},backend:e,attrs:{shape:l}}),u=Kk({inputs:{a:o,b:c},backend:e}),d=Wk({inputs:{x:u},backend:e}),p=Vd({inputs:{x:d},backend:e,attrs:{axis:s,keepDims:!1}}),f=ie({inputs:{x:p},backend:e,attrs:{shape:l}}),m=qk({inputs:{a:d,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}var s8={kernelName:yc,backendName:"webgl",kernelFunc:Xk};function uve(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r,l=a?o:Xk({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new EI(c,u,i),p=d.getCustomSetupFunc(s),f=e.runWebGLProgram(d,[l],"int32",p);return a||e.disposeIntermediateTensorInfo(l),f}var a8={kernelName:ub,backendName:"webgl",kernelFunc:uve};var l8="return -x;";function dve(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=mH(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return G().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Jo(r.shape,l8):o=new wr(r.shape,l8),e.runWebGLProgram(o,[r],r.dtype)}var c8={kernelName:nc,backendName:"webgl",kernelFunc:dve};var pve=Zn.nonMaxSuppressionV3Impl;function fve(t){_.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=pve(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var u8={kernelName:db,backendName:"webgl",kernelFunc:fve};var mve=Zn.nonMaxSuppressionV4Impl;function hve(t){_.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=mve(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var d8={kernelName:pb,backendName:"webgl",kernelFunc:hve};var gve=Zn.nonMaxSuppressionV5Impl;function yve(t){_.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:y}=gve(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var p8={kernelName:fb,backendName:"webgl",kernelFunc:yve};var _I=class{constructor(n,e,r,o){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var xve=t=>{let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r,l=v.sizeFromShape(o.shape),c=new _I(l,i,s,a),u=ie({inputs:{x:o},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[u],o.dtype);e.disposeIntermediateTensorInfo(u);let p=[...o.shape,i],f=ie({inputs:{x:d},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(d),f},f8={kernelName:oc,backendName:"webgl",kernelFunc:xve};function By(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="complex64"){let o=Ja({inputs:{input:r},backend:e}),i=By({inputs:{x:o},backend:e}),s=zd({inputs:{input:r},backend:e}),a=By({inputs:{x:s},backend:e}),l=Mr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Vy({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var m8={kernelName:wc,backendName:"webgl",kernelFunc:By};function h8(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=Ja({inputs:{input:r},backend:e}),i=h8({inputs:{x:o},backend:e}),s=zd({inputs:{input:r},backend:e}),a=By({inputs:{x:s},backend:e}),l=Mr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Vy({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var g8={kernelName:rc,backendName:"webgl",kernelFunc:h8};function vve(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return dI({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{v.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),v.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=dI({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Gk({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var y8={kernelName:ic,backendName:"webgl",kernelFunc:vve};var DI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((c,u)=>c[0]+n[u]+c[1]);let o=n.length,i=je(o),s=e.map(c=>c[0]).join(","),a=e.map((c,u)=>c[0]+n[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};
        uniform float value;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var NI=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,g)=>h[0]+n[g]+h[1]);let o=n.length,i=je(o),s=e.map(h=>h[0]).join(","),a=e.map((h,g)=>h[0]+n[g]).join(","),l=ln("rc",o),c=ln("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,g=o===1?2:4;h<g;h++)m+=`
        ${p[h]}
        if (${f}) {
          result[${h}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${h}] = getChannel(getX(${c.join()}), ${d});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var Yk=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r,a=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new NI(o.shape,i,s):new DI(o.shape,i,s),l=a.getCustomSetupFunc(s);return e.runWebGLProgram(a,[o],o.dtype,l)},x8={kernelName:sc,backendName:"webgl",kernelFunc:Yk};var bve=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,wve=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+Uc+`
  return result;
`,Cve=yt({opSnippet:bve,packedOpSnippet:wve}),v8={kernelName:ma,backendName:"webgl",kernelFunc:Cve};function Ive(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],c=v.parseAxisParam(i,o.shape),u=c,d=_.getAxesPermutation(u,a),p=o;d!=null&&(p=Wt({inputs:{x:o},backend:e,attrs:{perm:d}}),u=_.getInnerMostAxes(u.length,a),l.push(p)),_.assertAxesAreInnerMostDims("prod",u,a);let f;if(e.shouldExecuteOnCPU([p])){let m=e.texData.get(p.dataId).values,{outVals:h,outShape:g,outDtype:y}=hH(p.shape,p.dtype,m,u);f=e.makeTensorInfo(g,y,h)}else{let[m,h]=_.computeOutAndReduceShapes(p.shape,u),g=v.sizeFromShape(h),y=ie({inputs:{x:p},backend:e,attrs:{shape:[-1,g]}}),x=Qu(o.dtype),w=Jr(y,x,"prod",e);f=ie({inputs:{x:w},backend:e,attrs:{shape:m}}),l.push(y),l.push(w)}if(s){l.push(f);let m=_.expandShapeToKeepDim(f.shape,c);f=ie({inputs:{x:f},backend:e,attrs:{shape:m}})}return l.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var b8={kernelName:Of,backendName:"webgl",kernelFunc:Ive};var Zk=t=>{let{backend:n,attrs:e}=t,{start:r,stop:o,step:i,dtype:s}=e,a=gH(r,o,i,s);return n.makeTensorInfo([a.length],s,a)},w8={kernelName:Mf,backendName:"webgl",kernelFunc:Zk};var Sve="return 1.0 / x;",Tve=be({opSnippet:Sve}),C8={kernelName:ha,backendName:"webgl",kernelFunc:Tve};var Eve=Mn+`
  return (x < 0.0) ? 0.0 : x;
`,_ve=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Dve=be({opSnippet:Eve,packedOpSnippet:_ve}),I8={kernelName:ga,backendName:"webgl",kernelFunc:Dve};var Nve=Mn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,kve=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ave=be({opSnippet:Nve,packedOpSnippet:kve}),S8={kernelName:ya,backendName:"webgl",kernelFunc:Ave};var kI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var AI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function Rve(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=G().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new AI(o.shape,l,c,i,s):new kI(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],"float32")}var T8={kernelName:uc,backendName:"webgl",kernelFunc:Rve};var RI=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Ove(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new RI(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var E8={kernelName:$f,backendName:"webgl",kernelFunc:Ove};var OI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var MI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function Mve(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=G().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new MI(o.shape,l,c,i,s):new OI(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],o.dtype)}var _8={kernelName:cc,backendName:"webgl",kernelFunc:Mve};var FI=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Fve(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new FI(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var D8={kernelName:Pf,backendName:"webgl",kernelFunc:Fve};var PI=class{constructor(n,e){this.variableNames=["x"];let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=n,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${n[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&n[a]!==1?`${n[a]} - coords[${a}] - 1`:`coords[${a}]`,i=n.map((a,l)=>o(l)).join(","),s=je(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var $I=class{constructor(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=n;let o=ln("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=je(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${n[0]} - rc - 1),
            ${n[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${n[0]} - (rc  + 1) - 1),
                ${n[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${c(o.slice())};
          }
          if(${s}) {
            result.b = ${u(o.slice())};
            if(${i}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return p(m)}function c(m){return m[r-1]="("+m[r-1]+" + 1)",p(m)}function u(m){return m[r-2]="("+m[r-2]+" + 1)",p(m)}function d(m){return m[r-1]="("+m[r-1]+" + 1)",m[r-2]="("+m[r-2]+" + 1)",p(m)}function p(m){let h=n.map((x,w)=>f(w,m)),g=h.join(","),y=h.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function f(m,h){return e.indexOf(m)!==-1&&n[m]!==1?`${n[m]} - ${h[m]} - 1`:`${h[m]}`}}};function Pve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r,s=o.shape.length,a=v.parseAxisParam(i,o.shape);if(s===0)return cn({inputs:{x:o},backend:e});let l=G().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $I(o.shape,a):new PI(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var N8={kernelName:dc,backendName:"webgl",kernelFunc:Pve};var LI=class{constructor(n,e){this.variableNames=["Image"],this.outputShape=[];let r=n[1],o=n[2];this.outputShape=n;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        uniform vec4 params;
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}getCustomSetupFunc(n,e,r,o){return(i,s)=>{this.paramsLoc==null&&(this.paramsLoc=i.getUniformLocationNoThrow(s,"params")),i.gl.uniform4f(this.paramsLoc,n,e,r,o)}}};var k8={kernelName:vb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=new LI(r.shape,i),[c,u]=_.getImageCenter(s,r.shape[1],r.shape[2]),d=l.getCustomSetupFunc(c,u,Math.sin(o),Math.cos(o));return a.runWebGLProgram(l,[r],r.dtype,d)}};var $ve=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Lve=be({opSnippet:$ve}),A8={kernelName:xa,backendName:"webgl",kernelFunc:Lve};var Vve="return inversesqrt(x);",Bve=be({opSnippet:Vve,cpuKernelImpl:yH}),R8={kernelName:va,backendName:"webgl",kernelFunc:Bve};var Wm=class{constructor(n,e,r,o,i,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=je(i.length),c=je(s.length),u="";r===1?u="i":r===2&&(u="i, j");let d=`getIndices(${u})`,p="";o===1?p="i":o===2&&(p="i, coords[1]");let f=`getUpdates(${p})`,m=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${n}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function zve(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=_.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=ie({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),m=ie({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),h=e.makeTensorInfo([],"float32",new Float32Array([0])),g=new Wm(l,a,f.shape.length,m.shape.length,u,p),y=e.runWebGLProgram(g,[m,f,h],m.dtype),x=ie({inputs:{x:y},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(h),x}var O8={kernelName:mb,backendName:"webgl",kernelFunc:zve};var VI=class{constructor(n,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<e.length;u++)c.push(`${a[u]}`),u<n&&l.push(`${a[u]}`);o=l.join(),i=c.join()}let s=je(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function Uve(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n,s=new VI(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],Cn(o.dtype,i.dtype))}var M8={kernelName:pc,backendName:"webgl",kernelFunc:Uve};var jve=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${_.SELU_SCALEALPHA};
  float scale = ${_.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Gve=be({opSnippet:jve}),F8={kernelName:ba,backendName:"webgl",kernelFunc:Gve};var Wve="return 1.0 / (1.0 + exp(-1.0 * x));",Hve=be({opSnippet:Wve}),P8={kernelName:Sa,backendName:"webgl",kernelFunc:Hve};var qve=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Kve=be({opSnippet:qve}),$8={kernelName:Ia,backendName:"webgl",kernelFunc:Kve};var Xve=NC+`
  return sin(x);
`,Yve=be({opSnippet:Xve}),L8={kernelName:wa,backendName:"webgl",kernelFunc:Yve};var Zve=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Qve=be({opSnippet:Zve}),V8={kernelName:Ca,backendName:"webgl",kernelFunc:Qve};var Jve=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,e0e=be({opSnippet:Jve}),B8={kernelName:Ta,backendName:"webgl",kernelFunc:e0e};var t0e=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;v.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((y,x)=>y*x),l=[[0,0]];l.push(...s);for(let y=1+i.length;y<o.shape.length;++y)l.push([0,0]);let c=[],u=Yk({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),d=_.getReshaped(u.shape,i,a,!1),p=_.getPermuted(d.length,i.length,!1),f=_.getReshapedPermuted(u.shape,i,a,!1),m=ie({inputs:{x:u},backend:e,attrs:{shape:d}}),h=Wt({inputs:{x:m},backend:e,attrs:{perm:p}}),g=ie({inputs:{x:h},backend:e,attrs:{shape:f}});return c.push(u),c.push(m),c.push(h),c.forEach(y=>e.disposeIntermediateTensorInfo(y)),g},z8={kernelName:hc,backendName:"webgl",kernelFunc:t0e};function n0e(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=e.readSync(s.dataId)[0],[d,p,f,m,h]=vH(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var U8={kernelName:hb,backendName:"webgl",kernelFunc:n0e};function r0e(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[c,u,d]=bH(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var j8={kernelName:gb,backendName:"webgl",kernelFunc:r0e};function o0e(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,strides:u,outputSize:d}=_.calculateShapes(i,o,a),p=!1,f=new Wm(c,l,o.shape.length,i.shape.length,u,[d,1],p),m=e.runWebGLProgram(f,[i,o,s],i.dtype),h=ie({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),h}var G8={kernelName:yb,backendName:"webgl",kernelFunc:o0e};function i0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=v.parseAxisParam(s,o.shape)[0],l=_.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let m=Qa({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,m})}var W8={kernelName:gc,backendName:"webgl",kernelFunc:i0e};var s0e="return sqrt(x);",a0e=be({opSnippet:s0e}),H8={kernelName:Ea,backendName:"webgl",kernelFunc:a0e};var l0e="return x * x;",c0e=be({opSnippet:l0e}),q8={kernelName:Lf,backendName:"webgl",kernelFunc:c0e};var K8="return (a - b) * (a - b);",u0e=yt({opSnippet:K8,packedOpSnippet:K8}),X8={kernelName:_a,backendName:"webgl",kernelFunc:u0e};function d0e({inputs:t,attrs:n,backend:e}){let{x:r}=t,o=Mn+`
    return x > 0.0 ? 1.0 : float(${n.alpha});
  `,i=new wr(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var Y8={kernelName:Aa,backendName:"webgl",kernelFunc:d0e};var BI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=je(r.length),s=je(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${n});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function p0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{nonStrided:f,$begin:m,$strides:h,size:g,newShape:y,outShape:x}=qn.sliceInfo(o.shape,i,s,a,l,c,u,d,p),w=ie({inputs:{x:o},backend:e,attrs:{shape:y}}),b;if(f){let E=Qa({inputs:{x:w},backend:e,attrs:{begin:m,size:g}});b=ie({inputs:{x:E},backend:e,attrs:{shape:x}}),e.disposeIntermediateTensorInfo(E)}else if(x.some(E=>E===0))b=e.makeTensorInfo(x,o.dtype,[]);else if(e.shouldExecuteOnCPU([w])){let O=e.texData.get(w.dataId).values,R=Ie(w.shape,w.dtype,O),P=wH(x,R,h,m);b=e.makeTensorInfo(x,w.dtype,P.values)}else{let D=new BI(m,h,x);b=e.runWebGLProgram(D,[w],w.dtype)}let S=ie({inputs:{x:b},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(w),e.disposeIntermediateTensorInfo(b),S}var Z8={kernelName:Vf,backendName:"webgl",kernelFunc:p0e};var f0e="return tan(x);",m0e=be({opSnippet:f0e}),Q8={kernelName:Na,backendName:"webgl",kernelFunc:m0e};var h0e=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,g0e=be({opSnippet:h0e}),J8={kernelName:ka,backendName:"webgl",kernelFunc:g0e};var zI=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[s]*e[s];this.outputShape=r,this.rank=r.length;let o=je(this.rank),i=y0e(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function y0e(t){let n=t.length;if(n>5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`imod(resRC, ${t[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<t.length;o++)r.push(`imod(${e[o]}, ${t[o]})`);return r.join()}function Qk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>v.decodeString(p)):l,u=Ie(o.shape,o.dtype,c),d=IH(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new zI(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var e6={kernelName:Zi,backendName:"webgl",kernelFunc:Qk};function x0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r,a=e.readSync(o.dataId),[l,c]=SH(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var t6={kernelName:Bf,backendName:"webgl",kernelFunc:x0e};var UI=class{constructor(n,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${n} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${n}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function v0e(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],y=new UI(d,p,s,a,l,g);return e.runWebGLProgram(y,[o,i],"float32")}var n6={kernelName:xb,backendName:"webgl",kernelFunc:v0e};function b0e(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;cs(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=TH(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var r6={kernelName:zf,backendName:"webgl",kernelFunc:b0e};function w0e(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let h=0;h<a;h++)h!==i&&(c[u++]=s.shape[h]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let m=new Array(l);for(let h=0;h<m.length;h++){p[i]=h;let g=Qa({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),y=ie({inputs:{x:g},backend:e,attrs:{shape:c}});m[h]=y,d.push(g)}return d.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var o6={kernelName:vc,backendName:"webgl",kernelFunc:w0e};var jI=class{constructor(n,e){this.variableNames=["x","segmentIds"];let r=n.windowSize,o=n.batchSize,i=n.inSize,s=n.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `,f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function C0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=_.getAxesPermutation([c],a),d=o;u!=null&&(d=Wt({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=_.getInnerMostAxes(1,a)[0]);let p=_.segment_util.computeOutShape(d.shape,c,s),f=v.sizeFromShape([d.shape[c]]),m=ie({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(m);let h=Qu(o.dtype),g=(b,S,E,D,O)=>{let R=b.shape[0],P=b.shape[1],U=_.segment_util.segOpComputeOptimalWindowSize(P,O),j={windowSize:U,inSize:P,batchSize:R,numSegments:O},W=new jI(j,S),K=e.compileAndRun(W,[b,E],D);if(l.push(K),K.shape[1]===O)return K;let H=Zk({backend:e,attrs:{start:0,stop:O,step:1,dtype:"float32"}}),Y=Qk({inputs:{x:H},backend:e,attrs:{reps:[P/U]}});return l.push(H),l.push(Y),g(K,S,Y,D,O)},y=g(m,"unsortedSegmentSum",i,h,s),x=ie({inputs:{x:y},backend:e,attrs:{shape:p}}),w=x;if(u!=null){l.push(x);let b=_.getUndoAxesPermutation(u);w=Wt({inputs:{x:w},backend:e,attrs:{perm:b}})}return l.forEach(b=>e.disposeIntermediateTensorInfo(b)),w}var i6={kernelName:bc,backendName:"webgl",kernelFunc:C0e};var I0e=[B5,z5,tq,rq,oq,iq,aq,lq,cq,uq,fq,mq,hq,gq,xq,yq,vq,wq,bq,Cq,Iq,Sq,Tq,_q,Dq,Rq,Mq,Fq,$q,jH,Vq,zq,Uq,Bq,Gq,Wq,jq,Hq,qq,Kq,Zq,Qq,Jq,t5,n5,e5,r5,o5,i5,s5,a5,l5,c5,d5,p5,m5,h5,g5,y5,v5,b5,w5,C5,I5,S5,T5,E5,_5,UH,D5,Lq,N5,k5,A5,GH,R5,O5,M5,P5,F5,$5,L5,V5,j5,H5,W5,q5,K5,Y5,G5,Q5,J5,e8,t8,n8,a8,XH,c8,u8,d8,p8,Nq,f8,g8,y8,x8,v8,WH,b8,w8,kq,r8,C8,S8,I8,ZH,T8,E8,_8,D8,N8,k8,A8,R8,O8,M8,F8,P8,$8,L8,V8,Eq,s8,B8,z8,U8,j8,G8,W8,H8,q8,X8,Y8,Z8,i8,JH,Q8,J8,e6,t6,n6,eq,r6,o6,i6,m8];for(let t of I0e)wb(t);function T0e(t,n){if(t&1&&(I(0,"p",7),T(1," Predicted Emotion: "),I(2,"strong"),T(3),C()()),t&2){let e=fe();B(3),dn(e.predictedEmotion)}}var GI=class t{constructor(n){this.cdr=n;this.loadModel()}inputText="";predictedEmotion=null;model;tokenizer={};emotions=["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","optimism","pride","realization","relief","remorse","sadness","surprise","neutral"];VOCAB_SIZE=1e3;MAX_LENGTH=50;OOV_INDEX=1;async loadModel(){this.model=await fN("/assets/models/model.json"),console.log("Model loaded successfully:"),this.model.summary();let n=await fetch("/assets/models/tokenizer.json");this.tokenizer=await n.json(),console.log("Tokenizer mapping loaded:",this.tokenizer)}textToSequence(n){let e=n.trim().toLowerCase().split(/\s+/),r=[];for(let o of e){let i=this.tokenizer[o];(!i||i>=this.VOCAB_SIZE)&&(i=this.OOV_INDEX),r.push(i)}return r}padSequence(n){if(n.length>this.MAX_LENGTH)return n.slice(0,this.MAX_LENGTH);for(;n.length<this.MAX_LENGTH;)n.push(0);return n}async predictEmotion(){if(console.log("button clicked"),!this.model){console.error("Model not loaded yet.");return}let n=this.textToSequence(this.inputText);n=this.padSequence(n);let e=kc([n],[1,this.MAX_LENGTH],"int32"),o=await this.model.predict(e).data(),i=o.indexOf(Math.max(...o));this.predictedEmotion=this.emotions[i],this.cdr.markForCheck(),console.log("Predicted Emotion:",this.predictedEmotion)}static \u0275fac=function(e){return new(e||t)(re(zt))};static \u0275cmp=Mt({type:t,selectors:[["app-emotion-analyze-prototype"]],decls:10,vars:2,consts:[[1,"container","mt-5"],[1,"card","shadow-lg","p-4"],[1,"text-center","text-primary","mb-4"],[1,"form-group"],["rows","3","placeholder","Enter your text here...",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-block",3,"click"],["class","mt-3 alert alert-info text-center",4,"ngIf"],[1,"mt-3","alert","alert-info","text-center"]],template:function(e,r){e&1&&(I(0,"div",0)(1,"div",1)(2,"h2",2),T(3,"Emotion Classifier"),C(),I(4,"div",3)(5,"textarea",4),Ns("ngModelChange",function(i){return fl(r.inputText,i)||(r.inputText=i),i}),T(6,"            "),C()(),I(7,"button",5),ye("click",function(){return r.predictEmotion()}),T(8," Predict Emotion "),C(),ce(9,T0e,4,1,"p",6),C()()),e&2&&(B(5),Ds("ngModel",r.inputText),B(4),X("ngIf",r.predictedEmotion))},dependencies:[rn,xn,nf,pr,qr,Ou],encapsulation:2})};var s6=[{path:"",component:X0,canActivate:[A0]},{path:"home",component:k0,canActivate:[Dr]},{path:"pretrades",component:W0,canActivate:[Dr]},{path:"pretradelog",component:rf,canActivate:[Dr]},{path:"posttrades",component:H0,canActivate:[Dr]},{path:"posttradelog",component:of,canActivate:[Dr]},{path:"emotions",component:K0,canActivate:[Dr]},{path:"tradejournal",component:Y0,canActivate:[Dr]},{path:"individualTrade",component:sf,canActivate:[Dr]},{path:"meditationhub",component:Z0,canActivate:[Dr]},{path:"analytics",component:Q0,canActivate:[Dr]},{path:"admin/emotionquestion",component:q0,canActivate:[Dr]},{path:"mlemotion",component:GI,canActivate:[Dr]},{path:"**",redirectTo:""}];var a6={providers:[ZM(),SF(s6),k2(A2())]};function E0e(t,n){t&1&&(Iv(0),I(1,"div",1),q(2,"router-outlet"),C(),Sv())}function _0e(t,n){if(t&1){let e=Ft();I(0,"div",19)(1,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/home"))}),q(2,"i",21),T(3,"Dashboard"),C(),I(4,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/emotions"))}),q(5,"i",22),T(6,"Morning Check-In"),C(),I(7,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/tradejournal"))}),q(8,"i",23),T(9,"Trade Journal"),C(),I(10,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/meditationhub"))}),q(11,"i",24),T(12,"Meditation Hub"),C(),I(13,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/analytics"))}),q(14,"i",25),T(15,"Analytics"),C(),I(16,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/pretrades"))}),q(17,"i",26),T(18,"PreTrades"),C(),I(19,"a",20),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/posttrades"))}),q(20,"i",27),T(21,"PostTrades"),C()()}}function D0e(t,n){if(t&1){let e=Ft();I(0,"div",28)(1,"div",29)(2,"button",30),q(3,"i",31),C(),T(4,"\xA0\xA0 "),I(5,"p",32),T(6),C()(),I(7,"button",33),ye("click",function(){Me(e);let o=fe(2);return Fe(o.logOut())}),T(8,"Logout\xA0\xA0\xA0"),q(9,"i",34),C()()}if(t&2){let e=fe(2);B(2),X("disabled",!0),B(4),Ke("Welcome, ",e.supabaseService.currentUsername(),"!")}}function N0e(t,n){if(t&1){let e=Ft();I(0,"button",35),ye("click",function(){Me(e);let o=fe(2);return Fe(o.navigateToUrl("/home"))}),q(1,"img",36),C()}}function k0e(t,n){if(t&1){let e=Ft();Iv(0),I(1,"div",2)(2,"nav",3)(3,"div",4)(4,"div",5)(5,"button",6),ye("click",function(){Me(e);let o=fe();return Fe(o.navigateToUrl("/home"))}),I(6,"img",7),ye("click",function(){Me(e);let o=fe();return Fe(o.navigateToUrl("/home"))}),C()(),I(7,"button",8),ye("click",function(){Me(e);let o=fe();return Fe(o.closeSidebar())}),C()(),ce(8,_0e,22,0,"div",9),C(),ce(9,D0e,10,2,"div",10),C(),I(10,"div",11)(11,"nav",12)(12,"div",13)(13,"div",14)(14,"button",15),ye("click",function(){Me(e);let o=fe();return Fe(o.toggleSidebar())}),q(15,"span",16),C(),ce(16,N0e,2,0,"button",17),C()()(),I(17,"div",18),q(18,"router-outlet"),C()()(),Sv()}if(t&2){let e=fe();B(2),Pi("collapsed",e.sidebarCollapsed()),B(6),X("ngIf",e.loginStatus()),B(),X("ngIf",e.loginStatus()),B(),Pi("expanded",e.sidebarCollapsed()),B(6),X("ngIf",e.sidebarCollapsed())}}var WI=class t{constructor(n,e,r,o,i){this.cdr=n;this.supabaseService=e;this.router=r;this.route=o;this.platformId=i;this.loginStatus=ml(()=>e.loginStatus())}title="TR-prototype";loginStatus;sidebarCollapsed=io(!1);isMobile=io(!1);resizeObserver;ngOnInit(){this.checkScreenSize(),Gr(this.platformId)&&(this.sidebarCollapsed.set(this.isMobile()),this.resizeObserver=new ResizeObserver(()=>{this.checkScreenSize(),this.cdr.detectChanges()}),this.resizeObserver.observe(document.body),console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngAfterViewInit(){Gr(this.platformId)&&(console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngOnDestroy(){Gr(this.platformId)&&this.resizeObserver&&this.resizeObserver.disconnect()}async logOut(){await this.supabaseService.signOut(),this.router.navigateByUrl("/")}toggleSidebar(){this.sidebarCollapsed.update(n=>!n),this.cdr.detectChanges()}navigateToUrl(n){this.router.navigateByUrl(n)}closeSidebar(){this.sidebarCollapsed.set(!0),this.cdr.detectChanges()}checkScreenSize(){Gr(this.platformId)&&this.isMobile.set(window.innerWidth<768)}static \u0275fac=function(e){return new(e||t)(re(zt),re(Ut),re(co),re(pi),re(No))};static \u0275cmp=Mt({type:t,selectors:[["app-root"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"container-fluid","p-0"],[1,"sidebar-container"],["id","sidebar",1,"d-flex","flex-column","h-100"],[1,"p-3","flex-grow-1"],[1,"mb-3","d-flex","align-items-center","justify-content-between"],[1,"text-decoration-none","me-auto","btn","btn-link","p-0","me-3",3,"click"],["src","/trading_rehab_main_logo.png",1,"img-fluid",2,"height","40px",3,"click"],["type","button",1,"btn-close","d-md-none",3,"click"],["class","nav flex-column",4,"ngIf"],["class","p-3 border-top mt-auto",4,"ngIf"],[1,"content"],[1,"navbar","navbar-expand-lg"],[1,"container-fluid"],[1,"d-flex","align-items-center"],[1,"btn","me-2",3,"click"],[1,"navbar-toggler-icon"],["class","btn navbar-branding text-decoration-none me-auto",3,"click",4,"ngIf"],[1,"container-fluid","p-4"],[1,"nav","flex-column"],[1,"nav-link",3,"click"],[1,"bi","bi-columns-gap","me-3"],[1,"bi","bi-brightness-high","me-3"],[1,"bi","bi-bookmark-check","me-3"],[1,"bi","bi-person-arms-up","me-3"],[1,"bi","bi-clipboard-data","me-3"],[1,"bi","bi-ui-checks-grid","me-3"],[1,"bi","bi-ui-checks","me-3"],[1,"p-3","border-top","mt-auto"],[1,"d-flex","align-items-center","mb-2"],["title","Profile",1,"btn","btn-link","p-0","me-2",3,"disabled"],[1,"bi","bi-person-circle","text-black",2,"font-size","30px"],[1,"text-black","mb-0"],[1,"btn","btn-outline-secondary","btn-tr","w-100",3,"click"],[1,"bi","bi-box-arrow-right"],[1,"btn","navbar-branding","text-decoration-none","me-auto",3,"click"],["src","/trading-rehab-logo.png","width","50px",1,"img-fluid"]],template:function(e,r){e&1&&ce(0,E0e,3,0,"ng-container",0)(1,k0e,19,7,"ng-container",0),e&2&&(X("ngIf",!r.supabaseService.loginStatus()),B(),X("ngIf",r.supabaseService.loginStatus()))},dependencies:[rn,xn,s_],styles:[".sidebar-container[_ngcontent-%COMP%]{display:flex;width:100%;position:relative}#sidebar[_ngcontent-%COMP%]{width:250px;position:fixed;top:0;left:0;height:100vh;z-index:999;background:#634aff0d;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);transition:all .3s;box-shadow:0 0 10px #0000001a}#sidebar.collapsed[_ngcontent-%COMP%]{margin-left:-250px}.content[_ngcontent-%COMP%]{width:calc(100% - 250px);margin-left:250px;transition:all .3s;min-height:100vh}.content.expanded[_ngcontent-%COMP%]{width:100%;margin-left:0}@media (max-width: 768px){#sidebar[_ngcontent-%COMP%]{margin-left:-250px}#sidebar[_ngcontent-%COMP%]:not(.collapsed){margin-left:0}.content[_ngcontent-%COMP%]{width:100%;margin-left:0}}.nav-link[_ngcontent-%COMP%]{padding:15px 20px;color:#333;border-bottom:1px solid #ddd}.nav-link[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.navbar[_ngcontent-%COMP%]{padding:15px 10px}"]})};z2(WI,a6).catch(t=>console.error(t));
