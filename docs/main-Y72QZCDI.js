import{b as _R,c as IR,f as T9,g as ER}from"./chunk-65CJINC2.js";import{a as me,b as Ue,c as g0,e as bt,f as rs,g as vh,h as S9}from"./chunk-VOSPIT4N.js";var ST=bt(ET=>{"use strict";Object.defineProperty(ET,"__esModule",{value:!0});var IT=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}};ET.default=IT});var DT=bt(Sg=>{"use strict";var bL=Sg&&Sg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Sg,"__esModule",{value:!0});var sre=bL((ER(),S9(T9))),are=bL(ST()),TT=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=sre.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=Object.assign({},this.headers),this.headers[n]=e,this}then(n,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var s,a,l;let c=null,u=null,d=null,p=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){let x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=x:u=JSON.parse(x))}let h=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),g=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");h&&g&&g.length>1&&(d=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,p=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let h=await i.text();try{c=JSON.parse(h),Array.isArray(c)&&i.status===404&&(u=[],c=null,p=200,f="OK")}catch{i.status===404&&h===""?(p=204,f="No Content"):c={message:h}}if(c&&this.isMaybeSingle&&(!((l=c?.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,p=200,f="OK"),c&&this.shouldThrowOnError)throw new are.default(c)}return{error:c,data:u,count:d,status:p,statusText:f}});return this.shouldThrowOnError||(o=o.catch(i=>{var s,a,l;return{error:{message:`${(s=i?.name)!==null&&s!==void 0?s:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),o.then(n,e)}};Sg.default=TT});var kT=bt(Tg=>{"use strict";var lre=Tg&&Tg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Tg,"__esModule",{value:!0});var cre=lre(DT()),NT=class extends cre.default{select(n){let e=!1,r=(n??"*").split("").map(o=>/\s/.test(o)&&!e?"":(o==='"'&&(e=!e),o)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:e=!0,nullsFirst:r,foreignTable:o,referencedTable:i=o}={}){let s=i?`${i}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:r=e}={}){let o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,e,{foreignTable:r,referencedTable:o=r}={}){let i=typeof o>"u"?"offset":`${o}.offset`,s=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(s,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:e=!1,settings:r=!1,buffers:o=!1,wal:i=!1,format:s="text"}={}){var a;let l=[n?"analyze":null,e?"verbose":null,r?"settings":null,o?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`,s==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Tg.default=NT});var Gx=bt(Dg=>{"use strict";var ure=Dg&&Dg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Dg,"__esModule",{value:!0});var dre=ure(kT()),AT=class extends dre.default{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}in(n,e){let r=Array.from(new Set(e)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${r})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:r,type:o}={}){let i="";o==="plain"?i="pl":o==="phrase"?i="ph":o==="websearch"&&(i="w");let s=r===void 0?"":`(${r})`;return this.url.searchParams.append(n,`${i}fts${s}.${e}`),this}match(n){return Object.entries(n).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(n,e,r){return this.url.searchParams.append(n,`not.${e}.${r}`),this}or(n,{foreignTable:e,referencedTable:r=e}={}){let o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,e,r){return this.url.searchParams.append(n,`${e}.${r}`),this}};Dg.default=AT});var MT=bt(kg=>{"use strict";var pre=kg&&kg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(kg,"__esModule",{value:!0});var Ng=pre(Gx()),RT=class{constructor(n,{headers:e={},schema:r,fetch:o}){this.url=n,this.headers=e,this.schema=r,this.fetch=o}select(n,{head:e=!1,count:r}={}){let o=e?"HEAD":"GET",i=!1,s=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),new Ng.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:e,defaultToNull:r=!0}={}){let o="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(n)){let s=n.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(s.length>0){let a=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ng.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:e,ignoreDuplicates:r=!1,count:o,defaultToNull:i=!0}={}){let s="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),o&&a.push(`count=${o}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(n)){let l=n.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){let c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Ng.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:e}={}){let r="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),e&&o.push(`count=${e}`),this.headers.Prefer=o.join(","),new Ng.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){let e="DELETE",r=[];return n&&r.push(`count=${n}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ng.default({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};kg.default=RT});var wL=bt(Wx=>{"use strict";Object.defineProperty(Wx,"__esModule",{value:!0});Wx.version=void 0;Wx.version="0.0.0-automated"});var CL=bt(Hx=>{"use strict";Object.defineProperty(Hx,"__esModule",{value:!0});Hx.DEFAULT_HEADERS=void 0;var fre=wL();Hx.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${fre.version}`}});var IL=bt(Ag=>{"use strict";var _L=Ag&&Ag.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Ag,"__esModule",{value:!0});var mre=_L(MT()),hre=_L(Gx()),gre=CL(),FT=class t{constructor(n,{headers:e={},schema:r,fetch:o}={}){this.url=n,this.headers=Object.assign(Object.assign({},gre.DEFAULT_HEADERS),e),this.schemaName=r,this.fetch=o}from(n){let e=new URL(`${this.url}/${n}`);return new mre.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new t(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,e={},{head:r=!1,get:o=!1,count:i}={}){let s,a=new URL(`${this.url}/rpc/${n}`),l;r||o?(s=r?"HEAD":"GET",Object.entries(e).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{a.searchParams.append(u,d)})):(s="POST",l=e);let c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new hre.default({method:s,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Ag.default=FT});var AL=bt(br=>{"use strict";var df=br&&br.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(br,"__esModule",{value:!0});br.PostgrestError=br.PostgrestBuilder=br.PostgrestTransformBuilder=br.PostgrestFilterBuilder=br.PostgrestQueryBuilder=br.PostgrestClient=void 0;var EL=df(IL());br.PostgrestClient=EL.default;var SL=df(MT());br.PostgrestQueryBuilder=SL.default;var TL=df(Gx());br.PostgrestFilterBuilder=TL.default;var DL=df(kT());br.PostgrestTransformBuilder=DL.default;var NL=df(DT());br.PostgrestBuilder=NL.default;var kL=df(ST());br.PostgrestError=kL.default;br.default={PostgrestClient:EL.default,PostgrestQueryBuilder:SL.default,PostgrestFilterBuilder:TL.default,PostgrestTransformBuilder:DL.default,PostgrestBuilder:NL.default,PostgrestError:kL.default}});var g3=bt((bm,h3)=>{"use strict";var Ele=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Od=Ele();h3.exports=bm=Od.fetch;Od.fetch&&(bm.default=Od.fetch.bind(Od));bm.Headers=Od.Headers;bm.Request=Od.Request;bm.Response=Od.Response});var y3=bt(()=>{"use strict"});var rB=bt((nB,FN)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(nB,typeof FN=="object"&&FN,typeof define=="function"&&define)});var iB=bt((oB,ON)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(oB,typeof ON=="object"&&ON,typeof define=="function"&&define)});var aB=bt((sB,PN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(sB,typeof PN=="object"&&PN,typeof define=="function"&&define)});var cB=bt((lB,LN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(lB,typeof LN=="object"&&LN,typeof define=="function"&&define)});var dB=bt((uB,$N)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(uB,typeof $N=="object"&&$N,typeof define=="function"&&define)});var fB=bt((pB,VN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(pB,typeof VN=="object"&&VN,typeof define=="function"&&define)});var Nw=bt(()=>{"use strict"});var mB=bt((M5e,kw)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(I,_,E){var S=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[I,b(t)]:I??x(),3),S),M=new f(S),R=function(){for(var L=M.g(o),G=a,W=0;L<l;)L=(L+W)*r,G*=r,W=M.g(1);for(;L>=c;)L/=2,G/=2,W>>>=1;return(L+W)/G};return R.int32=function(){return M.g(4)|0},R.quick=function(){return M.g(4)/4294967296},R.double=R,g(b(M.S),t),(_.pass||E||function(L,G,W,q){return q&&(q.S&&m(q,M),L.state=function(){return m(M,{})}),W?(n[s]=L,G):L})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(I){var _,E=I.length,S=this,D=0,M=S.i=S.j=0,R=S.S=[];for(E||(I=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[M=u&M+I[D%E]+(_=R[D])],R[M]=_;(S.g=function(L){for(var G,W=0,q=S.i,X=S.j,K=S.S;L--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return S.i=q,S.j=X,W})(r)}function m(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function h(I,_){var E=[],S=typeof I,D;if(_&&S=="object")for(D in I)try{E.push(h(I[D],_-1))}catch{}return E.length?E:S=="string"?I:I+"\0"}function g(I,_){for(var E=I+"",S,D=0;D<E.length;)_[u&D]=u&(S^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(I){return String.fromCharCode.apply(0,I)}if(g(n.random(),t),typeof kw=="object"&&kw.exports){kw.exports=p;try{d=Nw()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var gB=bt((F5e,hB)=>{"use strict";var nde=rB(),rde=iB(),ode=aB(),ide=cB(),sde=dB(),ade=fB(),Hd=mB();Hd.alea=nde;Hd.xor128=rde;Hd.xorwow=ode;Hd.xorshift7=ide;Hd.xor4096=sde;Hd.tychei=ade;hB.exports=Hd});var Wj=bt((Gj,Yk)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(Gj,typeof Yk=="object"&&Yk,typeof define=="function"&&define)});var qj=bt((Hj,Zk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(Hj,typeof Zk=="object"&&Zk,typeof define=="function"&&define)});var Xj=bt((Kj,Qk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(Kj,typeof Qk=="object"&&Qk,typeof define=="function"&&define)});var Zj=bt((Yj,Jk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(Yj,typeof Jk=="object"&&Jk,typeof define=="function"&&define)});var Jj=bt((Qj,eA)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(Qj,typeof eA=="object"&&eA,typeof define=="function"&&define)});var tG=bt((eG,tA)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(eG,typeof tA=="object"&&tA,typeof define=="function"&&define)});var nG=bt((kSt,NC)=>{"use strict";(function(t,n){var e=(0,eval)("this"),r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(I,_,E){var S=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[I,b(t)]:I??x(),3),S),M=new f(S),R=function(){for(var L=M.g(o),G=a,W=0;L<l;)L=(L+W)*r,G*=r,W=M.g(1);for(;L>=c;)L/=2,G/=2,W>>>=1;return(L+W)/G};return R.int32=function(){return M.g(4)|0},R.quick=function(){return M.g(4)/4294967296},R.double=R,g(b(M.S),t),(_.pass||E||function(L,G,W,q){return q&&(q.S&&m(q,M),L.state=function(){return m(M,{})}),W?(n[s]=L,G):L})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(I){var _,E=I.length,S=this,D=0,M=S.i=S.j=0,R=S.S=[];for(E||(I=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[M=u&M+I[D%E]+(_=R[D])],R[M]=_;(S.g=function(L){for(var G,W=0,q=S.i,X=S.j,K=S.S;L--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return S.i=q,S.j=X,W})(r)}function m(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function h(I,_){var E=[],S=typeof I,D;if(_&&S=="object")for(D in I)try{E.push(h(I[D],_-1))}catch{}return E.length?E:S=="string"?I:I+"\0"}function g(I,_){for(var E=I+"",S,D=0;D<E.length;)_[u&D]=u&(S^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(I){return String.fromCharCode.apply(0,I)}if(g(n.random(),t),typeof NC=="object"&&NC.exports){NC.exports=p;try{d=Nw()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var nA=bt((ASt,rG)=>{"use strict";var Ihe=Wj(),Ehe=qj(),She=Xj(),The=Zj(),Dhe=Jj(),Nhe=tG(),lp=nG();lp.alea=Ihe;lp.xor128=Ehe;lp.xorwow=She;lp.xorshift7=The;lp.xor4096=Dhe;lp.tychei=Nhe;rG.exports=lp});var fH=bt((pH,PA)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(pH,typeof PA=="object"&&PA,typeof define=="function"&&define)});var hH=bt((mH,LA)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(mH,typeof LA=="object"&&LA,typeof define=="function"&&define)});var yH=bt((gH,$A)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(gH,typeof $A=="object"&&$A,typeof define=="function"&&define)});var xH=bt((vH,VA)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(vH,typeof VA=="object"&&VA,typeof define=="function"&&define)});var wH=bt((bH,BA)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(bH,typeof BA=="object"&&BA,typeof define=="function"&&define)});var _H=bt((CH,zA)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(CH,typeof zA=="object"&&zA,typeof define=="function"&&define)});var IH=bt((qOt,WC)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(I,_,E){var S=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[I,b(t)]:I??x(),3),S),M=new f(S),R=function(){for(var L=M.g(o),G=a,W=0;L<l;)L=(L+W)*r,G*=r,W=M.g(1);for(;L>=c;)L/=2,G/=2,W>>>=1;return(L+W)/G};return R.int32=function(){return M.g(4)|0},R.quick=function(){return M.g(4)/4294967296},R.double=R,g(b(M.S),t),(_.pass||E||function(L,G,W,q){return q&&(q.S&&m(q,M),L.state=function(){return m(M,{})}),W?(n[s]=L,G):L})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(I){var _,E=I.length,S=this,D=0,M=S.i=S.j=0,R=S.S=[];for(E||(I=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[M=u&M+I[D%E]+(_=R[D])],R[M]=_;(S.g=function(L){for(var G,W=0,q=S.i,X=S.j,K=S.S;L--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return S.i=q,S.j=X,W})(r)}function m(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function h(I,_){var E=[],S=typeof I,D;if(_&&S=="object")for(D in I)try{E.push(h(I[D],_-1))}catch{}return E.length?E:S=="string"?I:I+"\0"}function g(I,_){for(var E=I+"",S,D=0;D<E.length;)_[u&D]=u&(S^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(I){return String.fromCharCode.apply(0,I)}if(g(n.random(),t),typeof WC=="object"&&WC.exports){WC.exports=p;try{d=Nw()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var SH=bt((KOt,EH)=>{"use strict";var Uye=fH(),jye=hH(),Gye=yH(),Wye=xH(),Hye=wH(),qye=_H(),up=IH();up.alea=Uye;up.xor128=jye;up.xorwow=Gye;up.xorshift7=Wye;up.xor4096=Hye;up.tychei=qye;EH.exports=up});function TR(t,n){return Object.is(t,n)}var Kn=null,xh=!1,VI=1,Zr=Symbol("SIGNAL");function Dt(t){let n=Kn;return Kn=t,n}function DR(){return Kn}function D9(){return xh}var Iu={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function v0(t){if(xh)throw new Error("");if(Kn===null)return;Kn.consumerOnSignalRead(t);let n=Kn.nextProducerIndex++;if(b0(Kn),n<Kn.producerNode.length&&Kn.producerNode[n]!==t&&bh(Kn)){let e=Kn.producerNode[n];x0(e,Kn.producerIndexOfThis[n])}Kn.producerNode[n]!==t&&(Kn.producerNode[n]=t,Kn.producerIndexOfThis[n]=bh(Kn)?MR(t,Kn,n):0),Kn.producerLastReadVersion[n]=t.version}function N9(){VI++}function NR(t){if(!(bh(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===VI)){if(!t.producerMustRecompute(t)&&!Ch(t)){SR(t);return}t.producerRecomputeValue(t),SR(t)}}function kR(t){if(t.liveConsumerNode===void 0)return;let n=xh;xh=!0;try{for(let e of t.liveConsumerNode)e.dirty||RR(e)}finally{xh=n}}function AR(){return Kn?.consumerAllowSignalWrites!==!1}function RR(t){t.dirty=!0,kR(t),t.consumerMarkedDirty?.(t)}function SR(t){t.dirty=!1,t.lastCleanEpoch=VI}function wp(t){return t&&(t.nextProducerIndex=0),Dt(t)}function wh(t,n){if(Dt(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(bh(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)x0(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function Ch(t){b0(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(NR(e),r!==e.version))return!0}return!1}function Cp(t){if(b0(t),bh(t))for(let n=0;n<t.producerNode.length;n++)x0(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function MR(t,n,e){if(FR(t),t.liveConsumerNode.length===0&&OR(t))for(let r=0;r<t.producerNode.length;r++)t.producerIndexOfThis[r]=MR(t.producerNode[r],t,r);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function x0(t,n){if(FR(t),t.liveConsumerNode.length===1&&OR(t))for(let r=0;r<t.producerNode.length;r++)x0(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];b0(o),o.producerIndexOfThis[r]=n}}function bh(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function b0(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function FR(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function OR(t){return t.producerNode!==void 0}function PR(t){let n=Object.create(k9);n.computation=t;let e=()=>{if(NR(n),v0(n),n.value===y0)throw n.error;return n.value};return e[Zr]=n,e}var PI=Symbol("UNSET"),LI=Symbol("COMPUTING"),y0=Symbol("ERRORED"),k9=Ue(me({},Iu),{value:PI,dirty:!0,error:null,equal:TR,kind:"computed",producerMustRecompute(t){return t.value===PI||t.value===LI},producerRecomputeValue(t){if(t.value===LI)throw new Error("Detected cycle in computations.");let n=t.value;t.value=LI;let e=wp(t),r,o=!1;try{r=t.computation(),Dt(null),o=n!==PI&&n!==y0&&r!==y0&&t.equal(n,r)}catch(i){r=y0,t.error=i}finally{wh(t,e)}if(o){t.value=n;return}t.value=r,t.version++}});function A9(){throw new Error}var LR=A9;function $R(){LR()}function VR(t){LR=t}var R9=null;function BR(t){let n=Object.create(BI);n.value=t;let e=()=>(v0(n),n.value);return e[Zr]=n,e}function w0(t,n){AR()||$R(),t.equal(t.value,n)||(t.value=n,M9(t))}function zR(t,n){AR()||$R(),w0(t,n(t.value))}var BI=Ue(me({},Iu),{equal:TR,value:void 0,kind:"signal"});function M9(t){t.version++,N9(),kR(t),R9?.()}function UR(t,n,e){let r=Object.create(F9);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;let o=l=>{r.cleanupFn=l};function i(l){return l.fn===null&&l.schedule===null}function s(l){i(l)||(Cp(l),l.cleanupFn(),l.fn=null,l.schedule=null,l.cleanupFn=$I)}let a=()=>{if(r.fn===null)return;if(D9())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(r.dirty=!1,r.hasRun&&!Ch(r))return;r.hasRun=!0;let l=wp(r);try{r.cleanupFn(),r.cleanupFn=$I,r.fn(o)}finally{wh(r,l)}};return r.ref={notify:()=>RR(r),run:a,cleanup:()=>r.cleanupFn(),destroy:()=>s(r),[Zr]:r},r.ref}var $I=()=>{},F9=Ue(me({},Iu),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule!==null&&t.schedule(t.ref)},hasRun:!1,cleanupFn:$I});function et(t){return typeof t=="function"}function _p(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var C0=_p(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function Eu(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var vn=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(et(r))try{r()}catch(i){n=i instanceof C0?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{jR(i)}catch(s){n=n??[],s instanceof C0?n=[...n,...s.errors]:n.push(s)}}if(n)throw new C0(n)}}add(n){var e;if(n&&n!==this)if(this.closed)jR(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&Eu(e,n)}remove(n){let{_finalizers:e}=this;e&&Eu(e,n),n instanceof t&&n._removeParent(this)}};vn.EMPTY=(()=>{let t=new vn;return t.closed=!0,t})();var zI=vn.EMPTY;function _0(t){return t instanceof vn||t&&"closed"in t&&et(t.remove)&&et(t.add)&&et(t.unsubscribe)}function jR(t){et(t)?t():t.unsubscribe()}var Ti={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Ip={setTimeout(t,n,...e){let{delegate:r}=Ip;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=Ip;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function I0(t){Ip.setTimeout(()=>{let{onUnhandledError:n}=Ti;if(n)n(t);else throw t})}function _h(){}var GR=UI("C",void 0,void 0);function WR(t){return UI("E",void 0,t)}function HR(t){return UI("N",t,void 0)}function UI(t,n,e){return{kind:t,value:n,error:e}}var Su=null;function Ep(t){if(Ti.useDeprecatedSynchronousErrorHandling){let n=!Su;if(n&&(Su={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=Su;if(Su=null,e)throw r}}else t()}function qR(t){Ti.useDeprecatedSynchronousErrorHandling&&Su&&(Su.errorThrown=!0,Su.error=t)}var Tu=class extends vn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,_0(n)&&n.add(this)):this.destination=L9}static create(n,e,r){return new $s(n,e,r)}next(n){this.isStopped?GI(HR(n),this):this._next(n)}error(n){this.isStopped?GI(WR(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?GI(GR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},O9=Function.prototype.bind;function jI(t,n){return O9.call(t,n)}var WI=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){E0(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){E0(r)}else E0(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){E0(e)}}},$s=class extends Tu{constructor(n,e,r){super();let o;if(et(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&Ti.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&jI(n.next,i),error:n.error&&jI(n.error,i),complete:n.complete&&jI(n.complete,i)}):o=n}this.destination=new WI(o)}};function E0(t){Ti.useDeprecatedSynchronousErrorHandling?qR(t):I0(t)}function P9(t){throw t}function GI(t,n){let{onStoppedNotification:e}=Ti;e&&Ip.setTimeout(()=>e(t,n))}var L9={closed:!0,next:_h,error:P9,complete:_h};var Sp=typeof Symbol=="function"&&Symbol.observable||"@@observable";function Co(t){return t}function HI(...t){return qI(t)}function qI(t){return t.length===0?Co:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var wt=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=V9(e)?e:new $s(e,r,o);return Ep(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=KR(r),new r((o,i)=>{let s=new $s({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[Sp](){return this}pipe(...e){return qI(e)(this)}toPromise(e){return e=KR(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return t.create=n=>new t(n),t})();function KR(t){var n;return(n=t??Ti.Promise)!==null&&n!==void 0?n:Promise}function $9(t){return t&&et(t.next)&&et(t.error)&&et(t.complete)}function V9(t){return t&&t instanceof Tu||$9(t)&&_0(t)}function KI(t){return et(t?.lift)}function ft(t){return n=>{if(KI(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function mt(t,n,e,r,o){return new XI(t,n,e,r,o)}var XI=class extends Tu{constructor(n,e,r,o,i,s){super(n),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){n.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function Tp(){return ft((t,n)=>{let e=null;t._refCount++;let r=mt(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var Dp=class extends wt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,KI(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new vn;let e=this.getSubject();n.add(this.source.subscribe(mt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=vn.EMPTY)}return n}refCount(){return Tp()(this)}};var XR=_p(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var xn=(()=>{class t extends wt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new S0(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new XR}next(e){Ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){Ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){Ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?zI:(this.currentObservers=null,i.push(e),new vn(()=>{this.currentObservers=null,Eu(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new wt;return e.source=this,e}}return t.create=(n,e)=>new S0(n,e),t})(),S0=class extends xn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:zI}};var hr=class extends xn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var YI={now(){return(YI.delegate||Date).now()},delegate:void 0};var T0=class extends vn{constructor(n,e){super()}schedule(n,e=0){return this}};var Ih={setInterval(t,n,...e){let{delegate:r}=Ih;return r?.setInterval?r.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){let{delegate:n}=Ih;return(n?.clearInterval||clearInterval)(t)},delegate:void 0};var D0=class extends T0{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var r;if(this.closed)return this;this.state=n;let o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,e)),this.pending=!0,this.delay=e,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(i,this.id,e),this}requestAsyncId(n,e,r=0){return Ih.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,e,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return e;e!=null&&Ih.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(n,e);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let r=!1,o;try{this.work(n)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){let{id:n,scheduler:e}=this,{actions:r}=e;this.work=this.state=this.scheduler=null,this.pending=!1,Eu(r,this),n!=null&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}};var Np=class t{constructor(n,e=t.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,r){return new this.schedulerActionCtor(this,n).schedule(r,e)}};Np.now=YI.now;var N0=class extends Np{constructor(n,e=Np.now){super(n,e),this.actions=[],this._active=!1}flush(n){let{actions:e}=this;if(this._active){e.push(n);return}let r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=e.shift());if(this._active=!1,r){for(;n=e.shift();)n.unsubscribe();throw r}}};var YR=new N0(D0);var Qr=new wt(t=>t.complete());function ZR(t){return t&&et(t.schedule)}function QR(t){return t[t.length-1]}function k0(t){return et(QR(t))?t.pop():void 0}function Ml(t){return ZR(QR(t))?t.pop():void 0}function eM(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})}function JR(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function Du(t){return this instanceof Du?(this.v=t,this):new Du(t)}function tM(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){r[f]&&(o[f]=function(h){return new Promise(function(g,x){i.push([f,h,g,x])>1||l(f,h)})},m&&(o[f]=m(o[f])))}function l(f,m){try{c(r[f](m))}catch(h){p(i[0][3],h)}}function c(f){f.value instanceof Du?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function p(f,m){f(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function nM(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof JR=="function"?JR(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}var A0=t=>t&&typeof t.length=="number"&&typeof t!="function";function R0(t){return et(t?.then)}function M0(t){return et(t[Sp])}function F0(t){return Symbol.asyncIterator&&et(t?.[Symbol.asyncIterator])}function O0(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function B9(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var P0=B9();function L0(t){return et(t?.[P0])}function $0(t){return tM(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield Du(e.read());if(o)return yield Du(void 0);yield yield Du(r)}}finally{e.releaseLock()}})}function V0(t){return et(t?.getReader)}function _n(t){if(t instanceof wt)return t;if(t!=null){if(M0(t))return z9(t);if(A0(t))return U9(t);if(R0(t))return j9(t);if(F0(t))return rM(t);if(L0(t))return G9(t);if(V0(t))return W9(t)}throw O0(t)}function z9(t){return new wt(n=>{let e=t[Sp]();if(et(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function U9(t){return new wt(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function j9(t){return new wt(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,I0)})}function G9(t){return new wt(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function rM(t){return new wt(n=>{H9(t,n).catch(e=>n.error(e))})}function W9(t){return rM($0(t))}function H9(t,n){var e,r,o,i;return eM(this,void 0,void 0,function*(){try{for(e=nM(t);r=yield e.next(),!r.done;){let s=r.value;if(n.next(s),n.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function Jr(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function B0(t,n=0){return ft((e,r)=>{e.subscribe(mt(r,o=>Jr(r,t,()=>r.next(o),n),()=>Jr(r,t,()=>r.complete(),n),o=>Jr(r,t,()=>r.error(o),n)))})}function z0(t,n=0){return ft((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function oM(t,n){return _n(t).pipe(z0(n),B0(n))}function iM(t,n){return _n(t).pipe(z0(n),B0(n))}function sM(t,n){return new wt(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function aM(t,n){return new wt(e=>{let r;return Jr(e,n,()=>{r=t[P0](),Jr(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>et(r?.return)&&r.return()})}function U0(t,n){if(!t)throw new Error("Iterable cannot be null");return new wt(e=>{Jr(e,n,()=>{let r=t[Symbol.asyncIterator]();Jr(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function lM(t,n){return U0($0(t),n)}function cM(t,n){if(t!=null){if(M0(t))return oM(t,n);if(A0(t))return sM(t,n);if(R0(t))return iM(t,n);if(F0(t))return U0(t,n);if(L0(t))return aM(t,n);if(V0(t))return lM(t,n)}throw O0(t)}function In(t,n){return n?cM(t,n):_n(t)}function je(...t){let n=Ml(t);return In(t,n)}function Fl(t,n){let e=et(t)?t:()=>t,r=o=>o.error(e());return new wt(n?o=>n.schedule(r,0,o):r)}function ZI(t){return!!t&&(t instanceof wt||et(t.lift)&&et(t.subscribe))}var Vs=_p(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function We(t,n){return ft((e,r)=>{let o=0;e.subscribe(mt(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:q9}=Array;function K9(t,n){return q9(n)?t(...n):t(n)}function j0(t){return We(n=>K9(t,n))}var{isArray:X9}=Array,{getPrototypeOf:Y9,prototype:Z9,keys:Q9}=Object;function G0(t){if(t.length===1){let n=t[0];if(X9(n))return{args:n,keys:null};if(J9(n)){let e=Q9(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function J9(t){return t&&typeof t=="object"&&Y9(t)===Z9}function W0(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function kp(...t){let n=Ml(t),e=k0(t),{args:r,keys:o}=G0(t);if(r.length===0)return In([],n);let i=new wt(e7(r,n,o?s=>W0(o,s):Co));return e?i.pipe(j0(e)):i}function e7(t,n,e=Co){return r=>{uM(n,()=>{let{length:o}=t,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)uM(n,()=>{let c=In(t[l],n),u=!1;c.subscribe(mt(r,d=>{i[l]=d,u||(u=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function uM(t,n,e){t?Jr(e,t,n):n()}function dM(t,n,e,r,o,i,s,a){let l=[],c=0,u=0,d=!1,p=()=>{d&&!l.length&&!c&&n.complete()},f=h=>c<r?m(h):l.push(h),m=h=>{i&&n.next(h),c++;let g=!1;_n(e(h,u++)).subscribe(mt(n,x=>{o?.(x),i?f(x):n.next(x)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){let x=l.shift();s?Jr(n,s,()=>m(x)):m(x)}p()}catch(x){n.error(x)}}))};return t.subscribe(mt(n,f,()=>{d=!0,p()})),()=>{a?.()}}function Xn(t,n,e=1/0){return et(n)?Xn((r,o)=>We((i,s)=>n(r,i,o,s))(_n(t(r,o))),e):(typeof n=="number"&&(e=n),ft((r,o)=>dM(r,o,t,e)))}function QI(t=1/0){return Xn(Co,t)}function pM(){return QI(1)}function Ol(...t){return pM()(In(t,Ml(t)))}function H0(t){return new wt(n=>{_n(t()).subscribe(n)})}function Eh(...t){let n=k0(t),{args:e,keys:r}=G0(t),o=new wt(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let d=!1;_n(e[u]).subscribe(mt(i,p=>{d||(d=!0,c--),a[u]=p},()=>l--,void 0,()=>{(!l||!d)&&(c||i.next(r?W0(r,a):a),i.complete())}))}});return n?o.pipe(j0(n)):o}function Br(t,n){return ft((e,r)=>{let o=0;e.subscribe(mt(r,i=>t.call(n,i,o++)&&r.next(i)))})}function os(t){return ft((n,e)=>{let r=null,o=!1,i;r=n.subscribe(mt(e,void 0,void 0,s=>{i=_n(t(s,os(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function fM(t,n,e,r,o){return(i,s)=>{let a=e,l=n,c=0;i.subscribe(mt(s,u=>{let d=c++;l=a?t(l,u,d):(a=!0,u),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function Pl(t,n){return et(n)?Xn(t,n,1):Xn(t,1)}function JI(t,n=YR){return ft((e,r)=>{let o=null,i=null,s=null,a=()=>{if(o){o.unsubscribe(),o=null;let c=i;i=null,r.next(c)}};function l(){let c=s+t,u=n.now();if(u<c){o=this.schedule(void 0,c-u),r.add(o);return}a()}e.subscribe(mt(r,c=>{i=c,s=n.now(),o||(o=n.schedule(l,t),r.add(o))},()=>{a(),r.complete()},void 0,()=>{i=o=null}))})}function Ll(t){return ft((n,e)=>{let r=!1;n.subscribe(mt(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function _o(t){return t<=0?()=>Qr:ft((n,e)=>{let r=0;n.subscribe(mt(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function q0(t=t7){return ft((n,e)=>{let r=!1;n.subscribe(mt(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function t7(){return new Vs}function Bs(t){return ft((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function zs(t,n){let e=arguments.length>=2;return r=>r.pipe(t?Br((o,i)=>t(o,i,r)):Co,_o(1),e?Ll(n):q0(()=>new Vs))}function Ap(t){return t<=0?()=>Qr:ft((n,e)=>{let r=[];n.subscribe(mt(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function eE(t,n){let e=arguments.length>=2;return r=>r.pipe(t?Br((o,i)=>t(o,i,r)):Co,Ap(1),e?Ll(n):q0(()=>new Vs))}function tE(t,n){return ft(fM(t,n,arguments.length>=2,!0))}function rE(t={}){let{connector:n=()=>new xn,resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=t;return i=>{let s,a,l,c=0,u=!1,d=!1,p=()=>{a?.unsubscribe(),a=void 0},f=()=>{p(),s=l=void 0,u=d=!1},m=()=>{let h=s;f(),h?.unsubscribe()};return ft((h,g)=>{c++,!d&&!u&&p();let x=l=l??n();g.add(()=>{c--,c===0&&!d&&!u&&(a=nE(m,o))}),x.subscribe(g),!s&&c>0&&(s=new $s({next:b=>x.next(b),error:b=>{d=!0,p(),a=nE(f,e,b),x.error(b)},complete:()=>{u=!0,p(),a=nE(f,r),x.complete()}}),_n(h).subscribe(s))})(i)}}function nE(t,n,...e){if(n===!0){t();return}if(n===!1)return;let r=new $s({next:()=>{r.unsubscribe(),t()}});return _n(n(...e)).subscribe(r)}function oE(t){return Br((n,e)=>t<=e)}function Sh(...t){let n=Ml(t);return ft((e,r)=>{(n?Ol(t,e,n):Ol(t,e)).subscribe(r)})}function Io(t,n){return ft((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(mt(r,l=>{o?.unsubscribe();let c=0,u=i++;_n(t(l,u)).subscribe(o=mt(r,d=>r.next(n?n(l,d,u,c++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function Th(t){return ft((n,e)=>{_n(t).subscribe(mt(e,()=>e.complete(),_h)),!e.closed&&n.subscribe(e)})}function Dn(t,n,e){let r=et(t)||n||e?{next:t,error:n,complete:e}:t;return r?ft((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(mt(i,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),i.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):Co}var JM="https://g.co/ng/security#xss",Ie=class extends Error{code;constructor(n,e){super(Fv(n,e)),this.code=n}};function Fv(t,n){return`${`NG0${Math.abs(t)}`}${n?": "+n:""}`}var e2=Symbol("InputSignalNode#UNSET"),n7=Ue(me({},BI),{transformFn:void 0,applyValueToInputSignal(t,n){w0(t,n)}});function t2(t,n){let e=Object.create(n7);e.value=t,e.transformFn=n?.transform;function r(){if(v0(e),e.value===e2)throw new Ie(-950,!1);return e.value}return r[Zr]=e,r}function Uh(t){return{toString:t}.toString()}var K0="__parameters__";function r7(t){return function(...e){if(t){let r=t(...e);for(let o in r)this[o]=r[o]}}}function n2(t,n,e){return Uh(()=>{let r=r7(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,c,u){let d=l.hasOwnProperty(K0)?l[K0]:Object.defineProperty(l,K0,{value:[]})[K0];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var Us=globalThis;function Qt(t){for(let n in t)if(t[n]===Qt)return n;throw Error("Could not find renamed property on target object.")}function o7(t,n){for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Ur(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Ur).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let n=t.toString();if(n==null)return""+n;let e=n.indexOf(`
`);return e===-1?n:n.substring(0,e)}function yE(t,n){return t==null||t===""?n===null?"":n:n==null||n===""?t:t+" "+n}var i7=Qt({__forward_ref__:Qt});function gr(t){return t.__forward_ref__=gr,t.toString=function(){return Ur(this())},t}function zr(t){return r2(t)?t():t}function r2(t){return typeof t=="function"&&t.hasOwnProperty(i7)&&t.__forward_ref__===gr}function be(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function rr(t){return{providers:t.providers||[],imports:t.imports||[]}}function Ov(t){return mM(t,i2)||mM(t,s2)}function o2(t){return Ov(t)!==null}function mM(t,n){return t.hasOwnProperty(n)?t[n]:null}function s7(t){let n=t&&(t[i2]||t[s2]);return n||null}function hM(t){return t&&(t.hasOwnProperty(gM)||t.hasOwnProperty(a7))?t[gM]:null}var i2=Qt({\u0275prov:Qt}),gM=Qt({\u0275inj:Qt}),s2=Qt({ngInjectableDef:Qt}),a7=Qt({ngInjectorDef:Qt}),ke=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=be({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function a2(t){return t&&!!t.\u0275providers}var l7=Qt({\u0275cmp:Qt}),c7=Qt({\u0275dir:Qt}),u7=Qt({\u0275pipe:Qt}),d7=Qt({\u0275mod:Qt}),av=Qt({\u0275fac:Qt}),Ah=Qt({__NG_ELEMENT_ID__:Qt}),yM=Qt({__NG_ENV_ID__:Qt});function js(t){return typeof t=="string"?t:t==null?"":String(t)}function p7(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():js(t)}function f7(t,n){let e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Ie(-200,t)}function bS(t,n){throw new Ie(-201,!1)}var ct=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(ct||{}),vE;function l2(){return vE}function eo(t){let n=vE;return vE=t,n}function c2(t,n,e){let r=Ov(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&ct.Optional)return null;if(n!==void 0)return n;bS(t,"Injector")}var m7={},Rh=m7,xE="__NG_DI_FLAG__",lv="ngTempTokenPath",h7="ngTokenPath",g7=/\n/gm,y7="\u0275",vM="__source",Op;function v7(){return Op}function $l(t){let n=Op;return Op=t,n}function x7(t,n=ct.Default){if(Op===void 0)throw new Ie(-203,!1);return Op===null?c2(t,void 0,n):Op.get(t,n&ct.Optional?null:void 0,n)}function Me(t,n=ct.Default){return(l2()||x7)(zr(t),n)}function se(t,n=ct.Default){return Me(t,Pv(n))}function Pv(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function bE(t){let n=[];for(let e=0;e<t.length;e++){let r=zr(t[e]);if(Array.isArray(r)){if(r.length===0)throw new Ie(900,!1);let o,i=ct.Default;for(let s=0;s<r.length;s++){let a=r[s],l=b7(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}n.push(Me(o,i))}else n.push(Me(r))}return n}function u2(t,n){return t[xE]=n,t.prototype[xE]=n,t}function b7(t){return t[xE]}function w7(t,n,e,r){let o=t[lv];throw n[vM]&&o.unshift(n[vM]),t.message=C7(`
`+t.message,o,e,r),t[h7]=o,t[lv]=null,t}function C7(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==y7?t.slice(2):t;let o=Ur(n);if(Array.isArray(n))o=n.map(Ur).join(" -> ");else if(typeof n=="object"){let i=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Ur(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(g7,`
  `)}`}var wS=u2(n2("Optional"),8);var d2=u2(n2("SkipSelf"),4);function Au(t,n){let e=t.hasOwnProperty(av);return e?t[av]:null}function _7(t,n,e){if(t.length!==n.length)return!1;for(let r=0;r<t.length;r++){let o=t[r],i=n[r];if(e&&(o=e(o),i=e(i)),i!==o)return!1}return!0}function I7(t){return t.flat(Number.POSITIVE_INFINITY)}function CS(t,n){t.forEach(e=>Array.isArray(e)?CS(e,n):n(e))}function p2(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function cv(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function E7(t,n){let e=[];for(let r=0;r<t;r++)e.push(n);return e}function S7(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(o===1)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;){let i=o-2;t[o]=t[i],o--}t[n]=e,t[n+1]=r}}function _S(t,n,e){let r=jh(t,n);return r>=0?t[r|1]=e:(r=~r,S7(t,r,n,e)),r}function iE(t,n){let e=jh(t,n);if(e>=0)return t[e|1]}function jh(t,n){return T7(t,n,1)}function T7(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=t[i<<e];if(n===s)return i<<e;s>n?o=i:r=i+1}return~(o<<e)}var Lp={},to=[],$p=new ke(""),f2=new ke("",-1),m2=new ke(""),uv=class{get(n,e=Rh){if(e===Rh){let r=new Error(`NullInjectorError: No provider for ${Ur(n)}!`);throw r.name="NullInjectorError",r}return e}};function h2(t,n){let e=t[d7]||null;if(!e&&n===!0)throw new Error(`Type ${Ur(t)} does not have '\u0275mod' property.`);return e}function Ru(t){return t[l7]||null}function g2(t){return t[c7]||null}function y2(t){return t[u7]||null}function v2(t){let n=Ru(t)||g2(t)||y2(t);return n!==null&&n.standalone}function Hp(t){return{\u0275providers:t}}function D7(...t){return{\u0275providers:x2(!0,t),\u0275fromNgModule:!0}}function x2(t,...n){let e=[],r=new Set,o,i=s=>{e.push(s)};return CS(n,s=>{let a=s;wE(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&b2(o,i),e}function b2(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];IS(o,i=>{n(i,r)})}}function wE(t,n,e,r){if(t=zr(t),!t)return!1;let o=null,i=hM(t),s=!i&&Ru(t);if(!i&&!s){let l=t.ngModule;if(i=hM(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=t}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)wE(c,n,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let c;try{CS(i.imports,u=>{wE(u,n,e,r)&&(c||=[],c.push(u))})}finally{}c!==void 0&&b2(c,n)}if(!a){let c=Au(o)||(()=>new o);n({provide:o,useFactory:c,deps:to},o),n({provide:m2,useValue:o,multi:!0},o),n({provide:$p,useValue:()=>Me(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let c=t;IS(l,u=>{n(u,c)})}}else return!1;return o!==t&&t.providers!==void 0}function IS(t,n){for(let e of t)a2(e)&&(e=e.\u0275providers),Array.isArray(e)?IS(e,n):n(e)}var N7=Qt({provide:String,useValue:Qt});function w2(t){return t!==null&&typeof t=="object"&&N7 in t}function k7(t){return!!(t&&t.useExisting)}function A7(t){return!!(t&&t.useFactory)}function Vp(t){return typeof t=="function"}function R7(t){return!!t.useClass}var Lv=new ke(""),ev={},M7={},sE;function ES(){return sE===void 0&&(sE=new uv),sE}var no=class{},Mh=class extends no{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,_E(n,s=>this.processProvider(s)),this.records.set(f2,Rp(void 0,this)),o.has("environment")&&this.records.set(no,Rp(void 0,this));let i=this.records.get(Lv);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(m2,to,ct.Self))}destroy(){Nh(this),this._destroyed=!0;let n=Dt(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),Dt(n)}}onDestroy(n){return Nh(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){Nh(this);let e=$l(this),r=eo(void 0),o;try{return n()}finally{$l(e),eo(r)}}get(n,e=Rh,r=ct.Default){if(Nh(this),n.hasOwnProperty(yM))return n[yM](this);r=Pv(r);let o,i=$l(this),s=eo(void 0);try{if(!(r&ct.SkipSelf)){let l=this.records.get(n);if(l===void 0){let c=$7(n)&&Ov(n);c&&this.injectableDefInScope(c)?l=Rp(CE(n),ev):l=null,this.records.set(n,l)}if(l!=null)return this.hydrate(n,l)}let a=r&ct.Self?ES():this.parent;return e=r&ct.Optional&&e===Rh?null:e,a.get(n,e)}catch(a){if(a.name==="NullInjectorError"){if((a[lv]=a[lv]||[]).unshift(Ur(n)),i)throw a;return w7(a,n,"R3InjectorError",this.source)}else throw a}finally{eo(s),$l(i)}}resolveInjectorInitializers(){let n=Dt(null),e=$l(this),r=eo(void 0),o;try{let i=this.get($p,to,ct.Self);for(let s of i)s()}finally{$l(e),eo(r),Dt(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Ur(r));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=zr(n);let e=Vp(n)?n:zr(n&&n.provide),r=O7(n);if(!Vp(n)&&n.multi===!0){let o=this.records.get(e);o||(o=Rp(void 0,ev,!0),o.factory=()=>bE(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){let r=Dt(null);try{return e.value===ev&&(e.value=M7,e.value=e.factory()),typeof e.value=="object"&&e.value&&L7(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{Dt(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=zr(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function CE(t){let n=Ov(t),e=n!==null?n.factory:Au(t);if(e!==null)return e;if(t instanceof ke)throw new Ie(204,!1);if(t instanceof Function)return F7(t);throw new Ie(204,!1)}function F7(t){if(t.length>0)throw new Ie(204,!1);let e=s7(t);return e!==null?()=>e.factory(t):()=>new t}function O7(t){if(w2(t))return Rp(void 0,t.useValue);{let n=C2(t);return Rp(n,ev)}}function C2(t,n,e){let r;if(Vp(t)){let o=zr(t);return Au(o)||CE(o)}else if(w2(t))r=()=>zr(t.useValue);else if(A7(t))r=()=>t.useFactory(...bE(t.deps||[]));else if(k7(t))r=()=>Me(zr(t.useExisting));else{let o=zr(t&&(t.useClass||t.provide));if(P7(t))r=()=>new o(...bE(t.deps));else return Au(o)||CE(o)}return r}function Nh(t){if(t.destroyed)throw new Ie(205,!1)}function Rp(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function P7(t){return!!t.deps}function L7(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function $7(t){return typeof t=="function"||typeof t=="object"&&t instanceof ke}function _E(t,n){for(let e of t)Array.isArray(e)?_E(e,n):e&&a2(e)?_E(e.\u0275providers,n):n(e)}function yr(t,n){t instanceof Mh&&Nh(t);let e,r=$l(t),o=eo(void 0);try{return n()}finally{$l(r),eo(o)}}function _2(){return l2()!==void 0||v7()!=null}function I2(t){if(!_2())throw new Ie(-203,!1)}function V7(t){return typeof t=="function"}var Zs=0,ht=1,Ye=2,Dr=3,ki=4,oo=5,Fh=6,dv=7,qo=8,Oh=9,Gs=10,En=11,Ph=12,xM=13,qp=14,Ko=15,Mu=16,Mp=17,Ws=18,$v=19,E2=20,Vl=21,tv=22,Fu=23,Eo=24,ro=25,S2=1;var Ou=7,pv=8,Bp=9,So=10;function Bl(t){return Array.isArray(t)&&typeof t[S2]=="object"}function Qs(t){return Array.isArray(t)&&t[S2]===!0}function SS(t){return(t.flags&4)!==0}function ju(t){return t.componentOffset>-1}function Vv(t){return(t.flags&1)===1}function Hs(t){return!!t.template}function fv(t){return(t[Ye]&512)!==0}function Gh(t){return(t[Ye]&256)===256}var IE=class{previousValue;currentValue;firstChange;constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function T2(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}var Xo=(()=>{let t=()=>D2;return t.ngInherit=!0,t})();function D2(t){return t.type.prototype.ngOnChanges&&(t.setInput=z7),B7}function B7(){let t=k2(this),n=t?.current;if(n){let e=t.previous;if(e===Lp)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function z7(t,n,e,r,o){let i=this.declaredInputs[r],s=k2(t)||U7(t,{previous:Lp,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[i];a[i]=new IE(c&&c.currentValue,e,l===Lp),T2(t,n,o,e)}var N2="__ngSimpleChanges__";function k2(t){return t[N2]||null}function U7(t,n){return t[N2]=n}var bM=null;var Ho=function(t,n,e){bM?.(t,n,e)},j7="svg",G7="math";function ss(t){for(;Array.isArray(t);)t=t[Zs];return t}function A2(t,n){return ss(n[t])}function Ai(t,n){return ss(n[t.index])}function R2(t,n){return t.data[n]}function W7(t,n){return t[n]}function as(t,n){let e=n[t];return Bl(e)?e:e[Zs]}function H7(t){return(t[Ye]&4)===4}function TS(t){return(t[Ye]&128)===128}function q7(t){return Qs(t[Dr])}function zp(t,n){return n==null?null:t[n]}function M2(t){t[Mp]=0}function DS(t){t[Ye]&1024||(t[Ye]|=1024,TS(t)&&Wh(t))}function K7(t,n){for(;t>0;)n=n[qp],t--;return n}function Bv(t){return!!(t[Ye]&9216||t[Eo]?.dirty)}function EE(t){t[Gs].changeDetectionScheduler?.notify(9),t[Ye]&64&&(t[Ye]|=1024),Bv(t)&&Wh(t)}function Wh(t){t[Gs].changeDetectionScheduler?.notify(0);let n=Pu(t);for(;n!==null&&!(n[Ye]&8192||(n[Ye]|=8192,!TS(n)));)n=Pu(n)}function F2(t,n){if(Gh(t))throw new Ie(911,!1);t[Vl]===null&&(t[Vl]=[]),t[Vl].push(n)}function X7(t,n){if(t[Vl]===null)return;let e=t[Vl].indexOf(n);e!==-1&&t[Vl].splice(e,1)}function Pu(t){let n=t[Dr];return Qs(n)?n[Dr]:n}function O2(t){return t[dv]??=[]}function P2(t){return t.cleanup??=[]}function Y7(t,n,e,r){let o=O2(n);o.push(e),t.firstCreatePass&&P2(t).push(r,o.length-1)}var ut={lFrame:W2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var SE=!1;function Z7(){return ut.lFrame.elementDepthCount}function Q7(){ut.lFrame.elementDepthCount++}function J7(){ut.lFrame.elementDepthCount--}function L2(){return ut.bindingsEnabled}function $2(){return ut.skipHydrationRootTNode!==null}function eX(t){return ut.skipHydrationRootTNode===t}function tX(){ut.skipHydrationRootTNode=null}function dt(){return ut.lFrame.lView}function Rn(){return ut.lFrame.tView}function le(t){return ut.lFrame.contextLView=t,t[qo]}function ce(t){return ut.lFrame.contextLView=null,t}function jr(){let t=V2();for(;t!==null&&t.type===64;)t=t.parent;return t}function V2(){return ut.lFrame.currentTNode}function nX(){let t=ut.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function Gu(t,n){let e=ut.lFrame;e.currentTNode=t,e.isParent=n}function NS(){return ut.lFrame.isParent}function kS(){ut.lFrame.isParent=!1}function B2(){return SE}function mv(t){let n=SE;return SE=t,n}function AS(){let t=ut.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function z2(){return ut.lFrame.bindingIndex}function rX(t){return ut.lFrame.bindingIndex=t}function zv(){return ut.lFrame.bindingIndex++}function Uv(t){let n=ut.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function oX(){return ut.lFrame.inI18n}function iX(t,n){let e=ut.lFrame;e.bindingIndex=e.bindingRootIndex=t,TE(n)}function sX(){return ut.lFrame.currentDirectiveIndex}function TE(t){ut.lFrame.currentDirectiveIndex=t}function aX(t){let n=ut.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function U2(){return ut.lFrame.currentQueryIndex}function RS(t){ut.lFrame.currentQueryIndex=t}function lX(t){let n=t[ht];return n.type===2?n.declTNode:n.type===1?t[oo]:null}function j2(t,n,e){if(e&ct.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&ct.Host);)if(o=lX(i),o===null||(i=i[qp],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=ut.lFrame=G2();return r.currentTNode=n,r.lView=t,!0}function MS(t){let n=G2(),e=t[ht];ut.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function G2(){let t=ut.lFrame,n=t===null?null:t.child;return n===null?W2(t):n}function W2(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function H2(){let t=ut.lFrame;return ut.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var q2=H2;function FS(){let t=H2();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function cX(t){return(ut.lFrame.contextLView=K7(t,ut.lFrame.contextLView))[qo]}function Js(){return ut.lFrame.selectedIndex}function Lu(t){ut.lFrame.selectedIndex=t}function jv(){let t=ut.lFrame;return R2(t.tView,t.selectedIndex)}function uX(){return ut.lFrame.currentNamespace}var K2=!0;function Gv(){return K2}function Wv(t){K2=t}function dX(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let s=D2(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function Hv(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),l&&(t.viewHooks??=[]).push(-e,l),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),u!=null&&(t.destroyHooks??=[]).push(e,u)}}function nv(t,n,e){X2(t,n,3,e)}function rv(t,n,e,r){(t[Ye]&3)===e&&X2(t,n,e,r)}function aE(t,n){let e=t[Ye];(e&3)===n&&(e&=16383,e+=1,t[Ye]=e)}function X2(t,n,e,r){let o=r!==void 0?t[Mp]&65535:0,i=r??-1,s=n.length-1,a=0;for(let l=o;l<s;l++)if(typeof n[l+1]=="number"){if(a=n[l],r!=null&&a>=r)break}else n[l]<0&&(t[Mp]+=65536),(a<i||i==-1)&&(pX(t,e,n,l),t[Mp]=(t[Mp]&4294901760)+l+2),l++}function wM(t,n){Ho(4,t,n);let e=Dt(null);try{n.call(t)}finally{Dt(e),Ho(5,t,n)}}function pX(t,n,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=t[s];o?t[Ye]>>14<t[Mp]>>16&&(t[Ye]&3)===n&&(t[Ye]+=16384,wM(a,i)):wM(a,i)}var Pp=-1,$u=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,r){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=r}};function fX(t){return t instanceof $u}function mX(t){return(t.flags&8)!==0}function hX(t){return(t.flags&16)!==0}function gX(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,i)}else{let i=o,s=e[++r];yX(i)?t.setProperty(n,i,s):t.setAttribute(n,i,s),r++}}return r}function Y2(t){return t===3||t===4||t===6}function yX(t){return t.charCodeAt(0)===64}function Up(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?CM(t,e,o,null,n[++r]):CM(t,e,o,null,null))}}return t}function CM(t,n,e,r,o){let i=0,s=t.length;if(n===-1)s=-1;else for(;i<t.length;){let a=t[i++];if(typeof a=="number"){if(a===n){s=-1;break}else if(a>n){s=i-1;break}}}for(;i<t.length;){let a=t[i];if(typeof a=="number")break;if(a===e){if(r===null){o!==null&&(t[i+1]=o);return}else if(r===t[i+1]){t[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}s!==-1&&(t.splice(s,0,n),i=s+1),t.splice(i++,0,e),r!==null&&t.splice(i++,0,r),o!==null&&t.splice(i++,0,o)}var lE={},DE=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Pv(r);let o=this.injector.get(n,lE,r);return o!==lE||e===lE?o:this.parentInjector.get(n,e,r)}};function Z2(t){return t!==Pp}function hv(t){return t&32767}function vX(t){return t>>16}function gv(t,n){let e=vX(t),r=n;for(;e>0;)r=r[qp],e--;return r}var NE=!0;function yv(t){let n=NE;return NE=t,n}var xX=256,Q2=xX-1,J2=5,bX=0,is={};function wX(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(Ah)&&(r=e[Ah]),r==null&&(r=e[Ah]=bX++);let o=r&Q2,i=1<<o;n.data[t+(o>>J2)]|=i}function vv(t,n){let e=eF(t,n);if(e!==-1)return e;let r=n[ht];r.firstCreatePass&&(t.injectorIndex=n.length,cE(r.data,t),cE(n,null),cE(r.blueprint,null));let o=OS(t,n),i=t.injectorIndex;if(Z2(o)){let s=hv(o),a=gv(o,n),l=a[ht].data;for(let c=0;c<8;c++)n[i+c]=a[s+c]|l[s+c]}return n[i+8]=o,i}function cE(t,n){t.push(0,0,0,0,0,0,0,0,n)}function eF(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function OS(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=iF(o),r===null)return Pp;if(e++,o=o[qp],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return Pp}function kE(t,n,e){wX(t,n,e)}function CX(t,n){if(n==="class")return t.classes;if(n==="style")return t.styles;let e=t.attrs;if(e){let r=e.length,o=0;for(;o<r;){let i=e[o];if(Y2(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<r&&typeof e[o]=="string";)o++;else{if(i===n)return e[o+1];o=o+2}}}return null}function tF(t,n,e){if(e&ct.Optional||t!==void 0)return t;bS(n,"NodeInjector")}function nF(t,n,e,r){if(e&ct.Optional&&r===void 0&&(r=null),!(e&(ct.Self|ct.Host))){let o=t[Oh],i=eo(void 0);try{return o?o.get(n,r,e&ct.Optional):c2(n,r,e&ct.Optional)}finally{eo(i)}}return tF(r,n,e)}function rF(t,n,e,r=ct.Default,o){if(t!==null){if(n[Ye]&2048&&!(r&ct.Self)){let s=SX(t,n,e,r,is);if(s!==is)return s}let i=oF(t,n,e,r,is);if(i!==is)return i}return nF(n,e,r,o)}function oF(t,n,e,r,o){let i=IX(e);if(typeof i=="function"){if(!j2(n,t,r))return r&ct.Host?tF(o,e,r):nF(n,e,r,o);try{let s;if(s=i(r),s==null&&!(r&ct.Optional))bS(e);else return s}finally{q2()}}else if(typeof i=="number"){let s=null,a=eF(t,n),l=Pp,c=r&ct.Host?n[Ko][oo]:null;for((a===-1||r&ct.SkipSelf)&&(l=a===-1?OS(t,n):n[a+8],l===Pp||!IM(r,!1)?a=-1:(s=n[ht],a=hv(l),n=gv(l,n)));a!==-1;){let u=n[ht];if(_M(i,a,u.data)){let d=_X(a,n,e,s,r,c);if(d!==is)return d}l=n[a+8],l!==Pp&&IM(r,n[ht].data[a+8]===c)&&_M(i,a,n)?(s=u,a=hv(l),n=gv(l,n)):a=-1}}return o}function _X(t,n,e,r,o,i){let s=n[ht],a=s.data[t+8],l=r==null?ju(a)&&NE:r!=s&&(a.type&3)!==0,c=o&ct.Host&&i===a,u=ov(a,s,e,l,c);return u!==null?Lh(n,s,u,a):is}function ov(t,n,e,r,o){let i=t.providerIndexes,s=n.data,a=i&1048575,l=t.directiveStart,c=t.directiveEnd,u=i>>20,d=r?a:a+u,p=o?a+u:c;for(let f=d;f<p;f++){let m=s[f];if(f<l&&e===m||f>=l&&m.type===e)return f}if(o){let f=s[l];if(f&&Hs(f)&&f.type===e)return l}return null}function Lh(t,n,e,r){let o=t[e],i=n.data;if(fX(o)){let s=o;s.resolving&&f7(p7(i[e]));let a=yv(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?eo(s.injectImpl):null,u=j2(t,r,ct.Default);try{o=t[e]=s.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&dX(e,i[e],n)}finally{c!==null&&eo(c),yv(a),s.resolving=!1,q2()}}return o}function IX(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(Ah)?t[Ah]:void 0;return typeof n=="number"?n>=0?n&Q2:EX:n}function _M(t,n,e){let r=1<<t;return!!(e[n+(t>>J2)]&r)}function IM(t,n){return!(t&ct.Self)&&!(t&ct.Host&&n)}var ku=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return rF(this._tNode,this._lView,n,Pv(r),e)}};function EX(){return new ku(jr(),dt())}function Yo(t){return Uh(()=>{let n=t.prototype.constructor,e=n[av]||AE(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[av]||AE(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function AE(t){return r2(t)?()=>{let n=AE(zr(t));return n&&n()}:Au(t)}function SX(t,n,e,r,o){let i=t,s=n;for(;i!==null&&s!==null&&s[Ye]&2048&&!fv(s);){let a=oF(i,s,e,r|ct.Self,is);if(a!==is)return a;let l=i.parent;if(!l){let c=s[E2];if(c){let u=c.get(e,is,r);if(u!==is)return u}l=iF(s),s=s[qp]}i=l}return o}function iF(t){let n=t[ht],e=n.type;return e===2?n.declTNode:e===1?t[oo]:null}function qv(t){return CX(jr(),t)}function EM(t,n=null,e=null,r){let o=sF(t,n,e,r);return o.resolveInjectorInitializers(),o}function sF(t,n=null,e=null,r,o=new Set){let i=[e||to,D7(t)];return r=r||(typeof t=="object"?void 0:Ur(t)),new Mh(i,n||ES(),r||null,o)}var Pn=class t{static THROW_IF_NOT_FOUND=Rh;static NULL=new uv;static create(n,e){if(Array.isArray(n))return EM({name:""},e,n,"");{let r=n.name??"";return EM({name:r},n.parent,n.providers,r)}}static \u0275prov=be({token:t,providedIn:"any",factory:()=>Me(f2)});static __NG_ELEMENT_ID__=-1};var xv=class{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>qv(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},TX=new ke("");TX.__NG_ELEMENT_ID__=t=>{let n=jr();if(n===null)throw new Ie(204,!1);if(n.type&2)return n.value;if(t&ct.Optional)return null;throw new Ie(204,!1)};var aF=!1,Kp=(()=>{class t{static __NG_ELEMENT_ID__=DX;static __NG_ENV_ID__=e=>e}return t})(),bv=class extends Kp{_lView;constructor(n){super(),this._lView=n}onDestroy(n){return F2(this._lView,n),()=>X7(this._lView,n)}};function DX(){return new bv(dt())}var Vu=class{},Kv=new ke("",{providedIn:"root",factory:()=>!1});var lF=new ke(""),PS=new ke(""),ea=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new hr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=be({token:t,providedIn:"root",factory:()=>new t})}return t})();var RE=class extends xn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,_2()&&(this.destroyRef=se(Kp,{optional:!0})??void 0,this.pendingTasks=se(ea,{optional:!0})??void 0)}emit(n){let e=Dt(null);try{super.next(n)}finally{Dt(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),s=r;if(n&&typeof n=="object"){let l=n;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return n instanceof vn&&n.add(a),a}wrapInTimeout(n){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{n(e),r!==void 0&&this.pendingTasks?.remove(r)})}}},Lt=RE;function $h(...t){}function cF(t){let n,e;function r(){t=$h;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{t(),r()})),()=>r()}function SM(t){return queueMicrotask(()=>t()),()=>{t=$h}}var LS="isAngularZone",wv=LS+"_ID",NX=0,bn=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Lt(!1);onMicrotaskEmpty=new Lt(!1);onStable=new Lt(!1);onError=new Lt(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=aF}=n;if(typeof Zone>"u")throw new Ie(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,RX(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(LS)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new Ie(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new Ie(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,n,kX,$h,$h);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},kX={};function $S(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function AX(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){cF(()=>{t.callbackScheduled=!1,ME(t),t.isCheckStableRunning=!0,$S(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),ME(t)}function RX(t){let n=()=>{AX(t)},e=NX++;t._inner=t._inner.fork({name:"angular",properties:{[LS]:!0,[wv]:e,[wv+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(MX(l))return r.invokeTask(i,s,a,l);try{return TM(t),r.invokeTask(i,s,a,l)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),DM(t)}},onInvoke:(r,o,i,s,a,l,c)=>{try{return TM(t),r.invoke(i,s,a,l,c)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!FX(l)&&n(),DM(t)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,ME(t),$S(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function ME(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function TM(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function DM(t){t._nesting--,$S(t)}var Cv=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Lt;onMicrotaskEmpty=new Lt;onStable=new Lt;onError=new Lt;run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}};function MX(t){return uF(t,"__ignore_ng_zone__")}function FX(t){return uF(t,"__scheduler_tick__")}function uF(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var To=class{_console=console;handleError(n){this._console.error("ERROR",n)}},OX=new ke("",{providedIn:"root",factory:()=>{let t=se(bn),n=se(To);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function NM(t,n){return t2(t,n)}function PX(t){return t2(e2,t)}var dF=(NM.required=PX,NM);function LX(){return Xp(jr(),dt())}function Xp(t,n){return new Yn(Ai(t,n))}var Yn=(()=>{class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=LX}return t})();function $X(t){return t instanceof Yn?t.nativeElement:t}var kM=new Set;function jl(t){kM.has(t)||(kM.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function VS(t){return typeof t=="function"&&t[Zr]!==void 0}function io(t,n){jl("NgSignals");let e=BR(t),r=e[Zr];return n?.equal&&(r.equal=n.equal),e.set=o=>w0(r,o),e.update=o=>zR(r,o),e.asReadonly=VX.bind(e),e}function VX(){let t=this[Zr];if(t.readonlyFn===void 0){let n=()=>this();n[Zr]=t,t.readonlyFn=n}return t.readonlyFn}function pF(t){return VS(t)&&typeof t.set=="function"}function BX(){return this._results[Symbol.iterator]()}var _v=class{_emitDistinctChangesOnly;dirty=!0;_onDirty=void 0;_results=[];_changesDetected=!1;_changes=void 0;length=0;first=void 0;last=void 0;get changes(){return this._changes??=new xn}constructor(n=!1){this._emitDistinctChangesOnly=n}get(n){return this._results[n]}map(n){return this._results.map(n)}filter(n){return this._results.filter(n)}find(n){return this._results.find(n)}reduce(n,e){return this._results.reduce(n,e)}forEach(n){this._results.forEach(n)}some(n){return this._results.some(n)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(n,e){this.dirty=!1;let r=I7(n);(this._changesDetected=!_7(this._results,r,e))&&(this._results=r,this.length=r.length,this.last=r[this.length-1],this.first=r[0])}notifyOnChanges(){this._changes!==void 0&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.next(this)}onDirty(n){this._onDirty=n}setDirty(){this.dirty=!0,this._onDirty?.()}destroy(){this._changes!==void 0&&(this._changes.complete(),this._changes.unsubscribe())}[Symbol.iterator]=BX};function fF(t){return(t.flags&128)===128}var mF=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(mF||{}),hF=new Map,zX=0;function UX(){return zX++}function jX(t){hF.set(t[$v],t)}function FE(t){hF.delete(t[$v])}var AM="__ngContext__";function Wu(t,n){Bl(n)?(t[AM]=n[$v],jX(n)):t[AM]=n}function gF(t){return vF(t[Ph])}function yF(t){return vF(t[ki])}function vF(t){for(;t!==null&&!Qs(t);)t=t[ki];return t}var OE;function xF(t){OE=t}function GX(){if(OE!==void 0)return OE;if(typeof document<"u")return document;throw new Ie(210,!1)}var Xv=new ke("",{providedIn:"root",factory:()=>WX}),WX="ng",BS=new ke(""),so=new ke("",{providedIn:"platform",factory:()=>"unknown"});var Hh=new ke("",{providedIn:"root",factory:()=>GX().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var HX="h",qX="b";var bF=!1,KX=new ke("",{providedIn:"root",factory:()=>bF});var wF=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(wF||{}),Yv=new ke("");var XX=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=be({token:t,providedIn:"root",factory:()=>new t})}return t})();var YX=()=>null;function CF(t,n,e=!1){return YX(t,n,e)}function _F(t,n){let e=t.contentQueries;if(e!==null){let r=Dt(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=t.data[s];RS(i),a.contentQueries(2,n[s],s)}}}finally{Dt(r)}}}function PE(t,n,e){RS(0);let r=Dt(null);try{n(t,e)}finally{Dt(r)}}function zS(t,n,e){if(SS(n)){let r=Dt(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let s=o;s<i;s++){let a=t.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{Dt(r)}}}var ls=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(ls||{}),X0;function ZX(){if(X0===void 0&&(X0=null,Us.trustedTypes))try{X0=Us.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return X0}function Zv(t){return ZX()?.createHTML(t)||t}var Y0;function QX(){if(Y0===void 0&&(Y0=null,Us.trustedTypes))try{Y0=Us.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return Y0}function RM(t){return QX()?.createScriptURL(t)||t}var qs=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${JM})`}},LE=class extends qs{getTypeName(){return"HTML"}},$E=class extends qs{getTypeName(){return"Style"}},VE=class extends qs{getTypeName(){return"Script"}},BE=class extends qs{getTypeName(){return"URL"}},zE=class extends qs{getTypeName(){return"ResourceURL"}};function Ri(t){return t instanceof qs?t.changingThisBreaksApplicationSecurity:t}function Gl(t,n){let e=JX(t);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${JM})`)}return e===n}function JX(t){return t instanceof qs&&t.getTypeName()||null}function IF(t){return new LE(t)}function EF(t){return new $E(t)}function SF(t){return new VE(t)}function TF(t){return new BE(t)}function DF(t){return new zE(t)}function eY(t){let n=new jE(t);return tY()?new UE(n):n}var UE=class{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{let e=new window.DOMParser().parseFromString(Zv(n),"text/html").body;return e===null?this.inertDocumentHelper.getInertBodyElement(n):(e.firstChild?.remove(),e)}catch{return null}}},jE=class{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){let e=this.inertDocument.createElement("template");return e.innerHTML=Zv(n),e}};function tY(){try{return!!new window.DOMParser().parseFromString(Zv(""),"text/html")}catch{return!1}}var nY=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Qv(t){return t=String(t),t.match(nY)?t:"unsafe:"+t}function ta(t){let n={};for(let e of t.split(","))n[e]=!0;return n}function qh(...t){let n={};for(let e of t)for(let r in e)e.hasOwnProperty(r)&&(n[r]=!0);return n}var NF=ta("area,br,col,hr,img,wbr"),kF=ta("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),AF=ta("rp,rt"),rY=qh(AF,kF),oY=qh(kF,ta("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),iY=qh(AF,ta("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),MM=qh(NF,oY,iY,rY),RF=ta("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),sY=ta("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),aY=ta("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),lY=qh(RF,sY,aY),cY=ta("script,style,template"),GE=class{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let e=n.firstChild,r=!0,o=[];for(;e;){if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild){o.push(e),e=pY(e);continue}for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let i=dY(e);if(i){e=i;break}e=o.pop()}}return this.buf.join("")}startElement(n){let e=FM(n).toLowerCase();if(!MM.hasOwnProperty(e))return this.sanitizedSomething=!0,!cY.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);let r=n.attributes;for(let o=0;o<r.length;o++){let i=r.item(o),s=i.name,a=s.toLowerCase();if(!lY.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let l=i.value;RF[a]&&(l=Qv(l)),this.buf.push(" ",s,'="',OM(l),'"')}return this.buf.push(">"),!0}endElement(n){let e=FM(n).toLowerCase();MM.hasOwnProperty(e)&&!NF.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(OM(n))}};function uY(t,n){return(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function dY(t){let n=t.nextSibling;if(n&&t!==n.previousSibling)throw MF(n);return n}function pY(t){let n=t.firstChild;if(n&&uY(t,n))throw MF(n);return n}function FM(t){let n=t.nodeName;return typeof n=="string"?n:"FORM"}function MF(t){return new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`)}var fY=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,mY=/([^\#-~ |!])/g;function OM(t){return t.replace(/&/g,"&amp;").replace(fY,function(n){let e=n.charCodeAt(0),r=n.charCodeAt(1);return"&#"+((e-55296)*1024+(r-56320)+65536)+";"}).replace(mY,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var Z0;function FF(t,n){let e=null;try{Z0=Z0||eY(t);let r=n?String(n):"";e=Z0.getInertBodyElement(r);let o=5,i=r;do{if(o===0)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=e.innerHTML,e=Z0.getInertBodyElement(r)}while(r!==i);let a=new GE().sanitizeChildren(PM(e)||e);return Zv(a)}finally{if(e){let r=PM(e)||e;for(;r.firstChild;)r.firstChild.remove()}}}function PM(t){return"content"in t&&hY(t)?t.content:null}function hY(t){return t.nodeType===Node.ELEMENT_NODE&&t.nodeName==="TEMPLATE"}var Nr=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(Nr||{});function cs(t){let n=PF();return n?n.sanitize(Nr.URL,t)||"":Gl(t,"URL")?Ri(t):Qv(js(t))}function gY(t){let n=PF();if(n)return RM(n.sanitize(Nr.RESOURCE_URL,t)||"");if(Gl(t,"ResourceURL"))return RM(Ri(t));throw new Ie(904,!1)}function yY(t,n){return n==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||n==="href"&&(t==="base"||t==="link")?gY:cs}function OF(t,n,e){return yY(n,e)(t)}function PF(){let t=dt();return t&&t[Gs].sanitizer}var vY=/^>|^->|<!--|-->|--!>|<!-$/g,xY=/(<|>)/g,bY="\u200B$1\u200B";function wY(t){return t.replace(vY,n=>n.replace(xY,bY))}function LF(t){return t.ownerDocument}function $F(t){return t instanceof Function?t():t}var zl=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(zl||{});function CY(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}var VF="ng-template";function _Y(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&CY(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if(US(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function US(t){return t.type===4&&t.value!==VF}function IY(t,n,e){let r=t.type===4&&!e?VF:t.value;return n===r}function EY(t,n,e){let r=4,o=t.attrs,i=o!==null?DY(o):0,s=!1;for(let a=0;a<n.length;a++){let l=n[a];if(typeof l=="number"){if(!s&&!Di(r)&&!Di(l))return!1;if(s&&Di(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!IY(t,l,e)||l===""&&n.length===1){if(Di(r))return!1;s=!0}}else if(r&8){if(o===null||!_Y(t,o,l,e)){if(Di(r))return!1;s=!0}}else{let c=n[++a],u=SY(l,o,US(t),e);if(u===-1){if(Di(r))return!1;s=!0;continue}if(c!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),r&2&&c!==d){if(Di(r))return!1;s=!0}}}}return Di(r)||s}function Di(t){return(t&1)===0}function SY(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let s=n[o];if(s===t)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=n[++o];for(;typeof a=="string";)a=n[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return NY(n,t)}function BF(t,n,e=!1){for(let r=0;r<n.length;r++)if(EY(t,n[r],e))return!0;return!1}function TY(t){let n=t.attrs;if(n!=null){let e=n.indexOf(5);if(!(e&1))return n[e+1]}return null}function DY(t){for(let n=0;n<t.length;n++){let e=t[n];if(Y2(e))return n}return t.length}function NY(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function kY(t,n){e:for(let e=0;e<n.length;e++){let r=n[e];if(t.length===r.length){for(let o=0;o<t.length;o++)if(t[o]!==r[o])continue e;return!0}}return!1}function LM(t,n){return t?":not("+n.trim()+")":n}function AY(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let s=t[e];if(typeof s=="string")if(r&2){let a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!Di(s)&&(n+=LM(i,o),o=""),r=s,i=i||!Di(r);e++}return o!==""&&(n+=LM(i,o)),n}function RY(t){return t.map(AY).join(",")}function MY(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!Di(o))break;o=i}r++}return e.length&&n.push(1,...e),n}var ao={};function FY(t,n){return t.createText(n)}function OY(t,n,e){t.setValue(n,e)}function PY(t,n){return t.createComment(wY(n))}function zF(t,n,e){return t.createElement(n,e)}function Iv(t,n,e,r,o){t.insertBefore(n,e,r,o)}function UF(t,n,e){t.appendChild(n,e)}function $M(t,n,e,r,o){r!==null?Iv(t,n,e,r,o):UF(t,n,e)}function LY(t,n,e){t.removeChild(null,n,e)}function $Y(t,n,e){t.setAttribute(n,"style",e)}function VY(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function jF(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&gX(t,n,r),o!==null&&VY(t,n,o),i!==null&&$Y(t,n,i)}function O(t=1){GF(Rn(),dt(),Js()+t,!1)}function GF(t,n,e,r){if(!r)if((n[Ye]&3)===3){let i=t.preOrderCheckHooks;i!==null&&nv(n,i,e)}else{let i=t.preOrderHooks;i!==null&&rv(n,i,0,e)}Lu(e)}function ne(t,n=ct.Default){let e=dt();if(e===null)return Me(t,n);let r=jr();return rF(r,e,zr(t),n)}function WF(t,n,e,r,o,i){let s=Dt(null);try{let a=null;o&zl.SignalBased&&(a=n[r][Zr]),a!==null&&a.transformFn!==void 0&&(i=a.transformFn(i)),o&zl.HasDecoratorInputTransform&&(i=t.inputTransforms[r].call(n,i)),t.setInput!==null?t.setInput(n,a,i,e,r):T2(n,a,r,i)}finally{Dt(s)}}function jS(t,n,e,r,o,i,s,a,l,c,u){let d=n.blueprint.slice();return d[Zs]=o,d[Ye]=r|4|128|8|64|1024,(c!==null||t&&t[Ye]&2048)&&(d[Ye]|=2048),M2(d),d[Dr]=d[qp]=t,d[qo]=e,d[Gs]=s||t&&t[Gs],d[En]=a||t&&t[En],d[Oh]=l||t&&t[Oh]||null,d[oo]=i,d[$v]=UX(),d[Fh]=u,d[E2]=c,d[Ko]=n.type==2?t[Ko]:d,d}function HF(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function qF(t,n,e,r,o){let i=Js(),s=r&2;try{Lu(-1),s&&n.length>ro&&GF(t,n,ro,!1),Ho(s?2:0,o),e(r,o)}finally{Lu(i),Ho(s?3:1,o)}}function GS(t,n,e){L2()&&(Wu(Ai(e,n),n),KF(t,n,e))}function KF(t,n,e){YY(t,n,e),(e.flags&64)===64&&ZY(t,n,e)}function WS(t,n,e=Ai){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(n,t):t[s];t[o++]=a}}}function BY(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=HS(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function HS(t,n,e,r,o,i,s,a,l,c,u){let d=ro+r,p=d+o,f=zY(d,p),m=typeof c=="function"?c():c;return f[ht]={type:t,blueprint:f,template:e,queries:null,viewQuery:a,declTNode:n,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:m,incompleteFirstPass:!1,ssrId:u}}function zY(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:ao);return e}function UY(t,n,e,r){let i=r.get(KX,bF)||e===ls.ShadowDom,s=t.selectRootElement(n,i);return jY(s),s}function jY(t){GY(t)}var GY=()=>null;function VM(t,n,e,r,o){for(let i in n){if(!n.hasOwnProperty(i))continue;let s=n[i];if(s===void 0)continue;r??={};let a,l=zl.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}t===0?BM(r,e,c,a,l):BM(r,e,c,a)}return r}function BM(t,n,e,r,o){let i;t.hasOwnProperty(e)?(i=t[e]).push(n,r):i=t[e]=[n,r],o!==void 0&&i.push(o)}function WY(t,n,e){let r=n.directiveStart,o=n.directiveEnd,i=t.data,s=n.attrs,a=[],l=null,c=null;for(let u=r;u<o;u++){let d=i[u],p=e?e.get(d):null,f=p?p.inputs:null,m=p?p.outputs:null;l=VM(0,d.inputs,u,l,f),c=VM(1,d.outputs,u,c,m);let h=l!==null&&s!==null&&!US(n)?uZ(l,u,s):null;a.push(h)}l!==null&&(l.hasOwnProperty("class")&&(n.flags|=8),l.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=a,n.inputs=l,n.outputs=c}function HY(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function qS(t,n,e,r,o,i,s,a){let l=Ai(n,e),c=n.inputs,u;!a&&c!=null&&(u=c[r])?(YS(t,e,u,r,o),ju(n)&&qY(e,n.index)):n.type&3?(r=HY(r),o=s!=null?s(o,n.value||"",r):o,i.setProperty(l,r,o)):n.type&12}function qY(t,n){let e=as(n,t);e[Ye]&16||(e[Ye]|=64)}function KS(t,n,e,r){if(L2()){let o=r===null?null:{"":-1},i=JY(t,e);if(i!==null){let[s,a]=YF(t,e,i);XF(t,n,e,s,o,a)}o&&tZ(e,r,o)}e.mergedAttrs=Up(e.mergedAttrs,e.attrs)}function XF(t,n,e,r,o,i){for(let c=0;c<r.length;c++)kE(vv(e,n),t,r[c].type);rZ(e,t.data.length,r.length);for(let c=0;c<r.length;c++){let u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=HF(t,n,r.length,null);for(let c=0;c<r.length;c++){let u=r[c];e.mergedAttrs=Up(e.mergedAttrs,u.hostAttrs),oZ(t,e,n,l,u),nZ(l,u,o),u.contentQueries!==null&&(e.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(e.flags|=64);let d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),l++}WY(t,e,i)}function KY(t,n,e,r,o){let i=o.hostBindings;if(i){let s=t.hostBindingOpCodes;s===null&&(s=t.hostBindingOpCodes=[]);let a=~n.index;XY(s)!=a&&s.push(a),s.push(e,r,i)}}function XY(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function YY(t,n,e){let r=e.directiveStart,o=e.directiveEnd;ju(e)&&sZ(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||vv(e,n);let i=e.initialInputs;for(let s=r;s<o;s++){let a=t.data[s],l=Lh(n,t,s,e);if(Wu(l,n),i!==null&&cZ(n,s-r,l,a,e,i),Hs(a)){let c=as(e.index,n);c[qo]=Lh(n,t,s,e)}}}function ZY(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=sX();try{Lu(i);for(let a=r;a<o;a++){let l=t.data[a],c=n[a];TE(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&QY(l,c)}}finally{Lu(-1),TE(s)}}function QY(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function JY(t,n){let e=t.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];BF(n,i.selectors,!1)&&(r??=[],Hs(i)?r.unshift(i):r.push(i))}return r}function YF(t,n,e){let r=[],o=null;for(let i of e)i.findHostDirectiveDefs!==null&&(o??=new Map,i.findHostDirectiveDefs(i,r,o)),Hs(i)&&(r.push(i),eZ(t,n,r.length-1));return ju(n)?r.push(...e.slice(1)):r.push(...e),[r,o]}function eZ(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function tZ(t,n,e){if(n){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new Ie(-301,!1);r.push(n[o],i)}}}function nZ(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;Hs(n)&&(e[""]=t)}}function rZ(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function oZ(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=Au(o.type,!0)),s=new $u(i,Hs(o),ne);t.blueprint[r]=s,e[r]=s,KY(t,n,r,HF(t,e,o.hostVars,ao),o)}function iZ(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function sZ(t,n,e){let r=Ai(n,t),o=BY(e),i=t[Gs].rendererFactory,s=XS(t,jS(t,o,null,iZ(e),r,n,null,i.createRenderer(r,e),null,null,null));return t[n.index]=s}function aZ(t,n,e,r,o,i){let s=Ai(t,n);lZ(n[En],s,i,t.value,e,r,o)}function lZ(t,n,e,r,o,i,s){if(i==null)t.removeAttribute(n,o,e);else{let a=s==null?js(i):s(i,r||"",o);t.setAttribute(n,o,a,e)}}function cZ(t,n,e,r,o,i){let s=i[n];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],u=s[a++],d=s[a++];WF(r,e,l,c,u,d)}}function uZ(t,n,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(t.hasOwnProperty(i)){r===null&&(r=[]);let s=t[i];for(let a=0;a<s.length;a+=3)if(s[a]===n){r.push(i,s[a+1],s[a+2],e[o+1]);break}}o+=2}return r}function ZF(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function XS(t,n){return t[Ph]?t[xM][ki]=n:t[Ph]=n,t[xM]=n,n}function QF(t,n){let e=t[Oh],r=e?e.get(To,null):null;r&&r.handleError(n)}function YS(t,n,e,r,o){for(let i=0;i<e.length;){let s=e[i++],a=e[i++],l=e[i++],c=n[s],u=t.data[s];WF(u,c,r,a,l,o)}}function dZ(t,n){let e=as(n,t),r=e[ht];pZ(r,e);let o=e[Zs];o!==null&&e[Fh]===null&&(e[Fh]=CF(o,e[Oh])),ZS(r,e,e[qo])}function pZ(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function ZS(t,n,e){MS(n);try{let r=t.viewQuery;r!==null&&PE(1,r,e);let o=t.template;o!==null&&qF(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[Ws]?.finishViewCreation(t),t.staticContentQueries&&_F(t,n),t.staticViewQueries&&PE(2,t.viewQuery,e);let i=t.components;i!==null&&fZ(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Ye]&=-5,FS()}}function fZ(t,n){for(let e=0;e<n.length;e++)dZ(t,n[e])}var Ks=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(Ks||{}),mZ;function QS(t,n){return mZ(t,n)}function JS(t){return(t.flags&32)===32}function Fp(t,n,e,r,o){if(r!=null){let i,s=!1;Qs(r)?i=r:Bl(r)&&(s=!0,r=r[Zs]);let a=ss(r);t===0&&e!==null?o==null?UF(n,e,a):Iv(n,e,a,o||null,!0):t===1&&e!==null?Iv(n,e,a,o||null,!0):t===2?LY(n,a,s):t===3&&n.destroyNode(a),i!=null&&EZ(n,t,i,e,o)}}function hZ(t,n){JF(t,n),n[Zs]=null,n[oo]=null}function gZ(t,n,e,r,o,i){r[Zs]=o,r[oo]=n,ex(t,r,e,1,o,i)}function JF(t,n){n[Gs].changeDetectionScheduler?.notify(10),ex(t,n,n[En],2,null,null)}function yZ(t){let n=t[Ph];if(!n)return uE(t[ht],t);for(;n;){let e=null;if(Bl(n))e=n[Ph];else{let r=n[So];r&&(e=r)}if(!e){for(;n&&!n[ki]&&n!==t;)Bl(n)&&uE(n[ht],n),n=n[Dr];n===null&&(n=t),Bl(n)&&uE(n[ht],n),e=n&&n[ki]}n=e}}function vZ(t,n,e,r){let o=So+r,i=e.length;r>0&&(e[o-1][ki]=n),r<i-So?(n[ki]=e[o],p2(e,So+r,n)):(e.push(n),n[ki]=null),n[Dr]=e;let s=n[Mu];s!==null&&e!==s&&eO(s,n);let a=n[Ws];a!==null&&a.insertView(t),EE(n),n[Ye]|=128}function eO(t,n){let e=t[Bp],r=n[Dr];if(Bl(r))t[Ye]|=2;else{let o=r[Dr][Ko];n[Ko]!==o&&(t[Ye]|=2)}e===null?t[Bp]=[n]:e.push(n)}function e1(t,n){let e=t[Bp],r=e.indexOf(n);e.splice(r,1)}function WE(t,n){if(t.length<=So)return;let e=So+n,r=t[e];if(r){let o=r[Mu];o!==null&&o!==t&&e1(o,r),n>0&&(t[e-1][ki]=r[ki]);let i=cv(t,So+n);hZ(r[ht],r);let s=i[Ws];s!==null&&s.detachView(i[ht]),r[Dr]=null,r[ki]=null,r[Ye]&=-129}return r}function tO(t,n){if(Gh(n))return;let e=n[En];e.destroyNode&&ex(t,n,e,3,null,null),yZ(n)}function uE(t,n){if(Gh(n))return;let e=Dt(null);try{n[Ye]&=-129,n[Ye]|=256,n[Eo]&&Cp(n[Eo]),bZ(t,n),xZ(t,n),n[ht].type===1&&n[En].destroy();let r=n[Mu];if(r!==null&&Qs(n[Dr])){r!==n[Dr]&&e1(r,n);let o=n[Ws];o!==null&&o.detachView(t)}FE(n)}finally{Dt(e)}}function xZ(t,n){let e=t.cleanup,r=n[dv];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(n[dv]=null);let o=n[Vl];if(o!==null){n[Vl]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=n[Fu];if(i!==null){n[Fu]=null;for(let s of i)s.destroy()}}function bZ(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof $u)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];Ho(4,a,l);try{l.call(a)}finally{Ho(5,a,l)}}else{Ho(4,o,i);try{i.call(o)}finally{Ho(5,o,i)}}}}}function nO(t,n,e){return wZ(t,n.parent,e)}function wZ(t,n,e){let r=n;for(;r!==null&&r.type&168;)n=r,r=n.parent;if(r===null)return e[Zs];if(ju(r)){let{encapsulation:o}=t.data[r.directiveStart+r.componentOffset];if(o===ls.None||o===ls.Emulated)return null}return Ai(r,e)}function rO(t,n,e){return _Z(t,n,e)}function CZ(t,n,e){return t.type&40?Ai(t,e):null}var _Z=CZ,zM;function Jv(t,n,e,r){let o=nO(t,r,n),i=n[En],s=r.parent||n[oo],a=rO(s,r,n);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)$M(i,o,e[l],a,!1);else $M(i,o,e,a,!1);zM!==void 0&&zM(i,r,n,e,o)}function kh(t,n){if(n!==null){let e=n.type;if(e&3)return Ai(n,t);if(e&4)return HE(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return kh(t,r);{let o=t[n.index];return Qs(o)?HE(-1,o):ss(o)}}else{if(e&128)return kh(t,n.next);if(e&32)return QS(n,t)()||ss(t[n.index]);{let r=oO(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=Pu(t[Ko]);return kh(o,r)}else return kh(t,n.next)}}}return null}function oO(t,n){if(n!==null){let r=t[Ko][oo],o=n.projection;return r.projection[o]}return null}function HE(t,n){let e=So+t+1;if(e<n.length){let r=n[e],o=r[ht].firstChild;if(o!==null)return kh(r,o)}return n[Ou]}function t1(t,n,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&n===0&&(a&&Wu(ss(a),r),e.flags|=2),!JS(e))if(l&8)t1(t,n,e.child,r,o,i,!1),Fp(n,t,o,a,i);else if(l&32){let c=QS(e,r),u;for(;u=c();)Fp(n,t,o,u,i);Fp(n,t,o,a,i)}else l&16?iO(t,n,r,e,o,i):Fp(n,t,o,a,i);e=s?e.projectionNext:e.next}}function ex(t,n,e,r,o,i){t1(e,r,t.firstChild,n,o,i,!1)}function IZ(t,n,e){let r=n[En],o=nO(t,e,n),i=e.parent||n[oo],s=rO(i,e,n);iO(r,0,n,e,o,s)}function iO(t,n,e,r,o,i){let s=e[Ko],l=s[oo].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];Fp(n,t,o,u,i)}else{let c=l,u=s[Dr];fF(r)&&(c.flags|=128),t1(t,n,c,u,o,i,!0)}}function EZ(t,n,e,r,o){let i=e[Ou],s=ss(e);i!==s&&Fp(n,t,r,i,o);for(let a=So;a<e.length;a++){let l=e[a];ex(l[ht],l,t,n,r,i)}}function SZ(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:Ks.DashCase;o==null?t.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=Ks.Important),t.setStyle(e,r,o,i))}}function sO(t,n,e,r){let o=Dt(null);try{let i=n.tView,a=t[Ye]&4096?4096:16,l=jS(t,i,e,a,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=t[n.index];l[Mu]=c;let u=t[Ws];return u!==null&&(l[Ws]=u.createEmbeddedView(i)),ZS(i,l,e),l}finally{Dt(o)}}function qE(t,n){return!n||n.firstChild===null||fF(t)}function aO(t,n,e,r=!0){let o=n[ht];if(vZ(o,n,t,e),r){let s=HE(e,t),a=n[En],l=a.parentNode(t[Ou]);l!==null&&gZ(o,t[oo],a,n,l,s)}let i=n[Fh];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function Ev(t,n,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=n[e.index];i!==null&&r.push(ss(i)),Qs(i)&&TZ(i,r);let s=e.type;if(s&8)Ev(t,n,e.child,r);else if(s&32){let a=QS(e,n),l;for(;l=a();)r.push(l)}else if(s&16){let a=oO(n,e);if(Array.isArray(a))r.push(...a);else{let l=Pu(n[Ko]);Ev(l[ht],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function TZ(t,n){for(let e=So;e<t.length;e++){let r=t[e],o=r[ht].firstChild;o!==null&&Ev(r[ht],r,o,n)}t[Ou]!==t[Zs]&&n.push(t[Ou])}var lO=[];function DZ(t){return t[Eo]??NZ(t)}function NZ(t){let n=lO.pop()??Object.create(AZ);return n.lView=t,n}function kZ(t){t.lView[Eo]!==t&&(t.lView=null,lO.push(t))}var AZ=Ue(me({},Iu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{Wh(t.lView)},consumerOnSignalRead(){this.lView[Eo]=this}});function RZ(t){let n=t[Eo]??Object.create(MZ);return n.lView=t,n}var MZ=Ue(me({},Iu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=Pu(t.lView);for(;n&&!cO(n[ht]);)n=Pu(n);n&&DS(n)},consumerOnSignalRead(){this.lView[Eo]=this}});function cO(t){return t.type!==2}function uO(t){if(t[Fu]===null)return;let n=!0;for(;n;){let e=!1;for(let r of t[Fu])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));n=e&&!!(t[Ye]&8192)}}var FZ=100;function dO(t,n=!0,e=0){let o=t[Gs].rendererFactory,i=!1;i||o.begin?.();try{OZ(t,e)}catch(s){throw n&&QF(t,s),s}finally{i||o.end?.()}}function OZ(t,n){let e=B2();try{mv(!0),KE(t,n);let r=0;for(;Bv(t);){if(r===FZ)throw new Ie(103,!1);r++,KE(t,1)}}finally{mv(e)}}function PZ(t,n,e,r){if(Gh(n))return;let o=n[Ye],i=!1,s=!1;MS(n);let a=!0,l=null,c=null;i||(cO(t)?(c=DZ(n),l=wp(c)):DR()===null?(a=!1,c=RZ(n),l=wp(c)):n[Eo]&&(Cp(n[Eo]),n[Eo]=null));try{M2(n),rX(t.bindingStartIndex),e!==null&&qF(t,n,e,2,r);let u=(o&3)===3;if(!i)if(u){let f=t.preOrderCheckHooks;f!==null&&nv(n,f,null)}else{let f=t.preOrderHooks;f!==null&&rv(n,f,0,null),aE(n,0)}if(s||LZ(n),uO(n),pO(n,0),t.contentQueries!==null&&_F(t,n),!i)if(u){let f=t.contentCheckHooks;f!==null&&nv(n,f)}else{let f=t.contentHooks;f!==null&&rv(n,f,1),aE(n,1)}VZ(t,n);let d=t.components;d!==null&&mO(n,d,0);let p=t.viewQuery;if(p!==null&&PE(2,p,r),!i)if(u){let f=t.viewCheckHooks;f!==null&&nv(n,f)}else{let f=t.viewHooks;f!==null&&rv(n,f,2),aE(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[tv]){for(let f of n[tv])f();n[tv]=null}i||(n[Ye]&=-73)}catch(u){throw i||Wh(n),u}finally{c!==null&&(wh(c,l),a&&kZ(c)),FS()}}function pO(t,n){for(let e=gF(t);e!==null;e=yF(e))for(let r=So;r<e.length;r++){let o=e[r];fO(o,n)}}function LZ(t){for(let n=gF(t);n!==null;n=yF(n)){if(!(n[Ye]&2))continue;let e=n[Bp];for(let r=0;r<e.length;r++){let o=e[r];DS(o)}}}function $Z(t,n,e){let r=as(n,t);fO(r,e)}function fO(t,n){TS(t)&&KE(t,n)}function KE(t,n){let r=t[ht],o=t[Ye],i=t[Eo],s=!!(n===0&&o&16);if(s||=!!(o&64&&n===0),s||=!!(o&1024),s||=!!(i?.dirty&&Ch(i)),s||=!1,i&&(i.dirty=!1),t[Ye]&=-9217,s)PZ(r,t,r.template,t[qo]);else if(o&8192){uO(t),pO(t,1);let a=r.components;a!==null&&mO(t,a,1)}}function mO(t,n,e){for(let r=0;r<n.length;r++)$Z(t,n[r],e)}function VZ(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)Lu(~o);else{let i=o,s=e[++r],a=e[++r];iX(s,i);let l=n[i];Ho(24,l),a(2,l),Ho(25,l)}}}finally{Lu(-1)}}function n1(t,n){let e=B2()?64:1088;for(t[Gs].changeDetectionScheduler?.notify(n);t;){t[Ye]|=e;let r=Pu(t);if(fv(t)&&!r)return t;t=r}return null}var Bu=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let n=this._lView,e=n[ht];return Ev(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[qo]}get dirty(){return!!(this._lView[Ye]&9280)||!!this._lView[Eo]?.dirty}set context(n){this._lView[qo]=n}get destroyed(){return Gh(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Dr];if(Qs(n)){let e=n[pv],r=e?e.indexOf(this):-1;r>-1&&(WE(n,r),cv(e,r))}this._attachedToViewContainer=!1}tO(this._lView[ht],this._lView)}onDestroy(n){F2(this._lView,n)}markForCheck(){n1(this._cdRefInjectingView||this._lView,4)}markForRefresh(){DS(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ye]&=-129}reattach(){EE(this._lView),this._lView[Ye]|=128}detectChanges(){this._lView[Ye]|=1024,dO(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ie(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=fv(this._lView),e=this._lView[Mu];e!==null&&!n&&e1(e,this._lView),JF(this._lView[ht],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Ie(902,!1);this._appRef=n;let e=fv(this._lView),r=this._lView[Mu];r!==null&&!e&&eO(r,this._lView),EE(this._lView)}},zu=(()=>{class t{static __NG_ELEMENT_ID__=UZ}return t})(),BZ=zu,zZ=class extends BZ{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=sO(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new Bu(o)}};function UZ(){return r1(jr(),dt())}function r1(t,n){return t.type&4?new zZ(n,t,Xp(t,n)):null}function Yp(t,n,e,r,o){let i=t.data[n];if(i===null)i=jZ(t,n,e,r,o),oX()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=nX();i.injectorIndex=s===null?-1:s.injectorIndex}return Gu(i,!0),i}function jZ(t,n,e,r,o){let i=V2(),s=NS(),a=s?i:i&&i.parent,l=t.data[n]=WZ(t,a,e,n,r,o);return GZ(t,l,i,s),l}function GZ(t,n,e,r){t.firstChild===null&&(t.firstChild=n),e!==null&&(r?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function WZ(t,n,e,r,o,i){let s=n?n.injectorIndex:-1,a=0;return $2()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var PDe=new RegExp(`^(\\d+)*(${qX}|${HX})*(.*)`);var HZ=()=>null;function XE(t,n){return HZ(t,n)}var YE=class{},Sv=class{},ZE=class{resolveComponentFactory(n){throw Error(`No component factory found for ${Ur(n)}.`)}},jp=class{static NULL=new ZE},Gp=class{},Mi=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>qZ()}return t})();function qZ(){let t=dt(),n=jr(),e=as(n.index,t);return(Bl(e)?e:t)[En]}var KZ=(()=>{class t{static \u0275prov=be({token:t,providedIn:"root",factory:()=>null})}return t})();function Tv(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let s=0;s<n.length;s++){let a=n[s];if(typeof a=="number")i=a;else if(i==1)o=yE(o,a);else if(i==2){let l=a,c=n[++s];r=yE(r,l+": "+c+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}var Dv=class extends jp{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=Ru(n);return new Vh(e,this.ngModule)}};function UM(t,n){let e=[];for(let r in t){if(!t.hasOwnProperty(r))continue;let o=t[r];if(o===void 0)continue;let i=Array.isArray(o),s=i?o[0]:o,a=i?o[1]:zl.None;n?e.push({propName:s,templateName:r,isSignal:(a&zl.SignalBased)!==0}):e.push({propName:s,templateName:r})}return e}function XZ(t){let n=t.toLowerCase();return n==="svg"?j7:n==="math"?G7:null}var Vh=class extends Sv{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let n=this.componentDef,e=n.inputTransforms,r=UM(n.inputs,!0);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return UM(this.componentDef.outputs,!1)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=RY(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,r,o){let i=Dt(null);try{o=o||this.ngModule;let s=o instanceof no?o:o?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new DE(n,s):n,l=a.get(Gp,null);if(l===null)throw new Ie(407,!1);let c=a.get(KZ,null),u=a.get(Vu,null),d={rendererFactory:l,sanitizer:c,changeDetectionScheduler:u},p=l.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",m=r?UY(p,r,this.componentDef.encapsulation,a):zF(p,f,XZ(f)),h=512;this.componentDef.signals?h|=4096:this.componentDef.onPush||(h|=16);let g=null;m!==null&&(g=CF(m,a,!0));let x=HS(0,null,null,1,0,null,null,null,null,null,null),b=jS(null,x,null,h,null,null,d,p,a,null,g);b[ro]=m,MS(b);let I=null;try{let _=r?["ng-version","19.1.4"]:MY(this.componentDef.selectors[0]),E=Yp(x,ro,2,"#host",_),[S,D]=YF(x,E,[this.componentDef]);XF(x,b,E,S,{},D);for(let M of S)E.mergedAttrs=Up(E.mergedAttrs,M.hostAttrs);E.mergedAttrs=Up(E.mergedAttrs,_),Tv(E,E.mergedAttrs,!0),m&&(jF(p,m,E),Wu(m,b)),e!==void 0&&YZ(E,this.ngContentSelectors,e),KF(x,b,E),zS(x,E,b),Hv(x,E),I=as(E.index,b),b[qo]=I[qo],ZS(x,b,null)}catch(_){throw I!==null&&FE(I),FE(b),_}finally{FS()}return new QE(this.componentType,b)}finally{Dt(i)}}},QE=class extends YE{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=R2(e[ht],ro),this.location=Xp(this._tNode,e),this.instance=as(this._tNode.index,e)[qo],this.hostView=this.changeDetectorRef=new Bu(e,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let i=this._rootLView;YS(i[ht],i,o,n,e),this.previousInputValues.set(n,e);let s=as(this._tNode.index,i);n1(s,1)}}get injector(){return new ku(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function YZ(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var Wl=(()=>{class t{static __NG_ELEMENT_ID__=ZZ}return t})();function ZZ(){let t=jr();return gO(t,dt())}var QZ=Wl,hO=class extends QZ{_lContainer;_hostTNode;_hostLView;constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return Xp(this._hostTNode,this._hostLView)}get injector(){return new ku(this._hostTNode,this._hostLView)}get parentInjector(){let n=OS(this._hostTNode,this._hostLView);if(Z2(n)){let e=gv(n,this._hostLView),r=hv(n),o=e[ht].data[r+8];return new ku(o,e)}else return new ku(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=jM(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-So}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=XE(this._lContainer,n.ssrId),a=n.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,qE(this._hostTNode,s)),a}createComponent(n,e,r,o,i){let s=n&&!V7(n),a;if(s)a=e;else{let m=e||{};a=m.index,r=m.injector,o=m.projectableNodes,i=m.environmentInjector||m.ngModuleRef}let l=s?n:new Vh(Ru(n)),c=r||this.parentInjector;if(!i&&l.ngModule==null){let h=(s?c:this.parentInjector).get(no,null);h&&(i=h)}let u=Ru(l.componentType??{}),d=XE(this._lContainer,u?.id??null),p=d?.firstChild??null,f=l.create(c,o,p,i);return this.insertImpl(f.hostView,a,qE(this._hostTNode,d)),f}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(q7(o)){let a=this.indexOf(n);if(a!==-1)this.detach(a);else{let l=o[Dr],c=new hO(l,l[oo],l[Dr]);c.detach(c.indexOf(n))}}let i=this._adjustIndex(e),s=this._lContainer;return aO(s,o,i,r),n.attachToViewContainerRef(),p2(dE(s),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=jM(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=WE(this._lContainer,e);r&&(cv(dE(this._lContainer),e),tO(r[ht],r))}detach(n){let e=this._adjustIndex(n,-1),r=WE(this._lContainer,e);return r&&cv(dE(this._lContainer),e)!=null?new Bu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function jM(t){return t[pv]}function dE(t){return t[pv]||(t[pv]=[])}function gO(t,n){let e,r=n[t.index];return Qs(r)?e=r:(e=ZF(r,n,null,t),n[t.index]=e,XS(n,e)),eQ(e,n,t,r),new hO(e,t,n)}function JZ(t,n){let e=t[En],r=e.createComment(""),o=Ai(n,t),i=e.parentNode(o);return Iv(e,i,r,e.nextSibling(o),!1),r}var eQ=rQ,tQ=()=>!1;function nQ(t,n,e){return tQ(t,n,e)}function rQ(t,n,e,r){if(t[Ou])return;let o;e.type&8?o=ss(r):o=JZ(n,e),t[Ou]=o}var JE=class t{queryList;matches=null;constructor(n){this.queryList=n}clone(){return new t(this.queryList)}setDirty(){this.queryList.setDirty()}},eS=class t{queries;constructor(n=[]){this.queries=n}createEmbeddedView(n){let e=n.queries;if(e!==null){let r=n.contentQueries!==null?n.contentQueries[0]:e.length,o=[];for(let i=0;i<r;i++){let s=e.getByIndex(i),a=this.queries[s.indexInDeclarationView];o.push(a.clone())}return new t(o)}return null}insertView(n){this.dirtyQueriesWithMatches(n)}detachView(n){this.dirtyQueriesWithMatches(n)}finishViewCreation(n){this.dirtyQueriesWithMatches(n)}dirtyQueriesWithMatches(n){for(let e=0;e<this.queries.length;e++)o1(n,e).matches!==null&&this.queries[e].setDirty()}},tS=class{flags;read;predicate;constructor(n,e,r=null){this.flags=e,this.read=r,typeof n=="string"?this.predicate=dQ(n):this.predicate=n}},nS=class t{queries;constructor(n=[]){this.queries=n}elementStart(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].elementStart(n,e)}elementEnd(n){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(n)}embeddedTView(n){let e=null;for(let r=0;r<this.length;r++){let o=e!==null?e.length:0,i=this.getByIndex(r).embeddedTView(n,o);i&&(i.indexInDeclarationView=r,e!==null?e.push(i):e=[i])}return e!==null?new t(e):null}template(n,e){for(let r=0;r<this.queries.length;r++)this.queries[r].template(n,e)}getByIndex(n){return this.queries[n]}get length(){return this.queries.length}track(n){this.queries.push(n)}},rS=class t{metadata;matches=null;indexInDeclarationView=-1;crossesNgTemplate=!1;_declarationNodeIndex;_appliesToNextNode=!0;constructor(n,e=-1){this.metadata=n,this._declarationNodeIndex=e}elementStart(n,e){this.isApplyingToNode(e)&&this.matchTNode(n,e)}elementEnd(n){this._declarationNodeIndex===n.index&&(this._appliesToNextNode=!1)}template(n,e){this.elementStart(n,e)}embeddedTView(n,e){return this.isApplyingToNode(n)?(this.crossesNgTemplate=!0,this.addMatch(-n.index,e),new t(this.metadata)):null}isApplyingToNode(n){if(this._appliesToNextNode&&(this.metadata.flags&1)!==1){let e=this._declarationNodeIndex,r=n.parent;for(;r!==null&&r.type&8&&r.index!==e;)r=r.parent;return e===(r!==null?r.index:-1)}return this._appliesToNextNode}matchTNode(n,e){let r=this.metadata.predicate;if(Array.isArray(r))for(let o=0;o<r.length;o++){let i=r[o];this.matchTNodeWithReadOption(n,e,oQ(e,i)),this.matchTNodeWithReadOption(n,e,ov(e,n,i,!1,!1))}else r===zu?e.type&4&&this.matchTNodeWithReadOption(n,e,-1):this.matchTNodeWithReadOption(n,e,ov(e,n,r,!1,!1))}matchTNodeWithReadOption(n,e,r){if(r!==null){let o=this.metadata.read;if(o!==null)if(o===Yn||o===Wl||o===zu&&e.type&4)this.addMatch(e.index,-2);else{let i=ov(e,n,o,!1,!1);i!==null&&this.addMatch(e.index,i)}else this.addMatch(e.index,r)}}addMatch(n,e){this.matches===null?this.matches=[n,e]:this.matches.push(n,e)}};function oQ(t,n){let e=t.localNames;if(e!==null){for(let r=0;r<e.length;r+=2)if(e[r]===n)return e[r+1]}return null}function iQ(t,n){return t.type&11?Xp(t,n):t.type&4?r1(t,n):null}function sQ(t,n,e,r){return e===-1?iQ(n,t):e===-2?aQ(t,n,r):Lh(t,t[ht],e,n)}function aQ(t,n,e){if(e===Yn)return Xp(n,t);if(e===zu)return r1(n,t);if(e===Wl)return gO(n,t)}function yO(t,n,e,r){let o=n[Ws].queries[r];if(o.matches===null){let i=t.data,s=e.matches,a=[];for(let l=0;s!==null&&l<s.length;l+=2){let c=s[l];if(c<0)a.push(null);else{let u=i[c];a.push(sQ(n,u,s[l+1],e.metadata.read))}}o.matches=a}return o.matches}function oS(t,n,e,r){let o=t.queries.getByIndex(e),i=o.matches;if(i!==null){let s=yO(t,n,o,e);for(let a=0;a<i.length;a+=2){let l=i[a];if(l>0)r.push(s[a/2]);else{let c=i[a+1],u=n[-l];for(let d=So;d<u.length;d++){let p=u[d];p[Mu]===p[Dr]&&oS(p[ht],p,c,r)}if(u[Bp]!==null){let d=u[Bp];for(let p=0;p<d.length;p++){let f=d[p];oS(f[ht],f,c,r)}}}}}return r}function lQ(t,n){return t[Ws].queries[n].queryList}function cQ(t,n,e){let r=new _v((e&4)===4);return Y7(t,n,r,r.destroy),(n[Ws]??=new eS).queries.push(new JE(r))-1}function uQ(t,n,e){let r=Rn();return r.firstCreatePass&&(pQ(r,new tS(t,n,e),-1),(n&2)===2&&(r.staticViewQueries=!0)),cQ(r,dt(),n)}function dQ(t){return t.split(",").map(n=>n.trim())}function pQ(t,n,e){t.queries===null&&(t.queries=new nS),t.queries.track(new rS(n,e))}function o1(t,n){return t.queries.getByIndex(n)}function fQ(t,n){let e=t[ht],r=o1(e,n);return r.crossesNgTemplate?oS(e,t,n,[]):yO(e,t,r,n)}var Ul=class{},Bh=class{};var iS=class extends Ul{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Dv(this);constructor(n,e,r,o=!0){super(),this.ngModuleType=n,this._parent=e;let i=h2(n);this._bootstrapComponents=$F(i.bootstrap),this._r3Injector=sF(n,e,[{provide:Ul,useValue:this},{provide:jp,useValue:this.componentFactoryResolver},...r],Ur(n),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},sS=class extends Bh{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new iS(this.moduleType,n,[])}};var Nv=class extends Ul{injector;componentFactoryResolver=new Dv(this);instance=null;constructor(n){super();let e=new Mh([...n.providers,{provide:Ul,useValue:this},{provide:jp,useValue:this.componentFactoryResolver}],n.parent||ES(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function i1(t,n,e=null){return new Nv({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var mQ=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=x2(!1,e.type),o=r.length>0?i1([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=be({token:t,providedIn:"environment",factory:()=>new t(Me(no))})}return t})();function it(t){return Uh(()=>{let n=xO(t),e=Ue(me({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===mF.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?o=>o.get(mQ).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||ls.Emulated,styles:t.styles||to,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&jl("NgStandalone"),bO(e);let r=t.dependencies;return e.directiveDefs=WM(r,!1),e.pipeDefs=WM(r,!0),e.id=yQ(e),e})}function hQ(t){return Ru(t)||g2(t)}function gQ(t){return t!==null}function or(t){return Uh(()=>({type:t.type,bootstrap:t.bootstrap||to,declarations:t.declarations||to,imports:t.imports||to,exports:t.exports||to,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function GM(t,n){if(t==null)return Lp;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,s,a=zl.None;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i):(i=o,s=o),n?(e[i]=a!==zl.None?[r,a]:r,n[i]=s):e[i]=r}return e}function Nt(t){return Uh(()=>{let n=xO(t);return bO(n),n})}function vO(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function xO(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||Lp,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||to,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:GM(t.inputs,n),outputs:GM(t.outputs),debugInfo:null}}function bO(t){t.features?.forEach(n=>n(t))}function WM(t,n){if(!t)return null;let e=n?y2:hQ;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(gQ)}function yQ(t){let n=0,e=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,e,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let i of r.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function vQ(t){return Object.getPrototypeOf(t.prototype).constructor}function Ln(t){let n=vQ(t.type),e=!0,r=[t];for(;n;){let o;if(Hs(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Ie(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);let s=t;s.inputs=Q0(t.inputs),s.inputTransforms=Q0(t.inputTransforms),s.declaredInputs=Q0(t.declaredInputs),s.outputs=Q0(t.outputs);let a=o.hostBindings;a&&_Q(t,a);let l=o.viewQuery,c=o.contentQueries;if(l&&wQ(t,l),c&&CQ(t,c),xQ(t,o),o7(t.outputs,o.outputs),Hs(o)&&o.data.animation){let u=t.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(t),a===Ln&&(e=!1)}}n=Object.getPrototypeOf(n)}bQ(r)}function xQ(t,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;let r=n.inputs[e];if(r!==void 0&&(t.inputs[e]=r,t.declaredInputs[e]=n.declaredInputs[e],n.inputTransforms!==null)){let o=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(o))continue;t.inputTransforms??={},t.inputTransforms[o]=n.inputTransforms[o]}}}function bQ(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){let o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=Up(o.hostAttrs,e=Up(e,o.hostAttrs))}}function Q0(t){return t===Lp?{}:t===to?[]:t}function wQ(t,n){let e=t.viewQuery;e?t.viewQuery=(r,o)=>{n(r,o),e(r,o)}:t.viewQuery=n}function CQ(t,n){let e=t.contentQueries;e?t.contentQueries=(r,o,i)=>{n(r,o,i),e(r,o,i)}:t.contentQueries=n}function _Q(t,n){let e=t.hostBindings;e?t.hostBindings=(r,o)=>{n(r,o),e(r,o)}:t.hostBindings=n}function Hu(t){let n=t.inputConfig,e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r];Array.isArray(o)&&o[3]&&(e[r]=o[3])}t.inputTransforms=e}function wO(t){return EQ(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function IQ(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{let e=t[Symbol.iterator](),r;for(;!(r=e.next()).done;)n(r.value)}}function EQ(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function CO(t,n,e){return t[n]=e}function Xs(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function s1(t,n,e,r){let o=Xs(t,n,e);return Xs(t,n+1,r)||o}function _O(t,n,e,r,o){let i=s1(t,n,e,r);return Xs(t,n+2,o)||i}function SQ(t,n,e,r,o,i,s,a,l){let c=n.consts,u=Yp(n,t,4,s||null,a||null);KS(n,e,u,zp(c,l)),Hv(n,u);let d=u.tView=HS(2,u,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return n.queries!==null&&(n.queries.template(n,u),d.queries=n.queries.embeddedTView(u)),u}function IO(t,n,e,r,o,i,s,a,l,c){let u=e+ro,d=n.firstCreatePass?SQ(u,n,t,r,o,i,s,a,l):n.data[u];Gu(d,!1);let p=TQ(n,t,d,e);Gv()&&Jv(n,t,p,d),Wu(p,t);let f=ZF(p,t,p,d);return t[u]=f,XS(t,f),nQ(f,d,t),Vv(d)&&GS(n,t,d),l!=null&&WS(t,d,c),d}function re(t,n,e,r,o,i,s,a){let l=dt(),c=Rn(),u=zp(c.consts,i);return IO(l,c,t,n,e,r,o,u,s,a),re}var TQ=DQ;function DQ(t,n,e,r){return Wv(!0),n[En].createComment("")}var a1=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var EO=new ke("");function qu(t){return!!t&&typeof t.then=="function"}function SO(t){return!!t&&typeof t.subscribe=="function"}var TO=new ke("");var DO=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=se(TO,{optional:!0})??[];injector=se(Pn);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=yr(this.injector,o);if(qu(i))e.push(i);else if(SO(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),NO=(()=>{class t{static \u0275prov=be({token:t,providedIn:"root",factory:()=>new kv})}return t})(),kv=class{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){let e=n.zone,r=this.queues.get(e);r.has(n)&&(r.delete(n),this.queuedEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(n)||(this.queuedEffectCount++,r.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,e]of this.queues)n===null?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(let e of n)n.delete(e),this.queuedEffectCount--,e.run()}},tx=new ke("");function NQ(){VR(()=>{throw new Ie(600,!1)})}function kQ(t){return t.isBoundToModule}var AQ=10;function RQ(t,n,e){try{let r=e();return qu(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var Ys=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=se(OX);afterRenderManager=se(XX);zonelessEnabled=se(Kv);rootEffectScheduler=se(NO);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new xn;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=se(ea).hasPendingTasks.pipe(We(e=>!e));constructor(){se(Yv,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=se(no);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){let o=e instanceof Sv;if(!this._injector.get(DO).done){let p=!o&&v2(e),f=!1;throw new Ie(405,f)}let s;o?s=e:s=this._injector.get(jp).resolveComponentFactory(e),this.componentTypes.push(s.componentType);let a=kQ(s)?void 0:this._injector.get(Ul),l=r||s.selector,c=s.create(Pn.NULL,[],l,a),u=c.location.nativeElement,d=c.injector.get(EO,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),iv(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(wF.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new Ie(101,!1);let e=Dt(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,Dt(e),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Gp,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let e=0;for(;this.dirtyFlags!==0&&e++<AQ;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)MQ(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>Bv(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;iv(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(tx,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>iv(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ie(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function iv(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function MQ(t,n,e,r){if(!e&&!Bv(t))return;dO(t,n,e&&!r?0:1)}function us(t,n,e,r){let o=dt(),i=zv();if(Xs(o,i,n)){let s=Rn(),a=jv();aZ(a,o,t,n,e,r)}return us}function kO(t,n,e,r){return Xs(t,zv(),e)?n+js(e)+r:ao}function FQ(t,n,e,r,o,i){let s=z2(),a=s1(t,s,e,o);return Uv(2),a?n+js(e)+r+js(o)+i:ao}function OQ(t,n,e,r,o,i,s,a){let l=z2(),c=_O(t,l,e,o,s);return Uv(3),c?n+js(e)+r+js(o)+i+js(s)+a:ao}function J0(t,n){return t<<17|n<<2}function Uu(t){return t>>17&32767}function PQ(t){return(t&2)==2}function LQ(t,n){return t&131071|n<<17}function aS(t){return t|2}function Wp(t){return(t&131068)>>2}function pE(t,n){return t&-131069|n<<2}function $Q(t){return(t&1)===1}function lS(t){return t|1}function VQ(t,n,e,r,o,i){let s=i?n.classBindings:n.styleBindings,a=Uu(s),l=Wp(s);t[r]=e;let c=!1,u;if(Array.isArray(e)){let d=e;u=d[1],(u===null||jh(d,u)>0)&&(c=!0)}else u=e;if(o)if(l!==0){let p=Uu(t[a+1]);t[r+1]=J0(p,a),p!==0&&(t[p+1]=pE(t[p+1],r)),t[a+1]=LQ(t[a+1],r)}else t[r+1]=J0(a,0),a!==0&&(t[a+1]=pE(t[a+1],r)),a=r;else t[r+1]=J0(l,0),a===0?a=r:t[l+1]=pE(t[l+1],r),l=r;c&&(t[r+1]=aS(t[r+1])),HM(t,u,r,!0),HM(t,u,r,!1),BQ(n,u,t,r,i),s=J0(a,l),i?n.classBindings=s:n.styleBindings=s}function BQ(t,n,e,r,o){let i=o?t.residualClasses:t.residualStyles;i!=null&&typeof n=="string"&&jh(i,n)>=0&&(e[r+1]=lS(e[r+1]))}function HM(t,n,e,r){let o=t[e+1],i=n===null,s=r?Uu(o):Wp(o),a=!1;for(;s!==0&&(a===!1||i);){let l=t[s],c=t[s+1];zQ(l,n)&&(a=!0,t[s+1]=r?lS(c):aS(c)),s=r?Uu(c):Wp(c)}a&&(t[e+1]=r?aS(o):lS(o))}function zQ(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?jh(t,n)>=0:!1}var Ni={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function UQ(t){return t.substring(Ni.key,Ni.keyEnd)}function jQ(t){return GQ(t),AO(t,RO(t,0,Ni.textEnd))}function AO(t,n){let e=Ni.textEnd;return e===n?-1:(n=Ni.keyEnd=WQ(t,Ni.key=n,e),RO(t,n,e))}function GQ(t){Ni.key=0,Ni.keyEnd=0,Ni.value=0,Ni.valueEnd=0,Ni.textEnd=t.length}function RO(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function WQ(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}function z(t,n,e){let r=dt(),o=zv();if(Xs(r,o,n)){let i=Rn(),s=jv();qS(i,s,r,t,n,r[En],e,!1)}return z}function cS(t,n,e,r,o){let i=n.inputs,s=o?"class":"style";YS(t,e,i[s],s,r)}function Zp(t,n,e){return MO(t,n,e,!1),Zp}function Do(t,n){return MO(t,n,null,!0),Do}function nx(t){qQ(JQ,HQ,t,!0)}function HQ(t,n){for(let e=jQ(n);e>=0;e=AO(n,e))_S(t,UQ(n),!0)}function MO(t,n,e,r){let o=dt(),i=Rn(),s=Uv(2);if(i.firstUpdatePass&&OO(i,t,s,r),n!==ao&&Xs(o,s,n)){let a=i.data[Js()];PO(i,a,o,o[En],t,o[s+1]=tJ(n,e),r,s)}}function qQ(t,n,e,r){let o=Rn(),i=Uv(2);o.firstUpdatePass&&OO(o,null,i,r);let s=dt();if(e!==ao&&Xs(s,i,e)){let a=o.data[Js()];if(LO(a,r)&&!FO(o,i)){let l=r?a.classesWithoutHost:a.stylesWithoutHost;l!==null&&(e=yE(l,e||"")),cS(o,a,s,e,r)}else eJ(o,a,s,s[En],s[i+1],s[i+1]=QQ(t,n,e),r,i)}}function FO(t,n){return n>=t.expandoStartIndex}function OO(t,n,e,r){let o=t.data;if(o[e+1]===null){let i=o[Js()],s=FO(t,e);LO(i,r)&&n===null&&!s&&(n=!1),n=KQ(o,i,n,r),VQ(o,i,n,e,s,r)}}function KQ(t,n,e,r){let o=aX(t),i=r?n.residualClasses:n.residualStyles;if(o===null)(r?n.classBindings:n.styleBindings)===0&&(e=fE(null,t,n,e,r),e=zh(e,n.attrs,r),i=null);else{let s=n.directiveStylingLast;if(s===-1||t[s]!==o)if(e=fE(o,t,n,e,r),i===null){let l=XQ(t,n,r);l!==void 0&&Array.isArray(l)&&(l=fE(null,t,n,l[1],r),l=zh(l,n.attrs,r),YQ(t,n,r,l))}else i=ZQ(t,n,r)}return i!==void 0&&(r?n.residualClasses=i:n.residualStyles=i),e}function XQ(t,n,e){let r=e?n.classBindings:n.styleBindings;if(Wp(r)!==0)return t[Uu(r)]}function YQ(t,n,e,r){let o=e?n.classBindings:n.styleBindings;t[Uu(o)]=r}function ZQ(t,n,e){let r,o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++){let s=t[i].hostAttrs;r=zh(r,s,e)}return zh(r,n.attrs,e)}function fE(t,n,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=n[a],r=zh(r,i.hostAttrs,o),i!==t);)a++;return t!==null&&(e.directiveStylingLast=a),r}function zh(t,n,e){let r=e?1:2,o=-1;if(n!==null)for(let i=0;i<n.length;i++){let s=n[i];typeof s=="number"?o=s:o===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),_S(t,s,e?!0:n[++i]))}return t===void 0?null:t}function QQ(t,n,e){if(e==null||e==="")return to;let r=[],o=Ri(e);if(Array.isArray(o))for(let i=0;i<o.length;i++)t(r,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&t(r,i,o[i]);else typeof o=="string"&&n(r,o);return r}function JQ(t,n,e){let r=String(n);r!==""&&!r.includes(" ")&&_S(t,r,e)}function eJ(t,n,e,r,o,i,s,a){o===ao&&(o=to);let l=0,c=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let p=l<o.length?o[l+1]:void 0,f=c<i.length?i[c+1]:void 0,m=null,h;u===d?(l+=2,c+=2,p!==f&&(m=d,h=f)):d===null||u!==null&&u<d?(l+=2,m=u):(c+=2,m=d,h=f),m!==null&&PO(t,n,e,r,m,h,s,a),u=l<o.length?o[l]:null,d=c<i.length?i[c]:null}}function PO(t,n,e,r,o,i,s,a){if(!(n.type&3))return;let l=t.data,c=l[a+1],u=$Q(c)?qM(l,n,e,o,Wp(c),s):void 0;if(!Av(u)){Av(i)||PQ(c)&&(i=qM(l,null,e,o,a,s));let d=A2(Js(),e);SZ(r,s,d,o,i)}}function qM(t,n,e,r,o,i){let s=n===null,a;for(;o>0;){let l=t[o],c=Array.isArray(l),u=c?l[1]:l,d=u===null,p=e[o+1];p===ao&&(p=d?to:void 0);let f=d?iE(p,r):u===r?p:void 0;if(c&&!Av(f)&&(f=iE(l,r)),Av(f)&&(a=f,s))return a;let m=t[o+1];o=s?Uu(m):Wp(m)}if(n!==null){let l=i?n.residualClasses:n.residualStyles;l!=null&&(a=iE(l,r))}return a}function Av(t){return t!==void 0}function tJ(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Ur(Ri(t)))),t}function LO(t,n){return(t.flags&(n?8:16))!==0}function nJ(t,n,e,r,o,i){let s=n.consts,a=zp(s,o),l=Yp(n,t,2,r,a);return KS(n,e,l,zp(s,i)),l.attrs!==null&&Tv(l,l.attrs,!1),l.mergedAttrs!==null&&Tv(l,l.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,l),l}function v(t,n,e,r){let o=dt(),i=Rn(),s=ro+t,a=o[En],l=i.firstCreatePass?nJ(s,i,o,n,e,r):i.data[s],c=rJ(i,o,l,a,n,t);o[s]=c;let u=Vv(l);return Gu(l,!0),jF(a,c,l),!JS(l)&&Gv()&&Jv(i,o,c,l),Z7()===0&&Wu(c,o),Q7(),u&&(GS(i,o,l),zS(i,l,o)),r!==null&&WS(o,l),v}function y(){let t=jr();NS()?kS():(t=t.parent,Gu(t,!1));let n=t;eX(n)&&tX(),J7();let e=Rn();return e.firstCreatePass&&(Hv(e,t),SS(t)&&e.queries.elementEnd(t)),n.classesWithoutHost!=null&&mX(n)&&cS(e,n,dt(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&hX(n)&&cS(e,n,dt(),n.stylesWithoutHost,!1),y}function U(t,n,e,r){return v(t,n,e,r),y(),U}var rJ=(t,n,e,r,o,i)=>(Wv(!0),zF(r,o,uX()));function oJ(t,n,e,r,o){let i=n.consts,s=zp(i,r),a=Yp(n,t,8,"ng-container",s);s!==null&&Tv(a,s,!0);let l=zp(i,o);return KS(n,e,a,l),n.queries!==null&&n.queries.elementStart(n,a),a}function na(t,n,e){let r=dt(),o=Rn(),i=t+ro,s=o.firstCreatePass?oJ(i,o,r,n,e):o.data[i];Gu(s,!0);let a=iJ(o,r,s,t);return r[i]=a,Gv()&&Jv(o,r,a,s),Wu(a,r),Vv(s)&&(GS(o,r,s),zS(o,s,r)),e!=null&&WS(r,s),na}function ra(){let t=jr(),n=Rn();return NS()?kS():(t=t.parent,Gu(t,!1)),n.firstCreatePass&&(Hv(n,t),SS(t)&&n.queries.elementEnd(t)),ra}var iJ=(t,n,e,r)=>(Wv(!0),PY(n[En],""));function Je(){return dt()}var Nu=void 0;function sJ(t){let n=t,e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return e===1&&r===0?1:5}var aJ=["en",[["a","p"],["AM","PM"],Nu],[["AM","PM"],Nu,Nu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Nu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Nu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Nu,"{1} 'at' {0}",Nu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",sJ],mE={};function Zo(t){let n=lJ(t),e=KM(n);if(e)return e;let r=n.split("-")[0];if(e=KM(r),e)return e;if(r==="en")return aJ;throw new Ie(701,!1)}function KM(t){return t in mE||(mE[t]=Us.ng&&Us.ng.common&&Us.ng.common.locales&&Us.ng.common.locales[t]),mE[t]}var Mn=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(Mn||{});function lJ(t){return t.toLowerCase().replace(/_/g,"-")}var Rv="en-US";var cJ=Rv;function uJ(t){typeof t=="string"&&(cJ=t.toLowerCase().replace(/_/g,"-"))}var dJ=(t,n,e)=>{};function te(t,n,e,r){let o=dt(),i=Rn(),s=jr();return $O(i,o,o[En],s,t,n,r),te}function pJ(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=n[dv],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function $O(t,n,e,r,o,i,s){let a=Vv(r),c=t.firstCreatePass&&P2(t),u=n[qo],d=O2(n),p=!0;if(r.type&3||s){let h=Ai(r,n),g=s?s(h):h,x=d.length,b=s?_=>s(ss(_[r.index])):r.index,I=null;if(!s&&a&&(I=pJ(t,n,o,r.index)),I!==null){let _=I.__ngLastListenerFn__||I;_.__ngNextListenerFn__=i,I.__ngLastListenerFn__=i,p=!1}else{i=YM(r,n,u,i),dJ(h,o,i);let _=e.listen(g,o,i);d.push(i,_),c&&c.push(o,b,x,x+1)}}else i=YM(r,n,u,i);let f=r.outputs,m;if(p&&f!==null&&(m=f[o])){let h=m.length;if(h)for(let g=0;g<h;g+=2){let x=m[g],b=m[g+1],E=n[x][b].subscribe(i),S=d.length;d.push(i,E),c&&c.push(o,r.index,S,-(S+1))}}}function XM(t,n,e,r){let o=Dt(null);try{return Ho(6,n,e),e(r)!==!1}catch(i){return QF(t,i),!1}finally{Ho(7,n,e),Dt(o)}}function YM(t,n,e,r){return function o(i){if(i===Function)return r;let s=ju(t)?as(t.index,n):n;n1(s,5);let a=XM(n,e,r,i),l=o.__ngNextListenerFn__;for(;l;)a=XM(n,e,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function Y(t=1){return cX(t)}function fJ(t,n){let e=null,r=TY(t);for(let o=0;o<n.length;o++){let i=n[o];if(i==="*"){e=o;continue}if(r===null?BF(t,i,!0):kY(r,i))return o}return e}function l1(t){let n=dt()[Ko][oo];if(!n.projection){let e=t?t.length:1,r=n.projection=E7(e,null),o=r.slice(),i=n.child;for(;i!==null;){if(i.type!==128){let s=t?fJ(i,t):0;s!==null&&(o[s]?o[s].projectionNext=i:r[s]=i,o[s]=i)}i=i.next}}}function c1(t,n=0,e,r,o,i){let s=dt(),a=Rn(),l=r?t+1:null;l!==null&&IO(s,a,l,r,o,i,null,e);let c=Yp(a,ro+t,16,null,e||null);c.projection===null&&(c.projection=n),kS();let d=!s[Fh]||$2();s[Ko][oo].projection[c.projection]===null&&l!==null?mJ(s,a,l):d&&!JS(c)&&IZ(a,s,c)}function mJ(t,n,e){let r=ro+e,o=n.data[r],i=t[r],s=XE(i,o.tView.ssrId),a=sO(t,o,void 0,{dehydratedView:s});aO(i,a,0,qE(o,s))}function Ku(t,n,e){return VO(t,"",n,"",e),Ku}function VO(t,n,e,r,o){let i=dt(),s=kO(i,n,e,r);if(s!==ao){let a=Rn(),l=jv();qS(a,l,i,t,s,i[En],o,!1)}return VO}function u1(t,n,e){uQ(t,n,e)}function rx(t){let n=dt(),e=Rn(),r=U2();RS(r+1);let o=o1(e,r);if(t.dirty&&H7(n)===((o.metadata.flags&2)===2)){if(o.matches===null)t.reset([]);else{let i=fQ(n,r);t.reset(i,$X),t.notifyOnChanges()}return!0}return!1}function ox(){return lQ(dt(),U2())}function hJ(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}function w(t,n=""){let e=dt(),r=Rn(),o=t+ro,i=r.firstCreatePass?Yp(r,o,1,n,null):r.data[o],s=gJ(r,e,i,n,t);e[o]=s,Gv()&&Jv(r,e,s,i),Gu(i,!1)}var gJ=(t,n,e,r,o)=>(Wv(!0),FY(n[En],r));function Ke(t){return $e("",t,""),Ke}function $e(t,n,e){let r=dt(),o=kO(r,t,n,e);return o!==ao&&d1(r,Js(),o),$e}function Xu(t,n,e,r,o){let i=dt(),s=FQ(i,t,n,e,r,o);return s!==ao&&d1(i,Js(),s),Xu}function Kh(t,n,e,r,o,i,s){let a=dt(),l=OQ(a,t,n,e,r,o,i,s);return l!==ao&&d1(a,Js(),l),Kh}function d1(t,n,e){let r=A2(n,t);OY(t[En],r,e)}function sn(t,n,e){pF(n)&&(n=n());let r=dt(),o=zv();if(Xs(r,o,n)){let i=Rn(),s=jv();qS(i,s,r,t,n,r[En],e,!1)}return sn}function un(t,n){let e=pF(t);return e&&t.set(n),e}function an(t,n){let e=dt(),r=Rn(),o=jr();return $O(r,e,e[En],o,t,n),an}function yJ(t,n,e){let r=Rn();if(r.firstCreatePass){let o=Hs(t);uS(e,r.data,r.blueprint,o,!0),uS(n,r.data,r.blueprint,o,!1)}}function uS(t,n,e,r,o){if(t=zr(t),Array.isArray(t))for(let i=0;i<t.length;i++)uS(t[i],n,e,r,o);else{let i=Rn(),s=dt(),a=jr(),l=Vp(t)?t:zr(t.provide),c=C2(t),u=a.providerIndexes&1048575,d=a.directiveStart,p=a.providerIndexes>>20;if(Vp(t)||!t.multi){let f=new $u(c,o,ne),m=gE(l,n,o?u:u+p,d);m===-1?(kE(vv(a,s),i,l),hE(i,t,n.length),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(f),s.push(f)):(e[m]=f,s[m]=f)}else{let f=gE(l,n,u+p,d),m=gE(l,n,u,u+p),h=f>=0&&e[f],g=m>=0&&e[m];if(o&&!g||!o&&!h){kE(vv(a,s),i,l);let x=bJ(o?xJ:vJ,e.length,o,r,c);!o&&g&&(e[m].providerFactory=x),hE(i,t,n.length,0),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(x),s.push(x)}else{let x=BO(e[o?m:f],c,!o&&r);hE(i,t,f>-1?f:m,x)}!o&&r&&g&&e[m].componentProviders++}}}function hE(t,n,e,r){let o=Vp(n),i=R7(n);if(o||i){let l=(i?zr(n.useClass):n).prototype.ngOnDestroy;if(l){let c=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){let u=c.indexOf(e);u===-1?c.push(e,[r,l]):c[u+1].push(r,l)}else c.push(e,l)}}}function BO(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function gE(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function vJ(t,n,e,r){return dS(this.multi,[])}function xJ(t,n,e,r){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=Lh(e,e[ht],this.providerFactory.index,r);i=a.slice(0,s),dS(o,i);for(let l=s;l<a.length;l++)i.push(a[l])}else i=[],dS(o,i);return i}function dS(t,n){for(let e=0;e<t.length;e++){let r=t[e];n.push(r())}return n}function bJ(t,n,e,r,o){let i=new $u(t,e,ne);return i.multi=[],i.index=n,i.componentProviders=0,BO(i,o,r&&!e),i}function vr(t,n=[]){return e=>{e.providersResolver=(r,o)=>yJ(r,o?o(t):t,n)}}function Qo(t,n,e,r,o){return UO(dt(),AS(),t,n,e,r,o)}function Hl(t,n,e,r,o,i){return wJ(dt(),AS(),t,n,e,r,o,i)}function zO(t,n){let e=t[n];return e===ao?void 0:e}function UO(t,n,e,r,o,i,s){let a=n+e;return s1(t,a,o,i)?CO(t,a+2,s?r.call(s,o,i):r(o,i)):zO(t,a+2)}function wJ(t,n,e,r,o,i,s,a){let l=n+e;return _O(t,l,o,i,s)?CO(t,l+3,a?r.call(a,o,i,s):r(o,i,s)):zO(t,l+3)}function No(t,n){let e=Rn(),r,o=t+ro;e.firstCreatePass?(r=CJ(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks??=[]).push(o,r.onDestroy)):r=e.data[o];let i=r.factory||(r.factory=Au(r.type,!0)),s,a=eo(ne);try{let l=yv(!1),c=i();return yv(l),hJ(e,dt(),o,c),c}finally{eo(a)}}function CJ(t,n){if(n)for(let e=n.length-1;e>=0;e--){let r=n[e];if(t===r.name)return r}}function ko(t,n,e,r){let o=t+ro,i=dt(),s=W7(i,o);return _J(i,o)?UO(i,AS(),n,s.transform,e,r,s):s.transform(e,r)}function _J(t,n){return t[ht].data[n].pure}var pS=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},p1=(()=>{class t{compileModuleSync(e){return new sS(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=h2(e),i=$F(o.declarations).reduce((s,a)=>{let l=Ru(a);return l&&s.push(new Vh(l)),s},[]);return new pS(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var IJ=(()=>{class t{zone=se(bn);changeDetectionScheduler=se(Vu);applicationRef=se(Ys);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function EJ({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new bn(Ue(me({},SJ()),{scheduleInRootZone:e})),[{provide:bn,useFactory:t},{provide:$p,multi:!0,useFactory:()=>{let r=se(IJ,{optional:!0});return()=>r.initialize()}},{provide:$p,multi:!0,useFactory:()=>{let r=se(TJ);return()=>{r.initialize()}}},n===!0?{provide:lF,useValue:!0}:[],{provide:PS,useValue:e??aF}]}function SJ(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var TJ=(()=>{class t{subscription=new vn;initialized=!1;zone=se(bn);pendingTasks=se(ea);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{bn.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{bn.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var jO=(()=>{class t{appRef=se(Ys);taskService=se(ea);ngZone=se(bn);zonelessEnabled=se(Kv);tracing=se(Yv,{optional:!0});disableScheduling=se(lF,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new vn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(wv):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(se(PS,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Cv||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?SM:cF;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(wv+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,SM(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function GO(){return jl("NgZoneless"),Hp([{provide:Vu,useExisting:jO},{provide:bn,useClass:Cv},{provide:Kv,useValue:!0},{provide:PS,useValue:!1},[]])}function DJ(){return typeof $localize<"u"&&$localize.locale||Rv}var Xh=new ke("",{providedIn:"root",factory:()=>se(Xh,ct.Optional|ct.SkipSelf)||DJ()});var fS=new ke(""),NJ=new ke("");function Dh(t){return!t.moduleRef}function kJ(t){let n=Dh(t)?t.r3Injector:t.moduleRef.injector,e=n.get(bn);return e.run(()=>{Dh(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=n.get(To,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),Dh(t)){let i=()=>n.destroy(),s=t.platformInjector.get(fS);s.add(i),n.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>t.moduleRef.destroy(),s=t.platformInjector.get(fS);s.add(i),t.moduleRef.onDestroy(()=>{iv(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(i)})}return RQ(r,e,()=>{let i=n.get(DO);return i.runInitializers(),i.donePromise.then(()=>{let s=n.get(Xh,Rv);if(uJ(s||Rv),!n.get(NJ,!0))return Dh(t)?n.get(Ys):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(Dh(t)){let l=n.get(Ys);return t.rootComponent!==void 0&&l.bootstrap(t.rootComponent),l}else return AJ(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function AJ(t,n){let e=t.injector.get(Ys);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(e);else throw new Ie(-403,!1);n.push(t)}var sv=null;function RJ(t=[],n){return Pn.create({name:n,providers:[{provide:Lv,useValue:"platform"},{provide:fS,useValue:new Set([()=>sv=null])},...t]})}function MJ(t=[]){if(sv)return sv;let n=RJ(t);return sv=n,NQ(),FJ(n),n}function FJ(t){let n=t.get(BS,null);yr(t,()=>{n?.forEach(e=>e())})}var vt=(()=>{class t{static __NG_ELEMENT_ID__=OJ}return t})();function OJ(t){return PJ(jr(),dt(),(t&16)===16)}function PJ(t,n,e){if(ju(t)&&!e){let r=as(t.index,n);return new Bu(r,r)}else if(t.type&175){let r=n[Ko];return new Bu(r,n)}return null}var mS=class{constructor(){}supports(n){return wO(n)}create(n){return new hS(n)}},LJ=(t,n)=>n,hS=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||LJ}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<ZM(r,o,i)?e:r,a=ZM(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let c=a-o,u=l-o;if(c!=u){for(let p=0;p<c;p++){let f=p<i.length?i[p]:i[p]=0,m=f+p;u<=m&&m<c&&(i[p]=f+1)}let d=s.previousIndex;i[d]=u-c}}a!==l&&n(s,a,l)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!wO(n))throw new Ie(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)i=n[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,IQ(n,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):(n=this._linkedRecords===null?null:this._linkedRecords.get(r,o),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new gS(e,r),i,o)),n}_verifyReinsertion(n,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let o=n._prevRemoved,i=n._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){let o=e===null?this._itHead:e._next;return n._next=o,n._prev=e,o===null?this._itTail=n:o._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new Mv),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,r=n._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Mv),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},gS=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},yS=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){let e=n._prevDup,r=n._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},Mv=class{map=new Map;put(n){let e=n.trackById,r=this.map.get(e);r||(r=new yS,this.map.set(e,r)),r.add(n)}get(n,e){let r=n,o=this.map.get(r);return o?o.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function ZM(t,n,e){let r=t.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}function QM(){return new f1([new mS])}var f1=(()=>{class t{factories;static \u0275prov=be({token:t,providedIn:"root",factory:QM});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||QM()),deps:[[t,new d2,new wS]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new Ie(901,!1)}}return t})();function WO(t){try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=MJ(r),i=[EJ({}),{provide:Vu,useExisting:jO},...e||[]],s=new Nv({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return kJ({r3Injector:s.injector,platformInjector:o,rootComponent:n})}catch(n){return Promise.reject(n)}}function Fi(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function ql(t,n){jl("NgSignals");let e=PR(t);return n?.equal&&(e[Zr].equal=n.equal),e}function ds(t){let n=Dt(null);try{return t()}finally{Dt(n)}}var HO=(()=>{class t{view;node;constructor(e,r){this.view=e,this.node=r}static __NG_ELEMENT_ID__=$J}return t})();function $J(){return new HO(dt(),jr())}var VJ=!1,BJ=(()=>{class t extends kv{pendingTasks=se(ea);taskId=null;schedule(e){super.schedule(e),this.taskId===null&&(this.taskId=this.pendingTasks.add(),queueMicrotask(()=>this.flush()))}flush(){try{super.flush()}finally{this.taskId!==null&&(this.pendingTasks.remove(this.taskId),this.taskId=null)}}static \u0275prov=be({token:t,providedIn:"root",factory:()=>new t})}return t})(),vS=class{scheduler;effectFn;zone;injector;unregisterOnDestroy;watcher;constructor(n,e,r,o,i,s){this.scheduler=n,this.effectFn=e,this.zone=r,this.injector=i,this.watcher=UR(a=>this.runEffect(a),()=>this.schedule(),s),this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}runEffect(n){try{this.effectFn(n)}catch(e){this.injector.get(To,null,{optional:!0})?.handleError(e)}}run(){this.watcher.run()}schedule(){this.scheduler.schedule(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function zJ(){}function UJ(t,n){jl("NgSignals"),!n?.injector&&I2(zJ);let e=n?.injector??se(Pn),r=n?.manualCleanup!==!0?e.get(Kp):null,o=new vS(e.get(BJ),t,typeof Zone>"u"?null:Zone.current,r,e,n?.allowSignalWrites??!1),i=e.get(vt,null,{optional:!0});return!i||!(i._lView[Ye]&8)?o.watcher.notify():(i._lView[tv]??=[]).push(o.watcher.notify),o}var jJ=VJ;var xS=class{[Zr];constructor(n){this[Zr]=n}destroy(){this[Zr].destroy()}};function Qp(t,n){if(jJ)return UJ(t,n);jl("NgSignals"),!n?.injector&&I2(Qp);let e=n?.injector??se(Pn),r=n?.manualCleanup!==!0?e.get(Kp):null,o,i=e.get(HO,null,{optional:!0}),s=e.get(Vu);return i!==null&&!n?.forceRoot?(o=HJ(i.view,s,t),r instanceof bv&&r._lView===i.view&&(r=null)):o=qJ(t,e.get(NO),s),o.injector=e,r!==null&&(o.onDestroyFn=r.onDestroy(()=>o.destroy())),new xS(o)}var qO=Ue(me({},Iu),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:$h,run(){if(this.dirty=!1,this.hasRun&&!Ch(this))return;this.hasRun=!0;let t=r=>(this.cleanupFns??=[]).push(r),n=wp(this),e=mv(!1);try{this.maybeCleanup(),this.fn(t)}finally{mv(e),wh(this,n)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),GJ=Ue(me({},qO),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(13)},destroy(){Cp(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),WJ=Ue(me({},qO),{consumerMarkedDirty(){this.view[Ye]|=8192,Wh(this.view),this.notifier.notify(14)},destroy(){Cp(this),this.onDestroyFn(),this.maybeCleanup(),this.view[Fu]?.delete(this)}});function HJ(t,n,e){let r=Object.create(WJ);return r.view=t,r.zone=typeof Zone<"u"?Zone.current:null,r.notifier=n,r.fn=e,t[Fu]??=new Set,t[Fu].add(r),r.consumerMarkedDirty(r),r}function qJ(t,n,e){let r=Object.create(GJ);return r.fn=t,r.scheduler=n,r.notifier=e,r.zone=typeof Zone<"u"?Zone.current:null,r.scheduler.schedule(r),r.notifier.notify(13),r}var eP=null;function ia(){return eP}function tP(t){eP??=t}var fx=class{};var Vn=new ke(""),nP=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>se(KJ),providedIn:"platform"})}return t})();var KJ=(()=>{class t extends nP{_location;_history;_doc=se(Vn);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ia().getBaseHref(this._doc)}onPopState(e){let r=ia().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=ia().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function rP(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function KO(t){let n=t.match(/#|\?|$/),e=n&&n.index||t.length,r=e-(t[e-1]==="/"?1:0);return t.slice(0,r)+t.slice(e)}function Yu(t){return t&&t[0]!=="?"?"?"+t:t}var ef=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>se(oP),providedIn:"root"})}return t})(),XJ=new ke(""),oP=(()=>{class t extends ef{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??se(Vn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return rP(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+Yu(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+Yu(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+Yu(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||t)(Me(nP),Me(XJ,8))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Yh=(()=>{class t{_subject=new xn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=QJ(KO(XO(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Yu(r))}normalize(e){return t.stripTrailingSlash(ZJ(this._basePath,XO(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Yu(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Yu(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=Yu;static joinWithSlash=rP;static stripTrailingSlash=KO;static \u0275fac=function(r){return new(r||t)(Me(ef))};static \u0275prov=be({token:t,factory:()=>YJ(),providedIn:"root"})}return t})();function YJ(){return new Yh(Me(ef))}function ZJ(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function XO(t){return t.replace(/\/index.html$/,"")}function QJ(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}var Gr=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Gr||{}),Jt=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Jt||{}),Ao=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(Ao||{}),Kl={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function JJ(t){return Zo(t)[Mn.LocaleId]}function eee(t,n,e){let r=Zo(t),o=[r[Mn.DayPeriodsFormat],r[Mn.DayPeriodsStandalone]],i=Jo(o,n);return Jo(i,e)}function tee(t,n,e){let r=Zo(t),o=[r[Mn.DaysFormat],r[Mn.DaysStandalone]],i=Jo(o,n);return Jo(i,e)}function nee(t,n,e){let r=Zo(t),o=[r[Mn.MonthsFormat],r[Mn.MonthsStandalone]],i=Jo(o,n);return Jo(i,e)}function ree(t,n){let r=Zo(t)[Mn.Eras];return Jo(r,n)}function ix(t,n){let e=Zo(t);return Jo(e[Mn.DateFormat],n)}function sx(t,n){let e=Zo(t);return Jo(e[Mn.TimeFormat],n)}function ax(t,n){let r=Zo(t)[Mn.DateTimeFormat];return Jo(r,n)}function gx(t,n){let e=Zo(t),r=e[Mn.NumberSymbols][n];if(typeof r>"u"){if(n===Kl.CurrencyDecimal)return e[Mn.NumberSymbols][Kl.Decimal];if(n===Kl.CurrencyGroup)return e[Mn.NumberSymbols][Kl.Group]}return r}function iP(t){if(!t[Mn.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[Mn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function oee(t){let n=Zo(t);return iP(n),(n[Mn.ExtraData][2]||[]).map(r=>typeof r=="string"?m1(r):[m1(r[0]),m1(r[1])])}function iee(t,n,e){let r=Zo(t);iP(r);let o=[r[Mn.ExtraData][0],r[Mn.ExtraData][1]],i=Jo(o,n)||[];return Jo(i,e)||[]}function Jo(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function m1(t){let[n,e]=t.split(":");return{hours:+n,minutes:+e}}var see=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,lx={},aee=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function lee(t,n,e,r){let o=yee(t);n=oa(e,n)||n;let s=[],a;for(;n;)if(a=aee.exec(n),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;n=u}else{s.push(n);break}let l=o.getTimezoneOffset();r&&(l=aP(r,l),o=gee(o,r,!0));let c="";return s.forEach(u=>{let d=mee(u);c+=d?d(o,e,l):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function mx(t,n,e){let r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function oa(t,n){let e=JJ(t);if(lx[e]??={},lx[e][n])return lx[e][n];let r="";switch(n){case"shortDate":r=ix(t,Ao.Short);break;case"mediumDate":r=ix(t,Ao.Medium);break;case"longDate":r=ix(t,Ao.Long);break;case"fullDate":r=ix(t,Ao.Full);break;case"shortTime":r=sx(t,Ao.Short);break;case"mediumTime":r=sx(t,Ao.Medium);break;case"longTime":r=sx(t,Ao.Long);break;case"fullTime":r=sx(t,Ao.Full);break;case"short":let o=oa(t,"shortTime"),i=oa(t,"shortDate");r=cx(ax(t,Ao.Short),[o,i]);break;case"medium":let s=oa(t,"mediumTime"),a=oa(t,"mediumDate");r=cx(ax(t,Ao.Medium),[s,a]);break;case"long":let l=oa(t,"longTime"),c=oa(t,"longDate");r=cx(ax(t,Ao.Long),[l,c]);break;case"full":let u=oa(t,"fullTime"),d=oa(t,"fullDate");r=cx(ax(t,Ao.Full),[u,d]);break}return r&&(lx[e][n]=r),r}function cx(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return n!=null&&r in n?n[r]:e})),t}function Oi(t,n,e="-",r,o){let i="";(t<0||o&&t<=0)&&(o?t=-t+1:(t=-t,i=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),i+s}function cee(t,n){return Oi(t,3).substring(0,n)}function $n(t,n,e=0,r=!1,o=!1){return function(i,s){let a=uee(t,i);if((e>0||a>-e)&&(a+=e),t===3)a===0&&e===-12&&(a=12);else if(t===6)return cee(a,n);let l=gx(s,Kl.MinusSign);return Oi(a,n,l,r,o)}}function uee(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}function ln(t,n,e=Gr.Format,r=!1){return function(o,i){return dee(o,i,t,n,e,r)}}function dee(t,n,e,r,o,i){switch(e){case 2:return nee(n,o,r)[t.getMonth()];case 1:return tee(n,o,r)[t.getDay()];case 0:let s=t.getHours(),a=t.getMinutes();if(i){let c=oee(n),u=iee(n,o,r),d=c.findIndex(p=>{if(Array.isArray(p)){let[f,m]=p,h=s>=f.hours&&a>=f.minutes,g=s<m.hours||s===m.hours&&a<m.minutes;if(f.hours<m.hours){if(h&&g)return!0}else if(h||g)return!0}else if(p.hours===s&&p.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return eee(n,o,r)[s<12?0:1];case 3:return ree(n,r)[t.getFullYear()<=0?0:1];default:let l=e;throw new Error(`unexpected translation type ${l}`)}}function ux(t){return function(n,e,r){let o=-1*r,i=gx(e,Kl.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case 0:return(o>=0?"+":"")+Oi(s,2,i)+Oi(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+Oi(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+Oi(s,2,i)+":"+Oi(Math.abs(o%60),2,i);case 3:return r===0?"Z":(o>=0?"+":"")+Oi(s,2,i)+":"+Oi(Math.abs(o%60),2,i);default:throw new Error(`Unknown zone width "${t}"`)}}}var pee=0,px=4;function fee(t){let n=mx(t,pee,1).getDay();return mx(t,0,1+(n<=px?px:px+7)-n)}function sP(t){let n=t.getDay(),e=n===0?-3:px-n;return mx(t.getFullYear(),t.getMonth(),t.getDate()+e)}function h1(t,n=!1){return function(e,r){let o;if(n){let i=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+i)/7)}else{let i=sP(e),s=fee(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Oi(o,t,gx(r,Kl.MinusSign))}}function dx(t,n=!1){return function(e,r){let i=sP(e).getFullYear();return Oi(i,t,gx(r,Kl.MinusSign),n)}}var g1={};function mee(t){if(g1[t])return g1[t];let n;switch(t){case"G":case"GG":case"GGG":n=ln(3,Jt.Abbreviated);break;case"GGGG":n=ln(3,Jt.Wide);break;case"GGGGG":n=ln(3,Jt.Narrow);break;case"y":n=$n(0,1,0,!1,!0);break;case"yy":n=$n(0,2,0,!0,!0);break;case"yyy":n=$n(0,3,0,!1,!0);break;case"yyyy":n=$n(0,4,0,!1,!0);break;case"Y":n=dx(1);break;case"YY":n=dx(2,!0);break;case"YYY":n=dx(3);break;case"YYYY":n=dx(4);break;case"M":case"L":n=$n(1,1,1);break;case"MM":case"LL":n=$n(1,2,1);break;case"MMM":n=ln(2,Jt.Abbreviated);break;case"MMMM":n=ln(2,Jt.Wide);break;case"MMMMM":n=ln(2,Jt.Narrow);break;case"LLL":n=ln(2,Jt.Abbreviated,Gr.Standalone);break;case"LLLL":n=ln(2,Jt.Wide,Gr.Standalone);break;case"LLLLL":n=ln(2,Jt.Narrow,Gr.Standalone);break;case"w":n=h1(1);break;case"ww":n=h1(2);break;case"W":n=h1(1,!0);break;case"d":n=$n(2,1);break;case"dd":n=$n(2,2);break;case"c":case"cc":n=$n(7,1);break;case"ccc":n=ln(1,Jt.Abbreviated,Gr.Standalone);break;case"cccc":n=ln(1,Jt.Wide,Gr.Standalone);break;case"ccccc":n=ln(1,Jt.Narrow,Gr.Standalone);break;case"cccccc":n=ln(1,Jt.Short,Gr.Standalone);break;case"E":case"EE":case"EEE":n=ln(1,Jt.Abbreviated);break;case"EEEE":n=ln(1,Jt.Wide);break;case"EEEEE":n=ln(1,Jt.Narrow);break;case"EEEEEE":n=ln(1,Jt.Short);break;case"a":case"aa":case"aaa":n=ln(0,Jt.Abbreviated);break;case"aaaa":n=ln(0,Jt.Wide);break;case"aaaaa":n=ln(0,Jt.Narrow);break;case"b":case"bb":case"bbb":n=ln(0,Jt.Abbreviated,Gr.Standalone,!0);break;case"bbbb":n=ln(0,Jt.Wide,Gr.Standalone,!0);break;case"bbbbb":n=ln(0,Jt.Narrow,Gr.Standalone,!0);break;case"B":case"BB":case"BBB":n=ln(0,Jt.Abbreviated,Gr.Format,!0);break;case"BBBB":n=ln(0,Jt.Wide,Gr.Format,!0);break;case"BBBBB":n=ln(0,Jt.Narrow,Gr.Format,!0);break;case"h":n=$n(3,1,-12);break;case"hh":n=$n(3,2,-12);break;case"H":n=$n(3,1);break;case"HH":n=$n(3,2);break;case"m":n=$n(4,1);break;case"mm":n=$n(4,2);break;case"s":n=$n(5,1);break;case"ss":n=$n(5,2);break;case"S":n=$n(6,1);break;case"SS":n=$n(6,2);break;case"SSS":n=$n(6,3);break;case"Z":case"ZZ":case"ZZZ":n=ux(0);break;case"ZZZZZ":n=ux(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=ux(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=ux(2);break;default:return null}return g1[t]=n,n}function aP(t,n){t=t.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function hee(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function gee(t,n,e){let r=e?-1:1,o=t.getTimezoneOffset(),i=aP(n,o);return hee(t,r*(i-o))}function yee(t){if(YO(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[o,i=1,s=1]=t.split("-").map(a=>+a);return mx(o,i-1,s)}let e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(see))return vee(r)}let n=new Date(t);if(!YO(n))throw new Error(`Unable to convert "${t}" into a date`);return n}function vee(t){let n=new Date(0),e=0,r=0,o=t[8]?n.setUTCFullYear:n.setFullYear,i=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),o.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,l=Number(t[6]||0),c=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return i.call(n,s,a,l,c),n}function YO(t){return t instanceof Date&&!isNaN(t.valueOf())}function yx(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var y1=/\s+/,ZO=[],lo=(()=>{class t{_ngEl;_renderer;initialClasses=ZO;rawClass;stateMap=new Map;constructor(e,r){this._ngEl=e,this._renderer=r}set klass(e){this.initialClasses=e!=null?e.trim().split(y1):ZO}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(y1):e}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let r of e)this._updateState(r,!0);else if(e!=null)for(let r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){let o=this.stateMap.get(e);o!==void 0?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){e=e.trim(),e.length>0&&e.split(y1).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(r){return new(r||t)(ne(Yn),ne(Mi))};static \u0275dir=Nt({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var v1=class{$implicit;ngForOf;index;count;constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Bn=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new v1(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),QO(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);QO(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(ne(Wl),ne(zu),ne(f1))};static \u0275dir=Nt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function QO(t,n){t.context.$implicit=n.item}var Ut=(()=>{class t{_viewContainer;_context=new x1;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){JO("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){JO("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(ne(Wl),ne(zu))};static \u0275dir=Nt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),x1=class{$implicit=null;ngIf=null};function JO(t,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${Ur(n)}'.`)}function xee(t,n){return new Ie(2100,!1)}var bee="mediumDate",wee=new ke(""),Cee=new ke(""),ei=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,r,o){this.locale=e,this.defaultTimezone=r,this.defaultOptions=o}transform(e,r,o,i){if(e==null||e===""||e!==e)return null;try{let s=r??this.defaultOptions?.dateFormat??bee,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return lee(e,s,i||this.locale,a)}catch(s){throw xee(t,s.message)}}static \u0275fac=function(r){return new(r||t)(ne(Xh,16),ne(wee,24),ne(Cee,24))};static \u0275pipe=vO({name:"date",type:t,pure:!0})}return t})();var kt=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({})}return t})(),b1="browser",_ee="server";function dn(t){return t===b1}function w1(t){return t===_ee}var Jp=class{};var Jh=class{},eg=class{},sa=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=e.slice(r+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.addHeaderEntry(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new t;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,e);let o=(n.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=n.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(n,e){let r=n.toLowerCase();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(e):this.headers.set(r,[e])}setHeaderEntries(n,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var I1=class{encodeKey(n){return lP(n)}encodeValue(n){return lP(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function Iee(t,n){let e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],l=e.get(s)||[];l.push(a),e.set(s,l)}),e}var Eee=/%(\d[a-f0-9])/gi,See={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function lP(t){return encodeURIComponent(t).replace(Eee,(n,e)=>See[e]??n)}function vx(t){return`${t}`}var Yl=class t{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new I1,n.fromString){if(n.fromObject)throw new Ie(2805,!1);this.map=Iee(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let r=n.fromObject[e],o=Array.isArray(r)?r.map(vx):[vx(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(r=>{let o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new t({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push(vx(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let r=this.map.get(n.param)||[],o=r.indexOf(vx(n.value));o!==-1&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var E1=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function Tee(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function cP(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function uP(t){return typeof Blob<"u"&&t instanceof Blob}function dP(t){return typeof FormData<"u"&&t instanceof FormData}function Dee(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var Zh="Content-Type",xx="Accept",D1="X-Request-URL",hP="text/plain",gP="application/json",yP=`${gP}, ${hP}, */*`,Qh=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(n,e,r,o){this.url=e,this.method=n.toUpperCase();let i;if(Tee(this.method)||o?(this.body=r!==void 0?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new sa,this.context??=new E1,!this.params)this.params=new Yl,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),l=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||cP(this.body)||uP(this.body)||dP(this.body)||Dee(this.body)?this.body:this.body instanceof Yl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||dP(this.body)?null:uP(this.body)?this.body.type||null:cP(this.body)?null:typeof this.body=="string"?hP:this.body instanceof Yl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?gP:null}clone(n={}){let e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=n.transferCache??this.transferCache,s=n.body!==void 0?n.body:this.body,a=n.withCredentials??this.withCredentials,l=n.reportProgress??this.reportProgress,c=n.headers||this.headers,u=n.params||this.params,d=n.context??this.context;return n.setHeaders!==void 0&&(c=Object.keys(n.setHeaders).reduce((p,f)=>p.set(f,n.setHeaders[f]),c)),n.setParams&&(u=Object.keys(n.setParams).reduce((p,f)=>p.set(f,n.setParams[f]),u)),new t(e,r,s,{params:u,headers:c,context:d,reportProgress:l,responseType:o,withCredentials:a,transferCache:i})}},Zl=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Zl||{}),tg=class{headers;status;statusText;url;ok;type;constructor(n,e=200,r="OK"){this.headers=n.headers||new sa,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},bx=class t extends tg{constructor(n={}){super(n)}type=Zl.ResponseHeader;clone(n={}){return new t({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},ng=class t extends tg{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=Zl.Response;clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Xl=class extends tg{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},vP=200,Nee=204;function C1(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}var N1=(()=>{class t{handler;constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof Qh)i=e;else{let l;o.headers instanceof sa?l=o.headers:l=new sa(o.headers);let c;o.params&&(o.params instanceof Yl?c=o.params:c=new Yl({fromObject:o.params})),i=new Qh(e,r,o.body!==void 0?o.body:null,{headers:l,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let s=je(i).pipe(Pl(l=>this.handler.handle(l)));if(e instanceof Qh||o.observe==="events")return s;let a=s.pipe(Br(l=>l instanceof ng));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(We(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Ie(2806,!1);return l.body}));case"blob":return a.pipe(We(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Ie(2807,!1);return l.body}));case"text":return a.pipe(We(l=>{if(l.body!==null&&typeof l.body!="string")throw new Ie(2808,!1);return l.body}));case"json":default:return a.pipe(We(l=>l.body))}case"response":return a;default:throw new Ie(2809,!1)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:new Yl().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,C1(o,r))}post(e,r,o={}){return this.request("POST",e,C1(o,r))}put(e,r,o={}){return this.request("PUT",e,C1(o,r))}static \u0275fac=function(r){return new(r||t)(Me(Jh))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),kee=/^\)\]\}',?\n/;function pP(t){if(t.url)return t.url;let n=D1.toLocaleLowerCase();return t.headers.get(n)}var xP=new ke(""),_1=(()=>{class t{fetchImpl=se(S1,{optional:!0})?.fetch??((...e)=>globalThis.fetch(...e));ngZone=se(bn);handle(e){return new wt(r=>{let o=new AbortController;return this.doRequest(e,o.signal,r).then(T1,i=>r.error(new Xl({error:i}))),()=>o.abort()})}async doRequest(e,r,o){let i=this.createRequestInit(e),s;try{let f=this.ngZone.runOutsideAngular(()=>this.fetchImpl(e.urlWithParams,me({signal:r},i)));Aee(f),o.next({type:Zl.Sent}),s=await f}catch(f){o.error(new Xl({error:f,status:f.status??0,statusText:f.statusText,url:e.urlWithParams,headers:f.headers}));return}let a=new sa(s.headers),l=s.statusText,c=pP(s)??e.urlWithParams,u=s.status,d=null;if(e.reportProgress&&o.next(new bx({headers:a,status:u,statusText:l,url:c})),s.body){let f=s.headers.get("content-length"),m=[],h=s.body.getReader(),g=0,x,b,I=typeof Zone<"u"&&Zone.current;await this.ngZone.runOutsideAngular(async()=>{for(;;){let{done:E,value:S}=await h.read();if(E)break;if(m.push(S),g+=S.length,e.reportProgress){b=e.responseType==="text"?(b??"")+(x??=new TextDecoder).decode(S,{stream:!0}):void 0;let D=()=>o.next({type:Zl.DownloadProgress,total:f?+f:void 0,loaded:g,partialText:b});I?I.run(D):D()}}});let _=this.concatChunks(m,g);try{let E=s.headers.get(Zh)??"";d=this.parseBody(e,_,E)}catch(E){o.error(new Xl({error:E,headers:new sa(s.headers),status:s.status,statusText:s.statusText,url:pP(s)??e.urlWithParams}));return}}u===0&&(u=d?vP:0),u>=200&&u<300?(o.next(new ng({body:d,headers:a,status:u,statusText:l,url:c})),o.complete()):o.error(new Xl({error:d,headers:a,status:u,statusText:l,url:c}))}parseBody(e,r,o){switch(e.responseType){case"json":let i=new TextDecoder().decode(r).replace(kee,"");return i===""?null:JSON.parse(i);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:o});case"arraybuffer":return r.buffer}}createRequestInit(e){let r={},o=e.withCredentials?"include":void 0;if(e.headers.forEach((i,s)=>r[i]=s.join(",")),e.headers.has(xx)||(r[xx]=yP),!e.headers.has(Zh)){let i=e.detectContentTypeHeader();i!==null&&(r[Zh]=i)}return{body:e.serializeBody(),method:e.method,headers:r,credentials:o}}concatChunks(e,r){let o=new Uint8Array(r),i=0;for(let s of e)o.set(s,i),i+=s.length;return o}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),S1=class{};function T1(){}function Aee(t){t.then(T1,T1)}function Ree(t,n){return n(t)}function Mee(t,n,e){return(r,o)=>yr(e,()=>n(r,i=>t(i,o)))}var bP=new ke(""),Fee=new ke(""),Oee=new ke("",{providedIn:"root",factory:()=>!0});var fP=(()=>{class t extends Jh{backend;injector;chain=null;pendingTasks=se(ea);contributeToStability=se(Oee);constructor(e,r){super(),this.backend=e,this.injector=r}handle(e){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(bP),...this.injector.get(Fee,[])]));this.chain=r.reduceRight((o,i)=>Mee(o,i,this.injector),Ree)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(Bs(()=>this.pendingTasks.remove(r)))}else return this.chain(e,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||t)(Me(eg),Me(no))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})();var Pee=/^\)\]\}',?\n/,Lee=RegExp(`^${D1}:`,"m");function $ee(t){return"responseURL"in t&&t.responseURL?t.responseURL:Lee.test(t.getAllResponseHeaders())?t.getResponseHeader(D1):null}var mP=(()=>{class t{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new Ie(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?In(r.\u0275loadImpl()):je(null)).pipe(Io(()=>new wt(i=>{let s=r.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((h,g)=>s.setRequestHeader(h,g.join(","))),e.headers.has(xx)||s.setRequestHeader(xx,yP),!e.headers.has(Zh)){let h=e.detectContentTypeHeader();h!==null&&s.setRequestHeader(Zh,h)}if(e.responseType){let h=e.responseType.toLowerCase();s.responseType=h!=="json"?h:"text"}let a=e.serializeBody(),l=null,c=()=>{if(l!==null)return l;let h=s.statusText||"OK",g=new sa(s.getAllResponseHeaders()),x=$ee(s)||e.url;return l=new bx({headers:g,status:s.status,statusText:h,url:x}),l},u=()=>{let{headers:h,status:g,statusText:x,url:b}=c(),I=null;g!==Nee&&(I=typeof s.response>"u"?s.responseText:s.response),g===0&&(g=I?vP:0);let _=g>=200&&g<300;if(e.responseType==="json"&&typeof I=="string"){let E=I;I=I.replace(Pee,"");try{I=I!==""?JSON.parse(I):null}catch(S){I=E,_&&(_=!1,I={error:S,text:I})}}_?(i.next(new ng({body:I,headers:h,status:g,statusText:x,url:b||void 0})),i.complete()):i.error(new Xl({error:I,headers:h,status:g,statusText:x,url:b||void 0}))},d=h=>{let{url:g}=c(),x=new Xl({error:h,status:s.status||0,statusText:s.statusText||"Unknown Error",url:g||void 0});i.error(x)},p=!1,f=h=>{p||(i.next(c()),p=!0);let g={type:Zl.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),e.responseType==="text"&&s.responseText&&(g.partialText=s.responseText),i.next(g)},m=h=>{let g={type:Zl.UploadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),i.next(g)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),e.reportProgress&&(s.addEventListener("progress",f),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:Zl.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),e.reportProgress&&(s.removeEventListener("progress",f),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(r){return new(r||t)(Me(Jp))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),wP=new ke(""),Vee="XSRF-TOKEN",Bee=new ke("",{providedIn:"root",factory:()=>Vee}),zee="X-XSRF-TOKEN",Uee=new ke("",{providedIn:"root",factory:()=>zee}),wx=class{},jee=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o}getToken(){if(this.platform==="server")return null;let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=yx(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(r){return new(r||t)(Me(Vn),Me(so),Me(Bee))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})();function Gee(t,n){let e=t.url.toLowerCase();if(!se(wP)||t.method==="GET"||t.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return n(t);let r=se(wx).getToken(),o=se(Uee);return r!=null&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var CP=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(CP||{});function Wee(t,n){return{\u0275kind:t,\u0275providers:n}}function _P(...t){let n=[N1,mP,fP,{provide:Jh,useExisting:fP},{provide:eg,useFactory:()=>se(xP,{optional:!0})??se(mP)},{provide:bP,useValue:Gee,multi:!0},{provide:wP,useValue:!0},{provide:wx,useClass:jee}];for(let e of t)n.push(...e.\u0275providers);return Hp(n)}function IP(){return Wee(CP.Fetch,[_1,{provide:xP,useExisting:_1},{provide:eg,useExisting:_1}])}var A1=class extends fx{supportsDOMEvents=!0},R1=class t extends A1{static makeCurrent(){tP(new t)}onAndCancel(n,e,r,o){return n.addEventListener(e,r,o),()=>{n.removeEventListener(e,r,o)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=qee();return e==null?null:Kee(e)}resetBaseElement(){rg=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return yx(document.cookie,n)}},rg=null;function qee(){return rg=rg||document.querySelector("base"),rg?rg.getAttribute("href"):null}function Kee(t){return new URL(t,document.baseURI).pathname}var Xee=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),M1=new ke(""),kP=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new Ie(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||t)(Me(M1),Me(bn))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),_x=class{_doc;constructor(n){this._doc=n}manager},Cx="ng-app-id";function EP(t){for(let n of t)n.remove()}function SP(t,n){let e=n.createElement("style");return e.textContent=t,e}function Yee(t,n,e,r){let o=t.head?.querySelectorAll(`style[${Cx}="${n}"],link[${Cx}="${n}"]`);if(o)for(let i of o)i.removeAttribute(Cx),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function F1(t,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}var AP=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=w1(i),Yee(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,SP);r?.forEach(o=>this.addUsage(o,this.external,F1))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(EP(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])EP(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,SP(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,F1(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(Cx,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||t)(Me(Vn),Me(Xv),Me(Hh,8),Me(so))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),k1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},P1=/%COMP%/g;var RP="%COMP%",Zee=`_nghost-${RP}`,Qee=`_ngcontent-${RP}`,Jee=!0,ete=new ke("",{providedIn:"root",factory:()=>Jee});function tte(t){return Qee.replace(P1,t)}function nte(t){return Zee.replace(P1,t)}function MP(t,n){return n.map(e=>e.replace(P1,t))}var TP=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=w1(a),this.defaultRenderer=new og(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===ls.ShadowDom&&(r=Ue(me({},r),{encapsulation:ls.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof Ix?o.applyToHost(e):o instanceof ig&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,p=this.tracingService;switch(r.encapsulation){case ls.Emulated:i=new Ix(l,c,r,this.appId,u,s,a,d,p);break;case ls.ShadowDom:return new O1(l,c,e,r,s,a,this.nonce,d,p);default:i=new ig(l,c,r,u,s,a,d,p);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||t)(Me(kP),Me(AP),Me(Xv),Me(ete),Me(Vn),Me(so),Me(bn),Me(Hh),Me(Yv,8))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),og=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,r,o,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(k1[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(DP(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(DP(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){e.remove()}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new Ie(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=k1[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=k1[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(Ks.DashCase|Ks.Important)?n.style.setProperty(e,r,o&Ks.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&Ks.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r,o){if(typeof n=="string"&&(n=ia().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${e}`);let i=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,e,i)),this.eventManager.addEventListener(n,e,i,o)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function DP(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var O1=class extends og{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,l,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=MP(o.id,u);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let d=o.getExternalStyles?.();if(d)for(let p of d){let f=F1(p,i);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},ig=class extends og{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let u=r.styles;this.styles=c?MP(c,u):u,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Ix=class extends ig{contentAttr;hostAttr;constructor(n,e,r,o,i,s,a,l,c){let u=o+"-"+r.id;super(n,e,r,i,s,a,l,c,u),this.contentAttr=tte(u),this.hostAttr=nte(u)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}},rte=(()=>{class t extends _x{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||t)(Me(Vn))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),NP=["alt","control","meta","shift"],ote={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ite={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},ste=(()=>{class t extends _x{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ia().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),NP.forEach(c=>{let u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=ote[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),NP.forEach(s=>{if(s!==o){let a=ite[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||t)(Me(Vn))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})();function FP(t,n){return WO(me({rootComponent:t},ate(n)))}function ate(t){return{appProviders:[...pte,...t?.providers??[]],platformProviders:dte}}function lte(){R1.makeCurrent()}function cte(){return new To}function ute(){return xF(document),document}var dte=[{provide:so,useValue:b1},{provide:BS,useValue:lte,multi:!0},{provide:Vn,useFactory:ute,deps:[]}];var pte=[{provide:Lv,useValue:"root"},{provide:To,useFactory:cte,deps:[]},{provide:M1,useClass:rte,multi:!0,deps:[Vn,bn,so]},{provide:M1,useClass:ste,multi:!0,deps:[Vn]},TP,AP,kP,{provide:Gp,useExisting:TP},{provide:Jp,useClass:Xee,deps:[]},[]];var OP=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||t)(Me(Vn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var L1=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:function(r){let o=null;return r?o=new(r||t):o=Me(fte),o},providedIn:"root"})}return t})(),fte=(()=>{class t extends L1{_doc;constructor(e){super(),this._doc=e}sanitize(e,r){if(r==null)return null;switch(e){case Nr.NONE:return r;case Nr.HTML:return Gl(r,"HTML")?Ri(r):FF(this._doc,String(r)).toString();case Nr.STYLE:return Gl(r,"Style")?Ri(r):r;case Nr.SCRIPT:if(Gl(r,"Script"))return Ri(r);throw new Ie(5200,!1);case Nr.URL:return Gl(r,"URL")?Ri(r):Qv(String(r));case Nr.RESOURCE_URL:if(Gl(r,"ResourceURL"))return Ri(r);throw new Ie(5201,!1);default:throw new Ie(5202,!1)}}bypassSecurityTrustHtml(e){return IF(e)}bypassSecurityTrustStyle(e){return EF(e)}bypassSecurityTrustScript(e){return SF(e)}bypassSecurityTrustUrl(e){return TF(e)}bypassSecurityTrustResourceUrl(e){return DF(e)}static \u0275fac=function(r){return new(r||t)(Me(Vn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var st="primary",bg=Symbol("RouteTitle"),U1=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function af(t){return new U1(t)}function hte(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=t[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function gte(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!ps(t[e],n[e]))return!1;return!0}function ps(t,n){let e=t?j1(t):void 0,r=n?j1(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!GP(t[o],n[o]))return!1;return!0}function j1(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function GP(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function WP(t){return t.length>0?t[t.length-1]:null}function Jl(t){return ZI(t)?t:qu(t)?In(Promise.resolve(t)):je(t)}var yte={exact:qP,subset:KP},HP={exact:vte,subset:xte,ignored:()=>!0};function LP(t,n,e){return yte[e.paths](t.root,n.root,e.matrixParams)&&HP[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function vte(t,n){return ps(t,n)}function qP(t,n,e){if(!Qu(t.segments,n.segments)||!Tx(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!qP(t.children[r],n.children[r],e))return!1;return!0}function xte(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>GP(t[e],n[e]))}function KP(t,n,e){return XP(t,n,n.segments,e)}function XP(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!Qu(o,e)||n.hasChildren()||!Tx(o,e,r))}else if(t.segments.length===e.length){if(!Qu(t.segments,e)||!Tx(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!KP(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!Qu(t.segments,o)||!Tx(t.segments,o,r)||!t.children[st]?!1:XP(t.children[st],n,i,r)}}function Tx(t,n,e){return n.every((r,o)=>HP[e](t[o].parameters,r.parameters))}var la=class{root;queryParams;fragment;_queryParamMap;constructor(n=new jt([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=af(this.queryParams),this._queryParamMap}toString(){return Cte.serialize(this)}},jt=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Dx(this)}},Zu=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=af(this.parameters),this._parameterMap}toString(){return ZP(this)}};function bte(t,n){return Qu(t,n)&&t.every((e,r)=>ps(e.parameters,n[r].parameters))}function Qu(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function wte(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===st&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==st&&(e=e.concat(n(o,r)))}),e}var hT=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>new dg,providedIn:"root"})}return t})(),dg=class{parse(n){let e=new W1(n);return new la(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${sg(n.root,!0)}`,r=Ete(n.queryParams),o=typeof n.fragment=="string"?`#${_te(n.fragment)}`:"";return`${e}${r}${o}`}},Cte=new dg;function Dx(t){return t.segments.map(n=>ZP(n)).join("/")}function sg(t,n){if(!t.hasChildren())return Dx(t);if(n){let e=t.children[st]?sg(t.children[st],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==st&&r.push(`${o}:${sg(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=wte(t,(r,o)=>o===st?[sg(t.children[st],!1)]:[`${o}:${sg(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[st]!=null?`${Dx(t)}/${e[0]}`:`${Dx(t)}/(${e.join("//")})`}}function YP(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ex(t){return YP(t).replace(/%3B/gi,";")}function _te(t){return encodeURI(t)}function G1(t){return YP(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Nx(t){return decodeURIComponent(t)}function $P(t){return Nx(t.replace(/\+/g,"%20"))}function ZP(t){return`${G1(t.path)}${Ite(t.parameters)}`}function Ite(t){return Object.entries(t).map(([n,e])=>`;${G1(n)}=${G1(e)}`).join("")}function Ete(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${Ex(e)}=${Ex(o)}`).join("&"):`${Ex(e)}=${Ex(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var Ste=/^[^\/()?;#]+/;function $1(t){let n=t.match(Ste);return n?n[0]:""}var Tte=/^[^\/()?;=#]+/;function Dte(t){let n=t.match(Tte);return n?n[0]:""}var Nte=/^[^=?&#]+/;function kte(t){let n=t.match(Nte);return n?n[0]:""}var Ate=/^[^&#]+/;function Rte(t){let n=t.match(Ate);return n?n[0]:""}var W1=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new jt([],{}):new jt([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[st]=new jt(n,e)),r}parseSegment(){let n=$1(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new Ie(4009,!1);return this.capture(n),new Zu(Nx(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=Dte(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=$1(this.remaining);o&&(r=o,this.capture(r))}n[Nx(e)]=Nx(r)}parseQueryParam(n){let e=kte(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=Rte(this.remaining);s&&(r=s,this.capture(r))}let o=$P(e),i=$P(r);if(n.hasOwnProperty(o)){let s=n[o];Array.isArray(s)||(s=[s],n[o]=s),s.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=$1(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new Ie(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=st);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[st]:new jt([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new Ie(4011,!1)}};function QP(t){return t.segments.length>0?new jt([],{[st]:t}):t}function JP(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=JP(o);if(r===st&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))n[s]=a;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new jt(t.segments,n);return Mte(e)}function Mte(t){if(t.numberOfChildren===1&&t.children[st]){let n=t.children[st];return new jt(t.segments.concat(n.segments),n.children)}return t}function Ju(t){return t instanceof la}function Fte(t,n,e=null,r=null){let o=eL(t);return tL(o,n,e,r)}function eL(t){let n;function e(i){let s={};for(let l of i.children){let c=e(l);s[l.outlet]=c}let a=new jt(i.url,s);return i===t&&(n=a),a}let r=e(t.root),o=QP(r);return n??o}function tL(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return V1(o,o,o,e,r);let i=Ote(n);if(i.toRoot())return V1(o,o,new jt([],{}),e,r);let s=Pte(i,o,t),a=s.processChildren?lg(s.segmentGroup,s.index,i.commands):rL(s.segmentGroup,s.index,i.commands);return V1(o,s.segmentGroup,a,e,r)}function kx(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function pg(t){return typeof t=="object"&&t!=null&&t.outlets}function V1(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([l,c])=>{i[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;t===n?s=e:s=nL(t,n,e);let a=QP(JP(s));return new la(a,i,o)}function nL(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=nL(i,n,e)}),new jt(t.segments,r)}var Ax=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&kx(r[0]))throw new Ie(4003,!1);let o=r.find(pg);if(o&&o!==WP(r))throw new Ie(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function Ote(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new Ax(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?n++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new Ax(e,n,r)}var rf=class{segmentGroup;processChildren;index;constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function Pte(t,n,e){if(t.isAbsolute)return new rf(n,!0,0);if(!e)return new rf(n,!1,NaN);if(e.parent===null)return new rf(e,!0,0);let r=kx(t.commands[0])?0:1,o=e.segments.length-1+r;return Lte(e,o,t.numberOfDoubleDots)}function Lte(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Ie(4005,!1);o=r.segments.length}return new rf(r,!1,o-i)}function $te(t){return pg(t[0])?t[0].outlets:{[st]:t}}function rL(t,n,e){if(t??=new jt([],{}),t.segments.length===0&&t.hasChildren())return lg(t,n,e);let r=Vte(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new jt(t.segments.slice(0,r.pathIndex),{});return i.children[st]=new jt(t.segments.slice(r.pathIndex),t.children),lg(i,0,o)}else return r.match&&o.length===0?new jt(t.segments,{}):r.match&&!t.hasChildren()?H1(t,n,e):r.match?lg(t,0,o):H1(t,n,e)}function lg(t,n,e){if(e.length===0)return new jt(t.segments,{});{let r=$te(e),o={};if(Object.keys(r).some(i=>i!==st)&&t.children[st]&&t.numberOfChildren===1&&t.children[st].segments.length===0){let i=lg(t.children[st],n,e);return new jt(t.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=rL(t.children[i],n,s))}),Object.entries(t.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new jt(t.segments,o)}}function Vte(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let s=t.segments[o],a=e[r];if(pg(a))break;let l=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!BP(l,c,s))return i;r+=2}else{if(!BP(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function H1(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(pg(i)){let l=Bte(i.outlets);return new jt(r,l)}if(o===0&&kx(e[0])){let l=t.segments[n];r.push(new Zu(l.path,VP(e[0]))),o++;continue}let s=pg(i)?i.outlets[st]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&kx(a)?(r.push(new Zu(s,VP(a))),o+=2):(r.push(new Zu(s,{})),o++)}return new jt(r,{})}function Bte(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=H1(new jt([],{}),0,r))}),n}function VP(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function BP(t,n,e){return t==e.path&&ps(n,e.parameters)}var cg="imperative",xr=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(xr||{}),ti=class{id;url;constructor(n,e){this.id=n,this.url=e}},fg=class extends ti{type=xr.NavigationStart;navigationTrigger;restoredState;constructor(n,e,r="imperative",o=null){super(n,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ql=class extends ti{urlAfterRedirects;type=xr.NavigationEnd;constructor(n,e,r){super(n,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Mo=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(Mo||{}),q1=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(q1||{}),aa=class extends ti{reason;code;type=xr.NavigationCancel;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ed=class extends ti{reason;code;type=xr.NavigationSkipped;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}},mg=class extends ti{error;target;type=xr.NavigationError;constructor(n,e,r,o){super(n,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Rx=class extends ti{urlAfterRedirects;state;type=xr.RoutesRecognized;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},K1=class extends ti{urlAfterRedirects;state;type=xr.GuardsCheckStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},X1=class extends ti{urlAfterRedirects;state;shouldActivate;type=xr.GuardsCheckEnd;constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Y1=class extends ti{urlAfterRedirects;state;type=xr.ResolveStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Z1=class extends ti{urlAfterRedirects;state;type=xr.ResolveEnd;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Q1=class{route;type=xr.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},J1=class{route;type=xr.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},eT=class{snapshot;type=xr.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},tT=class{snapshot;type=xr.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},nT=class{snapshot;type=xr.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},rT=class{snapshot;type=xr.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var hg=class{},lf=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function zte(t,n){return t.providers&&!t._injector&&(t._injector=i1(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Pi(t){return t.outlet||st}function Ute(t,n){let e=t.filter(r=>Pi(r)===n);return e.push(...t.filter(r=>Pi(r)!==n)),e}function wg(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var oT=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return wg(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new Vx(this.rootInjector)}},Vx=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new oT(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||t)(Me(no))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Mx=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=iT(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=iT(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=sT(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return sT(n,this._root).map(e=>e.value)}};function iT(t,n){if(t===n.value)return n;for(let e of n.children){let r=iT(t,e);if(r)return r}return null}function sT(t,n){if(t===n.value)return[n];for(let e of n.children){let r=sT(t,e);if(r.length)return r.unshift(n),r}return[]}var Ro=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function nf(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var Fx=class extends Mx{snapshot;constructor(n,e){super(n),this.snapshot=e,gT(this,n)}toString(){return this.snapshot.toString()}};function oL(t){let n=jte(t),e=new hr([new Zu("",{})]),r=new hr({}),o=new hr({}),i=new hr({}),s=new hr(""),a=new Li(e,r,i,s,o,st,t,n.root);return a.snapshot=n.root,new Fx(new Ro(a,[]),n)}function jte(t){let n={},e={},r={},o="",i=new of([],n,r,o,e,st,t,null,{});return new Px("",new Ro(i,[]))}var Li=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,r,o,i,s,a,l){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(We(c=>c[bg]))??je(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(We(n=>af(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(We(n=>af(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Ox(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:me(me({},n.params),t.params),data:me(me({},n.data),t.data),resolve:me(me(me(me({},t.data),n.data),o?.data),t._resolvedData)}:r={params:me({},t.params),data:me({},t.data),resolve:me(me({},t.data),t._resolvedData??{})},o&&sL(o)&&(r.resolve[bg]=o.title),r}var of=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[bg]}constructor(n,e,r,o,i,s,a,l,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=af(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=af(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},Px=class extends Mx{url;constructor(n,e){super(e),this.url=n,gT(this,e)}toString(){return iL(this._root)}};function gT(t,n){n.value._routerState=t,n.children.forEach(e=>gT(t,e))}function iL(t){let n=t.children.length>0?` { ${t.children.map(iL).join(", ")} } `:"";return`${t.value}${n}`}function B1(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,ps(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),ps(n.params,e.params)||t.paramsSubject.next(e.params),gte(n.url,e.url)||t.urlSubject.next(e.url),ps(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function aT(t,n){let e=ps(t.params,n.params)&&bte(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||aT(t.parent,n.parent))}function sL(t){return typeof t.title=="string"||t.title===null}var Gte=new ke(""),yT=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=st;activateEvents=new Lt;deactivateEvents=new Lt;attachEvents=new Lt;detachEvents=new Lt;routerOutletData=dF(void 0);parentContexts=se(Vx);location=se(Wl);changeDetector=se(vt);inputBinder=se(vT,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ie(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ie(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ie(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Ie(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new lT(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Nt({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Xo]})}return t})(),lT=class t{route;childContexts;parent;outletData;__ngOutletInjector(n){return new t(this.route,this.childContexts,n,this.outletData)}constructor(n,e,r,o){this.route=n,this.childContexts=e,this.parent=r,this.outletData=o}get(n,e){return n===Li?this.route:n===Vx?this.childContexts:n===Gte?this.outletData:this.parent.get(n,e)}},vT=new ke("");function Wte(t,n,e){let r=gg(t,n._root,e?e._root:void 0);return new Fx(r,n)}function gg(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=Hte(t,n,e);return new Ro(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>gg(t,a)),s}}let r=qte(n.value),o=n.children.map(i=>gg(t,i));return new Ro(r,o)}}function Hte(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return gg(t,r,o);return gg(t,r)})}function qte(t){return new Li(new hr(t.url),new hr(t.params),new hr(t.queryParams),new hr(t.fragment),new hr(t.data),t.outlet,t.component,t)}var yg=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},aL="ngNavigationCancelingError";function Lx(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Ju(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=lL(!1,Mo.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function lL(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[aL]=!0,e.cancellationCode=n,e}function Kte(t){return cL(t)&&Ju(t.url)}function cL(t){return!!t&&t[aL]}var Xte=(t,n,e,r)=>We(o=>(new cT(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),cT=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),B1(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=nf(e);n.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=nf(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=nf(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=nf(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new rT(i.value.snapshot))}),n.children.length&&this.forwardEvent(new tT(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(B1(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),B1(a.route.value),this.activateChildRoutes(n,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(n,null,s.children)}else this.activateChildRoutes(n,null,r)}},$x=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},sf=class{component;route;constructor(n,e){this.component=n,this.route=e}};function Yte(t,n,e){let r=t._root,o=n?n._root:null;return ag(r,o,e,[r.value])}function Zte(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function uf(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!o2(t)?t:n.get(t):r}function ag(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=nf(n);return t.children.forEach(s=>{Qte(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>ug(a,e.getContext(s),o)),o}function Qte(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=Jte(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new $x(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?ag(t,n,a?a.children:null,r,o):ag(t,n,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new sf(a.outlet.component,s))}else s&&ug(n,a,o),o.canActivateChecks.push(new $x(r)),i.component?ag(t,null,a?a.children:null,r,o):ag(t,null,e,r,o);return o}function Jte(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!Qu(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Qu(t.url,n.url)||!ps(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!aT(t,n)||!ps(t.queryParams,n.queryParams);case"paramsChange":default:return!aT(t,n)}}function ug(t,n,e){let r=nf(t),o=t.value;Object.entries(r).forEach(([i,s])=>{o.component?n?ug(s,n.children.getContext(i),e):ug(s,null,e):ug(s,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new sf(n.outlet.component,o)):e.canDeactivateChecks.push(new sf(null,o)):e.canDeactivateChecks.push(new sf(null,o))}function Cg(t){return typeof t=="function"}function ene(t){return typeof t=="boolean"}function tne(t){return t&&Cg(t.canLoad)}function nne(t){return t&&Cg(t.canActivate)}function rne(t){return t&&Cg(t.canActivateChild)}function one(t){return t&&Cg(t.canDeactivate)}function ine(t){return t&&Cg(t.canMatch)}function uL(t){return t instanceof Vs||t?.name==="EmptyError"}var Sx=Symbol("INITIAL_VALUE");function cf(){return Io(t=>kp(t.map(n=>n.pipe(_o(1),Sh(Sx)))).pipe(We(n=>{for(let e of n)if(e!==!0){if(e===Sx)return Sx;if(e===!1||sne(e))return e}return!0}),Br(n=>n!==Sx),_o(1)))}function sne(t){return Ju(t)||t instanceof yg}function ane(t,n){return Xn(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?je(Ue(me({},e),{guardsResult:!0})):lne(s,r,o,t).pipe(Xn(a=>a&&ene(a)?cne(r,i,t,n):je(a)),We(a=>Ue(me({},e),{guardsResult:a})))})}function lne(t,n,e,r){return In(t).pipe(Xn(o=>mne(o.component,o.route,e,n,r)),zs(o=>o!==!0,!0))}function cne(t,n,e,r){return In(n).pipe(Pl(o=>Ol(dne(o.route.parent,r),une(o.route,r),fne(t,o.path,e),pne(t,o.route,e))),zs(o=>o!==!0,!0))}function une(t,n){return t!==null&&n&&n(new nT(t)),je(!0)}function dne(t,n){return t!==null&&n&&n(new eT(t)),je(!0)}function pne(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return je(!0);let o=r.map(i=>H0(()=>{let s=wg(n)??e,a=uf(i,s),l=nne(a)?a.canActivate(n,t):yr(s,()=>a(n,t));return Jl(l).pipe(zs())}));return je(o).pipe(cf())}function fne(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(s=>Zte(s)).filter(s=>s!==null).map(s=>H0(()=>{let a=s.guards.map(l=>{let c=wg(s.node)??e,u=uf(l,c),d=rne(u)?u.canActivateChild(r,t):yr(c,()=>u(r,t));return Jl(d).pipe(zs())});return je(a).pipe(cf())}));return je(i).pipe(cf())}function mne(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return je(!0);let s=i.map(a=>{let l=wg(n)??o,c=uf(a,l),u=one(c)?c.canDeactivate(t,n,e,r):yr(l,()=>c(t,n,e,r));return Jl(u).pipe(zs())});return je(s).pipe(cf())}function hne(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return je(!0);let i=o.map(s=>{let a=uf(s,t),l=tne(a)?a.canLoad(n,e):yr(t,()=>a(n,e));return Jl(l)});return je(i).pipe(cf(),dL(r))}function dL(t){return HI(Dn(n=>{if(typeof n!="boolean")throw Lx(t,n)}),We(n=>n===!0))}function gne(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return je(!0);let i=o.map(s=>{let a=uf(s,t),l=ine(a)?a.canMatch(n,e):yr(t,()=>a(n,e));return Jl(l)});return je(i).pipe(cf(),dL(r))}var vg=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},xg=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function tf(t){return Fl(new vg(t))}function yne(t){return Fl(new Ie(4e3,!1))}function vne(t){return Fl(lL(!1,Mo.GuardRejected))}var uT=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return je(r);if(o.numberOfChildren>1||!o.children[st])return yne(`${n.redirectTo}`);o=o.children[st]}}applyRedirectCommands(n,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,params:f,data:m,title:h}=o,g=yr(i,()=>a({params:f,data:m,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,title:h}));if(g instanceof la)throw new xg(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e[0]==="/")throw new xg(s);return s}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new la(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(n,l,r,o)}),new jt(i,s)}createSegments(n,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new Ie(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},dT={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function xne(t,n,e,r,o){let i=pL(t,n,e);return i.matched?(r=zte(n,r),gne(r,n,e,o).pipe(We(s=>s===!0?i:me({},dT)))):je(i)}function pL(t,n,e){if(n.path==="**")return bne(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?me({},dT):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||hte)(e,t,n);if(!o)return me({},dT);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?me(me({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function bne(t){return{matched:!0,parameters:t.length>0?WP(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function zP(t,n,e,r){return e.length>0&&_ne(t,e,r)?{segmentGroup:new jt(n,Cne(r,new jt(e,t.children))),slicedSegments:[]}:e.length===0&&Ine(t,e,r)?{segmentGroup:new jt(t.segments,wne(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new jt(t.segments,t.children),slicedSegments:e}}function wne(t,n,e,r){let o={};for(let i of e)if(Bx(t,n,i)&&!r[Pi(i)]){let s=new jt([],{});o[Pi(i)]=s}return me(me({},r),o)}function Cne(t,n){let e={};e[st]=n;for(let r of t)if(r.path===""&&Pi(r)!==st){let o=new jt([],{});e[Pi(r)]=o}return e}function _ne(t,n,e){return e.some(r=>Bx(t,n,r)&&Pi(r)!==st)}function Ine(t,n,e){return e.some(r=>Bx(t,n,r))}function Bx(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function Ene(t,n,e){return n.length===0&&!t.children[e]}var pT=class{};function Sne(t,n,e,r,o,i,s="emptyOnly"){return new fT(t,n,e,r,o,s,i).recognize()}var Tne=31,fT=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,r,o,i,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new uT(this.urlSerializer,this.urlTree)}noMatchError(n){return new Ie(4002,`'${n.segmentGroup}'`)}recognize(){let n=zP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(We(({children:e,rootSnapshot:r})=>{let o=new Ro(r,e),i=new Px("",o),s=Fte(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(n){let e=new of([],Object.freeze({}),Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),st,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,st,e).pipe(We(r=>({children:r,rootSnapshot:e})),os(r=>{if(r instanceof xg)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof vg?this.noMatchError(r):r}))}processSegmentGroup(n,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r,i):this.processSegment(n,e,r,r.segments,o,!0,i).pipe(We(s=>s instanceof Ro?[s]:[]))}processChildren(n,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return In(i).pipe(Pl(s=>{let a=r.children[s],l=Ute(e,s);return this.processSegmentGroup(n,l,a,s,o)}),tE((s,a)=>(s.push(...a),s)),Ll(null),eE(),Xn(s=>{if(s===null)return tf(r);let a=fL(s);return Dne(a),je(a)}))}processSegment(n,e,r,o,i,s,a){return In(e).pipe(Pl(l=>this.processSegmentAgainstRoute(l._injector??n,e,l,r,o,i,s,a).pipe(os(c=>{if(c instanceof vg)return je(null);throw c}))),zs(l=>!!l),os(l=>{if(uL(l))return Ene(r,o,i)?je(new pT):tf(r);throw l}))}processSegmentAgainstRoute(n,e,r,o,i,s,a,l){return Pi(r)!==s&&(s===st||!Bx(o,i,r))?tf(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,s,l):tf(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:p}=pL(e,o,i);if(!l)return tf(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Tne&&(this.allowRedirects=!1));let f=new of(i,c,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,UP(o),Pi(o),o.component??o._loadedComponent??null,o,jP(o)),m=Ox(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(m.params),f.data=Object.freeze(m.data);let h=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,f,n);return this.applyRedirects.lineralizeSegments(o,h).pipe(Xn(g=>this.processSegment(n,r,e,g.concat(p),s,!1,a)))}matchSegmentAgainstRoute(n,e,r,o,i,s){let a=xne(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(Io(l=>l.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(Io(({routes:c})=>{let u=r._loadedInjector??n,{parameters:d,consumedSegments:p,remainingSegments:f}=l,m=new of(p,d,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,UP(r),Pi(r),r.component??r._loadedComponent??null,r,jP(r)),h=Ox(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(h.params),m.data=Object.freeze(h.data);let{segmentGroup:g,slicedSegments:x}=zP(e,p,f,c);if(x.length===0&&g.hasChildren())return this.processChildren(u,c,g,m).pipe(We(I=>new Ro(m,I)));if(c.length===0&&x.length===0)return je(new Ro(m,[]));let b=Pi(r)===i;return this.processSegment(u,c,g,x,b?st:i,!0,m).pipe(We(I=>new Ro(m,I instanceof Ro?[I]:[])))}))):tf(e)))}getChildConfig(n,e,r){return e.children?je({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?je({routes:e._loadedRoutes,injector:e._loadedInjector}):hne(n,e,r,this.urlSerializer).pipe(Xn(o=>o?this.configLoader.loadChildren(n,e).pipe(Dn(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):vne(e))):je({routes:[],injector:n})}};function Dne(t){t.sort((n,e)=>n.value.outlet===st?-1:e.value.outlet===st?1:n.value.outlet.localeCompare(e.value.outlet))}function Nne(t){let n=t.value.routeConfig;return n&&n.path===""}function fL(t){let n=[],e=new Set;for(let r of t){if(!Nne(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=fL(r.children);n.push(new Ro(r.value,o))}return n.filter(r=>!e.has(r))}function UP(t){return t.data||{}}function jP(t){return t.resolve||{}}function kne(t,n,e,r,o,i){return Xn(s=>Sne(t,n,e,r,s.extractedUrl,o,i).pipe(We(({state:a,tree:l})=>Ue(me({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function Ane(t,n){return Xn(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return je(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let c of mL(l))s.add(c);let a=0;return In(s).pipe(Pl(l=>i.has(l)?Rne(l,r,t,n):(l.data=Ox(l,l.parent,t).resolve,je(void 0))),Dn(()=>a++),Ap(1),Xn(l=>a===s.size?je(e):Qr))})}function mL(t){let n=t.children.map(e=>mL(e)).flat();return[t,...n]}function Rne(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!sL(o)&&(i[bg]=o.title),Mne(i,t,n,r).pipe(We(s=>(t._resolvedData=s,t.data=Ox(t,t.parent,e).resolve,null)))}function Mne(t,n,e,r){let o=j1(t);if(o.length===0)return je({});let i={};return In(o).pipe(Xn(s=>Fne(t[s],n,e,r).pipe(zs(),Dn(a=>{if(a instanceof yg)throw Lx(new dg,a);i[s]=a}))),Ap(1),We(()=>i),os(s=>uL(s)?Qr:Fl(s)))}function Fne(t,n,e,r){let o=wg(n)??r,i=uf(t,o),s=i.resolve?i.resolve(n,e):yr(o,()=>i(n,e));return Jl(s)}function z1(t){return Io(n=>{let e=t(n);return e?In(e).pipe(We(()=>n)):je(n)})}var hL=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===st);return r}getResolvedTitleForRoute(e){return e.data[bg]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>se(One),providedIn:"root"})}return t})(),One=(()=>{class t extends hL{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)(Me(OP))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),xT=new ke("",{providedIn:"root",factory:()=>({})}),Pne=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=it({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&U(0,"router-outlet")},dependencies:[yT],encapsulation:2})}return t})();function bT(t){let n=t.children&&t.children.map(bT),e=n?Ue(me({},t),{children:n}):me({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==st&&(e.component=Pne),e}var wT=new ke(""),Lne=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=se(p1);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return je(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=Jl(e.loadComponent()).pipe(We(gL),Dn(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),Bs(()=>{this.componentLoaders.delete(e)})),o=new Dp(r,()=>new xn).pipe(Tp());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return je({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=$ne(r,this.compiler,e,this.onLoadEndListener).pipe(Bs(()=>{this.childrenLoaders.delete(r)})),s=new Dp(i,()=>new xn).pipe(Tp());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function $ne(t,n,e,r){return Jl(t.loadChildren()).pipe(We(gL),Xn(o=>o instanceof Bh||Array.isArray(o)?je(o):In(n.compileModuleAsync(o))),We(o=>{r&&r(t);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(wT,[],{optional:!0,self:!0}).flat()),{routes:s.map(bT),injector:i}}))}function Vne(t){return t&&typeof t=="object"&&"default"in t}function gL(t){return Vne(t)?t.default:t}var CT=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>se(Bne),providedIn:"root"})}return t})(),Bne=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),zne=new ke("");var Une=new ke(""),jne=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new xn;transitionAbortSubject=new xn;configLoader=se(Lne);environmentInjector=se(no);destroyRef=se(Kp);urlSerializer=se(hT);rootContexts=se(Vx);location=se(Yh);inputBindingEnabled=se(vT,{optional:!0})!==null;titleStrategy=se(hL);options=se(xT,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=se(CT);createViewTransition=se(zne,{optional:!0});navigationErrorHandler=se(Une,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>je(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new Q1(o)),r=o=>this.events.next(new J1(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(Ue(me(me({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new hr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:cg,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Br(i=>i.id!==0),We(i=>Ue(me({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),Io(i=>{let s=!1,a=!1;return je(i).pipe(Io(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",Mo.SupersededByNewNavigation),Qr;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?Ue(me({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&u!=="reload"){let d="";return this.events.next(new ed(l.id,this.urlSerializer.serialize(l.rawUrl),d,q1.IgnoredSameUrlNavigation)),l.resolve(!1),Qr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return je(l).pipe(Io(d=>{let p=this.transitions?.getValue();return this.events.next(new fg(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?Qr:Promise.resolve(d)}),kne(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Dn(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=Ue(me({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let p=new Rx(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:p,source:f,restoredState:m,extras:h}=l,g=new fg(d,this.urlSerializer.serialize(p),f,m);this.events.next(g);let x=oL(this.rootComponentType).snapshot;return this.currentTransition=i=Ue(me({},l),{targetSnapshot:x,urlAfterRedirects:p,extras:Ue(me({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,je(i)}else{let d="";return this.events.next(new ed(l.id,this.urlSerializer.serialize(l.extractedUrl),d,q1.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Qr}}),Dn(l=>{let c=new K1(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),We(l=>(this.currentTransition=i=Ue(me({},l),{guards:Yte(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),ane(this.environmentInjector,l=>this.events.next(l)),Dn(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw Lx(this.urlSerializer,l.guardsResult);let c=new X1(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),Br(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",Mo.GuardRejected),!1)),z1(l=>{if(l.guards.canActivateChecks.length)return je(l).pipe(Dn(c=>{let u=new Y1(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),Io(c=>{let u=!1;return je(c).pipe(Ane(this.paramsInheritanceStrategy,this.environmentInjector),Dn({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",Mo.NoDataFromResolver)}}))}),Dn(c=>{let u=new Z1(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),z1(l=>{let c=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(Dn(p=>{u.component=p}),We(()=>{})));for(let p of u.children)d.push(...c(p));return d};return kp(c(l.targetSnapshot.root)).pipe(Ll(null),_o(1))}),z1(()=>this.afterPreactivation()),Io(()=>{let{currentSnapshot:l,targetSnapshot:c}=i,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?In(u).pipe(We(()=>i)):je(i)}),We(l=>{let c=Wte(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=Ue(me({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),Dn(()=>{this.events.next(new hg)}),Xte(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),_o(1),Dn({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ql(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),Th(this.transitionAbortSubject.pipe(Dn(l=>{throw l}))),Bs(()=>{!s&&!a&&this.cancelNavigationTransition(i,"",Mo.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),os(l=>{if(this.destroyed)return i.resolve(!1),Qr;if(a=!0,cL(l))this.events.next(new aa(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),Kte(l)?this.events.next(new lf(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let c=new mg(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let u=yr(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof yg){let{message:d,cancellationCode:p}=Lx(this.urlSerializer,u);this.events.next(new aa(i.id,this.urlSerializer.serialize(i.extractedUrl),d,p)),this.events.next(new lf(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return Qr}))}))}cancelNavigationTransition(e,r,o){let i=new aa(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Gne(t){return t!==cg}var Wne=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>se(Hne),providedIn:"root"})}return t})(),mT=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},Hne=(()=>{class t extends mT{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),yL=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>se(qne),providedIn:"root"})}return t})(),qne=(()=>{class t extends yL{location=se(Yh);urlSerializer=se(hT);options=se(xT,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=se(CT);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new la;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=oL(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof fg)this.stateMemento=this.createStateMemento();else if(e instanceof ed)this.rawUrlTree=r.initialUrl;else if(e instanceof Rx){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else e instanceof hg?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):e instanceof aa&&(e.code===Mo.GuardRejected||e.code===Mo.NoDataFromResolver)?this.restoreHistory(r):e instanceof mg?this.restoreHistory(r,!0):e instanceof Ql&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=e instanceof la?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,s=me(me({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",s)}else{let i=me(me({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Kne(t,n){t.events.pipe(Br(e=>e instanceof Ql||e instanceof aa||e instanceof mg||e instanceof ed),We(e=>e instanceof Ql||e instanceof ed?0:(e instanceof aa?e.code===Mo.Redirect||e.code===Mo.SupersededByNewNavigation:!1)?2:1),Br(e=>e!==2),_o(1)).subscribe(()=>{n()})}var Xne={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Yne={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},Fo=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=se(a1);stateManager=se(yL);options=se(xT,{optional:!0})||{};pendingTasks=se(ea);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=se(jne);urlSerializer=se(hT);location=se(Yh);urlHandlingStrategy=se(CT);_events=new xn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=se(Wne);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=se(wT,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!se(vT,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new vn;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof aa&&r.code!==Mo.Redirect&&r.code!==Mo.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Ql)this.navigated=!0;else if(r instanceof lf){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=me({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||Gne(o.source)},s);this.scheduleNavigation(a,cg,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}Qne(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),cg,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=me({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(bT),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=me(me({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let p=o?o.snapshot:this.routerState.snapshot.root;d=eL(p)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),d=this.currentUrlTree.root}return tL(d,e,u,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Ju(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,cg,null,r)}navigate(e,r={skipLocationChange:!1}){return Zne(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=me({},Xne):r===!1?o=me({},Yne):o=r,Ju(e))return LP(this.currentUrlTree,e,o);let i=this.parseUrl(e);return LP(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,p)=>{a=d,l=p});let u=this.pendingTasks.add();return Kne(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Zne(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new Ie(4008,!1)}function Qne(t){return!(t instanceof hg)&&!(t instanceof lf)}var zn=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new xn;constructor(e,r,o,i,s,a){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a;let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof Ql&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Ju(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,r,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||r||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.href=e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;let r=this.href===null?null:OF(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(e,r){let o=this.renderer,i=this.el.nativeElement;r!==null?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return this.routerLinkInput===null?null:Ju(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(r){return new(r||t)(ne(Fo),ne(Li),qv("tabindex"),ne(Mi),ne(Yn),ne(ef))};static \u0275dir=Nt({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,o){r&1&&te("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),r&2&&us("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Fi],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Fi],replaceUrl:[2,"replaceUrl","replaceUrl",Fi],routerLink:"routerLink"},features:[Hu,Xo]})}return t})();var Jne=new ke("");function vL(t,...n){return Hp([{provide:wT,multi:!0,useValue:t},[],{provide:Li,useFactory:ere,deps:[Fo]},{provide:tx,multi:!0,useFactory:tre},n.map(e=>e.\u0275providers)])}function ere(t){return t.routerState.root}function tre(){let t=se(Pn);return n=>{let e=t.get(Ys);if(n!==e.components[0])return;let r=t.get(Fo),o=t.get(nre);t.get(rre)===1&&r.initialNavigation(),t.get(ore,null,ct.Optional)?.setUpPreloading(),t.get(Jne,null,ct.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var nre=new ke("",{factory:()=>new xn}),rre=new ke("",{providedIn:"root",factory:()=>1});var ore=new ke("");var xL=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)};var Ig=class extends Error{constructor(n,e="FunctionsError",r){super(n),this.name=e,this.context=r}},zx=class extends Ig{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}},Ux=class extends Ig{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}},jx=class extends Ig{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}},_T=function(t){return t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2",t}(_T||{});var ire=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Eg=class{constructor(n,{headers:e={},customFetch:r,region:o=_T.Any}={}){this.url=n,this.headers=e,this.region=o,this.fetch=xL(r)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,e={}){var r;return ire(this,void 0,void 0,function*(){try{let{headers:o,method:i,body:s}=e,a={},{region:l}=e;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;s&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=s):typeof s=="string"?(a["Content-Type"]="text/plain",c=s):typeof FormData<"u"&&s instanceof FormData?c=s:(a["Content-Type"]="application/json",c=JSON.stringify(s)));let u=yield this.fetch(`${this.url}/${n}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:c}).catch(m=>{throw new zx(m)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new Ux(u);if(!u.ok)throw new jx(u);let p=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return p==="application/json"?f=yield u.json():p==="application/octet-stream"?f=yield u.blob():p==="text/event-stream"?f=u:p==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(o){return{data:null,error:o}}})}};var RL=vh(AL(),1),{PostgrestClient:ML,PostgrestQueryBuilder:Tke,PostgrestFilterBuilder:Dke,PostgrestTransformBuilder:Nke,PostgrestBuilder:kke,PostgrestError:yre}=RL.default;var FL="2.11.2";var OL={"X-Client-Info":`realtime-js/${FL}`},PL="1.0.0",qx=1e4,LL=1e3,pf=function(t){return t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed",t}(pf||{}),Oo=function(t){return t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving",t}(Oo||{}),ni=function(t){return t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token",t}(ni||{}),OT=function(t){return t.websocket="websocket",t}(OT||{}),td=function(t){return t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed",t}(td||{});var Kx=class{constructor(){this.HEADER_LENGTH=1}decode(n,e){return n.constructor===ArrayBuffer?e(this._binaryDecode(n)):e(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){let e=new DataView(n),r=new TextDecoder;return this._decodeBroadcast(n,e,r)}_decodeBroadcast(n,e,r){let o=e.getUint8(1),i=e.getUint8(2),s=this.HEADER_LENGTH+2,a=r.decode(n.slice(s,s+o));s=s+o;let l=r.decode(n.slice(s,s+i));s=s+i;let c=JSON.parse(r.decode(n.slice(s,n.byteLength)));return{ref:null,topic:a,event:l,payload:c}}};var ff=class{constructor(n,e){this.callback=n,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var pn=function(t){return t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange",t}(pn||{}),LT=(t,n,e={})=>{var r;let o=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(n).reduce((i,s)=>(i[s]=vre(s,t,n,o),i),{})},vre=(t,n,e,r)=>{let o=n.find(a=>a.name===t),i=o?.type,s=e[t];return i&&!r.includes(i)?$L(i,s):PT(s)},$L=(t,n)=>{if(t.charAt(0)==="_"){let e=t.slice(1,t.length);return Cre(n,e)}switch(t){case pn.bool:return xre(n);case pn.float4:case pn.float8:case pn.int2:case pn.int4:case pn.int8:case pn.numeric:case pn.oid:return bre(n);case pn.json:case pn.jsonb:return wre(n);case pn.timestamp:return _re(n);case pn.abstime:case pn.date:case pn.daterange:case pn.int4range:case pn.int8range:case pn.money:case pn.reltime:case pn.text:case pn.time:case pn.timestamptz:case pn.timetz:case pn.tsrange:case pn.tstzrange:return PT(n);default:return PT(n)}},PT=t=>t,xre=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},bre=t=>{if(typeof t=="string"){let n=parseFloat(t);if(!Number.isNaN(n))return n}return t},wre=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(n){return console.log(`JSON parse error: ${n}`),t}return t},Cre=(t,n)=>{if(typeof t!="string")return t;let e=t.length-1,r=t[e];if(t[0]==="{"&&r==="}"){let i,s=t.slice(1,e);try{i=JSON.parse("["+s+"]")}catch{i=s?s.split(","):[]}return i.map(a=>$L(n,a))}return t},_re=t=>typeof t=="string"?t.replace(" ","T"):t,Xx=t=>{let n=t;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};var mf=class{constructor(n,e,r={},o=qx){this.channel=n,this.event=e,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,e){var r;return this._hasReceived(n)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:n,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let n=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:e}){this.recHooks.filter(r=>r.status===n).forEach(r=>r.callback(e))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}};var Rg=class t{constructor(n,e){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,o,i,s),this.pendingDiffs.forEach(l=>{this.state=t.syncDiff(this.state,l,i,s)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t.syncDiff(this.state,o,i,s),a())}),this.onJoin((o,i,s)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:i,newPresences:s})}),this.onLeave((o,i,s)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:i,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,e,r,o){let i=this.cloneDeep(n),s=this.transformState(e),a={},l={};return this.map(i,(c,u)=>{s[c]||(l[c]=u)}),this.map(s,(c,u)=>{let d=i[c];if(d){let p=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),h=d.filter(g=>p.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),h.length>0&&(l[c]=h)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,o)}static syncDiff(n,e,r,o){let{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(i,(a,l)=>{var c;let u=(c=n[a])!==null&&c!==void 0?c:[];if(n[a]=this.cloneDeep(l),u.length>0){let d=n[a].map(f=>f.presence_ref),p=u.filter(f=>d.indexOf(f.presence_ref)<0);n[a].unshift(...p)}r(a,u,l)}),this.map(s,(a,l)=>{let c=n[a];if(!c)return;let u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),n[a]=c,o(a,c,l),c.length===0&&delete n[a]}),n}static map(n,e){return Object.getOwnPropertyNames(n).map(r=>e(r,n[r]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((e,r)=>{let o=n[r];return"metas"in o?e[r]=o.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=o,e},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var ca=function(t){return t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR",t}(ca||{});var Mg=class t{constructor(n,e={config:{}},r){this.topic=n,this.params=e,this.socket=r,this.bindings={},this.state=Oo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new mf(this,ni.join,this.params,this.timeout),this.rejoinTimer=new ff(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Oo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Oo.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Oo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Oo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ni.reply,{},(o,i)=>{this._trigger(this._replyEventName(i),o)}),this.presence=new Rg(this),this.broadcastEndpointURL=Xx(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(n,e=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:s,private:a}}=this.params;this._onError(u=>n?.(ca.CHANNEL_ERROR,u)),this._onClose(()=>n?.(ca.CLOSED));let l={},c={broadcast:i,presence:s,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){n?.(ca.SUBSCRIBED);return}else{let p=this.bindings.postgres_changes,f=(d=p?.length)!==null&&d!==void 0?d:0,m=[];for(let h=0;h<f;h++){let g=p[h],{filter:{event:x,schema:b,table:I,filter:_}}=g,E=u&&u[h];if(E&&E.event===x&&E.schema===b&&E.table===I&&E.filter===_)m.push(Object.assign(Object.assign({},g),{id:E.id}));else{this.unsubscribe(),n?.(ca.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,n&&n(ca.SUBSCRIBED);return}}).receive("error",u=>{n?.(ca.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{n?.(ca.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,e={}){return await this.send({type:"presence",event:"track",payload:n},e.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,e,r){return this._on(n,e,r)}async send(n,e={}){var r,o;if(!this._canPush()&&n.type==="broadcast"){let{event:i,payload:s}=n,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s,private:this.private}]})};try{let c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var s,a,l;let c=this._push(n.type,n,e.timeout||this.timeout);n.type==="broadcast"&&!(!((l=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Oo.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ni.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let o=new mf(this,ni.leave,{},n);o.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}async _fetchWithTimeout(n,e,r){let o=new AbortController,i=setTimeout(()=>o.abort(),r),s=await this.socket.fetch(n,Object.assign(Object.assign({},e),{signal:o.signal}));return clearTimeout(i),s}_push(n,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new mf(this,n,e,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(n,e,r){return e}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,e,r){var o,i;let s=n.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=ni;if(r&&[a,l,c,u].indexOf(s)>=0&&r!==this._joinRef())return;let p=this._onMessage(s,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var m,h,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(h=f.filter)===null||h===void 0?void 0:h.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===s}).map(f=>f.callback(p,r)):(i=this.bindings[s])===null||i===void 0||i.filter(f=>{var m,h,g,x,b,I;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in f){let _=f.id,E=(m=f.filter)===null||m===void 0?void 0:m.event;return _&&((h=e.ids)===null||h===void 0?void 0:h.includes(_))&&(E==="*"||E?.toLocaleLowerCase()===((g=e.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let _=(b=(x=f?.filter)===null||x===void 0?void 0:x.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return _==="*"||_===((I=e?.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===s}).map(f=>{if(typeof p=="object"&&"ids"in p){let m=p.data,{schema:h,table:g,commit_timestamp:x,type:b,errors:I}=m;p=Object.assign(Object.assign({},{schema:h,table:g,commit_timestamp:x,eventType:b,new:{},old:{},errors:I}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===Oo.closed}_isJoined(){return this.state===Oo.joined}_isJoining(){return this.state===Oo.joining}_isLeaving(){return this.state===Oo.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,e,r){let o=n.toLocaleLowerCase(),i={type:o,filter:e,callback:r};return this.bindings[o]?this.bindings[o].push(i):this.bindings[o]=[i],this}_off(n,e){let r=n.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var i;return!(((i=o.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&t.isEqual(o.filter,e))}),this}static isEqual(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(let r in n)if(n[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(ni.close,{},n)}_onError(n){this._on(ni.error,{},e=>n(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Oo.joining,this.joinPush.resend(n))}_getPayloadRecords(n){let e={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(e.new=LT(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(e.old=LT(n.columns,n.old_record)),e}};var Ere=()=>{},Sre=typeof WebSocket<"u",Tre=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,Fg=class{constructor(n,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=OL,this.params={},this.timeout=qx,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Ere,this.conn=null,this.sendBuffer=[],this.serializer=new Kx,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...a)=>import("./chunk-MAQGHWLI.js").then(({default:l})=>l(...a)):s=fetch,(...a)=>s(...a)},this.endPoint=`${n}/${OT.websocket}`,this.httpEndpoint=Xx(n),e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let o=(r=e?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e?.encode?e.encode:(i,s)=>s(JSON.stringify(i)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ff(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch),e?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=e?.worker||!1,this.workerUrl=e?.workerUrl}this.accessToken=e?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Sre){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new $T(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-KYSFV2V4.js").then(({default:n})=>{this.conn=new n(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:PL}))}disconnect(n,e){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){let e=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){let n=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),n}log(n,e,r){this.logger(n,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case pf.connecting:return td.Connecting;case pf.open:return td.Open;case pf.closing:return td.Closing;default:return td.Closed}}isConnected(){return this.connectionState()===td.Open}channel(n,e={config:{}}){let r=new Mg(`realtime:${n}`,e,this);return this.channels.push(r),r}push(n){let{topic:e,event:r,payload:o,ref:i}=n,s=()=>{this.encode(n,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${r} (${i})`,o),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(n=null){let e=n||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(o=>{e&&o.updateJoinPayload({access_token:e}),o.joinedOnce&&o._isJoined()&&o._push(ni.access_token,{access_token:e})})}}async sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(LL,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let e=this.channels.find(r=>r.topic===n&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${n}"`),e.unsubscribe())}_remove(n){this.channels=this.channels.filter(e=>e._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_onConnMessage(n){this.decode(n.data,e=>{let{topic:r,event:o,payload:i,ref:s}=e;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${o} ${s&&"("+s+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,i,s)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(ni.error))}_appendParams(n,e){if(Object.keys(e).length===0)return n;let r=n.match(/\?/)?"&":"?",o=new URLSearchParams(e);return`${n}${r}${o}`}_workerObjectUrl(n){let e;if(n)e=n;else{let r=new Blob([Tre],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}};var $T=class{constructor(n,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=pf.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=r.close}};var hf=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function Un(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var Yx=class extends hf{constructor(n,e){super(n),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},nd=class extends hf{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};var Dre=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Qx=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},VL=()=>Dre(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-MAQGHWLI.js")).Response:Response}),Zx=t=>{if(Array.isArray(t))return t.map(e=>Zx(e));if(typeof t=="function"||t!==Object(t))return t;let n={};return Object.entries(t).forEach(([e,r])=>{let o=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));n[o]=Zx(r)}),n};var rd=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},VT=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Nre=(t,n,e)=>rd(void 0,void 0,void 0,function*(){let r=yield VL();t instanceof r&&!e?.noResolveJson?t.json().then(o=>{n(new Yx(VT(o),t.status||500))}).catch(o=>{n(new nd(VT(o),o))}):n(new nd(VT(t),t))}),kre=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},n?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),e))};function Og(t,n,e,r,o,i){return rd(this,void 0,void 0,function*(){return new Promise((s,a)=>{t(e,kre(n,r,o,i)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>Nre(l,a,r))})})}function gf(t,n,e,r){return rd(this,void 0,void 0,function*(){return Og(t,"GET",n,e,r)})}function fs(t,n,e,r,o){return rd(this,void 0,void 0,function*(){return Og(t,"POST",n,r,o,e)})}function BL(t,n,e,r,o){return rd(this,void 0,void 0,function*(){return Og(t,"PUT",n,r,o,e)})}function zL(t,n,e,r){return rd(this,void 0,void 0,function*(){return Og(t,"HEAD",n,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function Jx(t,n,e,r,o){return rd(this,void 0,void 0,function*(){return Og(t,"DELETE",n,r,o,e)})}var co=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Are={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},UL={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},eb=class{constructor(n,e={},r,o){this.url=n,this.headers=e,this.bucketId=r,this.fetch=Qx(o)}uploadOrUpdate(n,e,r,o){return co(this,void 0,void 0,function*(){try{let i,s=Object.assign(Object.assign({},UL),o),a=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(s.upsert)}),l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let c=this._removeEmptyFolders(e),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:n,body:i,headers:a},s?.duplex?{duplex:s.duplex}:{})),p=yield d.json();return d.ok?{data:{path:c,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(Un(i))return{data:null,error:i};throw i}})}upload(n,e,r){return co(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,e,r)})}uploadToSignedUrl(n,e,r,o){return co(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(n),s=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let l,c=Object.assign({upsert:UL.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(l){if(Un(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(n,e){return co(this,void 0,void 0,function*(){try{let r=this._getFinalPath(n),o=Object.assign({},this.headers);e?.upsert&&(o["x-upsert"]="true");let i=yield fs(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),s=new URL(this.url+i.url),a=s.searchParams.get("token");if(!a)throw new hf("No token returned by API");return{data:{signedUrl:s.toString(),path:n,token:a},error:null}}catch(r){if(Un(r))return{data:null,error:r};throw r}})}update(n,e,r){return co(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,e,r)})}move(n,e,r){return co(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Un(o))return{data:null,error:o};throw o}})}copy(n,e,r){return co(this,void 0,void 0,function*(){try{return{data:{path:(yield fs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Un(o))return{data:null,error:o};throw o}})}createSignedUrl(n,e,r){return co(this,void 0,void 0,function*(){try{let o=this._getFinalPath(n),i=yield fs(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(o){if(Un(o))return{data:null,error:o};throw o}})}createSignedUrls(n,e,r){return co(this,void 0,void 0,function*(){try{let o=yield fs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:n},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${i}`):null})),error:null}}catch(o){if(Un(o))return{data:null,error:o};throw o}})}download(n,e){return co(this,void 0,void 0,function*(){let o=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),s=i?`?${i}`:"";try{let a=this._getFinalPath(n);return{data:yield(yield gf(this.fetch,`${this.url}/${o}/${a}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Un(a))return{data:null,error:a};throw a}})}info(n){return co(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{let r=yield gf(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Zx(r),error:null}}catch(r){if(Un(r))return{data:null,error:r};throw r}})}exists(n){return co(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{return yield zL(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Un(r)&&r instanceof nd){let o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(n,e){let r=this._getFinalPath(n),o=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&o.push(i);let a=typeof e?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(e?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(n){return co(this,void 0,void 0,function*(){try{return{data:yield Jx(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(e){if(Un(e))return{data:null,error:e};throw e}})}list(n,e,r){return co(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},Are),e),{prefix:n||""});return{data:yield fs(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Un(o))return{data:null,error:o};throw o}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){let e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};var jL="2.7.1";var GL={"X-Client-Info":`storage-js/${jL}`};var yf=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},tb=class{constructor(n,e={},r){this.url=n,this.headers=Object.assign(Object.assign({},GL),e),this.fetch=Qx(r)}listBuckets(){return yf(this,void 0,void 0,function*(){try{return{data:yield gf(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(Un(n))return{data:null,error:n};throw n}})}getBucket(n){return yf(this,void 0,void 0,function*(){try{return{data:yield gf(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(e){if(Un(e))return{data:null,error:e};throw e}})}createBucket(n,e={public:!1}){return yf(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Un(r))return{data:null,error:r};throw r}})}updateBucket(n,e){return yf(this,void 0,void 0,function*(){try{return{data:yield BL(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Un(r))return{data:null,error:r};throw r}})}emptyBucket(n){return yf(this,void 0,void 0,function*(){try{return{data:yield fs(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(Un(e))return{data:null,error:e};throw e}})}deleteBucket(n){return yf(this,void 0,void 0,function*(){try{return{data:yield Jx(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(e){if(Un(e))return{data:null,error:e};throw e}})}};var Pg=class extends tb{constructor(n,e={},r){super(n,e,r)}from(n){return new eb(this.url,this.headers,n,this.fetch)}};var WL="2.48.1";var Lg="";typeof Deno<"u"?Lg="deno":typeof document<"u"?Lg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Lg="react-native":Lg="node";var Rre={"X-Client-Info":`supabase-js-${Lg}/${WL}`},HL={headers:Rre},qL={schema:"public"},KL={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},XL={};ER();var Mre=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Fre=t=>{let n;return t?n=t:typeof fetch>"u"?n=_R:n=fetch,(...e)=>n(...e)},Ore=()=>typeof Headers>"u"?IR:Headers,YL=(t,n,e)=>{let r=Fre(e),o=Ore();return(i,s)=>Mre(void 0,void 0,void 0,function*(){var a;let l=(a=yield n())!==null&&a!==void 0?a:t,c=new o(s?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},s),{headers:c}))})};var Pre=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})};function ZL(t){return t.replace(/\/$/,"")}function QL(t,n){let{db:e,auth:r,realtime:o,global:i}=t,{db:s,auth:a,realtime:l,global:c}=n,u={db:Object.assign(Object.assign({},s),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),o),global:Object.assign(Object.assign({},c),i),accessToken:()=>Pre(this,void 0,void 0,function*(){return""})};return t.accessToken?u.accessToken=t.accessToken:delete u.accessToken,u}var nb="2.67.3";var JL="http://localhost:9999",e$="supabase.auth.token";var t$={"X-Client-Info":`gotrue-js/${nb}`},BT=10;var $g="X-Supabase-Api-Version",zT={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function n$(t){return Math.round(Date.now()/1e3)+t}function r$(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=Math.random()*16|0;return(t=="x"?n:n&3|8).toString(16)})}var $i=()=>typeof window<"u"&&typeof document<"u",od={tested:!1,writable:!1},ec=()=>{if(!$i())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(od.tested)return od.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),od.tested=!0,od.writable=!0}catch{od.tested=!0,od.writable=!1}return od.writable};function o$(t){let n={},e=new URL(t);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((o,i)=>{n[i]=o})}catch{}return e.searchParams.forEach((r,o)=>{n[o]=r}),n}var rb=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},i$=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",UT=async(t,n,e)=>{await t.setItem(n,JSON.stringify(e))},Bg=async(t,n)=>{let e=await t.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch{return e}},zg=async(t,n)=>{await t.removeItem(n)};function Lre(t){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,o,i,s,a,l,c,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)s=n.indexOf(t.charAt(u++)),a=n.indexOf(t.charAt(u++)),l=n.indexOf(t.charAt(u++)),c=n.indexOf(t.charAt(u++)),r=s<<2|a>>4,o=(a&15)<<4|l>>2,i=(l&3)<<6|c,e=e+String.fromCharCode(r),l!=64&&o!=0&&(e=e+String.fromCharCode(o)),c!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}var Vg=class t{constructor(){this.promise=new t.promiseConstructor((n,e)=>{this.resolve=n,this.reject=e})}};Vg.promiseConstructor=Promise;function jT(t){let n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=t.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(Lre(r))}async function s$(t){return await new Promise(n=>{setTimeout(()=>n(null),t)})}function a$(t,n){return new Promise((r,o)=>{(async()=>{for(let i=0;i<1/0;i++)try{let s=await t(i);if(!n(i,null,s)){r(s);return}}catch(s){if(!n(i,s)){o(s);return}}})()})}function $re(t){return("0"+t.toString(16)).substr(-2)}function Vre(){let n=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,o="";for(let i=0;i<56;i++)o+=e.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(n),Array.from(n,$re).join("")}async function Bre(t){let e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",e),o=new Uint8Array(r);return Array.from(o).map(i=>String.fromCharCode(i)).join("")}function zre(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Ure(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let e=await Bre(t);return zre(e)}async function id(t,n,e=!1){let r=Vre(),o=r;e&&(o+="/PASSWORD_RECOVERY"),await UT(t,`${n}-code-verifier`,o);let i=await Ure(r);return[i,r===i?"plain":"s256"]}var jre=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function l$(t){let n=t.headers.get($g);if(!n||!n.match(jre))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}var Ug=class extends Error{constructor(n,e,r){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}};function nt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var ob=class extends Ug{constructor(n,e,r){super(n,e,r),this.name="AuthApiError",this.status=e,this.code=r}};function c$(t){return nt(t)&&t.name==="AuthApiError"}var vf=class extends Ug{constructor(n,e){super(n),this.name="AuthUnknownError",this.originalError=e}},ua=class extends Ug{constructor(n,e,r,o){super(n,r,o),this.name=e,this.status=r}},ri=class extends ua{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function u$(t){return nt(t)&&t.name==="AuthSessionMissingError"}var xf=class extends ua{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},sd=class extends ua{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}},ad=class extends ua{constructor(n,e=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function d$(t){return nt(t)&&t.name==="AuthImplicitGrantRedirectError"}var jg=class extends ua{constructor(n,e=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},bf=class extends ua{constructor(n,e){super(n,"AuthRetryableFetchError",e,void 0)}};function ib(t){return nt(t)&&t.name==="AuthRetryableFetchError"}var Gg=class extends ua{constructor(n,e,r){super(n,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}};var Gre=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},ld=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Wre=[502,503,504];async function p$(t){var n;if(!i$(t))throw new bf(ld(t),0);if(Wre.includes(t.status))throw new bf(ld(t),t.status);let e;try{e=await t.json()}catch(i){throw new vf(ld(i),i)}let r,o=l$(t);if(o&&o.getTime()>=zT["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new Gg(ld(e),t.status,((n=e.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(r==="session_not_found")throw new ri}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,s)=>i&&typeof s=="string",!0))throw new Gg(ld(e),t.status,e.weak_password.reasons);throw new ob(ld(e),t.status||500,r)}var Hre=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),e))};async function xt(t,n,e,r){var o;let i=Object.assign({},r?.headers);i[$g]||(i[$g]=zT["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let s=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(s.redirect_to=r.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await qre(t,n,e+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function qre(t,n,e,r,o,i){let s=Hre(n,r,o,i),a;try{a=await t(e,Object.assign({},s))}catch(l){throw console.error(l),new bf(ld(l),0)}if(a.ok||await p$(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await p$(l)}}function da(t){var n;let e=null;Kre(t)&&(e=Object.assign({},t),t.expires_at||(e.expires_at=n$(t.expires_in)));let r=(n=t.user)!==null&&n!==void 0?n:t;return{data:{session:e,user:r},error:null}}function GT(t){let n=da(t);return!n.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(n.data.weak_password=t.weak_password),n}function ms(t){var n;return{data:{user:(n=t.user)!==null&&n!==void 0?n:t},error:null}}function f$(t){return{data:t,error:null}}function m$(t){let{action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i}=t,s=Gre(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i},l=Object.assign({},s);return{data:{properties:a,user:l},error:null}}function h$(t){return t}function Kre(t){return t.access_token&&t.refresh_token&&t.expires_in}var Xre=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},wf=class{constructor({url:n="",headers:e={},fetch:r}){this.url=n,this.headers=e,this.fetch=rb(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,e="global"){try{return await xt(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(r){if(nt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(n,e={}){try{return await xt(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:ms})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async generateLink(n){try{let{options:e}=n,r=Xre(n,["options"]),o=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await xt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:m$,redirectTo:e?.redirectTo})}catch(e){if(nt(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(n){try{return await xt(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:ms})}catch(e){if(nt(e))return{data:{user:null},error:e};throw e}}async listUsers(n){var e,r,o,i,s,a,l;try{let c={nextPage:null,lastPage:0,total:0},u=await xt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=n?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=n?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:h$});if(u.error)throw u.error;let d=await u.json(),p=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{let h=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=h}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(nt(c))return{data:{users:[]},error:c};throw c}}async getUserById(n){try{return await xt(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:ms})}catch(e){if(nt(e))return{data:{user:null},error:e};throw e}}async updateUserById(n,e){try{return await xt(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:e,headers:this.headers,xform:ms})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async deleteUser(n,e=!1){try{return await xt(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:e},xform:ms})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async _listFactors(n){try{let{data:e,error:r}=await xt(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:e,error:r}}catch(e){if(nt(e))return{data:null,error:e};throw e}}async _deleteFactor(n){try{return{data:await xt(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(e){if(nt(e))return{data:null,error:e};throw e}}};var g$={getItem:t=>ec()?globalThis.localStorage.getItem(t):null,setItem:(t,n)=>{ec()&&globalThis.localStorage.setItem(t,n)},removeItem:t=>{ec()&&globalThis.localStorage.removeItem(t)}};function WT(t={}){return{getItem:n=>t[n]||null,setItem:(n,e)=>{t[n]=e},removeItem:n=>{delete t[n]}}}function y$(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var cd={debug:!!(globalThis&&ec()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Wg=class extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}},sb=class extends Wg{};async function HT(t,n,e){cd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,n);let r=new globalThis.AbortController;return n>0&&setTimeout(()=>{r.abort(),cd.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){cd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await e()}finally{cd.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(n===0)throw cd.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new sb(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(cd.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}y$();var Yre={url:JL,storageKey:e$,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:t$,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},Hg=30*1e3,v$=3;async function x$(t,n,e){return await e()}var qT=(()=>{class t{constructor(e){var r,o;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&$i()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},Yre),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new wf({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=rb(i.fetch),this.lock=i.lock||x$,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:$i()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=HT:this.lock=x$,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:ec()?this.storage=g$:(this.memoryStorage={},this.storage=WT(this.memoryStorage)):(this.memoryStorage={},this.storage=WT(this.memoryStorage)),$i()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${nb}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r=o$(window.location.href),o="none";if(this._isImplicitGrantCallback(r)?o="implicit":await this._isPKCECallback(r)&&(o="pkce"),$i()&&this.detectSessionInUrl&&o!=="none"){let{data:i,error:s}=await this._getSessionFromURL(r,o);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),d$(s)){let c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return nt(r)?{error:r}:{error:new vf("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,o,i;try{let s=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:da}),{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(nt(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,o,i;try{let s;if("email"in e){let{email:d,password:p,options:f}=e,m=null,h=null;this.flowType==="pkce"&&([m,h]=await id(this.storage,this.storageKey)),s=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:h},xform:da})}else if("phone"in e){let{phone:d,password:p,options:f}=e;s=await xt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(o=f?.data)!==null&&o!==void 0?o:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:da})}else throw new sd("You must provide either an email or phone number and a password");let{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(nt(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){let{email:s,password:a,options:l}=e;r=await xt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:GT})}else if("phone"in e){let{phone:s,password:a,options:l}=e;r=await xt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:GT})}else throw new sd("You must provide either an email or phone number and a password");let{data:o,error:i}=r;return i?{data:{user:null,session:null},error:i}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new xf}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:i})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,o,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let r=await Bg(this.storage,`${this.storageKey}-code-verifier`),[o,i]=(r??"").split("/");try{let{data:s,error:a}=await xt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:o},xform:da});if(await zg(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new xf}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:a})}catch(s){if(nt(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:r,provider:o,token:i,access_token:s,nonce:a}=e,l=await xt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:da}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new xf}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,o,i,s,a;try{if("email"in e){let{email:l,options:c}=e,u=null,d=null;this.flowType==="pkce"&&([u,d]=await id(this.storage,this.storageKey));let{error:p}=await xt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:l,options:c}=e,{data:u,error:d}=await xt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new sd("You must provide either an email or phone number.")}catch(l){if(nt(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,o;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(o=e.options)===null||o===void 0?void 0:o.captchaToken);let{data:a,error:l}=await xt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:da});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");let c=a.session,u=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(nt(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var r,o,i;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await id(this.storage,this.storageKey)),await xt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&o!==void 0?o:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:f$})}catch(s){if(nt(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:r},error:o}=e;if(o)throw o;if(!r)throw new ri;let{error:i}=await xt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(nt(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let r=`${this.url}/resend`;if("email"in e){let{email:o,type:i,options:s}=e,{error:a}=await xt(this.fetch,"POST",r,{headers:this.headers,body:{email:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:o,type:i,options:s}=e,{data:a,error:l}=await xt(this.fetch,"POST",r,{headers:this.headers,body:{phone:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:l}}throw new sd("You must provide either an email or phone number and a type")}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await o,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let o=r();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=await Bg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let o=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",e.expires_at),!o){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await xt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ms}):await this._useSession(async r=>{var o,i,s;let{data:a,error:l}=r;if(l)throw l;return!(!((o=a.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new ri}:await xt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:ms})})}catch(r){if(nt(r))return u$(r)&&(await this._removeSession(),await zg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async o=>{let{data:i,error:s}=o;if(s)throw s;if(!i.session)throw new ri;let a=i.session,l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await id(this.storage,this.storageKey));let{data:u,error:d}=await xt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:ms});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(o){if(nt(o))return{data:{user:null},error:o};throw o}}_decodeJWT(e){return jT(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new ri;let r=Date.now()/1e3,o=r,i=!0,s=null,a=jT(e.access_token);if(a.exp&&(o=a.exp,i=o<=r),i){let{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};s=l}else{let{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:o-r,expires_at:o},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(nt(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var o;if(!e){let{data:a,error:l}=r;if(l)throw l;e=(o=a.session)!==null&&o!==void 0?o:void 0}if(!e?.refresh_token)throw new ri;let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!$i())throw new ad("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ad(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new jg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ad("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new jg("No code detected.");let{data:I,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;let E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:I.session,redirectType:null},error:null}}let{provider_token:o,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!a||!u)throw new ad("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(l),f=d+p;c&&(f=parseInt(c));let m=f-d;m*1e3<=Hg&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${p}s`);let h=f-p;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,f,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,f,d);let{data:g,error:x}=await this._getUser(s);if(x)throw x;let b={provider_token:o,provider_refresh_token:i,access_token:s,expires_in:p,expires_at:f,refresh_token:a,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(o){if(nt(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let r=await Bg(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{error:s};let a=(o=i.session)===null||o===void 0?void 0:o.access_token;if(a){let{error:l}=await this.admin.signOut(a,e);if(l&&!(c$(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await zg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let r=r$(),o={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,o),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:o}}}async _emitInitialSession(e){return await this._useSession(async r=>{var o,i;try{let{data:{session:s},error:a}=r;if(a)throw a;await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let o=null,i=null;this.flowType==="pkce"&&([o,i]=await id(this.storage,this.storageKey,!0));try{return await xt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(nt(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:r,error:o}=await this.getUser();if(o)throw o;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(nt(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{let{data:o,error:i}=await this._useSession(async s=>{var a,l,c,u,d;let{data:p,error:f}=s;if(f)throw f;let m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await xt(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=p.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return $i()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:e.provider,url:o?.url},error:null}}catch(o){if(nt(o))return{data:{provider:e.provider,url:null},error:o};throw o}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)throw a;return await xt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(o=s.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let o=Date.now();return await a$(async i=>(i>0&&await s$(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await xt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:da})),(i,s)=>{let a=200*Math.pow(2,i);return s&&ib(s)&&Date.now()+a-o<Hg})}catch(o){if(this._debug(r,"error",o),nt(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){let o=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",o),$i()&&!r.skipBrowserRedirect&&window.location.assign(o),{data:{provider:e,url:o},error:null}}async _recoverAndRefresh(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=await Bg(this.storage,this.storageKey);if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}let i=Math.round(Date.now()/1e3),s=((e=o.expires_at)!==null&&e!==void 0?e:1/0)<i+BT;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${BT}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=await this._callRefreshToken(o.refresh_token);a&&(console.error(a),ib(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,o;if(!e)throw new ri;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Vg;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new ri;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),nt(s)){let a={session:null,error:s};return ib(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,o=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:e,session:r});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){s.push(c)}});if(await Promise.all(a),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await UT(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await zg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&$i()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),Hg);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async r=>{let{data:{session:o}}=r;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((o.expires_at*1e3-e)/Hg);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${Hg}ms, refresh threshold is ${v$} ticks`),i<=v$&&await this._callRefreshToken(o.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Wg)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$i()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,o){let i=[`provider=${encodeURIComponent(r)}`];if(o?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&i.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){let[s,a]=await id(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(l.toString())}if(o?.queryParams){let s=new URLSearchParams(o.queryParams);i.push(s.toString())}return o?.skipBrowserRedirect&&i.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await xt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)return{data:null,error:a};let l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await xt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{data:null,error:s};let{data:a,error:l}=await xt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(r){if(nt(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await xt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(nt(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){let{data:r,error:o}=await this._challenge({factorId:e.factorId});return o?{data:null,error:o}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){let{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};let o=e?.factors||[],i=o.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=o.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:o,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,o;let{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),l=null;a.aal&&(l=a.aal);let c=l;((o=(r=i.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(c="aal2");let d=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}}return t.nextInstanceID=0,t})();var Zre=qT,KT=Zre;var ab=class extends KT{constructor(n){super(n)}};var Qre=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},lb=class{constructor(n,e,r){var o,i,s;if(this.supabaseUrl=n,this.supabaseKey=e,!n)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let a=ZL(n);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:qL,realtime:XL,auth:Object.assign(Object.assign({},KL),{storageKey:l}),global:HL},u=QL(r??{},c);this.storageKey=(o=u.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=u.auth)!==null&&s!==void 0?s:{},this.headers,u.global.fetch),this.fetch=YL(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new ML(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Eg(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Pg(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},r={}){return this.rest.rpc(n,e,r)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,e;return Qre(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,storageKey:i,flowType:s,lock:a,debug:l},c,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ab({url:this.authUrl,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,flowType:s,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new Fg(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(n,e,r){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var b$=(t,n,e)=>new lb(t,n,e);var ZT=(t,n)=>n.some(e=>t instanceof e),w$,C$;function Jre(){return w$||(w$=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function eoe(){return C$||(C$=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var QT=new WeakMap,XT=new WeakMap,cb=new WeakMap;function toe(t){let n=new Promise((e,r)=>{let o=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(ud(t.result)),o()},s=()=>{r(t.error),o()};t.addEventListener("success",i),t.addEventListener("error",s)});return cb.set(n,t),n}function noe(t){if(QT.has(t))return;let n=new Promise((e,r)=>{let o=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),o()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});QT.set(t,n)}var JT={get(t,n,e){if(t instanceof IDBTransaction){if(n==="done")return QT.get(t);if(n==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ud(t[n])},set(t,n,e){return t[n]=e,!0},has(t,n){return t instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in t}};function S$(t){JT=t(JT)}function roe(t){return eoe().includes(t)?function(...n){return t.apply(eD(this),n),ud(this.request)}:function(...n){return ud(t.apply(eD(this),n))}}function ooe(t){return typeof t=="function"?roe(t):(t instanceof IDBTransaction&&noe(t),ZT(t,Jre())?new Proxy(t,JT):t)}function ud(t){if(t instanceof IDBRequest)return toe(t);if(XT.has(t))return XT.get(t);let n=ooe(t);return n!==t&&(XT.set(t,n),cb.set(n,t)),n}var eD=t=>cb.get(t);function nD(t,n,{blocked:e,upgrade:r,blocking:o,terminated:i}={}){let s=indexedDB.open(t,n),a=ud(s);return r&&s.addEventListener("upgradeneeded",l=>{r(ud(s.result),l.oldVersion,l.newVersion,ud(s.transaction),l)}),e&&s.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),o&&l.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var ioe=["get","getKey","getAll","getAllKeys","count"],soe=["put","add","delete","clear"],YT=new Map;function _$(t,n){if(!(t instanceof IDBDatabase&&!(n in t)&&typeof n=="string"))return;if(YT.get(n))return YT.get(n);let e=n.replace(/FromIndex$/,""),r=n!==e,o=soe.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(o||ioe.includes(e)))return;let i=async function(s,...a){let l=this.transaction(s,o?"readwrite":"readonly"),c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[e](...a),o&&l.done]))[0]};return YT.set(n,i),i}S$(t=>Ue(me({},t),{get:(n,e,r)=>_$(n,e)||t.get(n,e,r),has:(n,e)=>!!_$(n,e)||t.has(n,e)}));var aoe=["continue","continuePrimaryKey","advance"],I$={},tD=new WeakMap,T$=new WeakMap,loe={get(t,n){if(!aoe.includes(n))return t[n];let e=I$[n];return e||(e=I$[n]=function(...r){tD.set(this,T$.get(this)[n](...r))}),e}};async function*coe(...t){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...t)),!n)return;n=n;let e=new Proxy(n,loe);for(T$.set(e,n),cb.set(e,eD(n));n;)yield e,n=await(tD.get(e)||n.continue()),tD.delete(e)}function E$(t,n){return n===Symbol.asyncIterator&&ZT(t,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&ZT(t,[IDBIndex,IDBObjectStore])}S$(t=>Ue(me({},t),{get(n,e,r){return E$(n,e)?coe:t.get(n,e,r)},has(n,e){return E$(n,e)||t.has(n,e)}}));var ub={API_URL:"https://jsgltiaidlacvchyjjha.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzZ2x0aWFpZGxhY3ZjaHlqamhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2NjIzNDIsImV4cCI6MjA1NTIzODM0Mn0.bPtRMhXapLzUgPEIf6GoW9r52umh0F1YZhG1bfLyb0s",supabase_LocalStorage_key:"sb-jsgltiaidlacvchyjjha-auth-token"};var Ct=class t{constructor(n){this.platformId=n;this.supabase=b$(ub.API_URL,ub.anon_key,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),this.initializeAuthState()}supabase;user=io(null);currentUsername=io(null);loginStatus=io(null);ngOnInit(){this.initializeAuthState()}initializeAuthState(){if(!dn(this.platformId))return;let n=this.getStoredSession();n&&this.updateSession(n),this.refreshSessionFromApi(),this.supabase.auth.onAuthStateChange((e,r)=>{this.updateSession(r)})}getStoredSession(){try{let n=localStorage.getItem(ub.supabase_LocalStorage_key);if(!n)return null;let e=JSON.parse(n);if(!e||!e.expires_at)return null;let r=e.expires_at*1e3;return Date.now()>=r?null:e}catch(n){return console.error("Error parsing stored session",n),null}}async refreshSessionFromApi(){try{let{data:n,error:e}=await this.supabase.auth.getSession();if(e)throw e;this.updateSession(n.session)}catch(n){console.error("Failed to refresh session:",n),this.updateSession(null)}}updateSession(n){if(n){this.user.set(n.user);let e=n.user?.identities?.[0]?.identity_data?.firstname||null;this.currentUsername.set(e),this.loginStatus.set(!0)}else this.user.set(null),this.currentUsername.set(null),this.loginStatus.set(!1)}initializeApp(){return new Promise(n=>{if(!dn(this.platformId))return this.loginStatus.set(!1),n(!1);let e=this.getStoredSession();e&&this.updateSession(e),this.supabase.auth.getSession().then(({data:r,error:o})=>{o?(console.error("Failed to get session:",o),this.updateSession(null)):this.updateSession(r.session),this.supabase.auth.onAuthStateChange((i,s)=>{this.updateSession(s)}),n(!0)})})}async signIn(n,e){try{let{error:r}=await this.supabase.auth.signInWithPassword({email:n,password:e});if(r)throw r;return{success:!0}}catch(r){return console.error("Sign in error:",r),{success:!1,error:r}}}async signOut(){try{let{error:n}=await this.supabase.auth.signOut();if(n)throw n;return this.clearStorages(),this.updateSession(null),{success:!0}}catch(n){return console.error("Sign out error:",n),{success:!1,error:n}}}async signUp(n,e,r,o){let{data:i,error:s}=await this.supabase.auth.signUp({email:n,password:e,options:{data:{firstname:r,lastname:o}}});if(s)throw s;setTimeout(()=>{i.user?.id&&this.createUserAccount(n,r,o)},500)}clearStorages(){dn(this.platformId)&&(localStorage.clear(),sessionStorage.clear())}async addTradeLog(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");n.userid=r.id;let{data:o,error:i}=await this.supabase.from(e).insert([n]);if(i)throw console.error("Error inserting trade log: ",i),i;return dn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async getTradeLogs(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=!1,o=null;if(dn(this.platformId)){r=sessionStorage.getItem(`${n}_refresh`)==="yes";let a=sessionStorage.getItem(n);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade logs:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(n).select("*").eq("userid",e.id);if(s)throw console.error("Error fetching trade logs:",s),s;return dn(this.platformId)&&(sessionStorage.setItem(n,JSON.stringify(i)),sessionStorage.removeItem(`${n}_refresh`)),i}async getTradeLogsOfSelectedAccount(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");let o=`${n}_${e}`,i=`${o}_refresh`,s=!1,a=null;if(dn(this.platformId)){s=sessionStorage.getItem(i)==="yes";let u=sessionStorage.getItem(o);if(u)try{a=JSON.parse(u)}catch(d){console.error("Error parsing cached trade logs:",d),a=null}}if(!s&&a)return a;let{data:l,error:c}=await this.supabase.from(n).select("*").eq("userid",r.id).eq("trade_account_id",e);if(c)throw console.error("Error fetching trade logs:",c),c;return dn(this.platformId)&&(sessionStorage.setItem(o,JSON.stringify(l)),sessionStorage.removeItem(i)),l}async addTradeLogOfSelectedAccount(n,e,r){let o=this.user();if(!o)throw new Error("User not authenticated");n.userid=o.id;let{data:i,error:s}=await this.supabase.from(e).insert([n]);if(s)throw console.error("Error inserting trade log: ",s),s;return dn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async updateTradeLogOfSelectedAccount(n,e,r){if(!this.user())throw new Error("User not authenticated");let{data:i,error:s}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(s)throw console.error("Error updating trade log: ",s),s;return dn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async deleteTradeLogOfSelectedAccount(n,e,r){if(!this.user())throw new Error("User not authenticated");let{data:i,error:s}=await this.supabase.from(e).delete().eq("tradeid",n);if(s)throw console.error("Error deleting trade log: ",s),s;return dn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async updateTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(i)throw console.error("Error updating trade log: ",i),i;return dn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async deleteTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).delete().eq("tradeid",n);if(i)throw console.error("Error deleting trade log: ",i),i;return dn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async loadQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminLoadQuestions(){let{data:n,error:e}=await this.supabase.from("adminquestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminSaveQuestions(n){let e=null;for(let r of n.filter(o=>o.isModified))if(r.question_id){let{data:o,error:i}=await this.supabase.from("adminquestions").update({question_data:r.question_data,active:r.active}).eq("question_id",r.question_id).select().single();if(i){console.error("Error updating question:",i),e=i;break}else r.updated_at=o.updated_at,r.isModified=!1}else{let{data:o,error:i}=await this.supabase.from("adminquestions").insert([{question_data:r.question_data,active:r.active}]).select().single();if(i){console.error("Error inserting question:",i),e=i;break}else r.question_id=o.question_id,r.created_at=o.created_at,r.updated_at=o.updated_at,r.isModified=!1}return{error:e}}async deleteQuestion(n){let{error:e}=await this.supabase.from("adminquestions").delete().eq("question_id",n.question_id);return{error:e}}async getActiveQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");return{data:n,error:e}}async submitUserAnswers(n){let{error:e}=await this.supabase.from("answers").insert(n);return{error:e}}async getUserTradeAccounts(){let n=this.user();if(!n)throw new Error("User not authenticated");let e="tradeaccount",r=!1,o=null;if(dn(this.platformId)){r=sessionStorage.getItem(`${e}_refresh`)==="yes";let a=sessionStorage.getItem(e);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade accounts:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(e).select("*").eq("user_id",n.id);if(s)throw console.error("Error fetching trade accounts:",s),s;return dn(this.platformId)&&(sessionStorage.setItem(e,JSON.stringify(i)),sessionStorage.removeItem(`${e}_refresh`)),i||[]}async addTradeAccount(n){let e=this.user();if(!e)throw new Error("User not authenticated");let c=n,{track_pl:r,include_in_analytics:o,trading_instruments:i}=c,s=g0(c,["track_pl","include_in_analytics","trading_instruments"]),a={track_pl:r,include_in_analytics:o,trading_instruments:i},{error:l}=await this.supabase.from("tradeaccount").insert([Ue(me({},s),{user_id:e.id,metadata:a})]);return l?(console.error("Failed to add trade account:",l),!1):(sessionStorage.setItem("tradeaccount_refresh","yes"),!0)}async editTradeAccount(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");let u=e,{track_pl:o,include_in_analytics:i,trading_instruments:s}=u,a=g0(u,["track_pl","include_in_analytics","trading_instruments"]),l={track_pl:o,include_in_analytics:i,trading_instruments:s},{error:c}=await this.supabase.from("tradeaccount").update(Ue(me({},a),{metadata:l})).eq("account_id",n).eq("user_id",r.id);return c?(console.error("Failed to update trade account:",c),!1):(sessionStorage.setItem("tradeaccount_refresh","yes"),!0)}async RemoveTradeAccount(n){let e=this.user();if(!e)throw new Error("User not authenticated");let{error:r}=await this.supabase.from("tradejournal").delete().eq("trade_account_id",n).eq("userid",e.id);if(r)return console.error("Failed to delete associated trade logs:",r),!1;let{error:o}=await this.supabase.from("tradeaccount").delete().eq("account_id",n).eq("user_id",e.id);return o?(console.error("Failed to remove trade account:",o),!1):(dn(this.platformId)&&(sessionStorage.setItem("tradeaccount_refresh","yes"),sessionStorage.setItem(`tradejournal_${n}_refresh`,"yes")),!0)}async createUserAccount(n,e,r){let o=this.user();if(!o)throw new Error("User not authenticated");let{error:i}=await this.supabase.from("usersaccount").insert({user_id:o.id,email:n||"",firstname:e||"",lastname:r||""});i&&console.error("Failed to create user account record:",i)}async getProfile(){let n=this.user();if(!n)throw new Error("User not authenticated");return this.supabase.from("usersaccount").select("*").eq("user_id",n.id).single()}async updateProfile(n){let e=this.user();if(!e)throw new Error("User not authenticated");return this.supabase.from("usersaccount").update(n).eq("user_id",e.id)}async uploadProfilePicture(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=n.name.split(".").pop(),o=`${e.id}/profile.${r}`,{error:i}=await this.supabase.storage.from("user-profile-pictures").upload(o,n,{upsert:!0});return i?null:o}async cacheProfilePictureBlob(n,e){await(await nD("profile-cache",1,{upgrade(o){o.createObjectStore("pictures")}})).put("pictures",e,n)}async getCachedProfilePictureBlobUrl(n){if(!n)return null;let e=await nD("profile-cache",1,{upgrade(a){a.createObjectStore("pictures")}}),r=await e.get("pictures",n);if(r)return URL.createObjectURL(r);let o=await this.getPublicUrl(n);if(!o)return null;let i=await fetch(o);if(!i.ok)return null;let s=await i.blob();return await e.put("pictures",s,n),URL.createObjectURL(s)}clearCachedProfilePictureBlobUrl(){if(dn(this.platformId)){let n=sessionStorage.getItem("profile_picture_blob_url");n&&(URL.revokeObjectURL(n),sessionStorage.removeItem("profile_picture_blob_url"))}}async deleteProfilePicture(){let{data:{user:n}}=await this.supabase.auth.getUser();if(!n)return;let e=`profile-pictures/${n.id}`;await this.supabase.storage.from("user-profile-pictures").remove([e])}async getPublicUrl(n){let{data:e}=await this.supabase.storage.from("user-profile-pictures").createSignedUrl(n,60);return e?.signedUrl??null}async adminLoadMeditationVideos(){let{data:n,error:e}=await this.supabase.from("adminmeditationvideos").select("*").order("created_at",{ascending:!1});if(e)throw console.error("Error loading meditation videos: ",e),e;return n}async loadActiveMeditationVideos(){let{data:n,error:e}=await this.supabase.from("activemeditationvideos").select("*").order("created_at",{ascending:!1});if(e)throw console.error("Error loading meditation videos: ",e),e;return n}async addMeditationVideo(n){let{error:e}=await this.supabase.from("adminmeditationvideos").insert([{title:n.title,url:n.url,category:n.category,description:n.description,isactive:n.isactive}]);return e&&console.error("Error adding meditation video: ",e),{error:e}}async updateMeditationVideo(n){let{error:e}=await this.supabase.from("adminmeditationvideos").update({title:n.title,url:n.url,category:n.category,description:n.description,isactive:n.isactive,updated_time:n.updated_time}).eq("id",n.id);return e&&console.error("Error updating meditation video: ",e),{error:e}}supaScream(){return"SupaScream"}static \u0275fac=function(e){return new(e||t)(Me(so))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})};function uoe(t,n){if(t&1&&(v(0,"div",11)(1,"div",12)(2,"div",8)(3,"h5",13),w(4),y(),v(5,"p",14),w(6),y(),v(7,"a",15),w(8),y()()()()),t&2){let e=n.$implicit;O(4),Ke(e.title),O(2),Ke(e.description),O(),z("routerLink",e.link),O(),Ke(e.buttonText)}}var db=class t{constructor(n){this.supabaseService=n;this.userFirstName=this.supabaseService.currentUsername()}userFirstName;steps=[{title:"Step 1: Daily Emotional Check-in",description:"Understand your emotional state before making trading decisions.",buttonText:"Begin Emotional Check-in",link:"/emotions"},{title:"Step 2: Plan Your Trades",description:"Document your trading plan before executing any trades.",buttonText:"Plan your trade",link:"/tradejournal"},{title:"Step 3: Update your Trades",description:"Record results and analyze your trading performance.",buttonText:"Execute your trades",link:"/tradejournal"},{title:"Step 4: Reflection & Meditation",description:"Clear your mind with mindfulness practices.",buttonText:"Start Reflection",link:"/reflection"}];static \u0275fac=function(e){return new(e||t)(ne(Ct))};static \u0275cmp=it({type:t,selectors:[["app-landing-page"]],decls:22,vars:1,consts:[[1,"container","mt-4"],[1,"mb-4"],[1,""],[1,"mt-3"],["class","col-12 mt-3",4,"ngFor","ngForOf"],[1,"row","mb-5"],[1,"col-12"],[1,"card","h-100","bg-transparent"],[1,"card-body"],[1,"card-title"],["routerLink","/meditationhub",1,"btn","btn-secondary","btn-tr"],[1,"col-12","mt-3"],[1,"card","h-100","bg-transparent","mt-3"],[1,"card-title","mt-3"],[1,"card-text","mt-3"],[1,"btn","btn-primary","btn-tr","mt-3",3,"routerLink"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"h2",1),w(2,"Begin Your Trading Transformation"),y(),v(3,"h3",1),w(4,"Your Daily Trading Routine"),y(),v(5,"p",2),w(6," Welcome to your personalized trading journey. Each day follows a structured approach designed to build discipline and improve your trading performance. "),y(),v(7,"div",3),re(8,uoe,9,4,"div",4),y(),U(9,"hr"),v(10,"h2",1),w(11,"Additional Resources"),y(),v(12,"div",5)(13,"div",6)(14,"div",7)(15,"div",8)(16,"h5",9),w(17,"Meditation Hub"),y(),v(18,"p"),w(19,"Clear your mind and reduce emotional reactivity with guided meditations."),y(),v(20,"a",10),w(21,"Visit Meditation Hub"),y()()()()()()),e&2&&(O(8),z("ngForOf",r.steps))},dependencies:[zn,kt,Bn],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:8px}.card-body[_ngcontent-%COMP%]{padding-left:0}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.75rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-custom[_ngcontent-%COMP%]{border-radius:20px;font-weight:600}@media (max-width: 576px){.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.btn-custom[_ngcontent-%COMP%]{padding:.5rem 1rem}}"]})};var sr=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return new Promise(o=>{yr(this.injector,()=>{Qp(()=>{this.supabaseService.loginStatus()&&o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()||o(this.router.createUrlTree([""],{queryParams:{returnUrl:e.url}}))},100)})}static \u0275fac=function(e){return new(e||t)(Me(Ct),Me(Fo),Me(Pn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})};var pb=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return r?!1:r?new Promise(o=>{yr(this.injector,()=>{Qp(()=>{this.supabaseService.loginStatus()||o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()&&o(this.router.createUrlTree(["/home"]))},100)}):!0}static \u0275fac=function(e){return new(e||t)(Me(Ct),Me(Fo),Me(Pn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})};var L$=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||t)(ne(Mi),ne(Yn))};static \u0275dir=Nt({type:t})}return t})(),Sf=(()=>{class t extends L${static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,features:[Ln]})}return t})(),oc=new ke(""),doe={provide:oc,useExisting:gr(()=>pa),multi:!0},pa=(()=>{class t extends Sf{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){r&1&&te("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[vr([doe]),Ln]})}return t})(),poe={provide:oc,useExisting:gr(()=>wn),multi:!0};function foe(){let t=ia()?ia().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var moe=new ke(""),wn=(()=>{class t extends L${_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!foe())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||t)(ne(Mi),ne(Yn),ne(moe,8))};static \u0275dir=Nt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&te("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[vr([poe]),Ln]})}return t})();function tc(t){return t==null||(typeof t=="string"||Array.isArray(t))&&t.length===0}function $$(t){return t!=null&&typeof t.length=="number"}var ic=new ke(""),Tf=new ke(""),hoe=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ee=class{static min(n){return V$(n)}static max(n){return B$(n)}static required(n){return goe(n)}static requiredTrue(n){return yoe(n)}static email(n){return voe(n)}static minLength(n){return xoe(n)}static maxLength(n){return boe(n)}static pattern(n){return woe(n)}static nullValidator(n){return mb(n)}static compose(n){return H$(n)}static composeAsync(n){return q$(n)}};function V$(t){return n=>{if(tc(n.value)||tc(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function B$(t){return n=>{if(tc(n.value)||tc(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}function goe(t){return tc(t.value)?{required:!0}:null}function yoe(t){return t.value===!0?null:{required:!0}}function voe(t){return tc(t.value)||hoe.test(t.value)?null:{email:!0}}function xoe(t){return n=>tc(n.value)||!$$(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}function boe(t){return n=>$$(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}function woe(t){if(!t)return mb;let n,e;return typeof t=="string"?(e="",t.charAt(0)!=="^"&&(e+="^"),e+=t,t.charAt(t.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),r=>{if(tc(r.value))return null;let o=r.value;return n.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}function mb(t){return null}function z$(t){return t!=null}function U$(t){return qu(t)?In(t):t}function j$(t){let n={};return t.forEach(e=>{n=e!=null?me(me({},n),e):n}),Object.keys(n).length===0?null:n}function G$(t,n){return n.map(e=>e(t))}function Coe(t){return!t.validate}function W$(t){return t.map(n=>Coe(n)?n:e=>n.validate(e))}function H$(t){if(!t)return null;let n=t.filter(z$);return n.length==0?null:function(e){return j$(G$(e,n))}}function lD(t){return t!=null?H$(W$(t)):null}function q$(t){if(!t)return null;let n=t.filter(z$);return n.length==0?null:function(e){let r=G$(e,n).map(U$);return Eh(r).pipe(We(j$))}}function cD(t){return t!=null?q$(W$(t)):null}function D$(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function K$(t){return t._rawValidators}function X$(t){return t._rawAsyncValidators}function rD(t){return t?Array.isArray(t)?t:[t]:[]}function hb(t,n){return Array.isArray(t)?t.includes(n):t===n}function N$(t,n){let e=rD(n);return rD(t).forEach(o=>{hb(e,o)||e.push(o)}),e}function k$(t,n){return rD(n).filter(e=>!hb(t,e))}var gb=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=lD(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=cD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},Wr=class extends gb{name;get formDirective(){return null}get path(){return null}},nc=class extends gb{_parent=null;name=null;valueAccessor=null},yb=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},_oe={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},TMe=Ue(me({},_oe),{"[class.ng-submitted]":"isSubmitted"}),Nn=(()=>{class t extends yb{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(ne(nc,2))};static \u0275dir=Nt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&Do("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[Ln]})}return t})(),uo=(()=>{class t extends yb{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(ne(Wr,10))};static \u0275dir=Nt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){r&2&&Do("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[Ln]})}return t})();var qg="VALID",fb="INVALID",Cf="PENDING",Kg="DISABLED",rc=class{},vb=class extends rc{value;source;constructor(n,e){super(),this.value=n,this.source=e}},Yg=class extends rc{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},Zg=class extends rc{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},_f=class extends rc{status;source;constructor(n,e){super(),this.status=n,this.source=e}},oD=class extends rc{source;constructor(n){super(),this.source=n}},iD=class extends rc{source;constructor(n){super(),this.source=n}};function uD(t){return(Cb(t)?t.validators:t)||null}function Ioe(t){return Array.isArray(t)?lD(t):t||null}function dD(t,n){return(Cb(n)?n.asyncValidators:t)||null}function Eoe(t){return Array.isArray(t)?cD(t):t||null}function Cb(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function Y$(t,n,e){let r=t.controls;if(!(n?Object.keys(r):r).length)throw new Ie(1e3,"");if(!r[e])throw new Ie(1001,"")}function Z$(t,n,e){t._forEachChild((r,o)=>{if(e[o]===void 0)throw new Ie(1002,"")})}var If=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return ds(this.statusReactive)}set status(n){ds(()=>this.statusReactive.set(n))}_status=ql(()=>this.statusReactive());statusReactive=io(void 0);get valid(){return this.status===qg}get invalid(){return this.status===fb}get pending(){return this.status==Cf}get disabled(){return this.status===Kg}get enabled(){return this.status!==Kg}errors;get pristine(){return ds(this.pristineReactive)}set pristine(n){ds(()=>this.pristineReactive.set(n))}_pristine=ql(()=>this.pristineReactive());pristineReactive=io(!0);get dirty(){return!this.pristine}get touched(){return ds(this.touchedReactive)}set touched(n){ds(()=>this.touchedReactive.set(n))}_touched=ql(()=>this.touchedReactive());touchedReactive=io(!1);get untouched(){return!this.touched}_events=new xn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(N$(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(N$(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(k$(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(k$(n,this._rawAsyncValidators))}hasValidator(n){return hb(this._rawValidators,n)}hasAsyncValidator(n){return hb(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(Ue(me({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Zg(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),e&&n.emitEvent!==!1&&this._events.next(new Zg(!1,r))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(Ue(me({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Yg(!1,r))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),e&&n.emitEvent!==!1&&this._events.next(new Yg(!0,r))}markAsPending(n={}){this.status=Cf;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new _f(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(Ue(me({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=Kg,this.errors=null,this._forEachChild(o=>{o.disable(Ue(me({},n),{onlySelf:!0}))}),this._updateValue();let r=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new vb(this.value,r)),this._events.next(new _f(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ue(me({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=qg,this._forEachChild(r=>{r.enable(Ue(me({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Ue(me({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===qg||this.status===Cf)&&this._runAsyncValidator(r,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new vb(this.value,e)),this._events.next(new _f(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(Ue(me({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Kg:qg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=Cf,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=U$(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new _f(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,r)}_initObservables(){this.valueChanges=new Lt,this.statusChanges=new Lt}_calculateStatus(){return this._allControlsDisabled()?Kg:this.errors?fb:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Cf)?Cf:this._anyControlsHaveStatus(fb)?fb:qg}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),o&&this._events.next(new Yg(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new Zg(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Cb(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=Ioe(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=Eoe(this._rawAsyncValidators)}},Ef=class extends If{constructor(n,e,r){super(uD(e),dD(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){Z$(this,!0,n),Object.keys(n).forEach(r=>{Y$(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(r=>{let o=this.controls[r];o&&o.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,o)=>{r.reset(n?n[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>r._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var sD=class extends Ef{};var Df=new ke("",{providedIn:"root",factory:()=>Jg}),Jg="always";function _b(t,n){return[...n.path,t]}function xb(t,n,e=Jg){pD(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),Toe(t,n),Noe(t,n),Doe(t,n),Soe(t,n)}function A$(t,n,e=!0){let r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),wb(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function bb(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function Soe(t,n){if(n.valueAccessor.setDisabledState){let e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}function pD(t,n){let e=K$(t);n.validator!==null?t.setValidators(D$(e,n.validator)):typeof e=="function"&&t.setValidators([e]);let r=X$(t);n.asyncValidator!==null?t.setAsyncValidators(D$(r,n.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let o=()=>t.updateValueAndValidity();bb(n._rawValidators,o),bb(n._rawAsyncValidators,o)}function wb(t,n){let e=!1;if(t!==null){if(n.validator!==null){let o=K$(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.validator);i.length!==o.length&&(e=!0,t.setValidators(i))}}if(n.asyncValidator!==null){let o=X$(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.asyncValidator);i.length!==o.length&&(e=!0,t.setAsyncValidators(i))}}}let r=()=>{};return bb(n._rawValidators,r),bb(n._rawAsyncValidators,r),e}function Toe(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&Q$(t,n)})}function Doe(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&Q$(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function Q$(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Noe(t,n){let e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}function J$(t,n){t==null,pD(t,n)}function koe(t,n){return wb(t,n)}function eV(t,n){if(!t.hasOwnProperty("model"))return!1;let e=t.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function Aoe(t){return Object.getPrototypeOf(t.constructor)===Sf}function tV(t,n){t._syncPendingControls(),n.forEach(e=>{let r=e.control;r.updateOn==="submit"&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function nV(t,n){if(!n)return null;Array.isArray(n);let e,r,o;return n.forEach(i=>{i.constructor===wn?e=i:Aoe(i)?r=i:o=i}),o||r||e||null}function Roe(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}var Moe={provide:Wr,useExisting:gr(()=>fD)},Xg=Promise.resolve(),fD=(()=>{class t extends Wr{callSetDisabledState;get submitted(){return ds(this.submittedReactive)}_submitted=ql(()=>this.submittedReactive());submittedReactive=io(!1);_directives=new Set;form;ngSubmit=new Lt;options;constructor(e,r,o){super(),this.callSetDisabledState=o,this.form=new Ef({},lD(e),cD(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Xg.then(()=>{let r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),xb(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Xg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Xg.then(()=>{let r=this._findContainer(e.path),o=new Ef({});J$(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Xg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){Xg.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),tV(this.form,this._directives),this.ngSubmit.emit(e),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(r){return new(r||t)(ne(ic,10),ne(Tf,10),ne(Df,8))};static \u0275dir=Nt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&te("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[vr([Moe]),Ln]})}return t})();function R$(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function M$(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var Qg=class extends If{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,r){super(uD(e),dD(r,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Cb(e)&&(e.nonNullable||e.initialValueIsDefault)&&(M$(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){R$(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){R$(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){M$(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var Foe=t=>t instanceof Qg,Ooe=(()=>{class t extends Wr{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return _b(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,standalone:!1,features:[Ln]})}return t})();var Poe={provide:nc,useExisting:gr(()=>Vi)},F$=Promise.resolve(),Vi=(()=>{class t extends nc{_changeDetectorRef;callSetDisabledState;control=new Qg;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Lt;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=nV(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),eV(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){xb(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){F$.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&Fi(r);F$.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?_b(e,this._parent):[e]}static \u0275fac=function(r){return new(r||t)(ne(Wr,9),ne(ic,10),ne(Tf,10),ne(oc,10),ne(vt,8),ne(Df,8))};static \u0275dir=Nt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[vr([Poe]),Ln,Xo]})}return t})(),po=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275dir=Nt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})(),Loe={provide:oc,useExisting:gr(()=>Bi),multi:!0},Bi=(()=>{class t extends Sf{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&te("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[vr([Loe]),Ln]})}return t})(),$oe={provide:oc,useExisting:gr(()=>fa),multi:!0};var Voe=(()=>{class t{_accessors=[];add(e,r){this._accessors.push([e,r])}remove(e){for(let r=this._accessors.length-1;r>=0;--r)if(this._accessors[r][1]===e){this._accessors.splice(r,1);return}}select(e){this._accessors.forEach(r=>{this._isSameGroup(r,e)&&r[1]!==e&&r[1].fireUncheck(e.value)})}_isSameGroup(e,r){return e[0].control?e[0]._parent===r._control._parent&&e[1].name===r.name:!1}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),fa=(()=>{class t extends Sf{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=se(Df,{optional:!0})??Jg;constructor(e,r,o,i){super(e,r),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get(nc),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(r){return new(r||t)(ne(Mi),ne(Yn),ne(Voe),ne(Pn))};static \u0275dir=Nt({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(r,o){r&1&&te("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[vr([$oe]),Ln]})}return t})();var rV=new ke("");var Boe={provide:Wr,useExisting:gr(()=>fo)},fo=(()=>{class t extends Wr{callSetDisabledState;get submitted(){return ds(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=ql(()=>this._submittedReactive());_submittedReactive=io(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Lt;constructor(e,r,o){super(),this.callSetDisabledState=o,this._setValidators(e),this._setAsyncValidators(r)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(wb(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let r=this.form.get(e.path);return xb(r,e,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),r}getControl(e){return this.form.get(e.path)}removeControl(e){A$(e.control||null,e,!1),Roe(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,r){this.form.get(e.path).setValue(r)}onSubmit(e){return this._submittedReactive.set(!0),tV(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new oD(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new iD(this.form))}_updateDomValue(){this.directives.forEach(e=>{let r=e.control,o=this.form.get(e.path);r!==o&&(A$(r||null,e),Foe(o)&&(xb(o,e,this.callSetDisabledState),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let r=this.form.get(e.path);J$(r,e),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let r=this.form.get(e.path);r&&koe(r,e)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){pD(this.form,this),this._oldForm&&wb(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(r){return new(r||t)(ne(ic,10),ne(Tf,10),ne(Df,8))};static \u0275dir=Nt({type:t,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&te("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[vr([Boe]),Ln,Xo]})}return t})(),zoe={provide:Wr,useExisting:gr(()=>Ib)},Ib=(()=>{class t extends Ooe{name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}_checkParentType(){oV(this._parent)}static \u0275fac=function(r){return new(r||t)(ne(Wr,13),ne(ic,10),ne(Tf,10))};static \u0275dir=Nt({type:t,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[vr([zoe]),Ln]})}return t})(),Uoe={provide:Wr,useExisting:gr(()=>Eb)},Eb=(()=>{class t extends Wr{_parent;name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}ngOnInit(){this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return _b(this.name==null?this.name:this.name.toString(),this._parent)}_checkParentType(){oV(this._parent)}static \u0275fac=function(r){return new(r||t)(ne(Wr,13),ne(ic,10),ne(Tf,10))};static \u0275dir=Nt({type:t,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[vr([Uoe]),Ln]})}return t})();function oV(t){return!(t instanceof Ib)&&!(t instanceof fo)&&!(t instanceof Eb)}var joe={provide:nc,useExisting:gr(()=>Po)},Po=(()=>{class t extends nc{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new Lt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,r,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=nV(this,i)}ngOnChanges(e){this._added||this._setUpControl(),eV(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return _b(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||t)(ne(Wr,13),ne(ic,10),ne(Tf,10),ne(oc,10),ne(rV,8))};static \u0275dir=Nt({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[vr([joe]),Ln,Xo]})}return t})(),Goe={provide:oc,useExisting:gr(()=>hs),multi:!0};function iV(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function Woe(t){return t.split(":")[0]}var hs=(()=>{class t extends Sf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=iV(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=Woe(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&te("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[vr([Goe]),Ln]})}return t})(),gs=(()=>{class t{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(iV(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(ne(Yn),ne(Mi),ne(hs,9))};static \u0275dir=Nt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),Hoe={provide:oc,useExisting:gr(()=>sV),multi:!0};function O$(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function qoe(t){return t.split(":")[0]}var sV=(()=>{class t extends Sf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);o.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);o.push(c)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=qoe(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&te("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[vr([Hoe]),Ln]})}return t})(),ys=(()=>{class t{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(O$(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(O$(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(ne(Yn),ne(Mi),ne(sV,9))};static \u0275dir=Nt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function aV(t){return typeof t=="number"?t:parseFloat(t)}var lV=(()=>{class t{_validator=mb;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):mb,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Nt({type:t,features:[Xo]})}return t})(),Koe={provide:ic,useExisting:gr(()=>mD),multi:!0},mD=(()=>{class t extends lV{max;inputName="max";normalizeInput=e=>aV(e);createValidator=e=>B$(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&us("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[vr([Koe]),Ln]})}return t})(),Xoe={provide:ic,useExisting:gr(()=>dd),multi:!0},dd=(()=>{class t extends lV{min;inputName="min";normalizeInput=e=>aV(e);createValidator=e=>V$(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Yo(t)))(o||t)}})();static \u0275dir=Nt({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&us("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[vr([Xoe]),Ln]})}return t})();var cV=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({})}return t})(),aD=class extends If{constructor(n,e,r){super(uD(e),dD(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,r={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,e={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,r={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),e&&(this.controls.splice(o,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){Z$(this,!1,n),n.forEach((r,o)=>{Y$(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((r,o)=>{r.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,r)=>r._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,r)=>{n(e,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function P$(t){return!!t&&(t.asyncValidators!==void 0||t.validators!==void 0||t.updateOn!==void 0)}var oi=(()=>{class t{useNonNullable=!1;get nonNullable(){let e=new t;return e.useNonNullable=!0,e}group(e,r=null){let o=this._reduceControls(e),i={};return P$(r)?i=r:r!==null&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new Ef(o,i)}record(e,r=null){let o=this._reduceControls(e);return new sD(o,r)}control(e,r,o){let i={};return this.useNonNullable?(P$(r)?i=r:(i.validators=r,i.asyncValidators=o),new Qg(e,Ue(me({},i),{nonNullable:!0}))):new Qg(e,r,o)}array(e,r,o){let i=e.map(s=>this._createControl(s));return new aD(i,r,o)}_reduceControls(e){let r={};return Object.keys(e).forEach(o=>{r[o]=this._createControl(e[o])}),r}_createControl(e){if(e instanceof Qg)return e;if(e instanceof If)return e;if(Array.isArray(e)){let r=e[0],o=e.length>1?e[1]:null,i=e.length>2?e[2]:null;return this.control(r,o,i)}else return this.control(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var vs=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:Df,useValue:e.callSetDisabledState??Jg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({imports:[cV]})}return t})(),mo=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:rV,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:Df,useValue:e.callSetDisabledState??Jg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({imports:[cV]})}return t})();var Cr=[];for(let t=0;t<256;++t)Cr.push((t+256).toString(16).slice(1));function uV(t,n=0){return(Cr[t[n+0]]+Cr[t[n+1]]+Cr[t[n+2]]+Cr[t[n+3]]+"-"+Cr[t[n+4]]+Cr[t[n+5]]+"-"+Cr[t[n+6]]+Cr[t[n+7]]+"-"+Cr[t[n+8]]+Cr[t[n+9]]+"-"+Cr[t[n+10]]+Cr[t[n+11]]+Cr[t[n+12]]+Cr[t[n+13]]+Cr[t[n+14]]+Cr[t[n+15]]).toLowerCase()}var hD,Yoe=new Uint8Array(16);function gD(){if(!hD){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");hD=crypto.getRandomValues.bind(crypto)}return hD(Yoe)}var Zoe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),yD={randomUUID:Zoe};function Qoe(t,n,e){if(yD.randomUUID&&!n&&!t)return yD.randomUUID();t=t||{};let r=t.random??t.rng?.()??gD();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let o=0;o<16;++o)n[e+o]=r[o];return n}return uV(r)}var pd=Qoe;var Joe=(t,n)=>({"text-success":t,"text-danger":n});function eie(t,n){if(t&1&&(v(0,"div",138),U(1,"div",139),y()),t&2){let e=Y();O(),Zp("width",e.calculateFormProgress()+"%")}}function tie(t,n){if(t&1&&(v(0,"span",140),w(1),y()),t&2){let e=Y();O(),$e("",e.calculateFormProgress(),"% Complete")}}function nie(t,n){t&1&&(v(0,"div",141),w(1," Account name is required "),y())}function rie(t,n){t&1&&(v(0,"div",141),w(1," Please select an instrument type "),y())}function oie(t,n){t&1&&(v(0,"div",141),w(1," Trade symbol is required "),y())}function iie(t,n){t&1&&(v(0,"div",141),w(1," Please select trade direction "),y())}function sie(t,n){t&1&&(v(0,"div",141),w(1," Time frame selection is required "),y())}function aie(t,n){t&1&&(v(0,"div",141),w(1," Please select an analysis type "),y())}function lie(t,n){t&1&&(v(0,"div",141),w(1," Strategy name is required "),y())}function cie(t,n){t&1&&(v(0,"div",141),w(1," Order type is required "),y())}function uie(t,n){t&1&&(v(0,"div",141),w(1," Entry criteria is required (min 10 characters) "),y())}function die(t,n){t&1&&(v(0,"div",141),w(1," Exit strategy is required (min 10 characters) "),y())}function pie(t,n){t&1&&(v(0,"div",141),w(1," Valid account balance is required "),y())}function fie(t,n){t&1&&(v(0,"div",141),w(1," Position size is required "),y())}function mie(t,n){t&1&&(v(0,"div",141),w(1," Valid entry price is required "),y())}function hie(t,n){t&1&&(v(0,"div",141),w(1," Entry date/time is required "),y())}function gie(t,n){t&1&&(v(0,"div",141),w(1," Stop loss price is required "),y())}function yie(t,n){t&1&&(v(0,"div",141),w(1," Take profit price is required "),y())}function vie(t,n){t&1&&(v(0,"div",141),w(1," Risk percentage is required "),y())}function xie(t,n){t&1&&(v(0,"div",142),U(1,"i",143),w(2," Risk exceeds recommended 2% "),y())}function bie(t,n){t&1&&(v(0,"div",141),w(1," Estimated reward is required "),y())}function wie(t,n){t&1&&(v(0,"div",141),w(1," Please select your emotional state "),y())}function Cie(t,n){t&1&&(v(0,"div",142),U(1,"i",143),w(2," Consider if this emotional state might negatively impact your decision making "),y())}function _ie(t,n){t&1&&(v(0,"div",144),w(1," Please rate your confidence "),y())}function Iie(t,n){t&1&&(v(0,"div",141),w(1," Please identify potential biases (min 5 characters) "),y())}function Eie(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Trade Setup"),y())}function Sie(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Strategy Details"),y())}function Tie(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Risk Management"),y())}function Die(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Psychological Analysis"),y())}function Nie(t,n){if(t&1&&(v(0,"div",145),U(1,"i",146),v(2,"strong"),w(3,"Please fix the errors highlighted above before submitting."),y(),v(4,"ul",147),re(5,Eie,2,0,"li",148)(6,Sie,2,0,"li",148)(7,Tie,2,0,"li",148)(8,Die,2,0,"li",148),y()()),t&2){let e=Y();O(5),z("ngIf",e.hasErrors("tradeSetup")),O(),z("ngIf",e.hasErrors("strategyDetails")),O(),z("ngIf",e.hasErrors("riskManagement")),O(),z("ngIf",e.hasErrors("psychologicalAnalysis"))}}function kie(t,n){if(t&1){let e=Je();v(0,"button",149),te("click",function(){le(e);let o=Y();return ce(o.onCancel())}),U(1,"i",150),w(2,"Cancel "),y()}}function Aie(t,n){if(t&1&&(v(0,"div",151),U(1,"i",152),w(2),y()),t&2){let e=Y();O(2),$e("",e.message," ")}}function Rie(t,n){if(t&1&&(v(0,"div",153),U(1,"i",146),w(2),y()),t&2){let e=Y();O(2),$e("",e.errorMessage," ")}}var Nf=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r}tradeLogData=null;formSubmitted=new Lt;cancel=new Lt;preTradeTableName="pretrade";postTradeTableName="posttrade";preTradeForm;postTradeForm;showEmotionalSection=!1;message="";errorMessage="";formSubmitMarker=!1;ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=pd();this.preTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[this.tradeLogData?.createdtime??new Date().toISOString()],accountname:[this.tradeLogData?.accountname??"",Ee.required],instrumenttype:[this.tradeLogData?.instrumenttype??"",Ee.required],analysistype:[this.tradeLogData?.analysistype??"",Ee.required],tradesymbol:[this.tradeLogData?.tradesymbol??"",Ee.required],tradetype:[this.tradeLogData?.tradetype??"Long",Ee.required],timeframe:[this.tradeLogData?.timeframe??"Day",Ee.required],strategyname:[this.tradeLogData?.strategyname??""],typeoforder:[this.tradeLogData?.typeoforder??"",Ee.required],entrycriteria:[this.tradeLogData?.entrycriteria??""],exitstrategy:[this.tradeLogData?.exitstrategy??""],entrydatetime:[this.tradeLogData?.entrydatetime??""],entryprice:[this.tradeLogData?.entryprice??""],accountbalance:[this.tradeLogData?.accountbalance??null,[Ee.required,Ee.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",Ee.required],estimatedrisk:[this.tradeLogData?.estimatedrisk??null,Ee.required],estimatedpnl:[this.tradeLogData?.estimatedpnl??null,Ee.required],estimatedstoploss:[this.tradeLogData?.estimatedstoploss??null,Ee.required],estimatedtakeprofit:[this.tradeLogData?.estimatedtakeprofit??null,Ee.required],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],tradeconfidence:[this.tradeLogData?.tradeconfidence??"1"],isopen:!0,emotionalstatebefore:[this.tradeLogData?.emotionalstatebefore??"",Ee.required],potentialbiases:[this.tradeLogData?.potentialbiases??"",Ee.required],notes:[this.tradeLogData?.notes??""],updatedtime:[new Date().toISOString()]})}toggleEmotionalSection(){this.showEmotionalSection=!this.showEmotionalSection}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.preTradeForm.patchValue({setupscreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.preTradeForm.invalid){this.preTradeForm.markAllAsTouched();return}let n=this.preTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.preTradeTableName):await this.supabaseService.addTradeLog(n,this.preTradeTableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.preTradeForm.reset(),this.preTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.preTradeTableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateFormProgress(){let e=0;return this.preTradeForm.get("accountname")?.valid&&e++,this.preTradeForm.get("instrumenttype")?.valid&&e++,this.preTradeForm.get("tradesymbol")?.valid&&e++,this.preTradeForm.get("tradetype")?.valid&&e++,this.preTradeForm.get("timeframe")?.valid&&e++,this.preTradeForm.get("analysistype")?.valid&&e++,this.preTradeForm.get("strategyname")?.valid&&e++,this.preTradeForm.get("typeoforder")?.valid&&e++,this.preTradeForm.get("entrycriteria")?.valid&&e++,this.preTradeForm.get("exitstrategy")?.valid&&e++,this.preTradeForm.get("accountbalance")?.valid&&e++,this.preTradeForm.get("positionsize")?.valid&&e++,this.preTradeForm.get("entryprice")?.valid&&e++,this.preTradeForm.get("entrydatetime")?.valid&&e++,this.preTradeForm.get("estimatedstoploss")?.valid&&e++,this.preTradeForm.get("estimatedtakeprofit")?.valid&&e++,this.preTradeForm.get("estimatedrisk")?.valid&&e++,this.preTradeForm.get("estimatedpnl")?.valid&&e++,this.preTradeForm.get("emotionalstatebefore")?.valid&&e++,this.preTradeForm.get("tradeConfidence")?.valid&&e++,this.preTradeForm.get("potentialbiases")?.valid&&e++,Math.round(e/18*100)}calculateRiskRewardRatio(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?"N/A":`1:${(e/n).toFixed(2)}`}isGoodRiskReward(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?!1:e/n>=2}isNegativeEmotionalState(){let n=this.preTradeForm.get("emotionalstatebefore")?.value;return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}hasErrors(n){switch(n){case"tradeSetup":return this.preTradeForm.get("accountname")?.invalid||this.preTradeForm.get("instrumenttype")?.invalid||this.preTradeForm.get("tradesymbol")?.invalid||this.preTradeForm.get("tradetype")?.invalid||this.preTradeForm.get("timeframe")?.invalid||this.preTradeForm.get("analysistype")?.invalid||!1;case"strategyDetails":return this.preTradeForm.get("strategyname")?.invalid||this.preTradeForm.get("typeoforder")?.invalid||this.preTradeForm.get("entrycriteria")?.invalid||this.preTradeForm.get("exitstrategy")?.invalid||!1;case"riskManagement":return this.preTradeForm.get("accountbalance")?.invalid||this.preTradeForm.get("positionsize")?.invalid||this.preTradeForm.get("entryprice")?.invalid||this.preTradeForm.get("entrydatetime")?.invalid||this.preTradeForm.get("estimatedstoploss")?.invalid||this.preTradeForm.get("estimatedtakeprofit")?.invalid||this.preTradeForm.get("estimatedrisk")?.invalid||this.preTradeForm.get("estimatedpnl")?.invalid||!1;case"psychologicalAnalysis":return this.preTradeForm.get("emotionalstatebefore")?.invalid||this.preTradeForm.get("tradeConfidence")?.invalid||this.preTradeForm.get("potentialbiases")?.invalid||!1;default:return!1}}static \u0275fac=function(e){return new(e||t)(ne(oi),ne(Ct),ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-pre-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:332,vars:40,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],[3,"click"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","entrycriteria",1,"form-label"],["id","entrycriteria","formControlName","entrycriteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)","rows","3",1,"form-control"],[1,"form-text"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Define your profit targets and stop loss levels","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],["type","button","data-bs-toggle","tooltip","title","Calculate based on risk",1,"btn","btn-outline-secondary"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Planned entry price",1,"form-control"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","estimatedstoploss",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedstoploss","formControlName","estimatedstoploss","placeholder","Stop loss price level",1,"form-control"],["for","estimatedtakeprofit",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedtakeprofit","formControlName","estimatedtakeprofit","placeholder","Target price level",1,"form-control"],[1,"mb-3"],[1,"col-md-4"],["for","estimatedrisk",1,"form-label"],["type","number","step","0.01","min","0","max","100","id","estimatedrisk","formControlName","estimatedrisk","placeholder","1-2% recommended",1,"form-control"],["class","text-warning mt-1 small",4,"ngIf"],["for","estimatedpnl",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedpnl","formControlName","estimatedpnl","placeholder","Expected % gain",1,"form-control"],[1,"form-label"],["type","text","readonly","",1,"form-control","bg-light",3,"value"],[1,"form-text",3,"ngClass"],[1,"bi","bi-5-circle","me-2"],["for","emotionalstatebefore",1,"form-label"],["id","emotionalstatebefore","formControlName","emotionalstatebefore",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],[1,"form-label","d-block"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","tradeconfidence","id","confidence1","value","1",1,"btn-check"],["for","confidence1",1,"btn","btn-outline-danger"],["type","radio","formControlName","tradeconfidence","id","confidence2","value","2",1,"btn-check"],["for","confidence2",1,"btn","btn-outline-warning"],["type","radio","formControlName","tradeconfidence","id","confidence3","value","3",1,"btn-check"],["for","confidence3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","tradeconfidence","id","confidence4","value","4",1,"btn-check"],["for","confidence4",1,"btn","btn-outline-primary"],["type","radio","formControlName","tradeconfidence","id","confidence5","value","5",1,"btn-check"],["for","confidence5",1,"btn","btn-outline-success"],[1,"form-text","text-center","mt-1"],["class","text-danger mt-1 small text-center",4,"ngIf"],["for","potentialbiases",1,"form-label"],["id","potentialbiases","formControlName","potentialbiases","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO, overconfidence)","rows","3",1,"form-control"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"text-warning","mt-1","small"],[1,"bi","bi-exclamation-triangle"],[1,"text-danger","mt-1","small","text-center"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),te("click",function(){return r.onCancel()}),w(8,"Pre-Trade Logs"),y()(),v(9,"li",6),w(10,"Pre-Trading Journal"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),w(14),y(),v(15,"p",10),w(16,"Document your strategy before entering positions to maintain discipline and clarity"),y()(),v(17,"div",11),re(18,eie,2,2,"div",12)(19,tie,2,1,"span",13),y()(),v(20,"form",14),te("ngSubmit",function(){return r.onSubmit()}),v(21,"div",15)(22,"div",16)(23,"h5",17),U(24,"i",18),w(25,"Trade Setup "),y(),v(26,"span",19),w(27,"Required"),y()(),v(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),w(32,"Account Name"),y(),v(33,"div",24)(34,"span",25),U(35,"i",26),y(),U(36,"input",27),y(),re(37,nie,2,0,"div",28),y(),v(38,"div",22)(39,"label",29),w(40,"Instrument Type"),y(),v(41,"select",30)(42,"option",31),w(43,"Choose instrument type"),y(),v(44,"option",32),w(45,"Forex"),y(),v(46,"option",33),w(47,"Stocks"),y(),v(48,"option",34),w(49,"Futures"),y(),v(50,"option",35),w(51,"Crypto"),y(),v(52,"option",36),w(53,"Options"),y(),v(54,"option",37),w(55,"ETF"),y(),v(56,"option",38),w(57,"Other"),y()(),re(58,rie,2,0,"div",28),y(),v(59,"div",22)(60,"label",39),w(61,"Trade Symbol"),y(),v(62,"div",24)(63,"span",25),U(64,"i",40),y(),U(65,"input",41),y(),re(66,oie,2,0,"div",28),y(),v(67,"div",22)(68,"label",42),w(69,"Trade Direction"),y(),v(70,"div",43),U(71,"input",44),v(72,"label",45),w(73,"Long"),y(),U(74,"input",46),v(75,"label",47),w(76,"Short"),y()(),re(77,iie,2,0,"div",28),y(),v(78,"div",22)(79,"label",48),w(80,"Time Frame"),y(),v(81,"select",49)(82,"option",31),w(83,"Select time frame"),y(),v(84,"option",50),w(85,"Scalp (minutes)"),y(),v(86,"option",51),w(87,"Day Trade (hours)"),y(),v(88,"option",52),w(89,"Swing (days-weeks)"),y(),v(90,"option",53),w(91,"Position (weeks-months)"),y(),v(92,"option",54),w(93,"Long Term (months+)"),y()(),re(94,sie,2,0,"div",28),y(),v(95,"div",22)(96,"label",55),w(97,"Analysis Type"),y(),v(98,"select",56)(99,"option",31),w(100,"Choose analysis method"),y(),v(101,"option",57),w(102,"Technical"),y(),v(103,"option",58),w(104,"Fundamental"),y(),v(105,"option",59),w(106,"Both"),y(),v(107,"option",60),w(108,"Sentiment"),y(),v(109,"option",38),w(110,"Other"),y()(),re(111,aie,2,0,"div",28),y()()()(),v(112,"div",15)(113,"div",16)(114,"h5",17),U(115,"i",61),w(116,"Strategy Details "),y(),v(117,"span",19),w(118,"Required"),y()(),v(119,"div",20)(120,"div",21)(121,"div",22)(122,"label",62),w(123,"Strategy Name"),y(),U(124,"input",63),re(125,lie,2,0,"div",28),y(),v(126,"div",22)(127,"label",64),w(128,"Type of Order"),y(),v(129,"select",65)(130,"option",31),w(131,"Choose order type"),y(),v(132,"option",66),w(133,"Market"),y(),v(134,"option",67),w(135,"Limit"),y(),v(136,"option",68),w(137,"Stop"),y(),v(138,"option",69),w(139,"Stop Limit"),y(),v(140,"option",70),w(141,"Trailing Stop"),y()(),re(142,cie,2,0,"div",28),y(),v(143,"div",71)(144,"label",72),w(145,"Entry Criteria "),v(146,"span",10),w(147,"(Why are you taking this trade?)"),y()(),U(148,"textarea",73),v(149,"div",74),w(150,"Be specific about what signals or conditions must be met for entry."),y(),re(151,uie,2,0,"div",28),y(),v(152,"div",71)(153,"label",75),w(154,"Exit Strategy "),v(155,"span",10),w(156,"(How will you close this position?)"),y()(),U(157,"textarea",76),v(158,"div",74),w(159,"Include both profit-taking and loss-cutting criteria."),y(),re(160,die,2,0,"div",28),y()()()(),v(161,"div",15)(162,"div",16)(163,"h5",17),U(164,"i",77),w(165,"Risk Management "),y(),v(166,"span",19),w(167,"Required"),y()(),v(168,"div",20)(169,"div",21)(170,"div",22)(171,"label",78),w(172,"Account Balance"),y(),v(173,"div",24)(174,"span",25),w(175,"$"),y(),U(176,"input",79),y(),re(177,pie,2,0,"div",28),y(),v(178,"div",22)(179,"label",80),w(180,"Position Size"),y(),v(181,"div",24),U(182,"input",81),v(183,"button",82),w(184,"Calculate"),y()(),re(185,fie,2,0,"div",28),y(),v(186,"div",22)(187,"label",83),w(188,"Entry Price"),y(),v(189,"div",24)(190,"span",25),w(191,"$"),y(),U(192,"input",84),y(),re(193,mie,2,0,"div",28),y(),v(194,"div",22)(195,"label",85),w(196,"Entry Date/Time"),y(),U(197,"input",86),re(198,hie,2,0,"div",28),y(),v(199,"div",22)(200,"label",87),w(201,"Stop Loss Price"),y(),v(202,"div",24)(203,"span",25),w(204,"$"),y(),U(205,"input",88),y(),re(206,gie,2,0,"div",28),y(),v(207,"div",22)(208,"label",89),w(209,"Take Profit Price"),y(),v(210,"div",24)(211,"span",25),w(212,"$"),y(),U(213,"input",90),y(),re(214,yie,2,0,"div",28),y(),v(215,"div",71),U(216,"hr"),v(217,"h6",91),w(218,"Risk/Reward Analysis"),y()(),v(219,"div",92)(220,"label",93),w(221,"Risk Per Trade"),y(),v(222,"div",24),U(223,"input",94),v(224,"span",25),w(225,"%"),y()(),v(226,"div",74),w(227,"Percentage of account at risk"),y(),re(228,vie,2,0,"div",28)(229,xie,3,0,"div",95),y(),v(230,"div",92)(231,"label",96),w(232,"Estimated Reward"),y(),v(233,"div",24),U(234,"input",97),v(235,"span",25),w(236,"%"),y()(),re(237,bie,2,0,"div",28),y(),v(238,"div",92)(239,"label",98),w(240,"Risk/Reward Ratio"),y(),v(241,"div",24),U(242,"input",99),v(243,"span",25),w(244,"R:R"),y()(),v(245,"div",100),U(246,"i"),w(247),y()()()()(),v(248,"div",15)(249,"div",16)(250,"h5",17),U(251,"i",101),w(252,"Psychological Analysis "),y(),v(253,"span",19),w(254,"Required"),y()(),v(255,"div",20)(256,"div",21)(257,"div",22)(258,"label",102),w(259,"Current Emotional State"),y(),v(260,"select",103)(261,"option",31),w(262,"How are you feeling?"),y(),v(263,"option",104),w(264,"Calm & Focused"),y(),v(265,"option",105),w(266,"Excited"),y(),v(267,"option",106),w(268,"Anxious"),y(),v(269,"option",107),w(270,"Frustrated"),y(),v(271,"option",108),w(272,"Overconfident"),y(),v(273,"option",109),w(274,"Fearful"),y(),v(275,"option",110),w(276,"Neutral"),y(),v(277,"option",38),w(278,"Other"),y()(),re(279,wie,2,0,"div",28)(280,Cie,3,0,"div",95),y(),v(281,"div",22)(282,"label",111),w(283,"Trading Confidence"),y(),v(284,"div",112),U(285,"input",113),v(286,"label",114),w(287,"1"),y(),U(288,"input",115),v(289,"label",116),w(290,"2"),y(),U(291,"input",117),v(292,"label",118),w(293,"3"),y(),U(294,"input",119),v(295,"label",120),w(296,"4"),y(),U(297,"input",121),v(298,"label",122),w(299,"5"),y()(),v(300,"div",123),w(301,"Low (1) to High (5)"),y(),re(302,_ie,2,0,"div",124),y(),v(303,"div",71)(304,"label",125),w(305,"Potential Biases"),y(),U(306,"textarea",126),v(307,"div",74),w(308,"Identifying biases helps improve future decision making"),y(),re(309,Iie,2,0,"div",28),y()()()(),v(310,"div",15)(311,"div",16)(312,"h5",17),U(313,"i",127),w(314,"Additional Notes "),y(),v(315,"span",128),w(316,"Optional"),y()(),v(317,"div",20)(318,"div",21)(319,"div",71)(320,"label",129),w(321,"Notes"),y(),U(322,"textarea",130),y()()()(),re(323,Nie,9,4,"div",131),v(324,"div",132),re(325,kie,3,0,"button",133),v(326,"div")(327,"button",134),U(328,"i",135),w(329),y()()(),re(330,Aie,3,1,"div",136)(331,Rie,3,1,"div",137),y()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,x,b,I,_,E,S,D,M,R;O(14),Ke(r.tradeLogData?"Edit Pre-Trading Journal":"Create Pre-Trading Journal"),O(4),z("ngIf",!r.tradeLogData),O(),z("ngIf",!r.tradeLogData),O(),z("formGroup",r.preTradeForm),O(17),z("ngIf",((o=r.preTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.preTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.preTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),O(21),z("ngIf",((i=r.preTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.preTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.preTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),O(8),z("ngIf",((s=r.preTradeForm.get("tradesymbol"))==null?null:s.invalid)&&(((s=r.preTradeForm.get("tradesymbol"))==null?null:s.dirty)||((s=r.preTradeForm.get("tradesymbol"))==null?null:s.touched)||r.formSubmitMarker)),O(11),z("ngIf",((a=r.preTradeForm.get("tradetype"))==null?null:a.invalid)&&(((a=r.preTradeForm.get("tradetype"))==null?null:a.dirty)||((a=r.preTradeForm.get("tradetype"))==null?null:a.touched)||r.formSubmitMarker)),O(17),z("ngIf",((l=r.preTradeForm.get("timeframe"))==null?null:l.invalid)&&(((l=r.preTradeForm.get("timeframe"))==null?null:l.dirty)||((l=r.preTradeForm.get("timeframe"))==null?null:l.touched)||r.formSubmitMarker)),O(17),z("ngIf",((c=r.preTradeForm.get("analysistype"))==null?null:c.invalid)&&(((c=r.preTradeForm.get("analysistype"))==null?null:c.dirty)||((c=r.preTradeForm.get("analysistype"))==null?null:c.touched)||r.formSubmitMarker)),O(14),z("ngIf",((u=r.preTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.preTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.preTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),O(17),z("ngIf",((d=r.preTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.preTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.preTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),O(9),z("ngIf",((p=r.preTradeForm.get("entrycriteria"))==null?null:p.invalid)&&(((p=r.preTradeForm.get("entrycriteria"))==null?null:p.dirty)||((p=r.preTradeForm.get("entrycriteria"))==null?null:p.touched)||r.formSubmitMarker)),O(9),z("ngIf",((f=r.preTradeForm.get("exitstrategy"))==null?null:f.invalid)&&(((f=r.preTradeForm.get("exitstrategy"))==null?null:f.dirty)||((f=r.preTradeForm.get("exitstrategy"))==null?null:f.touched)||r.formSubmitMarker)),O(17),z("ngIf",((m=r.preTradeForm.get("accountbalance"))==null?null:m.invalid)&&(((m=r.preTradeForm.get("accountbalance"))==null?null:m.dirty)||((m=r.preTradeForm.get("accountbalance"))==null?null:m.touched)||r.formSubmitMarker)),O(8),z("ngIf",((h=r.preTradeForm.get("positionsize"))==null?null:h.invalid)&&(((h=r.preTradeForm.get("positionsize"))==null?null:h.dirty)||((h=r.preTradeForm.get("positionsize"))==null?null:h.touched)||r.formSubmitMarker)),O(8),z("ngIf",((g=r.preTradeForm.get("entryprice"))==null?null:g.invalid)&&(((g=r.preTradeForm.get("entryprice"))==null?null:g.dirty)||((g=r.preTradeForm.get("entryprice"))==null?null:g.touched)||r.formSubmitMarker)),O(5),z("ngIf",((x=r.preTradeForm.get("entrydatetime"))==null?null:x.invalid)&&(((x=r.preTradeForm.get("entrydatetime"))==null?null:x.dirty)||((x=r.preTradeForm.get("entrydatetime"))==null?null:x.touched)||r.formSubmitMarker)),O(8),z("ngIf",((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.invalid)&&(((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.dirty)||((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.touched)||r.formSubmitMarker)),O(8),z("ngIf",((I=r.preTradeForm.get("estimatedtakeprofit"))==null?null:I.invalid)&&(((I=r.preTradeForm.get("estimatedtakeprofit"))==null?null:I.dirty)||((I=r.preTradeForm.get("estimatedtakeprofit"))==null?null:I.touched)||r.formSubmitMarker)),O(14),z("ngIf",((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.invalid)&&(((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.dirty)||((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.touched)||r.formSubmitMarker)),O(),z("ngIf",((E=r.preTradeForm.get("estimatedrisk"))==null?null:E.value)>2),O(8),z("ngIf",((S=r.preTradeForm.get("estimatedpnl"))==null?null:S.invalid)&&(((S=r.preTradeForm.get("estimatedpnl"))==null?null:S.dirty)||((S=r.preTradeForm.get("estimatedpnl"))==null?null:S.touched)||r.formSubmitMarker)),O(5),z("value",r.calculateRiskRewardRatio()),O(3),z("ngClass",Qo(37,Joe,r.isGoodRiskReward(),!r.isGoodRiskReward())),O(),nx(r.isGoodRiskReward()?"bi bi-check-circle":"bi bi-x-circle"),O(),$e(" ",r.isGoodRiskReward()?"Good risk/reward ratio":"Risk/reward should be at least 1:2"," "),O(32),z("ngIf",((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.invalid)&&(((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.dirty)||((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.touched)||r.formSubmitMarker)),O(),z("ngIf",r.isNegativeEmotionalState()),O(22),z("ngIf",((M=r.preTradeForm.get("tradeconfidence"))==null?null:M.invalid)&&(((M=r.preTradeForm.get("tradeconfidence"))==null?null:M.dirty)||((M=r.preTradeForm.get("tradeconfidence"))==null?null:M.touched)||r.formSubmitMarker)),O(7),z("ngIf",((R=r.preTradeForm.get("potentialbiases"))==null?null:R.invalid)&&(((R=r.preTradeForm.get("potentialbiases"))==null?null:R.dirty)||((R=r.preTradeForm.get("potentialbiases"))==null?null:R.touched)||r.formSubmitMarker)),O(14),z("ngIf",r.formSubmitMarker&&r.preTradeForm.invalid),O(2),z("ngIf",r.tradeLogData),O(4),$e("",r.tradeLogData?"Update":"Submit"," "),O(),z("ngIf",r.message),O(),z("ngIf",r.errorMessage)}},dependencies:[kt,lo,Ut,mo,po,gs,ys,wn,Bi,hs,fa,Nn,uo,dd,mD,fo,Po,zn],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function Mie(t,n){t&1&&(v(0,"div",12),w(1,"Loading trade logs..."),y())}function Fie(t,n){if(t&1&&(v(0,"div",13),w(1),y()),t&2){let e=Y();O(),Ke(e.errorMessage)}}function Oie(t,n){if(t&1){let e=Je();v(0,"div",16)(1,"div",17),te("click",function(){let o=le(e).$implicit,i=Y(2);return ce(i.openEditModal(o))}),v(2,"div",18),U(3,"i",19),w(4," Planned "),y(),v(5,"div",20),te("click",function(o){let i=le(e).$implicit,s=Y(2);return ce(s.onDeleteTradeLog(i,o))}),U(6,"i",21),y(),v(7,"div",22)(8,"h4",23),w(9),y(),v(10,"h5",24),w(11),y(),v(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),w(16,"Analysis:"),y(),w(17),y(),v(18,"div",27)(19,"strong"),w(20,"Order:"),y(),w(21),y()(),v(22,"div",26)(23,"div",27)(24,"strong"),w(25,"Stop Loss:"),y(),w(26),y(),v(27,"div",27)(28,"strong"),w(29,"Take Profit:"),y(),w(30),y()(),v(31,"div",26)(32,"div",27)(33,"strong"),w(34,"Risk:"),y(),w(35),y(),v(36,"div",27)(37,"strong"),w(38,"Est. PnL:"),y(),w(39),y()(),v(40,"div",28)(41,"div",29)(42,"strong"),w(43,"Account:"),y(),w(44),y()()(),v(45,"div",30)(46,"small",31),w(47),No(48,"date"),y()()()()()}if(t&2){let e=n.$implicit;O(9),Ke(e.tradesymbol),O(2),Xu(" ",e.tradetype," | ",e.instrumenttype," "),O(6),$e(" ",e.analysistype," "),O(4),$e(" ",e.typeoforder," "),O(5),$e(" ",e.estimatedstoploss," "),O(4),$e(" ",e.estimatedtakeprofit," "),O(5),$e(" ",e.estimatedrisk," "),O(4),$e(" ",e.estimatedpnl," "),O(5),$e(" ",e.accountname," "),O(3),Ke(ko(48,11,e.createdtime,"medium"))}}function Pie(t,n){if(t&1&&(v(0,"div",14),re(1,Oie,49,14,"div",15),y()),t&2){let e=Y();O(),z("ngForOf",e.tradeLogs)}}function Lie(t,n){t&1&&(v(0,"div",32),w(1," No trade logs found. "),y())}function $ie(t,n){if(t&1){let e=Je();v(0,"div",33),te("click",function(o){le(e);let i=Y();return ce(i.closeModalOnOverlayClick(o))}),v(1,"div",34),te("click",function(o){return le(e),ce(o.stopPropagation())}),v(2,"app-pre-trade-log",35),te("formSubmitted",function(){le(e);let o=Y();return ce(o.onFormSubmitted())})("cancel",function(){le(e);let o=Y();return ce(o.closeModal())}),y()()()}if(t&2){let e=Y();O(2),z("tradeLogData",e.selectedTradeLog)}}var Sb=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="pretrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName)}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(ne(Ct),ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-pre-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/pretradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click"],[1,"trade-status-indicator","status-planned"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",5),w(7,"Pre-Trade Logs"),y(),v(8,"li",3)(9,"a",6),w(10,"Pre-Trading Journal"),y()()()(),v(11,"h2"),w(12,"Pre Trade Logs"),y(),re(13,Mie,2,0,"div",7)(14,Fie,2,1,"div",8)(15,Pie,2,1,"div",9)(16,Lie,2,0,"div",10),y(),re(17,$ie,3,1,"div",11)),e&2&&(O(13),z("ngIf",r.loading),O(),z("ngIf",r.errorMessage),O(),z("ngIf",r.tradeLogs&&r.tradeLogs.length),O(),z("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),O(),z("ngIf",r.showModal))},dependencies:[zn,kt,Bn,Ut,ei,Nf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease;border-left:4px solid #6c757d!important}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-planned[_ngcontent-%COMP%]{background-color:#6c757d}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0})};function Vie(t,n){if(t&1&&(v(0,"div",131),U(1,"div",132),y()),t&2){let e=Y();O(),Zp("width",e.calculateFormProgress()+"%")}}function Bie(t,n){if(t&1&&(v(0,"span",133),w(1),y()),t&2){let e=Y();O(),$e("",e.calculateFormProgress(),"% Complete")}}function zie(t,n){t&1&&(v(0,"div",134),w(1," Account name is required "),y())}function Uie(t,n){t&1&&(v(0,"div",134),w(1," Please select an instrument type "),y())}function jie(t,n){t&1&&(v(0,"div",134),w(1," Please select an analysis type "),y())}function Gie(t,n){t&1&&(v(0,"div",134),w(1," Trade symbol is required "),y())}function Wie(t,n){t&1&&(v(0,"div",134),w(1," Please select trade direction "),y())}function Hie(t,n){t&1&&(v(0,"div",134),w(1," Time frame selection is required "),y())}function qie(t,n){t&1&&(v(0,"div",134),w(1," Strategy name is required "),y())}function Kie(t,n){t&1&&(v(0,"div",134),w(1," Order type is required "),y())}function Xie(t,n){t&1&&(v(0,"div",134),w(1," Entry date/time is required "),y())}function Yie(t,n){t&1&&(v(0,"div",134),w(1," Exit date/time is required "),y())}function Zie(t,n){t&1&&(v(0,"div",134),w(1," Valid entry price is required "),y())}function Qie(t,n){t&1&&(v(0,"div",134),w(1," Valid exit price is required "),y())}function Jie(t,n){t&1&&(v(0,"div",134),w(1," Position size is required "),y())}function ese(t,n){t&1&&(v(0,"div",134),w(1," Please select trade outcome "),y())}function tse(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Trade Details"),y())}function nse(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Strategy Information"),y())}function rse(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Trade Execution"),y())}function ose(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Trade Outcome"),y())}function ise(t,n){t&1&&(v(0,"li"),w(1,"Complete all required fields in Post-Trade Analysis"),y())}function sse(t,n){if(t&1&&(v(0,"div",135),U(1,"i",136),v(2,"strong"),w(3,"Please fix the errors highlighted above before submitting."),y(),v(4,"ul",137),re(5,tse,2,0,"li",138)(6,nse,2,0,"li",138)(7,rse,2,0,"li",138)(8,ose,2,0,"li",138)(9,ise,2,0,"li",138),y()()),t&2){let e=Y();O(5),z("ngIf",e.hasErrors("tradeDetails")),O(),z("ngIf",e.hasErrors("strategyInformation")),O(),z("ngIf",e.hasErrors("tradeExecution")),O(),z("ngIf",e.hasErrors("tradeOutcome")),O(),z("ngIf",e.hasErrors("postTradeAnalysis"))}}function ase(t,n){if(t&1){let e=Je();v(0,"button",139),te("click",function(){le(e);let o=Y();return ce(o.onCancel())}),U(1,"i",140),w(2,"Cancel "),y()}}function lse(t,n){if(t&1&&(v(0,"div",141),U(1,"i",142),w(2),y()),t&2){let e=Y();O(2),$e("",e.message," ")}}function cse(t,n){if(t&1&&(v(0,"div",143),U(1,"i",136),w(2),y()),t&2){let e=Y();O(2),$e("",e.errorMessage," ")}}var kf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabaseService=r}tradeLogData=null;formSubmitted=new Lt;cancel=new Lt;tableName="posttrade";postTradeForm;message="";errorMessage="";formSubmitMarker=!1;tradeOutcomes=["Win","Loss","Breakeven"];tradeDirections=["Long","Short"];ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=pd();this.postTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[new Date().toISOString(),Ee.required],accountname:[this.tradeLogData?.accountname,[Ee.required,Ee.maxLength(255)]],accountbalance:[this.tradeLogData?.accountbalance??""],instrumenttype:[this.tradeLogData?.instrumenttype??"",[Ee.required,Ee.maxLength(50)]],analysistype:[this.tradeLogData?.analysistype??"",[Ee.required,Ee.maxLength(100)]],tradesymbol:[this.tradeLogData?.tradesymbol??"",[Ee.required,Ee.maxLength(50)]],tradetype:[this.tradeLogData?.tradetype??"",[Ee.required,Ee.maxLength(50)]],timeframe:[this.tradeLogData?.timeframe??"",[Ee.required,Ee.maxLength(50)]],entrydatetime:[this.tradeLogData?.entrydatetime??"",Ee.required],strategyname:[this.tradeLogData?.strategyname??"",[Ee.required,Ee.maxLength(255)]],typeoforder:[this.tradeLogData?.typeoforder??"",[Ee.required,Ee.maxLength(50)]],exitstrategy:[this.tradeLogData?.exitstrategy??""],entryprice:[this.tradeLogData?.entryprice??"",[Ee.required,Ee.min(0)]],exitprice:[this.tradeLogData?.exitprice??"",[Ee.required,Ee.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",[Ee.required,Ee.maxLength(50)]],exitdatetime:[this.tradeLogData?.exitdatetime??"",Ee.required],tradeoutcome:[this.tradeLogData?.tradeoutcome??"",Ee.required],profitlossamount:[this.tradeLogData?.profitlossamount??""],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],emotionalstateafter:[this.tradeLogData?.emotionalstateafter??""],emotionalimpactondecision:[this.tradeLogData?.emotionalimpactondecision??""],whatwentwell:[this.tradeLogData?.whatwentwell??""],whatcouldimprove:[this.tradeLogData?.whatcouldimprove??""],notes:[this.tradeLogData?.notes??""],isopen:[this.tradeLogData?.isopen??!0,Ee.required],updatedtime:[new Date().toDateString(),Ee.required]})}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.postTradeForm.patchValue({setupScreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.postTradeForm.invalid){this.postTradeForm.markAllAsTouched();return}let n=this.postTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.tableName):await this.supabaseService.addTradeLog(n,this.tableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.postTradeForm.reset(),this.postTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.tableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateProfitLoss(){let n=this.postTradeForm.get("entryprice")?.value,e=this.postTradeForm.get("exitprice")?.value,r=parseFloat(this.postTradeForm.get("positionsize")?.value),o=this.postTradeForm.get("tradetype")?.value;if(n&&e&&r&&o){let i=0;o==="Long"?i=(e-n)*r:o==="Short"&&(i=(n-e)*r),this.postTradeForm.get("profitlossamount")?.setValue(i.toFixed(2)),i>0?this.postTradeForm.get("tradeoutcome")?.setValue("Win"):i<0?this.postTradeForm.get("tradeoutcome")?.setValue("Loss"):this.postTradeForm.get("tradeoutcome")?.setValue("Breakeven")}}calculateFormProgress(){let n=Object.keys(this.postTradeForm.controls).filter(r=>this.postTradeForm.get(r)?.validator!==null),e=n.filter(r=>this.postTradeForm.get(r)?.valid);return Math.round(e.length/n.length*100)}hasErrors(n){let e=!1,r={tradeDetails:["accountname","instrumenttype","analysistype","tradesymbol","tradetype","timeframe"],strategyInformation:["strategyname","typeoforder"],tradeExecution:["entrydatetime","exitdatetime","entryprice","exitprice","positionsize"],tradeOutcome:["tradeoutcome"],postTradeAnalysis:["emotionalstateafter","whatwentwell","whatcouldimprove"]};return r[n]&&r[n].forEach(o=>{this.postTradeForm.get(o)?.invalid&&(e=!0)}),e}static \u0275fac=function(e){return new(e||t)(ne(oi),ne(vt),ne(Ct))};static \u0275cmp=it({type:t,selectors:[["app-post-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:299,vars:23,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["routerLink","/posttrades"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Describe the exit strategy you implemented","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","exitdatetime",1,"form-label"],["type","datetime-local","id","exitdatetime","formControlName","exitdatetime",1,"form-control"],[1,"col-md-4"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Actual entry price",1,"form-control"],["for","exitprice",1,"form-label"],["type","number","id","exitprice","formControlName","exitprice","step","0.01","min","0","placeholder","Actual exit price",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],[1,"bi","bi-4-circle","me-2"],["for","tradeoutcome",1,"form-label"],["role","group","aria-label","Trade outcome",1,"btn-group","w-100"],["type","radio","name","tradeoutcome","id","tradeoutcome_win","value","Win","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_win",1,"btn","btn-outline-success"],["type","radio","name","tradeoutcome","id","tradeoutcome_loss","value","Loss","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_loss",1,"btn","btn-outline-danger"],["type","radio","name","tradeoutcome","id","tradeoutcome_breakeven","value","Breakeven","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_breakeven",1,"btn","btn-outline-warning"],["for","profitlossamount",1,"form-label"],["type","number","step","0.01","id","profitlossamount","formControlName","profitlossamount","placeholder","e.g. 50.25 or -30.50",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-6-circle","me-2"],["for","emotionalstateafter",1,"form-label"],["id","emotionalstateafter","formControlName","emotionalstateafter",1,"form-select"],["value","Satisfied"],["value","Excited"],["value","Relieved"],["value","Disappointed"],["value","Frustrated"],["value","Neutral"],["value","Angry"],["for","emotionalimpactondecision",1,"form-label"],["id","emotionalimpactondecision","formControlName","emotionalimpactondecision","placeholder","How did your emotions affect your trading decisions?","rows","3",1,"form-control"],["for","whatwentwell",1,"form-label"],["id","whatwentwell","formControlName","whatwentwell","placeholder","What aspects of this trade did you execute correctly?","rows","3",1,"form-control"],["for","whatcouldimprove",1,"form-label"],["id","whatcouldimprove","formControlName","whatcouldimprove","placeholder","What could you have done better in this trade?","rows","3",1,"form-control"],["for","isopen",1,"form-label"],[1,"form-check","form-switch"],["type","checkbox","id","isopen","formControlName","isopen",1,"form-check-input"],["for","isopen",1,"form-check-label"],[1,"bi","bi-7-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-tr-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-tr-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),w(8,"Trade Logs"),y()(),v(9,"li",6),w(10,"Post-Trading Journal"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),w(14),y(),v(15,"p",10),w(16,"Document your completed trades to analyze performance and improve your strategy"),y()(),v(17,"div",11),re(18,Vie,2,2,"div",12)(19,Bie,2,1,"span",13),y()(),v(20,"form",14),te("ngSubmit",function(){return r.onSubmit()}),v(21,"div",15)(22,"div",16)(23,"h5",17),U(24,"i",18),w(25,"Trade Details "),y(),v(26,"span",19),w(27,"Required"),y()(),v(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),w(32,"Account Name"),y(),v(33,"div",24)(34,"span",25),U(35,"i",26),y(),U(36,"input",27),y(),re(37,zie,2,0,"div",28),y(),v(38,"div",22)(39,"label",29),w(40,"Account Balance"),y(),v(41,"div",24)(42,"span",25),w(43,"$"),y(),U(44,"input",30),y()(),v(45,"div",22)(46,"label",31),w(47,"Instrument Type"),y(),v(48,"select",32)(49,"option",33),w(50,"Choose instrument type"),y(),v(51,"option",34),w(52,"Forex"),y(),v(53,"option",35),w(54,"Stocks"),y(),v(55,"option",36),w(56,"Futures"),y(),v(57,"option",37),w(58,"Crypto"),y(),v(59,"option",38),w(60,"Options"),y(),v(61,"option",39),w(62,"ETF"),y(),v(63,"option",40),w(64,"Other"),y()(),re(65,Uie,2,0,"div",28),y(),v(66,"div",22)(67,"label",41),w(68,"Analysis Type"),y(),v(69,"select",42)(70,"option",33),w(71,"Choose analysis method"),y(),v(72,"option",43),w(73,"Technical"),y(),v(74,"option",44),w(75,"Fundamental"),y(),v(76,"option",45),w(77,"Both"),y(),v(78,"option",46),w(79,"Sentiment"),y(),v(80,"option",40),w(81,"Other"),y()(),re(82,jie,2,0,"div",28),y(),v(83,"div",22)(84,"label",47),w(85,"Trade Symbol"),y(),v(86,"div",24)(87,"span",25),U(88,"i",48),y(),U(89,"input",49),y(),re(90,Gie,2,0,"div",28),y(),v(91,"div",22)(92,"label",50),w(93,"Trade Direction"),y(),v(94,"div",51),U(95,"input",52),v(96,"label",53),w(97,"Long"),y(),U(98,"input",54),v(99,"label",55),w(100,"Short"),y()(),re(101,Wie,2,0,"div",28),y(),v(102,"div",22)(103,"label",56),w(104,"Time Frame"),y(),v(105,"select",57)(106,"option",33),w(107,"Select time frame"),y(),v(108,"option",58),w(109,"Scalp (minutes)"),y(),v(110,"option",59),w(111,"Day Trade (hours)"),y(),v(112,"option",60),w(113,"Swing (days-weeks)"),y(),v(114,"option",61),w(115,"Position (weeks-months)"),y(),v(116,"option",62),w(117,"Long Term (months+)"),y()(),re(118,Hie,2,0,"div",28),y()()()(),v(119,"div",15)(120,"div",16)(121,"h5",17),U(122,"i",63),w(123,"Strategy Information "),y(),v(124,"span",19),w(125,"Required"),y()(),v(126,"div",20)(127,"div",21)(128,"div",22)(129,"label",64),w(130,"Strategy Name"),y(),U(131,"input",65),re(132,qie,2,0,"div",28),y(),v(133,"div",22)(134,"label",66),w(135,"Type of Order"),y(),v(136,"select",67)(137,"option",33),w(138,"Choose order type"),y(),v(139,"option",68),w(140,"Market"),y(),v(141,"option",69),w(142,"Limit"),y(),v(143,"option",70),w(144,"Stop"),y(),v(145,"option",71),w(146,"Stop Limit"),y(),v(147,"option",72),w(148,"Trailing Stop"),y()(),re(149,Kie,2,0,"div",28),y(),v(150,"div",73)(151,"label",74),w(152,"Exit Strategy Used"),y(),U(153,"textarea",75),y()()()(),v(154,"div",15)(155,"div",16)(156,"h5",17),U(157,"i",76),w(158,"Trade Execution "),y(),v(159,"span",19),w(160,"Required"),y()(),v(161,"div",20)(162,"div",21)(163,"div",22)(164,"label",77),w(165,"Entry Date/Time"),y(),U(166,"input",78),re(167,Xie,2,0,"div",28),y(),v(168,"div",22)(169,"label",79),w(170,"Exit Date/Time"),y(),U(171,"input",80),re(172,Yie,2,0,"div",28),y(),v(173,"div",81)(174,"label",82),w(175,"Entry Price"),y(),v(176,"div",24)(177,"span",25),w(178,"$"),y(),U(179,"input",83),y(),re(180,Zie,2,0,"div",28),y(),v(181,"div",81)(182,"label",84),w(183,"Exit Price"),y(),v(184,"div",24)(185,"span",25),w(186,"$"),y(),U(187,"input",85),y(),re(188,Qie,2,0,"div",28),y(),v(189,"div",81)(190,"label",86),w(191,"Position Size"),y(),v(192,"div",24),U(193,"input",87),y(),re(194,Jie,2,0,"div",28),y()()()(),v(195,"div",15)(196,"div",16)(197,"h5",17),U(198,"i",88),w(199,"Trade Outcome "),y(),v(200,"span",19),w(201,"Required"),y()(),v(202,"div",20)(203,"div",21)(204,"div",22)(205,"label",89),w(206,"Trade Result"),y(),v(207,"div",90),U(208,"input",91),v(209,"label",92),w(210,"Win"),y(),U(211,"input",93),v(212,"label",94),w(213,"Loss"),y(),U(214,"input",95),v(215,"label",96),w(216,"Breakeven"),y()(),re(217,ese,2,0,"div",28),y(),v(218,"div",22)(219,"label",97),w(220,"Profit/Loss Amount"),y(),v(221,"div",24)(222,"span",25),w(223,"$"),y(),U(224,"input",98),v(225,"button",99),te("click",function(){return r.calculateProfitLoss()}),w(226," Calculate "),y()()()()()(),v(227,"div",15)(228,"div",16)(229,"h5",17),U(230,"i",100),w(231,"Post-Trade Analysis "),y(),v(232,"span",19),w(233,"Required"),y()(),v(234,"div",20)(235,"div",21)(236,"div",22)(237,"label",101),w(238,"Emotional State After Trade"),y(),v(239,"select",102)(240,"option",33),w(241,"How do you feel now?"),y(),v(242,"option",103),w(243,"Satisfied"),y(),v(244,"option",104),w(245,"Excited"),y(),v(246,"option",105),w(247,"Relieved"),y(),v(248,"option",106),w(249,"Disappointed"),y(),v(250,"option",107),w(251,"Frustrated"),y(),v(252,"option",108),w(253,"Neutral"),y(),v(254,"option",109),w(255,"Angry"),y(),v(256,"option",40),w(257,"Other"),y()()(),v(258,"div",73)(259,"label",110),w(260,"Emotional Impact on Decisions"),y(),U(261,"textarea",111),y(),v(262,"div",73)(263,"label",112),w(264,"What Went Well"),y(),U(265,"textarea",113),y(),v(266,"div",73)(267,"label",114),w(268,"Areas for Improvement"),y(),U(269,"textarea",115),y(),v(270,"div",22)(271,"label",116),w(272,"Trade Status"),y(),v(273,"div",117),U(274,"input",118),v(275,"label",119),w(276,"This position is still open"),y()()()()()(),v(277,"div",15)(278,"div",16)(279,"h5",17),U(280,"i",120),w(281,"Additional Notes "),y(),v(282,"span",121),w(283,"Optional"),y()(),v(284,"div",20)(285,"div",21)(286,"div",73)(287,"label",122),w(288,"Notes"),y(),U(289,"textarea",123),y()()()(),re(290,sse,10,5,"div",124),v(291,"div",125),re(292,ase,3,0,"button",126),v(293,"div")(294,"button",127),U(295,"i",128),w(296),y()()(),re(297,lse,3,1,"div",129)(298,cse,3,1,"div",130),y()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,x;O(14),Ke(r.tradeLogData?"Edit Post-Trading Journal":"Create Post-Trading Journal"),O(4),z("ngIf",!r.tradeLogData),O(),z("ngIf",!r.tradeLogData),O(),z("formGroup",r.postTradeForm),O(17),z("ngIf",((o=r.postTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.postTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.postTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),O(28),z("ngIf",((i=r.postTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.postTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.postTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),O(17),z("ngIf",((s=r.postTradeForm.get("analysistype"))==null?null:s.invalid)&&(((s=r.postTradeForm.get("analysistype"))==null?null:s.dirty)||((s=r.postTradeForm.get("analysistype"))==null?null:s.touched)||r.formSubmitMarker)),O(8),z("ngIf",((a=r.postTradeForm.get("tradesymbol"))==null?null:a.invalid)&&(((a=r.postTradeForm.get("tradesymbol"))==null?null:a.dirty)||((a=r.postTradeForm.get("tradesymbol"))==null?null:a.touched)||r.formSubmitMarker)),O(11),z("ngIf",((l=r.postTradeForm.get("tradetype"))==null?null:l.invalid)&&(((l=r.postTradeForm.get("tradetype"))==null?null:l.dirty)||((l=r.postTradeForm.get("tradetype"))==null?null:l.touched)||r.formSubmitMarker)),O(17),z("ngIf",((c=r.postTradeForm.get("timeframe"))==null?null:c.invalid)&&(((c=r.postTradeForm.get("timeframe"))==null?null:c.dirty)||((c=r.postTradeForm.get("timeframe"))==null?null:c.touched)||r.formSubmitMarker)),O(14),z("ngIf",((u=r.postTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.postTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.postTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),O(17),z("ngIf",((d=r.postTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.postTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.postTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),O(18),z("ngIf",((p=r.postTradeForm.get("entrydatetime"))==null?null:p.invalid)&&(((p=r.postTradeForm.get("entrydatetime"))==null?null:p.dirty)||((p=r.postTradeForm.get("entrydatetime"))==null?null:p.touched)||r.formSubmitMarker)),O(5),z("ngIf",((f=r.postTradeForm.get("exitdatetime"))==null?null:f.invalid)&&(((f=r.postTradeForm.get("exitdatetime"))==null?null:f.dirty)||((f=r.postTradeForm.get("exitdatetime"))==null?null:f.touched)||r.formSubmitMarker)),O(8),z("ngIf",((m=r.postTradeForm.get("entryprice"))==null?null:m.invalid)&&(((m=r.postTradeForm.get("entryprice"))==null?null:m.dirty)||((m=r.postTradeForm.get("entryprice"))==null?null:m.touched)||r.formSubmitMarker)),O(8),z("ngIf",((h=r.postTradeForm.get("exitprice"))==null?null:h.invalid)&&(((h=r.postTradeForm.get("exitprice"))==null?null:h.dirty)||((h=r.postTradeForm.get("exitprice"))==null?null:h.touched)||r.formSubmitMarker)),O(6),z("ngIf",((g=r.postTradeForm.get("positionsize"))==null?null:g.invalid)&&(((g=r.postTradeForm.get("positionsize"))==null?null:g.dirty)||((g=r.postTradeForm.get("positionsize"))==null?null:g.touched)||r.formSubmitMarker)),O(23),z("ngIf",((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.invalid)&&(((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.dirty)||((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.touched)||r.formSubmitMarker)),O(73),z("ngIf",r.formSubmitMarker&&r.postTradeForm.invalid),O(2),z("ngIf",r.tradeLogData),O(4),$e("",r.tradeLogData?"Update":"Submit"," "),O(),z("ngIf",r.message),O(),z("ngIf",r.errorMessage)}},dependencies:[kt,Ut,mo,po,gs,ys,wn,Bi,pa,hs,fa,Nn,uo,dd,fo,Po,zn],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};var use=(t,n,e)=>({"open-trade":t,"win-trade":n,"loss-trade":e}),dse=(t,n,e)=>({"status-open":t,"status-win":n,"status-loss":e}),pse=(t,n,e)=>({"bi-clock-history":t,"bi-check-circle":n,"bi-x-circle":e}),fse=(t,n,e)=>({"text-success":t,"text-danger":n,"text-secondary":e});function mse(t,n){t&1&&(v(0,"div",12),w(1,"Loading trade logs..."),y())}function hse(t,n){if(t&1&&(v(0,"div",13),w(1),y()),t&2){let e=Y();O(),Ke(e.errorMessage)}}function gse(t,n){if(t&1){let e=Je();v(0,"div",16)(1,"div",17),te("click",function(){let o=le(e).$implicit,i=Y(2);return ce(i.openEditModal(o))}),v(2,"div",18),U(3,"i",19),w(4),y(),v(5,"div",20),te("click",function(o){let i=le(e).$implicit,s=Y(2);return ce(s.onDeleteTradeLog(i,o))}),U(6,"i",21),y(),v(7,"div",22)(8,"h4",23),w(9),y(),v(10,"h5",24),w(11),y(),v(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),w(16,"Strategy:"),y(),w(17),y(),v(18,"div",27)(19,"strong"),w(20,"Analysis:"),y(),w(21),y()(),v(22,"div",26)(23,"div",27)(24,"strong"),w(25,"Entry:"),y(),w(26),y(),v(27,"div",27)(28,"strong"),w(29,"Exit:"),y(),w(30),y()(),v(31,"div",26)(32,"div",27)(33,"strong"),w(34,"Date:"),y(),w(35),No(36,"date"),y(),v(37,"div",27)(38,"strong"),w(39,"Account:"),y(),w(40),y()(),v(41,"div",28)(42,"div",29)(43,"strong"),w(44,"P/L:"),y(),v(45,"span",30),w(46),y()()()(),v(47,"div",31)(48,"small",32),w(49),No(50,"date"),y()()()()()}if(t&2){let e=n.$implicit;O(),z("ngClass",Hl(23,use,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),O(),z("ngClass",Hl(27,dse,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),O(),z("ngClass",Hl(31,pse,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),O(),$e(" ",e.isopen?"In Progress":e.tradeoutcome," "),O(5),Ke(e.tradesymbol),O(2),Kh(" ",e.tradetype," | ",e.instrumenttype," | ",e.timeframe," "),O(6),$e(" ",e.strategyname," "),O(4),$e(" ",e.analysistype," "),O(5),$e(" ",e.entryprice," "),O(4),$e(" ",e.isopen?"Pending":e.exitprice," "),O(5),$e(" ",ko(36,17,e.entrydatetime,"shortDate")," "),O(5),$e(" ",e.accountname," "),O(5),z("ngClass",Hl(35,fse,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss",e.isopen)),O(),$e(" ",e.isopen?"Trade in progress":e.profitlossamount," "),O(3),Ke(ko(50,20,e.createdtime,"medium"))}}function yse(t,n){if(t&1&&(v(0,"div",14),re(1,gse,51,39,"div",15),y()),t&2){let e=Y();O(),z("ngForOf",e.tradeLogs)}}function vse(t,n){t&1&&(v(0,"div",33),w(1," No trade logs found. "),y())}function xse(t,n){if(t&1){let e=Je();v(0,"div",34),te("click",function(o){le(e);let i=Y();return ce(i.closeModalOnOverlayClick(o))}),v(1,"div",35),te("click",function(o){return le(e),ce(o.stopPropagation())}),v(2,"app-post-trade-log",36),te("formSubmitted",function(){le(e);let o=Y();return ce(o.onFormSubmitted())})("cancel",function(){le(e);let o=Y();return ce(o.closeModal())}),y()()()}if(t&2){let e=Y();O(2),z("tradeLogData",e.selectedTradeLog)}}var Tb=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="posttrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.detectChanges()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName),this.cdr.detectChanges()}catch(n){console.error("Error fetching trade logs",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(ne(Ct),ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-post-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/posttradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[3,"ngClass"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",5),w(7,"Post-Trade Logs"),y(),v(8,"li",3)(9,"a",6),w(10,"Post-Trading Journal"),y()()()(),v(11,"h2"),w(12,"Post Trade Logs"),y(),re(13,mse,2,0,"div",7)(14,hse,2,1,"div",8)(15,yse,2,1,"div",9)(16,vse,2,0,"div",10),y(),re(17,xse,3,1,"div",11)),e&2&&(O(13),z("ngIf",r.loading),O(),z("ngIf",r.errorMessage),O(),z("ngIf",r.tradeLogs&&r.tradeLogs.length),O(),z("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),O(),z("ngIf",r.showModal))},dependencies:[zn,kt,lo,Bn,Ut,ei,kf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.open-trade[_ngcontent-%COMP%]{border-left:4px solid #17a2b8!important}.win-trade[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.loss-trade[_ngcontent-%COMP%]{border-left:4px solid #dc3545!important}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-open[_ngcontent-%COMP%]{background-color:#17a2b8}.status-win[_ngcontent-%COMP%]{background-color:#28a745}.status-loss[_ngcontent-%COMP%]{background-color:#dc3545}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"]})};var bse=(t,n)=>({"alert-success":t,"alert-danger":n});function wse(t,n){if(t&1&&(v(0,"div",18),w(1),y()),t&2){let e=Y();z("ngClass",Qo(2,bse,e.messageType==="success",e.messageType==="error")),O(),$e(" ",e.message," ")}}function Cse(t,n){if(t&1){let e=Je();na(0),v(1,"input",27),an("ngModelChange",function(o){le(e);let i=Y().$implicit;return un(i.choicesInput,o)||(i.choicesInput=o),ce(o)}),te("change",function(){le(e);let o=Y().$implicit,i=Y();return ce(i.updateChoices(o))}),y(),v(2,"div",28),w(3,'e.g., "Option A, Option B, Option C"'),y(),ra()}if(t&2){let e=Y().$implicit;O(),sn("ngModel",e.choicesInput)}}function _se(t,n){if(t&1){let e=Je();v(0,"tr")(1,"td")(2,"select",19),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.question_data.question_type,o)||(i.question_data.question_type=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onQuestionChange(o))}),v(3,"option",9),w(4,"Fill"),y(),v(5,"option",10),w(6,"Multiple"),y(),v(7,"option",11),w(8,"Select One"),y()()(),v(9,"td")(10,"input",20),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.question_data.question_icon,o)||(i.question_data.question_icon=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onQuestionChange(o))}),y()(),v(11,"td")(12,"input",21),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.question_data.question_title,o)||(i.question_data.question_title=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onQuestionChange(o))}),y()(),v(13,"td")(14,"textarea",22),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.question_data.question,o)||(i.question_data.question=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onQuestionChange(o))}),y()(),v(15,"td"),re(16,Cse,4,1,"ng-container",23),y(),v(17,"td")(18,"input",24),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.question_data.placeholder,o)||(i.question_data.placeholder=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onQuestionChange(o))}),y()(),v(19,"td")(20,"div",25)(21,"input",26),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.active,o)||(i.active=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onQuestionChange(o))}),y()()(),v(22,"td"),w(23),No(24,"date"),y()()}if(t&2){let e=n.$implicit;O(2),sn("ngModel",e.question_data.question_type),O(8),sn("ngModel",e.question_data.question_icon),O(2),sn("ngModel",e.question_data.question_title),O(2),sn("ngModel",e.question_data.question),O(2),z("ngIf",e.question_data.question_type!=="fill"),O(2),sn("ngModel",e.question_data.placeholder),O(3),sn("ngModel",e.active),O(2),Ke(ko(24,8,e.updated_at,"short"))}}function Ise(t,n){if(t&1){let e=Je();v(0,"div",29)(1,"input",30),an("ngModelChange",function(o){le(e);let i=Y();return un(i.newQuestionChoices,o)||(i.newQuestionChoices=o),ce(o)}),y()()}if(t&2){let e=Y();O(),sn("ngModel",e.newQuestionChoices)}}var Db=class t{constructor(n,e){this.cdr=n;this.supabaseService=e}questions=[];newQuestionText="";newQuestionType="fill";newQuestionChoices="";message="";messageType="success";async ngOnInit(){let n=await this.supabaseService.adminLoadQuestions();this.questions=n.map(e=>Ue(me({},e),{choicesInput:e.question_data.choices?.join(", ")||""})),this.cdr.markForCheck()}onQuestionChange(n){n.isModified=!0}updateChoices(n){let e=n.choicesInput??"";n.question_data.choices=e.split(",").map(r=>r.trim()).filter(r=>r),n.isModified=!0}addQuestion(){if(!this.newQuestionText.trim())return;let n={question_type:this.newQuestionType,question:this.newQuestionText.trim(),placeholder:this.newQuestionText.trim()};if(this.newQuestionType!=="fill"){let e=this.newQuestionChoices.split(",").map(r=>r.trim()).filter(r=>r);n.choices=e}this.questions.push({question_data:n,choicesInput:this.newQuestionChoices,active:!0,isModified:!0}),this.newQuestionText="",this.newQuestionChoices="",this.newQuestionType="fill",this.cdr.detectChanges()}async saveChanges(){let{error:n}=await this.supabaseService.adminSaveQuestions(this.questions);n?this.showMessage("Error saving questions","error"):this.showMessage("Questions saved successfully","success"),this.cdr.detectChanges()}async deleteQuestion(n){if(!n.question_id){this.questions=this.questions.filter(r=>r!==n),this.showMessage("Question removed locally","success"),this.cdr.markForCheck();return}let{error:e}=await this.supabaseService.deleteQuestion(n);e?this.showMessage("Error deleting question","error"):(this.questions=this.questions.filter(r=>r.question_id!==n.question_id),this.showMessage("Question deleted successfully","success")),this.cdr.markForCheck()}showMessage(n,e){this.message=n,this.messageType=e,this.cdr.markForCheck(),setTimeout(()=>{this.message="",this.cdr.markForCheck()},4e3)}hasChanges(){return this.questions.some(n=>n.isModified)}static \u0275fac=function(e){return new(e||t)(ne(vt),ne(Ct))};static \u0275cmp=it({type:t,selectors:[["app-admin-emotion-dashboard"]],decls:53,vars:6,consts:[[1,"container-fluid","mt-4","p-5"],["class","alert",3,"ngClass",4,"ngIf"],[1,"table","mt-5"],[4,"ngFor","ngForOf"],["href","https://icons.getbootstrap.com/","target","_blank"],[1,"mt-4"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","ngModel"],["value","fill"],["value","multiple"],["value","select-one"],[1,"col-md-5"],["type","text","placeholder","Enter question text",1,"form-control",3,"ngModelChange","ngModel"],["class","col-md-4",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-success",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"form-select",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Enter icon URL or name",1,"form-control",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Enter question title",1,"form-control",3,"ngModelChange","change","ngModel"],["type","text",1,"form-control",3,"ngModelChange","change","ngModel"],[4,"ngIf"],["type","text","placeholder","Enter placeholder text",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Comma-separated choices",1,"form-control","mb-1",3,"ngModelChange","change","ngModel"],[1,"text-muted","small"],[1,"col-md-4"],["type","text","placeholder","Comma-separated choices",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,r){e&1&&(v(0,"div",0),re(1,wse,2,5,"div",1),v(2,"h1"),w(3,"Admin Emotion Question Dashboard"),y(),v(4,"table",2)(5,"thead")(6,"tr")(7,"th"),w(8,"Type"),y(),v(9,"th"),w(10,"Question Icon"),y(),v(11,"th"),w(12,"Question Title"),y(),v(13,"th"),w(14,"Question Text"),y(),v(15,"th"),w(16,"Choices"),y(),v(17,"th"),w(18,"Placeholder"),y(),v(19,"th"),w(20,"Active"),y(),v(21,"th"),w(22,"Last Updated"),y()()(),v(23,"tbody"),re(24,_se,25,11,"tr",3),y()(),v(25,"label"),w(26,"For icons, go to this website: "),v(27,"a",4),w(28,"https://icons.getbootstrap.com/"),y(),w(29,". "),U(30,"br"),w(31,'Search for favourite icon. When you click your icon, you will see something like this. <i class="bi bi-emoji-smile"></i>. '),U(32,"br"),w(33,'Then copy this part "bi bi-emoji-smile" and put it into the space'),y(),v(34,"h4",5),w(35,"Add New Question"),y(),v(36,"div",6)(37,"div",7)(38,"select",8),an("ngModelChange",function(i){return un(r.newQuestionType,i)||(r.newQuestionType=i),i}),v(39,"option",9),w(40,"Fill"),y(),v(41,"option",10),w(42,"Multiple"),y(),v(43,"option",11),w(44,"Select One"),y()()(),v(45,"div",12)(46,"input",13),an("ngModelChange",function(i){return un(r.newQuestionText,i)||(r.newQuestionText=i),i}),y()(),re(47,Ise,2,1,"div",14),y(),v(48,"div",15)(49,"button",16),te("click",function(){return r.addQuestion()}),w(50,"Add Question"),y(),v(51,"button",17),te("click",function(){return r.saveChanges()}),w(52,"Save Changes"),y()()()),e&2&&(O(),z("ngIf",r.message),O(23),z("ngForOf",r.questions),O(14),sn("ngModel",r.newQuestionType),O(8),sn("ngModel",r.newQuestionText),O(),z("ngIf",r.newQuestionType!=="fill"),O(4),z("disabled",!r.hasChanges()))},dependencies:[vs,gs,ys,wn,pa,hs,Nn,Vi,kt,lo,Bn,Ut,ei],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.question-row[_ngcontent-%COMP%]{position:relative}.delete-button[_ngcontent-%COMP%]{display:none;position:absolute;right:10px;top:50%;transform:translateY(-50%)}.question-row[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{display:block}.alert[_ngcontent-%COMP%]{padding:10px 20px;margin-bottom:15px;border-radius:4px;text-align:center}.table[_ngcontent-%COMP%]{--bs-table-bg: transparent}"]})};var vD;try{vD=typeof Intl<"u"&&Intl.v8BreakIterator}catch{vD=!1}var Nb=(()=>{class t{_platformId=se(so);isBrowser=this._platformId?dn(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||vD)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function xD(t){return Array.isArray(t)?t:[t]}var dV=new Set,fd,Ese=(()=>{class t{_platform=se(Nb);_nonce=se(Hh,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Tse}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&Sse(e,this._nonce),this._matchMedia(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Sse(t,n){if(!dV.has(t))try{fd||(fd=document.createElement("style"),n&&fd.setAttribute("nonce",n),fd.setAttribute("type","text/css"),document.head.appendChild(fd)),fd.sheet&&(fd.sheet.insertRule(`@media ${t} {body{ }}`,0),dV.add(t))}catch(e){console.error(e)}}function Tse(t){return{matches:t==="all"||t==="",media:t,addListener:()=>{},removeListener:()=>{}}}var fV=(()=>{class t{_mediaMatcher=se(Ese);_zone=se(bn);_queries=new Map;_destroySubject=new xn;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return pV(xD(e)).some(o=>this._registerQuery(o).mql.matches)}observe(e){let o=pV(xD(e)).map(s=>this._registerQuery(s).observable),i=kp(o);return i=Ol(i.pipe(_o(1)),i.pipe(oE(1),JI(0))),i.pipe(We(s=>{let a={matches:!1,breakpoints:{}};return s.forEach(({matches:l,query:c})=>{a.matches=a.matches||l,a.breakpoints[c]=l}),a}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);let r=this._mediaMatcher.matchMedia(e),i={observable:new wt(s=>{let a=l=>this._zone.run(()=>s.next(l));return r.addListener(a),()=>{r.removeListener(a)}}).pipe(Sh(r),We(({matches:s})=>({query:e,matches:s})),Th(this._destroySubject)),mql:r};return this._queries.set(e,i),i}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function pV(t){return t.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}var md=function(t){return t[t.NONE=0]="NONE",t[t.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",t[t.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",t}(md||{}),mV="cdk-high-contrast-black-on-white",hV="cdk-high-contrast-white-on-black",bD="cdk-high-contrast-active",gV=(()=>{class t{_platform=se(Nb);_hasCheckedHighContrastMode;_document=se(Vn);_breakpointSubscription;constructor(){this._breakpointSubscription=se(fV).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return md.NONE;let e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);let r=this._document.defaultView||window,o=r&&r.getComputedStyle?r.getComputedStyle(e):null,i=(o&&o.backgroundColor||"").replace(/ /g,"");switch(e.remove(),i){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return md.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return md.BLACK_ON_WHITE}return md.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let e=this._document.body.classList;e.remove(bD,mV,hV),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===md.BLACK_ON_WHITE?e.add(bD,mV):r===md.WHITE_ON_BLACK&&e.add(bD,hV)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var wD=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({})}return t})();var CD=(()=>{class t{constructor(){se(gV)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({imports:[wD,wD]})}return t})();var Dse=["*"],kb;function Nse(){if(kb===void 0&&(kb=null,typeof window<"u")){let t=window;t.trustedTypes!==void 0&&(kb=t.trustedTypes.createPolicy("angular#components",{createHTML:n=>n}))}return kb}function ey(t){return Nse()?.createHTML(t)||t}function yV(t){return Error(`Unable to find icon with the name "${t}"`)}function kse(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function vV(t){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${t}".`)}function xV(t){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${t}".`)}var ma=class{url;svgText;options;svgElement;constructor(n,e,r){this.url=n,this.svgText=e,this.options=r}},Ase=(()=>{class t{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(e,r,o,i){this._httpClient=e,this._sanitizer=r,this._errorHandler=i,this._document=o}addSvgIcon(e,r,o){return this.addSvgIconInNamespace("",e,r,o)}addSvgIconLiteral(e,r,o){return this.addSvgIconLiteralInNamespace("",e,r,o)}addSvgIconInNamespace(e,r,o,i){return this._addSvgIconConfig(e,r,new ma(o,null,i))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,r,o,i){let s=this._sanitizer.sanitize(Nr.HTML,o);if(!s)throw xV(o);let a=ey(s);return this._addSvgIconConfig(e,r,new ma("",a,i))}addSvgIconSet(e,r){return this.addSvgIconSetInNamespace("",e,r)}addSvgIconSetLiteral(e,r){return this.addSvgIconSetLiteralInNamespace("",e,r)}addSvgIconSetInNamespace(e,r,o){return this._addSvgIconSetConfig(e,new ma(r,null,o))}addSvgIconSetLiteralInNamespace(e,r,o){let i=this._sanitizer.sanitize(Nr.HTML,r);if(!i)throw xV(r);let s=ey(i);return this._addSvgIconSetConfig(e,new ma("",s,o))}registerFontClassAlias(e,r=e){return this._fontCssClassesByAlias.set(e,r),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){let r=this._sanitizer.sanitize(Nr.RESOURCE_URL,e);if(!r)throw vV(e);let o=this._cachedIconsByUrl.get(r);return o?je(Ab(o)):this._loadSvgIconFromConfig(new ma(e,null)).pipe(Dn(i=>this._cachedIconsByUrl.set(r,i)),We(i=>Ab(i)))}getNamedSvgIcon(e,r=""){let o=bV(r,e),i=this._svgIconConfigs.get(o);if(i)return this._getSvgFromConfig(i);if(i=this._getIconConfigFromResolvers(r,e),i)return this._svgIconConfigs.set(o,i),this._getSvgFromConfig(i);let s=this._iconSetConfigs.get(r);return s?this._getSvgFromIconSetConfigs(e,s):Fl(yV(o))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?je(Ab(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(We(r=>Ab(r)))}_getSvgFromIconSetConfigs(e,r){let o=this._extractIconWithNameFromAnySet(e,r);if(o)return je(o);let i=r.filter(s=>!s.svgText).map(s=>this._loadSvgIconSetFromConfig(s).pipe(os(a=>{let c=`Loading icon set URL: ${this._sanitizer.sanitize(Nr.RESOURCE_URL,s.url)} failed: ${a.message}`;return this._errorHandler.handleError(new Error(c)),je(null)})));return Eh(i).pipe(We(()=>{let s=this._extractIconWithNameFromAnySet(e,r);if(!s)throw yV(e);return s}))}_extractIconWithNameFromAnySet(e,r){for(let o=r.length-1;o>=0;o--){let i=r[o];if(i.svgText&&i.svgText.toString().indexOf(e)>-1){let s=this._svgElementFromConfig(i),a=this._extractSvgIconFromSet(s,e,i.options);if(a)return a}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(Dn(r=>e.svgText=r),We(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?je(null):this._fetchIcon(e).pipe(Dn(r=>e.svgText=r))}_extractSvgIconFromSet(e,r,o){let i=e.querySelector(`[id="${r}"]`);if(!i)return null;let s=i.cloneNode(!0);if(s.removeAttribute("id"),s.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(s,o);if(s.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(s),o);let a=this._svgElementFromString(ey("<svg></svg>"));return a.appendChild(s),this._setSvgAttributes(a,o)}_svgElementFromString(e){let r=this._document.createElement("DIV");r.innerHTML=e;let o=r.querySelector("svg");if(!o)throw Error("<svg> tag not found");return o}_toSvgElement(e){let r=this._svgElementFromString(ey("<svg></svg>")),o=e.attributes;for(let i=0;i<o.length;i++){let{name:s,value:a}=o[i];s!=="id"&&r.setAttribute(s,a)}for(let i=0;i<e.childNodes.length;i++)e.childNodes[i].nodeType===this._document.ELEMENT_NODE&&r.appendChild(e.childNodes[i].cloneNode(!0));return r}_setSvgAttributes(e,r){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),r&&r.viewBox&&e.setAttribute("viewBox",r.viewBox),e}_fetchIcon(e){let{url:r,options:o}=e,i=o?.withCredentials??!1;if(!this._httpClient)throw kse();if(r==null)throw Error(`Cannot fetch icon from URL "${r}".`);let s=this._sanitizer.sanitize(Nr.RESOURCE_URL,r);if(!s)throw vV(r);let a=this._inProgressUrlFetches.get(s);if(a)return a;let l=this._httpClient.get(s,{responseType:"text",withCredentials:i}).pipe(We(c=>ey(c)),Bs(()=>this._inProgressUrlFetches.delete(s)),rE());return this._inProgressUrlFetches.set(s,l),l}_addSvgIconConfig(e,r,o){return this._svgIconConfigs.set(bV(e,r),o),this}_addSvgIconSetConfig(e,r){let o=this._iconSetConfigs.get(e);return o?o.push(r):this._iconSetConfigs.set(e,[r]),this}_svgElementFromConfig(e){if(!e.svgElement){let r=this._svgElementFromString(e.svgText);this._setSvgAttributes(r,e.options),e.svgElement=r}return e.svgElement}_getIconConfigFromResolvers(e,r){for(let o=0;o<this._resolvers.length;o++){let i=this._resolvers[o](r,e);if(i)return Rse(i)?new ma(i.url,null,i.options):new ma(i,null)}}static \u0275fac=function(r){return new(r||t)(Me(N1,8),Me(L1),Me(Vn,8),Me(To))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Ab(t){return t.cloneNode(!0)}function bV(t,n){return t+":"+n}function Rse(t){return!!(t.url&&t.options)}var Mse=new ke("MAT_ICON_DEFAULT_OPTIONS"),Fse=new ke("mat-icon-location",{providedIn:"root",factory:Ose});function Ose(){let t=se(Vn),n=t?t.location:null;return{getPathname:()=>n?n.pathname+n.search:""}}var wV=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],Pse=wV.map(t=>`[${t}]`).join(", "),Lse=/^url\(['"]?#(.*?)['"]?\)$/,CV=(()=>{class t{_elementRef=se(Yn);_iconRegistry=se(Ase);_location=se(Fse);_errorHandler=se(To);_defaultColor;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(e){let r=this._cleanupFontValue(e);r!==this._fontSet&&(this._fontSet=r,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(e){let r=this._cleanupFontValue(e);r!==this._fontIcon&&(this._fontIcon=r,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=vn.EMPTY;constructor(){let e=se(new xv("aria-hidden"),{optional:!0}),r=se(Mse,{optional:!0});r&&(r.color&&(this.color=this._defaultColor=r.color),r.fontSet&&(this.fontSet=r.fontSet)),e||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(e){if(!e)return["",""];let r=e.split(":");switch(r.length){case 1:return["",r[0]];case 2:return r;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let e=this._elementsWithExternalReferences;if(e&&e.size){let r=this._location.getPathname();r!==this._previousPath&&(this._previousPath=r,this._prependPathToReferences(r))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();let r=this._location.getPathname();this._previousPath=r,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(r),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){let e=this._elementRef.nativeElement,r=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();r--;){let o=e.childNodes[r];(o.nodeType!==1||o.nodeName.toLowerCase()==="svg")&&o.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let e=this._elementRef.nativeElement,r=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(o=>o.length>0);this._previousFontSetClass.forEach(o=>e.classList.remove(o)),r.forEach(o=>e.classList.add(o)),this._previousFontSetClass=r,this.fontIcon!==this._previousFontIconClass&&!r.includes("mat-ligature-font")&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return typeof e=="string"?e.trim().split(" ")[0]:e}_prependPathToReferences(e){let r=this._elementsWithExternalReferences;r&&r.forEach((o,i)=>{o.forEach(s=>{i.setAttribute(s.name,`url('${e}#${s.value}')`)})})}_cacheChildrenWithExternalReferences(e){let r=e.querySelectorAll(Pse),o=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let i=0;i<r.length;i++)wV.forEach(s=>{let a=r[i],l=a.getAttribute(s),c=l?l.match(Lse):null;if(c){let u=o.get(a);u||(u=[],o.set(a,u)),u.push({name:s,value:c[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){let[r,o]=this._splitIconName(e);r&&(this._svgNamespace=r),o&&(this._svgName=o),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(o,r).pipe(_o(1)).subscribe(i=>this._setSvgElement(i),i=>{let s=`Error retrieving icon ${r}:${o}! ${i.message}`;this._errorHandler.handleError(new Error(s))})}}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=it({type:t,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(r,o){r&2&&(us("data-mat-icon-type",o._usingFontIcon()?"font":"svg")("data-mat-icon-name",o._svgName||o.fontIcon)("data-mat-icon-namespace",o._svgNamespace||o.fontSet)("fontIcon",o._usingFontIcon()?o.fontIcon:null),nx(o.color?"mat-"+o.color:""),Do("mat-icon-inline",o.inline)("mat-icon-no-color",o.color!=="primary"&&o.color!=="accent"&&o.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Fi],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[Hu],ngContentSelectors:Dse,decls:1,vars:0,template:function(r,o){r&1&&(l1(),c1(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return t})(),_V=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=or({type:t});static \u0275inj=rr({imports:[CD,CD]})}return t})();var Vse=(t,n)=>({"alert-success":t,"alert-danger":n});function Bse(t,n){if(t&1&&(v(0,"div",9),w(1),y()),t&2){let e=Y();z("ngClass",Qo(2,Vse,e.messageType==="success",e.messageType==="error")),O(),$e(" ",e.message," ")}}function zse(t,n){if(t&1){let e=Je();v(0,"textarea",17),an("ngModelChange",function(o){le(e);let i=Y().$implicit;return un(i.answer,o)||(i.answer=o),ce(o)}),y()}if(t&2){let e=Y().$implicit;Ku("name",e.question_id),Ku("placeholder",e.question_data.placeholder),sn("ngModel",e.answer)}}function Use(t,n){if(t&1){let e=Je();v(0,"div",20)(1,"input",21),an("ngModelChange",function(o){le(e);let i=Y(2).$implicit;return un(i.answer,o)||(i.answer=o),ce(o)}),y(),v(2,"label",22),w(3),y()()}if(t&2){let e=n.$implicit,r=Y(2).$implicit;O(),Ku("name",r.question_id),z("value",e),sn("ngModel",r.answer),O(2),Ke(e)}}function jse(t,n){if(t&1&&(v(0,"div",18),re(1,Use,4,4,"div",19),y()),t&2){let e=Y().$implicit;O(),z("ngForOf",e.question_data.choices)}}function Gse(t,n){if(t&1){let e=Je();v(0,"div",24)(1,"input",25),te("change",function(){let o=le(e).$implicit,i=Y(2).$implicit,s=Y();return ce(s.toggleMultipleChoice(i,o))}),y(),v(2,"label",22),w(3),y()()}if(t&2){let e=n.$implicit,r=Y(2).$implicit;O(),z("checked",r.multipleAnswers==null?null:r.multipleAnswers.includes(e)),O(2),Ke(e)}}function Wse(t,n){if(t&1&&(v(0,"div",18),re(1,Gse,4,2,"div",23),y()),t&2){let e=Y().$implicit;O(),z("ngForOf",e.question_data.choices)}}function Hse(t,n){if(t&1&&(v(0,"div",10)(1,"div",11)(2,"mat-icon",12),w(3),y(),v(4,"h2",13),w(5),y(),v(6,"h6",14),w(7),y()(),re(8,zse,1,3,"textarea",15)(9,jse,2,1,"div",16)(10,Wse,2,1,"div",16),y()),t&2){let e=n.$implicit;O(3),Ke(e.question_data.question_icon),O(2),Ke(e.question_data.question_title),O(2),Ke(e.question_data.question),O(),z("ngIf",e.question_data.question_type==="fill"),O(),z("ngIf",e.question_data.question_type==="select-one"),O(),z("ngIf",e.question_data.question_type==="multiple")}}var Rb=class t{constructor(n,e,r){this.supabaseService=n;this.cdr=e;this.router=r}questions=[];message="";messageType="success";ngOnInit(){this.loadQuestions()}async loadQuestions(){let{data:n,error:e}=await this.supabaseService.getActiveQuestions();e?(console.error("Error loading questions:",e),this.message="Error loading questions.",this.messageType="error"):n&&(this.questions=n),this.cdr.markForCheck()}allQuestionsAnswered(){return this.questions.every(n=>n.question_data.question_type==="multiple"?n.multipleAnswers&&n.multipleAnswers.length>0:n.answer&&n.answer.trim().length>0)}toggleMultipleChoice(n,e){n.multipleAnswers||(n.multipleAnswers=[]);let r=n.multipleAnswers.indexOf(e);r>-1?n.multipleAnswers.splice(r,1):n.multipleAnswers.push(e)}async submitAnswers(){if(!this.allQuestionsAnswered()){this.message="Please answer all questions before submitting.",this.messageType="error",this.cdr.markForCheck();return}let n=this.supabaseService.user()?.id;if(!n){this.message="User not authenticated.",this.messageType="error",this.cdr.markForCheck();return}let e=this.questions.map(o=>({question_id:o.question_id,answer:o.question_data.question_type==="multiple"?o.multipleAnswers?.join(", ")??"":o.answer?.trim()??"",user_id:n})),{error:r}=await this.supabaseService.submitUserAnswers(e);r?(console.error("Error submitting answers:",r),this.message="Error submitting answers.",this.messageType="error"):(this.message="Answers submitted successfully. redirecting in 5 seconds.",this.messageType="success"),this.cdr.markForCheck(),setTimeout(()=>{this.router.navigateByUrl("/home")},5e3)}static \u0275fac=function(e){return new(e||t)(ne(Ct),ne(vt),ne(Fo))};static \u0275cmp=it({type:t,selectors:[["app-user-emotion-questionnaire"]],decls:15,vars:3,consts:[[1,"container","mt-4","mb-5"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],["class","alert",3,"ngClass",4,"ngIf"],["class","mb-4",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-primary",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"mb-4"],[1,"card-header","form-label","question-label","mt-3","mb-5","pt-2","pb-2","ps-2","col-12"],[1,"question-icon","fs-2","ps-3","mt-4","mb-2"],[1,"fs-2","ps-3","pe-3","mt-2","mb-3","fw-bold"],[1,"ps-3","pe-3","mt-2","mb-3"],["class","form-control card-body p-3","rows","3",3,"ngModel","name","placeholder","ngModelChange",4,"ngIf"],["class","card-body p-4",4,"ngIf"],["rows","3",1,"form-control","card-body","p-3",3,"ngModelChange","ngModel","name","placeholder"],[1,"card-body","p-4"],["class","btn-radio-tr form-check",4,"ngFor","ngForOf"],[1,"btn-radio-tr","form-check"],["type","radio",1,"form-check-input","mb-2",3,"ngModelChange","name","value","ngModel"],[1,"form-check-label"],["class","btn-check-tr form-check",4,"ngFor","ngForOf"],[1,"btn-check-tr","form-check"],["type","checkbox",1,"form-check-input","mb-2",3,"change","checked"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",5),w(7,"Emotion Questions"),y()()(),re(8,Bse,2,5,"div",6),v(9,"h1"),w(10,"User Emotion Questionnaire"),y(),v(11,"form"),re(12,Hse,11,6,"div",7),v(13,"button",8),te("click",function(){return r.submitAnswers()}),w(14," Submit Answers "),y()()()),e&2&&(O(8),z("ngIf",r.message),O(4),z("ngForOf",r.questions),O(),z("disabled",!r.allQuestionsAnswered()))},dependencies:[vs,po,wn,fa,Nn,uo,Vi,fD,kt,lo,Bn,Ut,_V,CV],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.alert[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}h1[_ngcontent-%COMP%]{margin-bottom:20px}.question-label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#333;background-color:#f0f0ff;border-radius:20px;display:inline-block}.question-icon[_ngcontent-%COMP%]{color:#634aff;min-height:24px;overflow:visible}"]})};function qse(t,n){if(t&1&&(v(0,"div",13),w(1),y()),t&2){let e=Y();O(),$e(" ",e.errorMessage," ")}}function Kse(t,n){t&1&&(v(0,"div",28),w(1," A valid email is required. "),y())}function Xse(t,n){t&1&&(v(0,"div",28),w(1," Password must be at least 6 characters. "),y())}function Yse(t,n){if(t&1){let e=Je();v(0,"form",14),te("ngSubmit",function(){le(e);let o=Y();return ce(o.onSubmit())}),v(1,"div",15)(2,"label",16),w(3,"Email"),y(),U(4,"input",17),re(5,Kse,2,0,"div",18),y(),v(6,"div",15)(7,"label",19),w(8,"Password"),y(),U(9,"input",20),re(10,Xse,2,0,"div",18),v(11,"div",21)(12,"a",22),w(13,"Forgot password?"),y()()(),v(14,"div",23)(15,"button",24),w(16,"Continue"),y()(),v(17,"div",25)(18,"p",26),w(19,"Don't have an account? "),v(20,"a",27),te("click",function(){le(e);let o=Y();return ce(o.setActiveTab("signup"))}),w(21,"Sign up"),y()()()()}if(t&2){let e,r,o=Y();z("formGroup",o.signinForm),O(5),z("ngIf",((e=o.signinForm.get("email"))==null?null:e.invalid)&&((e=o.signinForm.get("email"))==null?null:e.touched)),O(5),z("ngIf",((r=o.signinForm.get("password"))==null?null:r.invalid)&&((r=o.signinForm.get("password"))==null?null:r.touched)),O(5),z("disabled",o.signinForm.invalid)}}function Zse(t,n){t&1&&(v(0,"small",43),w(1," First name is required "),y())}function Qse(t,n){t&1&&(v(0,"small",43),w(1," Last name is required "),y())}function Jse(t,n){t&1&&(v(0,"small",43),w(1," Valid email is required "),y())}function eae(t,n){t&1&&(v(0,"small",43),w(1," Password must be at least 6 characters "),y())}function tae(t,n){t&1&&(v(0,"small",43),w(1," Passwords do not match "),y())}function nae(t,n){if(t&1){let e=Je();v(0,"form",14),te("ngSubmit",function(){le(e);let o=Y();return ce(o.onSignupSubmit())}),v(1,"div",29)(2,"div",30)(3,"label",31),w(4,"First Name"),y(),U(5,"input",32),re(6,Zse,2,0,"small",33),y(),v(7,"div",30)(8,"label",34),w(9,"Last Name"),y(),U(10,"input",35),re(11,Qse,2,0,"small",33),y()(),v(12,"div",15)(13,"label",36),w(14,"Email"),y(),U(15,"input",37),re(16,Jse,2,0,"small",33),y(),v(17,"div",15)(18,"label",38),w(19,"Password"),y(),U(20,"input",39),re(21,eae,2,0,"small",33),y(),v(22,"div",15)(23,"label",40),w(24,"Confirm Password"),y(),U(25,"input",41),re(26,tae,2,0,"small",33),y(),v(27,"div",23)(28,"button",24),w(29,"Create Account"),y()(),v(30,"div",25)(31,"p",26),w(32,"Already have an account? "),v(33,"a",42),te("click",function(){le(e);let o=Y();return ce(o.setActiveTab("login"))}),w(34,"Login"),y()()()()}if(t&2){let e,r,o,i,s,a=Y();z("formGroup",a.signupForm),O(6),z("ngIf",((e=a.signupForm.get("firstname"))==null?null:e.invalid)&&((e=a.signupForm.get("firstname"))==null?null:e.touched)),O(5),z("ngIf",((r=a.signupForm.get("lastname"))==null?null:r.invalid)&&((r=a.signupForm.get("lastname"))==null?null:r.touched)),O(5),z("ngIf",((o=a.signupForm.get("email"))==null?null:o.invalid)&&((o=a.signupForm.get("email"))==null?null:o.touched)),O(5),z("ngIf",((i=a.signupForm.get("password"))==null?null:i.invalid)&&((i=a.signupForm.get("password"))==null?null:i.touched)),O(5),z("ngIf",a.signupForm.hasError("mismatch")&&((s=a.signupForm.get("confirmPassword"))==null?null:s.touched)),O(2),z("disabled",a.signupForm.invalid)}}var Mb=class t{constructor(n,e,r,o){this.fb=n;this.router=e;this.route=r;this.supabaseService=o;this.signinForm=this.fb.group({email:["",[Ee.required,Ee.email]],password:["",[Ee.required,Ee.minLength(6)]]}),this.signupForm=this.fb.group({firstname:["",Ee.required],lastname:["",Ee.required],email:["",[Ee.required,Ee.email]],password:["",[Ee.required,Ee.minLength(6)]],confirmPassword:["",Ee.required]},{validators:this.passwordMatchValidator})}activeTab="login";signinForm;signupForm;errorMessage=null;ngOnInit(){this.route.queryParams.subscribe(n=>{n.mode==="signup"&&(this.activeTab="signup")})}passwordMatchValidator(n){let e=n.get("password")?.value,r=n.get("confirmPassword")?.value;return e===r?null:{mismatch:!0}}setActiveTab(n){this.activeTab=n,this.errorMessage=null}async onSubmit(){if(this.signinForm.invalid){this.signinForm.markAllAsTouched();return}let{email:n,password:e}=this.signinForm.getRawValue();try{if(await this.supabaseService.signIn(n,e),!this.supabaseService.currentUsername()){this.errorMessage="Login failed. Please try again.";return}this.signinForm.reset();let r=this.route.snapshot.queryParams.returnUrl||"/home";this.router.navigateByUrl(r)}catch(r){this.errorMessage=r.message||"An unexpected error occurred."}}onSignupSubmit(){if(this.signupForm.invalid){this.signupForm.markAllAsTouched();return}let{email:n,password:e,firstname:r,lastname:o}=this.signupForm.getRawValue();this.supabaseService.signUp(n,e,r,o).then(()=>{this.signupForm.reset(),this.router.navigateByUrl("/home")}).catch(i=>{this.errorMessage=i.message||"An unexpected error occurred.",console.error(i)})}static \u0275fac=function(e){return new(e||t)(ne(oi),ne(Fo),ne(Li),ne(Ct))};static \u0275cmp=it({type:t,selectors:[["app-login-signup"]],decls:20,vars:7,consts:[[1,"auth-container"],[1,"auth-card"],[1,"text-center","mb-4"],[1,"logo-circle","mx-auto"],["src","/trading-rehab-logo.png","alt","Logo",1,"img-fluid"],[1,"brand-name","mt-3"],[1,"brand-tagline"],[1,"auth-tabs","d-flex","justify-content-center","mb-4"],[1,"tabs-container"],[1,"tab",3,"click"],[1,"mx-2","tab-separator"],["class","alert alert-danger mb-3",4,"ngIf"],["class","auth-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"alert","alert-danger","mb-3"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Enter your email",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Enter your password",1,"form-control"],[1,"d-flex","justify-content-end","mt-2"],["href","#",1,"forgot-link"],[1,"d-grid","gap-2","mt-4"],["type","submit",1,"btn","btn-tr","btn-primary","btn-md",3,"disabled"],[1,"text-center","mt-4"],[1,"mb-0"],["href","javascript:void(0)",1,"signup-link",3,"click"],[1,"text-danger","small","mt-1"],[1,"row"],[1,"col-md-6","mb-3"],["for","firstname",1,"form-label"],["type","text","id","firstname","formControlName","firstname","placeholder","First name",1,"form-control"],["class","text-danger",4,"ngIf"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","placeholder","Last name",1,"form-control"],["for","signup-email",1,"form-label"],["type","email","id","signup-email","formControlName","email","placeholder","Enter your email",1,"form-control"],["for","signup-password",1,"form-label"],["type","password","id","signup-password","formControlName","password","placeholder","Create a password",1,"form-control"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm your password",1,"form-control"],["href","javascript:void(0)",1,"login-link",3,"click"],[1,"text-danger"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),U(4,"img",4),y(),v(5,"h2",5),w(6,"TRADING REHAB"),y(),v(7,"p",6),w(8,"Where Disciplined Trading Begins"),y()(),v(9,"div",7)(10,"div",8)(11,"span",9),te("click",function(){return r.setActiveTab("login")}),w(12,"Login"),y(),v(13,"span",10),w(14,"\u2022"),y(),v(15,"span",9),te("click",function(){return r.setActiveTab("signup")}),w(16,"Sign Up"),y()()(),re(17,qse,2,1,"div",11)(18,Yse,22,4,"form",12)(19,nae,35,7,"form",12),y()()),e&2&&(O(11),Do("active",r.activeTab==="login"),O(4),Do("active",r.activeTab==="signup"),O(2),z("ngIf",r.errorMessage),O(),z("ngIf",r.activeTab==="login"),O(),z("ngIf",r.activeTab==="signup"))},dependencies:[kt,Ut,mo,po,wn,Nn,uo,fo,Po],styles:['.auth-container[_ngcontent-%COMP%]{min-height:100vh;background:conic-gradient(#eaeafd,#9c9ce4,#eaeafd);display:flex;align-items:center;justify-content:center}.auth-card[_ngcontent-%COMP%]{background-color:transparent;border-radius:12px;width:100%;max-width:450px;padding:30px}.logo-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:transparent;position:relative;display:flex;align-items:center;justify-content:center;margin:0 auto}.dots-circle[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;position:relative;background-image:radial-gradient(circle,#5046e5 3px,transparent 3px);background-size:15px 15px;transform:rotate(45deg)}.brand-name[_ngcontent-%COMP%]{font-weight:700;font-size:24px;margin-bottom:5px;letter-spacing:.5px}.brand-tagline[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.tabs-container[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-bottom:1px solid #eee;padding-bottom:5px}.tab[_ngcontent-%COMP%]{padding:8px 15px;cursor:pointer;color:#888;font-weight:500;font-size:16px;transition:color .2s}.tab.active[_ngcontent-%COMP%]{color:#5046e5;border-bottom:2px solid #5046e5}.tab-separator[_ngcontent-%COMP%]{color:#ccc}.auth-form[_ngcontent-%COMP%]{margin-top:10px}.form-control[_ngcontent-%COMP%]{height:auto;padding:12px 15px;border-radius:8px;border:1px solid #ddd;transition:border-color .2s,box-shadow .2s}.form-control[_ngcontent-%COMP%]:focus{border-color:#5046e5;box-shadow:0 0 0 .2rem #5046e526}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#555;margin-bottom:8px}.forgot-link[_ngcontent-%COMP%]{font-size:14px;color:#5046e5;text-decoration:none}.forgot-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.signup-link[_ngcontent-%COMP%], .login-link[_ngcontent-%COMP%]{color:#5046e5;font-weight:500;text-decoration:none}.signup-link[_ngcontent-%COMP%]:hover, .login-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn-primary[_ngcontent-%COMP%]{background-color:#5046e5;border-color:#5046e5;padding:12px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover, .btn-primary[_ngcontent-%COMP%]:focus{background-color:#4238d0;border-color:#4238d0}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#a8a4e0;border-color:#a8a4e0}.separator[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#888;font-size:14px}.separator[_ngcontent-%COMP%]:before, .separator[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #ddd}.separator[_ngcontent-%COMP%]:before{margin-right:1em}.separator[_ngcontent-%COMP%]:after{margin-left:1em}.google-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#fff;border:1px solid #ddd;color:#333;padding:12px;font-weight:500}.google-btn[_ngcontent-%COMP%]:hover{background-color:#f8f8f8;color:#333}@media (max-width: 576px){.auth-card[_ngcontent-%COMP%]{padding:20px 15px}.brand-name[_ngcontent-%COMP%]{font-size:20px}.form-control[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{padding:10px}}']})};var IV=(t,n)=>({"btn-tr text-dark":t,"btn-tr":n}),rae=(t,n)=>({"btn-tr  text-dark":t,"btn-tr  btn-outline-primary":n});function oae(t,n){if(t&1){let e=Je();v(0,"button",15),te("click",function(){let o;le(e);let i=Y();return ce((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Executing"))}),U(1,"i",75),w(2," Executing "),y()}if(t&2){let e,r=Y();z("ngClass",Qo(1,IV,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Executing",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Executing"))}}function iae(t,n){if(t&1){let e=Je();v(0,"button",15),te("click",function(){let o;le(e);let i=Y();return ce((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Completed"))}),U(1,"i",76),w(2," Completed "),y()}if(t&2){let e,r=Y();z("ngClass",Qo(1,rae,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Completed",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Completed"))}}function sae(t,n){if(t&1){let e=Je();v(0,"div",82)(1,"button",83),te("click",function(){let o=le(e).index,i=Y(2);return ce(i.removePlannedTrade(o))}),U(2,"i",84),y(),v(3,"h6",85),w(4),y(),v(5,"div",24)(6,"div",86)(7,"label",87),w(8,"Direction"),y(),v(9,"div",88),U(10,"input",89),v(11,"label",90),w(12,"Long"),y(),U(13,"input",91),v(14,"label",92),w(15,"Short"),y()()(),v(16,"div",86)(17,"label",87),w(18,"Entry Price"),y(),v(19,"div",27)(20,"span",28),w(21,"$"),y(),U(22,"input",93),y()(),v(23,"div",86)(24,"label",87),w(25,"Stop Loss"),y(),v(26,"div",27)(27,"span",28),w(28,"$"),y(),U(29,"input",94),y()(),v(30,"div",86)(31,"label",87),w(32,"Exit Price"),y(),v(33,"div",27)(34,"span",28),w(35,"$"),y(),U(36,"input",95),y()(),v(37,"div",25)(38,"label",87),w(39,"Planned Entry Time"),y(),U(40,"input",96),y(),v(41,"div",25)(42,"label",87),w(43,"Planned Exit Time"),y(),U(44,"input",97),y(),v(45,"div",25)(46,"label",87),w(47,"Exit Type"),y(),v(48,"select",98)(49,"option",33),w(50,"Select exit type"),y(),v(51,"option",99),w(52,"Target"),y(),v(53,"option",100),w(54,"Stop Loss"),y(),v(55,"option",101),w(56,"Manual"),y()()(),v(57,"div",25)(58,"label",87),w(59,"Position Size ($)"),y(),v(60,"div",27)(61,"span",28),w(62,"$"),y(),U(63,"input",102),y()(),v(64,"div",25)(65,"label",87),w(66,"Contracts/Shares"),y(),U(67,"input",103),y(),v(68,"div",25)(69,"label",87),w(70,"Multiplier"),y(),U(71,"input",104),y()(),v(72,"div",105)(73,"div",106),U(74,"div",107),y()()()}if(t&2){let e=n.index;z("formGroupName",e),O(4),$e("Planned Trade #",e+1,""),O(6),z("id","direction_long_"+e),O(),z("for","direction_long_"+e),O(2),z("id","direction_short_"+e),O(),z("for","direction_short_"+e)}}function aae(t,n){if(t&1){let e=Je();v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",77),w(4,"Planned Trades "),y(),v(5,"span",22),w(6,"Required"),y()(),v(7,"div",23)(8,"div",78),re(9,sae,75,6,"div",79),v(10,"button",80),te("click",function(){le(e);let o=Y();return ce(o.addPlannedTrade())}),U(11,"i",81),w(12,"Add Planned Trade "),y()()()()}if(t&2){let e=Y();O(9),z("ngForOf",e.plannedTrades.controls)}}function lae(t,n){if(t&1){let e=Je();v(0,"div",82)(1,"button",83),te("click",function(){let o=le(e).index,i=Y(2);return ce(i.removeExecutingTrade(o))}),U(2,"i",84),y(),v(3,"h6",85),w(4),y(),v(5,"div",24)(6,"div",86)(7,"label",87),w(8,"Direction"),y(),v(9,"div",88),U(10,"input",89),v(11,"label",90),w(12,"Long"),y(),U(13,"input",91),v(14,"label",92),w(15,"Short"),y()()(),v(16,"div",86)(17,"label",87),w(18,"Entry Price"),y(),v(19,"div",27)(20,"span",28),w(21,"$"),y(),U(22,"input",93),y()(),v(23,"div",86)(24,"label",87),w(25,"Stop Loss"),y(),v(26,"div",27)(27,"span",28),w(28,"$"),y(),U(29,"input",94),y()(),v(30,"div",86)(31,"label",87),w(32,"Exit Price"),y(),v(33,"div",27)(34,"span",28),w(35,"$"),y(),U(36,"input",95),y()(),v(37,"div",25)(38,"label",87),w(39,"Entry Time"),y(),U(40,"input",96),y(),v(41,"div",25)(42,"label",87),w(43,"Exit Time"),y(),U(44,"input",97),y(),v(45,"div",25)(46,"label",87),w(47,"Exit Type"),y(),v(48,"select",98)(49,"option",33),w(50,"Select exit type"),y(),v(51,"option",99),w(52,"Target"),y(),v(53,"option",100),w(54,"Stop Loss"),y(),v(55,"option",101),w(56,"Manual"),y()()(),v(57,"div",25)(58,"label",87),w(59,"Position Size ($)"),y(),v(60,"div",27)(61,"span",28),w(62,"$"),y(),U(63,"input",102),y()(),v(64,"div",25)(65,"label",87),w(66,"Contracts/Shares"),y(),U(67,"input",103),y(),v(68,"div",25)(69,"label",87),w(70,"Multiplier"),y(),U(71,"input",104),y()()()}if(t&2){let e=n.index;z("formGroupName",e),O(4),$e("Trade Execution #",e+1,""),O(6),z("id","exec_direction_long_"+e),O(),z("for","exec_direction_long_"+e),O(2),z("id","exec_direction_short_"+e),O(),z("for","exec_direction_short_"+e)}}function cae(t,n){if(t&1){let e=Je();v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",77),w(4,"Executing Trades "),y(),v(5,"span",22),w(6,"Required"),y()(),v(7,"div",23)(8,"div",108),re(9,lae,72,6,"div",79),v(10,"button",80),te("click",function(){le(e);let o=Y();return ce(o.addExecutingTrade())}),U(11,"i",81),w(12,"Add Executing Trade "),y()()()()}if(t&2){let e=Y();O(9),z("ngForOf",e.executingTrades.controls)}}function uae(t,n){t&1&&(v(0,"div",64),U(1,"i",135),v(2,"span",136),w(3," Consider if this emotional state might negatively impact your decision making"),y()())}function dae(t,n){if(t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",109),w(4,"Emotional Analysis "),y(),v(5,"span",22),w(6,"Required"),y()(),v(7,"div",23)(8,"div",110)(9,"div",24)(10,"div",39)(11,"label",111),w(12,"Emotional State"),y(),v(13,"select",112)(14,"option",33),w(15,"How are you feeling?"),y(),v(16,"option",113),w(17,"Calm & Focused"),y(),v(18,"option",114),w(19,"Excited"),y(),v(20,"option",115),w(21,"Anxious"),y(),v(22,"option",116),w(23,"Frustrated"),y(),v(24,"option",117),w(25,"Overconfident"),y(),v(26,"option",118),w(27,"Fearful"),y(),v(28,"option",119),w(29,"Neutral"),y(),v(30,"option",38),w(31,"Other"),y()(),re(32,uae,4,0,"div",120),y(),v(33,"div",39)(34,"label",121),w(35,"Trade Confidence"),y(),v(36,"div",88),U(37,"input",122),v(38,"label",123),w(39,"1"),y(),U(40,"input",124),v(41,"label",125),w(42,"2"),y(),U(43,"input",126),v(44,"label",127),w(45,"3"),y(),U(46,"input",128),v(47,"label",129),w(48,"4"),y(),U(49,"input",130),v(50,"label",131),w(51,"5"),y()(),v(52,"div",132),w(53,"Low (1) to High (5)"),y()()(),v(54,"div",55)(55,"label",133),w(56,"Reflection"),y(),U(57,"textarea",134),y()()()()),t&2){let e=Y();O(32),z("ngIf",e.isNegativeEmotionalState())}}function pae(t,n){t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",109),w(4,"Profit Analysis "),y(),v(5,"span",22),w(6,"Required"),y()(),v(7,"div",23)(8,"div",24)(9,"div",25)(10,"label",137),w(11,"Realized Profit"),y(),v(12,"div",27)(13,"span",28),w(14,"$"),y(),U(15,"input",138),y()(),v(16,"div",25)(17,"label",139),w(18,"Unrealized Profit"),y(),v(19,"div",27)(20,"span",28),w(21,"$"),y(),U(22,"input",140),y()(),v(23,"div",25)(24,"label",141),w(25,"Total Profit"),y(),v(26,"div",27)(27,"span",28),w(28,"$"),y(),U(29,"input",142),y()()()()())}function fae(t,n){t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",143),w(4,"Post-Trade Reflection "),y(),v(5,"span",22),w(6,"Required"),y()(),v(7,"div",23)(8,"div",144)(9,"div",24)(10,"div",39)(11,"label",145),w(12,"Emotional State"),y(),v(13,"select",146)(14,"option",33),w(15,"How are you feeling?"),y(),v(16,"option",147),w(17,"Satisfied"),y(),v(18,"option",114),w(19,"Excited"),y(),v(20,"option",148),w(21,"Disappointed"),y(),v(22,"option",116),w(23,"Frustrated"),y(),v(24,"option",117),w(25,"Overconfident"),y(),v(26,"option",119),w(27,"Neutral"),y(),v(28,"option",38),w(29,"Other"),y()()(),v(30,"div",39)(31,"label",149),w(32,"Trade Confidence for Next Time"),y(),v(33,"div",88),U(34,"input",150),v(35,"label",151),w(36,"1"),y(),U(37,"input",152),v(38,"label",153),w(39,"2"),y(),U(40,"input",154),v(41,"label",155),w(42,"3"),y(),U(43,"input",156),v(44,"label",157),w(45,"4"),y(),U(46,"input",158),v(47,"label",159),w(48,"5"),y()(),v(49,"div",132),w(50,"Low (1) to High (5)"),y()()(),v(51,"div",55)(52,"label",160),w(53,"Trade Reflection"),y(),U(54,"textarea",161),y()()()())}var Af=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabase=r}tradeData;mode="create";tradeAccountId;formSubmitted=new Lt;cancel=new Lt;tradeForm;tableName="tradejournal";trade_account_id;ngOnInit(){this.trade_account_id=this.tradeAccountId??"",this.initForm()}ngOnChanges(n){n.tradeAccountId&&(this.trade_account_id=n.tradeAccountId.currentValue),n.tradeData&&!n.tradeData.firstChange&&(this.populateForm(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)}),this.tradeData&&(this.mode="edit"))}initForm(){let n=this.mode==="create"?pd():this.tradeData?.tradeid;this.tradeForm=this.fb.group({tradeid:n,userid:this.supabase.user()?.id,updated_time:[""],trade_symbol:["",Ee.required],trade_analysis:[""],trade_instrument:[""],type_of_order:[""],market_condition:[""],trade_status:["Planned"],strategy_name:[""],entry_criteria:[""],exit_criteria:[""],planned_trade:this.fb.array([]),executing_trades:this.fb.array([]),realized_profit:[0,Ee.required],unrealized_profit:[0,Ee.required],planned_profit:[0,Ee.required],emotion_before:this.fb.group({emotional_state_before:[""],trade_confidence_before:[""],reflection_before:[""]}),emotion_after:this.fb.group({emotional_state_after:[""],trade_confidence_after:[""],reflection_after:[""]}),notes:[""],trade_account_id:this.trade_account_id}),this.tradeForm.get("trade_status")?.valueChanges.subscribe(e=>{this.handleStatusChange(e)}),this.handleStatusChange("Planned"),this.tradeData&&(this.populateForm(),this.mode="edit")}get plannedTrades(){return this.tradeForm.get("planned_trade")}get executingTrades(){return this.tradeForm.get("executing_trades")}newTradeGroup(n=!1){let e={entry_price:[""],exit_price:[""],stop_loss:[""],trade_direction:[""],entry_time:[""],exit_time:[""],exit:[""],position_size:[""],contracts:[""],contract_multiplier:[""]};return n&&(e.profit=[""]),this.fb.group(e)}addPlannedTrade(){this.plannedTrades.push(this.newTradeGroup())}removePlannedTrade(n){this.plannedTrades.removeAt(n)}addExecutingTrade(){this.executingTrades.push(this.newTradeGroup(!0))}removeExecutingTrade(n){this.executingTrades.removeAt(n)}populateForm(){this.tradeData&&(this.tradeForm.patchValue(this.tradeData),this.plannedTrades.clear(),this.executingTrades.clear(),this.tradeData.planned_trade?.forEach(n=>{this.plannedTrades.push(this.fb.group(n))}),this.tradeData.executing_trades?.forEach(n=>{this.executingTrades.push(this.fb.group(n))}),this.handleStatusChange(this.tradeData.trade_status))}handleStatusChange(n){let e=this.tradeForm.get("emotion_after"),r=this.tradeForm.get("emotion_before");n==="Planned"?(this.executingTrades.disable(),e.disable(),r.enable()):n==="Executing"?(this.executingTrades.enable(),e.disable(),r.enable(),this.executingTrades.length===0&&this.plannedTrades.length>0&&this.plannedTrades.controls.forEach(o=>{this.executingTrades.push(this.fb.group(o.value))})):n==="Completed"&&(this.executingTrades.enable(),e.enable(),r.disable()),this.cdr.markForCheck(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)})}async onSubmit(){if(this.tradeForm.valid){this.tradeForm.patchValue({updated_time:new Date().toISOString()});let n=this.tradeForm.getRawValue();try{this.mode==="create"?await this.supabase.addTradeLogOfSelectedAccount(n,this.tableName,this.tradeAccountId):this.mode==="edit"&&await this.supabase.updateTradeLogOfSelectedAccount(n,this.tableName,this.tradeAccountId),this.formSubmitted.emit()}catch(e){console.error("Error submitting trade:",e)}}else console.log("Invalid form")}onCancel(){this.cancel.emit()}isNegativeEmotionalState(){let n=this.tradeData?this.tradeData.emotion_before:"calm";return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}static \u0275fac=function(e){return new(e||t)(ne(oi),ne(vt),ne(Ct))};static \u0275cmp=it({type:t,selectors:[["app-individual-trade"]],inputs:{tradeData:"tradeData",mode:"mode",tradeAccountId:"tradeAccountId"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},features:[Xo],decls:147,vars:14,consts:[[1,"container-fluid","my-4"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["routerLink","/tradejournal",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"needs-validation",3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","d-block","mb-2"],["role","group","aria-label","Trade status toggle",1,"btn-group","w-100","shadow-sm"],["type","button",1,"btn",3,"click","ngClass"],[1,"bi","bi-hourglass","me-1"],["type","button","class","btn",3,"ngClass","click",4,"ngIf"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],["for","trade_symbol",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-tag"],["type","text","id","trade_symbol","formControlName","trade_symbol","placeholder","Enter ticker symbol",1,"form-control"],["for","trade_analysis",1,"form-label"],["id","trade_analysis","formControlName","trade_analysis",1,"form-select"],["value","","selected","","disabled",""],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["value","Other"],[1,"col-md-6"],["for","trade_instrument",1,"form-label"],["id","trade_instrument","formControlName","trade_instrument",1,"form-select"],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["for","type_of_order",1,"form-label"],["id","type_of_order","formControlName","type_of_order",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","market_condition",1,"form-label"],["id","market_condition","rows","3","formControlName","market_condition","placeholder","Describe current market conditions and relevant factors",1,"form-control"],[1,"bi","bi-2-circle","me-2"],[1,"card-body","col-12"],["for","strategy_name",1,"form-label"],["type","text","id","strategy_name","formControlName","strategy_name","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","entry_criteria",1,"form-label"],["id","entry_criteria","rows","4","formControlName","entry_criteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)",1,"form-control"],[1,"form-text"],["for","exit_criteria",1,"form-label"],["id","exit_criteria","rows","4","formControlName","exit_criteria","placeholder","Define your profit targets and stop loss levels",1,"form-control"],["class","card mb-4 shadow-sm",4,"ngIf"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],[1,"p-3"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-tr-secondary","me-2","mt-3",3,"click"],["type","submit",1,"btn","btn-primary","btn-tr","mt-3"],[1,"bi","bi-play-fill","me-1"],[1,"bi","bi-check-circle","me-1"],[1,"bi","bi-3-circle","me-2"],["formArrayName","planned_trade"],["class","border rounded p-3 mb-3 position-relative",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-outline-primary","w-100",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"border","rounded","p-3","mb-3","position-relative",3,"formGroupName"],["type","button",1,"btn","btn-sm","btn-danger","position-absolute","end-0","top-0","m-2",3,"click"],[1,"bi","bi-x"],[1,"mb-3"],[1,"col-md-3"],[1,"form-label"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","trade_direction","value","Long",1,"btn-check",3,"id"],[1,"btn","btn-outline-success",3,"for"],["type","radio","formControlName","trade_direction","value","Short",1,"btn-check",3,"id"],[1,"btn","btn-outline-danger",3,"for"],["type","number","step","0.01","placeholder","Entry Price","formControlName","entry_price",1,"form-control"],["type","number","step","0.01","placeholder","Stop Loss","formControlName","stop_loss",1,"form-control"],["type","number","step","0.01","placeholder","Exit Price","formControlName","exit_price",1,"form-control"],["type","datetime-local","formControlName","entry_time",1,"form-control"],["type","datetime-local","formControlName","exit_time",1,"form-control"],["formControlName","exit",1,"form-select"],["value","Target"],["value","StopLoss"],["value","Manual"],["type","number","step","0.01","placeholder","Position Size","formControlName","position_size",1,"form-control"],["type","number","placeholder","Contracts","formControlName","contracts",1,"form-control"],["type","number","step","0.01","placeholder","Multiplier","formControlName","contract_multiplier",1,"form-control"],[1,"mt-3"],[1,"progress",2,"height","5px"],["role","progressbar",1,"progress-bar",2,"width","100%"],["formArrayName","executing_trades"],[1,"bi","bi-4-circle","me-2"],["formGroupName","emotion_before"],["for","emotional_state_before",1,"form-label"],["id","emotional_state_before","formControlName","emotional_state_before",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],["class","form-text",4,"ngIf"],["for","trade_confidence_before",1,"form-label"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_1","value","1",1,"btn-check"],["for","confidence_before_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_2","value","2",1,"btn-check"],["for","confidence_before_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_3","value","3",1,"btn-check"],["for","confidence_before_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_4","value","4",1,"btn-check"],["for","confidence_before_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_5","value","5",1,"btn-check"],["for","confidence_before_5",1,"btn","btn-outline-success"],[1,"form-text","text-center"],["for","reflection_before",1,"form-label"],["id","reflection_before","formControlName","reflection_before","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO)","rows","2",1,"form-control"],[1,"bi","bi-exclamation-triangle","text-warning"],[1,"text-warning"],["for","realized_profit",1,"form-label"],["type","number","step","0.01","id","realized_profit","formControlName","realized_profit",1,"form-control"],["for","unrealized_profit",1,"form-label"],["type","number","step","0.01","id","unrealized_profit","formControlName","unrealized_profit",1,"form-control"],["for","planned_profit",1,"form-label"],["type","number","step","0.01","id","planned_profit","formControlName","planned_profit",1,"form-control"],[1,"bi","bi-5-circle","me-2"],["formGroupName","emotion_after"],["for","emotional_state_after",1,"form-label"],["id","emotional_state_after","formControlName","emotional_state_after",1,"form-select"],["value","Satisfied"],["value","Disappointed"],["for","trade_confidence_after",1,"form-label"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_1","value","1",1,"btn-check"],["for","confidence_after_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_2","value","2",1,"btn-check"],["for","confidence_after_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_3","value","3",1,"btn-check"],["for","confidence_after_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_4","value","4",1,"btn-check"],["for","confidence_after_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_5","value","5",1,"btn-check"],["for","confidence_after_5",1,"btn","btn-outline-success"],["for","reflection_after",1,"form-label"],["id","reflection_after","formControlName","reflection_after","placeholder","What did you learn? What could be improved?","rows","2",1,"form-control"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),w(8,"Trade Logs"),y()(),v(9,"li",6),w(10,"Trade Form"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),w(14),y(),v(15,"p",10),w(16,"Document your trading strategy and execution to maintain discipline and improve performance"),y()()(),v(17,"form",11),te("ngSubmit",function(){return r.onSubmit()}),v(18,"div",12)(19,"label",13),w(20,"Trade Status"),y(),v(21,"div",14)(22,"button",15),te("click",function(){let i;return(i=r.tradeForm.get("trade_status"))==null?null:i.setValue("Planned")}),U(23,"i",16),w(24," Planned "),y(),re(25,oae,3,4,"button",17)(26,iae,3,4,"button",17),y()(),v(27,"div",18)(28,"div",19)(29,"h5",20),U(30,"i",21),w(31,"Trade Setup "),y(),v(32,"span",22),w(33,"Required"),y()(),v(34,"div",23)(35,"div",24)(36,"div",25)(37,"label",26),w(38,"Trade Symbol"),y(),v(39,"div",27)(40,"span",28),U(41,"i",29),y(),U(42,"input",30),y()(),v(43,"div",25)(44,"label",31),w(45,"Trade Analysis"),y(),v(46,"select",32)(47,"option",33),w(48,"Choose analysis method"),y(),v(49,"option",34),w(50,"Technical"),y(),v(51,"option",35),w(52,"Fundamental"),y(),v(53,"option",36),w(54,"Both"),y(),v(55,"option",37),w(56,"Sentiment"),y(),v(57,"option",38),w(58,"Other"),y()()(),v(59,"div",39)(60,"label",40),w(61,"Trade Instrument"),y(),v(62,"select",41)(63,"option",33),w(64,"Choose instrument type"),y(),v(65,"option",42),w(66,"Forex"),y(),v(67,"option",43),w(68,"Stocks"),y(),v(69,"option",44),w(70,"Futures"),y(),v(71,"option",45),w(72,"Crypto"),y(),v(73,"option",46),w(74,"Options"),y(),v(75,"option",47),w(76,"ETF"),y(),v(77,"option",38),w(78,"Other"),y()()(),v(79,"div",39)(80,"label",48),w(81,"Type of Order"),y(),v(82,"select",49)(83,"option",33),w(84,"Choose order type"),y(),v(85,"option",50),w(86,"Market"),y(),v(87,"option",51),w(88,"Limit"),y(),v(89,"option",52),w(90,"Stop"),y(),v(91,"option",53),w(92,"Stop Limit"),y(),v(93,"option",54),w(94,"Trailing Stop"),y()()(),v(95,"div",55)(96,"label",56),w(97,"Market Condition"),y(),U(98,"textarea",57),y()()()(),v(99,"div",18)(100,"div",19)(101,"h5",20),U(102,"i",58),w(103,"Trade Strategy "),y(),v(104,"span",22),w(105,"Required"),y()(),v(106,"div",59)(107,"label",60),w(108,"Strategy Name"),y(),U(109,"input",61),y(),v(110,"div",23)(111,"div",24)(112,"div",39)(113,"label",62),w(114,"Entry Criteria "),v(115,"span",10),w(116,"(Why are you taking this trade?)"),y()(),U(117,"textarea",63),v(118,"div",64),w(119,"Be specific about what signals or conditions must be met for entry."),y()(),v(120,"div",39)(121,"label",65),w(122,"Exit Criteria "),v(123,"span",10),w(124,"(How will you close this position?)"),y()(),U(125,"textarea",66),v(126,"div",64),w(127,"Include both profit-taking and loss-cutting criteria."),y()()()()(),re(128,aae,13,1,"div",67)(129,cae,13,1,"div",67)(130,dae,58,1,"div",67)(131,pae,30,0,"div",67)(132,fae,55,0,"div",67),v(133,"div",18)(134,"div",19)(135,"h5",20),U(136,"i",68),w(137,"Additional Notes "),y(),v(138,"span",69),w(139,"Optional"),y()(),v(140,"div",70),U(141,"textarea",71),y()(),v(142,"div",72)(143,"button",73),te("click",function(){return r.onCancel()}),w(144,"Cancel"),y(),v(145,"button",74),w(146),y()()()()),e&2){let o,i,s,a,l,c;O(14),Ke(r.mode==="edit"?"Edit Trade":"Create Trade"),O(3),z("formGroup",r.tradeForm),O(5),z("ngClass",Qo(11,IV,((o=r.tradeForm.get("trade_status"))==null?null:o.value)==="Planned",((o=r.tradeForm.get("trade_status"))==null?null:o.value)!=="Planned")),O(3),z("ngIf",r.mode==="edit"),O(),z("ngIf",r.mode==="edit"),O(102),z("ngIf",((i=r.tradeForm.get("trade_status"))==null?null:i.value)==="Planned"),O(),z("ngIf",((s=r.tradeForm.get("trade_status"))==null?null:s.value)!=="Planned"),O(),z("ngIf",((a=r.tradeForm.get("trade_status"))==null?null:a.value)!=="Completed"),O(),z("ngIf",((l=r.tradeForm.get("trade_status"))==null?null:l.value)==="Completed"),O(),z("ngIf",((c=r.tradeForm.get("trade_status"))==null?null:c.value)==="Completed"),O(14),$e(" ",r.mode==="edit"?"Update Trade":"Save Trade"," ")}},dependencies:[kt,lo,Bn,Ut,mo,po,gs,ys,wn,Bi,hs,fa,Nn,uo,fo,Po,Ib,Eb,zn],encapsulation:2})};var mae=(t,n,e)=>({"status-planned-card":t,"status-executing-card":n,"status-completed-card":e}),hae=(t,n,e)=>({"status-planned":t,"status-executing":n,"status-completed":e});function gae(t,n){if(t&1&&(v(0,"option",18),w(1),y()),t&2){let e=n.$implicit,r=Y();z("value",e.account_id)("selected",e.account_id===r.tradeAccountId),O(),$e(" ",e.account_name," ")}}function yae(t,n){t&1&&(v(0,"div",19),w(1,"Loading trade logs..."),y())}function vae(t,n){if(t&1&&(v(0,"div",20),w(1),y()),t&2){let e=Y();O(),Ke(e.errorMessage)}}function xae(t,n){if(t&1){let e=Je();na(0),v(1,"div",27)(2,"div",28),te("click",function(){le(e);let o=Y().$implicit,i=Y(3);return ce(i.openEditModal(o))}),v(3,"div",29),U(4,"i",30),w(5),y(),v(6,"div",31),te("click",function(o){le(e);let i=Y().$implicit,s=Y(3);return ce(s.onDeleteTradeLog(i,o))}),U(7,"i",32),y(),v(8,"div",33)(9,"h4",34),w(10),y(),v(11,"h5",35),w(12),y(),v(13,"div",36)(14,"div",37)(15,"strong"),w(16,"Account Name:"),y(),w(17),y(),v(18,"div",37)(19,"strong"),w(20,"Analysis:"),y(),w(21),y(),v(22,"div",37)(23,"strong"),w(24,"Profit:"),y(),w(25),y()(),v(26,"div",38)(27,"small",39),w(28),No(29,"date"),y()()()()(),ra()}if(t&2){let e=Y().$implicit;O(2),z("ngClass",Hl(15,mae,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),O(),z("ngClass",Hl(19,hae,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),O(2),$e(" ",e.trade_status," "),O(5),Ke(e.trade_symbol),O(2),Xu(" ",e.trade_instrument," | ",e.type_of_order," "),O(5),$e(" ",e.account_name," "),O(4),$e(" ",e.trade_analysis," "),O(4),Kh(" Realized: ",e.realized_profit," | Unrealized: ",e.unrealized_profit," | Planned: ",e.planned_profit," "),O(3),$e("Last modified: ",ko(29,12,e.updated_time,"medium"),"")}}function bae(t,n){if(t&1&&(na(0),re(1,xae,30,23,"ng-container",26),ra()),t&2){let e=n.$implicit,r=Y().$implicit;O(),z("ngIf",e.trade_status===r.status)}}function wae(t,n){if(t&1&&(v(0,"div",23)(1,"h3"),w(2),y(),v(3,"div",24),re(4,bae,2,1,"ng-container",25),y()()),t&2){let e=n.$implicit,r=Y(2);O(2),Ke(e.title),O(2),z("ngForOf",r.tradeLogs)}}function Cae(t,n){if(t&1&&(v(0,"div",21),re(1,wae,5,2,"div",22),y()),t&2){let e=Y();O(),z("ngForOf",e.tradeStatus)}}function _ae(t,n){t&1&&(v(0,"div",40),w(1," No trade logs found. "),y())}function Iae(t,n){if(t&1){let e=Je();v(0,"div",41),te("click",function(o){le(e);let i=Y();return ce(i.closeModalOnOverlayClick(o))}),v(1,"div",42),te("click",function(o){return le(e),ce(o.stopPropagation())}),v(2,"app-individual-trade",43),te("formSubmitted",function(){le(e);let o=Y();return ce(o.onFormSubmitted())})("cancel",function(){le(e);let o=Y();return ce(o.closeModal())}),y()()()}if(t&2){let e=Y();O(2),z("tradeData",e.selectedTradeLog)("mode",e.selectedTradeLog?"edit":"create")("tradeAccountId",e.tradeAccountId)}}var Fb=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="tradejournal";tradeLogs=[];tradeAccounts=[];loading=!1;errorMessage="";tradeAccountId="";showModal=!1;selectedTradeLog=null;tradeStatus=[{status:"Planned",title:"Planning Phase"},{status:"Executing",title:"Executing Phase"},{status:"Completed",title:"Completed Phase"}];async ngOnInit(){this.loading=!0,await this.fetchTradeAccounts(),await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{let n=await this.supabaseService.getTradeLogsOfSelectedAccount(this.tableName,this.tradeAccountId);this.tradeLogs=n.sort((e,r)=>new Date(r.updated_time).getDate()-new Date(e.updated_time).getTime()),this.cdr.markForCheck()}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}async fetchTradeAccounts(){try{this.tradeAccounts=await this.supabaseService.getUserTradeAccounts(),this.tradeAccounts.length&&(this.tradeAccountId=this.tradeAccounts[0].account_id)}catch(n){console.error("Error fetching trade accounts:",n),this.errorMessage="Error loading trade accounts."}}onAccountChange(n){let e=n.target;this.tradeAccountId=e.value,this.fetchTradeLogs(),this.cdr.markForCheck()}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}openAddModal(){this.selectedTradeLog=null,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal(),this.cdr.markForCheck()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLogOfSelectedAccount(n.tradeid,this.tableName,this.tradeAccountId),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(ne(Ct),ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-trade-journal"]],decls:25,vars:6,consts:[[1,"container","mt-3"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","justify-content-center"],[1,"btn","btn-tr","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"form-group","mt-4","mb-3"],["for","accountSelector"],["id","accountSelector",1,"form-control","w-auto","d-inline-block","ms-2",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value","selected"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"mt-5"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"mt-3","row"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"col-md-3","col-sm-6","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"mb-2"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeData","mode","tradeAccountId"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",5),w(7,"Trade Journal"),y()()(),v(8,"div",6)(9,"h2"),w(10,"Trade Journal"),y(),v(11,"button",7),te("click",function(){return r.openAddModal()}),U(12,"i",8),w(13," Add "),y()(),v(14,"div",9)(15,"label",10)(16,"strong"),w(17,"Select Trade Account:"),y()(),v(18,"select",11),te("change",function(i){return r.onAccountChange(i)}),re(19,gae,2,3,"option",12),y()(),re(20,yae,2,0,"div",13)(21,vae,2,1,"div",14)(22,Cae,2,1,"div",15)(23,_ae,2,0,"div",16),y(),re(24,Iae,3,3,"div",17)),e&2&&(O(19),z("ngForOf",r.tradeAccounts),O(),z("ngIf",r.loading),O(),z("ngIf",r.errorMessage),O(),z("ngIf",r.tradeLogs&&r.tradeLogs.length),O(),z("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),O(),z("ngIf",r.showModal))},dependencies:[mo,gs,ys,kt,lo,Bn,Ut,ei,Af,zn],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:5px;color:#fff;font-size:.7rem}.status-planned[_ngcontent-%COMP%]{background-color:#007bff}.status-executing[_ngcontent-%COMP%]{background-color:#ffc107}.status-completed[_ngcontent-%COMP%]{background-color:#28a745}.status-planned-card[_ngcontent-%COMP%]{border-left:4px solid #007bff!important}.status-executing-card[_ngcontent-%COMP%]{border-left:4px solid #ffc107!important}.status-completed-card[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;display:none;color:red;cursor:pointer}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;max-width:90vw;position:relative;max-height:98vh;overflow-y:auto}"]})};var Eae=["alertAudio"],Ob=class t{minutes=0;seconds=0;displayTime="00:00";isRunning=!1;totalSeconds=0;intervalId;alertAudio;startTimer(){this.totalSeconds=this.minutes*60+this.seconds,!(this.totalSeconds<=0)&&(this.updateDisplay(),this.isRunning=!0,this.intervalId=setInterval(()=>{this.totalSeconds>0?(this.totalSeconds--,this.updateDisplay()):(this.stopTimer(),this.alertAudio.nativeElement.play())},1e3))}stopTimer(){clearInterval(this.intervalId),this.isRunning=!1}resetTimer(){this.stopTimer(),this.minutes=0,this.seconds=0,this.displayTime="00:00"}updateDisplay(){let n=Math.floor(this.totalSeconds/60),e=this.totalSeconds%60;this.displayTime=`${this.pad(n)}:${this.pad(e)}`}pad(n){return n<10?"0"+n:n.toString()}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=it({type:t,selectors:[["app-timer-clock"]],viewQuery:function(e,r){if(e&1&&u1(Eae,5),e&2){let o;rx(o=ox())&&(r.alertAudio=o.first)}},decls:15,vars:5,consts:[["alertAudio",""],[1,"timer-container"],[1,"inputs"],["type","number","placeholder","Minutes","min","0",3,"ngModelChange","ngModel"],["type","number","placeholder","Seconds","min","0",3,"ngModelChange","ngModel"],[1,"controls"],[3,"click","disabled"],[3,"click"],["src","assets/alert.mp3"]],template:function(e,r){if(e&1){let o=Je();v(0,"div",1)(1,"h1"),w(2),y(),v(3,"div",2)(4,"input",3),an("ngModelChange",function(s){return le(o),un(r.minutes,s)||(r.minutes=s),ce(s)}),y(),v(5,"input",4),an("ngModelChange",function(s){return le(o),un(r.seconds,s)||(r.seconds=s),ce(s)}),y()(),v(6,"div",5)(7,"button",6),te("click",function(){return le(o),ce(r.startTimer())}),w(8,"Start"),y(),v(9,"button",6),te("click",function(){return le(o),ce(r.stopTimer())}),w(10,"Stop"),y(),v(11,"button",7),te("click",function(){return le(o),ce(r.resetTimer())}),w(12,"Reset"),y()(),U(13,"audio",8,0),y()}e&2&&(O(2),Ke(r.displayTime),O(2),sn("ngModel",r.minutes),O(),sn("ngModel",r.seconds),O(2),z("disabled",r.isRunning),O(2),z("disabled",!r.isRunning))},dependencies:[vs,wn,Bi,Nn,dd,Vi],styles:[".timer-container[_ngcontent-%COMP%]{text-align:center;font-family:sans-serif;margin-top:100px}h1[_ngcontent-%COMP%]{font-size:100px;margin-bottom:30px}.inputs[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:80px;padding:10px;font-size:20px;margin:10px}.controls[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:10px 20px;font-size:20px;margin:10px}"]})};function Sae(t,n){if(t&1&&(v(0,"p",11),w(1),y()),t&2){let e=Y().$implicit;O(),Ke(e.description)}}function Tae(t,n){if(t&1&&(v(0,"div",3)(1,"div",4)(2,"a",5),U(3,"img",6),y(),v(4,"div",7)(5,"a",8)(6,"h5",9),w(7),y(),re(8,Sae,2,1,"p",10),y()()()()),t&2){let e=n.$implicit;O(2),z("href",e.url,cs),O(),z("src",e.thumbnail,cs),O(2),z("href",e.url,cs),O(),Ku("title",e.title),O(),Ke(e.title),O(),z("ngIf",e.description)}}var Pb=class t{cdr=se(vt);supabaseService=se(Ct);videos=[];ngOnInit(){this.loadActiveVideos()}async loadActiveVideos(){try{let n=await this.supabaseService.loadActiveMeditationVideos();this.videos=n.map(e=>{let r=this.extractVideoId(e.url);return r?{url:e.url,id:r,title:e.title??"",description:e.description??"",thumbnail:`https://img.youtube.com/vi/${r}/hqdefault.jpg`}:null}).filter(e=>e!==null),this.cdr.markForCheck()}catch(n){console.error("Failed to load active meditation videos:",n)}}fetchVideoTitles(){this.videos.forEach(n=>{fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(`https://www.youtube.com/watch?v=${n.id}`)}&format=json`).then(e=>e.json()).then(e=>{n.title=e.title,this.cdr.markForCheck()}).catch(()=>{n.title="Unknown Title",this.cdr.markForCheck()})})}extractVideoId(n){let e=n.match(/(?:youtube\.com\/(?:.*v=|.*\/|.*embed\/)|youtu\.be\/)([a-zA-Z0-9_-]{11})/);return e?e[1]:null}formatDuration(n){let e=Math.floor(n/60),r=n%60;return`${e}:${r<10?"0"+r:r}`}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=it({type:t,selectors:[["app-meditation-hub"]],decls:6,vars:1,consts:[[1,"container-fluid","mt-4","ps-3l"],[1,"row"],["class","col-sm-6 col-md-4 col-lg-2 mb-4",4,"ngFor","ngForOf"],[1,"col-sm-6","col-md-4","col-lg-2","mb-4"],[1,"card","h-100","shadow-sm"],["target","_blank",3,"href"],["alt","Video thumbnail",1,"card-img-top",3,"src"],[1,"card-body","d-flex","flex-column"],["target","_blank",2,"all","unset",3,"href"],[1,"card-title","text-truncate",3,"title"],["class","card-text mt-auto",4,"ngIf"],[1,"card-text","mt-auto"]],template:function(e,r){e&1&&(v(0,"div",0),U(1,"app-timer-clock"),v(2,"h2"),w(3,"Meditation Videos"),y(),v(4,"div",1),re(5,Tae,9,6,"div",2),y()()),e&2&&(O(5),z("ngForOf",r.videos))},dependencies:[kt,Bn,Ut,Ob],styles:[".player-container[_ngcontent-%COMP%]{width:100%;height:0;padding-bottom:56.25%;position:relative}.player-container[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%;height:100%}"]})};var Lb=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=it({type:t,selectors:[["app-analytics"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(v(0,"h1",0),w(1,"Analytics Coming soon"),y())},encapsulation:2})};var hd=class{constructor(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)}set(n,e){this.dataIdsCount++,this.data.set(n,e)}has(n){return this.data.has(n)}delete(n){return this.dataIdsCount--,this.data.delete(n)}numDataIds(){return this.dataIdsCount}},ha=class{refCount(n){return si("refCount")}incRef(n){return si("incRef")}timerAvailable(){return!0}time(n){return si("time")}read(n){return si("read")}readSync(n){return si("readSync")}numDataIds(){return si("numDataIds")}disposeData(n,e){return si("disposeData")}write(n,e,r){return si("write")}move(n,e,r,o,i){return si("move")}memory(){return si("memory")}floatPrecision(){return si("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return si("dispose")}};function si(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function EV(t){let n=t.length,e=0,r=0;for(;n>0;)r=Math.random()*n|0,n--,e=t[n],t[n]=t[r],t[r]=e}function Dae(t,n){if(t.length!==n.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${n.length}`);let e=t.length,r,o,i=0;for(;e>0;)i=Math.random()*e|0,e--,r=t[e],o=n[e],t[e]=t[i],n[e]=n[i],t[i]=r,n[i]=o}function Rf(t,n,e){return Math.max(t,Math.min(n,e))}function Nae(t){return t%2===0?t:t+1}function kae(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function Aae(t,n){let e=Math.random();return n*e+(1-e)*t}function Rae(t,n){let e=0;for(let r=0;r<t.length;r++){let o=Number(t[r])-Number(n[r]);e+=o*o}return e}function F(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function $b(t,n,e=""){F(xs(t,n),()=>e+` Shapes ${t} and ${n} must match`)}function ty(t){F(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function sc(t,n=[],e=!1){if(n==null&&(n=[]),Array.isArray(t)||ho(t)&&!e)for(let r=0;r<t.length;++r)sc(t[r],n,e);else n.push(t);return n}function $t(t){if(t.length===0)return 1;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];return n}function Mae(t){return t.length===0}function xs(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function _t(t){return t%1===0}function Fae(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let n=Math.exp(2*t);return(n-1)/(n+1)}}function Oae(t){let n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function Pae(t){let n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return EV(n),n}function yd(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function Lae(t,n=r=>0,e){return new Promise((r,o)=>{let i=0,s=()=>{if(t()){r();return}i++;let a=n(i);if(e!=null&&i>=e){o();return}setTimeout(s,a)};s()})}function $ae(t,n){let e=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(n>0&&n!==e)throw Error(`Size(${n}) must match the product of shape ${t}`);return t}if(e===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(n%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${n} / ${e}`);let o=t.slice();return o[r]=n/e,o}function kn(t,n){let e=n.length;return t=t==null?n.map((r,o)=>o):[].concat(t),F(t.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${t}`),F(t.every(r=>_t(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?e+r:r)}function _D(t,n){let e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:kn(n,t).sort(),s=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[s]==null||i[s]>a)&&t[a]===1&&(e.push(t[a]),r.push(a)),i[s]<=a&&s++}t[a]!==1&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function Vae(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);return e}function ID(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else if(t==="string")e=new Array(n);else throw new Error(`Unknown data type ${t}`);return e}function ED(t,n){for(let e=0;e<t.length;e++){let r=t[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${n} being uploaded contains ${r}.`)}}function SD(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Bae(t,n){return!(n==="complex64"||n==="float32"&&t!=="complex64"||n==="int32"&&t!=="float32"&&t!=="complex64"||n==="bool"&&t==="bool")}function ho(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Vb(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function TD(t){if(t==null)return 0;let n=0;return t.forEach(e=>n+=e.length),n}function Mf(t){return typeof t=="string"||t instanceof String}function SV(t){return typeof t=="boolean"}function TV(t){return typeof t=="number"}function Ff(t){return Array.isArray(t)?Ff(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":TV(t)?"float32":Mf(t)?"string":SV(t)?"bool":"float32"}function Of(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Pf(t,n){for(let e=n;e<t;++e)if(t%e===0)return e;return t}function bs(t){let n=t.length;if(n<2)return[];let e=new Array(n-1);e[n-2]=t[n-1];for(let r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function DV(t,n,e,r=!1){let o=new Array;if(n.length===1){let i=n[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[t+s]}else{let i=n[0],s=n.slice(1),a=s.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)o[l]=DV(t+l*a,s,e,r)}return o}function gd(t,n,e=!1){if(t.length===0)return n[0];let r=t.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==n.length)throw new Error(`[${t}] does not match the input size ${n.length}${e?" for a complex tensor":""}.`);return DV(0,t,n,e)}function ny(t,n){let e=Lf(t,n);for(let r=0;r<e.length;r++)e[r]=1;return e}function Lf(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${n}`)}function zae(t,n){let e=t.reduce((r,o)=>r*o,1);if(n==null||n==="float32")return gd(t,new Float32Array(e));if(n==="int32")return gd(t,new Int32Array(e));if(n==="bool")return gd(t,new Uint8Array(e));throw new Error(`Unknown data type ${n}`)}function ry(t){t.forEach(n=>{F(Number.isInteger(n)&&n>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Uae(t,n,e){if(n===0)return 0;if(n===1)return t[0];let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function jae(t,n,e){if(n===0)return[];if(n===1)return[t];let r=new Array(n);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}function oy(t){return t&&t.then&&typeof t.then=="function"}var NV="tfjsflags",iy=class{constructor(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Wae,this.populateURLFlags()}setPlatform(n,e){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=n,this.platform=e}registerFlag(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){let o=this.urlFlags[n];console.warn(`Setting feature override from URL ${n}: ${o}.`),this.set(n,o)}}async getAsync(n){return n in this.flags?this.flags[n]:(this.flags[n]=await this.evaluateFlag(n),this.flags[n])}get(n){if(n in this.flags)return this.flags[n];let e=this.evaluateFlag(n);if(oy(e))throw new Error(`Flag ${n} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[n]=e,this.flags[n]}getNumber(n){return this.get(n)}getBool(n){return this.get(n)}getFlags(){return this.flags}get features(){return this.flags}set(n,e){if(this.flagRegistry[n]==null)throw new Error(`Cannot set flag ${n} as it has not been registered.`);this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)}evaluateFlag(n){if(this.flagRegistry[n]==null)throw new Error(`Cannot evaluate flag '${n}': no evaluation function found.`);return this.flagRegistry[n].evaluationFn()}setFlags(n){this.flags=Object.assign({},n)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let n=this.getQueryParams(this.global.location.search);NV in n&&n[NV].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=qae(o,i)})}};function Wae(t){let n={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(Hae(n,r[0],r[1]),r.join("="))),n}function Hae(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function qae(t,n){if(n=n.toLowerCase(),n==="true"||n==="false")return n==="true";if(`${+n}`===n)return+n;throw new Error(`Could not parse value flag value ${n} for flag ${t}.`)}function H(){return DD}var DD=null;function kV(t){DD=t}var ND;function kD(){if(ND==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");ND=t}return ND}function Kae(){let t=kD();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function sy(t,n){let e=Kae();if(e.has(t))return e.get(t);{let r=n();return e.set(t,r),e.get(t)}}var ac="Abs",ga="Acos",ya="Acosh",zi="Add",$f="AddN",Vf="All",Bf="Any",lc="ArgMax",cc="ArgMin",va="Asin",xa="Asinh",ba="Atan",wa="Atanh",Ca="Atan2",uc="AvgPool",zf="AvgPoolGrad",dc="AvgPool3D",Uf="AvgPool3DGrad",pc="BatchMatMul",fc="BatchToSpaceND",Bb="Bincount",AV="BroadcastTo",ws="Cast",_a="Ceil",Ia="ClipByValue",jf="Complex",mc="ComplexAbs",hc="Concat",gc="Conv2D",Gf="Conv2DBackpropFilter",yc="Conv2DBackpropInput",vc="Conv3D",Wf="Conv3DBackpropFilterV2",Hf="Conv3DBackpropInputV2",Ea="Cos",Sa="Cosh",xc="Cumsum",zb="CropAndResize",Ub="DenseBincount",qf="DepthToSpace",bc="DepthwiseConv2dNative",Kf="DepthwiseConv2dNativeBackpropFilter",Xf="DepthwiseConv2dNativeBackpropInput",jb="Diag",wc="Dilation2D",ay="Dilation2DBackpropInput",ly="Dilation2DBackpropFilter",Ta="RealDiv",Gb="Einsum",Da="Elu",Yf="EluGrad",Na="Erf",vd="Equal",ka="Exp",Cc="ExpandDims",Aa="Expm1",Zf="FFT",Qf="Fill",Wb="FlipLeftRight",Ra="Floor",Ma="FloorDiv",_c="FusedBatchNorm",Ic="GatherV2",Hb="GatherNd",xd="Greater",Fa="GreaterEqual",Cs="Identity",Jf="IFFT",em="Imag",Oa="IsFinite",Pa="IsInf",La="IsNan",Ec="LeakyRelu",bd="Less",wd="LessEqual",qb="LinSpace",$a="Log",Va="Log1p",Cd="LogicalAnd",_d="LogicalNot",Id="LogicalOr",RV="LogSoftmax",Sc="LRN",tm="LRNGrad",Tc="Max",Ba="Maximum",Dc="MaxPool",nm="MaxPoolGrad",Nc="MaxPool3D",rm="MaxPool3DGrad",Kb="MaxPoolWithArgmax",kc="Mean",Ac="Min",za="Minimum",Rc="MirrorPad",Ua="Mod",Xb="Multinomial",ja="Multiply",Mc="Neg",Ed="NotEqual",Yb="NonMaxSuppressionV3",Zb="NonMaxSuppressionV4",Qb="NonMaxSuppressionV5",Fc="OnesLike",Oc="OneHot",Pc="Pack",Lc="PadV2";var Ga="Pow",$c="Prelu",om="Prod",im="Range",sm="Real",Wa="Reciprocal",Ha="Relu",Vc="Reshape",Bc="ResizeNearestNeighbor",am="ResizeNearestNeighborGrad",zc="ResizeBilinear",lm="ResizeBilinearGrad",qa="Relu6",Uc="Reverse",Ka="Round",Xa="Rsqrt",Jb="ScatterNd",jc="Select",Ya="Selu",Gc="Slice",Za="Sin",Qa="Sinh",Ja="Sign",el="Sigmoid",tl="Softplus",nl="Sqrt",Wc="Sum",Hc="SpaceToBatchND",qc="SplitV",Kc="Softmax",ew="SparseFillEmptyRows",tw="SparseReshape",nw="SparseToDense",rl="SquaredDifference",cm="Square",um="StridedSlice",ol="Sub",il="Tan",sl="Tanh",_s="Tile",dm="TopK",rw="Transform",Xc="Transpose",pm="Unique",Yc="Unpack",Zc="UnsortedSegmentSum",Qc="ZerosLike",al="Step",MV="FromPixels",ow="RotateWithOffset",Sd="_FusedMatMul",Td="FusedConv2D",Dd="FusedDepthwiseConv2D";var iw=sy("kernelRegistry",()=>new Map),AD=sy("gradRegistry",()=>new Map);function RD(t,n){let e=OV(t,n);return iw.get(e)}function MD(t){return AD.get(t)}function FD(t){let n=iw.entries(),e=[];for(;;){let{done:r,value:o}=n.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===t&&e.push(s)}return e}function sw(t){let{kernelName:n,backendName:e}=t,r=OV(n,e);iw.has(r)&&console.warn(`The kernel '${n}' for backend '${e}' is already registered`),iw.set(r,t)}function FV(t){let{kernelName:n}=t;AD.has(n)&&H().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${n}'`),AD.set(n,t)}function OV(t,n){return`${n}_${t}`}var C={};rs(C,{arraysEqual:()=>xs,assert:()=>F,assertNonNegativeIntegerDimensions:()=>ry,assertNonNull:()=>ty,assertShapesMatch:()=>$b,bytesFromStringArray:()=>TD,bytesPerElement:()=>Vb,checkConversionForErrors:()=>ED,clamp:()=>Rf,computeStrides:()=>bs,createScalarValue:()=>Xae,createShuffledIndices:()=>Pae,decodeString:()=>hm,distSquared:()=>Rae,encodeString:()=>mm,fetch:()=>Zae,flatten:()=>sc,getArrayFromDType:()=>ID,getTypedArrayFromDType:()=>Vae,hasEncodingLoss:()=>Bae,indexToLoc:()=>jae,inferDtype:()=>Ff,inferFromImplicitShape:()=>$ae,isBoolean:()=>SV,isFunction:()=>Of,isInt:()=>_t,isNumber:()=>TV,isPromise:()=>oy,isScalarShape:()=>Mae,isString:()=>Mf,isTypedArray:()=>ho,isValidDtype:()=>SD,locToIndex:()=>Uae,makeOnesTypedArray:()=>ny,makeZerosNestedTypedArray:()=>zae,makeZerosTypedArray:()=>Lf,nearestDivisor:()=>Pf,nearestLargerEven:()=>Nae,now:()=>Nd,parseAxisParam:()=>kn,randUniform:()=>Aae,repeatedTry:()=>Lae,rightPad:()=>yd,shuffle:()=>EV,shuffleCombo:()=>Dae,sizeFromShape:()=>$t,sizeToSquarishShape:()=>Oae,squeezeShape:()=>_D,sum:()=>kae,tanh:()=>Fae,toNestedArray:()=>gd,toTypedArray:()=>fm});function Xae(t,n){return n==="string"?mm(t):fm([t],n)}function Yae(t,n){return t instanceof Float32Array&&n==="float32"||t instanceof Int32Array&&n==="int32"||t instanceof Uint8Array&&n==="bool"}function fm(t,n){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=sc(t)),H().getBool("DEBUG")&&ED(t,n),Yae(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){let e=new Uint8Array(t.length);for(let r=0;r<e.length;++r)Math.round(t[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${n}`)}function Nd(){return H().platform.now()}function Zae(t,n){return H().platform.fetch(t,n)}function mm(t,n="utf-8"){return n=n||"utf-8",H().platform.encode(t,n)}function hm(t,n="utf-8"){return n=n||"utf-8",H().platform.decode(t,n)}var aw=class{constructor(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new OD)}profileKernel(n,e,r){let o,i=()=>{o=r()},s,a=Nd();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let c of o)c.dataSync();s=Promise.resolve({kernelMs:Nd()-a})}if(H().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let u=o[c];u.data().then(d=>{Qae(d,u.dtype,n)})}return{kernelName:n,outputs:o,inputs:e,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(n){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=n;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function Qae(t,n,e){if(n!=="float32")return!1;for(let r=0;r<t.length;r++){let o=t[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var OD=class{logKernelProfile(n,e,r,o,i,s){let a=typeof o=="number"?yd(`${o}ms`,9):o.error,l=yd(n,25),c=e.rank,u=e.size,d=yd(e.shape.toString(),14),p="";for(let f in i){let m=i[f];if(m!=null){let h=m.shape||e.shape,g=h.length;p+=`${f}: ${g}D ${g>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function PV(t,n,e){let r={},o={};for(let l=0;l<n.length;l++)r[n[l].id]=!0;for(let l=0;l<t.length;l++){let c=t[l],u=c.inputs;for(let d in u){let p=u[d],f=!1;for(let m=0;m<n.length;m++)if(r[p.id]){c.outputs.forEach(h=>r[h.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}let i={};i[e.id]=!0;let s={};for(let l=t.length-1;l>=0;l--){let c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(let p in u)i[u[p].id]=!0,s[c.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let c=t[l];if(o[c.id]&&s[c.id]){let u={};for(let p in c.inputs){let f=c.inputs[p];r[f.id]&&(u[p]=f)}let d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function LV(t,n,e,r){for(let o=n.length-1;o>=0;o--){let i=n[o],s=[];if(i.outputs.forEach(l=>{let c=t[l.id];c!=null?s.push(c):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);let u=i.inputs[l];if(!xs(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{let d=t[u.id];t[u.id]=r(d,c),d.dispose()}}}}var $V=20,cy=3,PD=7;function VV(t,n,e,r){let o=bs(n),i=Jae(t,n,e,o),s=n.length,a=lw(t,n,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${n}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Jae(t,n,e,r){let o=$t(n),i=r[r.length-1],s=new Array(i).fill(0),a=n.length,l=e==="complex64"?dy(t):t;if(a>1)for(let c=0;c<o/i;c++){let u=c*i;for(let d=0;d<i;d++)s[d]=Math.max(s[d],uy(l[u+d],0,e).length)}return s}function uy(t,n,e){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(PD))} + ${parseFloat(t[1].toFixed(PD))}j`:Mf(t)?r=`'${t}'`:e==="bool"?r=BV(t):r=parseFloat(t.toFixed(PD)).toString(),yd(r,n)}function BV(t){return t===0?"false":"true"}function lw(t,n,e,r,o,i=!0){let s=e==="complex64"?2:1,a=n[0],l=n.length;if(l===0){if(e==="complex64"){let h=dy(t);return[uy(h[0],0,e)]}return e==="bool"?[BV(t[0])]:[t[0].toString()]}if(l===1){if(a>$V){let g=cy*s,x=Array.from(t.slice(0,g)),b=Array.from(t.slice((a-cy)*s,a*s));return e==="complex64"&&(x=dy(x),b=dy(b)),["["+x.map((I,_)=>uy(I,o[_],e)).join(", ")+", ..., "+b.map((I,_)=>uy(I,o[a-cy+_],e)).join(", ")+"]"]}return["["+(e==="complex64"?dy(t):Array.from(t)).map((g,x)=>uy(g,o[x],e)).join(", ")+"]"]}let c=n.slice(1),u=r.slice(1),d=r[0]*s,p=[];if(a>$V){for(let h=0;h<cy;h++){let g=h*d,x=g+d;p.push(...lw(t.slice(g,x),c,e,u,o,!1))}p.push("...");for(let h=a-cy;h<a;h++){let g=h*d,x=g+d;p.push(...lw(t.slice(g,x),c,e,u,o,h===a-1))}}else for(let h=0;h<a;h++){let g=h*d,x=g+d;p.push(...lw(t.slice(g,x),c,e,u,o,h===a-1))}let f=l===2?",":"";p[0]="["+p[0]+f;for(let h=1;h<p.length-1;h++)p[h]=" "+p[h]+f;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":m),p}function dy(t){let n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var Mt=class{constructor(n,e,r){if(this.dtype=e,this.shape=n.slice(),this.size=$t(n),r!=null){let o=r.length;F(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ID(e,this.size),this.strides=bs(n)}set(n,...e){e.length===0&&(e=[0]),F(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=n}get(...n){n.length===0&&(n=[0]);let e=0;for(let o of n){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${n}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=this.strides[o]*n[o];return this.values[r]}locToIndex(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];let e=n[n.length-1];for(let r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e}indexToLoc(n){if(this.rank===0)return[];if(this.rank===1)return[n];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e}get rank(){return this.shape.length}toTensor(){return Is().makeTensor(this.values,this.shape,this.dtype)}},Is=null,gm=null,ele=null;function zV(t){Is=t}function UV(t){gm=t}function jV(t){ele=t}var gt=class{constructor(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=$t(n),this.strides=bs(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let n=await this.data();return gm.buffer(this.shape,this.dtype,n)}bufferSync(){return gm.buffer(this.shape,this.dtype,this.dataSync())}async array(){let n=await this.data();return gd(this.shape,n,this.dtype==="complex64")}arraySync(){return gd(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let n=Is().read(this.dataId);if(this.dtype==="string"){let e=await n;try{return e.map(r=>hm(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return n}dataSync(){this.throwIfDisposed();let n=Is().readSync(this.dataId);if(this.dtype==="string")try{return n.map(e=>hm(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n}async bytes(){this.throwIfDisposed();let n=await Is().read(this.dataId);return this.dtype==="string"?n:new Uint8Array(n.buffer)}dispose(){this.isDisposed||(Is().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(n=!1){return gm.print(this,n)}clone(){return this.throwIfDisposed(),gm.clone(this)}toString(n=!1){let e=this.dataSync();return VV(e,this.shape,this.dtype,n)}cast(n){return this.throwIfDisposed(),gm.cast(this,n)}variable(n=!0,e,r){return this.throwIfDisposed(),Is().makeVariable(this,n,e,r)}};Object.defineProperty(gt,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function P(){return sy("Tensor",()=>gt)}P();var ll=class extends gt{constructor(n,e,r,o){super(n.shape,n.dtype,n.dataId,o),this.trainable=e,this.name=r}assign(n){if(n.dtype!==this.dtype)throw new Error(`dtype of the new value (${n.dtype}) and previous value (${this.dtype}) must match`);if(!xs(n.shape,this.shape))throw new Error(`shape of the new value (${n.shape}) and previous value (${this.shape}) must match`);Is().disposeTensor(this),this.dataId=n.dataId,Is().incRef(this,null)}dispose(){Is().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(ll,Symbol.hasInstance,{value:t=>t instanceof gt&&t.assign!=null&&t.assign instanceof Function});var GV=function(t){return t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64",t}(GV||{}),WV=function(t){return t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64",t}(WV||{}),HV=function(t){return t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64",t}(HV||{}),qV=function(t){return t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64",t}(qV||{}),tle={float32:HV,int32:GV,bool:WV,complex64:qV};function Fn(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error(`Can not upcast ${t} with ${n}`)}return tle[t][n]}function kd(t){return Fn(t,"int32")}function Qe(t,n){if(t.dtype===n.dtype)return[t,n];let e=Fn(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function cw(t){let n=[];return KV(t,n,new Set),n}function KV(t,n,e){if(t==null)return;if(t instanceof gt){n.push(t);return}if(!nle(t))return;let r=t;for(let o in r){let i=r[o];e.has(i)||(e.add(i),KV(i,n,e))}}function nle(t){return Array.isArray(t)||typeof t=="object"}function LD(t){return t.kernelName!=null}var uw=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(n=>n.name)))}}}dispose(){for(let n in this.registeredVariables)this.registeredVariables[n].dispose()}},ole=(()=>{class t{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new uw}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(await this.initializeBackend(o).success){await this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(console.warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new aw(this.backendInstance),!0}setupRegisteredKernels(){FD(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){FD(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof ha)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return console.warn(`Initialization of backend ${e} failed`),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return t.nextTensorId++}nextVariableId(){return t.nextVariableId++}clone(e){let r=k.runKernel(Cs,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",c={x:a},u={dtype:l};return k.runKernel(ws,c,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(!(RD(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(c=>{s+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,u=LD(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(LD(e)){let{kernelName:h,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;let b=RD(h,this.backendName);F(b!=null,()=>`Cannot find registered kernel '${h}' for backend '${this.backendName}'`),l=()=>{let I=this.backend.numDataIds();c=b.kernelFunc({inputs:g,attrs:x,backend:this.backend});let _=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,I,_);let E=_.map(S=>{if(S.rank!=null)return S;let{dataId:D,shape:M,dtype:R}=S;return this.makeTensorFromDataId(D,M,R)});if(i){let S=this.getTensorsForGradient(h,g,E);o=this.saveTensorsForBackwardMode(S)}return E}}else{let{forwardFunc:h}=e,g=x=>{i&&(o=x.map(b=>this.keep(this.clone(b))))};l=()=>{let x=this.backend.numDataIds();c=this.tidy(()=>h(this.backend,g));let b=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,x,b),b}}let{inputs:d,attrs:p}=e,f=LD(e)?null:e.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(m=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),r=m.outputs)}),i&&this.addTapeNode(u,d,r,f,o,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(h=>d[h]!=null?d[h].shape:null),outputShapes:r.map(h=>h.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(c)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=MD(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(F(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(u=>r[u])):l=s.map(u=>r[u]);let c=o.filter((u,d)=>a[d]);return l.concat(c)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&Mf(e[0])&&(s=e.map(c=>mm(c)));let a=i.write(s,r,o),l=new gt(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let c=this.state.tensorInfo.get(a),u=TD(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s=new gt(r,o,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new ll(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*Vb(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof ll||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*Vb(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},c=MD(e);c!=null&&(i=c.gradFunc),i!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){let f=o[p],m=Lf(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return d}),i(u.length>1?u:u[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=cw(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(F(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));F(s instanceof gt,()=>"The result y returned by f() must be a tensor.");let a=PV(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??ile(s.shape),LV(l,a,u=>this.tidy(u),sle);let c=r.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let d of u.saved)d.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return F(Of(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{F(r.every(l=>l instanceof gt),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,c)=>{i[c]=l});let s=(l,c)=>(o=e(...r,c),F(o.value instanceof gt,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),F(Of(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,c)=>{let u=o.gradFunc(l,c),d=Array.isArray(u)?u:[u];F(d.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),F(d.every(f=>f instanceof gt),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return d.forEach((f,m)=>{p[m]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){let r=Nd(),o=await this.backend.time(e);return o.wallMs=Nd()-r,o}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new uw;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return t.nextTensorId=0,t.nextVariableId=0,t})();function ile(t){let n=ny($t(t),"float32");return k.makeTensor(n,t,"float32")}function $D(){let t=kD();if(t._tfengine==null){let n=new iy(t);t._tfengine=new ole(n)}return kV(t._tfengine.ENV),zV(()=>t._tfengine),t._tfengine}var k=$D();function sle(t,n){let e={a:t,b:n};return k.runKernel(zi,e)}var Jc={};rs(Jc,{isBrowser:()=>VD,isMobile:()=>lle});function ale(){return typeof navigator<"u"&&navigator!=null}function lle(t){if(t||ale()){if(t||(t=navigator),t.product==="ReactNative")return!0;let n=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function VD(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Ui=H();Ui.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Ui.registerFlag("IS_BROWSER",()=>VD());Ui.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Ui.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Ui.registerFlag("PROD",()=>!1);Ui.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Ui.getBool("DEBUG"));Ui.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Ui.registerFlag("IS_TEST",()=>!1);Ui.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);Ui.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);function Ad(t,n){let e=t;if(ho(t))return n==="string"?[]:[t.length];if(!Array.isArray(t))return[];let r=[];for(;Array.isArray(e)||ho(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&YV(t,r,[]),r}function YV(t,n,e){if(e=e||[],!Array.isArray(t)&&!ho(t)){F(n.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);return}F(n.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${t.length} elements`),F(t.length===n[0],()=>`Element arr[${e.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);let r=n.slice(1);for(let o=0;o<t.length;++o)YV(t[o],r,e.concat(o))}function XV(t,n,e,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==n||t==="numeric"&&n==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${t} tensor, but got ${n} tensor`)}}function N(t,n,e,r="numeric"){if(t instanceof gt)return XV(r,t.dtype,n,e),t;let o=Ff(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),XV(r,o,n,e),t==null||!ho(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${n}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=Ad(t,o);!ho(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?fm(t,o):sc(t,[],!0);return k.makeTensor(a,i,o)}function dw(t,n,e,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${n} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,s)=>N(i,`${n}[${s}]`,e,r))}var cle="__op";function A(t){let n=Object.keys(t);if(n.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${n.length} keys.`);let e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+cle;let o=(...i)=>{k.startScope(e);try{let s=r(...i);return oy(s)&&console.error("Cannot return a Promise inside of tidy."),k.endScope(s),s}catch(s){throw k.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function ule(t,n){let e=N(t,"real","complex"),r=N(n,"imag","complex");$b(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return k.runKernel(jf,o)}var ji=A({complex_:ule});function eu(t,n,e,r){if(r==null&&(r=Ff(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!ho(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){ry(n);let o=$t(n),i=$t(e);F(o===i,()=>`Based on the provided shape, [${n}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==$t(n.slice(s)):!0;F(e[s]===n[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${n}). `)}}return!ho(t)&&!Array.isArray(t)&&(t=[t]),n=n||e,t=r!=="string"?fm(t,r):sc(t,[],!0),k.makeTensor(t,n,r)}function tu(t,n,e){let r=Ad(t,e);return eu(t,n,r,e)}var py={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var pw=4;async function QV(t,n){let e=[],r=[],o=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(t)?t[s].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let u=new Promise(async d=>{let p=await l.bytes(),f=p.reduce((g,x)=>g+x.length,0)+pw*p.length,m=new Uint8Array(f),h=0;for(let g=0;g<p.length;g++){let x=p[g],b=new Uint8Array(new Uint32Array([x.length]).buffer);m.set(b,h),h+=pw,m.set(x,h),h+=x.length}d(m)});r.push(u)}else r.push(l.data());n!=null&&(c.group=n),e.push(c)}let i=await Promise.all(r);return{data:dle(i),specs:e}}function fw(t,n){let e={},r,o=0;for(let i of n){let s=i.name,a=i.dtype,l=i.shape,c=$t(l),u;if("quantization"in i){let d=i.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${i.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${i.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let p=py[d.dtype],f=t.slice(o,o+c*p),m=d.dtype==="uint8"?new Uint8Array(f):new Uint16Array(f);if(a==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){u=new Float32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=g*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=hle()),u=r(m);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(a==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);u=new Int32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=Math.round(g*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*p}else if(a==="string"){let d=$t(i.shape);u=[];for(let p=0;p<d;p++){let f=new Uint32Array(t.slice(o,o+pw))[0];o+=pw;let m=new Uint8Array(t.slice(o,o+f));u.push(m),o+=f}}else{let d=py[a],p=t.slice(o,o+c*d);if(a==="float32")u=new Float32Array(p);else if(a==="int32")u=new Int32Array(p);else if(a==="bool")u=new Uint8Array(p);else if(a==="complex64"){u=new Float32Array(p);let f=new Float32Array(u.length/2),m=new Float32Array(u.length/2);for(let x=0;x<f.length;x++)f[x]=u[x*2],m[x]=u[x*2+1];let h=tu(f,l,"float32"),g=tu(m,l,"float32");e[s]=ji(h,g),h.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*d}a!=="complex64"&&(e[s]=tu(u,l,a))}return e}function dle(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let n=0,e=[];t.forEach(i=>{if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(n),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var BD=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function ZV(t){return BD?Buffer.byteLength(t):new Blob([t]).size}function JV(t){if(BD)return Buffer.from(t).toString("base64");let n=new Uint8Array(t),e="";for(let r=0,o=n.length;r<o;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function e3(t){if(BD){let r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;++r)e.set([n.charCodeAt(r)],r);return e.buffer}function ym(t){if(t.length===1)return t[0];let n=0;t.forEach(o=>{n+=o.byteLength});let e=new Uint8Array(n),r=0;return t.forEach(o=>{e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function zD(t){let n="/";for(t=t.trim();t.endsWith(n);)t=t.slice(0,t.length-1);let e=t.split(n);return e[e.length-1]}function Es(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:ZV(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:ZV(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function ple(){let t=e=>{let r=e<<13,o=0;for(;!(r&8388608);)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},n=new Uint32Array(2048);n[0]=0;for(let e=1;e<1024;e++)n[e]=t(e);for(let e=1024;e<2048;e++)n[e]=939524096+(e-1024<<13);return n}function fle(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let n=1;n<31;n++)t[n]=n<<23;for(let n=33;n<63;n++)t[n]=2147483648+(n-32<<23);return t}function mle(){let t=new Uint32Array(64);for(let n=0;n<64;n++)t[n]=1024;return t[0]=t[32]=0,t}function hle(){let t=ple(),n=fle(),e=mle();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=t[e[a>>10]+(a&1023)]+n[a>>10];i[s]=l}return new Float32Array(o)}}var jn=class t{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerSaveRouter(n){t.getInstance().saveRouters.push(n)}static registerLoadRouter(n){t.getInstance().loadRouters.push(n)}static getSaveHandlers(n){return t.getHandlers(n,"save")}static getLoadHandlers(n,e){return t.getHandlers(n,"load",e)}static getHandlers(n,e,r){let o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(s=>{let a=s(n,r);a!==null&&o.push(a)}),o}},t3=t=>jn.registerSaveRouter(t),n3=t=>jn.registerLoadRouter(t),r3=t=>jn.getSaveHandlers(t),o3=(t,n)=>jn.getLoadHandlers(t,n);var UD="tensorflowjs",jD=1,Rd="models_store",nu="model_info_store";function i3(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function GD(t){let n=t.result;n.createObjectStore(Rd,{keyPath:"modelPath"}),n.createObjectStore(nu,{keyPath:"modelPath"})}var Md=(()=>{class t{constructor(e){if(this.indexedDB=i3(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(UD,jD);s.onupgradeneeded=()=>GD(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(Rd,"readonly"),u=l.objectStore(Rd).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>a.close()}else{let l=Es(r),c=a.transaction(nu,"readwrite"),u=c.objectStore(nu),d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l}),p;d.onsuccess=()=>{p=a.transaction(Rd,"readwrite");let m=p.objectStore(Rd).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l});m.onsuccess=()=>o({modelArtifactsInfo:l}),m.onerror=h=>{u=c.objectStore(nu);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(m.error)),g.onerror=x=>(a.close(),i(m.error))}},d.onerror=f=>(a.close(),i(d.error)),c.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return t.URL_SCHEME="indexeddb://",t})(),s3=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Md.URL_SCHEME)?gle(t.slice(Md.URL_SCHEME.length)):null;jn.registerSaveRouter(s3);jn.registerLoadRouter(s3);function gle(t){return new Md(t)}function yle(t){return t.startsWith(Md.URL_SCHEME)?t.slice(Md.URL_SCHEME.length):t}var mw=class{constructor(){this.indexedDB=i3()}async listModels(){return new Promise((n,e)=>{let r=this.indexedDB.open(UD,jD);r.onupgradeneeded=()=>GD(r),r.onsuccess=()=>{let o=r.result,i=o.transaction(nu,"readonly"),a=i.objectStore(nu).getAll();a.onsuccess=()=>{let l={};for(let c of a.result)l[c.modelPath]=c.modelArtifactsInfo;n(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})}async removeModel(n){return n=yle(n),new Promise((e,r)=>{let o=this.indexedDB.open(UD,jD);o.onupgradeneeded=()=>GD(o),o.onsuccess=()=>{let i=o.result,s=i.transaction(nu,"readwrite"),a=s.objectStore(nu),l=a.get(n),c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${n}' in IndexedDB.`));{let u=a.delete(n),d=()=>{c=i.transaction(Rd,"readwrite");let f=c.objectStore(Rd).delete(n);f.onsuccess=()=>e(l.result.modelArtifactsInfo),f.onerror=m=>r(l.error)};u.onsuccess=d,u.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=u=>(i.close(),r(l.error)),s.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})}};var cl="/",vm="tensorflowjs_models",a3="info",vle="model_topology",xle="weight_specs",ble="weight_data",wle="model_metadata";function l3(t){return{info:[vm,t,a3].join(cl),topology:[vm,t,vle].join(cl),weightSpecs:[vm,t,xle].join(cl),weightData:[vm,t,ble].join(cl),modelMetadata:[vm,t,wle].join(cl)}}function Cle(t){let n=t.split(cl);if(n.length<3)throw new Error(`Invalid key format: ${t}`);return n.slice(1,n.length-1).join(cl)}function _le(t){return t.startsWith(Fd.URL_SCHEME)?t.slice(Fd.URL_SCHEME.length):t}var Fd=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=l3(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=Es(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,JV(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=e3(a),r}}return t.URL_SCHEME="localstorage://",t})(),c3=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Fd.URL_SCHEME)?Ile(t.slice(Fd.URL_SCHEME.length)):null;jn.registerSaveRouter(c3);jn.registerLoadRouter(c3);function Ile(t){return new Fd(t)}var hw=class{constructor(){F(H().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),F(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let n={},e=vm+cl,r=cl+a3;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=Cle(i);n[s]=JSON.parse(this.LS.getItem(i))}}return n}async removeModel(n){n=_le(n);let e=l3(n);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${n}'`);let r=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),r}};var xm="://",Gi=class t{constructor(){this.managers={}}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerManager(n,e){F(n!=null,()=>"scheme must not be undefined or null."),n.endsWith(xm)&&(n=n.slice(0,n.indexOf(xm))),F(n.length>0,()=>"scheme must not be an empty string.");let r=t.getInstance();F(r.managers[n]==null,()=>`A model store manager is already registered for scheme '${n}'.`),r.managers[n]=e}static getManager(n){let e=this.getInstance().managers[n];if(e==null)throw new Error(`Cannot find model manager for scheme '${n}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}};function gw(t){if(t.indexOf(xm)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Gi.getSchemes().join(",")}`);return{scheme:t.split(xm)[0],path:t.split(xm)[1]}}async function u3(t,n,e=!1){F(t!==n,()=>`Old path and new path are the same: '${t}'`);let r=jn.getLoadHandlers(t);F(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),F(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);let o=r[0],i=jn.getSaveHandlers(n);F(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${n}.`),F(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${n}.`);let s=i[0],a=gw(t).scheme,l=gw(t).path,c=a===gw(t).scheme,u=await o.load();e&&c&&await Gi.getManager(a).removeModel(l);let d=await s.save(u);return e&&!c&&await Gi.getManager(a).removeModel(l),d.modelArtifactsInfo}async function d3(){let t=Gi.getSchemes(),n={};for(let e of t){let r=await Gi.getManager(e).listModels();for(let o in r){let i=e+xm+o;n[i]=r[o]}}return n}async function p3(t){let n=gw(t);return Gi.getManager(n.scheme).removeModel(n.path)}async function f3(t,n){return u3(t,n,!1)}async function m3(t,n){return u3(t,n,!0)}var WD=class{fetch(n,e){return fetch(n,e)}now(){return performance.now()}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)}decode(n,e){return new TextDecoder(e).decode(n)}};if(H().get("IS_BROWSER")){H().setPlatform("browser",new WD);try{Gi.registerManager(Fd.URL_SCHEME,new hw)}catch{}try{Gi.registerManager(Md.URL_SCHEME,new mw)}catch{}}var Sle={importFetch:()=>g3()},HD;var qD=class{constructor(){this.util=y3(),this.textEncoder=new this.util.TextEncoder}fetch(n,e){return H().global.fetch!=null?H().global.fetch(n,e):(HD==null&&(HD=Sle.importFetch()),HD(n,e))}now(){let n=process.hrtime();return n[0]*1e3+n[1]/1e6}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(n)}decode(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)}};H().get("IS_NODE")&&H().setPlatform("node",new qD);function Te(t,n="float32",e){return n=n||"float32",ry(t),new Mt(t,n,e)}function Tle(t,n){let e=N(t,"x","cast");if(!SD(n))throw new Error(`Failed to cast to unknown dtype ${n}`);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:n};return k.runKernel(ws,r,o)}var pe=A({cast_:Tle});function Dle(t){let e={x:N(t,"x","clone","string_or_numeric")};return k.runKernel(Cs,e)}var Wi=A({clone_:Dle});function v3(t,n=!1){console.log(t.toString(n))}$D();var Nle={buffer:Te,cast:pe,clone:Wi,print:v3};UV(Nle);var ai={};rs(ai,{browserFiles:()=>b3,browserHTTPRequest:()=>I3,concatenateArrayBuffers:()=>ym,copyModel:()=>f3,decodeWeights:()=>fw,encodeWeights:()=>QV,fromMemory:()=>E3,getLoadHandlers:()=>o3,getModelArtifactsInfoForJSON:()=>Es,getSaveHandlers:()=>r3,http:()=>vw,isHTTPScheme:()=>yw,listModels:()=>d3,loadWeights:()=>w3,moveModel:()=>m3,registerLoadRouter:()=>n3,registerSaveRouter:()=>t3,removeModel:()=>p3,weightsLoaderFactory:()=>QD,withSaveHandler:()=>S3});var kle="model",Ale=".json",Rle=".weights.bin";function x3(t){return new Promise(n=>setTimeout(n)).then(t)}var KD=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),(e==null||e.length===0)&&(e=kle),this.modelTopologyFileName=e+Ale,this.weightDataFileName=e+Rle}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer);let s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=s,await x3(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await x3(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Es(e)}}}}return t.URL_SCHEME="downloads://",t})(),XD=class{constructor(n){if(n==null||n.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${n}`);this.files=n}async load(){let n=this.files[0],e=this.files.slice(1);return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=JSON.parse(s.target.result),l=a.modelTopology;if(l==null){o(new Error(`modelTopology field is missing from file ${n.name}`));return}e.length===0&&r({modelTopology:l});let c=a.weightsManifest;if(c==null){o(new Error(`weightManifest field is missing from file ${n.name}`));return}let u;try{u=this.checkManifestAndWeightFiles(c,e)}catch(m){o(m);return}let d=[],p=[],f=[];c.forEach(m=>{m.paths.forEach(h=>{p.push(h),f.push(null)}),d.push(...m.weights)}),c.forEach(m=>{m.paths.forEach(h=>{let g=new FileReader;g.onload=x=>{let b=x.target.result,I=p.indexOf(h);if(f[I]=b,f.indexOf(null)===-1){let _={modelTopology:l,weightSpecs:d,weightData:ym(f),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};a.signature!=null&&(_.signature=a.signature),a.userDefinedMetadata!=null&&(_.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(_.modelInitializer=a.modelInitializer),r(_)}},g.onerror=x=>o(`Failed to weights data from file of path '${h}'.`),g.readAsArrayBuffer(u[h])})})},i.onerror=s=>o(`Failed to read model topology and weights manifest JSON from file '${n.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(n)})}checkManifestAndWeightFiles(n,e){let r=[],o=e.map(s=>zD(s.name)),i={};for(let s of n)s.paths.forEach(a=>{let l=zD(a);if(r.indexOf(l)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${l}'`);if(r.push(l),o.indexOf(l)===-1)throw new Error(`Weight file with basename '${l}' is not provided.`);i[a]=e[o.indexOf(l)]});if(r.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${e.length}).`);return i}},Mle=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(KD.URL_SCHEME)?Fle(t.slice(KD.URL_SCHEME.length)):null;jn.registerSaveRouter(Mle);function Fle(t="model"){return new KD(t)}function b3(t){return new XD(t)}function YD(t,n,e,r){s(t),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(c=>{let u=e+ ++o/t.length*(r-e);return n(u),c}),l);function s(l){F(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){F(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),F(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),F(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}async function ZD(t,n){n==null&&(n={});let e=n.fetchFunc==null?H().platform.fetch:n.fetchFunc,r=t.map(d=>e(d,n.requestInit,{isBinary:!0})),a=(n.onProgress==null?await Promise.all(r):await YD(r,n.onProgress,0,.5)).map(d=>d.arrayBuffer());return n.onProgress==null?await Promise.all(a):await YD(a,n.onProgress,.5,1)}async function w3(t,n="",e,r){return QD(s=>ZD(s,{requestInit:r}))(t,n,e)}function QD(t){return async(n,e="",r)=>{let o=n.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(n.forEach((f,m)=>{let h=0;f.weights.forEach(g=>{let x="quantization"in g?g.quantization.dtype:g.dtype,b=py[x]*$t(g.shape),I=()=>{o[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:g,groupOffset:h,sizeBytes:b})};r!=null?r.forEach((_,E)=>{_===g.name&&(I(),s[E]=!0)}):I(),a.push(g.name),h+=b})}),!s.every(f=>f)){let f=r.filter((m,h)=>!s[h]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((f,m,h)=>(m&&f.push(h),f),[]),c=[];l.forEach(f=>{n[f].paths.forEach(m=>{let h=e+(e.endsWith("/")?"":"/")+m;c.push(h)})});let u=await t(c),d={},p=0;return l.forEach(f=>{let m=n[f].paths.length,h=0;for(let _=0;_<m;_++)h+=u[p+_].byteLength;let g=new ArrayBuffer(h),x=new Uint8Array(g),b=0;for(let _=0;_<m;_++){let E=new Uint8Array(u[p+_]);x.set(E,b),b+=E.byteLength}i[f].forEach(_=>{let E=g.slice(_.groupOffset,_.groupOffset+_.sizeBytes),S=fw(E,[_.manifestEntry]);for(let D in S)d[D]=S[D]}),p+=m}),d}}var Ole="application/octet-stream",Ple="application/json",C3=(()=>{class t{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(F(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=H().platform.fetch,F(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&F(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(i)],{type:Ple}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:Ole}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:Es(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let g=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?g+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":g+=" Please make sure the server is serving valid JSON for this request.",new Error(g)}let o=r.modelTopology,i=r.weightsManifest,s=r.generatedBy,a=r.convertedBy,l=r.format,c=r.signature,u=r.userDefinedMetadata;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let d,p;i!=null&&([d,p]=await this.loadWeights(i));let f={modelTopology:o,weightSpecs:d,weightData:p,generatedBy:s,convertedBy:a,format:l};c!=null&&(f.signature=c),u!=null&&(f.userDefinedMetadata=u);let m=r.modelInitializer;return m&&(f.modelInitializer=m),f}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=Lle(r),s=this.weightPathPrefix||o,a=[];for(let d of e)a.push(...d.weights);let l=[],c=[];for(let d of e)for(let p of d.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(p)):l.push(s+p+i);this.weightUrlConverter&&l.push(...await Promise.all(c));let u=await ZD(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,ym(u)]}}return t.URL_SCHEME_REGEX=/^https?:\/\//,t})();function Lle(t){let n=t.lastIndexOf("/"),e=t.lastIndexOf("?"),r=t.substring(0,n),o=e>n?t.substring(e):"";return[r+"/",o]}function yw(t){return t.match(C3.URL_SCHEME_REGEX)!=null}var _3=(t,n)=>{if(typeof fetch>"u"&&(n==null||n.fetchFunc==null))return null;{let e=!0;if(Array.isArray(t)?e=t.every(r=>yw(r)):e=yw(t),e)return vw(t,n)}return null};jn.registerSaveRouter(_3);jn.registerLoadRouter(_3);function vw(t,n){return new C3(t,n)}function I3(t,n){return vw(t,n)}var fy=class{constructor(n){this.modelArtifacts=n}async load(){return this.modelArtifacts}},JD=class{constructor(n){this.saveHandler=n}async save(n){return this.saveHandler(n)}};function E3(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new fy(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new fy({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new fy({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))}function S3(t){return new JD(t)}function $le(t,n,e=!1,r=!1){let o=N(t,"a","matMul"),i=N(n,"b","matMul");[o,i]=Qe(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return k.runKernel(pc,s,a)}var It=A({matMul_:$le});function Vle(t,n,e=1,r=0){if(n<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${n}`);let i={indices:N(t,"indices","oneHot","int32")},s={depth:n,onValue:e,offValue:r};return k.runKernel(Oc,i,s)}var wm=A({oneHot_:Vle});function Ble(t,n){let e=N(t,"x","transpose");if(n==null&&(n=e.shape.map((i,s)=>s).reverse()),F(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of perm ${n}.`),n.forEach(i=>{F(i>=0&&i<e.rank,()=>`All entries in 'perm' must be between 0 and ${e.rank-1} but got ${n}`)}),e.rank<=1)return e.clone();let r={x:e},o={perm:n};return k.runKernel(Xc,r,o)}var at=A({transpose_:Ble});function zle(t,n){let e=t.shape.length,r=n.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(n.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${n.shape[r-1]} vs. ${e}`);if($t(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=n.shape,i=o[o.length-1],s=1;for(let d=0;d<o.length-1;++d)s*=o[d];let a=t.shape,l=o.slice();l.pop();let c=1;for(let d=i;d<e;++d)c*=a[d],l.push(a[d]);let u=[...bs(t.shape).map(d=>d/c),1].slice(0,i);return[l,s,c,u]}function T3(t,n,e){let r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${n.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(t.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+t.length-r)throw new Error(i+` update.rank != ${o+t.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==n.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${n.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==t[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${t[s+o]})`)}function Ule(t,n,e){if(n.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${n.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(n.size===0)throw new Error(`Indices specified for empty output. indices shape: ${n.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}T3(e,n,t)}function jle(t,n,e){let r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,s=1;for(let d=o;d<i;++d)s*=e[d];let a=o<1?1:o,l=$t(n.shape)/a,c=[...bs(e.slice(0,o)),1],u=$t(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}var ar={};rs(ar,{assertParamsValid:()=>Gle,computeFlatOffset:()=>Hle,computeOutShape:()=>D3,getNormalizedAxes:()=>R3,isSliceContinous:()=>Wle,maskToAxes:()=>xw,parseSliceParams:()=>eN,sliceInfo:()=>qle,startForAxis:()=>P3,startIndicesWithElidedDims:()=>M3,stopForAxis:()=>L3,stopIndicesWithElidedDims:()=>F3,stridesForAxis:()=>O3,stridesWithElidedDims:()=>N3});function Gle(t,n,e){let r=t.shape.length;F(r===n.length,()=>`Error in slice${r}D: Length of begin ${n} must match the rank of the array (${r}).`),F(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)F(n[o]+e[o]<=t.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${n[o]+e[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function xw(t){let n=[],e=0;for(;t>0;)t&1&&n.push(e),t/=2,e++;return n}function D3(t,n,e){let r=[];for(let o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function N3(t,n,e,r){let o=[...t];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[n]=1:(o.splice(n,0,1),o.pop());return o}function k3(t,n,e){return e<=t?e:e-(n-1)}function A3(t,n){let e=[];for(let r=0;r<t;r++)e.push(n+r);return e}function R3(t,n,e,r,o,i,s,a,l){let c=t.length,u=new Array(c),d=new Array(c),p=new Array(c);if(n.length&&e>0){let f=n[0],m=e+1;u=M3(s,f,m,r,t),d=F3(a,f,m,o,t),p=N3(i,f,m,t)}else for(let f=0;f<c;f++)u[f]=P3(s,r,i,t,f,l),d[f]=L3(a,o,i,t,f,l),p[f]=O3(i,f,l);return{begin:u,end:d,strides:p}}function M3(t,n,e,r,o){let i=[...o],s=A3(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=k3(n,e,a),c=r[l];t&1<<l&&(c=0),i[a]=c}return i}function F3(t,n,e,r,o){let i=[...o],s=A3(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=k3(n,e,a),c=r[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=Rf(0,i[a],o[a])}return i}function O3(t,n,e){let r=t[n];return(e&1<<n||r==null)&&(r=1),r}function P3(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=Rf(0,s,l-1),s}function L3(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=Rf(0,s,l):s=Rf(-1,s,l-1),s}function Wle(t,n,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function Hle(t,n){let e=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function eN(t,n,e){let r,o=t.shape.length;typeof n=="number"?r=[n,...new Array(o-1).fill(0)]:n.length<o?r=n.concat(new Array(o-n.length).fill(0)):r=n.slice(),r.forEach(s=>{F(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(F(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function qle(t,n,e,r,o,i,s,a,l){let c=n.slice(),u=e.slice(),d=r;r==null&&(d=new Array(c.length));let p=xw(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(s!==0&&a!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(s!==0&&l!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let f=t.length-c.length,m=xw(a),h=t.slice();m.forEach(D=>{c[D]=0,u[D]=1,h.splice(D,0,1)});let{begin:g,end:x,strides:b}=R3(h,p,f,c,u,d,o,i,s);c=g,u=x,d=b;let I=xw(l);I.forEach(D=>{u[D]=c[D]+1,d[D]=1});let _=D3(c,u,d),E=_.filter((D,M)=>I.indexOf(M)===-1);return{nonStrided:d.every(D=>D===1),$begin:c,$end:u,$strides:d,size:_,newShape:h,outShape:E}}var Q={};rs(Q,{Serializable:()=>my,SerializationMap:()=>bw,registerClass:()=>Hr});var my=class{getClassName(){return this.constructor.className}static fromConfig(n,e){return new n(e)}},bw=class t{constructor(){this.classNameMap={}}static getMap(){return t.instance==null&&(t.instance=new t),t.instance}static register(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]}};function Hr(t){F(t.className!=null,()=>"Class being registered does not have the static className property defined."),F(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),F(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),bw.register(t)}function Kle(t){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}jV(Kle);function ul(){return k}function hy(){return k.memory()}function j(t,n){return k.tidy(t,n)}function Pe(t){cw(t).forEach(e=>e.dispose())}function Gn(t){return k.keep(t)}function ww(t,n,e=1){return k.registerBackend(t,n,e)}function $3(){return k.backend}function Xle(t,n){let e=N(t,"a","add"),r=N(n,"b","add");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(zi,o)}var oe=A({add_:Xle});function Yle(t,n){let e=N(t,"a","floorDiv"),r=N(n,"b","floorDiv");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(Ma,o)}var Cw=A({floorDiv_:Yle});function Zle(t,n){let e=N(t,"a","div"),r=N(n,"b","div");if([e,r]=Qe(e,r),e.dtype==="int32"&&r.dtype==="int32")return Cw(e,r);let o={a:e,b:r},i={};return k.runKernel(Ta,o,i)}var ye=A({div_:Zle});function Qle(t,n){let e=N(t,"a","mul"),r=N(n,"b","mul");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(ja,o)}var V=A({mul_:Qle});function Jle(t){let n=N(t,"x","abs");if(n.dtype==="complex64"){let e={x:n};return k.runKernel(mc,e)}else{let e={x:n};return k.runKernel(ac,e)}}var An=A({abs_:Jle});function ece(t){let e={x:N(t,"x","acos")};return k.runKernel(ga,e)}var tN=A({acos_:ece});function tce(t){let e={x:N(t,"x","acosh")};return k.runKernel(ya,e)}var nN=A({acosh_:tce});function nce(t,n=null,e=!1){let o={x:N(t,"x","all","bool")},i={axis:n,keepDims:e};return k.runKernel(Vf,o,i)}var gy=A({all_:nce});function rce(t,n=null,e=!1){let o={x:N(t,"x","any","bool")},i={axis:n,keepDims:e};return k.runKernel(Bf,o,i)}var Cm=A({any_:rce});function oce(t,n=0){let r={x:N(t,"x","argMax")},o={axis:n};return k.runKernel(lc,r,o)}var _m=A({argMax_:oce});function ice(t,n=0){let r={x:N(t,"x","argMin")},o={axis:n};return k.runKernel(cc,r,o)}var V3=A({argMin_:ice});function sce(t){let e={x:N(t,"x","asin")};return k.runKernel(va,e)}var rN=A({asin_:sce});function ace(t){let e={x:N(t,"x","asinh")};return k.runKernel(xa,e)}var oN=A({asinh_:ace});function lce(t){let e={x:N(t,"x","atan")};return k.runKernel(ba,e)}var iN=A({atan_:lce});function cce(t,n){let e=N(t,"a","atan2"),r=N(n,"b","atan2");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(Ca,o)}var B3=A({atan2_:cce});function uce(t){let e={x:N(t,"x","atanh")};return k.runKernel(wa,e)}var sN=A({atanh_:uce});function dce(t,n,e,r,o="NHWC",i){let s=t[3],a=[...n,s],l=U3(o);return Ld(t,a,e,i,r,null,null,l)}function lN(t,n,e,r,o,i,s="channelsLast"){let[a,l]=_w(n),c;if(s==="channelsLast")c=[a,l,t[3],t[3]];else if(s==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return Ld(t,c,e,r,o,i,!1,s)}function pce(t,n,e,r,o,i,s="NDHWC"){let[a,l,c]=aN(n),u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return z3(t,u,e,r,o,!1,d,i)}function Ld(t,n,e,r,o,i,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);let[p,f,,m]=n,[h,g]=_w(e),[x,b]=_w(r),I=Im(p,x),_=Im(f,b),{padInfo:E,outHeight:S,outWidth:D}=hce(o,c,u,h,g,I,_,i,a),M=s?m*d:m,R;return a==="channelsFirst"?R=[l,M,S,D]:a==="channelsLast"&&(R=[l,S,D,M]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:S,outWidth:D,outChannels:M,padInfo:E,strideHeight:h,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:I,effectiveFilterWidth:_,dilationHeight:x,dilationWidth:b,inShape:t,outShape:R,filterShape:n}}function z3(t,n,e,r,o,i=!1,s="channelsLast",a){let[l,c,u,d,p]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,p]=t;else if(s==="channelsFirst")[l,p,c,u,d]=t;else throw new Error(`Unknown dataFormat ${s}`);let[f,m,h,,g]=n,[x,b,I]=aN(e),[_,E,S]=aN(r),D=Im(f,_),M=Im(m,E),R=Im(h,S),{padInfo:L,outDepth:G,outHeight:W,outWidth:q}=gce(o,c,u,d,x,b,I,D,M,R,a),X=i?g*p:g,K;return s==="channelsFirst"?K=[l,X,G,W,q]:s==="channelsLast"&&(K=[l,G,W,q,X]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:p,outDepth:G,outHeight:W,outWidth:q,outChannels:X,padInfo:L,strideDepth:x,strideHeight:b,strideWidth:I,filterDepth:f,filterHeight:m,filterWidth:h,effectiveFilterDepth:D,effectiveFilterHeight:M,effectiveFilterWidth:R,dilationDepth:_,dilationHeight:E,dilationWidth:S,inShape:t,outShape:K,filterShape:n}}function fce(t,n,e,r,o){r==null&&(r=cN(t,n,e));let i=t[0],s=t[1],a=Pd((i-n+2*r)/e+1,o),l=Pd((s-n+2*r)/e+1,o);return[a,l]}function mce(t,n,e,r,o,i){o==null&&(o=cN(t,n,r));let s=t[0],a=t[1],l=t[2],c=Pd((s-n+2*o)/r+1,i),u=Pd((a-n+2*o)/r+1,i),d=Pd((l-n+2*o)/r+1,i);return[c,u,d,e]}function cN(t,n,e,r=1){let o=Im(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function _w(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function aN(t){return typeof t=="number"?[t,t,t]:t}function Im(t,n){return n<=1?t:t+(t-1)*(n-1)}function hce(t,n,e,r,o,i,s,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let f=fce([n,e],i,r,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(n/r),d=Math.ceil(e/o);let p=Math.max(0,(u-1)*r+i-n),f=Math.max(0,(d-1)*o+s-e),m=Math.floor(p/2),h=p-m,g=Math.floor(f/2),x=f-g;c={top:m,bottom:h,left:g,right:x,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((n-i+1)/r),d=Math.ceil((e-s+1)/o);else if(typeof t=="object"){let p=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];c={top:p,bottom:f,left:m,right:h,type:p===0&&f===0&&m===0&&h===0?"VALID":"EXPLICIT"},u=Pd((n-i+p+f)/r+1,a),d=Pd((e-s+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function gce(t,n,e,r,o,i,s,a,l,c,u){let d,p,f,m;if(typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=mce([n,e,r,1],a,1,o,t,u);p=g[0],f=g[1],m=g[2]}else if(t==="same"){p=Math.ceil(n/o),f=Math.ceil(e/i),m=Math.ceil(r/s);let h=(p-1)*o+a-n,g=(f-1)*i+l-e,x=(m-1)*s+c-r,b=Math.floor(h/2),I=h-b,_=Math.floor(g/2),E=g-_,S=Math.floor(x/2),D=x-S;d={top:_,bottom:E,left:S,right:D,front:b,back:I,type:"SAME"}}else if(t==="valid")d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((n-a+1)/o),f=Math.ceil((e-l+1)/i),m=Math.ceil((r-c+1)/s);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:p,outHeight:f,outWidth:m}}function Pd(t,n){if(!n)return Math.trunc(t);switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${n}`)}}function Lo(t){let[n,e,r]=_w(t);return n===1&&e===1&&r===1}function Zn(t,n){return Lo(t)||Lo(n)}function U3(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function yce(t,n){let r={x:N(t,"x","reshape","string_or_numeric")},o={shape:n};return k.runKernel(Vc,r,o)}var B=A({reshape_:yce});function vce(t,n,e,r,o){let i=N(t,"x","avgPool","float32"),s=1;F(Zn(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),o!=null&&F(_t(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(uc,c,u);return d=pe(d,i.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var $d=A({avgPool_:vce});function xce(t,n,e,r,o,i="NDHWC"){let s=N(t,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),F(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&F(_t(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(dc,c,u);return d=pe(d,a.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var uN=A({avgPool3d_:xce});function bce(t,n=0){F(t.length>=1,()=>"Pass at least one tensor to concat");let e=dw(t,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Wi(e[0]);let r=e,o={axis:n};return k.runKernel(hc,r,o)}var Gt=A({concat_:bce});function wce(t){let e={x:N(t,"x","sigmoid")};return k.runKernel(el,e)}var li=A({sigmoid_:wce});function Cce(t,n,e){let r=N(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:n,size:e};return k.runKernel(Gc,o,i)}var lt=A({slice_:Cce});function _ce(t){let e={x:N(t,"x","tanh")};return k.runKernel(sl,e)}var Em=A({tanh_:_ce});function Ice(t,n,e){let r=N(t,"x","batchToSpaceND"),o=n.reduce((a,l)=>a*l);F(r.rank>=1+n.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${n.length}`),F(e.length===n.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${n.length}`),F(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${n.join(" * ")} === ${o}`);let i={x:r},s={blockShape:n,crops:e};return k.runKernel(fc,i,s)}var Sm=A({batchToSpaceND_:Ice});function j3(t){let n;return t.rank===0||t.rank===1?n=B(t,[1,1,1,t.size]):t.rank===2?n=B(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?n=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]):n=t,n}function Ece(t,n,e,r,o,i){i==null&&(i=.001);let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;r!=null&&(u=N(r,"offset","batchNorm")),F(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:j3(s),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},m=k.runKernel(_c,p,f);return B(m,s.shape)}var ru=A({batchNorm_:Ece});function Sce(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),F(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),F(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),F(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),ru(s,a,l,u,c,i)}var dN=A({batchNorm2d_:Sce});function Tce(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),F(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),F(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),F(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),ru(s,a,l,u,c,i)}var pN=A({batchNorm3d_:Tce});function Dce(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),F(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),F(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),F(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),ru(s,a,l,u,c,i)}var fN=A({batchNorm4d_:Dce});function Nce(t,n){let e=N(t,"broadcastTo","x"),r=e.shape;if(n.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${n}].`);if(n.length<e.rank)throw new Error(`broadcastTo(): shape.length=${n.length} < input.rank=${e.rank}.`);if(n.length>e.rank){let c=e.shape.slice();for(;c.length<n.length;)c.unshift(1);e=B(e,c)}let o=e.shape,i=Array.from(n);for(let c=n.length-1;c>=0;c--)if(o[c]===n[c])i[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${n}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Wi(e);let a={x:e},l={reps:i};return k.runKernel(_s,a,l)}var Tm=A({broadcastTo_:Nce});function kce(t){let e={x:N(t,"x","ceil")};return k.runKernel(_a,e)}var mN=A({ceil_:kce});function Ace(t,n,e){let r=N(t,"x","clipByValue");F(n<=e,()=>`Error in clip: min (${n}) must be less than or equal to max (${e}).`);let o={x:r},i={clipValueMin:n,clipValueMax:e};return k.runKernel(Ia,o,i)}var Qn=A({clipByValue_:Ace});function Rce(t){return Gt(t,0)}var hN=A({concat1d_:Rce});function Mce(t,n){return Gt(t,n)}var gN=A({concat2d_:Mce});function Fce(t,n){return Gt(t,n)}var yN=A({concat3d_:Fce});function Oce(t,n){return Gt(t,n)}var vN=A({concat4d_:Oce});function Pce(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","conv2d"),l=N(n,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),s!=null&&F(_t(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d=o==="NHWC"?c.shape[3]:c.shape[1];F(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),F(Zn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},m=k.runKernel(gc,p,f);return u?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var go=A({conv2d_:Pce});function Lce(t,n,e,r,o="NWC",i=1,s){let a=N(t,"x","conv1d"),l=N(n,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1]])),F(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),F(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),s!=null&&F(_t(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),F(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),F(Zn(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),F(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let d=B(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=B(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=go(p,d,[1,e],r,"NHWC",[1,i],s);return u?B(g,[g.shape[2],g.shape[3]]):B(g,[g.shape[0],g.shape[2],g.shape[3]])}var yy=A({conv1d_:Lce});function $ce(t,n,e,r,o,i="NHWC",s){F(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let a=t,l=n,c=!1;n.rank===3&&(c=!0,l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]),a=[1,t[0],t[1],t[2]]),F(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),F(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),F(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];F(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),F(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),s!=null&&F(_t(o),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let p={dy:l,filter:e},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},m=k.runKernel(yc,p,f);return c?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Dm=A({conv2DBackpropInput_:$ce});function Vce(t,n,e,r,o,i){let s=N(t,"x","conv2dTranspose"),a=N(n,"filter","conv2dTranspose");return Dm(e,s,a,r,o,"NHWC",i)}var vy=A({conv2dTranspose_:Vce});function Bce(t,n,e,r,o="NDHWC",i=[1,1,1]){let s=N(t,"x","conv3d"),a=N(n,"filter","conv3d"),l=s,c=!1;s.rank===4&&(c=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),F(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),F(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),F(Zn(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),F(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let u={x:l,filter:a},d={strides:e,pad:r,dataFormat:o,dilations:i},p=k.runKernel(vc,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var xN=A({conv3d_:Bce});function zce(t,n,e,r,o){F(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let i=t,s=n,a=!1;n.rank===4&&(a=!0,s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);let l=i[4],c=s.shape[4];F(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),F(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),F(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),F(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),F(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let u={dy:s,filter:e},d={pad:o,strides:r,inputShape:i},p=k.runKernel(Hf,u,d);return a?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Iw=A({conv3DBackpropInput_:zce});function Uce(t,n,e,r,o){let i=N(t,"x","conv3dTranspose"),s=N(n,"filter","conv3dTranspose");return Iw(e,i,s,r,o)}var bN=A({conv3dTranspose_:Uce});function jce(t){let e={x:N(t,"x","cos")};return k.runKernel(Ea,e)}var Vd=A({cos_:jce});function Gce(t){let e={x:N(t,"x","cosh")};return k.runKernel(Sa,e)}var xy=A({cosh_:Gce});function Wce(t,n=0,e=!1,r=!1){let i={x:N(t,"x","cumsum")},s={axis:n,exclusive:e,reverse:r};return k.runKernel(xc,i,s)}var Ew=A({cumsum_:Wce});function Hce(t,n,e="NHWC"){let r=N(t,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];F(o*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${n}  for depthToSpace with input shape
    ${r.shape}`),F(i*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${n} for depthToSpace with input shape
        ${r.shape}`),F(s%(n*n)===0,()=>`Dimension size must be evenly divisible by ${n*n} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:n,dataFormat:e};return k.runKernel(qf,a,l)}var G3=A({depthToSpace_:Hce});function qce(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","depthwiseConv2d"),l=N(n,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`),F(c.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),s!=null&&F(_t(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d={x:c,filter:l},p={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},f=k.runKernel(bc,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var pl=A({depthwiseConv2d_:qce});function Kce(t,n,e,r,o=[1,1],i="NHWC"){let s=N(t,"x","dilation2d"),a=N(n,"filter","dilation2d");F(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),F(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),F(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,c=!1;s.rank===3&&(l=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0);let u={x:l,filter:a},d={strides:e,pad:r,dilations:o},p=k.runKernel(wc,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var W3=A({dilation2d_:Kce});function Xce(t,n){let e=t.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=t[i]||1;(n[n.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function Vt(t,n){let e=[];for(let r=0;r<n.length;r++){let o=t[t.length-r-1],i=n.length-r-1,s=n[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function He(t,n){let e=[],r=Math.max(t.length,n.length);for(let o=0;o<r;o++){let i=t[t.length-o-1];i==null&&(i=1);let s=n[n.length-o-1];if(s==null&&(s=1),i===1)e.unshift(s);else if(s===1)e.unshift(i);else if(i!==s){let a=`Operands could not be broadcast together with shapes ${t} and ${n}.`;throw Error(a)}else e.unshift(i)}return e}function Yce(t,n){let e=N(t,"a","equal"),r=N(n,"b","equal");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(vd,o)}var ci=A({equal_:Yce});function Zce(t,n,e){let r=N(n,"a","where"),o=N(e,"b","where"),i=N(t,"condition","where","bool"),s=He(He(i.shape,r.shape),o.shape),a=Tm(i,s),l=Tm(r,s),c=Tm(o,s),u={condition:a,t:l,e:c};return k.runKernel(jc,u)}var fn=A({where_:Zce});function Qce(t){let e={x:N(t,"x","zerosLike")};return k.runKernel(Qc,e)}var De=A({zerosLike_:Qce});function Jce(t,n){let e=N(t,"a","div"),r=N(n,"b","div");[e,r]=Qe(e,r);let o=ye(e,r),i=De(o),s=ci(r,i);return fn(s,i,o)}var H3=A({divNoNan_:Jce});function eue(t,n){let e=N(t,"t1","dot"),r=N(n,"t2","dot");F((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(F(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=B(e,[1,-1]),a=B(r,[-1,1]),l=It(s,a);return B(l,[])}else if(e.rank===1&&r.rank===2){let s=B(e,[1,-1]),a=B(r,[r.shape[0],r.shape[1]]),l=It(s,a);return B(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=B(r,[-1,1]),a=It(e,s);return B(a,[a.size])}else{let s=B(r,[r.shape[0],r.shape[1]]);return It(e,s)}}var q3=A({dot_:eue});function tue(t){let e={x:N(t,"x","elu")};return k.runKernel(Da,e)}var fl=A({elu_:tue});function nue(t){let n=N(t,"x","erf");F(n.dtype==="int32"||n.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),n.dtype==="int32"&&(n=pe(n,"float32"));let e={x:n};return k.runKernel(Na,e)}var wN=A({erf_:nue});function rue(t){let e={x:N(t,"x","exp")};return k.runKernel(ka,e)}var Ar=A({exp_:rue});function oue(t,n=0){let e=N(t,"x","expandDims","string_or_numeric");F(n<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:n};return k.runKernel(Cc,r,o)}var lr=A({expandDims_:oue});function iue(t){let e={x:N(t,"x","expm1")};return k.runKernel(Aa,e)}var CN=A({expm1_:iue});function sue(t,n){let e=N(t,"x","tile","string_or_numeric");F(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${n}.`);let r={x:e},o={reps:n};return k.runKernel(_s,r,o)}var Hi=A({tile_:sue});function aue(t,n,e,r="float32"){n==null&&(n=t);let o=Te([t,n],r),i=t<=n?t:n;for(let a=0;a<i;++a)o.set(1,a,a);let s=B(o.toTensor(),[t,n]);if(e==null)return s;if(e.length===1)return Hi(lr(s,0),[e[0],1,1]);if(e.length===2)return Hi(lr(lr(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return Hi(lr(lr(lr(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var Nm=A({eye_:aue});function by(t,n,e){let r={shape:t,value:n,dtype:e};return k.runKernel(Qf,{},r)}function lue(t){let e={x:N(t,"x","floor")};return k.runKernel(Ra,e)}var ml=A({floor_:lue});function cue(t,n,e=0,r=0){let o=N(t,"x","gather"),i=N(n,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return k.runKernel(Ic,s,a)}var Bd=A({gather_:cue});function uue(t,n){let e=N(t,"a","greater"),r=N(n,"b","greater");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(xd,o)}var Jn=A({greater_:uue});function due(t,n){let e=N(t,"a","greaterEqual"),r=N(n,"b","greaterEqual");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Fa,o)}var $o=A({greaterEqual_:due});function pue(t){let e={input:N(t,"input","imag")};return k.runKernel(em,e)}var Sw=A({imag_:pue});function fue(t){let e={x:N(t,"x","isFinite")};return k.runKernel(Oa,e)}var _N=A({isFinite_:fue});function mue(t){let e={x:N(t,"x","isInf")};return k.runKernel(Pa,e)}var IN=A({isInf_:mue});function hue(t){let e={x:N(t,"x","isNaN")};return k.runKernel(La,e)}var EN=A({isNaN_:hue});function gue(t,n=.2){let r={x:N(t,"x","leakyRelu")},o={alpha:n};return k.runKernel(Ec,r,o)}var zd=A({leakyRelu_:gue});function yue(t,n){let e=N(t,"a","less"),r=N(n,"b","less");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(bd,o)}var Tw=A({less_:yue});function vue(t,n){let e=N(t,"a","lessEqual"),r=N(n,"b","lessEqual");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(wd,o)}var Ss=A({lessEqual_:vue});function xue(t,n=5,e=1,r=1,o=.5){let i=N(t,"x","localResponseNormalization");F(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),F(_t(n),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${n}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=B(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},c={depthRadius:n,bias:e,alpha:r,beta:o},u=k.runKernel(Sc,l,c);return a?B(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var K3=A({localResponseNormalization_:xue});function bue(t){let e={x:N(t,"x","log")};return k.runKernel($a,e)}var Rr=A({log_:bue});function wue(t){let e={x:N(t,"x","log1p")};return k.runKernel(Va,e)}var SN=A({log1p_:wue});function TN(t,n){F(Of(t),()=>"The f passed in variableGrads(f) must be a function"),F(n==null||Array.isArray(n)&&n.every(c=>c instanceof ll),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=n!=null;if(!e){n=[];for(let c in k.registeredVariables)n.push(k.registeredVariables[c])}let r=e?n.filter(c=>!c.trainable):null,o=n.length;n=n.filter(c=>c.trainable),F(n.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=k.gradients(t,n,null,i);F(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),F(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return n.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:s,grads:l}}function Vo(t){return k.customGrad(t)}function Cue(t){let e={x:N(t,"x","neg")};return k.runKernel(Mc,e)}var Et=A({neg_:Cue});function _ue(t){let e={x:N(t,"x","softplus")};return k.runKernel(tl,e)}var Ts=A({softplus_:_ue});function Iue(t){let n=N(t,"x","logSigmoid");return Vo(r=>({value:Et(Ts(Et(r))),gradFunc:s=>V(s,li(Et(r)))}))(n)}var DN=A({logSigmoid_:Iue});function Eue(t,n=null,e=!1){let o={x:N(t,"x","max")},i={reductionIndices:n,keepDims:e};return k.runKernel(Tc,o,i)}var er=A({max_:Eue});function Sue(t,n){let e=N(t,"a","sub"),r=N(n,"b","sub");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(ol,o)}var Se=A({sub_:Sue});function Tue(t,n=null,e=!1){let r=N(t,"x","sum");r.dtype==="bool"&&(r=pe(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(Wc,o,i)}var Ce=A({sum_:Tue});function Due(t,n=-1){let e=N(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${n}`);return Vo((o,i)=>{let a=er(o,n,!0),l=Se(o,a),c=Se(pe(l,"float32"),Rr(Ce(Ar(l),n,!0)));return i([c]),{value:c,gradFunc:(d,p)=>{let[f]=p,m=!0,h=Ar(f);return Se(d,V(Ce(d,n,m),h))}}})(e)}var wy=A({logSoftmax_:Due});function NN(t,n){for(let e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function X3(t,n,e){let r=t.length+n.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(t[i++]):o.push(n[s++]);return o}function kN(t,n){let e=[],r=t.length;for(let i=0;i<r;i++)n.indexOf(i)===-1&&e.push(t[i]);let o=n.map(i=>t[i]);return[e,o]}function Ds(t,n){let e=n.map(r=>1);return X3(t,e,n)}function Nue(t,n,e){F(NN(n,e),()=>`${t} supports only inner-most axes for now. Got axes ${n} and rank-${e} input.`)}function AN(t,n){if(NN(t,n))return null;let e=[];for(let r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(r=>e.push(r)),e}function Cy(t){return t.map((n,e)=>[e,n]).sort((n,e)=>n[1]-e[1]).map(n=>n[0])}function kue(t,n){let e=[];for(let r=n-t;r<n;++r)e.push(r);return e}function Aue(t,n=null,e=!1){let r=N(t,"x","logSumExp"),o=kn(n,r.shape),i=er(r,o,!0),s=Se(r,i),a=Ar(s),l=Ce(a,o),c=Rr(l),u=oe(B(i,c.shape),c);if(e){let d=Ds(u.shape,o);return B(u,d)}return u}var Y3=A({logSumExp_:Aue});function Rue(t,n){let e=N(t,"a","logicalAnd","bool"),r=N(n,"b","logicalAnd","bool");He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Cd,o)}var _r=A({logicalAnd_:Rue});function Mue(t){let e={x:N(t,"x","logicalNot","bool")};return k.runKernel(_d,e)}var km=A({logicalNot_:Mue});function Fue(t,n){let e=N(t,"a","logicalOr","bool"),r=N(n,"b","logicalOr","bool");He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Id,o)}var Dw=A({logicalOr_:Fue});function Oue(t,n){let e=N(t,"a","logicalXor","bool"),r=N(n,"b","logicalXor","bool");return He(e.shape,r.shape),_r(Dw(t,n),km(_r(t,n)))}var Z3=A({logicalXor_:Oue});function Pue(t,n,e,r,o){let i=N(t,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),F(Zn(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),o!=null&&F(_t(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(Dc,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Ud=A({maxPool_:Pue});function Lue(t,n=[1,1,1],e,r,o,i="NDHWC"){let s=N(t,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),F(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&F(_t(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(Nc,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var MN=A({maxPool3d_:Lue});function $ue(t,n){let e=N(t,"a","maximum"),r=N(n,"b","maximum");[e,r]=Qe(e,r),e.dtype==="bool"&&(e=pe(e,"int32"),r=pe(r,"int32")),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Ba,o)}var yo=A({maximum_:$ue});function Vue(t,n=null,e=!1){let o={x:N(t,"x","mean")},i={axis:n,keepDims:e};return k.runKernel(kc,o,i)}var qt=A({mean_:Vue});function Wt(t,n="float32"){if(n==="complex64"){let r=Wt(t,"float32"),o=Wt(t,"float32");return ji(r,o)}let e=Lf($t(t),n);return k.makeTensor(e,t,n)}function vo(t,n="float32"){if(n==="complex64"){let r=vo(t,"float32"),o=Wt(t,"float32");return ji(r,o)}let e=ny($t(t),n);return k.makeTensor(e,t,n)}function Bue(t,n=null,e=!1){let o={x:N(t,"x","min")},i={axis:n,keepDims:e};return k.runKernel(Ac,o,i)}var iu=A({min_:Bue});function zue(t,n){let e=N(t,"a","minimum"),r=N(n,"b","minimum");[e,r]=Qe(e,r),e.dtype==="bool"&&(e=pe(e,"int32"),r=pe(r,"int32")),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(za,o)}var jd=A({minimum_:zue});function Uue(t,n,e){F(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=N(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");F(n.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${n.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)F(n[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),F(n[a][0]>=0&&n[a][0]<=r.shape[a]-o&&n[a][1]>=0&&n[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:n,mode:e},s={x:r};return k.runKernel(Rc,s,i)}var Q3=A({mirrorPad_:Uue});function jue(t,n){let e=N(t,"a","mod"),r=N(n,"b","mod");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(Ua,o)}var J3=A({mod_:jue});function Gue(t){let n=N(t,"x","square"),e={};return k.runKernel("Square",{x:n},e)}var Xe=A({square_:Gue});function Wue(t,n=null,e=!1){t=N(t,"x","moments");let r=kn(n,t.shape),o=qt(t,r,e),i=o.shape;e||(i=Ds(o.shape,r));let s=Xe(Se(pe(t,"float32"),B(o,i))),a=qt(s,r,e);return{mean:o,variance:a}}var Am=A({moments_:Wue});function Hue(t,n){let e=N(t,"a","notEqual"),r=N(n,"b","notEqual");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Ed,o)}var su=A({notEqual_:Hue});function que(t){let e={x:N(t,"x","onesLike")};return k.runKernel(Fc,e)}var Wn=A({onesLike_:que});function Kue(t,n,e=0){let r=N(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:n,constantValue:e},i={x:r};return k.runKernel(Lc,i,o)}var Gd=A({pad_:Kue});function Xue(t,n,e){let r=N(t,"x","spaceToBatchND");F(r.rank>=1+n.length,()=>`input rank ${r.rank} should be > than [blockShape] ${n.length}`),F(e.length===n.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${n.length}`),F(r.shape.reduce((s,a,l)=>l>0&&l<=n.length?s&&(a+e[l-1][0]+e[l-1][1])%n[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${n.toString()}`);let o={x:r},i={blockShape:n,paddings:e};return k.runKernel(Hc,o,i)}var Rm=A({spaceToBatchND_:Xue});function Yue(t,n,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=N(t,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]])),F(Zn(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let c=lN(a.shape,n,i,o,r),u=[c.dilationHeight,c.dilationWidth],d;r==="same"?d=Que([c.filterHeight,c.filterWidth],u):d=[[0,0],[0,0]];let p=u[0]===1&&u[1]===1,[f,m]=Zue([c.inHeight,c.inWidth],u,d),h=p?r:"valid",g=p?a:Rm(a,u,f),b=(e==="avg"?()=>$d(g,n,i,h):()=>Ud(g,n,i,h))(),I=p?b:Sm(b,u,m);return l?B(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function Zue(t,n,e){let r=e.map(u=>u[0]),o=e.map(u=>u[1]),i=t.concat(r,o),s=n.map((u,d)=>(u-i[d]%u)%u),a=o.map((u,d)=>u+s[d]),l=n.map((u,d)=>[r[d],a[d]]),c=n.map((u,d)=>[0,s[d]]);return[l,c]}function Que(t,n){let r=t.map((s,a)=>s+(s-1)*(n[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var eB=A({pool_:Yue});function Jue(t,n){let e=N(t,"base","pow"),r=N(n,"exp","pow");[e,r]=Qe(e,r);let o={a:e,b:r};return k.runKernel(Ga,o)}var ui=A({pow_:Jue});function ede(t,n){let e=N(t,"x","prelu"),r=N(n,"alpha","prelu"),o={x:e,alpha:r};return k.runKernel($c,o)}var Wd=A({prelu_:ede});function tde(t,n=null,e=!1){let r=N(t,"x","prod");r.dtype==="bool"&&(r=pe(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(om,o,i)}var tB=A({prod_:tde});var BN=vh(gB());var Mm=class{constructor(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=BN.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let n,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(n))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(n)}convertValue(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)}isValidTruncated(n){return n<=this.upper&&n>=this.lower}};var Aw=class{constructor(n=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${n} - ${e} <= 1 and dtype is not float`);this.random=BN.alea(o)}convertValue(n){return this.canReturnFloat()?n:Math.round(n)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function lde(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new Mm(n,e,r,!1,o),s=Te(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Rw=A({randomNormal_:lde});function cde(t,n=0,e=1,r="float32",o){let i=Te(t,r),s=new Aw(n,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var hl=A({randomUniform_:cde});function zN(t,n,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:n,step:e,dtype:r};return k.runKernel(im,{},o)}function ude(t){let e={input:N(t,"input","real")};return k.runKernel(sm,e)}var _y=A({real_:ude});function dde(t){let e={x:N(t,"x","reciprocal")};return k.runKernel(Wa,e)}var UN=A({reciprocal_:dde});function pde(t){let e={x:N(t,"x","relu")};return k.runKernel(Ha,e)}var di=A({relu_:pde});function fde(t){let e={x:N(t,"x","relu6")};return k.runKernel(qa,e)}var Mw=A({relu6_:fde});function mde(t,n){let r={x:N(t,"x","reverse")},o={dims:n};return k.runKernel(Uc,r,o)}var Bo=A({reverse_:mde});function hde(t){let e={x:N(t,"x","round")};return k.runKernel(Ka,e)}var jN=A({round_:hde});function gde(t){let e={x:N(t,"x","rsqrt")};return k.runKernel(Xa,e)}var Iy=A({rsqrt_:gde});function Fe(t,n){if((ho(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&ho(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return eu(t,[],[],n)}function yde(t){let e={x:N(t,"x","selu")};return k.runKernel(Ya,e)}var Ey=A({selu_:yde});function vde(t,n,e,r,o,i=[1,1],s="NHWC"){let a=N(t,"x","separableConv2d"),l=N(n,"depthwiseFilter","separableConv2d"),c=N(e,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),F(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),F(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),F(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let p=l.shape[2],f=l.shape[3];F(c.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`);let m=pl(u,l,r,o,s,i),g=go(m,c,1,"valid",s);return d?B(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Sy=A({separableConv2d_:vde});function xde(t){let e={x:N(t,"x","sign")};return k.runKernel(Ja,e)}var GN=A({sign_:xde});function bde(t){let e={x:N(t,"x","sin")};return k.runKernel(Za,e)}var Ty=A({sin_:bde});function wde(t){let e={x:N(t,"x","sinh")};return k.runKernel(Qa,e)}var Dy=A({sinh_:wde});function Cde(t,n,e){let r=N(t,"x","slice1d");return F(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),lt(r,[n],[e])}var Ny=A({slice1d_:Cde});function _de(t,n,e){let r=N(t,"x","slice2d");return F(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),lt(r,n,e)}var Fw=A({slice2d_:_de});function Ide(t,n,e){let r=N(t,"x","slice3d");return F(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),lt(r,n,e)}var ky=A({slice3d_:Ide});function Ede(t,n,e){let r=N(t,"x","slice4d");return F(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),lt(r,n,e)}var Fm=A({slice4d_:Ede});function Sde(t,n=-1){let e=N(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${n}`);let r={logits:e},o={dim:n};return k.runKernel(Kc,r,o)}var qd=A({softmax_:Sde});function Tde(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Zf,n)}var Ay=A({fft_:Tde});function Dde(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Jf,n)}var Om=A({ifft_:Dde});function Nde(t){let n=t.shape[t.shape.length-1],e=t.size/n,r;if(n<=2){let o=B(t,[e,n]);r=Om(o)}else{let o=[e,2*(n-1)],i=B(_y(t),[e,n]),s=B(Sw(t),[e,n]),a=Bo(lt(i,[0,1],[e,n-2]),1),l=V(Bo(lt(s,[0,1],[e,n-2]),1),Fe(-1)),c=Gt([i,a],1),u=Gt([s,l],1),d=B(ji(c,u),[o[0],o[1]]);r=Om(d)}if(r=_y(r),t.rank===3&&t.shape[0]!==0){let o=r,i=t.shape[0];r=B(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var WN=A({irfft_:Nde});function kde(t,n,e=0){let o={x:N(t,"x","split")},i={numOrSizeSplits:n,axis:e};return k.runKernel(qc,o,i)}var tr=A({split_:kde});function Ade(t,n){F(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let e=t.shape[t.shape.length-1],r=t.size/e,o;if(n!=null&&n<e){let m=t.shape.map(g=>0),h=t.shape.map(g=>g);h[t.shape.length-1]=n,o=lt(t,m,h),e=n}else if(n!=null&&n>e){let m=t.shape.map(h=>h);m[t.shape.length-1]=n-e,o=Gt([t,Wt(m)],t.shape.length-1),e=n}else o=t;let i=De(o),s=B(ji(o,i),[r,e]),a=Ay(s),l=Math.floor(e/2)+1,c=_y(a),u=Sw(a),d=tr(c,[l,e-l],c.shape.length-1),p=tr(u,[l,e-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,B(ji(d[0],p[0]),f)}var HN=A({rfft_:Ade});function Rde(t){let e={x:N(t,"x","sqrt")};return k.runKernel(nl,e)}var Ht=A({sqrt_:Rde});function Mde(t,n){let e=N(t,"a","squaredDifference"),r=N(n,"b","squaredDifference");[e,r]=Qe(e,r),He(e.shape,r.shape);let o={a:e,b:r},i={};return k.runKernel(rl,o,i)}var yB=A({squaredDifference_:Mde});function Fde(t,n){let e=N(t,"x","squeeze");return B(e,_D(e.shape,n).newShape)}var Kd=A({squeeze_:Fde});function Ode(t,n=0){let e=dw(t,"tensors","stack","string_or_numeric");F(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&F(n<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:n};return k.runKernel(Pc,r,o)}var cr=A({stack_:Ode});function Pde(t,n=0){let r={x:N(t,"x","step")},o={alpha:n};return k.runKernel(al,r,o)}var qi=A({step_:Pde});function Lde(t,n,e,r,o=0,i=0,s=0,a=0,l=0){let u={x:N(t,"x","stridedSlice")},d={begin:n,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return k.runKernel(um,u,d)}var qN=A({stridedSlice_:Lde});function $de(t){let e={x:N(t,"x","tan")};return k.runKernel(il,e)}var KN=A({tan_:$de});function pi(t,n){ty(t);let e=Ad(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return eu(t,null,e,n)}function au(t,n,e){if(ty(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=Ad(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return eu(t,n,r,e)}function Vde(t,n=1,e=!0){let r=N(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(n>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${n}`);let i={x:r},s={k:n,sorted:e},[a,l]=k.runKernel(dm,i,s);return{values:a,indices:l}}var vB=A({topk_:Vde});function Bde(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new Mm(n,e,r,!0,o),s=Te(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Ry=A({truncatedNormal_:Bde});function zde(t,n=0){let e=N(t,"x","unique","string_or_numeric");F(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:n},[i,s]=k.runKernel(pm,r,o);return{values:i,indices:s}}var xB=A({unique_:zde});function Ude(t,n,e){let r=N(t,"x","unsortedSegmentSum"),o=N(n,"segmentIds","unsortedSegmentSum","int32");F(_t(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return k.runKernel(Zc,i,s)}var Ow=A({unsortedSegmentSum_:Ude});function jde(t,n=0){let e=N(t,"x","unstack","string_or_numeric");F(n>=-e.shape.length&&n<e.shape.length,()=>`Axis = ${n} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:n};return k.runKernel(Yc,r,o)}var qr=A({unstack_:jde});function XN(t,n=!0,e,r){return k.makeVariable(t,n,e,r)}function bB(t,n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(i);let r=Te(t,"int32"),o=Te([e.length,t.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*t.length;o.values.set(s,a)}return o.toTensor()}function Gde(t,n="euclidean",e=null,r=!1){t=N(t,"x","norm");let o=wB(t,n,e),i=o.shape;if(r){let s=kn(e,t.shape);i=Ds(o.shape,s)}return B(o,i)}function wB(t,n,e=null){if(t.rank===0)return An(t);if(t.rank!==1&&e===null)return wB(B(t,[-1]),n,e);if(t.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(n===1)return Ce(An(t),e);if(n===1/0)return er(An(t),e);if(n===-1/0)return iu(An(t),e);if(n==="euclidean"||n===2)return Ht(Ce(ui(An(t),Fe(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}if(Array.isArray(e)&&e.length===2){if(n===1)return er(Ce(An(t),e[0]),e[1]-1);if(n===1/0)return er(Ce(An(t),e[1]),e[0]);if(n===-1/0)return iu(Ce(An(t),e[1]),e[0]);if(n==="fro"||n==="euclidean")return Ht(Ce(Xe(t),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var Pm=A({norm_:Gde});function CB(t,n){if(n==null)return t.shape.slice();if(xs(t.shape,n))return n;if(t.shape.length===n.length){let e=[];for(let r=0;r<t.shape.length;r++)n[r]==null&&t.shape[r]!=null?e.push(t.shape[r]):e.push(n[r]);return e}return n}function Wde(t,n,e,r){let o=N(t,"x","dropout");if(F(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),F(n>=0&&n<1,()=>`rate must be a float in the range [0, 1), but got ${n}.`),n===0)return t instanceof gt?o.clone():o;let i=CB(o,e),s=1-n,a=ye(ml(oe(hl(i,0,1,"float32",r),s)),s);return V(o,a)}var _B=A({dropout_:Wde});var Jd={};rs(Jd,{conv2d:()=>IB,depthwiseConv2d:()=>EB,matMul:()=>SB});function Hde(t,n,e,r,o,i="NHWC",s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]])),F(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),F(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),F(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];F(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),F(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),s!=null&&F(_t(o),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let d={x:a,dy:l},p={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return k.runKernel(Gf,d,p)}var Lm=A({conv2DBackpropFilter_:Hde});function Xd(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return V(t,qi(n));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Yd(t,n){let e=n,r=Vt(t.shape,n.shape);return r.length>0&&(e=Ce(e,r)),B(e,t.shape)}function Zd(t,n,e,r){if(n==="linear")return t;if(n==="relu")return di(t);if(n==="elu")return fl(t);if(n==="relu6")return Mw(t);if(n==="prelu")return Wd(t,e);if(n==="leakyrelu")return zd(t,r);if(n==="sigmoid")return li(t);throw new Error(`Unknown fused activation ${n}.`)}var Qd=(t,n)=>!(t>0)||n==="linear";function qde({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Qd(k.state.gradientDepth,l)===!1){let E=go(t,n,e,r,o,i,s);return a!=null&&(E=oe(E,a)),Zd(E,l,c,u)}let d=N(t,"x","conv2d"),p=N(n,"filter","conv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),F(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),s!=null&&F(_t(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),F(f.shape[3]===p.shape[2],()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${p.shape[2]}.`),F(Zn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),F(o==="NHWC",()=>`Error in conv2d: got dataFormat of ${o} but only NHWC is currently supported.`);let h=Ld(f.shape,p.shape,e,i,r,s),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Qe(g,d),He(h.outShape,g.shape));let x;c!=null&&(x=N(c,"prelu weights","fused conv2d"));let b=(E,S)=>{let[D,M,R,L]=S,G=Xd(E,R,l);F(Lo(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let W=Dm(M.shape,G,D,e,r),q=Lm(M,G,D.shape,e,r),X=[W,q];if(L!=null){let K=Yd(L,G);X.push(K)}return X},I={x:f,filter:p,bias:g,preluActivationWeights:x},_={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?Vo((S,D,M)=>{let R=k.runKernel(Td,I,_);return M([D,S,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(f,p):Vo((S,D,M,R)=>{let L=k.runKernel(Td,I,_);return R([D,S,L,M]),m&&(L=B(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:b}})(f,p,g)}var IB=A({fusedConv2d_:qde});function Kde(t,n,e,r,o,i=[1,1],s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return k.runKernel(Kf,c,u)}var Pw=A({depthwiseConv2dNativeBackpropFilter_:Kde});function Xde(t,n,e,r,o,i=[1,1],s){let a=n,l=!1;n.rank===3&&(l=!0,a=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={dy:a,filter:e},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:t},d=k.runKernel(Xf,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Lw=A({depthwiseConv2dNativeBackpropInput_:Xde});function Yde({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(Qd(k.state.gradientDepth,l)===!1){let E=pl(t,n,e,r,o,i,s);return a!=null&&(E=oe(E,a)),Zd(E,l,c,u)}let d=N(t,"x","depthwiseConv2d"),p=N(n,"filter","depthwiseConv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),F(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),F(f.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),F(Zn(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),s!=null&&F(_t(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${s} but got pad ${r}.`);let h=Ld(f.shape,p.shape,e,i,r,s,!0),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Qe(g,d),He(h.outShape,g.shape));let x;c!=null&&(x=N(c,"prelu weights","fused depthwiseConv2d"));let b=(E,S)=>{F(Lo(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[D,M,R,L]=S,G=Xd(E,R,l),W=Lw(M.shape,G,D,e,r,i,s),q=Pw(M,G,D.shape,e,r,i,s);if(L!=null){let X=Yd(g,G);return[W,q,X]}return[W,q]},I={x:f,filter:p,bias:g,preluActivationWeights:x},_={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?Vo((S,D,M)=>{let R=k.runKernel(Dd,I,_);return M([D,S,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(f,p):Vo((S,D,M,R)=>{let L=k.runKernel(Dd,I,_);return R([D,S,L,M]),m&&(L=B(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:b}})(f,p,g)}var EB=A({fusedDepthwiseConv2d_:Yde});function Zde({a:t,b:n,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a}){if(Qd(k.state.gradientDepth,i)===!1){let L=It(t,n,e,r);return o!=null&&(L=oe(L,o)),Zd(L,i,s,a)}let l=N(t,"a","fused matMul"),c=N(n,"b","fused matMul");[l,c]=Qe(l,c);let u=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=e?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],m=l.shape.slice(0,-2),h=c.shape.slice(0,-2),g=$t(m),x=$t(h);F(l.rank>=2&&c.rank>=2&&l.rank===c.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${l.rank} and ${c.rank}.`),F(xs(m,h),()=>`Error in fused matMul: outer dimensions (${m}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} must match.`),F(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let b=l.shape.slice(0,-2).concat([p,f]),I=e?B(l,[g,u,p]):B(l,[g,p,u]),_=r?B(c,[x,f,d]):B(c,[x,d,f]),E;o!=null&&(E=N(o,"bias","fused matMul"),[E]=Qe(E,l),He(b,E.shape));let S;s!=null&&(S=N(s,"prelu weights","fused matMul"));let D=(L,G)=>{let[W,q,X,K]=G,Z=Xd(B(L,X.shape),X,i),ae,ee;if(!e&&!r?(ae=It(Z,q,!1,!0),ee=It(W,Z,!0,!1)):!e&&r?(ae=It(Z,q,!1,!1),ee=It(Z,W,!0,!1)):e&&!r?(ae=It(q,Z,!1,!0),ee=It(W,Z,!1,!1)):(ae=It(q,Z,!0,!0),ee=It(Z,W,!0,!0)),o!=null){let ie=Yd(K,Z);return[ae,ee,ie]}else return[ae,ee]},M={a:I,b:_,bias:E,preluActivationWeights:S},R={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?Vo((G,W,q)=>{let X=k.runKernel(Sd,M,R);return q([G,W,X]),{value:B(X,b),gradFunc:D}})(I,_):Vo((G,W,q,X)=>{let K=k.runKernel(Sd,M,R);return X([G,W,K,q]),{value:B(K,b),gradFunc:D}})(I,_,E)}var SB=A({fusedMatMul_:Zde});function TB(t,n,e){let r=Qde(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function Qde(t,n,e){return epe(t,n,e||Jde)}function Jde(t,n){return t>n?1:t<n?-1:0}function epe(t,n,e){let r=0,o=t.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(n,t[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function NB(t,n,e,r,o){return YN(t,n,e,r,o,0)}function kB(t,n,e,r,o,i){return YN(t,n,e,r,o,0,!1,i,!0)}function AB(t,n,e,r,o,i){return YN(t,n,e,r,o,i,!0)}function YN(t,n,e,r,o,i,s=!1,a=!1,l=!1){let c=[];for(let g=0;g<n.length;g++)n[g]>o&&c.push({score:n[g],boxIndex:g,suppressBeginIndex:0});c.sort(DB);let u=i>0?-.5/i:0,d=[],p=[];for(;d.length<e&&c.length>0;){let g=c.pop(),{score:x,boxIndex:b,suppressBeginIndex:I}=g;if(x<o)break;let _=!1;for(let E=d.length-1;E>=I;--E){let S=tpe(t,b,d[E]);if(S>=r){_=!0;break}if(g.score=g.score*npe(r,u,S),g.score<=o)break}g.suppressBeginIndex=d.length,_||(g.score===x?(d.push(b),p.push(g.score)):g.score>o&&TB(c,g,DB))}let f=d.length,m=e-f;a&&m>0&&(d.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));let h={selectedIndices:d};return s&&(h.selectedScores=p),l&&(h.validOutputs=f),h}function tpe(t,n,e){let r=t.subarray(n*4,n*4+4),o=t.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(a-i)*(l-s),m=(d-c)*(p-u);if(f<=0||m<=0)return 0;let h=Math.max(i,c),g=Math.max(s,u),x=Math.min(a,d),b=Math.min(l,p),I=Math.max(x-h,0)*Math.max(b-g,0);return I/(f+m-I)}function npe(t,n,e){let r=Math.exp(n*e*e);return e<=t?r:0}function DB(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function rpe(t,n,e=!1,r=!1){let o=N(t,"images","resizeBilinear");F(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),F(n.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${n}.`),F(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(zc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var RB=A({resizeBilinear_:rpe});function ope(t,n,e=!1,r=!1){let o=N(t,"images","resizeNearestNeighbor");F(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),F(n.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${n}.`),F(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),F(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(Bc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var MB=A({resizeNearestNeighbor_:ope});function ipe(t,n,e){F(n%1===0,()=>`bandPart(): numLower must be an integer, got ${n}.`),F(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`);let r=N(t,"a","bandPart");F(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2);if(!(n<=i))throw new Error(`bandPart(): numLower (${n}) must not be greater than the number of rows (${i}).`);if(!(e<=s))throw new Error(`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`);n<0&&(n=i),e<0&&(e=s);let a=B(zN(0,i,1,"int32"),[-1,1]),l=zN(0,s,1,"int32"),c=Se(a,l),u=_r(Ss(c,Fe(+n,"int32")),$o(c,Fe(-e,"int32"))),d=Wt([i,s],r.dtype);return B(cr(qr(B(r,[-1,i,s])).map(p=>fn(u,p,d))),o)}var FB=A({bandPart_:ipe});function spe(t){let n;if(Array.isArray(t)){n=!1,F(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let i=1;i<t.length;++i)F(t[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${o})`)}else n=!0,t=tr(t,t.shape[0],0).map(o=>Kd(o,[0]));F(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let e=[],r=t;for(let o=0;o<t.length;++o)e.push(k.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=V(Ce(V(e[s],i)),e[s]);i=Se(i,a)}return ye(i,Pm(i,"euclidean"))}));return n?cr(e,0):e}var OB=A({gramSchmidt_:spe});function ape(t,n=!1){if(F(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return PB(t,n);{let e=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),r=qr(B(t,[e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[c,u]=PB(l,n);o.push(c),i.push(u)});let s=B(cr(o,0),t.shape),a=B(cr(i,0),t.shape);return[s,a]}}function PB(t,n=!1){return k.tidy(()=>{F(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let e=t.shape[0],r=t.shape[1],o=Nm(e),i=Wi(t),s=au([[1]],[1,1]),a=Wi(s),l=e>=r?r:e;for(let c=0;c<l;++c){let u=i,d=a,p=o;[a,i,o]=k.tidy(()=>{let f=lt(i,[c,c],[e-c,1]),m=Pm(f),h=lt(i,[c,c],[1,1]),g=fn(Jn(h,0),au([[-1]]),au([[1]])),x=Se(h,V(g,m)),b=ye(f,x);b.shape[0]===1?a=Wi(s):a=Gt([s,lt(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);let I=Et(ye(It(g,x),m)),_=lt(i,[c,0],[e-c,r]),E=V(I,a),S=at(a);if(c===0)i=Se(_,It(E,It(S,_)));else{let R=Se(_,It(E,It(S,_)));i=Gt([lt(i,[0,0],[c,r]),R],0)}let D=at(E),M=lt(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=Se(M,It(It(M,a),D));else{let R=Se(M,It(It(M,a),D));o=Gt([lt(o,[0,0],[e,c]),R],1)}return[a,i,o]}),Pe([u,d,p])}return!n&&e>r&&(o=lt(o,[0,0],[e,r]),i=lt(i,[0,0],[r,r])),[o,i]})}var LB=A({qr_:ape});var $B={bandPart:FB,gramSchmidt:OB,qr:LB};var ur=class extends my{minimize(n,e=!1,r){let{value:o,grads:i}=this.computeGradients(n,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return Pe(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(n,e){return TN(n,e)}dispose(){this.iterations_!=null&&Pe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Fe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(n){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(n){return this.iterations_=(await n[0].tensor.data())[0],n.slice(1)}};Object.defineProperty(ur,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var ZN=(()=>{class t extends ur{constructor(e,r,o=null){super(),this.learningRate=e,this.rho=r,this.epsilon=o,this.accumulatedGrads=[],this.accumulatedUpdates=[],o==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accum_grad`,variable:j(()=>De(s).variable(a))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${o}/accum_var`,variable:j(()=>De(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedGrads[i].variable,u=this.accumulatedUpdates[i].variable;j(()=>{let d=oe(V(c,this.rho),V(Xe(l),1-this.rho)),p=V(ye(Ht(oe(u,this.epsilon)),Ht(oe(c,this.epsilon))),l),f=oe(V(u,this.rho),V(Xe(p),1-this.rho));c.assign(d),u.assign(f);let m=oe(V(p,-this.learningRate),s);s.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Pe(this.accumulatedGrads.map(e=>e.variable)),Pe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,o=!1;this.accumulatedGrads=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedUpdates=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}}return t.className="Adadelta",t})();Hr(ZN);var QN=(()=>{class t extends ur{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accumulator`,variable:j(()=>by(s.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[i].tensor:e[o];if(a==null)return;let l=this.accumulatedGrads[i].variable;j(()=>{let c=oe(l,Xe(a));l.assign(c);let u=oe(V(ye(a,Ht(oe(c,k.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Pe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}}return t.className="Adagrad",t})();Hr(QN);var JN=(()=>{class t extends ur{constructor(e,r,o,i=null){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],j(()=>{this.accBeta1=Fe(r).variable(),this.accBeta2=Fe(o).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);j(()=>{let o=Se(1,this.accBeta1),i=Se(1,this.accBeta2);r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:j(()=>De(l).variable(c))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${s}/v`,variable:j(()=>De(l).variable(c))});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,f=oe(V(d,this.beta1),V(u,1-this.beta1)),m=oe(V(p,this.beta2),V(Xe(u),1-this.beta2)),h=ye(f,o),g=ye(m,i);d.assign(f),p.assign(m);let x=oe(V(ye(h,oe(Ht(g),this.epsilon)),-this.learningRate),l);l.assign(x)}),this.accBeta1.assign(V(this.accBeta1,this.beta1)),this.accBeta2.assign(V(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Pe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Pe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),j(()=>{this.accBeta1.assign(ui(this.beta1,this.iterations_+1)),this.accBeta2.assign(ui(this.beta2,this.iterations_+1))});let r=e.length/2,o=!1;this.accumulatedFirstMoment=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}}return t.className="Adam",t})();Hr(JN);var ek=(()=>{class t extends ur{constructor(e,r,o,i=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],j(()=>{this.iteration=Fe(0).variable(),this.accBeta1=Fe(r).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);j(()=>{let o=Se(1,this.accBeta1),i=ye(-this.learningRate,oe(V(this.iteration,this.decay),1));r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:De(l).variable(c)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${s}/v`,variable:De(l).variable(c)});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,f=oe(V(d,this.beta1),V(u,1-this.beta1)),m=V(p,this.beta2),h=An(u),g=yo(m,h);d.assign(f),p.assign(g);let x=oe(V(ye(i,o),ye(f,oe(g,this.epsilon))),l);l.assign(x)}),this.iteration.assign(oe(this.iteration,1)),this.accBeta1.assign(V(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Pe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Pe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}}return t.className="Adamax",t})();Hr(ek);var My=(()=>{class t extends ur{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=Array.isArray(e)?e[i].tensor:e[o];if(s==null)return;let a=k.registeredVariables[o];j(()=>{let l=oe(V(this.c,s),a);a.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Gn(Fe(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}}return t.className="SGD",t})();Hr(My);var tk=(()=>{class t extends My{constructor(e,r,o=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=o,this.accumulations=[],this.m=Fe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${o}/momentum`,variable:j(()=>De(s).variable(!1))});let a=this.accumulations[i].variable,l=Array.isArray(e)?e[i].tensor:e[o];l!=null&&j(()=>{let c,u=oe(V(this.m,a),l);this.useNesterov?c=oe(V(this.c,oe(l,V(u,this.m))),s):c=oe(V(this.c,u),s),a.assign(u),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Pe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}}return t.className="Momentum",t})();Hr(tk);var nk=(()=>{class t extends ur{constructor(e,r=.9,o=0,i=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=o,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=k.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${o}/rms`,variable:j(()=>De(s).variable(a))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${o}/momentum`,variable:j(()=>De(s).variable(a))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${o}/mg`,variable:j(()=>De(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedMeanSquares[i].variable,u=this.accumulatedMoments[i].variable;j(()=>{let d=oe(V(c,this.decay),V(Xe(l),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[i].variable,f=oe(V(p,this.decay),V(l,1-this.decay)),m=ye(V(l,this.learningRate),Ht(Se(d,oe(Xe(f),this.epsilon)))),h=oe(V(u,this.momentum),m);c.assign(d),p.assign(f),u.assign(h);let g=Se(s,h);s.assign(g)}else{let p=oe(V(c,this.decay),V(Xe(l),1-this.decay)),f=oe(V(u,this.momentum),ye(V(l,this.learningRate),Ht(oe(p,this.epsilon))));c.assign(p),u.assign(f);let m=Se(s,f);s.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Pe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Pe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Pe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,o=!1;this.accumulatedMeanSquares=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedMoments=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}}return t.className="RMSProp",t})();Hr(nk);var Ns=class{static sgd(n){return new My(n)}static momentum(n,e,r=!1){return new tk(n,e,r)}static rmsprop(n,e=.9,r=0,o=null,i=!1){return new nk(n,e,r,o,i)}static adam(n=.001,e=.9,r=.999,o=null){return new JN(n,e,r,o)}static adadelta(n=.001,e=.95,r=null){return new ZN(n,e,r)}static adamax(n=.002,e=.9,r=.999,o=null,i=0){return new ek(n,e,r,o,i)}static adagrad(n,e=.1){return new QN(n,e)}};var ep={sgd:Ns.sgd,momentum:Ns.momentum,adadelta:Ns.adadelta,adagrad:Ns.adagrad,rmsprop:Ns.rmsprop,adamax:Ns.adamax,adam:Ns.adam};var lpe=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function Fy(){return new Promise(t=>lpe(()=>t()))}var T={};rs(T,{ERF_A1:()=>xpe,ERF_A2:()=>bpe,ERF_A3:()=>wpe,ERF_A4:()=>Cpe,ERF_A5:()=>_pe,ERF_P:()=>vpe,PARALLELIZE_THRESHOLD:()=>$w,SELU_SCALE:()=>ok,SELU_SCALEALPHA:()=>rk,applyActivation:()=>Zd,assertAndGetBroadcastShape:()=>He,assertAxesAreInnerMostDims:()=>Nue,assertParamsConsistent:()=>cpe,assignToTypedArray:()=>Ape,axesAreInnerMostDims:()=>NN,calculateShapes:()=>jle,checkEinsumDimSizes:()=>Lpe,combineLocations:()=>X3,complexWithEvenIndex:()=>Dpe,complexWithOddIndex:()=>Npe,computeConv2DInfo:()=>Ld,computeConv3DInfo:()=>z3,computeDefaultPad:()=>cN,computeDilation2DInfo:()=>dce,computeOptimalWindowSize:()=>dpe,computeOutAndReduceShapes:()=>kN,computeOutShape:()=>upe,computePool2DInfo:()=>lN,computePool3DInfo:()=>pce,convertConv2DDataFormat:()=>U3,decodeEinsumEquation:()=>Ope,eitherStridesOrDilationsAreOne:()=>Zn,expandShapeToKeepDim:()=>Ds,exponent:()=>Mpe,exponents:()=>Rpe,fromStringArrayToUint8:()=>Hpe,fromUint8ToStringArray:()=>Wpe,getAxesPermutation:()=>AN,getBroadcastDims:()=>Xce,getComplexWithIndex:()=>kpe,getEinsumComputePath:()=>$pe,getEinsumPermutation:()=>Ppe,getFusedBiasGradient:()=>Yd,getFusedDyActivation:()=>Xd,getImageCenter:()=>ppe,getInnerMostAxes:()=>kue,getPermuted:()=>mpe,getReductionAxes:()=>Vt,getReshaped:()=>fpe,getReshapedPermuted:()=>hpe,getSliceBeginCoords:()=>gpe,getSliceSize:()=>ype,getUndoAxesPermutation:()=>Cy,isIdentityPermutation:()=>Vpe,log:()=>Epe,mergeRealAndImagArrays:()=>Spe,prepareAndValidate:()=>zle,prepareSplitSize:()=>zpe,segment_util:()=>sk,shouldFuse:()=>Qd,slice_util:()=>ar,splitRealAndImagArrays:()=>Tpe,tupleValuesAreOne:()=>Lo,upcastType:()=>Fn,validateInput:()=>Ule,validateUpdateShape:()=>T3,warn:()=>Ipe});function cpe(t,n){let e=t[0].length;t.forEach((o,i)=>{F(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),F(n>=0&&n<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=t[0];t.forEach((o,i)=>{for(let s=0;s<e;s++)F(s===n||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function upe(t,n){let e=t[0].slice();for(let r=1;r<t.length;r++)e[n]+=t[r][n];return e}var $w=30;function dpe(t){return t<=$w?t:Pf(t,Math.floor(Math.sqrt(t)))}function ppe(t,n,e){let r=e*(typeof t=="number"?t:t[0]),o=n*(typeof t=="number"?t:t[1]);return[r,o]}function fpe(t,n,e,r=!0){let o=[];if(r)o=o.concat(n.slice(0)),o.push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let i=n.length;for(let s=0;s<i;++s)o=o.concat([t[s+1]/n[s],n[s]]);o=o.concat(t.slice(i+1))}return o}function mpe(t,n,e=!0){let r=[];if(e){r.push(n);for(let o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<t;++s)s>=n*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function hpe(t,n,e,r=!0){let o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(let i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function gpe(t,n){let e=[0];for(let r=0;r<n;++r)e.push(t[r][0]);return e}function ype(t,n,e){let r=t.slice(0,1);for(let o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}var rk=1.7580993408473768,ok=1.0507009873554805;var vpe=.3275911,xpe=.254829592,bpe=-.284496736,wpe=1.421413741,Cpe=-1.453152027,_pe=1.061405429;function Ipe(...t){H().getBool("IS_TEST")||console.warn(...t)}function Epe(...t){H().getBool("IS_TEST")||console.log(...t)}function Spe(t,n){if(t.length!==n.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${n.length}.`);let e=new Float32Array(t.length*2);for(let r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function Tpe(t){let n=new Float32Array(t.length/2),e=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=t[r],e[r/2]=t[r+1];return{real:n,imag:e}}function Dpe(t){let n=Math.ceil(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=0;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function Npe(t){let n=Math.floor(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=2;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function kpe(t,n){let e=t[n*2],r=t[n*2+1];return{real:e,imag:r}}function Ape(t,n,e,r){t[r*2]=n,t[r*2+1]=e}function Rpe(t,n){let e=new Float32Array(t/2),r=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let i=(n?2:-2)*Math.PI*(o/t);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function Mpe(t,n,e){let r=(e?2:-2)*Math.PI*(t/n),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var ik="->",Fpe=/->/g,VB=",",BB="...";function Ope(t,n){t=t.replace(/\s/g,"");let e=(t.length-t.replace(Fpe,"").length)/ik.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${ik}").`);let[r,o]=t.split(ik);F(r.indexOf(BB)===-1,()=>`The ellipsis notation ("${BB}") is not supported yet.`);let i=r.split(VB),s=i.length;if(n!==s)throw new Error(`Expected ${s} input tensors, received ${n}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let p=0;p<o.length;++p){let f=o[p];if(!i.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<r.length;++p){let f=r[p];a.indexOf(f)===-1&&f!==VB&&a.push(f)}let l=new Array(i.length);for(let p=0;p<s;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let f=0;f<i[p].length;++f)l[p].push(a.indexOf(i[p][f]))}let c=a.length,u=o.length,d=[];for(let p=u;p<c;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function Ppe(t,n){let e=new Array(t);e.fill(-1);for(let o=0;o<n.length;++o)e[n[o]]=o;let r=[];for(let o=0;o<t;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function Lpe(t,n,e){let r=new Array(t);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<n[o].length;++s)r[n[o][s]]===void 0?r[n[o][s]]=i[s]:F(r[n[o][s]]===i[s],()=>`Expected dimension ${r[n[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function $pe(t,n){let e=t,r=[],o=0;t.length===0&&e.push(-1),o=t.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=Bpe(n,a);for(let c of l)i.indexOf(c)===-1&&(r[s].push(c),i.push(c))}return{path:e,steps:r}}function Vpe(t){return t.every((n,e)=>n===e)}function Bpe(t,n){let e=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(n)!==-1||n===-1)&&e.push(r);return e}function zpe(t,n,e=0){let r=[];if(typeof n=="number")F(t.shape[e]%n===0,()=>"Number of splits must evenly divide the axis."),r=new Array(n).fill(t.shape[e]/n);else{let o=n.reduce((s,a)=>(a===-1&&(s+=1),s),0);F(o<=1,()=>"There should be only one negative value in split array.");let i=n.indexOf(-1);if(i!==-1){let s=n.reduce((a,l)=>l>0?a+l:a);n[i]=t.shape[e]-s}F(t.shape[e]===n.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=n}return r}var sk={};rs(sk,{collectGatherOpShapeInfo:()=>Gpe,computeOutShape:()=>jpe,segOpComputeOptimalWindowSize:()=>Upe});function Upe(t,n){let e=!1,r;for(t<=$w?(r=t,e=!0):r=Pf(t,Math.floor(Math.sqrt(t)));!e;)r>n||r===t?e=!0:r=Pf(t,r+1);return r}function jpe(t,n,e){let r=[],o=t.length;for(let i=0;i<o;i++)i!==n?r.push(t[i]):r.push(e);return r}function Gpe(t,n,e,r){let o=n.shape.length,i=t.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let d=0;d<r;++d)if(t.shape[d]!==n.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${n.shape[d]}.`);let s=t.shape[e],a=[],l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=r;d<e;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=r;d<o;d++)a.push(n.shape[d]);for(let d=e+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}function Wpe(t){try{return t.map(n=>hm(n))}catch(n){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${n}`)}}function Hpe(t){return t.map(n=>mm(n))}var dr={};rs(dr,{nonMaxSuppressionV3Impl:()=>NB,nonMaxSuppressionV4Impl:()=>kB,nonMaxSuppressionV5Impl:()=>AB,whereImpl:()=>bB});var Vw={kernelName:ac,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,qi(pe(e,"float32"),-1))}}};var zB={kernelName:ga,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Xe(pe(e,"float32")),o=Ht(Se(Fe(1),r));return Et(ye(t,o))}}}};var UB={kernelName:ya,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Ht(Se(Xe(pe(e,"float32")),1));return ye(t,r)}}}};var jB={kernelName:zi,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=t,l=Vt(e.shape,o);return l.length>0&&(a=Ce(a,l)),B(a,e.shape)},b:()=>{let a=t,l=Vt(r.shape,o);return l.length>0&&(a=Ce(a,l)),B(a,r.shape)}}}};var GB={kernelName:$f,saveAllInputs:!0,gradFunc:(t,n)=>{let e={};return n.forEach((r,o)=>{e[o]=()=>t.clone()}),e}};var WB={kernelName:lc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>De(e)}}};var HB={kernelName:cc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>De(e)}}};var qB={kernelName:va,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Ht(Se(Fe(1),Xe(pe(e,"float32")))))}}};var KB={kernelName:xa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Ht(oe(Fe(1),Xe(pe(e,"float32"))));return ye(t,r)}}}};var XB={kernelName:Ca,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=oe(Xe(e),Xe(r)),l=V(t,ye(r,a)),c=Vt(e.shape,o);return c.length>0&&(l=Ce(l,c)),B(l,e.shape)},b:()=>{let a=oe(Xe(e),Xe(r)),l=Et(V(t,ye(e,a))),c=Vt(r.shape,o);return c.length>0&&(l=Ce(l,c)),B(l,r.shape)}}}};var YB={kernelName:ba,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,oe(Xe(pe(e,"float32")),1))}}};var ZB={kernelName:wa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Se(Fe(1),Xe(pe(e,"float32"))))}}};function qpe(t,n,e,r,o,i){let s=N(t,"dy","avgPool3dGrad"),a=N(n,"input","avgPool3dGrad"),l=s,c=a,u=!1;a.rank===4&&(u=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),F(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),i!=null&&F(_t(o),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let d={dy:l,input:c},p={filterSize:e,strides:r,pad:o,dimRoundingMode:i},f=k.runKernel(Uf,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var QB=A({avgPool3dGrad_:qpe});var JB={kernelName:dc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>QB(t,r,o,i,s,a)}}};function Kpe(t,n,e,r,o){let i=N(t,"dy","avgPoolGrad"),s=N(n,"input","avgPoolGrad");F(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,c=!1;s.rank===3&&(c=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),F(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:l,input:a},d={filterSize:e,strides:r,pad:o},p=k.runKernel(zf,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ez=A({avgPoolGrad_:Kpe});var tz={kernelName:uc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s}=e;return{x:()=>ez(t,r,o,i,s)}}};var nz={kernelName:pc,inputsToSave:["a","b"],gradFunc:(t,n,e)=>{let[r,o]=n,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>It(t,o,!1,!0),b:()=>It(r,t,!0,!1)}:!i&&s?{a:()=>It(t,o,!1,!1),b:()=>It(t,r,!0,!1)}:i&&!s?{a:()=>It(o,t,!1,!0),b:()=>It(r,t,!1,!1)}:{a:()=>It(o,t,!0,!0),b:()=>It(t,r,!0,!0)}}};var rz={kernelName:fc,gradFunc:(t,n,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>Rm(t,r,o)}}};var oz={kernelName:AV,gradFunc:(t,n,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>Ce(t,a,!0)}}};var iz={kernelName:ws,gradFunc:t=>({x:()=>t.clone()})};var sz={kernelName:_a,gradFunc:t=>({x:()=>De(t)})};var az={kernelName:Ia,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>fn(_r($o(r,o),Ss(r,i)),t,De(t))}}};var lz={kernelName:mc,inputsToSave:["x"],gradFunc:Vw.gradFunc};var cz={kernelName:hc,saveAllInputs:!0,gradFunc:(t,n,e)=>{let r=n.map(l=>l.shape),{axis:o}=e,i=kn(o,n[0].shape)[0],s=r.map(l=>l[i]);return tr(t,s,i).map(l=>()=>l)}};var uz={kernelName:gc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return F(Lo(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Dm(r.shape,t,o,s,a,l),filter:()=>Lm(r,t,o.shape,s,a,l)}}};var dz={kernelName:yc,inputsToSave:["dy","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>go(t,o,i,s,a,1,l),filter:()=>Lm(t,r,o.shape,i,s,a,l)}}};function Xpe(t,n,e,r,o){let i=t;t.rank===4&&(i=B(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let s=n;s.rank===4&&(s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]])),F(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),F(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),F(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),F(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),F(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return k.runKernel(Wf,a,l)}var pz=A({conv3DBackpropFilter_:Xpe});var fz={kernelName:vc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i}=e;F(Lo(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=n;return{x:()=>Iw(s.shape,t,a,o,i),filter:()=>pz(s,t,a.shape,o,i)}}};var mz={kernelName:Ea,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Et(Ty(pe(e,"float32"))),t)}}};var hz={kernelName:Sa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Dy(pe(e,"float32")),t)}}};var gz={kernelName:xc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=AN([o],r.rank),l=Ew(t,o,i,!s);return a!=null&&(l=at(l,a)),l}}}};var yz={kernelName:bc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];F(Lo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,c]=n;return F(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),F(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),F(Zn(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),s!=null&&F(_t(i),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`),{x:()=>Lw(l.shape,t,c,o,i,r,s),filter:()=>Pw(l,t,c.shape,o,i,r,s)}}};var vz={kernelName:wc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,i={x:r,filter:o,dy:t},s={x:r,filter:o,dy:t};return{x:()=>k.runKernel(ay,i,e),filter:()=>k.runKernel(ly,s,e)}}};var xz={kernelName:Da,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n,r={dy:t,y:e};return{x:()=>k.runKernel(Yf,r)}}};var bz={kernelName:Na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(Ar(Et(Xe(e))),2/Math.sqrt(Math.PI));return{x:()=>V(t,r)}}};var wz={kernelName:ka,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,e)}}};var Cz={kernelName:Cc,inputsToSave:["input"],gradFunc:(t,n)=>{let[e]=n;return{input:()=>B(t,e.shape)}}};var _z={kernelName:Aa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Ar(e))}}};var Iz={kernelName:Ra,gradFunc:t=>({x:()=>De(t)})};var Ez={kernelName:Ma,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=ye(t,pe(r,"float32")),l=Vt(e.shape,o);return l.length>0?B(Ce(a,l),e.shape):a},b:()=>{let a=V(t,pe(e,"float32")),l=Vt(r.shape,o);l.length>0&&(a=B(Ce(a,l),r.shape));let c=Xe(r);return Et(ye(a,pe(c,"float32")))}}}};var Sz={kernelName:_c,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,n,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=n,l=a??Fe(1),c=Vt(i.shape,o.shape),u=[];if(i.rank===1){for(let _=0;_<o.shape.length-1;++_)u.push(o.shape[_]);u.push(1)}let d=Se(o,i),p=V(t,l),f=Iy(oe(s,Fe(r))),m=V(V(V(f,f),f),Fe(-.5));return{x:()=>i.rank===1?B(V(V(t,Hi(B(f,[1,1,1,i.shape[0]]),u)),l),o.shape):B(V(V(t,f),l),o.shape),mean:()=>{let _=V(V(f,Fe(-1)),p);return i.rank===1&&(_=Ce(_,c)),B(_,i.shape)},variance:()=>{let _=V(V(m,d),p);return i.rank===1&&(_=Ce(_,c)),B(_,i.shape)},scale:()=>{let _=V(d,f),E=V(t,_);return i.rank===1&&(E=Ce(E,c)),B(E,i.shape)},offset:()=>{let _=t;return i.rank===1&&(_=Ce(_,c)),B(_,i.shape)}}}};var Nz={kernelName:Ic,inputsToSave:["x","indices"],gradFunc:(t,n,e)=>{let[r,o]=n,{axis:i}=e,s=kn(i,r.shape)[0];return{x:()=>{let l=r.shape,c=o.size,u=l.slice(0,s),d=u.length,p=l.slice(i,l.length).slice(1),f=p.length,m=Tz(0,d),h=Tz(d+1,d+1+f),g=Dz([u,[c],p]),x=B(t,g),b=B(o,[c]),I=Dz([[d],m,h]),_=at(x,I),E=Ow(_,b,r.shape[s]),S=Cy(I);return E=at(E,S),E},indices:()=>o}}};function Tz(t,n){let e=[];for(let r=t;r<n;++r)e.push(r);return e}function Dz(t){let n=[];for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var kz={kernelName:Fa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>De(e),b:()=>De(r)}}};var Az={kernelName:Cs,gradFunc:t=>({x:()=>pe(t,"float32")})};var Rz={kernelName:Oa,gradFunc:t=>({x:()=>De(t)})};var Mz={kernelName:Pa,gradFunc:t=>({x:()=>De(t)})};var Fz={kernelName:La,gradFunc:t=>({x:()=>De(t)})};var Oz={kernelName:Ec,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{alpha:o}=e,i=Jn(r,0);return{x:()=>fn(i,t,V(t,o))}}};var Pz={kernelName:Va,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,oe(e,1))}}};var Lz={kernelName:$a,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,pe(e,"float32"))}}};var $z={kernelName:RV,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e;return{logits:()=>{let s=Ar(r);return Se(t,V(Ce(t,o,!0),s))}}}};function Ype(t,n,e,r=5,o=1,i=1,s=.5){let a={x:t,y:n,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return k.runKernel(tm,a,l)}var Vz=A({localResponseNormalizationBackprop_:Ype});var Bz={kernelName:Sc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>Vz(r,o,t,i,s,a,l)}}};function Bw(t,n,e,r){return n.rank<e.rank&&(n=B(n,Ds(n.shape,r))),t.rank<e.rank&&(t=B(t,Ds(t.shape,r))),{x:()=>V(t,pe(ci(e,n),t.dtype))}}var ak={kernelName:Tc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{reductionIndices:o}=r,i=n[0],s=n[1],a=kn(o,i.shape),l=Bw(t,s,i,a);return{x:()=>l.x()}}};var zz={kernelName:Ba,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,pe($o(e,r),"float32")),b:()=>V(t,pe(Tw(e,r),"float32"))}}};function Zpe(t,n,e,r,o,i,s){let a=N(t,"dy","maxPool3dGrad"),l=N(n,"input","maxPool3dGrad"),c=N(e,"output","maxPool3dGrad"),u=a,d=l,p=c,f=!1;l.rank===4&&(f=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=B(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=B(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),F(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),F(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),F(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),s!=null&&F(_t(i),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let m={dy:u,input:d,output:p},h={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=k.runKernel(rm,m,h);return f?B(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var Uz=A({maxPool3dGrad_:Zpe});var jz={kernelName:Nc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>Uz(t,r,o,i,s,a,l)}}};function Qpe(t,n,e,r,o,i,s){let a=N(t,"dy","maxPoolGrad"),l=N(n,"input","maxPoolGrad"),c=N(e,"output","maxPoolGrad");F(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),F(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),F(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),s!=null&&F(_t(i),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return k.runKernel(nm,u,d)}var Gz=A({maxPoolGrad_:Qpe});var Wz={kernelName:Dc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a}=e;return{x:()=>Gz(t,r,o,i,s,a)}}};var Hz={kernelName:kc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=kn(o,r.shape),a=kN(r.shape,i)[1],l=$t(a);return{x:()=>{let u=r.shape.slice();i.forEach(f=>{u[f]=1});let d=B(t,u);return ye(V(d,vo(r.shape,"float32")),l)}}}};var qz={kernelName:Ac,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{axis:o}=r,[i,s]=n,a=kn(o,i.shape),l=Bw(t,s,i,a);return{x:()=>l.x()}}};var Kz={kernelName:za,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,pe(Ss(e,r),"float32")),b:()=>V(t,pe(Jn(e,r),"float32"))}}};var Xz={kernelName:Rc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>lt(t,i,r.shape)}}};var Yz={kernelName:Ua,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=Vt(e.shape,o);return a.length>0?B(Ce(t,a),e.shape):t},b:()=>{let a=V(t,Et(ml(ye(e,r)))),l=Vt(r.shape,o);return l.length>0?B(Ce(a,l),r.shape):a}}}};var Zz={kernelName:ja,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=V(t,pe(r,"float32")),l=Vt(e.shape,o);return l.length>0?B(Ce(a,l),e.shape):a},b:()=>{let a=V(t,pe(e,"float32")),l=Vt(r.shape,o);return l.length>0?B(Ce(a,l),r.shape):a}}}};var Qz={kernelName:Mc,gradFunc:t=>({x:()=>Et(t)})};var Jz={kernelName:Oc,inputsToSave:["indices"],gradFunc:(t,n)=>{let e=n[0];return{indices:()=>Wt(e.shape,"float32")}}};var e4={kernelName:Fc,gradFunc:t=>({x:()=>De(t)})};var t4={kernelName:Pc,saveAllInputs:!0,gradFunc:(t,n,e)=>{let{axis:r}=e;return qr(t,r).map(i=>()=>i)}};var lk={kernelName:Lc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>lt(t,i,r.shape)}}};var n4={kernelName:Ga,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,n)=>{let[e,r,o]=n,i=e,s=r,a=He(i.shape,s.shape);return{a:()=>{let u=pe(s,"float32"),d=V(t,V(u,ui(i,Se(u,Fe(1))))),p=Vt(i.shape,a);return p.length>0&&(d=Ce(d,p)),B(d,i.shape)},b:()=>{let u=Jn(i,0),d=fn(u,Rr(i),De(i)),p=V(t,V(o,d)),f=Vt(s.shape,a);return f.length>0&&(p=Ce(p,f)),B(p,s.shape)}}}};var r4={kernelName:$c,inputsToSave:["x","alpha"],gradFunc:(t,n)=>{let[e,r]=n,o=Jn(e,0);return{x:()=>fn(o,t,V(t,r)),alpha:()=>{let i=fn(o,De(t),V(t,e)),s=Vt(r.shape,t.shape);return s.length>0&&(i=Ce(i,s)),B(i,r.shape)}}}};var o4={kernelName:Ta,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=ye(t,pe(r,"float32")),l=Vt(e.shape,o);return l.length>0?B(Ce(a,l),e.shape):a},b:()=>{let a=V(t,pe(e,"float32")),l=Vt(r.shape,o);l.length>0&&(a=B(Ce(a,l),r.shape));let c=Xe(r);return Et(ye(a,pe(c,"float32")))}}}};var i4={kernelName:Wa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Et(Xe(e)))}}};var s4={kernelName:qa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(Ss(e,6),qi(e));return{x:()=>V(t,pe(r,"float32"))}}};var a4={kernelName:Ha,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,pe(qi(e),"float32"))}}};var l4={kernelName:Vc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>B(t,e.shape)}}};var c4={kernelName:zc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(lm,o,e)}}};var u4={kernelName:Bc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(am,o,e)}}};var d4={kernelName:Uc,gradFunc:(t,n,e)=>{let{dims:r}=e,o=kn(r,t.shape);return{x:()=>Bo(t,o)}}};var p4={kernelName:Ka,gradFunc:t=>({x:()=>De(t)})};var f4={kernelName:Xa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Et(ye(t,V(ui(e,1.5),2)))}}};var m4={kernelName:jc,inputsToSave:["condition"],gradFunc:(t,n)=>{let[e]=n;return{condition:()=>pe(De(e),"float32"),t:()=>V(t,pe(e,t.dtype)),e:()=>V(t,pe(km(e),t.dtype))}}};var h4={kernelName:Ya,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Jn(e,Fe(0)),o=Fe(rk),i=Fe(ok),s=V(t,i),a=V(V(t,o),Ar(pe(e,"float32")));return fn(r,s,a)}}}};var g4={kernelName:el,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(e,Se(Fe(1),e)))}}};var y4={kernelName:Ja,gradFunc:t=>({x:()=>De(t)})};var v4={kernelName:Za,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Vd(pe(e,"float32")),t)}}};var x4={kernelName:Qa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(xy(pe(e,"float32")),t)}}};var b4={kernelName:Gc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{begin:o,size:i}=e,s=r.shape,[a,l]=eN(r,o,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>Gd(t,c)}}};var w4={kernelName:Kc,outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{dim:o}=e,i=!0,s=V(t,r);return{logits:()=>Se(s,V(Ce(s,[o],i),r))}}};var C4={kernelName:tl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,li(e))}}};var ck={kernelName:Hc,gradFunc:(t,n,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>Sm(t,r,o)}}};var uk={kernelName:qc,gradFunc:(t,n,e)=>{let{axis:r}=e;return{x:()=>Gt(t,r)}}};var _4={kernelName:nl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,V(Ht(pe(e,"float32")),2))}}};var I4={kernelName:cm,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(pe(e,"float32"),2))}}};var E4={kernelName:rl,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Fe(2);return{a:()=>V(t,V(o,Se(e,r))),b:()=>V(t,V(o,Se(r,e)))}}};var S4={kernelName:al,gradFunc:t=>({x:()=>De(t)})};var T4={kernelName:ol,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=He(e.shape,r.shape);return{a:()=>{let a=t,l=Vt(e.shape,o);return l.length>0&&(a=Ce(a,l)),B(a,e.shape)},b:()=>{let a=t,l=Vt(r.shape,o);return l.length>0&&(a=Ce(a,l)),B(Et(a),r.shape)}}}};var D4={kernelName:Wc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,o=r.shape.slice(),{axis:i}=e;kn(i,r.shape).forEach(c=>{o[c]=1});let a=B(t,o),l=V(a,vo(r.shape,"float32"));return{x:()=>l}}};var N4={kernelName:il,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Xe(Vd(e)))}}};var k4={kernelName:sl,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Se(Fe(1),Xe(e)),t)}}};var A4={kernelName:_s,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{reps:o}=e;return{x:()=>{let s=De(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=oe(s,lt(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=oe(s,lt(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)s=oe(s,lt(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)s=oe(s,lt(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var R4={kernelName:Xc,gradFunc:(t,n,e)=>{let r=e,{perm:o}=r,i=Cy(o);return{x:()=>at(t,i)}}};var M4={kernelName:Yc,gradFunc:(t,n,e)=>{let r=e,{axis:o}=r;return{value:()=>cr(t,o)}}};var F4={kernelName:Zc,inputsToSave:["segmentIds"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Jpe(t,e)}}};function Jpe(t,n){let e=yo(n,De(n)),r=Bd(t,e),o=$o(n,Fe(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=lr(o,a+1);o=_r(o,vo(r.shape,"bool"));let s=De(r);return fn(o,r,s)}var O4={kernelName:Qc,gradFunc:t=>({x:()=>De(t)})};var efe=[Vw,zB,UB,jB,GB,WB,HB,qB,KB,XB,YB,ZB,JB,tz,nz,rz,oz,iz,sz,az,lz,cz,dz,uz,fz,mz,hz,gz,yz,vz,o4,xz,bz,wz,Cz,_z,Ez,Iz,Sz,Nz,kz,Az,Rz,Mz,Fz,Oz,Pz,Lz,$z,Bz,ak,ak,zz,jz,Wz,Hz,qz,Kz,Xz,Yz,Zz,Qz,Jz,e4,t4,lk,lk,n4,r4,i4,s4,a4,l4,c4,u4,d4,p4,f4,m4,h4,g4,y4,v4,x4,b4,w4,C4,ck,ck,uk,uk,_4,E4,I4,S4,T4,D4,N4,k4,A4,R4,M4,F4,O4];for(let t of efe)FV(t);P().prototype.abs=function(){return this.throwIfDisposed(),An(this)};P().prototype.acos=function(){return this.throwIfDisposed(),tN(this)};P().prototype.acosh=function(){return this.throwIfDisposed(),nN(this)};P().prototype.add=function(t){return this.throwIfDisposed(),oe(this,t)};P().prototype.all=function(t,n){return this.throwIfDisposed(),gy(this,t,n)};P().prototype.any=function(t,n){return this.throwIfDisposed(),Cm(this,t,n)};P().prototype.argMax=function(t){return this.throwIfDisposed(),_m(this,t)};P().prototype.argMin=function(t){return this.throwIfDisposed(),V3(this,t)};P().prototype.asScalar=function(){return this.throwIfDisposed(),F(this.size===1,()=>"The array must have only 1 element."),B(this,[])};P().prototype.asType=function(t){return this.throwIfDisposed(),pe(this,t)};P().prototype.as1D=function(){return this.throwIfDisposed(),B(this,[this.size])};P().prototype.as2D=function(t,n){return this.throwIfDisposed(),B(this,[t,n])};P().prototype.as3D=function(t,n,e){return this.throwIfDisposed(),B(this,[t,n,e])};P().prototype.as4D=function(t,n,e,r){return this.throwIfDisposed(),B(this,[t,n,e,r])};P().prototype.as5D=function(t,n,e,r,o){return this.throwIfDisposed(),B(this,[t,n,e,r,o])};P().prototype.asin=function(){return this.throwIfDisposed(),rN(this)};P().prototype.asinh=function(){return this.throwIfDisposed(),oN(this)};P().prototype.atan=function(){return this.throwIfDisposed(),iN(this)};P().prototype.atan2=function(t){return this.throwIfDisposed(),B3(this,t)};P().prototype.atanh=function(){return this.throwIfDisposed(),sN(this)};P().prototype.avgPool=function(t,n,e,r){return this.throwIfDisposed(),$d(this,t,n,e,r)};P().prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),Sm(this,t,n)};P().prototype.batchNorm=function(t,n,e,r,o){return this.throwIfDisposed(),ru(this,t,n,e,r,o)};P().prototype.broadcastTo=function(t){return this.throwIfDisposed(),Tm(this,t)};P().prototype.cast=function(t){return this.throwIfDisposed(),pe(this,t)};P().prototype.ceil=function(){return this.throwIfDisposed(),mN(this)};P().prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Qn(this,t,n)};P().prototype.concat=function(t,n){return this.throwIfDisposed(),t instanceof gt&&(t=[t]),Gt([this,...t],n)};P().prototype.conv1d=function(t,n,e,r,o,i){return this.throwIfDisposed(),yy(this,t,n,e,r,o,i)};P().prototype.conv2dTranspose=function(t,n,e,r,o){return this.throwIfDisposed(),vy(this,t,n,e,r,o)};P().prototype.conv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),go(this,t,n,e,r,o,i)};P().prototype.cos=function(){return this.throwIfDisposed(),Vd(this)};P().prototype.cosh=function(){return this.throwIfDisposed(),xy(this)};P().prototype.cumsum=function(t,n,e){return this.throwIfDisposed(),Ew(this,t,n,e)};P().prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),G3(this,t,n)};P().prototype.depthwiseConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),pl(this,t,n,e,r,o,i)};P().prototype.dilation2d=function(t,n,e,r,o){return this.throwIfDisposed(),W3(this,t,n,e,r,o)};P().prototype.divNoNan=function(t){return this.throwIfDisposed(),H3(this,t)};P().prototype.div=function(t){return this.throwIfDisposed(),ye(this,t)};P().prototype.dot=function(t){return this.throwIfDisposed(),q3(this,t)};P().prototype.elu=function(){return this.throwIfDisposed(),fl(this)};P().prototype.equal=function(t){return this.throwIfDisposed(),ci(this,t)};P().prototype.erf=function(){return this.throwIfDisposed(),wN(this)};P().prototype.exp=function(){return this.throwIfDisposed(),Ar(this)};P().prototype.expandDims=function(t){return this.throwIfDisposed(),lr(this,t)};P().prototype.expm1=function(){return this.throwIfDisposed(),CN(this)};P().prototype.fft=function(){return this.throwIfDisposed(),Ay(this)};P().prototype.flatten=function(){return this.throwIfDisposed(),B(this,[this.size])};P().prototype.floor=function(){return this.throwIfDisposed(),ml(this)};P().prototype.floorDiv=function(t){return this.throwIfDisposed(),Cw(this,t)};P().prototype.gather=function(t,n){return this.throwIfDisposed(),Bd(this,t,n)};P().prototype.greaterEqual=function(t){return this.throwIfDisposed(),$o(this,t)};P().prototype.greater=function(t){return this.throwIfDisposed(),Jn(this,t)};P().prototype.ifft=function(){return this.throwIfDisposed(),Om(this)};P().prototype.irfft=function(){return this.throwIfDisposed(),WN(this)};P().prototype.isFinite=function(){return this.throwIfDisposed(),_N(this)};P().prototype.isInf=function(){return this.throwIfDisposed(),IN(this)};P().prototype.isNaN=function(){return this.throwIfDisposed(),EN(this)};P().prototype.leakyRelu=function(t){return this.throwIfDisposed(),zd(this,t)};P().prototype.lessEqual=function(t){return this.throwIfDisposed(),Ss(this,t)};P().prototype.less=function(t){return this.throwIfDisposed(),Tw(this,t)};P().prototype.localResponseNormalization=function(t,n,e,r){return this.throwIfDisposed(),K3(this,t,n,e,r)};P().prototype.logSigmoid=function(){return this.throwIfDisposed(),DN(this)};P().prototype.logSoftmax=function(t){return this.throwIfDisposed(),wy(this,t)};P().prototype.logSumExp=function(t,n){return this.throwIfDisposed(),Y3(this,t,n)};P().prototype.log=function(){return this.throwIfDisposed(),Rr(this)};P().prototype.log1p=function(){return this.throwIfDisposed(),SN(this)};P().prototype.logicalAnd=function(t){return this.throwIfDisposed(),_r(this,t)};P().prototype.logicalNot=function(){return this.throwIfDisposed(),km(this)};P().prototype.logicalOr=function(t){return this.throwIfDisposed(),Dw(this,t)};P().prototype.logicalXor=function(t){return this.throwIfDisposed(),Z3(this,t)};P().prototype.matMul=function(t,n,e){return this.throwIfDisposed(),It(this,t,n,e)};P().prototype.maxPool=function(t,n,e,r){return this.throwIfDisposed(),Ud(this,t,n,e,r)};P().prototype.max=function(t,n){return this.throwIfDisposed(),er(this,t,n)};P().prototype.maximum=function(t){return this.throwIfDisposed(),yo(this,t)};P().prototype.mean=function(t,n){return this.throwIfDisposed(),qt(this,t,n)};P().prototype.min=function(t,n){return this.throwIfDisposed(),iu(this,t,n)};P().prototype.minimum=function(t){return this.throwIfDisposed(),jd(this,t)};P().prototype.mirrorPad=function(t,n){return this.throwIfDisposed(),Q3(this,t,n)};P().prototype.mod=function(t){return this.throwIfDisposed(),J3(this,t)};P().prototype.mul=function(t){return this.throwIfDisposed(),V(this,t)};P().prototype.neg=function(){return this.throwIfDisposed(),Et(this)};P().prototype.norm=function(t,n,e){return this.throwIfDisposed(),Pm(this,t,n,e)};P().prototype.notEqual=function(t){return this.throwIfDisposed(),su(this,t)};P().prototype.oneHot=function(t,n=1,e=0){return this.throwIfDisposed(),wm(this,t,n,e)};P().prototype.onesLike=function(){return this.throwIfDisposed(),Wn(this)};P().prototype.pad=function(t,n){return this.throwIfDisposed(),Gd(this,t,n)};P().prototype.pool=function(t,n,e,r,o){return this.throwIfDisposed(),eB(this,t,n,e,r,o)};P().prototype.pow=function(t){return this.throwIfDisposed(),ui(this,t)};P().prototype.prelu=function(t){return this.throwIfDisposed(),Wd(this,t)};P().prototype.prod=function(t,n){return this.throwIfDisposed(),tB(this,t,n)};P().prototype.reciprocal=function(){return this.throwIfDisposed(),UN(this)};P().prototype.relu=function(){return this.throwIfDisposed(),di(this)};P().prototype.relu6=function(){return this.throwIfDisposed(),Mw(this)};P().prototype.reshapeAs=function(t){return this.throwIfDisposed(),B(this,t.shape)};P().prototype.reshape=function(t){return this.throwIfDisposed(),B(this,t)};P().prototype.resizeBilinear=function(t,n,e){return this.throwIfDisposed(),RB(this,t,n,e)};P().prototype.resizeNearestNeighbor=function(t,n,e){return this.throwIfDisposed(),MB(this,t,n,e)};P().prototype.reverse=function(t){return this.throwIfDisposed(),Bo(this,t)};P().prototype.rfft=function(){return this.throwIfDisposed(),HN(this)};P().prototype.round=function(){return this.throwIfDisposed(),jN(this)};P().prototype.rsqrt=function(){return this.throwIfDisposed(),Iy(this)};P().prototype.selu=function(){return this.throwIfDisposed(),Ey(this)};P().prototype.separableConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Sy(this,t,n,e,r,o,i)};P().prototype.sigmoid=function(){return this.throwIfDisposed(),li(this)};P().prototype.sign=function(){return this.throwIfDisposed(),GN(this)};P().prototype.sin=function(){return this.throwIfDisposed(),Ty(this)};P().prototype.sinh=function(){return this.throwIfDisposed(),Dy(this)};P().prototype.slice=function(t,n){return this.throwIfDisposed(),lt(this,t,n)};P().prototype.softmax=function(t){return this.throwIfDisposed(),qd(this,t)};P().prototype.softplus=function(){return this.throwIfDisposed(),Ts(this)};P().prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),Rm(this,t,n)};P().prototype.split=function(t,n){return this.throwIfDisposed(),tr(this,t,n)};P().prototype.sqrt=function(){return this.throwIfDisposed(),Ht(this)};P().prototype.square=function(){return this.throwIfDisposed(),Xe(this)};P().prototype.squaredDifference=function(t){return this.throwIfDisposed(),yB(this,t)};P().prototype.squeeze=function(t){return this.throwIfDisposed(),Kd(this,t)};P().prototype.stack=function(t,n){this.throwIfDisposed();let e=t instanceof gt?[this,t]:[this,...t];return cr(e,n)};P().prototype.step=function(t){return this.throwIfDisposed(),qi(this,t)};P().prototype.stridedSlice=function(t,n,e,r,o,i,s,a){return this.throwIfDisposed(),qN(this,t,n,e,r,o,i,s,a)};P().prototype.sub=function(t){return this.throwIfDisposed(),Se(this,t)};P().prototype.sum=function(t,n){return this.throwIfDisposed(),Ce(this,t,n)};P().prototype.tan=function(){return this.throwIfDisposed(),KN(this)};P().prototype.tanh=function(){return this.throwIfDisposed(),Em(this)};P().prototype.tile=function(t){return this.throwIfDisposed(),Hi(this,t)};P().prototype.toBool=function(){return this.throwIfDisposed(),pe(this,"bool")};P().prototype.toFloat=function(){return this.throwIfDisposed(),pe(this,"float32")};P().prototype.toInt=function(){return this.throwIfDisposed(),pe(this,"int32")};P().prototype.topk=function(t,n){return this.throwIfDisposed(),vB(this,t,n)};P().prototype.transpose=function(t){return this.throwIfDisposed(),at(this,t)};P().prototype.unique=function(t){return this.throwIfDisposed(),xB(this,t)};P().prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Ow(this,t,n)};P().prototype.unstack=function(t){return this.throwIfDisposed(),qr(this,t)};P().prototype.where=function(t,n){return this.throwIfDisposed(),fn(t,this,n)};P().prototype.zerosLike=function(){return this.throwIfDisposed(),De(this)};var dk;function Sn(){return dk==null&&(dk=$3().epsilon()),dk}function Mr(){return"channelsLast"}var zo=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Fr=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},$=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Ae=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},zw=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}};function mi(t,n){if(Array.isArray(t)){let e=[];for(let r=0;r<n;r++)e=e.concat(t);return e}else{let e=new Array(n);return e.fill(t),e}}function Uo(t,n){if(!t)throw new zw(n)}function fk(t,n){let e=0;for(let r of t)r===n&&e++;return e}function Hn(t){return t.length===1?t[0]:t}function Ft(t){return Array.isArray(t)?t:[t]}function hi(t){let e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function gl(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(n,e)=>e.toUpperCase())}var fi={};function $m(t){if(t==null)return null;let n={};return n.className=t.getClassName(),n.config=t.getConfig(),n}function pk(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(n=>pk(n));else{let n=Object.keys(t);for(let e of n){let r=t[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[e]=r.value:pk(r))}}}function ks(t,n={},e={},r="object",o=!1){if(typeof t=="string"){let i=t,s;if(i in e)s=e[i];else if(i in fi)s=fi[i];else if(s=n[i],s==null)throw new $(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=t;if(i.className==null||i.config==null)throw new $(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in fi?[a,l]=fi.className:s in n&&([a,l]=n[s]),a==null)throw new $(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let c={};for(let f of Object.keys(fi))c[f]=fi[f];for(let f of Object.keys(e))c[f]=e[f];let u=i.config;u.customObjects=c;let d=Object.assign({},fi);for(let f of Object.keys(e))fi[f]=e[f];pk(i.config);let p=l(a,i.config,e,o);return fi=Object.assign({},d),p}else{let c=Object.assign({},fi);for(let d of Object.keys(e))fi[d]=e[d];let u=new a(i.config);return fi=Object.assign({},c),u}}}function tfe(t,n){return t<n?-1:t>n?1:0}function Oy(t,n){return-1*tfe(t,n)}function gi(t){if(t==null)return t;let n=[];for(let e of t)n.indexOf(e)===-1&&n.push(e);return n}function P4(t){if(t==null)throw new $(`Invalid value in obj: ${JSON.stringify(t)}`);for(let n in t)if(t.hasOwnProperty(n))return!1;return!0}function As(t,n,e){if(e!=null&&t.indexOf(e)<0)throw new $(`${e} is not a valid ${n}.  Valid values are ${t} or null/undefined.`)}function Uw(t,n,e=0,r=1/0){return Uo(e>=0),Uo(r>=e),Array.isArray(t)&&t.length>=e&&t.length<=r&&t.every(o=>typeof o===n)}function mn(t,n){Array.isArray(t)?(C.assert(t.length>0,()=>`${n} is unexpectedly an empty array.`),t.forEach((e,r)=>mn(e,`element ${r+1} of ${n}`))):C.assert(Number.isInteger(t)&&t>0,()=>`Expected ${n} to be a positive integer, but got ${L4(t)}.`)}function L4(t){return t===null?"null":Array.isArray(t)?"["+t.map(n=>L4(n)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function $4(t,n){let e=C.now(),r;return(...i)=>{let s=C.now();return s-e<n||(e=s,r=t(...i)),r}}function jw(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}function mk(t,n){return j(()=>Ht(Ce(V(t,t),n,!0)))}var tp=class extends Q.Serializable{getConfig(){return{}}},z4=(()=>{class t extends tp{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>{let r=mk(e,this.axis),o=Qn(r,0,this.maxValue);return V(e,ye(o,oe(Sn(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return t.className="MaxNorm",t})();Q.registerClass(z4);var U4=(()=>{class t extends tp{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>ye(e,oe(Sn(),mk(e,this.axis))))}getConfig(){return{axis:this.axis}}}return t.className="UnitNorm",t})();Q.registerClass(U4);var j4=(()=>{class t extends tp{apply(e){return di(e)}}return t.className="NonNeg",t})();Q.registerClass(j4);var G4=(()=>{class t extends tp{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>{let r=mk(e,this.axis),o=oe(V(this.rate,Qn(r,this.minValue,this.maxValue)),V(1-this.rate,r));return V(e,ye(o,oe(Sn(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return t.className="MinMaxNorm",t})();Q.registerClass(G4);var V4={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function en(t){return $m(t)}function B4(t,n={}){return ks(t,Q.SerializationMap.getMap().classNameMap,n,"constraint")}function tn(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in V4?V4[t]:t,config:{}};return B4(e)}else return t instanceof tp?t:B4(t)}var W4=["channelsFirst","channelsLast"],H4=["nearest","bilinear"],q4=["valid","same","causal"],K4=["max","avg"],X4=["sum","mul","concat","ave"];var Vm=new Map;function Kt(t){As(W4,"DataFormat",t)}function Z4(t){As(H4,"InterpolationFormat",t)}function Or(t){As(q4,"PaddingMode",t)}function hk(t){As(K4,"PoolMode",t)}var Py=[],Y4="/";function Xi(t,n){Py.push(t);try{let e=n();return Py.pop(),e}catch(e){throw Py.pop(),e}}function rfe(){return Py.length===0?"":Py.join(Y4)+Y4}function Gw(t){if(!Q4(t))throw new Error("Not a valid tensor name: '"+t+"'");return rfe()+t}function Ww(t){if(!Q4(t))throw new Error("Not a valid tensor name: '"+t+"'");Vm.has(t)||Vm.set(t,0);let n=Vm.get(t);if(Vm.set(t,Vm.get(t)+1),n>0){let e=`${t}_${n}`;return Vm.set(e,1),e}else return t}var ofe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function Q4(t){return!!t.match(ofe)}function J4(t){return t===parseInt(t.toString(),10)}function yi(t,n,e){n==null&&(n=0),e==null&&(e=t.length);let r=1;for(let o=n;o<e;++o)r*=t[o];return r}function eU(t){return t=Array.isArray(t)?new Float32Array(t):t,pi(t)}function np(t){return iu(eU(t)).dataSync()[0]}function Yi(t){return er(eU(t)).dataSync()[0]}function Ir(t,n){if(n<t)throw new $(`end (${n}) < begin (${t}) is forbidden.`);let e=[];for(let r=t;r<n;++r)e.push(r);return e}function vl(t,n){return t.asType(n)}function xl(t,n=-1){let e=t.shape.slice();return n<0&&(n=e.length+n+1),e.splice(n,0,1),t.reshape(e)}function tU(t,n){return j(()=>{if(t.shape.length!==2)throw new $(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let e=xl(t,1);return qw(e,[1,n,1])})}function nU(t){let n=[yi(t.shape)];return t.reshape(n)}function rU(t){if(t.rank<=1)throw new $(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let n=[t.shape[0],yi(t.shape,1)];return t.reshape(n)}function yl(t,n,e){return j(()=>{switch(t.rank){case 1:return Ny(t,n,e);case 2:return Fw(t,[n,0],[e,t.shape[1]]);case 3:return ky(t,[n,0,0],[e,t.shape[1],t.shape[2]]);case 4:return Fm(t,[n,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3]]);case 5:return lt(t,[n,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return lt(t,[n,0,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new $(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function gk(t,n,e){return j(()=>{switch(t.rank){case 1:return Ny(t,n,e);case 2:return Fw(t,[0,n],[t.shape[0],e]);case 3:return ky(t,[0,0,n],[t.shape[0],t.shape[1],e]);case 4:return Fm(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],e]);default:throw new $(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Ly(t,n,e,r){return j(()=>{switch(t.rank){case 1:return Ny(t,n,e);case 2:switch(r){case 1:return yl(t,n,e);case 2:return gk(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return yl(t,n,e);case 2:return ky(t,[0,n,0],[t.shape[0],e,t.shape[2]]);case 3:return gk(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return yl(t,n,e);case 2:return Fm(t,[0,n,0,0],[t.shape[0],e,t.shape[2],t.shape[3]]);case 3:return Fm(t,[0,0,n,0],[t.shape[0],t.shape[1],e,t.shape[3]]);case 4:return gk(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}default:throw new $(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Bm(t,n=-1){let e;return n<0&&(e=t[0].rank,e!==0?n=e:n=0),n===t[0].rank&&(n=-1),Gt(t,n)}function vk(t,n){switch(t.rank){case 1:return hN([t,n]);case 2:return gN([t,n],0);case 3:return yN([t,n],0);case 4:return vN([t,n],0);default:throw new $(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function qw(t,n){if(Array.isArray(n)||(n=[n]),t.rank!==n.length)throw new $(`The length of input n (${n.length}) does not match the number of dimensions in input x (${t.rank})`);return Hi(t,n)}function zm(t,n=0,e=1,r,o){return Rw(t,n,e,r,o)}function vi(t,n,e,r){if(t.rank<2||n.rank<2)throw new Ae(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${n.shape}`);if(n.rank>=3){let o=t.shape.slice(-1)[0],i=n.shape.slice(-2)[0];if(o!==i)throw new Ae(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${n.shape}`)}if(t.rank===2&&n.rank===2)return Jd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?yk(t.rank,r,Mr()):null,activation:e});{let o=t.shape.slice(),i=o.pop();t=t.reshape([-1,i]);let s=n.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:n.rank},(m,h)=>h===0?n.rank-2:h<=n.rank-2?h-1:h);n=n.transpose(u).reshape([l,-1]);let d=[...o,...c];return Jd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?yk(t.rank,r,Mr()):null,activation:e}).reshape(d)}}function Kw(t,n,e){return j(()=>(Array.isArray(n)?n=pi(n,"int32"):n=n.toInt(),Bd(t,n,e)))}function rp(t){return V(t,t)}function yk(t,n,e){let r=n.shape;if(n.rank!==1&&n.rank!==t)throw new $(`Unexpected bias dimensions: ${n.rank}; expected it to be 1 or ${t}`);if(t===5){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1,1]):n.reshape([1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===4){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1]):n.reshape([1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===3){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1]):n.reshape([1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,r[0]]):n.reshape([1].concat(r))}else if(t<3)return n;throw new $(`Unsupported input rank by biasAdd: ${n.rank}`)}function Pr(t,n,e){return j(()=>(e==null&&(e=Mr()),Kt(e),t.add(yk(t.rank,n,e))))}function oU(t,n=1){if(n!==1)throw new Ae(`Support for alpha values other than 1 (${n}) is not implemented yet.`);return fl(t)}function iU(t){return j(()=>ye(t,An(t).add(1)))}function Xw(t,n,e,r){return j(()=>_B(t,n,e,r))}function sU(t){return j(()=>{let n=oe(.5,V(.2,t));return Qn(n,0,1)})}function lu(t,n,e=!1){return e?t():n()}var aU=["fanIn","fanOut","fanAvg"],lU=["normal","uniform","truncatedNormal"];function ife(t){As(aU,"FanMode",t)}function sfe(t){As(lU,"Distribution",t)}var $r=class extends Q.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},dU=(()=>{class t extends $r{apply(e,r){return Wt(e,r)}}return t.className="Zeros",t})();Q.registerClass(dU);var Yw=(()=>{class t extends $r{apply(e,r){return vo(e,r)}}return t.className="Ones",t})();Q.registerClass(Yw);var pU=(()=>{class t extends $r{constructor(e){if(super(),typeof e!="object")throw new $(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new $(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return j(()=>V(Fe(this.value),vo(e,r)))}getConfig(){return{value:this.value}}}return t.className="Constant",t})();Q.registerClass(pU);var fU=(()=>{class t extends $r{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return hl(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return t.className="RandomUniform",t})();Q.registerClass(fU);var mU=(()=>{class t extends $r{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ae(`randomNormal does not support dType ${r}.`);return zm(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="RandomNormal",t})();Q.registerClass(mU);var hU=(()=>{class t extends $r{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ae(`truncatedNormal does not support dType ${r}.`);return Ry(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="TruncatedNormal",t})();Q.registerClass(hU);var gU=(()=>{class t extends $r{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return j(()=>{if(e.length!==2||e[0]!==e[1])throw new $("Identity matrix initializer can only be used for 2D square matrices.");return V(this.gain,Nm(e[0]))})}getConfig(){return{gain:this.gain}}}return t.className="Identity",t})();Q.registerClass(gU);function afe(t,n="channelsLast"){let e,r;if(Kt(n),t.length===2)e=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(n==="channelsFirst"){let o=yi(t,2);e=t[1]*o,r=t[0]*o}else if(n==="channelsLast"){let o=yi(t,0,t.length-2);e=t[t.length-2]*o,r=t[t.length-1]*o}}else{let o=yi(t);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var xo=(()=>{class t extends $r{constructor(e){if(super(),e.scale<0)throw new $(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,ife(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,sfe(this.distribution),this.seed=e.seed}apply(e,r){let o=afe(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ae(`${this.getClassName()} does not support dType ${r}.`);return Ry(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return hl(e,-l,l,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return t.className="VarianceScaling",t})();Q.registerClass(xo);var xk=(()=>{class t extends xo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xo.className}}return t.className="GlorotUniform",t})();Q.registerClass(xk);var bk=(()=>{class t extends xo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xo.className}}return t.className="GlorotNormal",t})();Q.registerClass(bk);var wk=(()=>{class t extends xo{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xo.className}}return t.className="HeNormal",t})();Q.registerClass(wk);var Ck=(()=>{class t extends xo{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xo.className}}return t.className="HeUniform",t})();Q.registerClass(Ck);var _k=(()=>{class t extends xo{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return xo.className}}return t.className="LeCunNormal",t})();Q.registerClass(_k);var Ik=(()=>{class t extends xo{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return xo.className}}return t.className="LeCunNormal",t})();Q.registerClass(Ik);var yU=(()=>{class t extends $r{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Ae("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return j(()=>{if(e.length<2)throw new Ae("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let o=e[0]>e[1]?[e[1],e[0]]:e,i=zm(o,0,1,"float32"),s=$B.gramSchmidt(i);return e[0]>e[1]&&(s=s.transpose()),V(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}}return t.className="Orthogonal",t})();Q.registerClass(yU);var cU={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function uU(t,n={}){return ks(t,Q.SerializationMap.getMap().classNameMap,n,"initializer")}function Bt(t){return $m(t)}function At(t){if(typeof t=="string"){let n=t in cU?cU[t]:t;if(n==="GlorotNormal")return new bk;if(n==="GlorotUniform")return new xk;if(n==="HeNormal")return new wk;if(n==="HeUniform")return new Ck;if(n==="LeCunNormal")return new _k;if(n==="LeCunUniform")return new Ik;{let e={};return e.className=n,e.config={},uU(e)}}else return t instanceof $r?t:uU(t)}var cfe=0;function Qw(){return cfe++}var Zw={};function cu(t=""){return t in Zw||(Zw[t]=0),Zw[t]+=1,t+Zw[t].toString()}function Jw(t){return Array.isArray(t)&&Array.isArray(t[0])}function Um(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ve(t){let n;if(Array.isArray(t)){if(t.length!==1)throw new $(`Expected Tensor length to be 1; got ${t.length}`);n=t[0]}else n=t;return n}function tt(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new $(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function jm(t){let n=0;for(let e of t)e.shape.length===0?n+=1:n+=e.shape.reduce((r,o)=>r*o);return n}var xU="Variable",$y=class{constructor(n,e="float32",r=xU,o=!0,i=null){this.dtype=e??"float32",this.shape=n.shape,this.id=Qw(),r=r??xU,this.originalName=Gw(r),this.name=Ww(this.originalName),this.trainable_=o,this.constraint=i,this.val=XN(n,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(n){return this.assertNotDisposed(),dfe(this.val,n),this.val.id!==n.id&&(this.val.assign(n),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(n){this.trainable_=n,this.val.trainable=n}};function dfe(t,n){if(t.shape.toString()!==n.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(n.shape))}function Vy(t){return t.map(n=>n.read())}function Gm(t){t.forEach(n=>{n[0].write(n[1])})}var Ot=class{constructor(n){this.dtype=n.dtype,this.shape=n.shape,n.shape!=null?this.ndim=n.shape.length:this.ndim=n.ndim,this.maxNDim=n.maxNDim,this.minNDim=n.minNDim,this.axes=n.axes||{}}},Er=class{constructor(n,e,r,o,i,s,a){this.dtype=n,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=Qw(),s!=null&&(this.originalName=Gw(s),this.name=Ww(this.originalName)),this.rank=e.length}},pfe=0,bl=class{constructor(n,e){this.callArgs=e,this.id=pfe++,this.outboundLayer=n.outboundLayer,this.inboundLayers=n.inboundLayers,this.nodeIndices=n.nodeIndices,this.tensorIndices=n.tensorIndices,this.inputTensors=n.inputTensors,this.outputTensors=n.outputTensors,this.inputMasks=n.inputMasks,this.outputMasks=n.outputMasks,this.inputShapes=n.inputShapes,this.outputShapes=n.outputShapes;for(let r of n.inboundLayers)r?.outboundNodes.push(this);n.outboundLayer.inboundNodes.push(this)}getConfig(){let n=[];for(let e of this.inboundLayers)e!=null?n.push(e.name):n.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},ffe=0,Ge=class extends Q.Serializable{constructor(n={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=ffe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=n.name;if(!e){let r=this.getClassName();e=hi(r)+"_"+cu(r)}if(this.name=e,this.trainable_=n.trainable==null?!0:n.trainable,n.inputShape!=null||n.batchInputShape!=null){let r;if(n.batchInputShape!=null)r=n.batchInputShape;else if(n.inputShape!=null){let i=null;n.batchSize!=null&&(i=n.batchSize),r=[i].concat(n.inputShape)}this.batchInputShape=r;let o=n.dtype;o==null&&(o=n.inputDType),o==null&&(o="float32"),this.dtype=o}n.weights!=null?this.initialWeights=n.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(n,e){return n.name+"_ib-"+e.toString()}getNodeAtIndex(n,e){if(this.inboundNodes.length===0)throw new Fr(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=n)throw new $(`Asked to get ${e} at node ${n}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[n]}getInputAt(n){return Hn(this.getNodeAtIndex(n,"input").inputTensors)}getOutputAt(n){return Hn(this.getNodeAtIndex(n,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new zo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new zo(`Layer ${this.name} is not connected, no input to return.`);return Hn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new zo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new zo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Hn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(n=>n())}get updates(){return this._updates}get built(){return this._built}set built(n){this._built=n}get trainable(){return this.trainable_}set trainable(n){this._trainableWeights.forEach(e=>e.trainable=n),this.trainable_=n}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(n=>n.trainable):[]}set trainableWeights(n){this._trainableWeights=n}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(n=>!n.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(n){this._nonTrainableWeights=n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(n){if(n=Ft(n),this.inputSpec==null||this.inputSpec.length===0)return;let e=Ft(this.inputSpec);if(n.length!==e.length)throw new $(`Layer ${this.name} expects ${e.length} inputs, but it received ${n.length} input tensors. Input received: ${n}`);for(let r=0;r<n.length;r++){let o=n[r],i=e[r];if(i==null)continue;let s=o.rank;if(i.ndim!=null&&s!==i.ndim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(i.maxNDim!=null&&s>i.maxNDim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(i.minNDim!=null&&s<i.minNDim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new $(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){let a=o.shape;for(let l in i.axes){let c=Number(l),u=i.axes[l],d=c>=0?a[c]:a[a.length+c];if(u!=null&&[u,null].indexOf(d)===-1)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${a}.`)}}if(i.shape!=null)for(let a=0;a<i.shape.length;++a){let l=i.shape[a],c=o.shape[a];if(l!=null&&c!=null&&l!==c)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(n,e){return n}invokeCallHook(n,e){this._callHook!=null&&this._callHook(n,e)}setCallHook(n){this._callHook=n}clearCallHook(){this._callHook=null}apply(n,e){e=e||{},this.assertNotDisposed();let r=Ft(n),o=!0;for(let s of r)if(!(s instanceof Er)){o=!1;break}let i=!0;for(let s of r)if(s instanceof Er){i=!1;break}if(o===i)throw new $("Arguments to apply() must be all SymbolicTensors or all Tensors");return Xi(this.name,()=>{if(!this.built){this.assertInputCompatibility(n);let s=[];for(let a of Ft(n))s.push(a.shape);this.build(Hn(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(n),i){let s=this.call(n,e),a=Ft(s),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=Hn(l),this.activityRegularizer!=null)throw new Ae("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=mfe(n),a=this.computeOutputShape(s),l,c=hfe(n);if(this.warnOnIncompatibleInputShape(Array.isArray(n)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new Er(c,u,this,Ft(n),e,this.name,d)):l=new Er(c,a,this,Ft(n),e,this.name),this.addInboundNode(n,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new Ae("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(n){if(this.batchInputShape!=null)if(n.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(n)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&n[o]!=null&&n[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(n)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new zo(`The layer ${this.name} has never been called and thus has no defined output shape.`);let n=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);n.indexOf(r)===-1&&n.push(r)}if(n.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new zo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Fr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return jm(this.weights)}build(n){this.built=!0}getWeights(n=!1){return Vy(n?this.trainableWeights:this.weights)}setWeights(n){j(()=>{let e=this.weights;if(e.length!==n.length)throw new $(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${n.length}, but the layer was expecting ${e.length} weights. Provided weights: ${n}...`);if(e.length===0)return;let r=[],o=Vy(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=n[i];if(!C.arraysEqual(s.shape,l.shape))throw new $(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}Gm(r)})}addWeight(n,e,r,o,i,s,a){if(this._addedWeightNames.indexOf(n)!==-1)throw new $(`Duplicate weight name ${n} for layer ${this.name}`);this._addedWeightNames.push(n),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=At("zeros"));let l=o.apply(e,r),c=new $y(l,r,n,s,a);return l.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),s==null&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(n){this.fastWeightInitDuringBuild=n}addLoss(n){n==null||Array.isArray(n)&&n.length===0||(n=Ft(n),this._losses!==void 0&&this._losses!==null&&this.losses.push(...n))}computeOutputShape(n){return n}computeMask(n,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(n,e,r,o,i,s,a=null){let l=Ft(n);e=Ft(e),r=Ft(r),o=Ft(o),i=Um(i),s=Um(s);let c=[],u=[],d=[];for(let p of l)c.push(p.sourceLayer),u.push(p.nodeIndex),d.push(p.tensorIndex);new bl({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let p=0;p<e.length;p++)e[p].sourceLayer=this,e[p].nodeIndex=this.inboundNodes.length-1,e[p].tensorIndex=p}getConfig(){let n={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(n.batchInputShape=this.batchInputShape),this.dtype!=null&&(n.dtype=this.dtype),n}disposeWeights(){return this.weights.forEach(n=>n.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let n=0;return--this._refCount===0&&(n=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:n}}};function mfe(t){t=Ft(t);let n=[];for(let e of t)n.push(e.shape);return Hn(n)}function hfe(t){return"float32"}function Ek(t,n,e){if((n==null||e!=null&&e>0)&&(n=t.sourceLayer,e=t.nodeIndex),n.inboundNodes.length===0)return[t];{let r=n.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=Ek(s,a,l);for(let u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}var op=(()=>{class t extends Ge{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:cu("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new $("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new $("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new $("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new Er(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new bl({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new $(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return t.className="InputLayer",t})();Q.registerClass(op);function Sk(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new $("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let n=t.batchShape;t.shape!=null&&n==null&&(n=[null].concat(t.shape));let e=t.dtype;return e==null&&(e="float32"),new op({batchInputShape:n,name:t.name,dtype:e,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}async function wl(t){if(t==null)return;let n=[],e=[],r=[];for(let o in t){let i=t[o];if(typeof i!="number"){let s=i;n.push(s.data()),e.push(o),r.push(s)}}if(n.length>0){let o=await Promise.all(n);for(let i=0;i<o.length;++i)t[e[i]]=o[i][0];Pe(r)}}function eC(t){if(t!=null)for(let n in t){let e=t[n];typeof e!="number"&&e.dispose()}}var gfe=125,uu=class{constructor(){this.validationData=null}setParams(n){this.params=n}async onEpochBegin(n,e){}async onEpochEnd(n,e){}async onBatchBegin(n,e){}async onBatchEnd(n,e){}async onTrainBegin(n){}async onTrainEnd(n){}setModel(n){}},tC=class{constructor(n,e=10){n==null&&(n=[]),this.callbacks=n,this.queueLength=e}append(n){this.callbacks.push(n)}setParams(n){for(let e of this.callbacks)e.setParams(n)}setModel(n){for(let e of this.callbacks)e.setModel(n)}async onEpochBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochBegin(n,e)}async onEpochEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochEnd(n,e)}async onBatchBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchBegin(n,e)}async onBatchEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchEnd(n,e)}async onTrainBegin(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainBegin(n)}async onTrainEnd(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainEnd(n)}},Tk=class extends uu{constructor(){super()}async onEpochBegin(n){this.seen=0,this.totals={}}async onBatchEnd(n,e){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=j(()=>oe(this.totals[o],V(i,r)));this.totals[o]=a,s?.dispose()}}}async onEpochEnd(n,e){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:j(()=>{let o=V(ye(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),Gn(e[r])}))}},nC=class extends uu{async onTrainBegin(n){this.epoch=[],this.history={}}async onEpochEnd(n,e){e==null&&(e={}),this.epoch.push(n);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])}async syncData(){let n=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];n.push(l.data()),e.push(i),r.push(a)}}let o=await Promise.all(n);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]}},rC=class extends uu{constructor(n,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=gfe),this.yieldEvery==="never"&&n.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");C.isNumber(this.yieldEvery)&&(this.maybeWait=$4(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=n.onTrainBegin,this.trainEnd=n.onTrainEnd,this.epochBegin=n.onEpochBegin,this.epochEnd=n.onEpochEnd,this.batchBegin=n.onBatchBegin,this.batchEnd=n.onBatchEnd,this.yield=n.onYield}async maybeWait(n,e,r){let o=[];this.yield!=null&&(await wl(r),o.push(this.yield(n,e,r))),o.push(Fy()),await Promise.all(o)}async onEpochBegin(n,e){this.currentEpoch=n,this.epochBegin!=null&&(await wl(e),await this.epochBegin(n,e))}async onEpochEnd(n,e){let r=[];this.epochEnd!=null&&(await wl(e),r.push(this.epochEnd(n,e))),this.yieldEvery==="epoch"&&r.push(Fy()),await Promise.all(r)}async onBatchBegin(n,e){this.batchBegin!=null&&(await wl(e),await this.batchBegin(n,e))}async onBatchEnd(n,e){let r=[];this.batchEnd!=null&&(await wl(e),r.push(this.batchEnd(n,e))),this.yieldEvery==="batch"?r.push(Fy()):C.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,n,e)),await Promise.all(r)}async onTrainBegin(n){this.trainBegin!=null&&(await wl(n),await this.trainBegin(n))}async onTrainEnd(n){this.trainEnd!=null&&(await wl(n),await this.trainEnd(n))}};function oC(t,n){return t==null&&(t={}),t instanceof uu?[t]:Array.isArray(t)&&t[0]instanceof uu?t:Ft(t).map(r=>new rC(r,n))}var bU=(()=>{class t{constructor(){}static registerCallbackConstructor(e,r){C.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),t.checkForDuplicate(r),t.constructors[e]==null&&(t.constructors[e]=[]),t.constructors[e].push(r)}static checkForDuplicate(e){for(let r in t.constructors)t.constructors[+r].forEach(i=>{if(i===e)throw new $("Duplicate callback constructor.")})}static clear(){t.constructors={}}static createCallbacks(e){let r=[];for(let o in t.constructors){let i=+o;e>=i&&r.push(...t.constructors[i])}return r.map(o=>new o)}}return t.constructors={},t})();function iC(t,n,e,r,o,i,s,a,l){let c=new nC,u=[new Tk,...bU.createCallbacks(n)];t!=null&&u.push(...t),u.push(c);let d=new tC(u);return d.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:n,doValidation:a,metrics:l}),{callbackList:d,history:c}}function Kr(t,n={},e=!1){return ks(t,Q.SerializationMap.getMap().classNameMap,n,"layer",e)}function By(t,n){return j(()=>{t.dtype!=="float32"&&(t=t.asType("float32"));let e=Ce(rp(t),n,!0),r=by(e.shape,Sn()),o=Ht(yo(e,r));return ye(t,o)})}function ip(t,n){return j(()=>qt(rp(Se(n,t)),-1))}function Uy(t,n){return j(()=>qt(An(Se(n,t)),-1))}function jy(t,n){return j(()=>{let e=Se(t,n),r=Qn(An(t),Sn(),Number.MAX_VALUE),o=An(ye(e,r));return V(100,qt(o,-1))})}function yfe(t,n){return j(()=>{let e=Qn(n,Sn(),Number.MAX_VALUE),r=Rr(oe(1,e)),o=Qn(t,Sn(),Number.MAX_VALUE),i=Rr(oe(1,o));return qt(rp(Se(r,i)),-1)})}function vfe(t,n){return j(()=>{let e=yo(0,Se(1,V(t,n)));return qt(rp(e),-1)})}function xfe(t,n){return j(()=>{let e=yo(0,Se(1,V(t,n)));return qt(e,-1)})}function bfe(t,n){return j(()=>{let e=Ce(V(t,n),-1),r=er(V(Se(1,t),n),-1);return yo(0,oe(1,Se(r,e)))})}function wfe(t,n){return j(()=>{let e=Math.log(2),r=Se(n,t),o=Se(oe(r,Ts(V(-2,r))),e);return qt(o,-1)})}function sp(t,n,e=!1){return j(()=>{if(e)n=qd(n);else{let r=Ce(n,n.shape.length-1,!0);n=ye(n,r)}return n=Qn(n,Sn(),1-Sn()),Et(Ce(V(t.toFloat(),Rr(n)),n.shape.length-1))})}function Wm(t,n,e=!1){return j(()=>{let r=ml(nU(t)).toInt();n=Qn(n,Sn(),1-Sn());let o=n.shape,i=wm(r,o[o.length-1]).reshape(o);return sp(i,n,e)})}function Cfe(t,n){if(!C.arraysEqual(t.shape,n.shape))throw new $(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(n.shape)}`);return j(()=>{let e=n.relu(),r=n.abs().neg();return e.sub(n.mul(t)).add(r.exp().log1p())})}function Hm(t,n){return j(()=>{let e;return e=Qn(n,Sn(),1-Sn()),e=Rr(ye(e,Se(1,e))),qt(Cfe(t,e),-1)})}function _fe(t,n){return j(()=>{let e=Qn(t,Sn(),1),r=Qn(n,Sn(),1);return Ce(V(t,Rr(ye(e,r))),-1)})}function Ife(t,n){return j(()=>{let e=Rr(oe(Sn(),n));return qt(Se(n,V(t,e)),-1)})}function sC(t,n){return j(()=>{let e=By(t,-1),r=By(n,-1),o=V(e,r);return Et(Ce(o,-1))})}var zy={meanSquaredError:ip,meanAbsoluteError:Uy,meanAbsolutePercentageError:jy,meanSquaredLogarithmicError:yfe,squaredHinge:vfe,hinge:xfe,categoricalHinge:bfe,logcosh:wfe,categoricalCrossentropy:sp,sparseCategoricalCrossentropy:Wm,binaryCrossentropy:Hm,kullbackLeiblerDivergence:_fe,poisson:Ife,cosineProximity:sC};function aC(t){if(typeof t=="string"){if(t in zy)return zy[t];let n=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new $(n)}else return t}function cC(t,n){return j(()=>{let e=V(.5,Wn(n)),r=vl(Jn(n,e),t.dtype);return qt(ci(t,r),-1)})}function uC(t,n){return j(()=>vl(ci(_m(t,-1),_m(n,-1)),"float32"))}function Efe(t,n){return j(()=>_r(t.equal(1),n.equal(1)).sum().cast("float32"))}function Sfe(t,n){return j(()=>_r(t.equal(0),n.equal(1)).sum().cast("float32"))}function CU(t,n){return j(()=>{let e=Efe(t,n),r=Sfe(t,n),o=e.add(r);return fn(Jn(o,0),e.div(o),0).cast("float32")})}function Dk(t,n){return Hm(t,n)}function Nk(t,n){return t.rank===n.rank&&(t=t.squeeze([t.rank-1])),n=n.argMax(-1),n.dtype!==t.dtype&&(n=n.asType(t.dtype)),ci(t,n).asType("float32")}var Tfe=ip,Dfe=ip,Nfe=Uy,kfe=Uy,Afe=jy,Rfe=jy,dC=sp,Mfe=sC,kk=Wm,lC={binaryAccuracy:cC,categoricalAccuracy:uC,precision:CU,categoricalCrossentropy:dC,sparseCategoricalCrossentropy:kk,mse:Tfe,MSE:Dfe,mae:Nfe,MAE:kfe,mape:Afe,MAPE:Rfe,cosine:Mfe};function _U(t){if(typeof t=="string"&&t in lC)return lC[t];if(typeof t!="string"&&t!=null)return t;throw new $(`Unknown metric ${t}`)}function Gy(t){if(Uo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let n;for(let e of Object.keys(zy))if(zy[e]===t){n=e;break}if(n!==void 0)return n;for(let e of Object.keys(lC))if(lC[e]===t){n=e;break}return n!==void 0?n:t.name}}function EU(t){let n={Adagrad:()=>ep.adagrad(.01),Adadelta:()=>ep.adadelta(1,.95,Sn()),Adam:()=>ep.adam(.001,.9,.999,Sn()),Adamax:()=>ep.adamax(.002,.9,.999,Sn(),0),RMSProp:()=>ep.rmsprop(.001,.9,0,Sn()),SGD:()=>ep.sgd(.01)};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new $(`Unknown Optimizer ${t}`)}function Rk(t,n,e=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!Ak(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(t);r.length>1048576&&console.warn(`User-defined metadata of model "${n}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function Ak(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let n=Object.keys(t);for(let e of n)if(typeof e!="string"||!Ak(t[e]))return!1;return!0}else if(Array.isArray(t)){for(let n of t)if(!Ak(n))return!1;return!0}else return!1;else{let n=typeof t;return n==="string"||n==="number"||n==="boolean"}}function SU(t,n,e,r=console.log){let o=Pfe(t),i=["Layer (type)","Output shape","Param #"];o?(n=n||65,e=e||[.45,.85,1]):(n=n||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(n*u)));let s;if(!o){i.push("Receives inputs"),s=[];for(let u in t.nodesByDepth)s.push(...t.nodesByDepth[u])}r("_".repeat(n)),pC(i,e,r),r("=".repeat(n));let a=t.layers;for(let u=0;u<a.length;++u)o?Lfe(a[u],e,r):$fe(a[u],e,s,r),r((u===a.length-1?"=":"_").repeat(n));t.checkTrainableWeightsConsistency();let l=Ofe(t),c=jm(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(n))}function Ofe(t){let n;return t.collectedTrainableWeights!=null?n=jm(t.collectedTrainableWeights):n=jm(t.trainableWeights),n}function Pfe(t){let n=!0,e=[],r=[];for(let o in t.nodesByDepth)e.push(t.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){n=!1;break}r.push(...o)}if(n)for(let o of t.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){n=!1;break}else i=!0;if(!n)break}return n}function pC(t,n,e=console.log){let r="";for(let o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=t[o],r=r.slice(0,n[o]),r+=" ".repeat(n[o]-r.length);e(r)}function Lfe(t,n,e){let r;try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}let o=t.name,i=t.getClassName(),s=[`${o} (${i})`,r,t.countParams().toString()];pC(s,n,e)}function $fe(t,n,e,r){let o;try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let u of t.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(u)===-1))for(let d=0;d<u.inboundLayers.length;++d){let p=u.inboundLayers[d].name,f=u.nodeIndices[d],m=u.tensorIndices[d];i.push(`${p}[${f}][${m}]`)}let s=t.name,a=t.getClassName(),l=i.length===0?"":i[0],c=[`${s} (${a})`,o,t.countParams().toString(),l];pC(c,n,r);for(let u=1;u<i.length;++u)pC(["","","",i[u]],n,r)}function TU(t,n,e){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&n===0&&typeof e=="string"}function qm(t,n){if(t===null)return null;if(typeof t=="string")return gl(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];TU(n,o,i)?e.push(i):e.push(qm(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=gl(r);e[i]=qm(o,i)}}return e}}function fC(t,n){if(t==null)return null;if(typeof t=="string")return hi(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];TU(n,o,i)?e.push(i):e.push(fC(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r],i=hi(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=fC(o,r)}return e}}var Km="3.6.0";function Vfe(t,n){if(t.dtype==null||t.dtype===n.dtype)return n;try{return pe(n,t.dtype)}catch{throw new $(`The dtype of the feed (${n.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var Rs=class t{constructor(n){if(this.id2Value={},this.id2Mask={},this.name2Id={},n instanceof t)for(let e in n.id2Value)this.id2Value[e]=n.id2Value[e],e in n.id2Mask&&(this.id2Mask[e]=n.id2Mask[e]);else{if(n==null)return;for(let e of n)this.add(e.key,e.value)}}add(n,e,r){if(this.id2Value[n.id]==null)this.id2Value[n.id]=Vfe(n,e),this.name2Id[n.name]=n.id,r!=null&&(this.id2Mask[n.id]=r);else throw new $(`Duplicate key: name=${n.name}, id=${n.id}`);return this}addFeed(n){this.add(n.key,n.value)}hasKey(n){return this.id2Value[n.id]!=null}names(){return Object.keys(this.name2Id)}getValue(n){if(n instanceof Er){if(this.id2Value[n.id]==null)throw new $(`Nonexistent key: ${n.name}`);return this.id2Value[n.id]}else{let e=this.name2Id[n];if(e==null)throw new $(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Value[e]}}getMask(n){if(n instanceof Er){if(this.id2Value[n.id]==null)throw new $(`Nonexistent key: ${n.name}`);return this.id2Mask[n.id]}else{let e=this.name2Id[n];if(e==null)throw new $(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Pe(this.id2Mask)}},Mk={},DU={};function ap(t,n,e,r){let o=e==null?!1:e.training,i=Array.isArray(t),s=i?t:[t],a=s.map(m=>m.name),l=[],c=n.names();for(let m of a)c.indexOf(m)!==-1?l.push(n.getValue(m)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let u=a.join(",")+"|"+n.names().join(","),d,p;if(Mk[u]==null){let m=Bfe(s,n);d=m.sorted,p=m.recipientCounts,Mk[u]=d,DU[u]=p}d=Mk[u],p={},o||Object.assign(p,DU[u]);let f=new Rs(n);for(let m=0;m<d.length;++m){if(r!=null){let R=hy().numTensors;R>r.maxNumTensors&&(r.maxNumTensors=R),R<r.minNumTensors&&(r.minNumTensors=R)}let h=d[m],g=h.sourceLayer;if(g instanceof op)continue;let x=[],b=[],I=[],_=!1;for(let R of h.inputs){let L=f.getValue(R),G=f.getMask(R);x.push(L),b.push(G),G!=null&&(_=!0),o||(p[R.name]--,p[R.name]===0&&!n.hasKey(R)&&a.indexOf(R.name)===-1&&!L.isDisposed&&R.sourceLayer.stateful!==!0&&I.push(L))}_&&(e=e||{},e.mask=b[0]);let E=Ft(g.apply(x,e)),S=null;g.supportsMasking&&(S=g.computeMask(x,b));let D=Ufe(h),M=Array.isArray(D)?D:[D];for(let R=0;R<M.length;++R){f.hasKey(M[R])||f.add(M[R],E[R],Array.isArray(S)?S[0]:S);let L=a.indexOf(M[R].name);L!==-1&&(l[L]=E[R])}o||Pe(I)}return f.disposeMasks(),i?l:l[0]}function Bfe(t,n){C.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(t.length===1){let o=NU(t[0],n);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of t){let{sorted:s,recipientMap:a}=NU(i,n);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:e,recipientCounts:zfe(r)}}function zfe(t){let n={};for(let e in t)n[e]=t[e].size;return n}function NU(t,n){let e=new Set,r=[],o={};for(let a of n.names())e.add(a);let i=[],s=[];for(i.push(t);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:o}}function Ufe(t){let n;if(t.sourceLayer.inboundNodes.length===1)n=t.sourceLayer.output;else{let e=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(let o of t.sourceLayer.inboundNodes[r].outputTensors)if(o.id===t.id){e=r;break}n=t.sourceLayer.getOutputAt(e)}return n}var mC=class t extends Ge{constructor(n){if(super({}),this.containerNodes=new Set,this.name=n.name,this.name==null){let b=this.getClassName().toLowerCase();this.name=cu(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(n.inputs)?this.inputs=n.inputs.slice():this.inputs=[n.inputs],Array.isArray(n.outputs)?this.outputs=n.outputs.slice():this.outputs=[n.outputs],gi(this.inputs).length!==this.inputs.length)throw new $(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);gi(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let b of this.outputs){let I=b.sourceLayer,_=b.nodeIndex,E=b.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(_),this.outputLayersTensorIndices.push(E)}for(let b of this.inputs){let I=b.sourceLayer,_=b.nodeIndex,E=b.tensorIndex;Uo(_===0,"input layer has >1 nodes"),Uo(E===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(_),this.inputLayersTensorIndices.push(E)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){let I=this.inputLayers[b];if(!(I instanceof op))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${n.inputs}. Input ${b} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(let b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);let e={},r={},o={},i={},s={},a=[],l=(b,I,_,E,S,D)=>{(E==null||S==null||D==null)&&(E=b.sourceLayer,S=b.nodeIndex,D=b.tensorIndex);let M=E.inboundNodes[S];if(_.indexOf(M)!==-1)throw new Fr(`The tensor ${b.name} at layer "${E.name}" is part of a cycle.`);if(I.indexOf(M)!==-1)return;this.containerNodes.add(t.nodeKey(E,S)),E.id in s||(s[E.id]=Object.keys(s).length),_.indexOf(M)===-1&&_.push(M);let R=M.inboundLayers.length;for(let L=0;L<R;L++){let G=M.inputTensors[L],W=M.inboundLayers[L],q=M.nodeIndices[L],X=M.tensorIndices[L];l(G,I,_,W,q,X)}for(I.push(M);_.indexOf(M)>=0;)_.splice(_.indexOf(M),1);a.push(M)},c=[],u=[];for(let b of this.outputs)l(b,c,u);let d=a.slice().reverse();for(let b of d){r[b.id]=b,b.id in e||(e[b.id]=0);let I=e[b.id],_=o[b.outboundLayer.id]==null?0:o[b.outboundLayer.id];I=Math.max(I,_),o[b.outboundLayer.id]=I,i[b.outboundLayer.id]=b.outboundLayer,e[b.id]=I;for(let E=0;E<b.inboundLayers.length;E++){let S=b.inboundLayers[E],D=b.nodeIndices[E],M=S.inboundNodes[D],R=e[M.id]==null?0:e[M.id];e[M.id]=Math.max(I+1,R),r[M.id]=M}}let p={};for(let b in e){let I=e[b];I in p||(p[I]=[]),p[I].push(r[b])}let f={};for(let b in o){let I=o[b];I in f||(f[I]=[]),f[I].push(i[b])}let m=Object.keys(f).map(b=>parseInt(b,10)).sort(Oy);this.layers=[];for(let b of m){let I=f[b];I.sort((_,E)=>{let S=s[_.id],D=s[E.id];return S<D?-1:S>D?1:0});for(let _ of I)_ instanceof t&&this.internalContainerRefs.push(_),this.layers.push(_)}this.layersByDepth=f,m=Object.keys(p).map(b=>parseInt(b,10)).sort(Oy);let h=this.inputs.slice(),g=[];for(let b of m)for(let I of p[b]){let _=I.outboundLayer;if(_!=null){for(let E of I.inputTensors)if(h.indexOf(E)===-1)throw new Fr(`Graph disconnected: cannot obtain value for tensor ${E} at layer "${_.name}". The following previous layers were accessed without issue: ${g}`);for(let E of I.outputTensors)h.push(E);g.push(_.name)}}this.nodesByDepth=p;let x=this.layers.map(b=>b.name);for(let b of x){let I=x.filter(_=>_===b).length;if(I!==1)throw new Fr(`The name "${b}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new bl({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let n={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)n.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)n.numDisposedVariables+=e.dispose().numDisposedVariables}return n.refCountAfterDispose=this._refCount,n}get trainable(){return this.trainable_}set trainable(n){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=n)}),this.trainable_=n}get trainableWeights(){if(this._trainableWeights.length>0)throw new $("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let n=[];for(let e of this.layers)n=n.concat(e.trainableWeights);return n}get nonTrainableWeights(){let n=[];for(let e of this.layers)n.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(n)}return n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(n,e=!0){let r={},o=0;for(let s of this.layers)for(let a of s.weights){if(r[a.originalName]!=null)throw new $(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,o++}let i=[];for(let s in n){let a=s;if(r[s]==null){let l=s.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[a]!=null)i.push([r[a],n[s]]);else if(e)throw new $(`Provided weight data has no target variable: ${s}`);delete r[a]}if(e){let s=[];for(let a in r)s.push(a);if(s.length>0)throw new $(`${s.length} of ${o} weights are not set: ${s}`)}Gm(i)}updatedConfig(){let n=this.getConfig(),e={};return e.className=this.getClassName(),e.config=n,e.kerasVersion=`tfjs-layers ${Km}`,e.backend="TensorFlow.js",e}toJSON(n,e=!0){let r=fC(this.updatedConfig());return e?JSON.stringify(r):r}call(n,e){return j(()=>{n=Ft(n);let r=new Rs;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],n[o]);return ap(this.outputs,r,e)})}computeMask(n,e){return j(()=>{n=Ft(n);let r;return e==null?r=mi(null,n.length):r=Ft(e),this.runInternalGraph(n,r)[1]})}computeOutputShape(n){let e=Um(n);if(e.length!==this.inputLayers.length)throw new $(`Invalid inputShape argument ${n}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],c=e[a],u=l.name+"_0_0";r[u]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Oy);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let c of l){let u=c.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(u.id)!==-1)continue;let d=[];for(let h=0;h<c.inboundLayers.length;h++){let g=c.inboundLayers[h],x=c.nodeIndices[h],b=c.tensorIndices[h],I=`${g.name}_${x}_${b}`,_=r[I];d.push(_)}let p=u.computeOutputShape(Hn(d)),f=Um(p),m=u.inboundNodes.indexOf(c);for(let h=0;h<f.length;h++){let g=`${u.name}_${m}_${h}`;r[g]=f[h]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){let l=s[a];Uo(l in r),i.push(r[l])}return Hn(i)}runInternalGraph(n,e){e==null&&(e=mi(null,n.length));let r={};for(let l=0;l<this.inputs.length;++l){let c=this.inputs[l],u=n[l],d=e[l];r[c.id]=[u,d]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Oy);for(let l of o){let c=this.nodesByDepth[l];for(let u of c){let d=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,m=new Array;for(let h of p)h.id in r&&m.push(r[h.id]);if(m.length===p.length){let h={},g,x,b,I;if(u.callArgs!=null&&(h=u.callArgs),m.length===1){let[_,E]=m[0];h.mask==null&&(h.mask=E),b=Ft(d.call(_,h)),I=Ft(d.computeMask(_,E)),g=[_],x=[E]}else g=m.map(_=>_[0]),x=m.map(_=>_[1]),h.mask==null&&(h.mask=x),b=Ft(d.call(g,h)),I=Ft(d.computeMask(g,x));if(d.activityRegularizer)throw new Ae("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let _=0;_<f.length;++_){let E=f[_],S=b[_],D=I[_];r[E.id]=[S,D]}}}}let i=[],s=[],a=[];for(let l of this.outputs){Uo(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[c,u]=r[l.id];a.push(c.shape),i.push(c),s.push(u)}return[i,s,a]}buildNodeConversionMap(n){let e={},r;for(let o of this.layers){r=o instanceof t?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=t.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(n,e){if(e!=null){if(this.layers.length<=e)throw new $(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}else if(n==null)throw new $("Provide either a layer name or layer index");for(let r of this.layers)if(r.name===n)return r;throw new $(`No such layer: ${n}`)}calculateLosses(){return j(()=>{let n=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=t.nodeKey(e,r);this.containerNodes.has(o)&&n.push(...e.calculateLosses())}return n})}getConfig(){let n={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){let p=s.inboundNodes[d],f=t.nodeKey(s,d),m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){let h=[];for(let g=0;g<p.inboundLayers.length;g++){let x=p.inboundLayers[g],b=p.nodeIndices[g],I=p.tensorIndices[g],_=t.nodeKey(x,b),E=e[_];E==null&&(E=0),h.push([x.name,E,I,m])}c.push(h)}}}let u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}n.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.inputLayersTensorIndices[s];o.push([a.name,u,d])}n.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.outputLayersTensorIndices[s];i.push([a.name,u,d])}return n.outputLayers=i,n}static fromConfig(n,e,r={},o=!1){let i={},s={};function a(g,x){g.name in s?s[g.name].push(x):s[g.name]=[x]}function l(g,x){let b=[],I;for(let _ of x){let E=_[0],S=_[1],D=_[2];if(I=_[3]==null?{}:_[3],!(E in i)){a(g,x);return}let M=i[E];if(M.inboundNodes.length<=S){a(g,x);return}let R=M.inboundNodes[S];b.push(R.outputTensors[D])}b.length>0&&g.apply(Hn(b),I)}function c(g){let x=g.name,b=Kr(g,e.customObjects!=null?e.customObjects:{});b.setFastWeightInitDuringBuild(o),i[x]=b,g.inboundNodes.forEach(_=>{if(!(_ instanceof Array))throw new $(`Corrupted configuration, expected array for nodeData: ${_}`);a(b,_)})}let u=e.name,d=e.layers;for(let g of d)c(g);for(;!P4(s);)for(let g of d){let x=i[g.name];if(x.name in s){let b=s[x.name];delete s[x.name];for(let I of b)l(x,I)}}let p=[],f=[],m=e.inputLayers;for(let g of m){let x=g[0],b=g[1],I=g[2];Uo(x in i);let E=i[x].inboundNodes[b].outputTensors;p.push(E[I])}let h=e.outputLayers;for(let g of h){let x=g[0],b=g[1],I=g[2];Uo(x in i);let E=i[x].inboundNodes[b].outputTensors;f.push(E[I])}return new n({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new $("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let n of this.layers)if(n.stateful)return!0;return!1}resetStates(){j(()=>{this.layers.forEach(n=>{n.stateful&&n.resetStates()})})}};function jfe(t,n,e){let r=n.length;if(t==null||Array.isArray(t)&&t.length===0)return n.map(o=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&n[0]in t?[t[n[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${e} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return n.forEach(i=>{i in t?o.push(t[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${n} keys. Provided ${e} not understood: ${JSON.stringify(t)}`)}function hC(t,n){return jfe(t,n,"classWeight")}async function gC(t,n,e,r){if(n!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=j(()=>{if(t.shape.length===1)return t.clone();if(t.shape.length===2){if(t.shape[1]>1)return t.argMax(1);if(t.shape[1]===1)return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await o.data());Pe(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),pi(s,"float32")}else return null}function kU(t,n){return V(t,n)}var Gfe=32;function MU(t,n){let e,r,o=n;e=o.xs,r=o.ys,C.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${n}`);let i=AU("input",t.inputNames,e),s=AU("output",t.outputNames,r),a=i[0].shape[0];C.assert(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),C.assert(s.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)C.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<s.length;l++)C.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:s}}function AU(t,n,e){if(e instanceof gt)return[e];if(Array.isArray(e))return C.assert(e.length===n.length,()=>`Received an array of ${e.length} Tensors, but expected ${n.length} to match the ${t} keys ${n}.`),e;{let r=[];for(let o of n){if(e[o]==null)throw new $(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);r.push(e[o])}return r}}function Wfe(t){if(t.length===3)throw new Ae("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function FU(t,n,e){let r=e.batchesPerEpoch!=null;if(C.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),C.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),C.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),C.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),C.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(RU(e.validationData))C.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=Wfe(e.validationData);i=g.xs,s=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();let u=oC(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:p,history:f}=iC(u,d,e.epochs,null,null,Hfe(n,e),null,o,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,h=await n.iterator();for(;m<e.epochs;){let g={};await p.onEpochBegin(m);let x=0,b=0;for(r||(h=await n.iterator());!r||x<e.batchesPerEpoch;){let I=await h.next();if(r&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){let{xs:_,ys:E}=MU(t,I.value),S={};S.batch=b,S.size=_[0].shape[0],await p.onBatchBegin(b,S);let D=[];if(e.classWeight!=null){let L=hC(e.classWeight,t.outputNames);for(let G=0;G<L.length;++G)D.push(await gC(E[G],null,L[G]))}let M=_.concat(E).concat(D),R=a(M);Pe(M);for(let L=0;L<l.length;++L){let G=l[L],W=R[L];S[G]=W,Gn(W)}await p.onBatchEnd(b,S),eC(S),b++,x++}if(r?x>=e.batchesPerEpoch:I.done){if(o){let _;RU(e.validationData)?_=Ft(await t.evaluateDataset(e.validationData,{batches:e.validationBatches})):_=Ft(t.evaluate(i,s,{batchSize:e.validationBatchSize==null?Gfe:e.validationBatchSize,verbose:0}));for(let E=0;E<t.metricsNames.length;++E)g[`val_${t.metricsNames[E]}`]=_[E]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,g),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Hfe(t,n){let e=null;return n.batchesPerEpoch!=null?e=n.batchesPerEpoch:Number.isFinite(t.size)&&(e=t.size),e}function RU(t){return typeof t.iterator=="function"}function qfe(t){return typeof t.next=="function"}async function OU(t,n,e){e=e||{};let r=e.batches!=null,o=t.testFunction,i=[];if(e.verbose>0)throw new Ae("Verbose mode is not implemented yet.");C.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=qfe(n)?n:await n.iterator(),a=0,l=0;for(;!r||l<e.batches;){let c=await s.next();if(i=j(()=>{if(c.value){let{xs:u,ys:d}=MU(t,c.value),p=u.concat(d),f=j(()=>o(p));if(Pe(p),l===0)for(let h=0;h<f.length;++h)i.push(Fe(0));let m=p[0].shape[0];for(let h=0;h<f.length;++h){let g=f[h],x=i[h];i[h]=j(()=>oe(i[h],V(m,g))),l>0&&Pe(x)}Pe(f),a+=m,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){let u=i[c];i[c]=ye(i[c],a),Pe(u)}return Hn(i)}function yC(t){C.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Xm(t,n,e){return t==null?[null]:Array.isArray(t)?t.map(r=>yl(r,n,e-n)):yl(t,n,e-n)}function vC(t,n){return j(()=>t==null?null:Array.isArray(t)?t.map(e=>vC(e,n)):Kw(t,n.dtype==="int32"?n:n.toInt()))}function xC(t,n){let e=[],r=0,o=null;for(;r<t;)o=r+n,o>=t&&(o=t),e.push([r,o]),r=o;return e}async function Kfe(t,n,e,r,o,i,s,a,l,c,u,d,p,f,m){o==null&&(o=32),i==null&&(i=1),u==null&&(u=!0),p==null&&(p=0);let h=!1;if(l!=null&&c!=null&&(h=!0),m!=null&&(h=!0,f==null))throw new $("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=t.checkNumSamples(e,o,f,"steps_per_epoch"),x;g!=null&&(x=Ir(0,g)),s==null&&(s=1);let{callbackList:b,history:I}=iC(a,s,i,p,g,f,o,h,d);b.setModel(t),t.history=I,await b.onTrainBegin(),t.stopTraining_=!1;for(let _=p;_<i;++_){await b.onEpochBegin(_);let E={};if(f!=null)throw new Ae("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Ae("batch shuffling is not implemneted yet");u&&C.shuffle(x);let S=pi(x),D=xC(g,o);for(let M=0;M<D.length;++M){let R={};if(await b.onBatchBegin(M,R),j(()=>{let L=D[M][0],G=D[M][1],W=yl(S,L,G-L);R.batch=M,R.size=G-L;let q=vC(e,W),X=n(q);for(let K=0;K<r.length;++K){let Z=r[K],ae=X[K];R[Z]=ae,Gn(ae)}if(M===D.length-1&&h){let K=t.testLoop(l,c,o);for(let Z=0;Z<r.length;++Z){let ae=r[Z],ee=K[Z];Gn(ee),E["val_"+ae]=ee}}}),await b.onBatchEnd(M,R),eC(R),t.stopTraining_)break}S.dispose()}if(await b.onEpochEnd(_,E),t.stopTraining_)break}return await b.onTrainEnd(),await t.history.syncData(),t.history}async function PU(t,n,e,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;let o,i,s,a,l,c,u;try{let d=r.batchSize==null?32:r.batchSize;yC(d);let f=await t.standardizeUserData(n,e,r.sampleWeight,r.classWeight,!1,d);o=f[0],i=f[1],u=f[2];let m=!1,h;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)s=r.validationData[0],a=r.validationData[1];else throw r.validationData.length===3?new Ae("validationData including sample weights is not supported yet."):new $(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);let M=await t.standardizeUserData(s,a,null,null,!0,d);l=M[0],c=M[1],h=l.concat(c)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;let D=Math.floor(o[0].shape[0]*(1-r.validationSplit)),M=o[0].shape[0];l=Xm(o,D,M),o=Xm(o,0,D),c=Xm(i,D,M),i=Xm(i,0,D),h=l.concat(c)}else r.validationSteps!=null&&(m=!0);let g=o.concat(i).concat(u);t.checkTrainableWeightsConsistency();let x=t.makeTrainFunction(),b=t.getDedupedMetricsNames(),I,_;m?(t.makeTestFunction(),I=t.testFunction,_=b.slice().concat(b.map(D=>"val_"+D))):(I=null,h=[],_=b.slice());let E=oC(r.callbacks,r.yieldEvery);return await Kfe(t,x,g,b,d,r.epochs,r.verbose,E,I,h,r.shuffle,_,r.initialEpoch,null,null)}finally{t.isTraining=!1,du(o,n),du(i,e),du(l,s),du(c,a),u!=null&&Pe(u)}}function Fk(t){let n=[];t instanceof gt&&(t=[t]);for(let e=0;e<t.length;++e){let r=t[e];if(r.rank===1)n.push(xl(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(r)}}return n}function du(t,n){if(t==null)return;let e=[];if(n instanceof gt)e.push(n.id);else if(Array.isArray(n))n.forEach(o=>e.push(o.id));else if(n!=null)for(let o in n){let i=n[o];e.push(i.id)}let r=[];if(t instanceof gt)e.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(t!=null)for(let o in t){let i=t[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function Xfe(t){return t instanceof gt}function Ok(t){return Array.isArray(t)}function LU(t){return!Xfe(t)&&!Ok(t)}function $U(t,n,e,r=!0,o=""){if(n==null||n.length===0){if(t!=null){let s=!1;if(Ok(t)&&t.length>0)s=!0;else if(LU(t)){for(let a in t)if(t.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new $(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return n.map(s=>null);let i;if(LU(t)){t=t,i=[];for(let s of n){if(t[s]==null)throw new $(`No data provided for "${s}". Need data for each key in: ${n}`);i.push(t[s])}}else if(Ok(t)){if(t=t,t.length!==n.length)throw new $(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${n.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,n.length>1)throw new $(`The model ${o} expects ${n.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=Fk(i),e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new $(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u>=0&&c!==u)throw new $(`Error when checking ${o}: expected ${n[s]} to have shape [${e[s]}], but got array with shape [${a.shape}].`)}}return i}function Yfe(t,n,e){let r=gi(t.map(i=>i.shape[0]));r.sort();let o=gi(n.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new $(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(o.length>1)throw new $(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!C.arraysEqual(r,o))throw new $(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function Zfe(t,n,e){let r=[ip,Hm,sp];for(let o=0;o<t.length;++o){let i=t[o],s=n[o],a=e[o];if(s!=null){if(s===sp&&i.shape[i.shape.length-1]===1)throw new $(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){let d=l[u],p=c[u];if(p!=null&&d!==p)throw new $(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function VU(t,n,e,r=!0,o=""){let i;if(Array.isArray(t)){if(t.length!==n.length)throw new $(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${n.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(n.length>1)throw new $(`The model expects ${n.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new $(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u!==c)throw new $(`Error when checking ${o}: expected ${n[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Qfe(t,n){if(t==null||Array.isArray(t)&&t.length===0)return n.map(r=>[]);let e;if(typeof t=="string"||typeof t=="function")e=[t];else if(Array.isArray(t)||typeof t=="object")e=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(e))return n.map(r=>e);{let r=[];for(let o of n){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var Jfe="layers-model",Cl=(()=>{class t extends mC{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new $("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");SU(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=EU(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof ur))throw new $("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new $(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(aC(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new $(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>aC(l))}else{let a=aC(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Xi("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=Qfe(e.metrics,this.outputNames),s=(a,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,a])};Xi("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(u=>{let d="",p,f,m;for(let h of u){if(typeof h=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(h)!==-1){let x=this.internalOutputShapes[a];x[x.length-1]===1||this.lossFunctions[a]===Hm?["accuracy","acc"].indexOf(h)!==-1?f=cC:["crossentropy","ce"].indexOf(h)!==-1&&(f=Dk):this.lossFunctions[a]===Wm?["accuracy","acc"].indexOf(h)!==-1?f=Nk:["crossentropy","ce"].indexOf(h)!==-1&&(f=kk):["accuracy","acc"].indexOf(h)!==-1?f=uC:["crossentropy","ce"].indexOf(h)!==-1&&(f=dC);let b;["accuracy","acc"].indexOf(h)!==-1?b="acc":["crossentropy","ce"].indexOf(h)!==-1&&(b="ce"),m=f,p=d+b}else m=_U(h),p=d+Gy(h);let g;Xi(p,()=>{g=m}),s(a,p,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;yC(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,u=this.testLoop(c,l,i,o.verbose,o.steps);return Hn(u)}finally{du(a[0],e),du(a[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),OU(this,e,r)}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new $(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new $(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new $("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new Rs;if(e instanceof gt&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new $(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let u=e[c.name];if(u==null)throw new $(`No value is provided for the model's input ${c.name}`);a.add(c,u)}let l=ap(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=mi(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let c=a.indexOf(e[l]);if(c!==-1&&(r[l]=s[c],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new $(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return j(()=>{let i=this.checkNumSamples(e);if(o)throw new Ae("Verbose predictLoop() is not implemented yet.");let s=xC(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)j(()=>{let u=s[l][0],d=s[l][1],p=Xm(e,u,d),f=[];if(Array.isArray(p))for(let h=0;h<p.length;++h)f.push({key:this.inputs[h],value:p[h]});else f.push({key:this.inputs[0],value:p});let m=new Rs(f);return ap(this.outputs,m)}).forEach((u,d)=>a[d].push(u));return Hn(a.map(l=>Gt(l,0)))})}predict(e,r={}){let o=Fk(e);VU(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return yC(i),this.predictLoop(o,i)}finally{du(o,e)}}predictOnBatch(e){VU(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new Fr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===Wm?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=$U(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=$U(r,this.feedOutputNames,s,!1,"target"),Yfe(e,r,null),Zfe(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new $(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,o,i,s=!0,a){let[l,c]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(i!=null){let d=hC(i,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(await gC(c[p],null,d[p]))}return[l,c,u]}testLoop(e,r,o,i=0,s){return j(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new Ae("Verbose mode is not implemented yet.");if(s!=null)throw new Ae("steps mode in testLoop() is not implemented yet");{let c=xC(a,o),u=pi(Ir(0,a));for(let d=0;d<c.length;++d){let p=c[d][0],f=c[d][1],m=yl(u,p,f-p),h=vC(r,m),g=e(h);if(d===0)for(let x=0;x<g.length;++x)l.push(Fe(0));for(let x=0;x<g.length;++x){let b=g[x];l[x]=oe(l[x],V(f-p,b))}}for(let d=0;d<l.length;++d)l[d]=ye(l[d],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(fk(e,i)>1){let a=fk(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let p=[];for(let g=0;g<this.inputs.length;++g)p.push({key:this.inputs[g],value:o[g]});let f=new Rs(p),m=ap(this.outputs,f,{training:!0}),h;for(let g=0;g<this.lossFunctions.length;++g){let x=this.lossFunctions[g],b=x(i[g],m[g]);s[g]!=null&&(b=kU(b,s[g]));let I=qt(b);r.push(I),g===0?h=b:h=oe(h,b)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=r[g];else{let b=this.metricsTensors[g][0],I=this.metricsTensors[g][1];x=qt(b(i[I],m[I]))}Gn(x),a.push(x)}return h=qt(h),this.calculateLosses().forEach(g=>{h=oe(h,g)}),h},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>j(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:i[u]});let l=new Rs(a),c=ap(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],p=qt(d(s[u],c[u]));u===0?o=p:o=oe(o,p),r.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=qt(d(s[p],c[p]));r.push(f)}return r})}async fit(e,r,o={}){return PU(this,e,r,o)}async fitDataset(e,r){return FU(this,e,r)}async trainOnBatch(e,r){let o=await this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),c=[];for(let u of l){let d=await u.data();c.push(d[0])}return Pe(l),Hn(c)}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=hy().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-hy().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=hi(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>hi(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=hi(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[hi(Gy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>hi(Gy(e)));{let e={};for(let r in this.metrics)e[r]=hi(Gy(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=qm(e.optimizer_config),o=Kr(r),i;if(typeof e.loss=="string")i=gl(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>gl(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=gl(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>gl(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=gl(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}async save(e,r){if(typeof e=="string"){let u=ai.getSaveHandlers(e);if(u.length===0)throw new $(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new $(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new $("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=await ai.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:Jfe,generatedBy:`TensorFlow.js tfjs-layers v${Km}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:d,specs:p}=await ai.encodeWeights(await this.optimizer.getWeights(),u);o.specs.push(...p),o.data=ai.concatenateArrayBuffers([o.data,d])}return this.userDefinedMetadata!=null&&(Rk(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)}setUserDefinedMetadata(e){Rk(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return t.className="Model",t})();Q.registerClass(Cl);var eme=(()=>{class t extends Cl{}return t.className="Functional",t})();Q.registerClass(eme);async function BU(t,n){if(n==null&&(n={}),typeof t=="string"){let e=ai.getLoadHandlers(t,n);if(e.length===0)e.push(ai.browserHTTPRequest(t,n));else if(e.length>1)throw new $(`Found more than one (${e.length}) load handlers for URL '${t}'`);t=e[0]}return tme(t,void 0,n)}async function tme(t,n,e){if(e==null&&(e={}),t.load==null)throw new $("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await t.load(),o=r.modelTopology;o.model_config!=null&&(o=o.model_config);let i=e.strict==null?!0:e.strict,s=r.weightData!=null&&r.weightSpecs!=null&&i,a=Kr(qm(o),n,s),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new $("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:c,optimizerWeights:u}=nme(r.weightData,r.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Pe(c),Pe(u.map(d=>d.tensor))}return a}function nme(t,n){let e=ai.decodeWeights(t,n),r={},o=[];return n.forEach(i=>{i.group==="optimizer"?o.push({name:i.name,tensor:e[i.name]}):r[i.name]=e[i.name]}),{modelWeights:r,optimizerWeights:o}}var Pk=(()=>{class t extends Cl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:cu("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new $(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof t||e instanceof Cl,o;if(r){if(o=e,o.outputs.length!==1)throw new $("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new $("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new $("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=Sk({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new $(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new $("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=Ek(this.outputs[0])}this.inboundNodes=[],new bl({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:mi(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(tt(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Cl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new Fr("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}async evaluateDataset(e,r){if(!this.built)throw new Fr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,o={}){if(!this.built)throw new Fr("The model needs to be compiled before being used.");return this.model.fit(e,r,o)}async fitDataset(e,r){if(!this.built)throw new Fr("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new $("Legacy serialization format not supported yet.");s=r}else C.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof t))throw new Ae(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=Kr(c,void 0,i);i&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new $("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new $("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return t.className="Sequential",t})();Q.registerClass(Pk);function Lk(t,n){return n==null&&(n={}),BU(t,n)}var Sr=class extends Q.Serializable{getConfig(){return{}}},rme=(()=>{class t extends Sr{apply(e,r=1){return oU(e,r)}}return t.className="elu",t})();Q.registerClass(rme);var ome=(()=>{class t extends Sr{apply(e){return Ey(e)}}return t.className="selu",t})();Q.registerClass(ome);var ime=(()=>{class t extends Sr{apply(e){return di(e)}}return t.className="relu",t})();Q.registerClass(ime);var sme=(()=>{class t extends Sr{apply(e){return j(()=>jd(6,di(e)))}}return t.className="relu6",t})();Q.registerClass(sme);var ame=(()=>{class t extends Sr{apply(e){return e}}return t.className="linear",t})();Q.registerClass(ame);var lme=(()=>{class t extends Sr{apply(e){return li(e)}}return t.className="sigmoid",t})();Q.registerClass(lme);var cme=(()=>{class t extends Sr{apply(e){return sU(e)}}return t.className="hardSigmoid",t})();Q.registerClass(cme);var ume=(()=>{class t extends Sr{apply(e){return Ts(e)}}return t.className="softplus",t})();Q.registerClass(ume);var dme=(()=>{class t extends Sr{apply(e){return iU(e)}}return t.className="softsign",t})();Q.registerClass(dme);var pme=(()=>{class t extends Sr{apply(e){return Em(e)}}return t.className="tanh",t})();Q.registerClass(pme);var Vk=(()=>{class t extends Sr{apply(e,r=-1){return qd(e,r)}}return t.className="softmax",t})();Q.registerClass(Vk);var fme=(()=>{class t extends Sr{apply(e,r=-1){return wy(e,r)}}return t.className="logSoftmax",t})();Q.registerClass(fme);var mme=(()=>{class t extends Sr{apply(e,r=1){return j(()=>li(e.mul(r)).mul(e))}}return t.className="swish",t})();Q.registerClass(mme);var hme=(()=>{class t extends Sr{apply(e){return j(()=>V(e,Em(Ts(e))))}}return t.className="mish",t})();Q.registerClass(hme);function Zi(t){return t.getClassName()}function $k(t,n={}){return ks(t,Q.SerializationMap.getMap().classNameMap,n,"activation")}function Qi(t){if(t==null){let n={};return n.className="linear",n.config={},$k(n)}if(typeof t=="string"){let n={};return n.className=t,n.config={},$k(n)}else return t instanceof Sr?t:$k(t)}function gme(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var bC=class extends Q.Serializable{},jU=(()=>{class t extends bC{constructor(e){super(),gme(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return j(()=>{let r=Wt([1]);return this.hasL1&&(r=oe(r,Ce(V(this.l1,An(e))))),this.hasL2&&(r=oe(r,Ce(V(this.l2,rp(e))))),r.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return t.className="L1L2",t})();Q.registerClass(jU);var zU={l1l2:"L1L2"};function Tt(t){return $m(t)}function UU(t,n={}){return ks(t,Q.SerializationMap.getMap().classNameMap,n,"regularizer")}function Pt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in zU?zU[t]:t,config:{}};return UU(e)}else return t instanceof bC?t:UU(t)}var GU=(()=>{class t extends Ge{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=Ve(e);let o=di(e);return this.maxValue!=null&&(o=Qn(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ReLU",t})();Q.registerClass(GU);var WU=(()=>{class t extends Ge{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Ve(e);return zd(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LeakyReLU",t})();Q.registerClass(WU);var HU=(()=>{class t extends Ge{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=At(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Pt(e.alphaRegularizer),this.alphaConstraint=tn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new $(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=tt(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new Ot({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=Ve(e),Wd(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Bt(this.alphaInitializer),alphaRegularizer:Tt(this.alphaRegularizer),alphaConstraint:en(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return t.className="PReLU",t})();Q.registerClass(HU);var qU=(()=>{class t extends Ge{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ae(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Ve(e);return fl(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ELU",t})();Q.registerClass(qU);var KU=(()=>{class t extends Ge{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=Ve(e);return o.mul(vl(o.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ThresholdedReLU",t})();Q.registerClass(KU);var XU=(()=>{class t extends Ge{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Vk().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let o=Ve(e);return this.softmax(o,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Softmax",t})();Q.registerClass(XU);function pu(t,n,e){if(typeof t=="number")return mi(t,n);if(t.length!==n)throw new $(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${t.length} elements.`);for(let r=0;r<n;++r){let o=t[r];if(!J4(o))throw new $(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Xr(t,n,e,r,o=1){if(t==null)return t;let i=n+(n-1)*(o-1),s;return e==="same"?s=t:s=t-i+1,Math.floor((s+r-1)/r)}function Ji(t,n,e,r){if(t==null)return null;if(r==="valid")t=t*n+Yi([e-n,0]);else if(r==="same")t=t*n;else throw new $(`Unsupport padding mode: ${r}.`);return t}function Hy(t,n){return j(()=>(Kt(n),n==="channelsFirst"?at(t,[0,2,3,1]):t))}function Bk(t,n){return j(()=>(Kt(n),n==="channelsFirst"?at(t,[0,2,3,4,1]):t))}function vme(t,n,e,r=1,o="valid",i,s=1){return j(()=>{if(i==null&&(i=Mr()),Kt(i),t.shape.length!==3)throw new $(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(n.shape.length!==3)throw new $(`The kernel for a conv1dWithBias operation should be 3, but is ${n.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new $(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=at(t,[0,2,1])),o==="causal")throw new Ae("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=yy(t,n,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=Pr(a,e)),a})}function YU(t,n,e,r=[1,1],o="valid",i,s,a=null){return j(()=>{if(i==null&&(i=Mr()),Kt(i),t.rank!==3&&t.rank!==4)throw new $(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(n.rank!==3&&n.rank!==4)throw new $(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Hy(t,i);if(o==="causal")throw new Ae("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Jd.conv2d({x:l,filter:n,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=at(l,[0,3,1,2])),l})}function xme(t,n,e,r=[1,1,1],o="valid",i,s){return j(()=>{if(i==null&&(i=Mr()),Kt(i),t.rank!==4&&t.rank!==5)throw new $(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(n.rank!==4&&n.rank!==5)throw new $(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=Bk(t,i);if(o==="causal")throw new Ae("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=xN(a,n,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=Pr(a,e)),i==="channelsFirst"&&(a=at(a,[0,4,1,2,3])),a})}var Wy=class t extends Ge{constructor(n,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(e),this.rank=n,mn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ae(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=pu(e.kernelSize,n,"kernelSize"),this.strides=pu(e.strides==null?1:e.strides,n,"strides"),this.padding=e.padding==null?"valid":e.padding,Or(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Kt(this.dataFormat),this.activation=Qi(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=At(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=tn(e.biasConstraint),this.biasRegularizer=Pt(e.biasRegularizer),this.activityRegularizer=Pt(e.activityRegularizer),this.dilationRate=pu(e.dilationRate==null?1:e.dilationRate,n,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new $(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new $(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new $(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(n){if(Uo("kernelSize"in n,"required key 'kernelSize' not in config"),typeof n.kernelSize!="number"&&!Uw(n.kernelSize,"number",1,3))throw new $(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(n.kernelSize)}.`)}getConfig(){let n={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Zi(this.activation),useBias:this.useBias,biasInitializer:Bt(this.biasInitializer),biasRegularizer:Tt(this.biasRegularizer),activityRegularizer:Tt(this.activityRegularizer),biasConstraint:en(this.biasConstraint)},e=super.getConfig();return Object.assign(n,e),n}},Ym=class t extends Wy{constructor(n,e){super(n,e),this.kernel=null,t.verifyArgs(e),this.filters=e.filters,mn(this.filters,"filters"),this.kernelInitializer=At(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=tn(e.kernelConstraint),this.kernelRegularizer=Pt(e.kernelRegularizer)}build(n){n=tt(n);let e=this.dataFormat==="channelsFirst"?1:n.length-1;if(n[e]==null)throw new $(`The channel dimension of the input should be defined. Found ${n[e]}`);let r=n[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(n,e){return j(()=>{n=Ve(n);let r,o=this.bias==null?null:this.bias.read(),i=jw(this.activation.getClassName());if(i!=null&&this.rank===2)r=YU(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=vme(n,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=YU(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=xme(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ae("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(n){n=tt(n);let e=[],r=this.dataFormat==="channelsLast"?n.slice(1,n.length-1):n.slice(2);for(let i=0;i<r.length;++i){let s=Xr(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[n[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let n={filters:this.filters,kernelInitializer:Bt(this.kernelInitializer),kernelRegularizer:Tt(this.kernelRegularizer),kernelConstraint:en(this.kernelConstraint)},e=super.getConfig();return Object.assign(n,e),n}static verifyArgs(n){if(!("filters"in n)||typeof n.filters!="number"||n.filters<1)throw new $(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(n.filters)}`)}},zk=(()=>{class t extends Ym{constructor(e){super(2,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Uw(e.kernelSize,"number",1,2))throw new $(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv2D",t})();Q.registerClass(zk);var Uk=(()=>{class t extends Ym{constructor(e){super(3,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new $(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv3D",t})();Q.registerClass(Uk);var ZU=(()=>{class t extends zk{constructor(e){if(super(e),this.inputSpec=[new Ot({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new $(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=tt(e),e.length!==4)throw new $("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new $("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ot({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return j(()=>{let o=Ve(e);if(o.shape.length!==4)throw new $(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let c=i[a],u=i[l],d=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],m=this.strides[1],h=Ji(c,f,d,this.padding),g=Ji(u,m,p,this.padding),x=[s,h,g,this.filters];this.dataFormat!=="channelsLast"&&(o=at(o,[0,2,3,1]));let b=vy(o,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=at(b,[0,3,1,2])),this.bias!=null&&(b=Pr(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=tt(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return r[o]=this.filters,r[i]=Ji(r[i],c,a,this.padding),r[s]=Ji(r[s],u,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv2DTranspose",t})();Q.registerClass(ZU);var QU=(()=>{class t extends Uk{constructor(e){if(super(e),this.inputSpec=[new Ot({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new $(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=tt(e),e.length!==5)throw new $("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new $("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ot({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return j(()=>{let o=Ve(e);if(o.shape.length!==5)throw new $(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,c;this.dataFormat==="channelsFirst"?(c=2,a=3,l=4):(c=1,a=2,l=3);let u=i[c],d=i[a],p=i[l],f=this.kernelSize[0],m=this.kernelSize[1],h=this.kernelSize[2],g=this.strides[0],x=this.strides[1],b=this.strides[2],I=Ji(u,g,f,this.padding),_=Ji(d,x,m,this.padding),E=Ji(p,b,h,this.padding),S=[s,I,_,E,this.filters];this.dataFormat!=="channelsLast"&&(o=at(o,[0,2,3,4,1]));let D=bN(o,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=at(D,[0,4,1,2,3])),this.bias!==null&&(D=Pr(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=tt(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],f=this.strides[2];return r[o]=this.filters,r[i]=Ji(r[i],d,l,this.padding),r[s]=Ji(r[s],p,c,this.padding),r[a]=Ji(r[a],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv3DTranspose",t})();Q.registerClass(QU);var bme=(()=>{class t extends Ym{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new $("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new $("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new $(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=At(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Pt(r.depthwiseRegularizer),this.depthwiseConstraint=tn(r.depthwiseConstraint),this.pointwiseInitializer=At(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Pt(r.pointwiseRegularizer),this.pointwiseConstraint=tn(r.pointwiseConstraint)}build(e){if(e=tt(e),e.length<this.rank+2)throw new $(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new $(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Ot({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return j(()=>{e=Ve(e);let o;if(this.rank===1)throw new Ae("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=at(e,[0,2,3,1])),o=Sy(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=Pr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=at(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Bt(this.depthwiseInitializer),e.pointwiseInitializer=Bt(this.pointwiseInitializer),e.depthwiseRegularizer=Tt(this.depthwiseRegularizer),e.pointwiseRegularizer=Tt(this.pointwiseRegularizer),e.depthwiseConstraint=en(this.depthwiseConstraint),e.pointwiseConstraint=en(this.pointwiseConstraint),e}}return t.className="SeparableConv",t})(),JU=(()=>{class t extends bme{constructor(e){super(2,e)}}return t.className="SeparableConv2D",t})();Q.registerClass(JU);var ej=(()=>{class t extends Ym{constructor(e){super(1,e),t.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Uw(e.kernelSize,"number",1,1))throw new $(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv1D",t})();Q.registerClass(ej);var tj=(()=>{class t extends Ge{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return j(()=>{if(e=Ve(e),this.dataFormat==="channelsLast"){let o=Ly(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Ly(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=Ly(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Ly(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Cropping2D",t})();Q.registerClass(tj);var nj=(()=>{class t extends Ge{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Kt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,Z4(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return j(()=>{let o=Ve(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=at(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a]);return at(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="UpSampling2D",t})();Q.registerClass(nj);function wme(t,n,e=[1,1],r="valid",o,i){return j(()=>{o==null&&(o=Mr()),Kt(o);let s=Hy(t,o);if(t.rank!==4)throw new $(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(n.rank!==4)throw new $(`depthwiseKernel is required to be 4-D, but is instead ${n.rank}-D`);return s=pl(s,n,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=at(s,[0,3,1,2])),s})}var rj=(()=>{class t extends Wy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=At(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=tn(e.depthwiseConstraint),this.depthwiseRegularizer=Pt(e.depthwiseRegularizer)}build(e){if(e=tt(e),e.length<4)throw new $(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new $(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return j(()=>{e=Ve(e);let o=wme(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=Pr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=tt(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=Xr(r,this.kernelSize[0],this.padding,this.strides[0]),a=Xr(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Bt(this.depthwiseInitializer),e.depthwiseRegularizer=Tt(this.depthwiseRegularizer),e.depthwiseConstraint=en(this.depthwiseRegularizer),e}}return t.className="DepthwiseConv2D",t})();Q.registerClass(rj);function jk(t,n,e,r){if(Array.isArray(t)){if(n!=null||e!=null)throw new $("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(n=t.slice(1,t.length)),t=t[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return n=o(n),e=o(e),{inputs:t,initialState:n,constants:e}}function Gk(t,n,e,r=!1,o,i,s=!1,a=!1){return j(()=>{let l=n.shape.length;if(l<3)throw new $(`Input should be at least 3D, but is ${l}D.`);let c=[1,0].concat(Ir(2,l));if(n=at(n,c),i!=null)throw new Ae("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=o.asType("bool").asType("float32"),o.rank===l-1&&(o=lr(o,-1)),o=at(o,c)),r&&(n=Bo(n,0),o!=null&&(o=Bo(o,0)));let u=[],d,p=e,f=n.shape[0],m=qr(n),h;o!=null&&(h=qr(o));for(let x=0;x<f;++x){let b=m[x],I=j(()=>t(b,p));if(o==null)d=I[0],p=I[1];else{let _=j(()=>{let E=h[x],S=Wn(E).sub(E),D=I[0].mul(E).add(p[0].mul(S)),M=p.map((R,L)=>I[1][L].mul(E).add(R.mul(S)));return{output:D,newStates:M}});d=_.output,p=_.newStates}a&&u.push(d)}let g;return a&&(g=cr(u,1)),[d,g,p]})}var mu=(()=>{class t extends Ge{constructor(e){super(e);let r;if(e.cell==null)throw new $("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new qk({cells:e.cell}):r=e.cell,r.stateSize==null)throw new $("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Ot({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Ir(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Jw(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return j(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ae("Constants support is not implemented in RNN yet.");Jw(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Ot({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!C.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new $(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new Ot({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){j(()=>{if(!this.stateful)throw new zo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new $("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Wt([o,i])):this.states_=[Wt([o,this.cell.stateSize])];else if(e==null)Pe(this.states_),this.keptStates!=null&&(Pe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Wt([o,i])):this.states_[0]=Wt([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new $(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Pe(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!C.arraysEqual(s.shape,l))throw new $(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>Gn(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=jk(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new Ot({shape:u.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof Er){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return j(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=Ve(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new $(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},u=Gk((h,g)=>{let x=this.cell.call([h].concat(g),l);return[x[0],x.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),d=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,i);let m=this.returnSequences?p:d;return this.returnState?[m].concat(f):m})}getInitialState(e){return j(()=>{let r=Wt(e.shape);return r=Ce(r,[1,2]),r=xl(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?qw(r,[1,o]):r):this.cell.stateSize>1?[qw(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===t.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign({},o,e,r)}static fromConfig(e,r,o={}){let i=r.cell,s=Kr(i,o);return new e(Object.assign(r,{cell:s}))}}return t.className="RNN",t})();Q.registerClass(mu);var fu=class extends Ge{},Wk=(()=>{class t extends fu{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,mn(this.units,"units"),this.activation=Qi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=At(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=At(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=At(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Pt(e.kernelRegularizer),this.recurrentRegularizer=Pt(e.recurrentRegularizer),this.biasRegularizer=Pt(e.biasRegularizer),this.kernelConstraint=tn(e.kernelConstraint),this.recurrentConstraint=tn(e.recurrentConstraint),this.biasConstraint=tn(e.biasConstraint),this.dropout=np([1,Yi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=np([1,Yi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=tt(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return j(()=>{if(e=e,e.length!==2)throw new $(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>Wn(e),rate:this.dropout,training:i})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>Wn(o),rate:this.recurrentDropout,training:i}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=vi(V(e,a),this.kernel.read()):s=vi(e,this.kernel.read()),this.bias!=null&&(s=Pr(s,this.bias.read())),l!=null&&(o=V(o,l));let c=oe(s,vi(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Zi(this.activation),useBias:this.useBias,kernelInitializer:Bt(this.kernelInitializer),recurrentInitializer:Bt(this.recurrentInitializer),biasInitializer:Bt(this.biasInitializer),kernelRegularizer:Tt(this.kernelRegularizer),recurrentRegularizer:Tt(this.recurrentRegularizer),biasRegularizer:Tt(this.biasRegularizer),activityRegularizer:Tt(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),recurrentConstraint:en(this.recurrentConstraint),biasConstraint:en(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,r)}}return t.className="SimpleRNNCell",t})();Q.registerClass(Wk);var oj=(()=>{class t extends mu{constructor(e){e.cell=new Wk(e),super(e)}call(e,r){return j(()=>{this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return t.className="SimpleRNN",t})();Q.registerClass(oj);var Hk=(()=>{class t extends fu{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new $("GRUCell does not support reset_after parameter set to true.");this.units=e.units,mn(this.units,"units"),this.activation=Qi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Qi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=At(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=At(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=At(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Pt(e.kernelRegularizer),this.recurrentRegularizer=Pt(e.recurrentRegularizer),this.biasRegularizer=Pt(e.biasRegularizer),this.kernelConstraint=tn(e.kernelConstraint),this.recurrentConstraint=tn(e.recurrentConstraint),this.biasConstraint=tn(e.biasConstraint),this.dropout=np([1,Yi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=np([1,Yi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=tt(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return j(()=>{if(e=e,e.length!==2)throw new $(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>Wn(e),rate:this.dropout,training:o,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>Wn(i),rate:this.recurrentDropout,training:o,count:3}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,c,u;0<this.dropout&&this.dropout<1&&(e=V(e,s[0]));let d=vi(e,this.kernel.read());this.useBias&&(d=Pr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,a[0]));let p=this.recurrentKernel.read(),[f,m]=tr(p,[2*this.units,this.units],p.rank-1),h=vi(i,f),[g,x,b]=tr(d,3,d.rank-1),[I,_]=tr(h,2,h.rank-1);l=this.recurrentActivation.apply(oe(g,I)),c=this.recurrentActivation.apply(oe(x,_));let E=vi(V(c,i),m);u=this.activation.apply(oe(b,E));let S=oe(V(l,i),V(oe(1,Et(l)),u));return[S,S]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Zi(this.activation),recurrentActivation:Zi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Bt(this.kernelInitializer),recurrentInitializer:Bt(this.recurrentInitializer),biasInitializer:Bt(this.biasInitializer),kernelRegularizer:Tt(this.kernelRegularizer),recurrentRegularizer:Tt(this.recurrentRegularizer),biasRegularizer:Tt(this.biasRegularizer),activityRegularizer:Tt(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),recurrentConstraint:en(this.recurrentConstraint),biasConstraint:en(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,r)}}return t.className="GRUCell",t})();Q.registerClass(Hk);var ij=(()=>{class t extends mu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Hk(e),super(e)}call(e,r){return j(()=>{this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="GRU",t})();Q.registerClass(ij);var qy=(()=>{class t extends fu{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,mn(this.units,"units"),this.activation=Qi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Qi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=At(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=At(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=At(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Pt(e.kernelRegularizer),this.recurrentRegularizer=Pt(e.recurrentRegularizer),this.biasRegularizer=Pt(e.biasRegularizer),this.kernelConstraint=tn(e.kernelConstraint),this.recurrentConstraint=tn(e.recurrentConstraint),this.biasConstraint=tn(e.biasConstraint),this.dropout=np([1,Yi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=np([1,Yi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=tt(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends $r{apply(c,u){let d=s.apply([a]),p=new Yw().apply([a]),f=s.apply([a*2]);return vk(vk(d,p),f)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return j(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new $(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>Wn(e),rate:this.dropout,training:o,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>Wn(i),rate:this.recurrentDropout,training:o,count:4}));let a=this.dropoutMask,l=this.recurrentDropoutMask,c,u,d,p;0<this.dropout&&this.dropout<1&&(e=V(e,a[0]));let f=vi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,l[0])),f=oe(f,vi(i,this.recurrentKernel.read())),this.useBias&&(f=Pr(f,this.bias.read()));let[m,h,g,x]=tr(f,4,f.rank-1);c=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(h),d=oe(V(u,s),V(c,this.activation.apply(g))),p=this.recurrentActivation.apply(x);let b=V(p,this.activation.apply(d));return[b,b,d]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Zi(this.activation),recurrentActivation:Zi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Bt(this.kernelInitializer),recurrentInitializer:Bt(this.recurrentInitializer),biasInitializer:Bt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Tt(this.kernelRegularizer),recurrentRegularizer:Tt(this.recurrentRegularizer),biasRegularizer:Tt(this.biasRegularizer),activityRegularizer:Tt(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),recurrentConstraint:en(this.recurrentConstraint),biasConstraint:en(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,r)}}return t.className="LSTMCell",t})();Q.registerClass(qy);var sj=(()=>{class t extends mu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new qy(e),super(e)}call(e,r){return j(()=>{this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="LSTM",t})();Q.registerClass(sj);var qk=(()=>{class t extends fu{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return j(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let c=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){Jw(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{Xi(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign({},e,i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push(Kr(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return Vy(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}Gm(r)}}return t.className="StackedRNNCells",t})();Q.registerClass(qk);function _l(t){let{ones:n,rate:e,training:r=!1,count:o=1}=t,i=()=>Xw(n(),e),s=()=>lu(i,n,r);return!o||o<=1?Gn(s().clone()):Array(o).fill(void 0).map(s).map(l=>Gn(l.clone()))}var Cme=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e};var _me=(()=>{class t extends mu{constructor(e){if(e.unroll)throw new Ae("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ae("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Ot({ndim:5})]}call(e,r){return j(()=>{if(this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new $("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return j(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=Wt(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){j(()=>{if(!this.stateful)throw new zo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new $("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Wt(s)):this.states_=[Wt(s)];else if(e==null)Pe(this.states_),this.keptStates!=null&&(Pe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Wt(s)):this.states_[0]=Wt(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new $(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Pe(this.states_);for(let l=0;l<this.states_.length;++l){let c=e[l],u=s;if(!C.arraysEqual(c.shape,u))throw new $(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>Gn(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,c=r==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=Xr(u,i[0],s,a[0],l[0]),f=Xr(d,i[1],s,a[1],l[1]);return[...e.slice(0,2),...c?[o,p,f]:[p,f,o]]}}return t.className="ConvRNN2D",t})(),Kk=(()=>{class t extends qy{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign({},e,{units:r})),this.filters=r,mn(this.filters,"filters"),this.kernelSize=pu(o,2,"kernelSize"),this.kernelSize.forEach(c=>mn(c,"kernelSize")),this.strides=pu(i||1,2,"strides"),this.strides.forEach(c=>mn(c,"strides")),this.padding=s||"valid",Or(this.padding),this.dataFormat=a||"channelsLast",Kt(this.dataFormat),this.dilationRate=pu(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>mn(c,"dilationRate"))}build(e){var r;e=tt(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new $(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;c=new(r=class extends $r{apply(f,m){let h=u.apply([d]),g=vo([d]),x=u.apply([d*2]);return Bm([h,g,x])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return j(()=>{if(e.length!==3)throw new $(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=_l({ones:()=>Wn(i),rate:this.dropout,training:o,count:l}));let c=this.dropoutMask,u=(fe,ge,he)=>!ge||!ge[he]?fe:V(ge[he],fe),d=u(i,c,0),p=u(i,c,1),f=u(i,c,2),m=u(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=_l({ones:()=>Wn(s),rate:this.recurrentDropout,training:o,count:l}));let h=this.recurrentDropoutMask,g=u(s,h,0),x=u(s,h,1),b=u(s,h,2),I=u(s,h,3),_=3,[E,S,D,M]=tr(this.kernel.read(),l,_),[R,L,G,W]=this.useBias?tr(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,E,R,this.padding),p=this.inputConv(p,S,L,this.padding),f=this.inputConv(f,D,G,this.padding),m=this.inputConv(m,M,W,this.padding);let[q,X,K,Z]=tr(this.recurrentKernel.read(),l,_);g=this.recurrentConv(g,q),x=this.recurrentConv(x,X),b=this.recurrentConv(b,K),I=this.recurrentConv(I,Z);let ae=this.recurrentActivation.apply(oe(d,g)),ee=this.recurrentActivation.apply(oe(p,x)),ie=oe(V(ee,a),V(ae,this.activation.apply(oe(f,b)))),ue=V(this.recurrentActivation.apply(oe(m,I)),this.activation.apply(ie));return[ue,ue,ie]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=Cme(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},o,i)}inputConv(e,r,o,i){let s=go(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?Pr(s,o,this.dataFormat):s}recurrentConv(e,r){return go(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return t.className="ConvLSTM2DCell",t})();Q.registerClass(Kk);var aj=(()=>{class t extends _me{constructor(e){let r=new Kk(e);super(Object.assign({},e,{cell:r}))}static fromConfig(e,r){return new e(r)}}return t.className="ConvLSTM2D",t})();Q.registerClass(aj);var Xk=(()=>{class t extends Ge{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return lu(()=>Xw(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return t.className="Dropout",t})();Q.registerClass(Xk);var lj=(()=>{class t extends Xk{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return t.className="SpatialDropout1D",t})();Q.registerClass(lj);var cj=(()=>{class t extends Ge{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,mn(this.units,"units"),this.activation=Qi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=At(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=At(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=tn(e.kernelConstraint),this.biasConstraint=tn(e.biasConstraint),this.kernelRegularizer=Pt(e.kernelRegularizer),this.biasRegularizer=Pt(e.biasRegularizer),this.activityRegularizer=Pt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=tt(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=tt(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e),i=jw(this.activation.getClassName()),s;return i!=null?s=vi(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=vi(o,this.kernel.read()),this.bias!=null&&(s=Pr(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Zi(this.activation),useBias:this.useBias,kernelInitializer:Bt(this.kernelInitializer),biasInitializer:Bt(this.biasInitializer),kernelRegularizer:Tt(this.kernelRegularizer),biasRegularizer:Tt(this.biasRegularizer),activityRegularizer:Tt(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),biasConstraint:en(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dense",t})();Q.registerClass(cj);var uj=(()=>{class t extends Ge{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=tt(e);for(let r of e.slice(1))if(r==null)throw new $(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],yi(e,1)]}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=o.transpose(i)}return rU(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return t.className="Flatten",t})();Q.registerClass(uj);var dj=(()=>{class t extends Ge{constructor(e){super(e),this.supportsMasking=!0,this.activation=Qi(e.activation)}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return this.activation.apply(o)})}getConfig(){let e={activation:Zi(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Activation",t})();Q.registerClass(dj);var pj=(()=>{class t extends Ge{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return j(()=>(e=Ve(e),tU(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return t.className="RepeatVector",t})();Q.registerClass(pj);var fj=(()=>{class t extends Ge{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let c=0;c<i.length;++c){let u=i[c];if(this.isUnknown(u))if(a===null)a=c;else throw new $("Can only specifiy one unknown dimension.");else s*=u}let l=yi(e);if(a!==null){if(s===0||l%s!==0)throw new $(o);i[a]=l/s}else if(l!==s)throw new $(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return o.reshape(s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Reshape",t})();Q.registerClass(fj);var mj=(()=>{class t extends Ge{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=Ir(1,e.dims.length+1);if(!C.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Ot({ndim:this.dims.length+1})]}computeOutputShape(e){e=tt(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return at(Ve(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Permute",t})();Q.registerClass(mj);var hj=(()=>{class t extends Ge{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=Ve(e);return Cm(su(o,this.maskValue),-1)}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e),a=Cm(su(o,this.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})}}return t.className="Masking",t})();Q.registerClass(hj);var gj=(()=>{class t extends Ge{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(Ft(e.inputLength))}this.inputDim=e.inputDim,mn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,mn(this.outputDim,"outputDim"),this.embeddingsInitializer=At(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Pt(e.embeddingsRegularizer),this.activityRegularizer=Pt(e.activityRegularizer),this.embeddingsConstraint=tn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return j(()=>this.maskZero?(e=Ve(e),su(e,De(e))):null)}computeOutputShape(e){if(e=tt(e),this.inputLength==null)return[...e,this.outputDim];let r=Ft(this.inputLength);if(r.length!==e.length-1)throw new $(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new $(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return o.dtype!=="int32"&&(o=vl(o,"int32")),Kw(this.embeddings.read(),o.as1D()).reshape(tt(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Bt(this.embeddingsInitializer),embeddingsRegularizer:Tt(this.embeddingsRegularizer),activityRegularizer:Tt(this.activityRegularizer),embeddingsConstraint:en(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Embedding",t})();Q.registerClass(gj);var Il=class extends Ge{constructor(n){super(n||{}),this.supportsMasking=!0}mergeFunction(n){throw new Ae}computeElementwiseOpOutputShape(n,e){if(n==null||e==null)return null;if(n.length<e.length)return this.computeElementwiseOpOutputShape(e,n);if(e.length===0)return n;let r=n.slice(0,n.length-e.length);for(let o=0;o<e.length;++o){let i=n[n.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new $("Operands could not be broadcast together with shapes "+JSON.stringify(n)+" "+JSON.stringify(e));r.push(i)}}return r}build(n){if(Array.isArray(n)&&!Array.isArray(n[0])&&(n=[tt(n)]),n=n,n.length<2)throw new $(`A merge layer should be called on an Array of at least 2 inputs. Got ${n.length} input(s).`);let e=[];for(let i of n)i!=null&&i[0]!==null&&e.push(i[0]);if(e=gi(e),e.length>1)throw new $(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(n)}.`);let r=n[0]==null?null:n[0].slice(1);for(let i=1;i<n.length;++i){let s=n[i]==null?null:n[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=n.map(i=>i.length);n.indexOf(null)===-1&&gi(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(n,e){return j(()=>{if(n=n,this.reshapeRequired){let r=[],o=n.map(i=>i.rank);if(o.indexOf(null)===-1){let i=Yi(o);for(let s of n){let a=s.rank;for(let l=0;l<i-a;++l)s=xl(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of n){let c=l.rank;if(c==null){let u=l.shape,d=u[0],p=u.slice(1).concat([d]),f=l.reshape([d].concat(yi(u.slice(1))));f=at(f,[1,0]),f=f.reshape(p),r.push(f),i=!0}else if(c>1){let u=Ir(1,c).concat([0]);r.push(at(l,u)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=at(s.reshape([-1,u]),[1,0]).reshape(d)}else if(a>1){let l=[a-1].concat(Ir(0,a-1));s=at(s,l)}}return s}}else return this.mergeFunction(n)})}computeOutputShape(n){n=n;let e;n[0]==null?e=null:e=n[0].slice(1);for(let o=1;o<n.length;++o){let i=n[o]==null?null:n[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of n)o!=null&&o[0]!==null&&r.push(o[0]);return r=gi(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(n,e){return j(()=>{if(e==null)return null;if(!Array.isArray(e))throw new $("`mask` should be an Array");if(!Array.isArray(n))throw new $("`inputs` should be an Array");if(e.length!==n.length)throw new $(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${n.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:lr(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=_r(r,e[o]);return r})}},yj=(()=>{class t extends Il{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=oe(r,e[o]);return r})}}return t.className="Add",t})();Q.registerClass(yj);var vj=(()=>{class t extends Il{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=V(r,e[o]);return r})}}return t.className="Multiply",t})();Q.registerClass(vj);var xj=(()=>{class t extends Il{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=oe(r,e[o]);return V(1/e.length,r)})}}return t.className="Average",t})();Q.registerClass(xj);var bj=(()=>{class t extends Il{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=yo(r,e[o]);return r})}}return t.className="Maximum",t})();Q.registerClass(bj);var wj=(()=>{class t extends Il{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=jd(r,e[o]);return r})}}return t.className="Minimum",t})();Q.registerClass(wj);var Cj=(()=>{class t extends Il{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new $("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(C.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new $("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return j(()=>Bm(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new $("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new $("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new $("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new $(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return j(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(Wn(e[a]).asType("bool")):r[a].rank<e[a].rank?i.push(lr(r[a],-1)):i.push(r[a]);let s=Gt(i,this.axis);return gy(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Concatenate",t})();Q.registerClass(Cj);function Ky(t,n){for(;t<0;)t+=n;return t}function Ime(t,n,e){if(t.shape.length>3||n.shape.length>3)throw new Ae("batchDot is not implemented for tensors of 4D or higher rank yet");if(C.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),C.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${n.shape.length}`),typeof e=="number"&&(e=[e,e]),t.dtype==="complex64"||n.dtype==="complex64")throw new Ae("batchDot is not implemented for complex64-type Tensors yet.");let r=t.shape.length,o=n.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return j(()=>{let s;if(r>o){s=r-o;let l=[];for(let c=0;c<s;++c)l.push(1);n=n.reshape(n.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let c=0;c<s;++c)l.push(1);t=t.reshape(t.shape.concat(l))}else s=0;let a;if(t.shape.length===2&&n.shape.length===2)i[0]===i[1]?a=t.mul(n).sum(i[0]):a=t.transpose([1,0]).mul(n).sum(i[1]);else{let l=i[0]!==t.shape.length-1,c=i[1]===n.shape.length-1;a=t.matMul(n,l,c)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let c=[];for(let u=l;u<l+s;++u)c.push(u);a=a.squeeze(c)}return a.shape.length===1&&(a=a.expandDims(1)),a})}var _j=(()=>{class t extends Il{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){C.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new Ae("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new $(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new $(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>Ky(s,e[a].shape.length)):i=[Ky(this.axes,r.shape.length),Ky(this.axes,o.shape.length)],this.normalize&&(r=By(r,i[0]),o=By(o,i[1])),Ime(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[Ky(this.axes,e.length),Ky(this.axes,r.length)],o}computeOutputShape(e){C.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new Ae("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dot",t})();Q.registerClass(_j);var Ij=(()=>{class t extends Ge{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return lu(()=>zm(o.shape,0,this.stddev).add(o),()=>o,r.training||!1)})}}return t.className="GaussianNoise",t})();Q.registerClass(Ij);var Ej=(()=>{class t extends Ge{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return this.rate>0&&this.rate<1?lu(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return o.mul(zm(o.shape,1,s))},()=>o,r.training||!1):o})}}return t.className="GaussianDropout",t})();Q.registerClass(Ej);var Sj=(()=>{class t extends Ge{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ve(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return j(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return lu(()=>{let s=Ve(e),c=-1.6732632423543772*1.0507009873554805,u=$o(hl(o),this.rate);u=vl(u,"float32");let d=((1-this.rate)*(1+this.rate*c**2))**-.5,p=-d*c*this.rate;return s.mul(u).add(u.add(-1).mul(c)).mul(d).add(p)},()=>Ve(e),r.training||!1)}return e})}}return t.className="AlphaDropout",t})();Q.registerClass(Sj);function Xy(t,n,e,r,o,i=.001){let s;if(t.rank===2)s=dN(t,n,e,r,o,i);else if(t.rank===3)s=pN(t,n,e,r,o,i);else if(t.rank===4)s=fN(t,n,e,r,o,i);else throw new Ae(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return s}function Eme(t,n,e,r,o=.001){return j(()=>{let i=Am(t,r),s=i.mean,a=i.variance;return[Xy(t,s,a,e,n,o),s,a]})}function Sme(t,n,e,r,o=.001){return j(()=>{let i=Am(t,r),s=i.mean,a=i.variance,l=[];for(let m of Ir(0,t.rank))r.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let c=s.reshape(l),u=a.reshape(l),d=n==null?null:n.reshape(l),p=e==null?null:e.reshape(l);return[Xy(t,c,u,p,d,o),s,a]})}function Tme(t,n,e,r,o=.001){return C.arraysEqual(r.slice().sort(),Ir(0,t.rank-1))?Eme(t,n,e,r,o):Sme(t,n,e,r,o)}var Tj=(()=>{class t extends Ge{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=At(e.betaInitializer||"zeros"),this.gammaInitializer=At(e.gammaInitializer||"ones"),this.movingMeanInitializer=At(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=At(e.movingVarianceInitializer||"ones"),this.betaConstraint=tn(e.betaConstraint),this.gammaConstraint=tn(e.gammaConstraint),this.betaRegularizer=Pt(e.betaRegularizer),this.gammaRegularizer=Pt(e.gammaRegularizer)}build(e){e=tt(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new $(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Ot({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return j(()=>{let o=r.training==null?!1:r.training,i=Ve(e),s=i.shape,a=s.length,l=Ir(0,a),c=this.axis>=0?this.axis:this.axis+a;l.splice(c,1);let u=mi(1,a);u[c]=s[c];let d=l.slice();d.sort();let p=!C.arraysEqual(d,Ir(0,a).slice(0,a-1)),f=()=>{if(p){let I=this.movingMean.read().reshape(u),_=this.movingVariance.read().reshape(u),E=this.center?this.beta.read().reshape(u):null,S=this.scale?this.gamma.read().reshape(u):null;return Xy(i,I,_,E,S,this.epsilon)}else return Xy(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return f();let[m,h,g]=Tme(i,this.gamma.read(),this.beta.read(),l,this.epsilon),x=(I,_,E)=>{j(()=>{let S=1-E,D=I.read(),M=D.sub(_).mul(S);I.write(D.sub(M))})};return(()=>{x(this.movingMean,h,this.momentum),x(this.movingVariance,g,this.momentum)})(),m})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Bt(this.betaInitializer),gammaInitializer:Bt(this.gammaInitializer),movingMeanInitializer:Bt(this.movingMeanInitializer),movingVarianceInitializer:Bt(this.movingVarianceInitializer),betaRegularizer:Tt(this.betaRegularizer),gammaRegularizer:Tt(this.gammaRegularizer),betaConstraint:en(this.betaConstraint),gammaConstraint:en(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BatchNormalization",t})();Q.registerClass(Tj);var Dj=(()=>{class t extends Ge{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=At(e.betaInitializer||"zeros"),this.gammaInitializer=At(e.gammaInitializer||"ones"),this.betaRegularizer=Pt(e.betaRegularizer),this.gammaRegularizer=Pt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=tt(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==gi(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=Ve(e),i=o.shape,s=i.length;return j(()=>{let{mean:l,variance:c}=Am(o,this.axis,!0),u=mi(1,s);for(let g of this.axis)u[g]=i[g];let d=g=>g!=null&&g.shape.length!==s&&this.axis!==[s-1]?g.reshape(u):g,p=d(this.gamma.read()),f=d(this.beta.read()),m=[],h=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(m.push(i[g]),h.push(1)):(m.push(1),h.push(i[g]));return l=l.tile(m),c=c.tile(m),p=p.tile(h),f=f.tile(h),Xy(o,l,c,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Bt(this.betaInitializer),gammaInitializer:Bt(this.gammaInitializer),betaRegularizer:Tt(this.betaRegularizer),gammaRegularizer:Tt(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LayerNormalization",t})();Q.registerClass(Dj);function Dme(t,n,e){return j(()=>{if(t.rank!==4)throw new $(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(n==null&&(n=[[1,1],[1,1]]),n.length!==2||n[0].length!==2||n[1].length!==2)throw new $("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=Mr()),e!=="channelsLast"&&e!=="channelsFirst")throw new $(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],n[0],n[1]]:r=[[0,0],n[0],n[1],[0,0]],Gd(t,r)})}var Nj=(()=>{class t extends Ge{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Mr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new $(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new $(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new $(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new Ot({ndim:4})]}computeOutputShape(e){e=tt(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return j(()=>Dme(Ve(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ZeroPadding2D",t})();Q.registerClass(Nj);function SC(t,n,e,r,o,i){return j(()=>{Kt(o),hk(i),Or(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=Mr()),i==null&&(i="max"),t=Hy(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=Ud(t,n,e,a):s=$d(t,n,e,a),o==="channelsFirst"&&(s=at(s,[0,3,1,2])),s})}function kj(t,n,e,r,o,i){return j(()=>{Kt(o),hk(i),Or(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=Mr()),i==null&&(i="max"),t=Bk(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=MN(t,n,e,a):s=uN(t,n,e,a),o==="channelsFirst"&&(s=at(s,[0,4,1,2,3])),s})}var wC=class extends Ge{constructor(n){if(n.poolSize==null&&(n.poolSize=2),super(n),typeof n.poolSize=="number")this.poolSize=[n.poolSize];else if(Array.isArray(n.poolSize)&&n.poolSize.length===1&&typeof n.poolSize[0]=="number")this.poolSize=n.poolSize;else throw new $(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.poolSize)}`);if(mn(this.poolSize,"poolSize"),n.strides==null)this.strides=this.poolSize;else if(typeof n.strides=="number")this.strides=[n.strides];else if(Array.isArray(n.strides)&&n.strides.length===1&&typeof n.strides[0]=="number")this.strides=n.strides;else throw new $(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.strides)}`);mn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,Or(this.padding),this.inputSpec=[new Ot({ndim:3})]}computeOutputShape(n){n=tt(n);let e=Xr(n[1],this.poolSize[0],this.padding,this.strides[0]);return[n[0],e,n[2]]}call(n,e){return j(()=>{this.invokeCallHook(n,e),n=xl(Ve(n),2);let r=this.poolingFunction(Ve(n),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Kd(r,[2])})}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(n,e),n}},Aj=(()=>{class t extends wC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Or(i),SC(e,r,o,i,s,"max")}}return t.className="MaxPooling1D",t})();Q.registerClass(Aj);var Rj=(()=>{class t extends wC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Or(i),SC(e,r,o,i,s,"avg")}}return t.className="AveragePooling1D",t})();Q.registerClass(Rj);var CC=class extends Ge{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==2)throw new $(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides];mn(this.poolSize,"poolSize"),mn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Kt(this.dataFormat),Or(this.padding),this.inputSpec=[new Ot({ndim:4})]}computeOutputShape(n){n=tt(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2];return e=Xr(e,this.poolSize[0],this.padding,this.strides[0]),r=Xr(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r]:[n[0],e,r,n[3]]}call(n,e){return j(()=>(this.invokeCallHook(n,e),this.poolingFunction(Ve(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},Mj=(()=>{class t extends CC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Or(i),SC(e,r,o,i,s,"max")}}return t.className="MaxPooling2D",t})();Q.registerClass(Mj);var Fj=(()=>{class t extends CC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Or(i),SC(e,r,o,i,s,"avg")}}return t.className="AveragePooling2D",t})();Q.registerClass(Fj);var _C=class extends Ge{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==3)throw new $(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides,n.strides];mn(this.poolSize,"poolSize"),mn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Kt(this.dataFormat),Or(this.padding),this.inputSpec=[new Ot({ndim:5})]}computeOutputShape(n){n=tt(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2],o=this.dataFormat==="channelsFirst"?n[4]:n[3];return e=Xr(e,this.poolSize[0],this.padding,this.strides[0]),r=Xr(r,this.poolSize[1],this.padding,this.strides[1]),o=Xr(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r,o]:[n[0],e,r,o,n[4]]}call(n,e){return j(()=>(this.invokeCallHook(n,e),this.poolingFunction(Ve(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},Oj=(()=>{class t extends _C{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Or(i),kj(e,r,o,i,s,"max")}}return t.className="MaxPooling3D",t})();Q.registerClass(Oj);var Pj=(()=>{class t extends _C{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Or(i),kj(e,r,o,i,s,"avg")}}return t.className="AveragePooling3D",t})();Q.registerClass(Pj);var IC=class extends Ge{constructor(n){super(n),this.inputSpec=[new Ot({ndim:3})]}computeOutputShape(n){return[n[0],n[2]]}call(n,e){throw new Ae}},Lj=(()=>{class t extends IC{constructor(e){super(e||{})}call(e,r){return j(()=>{let o=Ve(e);return qt(o,1)})}}return t.className="GlobalAveragePooling1D",t})();Q.registerClass(Lj);var $j=(()=>{class t extends IC{constructor(e){super(e||{})}call(e,r){return j(()=>{let o=Ve(e);return er(o,1)})}}return t.className="GlobalMaxPooling1D",t})();Q.registerClass($j);var EC=class extends Ge{constructor(n){super(n),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Kt(this.dataFormat),this.inputSpec=[new Ot({ndim:4})]}computeOutputShape(n){return n=n,this.dataFormat==="channelsLast"?[n[0],n[3]]:[n[0],n[1]]}call(n,e){throw new Ae}getConfig(){let n={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},Vj=(()=>{class t extends EC{call(e,r){return j(()=>{let o=Ve(e);return this.dataFormat==="channelsLast"?qt(o,[1,2]):qt(o,[2,3])})}}return t.className="GlobalAveragePooling2D",t})();Q.registerClass(Vj);var Bj=(()=>{class t extends EC{call(e,r){return j(()=>{let o=Ve(e);return this.dataFormat==="channelsLast"?er(o,[1,2]):er(o,[2,3])})}}return t.className="GlobalMaxPooling2D",t})();Q.registerClass(Bj);var TC=class extends Ge{constructor(n){super(n),this.layer=n.layer}build(n){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(n){this.layer!=null&&(this.layer.trainable=n)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(n){this.layer.setWeights(n)}getConfig(){let n={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(n,e),n}setFastWeightInitDuringBuild(n){super.setFastWeightInitDuringBuild(n),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(n)}static fromConfig(n,e,r={}){let o=e.layer,i=Kr(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new n(s)}},zj=(()=>{class t extends TC{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=tt(e),e.length<3)throw new $(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=tt(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return j(()=>(e=Ve(e),Gk((a,l)=>[Ve(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return t.className="TimeDistributed",t})();Q.registerClass(zj);function Nme(t){As(X4,"BidirectionalMergeMode",t)}var kme="concat",Uj=(()=>{class t extends TC{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=Kr(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=Kr(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?kme:e.mergeMode,Nme(this.mergeMode),e.weights)throw new Ae("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):Hn(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=jk(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let u=o.length;if(u%2>0)throw new $("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let d=o.map(p=>new Ot({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(i!=null)throw new Ae("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof Er;for(let u of a)if(u instanceof Er!==c)throw new $("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return j(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),u=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Bo(s,1));let l;return this.mergeMode==="concat"?l=Bm([i,s]):this.mergeMode==="sum"?l=oe(i,s):this.mergeMode==="ave"?l=V(.5,oe(i,s)):this.mergeMode==="mul"?l=V(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Xi(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Xi(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=Kr(r.layer);if(delete r.layer,r.numConstants!=null)throw new Ae("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return t.className="Bidirectional",t})();Q.registerClass(Uj);var jj;(function(t){let n;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(jj||(jj={}));var Ohe=vh(nA());var Mhe=vh(nA());var a1t=Symbol("out"),l1t=Symbol("field"),c1t=Symbol("quote"),u1t=Symbol("quoteafterquote"),d1t=Symbol("quoteinquote");function J(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&C.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the CPU backend.`)})}var Hhe=dr.whereImpl,iG=(()=>{class t extends ha{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new hd(this,ul())}nextDataId(){return t.nextDataId++}write(e,r,o){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&T.warn(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&C.isString(o[0])){let s=o.map(a=>C.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return T.mergeRealAndImagArrays(i,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>C.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(e.shape,e.dtype,o)}makeOutput(e,r,o){let i=this.write(e,r,o);return ul().makeTensorFromDataId(i,r,o,this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=C.now();return e(),{kernelMs:C.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){J([e],"where");let r=this.readSync(e.dataId);return Hhe(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return t.nextDataId=0,t})();var _A={};rs(_A,{addImpl:()=>iA,bincountImpl:()=>Jm,bincountReduceImpl:()=>kC,ceilImpl:()=>sA,concatImpl:()=>AC,expImpl:()=>aA,expm1Impl:()=>cA,floorImpl:()=>uA,gatherV2Impl:()=>RC,greaterImpl:()=>dA,lessImpl:()=>pA,linSpaceImpl:()=>MC,logImpl:()=>fA,maxImpl:()=>FC,maximumImpl:()=>mA,minimumImpl:()=>hA,multiplyImpl:()=>Yy,negImpl:()=>gA,notEqualImpl:()=>yA,prodImpl:()=>vA,rangeImpl:()=>OC,rsqrtImpl:()=>xA,simpleAbsImpl:()=>oA,sliceImpl:()=>bA,sparseFillEmptyRowsImpl:()=>PC,sparseReshapeImpl:()=>LC,squaredDifferenceImpl:()=>wA,stridedSliceImpl:()=>$C,subImpl:()=>CA,tileImpl:()=>VC,topKImpl:()=>BC,transposeImpl:()=>eh,uniqueImpl:()=>zC});function oA(t){let n=new Float32Array(t.length);for(let e=0;e<t.length;++e)n[e]=Math.abs(t[e]);return n}var qhe=t=>{let{x:n}=t.inputs,e=t.backend;J(n,"abs");let r=new Float32Array(C.sizeFromShape(n.shape)),o=e.data.get(n.dataId).values;return r=oA(o),e.makeOutput(r,n.shape,"float32")},sG={kernelName:ac,backendName:"cpu",kernelFunc:qhe};function rt(t){return(n,e,r,o,i)=>{let s=T.assertAndGetBroadcastShape(n,e),a=s.length,l=C.computeStrides(s),c=C.sizeFromShape(s),u=C.getTypedArrayFromDType(i,c),d=n.length,p=e.length,f=C.computeStrides(n),m=C.computeStrides(e),h=T.getBroadcastDims(n,s),g=T.getBroadcastDims(e,s);if(h.length+g.length===0)for(let x=0;x<u.length;++x)u[x]=t(r[x%r.length],o[x%o.length]);else for(let x=0;x<u.length;++x){let b=C.indexToLoc(x,a,l),I=b.slice(-d);h.forEach(D=>I[D]=0);let _=C.locToIndex(I,d,f),E=b.slice(-p);g.forEach(D=>E[D]=0);let S=C.locToIndex(E,p,m);u[x]=t(r[_],o[S])}return[u,s]}}function On(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var aG={kernelName:jf,backendName:"cpu",kernelFunc:On};function Zm(t,n,e="float32"){if(e==="complex64"){let o=Zm(t,n,"float32"),i=Zm(t,n,"float32");return On({inputs:{real:o,imag:i},backend:t})}let r=C.makeZerosTypedArray(C.sizeFromShape(n),e);return t.makeTensorInfo(n,e,r)}function fr(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var lG={kernelName:Cs,backendName:"cpu",kernelFunc:fr};function xi(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var cG={kernelName:sm,backendName:"cpu",kernelFunc:xi};function bi(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return fr({inputs:{x:o},backend:e});let s=Zm(e,o.shape,o.dtype),a=bi({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=On({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=xi({inputs:{input:o},backend:e}),a=bi({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!C.hasEncodingLoss(o.dtype,i)){let s=fr({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32"){let s=e.data.get(o.dataId).values,a=Int32Array.from(s);return e.makeTensorInfo(o.shape,"int32",a)}if(i==="bool"){let s=e.data.get(o.dataId).values,a=C.toTypedArray([0],o.dtype),[l,c]=rt((u,d)=>u!==d?1:0)(o.shape,[],s,a,"bool");return e.makeTensorInfo(c,"bool",l)}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var uG={kernelName:ws,backendName:"cpu",kernelFunc:bi};function yt(t,n,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;J([s,a],t);let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let c=bi({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,m=l.data.get(p.dataId).values,h=bi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(h.dataId),x=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,I=l.data.get(x.dataId).values,_=l.data.get(b.dataId).values,[E,S,D]=e(s.shape,a.shape,f,m,I,_),M=l.makeTensorInfo(D,"float32",E),R=l.makeTensorInfo(D,"float32",S),L=On({inputs:{real:M,imag:R},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(M),l.disposeIntermediateTensorInfo(R),L}else{let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}}}function Qm(t){return(n,e,r,o,i,s)=>{let a=T.assertAndGetBroadcastShape(n,e),l=C.sizeFromShape(a),c=a.length,u=C.computeStrides(a),d=C.getTypedArrayFromDType("float32",l),p=C.getTypedArrayFromDType("float32",l),f=T.getBroadcastDims(n,a),m=T.getBroadcastDims(e,a),h=T.mergeRealAndImagArrays(r,o),g=T.mergeRealAndImagArrays(i,s),x=n.length,b=C.computeStrides(n),I=e.length,_=C.computeStrides(e);if(f.length+m.length===0)for(let E=0;E<d.length;E++){let S=E%h.length,D=E%g.length,M=t(h[S*2],h[S*2+1],g[D*2],g[D*2+1]);d[E]=M.real,p[E]=M.imag}else for(let E=0;E<d.length;E++){let S=C.indexToLoc(E,c,u),D=S.slice(-x);f.forEach(W=>D[W]=0);let M=C.locToIndex(D,x,b),R=S.slice(-I);m.forEach(W=>R[W]=0);let L=C.locToIndex(R,I,_),G=t(h[M*2],h[M*2+1],g[L*2],g[L*2+1]);d[E]=G.real,p[E]=G.imag}return[d,p,a]}}var iA=rt((t,n)=>t+n),Khe=Qm((t,n,e,r)=>({real:t+e,imag:n+r})),El=yt(zi,iA,Khe),dG={kernelName:zi,backendName:"cpu",kernelFunc:El};function Jm(t,n,e,r,o){let i=C.sizeFromShape(r),s=C.makeZerosTypedArray(o,e);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=n[a]:s[l]+=1)}return s}function kC(t,n,e,r=!1){let o=t.shape[0],i=t.shape[1],s=Te([o,e],n.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?s.set(1,a,c):n.size>0?s.set(s.get(a,c)+n.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}function wi(t){return(n,e,r)=>{let o=C.getTypedArrayFromDType(e,n.length);for(let i=0;i<n.length;++i)o[i]=t(n[i],r);return o}}function Oe(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(J(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=C.sizeFromShape(s.shape),u=e||s.dtype,d=C.getArrayFromDType(u,c);for(let p=0;p<c;++p)d[p]=n(l[p],o);return a.makeTensorInfo(s.shape,u,d)}}function Ci(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(J(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=e||s.dtype,u=n(l,c,o);return a.makeTensorInfo(s.shape,c,u)}}var sA=wi(t=>Math.ceil(t)),Xhe=Ci(_a,sA),pG={kernelName:_a,backendName:"cpu",kernelFunc:Xhe};function AC(t,n,e,r){let o=C.getArrayFromDType(e,C.sizeFromShape(n));if(r&&e!=="string"){let i=0;t.forEach(s=>{let a=C.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;t.forEach(s=>{let a=e==="string"?T.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let c=0;c<s.shape[0];++c){let u=c*n[1]+i;for(let d=0;d<s.shape[1];++d)o[u+d]=a[l++]}i+=s.shape[1]})}return o}var aA=wi(t=>Math.exp(t)),lA=Ci(ka,aA),fG={kernelName:ka,backendName:"cpu",kernelFunc:lA};var cA=wi(t=>Math.expm1(t)),Yhe=Ci(Aa,cA),mG={kernelName:Aa,backendName:"cpu",kernelFunc:Yhe};var uA=wi(t=>Math.floor(t)),Zhe=Ci(Ra,uA),hG={kernelName:Ra,backendName:"cpu",kernelFunc:Zhe};function RC(t,n,e){let r=Te(e,t.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],c=n.locToIndex([a,l]);s[2]=n.values[c];let u=t.locToIndex(s);r.values[o]=t.values[u]}return r}var dA=rt((t,n)=>t>n?1:0),Qhe=yt(xd,dA,null,"bool"),gG={kernelName:xd,backendName:"cpu",kernelFunc:Qhe};var pA=rt((t,n)=>t<n?1:0),Jhe=yt(bd,pA,null,"bool"),yG={kernelName:bd,backendName:"cpu",kernelFunc:Jhe};function MC(t,n,e){let r=(n-t)/(e-1),o=C.makeZerosTypedArray(e,"float32");o[0]=t;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var fA=wi(t=>Math.log(t)),ege=Ci($a,fA),vG={kernelName:$a,backendName:"cpu",kernelFunc:ege};function FC(t,n,e,r){let o=C.getTypedArrayFromDType(r,C.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*n,a=t[s];for(let l=0;l<n;++l){let c=t[s+l];c>a&&(a=c)}o[i]=a}return o}var mA=rt((t,n)=>Math.max(t,n)),tge=yt(Ba,mA),xG={kernelName:Ba,backendName:"cpu",kernelFunc:tge};var hA=rt((t,n)=>Math.min(t,n)),nge=yt(za,hA),bG={kernelName:za,backendName:"cpu",kernelFunc:nge};var Yy=rt((t,n)=>t*n),rge=Qm((t,n,e,r)=>({real:t*e-n*r,imag:t*r+n*e})),cp=yt(ja,Yy,rge),wG={kernelName:ja,backendName:"cpu",kernelFunc:cp};function gA(t,n,e){let r=C.createScalarValue(-1,e);return Yy([],n,r,t,e)}function oge(t){let{inputs:n,backend:e}=t,{x:r}=n;J(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=gA(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var CG={kernelName:Mc,backendName:"cpu",kernelFunc:oge};var yA=rt((t,n)=>t!==n?1:0),ige=yt(Ed,yA,null,"bool"),_G={kernelName:Ed,backendName:"cpu",kernelFunc:ige};function eh(t,n,e,r,o){let i=n.length,s=C.sizeFromShape(n),a=C.computeStrides(n),l=C.computeStrides(o),c=C.getTypedArrayFromDType(e,C.sizeFromShape(o));for(let u=0;u<s;++u){let d=C.indexToLoc(u,i,a),p=new Array(d.length);for(let m=0;m<p.length;m++)p[m]=d[r[m]];let f=C.locToIndex(p,i,l);c[f]=t[u]}return c}function Cn(t){let{inputs:n,attrs:e,backend:r}=t,{x:o}=n,{perm:i}=e;J(o,"transpose");let s=o.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=o.shape[i[d]];let l=r.data.get(o.dataId).values,c=eh(l,o.shape,o.dtype,i,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var IG={kernelName:Xc,backendName:"cpu",kernelFunc:Cn};function vA(t,n,e,r){let[o,i]=T.computeOutAndReduceShapes(t,r),s=Fn(n,"int32"),a=C.makeZerosTypedArray(C.sizeFromShape(o),s),l=C.sizeFromShape(i);for(let c=0;c<a.length;++c){let u=c*l,d=1;for(let p=0;p<l;++p)d*=e[u+p];a[c]=d}return{outVals:a,outShape:o,outDtype:s}}function sge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"prod");let a=o.shape.length,l=C.parseAxisParam(i,o.shape),c=T.getAxesPermutation(l,a),u=l,d=o,p=[];c!=null&&(d=Cn({inputs:{x:o},backend:e,attrs:{perm:c}}),p.push(d),u=T.getInnerMostAxes(u.length,a));let f=e.data.get(d.dataId).values,{outVals:m,outShape:h,outDtype:g}=vA(d.shape,d.dtype,f,u),x=h;return s&&(x=T.expandShapeToKeepDim(h,l)),p.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(x,g,m)}var EG={kernelName:om,backendName:"cpu",kernelFunc:sge};function OC(t,n,e,r){let o=t===n,i=t<n&&e<0,s=n<t&&e>1;if(o||i||s)return C.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((n-t)/e)),l=C.makeZerosTypedArray(a,r);n<t&&e===1&&(e=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+e;return l}var xA=wi(t=>1/Math.sqrt(t)),age=Ci(Xa,xA),SG={kernelName:Xa,backendName:"cpu",kernelFunc:age};function bA(t,n,e,r,o){let i=ar.isSliceContinous(r,n,e),s=C.sizeFromShape(e),a=C.computeStrides(r);if(i){let d=ar.computeFlatOffset(n,a);return o==="string"?t.slice(d,d+s):t.subarray(d,d+s)}let l=o==="string"?T.fromUint8ToStringArray(t):t,c=Te(r,o,l),u=Te(e,o);for(let d=0;d<u.size;++d){let p=u.indexToLoc(d),f=p.map((m,h)=>m+n[h]);u.set(c.get(...f),...p)}return o==="string"?T.fromStringArrayToUint8(u.values):u.values}function _i(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r;J(o,"slice");let[a,l]=ar.parseSliceParams(o,i,s);ar.assertParamsValid(o,a,l);let c=e.data.get(o.dataId).values,u=bA(c,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,u)}var TG={kernelName:Gc,backendName:"cpu",kernelFunc:_i};function PC(t,n,e,r,o,i,s){let a=n[0],l=i[0],c=new Array(l),u=new Array(a),d=n[1];if(l===0){if(a!==0)throw new Error(`Received SparseTensor with denseShape[0] = 0 but
         indices.shape[0] = ${a}`);let g=C.getArrayFromDType(e,0),x=C.getArrayFromDType(o,0);return[g,[0,d],x,c,u]}let p=!0,f=0,m=new Array(l).fill(0);for(let g=0;g<a;++g){let x=t[g*d];if(x<0)throw new Error(`indices(${g}, 0) is invalid: ${x} < 0`);if(x>=l)throw new Error(`indices(${g}, 0) is invalid: ${x} >= ${l}`);++m[x],p=p&&x>=f,f=x}let h=!0;for(let g=0;g<l;++g){let x=m[g]===0;c[g]=x,h=h&&!x,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(h&&p){let g=t,x=r;for(let b=0;b<a;++b)u[b]=b;return[g,[a,d],x,c,u]}else{let g=m[l-1],x=C.getArrayFromDType(e,g*d),b=C.getArrayFromDType(o,g),I=new Array(l).fill(0);for(let _=0;_<a;++_){let E=t[_*d],S=I[E],D=(E===0?0:m[E-1])+S;I[E]++;for(let M=0;M<d;++M)x[D*d+M]=t[_*d+M];b[D]=r[_],u[_]=D}for(let _=0;_<l;++_)if(I[_]===0){let S=_===0?0:m[_-1];x[S*d+0]=_;for(let D=1;D<d;++D)x[S*d+D]=0;b[S]=s}return[x,[a,d],b,c,u]}}function LC(t,n,e,r,o){let i=C.sizeFromShape(r),s=n[0],a=o.length,l=[],c=1,u=-1;for(let g=0;g<a;++g){let x=o[g];if(x===-1){if(u!==-1)throw new Error(`only one output dimension may be -1, not both ${u} and ${g}`);u=g,l.push(1)}else{if(x<0)throw new Error(`size ${g} must be non-negative, not ${x}`);c*=x,l.push(x)}}if(u!==-1){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");let g=Math.trunc(i/c);if(c*g!==i)throw new Error(`Input to reshape is a SparseTensor with ${i}
          dense values, but the requested shape requires a multiple of ${c}. inputShape=${r} outputShape= ${l}`);l[u]=g}let d=C.sizeFromShape(l);if(d!==i)throw new Error(`Input to reshape is a tensor with ${i} dense values, but the requested shape has ${d}. inputShape=${r} outputShape=${l}`);let p=r.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}let m=[];if(a>0){m[a-1]=1;for(let g=a-2;g>=0;--g)m[g]=m[g+1]*l[g+1]}let h=C.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let x=0;for(let b=0;b<p;++b)x+=t[g*p+b]*f[b];for(let b=0;b<a;++b)h[g*a+b]=Math.trunc(x/m[b]),x%=m[b]}return[h,[s,a],l]}var wA=rt((t,n)=>{let e=t-n;return e*e}),lge=yt(rl,wA),DG={kernelName:rl,backendName:"cpu",kernelFunc:lge};function $C(t,n,e,r){let o=Te(t,n.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(n.get(...a),...s)}return o}var CA=rt((t,n)=>t-n),cge=Qm((t,n,e,r)=>({real:t-e,imag:n-r})),Zy=yt(ol,CA,cge),NG={kernelName:ol,backendName:"cpu",kernelFunc:Zy};function VC(t,n){let e=new Array(t.rank);for(let o=0;o<e.length;o++)e[o]=t.shape[o]*n[o];let r=Te(e,t.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(t.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%t.shape[l];let a=t.locToIndex(s);r.values[o]=t.values[a]}return r}function BC(t,n,e,r,o){let i=n[n.length-1],[s,a]=[t.length/i,i],l=C.getTypedArrayFromDType(e,s*r),c=C.getTypedArrayFromDType("int32",s*r);for(let d=0;d<s;d++){let p=d*a,f=t.subarray(p,p+a),m=[];for(let b=0;b<f.length;b++)m.push({value:f[b],index:b});m.sort((b,I)=>I.value-b.value);let h=d*r,g=l.subarray(h,h+r),x=c.subarray(h,h+r);for(let b=0;b<r;b++)g[b]=m[b].value,x[b]=m[b].index}let u=n.slice();return u[u.length-1]=r,[Te(u,e,l),Te(u,"int32",c)]}function zC(t,n,e,r){let o=C.parseAxisParam(n,e)[0],i=[1,e[0],1];for(let m=0;m<o;m++)i[0]*=e[m];i[1]=e[o];for(let m=o+1;m<e.length;m++)i[2]*=e[m];let s={},a=new Int32Array(e[o]),l=new Mt(i,r,t),c=[],u=i[0]===1&&i[2]===1;for(let m=0;m<e[o];m++){let h;if(u)h=t[m].toString();else{let g=[];for(let x=0;x<i[0];x++)for(let b=0;b<i[2];b++)g.push(l.get(x,m,b));h=g.join(",")}if(s[h]!==void 0)a[m]=s[h];else{let g=Object.keys(s).length;s[h]=g,a[m]=g,c.push(m)}}let d=i.slice();d[1]=Object.keys(s).length;let p=new Mt(d,r);c.forEach((m,h)=>{for(let g=0;g<i[0];g++)for(let x=0;x<i[2];x++)p.set(l.get(g,m,x),g,h,x)});let f=e.slice();return f[o]=d[1],{outputValues:p.values,outputShape:f,indices:a}}ww("cpu",()=>new iG,1);var IA=Oe(Da,t=>t>=0?t:Math.exp(t)-1),kG={kernelName:Da,backendName:"cpu",kernelFunc:IA};function EA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r;J([o],"leakyRelu");let s=C.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=C.getTypedArrayFromDType("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",l)}var AG={kernelName:Ec,backendName:"cpu",kernelFunc:EA};var uge=rt((t,n)=>t<0?n*t:t);function SA(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n;J([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=uge(r.shape,o.shape,i,s,r.dtype);return e.makeTensorInfo(l,r.dtype,a)}var RG={kernelName:$c,backendName:"cpu",kernelFunc:SA};var TA=Oe(Ha,t=>Math.max(0,t)),MG={kernelName:Ha,backendName:"cpu",kernelFunc:TA};var DA=Oe(qa,t=>Math.min(Math.max(0,t),6)),FG={kernelName:qa,backendName:"cpu",kernelFunc:DA};var NA=Oe(el,t=>1/(1+Math.exp(-t))),OG={kernelName:el,backendName:"cpu",kernelFunc:NA};function th(t,n,e,r,o){if(e==="linear")return fr({inputs:{x:n},backend:t});if(e==="relu")return TA({inputs:{x:n},backend:t});if(e==="elu")return IA({inputs:{x:n},backend:t});if(e==="relu6")return DA({inputs:{x:n},backend:t});if(e==="prelu")return SA({inputs:{x:n,alpha:r},backend:t});if(e==="leakyrelu")return EA({inputs:{x:n},backend:t,attrs:{alpha:o}});if(e==="sigmoid")return NA({inputs:{x:n},backend:t});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function ot(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=C.sizeFromShape(o.shape),a=C.inferFromImplicitShape(i,s),l=C.sizeFromShape(a);C.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var PG={kernelName:Vc,backendName:"cpu",kernelFunc:ot};function kA(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;J([o,i],"matMul");let l=o.shape.length,c=i.shape.length,u=s?o.shape[l-2]:o.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],p=s?o.shape[l-1]:o.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],m=o.shape.slice(0,-2),h=i.shape.slice(0,-2),g=C.sizeFromShape(m),x=C.sizeFromShape(h),b=g===x||g===1||x===1;C.assert(l>=2&&c>=2&&b,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${h}).`);let _=(g>x?o.shape.slice(0,-2):i.shape.slice(0,-2)).concat([p,f]);C.assert(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let E=s?[g,u,p]:[g,p,u],S=a?[x,f,d]:[x,d,f],D=ot({inputs:{x:o},backend:e,attrs:{shape:E}}),M=ot({inputs:{x:i},backend:e,attrs:{shape:S}}),R=s?D.shape[1]:D.shape[2],L=s?D.shape[2]:D.shape[1],G=a?M.shape[1]:M.shape[2],W=Math.max(g,x),q=e.data.get(D.dataId).values,X=e.data.get(M.dataId).values,K=C.computeStrides(D.shape),Z=C.computeStrides(M.shape),[ae,ee,ie]=s?[K[0],1,K[1]]:[K[0],K[1],1],[ue,fe,ge]=a?[1,Z[1],Z[0]]:[Z[1],1,Z[0]],he=L*G,ve=Te([W,L,G],D.dtype),xe=ve.values,we=e.blockSize;for(let Ne=0;Ne<W;Ne++)for(let Le=0;Le<L;Le+=we)for(let Be=0;Be<G;Be+=we)for(let Ze=0;Ze<R;Ze+=we){let pt=Math.min(Le+we,L),zt=Math.min(Be+we,G),yn=Math.min(Ze+we,R);for(let rn=Le;rn<pt;rn++)for(let Yt=Be;Yt<zt;Yt++){let Zt=0;for(let on=Ze;on<yn;on++){let Tn=Math.min(Ne,g-1)*ae,Ps=Math.min(Ne,x-1)*ge,nr=q[Tn+rn*ee+on*ie],ns=X[on*ue+Yt*fe+Ps];Zt+=nr*ns}xe[Ne*he+(rn*G+Yt)]+=Zt}}return e.disposeIntermediateTensorInfo(D),e.disposeIntermediateTensorInfo(M),e.makeTensorInfo(_,ve.dtype,ve.values)}var LG={kernelName:pc,backendName:"cpu",kernelFunc:kA};function dge(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r,p,f,m,h=[];p=kA({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:e}),s&&(f=El({inputs:{a:p,b:s},backend:e}),h.push(p),p=f),u&&(m=th(e,p,u,a,d),h.push(p),p=m);for(let x of h)e.disposeIntermediateTensorInfo(x);return p}var $G={kernelName:Sd,backendName:"cpu",kernelFunc:dge};var pge=Oe(ga,t=>Math.acos(t)),VG={kernelName:ga,backendName:"cpu",kernelFunc:pge};var fge=Oe(ya,t=>Math.acosh(t)),BG={kernelName:ya,backendName:"cpu",kernelFunc:fge};function mge(t){let{inputs:n,backend:e}=t,r=n;J(n,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=Te(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var zG={kernelName:$f,backendName:"cpu",kernelFunc:mge};function hge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"all");let a=C.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=Cn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=C.sizeFromShape(p),m=C.makeZerosTypedArray(C.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,I=h[b];for(let _=0;_<f;++_){let E=h[b+_];I=I&&E}m[x]=I}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=ot({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var UG={kernelName:Vf,backendName:"cpu",kernelFunc:hge};function gge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"any");let a=C.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=Cn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=C.sizeFromShape(p),m=C.makeZerosTypedArray(C.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,I=h[b];for(let _=0;_<f;++_){let E=h[b+_];I=I||E}m[x]=I}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=ot({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var jG={kernelName:Bf,backendName:"cpu",kernelFunc:gge};function yge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;J(o,"argMax");let s=C.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Cn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=C.sizeFromShape(u),f=C.makeZerosTypedArray(p,"int32"),m=C.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let x=g*m,b=h[x],I=0;for(let _=0;_<m;++_){let E=h[x+_];E>b&&(b=E,I=_)}f[g]=I}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var GG={kernelName:lc,backendName:"cpu",kernelFunc:yge};function vge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;J(o,"argMin");let s=C.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Cn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=C.sizeFromShape(u),f=C.makeZerosTypedArray(p,"int32"),m=C.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let x=g*m,b=h[x],I=0;for(let _=0;_<m;++_){let E=h[x+_];E<b&&(b=E,I=_)}f[g]=I}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var WG={kernelName:cc,backendName:"cpu",kernelFunc:vge};var xge=Oe(va,t=>Math.asin(t)),HG={kernelName:va,backendName:"cpu",kernelFunc:xge};var bge=Oe(xa,t=>Math.asinh(t)),qG={kernelName:xa,backendName:"cpu",kernelFunc:bge};var wge=Oe(ba,t=>Math.atan(t)),KG={kernelName:ba,backendName:"cpu",kernelFunc:wge};var Cge=rt((t,n)=>Math.atan2(t,n)),_ge=yt(Ca,Cge),XG={kernelName:Ca,backendName:"cpu",kernelFunc:_ge};var Ige=Oe(wa,t=>Math.atanh(t)),YG={kernelName:wa,backendName:"cpu",kernelFunc:Ige};function nh(t,n,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=o.padInfo.top,f=o.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Te(o.outShape,e),g=h.values,x=o.outShape[1]*o.outShape[2]*o.outShape[3],b=o.outShape[2]*o.outShape[3],I=o.outShape[3];for(let _=0;_<o.batchSize;++_){let E=_*x,S=_*r[0];for(let D=0;D<o.inChannels;++D)for(let M=0;M<o.outHeight;++M){let R=M*s-p,L=Math.max(0,R),G=Math.min(o.inHeight,u+R),W=E+M*b;for(let q=0;q<o.outWidth;++q){let X=q*a-f,K=Math.max(0,X),Z=Math.min(o.inWidth,d+X),ae=m,ee=0,ie=0;for(let fe=L;fe<G;fe+=l){let ge=S+fe*r[1];for(let he=K;he<Z;he+=c){let ve=ge+he*r[2],xe=t[ve+D];i==="max"&&xe>ae?ae=xe:i==="avg"&&(ee+=xe,ie++)}if(isNaN(ae))break}let ue=W+q*I+D;g[ue]=i==="avg"?ee/ie:ae}}}return h}function UC(t,n,e,r,o=!1,i=!1){let s=Te(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left,h=Te(n,e,t);for(let g=0;g<r.batchSize;++g)for(let x=0;x<r.inChannels;++x)for(let b=0;b<r.outHeight;++b){let I=b*a-f,_=I;for(;_<0;)_+=c;let E=Math.min(r.inHeight,d+I);for(let S=0;S<r.outWidth;++S){let D=S*l-m,M=D;for(;M<0;)M+=u;let R=Math.min(r.inWidth,p+D),L=Number.NEGATIVE_INFINITY,G=-1;for(let W=_;W<E;W+=c){let q=W-I;for(let X=M;X<R;X+=u){let K=X-D,Z=h.get(g,W,X,x);Z>L&&(L=Z,o?G=i?((g*r.inHeight+W)*r.inWidth+X)*r.inChannels+x:(W*r.inWidth+X)*r.inChannels+x:G=q*p+K)}}s.set(G,g,b,S,x)}}return s}function jC(t,n,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,g=o.padInfo.top,x=o.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=Te(o.outShape,e),_=I.values,E=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[2]*o.outShape[3]*o.outShape[4],D=o.outShape[3]*o.outShape[4],M=o.outShape[4];for(let R=0;R<o.batchSize;++R){let L=R*E,G=R*r[0];for(let W=0;W<o.inChannels;++W)for(let q=0;q<o.outDepth;++q){let X=q*s-h,K=X;for(;K<0;)K+=c;let Z=Math.min(o.inDepth,p+X),ae=L+q*S;for(let ee=0;ee<o.outHeight;++ee){let ie=ee*a-g,ue=ie;for(;ue<0;)ue+=u;let fe=Math.min(o.inHeight,f+ie),ge=ae+ee*D;for(let he=0;he<o.outWidth;++he){let ve=he*l-x,xe=ve;for(;xe<0;)xe+=d;let we=Math.min(o.inWidth,m+ve),Ne=ge+he*M,Le=b,Be=0,Ze=0;for(let zt=K;zt<Z;zt+=c){let yn=G+zt*r[1];for(let rn=ue;rn<fe;rn+=u){let Yt=yn+rn*r[2];for(let Zt=xe;Zt<we;Zt+=d){let on=Yt+Zt*r[3],Tn=t[on+W];if(i==="max"&&Tn>Le?Le=Tn:i==="avg"&&(Be+=Tn,Ze++),isNaN(Le))break}if(isNaN(Le))break}if(isNaN(Le))break}let pt=Ne+W;_[pt]=i==="avg"?Be/Ze:Le}}}}return I}function ZG(t,n){let e=Te(n.outShape,"int32"),r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,u=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,f=n.padInfo.top,m=n.padInfo.left;for(let h=0;h<n.batchSize;++h)for(let g=0;g<n.inChannels;++g)for(let x=0;x<n.outDepth;++x){let b=x*r-p,I=b;for(;I<0;)I+=s;let _=Math.min(n.inDepth,c+b);for(let E=0;E<n.outHeight;++E){let S=E*o-f,D=S;for(;D<0;)D+=a;let M=Math.min(n.inHeight,u+S);for(let R=0;R<n.outWidth;++R){let L=R*i-m,G=L;for(;G<0;)G+=l;let W=Math.min(n.inWidth,d+L),q=Number.NEGATIVE_INFINITY,X=-1;for(let K=I;K<_;K+=s){let Z=K-b;for(let ae=D;ae<M;ae+=a){let ee=ae-S;for(let ie=G;ie<W;ie+=l){let ue=ie-L,fe=t.get(h,K,ae,ie,g);fe>=q&&(q=fe,X=Z*u*d+ee*u+ue)}}}e.set(X,h,x,E,R,g)}}}return e}function Ege(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;J(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;C.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))d=fr({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=C.computeStrides(o.shape),m=nh(p,o.shape,o.dtype,f,u,"avg");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var QG={kernelName:uc,backendName:"cpu",kernelFunc:Ege};function Sge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;J(o,"avgPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=jC(d,o.shape,o.dtype,C.computeStrides(o.shape),u,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var JG={kernelName:dc,backendName:"cpu",kernelFunc:Sge};function Tge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;J([o,i],"avgPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.filterDepth,h=u.filterHeight,g=u.filterWidth,x=u.dilationDepth,b=u.dilationHeight,I=u.dilationWidth,_=u.effectiveFilterDepth,E=u.effectiveFilterHeight,S=u.effectiveFilterWidth,D=_-1-u.padInfo.front,M=S-1-u.padInfo.left,R=E-1-u.padInfo.top,L=Te(i.shape,"float32"),G=1/(m*h*g),W=e.bufferSync(o);for(let q=0;q<u.batchSize;++q)for(let X=0;X<u.inChannels;++X)for(let K=0;K<u.inDepth;++K)for(let Z=0;Z<u.inHeight;++Z)for(let ae=0;ae<u.inWidth;++ae){let ee=K-D,ie=Z-R,ue=ae-M,fe=0;for(let ge=0;ge<_;ge+=x){let he=(ee+ge)/d;if(!(he<0||he>=u.outDepth||Math.floor(he)!==he))for(let ve=0;ve<E;ve+=b){let xe=(ie+ve)/p;if(!(xe<0||xe>=u.outHeight||Math.floor(xe)!==xe))for(let we=0;we<S;we+=I){let Ne=(ue+we)/f;if(Ne<0||Ne>=u.outWidth||Math.floor(Ne)!==Ne)continue;let Le=W.get(q,he,xe,Ne,X);fe+=Le}}}L.set(fe*G,q,K,Z,ae,X)}return e.makeTensorInfo(L.shape,L.dtype,L.values)}var eW={kernelName:Uf,backendName:"cpu",kernelFunc:Tge};function Dge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;J([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=u.strideHeight,p=u.strideWidth,f=u.filterHeight,m=u.filterWidth,h=u.dilationHeight,g=u.dilationWidth,x=u.effectiveFilterHeight,b=u.effectiveFilterWidth,I=b-1-u.padInfo.left,_=x-1-u.padInfo.top,E=Te(s.shape,"float32"),S=1/(f*m),D=e.data.get(o.dataId).values,M=Te(o.shape,"float32",D);for(let R=0;R<u.batchSize;++R)for(let L=0;L<u.inChannels;++L)for(let G=0;G<u.inHeight;++G)for(let W=0;W<u.inWidth;++W){let q=G-_,X=W-I,K=0;for(let Z=0;Z<x;Z+=h){let ae=(q+Z)/d;if(!(ae<0||ae>=u.outHeight||Math.floor(ae)!==ae))for(let ee=0;ee<b;ee+=g){let ie=(X+ee)/p;if(ie<0||ie>=u.outWidth||Math.floor(ie)!==ie)continue;let ue=M.get(R,ae,ie,L);K+=ue}}E.set(K*S,R,G,W,L)}return e.makeTensorInfo(E.shape,E.dtype,E.values)}var tW={kernelName:zf,backendName:"cpu",kernelFunc:Dge};function Nge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,scale:i,offset:s,mean:a,variance:l}=n;C.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),J([o,a,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,p=e.data.get(l.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),m=s?e.data.get(s.dataId).values:new Float32Array([0]),h=new Float32Array(u.length),g=m.length,x=f.length,b=p.length,I=d.length,_=0,E=0,S=0,D=0;for(let M=0;M<u.length;++M)h[M]=m[_++]+(u[M]-d[E++])*f[S++]/Math.sqrt(p[D++]+c),_>=g&&(_=0),E>=I&&(E=0),S>=x&&(S=0),D>=b&&(D=0);return e.makeTensorInfo(o.shape,o.dtype,h)}var nW={kernelName:_c,backendName:"cpu",kernelFunc:Nge};function kge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;J([o],"batchToSpaceND");let a=i.reduce((x,b)=>x*b),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=ot({inputs:{x:o},backend:e,attrs:{shape:l}}),m=Cn({inputs:{x:f},backend:e,attrs:{perm:c}}),h=ot({inputs:{x:m},backend:e,attrs:{shape:u}}),g=_i({inputs:{x:h},backend:e,attrs:{begin:d,size:p}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var rW={kernelName:fc,backendName:"cpu",kernelFunc:kge};function Age(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=Jm(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var oW={kernelName:Bb,backendName:"cpu",kernelFunc:Age};var Rge=Oe(Ia,(t,n)=>{let e=n;return t>e.clipValueMax?e.clipValueMax:t<e.clipValueMin?e.clipValueMin:t}),iW={kernelName:Ia,backendName:"cpu",kernelFunc:Rge};var Mge=t=>{let{x:n}=t.inputs,e=t.backend,r=new Float32Array(C.sizeFromShape(n.shape)),o=e.data.get(n.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let c=0;c<a.length;c++){let u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return e.makeOutput(r,n.shape,"float32")},sW={kernelName:mc,backendName:"cpu",kernelFunc:Mge};function Ms(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var aW={kernelName:em,backendName:"cpu",kernelFunc:Ms};function hu(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=C.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(h=>h.shape),i);if(C.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(h=>C.sizeFromShape(h.shape)>0);if(a.length===1)return fr({inputs:{x:a[0]},backend:e});let l=a.map(h=>h.shape);if(T.assertParamsConsistent(l,i),a[0].dtype==="complex64"){let h=a.map(_=>xi({inputs:{input:_},backend:e})),g=a.map(_=>Ms({inputs:{input:_},backend:e})),x=hu({inputs:h,backend:e,attrs:{axis:i}}),b=hu({inputs:g,backend:e,attrs:{axis:i}}),I=On({inputs:{real:x,imag:b},backend:e});return h.forEach(_=>e.disposeIntermediateTensorInfo(_)),g.forEach(_=>e.disposeIntermediateTensorInfo(_)),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),I}let c=a.map(h=>{let x=[-1,C.sizeFromShape(h.shape.slice(i))];return ot({inputs:{x:h},backend:e,attrs:{shape:x}})}),u=c.map(h=>({vals:e.data.get(h.dataId).values,shape:h.shape}));s=T.computeOutShape(c.map(h=>h.shape),1);let d=c[0].shape[0]===1,p=AC(u,s,n[0].dtype,d),f=T.computeOutShape(a.map(h=>h.shape),i),m=e.makeTensorInfo(f,n[0].dtype,p);return c.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var lW={kernelName:hc,backendName:"cpu",kernelFunc:hu};function AA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;J([o,i],"conv2d");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f=p.filterHeight,m=p.filterWidth,h=p.dilationHeight,g=p.dilationWidth,x=p.padInfo.left,b=p.padInfo.top,I=p.dataFormat==="channelsLast",_=new Mt(p.outShape,o.dtype),E=C.computeStrides(o.shape),S=C.computeStrides(i.shape),D=E[0],M=I?E[1]:E[2],R=I?E[2]:1,L=I?1:E[1],G=_.strides[0],W=I?_.strides[1]:_.strides[2],q=I?_.strides[2]:1,X=I?1:_.strides[1],K=e.data.get(o.dataId).values,Z=e.data.get(i.dataId).values,ae=_.values;for(let ee=0;ee<p.batchSize;++ee){let ie=ee*D,ue=ee*G;for(let fe=0;fe<p.outHeight;++fe){let ge=ue+fe*W,he=fe*p.strideHeight-b;for(let ve=0;ve<f;++ve){let xe=he+ve*h;if(xe<0||xe>=p.inHeight)continue;let we=ve*S[0],Ne=ie+xe*M;for(let Le=0;Le<p.outWidth;++Le){let Be=ge+Le*q,Ze=Le*p.strideWidth-x;for(let pt=0;pt<m;++pt){let zt=Ze+pt*g;if(zt<0||zt>=p.inWidth)continue;let yn=we+pt*S[1],rn=Ne+zt*R,Yt=yn;for(let Zt=0;Zt<p.inChannels;++Zt){let on=K[rn+Zt*L];for(let Tn=0;Tn<p.outChannels;++Tn)ae[Be+Tn*X]+=on*Z[Yt+Tn];Yt+=p.outChannels}}}}}}return e.makeTensorInfo(_.shape,_.dtype,ae)}var cW={kernelName:gc,backendName:"cpu",kernelFunc:AA};function Fge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;J([o,i],"conv2dBackpropFilter");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),{strideHeight:f,strideWidth:m,filterHeight:h,filterWidth:g}=p,x=p.dataFormat==="channelsLast",b=new Mt(p.filterShape,"float32"),I=p.padInfo.left,_=p.padInfo.top,E=e.data.get(o.dataId).values,S=e.data.get(i.dataId).values,D=new Mt(o.shape,o.dtype,E),M=new Mt(i.shape,i.dtype,S);for(let R=0;R<h;++R){let L=Math.max(0,Math.ceil((_-R)/f)),G=Math.min(p.outHeight,(p.inHeight+_-R)/f);for(let W=0;W<g;++W){let q=Math.max(0,Math.ceil((I-W)/m)),X=Math.min(p.outWidth,(p.inWidth+I-W)/m);for(let K=0;K<p.inChannels;++K)for(let Z=0;Z<p.outChannels;++Z){let ae=0;for(let ee=0;ee<p.batchSize;++ee)for(let ie=L;ie<G;++ie){let ue=R+ie*f-_;for(let fe=q;fe<X;++fe){let ge=W+fe*m-I;x?ae+=D.get(ee,ue,ge,K)*M.get(ee,ie,fe,Z):ae+=D.get(ee,K,ue,ge)*M.get(ee,Z,ie,fe)}}b.set(ae,R,W,K,Z)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var uW={kernelName:Gf,backendName:"cpu",kernelFunc:Fge};function Oge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;J([o,i],"conv2dBackpropInput");let d=C.computeStrides(i.shape),p=C.computeStrides(o.shape),f=T.convertConv2DDataFormat(c),m=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,f),h=new Mt(m.inShape,"float32"),g=h.values,x=e.data.get(o.dataId).values,b=e.data.get(i.dataId).values,[I,_,E]=d,{batchSize:S,filterHeight:D,filterWidth:M,inChannels:R,inHeight:L,inWidth:G,outChannels:W,outHeight:q,outWidth:X,strideHeight:K,strideWidth:Z}=m;f=m.dataFormat;let ae=D-1-m.padInfo.top,ee=M-1-m.padInfo.left,ie=f==="channelsLast",ue=h.strides[0],fe=ie?h.strides[1]:h.strides[2],ge=ie?h.strides[2]:1,he=ie?1:h.strides[1],ve=p[0],xe=ie?p[1]:p[2],we=ie?p[2]:1,Ne=ie?1:p[1];for(let Le=0;Le<S;++Le)for(let Be=0;Be<R;++Be)for(let Ze=0;Ze<L;++Ze){let pt=Ze-ae,zt=Math.max(0,Math.ceil(pt/K)),yn=Math.min(q,(D+pt)/K);for(let rn=0;rn<G;++rn){let Yt=rn-ee,Zt=Math.max(0,Math.ceil(Yt/Z)),on=Math.min(X,(M+Yt)/Z),Tn=0;for(let nr=zt;nr<yn;++nr){let ns=nr*K-pt;for(let wo=Zt;wo<on;++wo){let _u=wo*Z-Yt,Si=ve*Le+xe*nr+we*wo,Ls=I*(D-1-ns)+_*(M-1-_u)+E*Be;for(let kl=0;kl<W;++kl){let Al=x[Si+Ne*kl],Rl=b[Ls+kl];Tn+=Al*Rl}}}let Ps=ue*Le+fe*Ze+ge*rn+he*Be;g[Ps]=Tn}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var dW={kernelName:yc,backendName:"cpu",kernelFunc:Oge};function Pge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r;J([o,i],"conv3d");let c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:h,padInfo:g}=c,x=g.front,b=g.left,I=g.top,_=new Mt(c.outShape,o.dtype),E=e.data.get(o.dataId).values,S=e.data.get(i.dataId).values,D=_.values,M=C.computeStrides(o.shape),R=C.computeStrides(i.shape);for(let L=0;L<c.batchSize;++L){let G=L*M[0],W=L*_.strides[0];for(let q=0;q<c.outDepth;++q){let X=W+q*_.strides[1],K=q*c.strideDepth-x;for(let Z=0;Z<u;++Z){let ae=K+Z*f;if(ae<0||ae>=c.inDepth)continue;let ee=Z*R[0],ie=G+ae*M[1];for(let ue=0;ue<c.outHeight;++ue){let fe=X+ue*_.strides[2],ge=ue*c.strideHeight-I;for(let he=0;he<d;++he){let ve=ge+he*m;if(ve<0||ve>=c.inHeight)continue;let xe=ee+he*R[1],we=ie+ve*M[2];for(let Ne=0;Ne<c.outWidth;++Ne){let Le=fe+Ne*c.outChannels,Be=Ne*c.strideWidth-b;for(let Ze=0;Ze<p;++Ze){let pt=Be+Ze*h;if(pt<0||pt>=c.inWidth)continue;let zt=xe+Ze*R[2],yn=we+pt*c.inChannels,rn=zt;for(let Yt=0;Yt<c.inChannels;++Yt){let Zt=E[yn+Yt];for(let on=0;on<c.outChannels;++on)D[Le+on]+=Zt*S[rn+on];rn+=c.outChannels}}}}}}}}return e.makeTensorInfo(_.shape,_.dtype,_.values)}var pW={kernelName:vc,backendName:"cpu",kernelFunc:Pge};function Lge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r;J([o,i],"conv3dBackpropFilterV2");let c=C.computeStrides(o.shape),u=C.computeStrides(i.shape),d=T.computeConv3DInfo(o.shape,l,s,1,a),p=d.strideDepth,f=d.strideHeight,m=d.strideWidth,h=d.filterDepth,g=d.filterHeight,x=d.filterWidth,b=new Mt(d.filterShape,"float32"),I=b.values,[_,E,S,D]=b.strides,M=e.data.get(i.dataId).values,[R,L,G,W]=u,q=e.data.get(o.dataId).values,[X,K,Z,ae]=c,ee=d.padInfo.front,ie=d.padInfo.left,ue=d.padInfo.top;for(let fe=0;fe<h;++fe){let ge=Math.max(0,Math.ceil((ee-fe)/p)),he=Math.min(d.outDepth,(d.inDepth+ee-fe)/p),ve=fe*_;for(let xe=0;xe<g;++xe){let we=Math.max(0,Math.ceil((ue-xe)/f)),Ne=Math.min(d.outHeight,(d.inHeight+ue-xe)/f),Le=xe*E+ve;for(let Be=0;Be<x;++Be){let Ze=Math.max(0,Math.ceil((ie-Be)/m)),pt=Math.min(d.outWidth,(d.inWidth+ie-Be)/m),zt=Be*S+Le;for(let yn=0;yn<d.inChannels;++yn){let rn=yn*D+zt;for(let Yt=0;Yt<d.outChannels;++Yt){let Zt=0;for(let on=0;on<d.batchSize;++on){let Tn=on*X,Ps=on*R;for(let nr=ge;nr<he;++nr){let wo=(fe+nr*p-ee)*K+Tn,_u=nr*L+Ps;for(let Si=we;Si<Ne;++Si){let kl=(xe+Si*f-ue)*Z+wo,Al=Si*G+_u;for(let Rl=Ze;Rl<pt;++Rl){let FI=(Be+Rl*m-ie)*ae+kl,OI=Rl*W+Al;Zt+=q[FI+yn]*M[OI+Yt]}}}}I[rn+Yt]=Zt}}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var fW={kernelName:Wf,backendName:"cpu",kernelFunc:Lge};function $ge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r;J([o],"conv3dBackpropInputV2");let c=C.computeStrides(o.shape),u=C.computeStrides(i.shape),d=T.computeConv3DInfo(l,i.shape,a,1,s),p=new Mt(d.inShape,"float32"),f=p.values,[m,h,g,x]=p.strides,b=e.data.get(o.dataId).values,[I,_,E,S]=c,D=e.data.get(i.dataId).values,[M,R,L,G]=u,{batchSize:W,filterDepth:q,filterHeight:X,filterWidth:K,inChannels:Z,inDepth:ae,inHeight:ee,inWidth:ie,outChannels:ue,outDepth:fe,outHeight:ge,outWidth:he,strideDepth:ve,strideHeight:xe,strideWidth:we}=d,Ne=q-1-d.padInfo.front,Le=X-1-d.padInfo.top,Be=K-1-d.padInfo.left;for(let Ze=0;Ze<W;++Ze)for(let pt=0;pt<Z;++pt)for(let zt=0;zt<ae;++zt){let yn=zt-Ne,rn=Math.max(0,Math.ceil(yn/ve)),Yt=Math.min(fe,(q+yn)/ve);for(let Zt=0;Zt<ee;++Zt){let on=Zt-Le,Tn=Math.max(0,Math.ceil(on/xe)),Ps=Math.min(ge,(X+on)/xe);for(let nr=0;nr<ie;++nr){let ns=nr-Be,wo=Math.max(0,Math.ceil(ns/we)),_u=Math.min(he,(K+ns)/we),Si=0;for(let Ls=rn;Ls<Yt;++Ls){let kl=Ls*ve-yn;for(let Al=Tn;Al<Ps;++Al){let Rl=Al*xe-on;for(let yh=wo;yh<_u;++yh){let FI=yh*we-ns,OI=I*Ze+_*Ls+E*Al+S*yh,_9=M*(q-1-kl)+R*(X-1-Rl)+L*(K-1-FI)+G*pt;for(let h0=0;h0<ue;++h0){let I9=b[OI+h0],E9=D[_9+h0];Si+=I9*E9}}}}f[m*Ze+h*zt+g*Zt+x*nr+pt]=Si}}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var mW={kernelName:Hf,backendName:"cpu",kernelFunc:$ge};var Vge=Oe(Ea,t=>Math.cos(t)),hW={kernelName:Ea,backendName:"cpu",kernelFunc:Vge};var Bge=Oe(Sa,t=>Math.cosh(t)),gW={kernelName:Sa,backendName:"cpu",kernelFunc:Bge};function zge(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,p,f]=o.shape,m=i.shape[0],[h,g]=a,x=Te([m,h,g,f],"float32"),b=e.data.get(i.dataId).values,I=e.data.get(s.dataId).values,_=e.data.get(o.dataId).values,E=C.computeStrides(o.shape),S=C.computeStrides(x.shape);for(let D=0;D<m;D++){let M=D*4,R=b[M],L=b[M+1],G=b[M+2],W=b[M+3],q=I[D];if(q>=u)continue;let X=h>1?(G-R)*(d-1)/(h-1):0,K=g>1?(W-L)*(p-1)/(g-1):0;for(let Z=0;Z<h;Z++){let ae=h>1?R*(d-1)+Z*X:.5*(R+G)*(d-1);if(ae<0||ae>d-1){for(let ee=0;ee<g;ee++)for(let ie=0;ie<f;ie++){let ue=ie+ee*S[2]+Z*S[1]+D*S[0];x.values[ue]=c}continue}if(l==="bilinear"){let ee=Math.floor(ae),ie=Math.ceil(ae),ue=ae-ee;for(let fe=0;fe<g;fe++){let ge=g>1?L*(p-1)+fe*K:.5*(L+W)*(p-1);if(ge<0||ge>p-1){for(let we=0;we<f;we++){let Ne=we+fe*S[2]+Z*S[1]+D*S[0];x.values[Ne]=c}continue}let he=Math.floor(ge),ve=Math.ceil(ge),xe=ge-he;for(let we=0;we<f;we++){let Ne=we+he*E[2]+ee*E[1]+q*E[0],Le=_[Ne];Ne=we+ve*E[2]+ee*E[1]+q*E[0];let Be=_[Ne];Ne=we+he*E[2]+ie*E[1]+q*E[0];let Ze=_[Ne];Ne=we+ve*E[2]+ie*E[1]+q*E[0];let pt=_[Ne],zt=Le+(Be-Le)*xe,yn=Ze+(pt-Ze)*xe;Ne=we+fe*S[2]+Z*S[1]+D*S[0],x.values[Ne]=zt+(yn-zt)*ue}}}else for(let ee=0;ee<g;++ee){let ie=g>1?L*(p-1)+ee*K:.5*(L+W)*(p-1);if(ie<0||ie>p-1){for(let ge=0;ge<f;ge++){let he=ge+ee*S[2]+Z*S[1]+D*S[0];x.values[he]=c}continue}let ue=Math.round(ie),fe=Math.round(ae);for(let ge=0;ge<f;ge++){let he=ge+ue*E[2]+fe*E[1]+q*E[0],ve=ge+ee*S[2]+Z*S[1]+D*S[0];x.values[ve]=_[he]}}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var yW={kernelName:zb,backendName:"cpu",kernelFunc:zge};function Uge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;J(o,"cumsum");let l=T.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=Cn({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=T.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=Fn(c.dtype,"int32"),p=C.makeZerosTypedArray(C.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],h=a?(x,b)=>x+m-b-1:(x,b)=>x+b;for(let x=0;x<f.length;x+=m)for(let b=0;b<m;b++){let I=h(x,b);if(b===0)p[I]=s?0:f[I];else{let _=h(x,b-1);p[I]=s?f[_]+p[_]:f[I]+p[_]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let x=T.getUndoAxesPermutation(l),b=Cn({inputs:{x:g},backend:e,attrs:{perm:x}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),b}return g}var vW={kernelName:xc,backendName:"cpu",kernelFunc:Uge};function jge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Jm(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=kC(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var xW={kernelName:Ub,backendName:"cpu",kernelFunc:jge};function Gge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;C.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`),C.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*i,p=c*i,f=u/(i*i),m=e.data.get(o.dataId).values,h=new Float32Array(a*d*p*f),g=0;for(let x=0;x<a;++x)for(let b=0;b<d;++b){let I=Math.floor(b/i),_=b%i;for(let E=0;E<p;++E){let S=Math.floor(E/i),D=E%i,M=(_*i+D)*f;for(let R=0;R<f;++R){let G=R+M+u*(S+c*(I+l*x));h[g++]=m[G]}}}return e.makeTensorInfo([a,d,p,f],o.dtype,h)}var bW={kernelName:qf,backendName:"cpu",kernelFunc:Gge};function RA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r;J([o,i],"depthwiseConv2DNative");let u=C.computeStrides(o.shape),d=C.computeStrides(i.shape),p=l;p==null&&(p=[1,1]),C.assert(T.eitherStridesOrDilationsAreOne(s,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`);let f=T.computeConv2DInfo(o.shape,i.shape,s,p,a,c,!0),{filterHeight:m,filterWidth:h,dilationHeight:g,dilationWidth:x,padInfo:b}=f,I=b.left,_=b.top,E=f.outChannels/f.inChannels,S=new Mt(f.outShape,o.dtype),D=e.data.get(o.dataId).values,M=e.data.get(i.dataId).values,R=S.values;for(let L=0;L<f.batchSize;++L){let G=L*u[0],W=L*S.strides[0];for(let q=0;q<f.outHeight;++q){let X=W+q*S.strides[1],K=q*f.strideHeight-_;for(let Z=0;Z<m;++Z){let ae=K+Z*g;if(ae<0||ae>=f.inHeight)continue;let ee=Z*d[0],ie=G+ae*u[1];for(let ue=0;ue<f.outWidth;++ue){let fe=X+ue*S.strides[2],ge=ue*f.strideWidth-I;for(let he=0;he<h;++he){let ve=ge+he*x;if(ve<0||ve>=f.inWidth)continue;let xe=ee+he*d[1],we=ie+ve*f.inChannels,Ne=fe,Le=xe;for(let Be=0;Be<f.inChannels;++Be){let Ze=D[we+Be];for(let pt=0;pt<E;++pt)R[Ne+pt]+=Ze*M[Le+pt];Ne+=E,Le+=E}}}}}}return e.makeTensorInfo(S.shape,S.dtype,S.values)}var wW={kernelName:bc,backendName:"cpu",kernelFunc:RA};function Wge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;J([o,i],"depthwiseConv2dNativeBackpropFilter");let d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:h}=d,g=new Mt(d.filterShape,"float32"),x=d.padInfo.left,b=d.padInfo.top,I=d.outChannels/d.inChannels,_=e.data.get(o.dataId).values,E=new Mt(o.shape,o.dtype,_),S=e.data.get(i.dataId).values,D=new Mt(i.shape,i.dtype,S);for(let M=0;M<m;++M){let R=Math.max(0,Math.ceil((b-M)/p)),L=Math.min(d.outHeight,(d.inHeight+b-M)/p);for(let G=0;G<h;++G){let W=Math.max(0,Math.ceil((x-G)/f)),q=Math.min(d.outWidth,(d.inWidth+x-G)/f);for(let X=0;X<d.outChannels;++X){let K=Math.trunc(X/I),Z=X%I,ae=0;for(let ee=0;ee<d.batchSize;++ee)for(let ie=R;ie<L;++ie){let ue=M+ie*p-b;for(let fe=W;fe<q;++fe){let ge=G+fe*f-x;ae+=E.get(ee,ue,ge,K)*D.get(ee,ie,fe,X)}}g.set(ae,M,G,K,Z)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var CW={kernelName:Kf,backendName:"cpu",kernelFunc:Wge};function Hge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;J([o,i],"depthwiseConv2DNativeBackpropInput");let d=C.computeStrides(o.shape),p=C.computeStrides(i.shape),f=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),m=new Mt(f.inShape,"float32"),h=m.values,[g,x,b]=m.strides,I=e.data.get(o.dataId).values,[_,E,S]=d,D=e.data.get(i.dataId).values,[M,R,L]=p,{batchSize:G,filterHeight:W,filterWidth:q,inChannels:X,inHeight:K,inWidth:Z,outChannels:ae,outHeight:ee,outWidth:ie,strideHeight:ue,strideWidth:fe}=f,ge=W-1-f.padInfo.top,he=q-1-f.padInfo.left,ve=ae/X;for(let xe=0;xe<G;++xe)for(let we=0;we<X;++we)for(let Ne=0;Ne<K;++Ne){let Le=Ne-ge,Be=Math.max(0,Math.ceil(Le/ue)),Ze=Math.min(ee,(W+Le)/ue);for(let pt=0;pt<Z;++pt){let zt=pt-he,yn=Math.max(0,Math.ceil(zt/fe)),rn=Math.min(ie,(q+zt)/fe),Yt=0;for(let Zt=Be;Zt<Ze;++Zt){let on=Zt*ue-Le;for(let Tn=yn;Tn<rn;++Tn){let Ps=Tn*fe-zt,nr=_*xe+E*Zt+S*Tn,ns=M*(W-1-on)+R*(q-1-Ps)+L*we;for(let wo=0;wo<ve;++wo){let _u=we*ve+wo,Si=I[nr+_u],Ls=D[ns+wo];Yt+=Si*Ls}}}h[g*xe+x*Ne+b*pt+we]=Yt}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var _W={kernelName:Xf,backendName:"cpu",kernelFunc:Hge};function qge(t){let{inputs:n,backend:e}=t,{x:r}=n,o=C.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=Te([o,o],r.dtype),a=s.values;for(let c=0;c<i.length;c++)a[c*o+c]=i[c];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var IW={kernelName:jb,backendName:"cpu",kernelFunc:qge};var EW={kernelName:wc,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o}=t,{strides:i,pad:s,dilations:a}=e,l=n,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:f,inHeight:m,inWidth:h,inChannels:g,outHeight:x,outWidth:b,padInfo:I,strideHeight:_,strideWidth:E,filterHeight:S,filterWidth:D,dilationHeight:M,dilationWidth:R,outShape:L}=T.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),G=C.sizeFromShape(L),W=L.length,q=C.getArrayFromDType(r.dtype,G);for(let K=0;K<f;++K)for(let Z=0;Z<x;++Z){let ae=Z*_-I.top;for(let ee=0;ee<b;++ee){let ie=ee*E-I.left;for(let ue=0;ue<g;++ue){let fe=Number.MIN_SAFE_INTEGER;for(let he=0;he<S;++he){let ve=ae+he*M;if(ve>=0&&ve<m)for(let xe=0;xe<D;++xe){let we=ie+xe*R;if(we>=0&&we<h){let Ne=C.locToIndex([K,ve,we,ue],u,C.computeStrides(r.shape)),Le=C.locToIndex([he,xe,ue],p,C.computeStrides(o.shape)),Be=c[Ne]+d[Le];Be>fe&&(fe=Be)}}}let ge=C.locToIndex([K,Z,ee,ue],W,C.computeStrides(L));q[ge]=fe}}}return{dataId:l.write(C.toTypedArray(q,r.dtype),L,r.dtype),shape:L,dtype:r.dtype}}};var SW={kernelName:ly,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=C.toNestedArray(r.shape,c.data.get(r.dataId).values),d=C.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:b,strideHeight:I,strideWidth:_,filterHeight:E,filterWidth:S,dilationHeight:D,dilationWidth:M,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);C.assert(i.rank===R.length,()=>`Error in ${ly}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let L=C.toNestedArray(R,c.data.get(i.dataId).values),G=C.makeZerosNestedTypedArray(o.shape,o.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*I-b.top;for(let Z=0;Z<x;++Z){let ae=Z*_-b.left;for(let ee=0;ee<h;++ee){let ie=Number.MIN_SAFE_INTEGER,ue=0,fe=0;for(let ge=0;ge<E;++ge){let he=K+ge*D;if(he>=0&&he<f)for(let ve=0;ve<S;++ve){let xe=ae+ve*M;if(xe>=0&&xe<m){let we=u[q][he][xe][ee]+d[ge][ve][ee];we>ie&&(ie=we,ue=ge,fe=ve)}}}G[ue][fe][ee]+=L[q][X][Z][ee]}}}return{dataId:c.write(C.toTypedArray(G,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var TW={kernelName:ay,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=C.toNestedArray(r.shape,c.data.get(r.dataId).values),d=C.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:b,strideHeight:I,strideWidth:_,filterHeight:E,filterWidth:S,dilationHeight:D,dilationWidth:M,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);C.assert(i.rank===R.length,()=>`Error in ${ay}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let L=C.toNestedArray(R,c.data.get(i.dataId).values),G=C.makeZerosNestedTypedArray(r.shape,r.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*I-b.top;for(let Z=0;Z<x;++Z){let ae=Z*_-b.left;for(let ee=0;ee<h;++ee){let ie=Number.MIN_SAFE_INTEGER,ue=K<0?0:K,fe=ae<0?0:ae;for(let ge=0;ge<E;++ge){let he=K+ge*D;if(he>=0&&he<f)for(let ve=0;ve<S;++ve){let xe=ae+ve*M;if(xe>=0&&xe<m){let we=u[q][he][xe][ee]+d[ge][ve][ee];we>ie&&(ie=we,ue=he,fe=xe)}}}G[q][ue][fe][ee]+=L[q][X][Z][ee]}}}return{dataId:c.write(C.toTypedArray(G,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function Sl(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"sum");let a;o.dtype==="bool"?a=bi({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=fr({inputs:{x:o},backend:e});let l=a.shape.length,c=C.parseAxisParam(i,a.shape),u=T.getAxesPermutation(c,l),d=c,p=a;u!=null&&(p=Cn({inputs:{x:a},backend:e,attrs:{perm:u}}),d=T.getInnerMostAxes(d.length,l)),T.assertAxesAreInnerMostDims("sum",d,p.shape.length);let[f,m]=T.computeOutAndReduceShapes(p.shape,d),h=T.upcastType(p.dtype,"int32"),g=Zm(e,f,h),x=C.sizeFromShape(m),b=e.data.get(g.dataId).values,I=e.data.get(p.dataId).values;for(let _=0;_<b.length;++_){let E=_*x,S=0;for(let D=0;D<x;++D)S+=I[E+D];b[_]=S}if(s){let _=T.expandShapeToKeepDim(g.shape,c),E=g;g=ot({inputs:{x:g},backend:e,attrs:{shape:_}}),e.disposeIntermediateTensorInfo(E)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(p),g}var DW={kernelName:Wc,backendName:"cpu",kernelFunc:Sl};function Kge(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:x,expandDims:b}=T.getEinsumPermutation(f,l[g]),I;T.isIdentityPermutation(x)?I=i[g]:(I=Cn({inputs:{x:i[g]},backend:e,attrs:{perm:x}}),m.push(I));let _=I.shape.slice();for(let E=0;E<b.length;++E)_.splice(b[E],0,1);C.arraysEqual(I.shape,_)||(I=ot({inputs:{x:I},backend:e,attrs:{shape:_}}),m.push(I)),p===null?p=I:(p=cp({inputs:{a:I,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=Sl({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var NW={kernelName:Gb,backendName:"cpu",kernelFunc:Kge};function Xge(t){let{inputs:n,backend:e}=t,{dy:r,y:o}=n;J([r,o],"eluGrad");let i=new Float32Array(C.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let c=s[l];c>=1?i[l]=a[l]:i[l]=a[l]*(c+1)}return e.makeTensorInfo(o.shape,"float32",i)}var kW={kernelName:Yf,backendName:"cpu",kernelFunc:Xge};var Yge=rt((t,n)=>t===n?1:0),MA=yt(vd,Yge,null,"bool"),AW={kernelName:vd,backendName:"cpu",kernelFunc:MA};var Zge=T.ERF_P,Qge=T.ERF_A1,Jge=T.ERF_A2,eye=T.ERF_A3,tye=T.ERF_A4,nye=T.ERF_A5,rye=Oe(Na,t=>{let n=Math.sign(t),e=Math.abs(t),r=1/(1+Zge*e);return n*(1-((((nye*r+tye)*r+eye)*r+Jge)*r+Qge)*r*Math.exp(-e*e))}),RW={kernelName:Na,backendName:"cpu",kernelFunc:rye};function rh(t){let{inputs:n,backend:e,attrs:r}=t,{input:o}=n,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(C.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),ot({inputs:{x:o},backend:e,attrs:{shape:a}})}var MW={kernelName:Cc,backendName:"cpu",kernelFunc:rh};var oye=rt((t,n)=>t/n),Qy=yt(Ta,oye),Jy={kernelName:Ta,backendName:"cpu",kernelFunc:Qy};function GC(t,n,e){let r=t.shape,o=r[0],i=r[1],s=e.data.get(t.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[o,i],u=C.sizeFromShape(c),d=C.getTypedArrayFromDType("float32",u),p=C.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let x=_i({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),b=_i({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),I=On({inputs:{real:x,imag:b},backend:e}),{real:_,imag:E}=iye(I,n,e),S=T.mergeRealAndImagArrays(_,E);for(let D=0;D<i;D++){let M=T.getComplexWithIndex(S,D);d[g*i+D]=M.real,p[g*i+D]=M.imag}e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(I)}let f=e.makeTensorInfo(c,"float32",d),m=e.makeTensorInfo(c,"float32",p),h=On({inputs:{real:f,imag:m},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),h}function iye(t,n,e){let r=C.sizeFromShape(t.shape),o=e.data.get(t.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(sye(r)){let a=FA(i,s,r,n,e),l=[t.shape[0],t.shape[1]];if(n){let c=e.makeTensorInfo(l,"float32",a.real),u=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",C.createScalarValue(r,"float32")),p=fr({inputs:{x:d},backend:e}),f=Jy.kernelFunc({inputs:{a:c,b:d},backend:e}),m=Jy.kernelFunc({inputs:{a:u,b:p},backend:e}),h=e.data.get(f.dataId).values,g=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),{real:h,imag:g}}return a}else{let a=T.mergeRealAndImagArrays(i,s),l=aye(a,r,n);return T.splitRealAndImagArrays(l)}}function sye(t){return(t&t-1)===0}function FA(t,n,e,r,o){if(e===1)return{real:t,imag:n};let i=T.mergeRealAndImagArrays(t,n),s=e/2,a=T.complexWithEvenIndex(i),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),p=o.makeTensorInfo(u,"float32",c),f=On({inputs:{real:d,imag:p},backend:o}),m=T.complexWithOddIndex(i),h=m.real,g=m.imag,x=[h.length],b=o.makeTensorInfo(x,"float32",h),I=o.makeTensorInfo(x,"float32",g),_=On({inputs:{real:b,imag:I},backend:o}),E=FA(l,c,s,r,o),S=E.real,D=E.imag,M=[S.length],R=o.makeTensorInfo(M,"float32",S),L=o.makeTensorInfo(M,"float32",D),G=On({inputs:{real:R,imag:L},backend:o}),W=FA(h,g,s,r,o),q=W.real,X=W.imag,K=[q.length],Z=o.makeTensorInfo(K,"float32",q),ae=o.makeTensorInfo(K,"float32",X),ee=On({inputs:{real:Z,imag:ae},backend:o}),ie=T.exponents(e,r),ue=[ie.real.length],fe=o.makeTensorInfo(ue,"float32",ie.real),ge=o.makeTensorInfo(ue,"float32",ie.imag),he=On({inputs:{real:fe,imag:ge},backend:o}),ve=cp({inputs:{a:he,b:ee},backend:o}),xe=El({inputs:{a:G,b:ve},backend:o}),we=Zy({inputs:{a:G,b:ve},backend:o}),Ne=xi({inputs:{input:xe},backend:o}),Le=xi({inputs:{input:we},backend:o}),Be=Ms({inputs:{input:xe},backend:o}),Ze=Ms({inputs:{input:we},backend:o}),pt=hu({inputs:[Ne,Le],backend:o,attrs:{axis:0}}),zt=hu({inputs:[Be,Ze],backend:o,attrs:{axis:0}}),yn=o.data.get(pt.dataId).values,rn=o.data.get(zt.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(I),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(R),o.disposeIntermediateTensorInfo(L),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(ee),o.disposeIntermediateTensorInfo(fe),o.disposeIntermediateTensorInfo(ge),o.disposeIntermediateTensorInfo(he),o.disposeIntermediateTensorInfo(ve),o.disposeIntermediateTensorInfo(xe),o.disposeIntermediateTensorInfo(we),o.disposeIntermediateTensorInfo(Ne),o.disposeIntermediateTensorInfo(Be),o.disposeIntermediateTensorInfo(Le),o.disposeIntermediateTensorInfo(Ze),o.disposeIntermediateTensorInfo(pt),o.disposeIntermediateTensorInfo(zt),{real:yn,imag:rn}}function aye(t,n,e){let r=new Float32Array(n*2);for(let o=0;o<n;o++){let i=0,s=0;for(let a=0;a<n;a++){let l=T.exponent(o*a,n,e),c=T.getComplexWithIndex(t,a);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}e&&(i/=n,s/=n),T.assignToTypedArray(r,i,s,o)}return r}function lye(t){let{inputs:n,backend:e}=t,{input:r}=n,o=C.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=ot({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=GC(a,!1,e),c=ot({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var FW={kernelName:Zf,backendName:"cpu",kernelFunc:lye};function e0(t){let{backend:n,attrs:e}=t,{shape:r,value:o,dtype:i}=e,s=i||C.inferDtype(o),a=C.getArrayFromDType(s,C.sizeFromShape(r));return cye(a,o,s),n.makeTensorInfo(r,s,a)}var OW={kernelName:Qf,backendName:"cpu",kernelFunc:e0};function cye(t,n,e){t.fill(n)}var PW={kernelName:Wb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,o=e,i=C.getTypedArrayFromDType(r.dtype,C.sizeFromShape(r.shape)),[s,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let p=0;p<s;p++){let f=p*l*a*c;for(let m=0;m<a;m++){let h=m*(l*c);for(let g=0;g<l;g++){let x=g*c;for(let b=0;b<c;b++){let _=[s,m,g,b][2],E=Math.round(l-_),S=f+h+x+b,D=u[S];if(E>=0&&E<l){let M=E*c,R=f+h+M+b;D=u[R]}i[S]=D}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var uye=rt((t,n)=>Math.floor(t/n)),dye=yt(Ma,uye,null,"int32"),LW={kernelName:Ma,backendName:"cpu",kernelFunc:dye};function pye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=AA({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=El({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=th(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var $W={kernelName:Td,backendName:"cpu",kernelFunc:pye};function fye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=RA({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=El({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=th(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var VW={kernelName:Dd,backendName:"cpu",kernelFunc:fye};function mye(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=C.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,c,u,d]=T.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(l,r.dtype,[]);let p=Te([c,u],r.dtype),f=e.data.get(o.dataId).values,m=e.data.get(r.dataId).values;for(let h=0;h<c;h++){let g=[],x=0;for(let b=0;b<a;b++){let I=f[h*a+b];x+=I*d[b],g.push(I)}if(x<0||x>=i/u)throw new Error(`Invalid indices: ${g} does not index into ${r.shape}`);for(let b=0;b<u;b++)p.values[h*u+b]=m[x*u+b]}return e.makeTensorInfo(l,p.dtype,p.values)}var BW={kernelName:Hb,backendName:"cpu",kernelFunc:mye};function hye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r;J([o,i],"gatherV2");let l=a;a==null&&(l=0);let c=C.sizeFromShape(i.shape),u=C.parseAxisParam(s,o.shape)[0],d=T.segment_util.collectGatherOpShapeInfo(o,i,u,l),p=ot({inputs:{x:o},backend:e,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=ot({inputs:{x:i},backend:e,attrs:{shape:[d.batchSize,c/d.batchSize]}}),m=[d.batchSize,d.outerSize,c/d.batchSize,d.sliceSize],h=e.bufferSync(f),g=e.bufferSync(p),x=RC(g,h,m);return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.makeTensorInfo(d.outputShape,x.dtype,x.values)}var zW={kernelName:Ic,backendName:"cpu",kernelFunc:hye};var gye=rt((t,n)=>t>=n?1:0),yye=yt(Fa,gye,null,"bool"),UW={kernelName:Fa,backendName:"cpu",kernelFunc:yye};function vye(t){let{inputs:n,backend:e}=t,{input:r}=n,o=C.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=ot({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=GC(a,!0,e),c=ot({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var jW={kernelName:Jf,backendName:"cpu",kernelFunc:vye};var xye=Oe(Oa,t=>Number.isFinite(t)?1:0,"bool"),GW={kernelName:Oa,backendName:"cpu",kernelFunc:xye};var bye=Oe(Pa,t=>Math.abs(t)===1/0?1:0,"bool"),WW={kernelName:Pa,backendName:"cpu",kernelFunc:bye};var wye=Oe(La,t=>Number.isNaN(t)?1:0,"bool"),HW={kernelName:La,backendName:"cpu",kernelFunc:wye};var Cye=rt((t,n)=>t<=n?1:0),_ye=yt(wd,Cye,null,"bool"),qW={kernelName:wd,backendName:"cpu",kernelFunc:_ye};function Iye(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=MC(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var KW={kernelName:qb,backendName:"cpu",kernelFunc:Iye};var Eye=Oe(Va,t=>Math.log1p(t)),XW={kernelName:Va,backendName:"cpu",kernelFunc:Eye};var Sye=rt((t,n)=>t&&n),Tye=yt(Cd,Sye,null,"bool"),YW={kernelName:Cd,backendName:"cpu",kernelFunc:Tye};var Dye=Oe(_d,t=>t?0:1,"bool"),ZW={kernelName:_d,backendName:"cpu",kernelFunc:Dye};var Nye=rt((t,n)=>t||n),kye=yt(Id,Nye,null,"bool"),QW={kernelName:Id,backendName:"cpu",kernelFunc:kye};function Aye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r;J(o,"LRN");let c=o.shape[3],u=c-1,d=e.data.get(o.dataId).values,p=C.sizeFromShape(o.shape),f=new Float32Array(p);function m(h){let g=h%c,x=h-g+Math.max(0,g-i),b=h-g+Math.min(g+i,u),I=0;for(;x<=b;x++){let _=d[x];I+=_*_}return I}for(let h=0;h<p;h++){let g=m(h),x=d[h]*Math.pow(s+a*g,-l);f[h]=x}return e.makeTensorInfo(o.shape,o.dtype,f)}var JW={kernelName:Sc,backendName:"cpu",kernelFunc:Aye};function Rye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r;J(s,"LRNGrad");let d=C.sizeFromShape(s.shape),p=s.shape[3],f=e.data.get(s.dataId).values,m=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values,g=new Float32Array(d),x=d;for(let b=0;b<x;b++){let I=b%p,_=b-I+Math.max(0,I-a),E=b-I+Math.min(p,I+a+1),S=0;for(let D=_;D<E;D++)S+=Math.pow(m[D],2);S=c*S+l;for(let D=_;D<E;D++){let M=-2*c*u*m[D]*h[b]/S;b===D&&(M+=Math.pow(S,-u)),M*=f[b],g[D]+=M}}return e.makeTensorInfo(s.shape,o.dtype,g)}var eH={kernelName:tm,backendName:"cpu",kernelFunc:Rye};function OA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,c=l.length,u=C.parseAxisParam(i,l),d=u,p=T.getAxesPermutation(d,c),f=a.data.get(o.dataId).values;if(p!=null){let _=new Array(c);for(let E=0;E<_.length;E++)_[E]=l[p[E]];f=eh(f,l,o.dtype,p,_),d=T.getInnerMostAxes(d.length,c),l=_}J(o,"max"),T.assertAxesAreInnerMostDims("max",d,c);let[m,h]=T.computeOutAndReduceShapes(l,d),g=C.sizeFromShape(h),x=FC(f,g,m,o.dtype),b=a.write(x,m,o.dtype),I=m;return s&&(I=T.expandShapeToKeepDim(m,u)),{dataId:b,shape:I,dtype:o.dtype}}var tH={kernelName:Tc,backendName:"cpu",kernelFunc:OA};function Mye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;J(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;C.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))d=fr({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=C.computeStrides(o.shape),m=nh(p,o.shape,o.dtype,f,u,"max");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var nH={kernelName:Dc,backendName:"cpu",kernelFunc:Mye};function Fye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;J(o,"maxPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=jC(d,o.shape,o.dtype,C.computeStrides(o.shape),u,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var rH={kernelName:Nc,backendName:"cpu",kernelFunc:Fye};function Oye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;J([o,i],"maxPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=e.bufferSync(i),p=ZG(d,u),f=u.strideDepth,m=u.strideHeight,h=u.strideWidth,g=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,I=u.effectiveFilterDepth,_=u.effectiveFilterHeight,E=u.effectiveFilterWidth,S=I-1-u.padInfo.front,D=E-1-u.padInfo.left,M=_-1-u.padInfo.top,R=Te(i.shape,"float32"),L=e.bufferSync(o);for(let G=0;G<u.batchSize;++G)for(let W=0;W<u.inChannels;++W)for(let q=0;q<u.inDepth;++q)for(let X=0;X<u.inHeight;++X)for(let K=0;K<u.inWidth;++K){let Z=q-S,ae=X-M,ee=K-D,ie=0;for(let ue=0;ue<I;ue+=g){let fe=(Z+ue)/f;if(!(fe<0||fe>=u.outDepth||Math.floor(fe)!==fe))for(let ge=0;ge<_;ge+=x){let he=(ae+ge)/m;if(!(he<0||he>=u.outHeight||Math.floor(he)!==he))for(let ve=0;ve<E;ve+=b){let xe=(ee+ve)/h;if(xe<0||xe>=u.outWidth||Math.floor(xe)!==xe)continue;let we=I*_*E-1-p.get(G,fe,he,xe,W),Ne=ue*_*E+ge*E+ve,Le=we===Ne?1:0;if(Le===0)continue;let Be=L.get(G,fe,he,xe,W);ie+=Be*Le}}}R.set(ie,G,q,X,K,W)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}var oH={kernelName:rm,backendName:"cpu",kernelFunc:Oye};function Pye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;J([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=e.data.get(a.dataId).values,m=Te(p.outShape,a.dtype,UC(f,a.shape,a.dtype,p).values),h=p.strideHeight,g=p.strideWidth,x=p.dilationHeight,b=p.dilationWidth,I=p.effectiveFilterHeight,_=p.effectiveFilterWidth,E=_-1-p.padInfo.left,S=I-1-p.padInfo.top,D=Te(a.shape,"float32"),M=e.data.get(o.dataId).values,R=Te(o.shape,"float32",M);for(let L=0;L<p.batchSize;++L)for(let G=0;G<p.inChannels;++G)for(let W=0;W<p.inHeight;++W)for(let q=0;q<p.inWidth;++q){let X=W-S,K=q-E,Z=0;for(let ae=0;ae<I;ae+=x){let ee=(X+ae)/h;if(!(ee<0||ee>=p.outHeight||Math.floor(ee)!==ee))for(let ie=0;ie<_;ie+=b){let ue=(K+ie)/g;if(ue<0||ue>=p.outWidth||Math.floor(ue)!==ue)continue;let fe=I*_-1-m.get(L,ee,ue,G),ge=ae*_+ie,he=fe===ge?1:0;if(he===0)continue;let ve=R.get(L,ee,ue,G);Z+=ve*he}}D.set(Z,L,W,q,G)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}var iH={kernelName:nm,backendName:"cpu",kernelFunc:Pye};function sH(t,n,e,r,o){let i=C.computeStrides(n),s=nh(t,n,e,i,o,"max"),a=UC(t,n,e,o,!0,r);return[s.values,a.values]}var aH={kernelName:Kb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;J(r,"MaxPoolWithArgmax");let c=l.data.get(r.dataId).values,u=T.computePool2DInfo(r.shape,o,i,[1,1],s),[d,p]=sH(c,r.shape,r.dtype,a,u),f=l.write(d,u.outShape,r.dtype),m=l.write(p,u.outShape,r.dtype);return[{dataId:f,shape:u.outShape,dtype:r.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};function Lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=C.parseAxisParam(i,o.shape),c=T.computeOutAndReduceShapes(o.shape,a)[1],u=C.sizeFromShape(c),d=[],p=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(p);let f=bi({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});d.push(f);let m=Qy({inputs:{a:f,b:p},backend:e});d.push(m);let h=Sl({inputs:{x:m},backend:e,attrs:{axis:i,keepDims:s}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),h}var lH={kernelName:kc,backendName:"cpu",kernelFunc:Lye};function $ye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"min");let a=C.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=Cn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=C.sizeFromShape(p),m=C.makeZerosTypedArray(C.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,I=h[b];for(let _=0;_<f;++_){let E=h[b+_];E<I&&(I=E)}m[x]=I}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=ot({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var cH={kernelName:Ac,backendName:"cpu",kernelFunc:$ye};function Vye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,mode:s}=r;J(o,"mirrorPad");let a=i.map((I,_)=>I[0]+o.shape[_]+I[1]),l=i.map(I=>I[0]),c=i.map((I,_)=>I[0]+o.shape[_]),u=s==="reflect"?0:1,d=e.data.get(o.dataId).values,p=o.shape.length,f=C.computeStrides(o.shape),m=C.sizeFromShape(a),h=a.length,g=C.computeStrides(a),x=C.getTypedArrayFromDType(o.dtype,m);for(let I=0;I<m;I++){let _=C.indexToLoc(I,h,g);for(let S=0;S<h;S++)_[S]<l[S]?_[S]=l[S]*2-_[S]-u:_[S]>=c[S]&&(_[S]=(c[S]-1)*2-_[S]+u);_=_.map((S,D)=>S-l[D]);let E=C.locToIndex(_,p,f);x[I]=d[E]}return{dataId:e.write(x,a,o.dtype),shape:a,dtype:o.dtype}}var uH={kernelName:Rc,backendName:"cpu",kernelFunc:Vye};var Bye=rt((t,n)=>{let e=t%n;return t<0&&n<0||t>=0&&n>=0?e:(e+n)%n}),zye=yt(Ua,Bye),dH={kernelName:Ua,backendName:"cpu",kernelFunc:zye};var DH=vh(SH());function UA(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=C.parseAxisParam([a],o.shape),c=OA({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=T.expandShapeToKeepDim(c.shape,l),d=ot({inputs:{x:c},backend:e,attrs:{shape:u}}),p=Zy({inputs:{a:o,b:d},backend:e}),f=lA({inputs:{x:p},backend:e}),m=Sl({inputs:{x:f},backend:e,attrs:{axis:l,keepDims:!1}}),h=ot({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Qy({inputs:{a:f,b:h},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var TH={kernelName:Kc,backendName:"cpu",kernelFunc:UA};function Kye(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r;J(o,"multinomial");let l=a?o:UA({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,p=[c,i],f=C.makeZerosTypedArray(C.sizeFromShape(p),"int32");for(let m=0;m<c;++m){let h=m*u,g=new Float32Array(u-1);g[0]=d[h];for(let I=1;I<g.length;++I)g[I]=g[I-1]+d[h+I];let x=DH.alea(s.toString()),b=m*i;for(let I=0;I<i;++I){let _=x();f[b+I]=g.length;for(let E=0;E<g.length;E++)if(_<g[E]){f[b+I]=E;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(p,"int32",f)}var NH={kernelName:Xb,backendName:"cpu",kernelFunc:Kye};var Xye=dr.nonMaxSuppressionV3Impl;function Yye(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;J(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,{selectedIndices:d}=Xye(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var kH={kernelName:Yb,backendName:"cpu",kernelFunc:Yye};var Zye=dr.nonMaxSuppressionV4Impl;function Qye(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;J(o,"NonMaxSuppressionPadded");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=Zye(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var AH={kernelName:Zb,backendName:"cpu",kernelFunc:Qye};var Jye=dr.nonMaxSuppressionV5Impl;function e0e(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;J(o,"NonMaxSuppressionWithScore");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:x}=Jye(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var RH={kernelName:Qb,backendName:"cpu",kernelFunc:e0e};function t0e(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r;J(o,"oneHot");let l=C.sizeFromShape(o.shape),c=new Float32Array(l*i);c.fill(a);let u=e.data.get(o.dataId).values;for(let d=0;d<l;++d)u[d]>=0&&u[d]<i&&(c[d*i+u[d]]=s);return e.makeTensorInfo([...o.shape,i],"int32",c)}var MH={kernelName:Oc,backendName:"cpu",kernelFunc:t0e};function t0(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=xi({inputs:{input:r},backend:e}),i=t0({inputs:{x:o},backend:e}),s=Ms({inputs:{input:r},backend:e}),a=t0({inputs:{x:s},backend:e}),l=On({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return e0({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var FH={kernelName:Qc,backendName:"cpu",kernelFunc:t0};function OH(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=xi({inputs:{input:r},backend:e}),i=OH({inputs:{x:o},backend:e}),s=Ms({inputs:{input:r},backend:e}),a=t0({inputs:{x:s},backend:e}),l=On({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return e0({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var PH={kernelName:Fc,backendName:"cpu",kernelFunc:OH};function jA(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return rh({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{C.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),C.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=rh({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=hu({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var LH={kernelName:Pc,backendName:"cpu",kernelFunc:jA};function n0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;J(o,"pad");let a=i.map((b,I)=>b[0]+o.shape[I]+b[1]),l=i.map(b=>b[0]),c=e.data.get(o.dataId).values,u=C.sizeFromShape(o.shape),d=o.shape.length,p=C.computeStrides(o.shape),f=C.sizeFromShape(a),m=a.length,h=C.computeStrides(a),g=C.getTypedArrayFromDType(o.dtype,f);s!==0&&g.fill(s);for(let b=0;b<u;b++){let _=C.indexToLoc(b,d,p).map((S,D)=>S+l[D]),E=C.locToIndex(_,m,h);g[E]=c[b]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var HC={kernelName:Lc,backendName:"cpu",kernelFunc:n0e};var r0e=rt((t,n)=>Math.pow(t,n)),o0e=yt(Ga,r0e),$H={kernelName:Ga,backendName:"cpu",kernelFunc:o0e};function i0e(t){let{backend:n,attrs:e}=t,{start:r,stop:o,dtype:i,step:s}=e,a=OC(r,o,s,i);return n.makeTensorInfo([a.length],i,a)}var VH={kernelName:im,backendName:"cpu",kernelFunc:i0e};var s0e=Oe(Wa,t=>1/t),BH={kernelName:Wa,backendName:"cpu",kernelFunc:s0e};function a0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;J(o,"resizeBilinear");let l=C.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(C.sizeFromShape([d,c,u,m])),x=[i&&c>1?p-1:p,i&&u>1?f-1:f],b=[i&&c>1?c-1:c,i&&u>1?u-1:u],I=0,_=x[0]/b[0],E=x[1]/b[1];for(let S=0;S<d;S++)for(let D=0;D<c;D++){let M;s?M=_*(D+.5)-.5:M=_*D;let R=Math.max(0,Math.floor(M)),L=M-R,G=Math.min(p-1,Math.ceil(M)),W=S*l[0]+R*l[1],q=S*l[0]+G*l[1];for(let X=0;X<u;X++){let K;s?K=E*(X+.5)-.5:K=E*X;let Z=Math.max(0,Math.floor(K)),ae=K-Z,ee=Math.min(f-1,Math.ceil(K)),ie=W+Z*l[2],ue=q+Z*l[2],fe=W+ee*l[2],ge=q+ee*l[2];for(let he=0;he<m;he++){let ve=h[ie+he],xe=h[ue+he],we=h[fe+he],Ne=h[ge+he],Le=ve+(we-ve)*ae,Be=xe+(Ne-xe)*ae,Ze=Le+(Be-Le)*L;g[I++]=Ze}}}return e.makeTensorInfo([d,c,u,m],"float32",g)}var zH={kernelName:zc,backendName:"cpu",kernelFunc:a0e};function l0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;J([i,o],"resizeBilinearGrad");let a=C.computeStrides(o.shape),[l,c,u,d]=o.shape,[,p,f]=i.shape,m=new Float32Array(l*c*u*d),h=[s&&p>1?c-1:c,s&&f>1?u-1:u],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],x=h[0]/g[0],b=h[1]/g[1],I=e.data.get(i.dataId).values,_=0;for(let E=0;E<l;E++){let S=E*a[0];for(let D=0;D<p;D++){let M=D*x,R=Math.floor(M),L=Math.min(Math.ceil(M),c-1),G=S+R*a[1],W=S+L*a[1],q=M-R,X=1-q;for(let K=0;K<f;K++){let Z=K*b,ae=Math.floor(Z),ee=Math.min(Math.ceil(Z),u-1),ie=Z-ae,ue=1-ie,fe=G+ae*a[2],ge=G+ee*a[2],he=W+ae*a[2],ve=W+ee*a[2],xe=X*ue,we=X*ie,Ne=q*ue,Le=q*ie;for(let Be=0;Be<d;Be++){let Ze=I[_++];m[fe+Be]+=Ze*xe,m[ge+Be]+=Ze*we,m[he+Be]+=Ze*Ne,m[ve+Be]+=Ze*Le}}}}return e.makeTensorInfo([l,u,c,d],"float32",m)}var UH={kernelName:lm,backendName:"cpu",kernelFunc:l0e};function c0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;J(o,"resizeNearestNeighbor");let l=C.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(d*c*u*m),x=[i&&c>1?p-1:p,i&&u>1?f-1:f],b=[i&&c>1?c-1:c,i&&u>1?u-1:u],I=x[0]/b[0],_=x[1]/b[1],E=0;for(let S=0;S<d;S++){let D=S*l[0];for(let M=0;M<c;M++){let R=s?I*(M+.5):I*M,L=Math.min(p-1,i?Math.round(R):Math.floor(R));s&&(L=Math.max(0,L));let G=D+L*l[1];for(let W=0;W<u;W++){let q=s?_*(W+.5):_*W,X=Math.min(f-1,i?Math.round(q):Math.floor(q));s&&(X=Math.max(0,X));let K=G+X*l[2];for(let Z=0;Z<m;Z++){let ae=h[K+Z];g[E++]=ae}}}}return e.makeTensorInfo([d,c,u,m],o.dtype,g)}var jH={kernelName:Bc,backendName:"cpu",kernelFunc:c0e};function u0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;J([i,o],"resizeNearestNeighborGrad");let a=C.computeStrides(o.shape),l=C.computeStrides(i.shape),[c,u,d,p]=o.shape,[,f,m]=i.shape,h=new Float32Array(c*u*d*p),g=e.data.get(i.dataId).values,x=[s&&f>1?u-1:u,s&&m>1?d-1:d],b=[s&&f>1?f-1:f,s&&m>1?m-1:m],I=x[0]/b[0],_=x[1]/b[1],E=1/I,S=1/_,D=Math.ceil(E)*2+2,M=Math.ceil(S)*2+2;for(let R=0;R<c;R++){let L=R*a[0];for(let G=0;G<u;G++){let W=L+G*a[1],q=Math.floor(G*E),X=Math.floor(q-D/2);for(let K=0;K<d;K++){let Z=W+K*a[2],ae=Math.floor(K*S),ee=Math.floor(ae-M/2);for(let ie=0;ie<p;ie++){let ue=0;for(let fe=0;fe<D;fe++){let ge=fe+X;if(ge<0||ge>=f)continue;let he=L+ge*l[1],ve=ge*I,xe=Math.min(u-1,s?Math.round(ve):Math.floor(ve));if(G===xe)for(let we=0;we<M;we++){let Ne=we+ee;if(Ne<0||Ne>=m)continue;let Le=he+Ne*l[2],Be=Ne*_,Ze=Math.min(d-1,s?Math.round(Be):Math.floor(Be));K===Ze&&(ue+=g[Le+ie])}}h[Z+ie]=ue}}}}return e.makeTensorInfo(o.shape,o.dtype,h)}var GH={kernelName:am,backendName:"cpu",kernelFunc:u0e};function d0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r;J(o,"reverse");let s=o.shape.length,a=C.parseAxisParam(i,o.shape);if(s===0)return fr({inputs:{x:o},backend:e});let l=new Mt(o.shape,o.dtype),c=e.bufferSync(o);for(let u=0;u<l.size;u++){let d=l.indexToLoc(u),p=d.slice();a.forEach(f=>p[f]=o.shape[f]-1-p[f]),l.set(c.get(...p),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var WH={kernelName:Uc,backendName:"cpu",kernelFunc:d0e};var HH={kernelName:ow,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=C.getTypedArrayFromDType(r.dtype,C.sizeFromShape(r.shape)),[c,u,d,p]=r.shape,[f,m]=T.getImageCenter(s,u,d),h=255,g=Math.sin(o),x=Math.cos(o),b=a.data.get(r.dataId).values;for(let _=0;_<c;_++){let E=_*d*u*p;for(let S=0;S<u;S++){let D=S*(d*p);for(let M=0;M<d;M++){let R=M*p;for(let L=0;L<p;L++){let G=[c,S,M,L],W=G[2],q=G[1],X=(W-f)*x-(q-m)*g,K=(W-f)*g+(q-m)*x;X=Math.round(X+f),K=Math.round(K+m);let Z=i;if(typeof i!="number"&&(L===3?Z=h:Z=i[L]),X>=0&&X<d&&K>=0&&K<u){let ee=K*(d*p),ie=X*p,ue=E+ee+ie+L;Z=b[ue]}let ae=E+D+R+L;l[ae]=Z}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var p0e=Oe(Ka,t=>{let n=Math.floor(t);return t-n<.5?Math.floor(t):t-n>.5?Math.ceil(t):n%2===0?n:n+1}),qH={kernelName:Ka,backendName:"cpu",kernelFunc:p0e};function qC(t,n,e,r,o,i,s,a,l,c){let u=[r/o,o],d=t.values,p=n.values;if(r===0)return Te(e,n.dtype);let f=Te(u,n.dtype);f.values.fill(l);for(let m=0;m<i;m++){let h=[],g=0;for(let x=0;x<s;x++){let b=d[m*s+x];h.push(b),g+=b*a[x]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${h} does not index into ${e}`);for(let x=0;x<o;x++)c?f.values[g*o+x]+=p[m*o+x]:f.values[g*o+x]=n.rank===0?p[0]:p[m*o+x]}return f}function f0e(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=!0,f=e.bufferSync(o),m=e.bufferSync(i),h=qC(f,m,s,d,c,l,a,u,0,p);return e.makeTensorInfo(s,h.dtype,h.values)}var KH={kernelName:Jb,backendName:"cpu",kernelFunc:f0e};function m0e(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n;J([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Fn(o.dtype,i.dtype),d=C.makeZerosTypedArray(C.sizeFromShape(o.shape),u),p=0,f=s===0||s>1||o.shape.length===1?1:C.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<f;h++)a[m]===1?d[p++]=l[m]:d[p++]=c[m];return e.makeTensorInfo(o.shape,u,d)}var XH={kernelName:jc,backendName:"cpu",kernelFunc:m0e};var h0e=T.SELU_SCALEALPHA,g0e=T.SELU_SCALE,y0e=Oe(Ya,t=>t>=0?g0e*t:h0e*(Math.exp(t)-1)),YH={kernelName:Ya,backendName:"cpu",kernelFunc:y0e};var v0e=Oe(Ja,t=>t<0?-1:t>0?1:0),ZH={kernelName:Ja,backendName:"cpu",kernelFunc:v0e};var x0e=Oe(Za,t=>Math.sin(t)),QH={kernelName:Za,backendName:"cpu",kernelFunc:x0e};var b0e=Oe(Qa,t=>Math.sinh(t)),JH={kernelName:Qa,backendName:"cpu",kernelFunc:b0e};var w0e=11920928955078125e-23,e5=Math.log(w0e)+2,C0e=Oe(tl,t=>{let n=t>-e5,e=t<e5,r=Math.exp(t),o;return e?o=r:n?o=t:o=Math.log(1+r),o}),t5={kernelName:tl,backendName:"cpu",kernelFunc:C0e};function _0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;J([o],"spaceToBatchND");let a=C.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let S=1+i.length;S<o.shape.length;++S)l.push([0,0]);let c=HC.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),u=T.getReshaped(c.shape,i,a,!1),d=T.getPermuted(u.length,i.length,!1),p=T.getReshapedPermuted(c.shape,i,a,!1),h=ot({inputs:{x:c},backend:e,attrs:{shape:u}}),b=Cn({inputs:{x:h},backend:e,attrs:{perm:d}}),E=ot({inputs:{x:b},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(b),E}var n5={kernelName:Hc,backendName:"cpu",kernelFunc:_0e};function I0e(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=e.data.get(s.dataId).values[0],[d,p,f,m,h]=PC(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var r5={kernelName:ew,backendName:"cpu",kernelFunc:I0e};function E0e(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[c,u,d]=LC(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var o5={kernelName:tw,backendName:"cpu",kernelFunc:E0e};function S0e(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1,m=e.bufferSync(o),h=e.bufferSync(i),g=e.data.get(s.dataId).values[0],x=qC(m,h,a,p,u,c,l,d,g,f);return e.makeTensorInfo(a,x.dtype,x.values)}var i5={kernelName:nw,backendName:"cpu",kernelFunc:S0e};function T0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=C.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{let p=[...u];p[a]=d;let f=_i({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[a]+=d,f})}var s5={kernelName:qc,backendName:"cpu",kernelFunc:T0e};var D0e=Oe(nl,t=>Math.sqrt(t)),a5={kernelName:nl,backendName:"cpu",kernelFunc:D0e};var l5={kernelName:cm,backendName:"cpu",kernelFunc:({inputs:t,backend:n})=>{let{x:e}=t,r=n;J(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var N0e=Oe(al,(t,n)=>{let e=n;return isNaN(t)?NaN:t>0?1:e.alpha}),c5={kernelName:al,backendName:"cpu",kernelFunc:N0e};function k0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r;J(o,"stridedSlice");let{nonStrided:f,$begin:m,$strides:h,size:g,newShape:x,outShape:b}=ar.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I=ot({inputs:{x:o},backend:e,attrs:{shape:x}}),_;if(f){let S=_i({inputs:{x:I},backend:e,attrs:{begin:m,size:g}});_=ot({inputs:{x:S},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(S)}else if(b.some(S=>S===0))_=e.makeTensorInfo(b,o.dtype,[]);else{let S=e.bufferSync(I),D=$C(b,S,h,m);_=e.makeTensorInfo(D.shape,D.dtype,D.values)}let E=ot({inputs:{x:_},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(I),e.disposeIntermediateTensorInfo(_),E}var u5={kernelName:um,backendName:"cpu",kernelFunc:k0e};var A0e=Oe(il,t=>Math.tan(t)),d5={kernelName:il,backendName:"cpu",kernelFunc:A0e};var R0e=Oe(sl,t=>Math.tanh(t)),p5={kernelName:sl,backendName:"cpu",kernelFunc:R0e};function M0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;J(o,"tile");let s=VC(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var f5={kernelName:_s,backendName:"cpu",kernelFunc:M0e};function F0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r;J(o,"topk");let a=e.data.get(o.dataId).values,[l,c]=BC(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var m5={kernelName:dm,backendName:"cpu",kernelFunc:F0e};function O0e(t){let{inputs:n,attrs:e,backend:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=e,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],x=C.computeStrides(o.shape),b=x[0],I=x[1],_=x[2],E=C.getTypedArrayFromDType(o.dtype,C.sizeFromShape(g));E.fill(l);let S=r.data.get(o.dataId).values,D=r.data.get(i.dataId).values;for(let R=0;R<u;++R){let L=i.shape[0]===1?D:D.subarray(R*8,R*8+8);for(let G=0;G<m;++G)for(let W=0;W<h;++W)for(let q=0;q<f;++q){let X,K=L[6]*W+L[7]*G+1;if(K===0)continue;let Z=(L[0]*W+L[1]*G+L[2])/K,ae=(L[3]*W+L[4]*G+L[5])/K,ee=h5(Z,p,a),ie=h5(ae,d,a);switch(s){case"nearest":X=B0e(S,d,p,b,I,_,R,ie,ee,q,l);break;case"bilinear":X=z0e(S,d,p,b,I,_,R,ie,ee,q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let ue=R*b+G*I+W*_+q;E[ue]=X}return r.makeTensorInfo(g,o.dtype,E)}return{dataId:r.write(E,g,o.dtype),shape:o.shape,dtype:o.dtype}}var g5={kernelName:rw,backendName:"cpu",kernelFunc:O0e};function h5(t,n,e){switch(e){case"reflect":return P0e(t,n);case"wrap":return L0e(t,n);case"nearest":return V0e(t,n);case"constant":default:return $0e(t,n)}}function P0e(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=2*n;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-n?e+r:-e-1}else if(e>n-1)if(n<=1)e=0;else{let r=2*n;e-=r*Math.trunc(e/r),e>=n&&(e=r-e-1)}return C.clamp(0,e,n-1)}function L0e(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=n-1;e+=n*(Math.trunc(-e/r)+1)}else if(e>n-1)if(n<=1)e=0;else{let r=n-1;e-=n*Math.trunc(e/r)}return C.clamp(0,e,n-1)}function $0e(t,n){return t}function V0e(t,n){return C.clamp(0,t,n-1)}function n0(t,n,e,r,o,i,s,a,l,c,u){let d=s*r+a*o+l*i+c;return 0<=a&&a<n&&0<=l&&l<e?t[d]:u}function B0e(t,n,e,r,o,i,s,a,l,c,u){let d=Math.round(a),p=Math.round(l);return n0(t,n,e,r,o,i,s,d,p,c,u)}function z0e(t,n,e,r,o,i,s,a,l,c,u){let d=Math.floor(a),p=Math.floor(l),f=d+1,m=p+1,h=(m-l)*n0(t,n,e,r,o,i,s,d,p,c,u)+(l-p)*n0(t,n,e,r,o,i,s,d,m,c,u),g=(m-l)*n0(t,n,e,r,o,i,s,f,p,c,u)+(l-p)*n0(t,n,e,r,o,i,s,f,m,c,u);return(f-a)*h+(a-d)*g}function U0e(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;J(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=zC(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var y5={kernelName:pm,backendName:"cpu",kernelFunc:U0e};function j0e(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),c=0;for(let f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);let u=new Array(s).fill(0),d=o.shape.slice();d[i]=1;let p=new Array(a);for(let f=0;f<p.length;f++){u[i]=f;let m=_i({inputs:{x:o},backend:e,attrs:{begin:u,size:d}});p[f]=ot({inputs:{x:m},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(m)}return p}var v5={kernelName:Yc,backendName:"cpu",kernelFunc:j0e};function G0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r;J(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,c=[],u=[],d=a-l,p=i;for(let m=0;m<d;++m){let h=rh({inputs:{input:p},backend:e,attrs:{dim:m+1}});p=h,u.push(h)}for(let m=0;m<s;++m){let h=C.createScalarValue(m,"int32"),g=e.makeTensorInfo([],"int32",h),x=MA({inputs:{a:g,b:p},backend:e}),b=bi({inputs:{x},backend:e,attrs:{dtype:"float32"}}),I=cp({inputs:{a:b,b:o},backend:e}),_=Sl({inputs:{x:I},backend:e,attrs:{axis:0,keepDims:!1}});c.push(_),u.push(g),u.push(x),u.push(b),u.push(I),u.push(_)}let f=jA({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var x5={kernelName:Zc,backendName:"cpu",kernelFunc:G0e};var W0e=[$G,sG,VG,BG,dG,zG,UG,jG,GG,WG,HG,qG,KG,XG,YG,QG,JG,eW,tW,LG,nW,rW,oW,uG,pG,iW,aG,sW,lW,uW,dW,cW,fW,mW,pW,hW,gW,yW,vW,xW,bW,wW,CW,_W,IW,EW,TW,SW,Jy,NW,kG,kW,AW,RW,fG,MW,mG,FW,OW,PW,hG,LW,$W,VW,BW,zW,gG,UW,lG,jW,aW,GW,WW,HW,AG,yG,qW,KW,vG,XW,YW,ZW,QW,JW,eH,xG,nH,rH,oH,iH,aH,tH,lH,cH,bG,uH,dH,NH,wG,CG,kH,AH,RH,_G,MH,PH,LH,HC,$H,RG,EG,VH,cG,BH,MG,FG,PG,zH,UH,jH,GH,WH,HH,qH,SG,KH,XH,YH,OG,ZH,QH,JH,TG,TH,t5,n5,r5,o5,i5,s5,a5,l5,DG,c5,u5,NG,DW,d5,p5,f5,m5,IG,g5,y5,v5,x5,FH];for(let t of W0e)sw(t);var dp={},GA={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function b5(t,n){dp[t]=n}function jo(t){if(!(t in dp)){let e=q0e(t);if(e!==null)dp[t]=e;else return console.log("Could not get context for WebGL version",t),null}let n=dp[t];return n.isContextLost()?(delete dp[t],jo(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),dp[t])}function H0e(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function q0e(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=H0e(t);return n.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete dp[t]},!1),t===1?n.getContext("webgl",GA)||n.getContext("experimental-webgl",GA):n.getContext("webgl2",GA)}var pp=function(t){return t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH",t}(pp||{}),Tr=function(t){return t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD",t}(Tr||{}),mr=function(t){return t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",t}(mr||{});function fp(t,n){return[n,t]}function w5(t,n){return t*n}function gu(t){let n=C.sizeFromShape(t),e=Math.ceil(n/4);return C.sizeToSquarishShape(e)}function Fs(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function C5(t,n){let[e,r]=Fs(t,n);return e*r*4}function r0(t,n){let e=t,r,o,i,s,a,l,c,u,d,p;return H().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,c=4,u=1,d=e.HALF_FLOAT,p=e.FLOAT):(r=t.RGBA,o=t.RGBA,i=t.RGBA,s=e.RGBA,a=t.RGBA,c=4,u=4,d=n!=null?n.HALF_FLOAT_OES:null,p=t.FLOAT),l=t.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:p}}function Re(t,n){let e=n();return H().getBool("DEBUG")&&K0e(t),e}function K0e(t){let n=t.getError();if(n!==t.NO_ERROR)throw new Error("WebGL Error: "+Z0e(t,n))}var X0e=596e-10,Y0e=65504;function _5(t){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||X0e<Math.abs(t)&&Math.abs(t)<Y0e)}function Z0e(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${n}`}}function o0(t,n){return Tl(t,()=>t.getExtension(n),'Extension "'+n+'" not supported on this browser.')}function I5(t,n){let e=Tl(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Re(t,()=>t.shaderSource(e,n)),Re(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function E5(t,n){let e=Tl(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Re(t,()=>t.shaderSource(e,n)),Re(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw J0e(n,t.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var Q0e=/ERROR: [0-9]+:([0-9]+):/g;function J0e(t,n){let e=Q0e.exec(n);if(e==null){console.log(`Couldn't parse line number in error: ${n}`),console.log(t);return}let r=+e[1],o=t.split(`
`),i=o.length.toString().length+2,s=o.map((d,p)=>C.rightPad((p+1).toString(),i)+d),a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);let l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join(`
`)),console.log(n.split(`
`)[0]),console.log(`%c ${C.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function S5(t){return Tl(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function T5(t,n){if(Re(t,()=>t.linkProgram(n)),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function XC(t,n){if(Re(t,()=>t.validateProgram(n)),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function D5(t,n){let e=Tl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),Re(t,()=>t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function N5(t,n){let e=Tl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Re(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)),Re(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function k5(t){return Tl(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function A5(t,n){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){let r=`[${t}x${n}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e){let r=`[${t}x${n}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function R5(t){return Tl(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function XA(t,n,e,r,o,i,s){let a=t.getAttribLocation(n,e);return a===-1?!1:(Re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),Re(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,i,s)),Re(t,()=>t.enableVertexAttribArray(a)),!0)}function eve(t,n,e){nve(t,e),Re(t,()=>t.activeTexture(t.TEXTURE0+e)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,n))}function M5(t,n,e){return Tl(t,()=>t.getUniformLocation(n,e),'uniform "'+e+'" not present in program.')}function F5(t,n,e){return t.getUniformLocation(n,e)}function O5(t,n,e,r){Re(t,()=>eve(t,n,r)),Re(t,()=>t.uniform1i(e,r))}function YC(t,n,e){Re(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Re(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0))}function YA(t,n){Re(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Re(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function i0(t){let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+tve(t,n))}function tve(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${n}`}}function Tl(t,n,e){let r=Re(t,()=>n());if(r==null)throw new Error(e);return r}function nve(t,n){let e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function yu(t,n=2){return C.sizeFromShape(t.slice(0,t.length-n))}function vu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function ZC(t){let n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[yu(t),...vu(t)]),n}function P5(t,n=!1){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");n&&(e=e*2,t=t.map((o,i)=>i>=t.length-2?C.nearestLargerEven(t[i]):t[i]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=C.squeezeShape(t).newShape);let r=C.sizeFromShape(t);if(t.length<=1&&r<=e)return[1,r];if(t.length===2&&t[0]<=e&&t[1]<=e)return t;if(t.length===3&&t[0]*t[1]<=e&&t[2]<=e)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=e&&t[1]*t[2]<=e)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=e&&t[3]<=e)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=e&&t[1]*t[2]*t[3]<=e)return[t[0],t[1]*t[2]*t[3]];if(n){let o=yu(t),i=2,s=2;return t.length&&([i,s]=vu(t)),r=o*(i/2)*(s/2),C.sizeToSquarishShape(r).map(a=>a*2)}return C.sizeToSquarishShape(r)}function KC(t){return t%2===0}function mp(t,n){if(t=t.slice(-2),n=n.slice(-2),C.arraysEqual(t,n)||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){let e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||KC(e)&&KC(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&KC(t[0])&&KC(n[0])}var HA,qA;function L5(t){if(HA==null){let n=jo(t);HA=n.getParameter(n.MAX_TEXTURE_SIZE)}return HA}function $5(t){if(qA==null){let n=jo(t);qA=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,qA)}function V5(t){if(t===0)return 0;let n,e=jo(t);return Go(e,"EXT_disjoint_timer_query_webgl2")&&t===2?n=2:Go(e,"EXT_disjoint_timer_query")?n=1:n=0,n}function Go(t,n){return t.getExtension(n)!=null}function ZA(t){try{if(jo(t)!=null)return!0}catch(n){return console.log("Error when getting WebGL context: ",n),!1}return!1}function B5(t){if(t===0)return!1;let n=jo(t);if(t===1){if(!Go(n,"OES_texture_float"))return!1}else if(!Go(n,"EXT_color_buffer_float"))return!1;return KA(n)}function z5(t){if(t===0)return!1;let n=jo(t);if(t===1){if(!Go(n,"OES_texture_float")||!Go(n,"WEBGL_color_buffer_float"))return!1}else{if(Go(n,"EXT_color_buffer_float"))return KA(n);let r="EXT_color_buffer_half_float";if(Go(n,r)){let o=n.getExtension(r);return rve(n,o)}return!1}return KA(n)}function KA(t){let n=r0(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(i),s}function rve(t,n){let e=r0(t,n),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function U5(t){return t!==2?!1:jo(t).fenceSync!=null}function Os(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&C.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the WebGL backend.`)})}var ze=H();ze.registerFlag("HAS_WEBGL",()=>ze.getNumber("WEBGL_VERSION")>0);ze.registerFlag("WEBGL_VERSION",()=>ZA(2)?2:ZA(1)?1:0);ze.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ze.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ze.get("WEBGL_VERSION")===2);ze.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ze.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ze.registerFlag("WEBGL_PACK",()=>ze.getBool("HAS_WEBGL"));ze.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CLIP",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_REDUCE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_LAZILY_UNPACK",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_CONV_IM2COL",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>L5(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>$5(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=ze.getNumber("WEBGL_VERSION");return t===0?0:V5(t)});ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ze.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Jc.isMobile());ze.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>B5(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ze.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ze.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ze.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>z5(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_FENCE_API_ENABLED",()=>U5(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ze.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ze.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});ze.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Jc.isMobile()&&ze.getBool("IS_CHROME")?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});function nn(){let t,n,e,r,o,i,s,a,l,c;return H().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function es(t,n,e="index"){let r=C.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * ${o}`:`index -= ${t[i]} * ${o}`;return`${s}; ${a};`}).join("")}function oh(t){let n=C.computeStrides(t).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${n[0]} + coords.y * ${n[1]} + coords.z;
  }
`}var JC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var e_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=pp.DENSE;let e=gu(n),r=nn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${es(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var t_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=pp.DENSE;let e=gu(n),r=nn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${es(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var n_=class{constructor(n){this.variableNames=["A"],this.outTexUsage=Tr.DOWNLOAD;let e=nn();this.outputShape=n,this.userCode=`
      ${JC}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var r_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Tr.DOWNLOAD;let e=nn();this.outputShape=n,this.userCode=`
      ${JC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var o_=class{constructor(n,e,r=!1){this.variableNames=["A"];let o=nn(),[i,s]=e;this.outputShape=n;let a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${oh(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${s};
        int c = imod(flatIndex, ${s});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
        vec4 values = ${o.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}};var i_=class{constructor(n,e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let o=nn(),[i,s]=e;this.outputShape=n;let a="",l="result";r&&(l="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let d=c*2+u;a+=`
          localCoords = coords;
          if(localCoords[2] + ${u} < ${n[2]}) {
            localCoords[2] += ${u};
            if(localCoords[1] + ${c} < ${n[1]}) {
              localCoords[1] += ${c};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${s};
              c = imod(flatIndex, ${s});
              uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
              values = ${o.texture2D}(A, uv);

              if(offset == 0) {
                result[${d}] = values[0];
              } else if(offset == 1) {
                result[${d}] = values[1];
              } else if(offset == 2) {
                result[${d}] = values[2];
              } else {
                result[${d}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${oh(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${a}

        ${o.output} = ${l};
      }
    `}};function j5(t){let n=nn(),e=`${n.version}
    precision highp float;
    ${n.attribute} vec3 clipSpacePos;
    ${n.attribute} vec2 uv;
    ${n.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return I5(t,e)}function G5(t){let n=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return D5(t,n)}function W5(t){let n=new Uint16Array([0,1,2,2,1,3]);return N5(t,n)}function s0(t,n,e,r,o,i){A5(n,e);let s=k5(t),a=t.TEXTURE_2D;return Re(t,()=>t.bindTexture(a,s)),Re(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Re(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Re(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Re(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Re(t,()=>t.texImage2D(a,0,r,n,e,0,o,i,null)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,null)),s}function QA(t){return t.internalFormatFloat}function H5(t,n,e,r){let[o,i]=fp(n,e);return s0(t,o,i,QA(r),r.textureFormatFloat,t.FLOAT)}function JA(t){return t.internalFormatHalfFloat}function q5(t,n,e,r){let[o,i]=fp(n,e);return s0(t,o,i,JA(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function eR(t){return t.downloadTextureFormat}function K5(t,n,e,r){let[o,i]=fp(n,e);return s0(t,o,i,eR(r),t.RGBA,t.UNSIGNED_BYTE)}function tR(t){return t.internalFormatPackedFloat}function X5(t,n,e,r){let[o,i]=Fs(n,e);return s0(t,o,i,tR(r),t.RGBA,t.FLOAT)}function nR(t){return t.internalFormatPackedHalfFloat}function Y5(t,n,e,r){let[o,i]=Fs(n,e);return s0(t,o,i,nR(r),t.RGBA,r.textureTypeHalfFloat)}function Z5(t,n,e){return Re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),XA(t,n,"clipSpacePos",e,3,20,0)&&XA(t,n,"uv",e,2,20,12)}function Q5(t,n,e,r,o,i){Re(t,()=>t.bindTexture(t.TEXTURE_2D,n));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(e*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),s.set(o),Re(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,e,r,0,t.RGBA,a,s)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function J5(t,n,e){Re(t,()=>t.bindTexture(t.TEXTURE_2D,n)),e.data instanceof Uint8Array?Re(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e.data)):Re(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function eq(t,n,e,r){let o=t.createBuffer();Re(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*n*e;return Re(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Re(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,0)),Re(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function tq(t,n,e){let r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function nq(t,n,e,r){let[o,i]=fp(n,e),s=4,a=new Uint8Array(w5(n*e,s));return Re(t,()=>t.readPixels(0,0,o,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function rq(t,n,e,r,o,i,s,a){let l=t,c=new Float32Array(C5(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,n),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function oq(t,n,e){let r=new Float32Array(n*e*4);return Re(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,r)),r}var s_=class{constructor(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let e=H().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,b5(e,n)):this.gl=jo(e);let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(H().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=o0(this.gl,i),Go(this.gl,s))this.textureHalfFloatExtension=o0(this.gl,s);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Go(this.gl,o))this.colorBufferHalfFloatExtension=o0(this.gl,o);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Go(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Go(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=G5(this.gl),this.indexBuffer=W5(this.gl),this.framebuffer=R5(this.gl),this.textureConfig=r0(this.gl,this.textureHalfFloatExtension)}get debug(){return H().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let n=this.gl;Re(n,()=>n.finish()),Re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),Re(n,()=>n.deleteFramebuffer(this.framebuffer)),Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,null)),Re(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)),Re(n,()=>n.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(n,e){return this.throwIfDisposed(),H5(this.gl,n,e,this.textureConfig)}createFloat16MatrixTexture(n,e){return this.throwIfDisposed(),q5(this.gl,n,e,this.textureConfig)}createUnsignedBytesMatrixTexture(n,e){return this.throwIfDisposed(),K5(this.gl,n,e,this.textureConfig)}uploadPixelDataToTexture(n,e){this.throwIfDisposed(),J5(this.gl,n,e)}uploadDenseMatrixToTexture(n,e,r,o){this.throwIfDisposed(),Q5(this.gl,n,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(n,e){return this.throwIfDisposed(),Y5(this.gl,n,e,this.textureConfig)}createPackedMatrixTexture(n,e){return this.throwIfDisposed(),X5(this.gl,n,e,this.textureConfig)}deleteMatrixTexture(n){this.throwIfDisposed(),this.outputTexture===n&&(YA(this.gl,this.framebuffer),this.outputTexture=null),Re(this.gl,()=>this.gl.deleteTexture(n))}downloadByteEncodedFloatMatrixFromOutputTexture(n,e,r){return this.downloadMatrixDriver(n,()=>nq(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(n,e,r,o,i,s){return rq(this.gl,n,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(n,e){return tq(this.gl,n,e)}createBufferFromTexture(n,e,r){this.bindTextureToFrameBuffer(n);let o=eq(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let n=this.createFence(this.gl);return this.pollFence(n)}createFence(n){let e,r;if(H().getBool("WEBGL_FENCE_API_ENABLED")){let o=n,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(n,e,r){return this.downloadMatrixDriver(n,()=>oq(this.gl,e,r))}createProgram(n){this.throwIfDisposed();let e=this.gl,r=E5(e,n);this.vertexShader==null&&(this.vertexShader=j5(e));let o=S5(e);return Re(e,()=>e.attachShader(o,this.vertexShader)),Re(e,()=>e.attachShader(o,r)),T5(e,o),this.debug&&XC(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Z5(e,this.program,this.vertexBuffer)),o}deleteProgram(n){this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&Re(this.gl,()=>this.gl.deleteProgram(n))}setProgram(n){this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&XC(this.gl,this.program),Re(this.gl,()=>this.gl.useProgram(n))}getUniformLocation(n,e,r=!0){return this.throwIfDisposed(),r?M5(this.gl,n,e):F5(this.gl,n,e)}getAttributeLocation(n,e){return this.throwIfDisposed(),Re(this.gl,()=>this.gl.getAttribLocation(n,e))}getUniformLocationNoThrow(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)}setInputMatrixTexture(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),O5(this.gl,n,e,r)}setOutputMatrixTexture(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)}setOutputPackedMatrixTexture(n,e,r){this.throwIfDisposed();let[o,i]=Fs(e,r);this.setOutputMatrixTextureDriver(n,o,i)}setOutputMatrixWriteRegion(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)}setOutputPackedMatrixWriteRegion(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&XC(this.gl,this.program),i0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let n=this.gl;this.debug&&this.debugValidate(),Re(n,()=>n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Re(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=o0(this.gl,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let n=this.getQueryTimerExtensionWebGL1(),e=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),e}endQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(n){return await C.repeatedTry(()=>this.disposed||this.isQueryAvailable(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(n,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(n,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(n){return new Promise(e=>{this.addItemToPoll(()=>n.isFencePassed(),()=>e())})}pollItems(){let n=ive(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=n;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(n+1)}addItemToPoll(n,e){this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),!(this.itemsToPoll.length>1)&&C.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(n){this.throwIfDisposed(),YC(this.gl,n,this.framebuffer),this.debug&&i0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(YC(this.gl,this.outputTexture,this.framebuffer),this.debug&&i0(this.gl)):YA(this.gl,this.framebuffer)}downloadMatrixDriver(n,e){this.bindTextureToFrameBuffer(n);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(n,e,r){this.throwIfDisposed();let o=this.gl;YC(o,n,this.framebuffer),this.debug&&i0(o),this.outputTexture=n,Re(o,()=>o.viewport(0,0,e,r)),Re(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(n,e,r,o){this.throwIfDisposed(),Re(this.gl,()=>this.gl.scissor(n,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function ive(t){let n=0;for(;n<t.length&&t[n]();++n);return n-1}var{getBroadcastDims:iq}=T;function sq(t,n,e,r){let o=[];t.forEach(m=>{let h=C.sizeFromShape(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?o.push(`uniform float ${m.name}${h>1?`[${h}]`:""};`):(o.push(`uniform sampler2D ${m.name};`),o.push(`uniform int offset${m.name};`))});let i=o.join(`
`),s=t.map(m=>sve(m,n,r)).join(`
`),a=n.texShape,l=nn(),c=cve(l),u,d,p=pve(l);return n.isPacked?(u=ave(n.logicalShape,a),d=dve(l)):(u=lve(n.logicalShape,a),d=uve(l)),r&&(p+=gve),[p,c,d,i,u,s,e].join(`
`)}function sh(t){let n=t.shapeInfo.logicalShape;switch(n.length){case 0:return Dve(t);case 1:return kve(t);case 2:return Rve(t);case 3:return Fve(t);case 4:return Pve(t);case 5:return Lve(t);case 6:return $ve(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function aq(t){switch(t.shapeInfo.logicalShape.length){case 0:return Tve(t);case 1:return Nve(t);case 2:return Ave(t);case 3:return Mve(t);default:return Ove(t)}}function sve(t,n,e=!1){let r="";e?r+=aq(t):r+=sh(t);let o=t.shapeInfo.logicalShape,i=n.logicalShape;return o.length<=i.length&&(e?r+=Vve(t,n):r+=Bve(t,n)),r}function ave(t,n){switch(t.length){case 0:return lq();case 1:return yve(t,n);case 2:return Eve(t,n);case 3:return xve(t,n);default:return wve(t,n)}}function lve(t,n){switch(t.length){case 0:return lq();case 1:return vve(t,n);case 2:return Sve(t,n);case 3:return bve(t,n);case 4:return Cve(t,n);case 5:return _ve(t,n);case 6:return Ive(t,n);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function cve(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function uve(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function dve(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function pve(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${fve}
    ${mve}
    ${hve}
  `}var fve=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,mve=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,hve=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,gve=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function lq(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function yve(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${e[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return 2 * (resTexRC.x * ${e[1]} + resTexRC.y);
    }
  `}function vve(t,n){return n[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${n[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return resTexRC.x * ${n[1]} + resTexRC.y;
    }
  `}function xve(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function bve(t,n){let e=es(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec3(r, c, d);
    }
  `}function wve(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,s="",a="b, r, c";for(let l=2;l<t.length-1;l++)i*=t[t.length-l-1],s=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+s,a=`b${l}, `+a;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${a});
    }
  `}function Cve(t,n){let e=es(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec4(r, c, d, d2);
    }
  `}function _ve(t,n){let e=es(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${n[0]},
                             ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Ive(t,n){let e=es(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Eve(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(C.arraysEqual(t,n))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `;let r=Math.ceil(t[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function Sve(t,n){return C.arraysEqual(t,n)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `:t[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function hp(t){return`offset${t}`}function Tve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=nn();return`
    vec4 ${e}() {
      return ${r.texture2D}(${n}, halfCR);
    }
  `}function Dve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${e}() {return ${n};}`;let[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${e}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let[i,s]=t.shapeInfo.texShape,a=hp(n);return`
    float ${e}() {
      vec2 uv = uvFromFlat(${i}, ${s}, ${a});
      return sampleTexture(${n}, uv);
    }
  `}function Nve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=nn();return`
    vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function kve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${e}(int index) {
        ${ah(t)}
      }
    `;let r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${e}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let s=hp(n);return i===1?`
      float ${e}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?`
      float ${e}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${e}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${s});
      return sampleTexture(${n}, uv);
    }
  `}function Ave(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=o[0],s=o[1],a=nn();if(o!=null&&C.arraysEqual(n,o))return`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${i}.0);

        return ${a.texture2D}(${e}, uv);
      }
    `;let l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${a.texture2D}(${e}, uv);
    }
  `}function Rve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape;if(o!=null&&C.arraysEqual(n,o)){let d=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${e}, uv);
    }
  `}let{newShape:i,keptDims:s}=C.squeezeShape(n),a=i;if(a.length<n.length){let d=lh(t,a),p=["row","col"];return`
      ${sh(d)}
      float ${r}(int row, int col) {
        return ${r}(${ch(p,s)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${ah(t)}
      }
    `;let l=o[0],c=o[1],u=hp(e);return c===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${e}, uv);
    }
  `:l===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${e}, uv);
    }
  `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${u};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${e}, uv);
  }
`}function Mve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){let d=n.slice(1),p=[1,2],f=lh(t,d),m=["b","row","col"];return`
        ${aq(f)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${ch(m,p)});
        }
      `}let s=i[0],a=i[1],l=Math.ceil(n[2]/2),c=l*Math.ceil(n[1]/2),u=nn();return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${s}, ${a}, ${c}, ${l}, b, row, col);
      return ${u.texture2D}(${e}, uv);
    }
  `}function Fve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[1]*n[2],i=n[2],{newShape:s,keptDims:a}=C.squeezeShape(n),l=s;if(l.length<n.length){let m=lh(t,l),h=["row","col","depth"];return`
        ${sh(m)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${ch(h,a)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${ah(t)}
      }
    `;let c=t.shapeInfo.texShape,u=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===o&&p==null)return`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${u}.0);
          return sampleTexture(${e}, uv);
        }
      `;if(d===i&&p==null)return`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${u}.0);
      return sampleTexture(${e}, uv);
    }
  `;let f=hp(e);return`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${u}, ${d}, index);
        return sampleTexture(${e}, uv);
      }
  `}function Ove(t){let n=t.shapeInfo.logicalShape,e=n.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],a=s[0],l=s[1],c=Math.ceil(n[e-1]/2),u=c*Math.ceil(n[e-2]/2),d="int b, int row, int col",p=`b * ${u} + (row / 2) * ${c} + (col / 2)`;for(let m=2;m<e-1;m++)d=`int b${m}, `+d,u*=n[e-m-1],p=`b${m} * ${u} + `+p;let f=nn();return`
    vec4 ${o}(${d}) {
      int index = ${p};
      int texR = index / ${l};
      int texC = index - texR * ${l};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${a});
      return ${f.texture2D}(${r}, uv);
    }
  `}function Pve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[3],i=n[2]*o,s=n[1]*i,{newShape:a,keptDims:l}=C.squeezeShape(n);if(a.length<n.length){let m=lh(t,a),h=["row","col","depth","depth2"];return`
      ${sh(m)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${ch(h,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${s}, ${i}, ${o}, 1)));
        ${ah(t)}
      }
    `;let c=t.shapeInfo.flatOffset,u=t.shapeInfo.texShape,d=u[0],p=u[1];if(p===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let f=hp(e);return`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${f});
      return sampleTexture(${e}, uv);
    }
  `}function Lve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[4],i=n[3]*o,s=n[2]*i,a=n[1]*s,{newShape:l,keptDims:c}=C.squeezeShape(n);if(l.length<n.length){let h=lh(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${sh(h)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${ch(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${ah(t)}
      }
    `;let u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]},
               ${n[2]*n[3]}, ${n[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=hp(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function $ve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=C.squeezeShape(n);if(o.length<n.length){let g=lh(t,o),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${sh(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${ch(x,i)});
      }
    `}let s=n[5],a=n[4]*s,l=n[3]*a,c=n[2]*l,u=n[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${ah(t)}
      }
    `;let d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];if(m===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]*n[4]},
               ${n[2]*n[3]*n[4]},
               ${n[3]*n[4]},
               ${n[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=hp(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${h};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function ah(t){let n=t.name,e=C.sizeFromShape(t.shapeInfo.logicalShape);return e<2?`return ${n};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${n}[i];
      }
    }
  `}function Vve(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=n.logicalShape.length,a=iq(t.shapeInfo.logicalShape,n.logicalShape),l=qe(s),c=s-i,u,d=["x","y","z","w","u","v"];i===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(b=>`coords.${d[b+c]} = 0;`).join(`
`);let p="";s<2&&i>0?p="coords":p=t.shapeInfo.logicalShape.map((b,I)=>`coords.${d[I+c]}`).join(", ");let f="return outputValue;",h=C.sizeFromShape(t.shapeInfo.logicalShape)===1,x=C.sizeFromShape(n.logicalShape)===1;if(i===1&&!h&&!x)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!x)s===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){let b=i-2,I=i-1;a.indexOf(b)>-1&&a.indexOf(I)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(I)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${f}
    }
  `}function Bve(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&C.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=qe(l),u=iq(t.shapeInfo.logicalShape,n.logicalShape),d=l-a,p,f=["x","y","z","w","u","v"];a===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(h=>`coords.${f[h+d]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${m});
    }
  `}function qe(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function lh(t,n){let e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function ch(t,n){return n.map(e=>t[e]).join(", ")}function uq(t,n,e,r){let o=n.userCode,i=e.map((f,m)=>{let h={logicalShape:f.shape,texShape:f.isUniform?null:f.texData.texShape,isUniform:f.isUniform,isPacked:f.isUniform?!1:f.texData.isPacked,flatOffset:null};return f.texData!=null&&f.texData.slice!=null&&f.texData.slice.flatOffset>0&&(h.flatOffset=f.texData.slice.flatOffset),{name:n.variableNames[m],shapeInfo:h}}),s=i.map(f=>f.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=sq(i,a,o,n.packedInputs),c=t.createProgram(l),u=null,d=t.getUniformLocation(c,"NAN",!1);H().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(c,"INFINITY",!1));let p={};for(let f=0;f<n.variableNames.length;f++){let m=n.variableNames[f],h=!1;p[m]=t.getUniformLocation(c,m,h),p[`offset${m}`]=t.getUniformLocation(c,`offset${m}`,h)}return{program:n,source:l,webGLProgram:c,uniformLocations:p,inShapeInfos:s,outShapeInfo:a,infLoc:u,nanLoc:d}}function cq(t,n){if(t.length!==n.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${n.length} inputs`);t.forEach((e,r)=>{let o=e.logicalShape,i=n[r],s=i.shape;if(!C.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!C.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function dq(t,n,e,r,o){cq(n.inShapeInfos,e),cq([n.outShapeInfo],[r]);let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,s[0],s[1]):t.setOutputMatrixTexture(i,s[0],s[1]),t.setProgram(n.webGLProgram),H().getNumber("WEBGL_VERSION")===1&&n.infLoc!==null&&t.gl.uniform1f(n.infLoc,1/0),n.nanLoc!==null&&t.gl.uniform1f(n.nanLoc,NaN),e.forEach((a,l)=>{let c=n.program.variableNames[l],u=n.uniformLocations[c],d=n.uniformLocations[`offset${c}`];if(u!=null){if(a.isUniform){if(C.sizeFromShape(a.shape)<2)t.gl.uniform1f(u,a.uniformValues[0]);else{let p=a.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}return}a.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,a.texData.slice.flatOffset),t.setInputMatrixTexture(a.texData.texture,u,l)}}),o?.(t,n.webGLProgram),t.executeProgram()}function pq(t,n,e){let r="";n.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0,l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`});let o=t.userCode,i=t.constructor.name;return i+="_"+r+"_"+o,i}var{addImpl:fq,bincountImpl:a_,bincountReduceImpl:mq,ceilImpl:hq,concatImpl:gq,expImpl:yq,expm1Impl:vq,floorImpl:xq,gatherV2Impl:bq,greaterImpl:wq,lessImpl:Cq,linSpaceImpl:_q,logImpl:Iq,maxImpl:Eq,maximumImpl:Sq,minimumImpl:Tq,multiplyImpl:Dq,negImpl:Nq,prodImpl:kq,rangeImpl:Aq,rsqrtImpl:Rq,simpleAbsImpl:l_,sliceImpl:Mq,sparseFillEmptyRowsImpl:Fq,sparseReshapeImpl:Oq,stridedSliceImpl:Pq,subImpl:Lq,tileImpl:$q,topKImpl:Vq,transposeImpl:gp,uniqueImpl:Bq}=_A;function rR(t,n){return["x","y","z","w","u","v"].slice(0,n).map(e=>`${t}.${e}`)}function hn(t,n){return n===1?[t]:rR(t,n)}function zq(t,n){if(t===1)return"rc";let e="";for(let r=0;r<t;r++)e+=n[r],r<t-1&&(e+=",");return e}var c_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;let e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=hn("rc",e),o=qe(e),i=Gve(e,n,r),s=Wve(e,n[n.length-1],n[n.length-2],r),a=Hve(n,r);this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${a}));
          }
        }
      `}}};function jve(t,n){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<t;s++)i=`${n[n.length-1-s]},`+i;e.push(i)}return e}function Gve(t,n,e){if(t===1)return`rc > ${n[0]}`;let r="";for(let o=t-2;o<t;o++)r+=`${e[o]} >= ${n[o]}`,o<t-1&&(r+="||");return r}function Wve(t,n,e,r){if(t===1)return"";let o=r.slice(-2);return`
    int r = ${o[0]};
    int c = ${o[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${n};
    bool rEdge = rp1 >= ${e};
  `}function Hve(t,n){let e=t.length,r=jve(e,n);return e===1?`getA(rc),
            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${r[0]}),
          cEdge ? 0. : getA(${r[1]}),
          rEdge ? 0. : getA(${r[2]}),
          rEdge || cEdge ? 0. : getA(${r[3]})`}var uh=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${qve(e)}
      ${oh(n)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${n[1]};
        int cols = ${n[2]};

        ${r}

        setOutput(result);
      }
    `}};function qve(t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${es(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var u_=class{constructor(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(n,e,r){let o=jq(e,r),i=Gq(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=Uq(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].shift();return this.usedTextures[i].push(l),l}let a;return o===mr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===mr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===mr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===mr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===mr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(n,e,r,o){if(this.freeTextures==null)return;let i=jq(r,o),s=Gq(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=Uq(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=H().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(n),this._numBytesAllocated-=a):(this.freeTextures[s].push(n),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[s],u=c.indexOf(n);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(u,1),this.log()}log(){if(!this.logEnabled)return;let n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${n})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let n in this.freeTextures)this.freeTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(let n in this.usedTextures)this.usedTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function Kve(t,n){let e=t;if(n===e.R32F)return 4;if(n===e.R16F)return 2;if(n===e.RGBA32F)return 16;if(n===t.RGBA)return 16;if(n===e.RGBA16F)return 8;throw new Error(`Unknown internal format ${n}`)}function Uq(t,n,e,r,o){let i=Xve(n,r),s;if(o){let[l,c]=Fs(t[0],t[1]);s=l*c}else{let[l,c]=fp(t[0],t[1]);s=l*c}let a=Kve(e,i);return s*a}function Xve(t,n){switch(t){case mr.PACKED_2X2_FLOAT32:return tR(n);case mr.PACKED_2X2_FLOAT16:return nR(n);case mr.UNPACKED_FLOAT32:return QA(n);case mr.UNPACKED_FLOAT16:return JA(n);case mr.PACKED_4X1_UNSIGNED_BYTE:return eR(n);default:throw new Error(`Unknown physical texture type ${t}`)}}function Yve(t){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?mr.PACKED_2X2_FLOAT32:mr.UNPACKED_FLOAT32:t?mr.PACKED_2X2_FLOAT16:mr.UNPACKED_FLOAT16}function jq(t,n){if(t===Tr.UPLOAD)return mr.PACKED_2X2_FLOAT32;if(t===Tr.RENDER||t==null)return Yve(n);if(t===Tr.DOWNLOAD||t===Tr.PIXELS)return mr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function Gq(t,n,e){return`${t[0]}_${t[1]}_${n}_${e}`}var Vr=class{constructor(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},qn="if (isnan(x)) return x;",Wq="return x;",oR="return abs(x);";var Hq="return (x >= 0.0) ? x : (exp(x) - 1.0);",qq=qn+`
  return (x < 0.0) ? 0.0 : x;
`,Kq=qn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,a0="return x;",Xq="return 1.0 / (1.0 + exp(-1.0 * x));";var Zq="return x;",Qq=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Jq=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,e8=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,t8="return 1.0 / (1.0 + exp(-1.0 * x));",Ii=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var d_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;let e=n.length,r=hn("rc",e),o=qe(e),i=zq(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Qve=dr.whereImpl,Jve=1e-7,exe=1e-4,p_={};function txe(t){return t in p_||(p_[t]={}),p_[t]}var nxe=128,rxe=600;function oxe(){return H().global.screen==null?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*rxe/1024/1024}var n8=(()=>{class t extends ha{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){let r=jo(H().getNumber("WEBGL_VERSION"));this.binaryCache=txe(H().getNumber("WEBGL_VERSION")),this.gpgpu=new s_(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new u_(this.gpgpu),this.numMBBeforeWarning=oxe(),this.texData=new hd(this,ul())}nextDataId(){return t.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,r,o){if((H().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||H().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Tr.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(H().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Tr.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:c}=r;if(a!=null){let f;c?f=new Ii(l,a0):f=new Vr(l,a0);let m=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),h=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),h}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let u=this.activeTimers!=null,d;u&&(d=C.now());let p;if(i==="complex64"){let f=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,m)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=C.now()-d),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let h=this.pendingRead.get(e);return new Promise(g=>h.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:c}=r;if(s!=null){let h;c?h=new Ii(i,a0):h=new Vr(i,a0);let g=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:a}],a),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(o!=null)return this.convertAndCacheOnCPU(e);if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&H().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(a!=="complex64"&&H().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);let h=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(h.texture,...gu(i))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){let h=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=h[0],x=h[1];p=T.mergeRealAndImagArrays(g,x)}else if(u==null)p=this.getValuesFromTexture(e);else{let h=C.sizeFromShape(i);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,h)}d!=null&&this.disposeIntermediateTensorInfo(d);let f=this.convertAndCacheOnCPU(e,p),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(h=>h(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ul().removeDataId(e,this),this.pendingDeletes--),f}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>C.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(e.shape,e.dtype,o)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!_5(o))throw H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=C.sizeFromShape(r);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),m=this.texData.get(f.dataId),h=this.gpgpu.downloadMatrixFromPackedTexture(m.texture,...gu(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),h}let a=H().getBool("WEBGL_PACK")&&i===!0,l=a?ZC(r):r,c=a?new r_(l):new n_(l),u=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=C.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=C.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=await Promise.all(s);l.kernelMs=C.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:C.now(),endMs:null}}endTimer(e){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=C.now(),e)}async getQueryTime(e){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=nxe){return H().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&C.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Qve(e.shape,r)}packedUnaryOp(e,r,o){let i=new Ii(e.shape,r),s=this.compileAndRun(i,[e],o);return ul().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=l_(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,oR,e.dtype);let r=new Vr(e.shape,oR),o=this.compileAndRun(r,[e]);return ul().makeTensorFromDataId(o.dataId,o.shape,o.dtype)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&C.isString(o[0])){let s=o.map(a=>C.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){let{dataId:i}=this.makeTensorInfo(e,r,o);return ul().makeTensorFromDataId(i,e,r,this)}unpackTensor(e){let r=new d_(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new c_(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[yu(e.shape),...vu(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[yu(r),...vu(r)],a=new uh(s,o),c=this.runWebGLProgram(a,[i],e.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}}decode(e){let r=this.texData.get(e),{isPacked:o,shape:i,dtype:s}=r,a=ZC(i),l;o?l=new t_(a):l=new e_(a);let u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],s,null,!0);return{dtype:s,shape:i,dataId:u.dataId}}runWebGLProgram(e,r,o,i,s=!1){let a=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===pp.DENSE){let x=gu(e.outputShape);l.texShape=x.map(b=>b*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),C.sizeFromShape(a.shape)===0)return l.values=C.getTypedArrayFromDType(a.dtype,0),a;let c=[],u=r.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!e.packedInputs&&C.sizeFromShape(x.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}else if(!!b.isPacked!=!!e.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),c.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!mp(b.shape,x.shape)){let I=x,_=x.shape;x.shape=b.shape,x=this.packedReshape(x,_),c.push(x),b=this.texData.get(x.dataId),I.shape=_}return this.uploadToGPU(x.dataId),{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);let d={shape:a.shape,texData:l,isUniform:!1},p=pq(e,u,d),f=this.getAndSaveBinary(p,()=>uq(this.gpgpu,e,u,d)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),dq(this.gpgpu,f,u,d,i),c.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let g=H().get("WEBGL_FLUSH_THRESHOLD");if(g>0){let x=C.now();x-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!H().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let x=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),x}return a}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(H().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=j(()=>{if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=H().getBool("DEBUG");H().set("DEBUG",!1);let r=this.abs(Fe(1e-8)).dataSync()[0];if(H().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Jve:exe}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:c}=r;if(a!=null)return;let u=this.activeTimers!=null,d;u&&(d=C.now());let p=r.texShape;if(p==null&&(p=P5(o,c),r.texShape=p),s!=null){let f=ZC(o),m,h=p[1],g=p[0],x=s instanceof Uint8Array;c?([h,g]=Fs(p[0],p[1]),m=new i_(f,[g,h],x)):m=new o_(f,[g,h],x);let b=this.makeTensorInfo([g,h],i);x?this.texData.get(b.dataId).usage=Tr.PIXELS:this.texData.get(b.dataId).usage=Tr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),h,g,s);let _=this.runWebGLProgram(m,[b],i,null,!0),E=this.texData.get(_.dataId);r.texture=E.texture,r.texShape=E.texShape,r.isPacked=E.isPacked,r.usage=E.usage,this.disposeIntermediateTensorInfo(b),this.texData.delete(_.dataId),r.values=null,u&&(this.uploadWaitMs+=C.now()-d)}else{let f=this.acquireTexture(p,l,i,c);r.texture=f}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return this.releaseGPUData(e),r!=null&&(o.values=ixe(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*C.bytesPerElement(r)}}return t.nextDataId=0,t})();function ixe(t,n){if(n==="float32"||n==="complex64")return t;if(n==="int32"||n==="bool"){let e=n==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<e.length;++r)e[r]=Math.round(t[r]);return e}else throw new Error(`Unknown dtype ${n}`)}Jc.isBrowser()&&ww("webgl",()=>new n8,2);var f_=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var Wo=class{constructor(n,e,r){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOperation(float a, float b) {
        ${n}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var xu=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;var Ei=class{constructor(n,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length,s="";if(o)if(i===0||C.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${qe(i)} coords = getOutputCoords();
        `,i===1)s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=hn("coords",i);s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${n}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function gn(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var r8={kernelName:Cs,backendName:"webgl",kernelFunc:gn};function Yr(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=gn({inputs:{x:r},backend:e}),l=gn({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var o8={kernelName:jf,backendName:"webgl",kernelFunc:Yr};var iR="return (a < 0.) ? b * a : a;",sR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function sxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r,s=e.makeTensorInfo([],"float32",C.createScalarValue(i,"float32")),a=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ei(sR,o.shape,s.shape):new Wo(iR,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],o.dtype);return e.disposeIntermediateTensorInfo(s),l}var i8={kernelName:Ec,backendName:"webgl",kernelFunc:sxe};var aR="return (a < 0.) ? b * a : a;",lR=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function axe(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ei(lR,r.shape,o.shape):new Wo(aR,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)}var s8={kernelName:$c,backendName:"webgl",kernelFunc:axe};var m_="if (isnan(x)) return x;",a8=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,l8=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function _e({opSnippet:t,packedOpSnippet:n,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let d=a.texData.get(s.dataId),p=e(d.values,l);return a.makeTensorInfo(s.shape,l,p)}let c=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&n!=null,u;return c?u=new Ii(s.shape,n):u=new Vr(s.shape,t),a.runWebGLProgram(u,[s],l)}}function St({opSnippet:t,packedOpSnippet:n,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:c}=s,u=a;if(r&&l.dtype==="complex64"){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,x]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(I=>{let[_,E]=I,S={dataId:_.dataId,dtype:_.dtype,shape:l.shape},D={dataId:E.dataId,dtype:E.dtype,shape:c.shape},M=new Wo(t,l.shape,c.shape);return u.runWebGLProgram(M,[S,D],Fn(_.dtype,E.dtype))}),b=Yr({inputs:{real:g,imag:x},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(x),b}let d=i||Fn(l.dtype,c.dtype);if(u.shouldExecuteOnCPU([l,c])&&o!=null){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,x]=o(l.shape,c.shape,m.values,h.values,d),b=u.makeTensorInfo(x,d),I=u.texData.get(b.dataId);return I.values=g,b}let p=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&n!=null,f;return p?f=new Ei(n,l.shape,c.shape,e):f=new Wo(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function bu(t,n=!1){if(t==="linear")return n?Zq:Wq;if(t==="relu")return n?Jq:qq;if(t==="elu")return n?Qq:Hq;if(t==="relu6")return n?e8:Kq;if(t==="prelu")return n?lR:aR;if(t==="leakyrelu")return n?sR:iR;if(t==="sigmoid")return n?t8:Xq;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var dh=class{constructor(n,e,r,o=!1,i=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;let u=o?n[1]:n[2],d=Math.ceil(u/2),p=o?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",x="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,x="result = activation(result);");let b=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let I="rc.x",_="rc.x";n[0]<e[0]?I=`int(min(float(rc.x), ${n[0]-1}.))`:e[0]<n[0]&&(_=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`
      ${g}

      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${d}; i++) {
          int batchA = ${I};
          int batchB = ${_};
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${x}

        setOutput(result);
      }
    `}};var cR={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},l0=class{constructor(n,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${n}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var c8="return a * b;";function c0(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=T.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),c=new l0(cR.REAL,r.shape,o.shape),u=new l0(cR.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Yr({inputs:{real:p,imag:f},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[c,u]=Dq(r.shape,o.shape,a.values,l.values,i),d=e.makeTensorInfo(u,i),p=e.texData.get(d.dataId);return p.values=c,d}let s;return H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new Ei(c8,r.shape,o.shape):s=new Wo(c8,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var u8={kernelName:ja,backendName:"webgl",kernelFunc:c0};function d8(t,n,e){let r=[yu(t.shape),...vu(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},i=[yu(n),...vu(n)],s=new uh(i,r),l=e.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}}function de(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=e,a=C.sizeFromShape(o.shape),l=C.inferFromImplicitShape(i,a),c=C.sizeFromShape(l);C.assert(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=s.texData.get(o.dataId);return u.isPacked&&!mp(o.shape,l)&&!(u.texture!==null&&mp(u.shape,l))?d8(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var p8={kernelName:Vc,backendName:"webgl",kernelFunc:de};var u0=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,c="sumValue += dot(values, ones);";if(e!=null){let d=1/e;c=`sumValue += dot(values * ${C.isInt(d)?d.toPrecision(2):d}, ones);`}let u="";i%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var h_=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let u=Math.floor(r/4)*4,d=r%4,p=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function cxe(t){let n=[];for(;n.length===0||n[n.length-1].outSize!==1;){let e=n.length?n[n.length-1].outSize:t[1],r=T.computeOptimalWindowSize(e);n.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return n}function bo(t,n,e,r){let o=cxe(t.shape),i=t;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:c}=o[s],u,d;e==="mean"?u=s===0?new u0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new u0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new h_({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},e),d=i,i=r.runWebGLProgram(u,[i],n),d.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(d)}return i}var g_=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[e[s]];this.outputShape=r,this.rank=r.length;let o=qe(this.rank),i=uxe(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function uxe(t){let n=t.length;if(n>6)throw Error(`Transpose for rank ${n} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(n);for(let o=0;o<t.length;o++)r[t[o]]=e[o];return r.join()}var y_=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(n.length);for(let u=0;u<r.length;u++)r[u]=n[e[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=qe(this.rank),i=rR("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function wu(t,n,e){let r=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new y_(t.shape,n):new g_(t.shape,n);return e.runWebGLProgram(r,[t],t.dtype)}function f8(t,n,e,r){let o=n,i=t.shape.length,s=C.parseAxisParam(o,t.shape),a=s,l=T.getAxesPermutation(a,i),c=l!=null,u=t;c&&(u=wu(t,l,r),a=T.getInnerMostAxes(a.length,i)),T.assertAxesAreInnerMostDims("sum",a,i);let[d,p]=T.computeOutAndReduceShapes(u.shape,a),f=d;e&&(f=T.expandShapeToKeepDim(d,s));let m=C.sizeFromShape(p),g=C.sizeFromShape(t.shape)/m,x=de({inputs:{x:u},attrs:{shape:[g,m]},backend:r}),b=kd(t.dtype),I=bo(x,b,"sum",r),_=de({inputs:{x:I},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(I),c&&r.disposeIntermediateTensorInfo(u),_}function yp(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;return f8(o,i,s,e)}var m8={kernelName:Wc,backendName:"webgl",kernelFunc:yp};function Xt(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];let c;if(s.shouldExecuteOnCPU([o])){let d=s.texData.get(o.dataId).values,p=gp(d,o.shape,o.dtype,i,l);c=s.makeTensorInfo(l,o.dtype);let f=s.texData.get(c.dataId);f.values=p}else c=wu(o,i,s);return c}var h8={kernelName:Xc,backendName:"webgl",kernelFunc:Xt};var uR=1e3;function vp({a:t,b:n,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=t.shape.length,u=n.shape.length,d=e?t.shape[c-2]:t.shape[c-1],p=r?n.shape[u-1]:n.shape[u-2],f=e?t.shape[c-1]:t.shape[c-2],m=r?n.shape[u-2]:n.shape[u-1],h=t.shape.slice(0,-2),g=n.shape.slice(0,-2),x=C.sizeFromShape(h),b=C.sizeFromShape(g),I=x===b||x===1||b===1;C.assert(c>=2&&u>=2&&I,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${h}) and (${g}).`);let E=(x>b?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([f,m]);C.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${t.shape} and ${n.shape} and transposeA=${e} and transposeB=${r} must match.`);let S=e?[x,d,f]:[x,f,d],D=r?[b,m,p]:[b,p,m],M=de({inputs:{x:t},backend:o,attrs:{shape:S}}),R=de({inputs:{x:n},backend:o,attrs:{shape:D}}),L=[M,R],G=Math.max(x,b),W=e?M.shape[1]:M.shape[2],q=i!=null,X=s!=null,K=l==="leakyrelu",Z=l!=null?bu(l,!0):null,ae=q||X||K||Z!=null,ee;if((f===1||m===1)&&W>uR&&ae===!1){let ue=M,fe=R;e&&(ue=Xt({inputs:{x:M},backend:o,attrs:{perm:[0,2,1]}}),L.push(ue)),r&&(fe=Xt({inputs:{x:R},backend:o,attrs:{perm:[0,2,1]}}),L.push(fe));let ge=m!==1,he=m===1,ve=ue;ge&&(ve=de({inputs:{x:ue},backend:o,attrs:{shape:[G,W,1]}}),L.push(ve));let xe=m===1?2:1,we=fe;he&&(we=de({inputs:{x:fe},backend:o,attrs:{shape:[G,1,W]}}),L.push(we));let Ne=c0({inputs:{a:ve,b:we},backend:o});ee=yp({inputs:{x:Ne},backend:o,attrs:{axis:xe,keepDims:!0}}),L.push(Ne)}else{let ue=Fn(t.dtype,n.dtype),fe=new dh(S,D,[G,f,m],e,r,q,Z,X,K),ge=[M,R];if(i!=null&&ge.push(i),X&&ge.push(s),K){let he=o.makeTensorInfo([],"float32",C.createScalarValue(a,"float32"));ge.push(he),L.push(he)}ee=o.runWebGLProgram(fe,ge,ue)}let ie=de({inputs:{x:ee},backend:o,attrs:{shape:E}});L.push(ee);for(let ue of L)o.disposeIntermediateTensorInfo(ue);return ie}function dxe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return vp({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var g8={kernelName:Sd,backendName:"webgl",kernelFunc:dxe};var y8="return abs(x);";function pxe(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=l_(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Ii(r.shape,y8):o=new Vr(r.shape,y8),e.runWebGLProgram(o,[r],r.dtype)}var v8={kernelName:ac,backendName:"webgl",kernelFunc:pxe};var fxe=qn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,mxe=_e({opSnippet:fxe}),x8={kernelName:ga,backendName:"webgl",kernelFunc:mxe};var hxe=qn+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,gxe=_e({opSnippet:hxe}),b8={kernelName:ya,backendName:"webgl",kernelFunc:gxe};var w8="return a + b;",yxe=St({opSnippet:w8,packedOpSnippet:w8,supportsComplex:!0,cpuKernelImpl:fq}),C8={kernelName:zi,backendName:"webgl",kernelFunc:yxe};var v_=class{constructor(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var x_=class{constructor(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function b_(t){let{inputs:n,backend:e}=t,r=n;if(r.length===1)return gn({inputs:{x:r[0]},backend:e});if(r.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=b_({inputs:r.slice(0,l),backend:e}),u=b_({inputs:r.slice(l),backend:e});return b_({inputs:[c,u],backend:e})}let o=r.map(l=>l.dtype).reduce((l,c)=>Fn(l,c)),i=r.map(l=>l.shape),a=H().getBool("WEBGL_PACK")?new x_(r[0].shape,i):new v_(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var _8={kernelName:$f,backendName:"webgl",kernelFunc:b_};function vxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=C.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("all",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=C.sizeFromShape(f),h=de({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=bo(h,h.dtype,"all",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=de({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=de({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var I8={kernelName:Vf,backendName:"webgl",kernelFunc:vxe};function xxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=C.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("any",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=C.sizeFromShape(f),h=de({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=bo(h,h.dtype,"any",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=de({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=de({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var E8={kernelName:Bf,backendName:"webgl",kernelFunc:xxe};var w_=class{constructor(n,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=n;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var C_=class{constructor(n,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,C.assert(n.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,c=qe(l),u=hn("coords",l),d,p;if(s===1){p=l+1;let M=qe(p);d=`
        ${M} sourceLocR = ${M}(${u.join()}, 0);
        ++${u[l-1]};
        ${M} sourceLocG = ${M}(${u.join()}, 0);
        ++${u[l-2]};
        ${M} sourceLocA = ${M}(${u.join()}, 0);
        --${u[l-1]};
        ${M} sourceLocB = ${M}(${u.join()}, 0);
        --${u[l-2]};`}else p=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;let f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],h=f.map(M=>"int "+M),g=hn("sourceLocR",p-1).concat("inIdx.r"),x=hn("sourceLocG",p-1).concat("inIdx.g"),b=hn("sourceLocB",p-1).concat("inIdx.b"),I=hn("sourceLocA",p-1).concat("inIdx.a"),_=r==="max"?"greaterThan":"lessThan",E=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${I.join()})));`,S=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,D=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${S};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${E}
          vec4 candidate = ${S};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${_}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function S8(t,n,e,r=null){let o=n.shape[0],i=n.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=T.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new w_(a,e,r==null),c=[n];r!=null&&c.push(r);let u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;let d=S8(t,n,e,u);return t.disposeIntermediateTensorInfo(u),d}function T8(t,n,e,r=null){let o=r!=null?r.shape:n.shape,i=o[o.length-1],s=T.computeOptimalWindowSize(i),a=new C_(o,s,e,r==null),l=r==null?[n]:[n,r],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===n.shape.length){let u=T8(t,n,e,c);return t.disposeIntermediateTensorInfo(c),u}return c}function __(t,n,e,r){let o=[e];if(T.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,n.shape.length),!H().getBool("WEBGL_PACK_REDUCE")||n.shape.length<=2){let i=[],[s,a]=T.computeOutAndReduceShapes(n.shape,o),l=C.sizeFromShape(a),c=de({inputs:{x:n},backend:t,attrs:{shape:[-1,l]}});i.push(c);let u=S8(t,c,r);i.push(u);let d=de({inputs:{x:u},backend:t,attrs:{shape:s}});return i.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}return T8(t,n,r)}function bxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=C.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Xt({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=__(e,l,s[0],"max");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var D8={kernelName:lc,backendName:"webgl",kernelFunc:bxe};function wxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=C.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Xt({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=__(e,l,s[0],"min");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var N8={kernelName:cc,backendName:"webgl",kernelFunc:wxe};var Cxe=qn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,_xe=_e({opSnippet:Cxe}),k8={kernelName:va,backendName:"webgl",kernelFunc:_xe};var Ixe=qn+"return log(x + sqrt(x * x + 1.0));",Exe=_e({opSnippet:Ixe}),A8={kernelName:xa,backendName:"webgl",kernelFunc:Exe};var Sxe=qn+`
  return atan(x);
`,Txe=_e({opSnippet:Sxe}),R8={kernelName:ba,backendName:"webgl",kernelFunc:Txe};var Dxe=a8+`
  return atan(a, b);
`,Nxe=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+l8+`
  return result;
`,kxe=St({opSnippet:Dxe,packedOpSnippet:Nxe}),M8={kernelName:Ca,backendName:"webgl",kernelFunc:kxe};var Axe=qn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Rxe=_e({opSnippet:Axe}),F8={kernelName:wa,backendName:"webgl",kernelFunc:Rxe};var ts=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;let h=e==="avg",g=`((batch  * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + d`,x=`(xR * ${n.inWidth} + xC) * ${n.inChannels} + d`,b="0.0";if(h||(b="-1.0 / 1e-20"),r){let M=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${M} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:x:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let I="max",_=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(_="avgValue / count");let E=Math.floor(s/4)*4,S=s%4,D=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${E}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${E};
          if (${S===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${S===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${S===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${_});
      }
    `}},Cu=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideDepth,l=n.strideHeight,c=n.strideWidth,u=n.dilationDepth,d=n.dilationHeight,p=n.dilationWidth,f=n.effectiveFilterDepth,m=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.front,x=n.padInfo.top,b=n.padInfo.left;this.outputShape=n.outShape;let I=e==="avg",_="0.0";if(I||(_="-1.0 / 1e-20"),r){let L=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${x}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${n.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${L} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${n.inDepth} + xD) * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`((xD * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let E="max",S=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(S="avgValue / count");let D=Math.floor(s/4)*4,M=s%4,R=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${E}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${x}, ${b});
      const float initializationValue = ${_};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${_});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${D};
            if (${M===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${M===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${M===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${R}
            }
          }
          setOutput(${S});
        }
      }
    `}};function Mxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Os(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;C.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))return gn({inputs:{x:o},backend:e});let d=new ts(u,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}var O8={kernelName:uc,backendName:"webgl",kernelFunc:Mxe};function Fxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,l,c),p=new Cu(d,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var P8={kernelName:dc,backendName:"webgl",kernelFunc:Fxe};var I_=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=l-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},E_=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,h=p-1-n.padInfo.top,g=f-1-n.padInfo.left,x=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Oxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new E_(p);return e.runWebGLProgram(f,[o],s.dtype)}var L8={kernelName:Uf,backendName:"webgl",kernelFunc:Oxe};function Pxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;Os([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=new I_(u);return e.runWebGLProgram(d,[o],s.dtype)}var $8={kernelName:zf,backendName:"webgl",kernelFunc:Pxe};function Lxe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;return vp({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var V8={kernelName:pc,backendName:"webgl",kernelFunc:Lxe};var S_=class{constructor(n,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var T_=class{constructor(n,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var $xe=({inputs:t,backend:n,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=t;C.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),C.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),C.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let c=[r,o,i],u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));let p=H().getBool("WEBGL_PACK_NORMALIZATION")?new T_(r.shape,o.shape,i.shape,u,d,l):new S_(r.shape,o.shape,i.shape,u,d,l);return n.runWebGLProgram(p,c,c[0].dtype)},B8={kernelName:_c,backendName:"webgl",kernelFunc:$xe};var D_=class{constructor(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;let e=qe(this.rank),r=`uniform int start[${this.rank}];`,o=Vxe(this.rank),i,s=n.map((a,l)=>`sourceLoc.${dR[l]} = start[${l}] + coords.${dR[l]};`);i=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      ${r}
      void main() {
        ${i}
        setOutput(getSource(${o}));
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}},dR=["x","y","z","w","u","v"];function Vxe(t){if(t===1)return"sourceLoc";if(t<=6)return dR.slice(0,t).map(n=>"sourceLoc."+n).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var N_=class{constructor(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;let e=qe(this.rank),r=hn("coords",this.rank),o=hn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${n[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${n.map((u,d)=>`start[${d}]`).join()});`:n.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}};function Bxe(t,n,e,r){let o=r.texData.get(t.dataId),i=r.makeTensorInfo(e,t.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=t.dtype;let a=ar.computeFlatOffset(n,C.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function Dl(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r,[a,l]=ar.parseSliceParams(o,i,s);if(ar.assertParamsValid(o,a,l),C.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.texData.get(o.dataId),p=Mq(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}let{isPacked:c}=e.texData.get(o.dataId),u=ar.isSliceContinous(o.shape,a,l);if(c||!u){let d=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new N_(l):new D_(l),p=d.getCustomSetupFunc(a);return e.runWebGLProgram(d,[o],o.dtype,p)}return e.uploadToGPU(o.dataId),Bxe(o,a,l,e)}var z8={kernelName:Gc,backendName:"webgl",kernelFunc:Dl};var zxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;C.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((b,I)=>b*I),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=[],m=de({inputs:{x:o},backend:e,attrs:{shape:l}}),h=Xt({inputs:{x:m},backend:e,attrs:{perm:c}}),g=de({inputs:{x:h},backend:e,attrs:{shape:u}}),x=Dl({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(m),f.push(h),f.push(g),f.forEach(b=>e.disposeIntermediateTensorInfo(b)),x},U8={kernelName:fc,backendName:"webgl",kernelFunc:zxe};function Uxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),c=a_(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var j8={kernelName:Bb,backendName:"webgl",kernelFunc:Uxe};var jxe="return float(a != b);",pR=St({opSnippet:jxe,dtype:"bool"}),G8={kernelName:Ed,backendName:"webgl",kernelFunc:pR};function Nl(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return gn({inputs:{x:o.complexTensorInfos.real},backend:e})}var W8={kernelName:sm,backendName:"webgl",kernelFunc:Nl};var Gxe="return float(int(x));";function H8(t,n){let e=new Vr(t.shape,Gxe),r=n.runWebGLProgram(e,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function fR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return gn({inputs:{x:o},backend:e});let s=Wt(o.shape),a=fR({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Yr({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=Nl({inputs:{input:o},backend:e}),a=fR({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!C.hasEncodingLoss(o.dtype,i)){let s=gn({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32")return H8(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",C.getTypedArrayFromDType("bool",1)),l=pR({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var q8={kernelName:ws,backendName:"webgl",kernelFunc:fR};var K8="return ceil(x);",Wxe=_e({opSnippet:K8,packedOpSnippet:K8,cpuKernelImpl:hq}),X8={kernelName:_a,backendName:"webgl",kernelFunc:Wxe};var k_=class{constructor(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};var A_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};function Hxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{clipValueMin:i,clipValueMax:s}=r,a;H().getBool("WEBGL_PACK_CLIP")?a=new A_(o.shape):a=new k_(o.shape);let l=a.getCustomSetupFunc(i,s);return e.runWebGLProgram(a,[o],o.dtype,l)}var Y8={kernelName:Ia,backendName:"webgl",kernelFunc:Hxe};var R_=class{constructor(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function Z8(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}}function qxe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=e.texData.get(r.dataId),i=new R_(r.shape),s=[Z8(r,o.complexTensorInfos.real),Z8(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var Q8={kernelName:mc,backendName:"webgl",kernelFunc:qxe};var M_=class{constructor(n){this.outputShape=[],this.outputShape=T.computeOutShape(n,1),this.variableNames=n.map((s,a)=>`T${a}`);let e=new Array(n.length-1);e[0]=n[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+n[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var O_=class{constructor(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(n,e);let r=this.outputShape,o=r.length,i=qe(o),s=hn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=n.map((h,g)=>`T${g}`);let l=new Array(n.length-1);l[0]=n[0][e];for(let h=1;h<l.length;h++)l[h]=l[h-1]+n[h][e];let c=a[e],u=a.slice(-2),d=a.join(),p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let h=1;h<l.length;h++){let g=l[h-1];p+=`
        if (${c} < ${l[h]}  && ${c} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${F_(a,c,g)}),
            vec2(${F_(u,c,g)}));
        }`}let f=l.length,m=l[l.length-1];p+=`
        return getChannel(
          getT${f}(${F_(a,c,m)}),
          vec2(${F_(u,c,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function F_(t,n,e){let r=t.indexOf(n);return t.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function xp(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return gn({inputs:{x:o.complexTensorInfos.imag},backend:e})}var J8={kernelName:em,backendName:"webgl",kernelFunc:xp};function bp(t,n,e){let r=t[0].dtype;if(r==="complex64"){let u=t.map(h=>Nl({inputs:{input:h},backend:e})),d=t.map(h=>xp({inputs:{input:h},backend:e})),p=bp(u,n,e),f=bp(d,n,e),m=Yr({inputs:{real:p,imag:f},backend:e});return u.forEach(h=>e.disposeIntermediateTensorInfo(h)),d.forEach(h=>e.disposeIntermediateTensorInfo(h)),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}let o=e.shouldExecuteOnCPU(t);if(r==="string"&&(o=!0),o){let u=t.map(x=>{let I=[-1,C.sizeFromShape(x.shape.slice(n))];return de({inputs:{x},backend:e,attrs:{shape:I}})}),d=u.map(x=>({vals:e.readSync(x.dataId),shape:x.shape})),p=T.computeOutShape(u.map(x=>x.shape),1),f=u[0].shape[0]===1,m=gq(d,p,r,f),h=T.computeOutShape(t.map(x=>x.shape),n),g=e.makeTensorInfo(h,r,m);return u.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}if(t.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(t.length/2),d=bp(t.slice(0,u),n,e),p=bp(t.slice(u),n,e),f=bp([d,p],n,e);return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),f}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){let u=new O_(t.map(d=>d.shape),n);return e.runWebGLProgram(u,t,r)}let{tensors2D:i,outShape:s}=Kxe(t,n,e),a=new M_(i.map(u=>u.shape)),l=e.runWebGLProgram(a,i,r);i.forEach(u=>e.disposeIntermediateTensorInfo(u));let c=de({inputs:{x:l},attrs:{shape:s},backend:e});return e.disposeIntermediateTensorInfo(l),c}function Kxe(t,n,e){let r=T.computeOutShape(t.map(i=>i.shape),n);return{tensors2D:t.map(i=>de({inputs:{x:i},attrs:{shape:[-1,C.sizeFromShape(i.shape.slice(n))]},backend:e})),outShape:r}}function mR(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=C.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(c=>c.shape),i);if(C.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(c=>C.sizeFromShape(c.shape)>0);if(a.length===1)return gn({inputs:{x:a[0]},backend:e});let l=a.map(c=>c.shape);return T.assertParamsConsistent(l,i),bp(a,i,e)}var e6={kernelName:hc,backendName:"webgl",kernelFunc:mR};var ph=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4,g=n.dataFormat==="channelsLast",x=g?1:2,b=g?2:3,I=g?3:1,_="",E="";r&&(o?_=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?_=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:_=`
          float activation(float x) {
            ${r}
          }
        `,E="result = activation(result);");let S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${_}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${n.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${S}
        ${E}
        setOutput(result);
      }
    `}},P_=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let e=n.padInfo.front,r=n.padInfo.top,o=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var L_=class{constructor(n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let{filterWidth:o,inChannels:i,strideWidth:s,strideHeight:a,padInfo:l,outWidth:c,dilationWidth:u,dilationHeight:d,dataFormat:p}=r,{left:f,top:m}=l,h=i*o,g=nn(),x=p==="channelsLast",b=x?0:1,I=x?1:2,_="";for(let E=0;E<=1;E++)for(let S=0;S<=1;S++)_+=`
          blockIndex = rc.y + ${S};
          pos = rc.x + ${E};

          if(blockIndex < ${n[1]} && pos < ${n[0]}) {
            offsetY = int(blockIndex / (${c})) * ${a} - ${m};
            d0 = offsetY + ${d} * (pos / ${h});

            if(d0 < ${e[b]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${c}.) * ${s}. - ${f}.);
              d1 = offsetX + ${u} * (int(mod(float(pos), ${h}.) / ${i}.));

              if(d1 < ${e[I]} && d1 >= 0) {

                ch = int(mod(float(pos), ${i}.));

                if (${x}) {
                  innerDims = vec2(d1, ch);
                  result[${E*2+S}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${E*2+S}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${_}

        ${g.output} = result;
      }
    `}};function $_({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=t.shape,c=r.texData.get(t.dataId),u=e.inChannels,d=l[0]*l[1]*l[2],p=e.outChannels,f=e.dataFormat==="channelsLast",m=!1,h=!1,g,x=[],b=(d===1||p===1)&&u>uR,I=l[2]%2!==0&&!!c.isPacked;if(b||!H().getBool("WEBGL_LAZILY_UNPACK")||!H().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!I){let _=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],E=de({inputs:{x:t},backend:r,attrs:{shape:[1,_,e.inChannels]}}),S=de({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=vp({a:E,b:S,transposeA:m,transposeB:h,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=de({inputs:{x:D},backend:r,attrs:{shape:e.outShape}}),x.push(E),x.push(S),x.push(D)}else{let _=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),E={dataId:t.dataId,shape:[1,_,e.inChannels],dtype:t.dtype},S=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,C.assert(mp(c.shape,E.shape),()=>`packed reshape ${c.shape} to ${E.shape} isn't free`);let D=de({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});x.push(D);let M=vp({a:E,b:D,backend:r,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),R=r.texData.get(M.dataId);C.assert(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=S,R.shape=e.outShape,g=gn({inputs:{x:M},backend:r}),g.shape=e.outShape,x.push(M)}for(let _ of x)r.disposeIntermediateTensorInfo(_);return g}function V_({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:p,dataFormat:f}=e,m=f==="channelsLast",h=l*c*u,g=p*d,x=[h,g],b=!0,I=!1,_=[],E=de({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),S=de({inputs:{x:n},backend:r,attrs:{shape:[1,h,C.sizeFromShape(n.shape)/h]}});_.push(E),_.push(S);let D=new L_(x,E.shape,e),M=r.runWebGLProgram(D,[E],"float32"),R=de({inputs:{x:M},backend:r,attrs:{shape:[1,x[0],x[1]]}});_.push(M),_.push(R);let L=o!=null,G=i!=null,W=a==="leakyrelu",q=a?bu(a,!0):null,X=new dh(R.shape,S.shape,[1,g,e.outChannels],b,I,L,q,G,W),K=[R,S];if(o&&K.push(o),G&&K.push(i),W){let ie=r.makeTensorInfo([],"float32",C.createScalarValue(s,"float32"));K.push(ie),_.push(ie)}let Z=r.runWebGLProgram(X,K,"float32"),ae=m?[1,p,d,e.outChannels]:[1,e.outChannels,p,d],ee=de({inputs:{x:Z},backend:r,attrs:{shape:ae}});_.push(Z);for(let ie of _)r.disposeIntermediateTensorInfo(ie);return ee}function Xxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=$_({x:o,filter:i,convInfo:p,backend:e});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)f=V_({x:o,filter:i,convInfo:p,backend:e});else{let h=new ph(p);f=e.runWebGLProgram(h,[o,i],"float32")}let m=de({inputs:{x:f},backend:e,attrs:{shape:p.outShape}});return e.disposeIntermediateTensorInfo(f),m}var t6={kernelName:gc,backendName:"webgl",kernelFunc:Xxe};var B_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              if (${s}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},z_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,l=r-1-n.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${n.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},U_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yF = 0; yF < ${n.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${n.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${n.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${n.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},j_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=e-1-n.padInfo.front,c=r-1-n.padInfo.top,u=o-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${n.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${n.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Yxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new B_(p);return e.runWebGLProgram(f,[o,i],"float32")}var n6={kernelName:Gf,backendName:"webgl",kernelFunc:Yxe};function Zxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(c),p=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d),f=new z_(p);return e.runWebGLProgram(f,[o,i],"float32")}var r6={kernelName:yc,backendName:"webgl",kernelFunc:Zxe};function Qxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),u=new P_(c);return e.runWebGLProgram(u,[o,i],"float32")}var o6={kernelName:vc,backendName:"webgl",kernelFunc:Qxe};function Jxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r,c=T.computeConv3DInfo(o.shape,l,s,1,a),u=new U_(c);return e.runWebGLProgram(u,[o,i],"float32")}var i6={kernelName:Wf,backendName:"webgl",kernelFunc:Jxe};function ebe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r,c=T.computeConv3DInfo(l,i.shape,a,1,s),u=new j_(c);return e.runWebGLProgram(u,[o,i],"float32")}var s6={kernelName:Hf,backendName:"webgl",kernelFunc:ebe};var tbe=m_+`
  return cos(x);
`,nbe=_e({opSnippet:tbe}),a6={kernelName:Ea,backendName:"webgl",kernelFunc:nbe};var rbe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,obe=_e({opSnippet:rbe}),l6={kernelName:Sa,backendName:"webgl",kernelFunc:obe};var G_=class{constructor(n,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,c]=n,[u]=e,[d,p]=r;this.outputShape=[u,d,p,c];let f=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[g,x,b]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[I,_,E]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${_};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${E};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var ibe=t=>{let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,u=new G_(o.shape,i.shape,a,l,c);return e.runWebGLProgram(u,[o,i,s],"float32")},c6={kernelName:zb,backendName:"webgl",kernelFunc:ibe};var d0=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=n;let o=n.length,i=e?"0.0":`getX(${u6(o,"coords")})`,s=n[n.length-1],a="",l="";e?(a=r?`end != ${s-1}`:"end != 0",l=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${s}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${qe(o)} coords = getOutputCoords();
        int end = ${d6(o,"coords")};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${l};
          ${d6(o,"coords")} = idx;
          val += getX(${u6(o,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.index==null&&(this.index=e.getUniformLocation(r,"index")),e.gl.uniform1f(this.index,n)}}};function u6(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.x, ${n}.y`;if(t===3)return`${n}.x, ${n}.y, ${n}.z`;if(t===4)return`${n}.x, ${n}.y, ${n}.z, ${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function d6(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.y`;if(t===3)return`${n}.z`;if(t===4)return`${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function sbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r,l=o.shape.length,c=T.getAxesPermutation([i],l),u=o;c!=null&&(u=Xt({inputs:{x:o},backend:e,attrs:{perm:c}}));let d=T.getInnerMostAxes(1,l)[0];if(d!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${o.shape.length-1} but got axis=${i}`);let p=u.shape[d],f=gn({inputs:{x:u},backend:e});for(let m=0;m<=Math.ceil(Math.log2(p))-1;m++){let h=new d0(u.shape,!1,a),g=h.getCustomSetupFunc(m),x=f;f=e.runWebGLProgram(h,[f],f.dtype,g),e.disposeIntermediateTensorInfo(x)}if(s){let m=new d0(u.shape,s,a),h=f;f=e.runWebGLProgram(m,[f],f.dtype),e.disposeIntermediateTensorInfo(h)}if(c!=null){let m=T.getUndoAxesPermutation(c),h=Xt({inputs:{x:f},backend:e,attrs:{perm:m}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(u),h}return f}var p6={kernelName:xc,backendName:"webgl",kernelFunc:sbe};function abe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=a_(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=mq(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var f6={kernelName:Ub,backendName:"webgl",kernelFunc:abe};var W_=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function lbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;C.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),m=s==="NHWC"?[a,d,p,f]:[a,f,d,p],h=new W_(m,i,s);return e.runWebGLProgram(h,[o],o.dtype)}var m6={kernelName:qf,backendName:"webgl",kernelFunc:lbe};var fh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.inHeight,a=n.inWidth,l=n.padInfo.top,c=n.padInfo.left,u=n.strideHeight,d=n.strideWidth,p=n.dilationHeight,f=n.dilationWidth,m=n.filterHeight,h=n.filterWidth,g=n.outChannels/n.inChannels,x="",b="";r&&(o?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`
          float activation(float x) {
            ${r}
          }
        `,b="result = activation(result);");let I=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${u}, ${d});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${g};
        int q = d2 - d1 * ${g};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${s}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${a}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${I}
        ${b}
        setOutput(result);
      }
    `}};var mh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;let s=n.outChannels/n.inChannels,a=n.inHeight,l=n.inWidth,c=n.padInfo.top,u=n.padInfo.left,d=n.strideHeight,p=n.strideWidth,f=n.dilationHeight,m=n.dilationWidth,h=n.filterHeight,g=n.filterWidth,x=g,b=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let S=0;S<g;S++)b+=`
          vec4 xTexelC${S*2};
          int xTexelC${S*2}Ready;
          vec4 xC${S};`;for(let S=0;S<h;S++){for(let D=0;D<g;D++)b+=`
          xTexelC${D*2} = vec4(0.0);
          xTexelC${D*2}Ready = 0;
          xC${D} = vec4(0.0);`;b+=`
        xR = xRCorner + ${S*f};
        if (xR >=0 && xR < ${a}) {
      `;for(let D=0;D<(x+1)/2;D++){let M=D*2,R=M*m;if(b+=`
          xC = xCCorner + ${R};
          `,p===1){if(M<g&&(u%2===1?(b+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }
              `,m===1&&R>0?b+=`
                xC${M} = vec4(xTexelC${R-2}.zw, xTexelC${R}.xy);
                `:b+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < ${l}) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      previous.zw = vec2(0.0);
                    }

                    xC${M} = vec4(previous.zw, xTexelC${R}.xy);
                  } else {
                    xC${M} = vec4(0.0, 0.0, xTexelC${R}.xy);
                  }
                  `):b+=`
                if (xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xC${M} = xTexelC${R};
                `,R+1<g)){let L=u%2===0?C.nearestLargerEven(m):m;m%2===0&&u%2===1||m%2!==0&&u%2!==1?(b+=`
                  xCOffset = xC + ${u%2} + ${L};

                  if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                    xTexelC${R+2} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      xTexelC${R+2}.zw = vec2(0.0);
                    }
                    xTexelC${R+2}Ready = 1;
                  }
                  `,m>1&&(b+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                      xTexelC${R} = getX(batch, xR, xCOffset, d1);
                      xTexelC${R}Ready = 1;
                    }
                    `),b+=`
                  xC${M+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.xy);
                  `):L===1?b+=`
                    xC${M+1} = xTexelC${R};
                    `:b+=`
                    xCOffset = xC + ${L};

                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                      xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= ${l}) {
                        xTexelC${R+2}.zw = vec2(0.0);
                      }
                      xTexelC${R+2}Ready = 1;
                    }

                    xC${M+1} = xTexelC${R+2};
                    `}}else R<g&&(u%2===1?(b+=`
                xCOffset = xC + 1 - ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.0);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${M} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
              `,R+1<g&&(b+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + ${p};
                  if(xCOffset >= 0 && xCOffset < ${l}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${M+1} = vec4(xTexelC${R+2}.xy, final.xy);
                `)):(b+=`
                if(xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xCOffset = xC + ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${M} = vec4(
                  xTexelC${R}.xy, xTexelC${R+2}.xy);
              `,R+1<g&&(b+=`
                  xC${M+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
                `)));M<g&&(b+=`
            wTexel = getW(${S}, ${R}, d1, q);
            dotProd += xC${M} * vec4(wTexel.xz, wTexel.xz);
          `,R+1<g&&(b+=`
              wTexel = getW(${S}, ${R+1}, d1, q);
              dotProd += xC${M+1} * vec4(wTexel.xz, wTexel.xz);
            `))}b+=`
        }
      `}let I="",_="";r&&(o?I=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?I=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:I=`vec4 activation(vec4 x) {
          ${r}
        }`,_="result = activation(result);");let E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${d}, ${p});
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${b}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${E}
        ${_}
        setOutput(result);
      }
    `}};function cbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r,u=l;u==null&&(u=[1,1]),C.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let d=T.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!0),p;return H().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new mh(d):p=new fh(d),e.runWebGLProgram(p,[o,i],"float32")}var h6={kernelName:bc,backendName:"webgl",kernelFunc:cbe};var H_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},q_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,a=r-1-n.padInfo.left,l=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function ube(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new H_(d);return e.runWebGLProgram(p,[o,i],"float32")}var g6={kernelName:Kf,backendName:"webgl",kernelFunc:ube};function dbe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new q_(d);return e.runWebGLProgram(p,[o,i],"float32")}var y6={kernelName:Xf,backendName:"webgl",kernelFunc:dbe};var K_=class{constructor(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function pbe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=[...r.shape,...r.shape],i=C.sizeFromShape(r.shape),s=de({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new K_(i),l=e.runWebGLProgram(a,[s],s.dtype),c=de({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),c}var v6={kernelName:jb,backendName:"webgl",kernelFunc:pbe};var X_=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=n,{top:d,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function fbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u,d=new X_(c);u=e.runWebGLProgram(d,[o,i],"float32");let p=de({inputs:{x:u},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(u),p}var x6={kernelName:wc,backendName:"webgl",kernelFunc:fbe};function mbe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:x,expandDims:b}=T.getEinsumPermutation(f,l[g]),I;T.isIdentityPermutation(x)?I=i[g]:(I=Xt({inputs:{x:i[g]},backend:e,attrs:{perm:x}}),m.push(I));let _=I.shape.slice();for(let E=0;E<b.length;++E)_.splice(b[E],0,1);C.arraysEqual(I.shape,_)||(I=de({inputs:{x:I},backend:e,attrs:{shape:_}}),m.push(I)),p===null?p=I:(p=c0({inputs:{a:I,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=yp({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var b6={kernelName:Gb,backendName:"webgl",kernelFunc:mbe};var hbe="return (x >= 0.0) ? x : (exp(x) - 1.0);",gbe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ybe=_e({opSnippet:hbe,packedOpSnippet:gbe}),w6={kernelName:Da,backendName:"webgl",kernelFunc:ybe};var vbe="return (b >= 1.0) ? a : a * (b + 1.0);",xbe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,bbe=t=>{let{inputs:n,backend:e}=t,{dy:r,y:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ei(xbe,r.shape,o.shape):new Wo(vbe,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},C6={kernelName:Yf,backendName:"webgl",kernelFunc:bbe};var wbe=`
  return vec4(equal(a, b));
`,Cbe="return float(a == b);",_be=St({opSnippet:Cbe,packedOpSnippet:wbe,dtype:"bool"}),_6={kernelName:vd,backendName:"webgl",kernelFunc:_be};var Ibe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Ebe=_e({opSnippet:Ibe}),I6={kernelName:Na,backendName:"webgl",kernelFunc:Ebe};var E6="return exp(x);",hR=_e({opSnippet:E6,packedOpSnippet:E6,cpuKernelImpl:yq}),S6={kernelName:ka,backendName:"webgl",kernelFunc:hR};function Y_(t){let{inputs:n,attrs:e,backend:r}=t,{dim:o}=e,{input:i}=n,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(C.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),de({inputs:{x:i},backend:r,attrs:{shape:a}})}var T6={kernelName:Cc,backendName:"webgl",kernelFunc:Y_};var D6="return exp(x) - 1.0;",Sbe=_e({opSnippet:D6,packedOpSnippet:D6,cpuKernelImpl:vq}),N6={kernelName:Aa,backendName:"webgl",kernelFunc:Sbe};var p0=class{constructor(n,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(n==="real")a="return real * expR - imag * expI;";else if(n==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${n}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function Z_(t,n,e){let r=e.texData.get(t.dataId),o=C.sizeFromShape(t.shape),i=t.shape[t.shape.length-1],s=o/i,a=de({inputs:{x:t},backend:e,attrs:{shape:[s,i]}}),l=a.shape,c=new p0("real",l,n),u=new p0("imag",l,n),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Yr({inputs:{real:p,imag:f},backend:e});e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f);let h=de({inputs:{x:m},backend:e,attrs:{shape:t.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(m),h}function Tbe(t){let{inputs:n,backend:e}=t,{input:r}=n;return Z_(r,!1,e)}var k6={kernelName:Zf,backendName:"webgl",kernelFunc:Tbe};var Q_=class{constructor(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};function f0(t){let{backend:n,attrs:e}=t,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||C.inferDtype(o),i==="string"){let s=C.getArrayFromDType(i,C.sizeFromShape(r));return s.fill(o),n.makeTensorInfo(r,i,s)}else{let s=new Q_(r,o),a=s.getCustomSetupFunc(o);return n.runWebGLProgram(s,[],i,a)}}var A6={kernelName:Qf,backendName:"webgl",kernelFunc:f0};var J_=class{constructor(n){this.variableNames=["Image"],this.outputShape=[];let e=n[2];this.outputShape=n,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var R6={kernelName:Wb,backendName:"webgl",kernelFunc:({inputs:t,backend:n})=>{let{image:e}=t,r=n,o=new J_(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var M6="return floor(x);",Dbe=_e({opSnippet:M6,packedOpSnippet:M6,cpuKernelImpl:xq}),F6={kernelName:Ra,backendName:"webgl",kernelFunc:Dbe};var Nbe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,kbe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,Abe=St({opSnippet:Nbe,packedOpSnippet:kbe,dtype:"int32"}),O6={kernelName:Ma,backendName:"webgl",kernelFunc:Abe};var eI=class{constructor(n){this.variableNames=["A"];let e=nn(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var tI=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=nn(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var P6={kernelName:MV,backendName:"webgl",kernelFunc:Rbe},hh;function Rbe(t){let{inputs:n,backend:e,attrs:r}=t,{pixels:o}=n,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,i];(a||s)&&(hh==null&&(hh=document.createElement("canvas").getContext("2d")),hh.canvas.width=l,hh.canvas.height=c,hh.drawImage(o,0,0,l,c),o=hh.canvas);let p=e.makeTensorInfo(u,"int32");e.texData.get(p.dataId).usage=Tr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);let f=H().getBool("WEBGL_PACK")?new tI(d):new eI(d),m=e.runWebGLProgram(f,[p],"int32");return e.disposeData(p.dataId),m}function Mbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=T.convertConv2DDataFormat(u),g=T.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,h),x,b=[];if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))x=$_({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)x=V_({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{let _=s!=null,E=a!=null,S=f==="leakyrelu",D=f?bu(f,!1):null,M=new ph(g,_,D,E,S),R=[o,i];if(s&&R.push(s),a&&R.push(a),S){let L=e.makeTensorInfo([],"float32",C.createScalarValue(m,"float32"));R.push(L),b.push(L)}x=e.runWebGLProgram(M,R,"float32")}let I=de({inputs:{x},backend:e,attrs:{shape:g.outShape}});return b.push(x),b.forEach(_=>e.disposeIntermediateTensorInfo(_)),I}var L6={kernelName:Td,backendName:"webgl",kernelFunc:Mbe};function Fbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[],h=u;h==null&&(h=[1,1]),C.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let g=T.computeConv2DInfo(o.shape,i.shape,l,h,c,d,!0),x=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=p?bu(p,x):null,I=[o,i],_=s!=null,E=a!=null,S=p==="leakyrelu";if(_&&I.push(s),E&&I.push(a),S){let R=e.makeTensorInfo([],"float32",C.createScalarValue(f,"float32"));I.push(R),m.push(R)}let D;x?D=new mh(g,_,b,E,S):D=new fh(g,_,b,E,S);let M=e.runWebGLProgram(D,I,"float32");return m.forEach(R=>e.disposeIntermediateTensorInfo(R)),M}var $6={kernelName:Dd,backendName:"webgl",kernelFunc:Fbe};var nI=class{constructor(n,e,r){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;let o=qe(e.length),i=qe(r.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${o} strides = ${o}(${this.strides});
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${s};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}};function Obe(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=o.shape,s=i[i.length-1],[a,l,c,u]=T.prepareAndValidate(r,o),d=de({inputs:{x:o},backend:e,attrs:{shape:[l,s]}}),p=de({inputs:{x:r},backend:e,attrs:{shape:[C.sizeFromShape(r.shape)/c,c]}}),f=new nI(s,u,[l,c]),m=e.runWebGLProgram(f,[p,d],p.dtype),h=de({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),h}var V6={kernelName:Hb,backendName:"webgl",kernelFunc:Obe};var rI=class{constructor(n,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=qe(this.rank),o=Pbe(n,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}};function Pbe(t,n){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<t.length;o++)o===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${e[o]}`);return r.join()}function Lbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r,l=C.parseAxisParam(s,o.shape)[0],c=T.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=C.sizeFromShape(i.shape),d=[],p=de({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=de({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let m=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let b=e.bufferSync(f),I=e.bufferSync(p),_=bq(I,b,m);return d.forEach(E=>e.disposeIntermediateTensorInfo(E)),e.makeTensorInfo(c.outputShape,_.dtype,_.values)}let h=new rI(p.shape,m),g=e.runWebGLProgram(h,[p,f],p.dtype);d.push(g);let x=de({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(b=>e.disposeIntermediateTensorInfo(b)),x}var B6={kernelName:Ic,backendName:"webgl",kernelFunc:Lbe};var $be="return float(a > b);",Vbe=`
  return vec4(greaterThan(a, b));
`,Bbe=St({opSnippet:$be,packedOpSnippet:Vbe,cpuKernelImpl:wq,dtype:"bool"}),z6={kernelName:xd,backendName:"webgl",kernelFunc:Bbe};var zbe="return float(a >= b);",Ube=`
  return vec4(greaterThanEqual(a, b));
`,jbe=St({opSnippet:zbe,packedOpSnippet:Ube,dtype:"bool"}),U6={kernelName:Fa,backendName:"webgl",kernelFunc:jbe};function Gbe(t){let{inputs:n,backend:e}=t,{input:r}=n;return Z_(r,!0,e)}var j6={kernelName:Jf,backendName:"webgl",kernelFunc:Gbe};var Wbe="return float(!isnan(x) && !isinf(x));",Hbe=_e({opSnippet:Wbe,dtype:"bool"}),G6={kernelName:Oa,backendName:"webgl",kernelFunc:Hbe};var qbe="return float(isinf(x));",Kbe=_e({opSnippet:qbe,dtype:"bool"}),W6={kernelName:Pa,backendName:"webgl",kernelFunc:Kbe};var Xbe="return float(isnan(x));",Ybe=_e({opSnippet:Xbe,dtype:"bool"}),H6={kernelName:La,backendName:"webgl",kernelFunc:Ybe};var Zbe="return float(a < b);",Qbe=`
  return vec4(lessThan(a, b));
`,Jbe=St({opSnippet:Zbe,packedOpSnippet:Qbe,cpuKernelImpl:Cq,dtype:"bool"}),q6={kernelName:bd,backendName:"webgl",kernelFunc:Jbe};var ewe="return float(a <= b);",twe=`
  return vec4(lessThanEqual(a, b));
`,nwe=St({opSnippet:ewe,packedOpSnippet:twe,dtype:"bool"}),K6={kernelName:wd,backendName:"webgl",kernelFunc:nwe};function rwe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=_q(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var X6={kernelName:qb,backendName:"webgl",kernelFunc:rwe};var owe=`if (x < 0.0) return NAN;
  return log(x);`,iwe=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,swe=_e({opSnippet:owe,packedOpSnippet:iwe,cpuKernelImpl:Iq}),Y6={kernelName:$a,backendName:"webgl",kernelFunc:swe};var awe="return log(1.0 + x);",lwe=_e({opSnippet:awe}),Z6={kernelName:Va,backendName:"webgl",kernelFunc:lwe};var cwe="return float(a >= 1.0 && b >= 1.0);",uwe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,dwe=St({opSnippet:cwe,packedOpSnippet:uwe,dtype:"bool"}),Q6={kernelName:Cd,backendName:"webgl",kernelFunc:dwe};var pwe="return float(!(x >= 1.0));",fwe=_e({opSnippet:pwe}),J6={kernelName:_d,backendName:"webgl",kernelFunc:fwe};var mwe="return float(a >= 1.0 || b >= 1.0);",hwe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,gwe=St({opSnippet:mwe,packedOpSnippet:hwe,dtype:"bool"}),eK={kernelName:Id,backendName:"webgl",kernelFunc:gwe};var oI=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var iI=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var ywe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c=H().getBool("WEBGL_PACK_NORMALIZATION")?new iI(o.shape,i,s,a,l):new oI(o.shape,i,s,a,l);return e.runWebGLProgram(c,[o],o.dtype)},tK={kernelName:Sc,backendName:"webgl",kernelFunc:ywe};var sI=class{constructor(n,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var vwe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new sI(o.shape,a,l,c,u);return e.runWebGLProgram(d,[o,i,s],o.dtype)},nK={kernelName:tm,backendName:"webgl",kernelFunc:vwe};function rK(t,n,e,r){let o=C.sizeFromShape(n),s=C.sizeFromShape(t.shape)/o,a=de({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=bo(a,t.dtype,"max",r),c=de({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function gR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=C.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=e.shouldExecuteOnCPU([o]),f=o;if(d){if(p){let I=e.texData.get(f.dataId).values,_=new Array(a);for(let D=0;D<_.length;D++)_[D]=o.shape[u[D]];let E=gp(I,o.shape,o.dtype,u,_);f=e.makeTensorInfo(_,o.dtype);let S=e.texData.get(f.dataId);S.values=E}else f=wu(o,u,e);c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("max",c,a);let[m,h]=T.computeOutAndReduceShapes(f.shape,c),g=m;s&&(g=T.expandShapeToKeepDim(m,l));let x;if(p){let I=e.texData.get(f.dataId).values,_=Eq(I,C.sizeFromShape(h),g,o.dtype);x=e.makeTensorInfo(g,o.dtype);let E=e.texData.get(x.dataId);E.values=_}else x=rK(f,h,g,e);return d&&e.disposeIntermediateTensorInfo(f),x}var oK={kernelName:Tc,backendName:"webgl",kernelFunc:gR};var xwe=f_+`
  return max(a, b);
`,bwe=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+xu+`
  return result;
`,wwe=St({opSnippet:xwe,packedOpSnippet:bwe,cpuKernelImpl:Sq}),iK={kernelName:Ba,backendName:"webgl",kernelFunc:wwe};function Cwe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Os(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;C.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&C.arraysEqual(u.inShape,u.outShape))return gn({inputs:{x:o},backend:e});let d=new ts(u,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}var sK={kernelName:Dc,backendName:"webgl",kernelFunc:Cwe};function _we(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new Cu(d,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var aK={kernelName:Nc,backendName:"webgl",kernelFunc:_we};var aI=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideHeight,r=n.strideWidth,o=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,a=i-1-n.padInfo.top,l=s-1-n.padInfo.left,c=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},lI=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterDepth,c=n.effectiveFilterHeight,u=n.effectiveFilterWidth,d=l-1-n.padInfo.front,p=c-1-n.padInfo.top,f=u-1-n.padInfo.left,m=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Iwe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new Cu(p,"max",!0),m=e.runWebGLProgram(f,[s],s.dtype),h=new lI(p),g=e.runWebGLProgram(h,[o,m],s.dtype);return e.disposeIntermediateTensorInfo(m),g}var lK={kernelName:rm,backendName:"webgl",kernelFunc:Iwe};function Ewe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;Os([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=!0,m=new ts(p,"max",f),h=e.runWebGLProgram(m,[a],a.dtype),g=new aI(p),x=e.runWebGLProgram(g,[o,h],a.dtype);return e.disposeIntermediateTensorInfo(h),x}var cK={kernelName:nm,backendName:"webgl",kernelFunc:Ewe};function uK(t,n,e,r){let o=new ts(e,"max",!1),i=r.runWebGLProgram(o,[t],"float32");o=new ts(e,"max",!0,!0,n);let s=r.runWebGLProgram(o,[t],"float32");return[i,s]}var dK={kernelName:Kb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;C.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];C.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=T.computePool2DInfo(r.shape,o,i,c,s),[d,p]=uK(r,a,u,l);return[d,p]}};function pK(t,n,e,r){let o=C.sizeFromShape(n),s=C.sizeFromShape(t.shape)/o,a=de({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=bo(a,"float32","mean",r),c=de({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}var fK={kernelName:kc,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{keepDims:o,axis:i}=n,s=e,a=r.shape.length,l=C.parseAxisParam(i,r.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=s.shouldExecuteOnCPU([r]),f=[],m=r;if(d){if(p){let _=s.texData.get(m.dataId).values,E=new Array(a);for(let M=0;M<E.length;M++)E[M]=r.shape[u[M]];let S=gp(_,r.shape,r.dtype,u,E);m=s.makeTensorInfo(E,r.dtype);let D=s.texData.get(m.dataId);D.values=S}else m=wu(r,u,s);f.push(m),c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("sum",c,a);let[h,g]=T.computeOutAndReduceShapes(m.shape,c),x=h;o&&(x=T.expandShapeToKeepDim(h,l));let b=pK(m,g,x,s);for(let I of f)s.disposeIntermediateTensorInfo(I);return b}};function Swe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=C.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=C.sizeFromShape(f),h=de({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=bo(h,h.dtype,"min",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=de({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=de({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var mK={kernelName:Ac,backendName:"webgl",kernelFunc:Swe};var Twe=f_+`
  return min(a, b);
`,Dwe=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+xu+`
  return result;
`,Nwe=St({opSnippet:Twe,packedOpSnippet:Dwe,cpuKernelImpl:Tq}),hK={kernelName:za,backendName:"webgl",kernelFunc:Nwe};var cI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((u,d)=>u[0]+n[d]+u[1]);let o=n.length,i=qe(o),s=e.map(u=>u[0]).join(","),a=e.map((u,d)=>u[0]+n[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var uI=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,h)=>m[0]+n[h]+m[1]);let o=n.length,i=qe(o),s=e.map(m=>m[0]).join(","),a=e.map((m,h)=>m[0]+n[h]).join(","),l=hn("rc",o),c=hn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1,f="";if(o===1){let m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{let m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var kwe=({inputs:t,backend:n,attrs:e})=>{let{x:r}=t,{paddings:o,mode:i}=e,s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uI(r.shape,o,i):new cI(r.shape,o,i);return n.runWebGLProgram(s,[r],r.dtype)},gK={kernelName:Rc,backendName:"webgl",kernelFunc:kwe};var Awe=`if (b == 0.0) return NAN;
  return mod(a, b);`,Rwe=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+xu+`
  return result;
`,Mwe=St({opSnippet:Awe,packedOpSnippet:Rwe}),yK={kernelName:Ua,backendName:"webgl",kernelFunc:Mwe};var dI=class{constructor(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.seedLoc==null&&(this.seedLoc=e.getUniformLocation(r,"seed")),e.gl.uniform1f(this.seedLoc,n)}}};var Fwe=`
if (a == b) {
  return 1.0;
};
return a / b;`,Owe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,yR=St({opSnippet:Fwe,packedOpSnippet:Owe,checkOutOfBounds:!0}),vK={kernelName:Ta,backendName:"webgl",kernelFunc:yR};var xK="return a - b;",vR=St({opSnippet:xK,packedOpSnippet:xK,supportsComplex:!0,cpuKernelImpl:Lq}),bK={kernelName:ol,backendName:"webgl",kernelFunc:vR};function xR(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=C.parseAxisParam([i],o.shape),a=gR({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,s),c=de({inputs:{x:a},backend:e,attrs:{shape:l}}),u=vR({inputs:{a:o,b:c},backend:e}),d=hR({inputs:{x:u},backend:e}),p=yp({inputs:{x:d},backend:e,attrs:{axis:s,keepDims:!1}}),f=de({inputs:{x:p},backend:e,attrs:{shape:l}}),m=yR({inputs:{a:d,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}var wK={kernelName:Kc,backendName:"webgl",kernelFunc:xR};function Pwe(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r,l=a?o:xR({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new dI(c,u,i),p=d.getCustomSetupFunc(s),f=e.runWebGLProgram(d,[l],"int32",p);return a||e.disposeIntermediateTensorInfo(l),f}var CK={kernelName:Xb,backendName:"webgl",kernelFunc:Pwe};var _K="return -x;";function Lwe(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=Nq(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new Ii(r.shape,_K):o=new Vr(r.shape,_K),e.runWebGLProgram(o,[r],r.dtype)}var IK={kernelName:Mc,backendName:"webgl",kernelFunc:Lwe};var $we=dr.nonMaxSuppressionV3Impl;function Vwe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=$we(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var EK={kernelName:Yb,backendName:"webgl",kernelFunc:Vwe};var Bwe=dr.nonMaxSuppressionV4Impl;function zwe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=Bwe(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var SK={kernelName:Zb,backendName:"webgl",kernelFunc:zwe};var Uwe=dr.nonMaxSuppressionV5Impl;function jwe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:x}=Uwe(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var TK={kernelName:Qb,backendName:"webgl",kernelFunc:jwe};var pI=class{constructor(n,e,r,o){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var Gwe=t=>{let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r,l=C.sizeFromShape(o.shape),c=new pI(l,i,s,a),u=de({inputs:{x:o},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[u],o.dtype);e.disposeIntermediateTensorInfo(u);let p=[...o.shape,i],f=de({inputs:{x:d},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(d),f},DK={kernelName:Oc,backendName:"webgl",kernelFunc:Gwe};function m0(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="complex64"){let o=Nl({inputs:{input:r},backend:e}),i=m0({inputs:{x:o},backend:e}),s=xp({inputs:{input:r},backend:e}),a=m0({inputs:{x:s},backend:e}),l=Yr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return f0({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var NK={kernelName:Qc,backendName:"webgl",kernelFunc:m0};function kK(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=Nl({inputs:{input:r},backend:e}),i=kK({inputs:{x:o},backend:e}),s=xp({inputs:{input:r},backend:e}),a=m0({inputs:{x:s},backend:e}),l=Yr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return f0({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var AK={kernelName:Fc,backendName:"webgl",kernelFunc:kK};function Wwe(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return Y_({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{C.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),C.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=Y_({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=mR({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var RK={kernelName:Pc,backendName:"webgl",kernelFunc:Wwe};var fI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((c,u)=>c[0]+n[u]+c[1]);let o=n.length,i=qe(o),s=e.map(c=>c[0]).join(","),a=e.map((c,u)=>c[0]+n[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};
        uniform float value;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var mI=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,g)=>h[0]+n[g]+h[1]);let o=n.length,i=qe(o),s=e.map(h=>h[0]).join(","),a=e.map((h,g)=>h[0]+n[g]).join(","),l=hn("rc",o),c=hn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,g=o===1?2:4;h<g;h++)m+=`
        ${p[h]}
        if (${f}) {
          result[${h}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${h}] = getChannel(getX(${c.join()}), ${d});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var bR=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r,a=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mI(o.shape,i,s):new fI(o.shape,i,s),l=a.getCustomSetupFunc(s);return e.runWebGLProgram(a,[o],o.dtype,l)},MK={kernelName:Lc,backendName:"webgl",kernelFunc:bR};var Hwe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,qwe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+xu+`
  return result;
`,Kwe=St({opSnippet:Hwe,packedOpSnippet:qwe}),FK={kernelName:Ga,backendName:"webgl",kernelFunc:Kwe};function Xwe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],c=C.parseAxisParam(i,o.shape),u=c,d=T.getAxesPermutation(u,a),p=o;d!=null&&(p=Xt({inputs:{x:o},backend:e,attrs:{perm:d}}),u=T.getInnerMostAxes(u.length,a),l.push(p)),T.assertAxesAreInnerMostDims("prod",u,a);let f;if(e.shouldExecuteOnCPU([p])){let m=e.texData.get(p.dataId).values,{outVals:h,outShape:g,outDtype:x}=kq(p.shape,p.dtype,m,u);f=e.makeTensorInfo(g,x,h)}else{let[m,h]=T.computeOutAndReduceShapes(p.shape,u),g=C.sizeFromShape(h),x=de({inputs:{x:p},backend:e,attrs:{shape:[-1,g]}}),b=kd(o.dtype),I=bo(x,b,"prod",e);f=de({inputs:{x:I},backend:e,attrs:{shape:m}}),l.push(x),l.push(I)}if(s){l.push(f);let m=T.expandShapeToKeepDim(f.shape,c);f=de({inputs:{x:f},backend:e,attrs:{shape:m}})}return l.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var OK={kernelName:om,backendName:"webgl",kernelFunc:Xwe};var wR=t=>{let{backend:n,attrs:e}=t,{start:r,stop:o,step:i,dtype:s}=e,a=Aq(r,o,i,s);return n.makeTensorInfo([a.length],s,a)},PK={kernelName:im,backendName:"webgl",kernelFunc:wR};var Ywe="return 1.0 / x;",Zwe=_e({opSnippet:Ywe}),LK={kernelName:Wa,backendName:"webgl",kernelFunc:Zwe};var Qwe=qn+`
  return (x < 0.0) ? 0.0 : x;
`,Jwe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,eCe=_e({opSnippet:Qwe,packedOpSnippet:Jwe}),$K={kernelName:Ha,backendName:"webgl",kernelFunc:eCe};var tCe=qn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,nCe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,rCe=_e({opSnippet:tCe,packedOpSnippet:nCe}),VK={kernelName:qa,backendName:"webgl",kernelFunc:rCe};var hI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var gI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function oCe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new gI(o.shape,l,c,i,s):new hI(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],"float32")}var BK={kernelName:zc,backendName:"webgl",kernelFunc:oCe};var yI=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function iCe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new yI(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var zK={kernelName:lm,backendName:"webgl",kernelFunc:iCe};var vI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var xI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function sCe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new xI(o.shape,l,c,i,s):new vI(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],o.dtype)}var UK={kernelName:Bc,backendName:"webgl",kernelFunc:sCe};var bI=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function aCe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new bI(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var jK={kernelName:am,backendName:"webgl",kernelFunc:aCe};var wI=class{constructor(n,e){this.variableNames=["x"];let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=n,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${n[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&n[a]!==1?`${n[a]} - coords[${a}] - 1`:`coords[${a}]`,i=n.map((a,l)=>o(l)).join(","),s=qe(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var CI=class{constructor(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=n;let o=hn("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=qe(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${n[0]} - rc - 1),
            ${n[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${n[0]} - (rc  + 1) - 1),
                ${n[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${c(o.slice())};
          }
          if(${s}) {
            result.b = ${u(o.slice())};
            if(${i}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return p(m)}function c(m){return m[r-1]="("+m[r-1]+" + 1)",p(m)}function u(m){return m[r-2]="("+m[r-2]+" + 1)",p(m)}function d(m){return m[r-1]="("+m[r-1]+" + 1)",m[r-2]="("+m[r-2]+" + 1)",p(m)}function p(m){let h=n.map((b,I)=>f(I,m)),g=h.join(","),x=h.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function f(m,h){return e.indexOf(m)!==-1&&n[m]!==1?`${n[m]} - ${h[m]} - 1`:`${h[m]}`}}};function lCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r,s=o.shape.length,a=C.parseAxisParam(i,o.shape);if(s===0)return gn({inputs:{x:o},backend:e});let l=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new CI(o.shape,a):new wI(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var GK={kernelName:Uc,backendName:"webgl",kernelFunc:lCe};var _I=class{constructor(n,e){this.variableNames=["Image"],this.outputShape=[];let r=n[1],o=n[2];this.outputShape=n;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        uniform vec4 params;
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}getCustomSetupFunc(n,e,r,o){return(i,s)=>{this.paramsLoc==null&&(this.paramsLoc=i.getUniformLocationNoThrow(s,"params")),i.gl.uniform4f(this.paramsLoc,n,e,r,o)}}};var WK={kernelName:ow,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=new _I(r.shape,i),[c,u]=T.getImageCenter(s,r.shape[1],r.shape[2]),d=l.getCustomSetupFunc(c,u,Math.sin(o),Math.cos(o));return a.runWebGLProgram(l,[r],r.dtype,d)}};var cCe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,uCe=_e({opSnippet:cCe}),HK={kernelName:Ka,backendName:"webgl",kernelFunc:uCe};var dCe="return inversesqrt(x);",pCe=_e({opSnippet:dCe,cpuKernelImpl:Rq}),qK={kernelName:Xa,backendName:"webgl",kernelFunc:pCe};var gh=class{constructor(n,e,r,o,i,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=qe(i.length),c=qe(s.length),u="";r===1?u="i":r===2&&(u="i, j");let d=`getIndices(${u})`,p="";o===1?p="i":o===2&&(p="i, coords[1]");let f=`getUpdates(${p})`,m=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${n}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function fCe(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=de({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),m=de({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),h=e.makeTensorInfo([],"float32",new Float32Array([0])),g=new gh(l,a,f.shape.length,m.shape.length,u,p),x=e.runWebGLProgram(g,[m,f,h],m.dtype),b=de({inputs:{x},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(h),b}var KK={kernelName:Jb,backendName:"webgl",kernelFunc:fCe};var II=class{constructor(n,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<e.length;u++)c.push(`${a[u]}`),u<n&&l.push(`${a[u]}`);o=l.join(),i=c.join()}let s=qe(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function mCe(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n,s=new II(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],Fn(o.dtype,i.dtype))}var XK={kernelName:jc,backendName:"webgl",kernelFunc:mCe};var hCe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,gCe=_e({opSnippet:hCe}),YK={kernelName:Ya,backendName:"webgl",kernelFunc:gCe};var yCe="return 1.0 / (1.0 + exp(-1.0 * x));",vCe=_e({opSnippet:yCe}),ZK={kernelName:el,backendName:"webgl",kernelFunc:vCe};var xCe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,bCe=_e({opSnippet:xCe}),QK={kernelName:Ja,backendName:"webgl",kernelFunc:bCe};var wCe=m_+`
  return sin(x);
`,CCe=_e({opSnippet:wCe}),JK={kernelName:Za,backendName:"webgl",kernelFunc:CCe};var _Ce=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,ICe=_e({opSnippet:_Ce}),e9={kernelName:Qa,backendName:"webgl",kernelFunc:ICe};var ECe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,SCe=_e({opSnippet:ECe}),t9={kernelName:tl,backendName:"webgl",kernelFunc:SCe};var TCe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;C.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((x,b)=>x*b),l=[[0,0]];l.push(...s);for(let x=1+i.length;x<o.shape.length;++x)l.push([0,0]);let c=[],u=bR({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),d=T.getReshaped(u.shape,i,a,!1),p=T.getPermuted(d.length,i.length,!1),f=T.getReshapedPermuted(u.shape,i,a,!1),m=de({inputs:{x:u},backend:e,attrs:{shape:d}}),h=Xt({inputs:{x:m},backend:e,attrs:{perm:p}}),g=de({inputs:{x:h},backend:e,attrs:{shape:f}});return c.push(u),c.push(m),c.push(h),c.forEach(x=>e.disposeIntermediateTensorInfo(x)),g},n9={kernelName:Hc,backendName:"webgl",kernelFunc:TCe};function DCe(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=e.readSync(s.dataId)[0],[d,p,f,m,h]=Fq(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var r9={kernelName:ew,backendName:"webgl",kernelFunc:DCe};function NCe(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[c,u,d]=Oq(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var o9={kernelName:tw,backendName:"webgl",kernelFunc:NCe};function kCe(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,strides:u,outputSize:d}=T.calculateShapes(i,o,a),p=!1,f=new gh(c,l,o.shape.length,i.shape.length,u,[d,1],p),m=e.runWebGLProgram(f,[i,o,s],i.dtype),h=de({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),h}var i9={kernelName:nw,backendName:"webgl",kernelFunc:kCe};function ACe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=C.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let m=Dl({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,m})}var s9={kernelName:qc,backendName:"webgl",kernelFunc:ACe};var RCe="return sqrt(x);",MCe=_e({opSnippet:RCe}),a9={kernelName:nl,backendName:"webgl",kernelFunc:MCe};var FCe="return x * x;",OCe=_e({opSnippet:FCe}),l9={kernelName:cm,backendName:"webgl",kernelFunc:OCe};var c9="return (a - b) * (a - b);",PCe=St({opSnippet:c9,packedOpSnippet:c9}),u9={kernelName:rl,backendName:"webgl",kernelFunc:PCe};function LCe({inputs:t,attrs:n,backend:e}){let{x:r}=t,o=qn+`
    return x > 0.0 ? 1.0 : float(${n.alpha});
  `,i=new Vr(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var d9={kernelName:al,backendName:"webgl",kernelFunc:LCe};var EI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=qe(r.length),s=qe(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${n});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function $Ce(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{nonStrided:f,$begin:m,$strides:h,size:g,newShape:x,outShape:b}=ar.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I=de({inputs:{x:o},backend:e,attrs:{shape:x}}),_;if(f){let S=Dl({inputs:{x:I},backend:e,attrs:{begin:m,size:g}});_=de({inputs:{x:S},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(S)}else if(b.some(S=>S===0))_=e.makeTensorInfo(b,o.dtype,[]);else if(e.shouldExecuteOnCPU([I])){let M=e.texData.get(I.dataId).values,R=Te(I.shape,I.dtype,M),L=Pq(b,R,h,m);_=e.makeTensorInfo(b,I.dtype,L.values)}else{let D=new EI(m,h,b);_=e.runWebGLProgram(D,[I],I.dtype)}let E=de({inputs:{x:_},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(I),e.disposeIntermediateTensorInfo(_),E}var p9={kernelName:um,backendName:"webgl",kernelFunc:$Ce};var VCe="return tan(x);",BCe=_e({opSnippet:VCe}),f9={kernelName:il,backendName:"webgl",kernelFunc:BCe};var zCe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,UCe=_e({opSnippet:zCe}),m9={kernelName:sl,backendName:"webgl",kernelFunc:UCe};var SI=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[s]*e[s];this.outputShape=r,this.rank=r.length;let o=qe(this.rank),i=jCe(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function jCe(t){let n=t.length;if(n>5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`imod(resRC, ${t[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<t.length;o++)r.push(`imod(${e[o]}, ${t[o]})`);return r.join()}function CR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>C.decodeString(p)):l,u=Te(o.shape,o.dtype,c),d=$q(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new SI(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var h9={kernelName:_s,backendName:"webgl",kernelFunc:CR};function GCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r,a=e.readSync(o.dataId),[l,c]=Vq(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var g9={kernelName:dm,backendName:"webgl",kernelFunc:GCe};var TI=class{constructor(n,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${n} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${n}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function WCe(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],x=new TI(d,p,s,a,l,g);return e.runWebGLProgram(x,[o,i],"float32")}var y9={kernelName:rw,backendName:"webgl",kernelFunc:WCe};function HCe(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;Os(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=Bq(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var v9={kernelName:pm,backendName:"webgl",kernelFunc:HCe};function qCe(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let h=0;h<a;h++)h!==i&&(c[u++]=s.shape[h]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let m=new Array(l);for(let h=0;h<m.length;h++){p[i]=h;let g=Dl({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),x=de({inputs:{x:g},backend:e,attrs:{shape:c}});m[h]=x,d.push(g)}return d.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var x9={kernelName:Yc,backendName:"webgl",kernelFunc:qCe};var DI=class{constructor(n,e){this.variableNames=["x","segmentIds"];let r=n.windowSize,o=n.batchSize,i=n.inSize,s=n.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `,f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function KCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=T.getAxesPermutation([c],a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=T.getInnerMostAxes(1,a)[0]);let p=T.segment_util.computeOutShape(d.shape,c,s),f=C.sizeFromShape([d.shape[c]]),m=de({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(m);let h=kd(o.dtype),g=(_,E,S,D,M)=>{let R=_.shape[0],L=_.shape[1],G=T.segment_util.segOpComputeOptimalWindowSize(L,M),W={windowSize:G,inSize:L,batchSize:R,numSegments:M},q=new DI(W,E),X=e.compileAndRun(q,[_,S],D);if(l.push(X),X.shape[1]===M)return X;let K=wR({backend:e,attrs:{start:0,stop:M,step:1,dtype:"float32"}}),Z=CR({inputs:{x:K},backend:e,attrs:{reps:[L/G]}});return l.push(K),l.push(Z),g(X,E,Z,D,M)},x=g(m,"unsortedSegmentSum",i,h,s),b=de({inputs:{x},backend:e,attrs:{shape:p}}),I=b;if(u!=null){l.push(b);let _=T.getUndoAxesPermutation(u);I=Xt({inputs:{x:I},backend:e,attrs:{perm:_}})}return l.forEach(_=>e.disposeIntermediateTensorInfo(_)),I}var b9={kernelName:Zc,backendName:"webgl",kernelFunc:KCe};var XCe=[tK,nK,g8,v8,x8,b8,C8,_8,I8,E8,D8,N8,k8,A8,M8,R8,F8,P8,O8,L8,$8,V8,B8,U8,j8,q8,X8,Y8,Q8,o8,e6,n6,r6,t6,i6,s6,o6,a6,l6,c6,p6,f6,m6,g6,y6,h6,v6,x6,b6,w6,C6,_6,I6,S6,T6,N6,k6,A6,R6,F6,O6,P6,L6,$6,V6,B6,z6,U6,r8,j6,J8,G6,W6,H6,i8,q6,K6,X6,Z6,Y6,Q6,J6,eK,oK,aK,sK,lK,cK,dK,iK,fK,mK,hK,gK,yK,CK,u8,IK,EK,SK,TK,G8,DK,AK,RK,MK,FK,s8,OK,PK,W8,vK,LK,VK,$K,p8,BK,zK,UK,jK,GK,WK,HK,qK,KK,XK,YK,ZK,QK,JK,e9,z8,wK,t9,n9,r9,o9,i9,s9,a9,l9,u9,d9,p9,bK,m8,f9,m9,h9,g9,y9,h8,v9,x9,b9,NK];for(let t of XCe)sw(t);function ZCe(t,n){if(t&1&&(v(0,"p",7),w(1," Predicted Emotion: "),v(2,"strong"),w(3),y()()),t&2){let e=Y();O(3),Ke(e.predictedEmotion)}}var NI=class t{constructor(n){this.cdr=n;this.loadModel()}inputText="";predictedEmotion=null;model;tokenizer={};emotions=["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","optimism","pride","realization","relief","remorse","sadness","surprise","neutral"];VOCAB_SIZE=1e3;MAX_LENGTH=50;OOV_INDEX=1;async loadModel(){this.model=await Lk("/assets/models/model.json"),console.log("Model loaded successfully:"),this.model.summary();let n=await fetch("/assets/models/tokenizer.json");this.tokenizer=await n.json(),console.log("Tokenizer mapping loaded:",this.tokenizer)}textToSequence(n){let e=n.trim().toLowerCase().split(/\s+/),r=[];for(let o of e){let i=this.tokenizer[o];(!i||i>=this.VOCAB_SIZE)&&(i=this.OOV_INDEX),r.push(i)}return r}padSequence(n){if(n.length>this.MAX_LENGTH)return n.slice(0,this.MAX_LENGTH);for(;n.length<this.MAX_LENGTH;)n.push(0);return n}async predictEmotion(){if(console.log("button clicked"),!this.model){console.error("Model not loaded yet.");return}let n=this.textToSequence(this.inputText);n=this.padSequence(n);let e=au([n],[1,this.MAX_LENGTH],"int32"),o=await this.model.predict(e).data(),i=o.indexOf(Math.max(...o));this.predictedEmotion=this.emotions[i],this.cdr.markForCheck(),console.log("Predicted Emotion:",this.predictedEmotion)}static \u0275fac=function(e){return new(e||t)(ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-emotion-analyze-prototype"]],decls:10,vars:2,consts:[[1,"container","mt-5"],[1,"card","shadow-lg","p-4"],[1,"text-center","text-primary","mb-4"],[1,"form-group"],["rows","3","placeholder","Enter your text here...",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-block",3,"click"],["class","mt-3 alert alert-info text-center",4,"ngIf"],[1,"mt-3","alert","alert-info","text-center"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1)(2,"h2",2),w(3,"Emotion Classifier"),y(),v(4,"div",3)(5,"textarea",4),an("ngModelChange",function(i){return un(r.inputText,i)||(r.inputText=i),i}),w(6,"            "),y()(),v(7,"button",5),te("click",function(){return r.predictEmotion()}),w(8," Predict Emotion "),y(),re(9,ZCe,4,1,"p",6),y()()),e&2&&(O(5),sn("ngModel",r.inputText),O(4),z("ngIf",r.predictedEmotion))},dependencies:[kt,Ut,vs,wn,Nn,Vi],encapsulation:2})};function QCe(t,n){if(t&1&&(v(0,"div",14),w(1),y()),t&2){let e=Y();O(),Ke(e.actionSuccess)}}function JCe(t,n){if(t&1&&(v(0,"div",15),w(1),y()),t&2){let e=Y();O(),Ke(e.actionError)}}function e_e(t,n){if(t&1){let e=Je();v(0,"li",16)(1,"div",17)(2,"i",18),te("click",function(){let o=le(e).$implicit,i=Y();return ce(i.onRowClick(o))}),y(),v(3,"div",19),te("click",function(){let o=le(e).$implicit,i=Y();return ce(i.onRowClick(o))}),v(4,"h5",20),w(5),y(),v(6,"span",21)(7,"span",22),w(8),y(),w(9," | "),v(10,"span",22),w(11),y(),w(12," | "),v(13,"span",22),w(14),No(15,"date"),y()()(),v(16,"div",23),te("click",function(){let o=le(e).$implicit,i=Y();return ce(i.deleteAccount(o.account_id))}),U(17,"i",24),y()()()}if(t&2){let e=n.$implicit;O(5),Ke(e.account_name),O(3),$e("Broker: ",e.broker_name,""),O(3),Xu("Balance: ",e.balance," ",e.currency,""),O(3),$e("Created At: ",ko(15,5,e.created_at,"y, MMMM, d h:mm a"),"")}}function t_e(t,n){if(t&1&&(v(0,"div",15),w(1),y()),t&2){let e=Y(2);O(),Ke(e.formError)}}function n_e(t,n){if(t&1){let e=Je();v(0,"div",25),te("click",function(o){le(e);let i=Y();return ce(i.closeFormOnOutside(o))})("keydown.escape",function(){le(e);let o=Y();return ce(o.toggleForm())}),v(1,"div",26),te("click",function(o){return le(e),ce(o.stopPropagation())}),v(2,"nav",27)(3,"ol",28)(4,"li",3)(5,"a",4),w(6,"Dashboard"),y()(),v(7,"li",3)(8,"a",29),te("click",function(o){le(e);let i=Y();return ce(i.closeFormOnOutside(o))}),w(9,"Trading Accounts"),y()(),v(10,"li",5),w(11,"Create Manual Account"),y()()(),v(12,"h4",30),w(13,"Create Manual Account"),y(),v(14,"p",31),w(15,"Set up a manual trading account to track your trades"),y(),v(16,"form",32),te("ngSubmit",function(){le(e);let o=Y();return ce(o.submitForm())}),v(17,"div",33)(18,"label",34),w(19,"Account Name"),y(),U(20,"input",35),y(),v(21,"div",33)(22,"label",34),w(23,"Broker Name"),y(),U(24,"input",36),y(),v(25,"div",33)(26,"label",34),w(27,"Account Type"),y(),U(28,"input",37),y(),v(29,"div",33)(30,"label",34),w(31,"Currency"),y(),U(32,"input",38),y(),v(33,"div",33)(34,"label",34),w(35,"Initial Balance"),y(),U(36,"input",39),y(),v(37,"div",33)(38,"label",34),w(39,"Account Notes (Optional)"),y(),U(40,"textarea",40),y(),v(41,"h5",8),w(42,"Trading Preferences"),y(),v(43,"div",41),U(44,"input",42),v(45,"label",43),w(46,"Track P&L"),y(),v(47,"small",44),w(48,"Enable profit and loss tracking for this account"),y()(),v(49,"div",41),U(50,"input",45),v(51,"label",46),w(52,"Include in Analytics"),y(),v(53,"small",44),w(54,"Include this account in overall performance metrics"),y()(),re(55,t_e,2,1,"div",10),v(56,"div",47)(57,"button",48),te("click",function(){le(e);let o=Y();return ce(o.toggleForm())}),w(58,"Cancel"),y(),v(59,"button",49),w(60,"Create Account"),y()()()()()}if(t&2){let e=Y();O(16),z("formGroup",e.tradeAccountForm),O(39),z("ngIf",e.formError)}}function r_e(t,n){if(t&1){let e=Je();v(0,"div",25),te("click",function(){le(e);let o=Y();return ce(o.cancelDelete())})("keydown.escape",function(){le(e);let o=Y();return ce(o.cancelDelete())}),v(1,"div",26),te("click",function(o){return le(e),ce(o.stopPropagation())}),v(2,"h5",33),w(3,"Confirm Deletion"),y(),v(4,"p"),w(5,"Are you sure you want to delete this trading account and all its associated data?"),y(),v(6,"div",47)(7,"button",50),te("click",function(){le(e);let o=Y();return ce(o.cancelDelete())}),w(8,"Cancel"),y(),v(9,"button",7),te("click",function(){le(e);let o=Y();return ce(o.confirmDelete())}),w(10,"Delete"),y()()()()}}var kI=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r;this.tradeAccountForm=this.fb.group({account_name:["",Ee.required],broker_name:[""],account_type:[""],currency:["USD"],balance:[0,Ee.min(0)],track_pl:[!1],include_in_analytics:[!1]})}tradeAccounts=[];showForm=!1;tradeAccountForm;formError=null;actionError=null;actionSuccess=null;selectedAccountId=null;showDeleteConfirm=!1;pendingDeleteAccountId=null;ngOnInit(){this.loadAccounts()}async loadAccounts(){try{this.tradeAccounts=await this.supabaseService.getUserTradeAccounts()}catch{this.actionError="Failed to load accounts. Please try again."}finally{this.cdr.markForCheck()}}async onRowClick(n){this.selectedAccountId=n.account_id,this.tradeAccountForm.patchValue({account_name:n.account_name,broker_name:n.broker_name,account_type:n.account_type,currency:n.currency,balance:n.balance,track_pl:n.metadata?.track_pl||!1,include_in_analytics:n.metadata?.include_in_analytics||!1}),this.showForm=!0}toggleForm(){this.showForm=!this.showForm,this.formError=null,this.actionSuccess=null,this.actionError=null,this.selectedAccountId=null,this.showForm||this.tradeAccountForm.reset({currency:"USD",balance:0})}async submitForm(){if(this.formError="",this.tradeAccountForm.valid){let n=this.tradeAccountForm.value;this.selectedAccountId?await this.supabaseService.editTradeAccount(this.selectedAccountId,n)?(this.actionSuccess="Account updated successfully",this.loadAccounts(),this.toggleForm()):this.formError="Failed to update account":await this.supabaseService.addTradeAccount(n)?(this.actionSuccess="Account added successfully",this.loadAccounts(),this.toggleForm()):this.formError="Failed to add account"}this.cdr.markForCheck()}async deleteAccount(n){this.showDeleteConfirm=!0,this.pendingDeleteAccountId=n}confirmDelete(){this.pendingDeleteAccountId&&this.performAccountDeletion(this.pendingDeleteAccountId),this.showDeleteConfirm=!1,this.pendingDeleteAccountId=null}cancelDelete(){this.showDeleteConfirm=!1,this.pendingDeleteAccountId=null}async performAccountDeletion(n){this.actionError=null,this.actionSuccess=null;try{await this.supabaseService.RemoveTradeAccount(n)?(this.loadAccounts(),this.actionSuccess="Account deleted successfully."):this.actionError="Failed to delete account."}catch{this.actionError="An unexpected error occurred while deleting."}finally{this.cdr.markForCheck(),setTimeout(()=>{this.actionSuccess="",this.cdr.markForCheck()},5e3)}}handleEscape(n){this.showForm&&this.toggleForm()}closeFormOnOutside(n){n.target===n.currentTarget&&this.toggleForm()}static \u0275fac=function(e){return new(e||t)(ne(oi),ne(Ct),ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-tradeaccountmanage"]],hostBindings:function(e,r){e&1&&te("keydown.escape",function(i){return r.handleEscape(i)},!1,LF)},decls:23,vars:5,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"btn","btn-tr",3,"click"],[1,"mt-4"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"list-group"],["class","list-group-item bg-transparent",4,"ngFor","ngForOf"],["class","overlay","tabindex","0",3,"click","keydown.escape",4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[1,"list-group-item","bg-transparent"],[1,"d-flex","align-items-center"],[1,"logo-circle","bi","bi-star-fill","text-primary",2,"font-size","2rem",3,"click"],[1,"ms-3",3,"click"],[1,"mt-2"],[1,"d-block","row","text-muted"],[1,"col-4"],["title","Delete Account",1,"delete-button","justify-content-end",3,"click"],[1,"bi","bi-trash"],["tabindex","0",1,"overlay",3,"click","keydown.escape"],[1,"modal-card",3,"click"],["aria-label","breadcrumb"],[1,"breadcrumb","small"],[3,"click"],[1,"mb-1"],[1,"text-muted","mb-3"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","account_name","placeholder","e.g., My Futures Account",1,"form-control"],["type","text","formControlName","broker_name","placeholder","e.g., NinjaTrader, TastyWorks",1,"form-control"],["type","text","formControlName","account_type","placeholder","e.g., Margin, Cash",1,"form-control"],["type","text","formControlName","currency","placeholder","USD",1,"form-control"],["type","number","formControlName","balance",1,"form-control"],["rows","3","placeholder","Add any additional information about this account","disabled","",1,"form-control"],[1,"form-check","form-switch","mb-2"],["type","checkbox","formControlName","track_pl","id","track_pl",1,"form-check-input"],["for","track_pl",1,"form-check-label"],[1,"text-muted","d-block","ms-4"],["type","checkbox","formControlName","include_in_analytics","id","include_in_analytics",1,"form-check-input"],["for","include_in_analytics",1,"form-check-label"],[1,"d-flex","justify-content-end","gap-2","mt-3"],["type","button",1,"btn","btn-tr-secondary",3,"click"],["type","submit",1,"btn","btn-tr"],[1,"btn","btn-tr-secondary",3,"click"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",5),w(7,"Trading Accounts"),y()()(),v(8,"div",6)(9,"h3"),w(10,"Your Trade Accounts"),y(),v(11,"button",7),te("click",function(){return r.toggleForm()}),w(12,"Add Account"),y()(),v(13,"div",8)(14,"h5"),w(15,"Manage your trading accounts"),y()(),re(16,QCe,2,1,"div",9)(17,JCe,2,1,"div",10),v(18,"div",0)(19,"ul",11),re(20,e_e,18,8,"li",12),y()(),re(21,n_e,61,2,"div",13)(22,r_e,11,0,"div",13),y()),e&2&&(O(16),z("ngIf",r.actionSuccess),O(),z("ngIf",r.actionError),O(3),z("ngForOf",r.tradeAccounts),O(),z("ngIf",r.showForm),O(),z("ngIf",r.showDeleteConfirm))},dependencies:[mo,po,wn,Bi,pa,Nn,uo,fo,Po,kt,Bn,Ut,ei,zn],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;z-index:1050}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 25px #00000026}.list-group-item[_ngcontent-%COMP%]{cursor:pointer}.delete-button[_ngcontent-%COMP%]{color:red;display:none;margin-left:auto}.list-group-item[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{color:red;display:block}"]})};function o_e(t,n){if(t&1&&U(0,"img",38),t&2){let e=Y();z("src",e.currentImageUrl,cs)}}function i_e(t,n){if(t&1&&U(0,"img",39),t&2){let e=Y();z("src",e.previewUrl,cs)}}function s_e(t,n){t&1&&(v(0,"div",14),w(1,"No new image selected"),y())}function a_e(t,n){if(t&1&&(v(0,"div",26)(1,"div",40),w(2),y()()),t&2){let e=Y();O(2),Ke(e.errorMessage)}}function l_e(t,n){if(t&1&&(v(0,"button",41),w(1," Save Changes "),y()),t&2){let e=Y();z("disabled",e.profileForm.invalid)}}var AI=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r;this.profileForm=this.fb.group({firstname:[""],lastname:[""],email:[""],phone:[""]})}profileForm;currentImageUrl=null;previewUrl=null;selectedFile=null;userId="";originalFormValue;formChanged=!1;errorMessage="";async ngOnInit(){await this.loadProfile(),this.trackFormChanges()}async loadProfile(){let{data:n}=await this.supabaseService.getProfile();n&&(this.profileForm.patchValue({firstname:n.firstname,lastname:n.lastname,email:n.email,phone:n.phone}),this.originalFormValue=this.profileForm.getRawValue(),n.profile_picture_url&&(this.currentImageUrl=await this.supabaseService.getCachedProfilePictureBlobUrl(n.profile_picture_url)),this.cdr.markForCheck())}async removeProfilePicture(){try{await this.supabaseService.deleteProfilePicture(),this.supabaseService.clearCachedProfilePictureBlobUrl(),await this.supabaseService.updateProfile({profile_picture_url:null}),this.currentImageUrl=null,this.previewUrl=null,this.selectedFile=null,this.formChanged=!0,this.cdr.markForCheck()}catch{this.errorMessage="Failed to remove profile picture."}}trackFormChanges(){this.profileForm.valueChanges.subscribe(()=>{this.formChanged=JSON.stringify(this.profileForm.getRawValue())!==JSON.stringify(this.originalFormValue)||!!this.selectedFile}),this.cdr.markForCheck()}onFileChange(n){this.errorMessage="";let e=n.target;if(!e?.files?.length)return;let r=e.files[0];if(!["image/jpeg","image/png","image/webp"].includes(r.type)){this.errorMessage="Only JPG, PNG, or WEBP images are allowed.",this.selectedFile=null;return}if(r.size>1024*1024){this.errorMessage="File size must be less than 1MB.",this.selectedFile=null;return}this.selectedFile=r,this.currentImageUrl=this.previewUrl,this.previewUrl=URL.createObjectURL(r),this.formChanged=!0,this.cdr.markForCheck()}async saveChanges(){if(!this.formChanged){this.errorMessage="No changes detected.";return}let n=null;this.selectedFile&&(n=await this.supabaseService.uploadProfilePicture(this.selectedFile));let e=this.profileForm.getRawValue(),r={firstname:e.firstname,lastname:e.lastname,email:e.email,phone:e.phone,profile_picture_url:n,updated_at:new Date().toISOString(),preferences:{},metadata:{}};n&&(this.supabaseService.clearCachedProfilePictureBlobUrl(),this.previewUrl=await this.supabaseService.getCachedProfilePictureBlobUrl(n),this.currentImageUrl=this.previewUrl),await this.supabaseService.updateProfile(r),this.formChanged=!1,this.selectedFile=null,this.originalFormValue=this.profileForm.getRawValue(),this.cdr.markForCheck()}static \u0275fac=function(e){return new(e||t)(ne(oi),ne(Ct),ne(vt))};static \u0275cmp=it({type:t,selectors:[["app-user-account-settings"]],decls:71,vars:6,consts:[[1,"container","mb-5"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"mb-2"],[1,"text-muted","mb-4"],[1,"row","g-3","mb-4"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","p-3","h-100"],[1,"d-flex","align-items-center","mb-2"],["alt","Profile","class","rounded-circle me-2","style","width: 40px; height: 40px; object-fit: cover;",3,"src",4,"ngIf"],[1,"mb-0"],[1,"text-muted"],[1,"card","border-primary","shadow-sm","p-3","h-100"],[1,"bi","bi-patch-check-fill","text-primary","me-2","fs-4"],[1,"mt-3"],[1,"btn","btn-outline-primary","btn-sm"],[1,"row","g-4",3,"ngSubmit","formGroup"],[1,"fw-bold"],[1,"form-label"],["formControlName","firstname","placeholder","First name",1,"form-control"],["formControlName","lastname","placeholder","Last name",1,"form-control"],["formControlName","email","placeholder","Email","type","email",1,"form-control"],["formControlName","phone","placeholder","+1 (123) 456-7890",1,"form-control"],[1,"col-12"],[1,"fw-bold","mt-3"],[1,"card","p-3","shadow-sm","border-light","bg-light-subtle"],[1,"form-label","d-block"],["alt","Preview","class","img-thumbnail","style","width: 120px;",3,"src",4,"ngIf"],["class","text-muted",4,"ngIf"],["type","file",1,"form-control","mt-2",3,"change"],[1,"mt-2","d-flex","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["class","col-12",4,"ngIf"],[1,"col-12","text-end"],["type","submit","class","btn btn-tr",3,"disabled",4,"ngIf"],["alt","Profile",1,"rounded-circle","me-2",2,"width","40px","height","40px","object-fit","cover",3,"src"],["alt","Preview",1,"img-thumbnail",2,"width","120px",3,"src"],[1,"alert","alert-danger"],["type","submit",1,"btn","btn-tr",3,"disabled"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),w(5,"Dashboard"),y()(),v(6,"li",5),w(7,"Account Settings"),y()()(),v(8,"h2",6),w(9,"Account Settings"),y(),v(10,"p",7),w(11,"Manage your profile, subscription, and preferences"),y(),v(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11),re(16,o_e,1,1,"img",12),v(17,"h5",13),w(18,"Profile Information"),y()(),v(19,"small",14),w(20,"Update your personal details and public profile"),y()()(),v(21,"div",9)(22,"div",15)(23,"small",14),w(24,"This is placeholder."),y(),v(25,"div",11),U(26,"i",16),v(27,"h5",13),w(28,"Pro Account"),y()(),v(29,"small",14),w(30,"Active until Dec 15, 2025"),y(),v(31,"div",17)(32,"button",18),w(33,"Manage Plan"),y()()()()(),v(34,"form",19),te("ngSubmit",function(){return r.saveChanges()}),v(35,"h5",20),w(36,"Personal Information"),y(),v(37,"div",9)(38,"label",21),w(39,"First Name"),y(),U(40,"input",22),y(),v(41,"div",9)(42,"label",21),w(43,"Last Name"),y(),U(44,"input",23),y(),v(45,"div",9)(46,"label",21),w(47,"Email Address"),y(),U(48,"input",24),y(),v(49,"div",9)(50,"label",21),w(51,"Phone"),y(),U(52,"input",25),y(),v(53,"div",26)(54,"h6",27),w(55,"Profile Picture"),y(),v(56,"div",28)(57,"div",6)(58,"label",29),w(59,"Preview New Photo"),y(),re(60,i_e,1,1,"img",30)(61,s_e,2,0,"div",31),y(),v(62,"input",32),te("change",function(i){return r.onFileChange(i)}),y(),v(63,"small",14),w(64,"JPG, PNG or GIF. Max 1MB."),y(),v(65,"div",33)(66,"button",34),te("click",function(){return r.removeProfilePicture()}),w(67,"Remove"),y()()()(),re(68,a_e,3,1,"div",35),v(69,"div",36),re(70,l_e,2,1,"button",37),y()()()),e&2&&(O(16),z("ngIf",r.currentImageUrl),O(18),z("formGroup",r.profileForm),O(26),z("ngIf",r.previewUrl),O(),z("ngIf",!r.previewUrl),O(7),z("ngIf",r.errorMessage),O(2),z("ngIf",r.formChanged))},dependencies:[mo,po,wn,Nn,uo,fo,Po,kt,Ut,zn],encapsulation:2})};var c_e=(t,n)=>({"alert-success":t,"alert-danger":n});function u_e(t,n){if(t&1&&(v(0,"div",7),w(1),y()),t&2){let e=Y();z("ngClass",Qo(2,c_e,e.messageType==="success",e.messageType==="error")),O(),$e(" ",e.message," ")}}function d_e(t,n){if(t&1){let e=Je();v(0,"tr")(1,"td")(2,"input",8),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.title,o)||(i.title=o),ce(o)}),te("ngModelChange",function(){let o=le(e).$implicit,i=Y();return ce(i.onFieldChange(o))}),y()(),v(3,"td")(4,"input",8),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.url,o)||(i.url=o),ce(o)}),te("ngModelChange",function(){let o=le(e).$implicit,i=Y();return ce(i.onFieldChange(o))}),y()(),v(5,"td")(6,"input",8),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.category,o)||(i.category=o),ce(o)}),te("ngModelChange",function(){let o=le(e).$implicit,i=Y();return ce(i.onFieldChange(o))}),y()(),v(7,"td")(8,"textarea",8),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.description,o)||(i.description=o),ce(o)}),te("ngModelChange",function(){let o=le(e).$implicit,i=Y();return ce(i.onFieldChange(o))}),y()(),v(9,"td")(10,"input",9),an("ngModelChange",function(o){let i=le(e).$implicit;return un(i.isactive,o)||(i.isactive=o),ce(o)}),te("change",function(){let o=le(e).$implicit,i=Y();return ce(i.onFieldChange(o))}),y()(),v(11,"td"),w(12),No(13,"date"),y()()}if(t&2){let e=n.$implicit;O(2),sn("ngModel",e.title),O(2),sn("ngModel",e.url),O(2),sn("ngModel",e.category),O(2),sn("ngModel",e.description),O(2),sn("ngModel",e.isactive),O(2),Ke(ko(13,6,e.updated_time,"short"))}}var RI=class t{constructor(n,e){this.cdr=n;this.supabaseService=e}videos=[];message="";messageType="success";async ngOnInit(){let n=await this.supabaseService.adminLoadMeditationVideos();this.videos=n.map(e=>Ue(me({},e),{isModified:!1})),this.cdr.markForCheck()}onFieldChange(n){n.isModified=!0}addVideo(){this.videos.push({title:"",url:"",category:"",description:"",isactive:!0,isModified:!0}),this.cdr.detectChanges()}async saveChanges(){let n=this.videos.filter(e=>e.isModified);for(let e of n){if(e.id){e.updated_time=new Date().toISOString();let{error:r}=await this.supabaseService.updateMeditationVideo(e);if(r)return this.showMessage("Error saving some videos","error")}else{let{error:r}=await this.supabaseService.addMeditationVideo(e);if(r)return this.showMessage("Error adding new video","error")}e.isModified=!1}this.showMessage("Videos saved successfully","success"),this.cdr.detectChanges()}hasChanges(){return this.videos.some(n=>n.isModified)}showMessage(n,e){this.message=n,this.messageType=e,this.cdr.markForCheck(),setTimeout(()=>{this.message="",this.cdr.markForCheck()},4e3)}static \u0275fac=function(e){return new(e||t)(ne(vt),ne(Ct))};static \u0275cmp=it({type:t,selectors:[["app-admin-meditation-dashboard"]],decls:26,vars:3,consts:[[1,"container","mt-4","p-4"],["class","alert",3,"ngClass",4,"ngIf"],[1,"table","mt-4"],[4,"ngFor","ngForOf"],[1,"d-flex","justify-content-between","mt-3"],[1,"btn","btn-secondary",3,"click"],[1,"btn","btn-success",3,"click","disabled"],[1,"alert",3,"ngClass"],["type","text",1,"form-control",3,"ngModelChange","ngModel"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"]],template:function(e,r){e&1&&(v(0,"div",0),re(1,u_e,2,5,"div",1),v(2,"h2"),w(3,"Meditation Video Admin Dashboard"),y(),v(4,"table",2)(5,"thead")(6,"tr")(7,"th"),w(8,"Title"),y(),v(9,"th"),w(10,"URL"),y(),v(11,"th"),w(12,"Category"),y(),v(13,"th"),w(14,"Description"),y(),v(15,"th"),w(16,"Active"),y(),v(17,"th"),w(18,"Last Updated"),y()()(),v(19,"tbody"),re(20,d_e,14,9,"tr",3),y()(),v(21,"div",4)(22,"button",5),te("click",function(){return r.addVideo()}),w(23,"Add Video"),y(),v(24,"button",6),te("click",function(){return r.saveChanges()}),w(25,"Save Changes"),y()()()),e&2&&(O(),z("ngIf",r.message),O(19),z("ngForOf",r.videos),O(4),z("disabled",!r.hasChanges()))},dependencies:[kt,lo,Bn,Ut,ei,vs,wn,pa,Nn,Vi],encapsulation:2})};var w9=[{path:"",component:Mb,canActivate:[pb]},{path:"home",component:db,canActivate:[sr]},{path:"pretrades",component:Sb,canActivate:[sr]},{path:"pretradelog",component:Nf,canActivate:[sr]},{path:"posttrades",component:Tb,canActivate:[sr]},{path:"posttradelog",component:kf,canActivate:[sr]},{path:"emotions",component:Rb,canActivate:[sr]},{path:"tradejournal",component:Fb,canActivate:[sr]},{path:"individualTrade",component:Af,canActivate:[sr]},{path:"meditationhub",component:Pb,canActivate:[sr]},{path:"analytics",component:Lb,canActivate:[sr]},{path:"tradeaccounts",component:kI,canActivate:[sr]},{path:"useraccount",component:AI,canActivate:[sr]},{path:"mlemotion",component:NI,canActivate:[sr]},{path:"admin/emotionquestion",component:Db,canActivate:[sr]},{path:"admin/meditationvideo",component:RI,canActivate:[sr]},{path:"**",redirectTo:""}];var C9={providers:[GO(),vL(w9),_P(IP())]};function p_e(t,n){t&1&&(na(0),v(1,"div",1),U(2,"router-outlet"),y(),ra())}function f_e(t,n){if(t&1){let e=Je();v(0,"div",19)(1,"a",20),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/home"))}),U(2,"i",21),w(3,"Dashboard"),y(),v(4,"a",20),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/emotions"))}),U(5,"i",22),w(6,"Morning Check-In"),y(),v(7,"a",20),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/tradejournal"))}),U(8,"i",23),w(9,"Trade Journal"),y(),v(10,"a",20),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/meditationhub"))}),U(11,"i",24),w(12,"Meditation Hub"),y(),v(13,"a",20),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/analytics"))}),U(14,"i",25),w(15,"Analytics"),y(),v(16,"a",20),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/tradeaccounts"))}),U(17,"i",26),w(18,"Trade Accounts"),y()()}}function m_e(t,n){if(t&1&&(v(0,"div"),U(1,"img",32),y()),t&2){let e=Y(3);O(),z("src",e.profile_image_blob_url,cs)}}function h_e(t,n){t&1&&(v(0,"div"),U(1,"i",33),y())}function g_e(t,n){if(t&1){let e=Je();v(0,"div",27)(1,"div",28),re(2,m_e,2,1,"div",0)(3,h_e,2,0,"div",0),w(4," \xA0\xA0 "),v(5,"p",29),w(6),y()(),v(7,"button",30),te("click",function(){le(e);let o=Y(2);return ce(o.logOut())}),w(8,"Logout\xA0\xA0\xA0"),U(9,"i",31),y()()}if(t&2){let e=Y(2);O(2),z("ngIf",e.profile_image_blob_url),O(),z("ngIf",!e.profile_image_blob_url),O(3),$e("Welcome, ",e.supabaseService.currentUsername(),"!")}}function y_e(t,n){if(t&1){let e=Je();v(0,"button",34),te("click",function(){le(e);let o=Y(2);return ce(o.navigateToUrl("/home"))}),U(1,"img",35),y()}}function v_e(t,n){if(t&1){let e=Je();na(0),v(1,"div",2)(2,"nav",3)(3,"div",4)(4,"div",5)(5,"button",6),te("click",function(){le(e);let o=Y();return ce(o.navigateToUrl("/home"))}),v(6,"img",7),te("click",function(){le(e);let o=Y();return ce(o.navigateToUrl("/home"))}),y()(),v(7,"button",8),te("click",function(){le(e);let o=Y();return ce(o.closeSidebar())}),y()(),re(8,f_e,19,0,"div",9),y(),re(9,g_e,10,3,"div",10),y(),v(10,"div",11)(11,"nav",12)(12,"div",13)(13,"div",14)(14,"button",15),te("click",function(){le(e);let o=Y();return ce(o.toggleSidebar())}),U(15,"span",16),y(),re(16,y_e,2,0,"button",17),y()()(),v(17,"div",18),U(18,"router-outlet"),y()()(),ra()}if(t&2){let e=Y();O(2),Do("collapsed",e.sidebarCollapsed()),O(6),z("ngIf",e.loginStatus()),O(),z("ngIf",e.loginStatus()),O(),Do("expanded",e.sidebarCollapsed()),O(6),z("ngIf",e.sidebarCollapsed())}}var MI=class t{constructor(n,e,r,o,i){this.cdr=n;this.supabaseService=e;this.router=r;this.route=o;this.platformId=i;this.loginStatus=ql(()=>e.loginStatus())}title="TR-prototype";profile_image_blob_url="";loginStatus;sidebarCollapsed=io(!1);isMobile=io(!1);resizeObserver;ngOnInit(){this.checkScreenSize(),dn(this.platformId)&&(this.sidebarCollapsed.set(this.isMobile()),this.resizeObserver=new ResizeObserver(()=>{this.checkScreenSize(),this.cdr.detectChanges()}),this.resizeObserver.observe(document.body),console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}async ngAfterViewInit(){dn(this.platformId)&&(await this.loadProfileImage(),this.cdr.markForCheck(),setTimeout(()=>{this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngOnDestroy(){dn(this.platformId)&&this.resizeObserver&&this.resizeObserver.disconnect()}async loadProfileImage(){let{data:n}=await this.supabaseService.getProfile();n?.profile_picture_url&&(this.profile_image_blob_url=await this.supabaseService.getCachedProfilePictureBlobUrl(n.profile_picture_url)),this.cdr.markForCheck()}async logOut(){await this.supabaseService.signOut(),this.router.navigateByUrl("/")}toggleSidebar(){this.sidebarCollapsed.update(n=>!n),this.cdr.detectChanges()}navigateToUrl(n){this.router.navigateByUrl(n)}closeSidebar(){this.sidebarCollapsed.set(!0),this.cdr.detectChanges()}checkScreenSize(){dn(this.platformId)&&this.isMobile.set(window.innerWidth<768)}static \u0275fac=function(e){return new(e||t)(ne(vt),ne(Ct),ne(Fo),ne(Li),ne(so))};static \u0275cmp=it({type:t,selectors:[["app-root"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"container-fluid","p-0"],[1,"sidebar-container"],["id","sidebar",1,"d-flex","flex-column","h-100"],[1,"p-3","flex-grow-1"],[1,"mb-3","d-flex","align-items-center","justify-content-between"],[1,"text-decoration-none","me-auto","btn","btn-link","p-0","me-3",3,"click"],["src","/trading_rehab_main_logo.png",1,"img-fluid",2,"height","36px",3,"click"],["type","button",1,"btn-close","d-md-none",3,"click"],["class","nav flex-column",4,"ngIf"],["class","p-3 border-top mt-auto",4,"ngIf"],[1,"content"],[1,"navbar","navbar-expand-lg"],[1,"container-fluid"],[1,"d-flex","align-items-center"],[1,"btn","me-2",3,"click"],[1,"navbar-toggler-icon"],["class","btn navbar-branding text-decoration-none me-auto",3,"click",4,"ngIf"],[1,"container-fluid","ps-3"],[1,"nav","flex-column"],[1,"nav-link",3,"click"],[1,"bi","bi-columns-gap","me-3"],[1,"bi","bi-brightness-high","me-3"],[1,"bi","bi-bookmark-check","me-3"],[1,"bi","bi-person-arms-up","me-3"],[1,"bi","bi-clipboard-data","me-3"],[1,"bi","bi-journals","me-3"],[1,"p-3","border-top","mt-auto"],["routerLink","/useraccount",1,"d-flex","align-items-center","mb-2",2,"cursor","pointer"],[1,"text-black","mb-0"],[1,"btn","btn-outline-secondary","btn-tr","w-100",3,"click"],[1,"bi","bi-box-arrow-right"],["alt","Profile",1,"rounded-circle","me-2",2,"width","40px","height","40px","object-fit","cover",3,"src"],[1,"bi","bi-person-circle","text-black",2,"font-size","30px"],[1,"btn","navbar-branding","text-decoration-none","me-auto",3,"click"],["src","/trading-rehab-logo.png","width","50px",1,"img-fluid"]],template:function(e,r){e&1&&re(0,p_e,3,0,"ng-container",0)(1,v_e,19,7,"ng-container",0),e&2&&(z("ngIf",!r.supabaseService.loginStatus()),O(),z("ngIf",r.supabaseService.loginStatus()))},dependencies:[kt,Ut,yT,zn],styles:[".sidebar-container[_ngcontent-%COMP%]{display:flex;width:100%;position:relative}#sidebar[_ngcontent-%COMP%]{width:250px;position:fixed;top:0;left:0;height:100vh;z-index:999;background:#634aff0d;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);transition:all .3s;box-shadow:0 0 10px #0000001a}#sidebar.collapsed[_ngcontent-%COMP%]{margin-left:-250px}.content[_ngcontent-%COMP%]{width:calc(100% - 250px);margin-left:250px;transition:all .3s;min-height:100vh}.content.expanded[_ngcontent-%COMP%]{width:100%;margin-left:0}@media (max-width: 768px){#sidebar[_ngcontent-%COMP%]{margin-left:-250px}#sidebar[_ngcontent-%COMP%]:not(.collapsed){margin-left:0}.content[_ngcontent-%COMP%]{width:100%;margin-left:0}}.nav-link[_ngcontent-%COMP%]{padding:15px 20px;color:#333;border-bottom:1px solid #ddd;cursor:pointer}.nav-link[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.navbar[_ngcontent-%COMP%]{padding:15px 10px}"]})};FP(MI,C9).catch(t=>console.error(t));
