import{b as tA,c as nA,f as g6,g as rA}from"./chunk-65CJINC2.js";import{a as me,b as qe,c as Gy,e as ft,f as Wi,g as Zm,h as h6}from"./chunk-VOSPIT4N.js";var yI=ft(gI=>{"use strict";Object.defineProperty(gI,"__esModule",{value:!0});var hI=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}};gI.default=hI});var vI=ft(eg=>{"use strict";var NF=eg&&eg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(eg,"__esModule",{value:!0});var Iee=NF((rA(),h6(g6))),Tee=NF(yI()),xI=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=Iee.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=Object.assign({},this.headers),this.headers[n]=e,this}then(n,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var s,a,l;let c=null,u=null,d=null,p=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){let x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=x:u=JSON.parse(x))}let h=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),g=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");h&&g&&g.length>1&&(d=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,p=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let h=await i.text();try{c=JSON.parse(h),Array.isArray(c)&&i.status===404&&(u=[],c=null,p=200,f="OK")}catch{i.status===404&&h===""?(p=204,f="No Content"):c={message:h}}if(c&&this.isMaybeSingle&&(!((l=c?.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,p=200,f="OK"),c&&this.shouldThrowOnError)throw new Tee.default(c)}return{error:c,data:u,count:d,status:p,statusText:f}});return this.shouldThrowOnError||(o=o.catch(i=>{var s,a,l;return{error:{message:`${(s=i?.name)!==null&&s!==void 0?s:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),o.then(n,e)}};eg.default=xI});var wI=ft(tg=>{"use strict";var Dee=tg&&tg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tg,"__esModule",{value:!0});var Nee=Dee(vI()),bI=class extends Nee.default{select(n){let e=!1,r=(n??"*").split("").map(o=>/\s/.test(o)&&!e?"":(o==='"'&&(e=!e),o)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:e=!0,nullsFirst:r,foreignTable:o,referencedTable:i=o}={}){let s=i?`${i}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:r=e}={}){let o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,e,{foreignTable:r,referencedTable:o=r}={}){let i=typeof o>"u"?"offset":`${o}.offset`,s=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(s,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:e=!1,settings:r=!1,buffers:o=!1,wal:i=!1,format:s="text"}={}){var a;let l=[n?"analyze":null,e?"verbose":null,r?"settings":null,o?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`,s==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};tg.default=bI});var pv=ft(ng=>{"use strict";var kee=ng&&ng.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ng,"__esModule",{value:!0});var Aee=kee(wI()),CI=class extends Aee.default{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}in(n,e){let r=Array.from(new Set(e)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${r})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:r,type:o}={}){let i="";o==="plain"?i="pl":o==="phrase"?i="ph":o==="websearch"&&(i="w");let s=r===void 0?"":`(${r})`;return this.url.searchParams.append(n,`${i}fts${s}.${e}`),this}match(n){return Object.entries(n).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(n,e,r){return this.url.searchParams.append(n,`not.${e}.${r}`),this}or(n,{foreignTable:e,referencedTable:r=e}={}){let o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,e,r){return this.url.searchParams.append(n,`${e}.${r}`),this}};ng.default=CI});var SI=ft(og=>{"use strict";var Ree=og&&og.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(og,"__esModule",{value:!0});var rg=Ree(pv()),_I=class{constructor(n,{headers:e={},schema:r,fetch:o}){this.url=n,this.headers=e,this.schema=r,this.fetch=o}select(n,{head:e=!1,count:r}={}){let o=e?"HEAD":"GET",i=!1,s=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),new rg.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:e,defaultToNull:r=!0}={}){let o="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(n)){let s=n.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(s.length>0){let a=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new rg.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:e,ignoreDuplicates:r=!1,count:o,defaultToNull:i=!0}={}){let s="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),o&&a.push(`count=${o}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(n)){let l=n.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){let c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new rg.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:e}={}){let r="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),e&&o.push(`count=${e}`),this.headers.Prefer=o.join(","),new rg.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){let e="DELETE",r=[];return n&&r.push(`count=${n}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new rg.default({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};og.default=_I});var kF=ft(fv=>{"use strict";Object.defineProperty(fv,"__esModule",{value:!0});fv.version=void 0;fv.version="0.0.0-automated"});var AF=ft(mv=>{"use strict";Object.defineProperty(mv,"__esModule",{value:!0});mv.DEFAULT_HEADERS=void 0;var Oee=kF();mv.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Oee.version}`}});var OF=ft(ig=>{"use strict";var RF=ig&&ig.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ig,"__esModule",{value:!0});var Mee=RF(SI()),Fee=RF(pv()),Pee=AF(),EI=class t{constructor(n,{headers:e={},schema:r,fetch:o}={}){this.url=n,this.headers=Object.assign(Object.assign({},Pee.DEFAULT_HEADERS),e),this.schemaName=r,this.fetch=o}from(n){let e=new URL(`${this.url}/${n}`);return new Mee.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new t(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,e={},{head:r=!1,get:o=!1,count:i}={}){let s,a=new URL(`${this.url}/rpc/${n}`),l;r||o?(s=r?"HEAD":"GET",Object.entries(e).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{a.searchParams.append(u,d)})):(s="POST",l=e);let c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new Fee.default({method:s,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};ig.default=EI});var BF=ft(ar=>{"use strict";var jp=ar&&ar.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ar,"__esModule",{value:!0});ar.PostgrestError=ar.PostgrestBuilder=ar.PostgrestTransformBuilder=ar.PostgrestFilterBuilder=ar.PostgrestQueryBuilder=ar.PostgrestClient=void 0;var MF=jp(OF());ar.PostgrestClient=MF.default;var FF=jp(SI());ar.PostgrestQueryBuilder=FF.default;var PF=jp(pv());ar.PostgrestFilterBuilder=PF.default;var $F=jp(wI());ar.PostgrestTransformBuilder=$F.default;var LF=jp(vI());ar.PostgrestBuilder=LF.default;var VF=jp(yI());ar.PostgrestError=VF.default;ar.default={PostgrestClient:MF.default,PostgrestQueryBuilder:FF.default,PostgrestFilterBuilder:PF.default,PostgrestTransformBuilder:$F.default,PostgrestBuilder:LF.default,PostgrestError:VF.default}});var iL=ft((em,oL)=>{"use strict";var yie=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},pd=yie();oL.exports=em=pd.fetch;pd.fetch&&(em.default=pd.fetch.bind(pd));em.Headers=pd.Headers;em.Request=pd.Request;em.Response=pd.Response});var sL=ft(()=>{"use strict"});var HL=ft((WL,pD)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(WL,typeof pD=="object"&&pD,typeof define=="function"&&define)});var KL=ft((qL,fD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(qL,typeof fD=="object"&&fD,typeof define=="function"&&define)});var YL=ft((XL,mD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(XL,typeof mD=="object"&&mD,typeof define=="function"&&define)});var ZL=ft((QL,hD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(QL,typeof hD=="object"&&hD,typeof define=="function"&&define)});var e3=ft((JL,gD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(JL,typeof gD=="object"&&gD,typeof define=="function"&&define)});var n3=ft((t3,yD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(t3,typeof yD=="object"&&yD,typeof define=="function"&&define)});var Hb=ft(()=>{"use strict"});var r3=ft((NUe,qb)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(S,_,E){var I=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[S,b(t)]:S??x(),3),I),O=new f(I),R=function(){for(var $=O.g(o),G=a,W=0;$<l;)$=($+W)*r,G*=r,W=O.g(1);for(;$>=c;)$/=2,G/=2,W>>>=1;return($+W)/G};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(b(O.S),t),(_.pass||E||function($,G,W,q){return q&&(q.S&&m(q,O),$.state=function(){return m(O,{})}),W?(n[s]=$,G):$})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(S){var _,E=S.length,I=this,D=0,O=I.i=I.j=0,R=I.S=[];for(E||(S=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+S[D%E]+(_=R[D])],R[O]=_;(I.g=function($){for(var G,W=0,q=I.i,X=I.j,K=I.S;$--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return I.i=q,I.j=X,W})(r)}function m(S,_){return _.i=S.i,_.j=S.j,_.S=S.S.slice(),_}function h(S,_){var E=[],I=typeof S,D;if(_&&I=="object")for(D in S)try{E.push(h(S[D],_-1))}catch{}return E.length?E:I=="string"?S:S+"\0"}function g(S,_){for(var E=S+"",I,D=0;D<E.length;)_[u&D]=u&(I^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var S;return d&&(S=d.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),b(S)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(S){return String.fromCharCode.apply(0,S)}if(g(n.random(),t),typeof qb=="object"&&qb.exports){qb.exports=p;try{d=Hb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var i3=ft((kUe,o3)=>{"use strict";var Kae=HL(),Xae=KL(),Yae=YL(),Qae=ZL(),Zae=e3(),Jae=n3(),_d=r3();_d.alea=Kae;_d.xor128=Xae;_d.xorwow=Yae;_d.xorshift7=Qae;_d.xor4096=Zae;_d.tychei=Jae;o3.exports=_d});var M4=ft((O4,DN)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(O4,typeof DN=="object"&&DN,typeof define=="function"&&define)});var P4=ft((F4,NN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(F4,typeof NN=="object"&&NN,typeof define=="function"&&define)});var L4=ft(($4,kN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})($4,typeof kN=="object"&&kN,typeof define=="function"&&define)});var B4=ft((V4,AN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(V4,typeof AN=="object"&&AN,typeof define=="function"&&define)});var U4=ft((z4,RN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(z4,typeof RN=="object"&&RN,typeof define=="function"&&define)});var G4=ft((j4,ON)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(j4,typeof ON=="object"&&ON,typeof define=="function"&&define)});var W4=ft((Iwt,Hw)=>{"use strict";(function(t,n){var e=(0,eval)("this"),r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(S,_,E){var I=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[S,b(t)]:S??x(),3),I),O=new f(I),R=function(){for(var $=O.g(o),G=a,W=0;$<l;)$=($+W)*r,G*=r,W=O.g(1);for(;$>=c;)$/=2,G/=2,W>>>=1;return($+W)/G};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(b(O.S),t),(_.pass||E||function($,G,W,q){return q&&(q.S&&m(q,O),$.state=function(){return m(O,{})}),W?(n[s]=$,G):$})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(S){var _,E=S.length,I=this,D=0,O=I.i=I.j=0,R=I.S=[];for(E||(S=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+S[D%E]+(_=R[D])],R[O]=_;(I.g=function($){for(var G,W=0,q=I.i,X=I.j,K=I.S;$--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return I.i=q,I.j=X,W})(r)}function m(S,_){return _.i=S.i,_.j=S.j,_.S=S.S.slice(),_}function h(S,_){var E=[],I=typeof S,D;if(_&&I=="object")for(D in S)try{E.push(h(S[D],_-1))}catch{}return E.length?E:I=="string"?S:S+"\0"}function g(S,_){for(var E=S+"",I,D=0;D<E.length;)_[u&D]=u&(I^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var S;return d&&(S=d.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),b(S)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(S){return String.fromCharCode.apply(0,S)}if(g(n.random(),t),typeof Hw=="object"&&Hw.exports){Hw.exports=p;try{d=Hb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var MN=ft((Twt,H4)=>{"use strict";var gpe=M4(),ype=P4(),xpe=L4(),vpe=B4(),bpe=U4(),wpe=G4(),Vd=W4();Vd.alea=gpe;Vd.xor128=ype;Vd.xorwow=xpe;Vd.xorshift7=vpe;Vd.xor4096=bpe;Vd.tychei=wpe;H4.exports=Vd});var nG=ft((tG,mk)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(tG,typeof mk=="object"&&mk,typeof define=="function"&&define)});var oG=ft((rG,hk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(rG,typeof hk=="object"&&hk,typeof define=="function"&&define)});var sG=ft((iG,gk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(iG,typeof gk=="object"&&gk,typeof define=="function"&&define)});var lG=ft((aG,yk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(aG,typeof yk=="object"&&yk,typeof define=="function"&&define)});var uG=ft((cG,xk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(cG,typeof xk=="object"&&xk,typeof define=="function"&&define)});var pG=ft((dG,vk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(dG,typeof vk=="object"&&vk,typeof define=="function"&&define)});var fG=ft((jAt,lC)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(S,_,E){var I=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[S,b(t)]:S??x(),3),I),O=new f(I),R=function(){for(var $=O.g(o),G=a,W=0;$<l;)$=($+W)*r,G*=r,W=O.g(1);for(;$>=c;)$/=2,G/=2,W>>>=1;return($+W)/G};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(b(O.S),t),(_.pass||E||function($,G,W,q){return q&&(q.S&&m(q,O),$.state=function(){return m(O,{})}),W?(n[s]=$,G):$})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(S){var _,E=S.length,I=this,D=0,O=I.i=I.j=0,R=I.S=[];for(E||(S=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+S[D%E]+(_=R[D])],R[O]=_;(I.g=function($){for(var G,W=0,q=I.i,X=I.j,K=I.S;$--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return I.i=q,I.j=X,W})(r)}function m(S,_){return _.i=S.i,_.j=S.j,_.S=S.S.slice(),_}function h(S,_){var E=[],I=typeof S,D;if(_&&I=="object")for(D in S)try{E.push(h(S[D],_-1))}catch{}return E.length?E:I=="string"?S:S+"\0"}function g(S,_){for(var E=S+"",I,D=0;D<E.length;)_[u&D]=u&(I^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var S;return d&&(S=d.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),b(S)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(S){return String.fromCharCode.apply(0,S)}if(g(n.random(),t),typeof lC=="object"&&lC.exports){lC.exports=p;try{d=Hb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var hG=ft((GAt,mG)=>{"use strict";var Mme=nG(),Fme=oG(),Pme=sG(),$me=lG(),Lme=uG(),Vme=pG(),zd=fG();zd.alea=Mme;zd.xor128=Fme;zd.xorwow=Pme;zd.xorshift7=$me;zd.xor4096=Lme;zd.tychei=Vme;mG.exports=zd});function iA(t,n){return Object.is(t,n)}var Pn=null,Jm=!1,eS=1,Br=Symbol("SIGNAL");function wt(t){let n=Pn;return Pn=t,n}function sA(){return Pn}function y6(){return Jm}var iu={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Hy(t){if(Jm)throw new Error("");if(Pn===null)return;Pn.consumerOnSignalRead(t);let n=Pn.nextProducerIndex++;if(Ky(Pn),n<Pn.producerNode.length&&Pn.producerNode[n]!==t&&eh(Pn)){let e=Pn.producerNode[n];qy(e,Pn.producerIndexOfThis[n])}Pn.producerNode[n]!==t&&(Pn.producerNode[n]=t,Pn.producerIndexOfThis[n]=eh(Pn)?dA(t,Pn,n):0),Pn.producerLastReadVersion[n]=t.version}function x6(){eS++}function aA(t){if(!(eh(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===eS)){if(!t.producerMustRecompute(t)&&!nh(t)){oA(t);return}t.producerRecomputeValue(t),oA(t)}}function lA(t){if(t.liveConsumerNode===void 0)return;let n=Jm;Jm=!0;try{for(let e of t.liveConsumerNode)e.dirty||uA(e)}finally{Jm=n}}function cA(){return Pn?.consumerAllowSignalWrites!==!1}function uA(t){t.dirty=!0,lA(t),t.consumerMarkedDirty?.(t)}function oA(t){t.dirty=!1,t.lastCleanEpoch=eS}function Zd(t){return t&&(t.nextProducerIndex=0),wt(t)}function th(t,n){if(wt(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(eh(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)qy(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function nh(t){Ky(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(aA(e),r!==e.version))return!0}return!1}function Jd(t){if(Ky(t),eh(t))for(let n=0;n<t.producerNode.length;n++)qy(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function dA(t,n,e){if(pA(t),t.liveConsumerNode.length===0&&fA(t))for(let r=0;r<t.producerNode.length;r++)t.producerIndexOfThis[r]=dA(t.producerNode[r],t,r);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function qy(t,n){if(pA(t),t.liveConsumerNode.length===1&&fA(t))for(let r=0;r<t.producerNode.length;r++)qy(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];Ky(o),o.producerIndexOfThis[r]=n}}function eh(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function Ky(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function pA(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function fA(t){return t.producerNode!==void 0}function mA(t){let n=Object.create(v6);n.computation=t;let e=()=>{if(aA(n),Hy(n),n.value===Wy)throw n.error;return n.value};return e[Br]=n,e}var Q_=Symbol("UNSET"),Z_=Symbol("COMPUTING"),Wy=Symbol("ERRORED"),v6=qe(me({},iu),{value:Q_,dirty:!0,error:null,equal:iA,kind:"computed",producerMustRecompute(t){return t.value===Q_||t.value===Z_},producerRecomputeValue(t){if(t.value===Z_)throw new Error("Detected cycle in computations.");let n=t.value;t.value=Z_;let e=Zd(t),r,o=!1;try{r=t.computation(),wt(null),o=n!==Q_&&n!==Wy&&r!==Wy&&t.equal(n,r)}catch(i){r=Wy,t.error=i}finally{th(t,e)}if(o){t.value=n;return}t.value=r,t.version++}});function b6(){throw new Error}var hA=b6;function gA(){hA()}function yA(t){hA=t}var w6=null;function xA(t){let n=Object.create(tS);n.value=t;let e=()=>(Hy(n),n.value);return e[Br]=n,e}function Xy(t,n){cA()||gA(),t.equal(t.value,n)||(t.value=n,C6(t))}function vA(t,n){cA()||gA(),Xy(t,n(t.value))}var tS=qe(me({},iu),{equal:iA,value:void 0,kind:"signal"});function C6(t){t.version++,x6(),lA(t),w6?.()}function bA(t,n,e){let r=Object.create(_6);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;let o=l=>{r.cleanupFn=l};function i(l){return l.fn===null&&l.schedule===null}function s(l){i(l)||(Jd(l),l.cleanupFn(),l.fn=null,l.schedule=null,l.cleanupFn=J_)}let a=()=>{if(r.fn===null)return;if(y6())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(r.dirty=!1,r.hasRun&&!nh(r))return;r.hasRun=!0;let l=Zd(r);try{r.cleanupFn(),r.cleanupFn=J_,r.fn(o)}finally{th(r,l)}};return r.ref={notify:()=>uA(r),run:a,cleanup:()=>r.cleanupFn(),destroy:()=>s(r),[Br]:r},r.ref}var J_=()=>{},_6=qe(me({},iu),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule!==null&&t.schedule(t.ref)},hasRun:!1,cleanupFn:J_});function Qe(t){return typeof t=="function"}function ep(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Yy=ep(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function rh(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var En=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Qe(r))try{r()}catch(i){n=i instanceof Yy?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{wA(i)}catch(s){n=n??[],s instanceof Yy?n=[...n,...s.errors]:n.push(s)}}if(n)throw new Yy(n)}}add(n){var e;if(n&&n!==this)if(this.closed)wA(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&rh(e,n)}remove(n){let{_finalizers:e}=this;e&&rh(e,n),n instanceof t&&n._removeParent(this)}};En.EMPTY=(()=>{let t=new En;return t.closed=!0,t})();var nS=En.EMPTY;function Qy(t){return t instanceof En||t&&"closed"in t&&Qe(t.remove)&&Qe(t.add)&&Qe(t.unsubscribe)}function wA(t){Qe(t)?t():t.unsubscribe()}var mi={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var tp={setTimeout(t,n,...e){let{delegate:r}=tp;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=tp;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Zy(t){tp.setTimeout(()=>{let{onUnhandledError:n}=mi;if(n)n(t);else throw t})}function oh(){}var CA=rS("C",void 0,void 0);function _A(t){return rS("E",void 0,t)}function SA(t){return rS("N",t,void 0)}function rS(t,n,e){return{kind:t,value:n,error:e}}var su=null;function np(t){if(mi.useDeprecatedSynchronousErrorHandling){let n=!su;if(n&&(su={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=su;if(su=null,e)throw r}}else t()}function EA(t){mi.useDeprecatedSynchronousErrorHandling&&su&&(su.errorThrown=!0,su.error=t)}var au=class extends En{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Qy(n)&&n.add(this)):this.destination=I6}static create(n,e,r){return new rp(n,e,r)}next(n){this.isStopped?iS(SA(n),this):this._next(n)}error(n){this.isStopped?iS(_A(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?iS(CA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},S6=Function.prototype.bind;function oS(t,n){return S6.call(t,n)}var sS=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Jy(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Jy(r)}else Jy(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Jy(e)}}},rp=class extends au{constructor(n,e,r){super();let o;if(Qe(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&mi.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&oS(n.next,i),error:n.error&&oS(n.error,i),complete:n.complete&&oS(n.complete,i)}):o=n}this.destination=new sS(o)}};function Jy(t){mi.useDeprecatedSynchronousErrorHandling?EA(t):Zy(t)}function E6(t){throw t}function iS(t,n){let{onStoppedNotification:e}=mi;e&&tp.setTimeout(()=>e(t,n))}var I6={closed:!0,next:oh,error:E6,complete:oh};var op=typeof Symbol=="function"&&Symbol.observable||"@@observable";function so(t){return t}function aS(...t){return lS(t)}function lS(t){return t.length===0?so:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var Ct=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=D6(e)?e:new rp(e,r,o);return np(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=IA(r),new r((o,i)=>{let s=new rp({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[op](){return this}pipe(...e){return lS(e)(this)}toPromise(e){return e=IA(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return t.create=n=>new t(n),t})();function IA(t){var n;return(n=t??mi.Promise)!==null&&n!==void 0?n:Promise}function T6(t){return t&&Qe(t.next)&&Qe(t.error)&&Qe(t.complete)}function D6(t){return t&&t instanceof au||T6(t)&&Qy(t)}function cS(t){return Qe(t?.lift)}function _t(t){return n=>{if(cS(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function mt(t,n,e,r,o){return new uS(t,n,e,r,o)}var uS=class extends au{constructor(n,e,r,o,i,s){super(n),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){n.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function ip(){return _t((t,n)=>{let e=null;t._refCount++;let r=mt(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var sp=class extends Ct{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,cS(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new En;let e=this.getSubject();n.add(this.source.subscribe(mt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=En.EMPTY)}return n}refCount(){return ip()(this)}};var TA=ep(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var $n=(()=>{class t extends Ct{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new e0(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new TA}next(e){np(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){np(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){np(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?nS:(this.currentObservers=null,i.push(e),new En(()=>{this.currentObservers=null,rh(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new Ct;return e.source=this,e}}return t.create=(n,e)=>new e0(n,e),t})(),e0=class extends $n{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:nS}};var rr=class extends $n{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var zr=new Ct(t=>t.complete());function DA(t){return t&&Qe(t.schedule)}function NA(t){return t[t.length-1]}function t0(t){return Qe(NA(t))?t.pop():void 0}function yl(t){return DA(NA(t))?t.pop():void 0}function AA(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})}function kA(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function lu(t){return this instanceof lu?(this.v=t,this):new lu(t)}function RA(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){r[f]&&(o[f]=function(h){return new Promise(function(g,x){i.push([f,h,g,x])>1||l(f,h)})},m&&(o[f]=m(o[f])))}function l(f,m){try{c(r[f](m))}catch(h){p(i[0][3],h)}}function c(f){f.value instanceof lu?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function p(f,m){f(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function OA(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof kA=="function"?kA(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}var n0=t=>t&&typeof t.length=="number"&&typeof t!="function";function r0(t){return Qe(t?.then)}function o0(t){return Qe(t[op])}function i0(t){return Symbol.asyncIterator&&Qe(t?.[Symbol.asyncIterator])}function s0(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function N6(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var a0=N6();function l0(t){return Qe(t?.[a0])}function c0(t){return RA(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield lu(e.read());if(o)return yield lu(void 0);yield yield lu(r)}}finally{e.releaseLock()}})}function u0(t){return Qe(t?.getReader)}function In(t){if(t instanceof Ct)return t;if(t!=null){if(o0(t))return k6(t);if(n0(t))return A6(t);if(r0(t))return R6(t);if(i0(t))return MA(t);if(l0(t))return O6(t);if(u0(t))return M6(t)}throw s0(t)}function k6(t){return new Ct(n=>{let e=t[op]();if(Qe(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function A6(t){return new Ct(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function R6(t){return new Ct(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Zy)})}function O6(t){return new Ct(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function MA(t){return new Ct(n=>{F6(t,n).catch(e=>n.error(e))})}function M6(t){return MA(c0(t))}function F6(t,n){var e,r,o,i;return AA(this,void 0,void 0,function*(){try{for(e=OA(t);r=yield e.next(),!r.done;){let s=r.value;if(n.next(s),n.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function Ur(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function d0(t,n=0){return _t((e,r)=>{e.subscribe(mt(r,o=>Ur(r,t,()=>r.next(o),n),()=>Ur(r,t,()=>r.complete(),n),o=>Ur(r,t,()=>r.error(o),n)))})}function p0(t,n=0){return _t((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function FA(t,n){return In(t).pipe(p0(n),d0(n))}function PA(t,n){return In(t).pipe(p0(n),d0(n))}function $A(t,n){return new Ct(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function LA(t,n){return new Ct(e=>{let r;return Ur(e,n,()=>{r=t[a0](),Ur(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>Qe(r?.return)&&r.return()})}function f0(t,n){if(!t)throw new Error("Iterable cannot be null");return new Ct(e=>{Ur(e,n,()=>{let r=t[Symbol.asyncIterator]();Ur(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function VA(t,n){return f0(c0(t),n)}function BA(t,n){if(t!=null){if(o0(t))return FA(t,n);if(n0(t))return $A(t,n);if(r0(t))return PA(t,n);if(i0(t))return f0(t,n);if(l0(t))return LA(t,n);if(u0(t))return VA(t,n)}throw s0(t)}function mn(t,n){return n?BA(t,n):In(t)}function Ke(...t){let n=yl(t);return mn(t,n)}function ap(t,n){let e=Qe(t)?t:()=>t,r=o=>o.error(e());return new Ct(n?o=>n.schedule(r,0,o):r)}function dS(t){return!!t&&(t instanceof Ct||Qe(t.lift)&&Qe(t.subscribe))}var Ss=ep(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function nt(t,n){return _t((e,r)=>{let o=0;e.subscribe(mt(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:P6}=Array;function $6(t,n){return P6(n)?t(...n):t(n)}function m0(t){return nt(n=>$6(t,n))}var{isArray:L6}=Array,{getPrototypeOf:V6,prototype:B6,keys:z6}=Object;function h0(t){if(t.length===1){let n=t[0];if(L6(n))return{args:n,keys:null};if(U6(n)){let e=z6(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function U6(t){return t&&typeof t=="object"&&V6(t)===B6}function g0(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function y0(...t){let n=yl(t),e=t0(t),{args:r,keys:o}=h0(t);if(r.length===0)return mn([],n);let i=new Ct(j6(r,n,o?s=>g0(o,s):so));return e?i.pipe(m0(e)):i}function j6(t,n,e=so){return r=>{zA(n,()=>{let{length:o}=t,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)zA(n,()=>{let c=mn(t[l],n),u=!1;c.subscribe(mt(r,d=>{i[l]=d,u||(u=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function zA(t,n,e){t?Ur(e,t,n):n()}function UA(t,n,e,r,o,i,s,a){let l=[],c=0,u=0,d=!1,p=()=>{d&&!l.length&&!c&&n.complete()},f=h=>c<r?m(h):l.push(h),m=h=>{i&&n.next(h),c++;let g=!1;In(e(h,u++)).subscribe(mt(n,x=>{o?.(x),i?f(x):n.next(x)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){let x=l.shift();s?Ur(n,s,()=>m(x)):m(x)}p()}catch(x){n.error(x)}}))};return t.subscribe(mt(n,f,()=>{d=!0,p()})),()=>{a?.()}}function Ln(t,n,e=1/0){return Qe(n)?Ln((r,o)=>nt((i,s)=>n(r,i,o,s))(In(t(r,o))),e):(typeof n=="number"&&(e=n),_t((r,o)=>UA(r,o,t,e)))}function pS(t=1/0){return Ln(so,t)}function jA(){return pS(1)}function lp(...t){return jA()(mn(t,yl(t)))}function x0(t){return new Ct(n=>{In(t()).subscribe(n)})}function fS(...t){let n=t0(t),{args:e,keys:r}=h0(t),o=new Ct(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let d=!1;In(e[u]).subscribe(mt(i,p=>{d||(d=!0,c--),a[u]=p},()=>l--,void 0,()=>{(!l||!d)&&(c||i.next(r?g0(r,a):a),i.complete())}))}});return n?o.pipe(m0(n)):o}function ao(t,n){return _t((e,r)=>{let o=0;e.subscribe(mt(r,i=>t.call(n,i,o++)&&r.next(i)))})}function xl(t){return _t((n,e)=>{let r=null,o=!1,i;r=n.subscribe(mt(e,void 0,void 0,s=>{i=In(t(s,xl(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function GA(t,n,e,r,o){return(i,s)=>{let a=e,l=n,c=0;i.subscribe(mt(s,u=>{let d=c++;l=a?t(l,u,d):(a=!0,u),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function vl(t,n){return Qe(n)?Ln(t,n,1):Ln(t,1)}function bl(t){return _t((n,e)=>{let r=!1;n.subscribe(mt(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function Es(t){return t<=0?()=>zr:_t((n,e)=>{let r=0;n.subscribe(mt(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function v0(t=G6){return _t((n,e)=>{let r=!1;n.subscribe(mt(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function G6(){return new Ss}function cu(t){return _t((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function Is(t,n){let e=arguments.length>=2;return r=>r.pipe(t?ao((o,i)=>t(o,i,r)):so,Es(1),e?bl(n):v0(()=>new Ss))}function cp(t){return t<=0?()=>zr:_t((n,e)=>{let r=[];n.subscribe(mt(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function mS(t,n){let e=arguments.length>=2;return r=>r.pipe(t?ao((o,i)=>t(o,i,r)):so,cp(1),e?bl(n):v0(()=>new Ss))}function hS(t,n){return _t(GA(t,n,arguments.length>=2,!0))}function gS(...t){let n=yl(t);return _t((e,r)=>{(n?lp(t,e,n):lp(t,e)).subscribe(r)})}function lo(t,n){return _t((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(mt(r,l=>{o?.unsubscribe();let c=0,u=i++;In(t(l,u)).subscribe(o=mt(r,d=>r.next(n?n(l,d,u,c++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function yS(t){return _t((n,e)=>{In(t).subscribe(mt(e,()=>e.complete(),oh)),!e.closed&&n.subscribe(e)})}function Wn(t,n,e){let r=Qe(t)||n||e?{next:t,error:n,complete:e}:t;return r?_t((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(mt(i,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),i.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):so}var DR="https://g.co/ng/security#xss",De=class extends Error{code;constructor(n,e){super(ix(n,e)),this.code=n}};function ix(t,n){return`${`NG0${Math.abs(t)}`}${n?": "+n:""}`}var NR=Symbol("InputSignalNode#UNSET"),W6=qe(me({},tS),{transformFn:void 0,applyValueToInputSignal(t,n){Xy(t,n)}});function kR(t,n){let e=Object.create(W6);e.value=t,e.transformFn=n?.transform;function r(){if(Hy(e),e.value===NR)throw new De(-950,!1);return e.value}return r[Br]=e,r}function yh(t){return{toString:t}.toString()}var b0="__parameters__";function H6(t){return function(...e){if(t){let r=t(...e);for(let o in r)this[o]=r[o]}}}function AR(t,n,e){return yh(()=>{let r=H6(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,c,u){let d=l.hasOwnProperty(b0)?l[b0]:Object.defineProperty(l,b0,{value:[]})[b0];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var du=globalThis;function Xt(t){for(let n in t)if(t[n]===Xt)return n;throw Error("Could not find renamed property on target object.")}function q6(t,n){for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Dr(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Dr).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let n=t.toString();if(n==null)return""+n;let e=n.indexOf(`
`);return e===-1?n:n.substring(0,e)}function kS(t,n){return t==null||t===""?n===null?"":n:n==null||n===""?t:t+" "+n}var K6=Xt({__forward_ref__:Xt});function or(t){return t.__forward_ref__=or,t.toString=function(){return Dr(this())},t}function Tr(t){return RR(t)?t():t}function RR(t){return typeof t=="function"&&t.hasOwnProperty(K6)&&t.__forward_ref__===or}function Re(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ms(t){return{providers:t.providers||[],imports:t.imports||[]}}function sx(t){return WA(t,MR)||WA(t,FR)}function OR(t){return sx(t)!==null}function WA(t,n){return t.hasOwnProperty(n)?t[n]:null}function X6(t){let n=t&&(t[MR]||t[FR]);return n||null}function HA(t){return t&&(t.hasOwnProperty(qA)||t.hasOwnProperty(Y6))?t[qA]:null}var MR=Xt({\u0275prov:Xt}),qA=Xt({\u0275inj:Xt}),FR=Xt({ngInjectableDef:Xt}),Y6=Xt({ngInjectorDef:Xt}),Me=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=Re({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function PR(t){return t&&!!t.\u0275providers}var Q6=Xt({\u0275cmp:Xt}),Z6=Xt({\u0275dir:Xt}),J6=Xt({\u0275pipe:Xt}),eK=Xt({\u0275mod:Xt}),k0=Xt({\u0275fac:Xt}),lh=Xt({__NG_ELEMENT_ID__:Xt}),KA=Xt({__NG_ENV_ID__:Xt});function Ts(t){return typeof t=="string"?t:t==null?"":String(t)}function tK(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Ts(t)}function nK(t,n){let e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new De(-200,t)}function yE(t,n){throw new De(-201,!1)}var at=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(at||{}),AS;function $R(){return AS}function jr(t){let n=AS;return AS=t,n}function LR(t,n,e){let r=sx(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&at.Optional)return null;if(n!==void 0)return n;yE(t,"Injector")}var rK={},ch=rK,RS="__NG_DI_FLAG__",A0="ngTempTokenPath",oK="ngTokenPath",iK=/\n/gm,sK="\u0275",XA="__source",fp;function aK(){return fp}function wl(t){let n=fp;return fp=t,n}function lK(t,n=at.Default){if(fp===void 0)throw new De(-203,!1);return fp===null?LR(t,void 0,n):fp.get(t,n&at.Optional?null:void 0,n)}function $e(t,n=at.Default){return($R()||lK)(Tr(t),n)}function pe(t,n=at.Default){return $e(t,ax(n))}function ax(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function OS(t){let n=[];for(let e=0;e<t.length;e++){let r=Tr(t[e]);if(Array.isArray(r)){if(r.length===0)throw new De(900,!1);let o,i=at.Default;for(let s=0;s<r.length;s++){let a=r[s],l=cK(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}n.push($e(o,i))}else n.push($e(r))}return n}function VR(t,n){return t[RS]=n,t.prototype[RS]=n,t}function cK(t){return t[RS]}function uK(t,n,e,r){let o=t[A0];throw n[XA]&&o.unshift(n[XA]),t.message=dK(`
`+t.message,o,e,r),t[oK]=o,t[A0]=null,t}function dK(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==sK?t.slice(2):t;let o=Dr(n);if(Array.isArray(n))o=n.map(Dr).join(" -> ");else if(typeof n=="object"){let i=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Dr(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(iK,`
  `)}`}var BR=VR(AR("Optional"),8);var pK=VR(AR("SkipSelf"),4);function fu(t,n){let e=t.hasOwnProperty(k0);return e?t[k0]:null}function xE(t,n){t.forEach(e=>Array.isArray(e)?xE(e,n):n(e))}function zR(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function R0(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function fK(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(o===1)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;){let i=o-2;t[o]=t[i],o--}t[n]=e,t[n+1]=r}}function vE(t,n,e){let r=xh(t,n);return r>=0?t[r|1]=e:(r=~r,fK(t,r,n,e)),r}function xS(t,n){let e=xh(t,n);if(e>=0)return t[e|1]}function xh(t,n){return mK(t,n,1)}function mK(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=t[i<<e];if(n===s)return i<<e;s>n?o=i:r=i+1}return~(o<<e)}var hp={},Gr=[],gp=new Me(""),UR=new Me("",-1),jR=new Me(""),O0=class{get(n,e=ch){if(e===ch){let r=new Error(`NullInjectorError: No provider for ${Dr(n)}!`);throw r.name="NullInjectorError",r}return e}};function GR(t,n){let e=t[eK]||null;if(!e&&n===!0)throw new Error(`Type ${Dr(t)} does not have '\u0275mod' property.`);return e}function mu(t){return t[Q6]||null}function WR(t){return t[Z6]||null}function HR(t){return t[J6]||null}function qR(t){let n=mu(t)||WR(t)||HR(t);return n!==null&&n.standalone}function Ep(t){return{\u0275providers:t}}function hK(...t){return{\u0275providers:KR(!0,t),\u0275fromNgModule:!0}}function KR(t,...n){let e=[],r=new Set,o,i=s=>{e.push(s)};return xE(n,s=>{let a=s;MS(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&XR(o,i),e}function XR(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];bE(o,i=>{n(i,r)})}}function MS(t,n,e,r){if(t=Tr(t),!t)return!1;let o=null,i=HA(t),s=!i&&mu(t);if(!i&&!s){let l=t.ngModule;if(i=HA(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=t}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)MS(c,n,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let c;try{xE(i.imports,u=>{MS(u,n,e,r)&&(c||=[],c.push(u))})}finally{}c!==void 0&&XR(c,n)}if(!a){let c=fu(o)||(()=>new o);n({provide:o,useFactory:c,deps:Gr},o),n({provide:jR,useValue:o,multi:!0},o),n({provide:gp,useValue:()=>$e(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let c=t;bE(l,u=>{n(u,c)})}}else return!1;return o!==t&&t.providers!==void 0}function bE(t,n){for(let e of t)PR(e)&&(e=e.\u0275providers),Array.isArray(e)?bE(e,n):n(e)}var gK=Xt({provide:String,useValue:Xt});function YR(t){return t!==null&&typeof t=="object"&&gK in t}function yK(t){return!!(t&&t.useExisting)}function xK(t){return!!(t&&t.useFactory)}function yp(t){return typeof t=="function"}function vK(t){return!!t.useClass}var lx=new Me(""),S0={},bK={},vS;function wE(){return vS===void 0&&(vS=new O0),vS}var Wr=class{},uh=class extends Wr{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,PS(n,s=>this.processProvider(s)),this.records.set(UR,up(void 0,this)),o.has("environment")&&this.records.set(Wr,up(void 0,this));let i=this.records.get(lx);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(jR,Gr,at.Self))}destroy(){sh(this),this._destroyed=!0;let n=wt(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),wt(n)}}onDestroy(n){return sh(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){sh(this);let e=wl(this),r=jr(void 0),o;try{return n()}finally{wl(e),jr(r)}}get(n,e=ch,r=at.Default){if(sh(this),n.hasOwnProperty(KA))return n[KA](this);r=ax(r);let o,i=wl(this),s=jr(void 0);try{if(!(r&at.SkipSelf)){let l=this.records.get(n);if(l===void 0){let c=EK(n)&&sx(n);c&&this.injectableDefInScope(c)?l=up(FS(n),S0):l=null,this.records.set(n,l)}if(l!=null)return this.hydrate(n,l)}let a=r&at.Self?wE():this.parent;return e=r&at.Optional&&e===ch?null:e,a.get(n,e)}catch(a){if(a.name==="NullInjectorError"){if((a[A0]=a[A0]||[]).unshift(Dr(n)),i)throw a;return uK(a,n,"R3InjectorError",this.source)}else throw a}finally{jr(s),wl(i)}}resolveInjectorInitializers(){let n=wt(null),e=wl(this),r=jr(void 0),o;try{let i=this.get(gp,Gr,at.Self);for(let s of i)s()}finally{wl(e),jr(r),wt(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Dr(r));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Tr(n);let e=yp(n)?n:Tr(n&&n.provide),r=CK(n);if(!yp(n)&&n.multi===!0){let o=this.records.get(e);o||(o=up(void 0,S0,!0),o.factory=()=>OS(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){let r=wt(null);try{return e.value===S0&&(e.value=bK,e.value=e.factory()),typeof e.value=="object"&&e.value&&SK(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{wt(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=Tr(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function FS(t){let n=sx(t),e=n!==null?n.factory:fu(t);if(e!==null)return e;if(t instanceof Me)throw new De(204,!1);if(t instanceof Function)return wK(t);throw new De(204,!1)}function wK(t){if(t.length>0)throw new De(204,!1);let e=X6(t);return e!==null?()=>e.factory(t):()=>new t}function CK(t){if(YR(t))return up(void 0,t.useValue);{let n=QR(t);return up(n,S0)}}function QR(t,n,e){let r;if(yp(t)){let o=Tr(t);return fu(o)||FS(o)}else if(YR(t))r=()=>Tr(t.useValue);else if(xK(t))r=()=>t.useFactory(...OS(t.deps||[]));else if(yK(t))r=()=>$e(Tr(t.useExisting));else{let o=Tr(t&&(t.useClass||t.provide));if(_K(t))r=()=>new o(...OS(t.deps));else return fu(o)||FS(o)}return r}function sh(t){if(t.destroyed)throw new De(205,!1)}function up(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function _K(t){return!!t.deps}function SK(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function EK(t){return typeof t=="function"||typeof t=="object"&&t instanceof Me}function PS(t,n){for(let e of t)Array.isArray(e)?PS(e,n):e&&PR(e)?PS(e.\u0275providers,n):n(e)}function ir(t,n){t instanceof uh&&sh(t);let e,r=wl(t),o=jr(void 0);try{return n()}finally{wl(r),jr(o)}}function ZR(){return $R()!==void 0||aK()!=null}function JR(t){if(!ZR())throw new De(-203,!1)}function IK(t){return typeof t=="function"}var Fs=0,St=1,Xe=2,Nr=3,yi=4,xi=5,M0=6,F0=7,No=8,dh=9,Ds=10,xn=11,ph=12,YA=13,Ip=14,qi=15,xp=16,dp=17,vp=18,cx=19,e2=20,Cl=21,E0=22,hu=23,co=24,ko=25,t2=1;var gu=7,P0=8,$0=9,Do=10;function _l(t){return Array.isArray(t)&&typeof t[t2]=="object"}function Ps(t){return Array.isArray(t)&&t[t2]===!0}function CE(t){return(t.flags&4)!==0}function _u(t){return t.componentOffset>-1}function ux(t){return(t.flags&1)===1}function Ns(t){return!!t.template}function L0(t){return(t[Xe]&512)!==0}function vh(t){return(t[Xe]&256)===256}var $S=class{previousValue;currentValue;firstChange;constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function n2(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}var vi=(()=>{let t=()=>r2;return t.ngInherit=!0,t})();function r2(t){return t.type.prototype.ngOnChanges&&(t.setInput=DK),TK}function TK(){let t=i2(this),n=t?.current;if(n){let e=t.previous;if(e===hp)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function DK(t,n,e,r,o){let i=this.declaredInputs[r],s=i2(t)||NK(t,{previous:hp,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[i];a[i]=new $S(c&&c.currentValue,e,l===hp),n2(t,n,o,e)}var o2="__ngSimpleChanges__";function i2(t){return t[o2]||null}function NK(t,n){return t[o2]=n}var QA=null;var To=function(t,n,e){QA?.(t,n,e)},kK="svg",AK="math";function Ki(t){for(;Array.isArray(t);)t=t[Fs];return t}function s2(t,n){return Ki(n[t])}function bi(t,n){return Ki(n[t.index])}function a2(t,n){return t.data[n]}function RK(t,n){return t[n]}function Xi(t,n){let e=n[t];return _l(e)?e:e[Fs]}function _E(t){return(t[Xe]&128)===128}function OK(t){return Ps(t[Nr])}function bp(t,n){return n==null?null:t[n]}function l2(t){t[dp]=0}function SE(t){t[Xe]&1024||(t[Xe]|=1024,_E(t)&&bh(t))}function MK(t,n){for(;t>0;)n=n[Ip],t--;return n}function dx(t){return!!(t[Xe]&9216||t[co]?.dirty)}function LS(t){t[Ds].changeDetectionScheduler?.notify(9),t[Xe]&64&&(t[Xe]|=1024),dx(t)&&bh(t)}function bh(t){t[Ds].changeDetectionScheduler?.notify(0);let n=yu(t);for(;n!==null&&!(n[Xe]&8192||(n[Xe]|=8192,!_E(n)));)n=yu(n)}function c2(t,n){if(vh(t))throw new De(911,!1);t[Cl]===null&&(t[Cl]=[]),t[Cl].push(n)}function FK(t,n){if(t[Cl]===null)return;let e=t[Cl].indexOf(n);e!==-1&&t[Cl].splice(e,1)}function yu(t){let n=t[Nr];return Ps(n)?n[Nr]:n}function PK(t){return t[F0]??=[]}function $K(t){return t.cleanup??=[]}var ct={lFrame:x2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var VS=!1;function LK(){return ct.lFrame.elementDepthCount}function VK(){ct.lFrame.elementDepthCount++}function BK(){ct.lFrame.elementDepthCount--}function u2(){return ct.bindingsEnabled}function zK(){return ct.skipHydrationRootTNode!==null}function UK(t){return ct.skipHydrationRootTNode===t}function jK(){ct.skipHydrationRootTNode=null}function Et(){return ct.lFrame.lView}function qn(){return ct.lFrame.tView}function ge(t){return ct.lFrame.contextLView=t,t[No]}function ye(t){return ct.lFrame.contextLView=null,t}function kr(){let t=d2();for(;t!==null&&t.type===64;)t=t.parent;return t}function d2(){return ct.lFrame.currentTNode}function GK(){let t=ct.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function Su(t,n){let e=ct.lFrame;e.currentTNode=t,e.isParent=n}function EE(){return ct.lFrame.isParent}function p2(){ct.lFrame.isParent=!1}function f2(){return VS}function V0(t){let n=VS;return VS=t,n}function IE(){let t=ct.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function m2(){return ct.lFrame.bindingIndex}function WK(t){return ct.lFrame.bindingIndex=t}function px(){return ct.lFrame.bindingIndex++}function fx(t){let n=ct.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function HK(){return ct.lFrame.inI18n}function qK(t,n){let e=ct.lFrame;e.bindingIndex=e.bindingRootIndex=t,BS(n)}function KK(){return ct.lFrame.currentDirectiveIndex}function BS(t){ct.lFrame.currentDirectiveIndex=t}function XK(t){let n=ct.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function h2(t){ct.lFrame.currentQueryIndex=t}function YK(t){let n=t[St];return n.type===2?n.declTNode:n.type===1?t[xi]:null}function g2(t,n,e){if(e&at.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&at.Host);)if(o=YK(i),o===null||(i=i[Ip],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=ct.lFrame=y2();return r.currentTNode=n,r.lView=t,!0}function TE(t){let n=y2(),e=t[St];ct.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function y2(){let t=ct.lFrame,n=t===null?null:t.child;return n===null?x2(t):n}function x2(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function v2(){let t=ct.lFrame;return ct.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var b2=v2;function DE(){let t=v2();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function QK(t){return(ct.lFrame.contextLView=MK(t,ct.lFrame.contextLView))[No]}function $s(){return ct.lFrame.selectedIndex}function xu(t){ct.lFrame.selectedIndex=t}function mx(){let t=ct.lFrame;return a2(t.tView,t.selectedIndex)}function ZK(){return ct.lFrame.currentNamespace}var w2=!0;function hx(){return w2}function gx(t){w2=t}function JK(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let s=r2(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function yx(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),l&&(t.viewHooks??=[]).push(-e,l),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),u!=null&&(t.destroyHooks??=[]).push(e,u)}}function I0(t,n,e){C2(t,n,3,e)}function T0(t,n,e,r){(t[Xe]&3)===e&&C2(t,n,e,r)}function bS(t,n){let e=t[Xe];(e&3)===n&&(e&=16383,e+=1,t[Xe]=e)}function C2(t,n,e,r){let o=r!==void 0?t[dp]&65535:0,i=r??-1,s=n.length-1,a=0;for(let l=o;l<s;l++)if(typeof n[l+1]=="number"){if(a=n[l],r!=null&&a>=r)break}else n[l]<0&&(t[dp]+=65536),(a<i||i==-1)&&(e7(t,e,n,l),t[dp]=(t[dp]&4294901760)+l+2),l++}function ZA(t,n){To(4,t,n);let e=wt(null);try{n.call(t)}finally{wt(e),To(5,t,n)}}function e7(t,n,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=t[s];o?t[Xe]>>14<t[dp]>>16&&(t[Xe]&3)===n&&(t[Xe]+=16384,ZA(a,i)):ZA(a,i)}var mp=-1,vu=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,r){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=r}};function t7(t){return t instanceof vu}function n7(t){return(t.flags&8)!==0}function r7(t){return(t.flags&16)!==0}function o7(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,i)}else{let i=o,s=e[++r];i7(i)?t.setProperty(n,i,s):t.setAttribute(n,i,s),r++}}return r}function _2(t){return t===3||t===4||t===6}function i7(t){return t.charCodeAt(0)===64}function wp(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?JA(t,e,o,null,n[++r]):JA(t,e,o,null,null))}}return t}function JA(t,n,e,r,o){let i=0,s=t.length;if(n===-1)s=-1;else for(;i<t.length;){let a=t[i++];if(typeof a=="number"){if(a===n){s=-1;break}else if(a>n){s=i-1;break}}}for(;i<t.length;){let a=t[i];if(typeof a=="number")break;if(a===e){if(r===null){o!==null&&(t[i+1]=o);return}else if(r===t[i+1]){t[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}s!==-1&&(t.splice(s,0,n),i=s+1),t.splice(i++,0,e),r!==null&&t.splice(i++,0,r),o!==null&&t.splice(i++,0,o)}var wS={},zS=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=ax(r);let o=this.injector.get(n,wS,r);return o!==wS||e===wS?o:this.parentInjector.get(n,e,r)}};function S2(t){return t!==mp}function B0(t){return t&32767}function s7(t){return t>>16}function z0(t,n){let e=s7(t),r=n;for(;e>0;)r=r[Ip],e--;return r}var US=!0;function U0(t){let n=US;return US=t,n}var a7=256,E2=a7-1,I2=5,l7=0,Hi={};function c7(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(lh)&&(r=e[lh]),r==null&&(r=e[lh]=l7++);let o=r&E2,i=1<<o;n.data[t+(o>>I2)]|=i}function j0(t,n){let e=T2(t,n);if(e!==-1)return e;let r=n[St];r.firstCreatePass&&(t.injectorIndex=n.length,CS(r.data,t),CS(n,null),CS(r.blueprint,null));let o=NE(t,n),i=t.injectorIndex;if(S2(o)){let s=B0(o),a=z0(o,n),l=a[St].data;for(let c=0;c<8;c++)n[i+c]=a[s+c]|l[s+c]}return n[i+8]=o,i}function CS(t,n){t.push(0,0,0,0,0,0,0,0,n)}function T2(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function NE(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=R2(o),r===null)return mp;if(e++,o=o[Ip],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return mp}function jS(t,n,e){c7(t,n,e)}function u7(t,n){if(n==="class")return t.classes;if(n==="style")return t.styles;let e=t.attrs;if(e){let r=e.length,o=0;for(;o<r;){let i=e[o];if(_2(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<r&&typeof e[o]=="string";)o++;else{if(i===n)return e[o+1];o=o+2}}}return null}function D2(t,n,e){if(e&at.Optional||t!==void 0)return t;yE(n,"NodeInjector")}function N2(t,n,e,r){if(e&at.Optional&&r===void 0&&(r=null),!(e&(at.Self|at.Host))){let o=t[dh],i=jr(void 0);try{return o?o.get(n,r,e&at.Optional):LR(n,r,e&at.Optional)}finally{jr(i)}}return D2(r,n,e)}function k2(t,n,e,r=at.Default,o){if(t!==null){if(n[Xe]&2048&&!(r&at.Self)){let s=h7(t,n,e,r,Hi);if(s!==Hi)return s}let i=A2(t,n,e,r,Hi);if(i!==Hi)return i}return N2(n,e,r,o)}function A2(t,n,e,r,o){let i=f7(e);if(typeof i=="function"){if(!g2(n,t,r))return r&at.Host?D2(o,e,r):N2(n,e,r,o);try{let s;if(s=i(r),s==null&&!(r&at.Optional))yE(e);else return s}finally{b2()}}else if(typeof i=="number"){let s=null,a=T2(t,n),l=mp,c=r&at.Host?n[qi][xi]:null;for((a===-1||r&at.SkipSelf)&&(l=a===-1?NE(t,n):n[a+8],l===mp||!tR(r,!1)?a=-1:(s=n[St],a=B0(l),n=z0(l,n)));a!==-1;){let u=n[St];if(eR(i,a,u.data)){let d=d7(a,n,e,s,r,c);if(d!==Hi)return d}l=n[a+8],l!==mp&&tR(r,n[St].data[a+8]===c)&&eR(i,a,n)?(s=u,a=B0(l),n=z0(l,n)):a=-1}}return o}function d7(t,n,e,r,o,i){let s=n[St],a=s.data[t+8],l=r==null?_u(a)&&US:r!=s&&(a.type&3)!==0,c=o&at.Host&&i===a,u=p7(a,s,e,l,c);return u!==null?G0(n,s,u,a):Hi}function p7(t,n,e,r,o){let i=t.providerIndexes,s=n.data,a=i&1048575,l=t.directiveStart,c=t.directiveEnd,u=i>>20,d=r?a:a+u,p=o?a+u:c;for(let f=d;f<p;f++){let m=s[f];if(f<l&&e===m||f>=l&&m.type===e)return f}if(o){let f=s[l];if(f&&Ns(f)&&f.type===e)return l}return null}function G0(t,n,e,r){let o=t[e],i=n.data;if(t7(o)){let s=o;s.resolving&&nK(tK(i[e]));let a=U0(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?jr(s.injectImpl):null,u=g2(t,r,at.Default);try{o=t[e]=s.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&JK(e,i[e],n)}finally{c!==null&&jr(c),U0(a),s.resolving=!1,b2()}}return o}function f7(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(lh)?t[lh]:void 0;return typeof n=="number"?n>=0?n&E2:m7:n}function eR(t,n,e){let r=1<<t;return!!(e[n+(t>>I2)]&r)}function tR(t,n){return!(t&at.Self)&&!(t&at.Host&&n)}var pu=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return k2(this._tNode,this._lView,n,ax(r),e)}};function m7(){return new pu(kr(),Et())}function Ao(t){return yh(()=>{let n=t.prototype.constructor,e=n[k0]||GS(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[k0]||GS(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function GS(t){return RR(t)?()=>{let n=GS(Tr(t));return n&&n()}:fu(t)}function h7(t,n,e,r,o){let i=t,s=n;for(;i!==null&&s!==null&&s[Xe]&2048&&!L0(s);){let a=A2(i,s,e,r|at.Self,Hi);if(a!==Hi)return a;let l=i.parent;if(!l){let c=s[e2];if(c){let u=c.get(e,Hi,r);if(u!==Hi)return u}l=R2(s),s=s[Ip]}i=l}return o}function R2(t){let n=t[St],e=n.type;return e===2?n.declTNode:e===1?t[xi]:null}function kE(t){return u7(kr(),t)}function nR(t,n=null,e=null,r){let o=O2(t,n,e,r);return o.resolveInjectorInitializers(),o}function O2(t,n=null,e=null,r,o=new Set){let i=[e||Gr,hK(t)];return r=r||(typeof t=="object"?void 0:Dr(t)),new uh(i,n||wE(),r||null,o)}var Hn=class t{static THROW_IF_NOT_FOUND=ch;static NULL=new O0;static create(n,e){if(Array.isArray(n))return nR({name:""},e,n,"");{let r=n.name??"";return nR({name:r},n.parent,n.providers,r)}}static \u0275prov=Re({token:t,providedIn:"any",factory:()=>$e(UR)});static __NG_ELEMENT_ID__=-1};var g7=new Me("");g7.__NG_ELEMENT_ID__=t=>{let n=kr();if(n===null)throw new De(204,!1);if(n.type&2)return n.value;if(t&at.Optional)return null;throw new De(204,!1)};var M2=!1,Tp=(()=>{class t{static __NG_ELEMENT_ID__=y7;static __NG_ENV_ID__=e=>e}return t})(),W0=class extends Tp{_lView;constructor(n){super(),this._lView=n}onDestroy(n){return c2(this._lView,n),()=>FK(this._lView,n)}};function y7(){return new W0(Et())}var bu=class{},xx=new Me("",{providedIn:"root",factory:()=>!1});var F2=new Me(""),AE=new Me(""),Ls=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new rr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}return t})();var WS=class extends $n{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,ZR()&&(this.destroyRef=pe(Tp,{optional:!0})??void 0,this.pendingTasks=pe(Ls,{optional:!0})??void 0)}emit(n){let e=wt(null);try{super.next(n)}finally{wt(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),s=r;if(n&&typeof n=="object"){let l=n;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return n instanceof En&&n.add(a),a}wrapInTimeout(n){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{n(e),r!==void 0&&this.pendingTasks?.remove(r)})}}},jt=WS;function fh(...t){}function P2(t){let n,e;function r(){t=fh;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{t(),r()})),()=>r()}function rR(t){return queueMicrotask(()=>t()),()=>{t=fh}}var RE="isAngularZone",H0=RE+"_ID",x7=0,Tn=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new jt(!1);onMicrotaskEmpty=new jt(!1);onStable=new jt(!1);onError=new jt(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=M2}=n;if(typeof Zone>"u")throw new De(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,w7(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(RE)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new De(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new De(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,n,v7,fh,fh);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},v7={};function OE(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function b7(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){P2(()=>{t.callbackScheduled=!1,HS(t),t.isCheckStableRunning=!0,OE(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),HS(t)}function w7(t){let n=()=>{b7(t)},e=x7++;t._inner=t._inner.fork({name:"angular",properties:{[RE]:!0,[H0]:e,[H0+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(C7(l))return r.invokeTask(i,s,a,l);try{return oR(t),r.invokeTask(i,s,a,l)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),iR(t)}},onInvoke:(r,o,i,s,a,l,c)=>{try{return oR(t),r.invoke(i,s,a,l,c)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!_7(l)&&n(),iR(t)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,HS(t),OE(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function HS(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function oR(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function iR(t){t._nesting--,OE(t)}var q0=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new jt;onMicrotaskEmpty=new jt;onStable=new jt;onError=new jt;run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}};function C7(t){return $2(t,"__ignore_ng_zone__")}function _7(t){return $2(t,"__scheduler_tick__")}function $2(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var ks=class{_console=console;handleError(n){this._console.error("ERROR",n)}},S7=new Me("",{providedIn:"root",factory:()=>{let t=pe(Tn),n=pe(ks);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function sR(t,n){return kR(t,n)}function E7(t){return kR(NR,t)}var L2=(sR.required=E7,sR);function I7(){return vx(kr(),Et())}function vx(t,n){return new Ro(bi(t,n))}var Ro=(()=>{class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=I7}return t})();var aR=new Set;function Il(t){aR.has(t)||(aR.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function T7(t){return typeof t=="function"&&t[Br]!==void 0}function uo(t,n){Il("NgSignals");let e=xA(t),r=e[Br];return n?.equal&&(r.equal=n.equal),e.set=o=>Xy(r,o),e.update=o=>vA(r,o),e.asReadonly=D7.bind(e),e}function D7(){let t=this[Br];if(t.readonlyFn===void 0){let n=()=>this();n[Br]=t,t.readonlyFn=n}return t.readonlyFn}function V2(t){return T7(t)&&typeof t.set=="function"}function B2(t){return(t.flags&128)===128}var z2=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(z2||{}),U2=new Map,N7=0;function k7(){return N7++}function A7(t){U2.set(t[cx],t)}function qS(t){U2.delete(t[cx])}var lR="__ngContext__";function Eu(t,n){_l(n)?(t[lR]=n[cx],A7(n)):t[lR]=n}function j2(t){return W2(t[ph])}function G2(t){return W2(t[yi])}function W2(t){for(;t!==null&&!Ps(t);)t=t[yi];return t}var KS;function H2(t){KS=t}function R7(){if(KS!==void 0)return KS;if(typeof document<"u")return document;throw new De(210,!1)}var ME=new Me("",{providedIn:"root",factory:()=>O7}),O7="ng",FE=new Me(""),Oo=new Me("",{providedIn:"platform",factory:()=>"unknown"});var PE=new Me("",{providedIn:"root",factory:()=>R7().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var M7="h",F7="b";var q2=!1,P7=new Me("",{providedIn:"root",factory:()=>q2});var K2=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(K2||{}),bx=new Me("");var $7=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}return t})();var L7=()=>null;function X2(t,n,e=!1){return L7(t,n,e)}function Y2(t,n){let e=t.contentQueries;if(e!==null){let r=wt(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=t.data[s];h2(i),a.contentQueries(2,n[s],s)}}}finally{wt(r)}}}function XS(t,n,e){h2(0);let r=wt(null);try{n(t,e)}finally{wt(r)}}function $E(t,n,e){if(CE(n)){let r=wt(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let s=o;s<i;s++){let a=t.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{wt(r)}}}var Yi=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Yi||{});var w0;function V7(){if(w0===void 0&&(w0=null,du.trustedTypes))try{w0=du.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return w0}function cR(t){return V7()?.createScriptURL(t)||t}var K0=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${DR})`}};function Dp(t){return t instanceof K0?t.changingThisBreaksApplicationSecurity:t}function LE(t,n){let e=B7(t);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${DR})`)}return e===n}function B7(t){return t instanceof K0&&t.getTypeName()||null}var z7=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Q2(t){return t=String(t),t.match(z7)?t:"unsafe:"+t}var wx=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(wx||{});function U7(t){let n=J2();return n?n.sanitize(wx.URL,t)||"":LE(t,"URL")?Dp(t):Q2(Ts(t))}function j7(t){let n=J2();if(n)return cR(n.sanitize(wx.RESOURCE_URL,t)||"");if(LE(t,"ResourceURL"))return cR(Dp(t));throw new De(904,!1)}function G7(t,n){return n==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||n==="href"&&(t==="base"||t==="link")?j7:U7}function Z2(t,n,e){return G7(n,e)(t)}function J2(){let t=Et();return t&&t[Ds].sanitizer}var W7=/^>|^->|<!--|-->|--!>|<!-$/g,H7=/(<|>)/g,q7="\u200B$1\u200B";function K7(t){return t.replace(W7,n=>n.replace(H7,q7))}function eO(t){return t.ownerDocument}function tO(t){return t instanceof Function?t():t}var Sl=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(Sl||{});function X7(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}var nO="ng-template";function Y7(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&X7(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if(VE(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function VE(t){return t.type===4&&t.value!==nO}function Q7(t,n,e){let r=t.type===4&&!e?nO:t.value;return n===r}function Z7(t,n,e){let r=4,o=t.attrs,i=o!==null?t9(o):0,s=!1;for(let a=0;a<n.length;a++){let l=n[a];if(typeof l=="number"){if(!s&&!hi(r)&&!hi(l))return!1;if(s&&hi(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!Q7(t,l,e)||l===""&&n.length===1){if(hi(r))return!1;s=!0}}else if(r&8){if(o===null||!Y7(t,o,l,e)){if(hi(r))return!1;s=!0}}else{let c=n[++a],u=J7(l,o,VE(t),e);if(u===-1){if(hi(r))return!1;s=!0;continue}if(c!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),r&2&&c!==d){if(hi(r))return!1;s=!0}}}}return hi(r)||s}function hi(t){return(t&1)===0}function J7(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let s=n[o];if(s===t)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=n[++o];for(;typeof a=="string";)a=n[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return n9(n,t)}function e9(t,n,e=!1){for(let r=0;r<n.length;r++)if(Z7(t,n[r],e))return!0;return!1}function t9(t){for(let n=0;n<t.length;n++){let e=t[n];if(_2(e))return n}return t.length}function n9(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function uR(t,n){return t?":not("+n.trim()+")":n}function r9(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let s=t[e];if(typeof s=="string")if(r&2){let a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!hi(s)&&(n+=uR(i,o),o=""),r=s,i=i||!hi(r);e++}return o!==""&&(n+=uR(i,o)),n}function o9(t){return t.map(r9).join(",")}function i9(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!hi(o))break;o=i}r++}return e.length&&n.push(1,...e),n}var Hr={};function s9(t,n){return t.createText(n)}function a9(t,n,e){t.setValue(n,e)}function l9(t,n){return t.createComment(K7(n))}function rO(t,n,e){return t.createElement(n,e)}function X0(t,n,e,r,o){t.insertBefore(n,e,r,o)}function oO(t,n,e){t.appendChild(n,e)}function dR(t,n,e,r,o){r!==null?X0(t,n,e,r,o):oO(t,n,e)}function c9(t,n,e){t.removeChild(null,n,e)}function u9(t,n,e){t.setAttribute(n,"style",e)}function d9(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function iO(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&o7(t,n,r),o!==null&&d9(t,n,o),i!==null&&u9(t,n,i)}function P(t=1){sO(qn(),Et(),$s()+t,!1)}function sO(t,n,e,r){if(!r)if((n[Xe]&3)===3){let i=t.preOrderCheckHooks;i!==null&&I0(n,i,e)}else{let i=t.preOrderHooks;i!==null&&T0(n,i,0,e)}xu(e)}function oe(t,n=at.Default){let e=Et();if(e===null)return $e(t,n);let r=kr();return k2(r,e,Tr(t),n)}function aO(t,n,e,r,o,i){let s=wt(null);try{let a=null;o&Sl.SignalBased&&(a=n[r][Br]),a!==null&&a.transformFn!==void 0&&(i=a.transformFn(i)),o&Sl.HasDecoratorInputTransform&&(i=t.inputTransforms[r].call(n,i)),t.setInput!==null?t.setInput(n,a,i,e,r):n2(n,a,r,i)}finally{wt(s)}}function BE(t,n,e,r,o,i,s,a,l,c,u){let d=n.blueprint.slice();return d[Fs]=o,d[Xe]=r|4|128|8|64|1024,(c!==null||t&&t[Xe]&2048)&&(d[Xe]|=2048),l2(d),d[Nr]=d[Ip]=t,d[No]=e,d[Ds]=s||t&&t[Ds],d[xn]=a||t&&t[xn],d[dh]=l||t&&t[dh]||null,d[xi]=i,d[cx]=k7(),d[M0]=u,d[e2]=c,d[qi]=n.type==2?t[qi]:d,d}function lO(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function cO(t,n,e,r,o){let i=$s(),s=r&2;try{xu(-1),s&&n.length>ko&&sO(t,n,ko,!1),To(s?2:0,o),e(r,o)}finally{xu(i),To(s?3:1,o)}}function zE(t,n,e){u2()&&(Eu(bi(e,n),n),uO(t,n,e))}function uO(t,n,e){C9(t,n,e),(e.flags&64)===64&&_9(t,n,e)}function UE(t,n,e=bi){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(n,t):t[s];t[o++]=a}}}function p9(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=jE(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function jE(t,n,e,r,o,i,s,a,l,c,u){let d=ko+r,p=d+o,f=f9(d,p),m=typeof c=="function"?c():c;return f[St]={type:t,blueprint:f,template:e,queries:null,viewQuery:a,declTNode:n,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:m,incompleteFirstPass:!1,ssrId:u}}function f9(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:Hr);return e}function m9(t,n,e,r){let i=r.get(P7,q2)||e===Yi.ShadowDom,s=t.selectRootElement(n,i);return h9(s),s}function h9(t){g9(t)}var g9=()=>null;function pR(t,n,e,r,o){for(let i in n){if(!n.hasOwnProperty(i))continue;let s=n[i];if(s===void 0)continue;r??={};let a,l=Sl.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}t===0?fR(r,e,c,a,l):fR(r,e,c,a)}return r}function fR(t,n,e,r,o){let i;t.hasOwnProperty(e)?(i=t[e]).push(n,r):i=t[e]=[n,r],o!==void 0&&i.push(o)}function y9(t,n,e){let r=n.directiveStart,o=n.directiveEnd,i=t.data,s=n.attrs,a=[],l=null,c=null;for(let u=r;u<o;u++){let d=i[u],p=e?e.get(d):null,f=p?p.inputs:null,m=p?p.outputs:null;l=pR(0,d.inputs,u,l,f),c=pR(1,d.outputs,u,c,m);let h=l!==null&&s!==null&&!VE(n)?P9(l,u,s):null;a.push(h)}l!==null&&(l.hasOwnProperty("class")&&(n.flags|=8),l.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=a,n.inputs=l,n.outputs=c}function x9(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function GE(t,n,e,r,o,i,s,a){let l=bi(n,e),c=n.inputs,u;!a&&c!=null&&(u=c[r])?(qE(t,e,u,r,o),_u(n)&&v9(e,n.index)):n.type&3?(r=x9(r),o=s!=null?s(o,n.value||"",r):o,i.setProperty(l,r,o)):n.type&12}function v9(t,n){let e=Xi(n,t);e[Xe]&16||(e[Xe]|=64)}function WE(t,n,e,r){if(u2()){let o=r===null?null:{"":-1},i=E9(t,e);if(i!==null){let[s,a]=pO(t,e,i);dO(t,n,e,s,o,a)}o&&T9(e,r,o)}e.mergedAttrs=wp(e.mergedAttrs,e.attrs)}function dO(t,n,e,r,o,i){for(let c=0;c<r.length;c++)jS(j0(e,n),t,r[c].type);N9(e,t.data.length,r.length);for(let c=0;c<r.length;c++){let u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=lO(t,n,r.length,null);for(let c=0;c<r.length;c++){let u=r[c];e.mergedAttrs=wp(e.mergedAttrs,u.hostAttrs),k9(t,e,n,l,u),D9(l,u,o),u.contentQueries!==null&&(e.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(e.flags|=64);let d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),l++}y9(t,e,i)}function b9(t,n,e,r,o){let i=o.hostBindings;if(i){let s=t.hostBindingOpCodes;s===null&&(s=t.hostBindingOpCodes=[]);let a=~n.index;w9(s)!=a&&s.push(a),s.push(e,r,i)}}function w9(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function C9(t,n,e){let r=e.directiveStart,o=e.directiveEnd;_u(e)&&R9(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||j0(e,n);let i=e.initialInputs;for(let s=r;s<o;s++){let a=t.data[s],l=G0(n,t,s,e);if(Eu(l,n),i!==null&&F9(n,s-r,l,a,e,i),Ns(a)){let c=Xi(e.index,n);c[No]=G0(n,t,s,e)}}}function _9(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=KK();try{xu(i);for(let a=r;a<o;a++){let l=t.data[a],c=n[a];BS(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&S9(l,c)}}finally{xu(-1),BS(s)}}function S9(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function E9(t,n){let e=t.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];e9(n,i.selectors,!1)&&(r??=[],Ns(i)?r.unshift(i):r.push(i))}return r}function pO(t,n,e){let r=[],o=null;for(let i of e)i.findHostDirectiveDefs!==null&&(o??=new Map,i.findHostDirectiveDefs(i,r,o)),Ns(i)&&(r.push(i),I9(t,n,r.length-1));return _u(n)?r.push(...e.slice(1)):r.push(...e),[r,o]}function I9(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function T9(t,n,e){if(n){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new De(-301,!1);r.push(n[o],i)}}}function D9(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;Ns(n)&&(e[""]=t)}}function N9(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function k9(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=fu(o.type,!0)),s=new vu(i,Ns(o),oe);t.blueprint[r]=s,e[r]=s,b9(t,n,r,lO(t,e,o.hostVars,Hr),o)}function A9(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function R9(t,n,e){let r=bi(n,t),o=p9(e),i=t[Ds].rendererFactory,s=HE(t,BE(t,o,null,A9(e),r,n,null,i.createRenderer(r,e),null,null,null));return t[n.index]=s}function O9(t,n,e,r,o,i){let s=bi(t,n);M9(n[xn],s,i,t.value,e,r,o)}function M9(t,n,e,r,o,i,s){if(i==null)t.removeAttribute(n,o,e);else{let a=s==null?Ts(i):s(i,r||"",o);t.setAttribute(n,o,a,e)}}function F9(t,n,e,r,o,i){let s=i[n];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],u=s[a++],d=s[a++];aO(r,e,l,c,u,d)}}function P9(t,n,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(t.hasOwnProperty(i)){r===null&&(r=[]);let s=t[i];for(let a=0;a<s.length;a+=3)if(s[a]===n){r.push(i,s[a+1],s[a+2],e[o+1]);break}}o+=2}return r}function fO(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function HE(t,n){return t[ph]?t[YA][yi]=n:t[ph]=n,t[YA]=n,n}function mO(t,n){let e=t[dh],r=e?e.get(ks,null):null;r&&r.handleError(n)}function qE(t,n,e,r,o){for(let i=0;i<e.length;){let s=e[i++],a=e[i++],l=e[i++],c=n[s],u=t.data[s];aO(u,c,r,a,l,o)}}function $9(t,n){let e=Xi(n,t),r=e[St];L9(r,e);let o=e[Fs];o!==null&&e[M0]===null&&(e[M0]=X2(o,e[dh])),KE(r,e,e[No])}function L9(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function KE(t,n,e){TE(n);try{let r=t.viewQuery;r!==null&&XS(1,r,e);let o=t.template;o!==null&&cO(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[vp]?.finishViewCreation(t),t.staticContentQueries&&Y2(t,n),t.staticViewQueries&&XS(2,t.viewQuery,e);let i=t.components;i!==null&&V9(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Xe]&=-5,DE()}}function V9(t,n){for(let e=0;e<n.length;e++)$9(t,n[e])}var As=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(As||{}),B9;function XE(t,n){return B9(t,n)}function hO(t){return(t.flags&32)===32}function pp(t,n,e,r,o){if(r!=null){let i,s=!1;Ps(r)?i=r:_l(r)&&(s=!0,r=r[Fs]);let a=Ki(r);t===0&&e!==null?o==null?oO(n,e,a):X0(n,e,a,o||null,!0):t===1&&e!==null?X0(n,e,a,o||null,!0):t===2?c9(n,a,s):t===3&&n.destroyNode(a),i!=null&&J9(n,t,i,e,o)}}function z9(t,n){gO(t,n),n[Fs]=null,n[xi]=null}function U9(t,n,e,r,o,i){r[Fs]=o,r[xi]=n,_x(t,r,e,1,o,i)}function gO(t,n){n[Ds].changeDetectionScheduler?.notify(10),_x(t,n,n[xn],2,null,null)}function j9(t){let n=t[ph];if(!n)return _S(t[St],t);for(;n;){let e=null;if(_l(n))e=n[ph];else{let r=n[Do];r&&(e=r)}if(!e){for(;n&&!n[yi]&&n!==t;)_l(n)&&_S(n[St],n),n=n[Nr];n===null&&(n=t),_l(n)&&_S(n[St],n),e=n&&n[yi]}n=e}}function G9(t,n,e,r){let o=Do+r,i=e.length;r>0&&(e[o-1][yi]=n),r<i-Do?(n[yi]=e[o],zR(e,Do+r,n)):(e.push(n),n[yi]=null),n[Nr]=e;let s=n[xp];s!==null&&e!==s&&yO(s,n);let a=n[vp];a!==null&&a.insertView(t),LS(n),n[Xe]|=128}function yO(t,n){let e=t[$0],r=n[Nr];if(_l(r))t[Xe]|=2;else{let o=r[Nr][qi];n[qi]!==o&&(t[Xe]|=2)}e===null?t[$0]=[n]:e.push(n)}function YE(t,n){let e=t[$0],r=e.indexOf(n);e.splice(r,1)}function YS(t,n){if(t.length<=Do)return;let e=Do+n,r=t[e];if(r){let o=r[xp];o!==null&&o!==t&&YE(o,r),n>0&&(t[e-1][yi]=r[yi]);let i=R0(t,Do+n);z9(r[St],r);let s=i[vp];s!==null&&s.detachView(i[St]),r[Nr]=null,r[yi]=null,r[Xe]&=-129}return r}function xO(t,n){if(vh(n))return;let e=n[xn];e.destroyNode&&_x(t,n,e,3,null,null),j9(n)}function _S(t,n){if(vh(n))return;let e=wt(null);try{n[Xe]&=-129,n[Xe]|=256,n[co]&&Jd(n[co]),H9(t,n),W9(t,n),n[St].type===1&&n[xn].destroy();let r=n[xp];if(r!==null&&Ps(n[Nr])){r!==n[Nr]&&YE(r,n);let o=n[vp];o!==null&&o.detachView(t)}qS(n)}finally{wt(e)}}function W9(t,n){let e=t.cleanup,r=n[F0];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(n[F0]=null);let o=n[Cl];if(o!==null){n[Cl]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=n[hu];if(i!==null){n[hu]=null;for(let s of i)s.destroy()}}function H9(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof vu)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];To(4,a,l);try{l.call(a)}finally{To(5,a,l)}}else{To(4,o,i);try{i.call(o)}finally{To(5,o,i)}}}}}function q9(t,n,e){return K9(t,n.parent,e)}function K9(t,n,e){let r=n;for(;r!==null&&r.type&168;)n=r,r=n.parent;if(r===null)return e[Fs];if(_u(r)){let{encapsulation:o}=t.data[r.directiveStart+r.componentOffset];if(o===Yi.None||o===Yi.Emulated)return null}return bi(r,e)}function X9(t,n,e){return Q9(t,n,e)}function Y9(t,n,e){return t.type&40?bi(t,e):null}var Q9=Y9,mR;function Cx(t,n,e,r){let o=q9(t,r,n),i=n[xn],s=r.parent||n[xi],a=X9(s,r,n);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)dR(i,o,e[l],a,!1);else dR(i,o,e,a,!1);mR!==void 0&&mR(i,r,n,e,o)}function ah(t,n){if(n!==null){let e=n.type;if(e&3)return bi(n,t);if(e&4)return QS(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return ah(t,r);{let o=t[n.index];return Ps(o)?QS(-1,o):Ki(o)}}else{if(e&128)return ah(t,n.next);if(e&32)return XE(n,t)()||Ki(t[n.index]);{let r=vO(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=yu(t[qi]);return ah(o,r)}else return ah(t,n.next)}}}return null}function vO(t,n){if(n!==null){let r=t[qi][xi],o=n.projection;return r.projection[o]}return null}function QS(t,n){let e=Do+t+1;if(e<n.length){let r=n[e],o=r[St].firstChild;if(o!==null)return ah(r,o)}return n[gu]}function QE(t,n,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&n===0&&(a&&Eu(Ki(a),r),e.flags|=2),!hO(e))if(l&8)QE(t,n,e.child,r,o,i,!1),pp(n,t,o,a,i);else if(l&32){let c=XE(e,r),u;for(;u=c();)pp(n,t,o,u,i);pp(n,t,o,a,i)}else l&16?Z9(t,n,r,e,o,i):pp(n,t,o,a,i);e=s?e.projectionNext:e.next}}function _x(t,n,e,r,o,i){QE(e,r,t.firstChild,n,o,i,!1)}function Z9(t,n,e,r,o,i){let s=e[qi],l=s[xi].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];pp(n,t,o,u,i)}else{let c=l,u=s[Nr];B2(r)&&(c.flags|=128),QE(t,n,c,u,o,i,!0)}}function J9(t,n,e,r,o){let i=e[gu],s=Ki(e);i!==s&&pp(n,t,r,i,o);for(let a=Do;a<e.length;a++){let l=e[a];_x(l[St],l,t,n,r,i)}}function eX(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:As.DashCase;o==null?t.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=As.Important),t.setStyle(e,r,o,i))}}function tX(t,n,e,r){let o=wt(null);try{let i=n.tView,a=t[Xe]&4096?4096:16,l=BE(t,i,e,a,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=t[n.index];l[xp]=c;let u=t[vp];return u!==null&&(l[vp]=u.createEmbeddedView(i)),KE(i,l,e),l}finally{wt(o)}}function hR(t,n){return!n||n.firstChild===null||B2(t)}function nX(t,n,e,r=!0){let o=n[St];if(G9(o,n,t,e),r){let s=QS(e,t),a=n[xn],l=a.parentNode(t[gu]);l!==null&&U9(o,t[xi],a,n,l,s)}let i=n[M0];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function Y0(t,n,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=n[e.index];i!==null&&r.push(Ki(i)),Ps(i)&&rX(i,r);let s=e.type;if(s&8)Y0(t,n,e.child,r);else if(s&32){let a=XE(e,n),l;for(;l=a();)r.push(l)}else if(s&16){let a=vO(n,e);if(Array.isArray(a))r.push(...a);else{let l=yu(n[qi]);Y0(l[St],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function rX(t,n){for(let e=Do;e<t.length;e++){let r=t[e],o=r[St].firstChild;o!==null&&Y0(r[St],r,o,n)}t[gu]!==t[Fs]&&n.push(t[gu])}var bO=[];function oX(t){return t[co]??iX(t)}function iX(t){let n=bO.pop()??Object.create(aX);return n.lView=t,n}function sX(t){t.lView[co]!==t&&(t.lView=null,bO.push(t))}var aX=qe(me({},iu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{bh(t.lView)},consumerOnSignalRead(){this.lView[co]=this}});function lX(t){let n=t[co]??Object.create(cX);return n.lView=t,n}var cX=qe(me({},iu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=yu(t.lView);for(;n&&!wO(n[St]);)n=yu(n);n&&SE(n)},consumerOnSignalRead(){this.lView[co]=this}});function wO(t){return t.type!==2}function CO(t){if(t[hu]===null)return;let n=!0;for(;n;){let e=!1;for(let r of t[hu])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));n=e&&!!(t[Xe]&8192)}}var uX=100;function _O(t,n=!0,e=0){let o=t[Ds].rendererFactory,i=!1;i||o.begin?.();try{dX(t,e)}catch(s){throw n&&mO(t,s),s}finally{i||o.end?.()}}function dX(t,n){let e=f2();try{V0(!0),ZS(t,n);let r=0;for(;dx(t);){if(r===uX)throw new De(103,!1);r++,ZS(t,1)}}finally{V0(e)}}function pX(t,n,e,r){if(vh(n))return;let o=n[Xe],i=!1,s=!1;TE(n);let a=!0,l=null,c=null;i||(wO(t)?(c=oX(n),l=Zd(c)):sA()===null?(a=!1,c=lX(n),l=Zd(c)):n[co]&&(Jd(n[co]),n[co]=null));try{l2(n),WK(t.bindingStartIndex),e!==null&&cO(t,n,e,2,r);let u=(o&3)===3;if(!i)if(u){let f=t.preOrderCheckHooks;f!==null&&I0(n,f,null)}else{let f=t.preOrderHooks;f!==null&&T0(n,f,0,null),bS(n,0)}if(s||fX(n),CO(n),SO(n,0),t.contentQueries!==null&&Y2(t,n),!i)if(u){let f=t.contentCheckHooks;f!==null&&I0(n,f)}else{let f=t.contentHooks;f!==null&&T0(n,f,1),bS(n,1)}hX(t,n);let d=t.components;d!==null&&IO(n,d,0);let p=t.viewQuery;if(p!==null&&XS(2,p,r),!i)if(u){let f=t.viewCheckHooks;f!==null&&I0(n,f)}else{let f=t.viewHooks;f!==null&&T0(n,f,2),bS(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[E0]){for(let f of n[E0])f();n[E0]=null}i||(n[Xe]&=-73)}catch(u){throw i||bh(n),u}finally{c!==null&&(th(c,l),a&&sX(c)),DE()}}function SO(t,n){for(let e=j2(t);e!==null;e=G2(e))for(let r=Do;r<e.length;r++){let o=e[r];EO(o,n)}}function fX(t){for(let n=j2(t);n!==null;n=G2(n)){if(!(n[Xe]&2))continue;let e=n[$0];for(let r=0;r<e.length;r++){let o=e[r];SE(o)}}}function mX(t,n,e){let r=Xi(n,t);EO(r,e)}function EO(t,n){_E(t)&&ZS(t,n)}function ZS(t,n){let r=t[St],o=t[Xe],i=t[co],s=!!(n===0&&o&16);if(s||=!!(o&64&&n===0),s||=!!(o&1024),s||=!!(i?.dirty&&nh(i)),s||=!1,i&&(i.dirty=!1),t[Xe]&=-9217,s)pX(r,t,r.template,t[No]);else if(o&8192){CO(t),SO(t,1);let a=r.components;a!==null&&IO(t,a,1)}}function IO(t,n,e){for(let r=0;r<n.length;r++)mX(t,n[r],e)}function hX(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)xu(~o);else{let i=o,s=e[++r],a=e[++r];qK(s,i);let l=n[i];To(24,l),a(2,l),To(25,l)}}}finally{xu(-1)}}function ZE(t,n){let e=f2()?64:1088;for(t[Ds].changeDetectionScheduler?.notify(n);t;){t[Xe]|=e;let r=yu(t);if(L0(t)&&!r)return t;t=r}return null}var wu=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let n=this._lView,e=n[St];return Y0(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[No]}get dirty(){return!!(this._lView[Xe]&9280)||!!this._lView[co]?.dirty}set context(n){this._lView[No]=n}get destroyed(){return vh(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Nr];if(Ps(n)){let e=n[P0],r=e?e.indexOf(this):-1;r>-1&&(YS(n,r),R0(e,r))}this._attachedToViewContainer=!1}xO(this._lView[St],this._lView)}onDestroy(n){c2(this._lView,n)}markForCheck(){ZE(this._cdRefInjectingView||this._lView,4)}markForRefresh(){SE(this._cdRefInjectingView||this._lView)}detach(){this._lView[Xe]&=-129}reattach(){LS(this._lView),this._lView[Xe]|=128}detectChanges(){this._lView[Xe]|=1024,_O(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new De(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=L0(this._lView),e=this._lView[xp];e!==null&&!n&&YE(e,this._lView),gO(this._lView[St],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new De(902,!1);this._appRef=n;let e=L0(this._lView),r=this._lView[xp];r!==null&&!e&&yO(r,this._lView),LS(this._lView)}},Sx=(()=>{class t{static __NG_ELEMENT_ID__=xX}return t})(),gX=Sx,yX=class extends gX{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=tX(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new wu(o)}};function xX(){return vX(kr(),Et())}function vX(t,n){return t.type&4?new yX(n,t,vx(t,n)):null}function wh(t,n,e,r,o){let i=t.data[n];if(i===null)i=bX(t,n,e,r,o),HK()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=GK();i.injectorIndex=s===null?-1:s.injectorIndex}return Su(i,!0),i}function bX(t,n,e,r,o){let i=d2(),s=EE(),a=s?i:i&&i.parent,l=t.data[n]=CX(t,a,e,n,r,o);return wX(t,l,i,s),l}function wX(t,n,e,r){t.firstChild===null&&(t.firstChild=n),e!==null&&(r?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function CX(t,n,e,r,o,i){let s=n?n.injectorIndex:-1,a=0;return zK()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var jEe=new RegExp(`^(\\d+)*(${F7}|${M7})*(.*)`);var _X=()=>null;function gR(t,n){return _X(t,n)}var JS=class{},Q0=class{},eE=class{resolveComponentFactory(n){throw Error(`No component factory found for ${Dr(n)}.`)}},Cp=class{static NULL=new eE},_p=class{},wi=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>SX()}return t})();function SX(){let t=Et(),n=kr(),e=Xi(n.index,t);return(_l(e)?e:t)[xn]}var EX=(()=>{class t{static \u0275prov=Re({token:t,providedIn:"root",factory:()=>null})}return t})();function Z0(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let s=0;s<n.length;s++){let a=n[s];if(typeof a=="number")i=a;else if(i==1)o=kS(o,a);else if(i==2){let l=a,c=n[++s];r=kS(r,l+": "+c+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}var J0=class extends Cp{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=mu(n);return new mh(e,this.ngModule)}};function yR(t,n){let e=[];for(let r in t){if(!t.hasOwnProperty(r))continue;let o=t[r];if(o===void 0)continue;let i=Array.isArray(o),s=i?o[0]:o,a=i?o[1]:Sl.None;n?e.push({propName:s,templateName:r,isSignal:(a&Sl.SignalBased)!==0}):e.push({propName:s,templateName:r})}return e}function IX(t){let n=t.toLowerCase();return n==="svg"?kK:n==="math"?AK:null}var mh=class extends Q0{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let n=this.componentDef,e=n.inputTransforms,r=yR(n.inputs,!0);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return yR(this.componentDef.outputs,!1)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=o9(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,r,o){let i=wt(null);try{o=o||this.ngModule;let s=o instanceof Wr?o:o?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new zS(n,s):n,l=a.get(_p,null);if(l===null)throw new De(407,!1);let c=a.get(EX,null),u=a.get(bu,null),d={rendererFactory:l,sanitizer:c,changeDetectionScheduler:u},p=l.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",m=r?m9(p,r,this.componentDef.encapsulation,a):rO(p,f,IX(f)),h=512;this.componentDef.signals?h|=4096:this.componentDef.onPush||(h|=16);let g=null;m!==null&&(g=X2(m,a,!0));let x=jE(0,null,null,1,0,null,null,null,null,null,null),b=BE(null,x,null,h,null,null,d,p,a,null,g);b[ko]=m,TE(b);let S=null;try{let _=r?["ng-version","19.1.4"]:i9(this.componentDef.selectors[0]),E=wh(x,ko,2,"#host",_),[I,D]=pO(x,E,[this.componentDef]);dO(x,b,E,I,{},D);for(let O of I)E.mergedAttrs=wp(E.mergedAttrs,O.hostAttrs);E.mergedAttrs=wp(E.mergedAttrs,_),Z0(E,E.mergedAttrs,!0),m&&(iO(p,m,E),Eu(m,b)),e!==void 0&&TX(E,this.ngContentSelectors,e),uO(x,b,E),$E(x,E,b),yx(x,E),S=Xi(E.index,b),b[No]=S[No],KE(x,b,null)}catch(_){throw S!==null&&qS(S),qS(b),_}finally{DE()}return new tE(this.componentType,b)}finally{wt(i)}}},tE=class extends JS{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=a2(e[St],ko),this.location=vx(this._tNode,e),this.instance=Xi(this._tNode.index,e)[No],this.hostView=this.changeDetectorRef=new wu(e,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let i=this._rootLView;qE(i[St],i,o,n,e),this.previousInputValues.set(n,e);let s=Xi(this._tNode.index,i);ZE(s,1)}}get injector(){return new pu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function TX(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var Np=(()=>{class t{static __NG_ELEMENT_ID__=DX}return t})();function DX(){let t=kr();return kX(t,Et())}var NX=Np,TO=class extends NX{_lContainer;_hostTNode;_hostLView;constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return vx(this._hostTNode,this._hostLView)}get injector(){return new pu(this._hostTNode,this._hostLView)}get parentInjector(){let n=NE(this._hostTNode,this._hostLView);if(S2(n)){let e=z0(n,this._hostLView),r=B0(n),o=e[St].data[r+8];return new pu(o,e)}else return new pu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=xR(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-Do}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=gR(this._lContainer,n.ssrId),a=n.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,hR(this._hostTNode,s)),a}createComponent(n,e,r,o,i){let s=n&&!IK(n),a;if(s)a=e;else{let m=e||{};a=m.index,r=m.injector,o=m.projectableNodes,i=m.environmentInjector||m.ngModuleRef}let l=s?n:new mh(mu(n)),c=r||this.parentInjector;if(!i&&l.ngModule==null){let h=(s?c:this.parentInjector).get(Wr,null);h&&(i=h)}let u=mu(l.componentType??{}),d=gR(this._lContainer,u?.id??null),p=d?.firstChild??null,f=l.create(c,o,p,i);return this.insertImpl(f.hostView,a,hR(this._hostTNode,d)),f}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(OK(o)){let a=this.indexOf(n);if(a!==-1)this.detach(a);else{let l=o[Nr],c=new TO(l,l[xi],l[Nr]);c.detach(c.indexOf(n))}}let i=this._adjustIndex(e),s=this._lContainer;return nX(s,o,i,r),n.attachToViewContainerRef(),zR(SS(s),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=xR(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=YS(this._lContainer,e);r&&(R0(SS(this._lContainer),e),xO(r[St],r))}detach(n){let e=this._adjustIndex(n,-1),r=YS(this._lContainer,e);return r&&R0(SS(this._lContainer),e)!=null?new wu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function xR(t){return t[P0]}function SS(t){return t[P0]||(t[P0]=[])}function kX(t,n){let e,r=n[t.index];return Ps(r)?e=r:(e=fO(r,n,null,t),n[t.index]=e,HE(n,e)),RX(e,n,t,r),new TO(e,t,n)}function AX(t,n){let e=t[xn],r=e.createComment(""),o=bi(n,t),i=e.parentNode(o);return X0(e,i,r,e.nextSibling(o),!1),r}var RX=FX,OX=()=>!1;function MX(t,n,e){return OX(t,n,e)}function FX(t,n,e,r){if(t[gu])return;let o;e.type&8?o=Ki(r):o=AX(n,e),t[gu]=o}var El=class{},hh=class{};var nE=class extends El{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new J0(this);constructor(n,e,r,o=!0){super(),this.ngModuleType=n,this._parent=e;let i=GR(n);this._bootstrapComponents=tO(i.bootstrap),this._r3Injector=O2(n,e,[{provide:El,useValue:this},{provide:Cp,useValue:this.componentFactoryResolver},...r],Dr(n),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},rE=class extends hh{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new nE(this.moduleType,n,[])}};var ex=class extends El{injector;componentFactoryResolver=new J0(this);instance=null;constructor(n){super();let e=new uh([...n.providers,{provide:El,useValue:this},{provide:Cp,useValue:this.componentFactoryResolver}],n.parent||wE(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function JE(t,n,e=null){return new ex({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var PX=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=KR(!1,e.type),o=r.length>0?JE([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Re({token:t,providedIn:"environment",factory:()=>new t($e(Wr))})}return t})();function Tt(t){return yh(()=>{let n=NO(t),e=qe(me({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===z2.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?o=>o.get(PX).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Yi.Emulated,styles:t.styles||Gr,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&Il("NgStandalone"),kO(e);let r=t.dependencies;return e.directiveDefs=bR(r,!1),e.pipeDefs=bR(r,!0),e.id=VX(e),e})}function $X(t){return mu(t)||WR(t)}function LX(t){return t!==null}function Vs(t){return yh(()=>({type:t.type,bootstrap:t.bootstrap||Gr,declarations:t.declarations||Gr,imports:t.imports||Gr,exports:t.exports||Gr,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function vR(t,n){if(t==null)return hp;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,s,a=Sl.None;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i):(i=o,s=o),n?(e[i]=a!==Sl.None?[r,a]:r,n[i]=s):e[i]=r}return e}function Rt(t){return yh(()=>{let n=NO(t);return kO(n),n})}function DO(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function NO(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||hp,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||Gr,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:vR(t.inputs,n),outputs:vR(t.outputs),debugInfo:null}}function kO(t){t.features?.forEach(n=>n(t))}function bR(t,n){if(!t)return null;let e=n?HR:$X;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(LX)}function VX(t){let n=0,e=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,e,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let i of r.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function BX(t){return Object.getPrototypeOf(t.prototype).constructor}function Dn(t){let n=BX(t.type),e=!0,r=[t];for(;n;){let o;if(Ns(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new De(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);let s=t;s.inputs=C0(t.inputs),s.inputTransforms=C0(t.inputTransforms),s.declaredInputs=C0(t.declaredInputs),s.outputs=C0(t.outputs);let a=o.hostBindings;a&&WX(t,a);let l=o.viewQuery,c=o.contentQueries;if(l&&jX(t,l),c&&GX(t,c),zX(t,o),q6(t.outputs,o.outputs),Ns(o)&&o.data.animation){let u=t.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(t),a===Dn&&(e=!1)}}n=Object.getPrototypeOf(n)}UX(r)}function zX(t,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;let r=n.inputs[e];if(r!==void 0&&(t.inputs[e]=r,t.declaredInputs[e]=n.declaredInputs[e],n.inputTransforms!==null)){let o=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(o))continue;t.inputTransforms??={},t.inputTransforms[o]=n.inputTransforms[o]}}}function UX(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){let o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=wp(o.hostAttrs,e=wp(e,o.hostAttrs))}}function C0(t){return t===hp?{}:t===Gr?[]:t}function jX(t,n){let e=t.viewQuery;e?t.viewQuery=(r,o)=>{n(r,o),e(r,o)}:t.viewQuery=n}function GX(t,n){let e=t.contentQueries;e?t.contentQueries=(r,o,i)=>{n(r,o,i),e(r,o,i)}:t.contentQueries=n}function WX(t,n){let e=t.hostBindings;e?t.hostBindings=(r,o)=>{n(r,o),e(r,o)}:t.hostBindings=n}function e1(t){let n=t.inputConfig,e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r];Array.isArray(o)&&o[3]&&(e[r]=o[3])}t.inputTransforms=e}function AO(t){return qX(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function HX(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{let e=t[Symbol.iterator](),r;for(;!(r=e.next()).done;)n(r.value)}}function qX(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function RO(t,n,e){return t[n]=e}function Rs(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function t1(t,n,e,r){let o=Rs(t,n,e);return Rs(t,n+1,r)||o}function OO(t,n,e,r,o){let i=t1(t,n,e,r);return Rs(t,n+2,o)||i}function KX(t,n,e,r,o,i,s,a,l){let c=n.consts,u=wh(n,t,4,s||null,a||null);WE(n,e,u,bp(c,l)),yx(n,u);let d=u.tView=jE(2,u,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return n.queries!==null&&(n.queries.template(n,u),d.queries=n.queries.embeddedTView(u)),u}function XX(t,n,e,r,o,i,s,a,l,c){let u=e+ko,d=n.firstCreatePass?KX(u,n,t,r,o,i,s,a,l):n.data[u];Su(d,!1);let p=YX(n,t,d,e);hx()&&Cx(n,t,p,d),Eu(p,t);let f=fO(p,t,p,d);return t[u]=f,HE(t,f),MX(f,d,t),ux(d)&&zE(n,t,d),l!=null&&UE(t,d,c),d}function ie(t,n,e,r,o,i,s,a){let l=Et(),c=qn(),u=bp(c.consts,i);return XX(l,c,t,n,e,r,o,u,s,a),ie}var YX=QX;function QX(t,n,e,r){return gx(!0),n[xn].createComment("")}var n1=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var MO=new Me("");function Iu(t){return!!t&&typeof t.then=="function"}function FO(t){return!!t&&typeof t.subscribe=="function"}var PO=new Me("");var $O=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=pe(PO,{optional:!0})??[];injector=pe(Hn);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=ir(this.injector,o);if(Iu(i))e.push(i);else if(FO(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),LO=(()=>{class t{static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new tx})}return t})(),tx=class{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){let e=n.zone,r=this.queues.get(e);r.has(n)&&(r.delete(n),this.queuedEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(n)||(this.queuedEffectCount++,r.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,e]of this.queues)n===null?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(let e of n)n.delete(e),this.queuedEffectCount--,e.run()}},Ex=new Me("");function ZX(){yA(()=>{throw new De(600,!1)})}function JX(t){return t.isBoundToModule}var eY=10;function tY(t,n,e){try{let r=e();return Iu(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var Os=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=pe(S7);afterRenderManager=pe($7);zonelessEnabled=pe(xx);rootEffectScheduler=pe(LO);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new $n;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=pe(Ls).hasPendingTasks.pipe(nt(e=>!e));constructor(){pe(bx,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=pe(Wr);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){let o=e instanceof Q0;if(!this._injector.get($O).done){let p=!o&&qR(e),f=!1;throw new De(405,f)}let s;o?s=e:s=this._injector.get(Cp).resolveComponentFactory(e),this.componentTypes.push(s.componentType);let a=JX(s)?void 0:this._injector.get(El),l=r||s.selector,c=s.create(Hn.NULL,[],l,a),u=c.location.nativeElement,d=c.injector.get(MO,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),D0(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(K2.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new De(101,!1);let e=wt(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,wt(e),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(_p,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let e=0;for(;this.dirtyFlags!==0&&e++<eY;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)nY(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>dx(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;D0(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Ex,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>D0(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new De(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function D0(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function nY(t,n,e,r){if(!e&&!dx(t))return;_O(t,n,e&&!r?0:1)}function kp(t,n,e,r){let o=Et(),i=px();if(Rs(o,i,n)){let s=qn(),a=mx();O9(a,o,t,n,e,r)}return kp}function VO(t,n,e,r){return Rs(t,px(),e)?n+Ts(e)+r:Hr}function rY(t,n,e,r,o,i){let s=m2(),a=t1(t,s,e,o);return fx(2),a?n+Ts(e)+r+Ts(o)+i:Hr}function oY(t,n,e,r,o,i,s,a){let l=m2(),c=OO(t,l,e,o,s);return fx(3),c?n+Ts(e)+r+Ts(o)+i+Ts(s)+a:Hr}function _0(t,n){return t<<17|n<<2}function Cu(t){return t>>17&32767}function iY(t){return(t&2)==2}function sY(t,n){return t&131071|n<<17}function oE(t){return t|2}function Sp(t){return(t&131068)>>2}function ES(t,n){return t&-131069|n<<2}function aY(t){return(t&1)===1}function iE(t){return t|1}function lY(t,n,e,r,o,i){let s=i?n.classBindings:n.styleBindings,a=Cu(s),l=Sp(s);t[r]=e;let c=!1,u;if(Array.isArray(e)){let d=e;u=d[1],(u===null||xh(d,u)>0)&&(c=!0)}else u=e;if(o)if(l!==0){let p=Cu(t[a+1]);t[r+1]=_0(p,a),p!==0&&(t[p+1]=ES(t[p+1],r)),t[a+1]=sY(t[a+1],r)}else t[r+1]=_0(a,0),a!==0&&(t[a+1]=ES(t[a+1],r)),a=r;else t[r+1]=_0(l,0),a===0?a=r:t[l+1]=ES(t[l+1],r),l=r;c&&(t[r+1]=oE(t[r+1])),wR(t,u,r,!0),wR(t,u,r,!1),cY(n,u,t,r,i),s=_0(a,l),i?n.classBindings=s:n.styleBindings=s}function cY(t,n,e,r,o){let i=o?t.residualClasses:t.residualStyles;i!=null&&typeof n=="string"&&xh(i,n)>=0&&(e[r+1]=iE(e[r+1]))}function wR(t,n,e,r){let o=t[e+1],i=n===null,s=r?Cu(o):Sp(o),a=!1;for(;s!==0&&(a===!1||i);){let l=t[s],c=t[s+1];uY(l,n)&&(a=!0,t[s+1]=r?iE(c):oE(c)),s=r?Cu(c):Sp(c)}a&&(t[e+1]=r?oE(o):iE(o))}function uY(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?xh(t,n)>=0:!1}var gi={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function dY(t){return t.substring(gi.key,gi.keyEnd)}function pY(t){return fY(t),BO(t,zO(t,0,gi.textEnd))}function BO(t,n){let e=gi.textEnd;return e===n?-1:(n=gi.keyEnd=mY(t,gi.key=n,e),zO(t,n,e))}function fY(t){gi.key=0,gi.keyEnd=0,gi.value=0,gi.valueEnd=0,gi.textEnd=t.length}function zO(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function mY(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}function j(t,n,e){let r=Et(),o=px();if(Rs(r,o,n)){let i=qn(),s=mx();GE(i,s,r,t,n,r[xn],e,!1)}return j}function sE(t,n,e,r,o){let i=n.inputs,s=o?"class":"style";qE(t,e,i[s],s,r)}function Ap(t,n,e){return jO(t,n,e,!1),Ap}function Qi(t,n){return jO(t,n,null,!0),Qi}function UO(t){gY(CY,hY,t,!0)}function hY(t,n){for(let e=pY(n);e>=0;e=BO(n,e))vE(t,dY(n),!0)}function jO(t,n,e,r){let o=Et(),i=qn(),s=fx(2);if(i.firstUpdatePass&&WO(i,t,s,r),n!==Hr&&Rs(o,s,n)){let a=i.data[$s()];HO(i,a,o,o[xn],t,o[s+1]=SY(n,e),r,s)}}function gY(t,n,e,r){let o=qn(),i=fx(2);o.firstUpdatePass&&WO(o,null,i,r);let s=Et();if(e!==Hr&&Rs(s,i,e)){let a=o.data[$s()];if(qO(a,r)&&!GO(o,i)){let l=r?a.classesWithoutHost:a.stylesWithoutHost;l!==null&&(e=kS(l,e||"")),sE(o,a,s,e,r)}else _Y(o,a,s,s[xn],s[i+1],s[i+1]=wY(t,n,e),r,i)}}function GO(t,n){return n>=t.expandoStartIndex}function WO(t,n,e,r){let o=t.data;if(o[e+1]===null){let i=o[$s()],s=GO(t,e);qO(i,r)&&n===null&&!s&&(n=!1),n=yY(o,i,n,r),lY(o,i,n,e,s,r)}}function yY(t,n,e,r){let o=XK(t),i=r?n.residualClasses:n.residualStyles;if(o===null)(r?n.classBindings:n.styleBindings)===0&&(e=IS(null,t,n,e,r),e=gh(e,n.attrs,r),i=null);else{let s=n.directiveStylingLast;if(s===-1||t[s]!==o)if(e=IS(o,t,n,e,r),i===null){let l=xY(t,n,r);l!==void 0&&Array.isArray(l)&&(l=IS(null,t,n,l[1],r),l=gh(l,n.attrs,r),vY(t,n,r,l))}else i=bY(t,n,r)}return i!==void 0&&(r?n.residualClasses=i:n.residualStyles=i),e}function xY(t,n,e){let r=e?n.classBindings:n.styleBindings;if(Sp(r)!==0)return t[Cu(r)]}function vY(t,n,e,r){let o=e?n.classBindings:n.styleBindings;t[Cu(o)]=r}function bY(t,n,e){let r,o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++){let s=t[i].hostAttrs;r=gh(r,s,e)}return gh(r,n.attrs,e)}function IS(t,n,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=n[a],r=gh(r,i.hostAttrs,o),i!==t);)a++;return t!==null&&(e.directiveStylingLast=a),r}function gh(t,n,e){let r=e?1:2,o=-1;if(n!==null)for(let i=0;i<n.length;i++){let s=n[i];typeof s=="number"?o=s:o===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),vE(t,s,e?!0:n[++i]))}return t===void 0?null:t}function wY(t,n,e){if(e==null||e==="")return Gr;let r=[],o=Dp(e);if(Array.isArray(o))for(let i=0;i<o.length;i++)t(r,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&t(r,i,o[i]);else typeof o=="string"&&n(r,o);return r}function CY(t,n,e){let r=String(n);r!==""&&!r.includes(" ")&&vE(t,r,e)}function _Y(t,n,e,r,o,i,s,a){o===Hr&&(o=Gr);let l=0,c=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let p=l<o.length?o[l+1]:void 0,f=c<i.length?i[c+1]:void 0,m=null,h;u===d?(l+=2,c+=2,p!==f&&(m=d,h=f)):d===null||u!==null&&u<d?(l+=2,m=u):(c+=2,m=d,h=f),m!==null&&HO(t,n,e,r,m,h,s,a),u=l<o.length?o[l]:null,d=c<i.length?i[c]:null}}function HO(t,n,e,r,o,i,s,a){if(!(n.type&3))return;let l=t.data,c=l[a+1],u=aY(c)?CR(l,n,e,o,Sp(c),s):void 0;if(!nx(u)){nx(i)||iY(c)&&(i=CR(l,null,e,o,a,s));let d=s2($s(),e);eX(r,s,d,o,i)}}function CR(t,n,e,r,o,i){let s=n===null,a;for(;o>0;){let l=t[o],c=Array.isArray(l),u=c?l[1]:l,d=u===null,p=e[o+1];p===Hr&&(p=d?Gr:void 0);let f=d?xS(p,r):u===r?p:void 0;if(c&&!nx(f)&&(f=xS(l,r)),nx(f)&&(a=f,s))return a;let m=t[o+1];o=s?Cu(m):Sp(m)}if(n!==null){let l=i?n.residualClasses:n.residualStyles;l!=null&&(a=xS(l,r))}return a}function nx(t){return t!==void 0}function SY(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Dr(Dp(t)))),t}function qO(t,n){return(t.flags&(n?8:16))!==0}function EY(t,n,e,r,o,i){let s=n.consts,a=bp(s,o),l=wh(n,t,2,r,a);return WE(n,e,l,bp(s,i)),l.attrs!==null&&Z0(l,l.attrs,!1),l.mergedAttrs!==null&&Z0(l,l.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,l),l}function v(t,n,e,r){let o=Et(),i=qn(),s=ko+t,a=o[xn],l=i.firstCreatePass?EY(s,i,o,n,e,r):i.data[s],c=IY(i,o,l,a,n,t);o[s]=c;let u=ux(l);return Su(l,!0),iO(a,c,l),!hO(l)&&hx()&&Cx(i,o,c,l),LK()===0&&Eu(c,o),VK(),u&&(zE(i,o,l),$E(i,l,o)),r!==null&&UE(o,l),v}function y(){let t=kr();EE()?p2():(t=t.parent,Su(t,!1));let n=t;UK(n)&&jK(),BK();let e=qn();return e.firstCreatePass&&(yx(e,t),CE(t)&&e.queries.elementEnd(t)),n.classesWithoutHost!=null&&n7(n)&&sE(e,n,Et(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&r7(n)&&sE(e,n,Et(),n.stylesWithoutHost,!1),y}function U(t,n,e,r){return v(t,n,e,r),y(),U}var IY=(t,n,e,r,o,i)=>(gx(!0),rO(r,o,ZK()));function TY(t,n,e,r,o){let i=n.consts,s=bp(i,r),a=wh(n,t,8,"ng-container",s);s!==null&&Z0(a,s,!0);let l=bp(i,o);return WE(n,e,a,l),n.queries!==null&&n.queries.elementStart(n,a),a}function Bs(t,n,e){let r=Et(),o=qn(),i=t+ko,s=o.firstCreatePass?TY(i,o,r,n,e):o.data[i];Su(s,!0);let a=DY(o,r,s,t);return r[i]=a,hx()&&Cx(o,r,a,s),Eu(a,r),ux(s)&&(zE(o,r,s),$E(o,s,r)),e!=null&&UE(r,s),Bs}function zs(){let t=kr(),n=qn();return EE()?p2():(t=t.parent,Su(t,!1)),n.firstCreatePass&&(yx(n,t),CE(t)&&n.queries.elementEnd(t)),zs}var DY=(t,n,e,r)=>(gx(!0),l9(n[xn],""));function it(){return Et()}var uu=void 0;function NY(t){let n=t,e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return e===1&&r===0?1:5}var kY=["en",[["a","p"],["AM","PM"],uu],[["AM","PM"],uu,uu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],uu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],uu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",uu,"{1} 'at' {0}",uu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",NY],TS={};function Mo(t){let n=AY(t),e=_R(n);if(e)return e;let r=n.split("-")[0];if(e=_R(r),e)return e;if(r==="en")return kY;throw new De(701,!1)}function _R(t){return t in TS||(TS[t]=du.ng&&du.ng.common&&du.ng.common.locales&&du.ng.common.locales[t]),TS[t]}var Cn=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(Cn||{});function AY(t){return t.toLowerCase().replace(/_/g,"-")}var rx="en-US";var RY=rx;function OY(t){typeof t=="string"&&(RY=t.toLowerCase().replace(/_/g,"-"))}var MY=(t,n,e)=>{};function le(t,n,e,r){let o=Et(),i=qn(),s=kr();return KO(i,o,o[xn],s,t,n,r),le}function FY(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=n[F0],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function KO(t,n,e,r,o,i,s){let a=ux(r),c=t.firstCreatePass&&$K(t),u=n[No],d=PK(n),p=!0;if(r.type&3||s){let h=bi(r,n),g=s?s(h):h,x=d.length,b=s?_=>s(Ki(_[r.index])):r.index,S=null;if(!s&&a&&(S=FY(t,n,o,r.index)),S!==null){let _=S.__ngLastListenerFn__||S;_.__ngNextListenerFn__=i,S.__ngLastListenerFn__=i,p=!1}else{i=ER(r,n,u,i),MY(h,o,i);let _=e.listen(g,o,i);d.push(i,_),c&&c.push(o,b,x,x+1)}}else i=ER(r,n,u,i);let f=r.outputs,m;if(p&&f!==null&&(m=f[o])){let h=m.length;if(h)for(let g=0;g<h;g+=2){let x=m[g],b=m[g+1],E=n[x][b].subscribe(i),I=d.length;d.push(i,E),c&&c.push(o,r.index,I,-(I+1))}}}function SR(t,n,e,r){let o=wt(null);try{return To(6,n,e),e(r)!==!1}catch(i){return mO(t,i),!1}finally{To(7,n,e),wt(o)}}function ER(t,n,e,r){return function o(i){if(i===Function)return r;let s=_u(t)?Xi(t.index,n):n;ZE(s,5);let a=SR(n,e,r,i),l=o.__ngNextListenerFn__;for(;l;)a=SR(n,e,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function ee(t=1){return QK(t)}function Ix(t,n,e){return XO(t,"",n,"",e),Ix}function XO(t,n,e,r,o){let i=Et(),s=VO(i,n,e,r);if(s!==Hr){let a=qn(),l=mx();GE(a,l,i,t,s,i[xn],o,!1)}return XO}function PY(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}function C(t,n=""){let e=Et(),r=qn(),o=t+ko,i=r.firstCreatePass?wh(r,o,1,n,null):r.data[o],s=$Y(r,e,i,n,t);e[o]=s,hx()&&Cx(r,e,s,i),Su(i,!1)}var $Y=(t,n,e,r,o)=>(gx(!0),s9(n[xn],r));function ht(t){return ze("",t,""),ht}function ze(t,n,e){let r=Et(),o=VO(r,t,n,e);return o!==Hr&&r1(r,$s(),o),ze}function Tu(t,n,e,r,o){let i=Et(),s=rY(i,t,n,e,r,o);return s!==Hr&&r1(i,$s(),s),Tu}function Ch(t,n,e,r,o,i,s){let a=Et(),l=oY(a,t,n,e,r,o,i,s);return l!==Hr&&r1(a,$s(),l),Ch}function r1(t,n,e){let r=s2(n,t);a9(t[xn],r,e)}function qr(t,n,e){V2(n)&&(n=n());let r=Et(),o=px();if(Rs(r,o,n)){let i=qn(),s=mx();GE(i,s,r,t,n,r[xn],e,!1)}return qr}function po(t,n){let e=V2(t);return e&&t.set(n),e}function Kr(t,n){let e=Et(),r=qn(),o=kr();return KO(r,e,e[xn],o,t,n),Kr}function LY(t,n,e){let r=qn();if(r.firstCreatePass){let o=Ns(t);aE(e,r.data,r.blueprint,o,!0),aE(n,r.data,r.blueprint,o,!1)}}function aE(t,n,e,r,o){if(t=Tr(t),Array.isArray(t))for(let i=0;i<t.length;i++)aE(t[i],n,e,r,o);else{let i=qn(),s=Et(),a=kr(),l=yp(t)?t:Tr(t.provide),c=QR(t),u=a.providerIndexes&1048575,d=a.directiveStart,p=a.providerIndexes>>20;if(yp(t)||!t.multi){let f=new vu(c,o,oe),m=NS(l,n,o?u:u+p,d);m===-1?(jS(j0(a,s),i,l),DS(i,t,n.length),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(f),s.push(f)):(e[m]=f,s[m]=f)}else{let f=NS(l,n,u+p,d),m=NS(l,n,u,u+p),h=f>=0&&e[f],g=m>=0&&e[m];if(o&&!g||!o&&!h){jS(j0(a,s),i,l);let x=zY(o?BY:VY,e.length,o,r,c);!o&&g&&(e[m].providerFactory=x),DS(i,t,n.length,0),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(x),s.push(x)}else{let x=YO(e[o?m:f],c,!o&&r);DS(i,t,f>-1?f:m,x)}!o&&r&&g&&e[m].componentProviders++}}}function DS(t,n,e,r){let o=yp(n),i=vK(n);if(o||i){let l=(i?Tr(n.useClass):n).prototype.ngOnDestroy;if(l){let c=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){let u=c.indexOf(e);u===-1?c.push(e,[r,l]):c[u+1].push(r,l)}else c.push(e,l)}}}function YO(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function NS(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function VY(t,n,e,r){return lE(this.multi,[])}function BY(t,n,e,r){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=G0(e,e[St],this.providerFactory.index,r);i=a.slice(0,s),lE(o,i);for(let l=s;l<a.length;l++)i.push(a[l])}else i=[],lE(o,i);return i}function lE(t,n){for(let e=0;e<t.length;e++){let r=t[e];n.push(r())}return n}function zY(t,n,e,r,o){let i=new vu(t,e,oe);return i.multi=[],i.index=n,i.componentProviders=0,YO(i,o,r&&!e),i}function Ar(t,n=[]){return e=>{e.providersResolver=(r,o)=>LY(r,o?o(t):t,n)}}function Zi(t,n,e,r,o){return ZO(Et(),IE(),t,n,e,r,o)}function Tl(t,n,e,r,o,i){return UY(Et(),IE(),t,n,e,r,o,i)}function QO(t,n){let e=t[n];return e===Hr?void 0:e}function ZO(t,n,e,r,o,i,s){let a=n+e;return t1(t,a,o,i)?RO(t,a+2,s?r.call(s,o,i):r(o,i)):QO(t,a+2)}function UY(t,n,e,r,o,i,s,a){let l=n+e;return OO(t,l,o,i,s)?RO(t,l+3,a?r.call(a,o,i,s):r(o,i,s)):QO(t,l+3)}function Ci(t,n){let e=qn(),r,o=t+ko;e.firstCreatePass?(r=jY(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks??=[]).push(o,r.onDestroy)):r=e.data[o];let i=r.factory||(r.factory=fu(r.type,!0)),s,a=jr(oe);try{let l=U0(!1),c=i();return U0(l),PY(e,Et(),o,c),c}finally{jr(a)}}function jY(t,n){if(n)for(let e=n.length-1;e>=0;e--){let r=n[e];if(t===r.name)return r}}function _i(t,n,e,r){let o=t+ko,i=Et(),s=RK(i,o);return GY(i,o)?ZO(i,IE(),n,s.transform,e,r,s):s.transform(e,r)}function GY(t,n){return t[St].data[n].pure}var cE=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},o1=(()=>{class t{compileModuleSync(e){return new rE(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=GR(e),i=tO(o.declarations).reduce((s,a)=>{let l=mu(a);return l&&s.push(new mh(l)),s},[]);return new cE(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var WY=(()=>{class t{zone=pe(Tn);changeDetectionScheduler=pe(bu);applicationRef=pe(Os);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function HY({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new Tn(qe(me({},qY()),{scheduleInRootZone:e})),[{provide:Tn,useFactory:t},{provide:gp,multi:!0,useFactory:()=>{let r=pe(WY,{optional:!0});return()=>r.initialize()}},{provide:gp,multi:!0,useFactory:()=>{let r=pe(KY);return()=>{r.initialize()}}},n===!0?{provide:F2,useValue:!0}:[],{provide:AE,useValue:e??M2}]}function qY(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var KY=(()=>{class t{subscription=new En;initialized=!1;zone=pe(Tn);pendingTasks=pe(Ls);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Tn.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Tn.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var JO=(()=>{class t{appRef=pe(Os);taskService=pe(Ls);ngZone=pe(Tn);zonelessEnabled=pe(xx);tracing=pe(bx,{optional:!0});disableScheduling=pe(F2,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new En;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(H0):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(pe(AE,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof q0||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?rR:P2;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(H0+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,rR(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function eM(){return Il("NgZoneless"),Ep([{provide:bu,useExisting:JO},{provide:Tn,useClass:q0},{provide:xx,useValue:!0},{provide:AE,useValue:!1},[]])}function XY(){return typeof $localize<"u"&&$localize.locale||rx}var Tx=new Me("",{providedIn:"root",factory:()=>pe(Tx,at.Optional|at.SkipSelf)||XY()});var uE=new Me(""),YY=new Me("");function ih(t){return!t.moduleRef}function QY(t){let n=ih(t)?t.r3Injector:t.moduleRef.injector,e=n.get(Tn);return e.run(()=>{ih(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=n.get(ks,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),ih(t)){let i=()=>n.destroy(),s=t.platformInjector.get(uE);s.add(i),n.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>t.moduleRef.destroy(),s=t.platformInjector.get(uE);s.add(i),t.moduleRef.onDestroy(()=>{D0(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(i)})}return tY(r,e,()=>{let i=n.get($O);return i.runInitializers(),i.donePromise.then(()=>{let s=n.get(Tx,rx);if(OY(s||rx),!n.get(YY,!0))return ih(t)?n.get(Os):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(ih(t)){let l=n.get(Os);return t.rootComponent!==void 0&&l.bootstrap(t.rootComponent),l}else return ZY(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function ZY(t,n){let e=t.injector.get(Os);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(e);else throw new De(-403,!1);n.push(t)}var N0=null;function JY(t=[],n){return Hn.create({name:n,providers:[{provide:lx,useValue:"platform"},{provide:uE,useValue:new Set([()=>N0=null])},...t]})}function eQ(t=[]){if(N0)return N0;let n=JY(t);return N0=n,ZX(),tQ(n),n}function tQ(t){let n=t.get(FE,null);ir(t,()=>{n?.forEach(e=>e())})}var $t=(()=>{class t{static __NG_ELEMENT_ID__=nQ}return t})();function nQ(t){return rQ(kr(),Et(),(t&16)===16)}function rQ(t,n,e){if(_u(t)&&!e){let r=Xi(t.index,n);return new wu(r,r)}else if(t.type&175){let r=n[qi];return new wu(r,n)}return null}var dE=class{constructor(){}supports(n){return AO(n)}create(n){return new pE(n)}},oQ=(t,n)=>n,pE=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||oQ}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<IR(r,o,i)?e:r,a=IR(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let c=a-o,u=l-o;if(c!=u){for(let p=0;p<c;p++){let f=p<i.length?i[p]:i[p]=0,m=f+p;u<=m&&m<c&&(i[p]=f+1)}let d=s.previousIndex;i[d]=u-c}}a!==l&&n(s,a,l)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!AO(n))throw new De(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)i=n[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,HX(n,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):(n=this._linkedRecords===null?null:this._linkedRecords.get(r,o),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new fE(e,r),i,o)),n}_verifyReinsertion(n,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let o=n._prevRemoved,i=n._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){let o=e===null?this._itHead:e._next;return n._next=o,n._prev=e,o===null?this._itTail=n:o._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new ox),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,r=n._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new ox),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},fE=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},mE=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){let e=n._prevDup,r=n._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},ox=class{map=new Map;put(n){let e=n.trackById,r=this.map.get(e);r||(r=new mE,this.map.set(e,r)),r.add(n)}get(n,e){let r=n,o=this.map.get(r);return o?o.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function IR(t,n,e){let r=t.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}function TR(){return new i1([new dE])}var i1=(()=>{class t{factories;static \u0275prov=Re({token:t,providedIn:"root",factory:TR});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||TR()),deps:[[t,new pK,new BR]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new De(901,!1)}}return t})();function tM(t){try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=eQ(r),i=[HY({}),{provide:bu,useExisting:JO},...e||[]],s=new ex({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return QY({r3Injector:s.injector,platformInjector:o,rootComponent:n})}catch(n){return Promise.reject(n)}}function Du(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function Dl(t,n){Il("NgSignals");let e=mA(t);return n?.equal&&(e[Br].equal=n.equal),e}function Ji(t){let n=wt(null);try{return t()}finally{wt(n)}}var nM=(()=>{class t{view;node;constructor(e,r){this.view=e,this.node=r}static __NG_ELEMENT_ID__=iQ}return t})();function iQ(){return new nM(Et(),kr())}var sQ=!1,aQ=(()=>{class t extends tx{pendingTasks=pe(Ls);taskId=null;schedule(e){super.schedule(e),this.taskId===null&&(this.taskId=this.pendingTasks.add(),queueMicrotask(()=>this.flush()))}flush(){try{super.flush()}finally{this.taskId!==null&&(this.pendingTasks.remove(this.taskId),this.taskId=null)}}static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}return t})(),hE=class{scheduler;effectFn;zone;injector;unregisterOnDestroy;watcher;constructor(n,e,r,o,i,s){this.scheduler=n,this.effectFn=e,this.zone=r,this.injector=i,this.watcher=bA(a=>this.runEffect(a),()=>this.schedule(),s),this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}runEffect(n){try{this.effectFn(n)}catch(e){this.injector.get(ks,null,{optional:!0})?.handleError(e)}}run(){this.watcher.run()}schedule(){this.scheduler.schedule(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function lQ(){}function cQ(t,n){Il("NgSignals"),!n?.injector&&JR(lQ);let e=n?.injector??pe(Hn),r=n?.manualCleanup!==!0?e.get(Tp):null,o=new hE(e.get(aQ),t,typeof Zone>"u"?null:Zone.current,r,e,n?.allowSignalWrites??!1),i=e.get($t,null,{optional:!0});return!i||!(i._lView[Xe]&8)?o.watcher.notify():(i._lView[E0]??=[]).push(o.watcher.notify),o}var uQ=sQ;var gE=class{[Br];constructor(n){this[Br]=n}destroy(){this[Br].destroy()}};function _h(t,n){if(uQ)return cQ(t,n);Il("NgSignals"),!n?.injector&&JR(_h);let e=n?.injector??pe(Hn),r=n?.manualCleanup!==!0?e.get(Tp):null,o,i=e.get(nM,null,{optional:!0}),s=e.get(bu);return i!==null&&!n?.forceRoot?(o=fQ(i.view,s,t),r instanceof W0&&r._lView===i.view&&(r=null)):o=mQ(t,e.get(LO),s),o.injector=e,r!==null&&(o.onDestroyFn=r.onDestroy(()=>o.destroy())),new gE(o)}var rM=qe(me({},iu),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:fh,run(){if(this.dirty=!1,this.hasRun&&!nh(this))return;this.hasRun=!0;let t=r=>(this.cleanupFns??=[]).push(r),n=Zd(this),e=V0(!1);try{this.maybeCleanup(),this.fn(t)}finally{V0(e),th(this,n)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),dQ=qe(me({},rM),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(13)},destroy(){Jd(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),pQ=qe(me({},rM),{consumerMarkedDirty(){this.view[Xe]|=8192,bh(this.view),this.notifier.notify(14)},destroy(){Jd(this),this.onDestroyFn(),this.maybeCleanup(),this.view[hu]?.delete(this)}});function fQ(t,n,e){let r=Object.create(pQ);return r.view=t,r.zone=typeof Zone<"u"?Zone.current:null,r.notifier=n,r.fn=e,t[hu]??=new Set,t[hu].add(r),r.consumerMarkedDirty(r),r}function mQ(t,n,e){let r=Object.create(dQ);return r.fn=t,r.scheduler=n,r.notifier=e,r.zone=typeof Zone<"u"?Zone.current:null,r.scheduler.schedule(r),r.notifier.notify(13),r}var uM=null;function js(){return uM}function dM(t){uM??=t}var Px=class{};var Xr=new Me(""),pM=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>pe(hQ),providedIn:"platform"})}return t})();var hQ=(()=>{class t extends pM{_location;_history;_doc=pe(Xr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return js().getBaseHref(this._doc)}onPopState(e){let r=js().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=js().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function fM(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function oM(t){let n=t.match(/#|\?|$/),e=n&&n.index||t.length,r=e-(t[e-1]==="/"?1:0);return t.slice(0,r)+t.slice(e)}function Nu(t){return t&&t[0]!=="?"?"?"+t:t}var Op=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>pe(mM),providedIn:"root"})}return t})(),gQ=new Me(""),mM=(()=>{class t extends Op{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??pe(Xr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return fM(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+Nu(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+Nu(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+Nu(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||t)($e(pM),$e(gQ,8))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Sh=(()=>{class t{_subject=new $n;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=vQ(oM(iM(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Nu(r))}normalize(e){return t.stripTrailingSlash(xQ(this._basePath,iM(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Nu(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Nu(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=Nu;static joinWithSlash=fM;static stripTrailingSlash=oM;static \u0275fac=function(r){return new(r||t)($e(Op))};static \u0275prov=Re({token:t,factory:()=>yQ(),providedIn:"root"})}return t})();function yQ(){return new Sh($e(Op))}function xQ(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function iM(t){return t.replace(/\/index.html$/,"")}function vQ(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}var Rr=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Rr||{}),Yt=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Yt||{}),fo=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(fo||{}),Nl={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function bQ(t){return Mo(t)[Cn.LocaleId]}function wQ(t,n,e){let r=Mo(t),o=[r[Cn.DayPeriodsFormat],r[Cn.DayPeriodsStandalone]],i=Fo(o,n);return Fo(i,e)}function CQ(t,n,e){let r=Mo(t),o=[r[Cn.DaysFormat],r[Cn.DaysStandalone]],i=Fo(o,n);return Fo(i,e)}function _Q(t,n,e){let r=Mo(t),o=[r[Cn.MonthsFormat],r[Cn.MonthsStandalone]],i=Fo(o,n);return Fo(i,e)}function SQ(t,n){let r=Mo(t)[Cn.Eras];return Fo(r,n)}function Dx(t,n){let e=Mo(t);return Fo(e[Cn.DateFormat],n)}function Nx(t,n){let e=Mo(t);return Fo(e[Cn.TimeFormat],n)}function kx(t,n){let r=Mo(t)[Cn.DateTimeFormat];return Fo(r,n)}function Lx(t,n){let e=Mo(t),r=e[Cn.NumberSymbols][n];if(typeof r>"u"){if(n===Nl.CurrencyDecimal)return e[Cn.NumberSymbols][Nl.Decimal];if(n===Nl.CurrencyGroup)return e[Cn.NumberSymbols][Nl.Group]}return r}function hM(t){if(!t[Cn.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[Cn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function EQ(t){let n=Mo(t);return hM(n),(n[Cn.ExtraData][2]||[]).map(r=>typeof r=="string"?s1(r):[s1(r[0]),s1(r[1])])}function IQ(t,n,e){let r=Mo(t);hM(r);let o=[r[Cn.ExtraData][0],r[Cn.ExtraData][1]],i=Fo(o,n)||[];return Fo(i,e)||[]}function Fo(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function s1(t){let[n,e]=t.split(":");return{hours:+n,minutes:+e}}var TQ=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,Ax={},DQ=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function NQ(t,n,e,r){let o=LQ(t);n=Us(e,n)||n;let s=[],a;for(;n;)if(a=DQ.exec(n),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;n=u}else{s.push(n);break}let l=o.getTimezoneOffset();r&&(l=yM(r,l),o=$Q(o,r,!0));let c="";return s.forEach(u=>{let d=FQ(u);c+=d?d(o,e,l):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function $x(t,n,e){let r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function Us(t,n){let e=bQ(t);if(Ax[e]??={},Ax[e][n])return Ax[e][n];let r="";switch(n){case"shortDate":r=Dx(t,fo.Short);break;case"mediumDate":r=Dx(t,fo.Medium);break;case"longDate":r=Dx(t,fo.Long);break;case"fullDate":r=Dx(t,fo.Full);break;case"shortTime":r=Nx(t,fo.Short);break;case"mediumTime":r=Nx(t,fo.Medium);break;case"longTime":r=Nx(t,fo.Long);break;case"fullTime":r=Nx(t,fo.Full);break;case"short":let o=Us(t,"shortTime"),i=Us(t,"shortDate");r=Rx(kx(t,fo.Short),[o,i]);break;case"medium":let s=Us(t,"mediumTime"),a=Us(t,"mediumDate");r=Rx(kx(t,fo.Medium),[s,a]);break;case"long":let l=Us(t,"longTime"),c=Us(t,"longDate");r=Rx(kx(t,fo.Long),[l,c]);break;case"full":let u=Us(t,"fullTime"),d=Us(t,"fullDate");r=Rx(kx(t,fo.Full),[u,d]);break}return r&&(Ax[e][n]=r),r}function Rx(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return n!=null&&r in n?n[r]:e})),t}function Si(t,n,e="-",r,o){let i="";(t<0||o&&t<=0)&&(o?t=-t+1:(t=-t,i=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),i+s}function kQ(t,n){return Si(t,3).substring(0,n)}function Nn(t,n,e=0,r=!1,o=!1){return function(i,s){let a=AQ(t,i);if((e>0||a>-e)&&(a+=e),t===3)a===0&&e===-12&&(a=12);else if(t===6)return kQ(a,n);let l=Lx(s,Nl.MinusSign);return Si(a,n,l,r,o)}}function AQ(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}function rn(t,n,e=Rr.Format,r=!1){return function(o,i){return RQ(o,i,t,n,e,r)}}function RQ(t,n,e,r,o,i){switch(e){case 2:return _Q(n,o,r)[t.getMonth()];case 1:return CQ(n,o,r)[t.getDay()];case 0:let s=t.getHours(),a=t.getMinutes();if(i){let c=EQ(n),u=IQ(n,o,r),d=c.findIndex(p=>{if(Array.isArray(p)){let[f,m]=p,h=s>=f.hours&&a>=f.minutes,g=s<m.hours||s===m.hours&&a<m.minutes;if(f.hours<m.hours){if(h&&g)return!0}else if(h||g)return!0}else if(p.hours===s&&p.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return wQ(n,o,r)[s<12?0:1];case 3:return SQ(n,r)[t.getFullYear()<=0?0:1];default:let l=e;throw new Error(`unexpected translation type ${l}`)}}function Ox(t){return function(n,e,r){let o=-1*r,i=Lx(e,Nl.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case 0:return(o>=0?"+":"")+Si(s,2,i)+Si(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+Si(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+Si(s,2,i)+":"+Si(Math.abs(o%60),2,i);case 3:return r===0?"Z":(o>=0?"+":"")+Si(s,2,i)+":"+Si(Math.abs(o%60),2,i);default:throw new Error(`Unknown zone width "${t}"`)}}}var OQ=0,Fx=4;function MQ(t){let n=$x(t,OQ,1).getDay();return $x(t,0,1+(n<=Fx?Fx:Fx+7)-n)}function gM(t){let n=t.getDay(),e=n===0?-3:Fx-n;return $x(t.getFullYear(),t.getMonth(),t.getDate()+e)}function a1(t,n=!1){return function(e,r){let o;if(n){let i=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+i)/7)}else{let i=gM(e),s=MQ(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Si(o,t,Lx(r,Nl.MinusSign))}}function Mx(t,n=!1){return function(e,r){let i=gM(e).getFullYear();return Si(i,t,Lx(r,Nl.MinusSign),n)}}var l1={};function FQ(t){if(l1[t])return l1[t];let n;switch(t){case"G":case"GG":case"GGG":n=rn(3,Yt.Abbreviated);break;case"GGGG":n=rn(3,Yt.Wide);break;case"GGGGG":n=rn(3,Yt.Narrow);break;case"y":n=Nn(0,1,0,!1,!0);break;case"yy":n=Nn(0,2,0,!0,!0);break;case"yyy":n=Nn(0,3,0,!1,!0);break;case"yyyy":n=Nn(0,4,0,!1,!0);break;case"Y":n=Mx(1);break;case"YY":n=Mx(2,!0);break;case"YYY":n=Mx(3);break;case"YYYY":n=Mx(4);break;case"M":case"L":n=Nn(1,1,1);break;case"MM":case"LL":n=Nn(1,2,1);break;case"MMM":n=rn(2,Yt.Abbreviated);break;case"MMMM":n=rn(2,Yt.Wide);break;case"MMMMM":n=rn(2,Yt.Narrow);break;case"LLL":n=rn(2,Yt.Abbreviated,Rr.Standalone);break;case"LLLL":n=rn(2,Yt.Wide,Rr.Standalone);break;case"LLLLL":n=rn(2,Yt.Narrow,Rr.Standalone);break;case"w":n=a1(1);break;case"ww":n=a1(2);break;case"W":n=a1(1,!0);break;case"d":n=Nn(2,1);break;case"dd":n=Nn(2,2);break;case"c":case"cc":n=Nn(7,1);break;case"ccc":n=rn(1,Yt.Abbreviated,Rr.Standalone);break;case"cccc":n=rn(1,Yt.Wide,Rr.Standalone);break;case"ccccc":n=rn(1,Yt.Narrow,Rr.Standalone);break;case"cccccc":n=rn(1,Yt.Short,Rr.Standalone);break;case"E":case"EE":case"EEE":n=rn(1,Yt.Abbreviated);break;case"EEEE":n=rn(1,Yt.Wide);break;case"EEEEE":n=rn(1,Yt.Narrow);break;case"EEEEEE":n=rn(1,Yt.Short);break;case"a":case"aa":case"aaa":n=rn(0,Yt.Abbreviated);break;case"aaaa":n=rn(0,Yt.Wide);break;case"aaaaa":n=rn(0,Yt.Narrow);break;case"b":case"bb":case"bbb":n=rn(0,Yt.Abbreviated,Rr.Standalone,!0);break;case"bbbb":n=rn(0,Yt.Wide,Rr.Standalone,!0);break;case"bbbbb":n=rn(0,Yt.Narrow,Rr.Standalone,!0);break;case"B":case"BB":case"BBB":n=rn(0,Yt.Abbreviated,Rr.Format,!0);break;case"BBBB":n=rn(0,Yt.Wide,Rr.Format,!0);break;case"BBBBB":n=rn(0,Yt.Narrow,Rr.Format,!0);break;case"h":n=Nn(3,1,-12);break;case"hh":n=Nn(3,2,-12);break;case"H":n=Nn(3,1);break;case"HH":n=Nn(3,2);break;case"m":n=Nn(4,1);break;case"mm":n=Nn(4,2);break;case"s":n=Nn(5,1);break;case"ss":n=Nn(5,2);break;case"S":n=Nn(6,1);break;case"SS":n=Nn(6,2);break;case"SSS":n=Nn(6,3);break;case"Z":case"ZZ":case"ZZZ":n=Ox(0);break;case"ZZZZZ":n=Ox(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=Ox(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=Ox(2);break;default:return null}return l1[t]=n,n}function yM(t,n){t=t.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function PQ(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function $Q(t,n,e){let r=e?-1:1,o=t.getTimezoneOffset(),i=yM(n,o);return PQ(t,r*(i-o))}function LQ(t){if(sM(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[o,i=1,s=1]=t.split("-").map(a=>+a);return $x(o,i-1,s)}let e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(TQ))return VQ(r)}let n=new Date(t);if(!sM(n))throw new Error(`Unable to convert "${t}" into a date`);return n}function VQ(t){let n=new Date(0),e=0,r=0,o=t[8]?n.setUTCFullYear:n.setFullYear,i=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),o.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,l=Number(t[6]||0),c=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return i.call(n,s,a,l,c),n}function sM(t){return t instanceof Date&&!isNaN(t.valueOf())}function Vx(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var c1=/\s+/,aM=[],Po=(()=>{class t{_ngEl;_renderer;initialClasses=aM;rawClass;stateMap=new Map;constructor(e,r){this._ngEl=e,this._renderer=r}set klass(e){this.initialClasses=e!=null?e.trim().split(c1):aM}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(c1):e}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let r of e)this._updateState(r,!0);else if(e!=null)for(let r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){let o=this.stateMap.get(e);o!==void 0?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){e=e.trim(),e.length>0&&e.split(c1).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(r){return new(r||t)(oe(Ro),oe(wi))};static \u0275dir=Rt({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var u1=class{$implicit;ngForOf;index;count;constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},mr=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new u1(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),lM(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);lM(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(oe(Np),oe(Sx),oe(i1))};static \u0275dir=Rt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function lM(t,n){t.context.$implicit=n.item}var pn=(()=>{class t{_viewContainer;_context=new d1;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){cM("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){cM("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(oe(Np),oe(Sx))};static \u0275dir=Rt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),d1=class{$implicit=null;ngIf=null};function cM(t,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${Dr(n)}'.`)}function BQ(t,n){return new De(2100,!1)}var zQ="mediumDate",UQ=new Me(""),jQ=new Me(""),es=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,r,o){this.locale=e,this.defaultTimezone=r,this.defaultOptions=o}transform(e,r,o,i){if(e==null||e===""||e!==e)return null;try{let s=r??this.defaultOptions?.dateFormat??zQ,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return NQ(e,s,i||this.locale,a)}catch(s){throw BQ(t,s.message)}}static \u0275fac=function(r){return new(r||t)(oe(Tx,16),oe(UQ,24),oe(jQ,24))};static \u0275pipe=DO({name:"date",type:t,pure:!0})}return t})();var Qt=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Vs({type:t});static \u0275inj=Ms({})}return t})(),f1="browser",GQ="server";function vn(t){return t===f1}function m1(t){return t===GQ}var Rp=class{};var Th=class{},Dh=class{},Gs=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=e.slice(r+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.addHeaderEntry(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new t;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,e);let o=(n.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=n.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(n,e){let r=n.toLowerCase();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(e):this.headers.set(r,[e])}setHeaderEntries(n,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var y1=class{encodeKey(n){return xM(n)}encodeValue(n){return xM(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function WQ(t,n){let e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],l=e.get(s)||[];l.push(a),e.set(s,l)}),e}var HQ=/%(\d[a-f0-9])/gi,qQ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function xM(t){return encodeURIComponent(t).replace(HQ,(n,e)=>qQ[e]??n)}function Bx(t){return`${t}`}var Al=class t{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new y1,n.fromString){if(n.fromObject)throw new De(2805,!1);this.map=WQ(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let r=n.fromObject[e],o=Array.isArray(r)?r.map(Bx):[Bx(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(r=>{let o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new t({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push(Bx(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let r=this.map.get(n.param)||[],o=r.indexOf(Bx(n.value));o!==-1&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var x1=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function KQ(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function vM(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function bM(t){return typeof Blob<"u"&&t instanceof Blob}function wM(t){return typeof FormData<"u"&&t instanceof FormData}function XQ(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var Eh="Content-Type",zx="Accept",w1="X-Request-URL",EM="text/plain",IM="application/json",TM=`${IM}, ${EM}, */*`,Ih=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(n,e,r,o){this.url=e,this.method=n.toUpperCase();let i;if(KQ(this.method)||o?(this.body=r!==void 0?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new Gs,this.context??=new x1,!this.params)this.params=new Al,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),l=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||vM(this.body)||bM(this.body)||wM(this.body)||XQ(this.body)?this.body:this.body instanceof Al?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||wM(this.body)?null:bM(this.body)?this.body.type||null:vM(this.body)?null:typeof this.body=="string"?EM:this.body instanceof Al?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?IM:null}clone(n={}){let e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=n.transferCache??this.transferCache,s=n.body!==void 0?n.body:this.body,a=n.withCredentials??this.withCredentials,l=n.reportProgress??this.reportProgress,c=n.headers||this.headers,u=n.params||this.params,d=n.context??this.context;return n.setHeaders!==void 0&&(c=Object.keys(n.setHeaders).reduce((p,f)=>p.set(f,n.setHeaders[f]),c)),n.setParams&&(u=Object.keys(n.setParams).reduce((p,f)=>p.set(f,n.setParams[f]),u)),new t(e,r,s,{params:u,headers:c,context:d,reportProgress:l,responseType:o,withCredentials:a,transferCache:i})}},Rl=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Rl||{}),Nh=class{headers;status;statusText;url;ok;type;constructor(n,e=200,r="OK"){this.headers=n.headers||new Gs,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},Ux=class t extends Nh{constructor(n={}){super(n)}type=Rl.ResponseHeader;clone(n={}){return new t({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},kh=class t extends Nh{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=Rl.Response;clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},kl=class extends Nh{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},DM=200,YQ=204;function h1(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}var QQ=(()=>{class t{handler;constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof Ih)i=e;else{let l;o.headers instanceof Gs?l=o.headers:l=new Gs(o.headers);let c;o.params&&(o.params instanceof Al?c=o.params:c=new Al({fromObject:o.params})),i=new Ih(e,r,o.body!==void 0?o.body:null,{headers:l,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let s=Ke(i).pipe(vl(l=>this.handler.handle(l)));if(e instanceof Ih||o.observe==="events")return s;let a=s.pipe(ao(l=>l instanceof kh));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(nt(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new De(2806,!1);return l.body}));case"blob":return a.pipe(nt(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new De(2807,!1);return l.body}));case"text":return a.pipe(nt(l=>{if(l.body!==null&&typeof l.body!="string")throw new De(2808,!1);return l.body}));case"json":default:return a.pipe(nt(l=>l.body))}case"response":return a;default:throw new De(2809,!1)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:new Al().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,h1(o,r))}post(e,r,o={}){return this.request("POST",e,h1(o,r))}put(e,r,o={}){return this.request("PUT",e,h1(o,r))}static \u0275fac=function(r){return new(r||t)($e(Th))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),ZQ=/^\)\]\}',?\n/;function CM(t){if(t.url)return t.url;let n=w1.toLocaleLowerCase();return t.headers.get(n)}var NM=new Me(""),g1=(()=>{class t{fetchImpl=pe(v1,{optional:!0})?.fetch??((...e)=>globalThis.fetch(...e));ngZone=pe(Tn);handle(e){return new Ct(r=>{let o=new AbortController;return this.doRequest(e,o.signal,r).then(b1,i=>r.error(new kl({error:i}))),()=>o.abort()})}async doRequest(e,r,o){let i=this.createRequestInit(e),s;try{let f=this.ngZone.runOutsideAngular(()=>this.fetchImpl(e.urlWithParams,me({signal:r},i)));JQ(f),o.next({type:Rl.Sent}),s=await f}catch(f){o.error(new kl({error:f,status:f.status??0,statusText:f.statusText,url:e.urlWithParams,headers:f.headers}));return}let a=new Gs(s.headers),l=s.statusText,c=CM(s)??e.urlWithParams,u=s.status,d=null;if(e.reportProgress&&o.next(new Ux({headers:a,status:u,statusText:l,url:c})),s.body){let f=s.headers.get("content-length"),m=[],h=s.body.getReader(),g=0,x,b,S=typeof Zone<"u"&&Zone.current;await this.ngZone.runOutsideAngular(async()=>{for(;;){let{done:E,value:I}=await h.read();if(E)break;if(m.push(I),g+=I.length,e.reportProgress){b=e.responseType==="text"?(b??"")+(x??=new TextDecoder).decode(I,{stream:!0}):void 0;let D=()=>o.next({type:Rl.DownloadProgress,total:f?+f:void 0,loaded:g,partialText:b});S?S.run(D):D()}}});let _=this.concatChunks(m,g);try{let E=s.headers.get(Eh)??"";d=this.parseBody(e,_,E)}catch(E){o.error(new kl({error:E,headers:new Gs(s.headers),status:s.status,statusText:s.statusText,url:CM(s)??e.urlWithParams}));return}}u===0&&(u=d?DM:0),u>=200&&u<300?(o.next(new kh({body:d,headers:a,status:u,statusText:l,url:c})),o.complete()):o.error(new kl({error:d,headers:a,status:u,statusText:l,url:c}))}parseBody(e,r,o){switch(e.responseType){case"json":let i=new TextDecoder().decode(r).replace(ZQ,"");return i===""?null:JSON.parse(i);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:o});case"arraybuffer":return r.buffer}}createRequestInit(e){let r={},o=e.withCredentials?"include":void 0;if(e.headers.forEach((i,s)=>r[i]=s.join(",")),e.headers.has(zx)||(r[zx]=TM),!e.headers.has(Eh)){let i=e.detectContentTypeHeader();i!==null&&(r[Eh]=i)}return{body:e.serializeBody(),method:e.method,headers:r,credentials:o}}concatChunks(e,r){let o=new Uint8Array(r),i=0;for(let s of e)o.set(s,i),i+=s.length;return o}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),v1=class{};function b1(){}function JQ(t){t.then(b1,b1)}function eZ(t,n){return n(t)}function tZ(t,n,e){return(r,o)=>ir(e,()=>n(r,i=>t(i,o)))}var kM=new Me(""),nZ=new Me(""),rZ=new Me("",{providedIn:"root",factory:()=>!0});var _M=(()=>{class t extends Th{backend;injector;chain=null;pendingTasks=pe(Ls);contributeToStability=pe(rZ);constructor(e,r){super(),this.backend=e,this.injector=r}handle(e){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(kM),...this.injector.get(nZ,[])]));this.chain=r.reduceRight((o,i)=>tZ(o,i,this.injector),eZ)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(cu(()=>this.pendingTasks.remove(r)))}else return this.chain(e,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||t)($e(Dh),$e(Wr))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})();var oZ=/^\)\]\}',?\n/,iZ=RegExp(`^${w1}:`,"m");function sZ(t){return"responseURL"in t&&t.responseURL?t.responseURL:iZ.test(t.getAllResponseHeaders())?t.getResponseHeader(w1):null}var SM=(()=>{class t{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new De(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?mn(r.\u0275loadImpl()):Ke(null)).pipe(lo(()=>new Ct(i=>{let s=r.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((h,g)=>s.setRequestHeader(h,g.join(","))),e.headers.has(zx)||s.setRequestHeader(zx,TM),!e.headers.has(Eh)){let h=e.detectContentTypeHeader();h!==null&&s.setRequestHeader(Eh,h)}if(e.responseType){let h=e.responseType.toLowerCase();s.responseType=h!=="json"?h:"text"}let a=e.serializeBody(),l=null,c=()=>{if(l!==null)return l;let h=s.statusText||"OK",g=new Gs(s.getAllResponseHeaders()),x=sZ(s)||e.url;return l=new Ux({headers:g,status:s.status,statusText:h,url:x}),l},u=()=>{let{headers:h,status:g,statusText:x,url:b}=c(),S=null;g!==YQ&&(S=typeof s.response>"u"?s.responseText:s.response),g===0&&(g=S?DM:0);let _=g>=200&&g<300;if(e.responseType==="json"&&typeof S=="string"){let E=S;S=S.replace(oZ,"");try{S=S!==""?JSON.parse(S):null}catch(I){S=E,_&&(_=!1,S={error:I,text:S})}}_?(i.next(new kh({body:S,headers:h,status:g,statusText:x,url:b||void 0})),i.complete()):i.error(new kl({error:S,headers:h,status:g,statusText:x,url:b||void 0}))},d=h=>{let{url:g}=c(),x=new kl({error:h,status:s.status||0,statusText:s.statusText||"Unknown Error",url:g||void 0});i.error(x)},p=!1,f=h=>{p||(i.next(c()),p=!0);let g={type:Rl.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),e.responseType==="text"&&s.responseText&&(g.partialText=s.responseText),i.next(g)},m=h=>{let g={type:Rl.UploadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),i.next(g)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),e.reportProgress&&(s.addEventListener("progress",f),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:Rl.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),e.reportProgress&&(s.removeEventListener("progress",f),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(r){return new(r||t)($e(Rp))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),AM=new Me(""),aZ="XSRF-TOKEN",lZ=new Me("",{providedIn:"root",factory:()=>aZ}),cZ="X-XSRF-TOKEN",uZ=new Me("",{providedIn:"root",factory:()=>cZ}),jx=class{},dZ=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o}getToken(){if(this.platform==="server")return null;let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=Vx(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(r){return new(r||t)($e(Xr),$e(Oo),$e(lZ))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})();function pZ(t,n){let e=t.url.toLowerCase();if(!pe(AM)||t.method==="GET"||t.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return n(t);let r=pe(jx).getToken(),o=pe(uZ);return r!=null&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var RM=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(RM||{});function fZ(t,n){return{\u0275kind:t,\u0275providers:n}}function OM(...t){let n=[QQ,SM,_M,{provide:Th,useExisting:_M},{provide:Dh,useFactory:()=>pe(NM,{optional:!0})??pe(SM)},{provide:kM,useValue:pZ,multi:!0},{provide:AM,useValue:!0},{provide:jx,useClass:dZ}];for(let e of t)n.push(...e.\u0275providers);return Ep(n)}function MM(){return fZ(RM.Fetch,[g1,{provide:NM,useExisting:g1},{provide:Dh,useExisting:g1}])}var _1=class extends Px{supportsDOMEvents=!0},S1=class t extends _1{static makeCurrent(){dM(new t)}onAndCancel(n,e,r,o){return n.addEventListener(e,r,o),()=>{n.removeEventListener(e,r,o)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=mZ();return e==null?null:hZ(e)}resetBaseElement(){Ah=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return Vx(document.cookie,n)}},Ah=null;function mZ(){return Ah=Ah||document.querySelector("base"),Ah?Ah.getAttribute("href"):null}function hZ(t){return new URL(t,document.baseURI).pathname}var gZ=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),E1=new Me(""),BM=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new De(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||t)($e(E1),$e(Tn))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),Wx=class{_doc;constructor(n){this._doc=n}manager},Gx="ng-app-id";function FM(t){for(let n of t)n.remove()}function PM(t,n){let e=n.createElement("style");return e.textContent=t,e}function yZ(t,n,e,r){let o=t.head?.querySelectorAll(`style[${Gx}="${n}"],link[${Gx}="${n}"]`);if(o)for(let i of o)i.removeAttribute(Gx),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function I1(t,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}var zM=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=m1(i),yZ(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,PM);r?.forEach(o=>this.addUsage(o,this.external,I1))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(FM(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])FM(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,PM(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,I1(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(Gx,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||t)($e(Xr),$e(ME),$e(PE,8),$e(Oo))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),C1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},D1=/%COMP%/g;var UM="%COMP%",xZ=`_nghost-${UM}`,vZ=`_ngcontent-${UM}`,bZ=!0,wZ=new Me("",{providedIn:"root",factory:()=>bZ});function CZ(t){return vZ.replace(D1,t)}function _Z(t){return xZ.replace(D1,t)}function jM(t,n){return n.map(e=>e.replace(D1,t))}var $M=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=m1(a),this.defaultRenderer=new Rh(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Yi.ShadowDom&&(r=qe(me({},r),{encapsulation:Yi.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof Hx?o.applyToHost(e):o instanceof Oh&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,p=this.tracingService;switch(r.encapsulation){case Yi.Emulated:i=new Hx(l,c,r,this.appId,u,s,a,d,p);break;case Yi.ShadowDom:return new T1(l,c,e,r,s,a,this.nonce,d,p);default:i=new Oh(l,c,r,u,s,a,d,p);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||t)($e(BM),$e(zM),$e(ME),$e(wZ),$e(Xr),$e(Oo),$e(Tn),$e(PE),$e(bx,8))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),Rh=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,r,o,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(C1[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(LM(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(LM(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){e.remove()}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new De(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=C1[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=C1[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(As.DashCase|As.Important)?n.style.setProperty(e,r,o&As.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&As.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r,o){if(typeof n=="string"&&(n=js().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${e}`);let i=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,e,i)),this.eventManager.addEventListener(n,e,i,o)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function LM(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var T1=class extends Rh{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,l,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=jM(o.id,u);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let d=o.getExternalStyles?.();if(d)for(let p of d){let f=I1(p,i);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Oh=class extends Rh{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let u=r.styles;this.styles=c?jM(c,u):u,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},Hx=class extends Oh{contentAttr;hostAttr;constructor(n,e,r,o,i,s,a,l,c){let u=o+"-"+r.id;super(n,e,r,i,s,a,l,c,u),this.contentAttr=CZ(u),this.hostAttr=_Z(u)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}},SZ=(()=>{class t extends Wx{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||t)($e(Xr))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),VM=["alt","control","meta","shift"],EZ={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},IZ={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},TZ=(()=>{class t extends Wx{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>js().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),VM.forEach(c=>{let u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=EZ[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),VM.forEach(s=>{if(s!==o){let a=IZ[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||t)($e(Xr))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})();function GM(t,n){return tM(me({rootComponent:t},DZ(n)))}function DZ(t){return{appProviders:[...OZ,...t?.providers??[]],platformProviders:RZ}}function NZ(){S1.makeCurrent()}function kZ(){return new ks}function AZ(){return H2(document),document}var RZ=[{provide:Oo,useValue:f1},{provide:FE,useValue:NZ,multi:!0},{provide:Xr,useFactory:AZ,deps:[]}];var OZ=[{provide:lx,useValue:"root"},{provide:ks,useFactory:kZ,deps:[]},{provide:E1,useClass:SZ,multi:!0,deps:[Xr,Tn,Oo]},{provide:E1,useClass:TZ,multi:!0,deps:[Xr]},$M,zM,BM,{provide:_p,useExisting:$M},{provide:Rp,useClass:gZ,deps:[]},[]];var WM=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||t)($e(Xr))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var rt="primary",Kh=Symbol("RouteTitle"),O1=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function Vp(t){return new O1(t)}function FZ(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=t[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function PZ(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!ts(t[e],n[e]))return!1;return!0}function ts(t,n){let e=t?M1(t):void 0,r=n?M1(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!JM(t[o],n[o]))return!1;return!0}function M1(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function JM(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function eF(t){return t.length>0?t[t.length-1]:null}function Ml(t){return dS(t)?t:Iu(t)?mn(Promise.resolve(t)):Ke(t)}var $Z={exact:nF,subset:rF},tF={exact:LZ,subset:VZ,ignored:()=>!0};function HM(t,n,e){return $Z[e.paths](t.root,n.root,e.matrixParams)&&tF[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function LZ(t,n){return ts(t,n)}function nF(t,n,e){if(!Au(t.segments,n.segments)||!Xx(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!nF(t.children[r],n.children[r],e))return!1;return!0}function VZ(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>JM(t[e],n[e]))}function rF(t,n,e){return oF(t,n,n.segments,e)}function oF(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!Au(o,e)||n.hasChildren()||!Xx(o,e,r))}else if(t.segments.length===e.length){if(!Au(t.segments,e)||!Xx(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!rF(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!Au(t.segments,o)||!Xx(t.segments,o,r)||!t.children[rt]?!1:oF(t.children[rt],n,i,r)}}function Xx(t,n,e){return n.every((r,o)=>tF[e](t[o].parameters,r.parameters))}var Hs=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Lt([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=Vp(this.queryParams),this._queryParamMap}toString(){return UZ.serialize(this)}},Lt=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Yx(this)}},ku=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=Vp(this.parameters),this._parameterMap}toString(){return sF(this)}};function BZ(t,n){return Au(t,n)&&t.every((e,r)=>ts(e.parameters,n[r].parameters))}function Au(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function zZ(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===rt&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==rt&&(e=e.concat(n(o,r)))}),e}var sI=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>new Vh,providedIn:"root"})}return t})(),Vh=class{parse(n){let e=new P1(n);return new Hs(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${Mh(n.root,!0)}`,r=WZ(n.queryParams),o=typeof n.fragment=="string"?`#${jZ(n.fragment)}`:"";return`${e}${r}${o}`}},UZ=new Vh;function Yx(t){return t.segments.map(n=>sF(n)).join("/")}function Mh(t,n){if(!t.hasChildren())return Yx(t);if(n){let e=t.children[rt]?Mh(t.children[rt],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==rt&&r.push(`${o}:${Mh(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=zZ(t,(r,o)=>o===rt?[Mh(t.children[rt],!1)]:[`${o}:${Mh(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[rt]!=null?`${Yx(t)}/${e[0]}`:`${Yx(t)}/(${e.join("//")})`}}function iF(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function qx(t){return iF(t).replace(/%3B/gi,";")}function jZ(t){return encodeURI(t)}function F1(t){return iF(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Qx(t){return decodeURIComponent(t)}function qM(t){return Qx(t.replace(/\+/g,"%20"))}function sF(t){return`${F1(t.path)}${GZ(t.parameters)}`}function GZ(t){return Object.entries(t).map(([n,e])=>`;${F1(n)}=${F1(e)}`).join("")}function WZ(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${qx(e)}=${qx(o)}`).join("&"):`${qx(e)}=${qx(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var HZ=/^[^\/()?;#]+/;function N1(t){let n=t.match(HZ);return n?n[0]:""}var qZ=/^[^\/()?;=#]+/;function KZ(t){let n=t.match(qZ);return n?n[0]:""}var XZ=/^[^=?&#]+/;function YZ(t){let n=t.match(XZ);return n?n[0]:""}var QZ=/^[^&#]+/;function ZZ(t){let n=t.match(QZ);return n?n[0]:""}var P1=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Lt([],{}):new Lt([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[rt]=new Lt(n,e)),r}parseSegment(){let n=N1(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new De(4009,!1);return this.capture(n),new ku(Qx(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=KZ(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=N1(this.remaining);o&&(r=o,this.capture(r))}n[Qx(e)]=Qx(r)}parseQueryParam(n){let e=YZ(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=ZZ(this.remaining);s&&(r=s,this.capture(r))}let o=qM(e),i=qM(r);if(n.hasOwnProperty(o)){let s=n[o];Array.isArray(s)||(s=[s],n[o]=s),s.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=N1(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new De(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=rt);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[rt]:new Lt([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new De(4011,!1)}};function aF(t){return t.segments.length>0?new Lt([],{[rt]:t}):t}function lF(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=lF(o);if(r===rt&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))n[s]=a;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new Lt(t.segments,n);return JZ(e)}function JZ(t){if(t.numberOfChildren===1&&t.children[rt]){let n=t.children[rt];return new Lt(t.segments.concat(n.segments),n.children)}return t}function Ru(t){return t instanceof Hs}function eJ(t,n,e=null,r=null){let o=cF(t);return uF(o,n,e,r)}function cF(t){let n;function e(i){let s={};for(let l of i.children){let c=e(l);s[l.outlet]=c}let a=new Lt(i.url,s);return i===t&&(n=a),a}let r=e(t.root),o=aF(r);return n??o}function uF(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return k1(o,o,o,e,r);let i=tJ(n);if(i.toRoot())return k1(o,o,new Lt([],{}),e,r);let s=nJ(i,o,t),a=s.processChildren?Ph(s.segmentGroup,s.index,i.commands):pF(s.segmentGroup,s.index,i.commands);return k1(o,s.segmentGroup,a,e,r)}function Zx(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function Bh(t){return typeof t=="object"&&t!=null&&t.outlets}function k1(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([l,c])=>{i[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;t===n?s=e:s=dF(t,n,e);let a=aF(lF(s));return new Hs(a,i,o)}function dF(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=dF(i,n,e)}),new Lt(t.segments,r)}var Jx=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Zx(r[0]))throw new De(4003,!1);let o=r.find(Bh);if(o&&o!==eF(r))throw new De(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function tJ(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new Jx(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?n++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new Jx(e,n,r)}var Pp=class{segmentGroup;processChildren;index;constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function nJ(t,n,e){if(t.isAbsolute)return new Pp(n,!0,0);if(!e)return new Pp(n,!1,NaN);if(e.parent===null)return new Pp(e,!0,0);let r=Zx(t.commands[0])?0:1,o=e.segments.length-1+r;return rJ(e,o,t.numberOfDoubleDots)}function rJ(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new De(4005,!1);o=r.segments.length}return new Pp(r,!1,o-i)}function oJ(t){return Bh(t[0])?t[0].outlets:{[rt]:t}}function pF(t,n,e){if(t??=new Lt([],{}),t.segments.length===0&&t.hasChildren())return Ph(t,n,e);let r=iJ(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new Lt(t.segments.slice(0,r.pathIndex),{});return i.children[rt]=new Lt(t.segments.slice(r.pathIndex),t.children),Ph(i,0,o)}else return r.match&&o.length===0?new Lt(t.segments,{}):r.match&&!t.hasChildren()?$1(t,n,e):r.match?Ph(t,0,o):$1(t,n,e)}function Ph(t,n,e){if(e.length===0)return new Lt(t.segments,{});{let r=oJ(e),o={};if(Object.keys(r).some(i=>i!==rt)&&t.children[rt]&&t.numberOfChildren===1&&t.children[rt].segments.length===0){let i=Ph(t.children[rt],n,e);return new Lt(t.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=pF(t.children[i],n,s))}),Object.entries(t.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new Lt(t.segments,o)}}function iJ(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let s=t.segments[o],a=e[r];if(Bh(a))break;let l=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!XM(l,c,s))return i;r+=2}else{if(!XM(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function $1(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(Bh(i)){let l=sJ(i.outlets);return new Lt(r,l)}if(o===0&&Zx(e[0])){let l=t.segments[n];r.push(new ku(l.path,KM(e[0]))),o++;continue}let s=Bh(i)?i.outlets[rt]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&Zx(a)?(r.push(new ku(s,KM(a))),o+=2):(r.push(new ku(s,{})),o++)}return new Lt(r,{})}function sJ(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=$1(new Lt([],{}),0,r))}),n}function KM(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function XM(t,n,e){return t==e.path&&ts(n,e.parameters)}var $h="imperative",sr=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(sr||{}),$o=class{id;url;constructor(n,e){this.id=n,this.url=e}},zh=class extends $o{type=sr.NavigationStart;navigationTrigger;restoredState;constructor(n,e,r="imperative",o=null){super(n,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Ol=class extends $o{urlAfterRedirects;type=sr.NavigationEnd;constructor(n,e,r){super(n,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},ho=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(ho||{}),L1=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(L1||{}),Ws=class extends $o{reason;code;type=sr.NavigationCancel;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},Ou=class extends $o{reason;code;type=sr.NavigationSkipped;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}},Uh=class extends $o{error;target;type=sr.NavigationError;constructor(n,e,r,o){super(n,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},ev=class extends $o{urlAfterRedirects;state;type=sr.RoutesRecognized;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},V1=class extends $o{urlAfterRedirects;state;type=sr.GuardsCheckStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},B1=class extends $o{urlAfterRedirects;state;shouldActivate;type=sr.GuardsCheckEnd;constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},z1=class extends $o{urlAfterRedirects;state;type=sr.ResolveStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},U1=class extends $o{urlAfterRedirects;state;type=sr.ResolveEnd;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},j1=class{route;type=sr.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},G1=class{route;type=sr.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},W1=class{snapshot;type=sr.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},H1=class{snapshot;type=sr.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},q1=class{snapshot;type=sr.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},K1=class{snapshot;type=sr.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var jh=class{},Bp=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function aJ(t,n){return t.providers&&!t._injector&&(t._injector=JE(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Ei(t){return t.outlet||rt}function lJ(t,n){let e=t.filter(r=>Ei(r)===n);return e.push(...t.filter(r=>Ei(r)!==n)),e}function Xh(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var X1=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Xh(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new av(this.rootInjector)}},av=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new X1(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||t)($e(Wr))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),tv=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=Y1(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=Y1(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=Q1(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return Q1(n,this._root).map(e=>e.value)}};function Y1(t,n){if(t===n.value)return n;for(let e of n.children){let r=Y1(t,e);if(r)return r}return null}function Q1(t,n){if(t===n.value)return[n];for(let e of n.children){let r=Q1(t,e);if(r.length)return r.unshift(n),r}return[]}var mo=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function Fp(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var nv=class extends tv{snapshot;constructor(n,e){super(n),this.snapshot=e,aI(this,n)}toString(){return this.snapshot.toString()}};function fF(t){let n=cJ(t),e=new rr([new ku("",{})]),r=new rr({}),o=new rr({}),i=new rr({}),s=new rr(""),a=new Ii(e,r,i,s,o,rt,t,n.root);return a.snapshot=n.root,new nv(new mo(a,[]),n)}function cJ(t){let n={},e={},r={},o="",i=new $p([],n,r,o,e,rt,t,null,{});return new ov("",new mo(i,[]))}var Ii=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,r,o,i,s,a,l){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(nt(c=>c[Kh]))??Ke(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(nt(n=>Vp(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(nt(n=>Vp(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function rv(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:me(me({},n.params),t.params),data:me(me({},n.data),t.data),resolve:me(me(me(me({},t.data),n.data),o?.data),t._resolvedData)}:r={params:me({},t.params),data:me({},t.data),resolve:me(me({},t.data),t._resolvedData??{})},o&&hF(o)&&(r.resolve[Kh]=o.title),r}var $p=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[Kh]}constructor(n,e,r,o,i,s,a,l,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Vp(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Vp(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},ov=class extends tv{url;constructor(n,e){super(e),this.url=n,aI(this,e)}toString(){return mF(this._root)}};function aI(t,n){n.value._routerState=t,n.children.forEach(e=>aI(t,e))}function mF(t){let n=t.children.length>0?` { ${t.children.map(mF).join(", ")} } `:"";return`${t.value}${n}`}function A1(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,ts(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),ts(n.params,e.params)||t.paramsSubject.next(e.params),PZ(n.url,e.url)||t.urlSubject.next(e.url),ts(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function Z1(t,n){let e=ts(t.params,n.params)&&BZ(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||Z1(t.parent,n.parent))}function hF(t){return typeof t.title=="string"||t.title===null}var uJ=new Me(""),lI=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=rt;activateEvents=new jt;deactivateEvents=new jt;attachEvents=new jt;detachEvents=new jt;routerOutletData=L2(void 0);parentContexts=pe(av);location=pe(Np);changeDetector=pe($t);inputBinder=pe(cI,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new De(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new De(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new De(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new De(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new J1(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Rt({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[vi]})}return t})(),J1=class t{route;childContexts;parent;outletData;__ngOutletInjector(n){return new t(this.route,this.childContexts,n,this.outletData)}constructor(n,e,r,o){this.route=n,this.childContexts=e,this.parent=r,this.outletData=o}get(n,e){return n===Ii?this.route:n===av?this.childContexts:n===uJ?this.outletData:this.parent.get(n,e)}},cI=new Me("");function dJ(t,n,e){let r=Gh(t,n._root,e?e._root:void 0);return new nv(r,n)}function Gh(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=pJ(t,n,e);return new mo(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>Gh(t,a)),s}}let r=fJ(n.value),o=n.children.map(i=>Gh(t,i));return new mo(r,o)}}function pJ(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return Gh(t,r,o);return Gh(t,r)})}function fJ(t){return new Ii(new rr(t.url),new rr(t.params),new rr(t.queryParams),new rr(t.fragment),new rr(t.data),t.outlet,t.component,t)}var Wh=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},gF="ngNavigationCancelingError";function iv(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Ru(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=yF(!1,ho.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function yF(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[gF]=!0,e.cancellationCode=n,e}function mJ(t){return xF(t)&&Ru(t.url)}function xF(t){return!!t&&t[gF]}var hJ=(t,n,e,r)=>nt(o=>(new eI(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),eI=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),A1(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=Fp(e);n.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Fp(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Fp(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=Fp(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new K1(i.value.snapshot))}),n.children.length&&this.forwardEvent(new H1(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(A1(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),A1(a.route.value),this.activateChildRoutes(n,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(n,null,s.children)}else this.activateChildRoutes(n,null,r)}},sv=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},Lp=class{component;route;constructor(n,e){this.component=n,this.route=e}};function gJ(t,n,e){let r=t._root,o=n?n._root:null;return Fh(r,o,e,[r.value])}function yJ(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function Up(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!OR(t)?t:n.get(t):r}function Fh(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Fp(n);return t.children.forEach(s=>{xJ(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>Lh(a,e.getContext(s),o)),o}function xJ(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=vJ(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new sv(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?Fh(t,n,a?a.children:null,r,o):Fh(t,n,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Lp(a.outlet.component,s))}else s&&Lh(n,a,o),o.canActivateChecks.push(new sv(r)),i.component?Fh(t,null,a?a.children:null,r,o):Fh(t,null,e,r,o);return o}function vJ(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!Au(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Au(t.url,n.url)||!ts(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Z1(t,n)||!ts(t.queryParams,n.queryParams);case"paramsChange":default:return!Z1(t,n)}}function Lh(t,n,e){let r=Fp(t),o=t.value;Object.entries(r).forEach(([i,s])=>{o.component?n?Lh(s,n.children.getContext(i),e):Lh(s,null,e):Lh(s,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new Lp(n.outlet.component,o)):e.canDeactivateChecks.push(new Lp(null,o)):e.canDeactivateChecks.push(new Lp(null,o))}function Yh(t){return typeof t=="function"}function bJ(t){return typeof t=="boolean"}function wJ(t){return t&&Yh(t.canLoad)}function CJ(t){return t&&Yh(t.canActivate)}function _J(t){return t&&Yh(t.canActivateChild)}function SJ(t){return t&&Yh(t.canDeactivate)}function EJ(t){return t&&Yh(t.canMatch)}function vF(t){return t instanceof Ss||t?.name==="EmptyError"}var Kx=Symbol("INITIAL_VALUE");function zp(){return lo(t=>y0(t.map(n=>n.pipe(Es(1),gS(Kx)))).pipe(nt(n=>{for(let e of n)if(e!==!0){if(e===Kx)return Kx;if(e===!1||IJ(e))return e}return!0}),ao(n=>n!==Kx),Es(1)))}function IJ(t){return Ru(t)||t instanceof Wh}function TJ(t,n){return Ln(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?Ke(qe(me({},e),{guardsResult:!0})):DJ(s,r,o,t).pipe(Ln(a=>a&&bJ(a)?NJ(r,i,t,n):Ke(a)),nt(a=>qe(me({},e),{guardsResult:a})))})}function DJ(t,n,e,r){return mn(t).pipe(Ln(o=>MJ(o.component,o.route,e,n,r)),Is(o=>o!==!0,!0))}function NJ(t,n,e,r){return mn(n).pipe(vl(o=>lp(AJ(o.route.parent,r),kJ(o.route,r),OJ(t,o.path,e),RJ(t,o.route,e))),Is(o=>o!==!0,!0))}function kJ(t,n){return t!==null&&n&&n(new q1(t)),Ke(!0)}function AJ(t,n){return t!==null&&n&&n(new W1(t)),Ke(!0)}function RJ(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return Ke(!0);let o=r.map(i=>x0(()=>{let s=Xh(n)??e,a=Up(i,s),l=CJ(a)?a.canActivate(n,t):ir(s,()=>a(n,t));return Ml(l).pipe(Is())}));return Ke(o).pipe(zp())}function OJ(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(s=>yJ(s)).filter(s=>s!==null).map(s=>x0(()=>{let a=s.guards.map(l=>{let c=Xh(s.node)??e,u=Up(l,c),d=_J(u)?u.canActivateChild(r,t):ir(c,()=>u(r,t));return Ml(d).pipe(Is())});return Ke(a).pipe(zp())}));return Ke(i).pipe(zp())}function MJ(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return Ke(!0);let s=i.map(a=>{let l=Xh(n)??o,c=Up(a,l),u=SJ(c)?c.canDeactivate(t,n,e,r):ir(l,()=>c(t,n,e,r));return Ml(u).pipe(Is())});return Ke(s).pipe(zp())}function FJ(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return Ke(!0);let i=o.map(s=>{let a=Up(s,t),l=wJ(a)?a.canLoad(n,e):ir(t,()=>a(n,e));return Ml(l)});return Ke(i).pipe(zp(),bF(r))}function bF(t){return aS(Wn(n=>{if(typeof n!="boolean")throw iv(t,n)}),nt(n=>n===!0))}function PJ(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return Ke(!0);let i=o.map(s=>{let a=Up(s,t),l=EJ(a)?a.canMatch(n,e):ir(t,()=>a(n,e));return Ml(l)});return Ke(i).pipe(zp(),bF(r))}var Hh=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},qh=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function Mp(t){return ap(new Hh(t))}function $J(t){return ap(new De(4e3,!1))}function LJ(t){return ap(yF(!1,ho.GuardRejected))}var tI=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return Ke(r);if(o.numberOfChildren>1||!o.children[rt])return $J(`${n.redirectTo}`);o=o.children[rt]}}applyRedirectCommands(n,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,params:f,data:m,title:h}=o,g=ir(i,()=>a({params:f,data:m,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,title:h}));if(g instanceof Hs)throw new qh(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e[0]==="/")throw new qh(s);return s}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new Hs(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(n,l,r,o)}),new Lt(i,s)}createSegments(n,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new De(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},nI={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function VJ(t,n,e,r,o){let i=wF(t,n,e);return i.matched?(r=aJ(n,r),PJ(r,n,e,o).pipe(nt(s=>s===!0?i:me({},nI)))):Ke(i)}function wF(t,n,e){if(n.path==="**")return BJ(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?me({},nI):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||FZ)(e,t,n);if(!o)return me({},nI);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?me(me({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function BJ(t){return{matched:!0,parameters:t.length>0?eF(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function YM(t,n,e,r){return e.length>0&&jJ(t,e,r)?{segmentGroup:new Lt(n,UJ(r,new Lt(e,t.children))),slicedSegments:[]}:e.length===0&&GJ(t,e,r)?{segmentGroup:new Lt(t.segments,zJ(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new Lt(t.segments,t.children),slicedSegments:e}}function zJ(t,n,e,r){let o={};for(let i of e)if(lv(t,n,i)&&!r[Ei(i)]){let s=new Lt([],{});o[Ei(i)]=s}return me(me({},r),o)}function UJ(t,n){let e={};e[rt]=n;for(let r of t)if(r.path===""&&Ei(r)!==rt){let o=new Lt([],{});e[Ei(r)]=o}return e}function jJ(t,n,e){return e.some(r=>lv(t,n,r)&&Ei(r)!==rt)}function GJ(t,n,e){return e.some(r=>lv(t,n,r))}function lv(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function WJ(t,n,e){return n.length===0&&!t.children[e]}var rI=class{};function HJ(t,n,e,r,o,i,s="emptyOnly"){return new oI(t,n,e,r,o,s,i).recognize()}var qJ=31,oI=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,r,o,i,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new tI(this.urlSerializer,this.urlTree)}noMatchError(n){return new De(4002,`'${n.segmentGroup}'`)}recognize(){let n=YM(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(nt(({children:e,rootSnapshot:r})=>{let o=new mo(r,e),i=new ov("",o),s=eJ(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(n){let e=new $p([],Object.freeze({}),Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),rt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,rt,e).pipe(nt(r=>({children:r,rootSnapshot:e})),xl(r=>{if(r instanceof qh)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Hh?this.noMatchError(r):r}))}processSegmentGroup(n,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r,i):this.processSegment(n,e,r,r.segments,o,!0,i).pipe(nt(s=>s instanceof mo?[s]:[]))}processChildren(n,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return mn(i).pipe(vl(s=>{let a=r.children[s],l=lJ(e,s);return this.processSegmentGroup(n,l,a,s,o)}),hS((s,a)=>(s.push(...a),s)),bl(null),mS(),Ln(s=>{if(s===null)return Mp(r);let a=CF(s);return KJ(a),Ke(a)}))}processSegment(n,e,r,o,i,s,a){return mn(e).pipe(vl(l=>this.processSegmentAgainstRoute(l._injector??n,e,l,r,o,i,s,a).pipe(xl(c=>{if(c instanceof Hh)return Ke(null);throw c}))),Is(l=>!!l),xl(l=>{if(vF(l))return WJ(r,o,i)?Ke(new rI):Mp(r);throw l}))}processSegmentAgainstRoute(n,e,r,o,i,s,a,l){return Ei(r)!==s&&(s===rt||!lv(o,i,r))?Mp(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,s,l):Mp(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:p}=wF(e,o,i);if(!l)return Mp(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>qJ&&(this.allowRedirects=!1));let f=new $p(i,c,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,QM(o),Ei(o),o.component??o._loadedComponent??null,o,ZM(o)),m=rv(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(m.params),f.data=Object.freeze(m.data);let h=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,f,n);return this.applyRedirects.lineralizeSegments(o,h).pipe(Ln(g=>this.processSegment(n,r,e,g.concat(p),s,!1,a)))}matchSegmentAgainstRoute(n,e,r,o,i,s){let a=VJ(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(lo(l=>l.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(lo(({routes:c})=>{let u=r._loadedInjector??n,{parameters:d,consumedSegments:p,remainingSegments:f}=l,m=new $p(p,d,Object.freeze(me({},this.urlTree.queryParams)),this.urlTree.fragment,QM(r),Ei(r),r.component??r._loadedComponent??null,r,ZM(r)),h=rv(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(h.params),m.data=Object.freeze(h.data);let{segmentGroup:g,slicedSegments:x}=YM(e,p,f,c);if(x.length===0&&g.hasChildren())return this.processChildren(u,c,g,m).pipe(nt(S=>new mo(m,S)));if(c.length===0&&x.length===0)return Ke(new mo(m,[]));let b=Ei(r)===i;return this.processSegment(u,c,g,x,b?rt:i,!0,m).pipe(nt(S=>new mo(m,S instanceof mo?[S]:[])))}))):Mp(e)))}getChildConfig(n,e,r){return e.children?Ke({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?Ke({routes:e._loadedRoutes,injector:e._loadedInjector}):FJ(n,e,r,this.urlSerializer).pipe(Ln(o=>o?this.configLoader.loadChildren(n,e).pipe(Wn(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):LJ(e))):Ke({routes:[],injector:n})}};function KJ(t){t.sort((n,e)=>n.value.outlet===rt?-1:e.value.outlet===rt?1:n.value.outlet.localeCompare(e.value.outlet))}function XJ(t){let n=t.value.routeConfig;return n&&n.path===""}function CF(t){let n=[],e=new Set;for(let r of t){if(!XJ(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=CF(r.children);n.push(new mo(r.value,o))}return n.filter(r=>!e.has(r))}function QM(t){return t.data||{}}function ZM(t){return t.resolve||{}}function YJ(t,n,e,r,o,i){return Ln(s=>HJ(t,n,e,r,s.extractedUrl,o,i).pipe(nt(({state:a,tree:l})=>qe(me({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function QJ(t,n){return Ln(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return Ke(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let c of _F(l))s.add(c);let a=0;return mn(s).pipe(vl(l=>i.has(l)?ZJ(l,r,t,n):(l.data=rv(l,l.parent,t).resolve,Ke(void 0))),Wn(()=>a++),cp(1),Ln(l=>a===s.size?Ke(e):zr))})}function _F(t){let n=t.children.map(e=>_F(e)).flat();return[t,...n]}function ZJ(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!hF(o)&&(i[Kh]=o.title),JJ(i,t,n,r).pipe(nt(s=>(t._resolvedData=s,t.data=rv(t,t.parent,e).resolve,null)))}function JJ(t,n,e,r){let o=M1(t);if(o.length===0)return Ke({});let i={};return mn(o).pipe(Ln(s=>eee(t[s],n,e,r).pipe(Is(),Wn(a=>{if(a instanceof Wh)throw iv(new Vh,a);i[s]=a}))),cp(1),nt(()=>i),xl(s=>vF(s)?zr:ap(s)))}function eee(t,n,e,r){let o=Xh(n)??r,i=Up(t,o),s=i.resolve?i.resolve(n,e):ir(o,()=>i(n,e));return Ml(s)}function R1(t){return lo(n=>{let e=t(n);return e?mn(e).pipe(nt(()=>n)):Ke(n)})}var SF=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===rt);return r}getResolvedTitleForRoute(e){return e.data[Kh]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>pe(tee),providedIn:"root"})}return t})(),tee=(()=>{class t extends SF{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)($e(WM))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),uI=new Me("",{providedIn:"root",factory:()=>({})}),nee=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=Tt({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&U(0,"router-outlet")},dependencies:[lI],encapsulation:2})}return t})();function dI(t){let n=t.children&&t.children.map(dI),e=n?qe(me({},t),{children:n}):me({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==rt&&(e.component=nee),e}var pI=new Me(""),ree=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=pe(o1);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Ke(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=Ml(e.loadComponent()).pipe(nt(EF),Wn(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),cu(()=>{this.componentLoaders.delete(e)})),o=new sp(r,()=>new $n).pipe(ip());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ke({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=oee(r,this.compiler,e,this.onLoadEndListener).pipe(cu(()=>{this.childrenLoaders.delete(r)})),s=new sp(i,()=>new $n).pipe(ip());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function oee(t,n,e,r){return Ml(t.loadChildren()).pipe(nt(EF),Ln(o=>o instanceof hh||Array.isArray(o)?Ke(o):mn(n.compileModuleAsync(o))),nt(o=>{r&&r(t);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(pI,[],{optional:!0,self:!0}).flat()),{routes:s.map(dI),injector:i}}))}function iee(t){return t&&typeof t=="object"&&"default"in t}function EF(t){return iee(t)?t.default:t}var fI=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>pe(see),providedIn:"root"})}return t})(),see=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),aee=new Me("");var lee=new Me(""),cee=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new $n;transitionAbortSubject=new $n;configLoader=pe(ree);environmentInjector=pe(Wr);destroyRef=pe(Tp);urlSerializer=pe(sI);rootContexts=pe(av);location=pe(Sh);inputBindingEnabled=pe(cI,{optional:!0})!==null;titleStrategy=pe(SF);options=pe(uI,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=pe(fI);createViewTransition=pe(aee,{optional:!0});navigationErrorHandler=pe(lee,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Ke(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new j1(o)),r=o=>this.events.next(new G1(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(qe(me(me({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new rr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:$h,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(ao(i=>i.id!==0),nt(i=>qe(me({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),lo(i=>{let s=!1,a=!1;return Ke(i).pipe(lo(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",ho.SupersededByNewNavigation),zr;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?qe(me({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&u!=="reload"){let d="";return this.events.next(new Ou(l.id,this.urlSerializer.serialize(l.rawUrl),d,L1.IgnoredSameUrlNavigation)),l.resolve(!1),zr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return Ke(l).pipe(lo(d=>{let p=this.transitions?.getValue();return this.events.next(new zh(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?zr:Promise.resolve(d)}),YJ(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Wn(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=qe(me({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let p=new ev(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:p,source:f,restoredState:m,extras:h}=l,g=new zh(d,this.urlSerializer.serialize(p),f,m);this.events.next(g);let x=fF(this.rootComponentType).snapshot;return this.currentTransition=i=qe(me({},l),{targetSnapshot:x,urlAfterRedirects:p,extras:qe(me({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,Ke(i)}else{let d="";return this.events.next(new Ou(l.id,this.urlSerializer.serialize(l.extractedUrl),d,L1.IgnoredByUrlHandlingStrategy)),l.resolve(!1),zr}}),Wn(l=>{let c=new V1(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),nt(l=>(this.currentTransition=i=qe(me({},l),{guards:gJ(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),TJ(this.environmentInjector,l=>this.events.next(l)),Wn(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw iv(this.urlSerializer,l.guardsResult);let c=new B1(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),ao(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",ho.GuardRejected),!1)),R1(l=>{if(l.guards.canActivateChecks.length)return Ke(l).pipe(Wn(c=>{let u=new z1(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),lo(c=>{let u=!1;return Ke(c).pipe(QJ(this.paramsInheritanceStrategy,this.environmentInjector),Wn({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",ho.NoDataFromResolver)}}))}),Wn(c=>{let u=new U1(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),R1(l=>{let c=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(Wn(p=>{u.component=p}),nt(()=>{})));for(let p of u.children)d.push(...c(p));return d};return y0(c(l.targetSnapshot.root)).pipe(bl(null),Es(1))}),R1(()=>this.afterPreactivation()),lo(()=>{let{currentSnapshot:l,targetSnapshot:c}=i,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?mn(u).pipe(nt(()=>i)):Ke(i)}),nt(l=>{let c=dJ(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=qe(me({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),Wn(()=>{this.events.next(new jh)}),hJ(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Es(1),Wn({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Ol(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),yS(this.transitionAbortSubject.pipe(Wn(l=>{throw l}))),cu(()=>{!s&&!a&&this.cancelNavigationTransition(i,"",ho.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),xl(l=>{if(this.destroyed)return i.resolve(!1),zr;if(a=!0,xF(l))this.events.next(new Ws(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),mJ(l)?this.events.next(new Bp(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let c=new Uh(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let u=ir(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof Wh){let{message:d,cancellationCode:p}=iv(this.urlSerializer,u);this.events.next(new Ws(i.id,this.urlSerializer.serialize(i.extractedUrl),d,p)),this.events.next(new Bp(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return zr}))}))}cancelNavigationTransition(e,r,o){let i=new Ws(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function uee(t){return t!==$h}var dee=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>pe(pee),providedIn:"root"})}return t})(),iI=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},pee=(()=>{class t extends iI{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),IF=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>pe(fee),providedIn:"root"})}return t})(),fee=(()=>{class t extends IF{location=pe(Sh);urlSerializer=pe(sI);options=pe(uI,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=pe(fI);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new Hs;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=fF(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof zh)this.stateMemento=this.createStateMemento();else if(e instanceof Ou)this.rawUrlTree=r.initialUrl;else if(e instanceof ev){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else e instanceof jh?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):e instanceof Ws&&(e.code===ho.GuardRejected||e.code===ho.NoDataFromResolver)?this.restoreHistory(r):e instanceof Uh?this.restoreHistory(r,!0):e instanceof Ol&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=e instanceof Hs?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,s=me(me({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",s)}else{let i=me(me({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function mee(t,n){t.events.pipe(ao(e=>e instanceof Ol||e instanceof Ws||e instanceof Uh||e instanceof Ou),nt(e=>e instanceof Ol||e instanceof Ou?0:(e instanceof Ws?e.code===ho.Redirect||e.code===ho.SupersededByNewNavigation:!1)?2:1),ao(e=>e!==2),Es(1)).subscribe(()=>{n()})}var hee={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},gee={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},go=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=pe(n1);stateManager=pe(IF);options=pe(uI,{optional:!0})||{};pendingTasks=pe(Ls);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=pe(cee);urlSerializer=pe(sI);location=pe(Sh);urlHandlingStrategy=pe(fI);_events=new $n;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=pe(dee);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=pe(pI,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!pe(cI,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new En;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof Ws&&r.code!==ho.Redirect&&r.code!==ho.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Ol)this.navigated=!0;else if(r instanceof Bp){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=me({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||uee(o.source)},s);this.scheduleNavigation(a,$h,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}xee(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),$h,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=me({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(dI),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=me(me({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let p=o?o.snapshot:this.routerState.snapshot.root;d=cF(p)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),d=this.currentUrlTree.root}return uF(d,e,u,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Ru(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,$h,null,r)}navigate(e,r={skipLocationChange:!1}){return yee(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=me({},hee):r===!1?o=me({},gee):o=r,Ru(e))return HM(this.currentUrlTree,e,o);let i=this.parseUrl(e);return HM(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,p)=>{a=d,l=p});let u=this.pendingTasks.add();return mee(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function yee(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new De(4008,!1)}function xee(t){return!(t instanceof jh)&&!(t instanceof Bp)}var hr=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new $n;constructor(e,r,o,i,s,a){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a;let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof Ol&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Ru(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,r,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||r||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.href=e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;let r=this.href===null?null:Z2(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(e,r){let o=this.renderer,i=this.el.nativeElement;r!==null?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return this.routerLinkInput===null?null:Ru(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(r){return new(r||t)(oe(go),oe(Ii),kE("tabindex"),oe(wi),oe(Ro),oe(Op))};static \u0275dir=Rt({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,o){r&1&&le("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),r&2&&kp("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Du],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Du],replaceUrl:[2,"replaceUrl","replaceUrl",Du],routerLink:"routerLink"},features:[e1,vi]})}return t})();var vee=new Me("");function TF(t,...n){return Ep([{provide:pI,multi:!0,useValue:t},[],{provide:Ii,useFactory:bee,deps:[go]},{provide:Ex,multi:!0,useFactory:wee},n.map(e=>e.\u0275providers)])}function bee(t){return t.routerState.root}function wee(){let t=pe(Hn);return n=>{let e=t.get(Os);if(n!==e.components[0])return;let r=t.get(go),o=t.get(Cee);t.get(_ee)===1&&r.initialNavigation(),t.get(See,null,at.Optional)?.setUpPreloading(),t.get(vee,null,at.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var Cee=new Me("",{factory:()=>new $n}),_ee=new Me("",{providedIn:"root",factory:()=>1});var See=new Me("");var DF=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)};var Zh=class extends Error{constructor(n,e="FunctionsError",r){super(n),this.name=e,this.context=r}},cv=class extends Zh{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}},uv=class extends Zh{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}},dv=class extends Zh{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}},mI=function(t){return t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2",t}(mI||{});var Eee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Jh=class{constructor(n,{headers:e={},customFetch:r,region:o=mI.Any}={}){this.url=n,this.headers=e,this.region=o,this.fetch=DF(r)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,e={}){var r;return Eee(this,void 0,void 0,function*(){try{let{headers:o,method:i,body:s}=e,a={},{region:l}=e;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;s&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=s):typeof s=="string"?(a["Content-Type"]="text/plain",c=s):typeof FormData<"u"&&s instanceof FormData?c=s:(a["Content-Type"]="application/json",c=JSON.stringify(s)));let u=yield this.fetch(`${this.url}/${n}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:c}).catch(m=>{throw new cv(m)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new uv(u);if(!u.ok)throw new dv(u);let p=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return p==="application/json"?f=yield u.json():p==="application/octet-stream"?f=yield u.blob():p==="text/event-stream"?f=u:p==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(o){return{data:null,error:o}}})}};var zF=Zm(BF(),1),{PostgrestClient:UF,PostgrestQueryBuilder:GIe,PostgrestFilterBuilder:WIe,PostgrestTransformBuilder:HIe,PostgrestBuilder:qIe,PostgrestError:$ee}=zF.default;var jF="2.11.2";var GF={"X-Client-Info":`realtime-js/${jF}`},WF="1.0.0",hv=1e4,HF=1e3,Gp=function(t){return t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed",t}(Gp||{}),yo=function(t){return t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving",t}(yo||{}),Lo=function(t){return t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token",t}(Lo||{}),II=function(t){return t.websocket="websocket",t}(II||{}),Mu=function(t){return t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed",t}(Mu||{});var gv=class{constructor(){this.HEADER_LENGTH=1}decode(n,e){return n.constructor===ArrayBuffer?e(this._binaryDecode(n)):e(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){let e=new DataView(n),r=new TextDecoder;return this._decodeBroadcast(n,e,r)}_decodeBroadcast(n,e,r){let o=e.getUint8(1),i=e.getUint8(2),s=this.HEADER_LENGTH+2,a=r.decode(n.slice(s,s+o));s=s+o;let l=r.decode(n.slice(s,s+i));s=s+i;let c=JSON.parse(r.decode(n.slice(s,n.byteLength)));return{ref:null,topic:a,event:l,payload:c}}};var Wp=class{constructor(n,e){this.callback=n,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var sn=function(t){return t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange",t}(sn||{}),DI=(t,n,e={})=>{var r;let o=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(n).reduce((i,s)=>(i[s]=Lee(s,t,n,o),i),{})},Lee=(t,n,e,r)=>{let o=n.find(a=>a.name===t),i=o?.type,s=e[t];return i&&!r.includes(i)?qF(i,s):TI(s)},qF=(t,n)=>{if(t.charAt(0)==="_"){let e=t.slice(1,t.length);return Uee(n,e)}switch(t){case sn.bool:return Vee(n);case sn.float4:case sn.float8:case sn.int2:case sn.int4:case sn.int8:case sn.numeric:case sn.oid:return Bee(n);case sn.json:case sn.jsonb:return zee(n);case sn.timestamp:return jee(n);case sn.abstime:case sn.date:case sn.daterange:case sn.int4range:case sn.int8range:case sn.money:case sn.reltime:case sn.text:case sn.time:case sn.timestamptz:case sn.timetz:case sn.tsrange:case sn.tstzrange:return TI(n);default:return TI(n)}},TI=t=>t,Vee=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Bee=t=>{if(typeof t=="string"){let n=parseFloat(t);if(!Number.isNaN(n))return n}return t},zee=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(n){return console.log(`JSON parse error: ${n}`),t}return t},Uee=(t,n)=>{if(typeof t!="string")return t;let e=t.length-1,r=t[e];if(t[0]==="{"&&r==="}"){let i,s=t.slice(1,e);try{i=JSON.parse("["+s+"]")}catch{i=s?s.split(","):[]}return i.map(a=>qF(n,a))}return t},jee=t=>typeof t=="string"?t.replace(" ","T"):t,yv=t=>{let n=t;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};var Hp=class{constructor(n,e,r={},o=hv){this.channel=n,this.event=e,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,e){var r;return this._hasReceived(n)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:n,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let n=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:e}){this.recHooks.filter(r=>r.status===n).forEach(r=>r.callback(e))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}};var sg=class t{constructor(n,e){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,o,i,s),this.pendingDiffs.forEach(l=>{this.state=t.syncDiff(this.state,l,i,s)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t.syncDiff(this.state,o,i,s),a())}),this.onJoin((o,i,s)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:i,newPresences:s})}),this.onLeave((o,i,s)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:i,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,e,r,o){let i=this.cloneDeep(n),s=this.transformState(e),a={},l={};return this.map(i,(c,u)=>{s[c]||(l[c]=u)}),this.map(s,(c,u)=>{let d=i[c];if(d){let p=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),h=d.filter(g=>p.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),h.length>0&&(l[c]=h)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,o)}static syncDiff(n,e,r,o){let{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(i,(a,l)=>{var c;let u=(c=n[a])!==null&&c!==void 0?c:[];if(n[a]=this.cloneDeep(l),u.length>0){let d=n[a].map(f=>f.presence_ref),p=u.filter(f=>d.indexOf(f.presence_ref)<0);n[a].unshift(...p)}r(a,u,l)}),this.map(s,(a,l)=>{let c=n[a];if(!c)return;let u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),n[a]=c,o(a,c,l),c.length===0&&delete n[a]}),n}static map(n,e){return Object.getOwnPropertyNames(n).map(r=>e(r,n[r]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((e,r)=>{let o=n[r];return"metas"in o?e[r]=o.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=o,e},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var qs=function(t){return t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR",t}(qs||{});var ag=class t{constructor(n,e={config:{}},r){this.topic=n,this.params=e,this.socket=r,this.bindings={},this.state=yo.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Hp(this,Lo.join,this.params,this.timeout),this.rejoinTimer=new Wp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=yo.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=yo.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=yo.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=yo.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Lo.reply,{},(o,i)=>{this._trigger(this._replyEventName(i),o)}),this.presence=new sg(this),this.broadcastEndpointURL=yv(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(n,e=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:s,private:a}}=this.params;this._onError(u=>n?.(qs.CHANNEL_ERROR,u)),this._onClose(()=>n?.(qs.CLOSED));let l={},c={broadcast:i,presence:s,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){n?.(qs.SUBSCRIBED);return}else{let p=this.bindings.postgres_changes,f=(d=p?.length)!==null&&d!==void 0?d:0,m=[];for(let h=0;h<f;h++){let g=p[h],{filter:{event:x,schema:b,table:S,filter:_}}=g,E=u&&u[h];if(E&&E.event===x&&E.schema===b&&E.table===S&&E.filter===_)m.push(Object.assign(Object.assign({},g),{id:E.id}));else{this.unsubscribe(),n?.(qs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,n&&n(qs.SUBSCRIBED);return}}).receive("error",u=>{n?.(qs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{n?.(qs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,e={}){return await this.send({type:"presence",event:"track",payload:n},e.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,e,r){return this._on(n,e,r)}async send(n,e={}){var r,o;if(!this._canPush()&&n.type==="broadcast"){let{event:i,payload:s}=n,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s,private:this.private}]})};try{let c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var s,a,l;let c=this._push(n.type,n,e.timeout||this.timeout);n.type==="broadcast"&&!(!((l=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=yo.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Lo.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let o=new Hp(this,Lo.leave,{},n);o.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}async _fetchWithTimeout(n,e,r){let o=new AbortController,i=setTimeout(()=>o.abort(),r),s=await this.socket.fetch(n,Object.assign(Object.assign({},e),{signal:o.signal}));return clearTimeout(i),s}_push(n,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Hp(this,n,e,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(n,e,r){return e}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,e,r){var o,i;let s=n.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Lo;if(r&&[a,l,c,u].indexOf(s)>=0&&r!==this._joinRef())return;let p=this._onMessage(s,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var m,h,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(h=f.filter)===null||h===void 0?void 0:h.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===s}).map(f=>f.callback(p,r)):(i=this.bindings[s])===null||i===void 0||i.filter(f=>{var m,h,g,x,b,S;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in f){let _=f.id,E=(m=f.filter)===null||m===void 0?void 0:m.event;return _&&((h=e.ids)===null||h===void 0?void 0:h.includes(_))&&(E==="*"||E?.toLocaleLowerCase()===((g=e.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let _=(b=(x=f?.filter)===null||x===void 0?void 0:x.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return _==="*"||_===((S=e?.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===s}).map(f=>{if(typeof p=="object"&&"ids"in p){let m=p.data,{schema:h,table:g,commit_timestamp:x,type:b,errors:S}=m;p=Object.assign(Object.assign({},{schema:h,table:g,commit_timestamp:x,eventType:b,new:{},old:{},errors:S}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===yo.closed}_isJoined(){return this.state===yo.joined}_isJoining(){return this.state===yo.joining}_isLeaving(){return this.state===yo.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,e,r){let o=n.toLocaleLowerCase(),i={type:o,filter:e,callback:r};return this.bindings[o]?this.bindings[o].push(i):this.bindings[o]=[i],this}_off(n,e){let r=n.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var i;return!(((i=o.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&t.isEqual(o.filter,e))}),this}static isEqual(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(let r in n)if(n[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Lo.close,{},n)}_onError(n){this._on(Lo.error,{},e=>n(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=yo.joining,this.joinPush.resend(n))}_getPayloadRecords(n){let e={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(e.new=DI(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(e.old=DI(n.columns,n.old_record)),e}};var Wee=()=>{},Hee=typeof WebSocket<"u",qee=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,lg=class{constructor(n,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=GF,this.params={},this.timeout=hv,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Wee,this.conn=null,this.sendBuffer=[],this.serializer=new gv,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...a)=>import("./chunk-MAQGHWLI.js").then(({default:l})=>l(...a)):s=fetch,(...a)=>s(...a)},this.endPoint=`${n}/${II.websocket}`,this.httpEndpoint=yv(n),e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let o=(r=e?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e?.encode?e.encode:(i,s)=>s(JSON.stringify(i)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Wp(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch),e?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=e?.worker||!1,this.workerUrl=e?.workerUrl}this.accessToken=e?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Hee){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new NI(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-KYSFV2V4.js").then(({default:n})=>{this.conn=new n(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:WF}))}disconnect(n,e){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){let e=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){let n=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),n}log(n,e,r){this.logger(n,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Gp.connecting:return Mu.Connecting;case Gp.open:return Mu.Open;case Gp.closing:return Mu.Closing;default:return Mu.Closed}}isConnected(){return this.connectionState()===Mu.Open}channel(n,e={config:{}}){let r=new ag(`realtime:${n}`,e,this);return this.channels.push(r),r}push(n){let{topic:e,event:r,payload:o,ref:i}=n,s=()=>{this.encode(n,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${r} (${i})`,o),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(n=null){let e=n||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(o=>{e&&o.updateJoinPayload({access_token:e}),o.joinedOnce&&o._isJoined()&&o._push(Lo.access_token,{access_token:e})})}}async sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(HF,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let e=this.channels.find(r=>r.topic===n&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${n}"`),e.unsubscribe())}_remove(n){this.channels=this.channels.filter(e=>e._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_onConnMessage(n){this.decode(n.data,e=>{let{topic:r,event:o,payload:i,ref:s}=e;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${o} ${s&&"("+s+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,i,s)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(Lo.error))}_appendParams(n,e){if(Object.keys(e).length===0)return n;let r=n.match(/\?/)?"&":"?",o=new URLSearchParams(e);return`${n}${r}${o}`}_workerObjectUrl(n){let e;if(n)e=n;else{let r=new Blob([qee],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}};var NI=class{constructor(n,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Gp.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=r.close}};var qp=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function kn(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var xv=class extends qp{constructor(n,e){super(n),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},Fu=class extends qp{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};var Kee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},bv=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},KF=()=>Kee(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-MAQGHWLI.js")).Response:Response}),vv=t=>{if(Array.isArray(t))return t.map(e=>vv(e));if(typeof t=="function"||t!==Object(t))return t;let n={};return Object.entries(t).forEach(([e,r])=>{let o=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));n[o]=vv(r)}),n};var Pu=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},kI=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Xee=(t,n,e)=>Pu(void 0,void 0,void 0,function*(){let r=yield KF();t instanceof r&&!e?.noResolveJson?t.json().then(o=>{n(new xv(kI(o),t.status||500))}).catch(o=>{n(new Fu(kI(o),o))}):n(new Fu(kI(t),t))}),Yee=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},n?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),e))};function cg(t,n,e,r,o,i){return Pu(this,void 0,void 0,function*(){return new Promise((s,a)=>{t(e,Yee(n,r,o,i)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>Xee(l,a,r))})})}function Kp(t,n,e,r){return Pu(this,void 0,void 0,function*(){return cg(t,"GET",n,e,r)})}function ns(t,n,e,r,o){return Pu(this,void 0,void 0,function*(){return cg(t,"POST",n,r,o,e)})}function XF(t,n,e,r,o){return Pu(this,void 0,void 0,function*(){return cg(t,"PUT",n,r,o,e)})}function YF(t,n,e,r){return Pu(this,void 0,void 0,function*(){return cg(t,"HEAD",n,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function wv(t,n,e,r,o){return Pu(this,void 0,void 0,function*(){return cg(t,"DELETE",n,r,o,e)})}var Yr=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Qee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},QF={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Cv=class{constructor(n,e={},r,o){this.url=n,this.headers=e,this.bucketId=r,this.fetch=bv(o)}uploadOrUpdate(n,e,r,o){return Yr(this,void 0,void 0,function*(){try{let i,s=Object.assign(Object.assign({},QF),o),a=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(s.upsert)}),l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let c=this._removeEmptyFolders(e),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:n,body:i,headers:a},s?.duplex?{duplex:s.duplex}:{})),p=yield d.json();return d.ok?{data:{path:c,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(kn(i))return{data:null,error:i};throw i}})}upload(n,e,r){return Yr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,e,r)})}uploadToSignedUrl(n,e,r,o){return Yr(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(n),s=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let l,c=Object.assign({upsert:QF.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(l){if(kn(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(n,e){return Yr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(n),o=Object.assign({},this.headers);e?.upsert&&(o["x-upsert"]="true");let i=yield ns(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),s=new URL(this.url+i.url),a=s.searchParams.get("token");if(!a)throw new qp("No token returned by API");return{data:{signedUrl:s.toString(),path:n,token:a},error:null}}catch(r){if(kn(r))return{data:null,error:r};throw r}})}update(n,e,r){return Yr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,e,r)})}move(n,e,r){return Yr(this,void 0,void 0,function*(){try{return{data:yield ns(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(kn(o))return{data:null,error:o};throw o}})}copy(n,e,r){return Yr(this,void 0,void 0,function*(){try{return{data:{path:(yield ns(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(kn(o))return{data:null,error:o};throw o}})}createSignedUrl(n,e,r){return Yr(this,void 0,void 0,function*(){try{let o=this._getFinalPath(n),i=yield ns(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(o){if(kn(o))return{data:null,error:o};throw o}})}createSignedUrls(n,e,r){return Yr(this,void 0,void 0,function*(){try{let o=yield ns(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:n},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${i}`):null})),error:null}}catch(o){if(kn(o))return{data:null,error:o};throw o}})}download(n,e){return Yr(this,void 0,void 0,function*(){let o=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),s=i?`?${i}`:"";try{let a=this._getFinalPath(n);return{data:yield(yield Kp(this.fetch,`${this.url}/${o}/${a}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(kn(a))return{data:null,error:a};throw a}})}info(n){return Yr(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{let r=yield Kp(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:vv(r),error:null}}catch(r){if(kn(r))return{data:null,error:r};throw r}})}exists(n){return Yr(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{return yield YF(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(kn(r)&&r instanceof Fu){let o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(n,e){let r=this._getFinalPath(n),o=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&o.push(i);let a=typeof e?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(e?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(n){return Yr(this,void 0,void 0,function*(){try{return{data:yield wv(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(e){if(kn(e))return{data:null,error:e};throw e}})}list(n,e,r){return Yr(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},Qee),e),{prefix:n||""});return{data:yield ns(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(kn(o))return{data:null,error:o};throw o}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){let e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};var ZF="2.7.1";var JF={"X-Client-Info":`storage-js/${ZF}`};var Xp=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},_v=class{constructor(n,e={},r){this.url=n,this.headers=Object.assign(Object.assign({},JF),e),this.fetch=bv(r)}listBuckets(){return Xp(this,void 0,void 0,function*(){try{return{data:yield Kp(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(kn(n))return{data:null,error:n};throw n}})}getBucket(n){return Xp(this,void 0,void 0,function*(){try{return{data:yield Kp(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(e){if(kn(e))return{data:null,error:e};throw e}})}createBucket(n,e={public:!1}){return Xp(this,void 0,void 0,function*(){try{return{data:yield ns(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(kn(r))return{data:null,error:r};throw r}})}updateBucket(n,e){return Xp(this,void 0,void 0,function*(){try{return{data:yield XF(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(kn(r))return{data:null,error:r};throw r}})}emptyBucket(n){return Xp(this,void 0,void 0,function*(){try{return{data:yield ns(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(kn(e))return{data:null,error:e};throw e}})}deleteBucket(n){return Xp(this,void 0,void 0,function*(){try{return{data:yield wv(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(e){if(kn(e))return{data:null,error:e};throw e}})}};var ug=class extends _v{constructor(n,e={},r){super(n,e,r)}from(n){return new Cv(this.url,this.headers,n,this.fetch)}};var eP="2.48.1";var dg="";typeof Deno<"u"?dg="deno":typeof document<"u"?dg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?dg="react-native":dg="node";var Zee={"X-Client-Info":`supabase-js-${dg}/${eP}`},tP={headers:Zee},nP={schema:"public"},rP={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},oP={};rA();var Jee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},ete=t=>{let n;return t?n=t:typeof fetch>"u"?n=tA:n=fetch,(...e)=>n(...e)},tte=()=>typeof Headers>"u"?nA:Headers,iP=(t,n,e)=>{let r=ete(e),o=tte();return(i,s)=>Jee(void 0,void 0,void 0,function*(){var a;let l=(a=yield n())!==null&&a!==void 0?a:t,c=new o(s?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},s),{headers:c}))})};var nte=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})};function sP(t){return t.replace(/\/$/,"")}function aP(t,n){let{db:e,auth:r,realtime:o,global:i}=t,{db:s,auth:a,realtime:l,global:c}=n,u={db:Object.assign(Object.assign({},s),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),o),global:Object.assign(Object.assign({},c),i),accessToken:()=>nte(this,void 0,void 0,function*(){return""})};return t.accessToken?u.accessToken=t.accessToken:delete u.accessToken,u}var Sv="2.67.3";var lP="http://localhost:9999",cP="supabase.auth.token";var uP={"X-Client-Info":`gotrue-js/${Sv}`},AI=10;var pg="X-Supabase-Api-Version",RI={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function dP(t){return Math.round(Date.now()/1e3)+t}function pP(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=Math.random()*16|0;return(t=="x"?n:n&3|8).toString(16)})}var Ti=()=>typeof window<"u"&&typeof document<"u",$u={tested:!1,writable:!1},Fl=()=>{if(!Ti())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if($u.tested)return $u.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),$u.tested=!0,$u.writable=!0}catch{$u.tested=!0,$u.writable=!1}return $u.writable};function fP(t){let n={},e=new URL(t);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((o,i)=>{n[i]=o})}catch{}return e.searchParams.forEach((r,o)=>{n[o]=r}),n}var Ev=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},mP=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",OI=async(t,n,e)=>{await t.setItem(n,JSON.stringify(e))},mg=async(t,n)=>{let e=await t.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch{return e}},hg=async(t,n)=>{await t.removeItem(n)};function rte(t){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,o,i,s,a,l,c,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)s=n.indexOf(t.charAt(u++)),a=n.indexOf(t.charAt(u++)),l=n.indexOf(t.charAt(u++)),c=n.indexOf(t.charAt(u++)),r=s<<2|a>>4,o=(a&15)<<4|l>>2,i=(l&3)<<6|c,e=e+String.fromCharCode(r),l!=64&&o!=0&&(e=e+String.fromCharCode(o)),c!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}var fg=class t{constructor(){this.promise=new t.promiseConstructor((n,e)=>{this.resolve=n,this.reject=e})}};fg.promiseConstructor=Promise;function MI(t){let n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=t.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(rte(r))}async function hP(t){return await new Promise(n=>{setTimeout(()=>n(null),t)})}function gP(t,n){return new Promise((r,o)=>{(async()=>{for(let i=0;i<1/0;i++)try{let s=await t(i);if(!n(i,null,s)){r(s);return}}catch(s){if(!n(i,s)){o(s);return}}})()})}function ote(t){return("0"+t.toString(16)).substr(-2)}function ite(){let n=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,o="";for(let i=0;i<56;i++)o+=e.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(n),Array.from(n,ote).join("")}async function ste(t){let e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",e),o=new Uint8Array(r);return Array.from(o).map(i=>String.fromCharCode(i)).join("")}function ate(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function lte(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let e=await ste(t);return ate(e)}async function Lu(t,n,e=!1){let r=ite(),o=r;e&&(o+="/PASSWORD_RECOVERY"),await OI(t,`${n}-code-verifier`,o);let i=await lte(r);return[i,r===i?"plain":"s256"]}var cte=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function yP(t){let n=t.headers.get(pg);if(!n||!n.match(cte))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}var gg=class extends Error{constructor(n,e,r){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}};function Je(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var Iv=class extends gg{constructor(n,e,r){super(n,e,r),this.name="AuthApiError",this.status=e,this.code=r}};function xP(t){return Je(t)&&t.name==="AuthApiError"}var Yp=class extends gg{constructor(n,e){super(n),this.name="AuthUnknownError",this.originalError=e}},Ks=class extends gg{constructor(n,e,r,o){super(n,r,o),this.name=e,this.status=r}},Vo=class extends Ks{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function vP(t){return Je(t)&&t.name==="AuthSessionMissingError"}var Qp=class extends Ks{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Vu=class extends Ks{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}},Bu=class extends Ks{constructor(n,e=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function bP(t){return Je(t)&&t.name==="AuthImplicitGrantRedirectError"}var yg=class extends Ks{constructor(n,e=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Zp=class extends Ks{constructor(n,e){super(n,"AuthRetryableFetchError",e,void 0)}};function Tv(t){return Je(t)&&t.name==="AuthRetryableFetchError"}var xg=class extends Ks{constructor(n,e,r){super(n,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}};var ute=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},zu=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),dte=[502,503,504];async function wP(t){var n;if(!mP(t))throw new Zp(zu(t),0);if(dte.includes(t.status))throw new Zp(zu(t),t.status);let e;try{e=await t.json()}catch(i){throw new Yp(zu(i),i)}let r,o=yP(t);if(o&&o.getTime()>=RI["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new xg(zu(e),t.status,((n=e.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(r==="session_not_found")throw new Vo}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,s)=>i&&typeof s=="string",!0))throw new xg(zu(e),t.status,e.weak_password.reasons);throw new Iv(zu(e),t.status||500,r)}var pte=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),e))};async function pt(t,n,e,r){var o;let i=Object.assign({},r?.headers);i[pg]||(i[pg]=RI["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let s=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(s.redirect_to=r.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await fte(t,n,e+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function fte(t,n,e,r,o,i){let s=pte(n,r,o,i),a;try{a=await t(e,Object.assign({},s))}catch(l){throw console.error(l),new Zp(zu(l),0)}if(a.ok||await wP(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await wP(l)}}function Xs(t){var n;let e=null;mte(t)&&(e=Object.assign({},t),t.expires_at||(e.expires_at=dP(t.expires_in)));let r=(n=t.user)!==null&&n!==void 0?n:t;return{data:{session:e,user:r},error:null}}function FI(t){let n=Xs(t);return!n.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(n.data.weak_password=t.weak_password),n}function rs(t){var n;return{data:{user:(n=t.user)!==null&&n!==void 0?n:t},error:null}}function CP(t){return{data:t,error:null}}function _P(t){let{action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i}=t,s=ute(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i},l=Object.assign({},s);return{data:{properties:a,user:l},error:null}}function SP(t){return t}function mte(t){return t.access_token&&t.refresh_token&&t.expires_in}var hte=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},Jp=class{constructor({url:n="",headers:e={},fetch:r}){this.url=n,this.headers=e,this.fetch=Ev(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,e="global"){try{return await pt(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}}async inviteUserByEmail(n,e={}){try{return await pt(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:rs})}catch(r){if(Je(r))return{data:{user:null},error:r};throw r}}async generateLink(n){try{let{options:e}=n,r=hte(n,["options"]),o=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await pt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:_P,redirectTo:e?.redirectTo})}catch(e){if(Je(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(n){try{return await pt(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:rs})}catch(e){if(Je(e))return{data:{user:null},error:e};throw e}}async listUsers(n){var e,r,o,i,s,a,l;try{let c={nextPage:null,lastPage:0,total:0},u=await pt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=n?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=n?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:SP});if(u.error)throw u.error;let d=await u.json(),p=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{let h=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=h}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Je(c))return{data:{users:[]},error:c};throw c}}async getUserById(n){try{return await pt(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:rs})}catch(e){if(Je(e))return{data:{user:null},error:e};throw e}}async updateUserById(n,e){try{return await pt(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:e,headers:this.headers,xform:rs})}catch(r){if(Je(r))return{data:{user:null},error:r};throw r}}async deleteUser(n,e=!1){try{return await pt(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:e},xform:rs})}catch(r){if(Je(r))return{data:{user:null},error:r};throw r}}async _listFactors(n){try{let{data:e,error:r}=await pt(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:e,error:r}}catch(e){if(Je(e))return{data:null,error:e};throw e}}async _deleteFactor(n){try{return{data:await pt(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(e){if(Je(e))return{data:null,error:e};throw e}}};var EP={getItem:t=>Fl()?globalThis.localStorage.getItem(t):null,setItem:(t,n)=>{Fl()&&globalThis.localStorage.setItem(t,n)},removeItem:t=>{Fl()&&globalThis.localStorage.removeItem(t)}};function PI(t={}){return{getItem:n=>t[n]||null,setItem:(n,e)=>{t[n]=e},removeItem:n=>{delete t[n]}}}function IP(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var Uu={debug:!!(globalThis&&Fl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},vg=class extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}},Dv=class extends vg{};async function $I(t,n,e){Uu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,n);let r=new globalThis.AbortController;return n>0&&setTimeout(()=>{r.abort(),Uu.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Uu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await e()}finally{Uu.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(n===0)throw Uu.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Dv(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Uu.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}IP();var gte={url:lP,storageKey:cP,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:uP,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},bg=30*1e3,TP=3;async function DP(t,n,e){return await e()}var LI=(()=>{class t{constructor(e){var r,o;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&Ti()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},gte),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Jp({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Ev(i.fetch),this.lock=i.lock||DP,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Ti()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=$I:this.lock=DP,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:Fl()?this.storage=EP:(this.memoryStorage={},this.storage=PI(this.memoryStorage)):(this.memoryStorage={},this.storage=PI(this.memoryStorage)),Ti()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Sv}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r=fP(window.location.href),o="none";if(this._isImplicitGrantCallback(r)?o="implicit":await this._isPKCECallback(r)&&(o="pkce"),Ti()&&this.detectSessionInUrl&&o!=="none"){let{data:i,error:s}=await this._getSessionFromURL(r,o);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),bP(s)){let c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Je(r)?{error:r}:{error:new Yp("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,o,i;try{let s=await pt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Xs}),{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(Je(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,o,i;try{let s;if("email"in e){let{email:d,password:p,options:f}=e,m=null,h=null;this.flowType==="pkce"&&([m,h]=await Lu(this.storage,this.storageKey)),s=await pt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:h},xform:Xs})}else if("phone"in e){let{phone:d,password:p,options:f}=e;s=await pt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(o=f?.data)!==null&&o!==void 0?o:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Xs})}else throw new Vu("You must provide either an email or phone number and a password");let{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(Je(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){let{email:s,password:a,options:l}=e;r=await pt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:FI})}else if("phone"in e){let{phone:s,password:a,options:l}=e;r=await pt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:FI})}else throw new Vu("You must provide either an email or phone number and a password");let{data:o,error:i}=r;return i?{data:{user:null,session:null},error:i}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new Qp}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:i})}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,o,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let r=await mg(this.storage,`${this.storageKey}-code-verifier`),[o,i]=(r??"").split("/");try{let{data:s,error:a}=await pt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:o},xform:Xs});if(await hg(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Qp}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:a})}catch(s){if(Je(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:r,provider:o,token:i,access_token:s,nonce:a}=e,l=await pt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:Xs}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Qp}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,o,i,s,a;try{if("email"in e){let{email:l,options:c}=e,u=null,d=null;this.flowType==="pkce"&&([u,d]=await Lu(this.storage,this.storageKey));let{error:p}=await pt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:l,options:c}=e,{data:u,error:d}=await pt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Vu("You must provide either an email or phone number.")}catch(l){if(Je(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,o;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(o=e.options)===null||o===void 0?void 0:o.captchaToken);let{data:a,error:l}=await pt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Xs});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");let c=a.session,u=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(Je(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var r,o,i;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await Lu(this.storage,this.storageKey)),await pt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&o!==void 0?o:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:CP})}catch(s){if(Je(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:r},error:o}=e;if(o)throw o;if(!r)throw new Vo;let{error:i}=await pt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Je(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let r=`${this.url}/resend`;if("email"in e){let{email:o,type:i,options:s}=e,{error:a}=await pt(this.fetch,"POST",r,{headers:this.headers,body:{email:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:o,type:i,options:s}=e,{data:a,error:l}=await pt(this.fetch,"POST",r,{headers:this.headers,body:{phone:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:l}}throw new Vu("You must provide either an email or phone number and a type")}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await o,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let o=r();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=await mg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let o=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",e.expires_at),!o){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await pt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:rs}):await this._useSession(async r=>{var o,i,s;let{data:a,error:l}=r;if(l)throw l;return!(!((o=a.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vo}:await pt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:rs})})}catch(r){if(Je(r))return vP(r)&&(await this._removeSession(),await hg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async o=>{let{data:i,error:s}=o;if(s)throw s;if(!i.session)throw new Vo;let a=i.session,l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await Lu(this.storage,this.storageKey));let{data:u,error:d}=await pt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:rs});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(o){if(Je(o))return{data:{user:null},error:o};throw o}}_decodeJWT(e){return MI(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vo;let r=Date.now()/1e3,o=r,i=!0,s=null,a=MI(e.access_token);if(a.exp&&(o=a.exp,i=o<=r),i){let{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};s=l}else{let{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:o-r,expires_at:o},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(Je(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var o;if(!e){let{data:a,error:l}=r;if(l)throw l;e=(o=a.session)!==null&&o!==void 0?o:void 0}if(!e?.refresh_token)throw new Vo;let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Ti())throw new Bu("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Bu(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new yg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Bu("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new yg("No code detected.");let{data:S,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;let E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:S.session,redirectType:null},error:null}}let{provider_token:o,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!a||!u)throw new Bu("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(l),f=d+p;c&&(f=parseInt(c));let m=f-d;m*1e3<=bg&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${p}s`);let h=f-p;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,f,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,f,d);let{data:g,error:x}=await this._getUser(s);if(x)throw x;let b={provider_token:o,provider_refresh_token:i,access_token:s,expires_in:p,expires_at:f,refresh_token:a,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(o){if(Je(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let r=await mg(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{error:s};let a=(o=i.session)===null||o===void 0?void 0:o.access_token;if(a){let{error:l}=await this.admin.signOut(a,e);if(l&&!(xP(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await hg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let r=pP(),o={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,o),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:o}}}async _emitInitialSession(e){return await this._useSession(async r=>{var o,i;try{let{data:{session:s},error:a}=r;if(a)throw a;await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let o=null,i=null;this.flowType==="pkce"&&([o,i]=await Lu(this.storage,this.storageKey,!0));try{return await pt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(Je(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:r,error:o}=await this.getUser();if(o)throw o;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{let{data:o,error:i}=await this._useSession(async s=>{var a,l,c,u,d;let{data:p,error:f}=s;if(f)throw f;let m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await pt(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=p.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return Ti()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:e.provider,url:o?.url},error:null}}catch(o){if(Je(o))return{data:{provider:e.provider,url:null},error:o};throw o}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)throw a;return await pt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(o=s.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(Je(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let o=Date.now();return await gP(async i=>(i>0&&await hP(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await pt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Xs})),(i,s)=>{let a=200*Math.pow(2,i);return s&&Tv(s)&&Date.now()+a-o<bg})}catch(o){if(this._debug(r,"error",o),Je(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){let o=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",o),Ti()&&!r.skipBrowserRedirect&&window.location.assign(o),{data:{provider:e,url:o},error:null}}async _recoverAndRefresh(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=await mg(this.storage,this.storageKey);if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}let i=Math.round(Date.now()/1e3),s=((e=o.expires_at)!==null&&e!==void 0?e:1/0)<i+AI;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${AI}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=await this._callRefreshToken(o.refresh_token);a&&(console.error(a),Tv(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,o;if(!e)throw new Vo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new fg;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Vo;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),Je(s)){let a={session:null,error:s};return Tv(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,o=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:e,session:r});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){s.push(c)}});if(await Promise.all(a),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await OI(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await hg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Ti()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),bg);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async r=>{let{data:{session:o}}=r;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((o.expires_at*1e3-e)/bg);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${bg}ms, refresh threshold is ${TP} ticks`),i<=TP&&await this._callRefreshToken(o.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof vg)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Ti()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,o){let i=[`provider=${encodeURIComponent(r)}`];if(o?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&i.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){let[s,a]=await Lu(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(l.toString())}if(o?.queryParams){let s=new URLSearchParams(o.queryParams);i.push(s.toString())}return o?.skipBrowserRedirect&&i.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await pt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Je(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)return{data:null,error:a};let l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await pt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(Je(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{data:null,error:s};let{data:a,error:l}=await pt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(r){if(Je(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await pt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Je(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){let{data:r,error:o}=await this._challenge({factorId:e.factorId});return o?{data:null,error:o}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){let{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};let o=e?.factors||[],i=o.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=o.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:o,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,o;let{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),l=null;a.aal&&(l=a.aal);let c=l;((o=(r=i.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(c="aal2");let d=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}}return t.nextInstanceID=0,t})();var yte=LI,VI=yte;var Nv=class extends VI{constructor(n){super(n)}};var xte=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},kv=class{constructor(n,e,r){var o,i,s;if(this.supabaseUrl=n,this.supabaseKey=e,!n)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let a=sP(n);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:nP,realtime:oP,auth:Object.assign(Object.assign({},rP),{storageKey:l}),global:tP},u=aP(r??{},c);this.storageKey=(o=u.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=u.auth)!==null&&s!==void 0?s:{},this.headers,u.global.fetch),this.fetch=iP(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new UF(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Jh(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new ug(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},r={}){return this.rest.rpc(n,e,r)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,e;return xte(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,storageKey:i,flowType:s,lock:a,debug:l},c,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Nv({url:this.authUrl,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,flowType:s,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new lg(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(n,e,r){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var NP=(t,n,e)=>new kv(t,n,e);var Av={API_URL:"https://jsgltiaidlacvchyjjha.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzZ2x0aWFpZGxhY3ZjaHlqamhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2NjIzNDIsImV4cCI6MjA1NTIzODM0Mn0.bPtRMhXapLzUgPEIf6GoW9r52umh0F1YZhG1bfLyb0s",supabase_LocalStorage_key:"sb-jsgltiaidlacvchyjjha-auth-token"};var Vt=class t{constructor(n){this.platformId=n;this.supabase=NP(Av.API_URL,Av.anon_key,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),this.initializeAuthState()}supabase;user=uo(null);currentUsername=uo(null);loginStatus=uo(null);ngOnInit(){this.initializeAuthState()}initializeAuthState(){if(!vn(this.platformId))return;let n=this.getStoredSession();n&&this.updateSession(n),this.refreshSessionFromApi(),this.supabase.auth.onAuthStateChange((e,r)=>{this.updateSession(r)})}getStoredSession(){try{let n=localStorage.getItem(Av.supabase_LocalStorage_key);if(!n)return null;let e=JSON.parse(n);if(!e||!e.expires_at)return null;let r=e.expires_at*1e3;return Date.now()>=r?null:e}catch(n){return console.error("Error parsing stored session",n),null}}async refreshSessionFromApi(){try{let{data:n,error:e}=await this.supabase.auth.getSession();if(e)throw e;this.updateSession(n.session)}catch(n){console.error("Failed to refresh session:",n),this.updateSession(null)}}updateSession(n){if(n){this.user.set(n.user);let e=n.user?.identities?.[0]?.identity_data?.firstname||null;this.currentUsername.set(e),this.loginStatus.set(!0)}else this.user.set(null),this.currentUsername.set(null),this.loginStatus.set(!1)}initializeApp(){return new Promise(n=>{if(!vn(this.platformId))return this.loginStatus.set(!1),n(!1);let e=this.getStoredSession();e&&this.updateSession(e),this.supabase.auth.getSession().then(({data:r,error:o})=>{o?(console.error("Failed to get session:",o),this.updateSession(null)):this.updateSession(r.session),this.supabase.auth.onAuthStateChange((i,s)=>{this.updateSession(s)}),n(!0)})})}async signIn(n,e){try{let{error:r}=await this.supabase.auth.signInWithPassword({email:n,password:e});if(r)throw r;return{success:!0}}catch(r){return console.error("Sign in error:",r),{success:!1,error:r}}}async signOut(){try{let{error:n}=await this.supabase.auth.signOut();if(n)throw n;return this.clearStorages(),this.updateSession(null),{success:!0}}catch(n){return console.error("Sign out error:",n),{success:!1,error:n}}}async signUp(n,e,r,o){let{error:i}=await this.supabase.auth.signUp({email:n,password:e,options:{data:{firstname:r,lastname:o}}});if(i)throw i}clearStorages(){vn(this.platformId)&&(localStorage.clear(),sessionStorage.clear())}async addTradeLog(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");n.userid=r.id;let{data:o,error:i}=await this.supabase.from(e).insert([n]);if(i)throw console.error("Error inserting trade log: ",i),i;return vn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async getTradeLogs(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=!1,o=null;if(vn(this.platformId)){r=sessionStorage.getItem(`${n}_refresh`)==="yes";let a=sessionStorage.getItem(n);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade logs:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(n).select("*").eq("userid",e.id);if(s)throw console.error("Error fetching trade logs:",s),s;return vn(this.platformId)&&(sessionStorage.setItem(n,JSON.stringify(i)),sessionStorage.removeItem(`${n}_refresh`)),i}async getTradeLogsOfSelectedAccount(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");let o=`${n}_${e}`,i=`${o}_refresh`,s=!1,a=null;if(vn(this.platformId)){s=sessionStorage.getItem(i)==="yes";let u=sessionStorage.getItem(o);if(u)try{a=JSON.parse(u)}catch(d){console.error("Error parsing cached trade logs:",d),a=null}}if(!s&&a)return a;let{data:l,error:c}=await this.supabase.from(n).select("*").eq("userid",r.id).eq("trade_account_id",e);if(c)throw console.error("Error fetching trade logs:",c),c;return vn(this.platformId)&&(sessionStorage.setItem(o,JSON.stringify(l)),sessionStorage.removeItem(i)),l}async addTradeLogOfSelectedAccount(n,e,r){let o=this.user();if(!o)throw new Error("User not authenticated");n.userid=o.id;let{data:i,error:s}=await this.supabase.from(e).insert([n]);if(s)throw console.error("Error inserting trade log: ",s),s;return vn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async updateTradeLogOfSelectedAccount(n,e,r){if(!this.user())throw new Error("User not authenticated");let{data:i,error:s}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(s)throw console.error("Error updating trade log: ",s),s;return vn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async deleteTradeLogOfSelectedAccount(n,e,r){if(!this.user())throw new Error("User not authenticated");let{data:i,error:s}=await this.supabase.from(e).delete().eq("tradeid",n);if(s)throw console.error("Error deleting trade log: ",s),s;return vn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async updateTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(i)throw console.error("Error updating trade log: ",i),i;return vn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async deleteTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).delete().eq("tradeid",n);if(i)throw console.error("Error deleting trade log: ",i),i;return vn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async loadQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminLoadQuestions(){let{data:n,error:e}=await this.supabase.from("adminquestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminSaveQuestions(n){let e=null;for(let r of n.filter(o=>o.isModified))if(r.question_id){let{data:o,error:i}=await this.supabase.from("adminquestions").update({question_data:r.question_data,active:r.active}).eq("question_id",r.question_id).select().single();if(i){console.error("Error updating question:",i),e=i;break}else r.updated_at=o.updated_at,r.isModified=!1}else{let{data:o,error:i}=await this.supabase.from("adminquestions").insert([{question_data:r.question_data,active:r.active}]).select().single();if(i){console.error("Error inserting question:",i),e=i;break}else r.question_id=o.question_id,r.created_at=o.created_at,r.updated_at=o.updated_at,r.isModified=!1}return{error:e}}async deleteQuestion(n){let{error:e}=await this.supabase.from("adminquestions").delete().eq("question_id",n.question_id);return{error:e}}async getActiveQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");return{data:n,error:e}}async submitUserAnswers(n){let{error:e}=await this.supabase.from("answers").insert(n);return{error:e}}async getUserTradeAccounts(){let n=this.user();if(!n)throw new Error("User not authenticated");let e="tradeaccount",r=!1,o=null;if(vn(this.platformId)){r=sessionStorage.getItem(`${e}_refresh`)==="yes";let a=sessionStorage.getItem(e);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade accounts:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(e).select("*").eq("user_id",n.id);if(s)throw console.error("Error fetching trade accounts:",s),s;return vn(this.platformId)&&(sessionStorage.setItem(e,JSON.stringify(i)),sessionStorage.removeItem(`${e}_refresh`)),i||[]}async addTradeAccount(n){let e=this.user();if(!e)throw new Error("User not authenticated");let c=n,{track_pl:r,include_in_analytics:o,trading_instruments:i}=c,s=Gy(c,["track_pl","include_in_analytics","trading_instruments"]),a={track_pl:r,include_in_analytics:o,trading_instruments:i},{error:l}=await this.supabase.from("tradeaccount").insert([qe(me({},s),{user_id:e.id,metadata:a})]);return l?(console.error("Failed to add trade account:",l),!1):(sessionStorage.setItem("tradeaccount_refresh","yes"),!0)}async editTradeAccount(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");let u=e,{track_pl:o,include_in_analytics:i,trading_instruments:s}=u,a=Gy(u,["track_pl","include_in_analytics","trading_instruments"]),l={track_pl:o,include_in_analytics:i,trading_instruments:s},{error:c}=await this.supabase.from("tradeaccount").update(qe(me({},a),{metadata:l})).eq("account_id",n).eq("user_id",r.id);return c?(console.error("Failed to update trade account:",c),!1):(sessionStorage.setItem("tradeaccount_refresh","yes"),!0)}async RemoveTradeAccount(n){let e=this.user();if(!e)throw new Error("User not authenticated");let{error:r}=await this.supabase.from("tradejournal").delete().eq("trade_account_id",n).eq("userid",e.id);if(r)return console.error("Failed to delete associated trade logs:",r),!1;let{error:o}=await this.supabase.from("tradeaccount").delete().eq("account_id",n).eq("user_id",e.id);return o?(console.error("Failed to remove trade account:",o),!1):(vn(this.platformId)&&(sessionStorage.setItem("tradeaccount_refresh","yes"),sessionStorage.setItem(`tradejournal_${n}_refresh`,"yes")),!0)}supaScream(){return"SupaScream"}static \u0275fac=function(e){return new(e||t)($e(Oo))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})};function vte(t,n){if(t&1&&(v(0,"div",11)(1,"div",12)(2,"div",8)(3,"h5",13),C(4),y(),v(5,"p",14),C(6),y(),v(7,"a",15),C(8),y()()()()),t&2){let e=n.$implicit;P(4),ht(e.title),P(2),ht(e.description),P(),j("routerLink",e.link),P(),ht(e.buttonText)}}var Rv=class t{constructor(n){this.supabaseService=n;this.userFirstName=this.supabaseService.currentUsername()}userFirstName;steps=[{title:"Step 1: Daily Emotional Check-in",description:"Understand your emotional state before making trading decisions.",buttonText:"Begin Emotional Check-in",link:"/emotions"},{title:"Step 2: Plan Your Trades",description:"Document your trading plan before executing any trades.",buttonText:"Plan your trade",link:"/tradejournal"},{title:"Step 3: Update your Trades",description:"Record results and analyze your trading performance.",buttonText:"Execute your trades",link:"/tradejournal"},{title:"Step 4: Reflection & Meditation",description:"Clear your mind with mindfulness practices.",buttonText:"Start Reflection",link:"/reflection"}];static \u0275fac=function(e){return new(e||t)(oe(Vt))};static \u0275cmp=Tt({type:t,selectors:[["app-landing-page"]],decls:22,vars:1,consts:[[1,"container","mt-4"],[1,"mb-4"],[1,""],[1,"mt-3"],["class","col-12 mt-3",4,"ngFor","ngForOf"],[1,"row","mb-5"],[1,"col-12"],[1,"card","h-100","bg-transparent"],[1,"card-body"],[1,"card-title"],["routerLink","/meditationhub",1,"btn","btn-secondary","btn-tr"],[1,"col-12","mt-3"],[1,"card","h-100","bg-transparent","mt-3"],[1,"card-title","mt-3"],[1,"card-text","mt-3"],[1,"btn","btn-primary","btn-tr","mt-3",3,"routerLink"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"h2",1),C(2,"Begin Your Trading Transformation"),y(),v(3,"h3",1),C(4,"Your Daily Trading Routine"),y(),v(5,"p",2),C(6," Welcome to your personalized trading journey. Each day follows a structured approach designed to build discipline and improve your trading performance. "),y(),v(7,"div",3),ie(8,vte,9,4,"div",4),y(),U(9,"hr"),v(10,"h2",1),C(11,"Additional Resources"),y(),v(12,"div",5)(13,"div",6)(14,"div",7)(15,"div",8)(16,"h5",9),C(17,"Meditation Hub"),y(),v(18,"p"),C(19,"Clear your mind and reduce emotional reactivity with guided meditations."),y(),v(20,"a",10),C(21,"Visit Meditation Hub"),y()()()()()()),e&2&&(P(8),j("ngForOf",r.steps))},dependencies:[hr,Qt,mr],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:8px}.card-body[_ngcontent-%COMP%]{padding-left:0}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.75rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-custom[_ngcontent-%COMP%]{border-radius:20px;font-weight:600}@media (max-width: 576px){.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.btn-custom[_ngcontent-%COMP%]{padding:.5rem 1rem}}"]})};var gr=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return new Promise(o=>{ir(this.injector,()=>{_h(()=>{this.supabaseService.loginStatus()&&o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()||o(this.router.createUrlTree([""],{queryParams:{returnUrl:e.url}}))},100)})}static \u0275fac=function(e){return new(e||t)($e(Vt),$e(go),$e(Hn))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})};var Ov=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return r?!1:r?new Promise(o=>{ir(this.injector,()=>{_h(()=>{this.supabaseService.loginStatus()||o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()&&o(this.router.createUrlTree(["/home"]))},100)}):!0}static \u0275fac=function(e){return new(e||t)($e(Vt),$e(go),$e(Hn))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})};var VP=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||t)(oe(wi),oe(Ro))};static \u0275dir=Rt({type:t})}return t})(),of=(()=>{class t extends VP{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,features:[Dn]})}return t})(),Vl=new Me(""),bte={provide:Vl,useExisting:or(()=>ju),multi:!0},ju=(()=>{class t extends of{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){r&1&&le("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Ar([bte]),Dn]})}return t})(),wte={provide:Vl,useExisting:or(()=>Kn),multi:!0};function Cte(){let t=js()?js().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var _te=new Me(""),Kn=(()=>{class t extends VP{_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!Cte())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||t)(oe(wi),oe(Ro),oe(_te,8))};static \u0275dir=Rt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&le("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[Ar([wte]),Dn]})}return t})();function Pl(t){return t==null||(typeof t=="string"||Array.isArray(t))&&t.length===0}function BP(t){return t!=null&&typeof t.length=="number"}var Bl=new Me(""),sf=new Me(""),Ste=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,_e=class{static min(n){return zP(n)}static max(n){return UP(n)}static required(n){return Ete(n)}static requiredTrue(n){return Ite(n)}static email(n){return Tte(n)}static minLength(n){return Dte(n)}static maxLength(n){return Nte(n)}static pattern(n){return kte(n)}static nullValidator(n){return Fv(n)}static compose(n){return KP(n)}static composeAsync(n){return XP(n)}};function zP(t){return n=>{if(Pl(n.value)||Pl(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function UP(t){return n=>{if(Pl(n.value)||Pl(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}function Ete(t){return Pl(t.value)?{required:!0}:null}function Ite(t){return t.value===!0?null:{required:!0}}function Tte(t){return Pl(t.value)||Ste.test(t.value)?null:{email:!0}}function Dte(t){return n=>Pl(n.value)||!BP(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}function Nte(t){return n=>BP(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}function kte(t){if(!t)return Fv;let n,e;return typeof t=="string"?(e="",t.charAt(0)!=="^"&&(e+="^"),e+=t,t.charAt(t.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),r=>{if(Pl(r.value))return null;let o=r.value;return n.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}function Fv(t){return null}function jP(t){return t!=null}function GP(t){return Iu(t)?mn(t):t}function WP(t){let n={};return t.forEach(e=>{n=e!=null?me(me({},n),e):n}),Object.keys(n).length===0?null:n}function HP(t,n){return n.map(e=>e(t))}function Ate(t){return!t.validate}function qP(t){return t.map(n=>Ate(n)?n:e=>n.validate(e))}function KP(t){if(!t)return null;let n=t.filter(jP);return n.length==0?null:function(e){return WP(HP(e,n))}}function WI(t){return t!=null?KP(qP(t)):null}function XP(t){if(!t)return null;let n=t.filter(jP);return n.length==0?null:function(e){let r=HP(e,n).map(GP);return fS(r).pipe(nt(WP))}}function HI(t){return t!=null?XP(qP(t)):null}function kP(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function YP(t){return t._rawValidators}function QP(t){return t._rawAsyncValidators}function BI(t){return t?Array.isArray(t)?t:[t]:[]}function Pv(t,n){return Array.isArray(t)?t.includes(n):t===n}function AP(t,n){let e=BI(n);return BI(t).forEach(o=>{Pv(e,o)||e.push(o)}),e}function RP(t,n){return BI(n).filter(e=>!Pv(t,e))}var $v=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=WI(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=HI(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},Mr=class extends $v{name;get formDirective(){return null}get path(){return null}},$l=class extends $v{_parent=null;name=null;valueAccessor=null},Lv=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Rte={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},zNe=qe(me({},Rte),{"[class.ng-submitted]":"isSubmitted"}),yr=(()=>{class t extends Lv{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(oe($l,2))};static \u0275dir=Rt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&Qi("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[Dn]})}return t})(),Bo=(()=>{class t extends Lv{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(oe(Mr,10))};static \u0275dir=Rt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){r&2&&Qi("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[Dn]})}return t})();var wg="VALID",Mv="INVALID",ef="PENDING",Cg="DISABLED",Ll=class{},Vv=class extends Ll{value;source;constructor(n,e){super(),this.value=n,this.source=e}},Sg=class extends Ll{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},Eg=class extends Ll{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},tf=class extends Ll{status;source;constructor(n,e){super(),this.status=n,this.source=e}},zI=class extends Ll{source;constructor(n){super(),this.source=n}},UI=class extends Ll{source;constructor(n){super(),this.source=n}};function qI(t){return(jv(t)?t.validators:t)||null}function Ote(t){return Array.isArray(t)?WI(t):t||null}function KI(t,n){return(jv(n)?n.asyncValidators:t)||null}function Mte(t){return Array.isArray(t)?HI(t):t||null}function jv(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function ZP(t,n,e){let r=t.controls;if(!(n?Object.keys(r):r).length)throw new De(1e3,"");if(!r[e])throw new De(1001,"")}function JP(t,n,e){t._forEachChild((r,o)=>{if(e[o]===void 0)throw new De(1002,"")})}var nf=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return Ji(this.statusReactive)}set status(n){Ji(()=>this.statusReactive.set(n))}_status=Dl(()=>this.statusReactive());statusReactive=uo(void 0);get valid(){return this.status===wg}get invalid(){return this.status===Mv}get pending(){return this.status==ef}get disabled(){return this.status===Cg}get enabled(){return this.status!==Cg}errors;get pristine(){return Ji(this.pristineReactive)}set pristine(n){Ji(()=>this.pristineReactive.set(n))}_pristine=Dl(()=>this.pristineReactive());pristineReactive=uo(!0);get dirty(){return!this.pristine}get touched(){return Ji(this.touchedReactive)}set touched(n){Ji(()=>this.touchedReactive.set(n))}_touched=Dl(()=>this.touchedReactive());touchedReactive=uo(!1);get untouched(){return!this.touched}_events=new $n;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(AP(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(AP(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(RP(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(RP(n,this._rawAsyncValidators))}hasValidator(n){return Pv(this._rawValidators,n)}hasAsyncValidator(n){return Pv(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(qe(me({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Eg(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),e&&n.emitEvent!==!1&&this._events.next(new Eg(!1,r))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(qe(me({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Sg(!1,r))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),e&&n.emitEvent!==!1&&this._events.next(new Sg(!0,r))}markAsPending(n={}){this.status=ef;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new tf(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(qe(me({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=Cg,this.errors=null,this._forEachChild(o=>{o.disable(qe(me({},n),{onlySelf:!0}))}),this._updateValue();let r=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Vv(this.value,r)),this._events.next(new tf(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(qe(me({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=wg,this._forEachChild(r=>{r.enable(qe(me({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(qe(me({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===wg||this.status===ef)&&this._runAsyncValidator(r,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Vv(this.value,e)),this._events.next(new tf(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(qe(me({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Cg:wg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=ef,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=GP(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new tf(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,r)}_initObservables(){this.valueChanges=new jt,this.statusChanges=new jt}_calculateStatus(){return this._allControlsDisabled()?Cg:this.errors?Mv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ef)?ef:this._anyControlsHaveStatus(Mv)?Mv:wg}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),o&&this._events.next(new Sg(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new Eg(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){jv(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=Ote(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=Mte(this._rawAsyncValidators)}},rf=class extends nf{constructor(n,e,r){super(qI(e),KI(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){JP(this,!0,n),Object.keys(n).forEach(r=>{ZP(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(r=>{let o=this.controls[r];o&&o.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,o)=>{r.reset(n?n[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>r._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var jI=class extends rf{};var af=new Me("",{providedIn:"root",factory:()=>Tg}),Tg="always";function Gv(t,n){return[...n.path,t]}function Bv(t,n,e=Tg){XI(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),Pte(t,n),Lte(t,n),$te(t,n),Fte(t,n)}function OP(t,n,e=!0){let r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),Uv(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function zv(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function Fte(t,n){if(n.valueAccessor.setDisabledState){let e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}function XI(t,n){let e=YP(t);n.validator!==null?t.setValidators(kP(e,n.validator)):typeof e=="function"&&t.setValidators([e]);let r=QP(t);n.asyncValidator!==null?t.setAsyncValidators(kP(r,n.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let o=()=>t.updateValueAndValidity();zv(n._rawValidators,o),zv(n._rawAsyncValidators,o)}function Uv(t,n){let e=!1;if(t!==null){if(n.validator!==null){let o=YP(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.validator);i.length!==o.length&&(e=!0,t.setValidators(i))}}if(n.asyncValidator!==null){let o=QP(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.asyncValidator);i.length!==o.length&&(e=!0,t.setAsyncValidators(i))}}}let r=()=>{};return zv(n._rawValidators,r),zv(n._rawAsyncValidators,r),e}function Pte(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&e$(t,n)})}function $te(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&e$(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function e$(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Lte(t,n){let e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}function t$(t,n){t==null,XI(t,n)}function Vte(t,n){return Uv(t,n)}function n$(t,n){if(!t.hasOwnProperty("model"))return!1;let e=t.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function Bte(t){return Object.getPrototypeOf(t.constructor)===of}function r$(t,n){t._syncPendingControls(),n.forEach(e=>{let r=e.control;r.updateOn==="submit"&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function o$(t,n){if(!n)return null;Array.isArray(n);let e,r,o;return n.forEach(i=>{i.constructor===Kn?e=i:Bte(i)?r=i:o=i}),o||r||e||null}function zte(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}var Ute={provide:Mr,useExisting:or(()=>YI)},_g=Promise.resolve(),YI=(()=>{class t extends Mr{callSetDisabledState;get submitted(){return Ji(this.submittedReactive)}_submitted=Dl(()=>this.submittedReactive());submittedReactive=uo(!1);_directives=new Set;form;ngSubmit=new jt;options;constructor(e,r,o){super(),this.callSetDisabledState=o,this.form=new rf({},WI(e),HI(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){_g.then(()=>{let r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),Bv(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){_g.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){_g.then(()=>{let r=this._findContainer(e.path),o=new rf({});t$(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){_g.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){_g.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),r$(this.form,this._directives),this.ngSubmit.emit(e),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(r){return new(r||t)(oe(Bl,10),oe(sf,10),oe(af,8))};static \u0275dir=Rt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&le("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ar([Ute]),Dn]})}return t})();function MP(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function FP(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var Ig=class extends nf{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,r){super(qI(e),KI(r,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),jv(e)&&(e.nonNullable||e.initialValueIsDefault)&&(FP(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){MP(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){MP(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){FP(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var jte=t=>t instanceof Ig,Gte=(()=>{class t extends Mr{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return Gv(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,standalone:!1,features:[Dn]})}return t})();var Wte={provide:$l,useExisting:or(()=>Gu)},PP=Promise.resolve(),Gu=(()=>{class t extends $l{_changeDetectorRef;callSetDisabledState;control=new Ig;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new jt;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=o$(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),n$(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Bv(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){PP.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&Du(r);PP.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?Gv(e,this._parent):[e]}static \u0275fac=function(r){return new(r||t)(oe(Mr,9),oe(Bl,10),oe(sf,10),oe(Vl,10),oe($t,8),oe(af,8))};static \u0275dir=Rt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Ar([Wte]),Dn,vi]})}return t})(),zo=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275dir=Rt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})(),Hte={provide:Vl,useExisting:or(()=>Ys),multi:!0},Ys=(()=>{class t extends of{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&le("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Ar([Hte]),Dn]})}return t})(),qte={provide:Vl,useExisting:or(()=>Qs),multi:!0};var Kte=(()=>{class t{_accessors=[];add(e,r){this._accessors.push([e,r])}remove(e){for(let r=this._accessors.length-1;r>=0;--r)if(this._accessors[r][1]===e){this._accessors.splice(r,1);return}}select(e){this._accessors.forEach(r=>{this._isSameGroup(r,e)&&r[1]!==e&&r[1].fireUncheck(e.value)})}_isSameGroup(e,r){return e[0].control?e[0]._parent===r._control._parent&&e[1].name===r.name:!1}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Qs=(()=>{class t extends of{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=pe(af,{optional:!0})??Tg;constructor(e,r,o,i){super(e,r),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get($l),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(r){return new(r||t)(oe(wi),oe(Ro),oe(Kte),oe(Hn))};static \u0275dir=Rt({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(r,o){r&1&&le("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Ar([qte]),Dn]})}return t})();var i$=new Me("");var Xte={provide:Mr,useExisting:or(()=>Uo)},Uo=(()=>{class t extends Mr{callSetDisabledState;get submitted(){return Ji(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=Dl(()=>this._submittedReactive());_submittedReactive=uo(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new jt;constructor(e,r,o){super(),this.callSetDisabledState=o,this._setValidators(e),this._setAsyncValidators(r)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(Uv(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let r=this.form.get(e.path);return Bv(r,e,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),r}getControl(e){return this.form.get(e.path)}removeControl(e){OP(e.control||null,e,!1),zte(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,r){this.form.get(e.path).setValue(r)}onSubmit(e){return this._submittedReactive.set(!0),r$(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new zI(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new UI(this.form))}_updateDomValue(){this.directives.forEach(e=>{let r=e.control,o=this.form.get(e.path);r!==o&&(OP(r||null,e),jte(o)&&(Bv(o,e,this.callSetDisabledState),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let r=this.form.get(e.path);t$(r,e),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let r=this.form.get(e.path);r&&Vte(r,e)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){XI(this.form,this),this._oldForm&&Uv(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(r){return new(r||t)(oe(Bl,10),oe(sf,10),oe(af,8))};static \u0275dir=Rt({type:t,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&le("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Ar([Xte]),Dn,vi]})}return t})(),Yte={provide:Mr,useExisting:or(()=>Wv)},Wv=(()=>{class t extends Gte{name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}_checkParentType(){s$(this._parent)}static \u0275fac=function(r){return new(r||t)(oe(Mr,13),oe(Bl,10),oe(sf,10))};static \u0275dir=Rt({type:t,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Ar([Yte]),Dn]})}return t})(),Qte={provide:Mr,useExisting:or(()=>Hv)},Hv=(()=>{class t extends Mr{_parent;name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}ngOnInit(){this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return Gv(this.name==null?this.name:this.name.toString(),this._parent)}_checkParentType(){s$(this._parent)}static \u0275fac=function(r){return new(r||t)(oe(Mr,13),oe(Bl,10),oe(sf,10))};static \u0275dir=Rt({type:t,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Ar([Qte]),Dn]})}return t})();function s$(t){return!(t instanceof Wv)&&!(t instanceof Uo)&&!(t instanceof Hv)}var Zte={provide:$l,useExisting:or(()=>Di)},Di=(()=>{class t extends $l{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new jt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,r,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=o$(this,i)}ngOnChanges(e){this._added||this._setUpControl(),n$(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return Gv(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||t)(oe(Mr,13),oe(Bl,10),oe(sf,10),oe(Vl,10),oe(i$,8))};static \u0275dir=Rt({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Ar([Zte]),Dn,vi]})}return t})(),Jte={provide:Vl,useExisting:or(()=>jo),multi:!0};function a$(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function ene(t){return t.split(":")[0]}var jo=(()=>{class t extends of{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=a$(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=ene(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&le("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Ar([Jte]),Dn]})}return t})(),Go=(()=>{class t{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(a$(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(oe(Ro),oe(wi),oe(jo,9))};static \u0275dir=Rt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),tne={provide:Vl,useExisting:or(()=>l$),multi:!0};function $P(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function nne(t){return t.split(":")[0]}var l$=(()=>{class t extends of{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);o.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);o.push(c)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=nne(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&le("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Ar([tne]),Dn]})}return t})(),Wo=(()=>{class t{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue($P(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue($P(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(oe(Ro),oe(wi),oe(l$,9))};static \u0275dir=Rt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function c$(t){return typeof t=="number"?t:parseFloat(t)}var u$=(()=>{class t{_validator=Fv;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):Fv,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Rt({type:t,features:[vi]})}return t})(),rne={provide:Bl,useExisting:or(()=>QI),multi:!0},QI=(()=>{class t extends u${max;inputName="max";normalizeInput=e=>c$(e);createValidator=e=>UP(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&kp("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[Ar([rne]),Dn]})}return t})(),one={provide:Bl,useExisting:or(()=>Dg),multi:!0},Dg=(()=>{class t extends u${min;inputName="min";normalizeInput=e=>c$(e);createValidator=e=>zP(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=Rt({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&kp("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[Ar([one]),Dn]})}return t})();var d$=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Vs({type:t});static \u0275inj=Ms({})}return t})(),GI=class extends nf{constructor(n,e,r){super(qI(e),KI(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,r={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,e={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,r={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),e&&(this.controls.splice(o,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){JP(this,!1,n),n.forEach((r,o)=>{ZP(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((r,o)=>{r.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,r)=>r._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,r)=>{n(e,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function LP(t){return!!t&&(t.asyncValidators!==void 0||t.validators!==void 0||t.updateOn!==void 0)}var os=(()=>{class t{useNonNullable=!1;get nonNullable(){let e=new t;return e.useNonNullable=!0,e}group(e,r=null){let o=this._reduceControls(e),i={};return LP(r)?i=r:r!==null&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new rf(o,i)}record(e,r=null){let o=this._reduceControls(e);return new jI(o,r)}control(e,r,o){let i={};return this.useNonNullable?(LP(r)?i=r:(i.validators=r,i.asyncValidators=o),new Ig(e,qe(me({},i),{nonNullable:!0}))):new Ig(e,r,o)}array(e,r,o){let i=e.map(s=>this._createControl(s));return new GI(i,r,o)}_reduceControls(e){let r={};return Object.keys(e).forEach(o=>{r[o]=this._createControl(e[o])}),r}_createControl(e){if(e instanceof Ig)return e;if(e instanceof nf)return e;if(Array.isArray(e)){let r=e[0],o=e.length>1?e[1]:null,i=e.length>2?e[2]:null;return this.control(r,o,i)}else return this.control(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var lf=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:af,useValue:e.callSetDisabledState??Tg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Vs({type:t});static \u0275inj=Ms({imports:[d$]})}return t})(),Ho=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:i$,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:af,useValue:e.callSetDisabledState??Tg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Vs({type:t});static \u0275inj=Ms({imports:[d$]})}return t})();var lr=[];for(let t=0;t<256;++t)lr.push((t+256).toString(16).slice(1));function p$(t,n=0){return(lr[t[n+0]]+lr[t[n+1]]+lr[t[n+2]]+lr[t[n+3]]+"-"+lr[t[n+4]]+lr[t[n+5]]+"-"+lr[t[n+6]]+lr[t[n+7]]+"-"+lr[t[n+8]]+lr[t[n+9]]+"-"+lr[t[n+10]]+lr[t[n+11]]+lr[t[n+12]]+lr[t[n+13]]+lr[t[n+14]]+lr[t[n+15]]).toLowerCase()}var ZI,ine=new Uint8Array(16);function JI(){if(!ZI){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");ZI=crypto.getRandomValues.bind(crypto)}return ZI(ine)}var sne=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),eT={randomUUID:sne};function ane(t,n,e){if(eT.randomUUID&&!n&&!t)return eT.randomUUID();t=t||{};let r=t.random??t.rng?.()??JI();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let o=0;o<16;++o)n[e+o]=r[o];return n}return p$(r)}var Wu=ane;var lne=(t,n)=>({"text-success":t,"text-danger":n});function cne(t,n){if(t&1&&(v(0,"div",138),U(1,"div",139),y()),t&2){let e=ee();P(),Ap("width",e.calculateFormProgress()+"%")}}function une(t,n){if(t&1&&(v(0,"span",140),C(1),y()),t&2){let e=ee();P(),ze("",e.calculateFormProgress(),"% Complete")}}function dne(t,n){t&1&&(v(0,"div",141),C(1," Account name is required "),y())}function pne(t,n){t&1&&(v(0,"div",141),C(1," Please select an instrument type "),y())}function fne(t,n){t&1&&(v(0,"div",141),C(1," Trade symbol is required "),y())}function mne(t,n){t&1&&(v(0,"div",141),C(1," Please select trade direction "),y())}function hne(t,n){t&1&&(v(0,"div",141),C(1," Time frame selection is required "),y())}function gne(t,n){t&1&&(v(0,"div",141),C(1," Please select an analysis type "),y())}function yne(t,n){t&1&&(v(0,"div",141),C(1," Strategy name is required "),y())}function xne(t,n){t&1&&(v(0,"div",141),C(1," Order type is required "),y())}function vne(t,n){t&1&&(v(0,"div",141),C(1," Entry criteria is required (min 10 characters) "),y())}function bne(t,n){t&1&&(v(0,"div",141),C(1," Exit strategy is required (min 10 characters) "),y())}function wne(t,n){t&1&&(v(0,"div",141),C(1," Valid account balance is required "),y())}function Cne(t,n){t&1&&(v(0,"div",141),C(1," Position size is required "),y())}function _ne(t,n){t&1&&(v(0,"div",141),C(1," Valid entry price is required "),y())}function Sne(t,n){t&1&&(v(0,"div",141),C(1," Entry date/time is required "),y())}function Ene(t,n){t&1&&(v(0,"div",141),C(1," Stop loss price is required "),y())}function Ine(t,n){t&1&&(v(0,"div",141),C(1," Take profit price is required "),y())}function Tne(t,n){t&1&&(v(0,"div",141),C(1," Risk percentage is required "),y())}function Dne(t,n){t&1&&(v(0,"div",142),U(1,"i",143),C(2," Risk exceeds recommended 2% "),y())}function Nne(t,n){t&1&&(v(0,"div",141),C(1," Estimated reward is required "),y())}function kne(t,n){t&1&&(v(0,"div",141),C(1," Please select your emotional state "),y())}function Ane(t,n){t&1&&(v(0,"div",142),U(1,"i",143),C(2," Consider if this emotional state might negatively impact your decision making "),y())}function Rne(t,n){t&1&&(v(0,"div",144),C(1," Please rate your confidence "),y())}function One(t,n){t&1&&(v(0,"div",141),C(1," Please identify potential biases (min 5 characters) "),y())}function Mne(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Setup"),y())}function Fne(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Strategy Details"),y())}function Pne(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Risk Management"),y())}function $ne(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Psychological Analysis"),y())}function Lne(t,n){if(t&1&&(v(0,"div",145),U(1,"i",146),v(2,"strong"),C(3,"Please fix the errors highlighted above before submitting."),y(),v(4,"ul",147),ie(5,Mne,2,0,"li",148)(6,Fne,2,0,"li",148)(7,Pne,2,0,"li",148)(8,$ne,2,0,"li",148),y()()),t&2){let e=ee();P(5),j("ngIf",e.hasErrors("tradeSetup")),P(),j("ngIf",e.hasErrors("strategyDetails")),P(),j("ngIf",e.hasErrors("riskManagement")),P(),j("ngIf",e.hasErrors("psychologicalAnalysis"))}}function Vne(t,n){if(t&1){let e=it();v(0,"button",149),le("click",function(){ge(e);let o=ee();return ye(o.onCancel())}),U(1,"i",150),C(2,"Cancel "),y()}}function Bne(t,n){if(t&1&&(v(0,"div",151),U(1,"i",152),C(2),y()),t&2){let e=ee();P(2),ze("",e.message," ")}}function zne(t,n){if(t&1&&(v(0,"div",153),U(1,"i",146),C(2),y()),t&2){let e=ee();P(2),ze("",e.errorMessage," ")}}var cf=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r}tradeLogData=null;formSubmitted=new jt;cancel=new jt;preTradeTableName="pretrade";postTradeTableName="posttrade";preTradeForm;postTradeForm;showEmotionalSection=!1;message="";errorMessage="";formSubmitMarker=!1;ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=Wu();this.preTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[this.tradeLogData?.createdtime??new Date().toISOString()],accountname:[this.tradeLogData?.accountname??"",_e.required],instrumenttype:[this.tradeLogData?.instrumenttype??"",_e.required],analysistype:[this.tradeLogData?.analysistype??"",_e.required],tradesymbol:[this.tradeLogData?.tradesymbol??"",_e.required],tradetype:[this.tradeLogData?.tradetype??"Long",_e.required],timeframe:[this.tradeLogData?.timeframe??"Day",_e.required],strategyname:[this.tradeLogData?.strategyname??""],typeoforder:[this.tradeLogData?.typeoforder??"",_e.required],entrycriteria:[this.tradeLogData?.entrycriteria??""],exitstrategy:[this.tradeLogData?.exitstrategy??""],entrydatetime:[this.tradeLogData?.entrydatetime??""],entryprice:[this.tradeLogData?.entryprice??""],accountbalance:[this.tradeLogData?.accountbalance??null,[_e.required,_e.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",_e.required],estimatedrisk:[this.tradeLogData?.estimatedrisk??null,_e.required],estimatedpnl:[this.tradeLogData?.estimatedpnl??null,_e.required],estimatedstoploss:[this.tradeLogData?.estimatedstoploss??null,_e.required],estimatedtakeprofit:[this.tradeLogData?.estimatedtakeprofit??null,_e.required],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],tradeconfidence:[this.tradeLogData?.tradeconfidence??"1"],isopen:!0,emotionalstatebefore:[this.tradeLogData?.emotionalstatebefore??"",_e.required],potentialbiases:[this.tradeLogData?.potentialbiases??"",_e.required],notes:[this.tradeLogData?.notes??""],updatedtime:[new Date().toISOString()]})}toggleEmotionalSection(){this.showEmotionalSection=!this.showEmotionalSection}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.preTradeForm.patchValue({setupscreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.preTradeForm.invalid){this.preTradeForm.markAllAsTouched();return}let n=this.preTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.preTradeTableName):await this.supabaseService.addTradeLog(n,this.preTradeTableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.preTradeForm.reset(),this.preTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.preTradeTableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateFormProgress(){let e=0;return this.preTradeForm.get("accountname")?.valid&&e++,this.preTradeForm.get("instrumenttype")?.valid&&e++,this.preTradeForm.get("tradesymbol")?.valid&&e++,this.preTradeForm.get("tradetype")?.valid&&e++,this.preTradeForm.get("timeframe")?.valid&&e++,this.preTradeForm.get("analysistype")?.valid&&e++,this.preTradeForm.get("strategyname")?.valid&&e++,this.preTradeForm.get("typeoforder")?.valid&&e++,this.preTradeForm.get("entrycriteria")?.valid&&e++,this.preTradeForm.get("exitstrategy")?.valid&&e++,this.preTradeForm.get("accountbalance")?.valid&&e++,this.preTradeForm.get("positionsize")?.valid&&e++,this.preTradeForm.get("entryprice")?.valid&&e++,this.preTradeForm.get("entrydatetime")?.valid&&e++,this.preTradeForm.get("estimatedstoploss")?.valid&&e++,this.preTradeForm.get("estimatedtakeprofit")?.valid&&e++,this.preTradeForm.get("estimatedrisk")?.valid&&e++,this.preTradeForm.get("estimatedpnl")?.valid&&e++,this.preTradeForm.get("emotionalstatebefore")?.valid&&e++,this.preTradeForm.get("tradeConfidence")?.valid&&e++,this.preTradeForm.get("potentialbiases")?.valid&&e++,Math.round(e/18*100)}calculateRiskRewardRatio(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?"N/A":`1:${(e/n).toFixed(2)}`}isGoodRiskReward(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?!1:e/n>=2}isNegativeEmotionalState(){let n=this.preTradeForm.get("emotionalstatebefore")?.value;return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}hasErrors(n){switch(n){case"tradeSetup":return this.preTradeForm.get("accountname")?.invalid||this.preTradeForm.get("instrumenttype")?.invalid||this.preTradeForm.get("tradesymbol")?.invalid||this.preTradeForm.get("tradetype")?.invalid||this.preTradeForm.get("timeframe")?.invalid||this.preTradeForm.get("analysistype")?.invalid||!1;case"strategyDetails":return this.preTradeForm.get("strategyname")?.invalid||this.preTradeForm.get("typeoforder")?.invalid||this.preTradeForm.get("entrycriteria")?.invalid||this.preTradeForm.get("exitstrategy")?.invalid||!1;case"riskManagement":return this.preTradeForm.get("accountbalance")?.invalid||this.preTradeForm.get("positionsize")?.invalid||this.preTradeForm.get("entryprice")?.invalid||this.preTradeForm.get("entrydatetime")?.invalid||this.preTradeForm.get("estimatedstoploss")?.invalid||this.preTradeForm.get("estimatedtakeprofit")?.invalid||this.preTradeForm.get("estimatedrisk")?.invalid||this.preTradeForm.get("estimatedpnl")?.invalid||!1;case"psychologicalAnalysis":return this.preTradeForm.get("emotionalstatebefore")?.invalid||this.preTradeForm.get("tradeConfidence")?.invalid||this.preTradeForm.get("potentialbiases")?.invalid||!1;default:return!1}}static \u0275fac=function(e){return new(e||t)(oe(os),oe(Vt),oe($t))};static \u0275cmp=Tt({type:t,selectors:[["app-pre-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:332,vars:40,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],[3,"click"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","entrycriteria",1,"form-label"],["id","entrycriteria","formControlName","entrycriteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)","rows","3",1,"form-control"],[1,"form-text"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Define your profit targets and stop loss levels","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],["type","button","data-bs-toggle","tooltip","title","Calculate based on risk",1,"btn","btn-outline-secondary"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Planned entry price",1,"form-control"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","estimatedstoploss",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedstoploss","formControlName","estimatedstoploss","placeholder","Stop loss price level",1,"form-control"],["for","estimatedtakeprofit",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedtakeprofit","formControlName","estimatedtakeprofit","placeholder","Target price level",1,"form-control"],[1,"mb-3"],[1,"col-md-4"],["for","estimatedrisk",1,"form-label"],["type","number","step","0.01","min","0","max","100","id","estimatedrisk","formControlName","estimatedrisk","placeholder","1-2% recommended",1,"form-control"],["class","text-warning mt-1 small",4,"ngIf"],["for","estimatedpnl",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedpnl","formControlName","estimatedpnl","placeholder","Expected % gain",1,"form-control"],[1,"form-label"],["type","text","readonly","",1,"form-control","bg-light",3,"value"],[1,"form-text",3,"ngClass"],[1,"bi","bi-5-circle","me-2"],["for","emotionalstatebefore",1,"form-label"],["id","emotionalstatebefore","formControlName","emotionalstatebefore",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],[1,"form-label","d-block"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","tradeconfidence","id","confidence1","value","1",1,"btn-check"],["for","confidence1",1,"btn","btn-outline-danger"],["type","radio","formControlName","tradeconfidence","id","confidence2","value","2",1,"btn-check"],["for","confidence2",1,"btn","btn-outline-warning"],["type","radio","formControlName","tradeconfidence","id","confidence3","value","3",1,"btn-check"],["for","confidence3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","tradeconfidence","id","confidence4","value","4",1,"btn-check"],["for","confidence4",1,"btn","btn-outline-primary"],["type","radio","formControlName","tradeconfidence","id","confidence5","value","5",1,"btn-check"],["for","confidence5",1,"btn","btn-outline-success"],[1,"form-text","text-center","mt-1"],["class","text-danger mt-1 small text-center",4,"ngIf"],["for","potentialbiases",1,"form-label"],["id","potentialbiases","formControlName","potentialbiases","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO, overconfidence)","rows","3",1,"form-control"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"text-warning","mt-1","small"],[1,"bi","bi-exclamation-triangle"],[1,"text-danger","mt-1","small","text-center"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),le("click",function(){return r.onCancel()}),C(8,"Pre-Trade Logs"),y()(),v(9,"li",6),C(10,"Pre-Trading Journal"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),C(14),y(),v(15,"p",10),C(16,"Document your strategy before entering positions to maintain discipline and clarity"),y()(),v(17,"div",11),ie(18,cne,2,2,"div",12)(19,une,2,1,"span",13),y()(),v(20,"form",14),le("ngSubmit",function(){return r.onSubmit()}),v(21,"div",15)(22,"div",16)(23,"h5",17),U(24,"i",18),C(25,"Trade Setup "),y(),v(26,"span",19),C(27,"Required"),y()(),v(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),C(32,"Account Name"),y(),v(33,"div",24)(34,"span",25),U(35,"i",26),y(),U(36,"input",27),y(),ie(37,dne,2,0,"div",28),y(),v(38,"div",22)(39,"label",29),C(40,"Instrument Type"),y(),v(41,"select",30)(42,"option",31),C(43,"Choose instrument type"),y(),v(44,"option",32),C(45,"Forex"),y(),v(46,"option",33),C(47,"Stocks"),y(),v(48,"option",34),C(49,"Futures"),y(),v(50,"option",35),C(51,"Crypto"),y(),v(52,"option",36),C(53,"Options"),y(),v(54,"option",37),C(55,"ETF"),y(),v(56,"option",38),C(57,"Other"),y()(),ie(58,pne,2,0,"div",28),y(),v(59,"div",22)(60,"label",39),C(61,"Trade Symbol"),y(),v(62,"div",24)(63,"span",25),U(64,"i",40),y(),U(65,"input",41),y(),ie(66,fne,2,0,"div",28),y(),v(67,"div",22)(68,"label",42),C(69,"Trade Direction"),y(),v(70,"div",43),U(71,"input",44),v(72,"label",45),C(73,"Long"),y(),U(74,"input",46),v(75,"label",47),C(76,"Short"),y()(),ie(77,mne,2,0,"div",28),y(),v(78,"div",22)(79,"label",48),C(80,"Time Frame"),y(),v(81,"select",49)(82,"option",31),C(83,"Select time frame"),y(),v(84,"option",50),C(85,"Scalp (minutes)"),y(),v(86,"option",51),C(87,"Day Trade (hours)"),y(),v(88,"option",52),C(89,"Swing (days-weeks)"),y(),v(90,"option",53),C(91,"Position (weeks-months)"),y(),v(92,"option",54),C(93,"Long Term (months+)"),y()(),ie(94,hne,2,0,"div",28),y(),v(95,"div",22)(96,"label",55),C(97,"Analysis Type"),y(),v(98,"select",56)(99,"option",31),C(100,"Choose analysis method"),y(),v(101,"option",57),C(102,"Technical"),y(),v(103,"option",58),C(104,"Fundamental"),y(),v(105,"option",59),C(106,"Both"),y(),v(107,"option",60),C(108,"Sentiment"),y(),v(109,"option",38),C(110,"Other"),y()(),ie(111,gne,2,0,"div",28),y()()()(),v(112,"div",15)(113,"div",16)(114,"h5",17),U(115,"i",61),C(116,"Strategy Details "),y(),v(117,"span",19),C(118,"Required"),y()(),v(119,"div",20)(120,"div",21)(121,"div",22)(122,"label",62),C(123,"Strategy Name"),y(),U(124,"input",63),ie(125,yne,2,0,"div",28),y(),v(126,"div",22)(127,"label",64),C(128,"Type of Order"),y(),v(129,"select",65)(130,"option",31),C(131,"Choose order type"),y(),v(132,"option",66),C(133,"Market"),y(),v(134,"option",67),C(135,"Limit"),y(),v(136,"option",68),C(137,"Stop"),y(),v(138,"option",69),C(139,"Stop Limit"),y(),v(140,"option",70),C(141,"Trailing Stop"),y()(),ie(142,xne,2,0,"div",28),y(),v(143,"div",71)(144,"label",72),C(145,"Entry Criteria "),v(146,"span",10),C(147,"(Why are you taking this trade?)"),y()(),U(148,"textarea",73),v(149,"div",74),C(150,"Be specific about what signals or conditions must be met for entry."),y(),ie(151,vne,2,0,"div",28),y(),v(152,"div",71)(153,"label",75),C(154,"Exit Strategy "),v(155,"span",10),C(156,"(How will you close this position?)"),y()(),U(157,"textarea",76),v(158,"div",74),C(159,"Include both profit-taking and loss-cutting criteria."),y(),ie(160,bne,2,0,"div",28),y()()()(),v(161,"div",15)(162,"div",16)(163,"h5",17),U(164,"i",77),C(165,"Risk Management "),y(),v(166,"span",19),C(167,"Required"),y()(),v(168,"div",20)(169,"div",21)(170,"div",22)(171,"label",78),C(172,"Account Balance"),y(),v(173,"div",24)(174,"span",25),C(175,"$"),y(),U(176,"input",79),y(),ie(177,wne,2,0,"div",28),y(),v(178,"div",22)(179,"label",80),C(180,"Position Size"),y(),v(181,"div",24),U(182,"input",81),v(183,"button",82),C(184,"Calculate"),y()(),ie(185,Cne,2,0,"div",28),y(),v(186,"div",22)(187,"label",83),C(188,"Entry Price"),y(),v(189,"div",24)(190,"span",25),C(191,"$"),y(),U(192,"input",84),y(),ie(193,_ne,2,0,"div",28),y(),v(194,"div",22)(195,"label",85),C(196,"Entry Date/Time"),y(),U(197,"input",86),ie(198,Sne,2,0,"div",28),y(),v(199,"div",22)(200,"label",87),C(201,"Stop Loss Price"),y(),v(202,"div",24)(203,"span",25),C(204,"$"),y(),U(205,"input",88),y(),ie(206,Ene,2,0,"div",28),y(),v(207,"div",22)(208,"label",89),C(209,"Take Profit Price"),y(),v(210,"div",24)(211,"span",25),C(212,"$"),y(),U(213,"input",90),y(),ie(214,Ine,2,0,"div",28),y(),v(215,"div",71),U(216,"hr"),v(217,"h6",91),C(218,"Risk/Reward Analysis"),y()(),v(219,"div",92)(220,"label",93),C(221,"Risk Per Trade"),y(),v(222,"div",24),U(223,"input",94),v(224,"span",25),C(225,"%"),y()(),v(226,"div",74),C(227,"Percentage of account at risk"),y(),ie(228,Tne,2,0,"div",28)(229,Dne,3,0,"div",95),y(),v(230,"div",92)(231,"label",96),C(232,"Estimated Reward"),y(),v(233,"div",24),U(234,"input",97),v(235,"span",25),C(236,"%"),y()(),ie(237,Nne,2,0,"div",28),y(),v(238,"div",92)(239,"label",98),C(240,"Risk/Reward Ratio"),y(),v(241,"div",24),U(242,"input",99),v(243,"span",25),C(244,"R:R"),y()(),v(245,"div",100),U(246,"i"),C(247),y()()()()(),v(248,"div",15)(249,"div",16)(250,"h5",17),U(251,"i",101),C(252,"Psychological Analysis "),y(),v(253,"span",19),C(254,"Required"),y()(),v(255,"div",20)(256,"div",21)(257,"div",22)(258,"label",102),C(259,"Current Emotional State"),y(),v(260,"select",103)(261,"option",31),C(262,"How are you feeling?"),y(),v(263,"option",104),C(264,"Calm & Focused"),y(),v(265,"option",105),C(266,"Excited"),y(),v(267,"option",106),C(268,"Anxious"),y(),v(269,"option",107),C(270,"Frustrated"),y(),v(271,"option",108),C(272,"Overconfident"),y(),v(273,"option",109),C(274,"Fearful"),y(),v(275,"option",110),C(276,"Neutral"),y(),v(277,"option",38),C(278,"Other"),y()(),ie(279,kne,2,0,"div",28)(280,Ane,3,0,"div",95),y(),v(281,"div",22)(282,"label",111),C(283,"Trading Confidence"),y(),v(284,"div",112),U(285,"input",113),v(286,"label",114),C(287,"1"),y(),U(288,"input",115),v(289,"label",116),C(290,"2"),y(),U(291,"input",117),v(292,"label",118),C(293,"3"),y(),U(294,"input",119),v(295,"label",120),C(296,"4"),y(),U(297,"input",121),v(298,"label",122),C(299,"5"),y()(),v(300,"div",123),C(301,"Low (1) to High (5)"),y(),ie(302,Rne,2,0,"div",124),y(),v(303,"div",71)(304,"label",125),C(305,"Potential Biases"),y(),U(306,"textarea",126),v(307,"div",74),C(308,"Identifying biases helps improve future decision making"),y(),ie(309,One,2,0,"div",28),y()()()(),v(310,"div",15)(311,"div",16)(312,"h5",17),U(313,"i",127),C(314,"Additional Notes "),y(),v(315,"span",128),C(316,"Optional"),y()(),v(317,"div",20)(318,"div",21)(319,"div",71)(320,"label",129),C(321,"Notes"),y(),U(322,"textarea",130),y()()()(),ie(323,Lne,9,4,"div",131),v(324,"div",132),ie(325,Vne,3,0,"button",133),v(326,"div")(327,"button",134),U(328,"i",135),C(329),y()()(),ie(330,Bne,3,1,"div",136)(331,zne,3,1,"div",137),y()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,x,b,S,_,E,I,D,O,R;P(14),ht(r.tradeLogData?"Edit Pre-Trading Journal":"Create Pre-Trading Journal"),P(4),j("ngIf",!r.tradeLogData),P(),j("ngIf",!r.tradeLogData),P(),j("formGroup",r.preTradeForm),P(17),j("ngIf",((o=r.preTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.preTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.preTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),P(21),j("ngIf",((i=r.preTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.preTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.preTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),P(8),j("ngIf",((s=r.preTradeForm.get("tradesymbol"))==null?null:s.invalid)&&(((s=r.preTradeForm.get("tradesymbol"))==null?null:s.dirty)||((s=r.preTradeForm.get("tradesymbol"))==null?null:s.touched)||r.formSubmitMarker)),P(11),j("ngIf",((a=r.preTradeForm.get("tradetype"))==null?null:a.invalid)&&(((a=r.preTradeForm.get("tradetype"))==null?null:a.dirty)||((a=r.preTradeForm.get("tradetype"))==null?null:a.touched)||r.formSubmitMarker)),P(17),j("ngIf",((l=r.preTradeForm.get("timeframe"))==null?null:l.invalid)&&(((l=r.preTradeForm.get("timeframe"))==null?null:l.dirty)||((l=r.preTradeForm.get("timeframe"))==null?null:l.touched)||r.formSubmitMarker)),P(17),j("ngIf",((c=r.preTradeForm.get("analysistype"))==null?null:c.invalid)&&(((c=r.preTradeForm.get("analysistype"))==null?null:c.dirty)||((c=r.preTradeForm.get("analysistype"))==null?null:c.touched)||r.formSubmitMarker)),P(14),j("ngIf",((u=r.preTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.preTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.preTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),P(17),j("ngIf",((d=r.preTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.preTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.preTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),P(9),j("ngIf",((p=r.preTradeForm.get("entrycriteria"))==null?null:p.invalid)&&(((p=r.preTradeForm.get("entrycriteria"))==null?null:p.dirty)||((p=r.preTradeForm.get("entrycriteria"))==null?null:p.touched)||r.formSubmitMarker)),P(9),j("ngIf",((f=r.preTradeForm.get("exitstrategy"))==null?null:f.invalid)&&(((f=r.preTradeForm.get("exitstrategy"))==null?null:f.dirty)||((f=r.preTradeForm.get("exitstrategy"))==null?null:f.touched)||r.formSubmitMarker)),P(17),j("ngIf",((m=r.preTradeForm.get("accountbalance"))==null?null:m.invalid)&&(((m=r.preTradeForm.get("accountbalance"))==null?null:m.dirty)||((m=r.preTradeForm.get("accountbalance"))==null?null:m.touched)||r.formSubmitMarker)),P(8),j("ngIf",((h=r.preTradeForm.get("positionsize"))==null?null:h.invalid)&&(((h=r.preTradeForm.get("positionsize"))==null?null:h.dirty)||((h=r.preTradeForm.get("positionsize"))==null?null:h.touched)||r.formSubmitMarker)),P(8),j("ngIf",((g=r.preTradeForm.get("entryprice"))==null?null:g.invalid)&&(((g=r.preTradeForm.get("entryprice"))==null?null:g.dirty)||((g=r.preTradeForm.get("entryprice"))==null?null:g.touched)||r.formSubmitMarker)),P(5),j("ngIf",((x=r.preTradeForm.get("entrydatetime"))==null?null:x.invalid)&&(((x=r.preTradeForm.get("entrydatetime"))==null?null:x.dirty)||((x=r.preTradeForm.get("entrydatetime"))==null?null:x.touched)||r.formSubmitMarker)),P(8),j("ngIf",((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.invalid)&&(((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.dirty)||((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.touched)||r.formSubmitMarker)),P(8),j("ngIf",((S=r.preTradeForm.get("estimatedtakeprofit"))==null?null:S.invalid)&&(((S=r.preTradeForm.get("estimatedtakeprofit"))==null?null:S.dirty)||((S=r.preTradeForm.get("estimatedtakeprofit"))==null?null:S.touched)||r.formSubmitMarker)),P(14),j("ngIf",((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.invalid)&&(((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.dirty)||((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.touched)||r.formSubmitMarker)),P(),j("ngIf",((E=r.preTradeForm.get("estimatedrisk"))==null?null:E.value)>2),P(8),j("ngIf",((I=r.preTradeForm.get("estimatedpnl"))==null?null:I.invalid)&&(((I=r.preTradeForm.get("estimatedpnl"))==null?null:I.dirty)||((I=r.preTradeForm.get("estimatedpnl"))==null?null:I.touched)||r.formSubmitMarker)),P(5),j("value",r.calculateRiskRewardRatio()),P(3),j("ngClass",Zi(37,lne,r.isGoodRiskReward(),!r.isGoodRiskReward())),P(),UO(r.isGoodRiskReward()?"bi bi-check-circle":"bi bi-x-circle"),P(),ze(" ",r.isGoodRiskReward()?"Good risk/reward ratio":"Risk/reward should be at least 1:2"," "),P(32),j("ngIf",((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.invalid)&&(((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.dirty)||((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.touched)||r.formSubmitMarker)),P(),j("ngIf",r.isNegativeEmotionalState()),P(22),j("ngIf",((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.invalid)&&(((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.dirty)||((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.touched)||r.formSubmitMarker)),P(7),j("ngIf",((R=r.preTradeForm.get("potentialbiases"))==null?null:R.invalid)&&(((R=r.preTradeForm.get("potentialbiases"))==null?null:R.dirty)||((R=r.preTradeForm.get("potentialbiases"))==null?null:R.touched)||r.formSubmitMarker)),P(14),j("ngIf",r.formSubmitMarker&&r.preTradeForm.invalid),P(2),j("ngIf",r.tradeLogData),P(4),ze("",r.tradeLogData?"Update":"Submit"," "),P(),j("ngIf",r.message),P(),j("ngIf",r.errorMessage)}},dependencies:[Qt,Po,pn,Ho,zo,Go,Wo,Kn,Ys,jo,Qs,yr,Bo,Dg,QI,Uo,Di,hr],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function Une(t,n){t&1&&(v(0,"div",12),C(1,"Loading trade logs..."),y())}function jne(t,n){if(t&1&&(v(0,"div",13),C(1),y()),t&2){let e=ee();P(),ht(e.errorMessage)}}function Gne(t,n){if(t&1){let e=it();v(0,"div",16)(1,"div",17),le("click",function(){let o=ge(e).$implicit,i=ee(2);return ye(i.openEditModal(o))}),v(2,"div",18),U(3,"i",19),C(4," Planned "),y(),v(5,"div",20),le("click",function(o){let i=ge(e).$implicit,s=ee(2);return ye(s.onDeleteTradeLog(i,o))}),U(6,"i",21),y(),v(7,"div",22)(8,"h4",23),C(9),y(),v(10,"h5",24),C(11),y(),v(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),C(16,"Analysis:"),y(),C(17),y(),v(18,"div",27)(19,"strong"),C(20,"Order:"),y(),C(21),y()(),v(22,"div",26)(23,"div",27)(24,"strong"),C(25,"Stop Loss:"),y(),C(26),y(),v(27,"div",27)(28,"strong"),C(29,"Take Profit:"),y(),C(30),y()(),v(31,"div",26)(32,"div",27)(33,"strong"),C(34,"Risk:"),y(),C(35),y(),v(36,"div",27)(37,"strong"),C(38,"Est. PnL:"),y(),C(39),y()(),v(40,"div",28)(41,"div",29)(42,"strong"),C(43,"Account:"),y(),C(44),y()()(),v(45,"div",30)(46,"small",31),C(47),Ci(48,"date"),y()()()()()}if(t&2){let e=n.$implicit;P(9),ht(e.tradesymbol),P(2),Tu(" ",e.tradetype," | ",e.instrumenttype," "),P(6),ze(" ",e.analysistype," "),P(4),ze(" ",e.typeoforder," "),P(5),ze(" ",e.estimatedstoploss," "),P(4),ze(" ",e.estimatedtakeprofit," "),P(5),ze(" ",e.estimatedrisk," "),P(4),ze(" ",e.estimatedpnl," "),P(5),ze(" ",e.accountname," "),P(3),ht(_i(48,11,e.createdtime,"medium"))}}function Wne(t,n){if(t&1&&(v(0,"div",14),ie(1,Gne,49,14,"div",15),y()),t&2){let e=ee();P(),j("ngForOf",e.tradeLogs)}}function Hne(t,n){t&1&&(v(0,"div",32),C(1," No trade logs found. "),y())}function qne(t,n){if(t&1){let e=it();v(0,"div",33),le("click",function(o){ge(e);let i=ee();return ye(i.closeModalOnOverlayClick(o))}),v(1,"div",34),le("click",function(o){return ge(e),ye(o.stopPropagation())}),v(2,"app-pre-trade-log",35),le("formSubmitted",function(){ge(e);let o=ee();return ye(o.onFormSubmitted())})("cancel",function(){ge(e);let o=ee();return ye(o.closeModal())}),y()()()}if(t&2){let e=ee();P(2),j("tradeLogData",e.selectedTradeLog)}}var qv=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="pretrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName)}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(oe(Vt),oe($t))};static \u0275cmp=Tt({type:t,selectors:[["app-pre-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/pretradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click"],[1,"trade-status-indicator","status-planned"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Pre-Trade Logs"),y(),v(8,"li",3)(9,"a",6),C(10,"Pre-Trading Journal"),y()()()(),v(11,"h2"),C(12,"Pre Trade Logs"),y(),ie(13,Une,2,0,"div",7)(14,jne,2,1,"div",8)(15,Wne,2,1,"div",9)(16,Hne,2,0,"div",10),y(),ie(17,qne,3,1,"div",11)),e&2&&(P(13),j("ngIf",r.loading),P(),j("ngIf",r.errorMessage),P(),j("ngIf",r.tradeLogs&&r.tradeLogs.length),P(),j("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),P(),j("ngIf",r.showModal))},dependencies:[hr,Qt,mr,pn,es,cf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease;border-left:4px solid #6c757d!important}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-planned[_ngcontent-%COMP%]{background-color:#6c757d}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0})};function Kne(t,n){if(t&1&&(v(0,"div",131),U(1,"div",132),y()),t&2){let e=ee();P(),Ap("width",e.calculateFormProgress()+"%")}}function Xne(t,n){if(t&1&&(v(0,"span",133),C(1),y()),t&2){let e=ee();P(),ze("",e.calculateFormProgress(),"% Complete")}}function Yne(t,n){t&1&&(v(0,"div",134),C(1," Account name is required "),y())}function Qne(t,n){t&1&&(v(0,"div",134),C(1," Please select an instrument type "),y())}function Zne(t,n){t&1&&(v(0,"div",134),C(1," Please select an analysis type "),y())}function Jne(t,n){t&1&&(v(0,"div",134),C(1," Trade symbol is required "),y())}function ere(t,n){t&1&&(v(0,"div",134),C(1," Please select trade direction "),y())}function tre(t,n){t&1&&(v(0,"div",134),C(1," Time frame selection is required "),y())}function nre(t,n){t&1&&(v(0,"div",134),C(1," Strategy name is required "),y())}function rre(t,n){t&1&&(v(0,"div",134),C(1," Order type is required "),y())}function ore(t,n){t&1&&(v(0,"div",134),C(1," Entry date/time is required "),y())}function ire(t,n){t&1&&(v(0,"div",134),C(1," Exit date/time is required "),y())}function sre(t,n){t&1&&(v(0,"div",134),C(1," Valid entry price is required "),y())}function are(t,n){t&1&&(v(0,"div",134),C(1," Valid exit price is required "),y())}function lre(t,n){t&1&&(v(0,"div",134),C(1," Position size is required "),y())}function cre(t,n){t&1&&(v(0,"div",134),C(1," Please select trade outcome "),y())}function ure(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Details"),y())}function dre(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Strategy Information"),y())}function pre(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Execution"),y())}function fre(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Outcome"),y())}function mre(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Post-Trade Analysis"),y())}function hre(t,n){if(t&1&&(v(0,"div",135),U(1,"i",136),v(2,"strong"),C(3,"Please fix the errors highlighted above before submitting."),y(),v(4,"ul",137),ie(5,ure,2,0,"li",138)(6,dre,2,0,"li",138)(7,pre,2,0,"li",138)(8,fre,2,0,"li",138)(9,mre,2,0,"li",138),y()()),t&2){let e=ee();P(5),j("ngIf",e.hasErrors("tradeDetails")),P(),j("ngIf",e.hasErrors("strategyInformation")),P(),j("ngIf",e.hasErrors("tradeExecution")),P(),j("ngIf",e.hasErrors("tradeOutcome")),P(),j("ngIf",e.hasErrors("postTradeAnalysis"))}}function gre(t,n){if(t&1){let e=it();v(0,"button",99),le("click",function(){ge(e);let o=ee();return ye(o.onCancel())}),U(1,"i",139),C(2,"Cancel "),y()}}function yre(t,n){if(t&1&&(v(0,"div",140),U(1,"i",141),C(2),y()),t&2){let e=ee();P(2),ze("",e.message," ")}}function xre(t,n){if(t&1&&(v(0,"div",142),U(1,"i",136),C(2),y()),t&2){let e=ee();P(2),ze("",e.errorMessage," ")}}var uf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabaseService=r}tradeLogData=null;formSubmitted=new jt;cancel=new jt;tableName="posttrade";postTradeForm;message="";errorMessage="";formSubmitMarker=!1;tradeOutcomes=["Win","Loss","Breakeven"];tradeDirections=["Long","Short"];ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=Wu();this.postTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[new Date().toISOString(),_e.required],accountname:[this.tradeLogData?.accountname,[_e.required,_e.maxLength(255)]],accountbalance:[this.tradeLogData?.accountbalance??""],instrumenttype:[this.tradeLogData?.instrumenttype??"",[_e.required,_e.maxLength(50)]],analysistype:[this.tradeLogData?.analysistype??"",[_e.required,_e.maxLength(100)]],tradesymbol:[this.tradeLogData?.tradesymbol??"",[_e.required,_e.maxLength(50)]],tradetype:[this.tradeLogData?.tradetype??"",[_e.required,_e.maxLength(50)]],timeframe:[this.tradeLogData?.timeframe??"",[_e.required,_e.maxLength(50)]],entrydatetime:[this.tradeLogData?.entrydatetime??"",_e.required],strategyname:[this.tradeLogData?.strategyname??"",[_e.required,_e.maxLength(255)]],typeoforder:[this.tradeLogData?.typeoforder??"",[_e.required,_e.maxLength(50)]],exitstrategy:[this.tradeLogData?.exitstrategy??""],entryprice:[this.tradeLogData?.entryprice??"",[_e.required,_e.min(0)]],exitprice:[this.tradeLogData?.exitprice??"",[_e.required,_e.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",[_e.required,_e.maxLength(50)]],exitdatetime:[this.tradeLogData?.exitdatetime??"",_e.required],tradeoutcome:[this.tradeLogData?.tradeoutcome??"",_e.required],profitlossamount:[this.tradeLogData?.profitlossamount??""],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],emotionalstateafter:[this.tradeLogData?.emotionalstateafter??""],emotionalimpactondecision:[this.tradeLogData?.emotionalimpactondecision??""],whatwentwell:[this.tradeLogData?.whatwentwell??""],whatcouldimprove:[this.tradeLogData?.whatcouldimprove??""],notes:[this.tradeLogData?.notes??""],isopen:[this.tradeLogData?.isopen??!0,_e.required],updatedtime:[new Date().toDateString(),_e.required]})}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.postTradeForm.patchValue({setupScreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.postTradeForm.invalid){this.postTradeForm.markAllAsTouched();return}let n=this.postTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.tableName):await this.supabaseService.addTradeLog(n,this.tableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.postTradeForm.reset(),this.postTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.tableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateProfitLoss(){let n=this.postTradeForm.get("entryprice")?.value,e=this.postTradeForm.get("exitprice")?.value,r=parseFloat(this.postTradeForm.get("positionsize")?.value),o=this.postTradeForm.get("tradetype")?.value;if(n&&e&&r&&o){let i=0;o==="Long"?i=(e-n)*r:o==="Short"&&(i=(n-e)*r),this.postTradeForm.get("profitlossamount")?.setValue(i.toFixed(2)),i>0?this.postTradeForm.get("tradeoutcome")?.setValue("Win"):i<0?this.postTradeForm.get("tradeoutcome")?.setValue("Loss"):this.postTradeForm.get("tradeoutcome")?.setValue("Breakeven")}}calculateFormProgress(){let n=Object.keys(this.postTradeForm.controls).filter(r=>this.postTradeForm.get(r)?.validator!==null),e=n.filter(r=>this.postTradeForm.get(r)?.valid);return Math.round(e.length/n.length*100)}hasErrors(n){let e=!1,r={tradeDetails:["accountname","instrumenttype","analysistype","tradesymbol","tradetype","timeframe"],strategyInformation:["strategyname","typeoforder"],tradeExecution:["entrydatetime","exitdatetime","entryprice","exitprice","positionsize"],tradeOutcome:["tradeoutcome"],postTradeAnalysis:["emotionalstateafter","whatwentwell","whatcouldimprove"]};return r[n]&&r[n].forEach(o=>{this.postTradeForm.get(o)?.invalid&&(e=!0)}),e}static \u0275fac=function(e){return new(e||t)(oe(os),oe($t),oe(Vt))};static \u0275cmp=Tt({type:t,selectors:[["app-post-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:299,vars:23,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["routerLink","/posttrades"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Describe the exit strategy you implemented","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","exitdatetime",1,"form-label"],["type","datetime-local","id","exitdatetime","formControlName","exitdatetime",1,"form-control"],[1,"col-md-4"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Actual entry price",1,"form-control"],["for","exitprice",1,"form-label"],["type","number","id","exitprice","formControlName","exitprice","step","0.01","min","0","placeholder","Actual exit price",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],[1,"bi","bi-4-circle","me-2"],["for","tradeoutcome",1,"form-label"],["role","group","aria-label","Trade outcome",1,"btn-group","w-100"],["type","radio","name","tradeoutcome","id","tradeoutcome_win","value","Win","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_win",1,"btn","btn-outline-success"],["type","radio","name","tradeoutcome","id","tradeoutcome_loss","value","Loss","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_loss",1,"btn","btn-outline-danger"],["type","radio","name","tradeoutcome","id","tradeoutcome_breakeven","value","Breakeven","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_breakeven",1,"btn","btn-outline-warning"],["for","profitlossamount",1,"form-label"],["type","number","step","0.01","id","profitlossamount","formControlName","profitlossamount","placeholder","e.g. 50.25 or -30.50",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-6-circle","me-2"],["for","emotionalstateafter",1,"form-label"],["id","emotionalstateafter","formControlName","emotionalstateafter",1,"form-select"],["value","Satisfied"],["value","Excited"],["value","Relieved"],["value","Disappointed"],["value","Frustrated"],["value","Neutral"],["value","Angry"],["for","emotionalimpactondecision",1,"form-label"],["id","emotionalimpactondecision","formControlName","emotionalimpactondecision","placeholder","How did your emotions affect your trading decisions?","rows","3",1,"form-control"],["for","whatwentwell",1,"form-label"],["id","whatwentwell","formControlName","whatwentwell","placeholder","What aspects of this trade did you execute correctly?","rows","3",1,"form-control"],["for","whatcouldimprove",1,"form-label"],["id","whatcouldimprove","formControlName","whatcouldimprove","placeholder","What could you have done better in this trade?","rows","3",1,"form-control"],["for","isopen",1,"form-label"],[1,"form-check","form-switch"],["type","checkbox","id","isopen","formControlName","isopen",1,"form-check-input"],["for","isopen",1,"form-check-label"],[1,"bi","bi-7-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),C(8,"Trade Logs"),y()(),v(9,"li",6),C(10,"Post-Trading Journal"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),C(14),y(),v(15,"p",10),C(16,"Document your completed trades to analyze performance and improve your strategy"),y()(),v(17,"div",11),ie(18,Kne,2,2,"div",12)(19,Xne,2,1,"span",13),y()(),v(20,"form",14),le("ngSubmit",function(){return r.onSubmit()}),v(21,"div",15)(22,"div",16)(23,"h5",17),U(24,"i",18),C(25,"Trade Details "),y(),v(26,"span",19),C(27,"Required"),y()(),v(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),C(32,"Account Name"),y(),v(33,"div",24)(34,"span",25),U(35,"i",26),y(),U(36,"input",27),y(),ie(37,Yne,2,0,"div",28),y(),v(38,"div",22)(39,"label",29),C(40,"Account Balance"),y(),v(41,"div",24)(42,"span",25),C(43,"$"),y(),U(44,"input",30),y()(),v(45,"div",22)(46,"label",31),C(47,"Instrument Type"),y(),v(48,"select",32)(49,"option",33),C(50,"Choose instrument type"),y(),v(51,"option",34),C(52,"Forex"),y(),v(53,"option",35),C(54,"Stocks"),y(),v(55,"option",36),C(56,"Futures"),y(),v(57,"option",37),C(58,"Crypto"),y(),v(59,"option",38),C(60,"Options"),y(),v(61,"option",39),C(62,"ETF"),y(),v(63,"option",40),C(64,"Other"),y()(),ie(65,Qne,2,0,"div",28),y(),v(66,"div",22)(67,"label",41),C(68,"Analysis Type"),y(),v(69,"select",42)(70,"option",33),C(71,"Choose analysis method"),y(),v(72,"option",43),C(73,"Technical"),y(),v(74,"option",44),C(75,"Fundamental"),y(),v(76,"option",45),C(77,"Both"),y(),v(78,"option",46),C(79,"Sentiment"),y(),v(80,"option",40),C(81,"Other"),y()(),ie(82,Zne,2,0,"div",28),y(),v(83,"div",22)(84,"label",47),C(85,"Trade Symbol"),y(),v(86,"div",24)(87,"span",25),U(88,"i",48),y(),U(89,"input",49),y(),ie(90,Jne,2,0,"div",28),y(),v(91,"div",22)(92,"label",50),C(93,"Trade Direction"),y(),v(94,"div",51),U(95,"input",52),v(96,"label",53),C(97,"Long"),y(),U(98,"input",54),v(99,"label",55),C(100,"Short"),y()(),ie(101,ere,2,0,"div",28),y(),v(102,"div",22)(103,"label",56),C(104,"Time Frame"),y(),v(105,"select",57)(106,"option",33),C(107,"Select time frame"),y(),v(108,"option",58),C(109,"Scalp (minutes)"),y(),v(110,"option",59),C(111,"Day Trade (hours)"),y(),v(112,"option",60),C(113,"Swing (days-weeks)"),y(),v(114,"option",61),C(115,"Position (weeks-months)"),y(),v(116,"option",62),C(117,"Long Term (months+)"),y()(),ie(118,tre,2,0,"div",28),y()()()(),v(119,"div",15)(120,"div",16)(121,"h5",17),U(122,"i",63),C(123,"Strategy Information "),y(),v(124,"span",19),C(125,"Required"),y()(),v(126,"div",20)(127,"div",21)(128,"div",22)(129,"label",64),C(130,"Strategy Name"),y(),U(131,"input",65),ie(132,nre,2,0,"div",28),y(),v(133,"div",22)(134,"label",66),C(135,"Type of Order"),y(),v(136,"select",67)(137,"option",33),C(138,"Choose order type"),y(),v(139,"option",68),C(140,"Market"),y(),v(141,"option",69),C(142,"Limit"),y(),v(143,"option",70),C(144,"Stop"),y(),v(145,"option",71),C(146,"Stop Limit"),y(),v(147,"option",72),C(148,"Trailing Stop"),y()(),ie(149,rre,2,0,"div",28),y(),v(150,"div",73)(151,"label",74),C(152,"Exit Strategy Used"),y(),U(153,"textarea",75),y()()()(),v(154,"div",15)(155,"div",16)(156,"h5",17),U(157,"i",76),C(158,"Trade Execution "),y(),v(159,"span",19),C(160,"Required"),y()(),v(161,"div",20)(162,"div",21)(163,"div",22)(164,"label",77),C(165,"Entry Date/Time"),y(),U(166,"input",78),ie(167,ore,2,0,"div",28),y(),v(168,"div",22)(169,"label",79),C(170,"Exit Date/Time"),y(),U(171,"input",80),ie(172,ire,2,0,"div",28),y(),v(173,"div",81)(174,"label",82),C(175,"Entry Price"),y(),v(176,"div",24)(177,"span",25),C(178,"$"),y(),U(179,"input",83),y(),ie(180,sre,2,0,"div",28),y(),v(181,"div",81)(182,"label",84),C(183,"Exit Price"),y(),v(184,"div",24)(185,"span",25),C(186,"$"),y(),U(187,"input",85),y(),ie(188,are,2,0,"div",28),y(),v(189,"div",81)(190,"label",86),C(191,"Position Size"),y(),v(192,"div",24),U(193,"input",87),y(),ie(194,lre,2,0,"div",28),y()()()(),v(195,"div",15)(196,"div",16)(197,"h5",17),U(198,"i",88),C(199,"Trade Outcome "),y(),v(200,"span",19),C(201,"Required"),y()(),v(202,"div",20)(203,"div",21)(204,"div",22)(205,"label",89),C(206,"Trade Result"),y(),v(207,"div",90),U(208,"input",91),v(209,"label",92),C(210,"Win"),y(),U(211,"input",93),v(212,"label",94),C(213,"Loss"),y(),U(214,"input",95),v(215,"label",96),C(216,"Breakeven"),y()(),ie(217,cre,2,0,"div",28),y(),v(218,"div",22)(219,"label",97),C(220,"Profit/Loss Amount"),y(),v(221,"div",24)(222,"span",25),C(223,"$"),y(),U(224,"input",98),v(225,"button",99),le("click",function(){return r.calculateProfitLoss()}),C(226," Calculate "),y()()()()()(),v(227,"div",15)(228,"div",16)(229,"h5",17),U(230,"i",100),C(231,"Post-Trade Analysis "),y(),v(232,"span",19),C(233,"Required"),y()(),v(234,"div",20)(235,"div",21)(236,"div",22)(237,"label",101),C(238,"Emotional State After Trade"),y(),v(239,"select",102)(240,"option",33),C(241,"How do you feel now?"),y(),v(242,"option",103),C(243,"Satisfied"),y(),v(244,"option",104),C(245,"Excited"),y(),v(246,"option",105),C(247,"Relieved"),y(),v(248,"option",106),C(249,"Disappointed"),y(),v(250,"option",107),C(251,"Frustrated"),y(),v(252,"option",108),C(253,"Neutral"),y(),v(254,"option",109),C(255,"Angry"),y(),v(256,"option",40),C(257,"Other"),y()()(),v(258,"div",73)(259,"label",110),C(260,"Emotional Impact on Decisions"),y(),U(261,"textarea",111),y(),v(262,"div",73)(263,"label",112),C(264,"What Went Well"),y(),U(265,"textarea",113),y(),v(266,"div",73)(267,"label",114),C(268,"Areas for Improvement"),y(),U(269,"textarea",115),y(),v(270,"div",22)(271,"label",116),C(272,"Trade Status"),y(),v(273,"div",117),U(274,"input",118),v(275,"label",119),C(276,"This position is still open"),y()()()()()(),v(277,"div",15)(278,"div",16)(279,"h5",17),U(280,"i",120),C(281,"Additional Notes "),y(),v(282,"span",121),C(283,"Optional"),y()(),v(284,"div",20)(285,"div",21)(286,"div",73)(287,"label",122),C(288,"Notes"),y(),U(289,"textarea",123),y()()()(),ie(290,hre,10,5,"div",124),v(291,"div",125),ie(292,gre,3,0,"button",126),v(293,"div")(294,"button",127),U(295,"i",128),C(296),y()()(),ie(297,yre,3,1,"div",129)(298,xre,3,1,"div",130),y()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,x;P(14),ht(r.tradeLogData?"Edit Post-Trading Journal":"Create Post-Trading Journal"),P(4),j("ngIf",!r.tradeLogData),P(),j("ngIf",!r.tradeLogData),P(),j("formGroup",r.postTradeForm),P(17),j("ngIf",((o=r.postTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.postTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.postTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),P(28),j("ngIf",((i=r.postTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.postTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.postTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),P(17),j("ngIf",((s=r.postTradeForm.get("analysistype"))==null?null:s.invalid)&&(((s=r.postTradeForm.get("analysistype"))==null?null:s.dirty)||((s=r.postTradeForm.get("analysistype"))==null?null:s.touched)||r.formSubmitMarker)),P(8),j("ngIf",((a=r.postTradeForm.get("tradesymbol"))==null?null:a.invalid)&&(((a=r.postTradeForm.get("tradesymbol"))==null?null:a.dirty)||((a=r.postTradeForm.get("tradesymbol"))==null?null:a.touched)||r.formSubmitMarker)),P(11),j("ngIf",((l=r.postTradeForm.get("tradetype"))==null?null:l.invalid)&&(((l=r.postTradeForm.get("tradetype"))==null?null:l.dirty)||((l=r.postTradeForm.get("tradetype"))==null?null:l.touched)||r.formSubmitMarker)),P(17),j("ngIf",((c=r.postTradeForm.get("timeframe"))==null?null:c.invalid)&&(((c=r.postTradeForm.get("timeframe"))==null?null:c.dirty)||((c=r.postTradeForm.get("timeframe"))==null?null:c.touched)||r.formSubmitMarker)),P(14),j("ngIf",((u=r.postTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.postTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.postTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),P(17),j("ngIf",((d=r.postTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.postTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.postTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),P(18),j("ngIf",((p=r.postTradeForm.get("entrydatetime"))==null?null:p.invalid)&&(((p=r.postTradeForm.get("entrydatetime"))==null?null:p.dirty)||((p=r.postTradeForm.get("entrydatetime"))==null?null:p.touched)||r.formSubmitMarker)),P(5),j("ngIf",((f=r.postTradeForm.get("exitdatetime"))==null?null:f.invalid)&&(((f=r.postTradeForm.get("exitdatetime"))==null?null:f.dirty)||((f=r.postTradeForm.get("exitdatetime"))==null?null:f.touched)||r.formSubmitMarker)),P(8),j("ngIf",((m=r.postTradeForm.get("entryprice"))==null?null:m.invalid)&&(((m=r.postTradeForm.get("entryprice"))==null?null:m.dirty)||((m=r.postTradeForm.get("entryprice"))==null?null:m.touched)||r.formSubmitMarker)),P(8),j("ngIf",((h=r.postTradeForm.get("exitprice"))==null?null:h.invalid)&&(((h=r.postTradeForm.get("exitprice"))==null?null:h.dirty)||((h=r.postTradeForm.get("exitprice"))==null?null:h.touched)||r.formSubmitMarker)),P(6),j("ngIf",((g=r.postTradeForm.get("positionsize"))==null?null:g.invalid)&&(((g=r.postTradeForm.get("positionsize"))==null?null:g.dirty)||((g=r.postTradeForm.get("positionsize"))==null?null:g.touched)||r.formSubmitMarker)),P(23),j("ngIf",((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.invalid)&&(((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.dirty)||((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.touched)||r.formSubmitMarker)),P(73),j("ngIf",r.formSubmitMarker&&r.postTradeForm.invalid),P(2),j("ngIf",r.tradeLogData),P(4),ze("",r.tradeLogData?"Update":"Submit"," "),P(),j("ngIf",r.message),P(),j("ngIf",r.errorMessage)}},dependencies:[Qt,pn,Ho,zo,Go,Wo,Kn,Ys,ju,jo,Qs,yr,Bo,Dg,Uo,Di,hr],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};var vre=(t,n,e)=>({"open-trade":t,"win-trade":n,"loss-trade":e}),bre=(t,n,e)=>({"status-open":t,"status-win":n,"status-loss":e}),wre=(t,n,e)=>({"bi-clock-history":t,"bi-check-circle":n,"bi-x-circle":e}),Cre=(t,n,e)=>({"text-success":t,"text-danger":n,"text-secondary":e});function _re(t,n){t&1&&(v(0,"div",12),C(1,"Loading trade logs..."),y())}function Sre(t,n){if(t&1&&(v(0,"div",13),C(1),y()),t&2){let e=ee();P(),ht(e.errorMessage)}}function Ere(t,n){if(t&1){let e=it();v(0,"div",16)(1,"div",17),le("click",function(){let o=ge(e).$implicit,i=ee(2);return ye(i.openEditModal(o))}),v(2,"div",18),U(3,"i",19),C(4),y(),v(5,"div",20),le("click",function(o){let i=ge(e).$implicit,s=ee(2);return ye(s.onDeleteTradeLog(i,o))}),U(6,"i",21),y(),v(7,"div",22)(8,"h4",23),C(9),y(),v(10,"h5",24),C(11),y(),v(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),C(16,"Strategy:"),y(),C(17),y(),v(18,"div",27)(19,"strong"),C(20,"Analysis:"),y(),C(21),y()(),v(22,"div",26)(23,"div",27)(24,"strong"),C(25,"Entry:"),y(),C(26),y(),v(27,"div",27)(28,"strong"),C(29,"Exit:"),y(),C(30),y()(),v(31,"div",26)(32,"div",27)(33,"strong"),C(34,"Date:"),y(),C(35),Ci(36,"date"),y(),v(37,"div",27)(38,"strong"),C(39,"Account:"),y(),C(40),y()(),v(41,"div",28)(42,"div",29)(43,"strong"),C(44,"P/L:"),y(),v(45,"span",30),C(46),y()()()(),v(47,"div",31)(48,"small",32),C(49),Ci(50,"date"),y()()()()()}if(t&2){let e=n.$implicit;P(),j("ngClass",Tl(23,vre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),P(),j("ngClass",Tl(27,bre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),P(),j("ngClass",Tl(31,wre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),P(),ze(" ",e.isopen?"In Progress":e.tradeoutcome," "),P(5),ht(e.tradesymbol),P(2),Ch(" ",e.tradetype," | ",e.instrumenttype," | ",e.timeframe," "),P(6),ze(" ",e.strategyname," "),P(4),ze(" ",e.analysistype," "),P(5),ze(" ",e.entryprice," "),P(4),ze(" ",e.isopen?"Pending":e.exitprice," "),P(5),ze(" ",_i(36,17,e.entrydatetime,"shortDate")," "),P(5),ze(" ",e.accountname," "),P(5),j("ngClass",Tl(35,Cre,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss",e.isopen)),P(),ze(" ",e.isopen?"Trade in progress":e.profitlossamount," "),P(3),ht(_i(50,20,e.createdtime,"medium"))}}function Ire(t,n){if(t&1&&(v(0,"div",14),ie(1,Ere,51,39,"div",15),y()),t&2){let e=ee();P(),j("ngForOf",e.tradeLogs)}}function Tre(t,n){t&1&&(v(0,"div",33),C(1," No trade logs found. "),y())}function Dre(t,n){if(t&1){let e=it();v(0,"div",34),le("click",function(o){ge(e);let i=ee();return ye(i.closeModalOnOverlayClick(o))}),v(1,"div",35),le("click",function(o){return ge(e),ye(o.stopPropagation())}),v(2,"app-post-trade-log",36),le("formSubmitted",function(){ge(e);let o=ee();return ye(o.onFormSubmitted())})("cancel",function(){ge(e);let o=ee();return ye(o.closeModal())}),y()()()}if(t&2){let e=ee();P(2),j("tradeLogData",e.selectedTradeLog)}}var Kv=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="posttrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.detectChanges()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName),this.cdr.detectChanges()}catch(n){console.error("Error fetching trade logs",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(oe(Vt),oe($t))};static \u0275cmp=Tt({type:t,selectors:[["app-post-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/posttradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[3,"ngClass"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Post-Trade Logs"),y(),v(8,"li",3)(9,"a",6),C(10,"Post-Trading Journal"),y()()()(),v(11,"h2"),C(12,"Post Trade Logs"),y(),ie(13,_re,2,0,"div",7)(14,Sre,2,1,"div",8)(15,Ire,2,1,"div",9)(16,Tre,2,0,"div",10),y(),ie(17,Dre,3,1,"div",11)),e&2&&(P(13),j("ngIf",r.loading),P(),j("ngIf",r.errorMessage),P(),j("ngIf",r.tradeLogs&&r.tradeLogs.length),P(),j("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),P(),j("ngIf",r.showModal))},dependencies:[hr,Qt,Po,mr,pn,es,uf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.open-trade[_ngcontent-%COMP%]{border-left:4px solid #17a2b8!important}.win-trade[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.loss-trade[_ngcontent-%COMP%]{border-left:4px solid #dc3545!important}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-open[_ngcontent-%COMP%]{background-color:#17a2b8}.status-win[_ngcontent-%COMP%]{background-color:#28a745}.status-loss[_ngcontent-%COMP%]{background-color:#dc3545}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"]})};var Nre=(t,n)=>({"alert-success":t,"alert-danger":n});function kre(t,n){if(t&1&&(v(0,"div",17),C(1),y()),t&2){let e=ee();j("ngClass",Zi(2,Nre,e.messageType==="success",e.messageType==="error")),P(),ze(" ",e.message," ")}}function Are(t,n){if(t&1){let e=it();Bs(0),v(1,"input",24),Kr("ngModelChange",function(o){ge(e);let i=ee().$implicit;return po(i.choicesInput,o)||(i.choicesInput=o),ye(o)}),le("change",function(){ge(e);let o=ee().$implicit,i=ee();return ye(i.updateChoices(o))}),y(),v(2,"div",25),C(3,'e.g., "Option A, Option B, Option C"'),y(),zs()}if(t&2){let e=ee().$implicit;P(),qr("ngModel",e.choicesInput)}}function Rre(t,n){if(t&1){let e=it();v(0,"tr")(1,"td")(2,"select",18),Kr("ngModelChange",function(o){let i=ge(e).$implicit;return po(i.question_data.question_type,o)||(i.question_data.question_type=o),ye(o)}),le("change",function(){let o=ge(e).$implicit,i=ee();return ye(i.onQuestionChange(o))}),v(3,"option",8),C(4,"Fill"),y(),v(5,"option",9),C(6,"Multiple"),y(),v(7,"option",10),C(8,"Select One"),y()()(),v(9,"td")(10,"textarea",19),Kr("ngModelChange",function(o){let i=ge(e).$implicit;return po(i.question_data.question,o)||(i.question_data.question=o),ye(o)}),le("change",function(){let o=ge(e).$implicit,i=ee();return ye(i.onQuestionChange(o))}),y()(),v(11,"td"),ie(12,Are,4,1,"ng-container",20),y(),v(13,"td")(14,"div",21)(15,"input",22),Kr("ngModelChange",function(o){let i=ge(e).$implicit;return po(i.active,o)||(i.active=o),ye(o)}),le("change",function(){let o=ge(e).$implicit,i=ee();return ye(i.onQuestionChange(o))}),y()()(),v(16,"td"),C(17),Ci(18,"date"),y(),v(19,"td")(20,"button",23),le("click",function(){let o=ge(e).$implicit,i=ee();return ye(i.deleteQuestion(o))}),C(21,"Delete"),y()()()}if(t&2){let e=n.$implicit;P(2),qr("ngModel",e.question_data.question_type),P(8),qr("ngModel",e.question_data.question),P(2),j("ngIf",e.question_data.question_type!=="fill"),P(3),qr("ngModel",e.active),P(2),ht(_i(18,5,e.updated_at,"short"))}}function Ore(t,n){if(t&1){let e=it();v(0,"div",26)(1,"input",27),Kr("ngModelChange",function(o){ge(e);let i=ee();return po(i.newQuestionChoices,o)||(i.newQuestionChoices=o),ye(o)}),y()()}if(t&2){let e=ee();P(),qr("ngModel",e.newQuestionChoices)}}var Xv=class t{constructor(n,e){this.cdr=n;this.supabaseService=e}questions=[];newQuestionText="";newQuestionType="fill";newQuestionChoices="";message="";messageType="success";async ngOnInit(){let n=await this.supabaseService.adminLoadQuestions();this.questions=n.map(e=>qe(me({},e),{choicesInput:e.question_data.choices?.join(", ")||""})),this.cdr.markForCheck()}onQuestionChange(n){n.isModified=!0}updateChoices(n){let e=n.choicesInput??"";n.question_data.choices=e.split(",").map(r=>r.trim()).filter(r=>r),n.isModified=!0}addQuestion(){if(!this.newQuestionText.trim())return;let n={question_type:this.newQuestionType,question:this.newQuestionText.trim()};if(this.newQuestionType!=="fill"){let e=this.newQuestionChoices.split(",").map(r=>r.trim()).filter(r=>r);n.choices=e}this.questions.push({question_data:n,choicesInput:this.newQuestionChoices,active:!0,isModified:!0}),this.newQuestionText="",this.newQuestionChoices="",this.newQuestionType="fill",this.cdr.detectChanges()}async saveChanges(){let{error:n}=await this.supabaseService.adminSaveQuestions(this.questions);n?this.showMessage("Error saving questions","error"):this.showMessage("Questions saved successfully","success"),this.cdr.detectChanges()}async deleteQuestion(n){if(!n.question_id){this.questions=this.questions.filter(r=>r!==n),this.showMessage("Question removed locally","success"),this.cdr.markForCheck();return}let{error:e}=await this.supabaseService.deleteQuestion(n);e?this.showMessage("Error deleting question","error"):(this.questions=this.questions.filter(r=>r.question_id!==n.question_id),this.showMessage("Question deleted successfully","success")),this.cdr.markForCheck()}showMessage(n,e){this.message=n,this.messageType=e,setTimeout(()=>{this.message="",this.cdr.markForCheck()},4e3)}hasChanges(){return this.questions.some(n=>n.isModified)}static \u0275fac=function(e){return new(e||t)(oe($t),oe(Vt))};static \u0275cmp=Tt({type:t,selectors:[["app-admin-emotion-dashboard"]],decls:40,vars:6,consts:[[1,"container","mt-4"],["class","alert",3,"ngClass",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[1,"mt-4"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","ngModel"],["value","fill"],["value","multiple"],["value","select-one"],[1,"col-md-5"],["type","text","placeholder","Enter question text",1,"form-control",3,"ngModelChange","ngModel"],["class","col-md-4",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-success",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"form-select",3,"ngModelChange","change","ngModel"],["type","text",1,"form-control",3,"ngModelChange","change","ngModel"],[4,"ngIf"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"],[1,"btn","btn-danger","btn-sm",3,"click"],["type","text","placeholder","Comma-separated choices",1,"form-control","mb-1",3,"ngModelChange","change","ngModel"],[1,"text-muted","small"],[1,"col-md-4"],["type","text","placeholder","Comma-separated choices",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,r){e&1&&(v(0,"div",0),ie(1,kre,2,5,"div",1),v(2,"h1"),C(3,"Admin Dashboard - Manage Questions"),y(),v(4,"table",2)(5,"thead")(6,"tr")(7,"th"),C(8,"Type"),y(),v(9,"th"),C(10,"Question Text"),y(),v(11,"th"),C(12,"Choices"),y(),v(13,"th"),C(14,"Active"),y(),v(15,"th"),C(16,"Last Updated"),y(),v(17,"th"),C(18,"Actions"),y()()(),v(19,"tbody"),ie(20,Rre,22,8,"tr",3),y()(),v(21,"h4",4),C(22,"Add New Question"),y(),v(23,"div",5)(24,"div",6)(25,"select",7),Kr("ngModelChange",function(i){return po(r.newQuestionType,i)||(r.newQuestionType=i),i}),v(26,"option",8),C(27,"Fill"),y(),v(28,"option",9),C(29,"Multiple"),y(),v(30,"option",10),C(31,"Select One"),y()()(),v(32,"div",11)(33,"input",12),Kr("ngModelChange",function(i){return po(r.newQuestionText,i)||(r.newQuestionText=i),i}),y()(),ie(34,Ore,2,1,"div",13),y(),v(35,"div",14)(36,"button",15),le("click",function(){return r.addQuestion()}),C(37,"Add Question"),y(),v(38,"button",16),le("click",function(){return r.saveChanges()}),C(39,"Save Changes"),y()()()),e&2&&(P(),j("ngIf",r.message),P(19),j("ngForOf",r.questions),P(5),qr("ngModel",r.newQuestionType),P(8),qr("ngModel",r.newQuestionText),P(),j("ngIf",r.newQuestionType!=="fill"),P(4),j("disabled",!r.hasChanges()))},dependencies:[lf,Go,Wo,Kn,ju,jo,yr,Gu,Qt,Po,mr,pn,es],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.question-row[_ngcontent-%COMP%]{position:relative}.delete-button[_ngcontent-%COMP%]{display:none;position:absolute;right:10px;top:50%;transform:translateY(-50%)}.question-row[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{display:block}.alert[_ngcontent-%COMP%]{padding:10px 20px;margin-bottom:15px;border-radius:4px;text-align:center}"]})};var Mre=(t,n)=>({"alert-success":t,"alert-danger":n});function Fre(t,n){if(t&1&&(v(0,"div",9),C(1),y()),t&2){let e=ee();j("ngClass",Zi(2,Mre,e.messageType==="success",e.messageType==="error")),P(),ze(" ",e.message," ")}}function Pre(t,n){if(t&1){let e=it();v(0,"textarea",14),Kr("ngModelChange",function(o){ge(e);let i=ee().$implicit;return po(i.answer,o)||(i.answer=o),ye(o)}),y()}if(t&2){let e=ee().$implicit;Ix("name",e.question_id),qr("ngModel",e.answer)}}function $re(t,n){if(t&1){let e=it();v(0,"div",17)(1,"input",18),Kr("ngModelChange",function(o){ge(e);let i=ee(2).$implicit;return po(i.answer,o)||(i.answer=o),ye(o)}),y(),v(2,"label",19),C(3),y()()}if(t&2){let e=n.$implicit,r=ee(2).$implicit;P(),Ix("name",r.question_id),j("value",e),qr("ngModel",r.answer),P(2),ht(e)}}function Lre(t,n){if(t&1&&(v(0,"div",15),ie(1,$re,4,4,"div",16),y()),t&2){let e=ee().$implicit;P(),j("ngForOf",e.question_data.choices)}}function Vre(t,n){if(t&1){let e=it();v(0,"div",21)(1,"input",22),le("change",function(){let o=ge(e).$implicit,i=ee(2).$implicit,s=ee();return ye(s.toggleMultipleChoice(i,o))}),y(),v(2,"label",19),C(3),y()()}if(t&2){let e=n.$implicit,r=ee(2).$implicit;P(),j("checked",r.multipleAnswers==null?null:r.multipleAnswers.includes(e)),P(2),ht(e)}}function Bre(t,n){if(t&1&&(v(0,"div",15),ie(1,Vre,4,2,"div",20),y()),t&2){let e=ee().$implicit;P(),j("ngForOf",e.question_data.choices)}}function zre(t,n){if(t&1&&(v(0,"div",10)(1,"label",11),C(2),y(),ie(3,Pre,1,2,"textarea",12)(4,Lre,2,1,"div",13)(5,Bre,2,1,"div",13),y()),t&2){let e=n.$implicit;P(2),ht(e.question_data.question),P(),j("ngIf",e.question_data.question_type==="fill"),P(),j("ngIf",e.question_data.question_type==="select-one"),P(),j("ngIf",e.question_data.question_type==="multiple")}}var Yv=class t{constructor(n,e,r){this.supabaseService=n;this.cdr=e;this.router=r}questions=[];message="";messageType="success";ngOnInit(){this.loadQuestions()}async loadQuestions(){let{data:n,error:e}=await this.supabaseService.getActiveQuestions();e?(console.error("Error loading questions:",e),this.message="Error loading questions.",this.messageType="error"):n&&(this.questions=n),this.cdr.markForCheck()}allQuestionsAnswered(){return this.questions.every(n=>n.question_data.question_type==="multiple"?n.multipleAnswers&&n.multipleAnswers.length>0:n.answer&&n.answer.trim().length>0)}toggleMultipleChoice(n,e){n.multipleAnswers||(n.multipleAnswers=[]);let r=n.multipleAnswers.indexOf(e);r>-1?n.multipleAnswers.splice(r,1):n.multipleAnswers.push(e)}async submitAnswers(){if(!this.allQuestionsAnswered()){this.message="Please answer all questions before submitting.",this.messageType="error",this.cdr.markForCheck();return}let n=this.supabaseService.user()?.id;if(!n){this.message="User not authenticated.",this.messageType="error",this.cdr.markForCheck();return}let e=this.questions.map(o=>({question_id:o.question_id,answer:o.question_data.question_type==="multiple"?o.multipleAnswers?.join(", ")??"":o.answer?.trim()??"",user_id:n})),{error:r}=await this.supabaseService.submitUserAnswers(e);r?(console.error("Error submitting answers:",r),this.message="Error submitting answers.",this.messageType="error"):(this.message="Answers submitted successfully. redirecting in 5 seconds.",this.messageType="success"),this.cdr.markForCheck(),setTimeout(()=>{this.router.navigateByUrl("/home")},5e3)}static \u0275fac=function(e){return new(e||t)(oe(Vt),oe($t),oe(go))};static \u0275cmp=Tt({type:t,selectors:[["app-user-emotion-questionnaire"]],decls:15,vars:3,consts:[[1,"container","mt-4","mb-5"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],["class","alert",3,"ngClass",4,"ngIf"],["class","mb-4",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-primary",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"mb-4"],[1,"form-label","fw-bold","question-label","pt-4","pb-4","ps-3","pe-3","mt-3","mb-3","col-12"],["class","form-control card-body p-3","rows","3","placeholder","Type your answer here...",3,"ngModel","name","ngModelChange",4,"ngIf"],["class","card-body p-4",4,"ngIf"],["rows","3","placeholder","Type your answer here...",1,"form-control","card-body","p-3",3,"ngModelChange","ngModel","name"],[1,"card-body","p-4"],["class","btn-radio-tr form-check",4,"ngFor","ngForOf"],[1,"btn-radio-tr","form-check"],["type","radio",1,"form-check-input","mb-2",3,"ngModelChange","name","value","ngModel"],[1,"form-check-label"],["class","btn-check-tr form-check",4,"ngFor","ngForOf"],[1,"btn-check-tr","form-check"],["type","checkbox",1,"form-check-input","mb-2",3,"change","checked"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Emotion Questions"),y()()(),ie(8,Fre,2,5,"div",6),v(9,"h1"),C(10,"User Emotion Questionnaire"),y(),v(11,"form"),ie(12,zre,6,4,"div",7),v(13,"button",8),le("click",function(){return r.submitAnswers()}),C(14," Submit Answers "),y()()()),e&2&&(P(8),j("ngIf",r.message),P(4),j("ngForOf",r.questions),P(),j("disabled",!r.allQuestionsAnswered()))},dependencies:[lf,zo,Kn,Qs,yr,Bo,Gu,YI,Qt,Po,mr,pn],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.alert[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}h1[_ngcontent-%COMP%]{margin-bottom:20px}.question-label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#333;background-color:#f0f0ff;border-radius:20px;display:inline-block}"]})};function Ure(t,n){if(t&1&&(v(0,"div",13),C(1),y()),t&2){let e=ee();P(),ze(" ",e.errorMessage," ")}}function jre(t,n){t&1&&(v(0,"div",28),C(1," A valid email is required. "),y())}function Gre(t,n){t&1&&(v(0,"div",28),C(1," Password must be at least 6 characters. "),y())}function Wre(t,n){if(t&1){let e=it();v(0,"form",14),le("ngSubmit",function(){ge(e);let o=ee();return ye(o.onSubmit())}),v(1,"div",15)(2,"label",16),C(3,"Email"),y(),U(4,"input",17),ie(5,jre,2,0,"div",18),y(),v(6,"div",15)(7,"label",19),C(8,"Password"),y(),U(9,"input",20),ie(10,Gre,2,0,"div",18),v(11,"div",21)(12,"a",22),C(13,"Forgot password?"),y()()(),v(14,"div",23)(15,"button",24),C(16,"Continue"),y()(),v(17,"div",25)(18,"p",26),C(19,"Don't have an account? "),v(20,"a",27),le("click",function(){ge(e);let o=ee();return ye(o.setActiveTab("signup"))}),C(21,"Sign up"),y()()()()}if(t&2){let e,r,o=ee();j("formGroup",o.signinForm),P(5),j("ngIf",((e=o.signinForm.get("email"))==null?null:e.invalid)&&((e=o.signinForm.get("email"))==null?null:e.touched)),P(5),j("ngIf",((r=o.signinForm.get("password"))==null?null:r.invalid)&&((r=o.signinForm.get("password"))==null?null:r.touched)),P(5),j("disabled",o.signinForm.invalid)}}function Hre(t,n){t&1&&(v(0,"small",43),C(1," First name is required "),y())}function qre(t,n){t&1&&(v(0,"small",43),C(1," Last name is required "),y())}function Kre(t,n){t&1&&(v(0,"small",43),C(1," Valid email is required "),y())}function Xre(t,n){t&1&&(v(0,"small",43),C(1," Password must be at least 6 characters "),y())}function Yre(t,n){t&1&&(v(0,"small",43),C(1," Passwords do not match "),y())}function Qre(t,n){if(t&1){let e=it();v(0,"form",14),le("ngSubmit",function(){ge(e);let o=ee();return ye(o.onSignupSubmit())}),v(1,"div",29)(2,"div",30)(3,"label",31),C(4,"First Name"),y(),U(5,"input",32),ie(6,Hre,2,0,"small",33),y(),v(7,"div",30)(8,"label",34),C(9,"Last Name"),y(),U(10,"input",35),ie(11,qre,2,0,"small",33),y()(),v(12,"div",15)(13,"label",36),C(14,"Email"),y(),U(15,"input",37),ie(16,Kre,2,0,"small",33),y(),v(17,"div",15)(18,"label",38),C(19,"Password"),y(),U(20,"input",39),ie(21,Xre,2,0,"small",33),y(),v(22,"div",15)(23,"label",40),C(24,"Confirm Password"),y(),U(25,"input",41),ie(26,Yre,2,0,"small",33),y(),v(27,"div",23)(28,"button",24),C(29,"Create Account"),y()(),v(30,"div",25)(31,"p",26),C(32,"Already have an account? "),v(33,"a",42),le("click",function(){ge(e);let o=ee();return ye(o.setActiveTab("login"))}),C(34,"Login"),y()()()()}if(t&2){let e,r,o,i,s,a=ee();j("formGroup",a.signupForm),P(6),j("ngIf",((e=a.signupForm.get("firstname"))==null?null:e.invalid)&&((e=a.signupForm.get("firstname"))==null?null:e.touched)),P(5),j("ngIf",((r=a.signupForm.get("lastname"))==null?null:r.invalid)&&((r=a.signupForm.get("lastname"))==null?null:r.touched)),P(5),j("ngIf",((o=a.signupForm.get("email"))==null?null:o.invalid)&&((o=a.signupForm.get("email"))==null?null:o.touched)),P(5),j("ngIf",((i=a.signupForm.get("password"))==null?null:i.invalid)&&((i=a.signupForm.get("password"))==null?null:i.touched)),P(5),j("ngIf",a.signupForm.hasError("mismatch")&&((s=a.signupForm.get("confirmPassword"))==null?null:s.touched)),P(2),j("disabled",a.signupForm.invalid)}}var Qv=class t{constructor(n,e,r,o){this.fb=n;this.router=e;this.route=r;this.supabaseService=o;this.signinForm=this.fb.group({email:["",[_e.required,_e.email]],password:["",[_e.required,_e.minLength(6)]]}),this.signupForm=this.fb.group({firstname:["",_e.required],lastname:["",_e.required],email:["",[_e.required,_e.email]],password:["",[_e.required,_e.minLength(6)]],confirmPassword:["",_e.required]},{validators:this.passwordMatchValidator})}activeTab="login";signinForm;signupForm;errorMessage=null;ngOnInit(){this.route.queryParams.subscribe(n=>{n.mode==="signup"&&(this.activeTab="signup")})}passwordMatchValidator(n){let e=n.get("password")?.value,r=n.get("confirmPassword")?.value;return e===r?null:{mismatch:!0}}setActiveTab(n){this.activeTab=n,this.errorMessage=null}async onSubmit(){if(this.signinForm.invalid){this.signinForm.markAllAsTouched();return}let{email:n,password:e}=this.signinForm.getRawValue();try{if(await this.supabaseService.signIn(n,e),!this.supabaseService.currentUsername()){this.errorMessage="Login failed. Please try again.";return}this.signinForm.reset();let r=this.route.snapshot.queryParams.returnUrl||"/home";this.router.navigateByUrl(r)}catch(r){this.errorMessage=r.message||"An unexpected error occurred."}}onSignupSubmit(){if(this.signupForm.invalid){this.signupForm.markAllAsTouched();return}let{email:n,password:e,firstname:r,lastname:o}=this.signupForm.getRawValue();this.supabaseService.signUp(n,e,r,o).then(()=>{this.signupForm.reset(),this.router.navigateByUrl("/home")}).catch(i=>{this.errorMessage=i.message||"An unexpected error occurred.",console.error(i)})}static \u0275fac=function(e){return new(e||t)(oe(os),oe(go),oe(Ii),oe(Vt))};static \u0275cmp=Tt({type:t,selectors:[["app-login-signup"]],decls:20,vars:7,consts:[[1,"auth-container"],[1,"auth-card"],[1,"text-center","mb-4"],[1,"logo-circle","mx-auto"],["src","/trading-rehab-logo.png","alt","Logo",1,"img-fluid"],[1,"brand-name","mt-3"],[1,"brand-tagline"],[1,"auth-tabs","d-flex","justify-content-center","mb-4"],[1,"tabs-container"],[1,"tab",3,"click"],[1,"mx-2","tab-separator"],["class","alert alert-danger mb-3",4,"ngIf"],["class","auth-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"alert","alert-danger","mb-3"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Enter your email",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Enter your password",1,"form-control"],[1,"d-flex","justify-content-end","mt-2"],["href","#",1,"forgot-link"],[1,"d-grid","gap-2","mt-4"],["type","submit",1,"btn","btn-tr","btn-primary","btn-md",3,"disabled"],[1,"text-center","mt-4"],[1,"mb-0"],["href","javascript:void(0)",1,"signup-link",3,"click"],[1,"text-danger","small","mt-1"],[1,"row"],[1,"col-md-6","mb-3"],["for","firstname",1,"form-label"],["type","text","id","firstname","formControlName","firstname","placeholder","First name",1,"form-control"],["class","text-danger",4,"ngIf"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","placeholder","Last name",1,"form-control"],["for","signup-email",1,"form-label"],["type","email","id","signup-email","formControlName","email","placeholder","Enter your email",1,"form-control"],["for","signup-password",1,"form-label"],["type","password","id","signup-password","formControlName","password","placeholder","Create a password",1,"form-control"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm your password",1,"form-control"],["href","javascript:void(0)",1,"login-link",3,"click"],[1,"text-danger"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),U(4,"img",4),y(),v(5,"h2",5),C(6,"TRADING REHAB"),y(),v(7,"p",6),C(8,"Where Disciplined Trading Begins"),y()(),v(9,"div",7)(10,"div",8)(11,"span",9),le("click",function(){return r.setActiveTab("login")}),C(12,"Login"),y(),v(13,"span",10),C(14,"\u2022"),y(),v(15,"span",9),le("click",function(){return r.setActiveTab("signup")}),C(16,"Sign Up"),y()()(),ie(17,Ure,2,1,"div",11)(18,Wre,22,4,"form",12)(19,Qre,35,7,"form",12),y()()),e&2&&(P(11),Qi("active",r.activeTab==="login"),P(4),Qi("active",r.activeTab==="signup"),P(2),j("ngIf",r.errorMessage),P(),j("ngIf",r.activeTab==="login"),P(),j("ngIf",r.activeTab==="signup"))},dependencies:[Qt,pn,Ho,zo,Kn,yr,Bo,Uo,Di],styles:['.auth-container[_ngcontent-%COMP%]{min-height:100vh;background:conic-gradient(#eaeafd,#9c9ce4,#eaeafd);display:flex;align-items:center;justify-content:center}.auth-card[_ngcontent-%COMP%]{background-color:transparent;border-radius:12px;width:100%;max-width:450px;padding:30px}.logo-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:transparent;position:relative;display:flex;align-items:center;justify-content:center;margin:0 auto}.dots-circle[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;position:relative;background-image:radial-gradient(circle,#5046e5 3px,transparent 3px);background-size:15px 15px;transform:rotate(45deg)}.brand-name[_ngcontent-%COMP%]{font-weight:700;font-size:24px;margin-bottom:5px;letter-spacing:.5px}.brand-tagline[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.tabs-container[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-bottom:1px solid #eee;padding-bottom:5px}.tab[_ngcontent-%COMP%]{padding:8px 15px;cursor:pointer;color:#888;font-weight:500;font-size:16px;transition:color .2s}.tab.active[_ngcontent-%COMP%]{color:#5046e5;border-bottom:2px solid #5046e5}.tab-separator[_ngcontent-%COMP%]{color:#ccc}.auth-form[_ngcontent-%COMP%]{margin-top:10px}.form-control[_ngcontent-%COMP%]{height:auto;padding:12px 15px;border-radius:8px;border:1px solid #ddd;transition:border-color .2s,box-shadow .2s}.form-control[_ngcontent-%COMP%]:focus{border-color:#5046e5;box-shadow:0 0 0 .2rem #5046e526}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#555;margin-bottom:8px}.forgot-link[_ngcontent-%COMP%]{font-size:14px;color:#5046e5;text-decoration:none}.forgot-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.signup-link[_ngcontent-%COMP%], .login-link[_ngcontent-%COMP%]{color:#5046e5;font-weight:500;text-decoration:none}.signup-link[_ngcontent-%COMP%]:hover, .login-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn-primary[_ngcontent-%COMP%]{background-color:#5046e5;border-color:#5046e5;padding:12px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover, .btn-primary[_ngcontent-%COMP%]:focus{background-color:#4238d0;border-color:#4238d0}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#a8a4e0;border-color:#a8a4e0}.separator[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#888;font-size:14px}.separator[_ngcontent-%COMP%]:before, .separator[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #ddd}.separator[_ngcontent-%COMP%]:before{margin-right:1em}.separator[_ngcontent-%COMP%]:after{margin-left:1em}.google-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#fff;border:1px solid #ddd;color:#333;padding:12px;font-weight:500}.google-btn[_ngcontent-%COMP%]:hover{background-color:#f8f8f8;color:#333}@media (max-width: 576px){.auth-card[_ngcontent-%COMP%]{padding:20px 15px}.brand-name[_ngcontent-%COMP%]{font-size:20px}.form-control[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{padding:10px}}']})};var f$=(t,n)=>({"btn-tr text-dark":t,"btn-tr":n}),Zre=(t,n)=>({"btn-tr  text-dark":t,"btn-tr  btn-outline-primary":n});function Jre(t,n){if(t&1){let e=it();v(0,"button",15),le("click",function(){let o;ge(e);let i=ee();return ye((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Executing"))}),U(1,"i",75),C(2," Executing "),y()}if(t&2){let e,r=ee();j("ngClass",Zi(1,f$,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Executing",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Executing"))}}function eoe(t,n){if(t&1){let e=it();v(0,"button",15),le("click",function(){let o;ge(e);let i=ee();return ye((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Completed"))}),U(1,"i",76),C(2," Completed "),y()}if(t&2){let e,r=ee();j("ngClass",Zi(1,Zre,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Completed",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Completed"))}}function toe(t,n){if(t&1){let e=it();v(0,"div",82)(1,"button",83),le("click",function(){let o=ge(e).index,i=ee(2);return ye(i.removePlannedTrade(o))}),U(2,"i",84),y(),v(3,"h6",85),C(4),y(),v(5,"div",24)(6,"div",86)(7,"label",87),C(8,"Direction"),y(),v(9,"div",88),U(10,"input",89),v(11,"label",90),C(12,"Long"),y(),U(13,"input",91),v(14,"label",92),C(15,"Short"),y()()(),v(16,"div",86)(17,"label",87),C(18,"Entry Price"),y(),v(19,"div",27)(20,"span",28),C(21,"$"),y(),U(22,"input",93),y()(),v(23,"div",86)(24,"label",87),C(25,"Stop Loss"),y(),v(26,"div",27)(27,"span",28),C(28,"$"),y(),U(29,"input",94),y()(),v(30,"div",86)(31,"label",87),C(32,"Exit Price"),y(),v(33,"div",27)(34,"span",28),C(35,"$"),y(),U(36,"input",95),y()(),v(37,"div",25)(38,"label",87),C(39,"Planned Entry Time"),y(),U(40,"input",96),y(),v(41,"div",25)(42,"label",87),C(43,"Planned Exit Time"),y(),U(44,"input",97),y(),v(45,"div",25)(46,"label",87),C(47,"Exit Type"),y(),v(48,"select",98)(49,"option",33),C(50,"Select exit type"),y(),v(51,"option",99),C(52,"Target"),y(),v(53,"option",100),C(54,"Stop Loss"),y(),v(55,"option",101),C(56,"Manual"),y()()(),v(57,"div",25)(58,"label",87),C(59,"Position Size ($)"),y(),v(60,"div",27)(61,"span",28),C(62,"$"),y(),U(63,"input",102),y()(),v(64,"div",25)(65,"label",87),C(66,"Contracts/Shares"),y(),U(67,"input",103),y(),v(68,"div",25)(69,"label",87),C(70,"Multiplier"),y(),U(71,"input",104),y()(),v(72,"div",105)(73,"div",106),U(74,"div",107),y()()()}if(t&2){let e=n.index;j("formGroupName",e),P(4),ze("Planned Trade #",e+1,""),P(6),j("id","direction_long_"+e),P(),j("for","direction_long_"+e),P(2),j("id","direction_short_"+e),P(),j("for","direction_short_"+e)}}function noe(t,n){if(t&1){let e=it();v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",77),C(4,"Planned Trades "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",78),ie(9,toe,75,6,"div",79),v(10,"button",80),le("click",function(){ge(e);let o=ee();return ye(o.addPlannedTrade())}),U(11,"i",81),C(12,"Add Planned Trade "),y()()()()}if(t&2){let e=ee();P(9),j("ngForOf",e.plannedTrades.controls)}}function roe(t,n){if(t&1){let e=it();v(0,"div",82)(1,"button",83),le("click",function(){let o=ge(e).index,i=ee(2);return ye(i.removeExecutingTrade(o))}),U(2,"i",84),y(),v(3,"h6",85),C(4),y(),v(5,"div",24)(6,"div",86)(7,"label",87),C(8,"Direction"),y(),v(9,"div",88),U(10,"input",89),v(11,"label",90),C(12,"Long"),y(),U(13,"input",91),v(14,"label",92),C(15,"Short"),y()()(),v(16,"div",86)(17,"label",87),C(18,"Entry Price"),y(),v(19,"div",27)(20,"span",28),C(21,"$"),y(),U(22,"input",93),y()(),v(23,"div",86)(24,"label",87),C(25,"Stop Loss"),y(),v(26,"div",27)(27,"span",28),C(28,"$"),y(),U(29,"input",94),y()(),v(30,"div",86)(31,"label",87),C(32,"Exit Price"),y(),v(33,"div",27)(34,"span",28),C(35,"$"),y(),U(36,"input",95),y()(),v(37,"div",25)(38,"label",87),C(39,"Entry Time"),y(),U(40,"input",96),y(),v(41,"div",25)(42,"label",87),C(43,"Exit Time"),y(),U(44,"input",97),y(),v(45,"div",25)(46,"label",87),C(47,"Exit Type"),y(),v(48,"select",98)(49,"option",33),C(50,"Select exit type"),y(),v(51,"option",99),C(52,"Target"),y(),v(53,"option",100),C(54,"Stop Loss"),y(),v(55,"option",101),C(56,"Manual"),y()()(),v(57,"div",25)(58,"label",87),C(59,"Position Size ($)"),y(),v(60,"div",27)(61,"span",28),C(62,"$"),y(),U(63,"input",102),y()(),v(64,"div",25)(65,"label",87),C(66,"Contracts/Shares"),y(),U(67,"input",103),y(),v(68,"div",25)(69,"label",87),C(70,"Multiplier"),y(),U(71,"input",104),y()()()}if(t&2){let e=n.index;j("formGroupName",e),P(4),ze("Trade Execution #",e+1,""),P(6),j("id","exec_direction_long_"+e),P(),j("for","exec_direction_long_"+e),P(2),j("id","exec_direction_short_"+e),P(),j("for","exec_direction_short_"+e)}}function ooe(t,n){if(t&1){let e=it();v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",77),C(4,"Executing Trades "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",108),ie(9,roe,72,6,"div",79),v(10,"button",80),le("click",function(){ge(e);let o=ee();return ye(o.addExecutingTrade())}),U(11,"i",81),C(12,"Add Executing Trade "),y()()()()}if(t&2){let e=ee();P(9),j("ngForOf",e.executingTrades.controls)}}function ioe(t,n){t&1&&(v(0,"div",64),U(1,"i",135),v(2,"span",136),C(3," Consider if this emotional state might negatively impact your decision making"),y()())}function soe(t,n){if(t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",109),C(4,"Emotional Analysis "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",110)(9,"div",24)(10,"div",39)(11,"label",111),C(12,"Emotional State"),y(),v(13,"select",112)(14,"option",33),C(15,"How are you feeling?"),y(),v(16,"option",113),C(17,"Calm & Focused"),y(),v(18,"option",114),C(19,"Excited"),y(),v(20,"option",115),C(21,"Anxious"),y(),v(22,"option",116),C(23,"Frustrated"),y(),v(24,"option",117),C(25,"Overconfident"),y(),v(26,"option",118),C(27,"Fearful"),y(),v(28,"option",119),C(29,"Neutral"),y(),v(30,"option",38),C(31,"Other"),y()(),ie(32,ioe,4,0,"div",120),y(),v(33,"div",39)(34,"label",121),C(35,"Trade Confidence"),y(),v(36,"div",88),U(37,"input",122),v(38,"label",123),C(39,"1"),y(),U(40,"input",124),v(41,"label",125),C(42,"2"),y(),U(43,"input",126),v(44,"label",127),C(45,"3"),y(),U(46,"input",128),v(47,"label",129),C(48,"4"),y(),U(49,"input",130),v(50,"label",131),C(51,"5"),y()(),v(52,"div",132),C(53,"Low (1) to High (5)"),y()()(),v(54,"div",55)(55,"label",133),C(56,"Reflection"),y(),U(57,"textarea",134),y()()()()),t&2){let e=ee();P(32),j("ngIf",e.isNegativeEmotionalState())}}function aoe(t,n){t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",109),C(4,"Profit Analysis "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",24)(9,"div",25)(10,"label",137),C(11,"Realized Profit"),y(),v(12,"div",27)(13,"span",28),C(14,"$"),y(),U(15,"input",138),y()(),v(16,"div",25)(17,"label",139),C(18,"Unrealized Profit"),y(),v(19,"div",27)(20,"span",28),C(21,"$"),y(),U(22,"input",140),y()(),v(23,"div",25)(24,"label",141),C(25,"Total Profit"),y(),v(26,"div",27)(27,"span",28),C(28,"$"),y(),U(29,"input",142),y()()()()())}function loe(t,n){t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),U(3,"i",143),C(4,"Post-Trade Reflection "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",144)(9,"div",24)(10,"div",39)(11,"label",145),C(12,"Emotional State"),y(),v(13,"select",146)(14,"option",33),C(15,"How are you feeling?"),y(),v(16,"option",147),C(17,"Satisfied"),y(),v(18,"option",114),C(19,"Excited"),y(),v(20,"option",148),C(21,"Disappointed"),y(),v(22,"option",116),C(23,"Frustrated"),y(),v(24,"option",117),C(25,"Overconfident"),y(),v(26,"option",119),C(27,"Neutral"),y(),v(28,"option",38),C(29,"Other"),y()()(),v(30,"div",39)(31,"label",149),C(32,"Trade Confidence for Next Time"),y(),v(33,"div",88),U(34,"input",150),v(35,"label",151),C(36,"1"),y(),U(37,"input",152),v(38,"label",153),C(39,"2"),y(),U(40,"input",154),v(41,"label",155),C(42,"3"),y(),U(43,"input",156),v(44,"label",157),C(45,"4"),y(),U(46,"input",158),v(47,"label",159),C(48,"5"),y()(),v(49,"div",132),C(50,"Low (1) to High (5)"),y()()(),v(51,"div",55)(52,"label",160),C(53,"Trade Reflection"),y(),U(54,"textarea",161),y()()()())}var df=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabase=r}tradeData;mode="create";tradeAccountId;formSubmitted=new jt;cancel=new jt;tradeForm;tableName="tradejournal";trade_account_id;ngOnInit(){this.trade_account_id=this.tradeAccountId??"",this.initForm()}ngOnChanges(n){n.tradeAccountId&&(this.trade_account_id=n.tradeAccountId.currentValue),n.tradeData&&!n.tradeData.firstChange&&(this.populateForm(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)}),this.tradeData&&(this.mode="edit"))}initForm(){let n=this.mode==="create"?Wu():this.tradeData?.tradeid;this.tradeForm=this.fb.group({tradeid:n,userid:this.supabase.user()?.id,updated_time:[""],trade_symbol:["",_e.required],trade_analysis:[""],trade_instrument:[""],type_of_order:[""],market_condition:[""],trade_status:["Planned"],strategy_name:[""],entry_criteria:[""],exit_criteria:[""],planned_trade:this.fb.array([]),executing_trades:this.fb.array([]),realized_profit:[0,_e.required],unrealized_profit:[0,_e.required],planned_profit:[0,_e.required],emotion_before:this.fb.group({emotional_state_before:[""],trade_confidence_before:[""],reflection_before:[""]}),emotion_after:this.fb.group({emotional_state_after:[""],trade_confidence_after:[""],reflection_after:[""]}),notes:[""],trade_account_id:this.trade_account_id}),this.tradeForm.get("trade_status")?.valueChanges.subscribe(e=>{this.handleStatusChange(e)}),this.handleStatusChange("Planned"),this.tradeData&&(this.populateForm(),this.mode="edit")}get plannedTrades(){return this.tradeForm.get("planned_trade")}get executingTrades(){return this.tradeForm.get("executing_trades")}newTradeGroup(n=!1){let e={entry_price:[""],exit_price:[""],stop_loss:[""],trade_direction:[""],entry_time:[""],exit_time:[""],exit:[""],position_size:[""],contracts:[""],contract_multiplier:[""]};return n&&(e.profit=[""]),this.fb.group(e)}addPlannedTrade(){this.plannedTrades.push(this.newTradeGroup())}removePlannedTrade(n){this.plannedTrades.removeAt(n)}addExecutingTrade(){this.executingTrades.push(this.newTradeGroup(!0))}removeExecutingTrade(n){this.executingTrades.removeAt(n)}populateForm(){this.tradeData&&(this.tradeForm.patchValue(this.tradeData),this.plannedTrades.clear(),this.executingTrades.clear(),this.tradeData.planned_trade?.forEach(n=>{this.plannedTrades.push(this.fb.group(n))}),this.tradeData.executing_trades?.forEach(n=>{this.executingTrades.push(this.fb.group(n))}),this.handleStatusChange(this.tradeData.trade_status))}handleStatusChange(n){let e=this.tradeForm.get("emotion_after"),r=this.tradeForm.get("emotion_before");n==="Planned"?(this.executingTrades.disable(),e.disable(),r.enable()):n==="Executing"?(this.executingTrades.enable(),e.disable(),r.enable(),this.executingTrades.length===0&&this.plannedTrades.length>0&&this.plannedTrades.controls.forEach(o=>{this.executingTrades.push(this.fb.group(o.value))})):n==="Completed"&&(this.executingTrades.enable(),e.enable(),r.disable()),this.cdr.markForCheck(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)})}async onSubmit(){if(this.tradeForm.valid){this.tradeForm.patchValue({updated_time:new Date().toISOString()});let n=this.tradeForm.getRawValue();try{this.mode==="create"?await this.supabase.addTradeLogOfSelectedAccount(n,this.tableName,this.tradeAccountId):this.mode==="edit"&&await this.supabase.updateTradeLogOfSelectedAccount(n,this.tableName,this.tradeAccountId),this.formSubmitted.emit()}catch(e){console.error("Error submitting trade:",e)}}else console.log("Invalid form")}onCancel(){this.cancel.emit()}isNegativeEmotionalState(){let n=this.tradeData?this.tradeData.emotion_before:"calm";return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}static \u0275fac=function(e){return new(e||t)(oe(os),oe($t),oe(Vt))};static \u0275cmp=Tt({type:t,selectors:[["app-individual-trade"]],inputs:{tradeData:"tradeData",mode:"mode",tradeAccountId:"tradeAccountId"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},features:[vi],decls:147,vars:14,consts:[[1,"container","my-4"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["routerLink","/tradejournal",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"needs-validation",3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","d-block","mb-2"],["role","group","aria-label","Trade status toggle",1,"btn-group","w-100","shadow-sm"],["type","button",1,"btn",3,"click","ngClass"],[1,"bi","bi-hourglass","me-1"],["type","button","class","btn",3,"ngClass","click",4,"ngIf"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],["for","trade_symbol",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-tag"],["type","text","id","trade_symbol","formControlName","trade_symbol","placeholder","Enter ticker symbol",1,"form-control"],["for","trade_analysis",1,"form-label"],["id","trade_analysis","formControlName","trade_analysis",1,"form-select"],["value","","selected","","disabled",""],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["value","Other"],[1,"col-md-6"],["for","trade_instrument",1,"form-label"],["id","trade_instrument","formControlName","trade_instrument",1,"form-select"],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["for","type_of_order",1,"form-label"],["id","type_of_order","formControlName","type_of_order",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","market_condition",1,"form-label"],["id","market_condition","rows","3","formControlName","market_condition","placeholder","Describe current market conditions and relevant factors",1,"form-control"],[1,"bi","bi-2-circle","me-2"],[1,"card-body","col-12"],["for","strategy_name",1,"form-label"],["type","text","id","strategy_name","formControlName","strategy_name","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","entry_criteria",1,"form-label"],["id","entry_criteria","rows","4","formControlName","entry_criteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)",1,"form-control"],[1,"form-text"],["for","exit_criteria",1,"form-label"],["id","exit_criteria","rows","4","formControlName","exit_criteria","placeholder","Define your profit targets and stop loss levels",1,"form-control"],["class","card mb-4 shadow-sm",4,"ngIf"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],[1,"p-3"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-tr","me-2","mt-3",3,"click"],["type","submit",1,"btn","btn-primary","btn-tr","mt-3"],[1,"bi","bi-play-fill","me-1"],[1,"bi","bi-check-circle","me-1"],[1,"bi","bi-3-circle","me-2"],["formArrayName","planned_trade"],["class","border rounded p-3 mb-3 position-relative",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-outline-primary","w-100",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"border","rounded","p-3","mb-3","position-relative",3,"formGroupName"],["type","button",1,"btn","btn-sm","btn-danger","position-absolute","end-0","top-0","m-2",3,"click"],[1,"bi","bi-x"],[1,"mb-3"],[1,"col-md-3"],[1,"form-label"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","trade_direction","value","Long",1,"btn-check",3,"id"],[1,"btn","btn-outline-success",3,"for"],["type","radio","formControlName","trade_direction","value","Short",1,"btn-check",3,"id"],[1,"btn","btn-outline-danger",3,"for"],["type","number","step","0.01","placeholder","Entry Price","formControlName","entry_price",1,"form-control"],["type","number","step","0.01","placeholder","Stop Loss","formControlName","stop_loss",1,"form-control"],["type","number","step","0.01","placeholder","Exit Price","formControlName","exit_price",1,"form-control"],["type","datetime-local","formControlName","entry_time",1,"form-control"],["type","datetime-local","formControlName","exit_time",1,"form-control"],["formControlName","exit",1,"form-select"],["value","Target"],["value","StopLoss"],["value","Manual"],["type","number","step","0.01","placeholder","Position Size","formControlName","position_size",1,"form-control"],["type","number","placeholder","Contracts","formControlName","contracts",1,"form-control"],["type","number","step","0.01","placeholder","Multiplier","formControlName","contract_multiplier",1,"form-control"],[1,"mt-3"],[1,"progress",2,"height","5px"],["role","progressbar",1,"progress-bar",2,"width","100%"],["formArrayName","executing_trades"],[1,"bi","bi-4-circle","me-2"],["formGroupName","emotion_before"],["for","emotional_state_before",1,"form-label"],["id","emotional_state_before","formControlName","emotional_state_before",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],["class","form-text",4,"ngIf"],["for","trade_confidence_before",1,"form-label"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_1","value","1",1,"btn-check"],["for","confidence_before_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_2","value","2",1,"btn-check"],["for","confidence_before_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_3","value","3",1,"btn-check"],["for","confidence_before_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_4","value","4",1,"btn-check"],["for","confidence_before_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_5","value","5",1,"btn-check"],["for","confidence_before_5",1,"btn","btn-outline-success"],[1,"form-text","text-center"],["for","reflection_before",1,"form-label"],["id","reflection_before","formControlName","reflection_before","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO)","rows","2",1,"form-control"],[1,"bi","bi-exclamation-triangle","text-warning"],[1,"text-warning"],["for","realized_profit",1,"form-label"],["type","number","step","0.01","id","realized_profit","formControlName","realized_profit",1,"form-control"],["for","unrealized_profit",1,"form-label"],["type","number","step","0.01","id","unrealized_profit","formControlName","unrealized_profit",1,"form-control"],["for","planned_profit",1,"form-label"],["type","number","step","0.01","id","planned_profit","formControlName","planned_profit",1,"form-control"],[1,"bi","bi-5-circle","me-2"],["formGroupName","emotion_after"],["for","emotional_state_after",1,"form-label"],["id","emotional_state_after","formControlName","emotional_state_after",1,"form-select"],["value","Satisfied"],["value","Disappointed"],["for","trade_confidence_after",1,"form-label"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_1","value","1",1,"btn-check"],["for","confidence_after_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_2","value","2",1,"btn-check"],["for","confidence_after_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_3","value","3",1,"btn-check"],["for","confidence_after_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_4","value","4",1,"btn-check"],["for","confidence_after_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_5","value","5",1,"btn-check"],["for","confidence_after_5",1,"btn","btn-outline-success"],["for","reflection_after",1,"form-label"],["id","reflection_after","formControlName","reflection_after","placeholder","What did you learn? What could be improved?","rows","2",1,"form-control"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),C(8,"Trade Logs"),y()(),v(9,"li",6),C(10,"Trade Form"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),C(14),y(),v(15,"p",10),C(16,"Document your trading strategy and execution to maintain discipline and improve performance"),y()()(),v(17,"form",11),le("ngSubmit",function(){return r.onSubmit()}),v(18,"div",12)(19,"label",13),C(20,"Trade Status"),y(),v(21,"div",14)(22,"button",15),le("click",function(){let i;return(i=r.tradeForm.get("trade_status"))==null?null:i.setValue("Planned")}),U(23,"i",16),C(24," Planned "),y(),ie(25,Jre,3,4,"button",17)(26,eoe,3,4,"button",17),y()(),v(27,"div",18)(28,"div",19)(29,"h5",20),U(30,"i",21),C(31,"Trade Setup "),y(),v(32,"span",22),C(33,"Required"),y()(),v(34,"div",23)(35,"div",24)(36,"div",25)(37,"label",26),C(38,"Trade Symbol"),y(),v(39,"div",27)(40,"span",28),U(41,"i",29),y(),U(42,"input",30),y()(),v(43,"div",25)(44,"label",31),C(45,"Trade Analysis"),y(),v(46,"select",32)(47,"option",33),C(48,"Choose analysis method"),y(),v(49,"option",34),C(50,"Technical"),y(),v(51,"option",35),C(52,"Fundamental"),y(),v(53,"option",36),C(54,"Both"),y(),v(55,"option",37),C(56,"Sentiment"),y(),v(57,"option",38),C(58,"Other"),y()()(),v(59,"div",39)(60,"label",40),C(61,"Trade Instrument"),y(),v(62,"select",41)(63,"option",33),C(64,"Choose instrument type"),y(),v(65,"option",42),C(66,"Forex"),y(),v(67,"option",43),C(68,"Stocks"),y(),v(69,"option",44),C(70,"Futures"),y(),v(71,"option",45),C(72,"Crypto"),y(),v(73,"option",46),C(74,"Options"),y(),v(75,"option",47),C(76,"ETF"),y(),v(77,"option",38),C(78,"Other"),y()()(),v(79,"div",39)(80,"label",48),C(81,"Type of Order"),y(),v(82,"select",49)(83,"option",33),C(84,"Choose order type"),y(),v(85,"option",50),C(86,"Market"),y(),v(87,"option",51),C(88,"Limit"),y(),v(89,"option",52),C(90,"Stop"),y(),v(91,"option",53),C(92,"Stop Limit"),y(),v(93,"option",54),C(94,"Trailing Stop"),y()()(),v(95,"div",55)(96,"label",56),C(97,"Market Condition"),y(),U(98,"textarea",57),y()()()(),v(99,"div",18)(100,"div",19)(101,"h5",20),U(102,"i",58),C(103,"Trade Strategy "),y(),v(104,"span",22),C(105,"Required"),y()(),v(106,"div",59)(107,"label",60),C(108,"Strategy Name"),y(),U(109,"input",61),y(),v(110,"div",23)(111,"div",24)(112,"div",39)(113,"label",62),C(114,"Entry Criteria "),v(115,"span",10),C(116,"(Why are you taking this trade?)"),y()(),U(117,"textarea",63),v(118,"div",64),C(119,"Be specific about what signals or conditions must be met for entry."),y()(),v(120,"div",39)(121,"label",65),C(122,"Exit Criteria "),v(123,"span",10),C(124,"(How will you close this position?)"),y()(),U(125,"textarea",66),v(126,"div",64),C(127,"Include both profit-taking and loss-cutting criteria."),y()()()()(),ie(128,noe,13,1,"div",67)(129,ooe,13,1,"div",67)(130,soe,58,1,"div",67)(131,aoe,30,0,"div",67)(132,loe,55,0,"div",67),v(133,"div",18)(134,"div",19)(135,"h5",20),U(136,"i",68),C(137,"Additional Notes "),y(),v(138,"span",69),C(139,"Optional"),y()(),v(140,"div",70),U(141,"textarea",71),y()(),v(142,"div",72)(143,"button",73),le("click",function(){return r.onCancel()}),C(144,"Cancel"),y(),v(145,"button",74),C(146),y()()()()),e&2){let o,i,s,a,l,c;P(14),ht(r.mode==="edit"?"Edit Trade":"Create Trade"),P(3),j("formGroup",r.tradeForm),P(5),j("ngClass",Zi(11,f$,((o=r.tradeForm.get("trade_status"))==null?null:o.value)==="Planned",((o=r.tradeForm.get("trade_status"))==null?null:o.value)!=="Planned")),P(3),j("ngIf",r.mode==="edit"),P(),j("ngIf",r.mode==="edit"),P(102),j("ngIf",((i=r.tradeForm.get("trade_status"))==null?null:i.value)==="Planned"),P(),j("ngIf",((s=r.tradeForm.get("trade_status"))==null?null:s.value)!=="Planned"),P(),j("ngIf",((a=r.tradeForm.get("trade_status"))==null?null:a.value)!=="Completed"),P(),j("ngIf",((l=r.tradeForm.get("trade_status"))==null?null:l.value)==="Completed"),P(),j("ngIf",((c=r.tradeForm.get("trade_status"))==null?null:c.value)==="Completed"),P(14),ze(" ",r.mode==="edit"?"Update Trade":"Save Trade"," ")}},dependencies:[Qt,Po,mr,pn,Ho,zo,Go,Wo,Kn,Ys,jo,Qs,yr,Bo,Uo,Di,Wv,Hv,hr],encapsulation:2})};var coe=(t,n,e)=>({"status-planned-card":t,"status-executing-card":n,"status-completed-card":e}),uoe=(t,n,e)=>({"status-planned":t,"status-executing":n,"status-completed":e});function doe(t,n){if(t&1&&(v(0,"option",18),C(1),y()),t&2){let e=n.$implicit,r=ee();j("value",e.account_id)("selected",e.account_id===r.tradeAccountId),P(),ze(" ",e.account_name," ")}}function poe(t,n){t&1&&(v(0,"div",19),C(1,"Loading trade logs..."),y())}function foe(t,n){if(t&1&&(v(0,"div",20),C(1),y()),t&2){let e=ee();P(),ht(e.errorMessage)}}function moe(t,n){if(t&1){let e=it();Bs(0),v(1,"div",27)(2,"div",28),le("click",function(){ge(e);let o=ee().$implicit,i=ee(3);return ye(i.openEditModal(o))}),v(3,"div",29),U(4,"i",30),C(5),y(),v(6,"div",31),le("click",function(o){ge(e);let i=ee().$implicit,s=ee(3);return ye(s.onDeleteTradeLog(i,o))}),U(7,"i",32),y(),v(8,"div",33)(9,"h4",34),C(10),y(),v(11,"h5",35),C(12),y(),v(13,"div",36)(14,"div",37)(15,"strong"),C(16,"Account Name:"),y(),C(17),y(),v(18,"div",37)(19,"strong"),C(20,"Analysis:"),y(),C(21),y(),v(22,"div",37)(23,"strong"),C(24,"Profit:"),y(),C(25),y()(),v(26,"div",38)(27,"small",39),C(28),Ci(29,"date"),y()()()()(),zs()}if(t&2){let e=ee().$implicit;P(2),j("ngClass",Tl(15,coe,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),P(),j("ngClass",Tl(19,uoe,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),P(2),ze(" ",e.trade_status," "),P(5),ht(e.trade_symbol),P(2),Tu(" ",e.trade_instrument," | ",e.type_of_order," "),P(5),ze(" ",e.account_name," "),P(4),ze(" ",e.trade_analysis," "),P(4),Ch(" Realized: ",e.realized_profit," | Unrealized: ",e.unrealized_profit," | Planned: ",e.planned_profit," "),P(3),ze("Last modified: ",_i(29,12,e.updated_time,"medium"),"")}}function hoe(t,n){if(t&1&&(Bs(0),ie(1,moe,30,23,"ng-container",26),zs()),t&2){let e=n.$implicit,r=ee().$implicit;P(),j("ngIf",e.trade_status===r.status)}}function goe(t,n){if(t&1&&(v(0,"div",23)(1,"h3"),C(2),y(),v(3,"div",24),ie(4,hoe,2,1,"ng-container",25),y()()),t&2){let e=n.$implicit,r=ee(2);P(2),ht(e.title),P(2),j("ngForOf",r.tradeLogs)}}function yoe(t,n){if(t&1&&(v(0,"div",21),ie(1,goe,5,2,"div",22),y()),t&2){let e=ee();P(),j("ngForOf",e.tradeStatus)}}function xoe(t,n){t&1&&(v(0,"div",40),C(1," No trade logs found. "),y())}function voe(t,n){if(t&1){let e=it();v(0,"div",41),le("click",function(o){ge(e);let i=ee();return ye(i.closeModalOnOverlayClick(o))}),v(1,"div",42),le("click",function(o){return ge(e),ye(o.stopPropagation())}),v(2,"app-individual-trade",43),le("formSubmitted",function(){ge(e);let o=ee();return ye(o.onFormSubmitted())})("cancel",function(){ge(e);let o=ee();return ye(o.closeModal())}),y()()()}if(t&2){let e=ee();P(2),j("tradeData",e.selectedTradeLog)("mode",e.selectedTradeLog?"edit":"create")("tradeAccountId",e.tradeAccountId)}}var Zv=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="tradejournal";tradeLogs=[];tradeAccounts=[];loading=!1;errorMessage="";tradeAccountId="";showModal=!1;selectedTradeLog=null;tradeStatus=[{status:"Planned",title:"Planning Phase"},{status:"Executing",title:"Executing Phase"},{status:"Completed",title:"Completed Phase"}];async ngOnInit(){this.loading=!0,await this.fetchTradeAccounts(),await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{let n=await this.supabaseService.getTradeLogsOfSelectedAccount(this.tableName,this.tradeAccountId);this.tradeLogs=n.sort((e,r)=>new Date(r.updated_time).getDate()-new Date(e.updated_time).getTime()),this.cdr.markForCheck()}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}async fetchTradeAccounts(){try{this.tradeAccounts=await this.supabaseService.getUserTradeAccounts(),this.tradeAccounts.length&&(this.tradeAccountId=this.tradeAccounts[0].account_id)}catch(n){console.error("Error fetching trade accounts:",n),this.errorMessage="Error loading trade accounts."}}onAccountChange(n){let e=n.target;this.tradeAccountId=e.value,this.fetchTradeLogs(),this.cdr.markForCheck()}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}openAddModal(){this.selectedTradeLog=null,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal(),this.cdr.markForCheck()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLogOfSelectedAccount(n.tradeid,this.tableName,this.tradeAccountId),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(oe(Vt),oe($t))};static \u0275cmp=Tt({type:t,selectors:[["app-trade-journal"]],decls:25,vars:6,consts:[[1,"container","mt-3"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","justify-content-center"],[1,"btn","btn-tr","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"form-group","mt-4","mb-3"],["for","accountSelector"],["id","accountSelector",1,"form-control","w-auto","d-inline-block","ms-2",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value","selected"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"mt-5"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"mt-3","row"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"col-md-3","col-sm-6","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"mb-2"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeData","mode","tradeAccountId"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Trade Journal"),y()()(),v(8,"div",6)(9,"h2"),C(10,"Trade Journal"),y(),v(11,"button",7),le("click",function(){return r.openAddModal()}),U(12,"i",8),C(13," Add "),y()(),v(14,"div",9)(15,"label",10)(16,"strong"),C(17,"Select Trade Account:"),y()(),v(18,"select",11),le("change",function(i){return r.onAccountChange(i)}),ie(19,doe,2,3,"option",12),y()(),ie(20,poe,2,0,"div",13)(21,foe,2,1,"div",14)(22,yoe,2,1,"div",15)(23,xoe,2,0,"div",16),y(),ie(24,voe,3,3,"div",17)),e&2&&(P(19),j("ngForOf",r.tradeAccounts),P(),j("ngIf",r.loading),P(),j("ngIf",r.errorMessage),P(),j("ngIf",r.tradeLogs&&r.tradeLogs.length),P(),j("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),P(),j("ngIf",r.showModal))},dependencies:[Ho,Go,Wo,Qt,Po,mr,pn,es,df,hr],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:5px;color:#fff;font-size:.7rem}.status-planned[_ngcontent-%COMP%]{background-color:#007bff}.status-executing[_ngcontent-%COMP%]{background-color:#ffc107}.status-completed[_ngcontent-%COMP%]{background-color:#28a745}.status-planned-card[_ngcontent-%COMP%]{border-left:4px solid #007bff!important}.status-executing-card[_ngcontent-%COMP%]{border-left:4px solid #ffc107!important}.status-completed-card[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;display:none;color:red;cursor:pointer}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;max-width:800px;width:100%;position:relative;max-height:98vh;overflow-y:auto}"]})};var Jv=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Tt({type:t,selectors:[["app-meditation-hub"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(v(0,"h1",0),C(1,"Meditation Coming soon"),y())},encapsulation:2})};var eb=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Tt({type:t,selectors:[["app-analytics"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(v(0,"h1",0),C(1,"Analytics Coming soon"),y())},encapsulation:2})};var Hu=class{constructor(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)}set(n,e){this.dataIdsCount++,this.data.set(n,e)}has(n){return this.data.has(n)}delete(n){return this.dataIdsCount--,this.data.delete(n)}numDataIds(){return this.dataIdsCount}},Js=class{refCount(n){return qo("refCount")}incRef(n){return qo("incRef")}timerAvailable(){return!0}time(n){return qo("time")}read(n){return qo("read")}readSync(n){return qo("readSync")}numDataIds(){return qo("numDataIds")}disposeData(n,e){return qo("disposeData")}write(n,e,r){return qo("write")}move(n,e,r,o,i){return qo("move")}memory(){return qo("memory")}floatPrecision(){return qo("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return qo("dispose")}};function qo(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function m$(t){let n=t.length,e=0,r=0;for(;n>0;)r=Math.random()*n|0,n--,e=t[n],t[n]=t[r],t[r]=e}function boe(t,n){if(t.length!==n.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${n.length}`);let e=t.length,r,o,i=0;for(;e>0;)i=Math.random()*e|0,e--,r=t[e],o=n[e],t[e]=t[i],n[e]=n[i],t[i]=r,n[i]=o}function pf(t,n,e){return Math.max(t,Math.min(n,e))}function woe(t){return t%2===0?t:t+1}function Coe(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function _oe(t,n){let e=Math.random();return n*e+(1-e)*t}function Soe(t,n){let e=0;for(let r=0;r<t.length;r++){let o=Number(t[r])-Number(n[r]);e+=o*o}return e}function M(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function tb(t,n,e=""){M(is(t,n),()=>e+` Shapes ${t} and ${n} must match`)}function Ng(t){M(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function zl(t,n=[],e=!1){if(n==null&&(n=[]),Array.isArray(t)||Jr(t)&&!e)for(let r=0;r<t.length;++r)zl(t[r],n,e);else n.push(t);return n}function Ot(t){if(t.length===0)return 1;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];return n}function Eoe(t){return t.length===0}function is(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function gt(t){return t%1===0}function Ioe(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let n=Math.exp(2*t);return(n-1)/(n+1)}}function Toe(t){let n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function Doe(t){let n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return m$(n),n}function Ku(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function Noe(t,n=r=>0,e){return new Promise((r,o)=>{let i=0,s=()=>{if(t()){r();return}i++;let a=n(i);if(e!=null&&i>=e){o();return}setTimeout(s,a)};s()})}function koe(t,n){let e=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(n>0&&n!==e)throw Error(`Size(${n}) must match the product of shape ${t}`);return t}if(e===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(n%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${n} / ${e}`);let o=t.slice();return o[r]=n/e,o}function bn(t,n){let e=n.length;return t=t==null?n.map((r,o)=>o):[].concat(t),M(t.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${t}`),M(t.every(r=>gt(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?e+r:r)}function tT(t,n){let e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:bn(n,t).sort(),s=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[s]==null||i[s]>a)&&t[a]===1&&(e.push(t[a]),r.push(a)),i[s]<=a&&s++}t[a]!==1&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function Aoe(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);return e}function nT(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else if(t==="string")e=new Array(n);else throw new Error(`Unknown data type ${t}`);return e}function rT(t,n){for(let e=0;e<t.length;e++){let r=t[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${n} being uploaded contains ${r}.`)}}function oT(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Roe(t,n){return!(n==="complex64"||n==="float32"&&t!=="complex64"||n==="int32"&&t!=="float32"&&t!=="complex64"||n==="bool"&&t==="bool")}function Jr(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function nb(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function iT(t){if(t==null)return 0;let n=0;return t.forEach(e=>n+=e.length),n}function ff(t){return typeof t=="string"||t instanceof String}function h$(t){return typeof t=="boolean"}function g$(t){return typeof t=="number"}function mf(t){return Array.isArray(t)?mf(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":g$(t)?"float32":ff(t)?"string":h$(t)?"bool":"float32"}function hf(t){return!!(t&&t.constructor&&t.call&&t.apply)}function gf(t,n){for(let e=n;e<t;++e)if(t%e===0)return e;return t}function ss(t){let n=t.length;if(n<2)return[];let e=new Array(n-1);e[n-2]=t[n-1];for(let r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function y$(t,n,e,r=!1){let o=new Array;if(n.length===1){let i=n[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[t+s]}else{let i=n[0],s=n.slice(1),a=s.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)o[l]=y$(t+l*a,s,e,r)}return o}function qu(t,n,e=!1){if(t.length===0)return n[0];let r=t.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==n.length)throw new Error(`[${t}] does not match the input size ${n.length}${e?" for a complex tensor":""}.`);return y$(0,t,n,e)}function kg(t,n){let e=yf(t,n);for(let r=0;r<e.length;r++)e[r]=1;return e}function yf(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${n}`)}function Ooe(t,n){let e=t.reduce((r,o)=>r*o,1);if(n==null||n==="float32")return qu(t,new Float32Array(e));if(n==="int32")return qu(t,new Int32Array(e));if(n==="bool")return qu(t,new Uint8Array(e));throw new Error(`Unknown data type ${n}`)}function Ag(t){t.forEach(n=>{M(Number.isInteger(n)&&n>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function Moe(t,n,e){if(n===0)return 0;if(n===1)return t[0];let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function Foe(t,n,e){if(n===0)return[];if(n===1)return[t];let r=new Array(n);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}function Rg(t){return t&&t.then&&typeof t.then=="function"}var x$="tfjsflags",Og=class{constructor(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=$oe,this.populateURLFlags()}setPlatform(n,e){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=n,this.platform=e}registerFlag(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){let o=this.urlFlags[n];console.warn(`Setting feature override from URL ${n}: ${o}.`),this.set(n,o)}}async getAsync(n){return n in this.flags?this.flags[n]:(this.flags[n]=await this.evaluateFlag(n),this.flags[n])}get(n){if(n in this.flags)return this.flags[n];let e=this.evaluateFlag(n);if(Rg(e))throw new Error(`Flag ${n} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[n]=e,this.flags[n]}getNumber(n){return this.get(n)}getBool(n){return this.get(n)}getFlags(){return this.flags}get features(){return this.flags}set(n,e){if(this.flagRegistry[n]==null)throw new Error(`Cannot set flag ${n} as it has not been registered.`);this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)}evaluateFlag(n){if(this.flagRegistry[n]==null)throw new Error(`Cannot evaluate flag '${n}': no evaluation function found.`);return this.flagRegistry[n].evaluationFn()}setFlags(n){this.flags=Object.assign({},n)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let n=this.getQueryParams(this.global.location.search);x$ in n&&n[x$].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=Voe(o,i)})}};function $oe(t){let n={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(Loe(n,r[0],r[1]),r.join("="))),n}function Loe(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function Voe(t,n){if(n=n.toLowerCase(),n==="true"||n==="false")return n==="true";if(`${+n}`===n)return+n;throw new Error(`Could not parse value flag value ${n} for flag ${t}.`)}function H(){return sT}var sT=null;function v$(t){sT=t}var aT;function lT(){if(aT==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");aT=t}return aT}function Boe(){let t=lT();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Mg(t,n){let e=Boe();if(e.has(t))return e.get(t);{let r=n();return e.set(t,r),e.get(t)}}var Ul="Abs",ea="Acos",ta="Acosh",Ni="Add",xf="AddN",vf="All",bf="Any",jl="ArgMax",Gl="ArgMin",na="Asin",ra="Asinh",oa="Atan",ia="Atanh",sa="Atan2",Wl="AvgPool",wf="AvgPoolGrad",Hl="AvgPool3D",Cf="AvgPool3DGrad",ql="BatchMatMul",Kl="BatchToSpaceND",rb="Bincount",b$="BroadcastTo",as="Cast",aa="Ceil",la="ClipByValue",_f="Complex",Xl="ComplexAbs",Yl="Concat",Ql="Conv2D",Sf="Conv2DBackpropFilter",Zl="Conv2DBackpropInput",Jl="Conv3D",Ef="Conv3DBackpropFilterV2",If="Conv3DBackpropInputV2",ca="Cos",ua="Cosh",ec="Cumsum",ob="CropAndResize",ib="DenseBincount",Tf="DepthToSpace",tc="DepthwiseConv2dNative",Df="DepthwiseConv2dNativeBackpropFilter",Nf="DepthwiseConv2dNativeBackpropInput",sb="Diag",nc="Dilation2D",Fg="Dilation2DBackpropInput",Pg="Dilation2DBackpropFilter",da="RealDiv",ab="Einsum",pa="Elu",kf="EluGrad",fa="Erf",Xu="Equal",ma="Exp",rc="ExpandDims",ha="Expm1",Af="FFT",Rf="Fill",lb="FlipLeftRight",ga="Floor",ya="FloorDiv",oc="FusedBatchNorm",ic="GatherV2",cb="GatherNd",Yu="Greater",xa="GreaterEqual",ls="Identity",Of="IFFT",Mf="Imag",va="IsFinite",ba="IsInf",wa="IsNan",sc="LeakyRelu",Qu="Less",Zu="LessEqual",ub="LinSpace",Ca="Log",_a="Log1p",Ju="LogicalAnd",ed="LogicalNot",td="LogicalOr",w$="LogSoftmax",ac="LRN",Ff="LRNGrad",lc="Max",Sa="Maximum",cc="MaxPool",Pf="MaxPoolGrad",uc="MaxPool3D",$f="MaxPool3DGrad",db="MaxPoolWithArgmax",dc="Mean",pc="Min",Ea="Minimum",fc="MirrorPad",Ia="Mod",pb="Multinomial",Ta="Multiply",mc="Neg",nd="NotEqual",fb="NonMaxSuppressionV3",mb="NonMaxSuppressionV4",hb="NonMaxSuppressionV5",hc="OnesLike",gc="OneHot",yc="Pack",xc="PadV2";var Da="Pow",vc="Prelu",Lf="Prod",Vf="Range",Bf="Real",Na="Reciprocal",ka="Relu",bc="Reshape",wc="ResizeNearestNeighbor",zf="ResizeNearestNeighborGrad",Cc="ResizeBilinear",Uf="ResizeBilinearGrad",Aa="Relu6",_c="Reverse",Ra="Round",Oa="Rsqrt",gb="ScatterNd",Sc="Select",Ma="Selu",Ec="Slice",Fa="Sin",Pa="Sinh",$a="Sign",La="Sigmoid",Va="Softplus",Ba="Sqrt",Ic="Sum",Tc="SpaceToBatchND",Dc="SplitV",Nc="Softmax",yb="SparseFillEmptyRows",xb="SparseReshape",vb="SparseToDense",za="SquaredDifference",jf="Square",Gf="StridedSlice",Ua="Sub",ja="Tan",Ga="Tanh",cs="Tile",Wf="TopK",bb="Transform",kc="Transpose",Hf="Unique",Ac="Unpack",Rc="UnsortedSegmentSum",Oc="ZerosLike",Wa="Step",C$="FromPixels",wb="RotateWithOffset",rd="_FusedMatMul",od="FusedConv2D",id="FusedDepthwiseConv2D";var Cb=Mg("kernelRegistry",()=>new Map),cT=Mg("gradRegistry",()=>new Map);function uT(t,n){let e=S$(t,n);return Cb.get(e)}function dT(t){return cT.get(t)}function pT(t){let n=Cb.entries(),e=[];for(;;){let{done:r,value:o}=n.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===t&&e.push(s)}return e}function _b(t){let{kernelName:n,backendName:e}=t,r=S$(n,e);Cb.has(r)&&console.warn(`The kernel '${n}' for backend '${e}' is already registered`),Cb.set(r,t)}function _$(t){let{kernelName:n}=t;cT.has(n)&&H().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${n}'`),cT.set(n,t)}function S$(t,n){return`${n}_${t}`}var w={};Wi(w,{arraysEqual:()=>is,assert:()=>M,assertNonNegativeIntegerDimensions:()=>Ag,assertNonNull:()=>Ng,assertShapesMatch:()=>tb,bytesFromStringArray:()=>iT,bytesPerElement:()=>nb,checkConversionForErrors:()=>rT,clamp:()=>pf,computeStrides:()=>ss,createScalarValue:()=>zoe,createShuffledIndices:()=>Doe,decodeString:()=>Xf,distSquared:()=>Soe,encodeString:()=>Kf,fetch:()=>joe,flatten:()=>zl,getArrayFromDType:()=>nT,getTypedArrayFromDType:()=>Aoe,hasEncodingLoss:()=>Roe,indexToLoc:()=>Foe,inferDtype:()=>mf,inferFromImplicitShape:()=>koe,isBoolean:()=>h$,isFunction:()=>hf,isInt:()=>gt,isNumber:()=>g$,isPromise:()=>Rg,isScalarShape:()=>Eoe,isString:()=>ff,isTypedArray:()=>Jr,isValidDtype:()=>oT,locToIndex:()=>Moe,makeOnesTypedArray:()=>kg,makeZerosNestedTypedArray:()=>Ooe,makeZerosTypedArray:()=>yf,nearestDivisor:()=>gf,nearestLargerEven:()=>woe,now:()=>sd,parseAxisParam:()=>bn,randUniform:()=>_oe,repeatedTry:()=>Noe,rightPad:()=>Ku,shuffle:()=>m$,shuffleCombo:()=>boe,sizeFromShape:()=>Ot,sizeToSquarishShape:()=>Toe,squeezeShape:()=>tT,sum:()=>Coe,tanh:()=>Ioe,toNestedArray:()=>qu,toTypedArray:()=>qf});function zoe(t,n){return n==="string"?Kf(t):qf([t],n)}function Uoe(t,n){return t instanceof Float32Array&&n==="float32"||t instanceof Int32Array&&n==="int32"||t instanceof Uint8Array&&n==="bool"}function qf(t,n){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=zl(t)),H().getBool("DEBUG")&&rT(t,n),Uoe(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){let e=new Uint8Array(t.length);for(let r=0;r<e.length;++r)Math.round(t[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${n}`)}function sd(){return H().platform.now()}function joe(t,n){return H().platform.fetch(t,n)}function Kf(t,n="utf-8"){return n=n||"utf-8",H().platform.encode(t,n)}function Xf(t,n="utf-8"){return n=n||"utf-8",H().platform.decode(t,n)}var Sb=class{constructor(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new fT)}profileKernel(n,e,r){let o,i=()=>{o=r()},s,a=sd();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let c of o)c.dataSync();s=Promise.resolve({kernelMs:sd()-a})}if(H().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let u=o[c];u.data().then(d=>{Goe(d,u.dtype,n)})}return{kernelName:n,outputs:o,inputs:e,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(n){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=n;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function Goe(t,n,e){if(n!=="float32")return!1;for(let r=0;r<t.length;r++){let o=t[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var fT=class{logKernelProfile(n,e,r,o,i,s){let a=typeof o=="number"?Ku(`${o}ms`,9):o.error,l=Ku(n,25),c=e.rank,u=e.size,d=Ku(e.shape.toString(),14),p="";for(let f in i){let m=i[f];if(m!=null){let h=m.shape||e.shape,g=h.length;p+=`${f}: ${g}D ${g>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function E$(t,n,e){let r={},o={};for(let l=0;l<n.length;l++)r[n[l].id]=!0;for(let l=0;l<t.length;l++){let c=t[l],u=c.inputs;for(let d in u){let p=u[d],f=!1;for(let m=0;m<n.length;m++)if(r[p.id]){c.outputs.forEach(h=>r[h.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}let i={};i[e.id]=!0;let s={};for(let l=t.length-1;l>=0;l--){let c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(let p in u)i[u[p].id]=!0,s[c.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let c=t[l];if(o[c.id]&&s[c.id]){let u={};for(let p in c.inputs){let f=c.inputs[p];r[f.id]&&(u[p]=f)}let d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function I$(t,n,e,r){for(let o=n.length-1;o>=0;o--){let i=n[o],s=[];if(i.outputs.forEach(l=>{let c=t[l.id];c!=null?s.push(c):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);let u=i.inputs[l];if(!is(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{let d=t[u.id];t[u.id]=r(d,c),d.dispose()}}}}var T$=20,$g=3,mT=7;function D$(t,n,e,r){let o=ss(n),i=Woe(t,n,e,o),s=n.length,a=Eb(t,n,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${n}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Woe(t,n,e,r){let o=Ot(n),i=r[r.length-1],s=new Array(i).fill(0),a=n.length,l=e==="complex64"?Vg(t):t;if(a>1)for(let c=0;c<o/i;c++){let u=c*i;for(let d=0;d<i;d++)s[d]=Math.max(s[d],Lg(l[u+d],0,e).length)}return s}function Lg(t,n,e){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(mT))} + ${parseFloat(t[1].toFixed(mT))}j`:ff(t)?r=`'${t}'`:e==="bool"?r=N$(t):r=parseFloat(t.toFixed(mT)).toString(),Ku(r,n)}function N$(t){return t===0?"false":"true"}function Eb(t,n,e,r,o,i=!0){let s=e==="complex64"?2:1,a=n[0],l=n.length;if(l===0){if(e==="complex64"){let h=Vg(t);return[Lg(h[0],0,e)]}return e==="bool"?[N$(t[0])]:[t[0].toString()]}if(l===1){if(a>T$){let g=$g*s,x=Array.from(t.slice(0,g)),b=Array.from(t.slice((a-$g)*s,a*s));return e==="complex64"&&(x=Vg(x),b=Vg(b)),["["+x.map((S,_)=>Lg(S,o[_],e)).join(", ")+", ..., "+b.map((S,_)=>Lg(S,o[a-$g+_],e)).join(", ")+"]"]}return["["+(e==="complex64"?Vg(t):Array.from(t)).map((g,x)=>Lg(g,o[x],e)).join(", ")+"]"]}let c=n.slice(1),u=r.slice(1),d=r[0]*s,p=[];if(a>T$){for(let h=0;h<$g;h++){let g=h*d,x=g+d;p.push(...Eb(t.slice(g,x),c,e,u,o,!1))}p.push("...");for(let h=a-$g;h<a;h++){let g=h*d,x=g+d;p.push(...Eb(t.slice(g,x),c,e,u,o,h===a-1))}}else for(let h=0;h<a;h++){let g=h*d,x=g+d;p.push(...Eb(t.slice(g,x),c,e,u,o,h===a-1))}let f=l===2?",":"";p[0]="["+p[0]+f;for(let h=1;h<p.length-1;h++)p[h]=" "+p[h]+f;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":m),p}function Vg(t){let n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var Dt=class{constructor(n,e,r){if(this.dtype=e,this.shape=n.slice(),this.size=Ot(n),r!=null){let o=r.length;M(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||nT(e,this.size),this.strides=ss(n)}set(n,...e){e.length===0&&(e=[0]),M(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=n}get(...n){n.length===0&&(n=[0]);let e=0;for(let o of n){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${n}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=this.strides[o]*n[o];return this.values[r]}locToIndex(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];let e=n[n.length-1];for(let r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e}indexToLoc(n){if(this.rank===0)return[];if(this.rank===1)return[n];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e}get rank(){return this.shape.length}toTensor(){return us().makeTensor(this.values,this.shape,this.dtype)}},us=null,Yf=null,Hoe=null;function k$(t){us=t}function A$(t){Yf=t}function R$(t){Hoe=t}var ut=class{constructor(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=Ot(n),this.strides=ss(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let n=await this.data();return Yf.buffer(this.shape,this.dtype,n)}bufferSync(){return Yf.buffer(this.shape,this.dtype,this.dataSync())}async array(){let n=await this.data();return qu(this.shape,n,this.dtype==="complex64")}arraySync(){return qu(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let n=us().read(this.dataId);if(this.dtype==="string"){let e=await n;try{return e.map(r=>Xf(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return n}dataSync(){this.throwIfDisposed();let n=us().readSync(this.dataId);if(this.dtype==="string")try{return n.map(e=>Xf(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n}async bytes(){this.throwIfDisposed();let n=await us().read(this.dataId);return this.dtype==="string"?n:new Uint8Array(n.buffer)}dispose(){this.isDisposed||(us().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(n=!1){return Yf.print(this,n)}clone(){return this.throwIfDisposed(),Yf.clone(this)}toString(n=!1){let e=this.dataSync();return D$(e,this.shape,this.dtype,n)}cast(n){return this.throwIfDisposed(),Yf.cast(this,n)}variable(n=!0,e,r){return this.throwIfDisposed(),us().makeVariable(this,n,e,r)}};Object.defineProperty(ut,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function F(){return Mg("Tensor",()=>ut)}F();var Ha=class extends ut{constructor(n,e,r,o){super(n.shape,n.dtype,n.dataId,o),this.trainable=e,this.name=r}assign(n){if(n.dtype!==this.dtype)throw new Error(`dtype of the new value (${n.dtype}) and previous value (${this.dtype}) must match`);if(!is(n.shape,this.shape))throw new Error(`shape of the new value (${n.shape}) and previous value (${this.shape}) must match`);us().disposeTensor(this),this.dataId=n.dataId,us().incRef(this,null)}dispose(){us().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Ha,Symbol.hasInstance,{value:t=>t instanceof ut&&t.assign!=null&&t.assign instanceof Function});var O$=function(t){return t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64",t}(O$||{}),M$=function(t){return t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64",t}(M$||{}),F$=function(t){return t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64",t}(F$||{}),P$=function(t){return t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64",t}(P$||{}),qoe={float32:F$,int32:O$,bool:M$,complex64:P$};function _n(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error(`Can not upcast ${t} with ${n}`)}return qoe[t][n]}function ad(t){return _n(t,"int32")}function Ye(t,n){if(t.dtype===n.dtype)return[t,n];let e=_n(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function Ib(t){let n=[];return $$(t,n,new Set),n}function $$(t,n,e){if(t==null)return;if(t instanceof ut){n.push(t);return}if(!Koe(t))return;let r=t;for(let o in r){let i=r[o];e.has(i)||(e.add(i),$$(i,n,e))}}function Koe(t){return Array.isArray(t)||typeof t=="object"}function hT(t){return t.kernelName!=null}var Tb=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(n=>n.name)))}}}dispose(){for(let n in this.registeredVariables)this.registeredVariables[n].dispose()}},Yoe=(()=>{class t{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Tb}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(await this.initializeBackend(o).success){await this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(console.warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Sb(this.backendInstance),!0}setupRegisteredKernels(){pT(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){pT(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof Js)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return console.warn(`Initialization of backend ${e} failed`),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return t.nextTensorId++}nextVariableId(){return t.nextVariableId++}clone(e){let r=k.runKernel(ls,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",c={x:a},u={dtype:l};return k.runKernel(as,c,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(!(uT(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(c=>{s+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,u=hT(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(hT(e)){let{kernelName:h,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;let b=uT(h,this.backendName);M(b!=null,()=>`Cannot find registered kernel '${h}' for backend '${this.backendName}'`),l=()=>{let S=this.backend.numDataIds();c=b.kernelFunc({inputs:g,attrs:x,backend:this.backend});let _=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,S,_);let E=_.map(I=>{if(I.rank!=null)return I;let{dataId:D,shape:O,dtype:R}=I;return this.makeTensorFromDataId(D,O,R)});if(i){let I=this.getTensorsForGradient(h,g,E);o=this.saveTensorsForBackwardMode(I)}return E}}else{let{forwardFunc:h}=e,g=x=>{i&&(o=x.map(b=>this.keep(this.clone(b))))};l=()=>{let x=this.backend.numDataIds();c=this.tidy(()=>h(this.backend,g));let b=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,x,b),b}}let{inputs:d,attrs:p}=e,f=hT(e)?null:e.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(m=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),r=m.outputs)}),i&&this.addTapeNode(u,d,r,f,o,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(h=>d[h]!=null?d[h].shape:null),outputShapes:r.map(h=>h.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(c)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=dT(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(M(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(u=>r[u])):l=s.map(u=>r[u]);let c=o.filter((u,d)=>a[d]);return l.concat(c)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&ff(e[0])&&(s=e.map(c=>Kf(c)));let a=i.write(s,r,o),l=new ut(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let c=this.state.tensorInfo.get(a),u=iT(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s=new ut(r,o,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new Ha(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*nb(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof Ha||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*nb(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},c=dT(e);c!=null&&(i=c.gradFunc),i!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){let f=o[p],m=yf(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return d}),i(u.length>1?u:u[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=Ib(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(M(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));M(s instanceof ut,()=>"The result y returned by f() must be a tensor.");let a=E$(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??Qoe(s.shape),I$(l,a,u=>this.tidy(u),Zoe);let c=r.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let d of u.saved)d.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return M(hf(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{M(r.every(l=>l instanceof ut),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,c)=>{i[c]=l});let s=(l,c)=>(o=e(...r,c),M(o.value instanceof ut,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),M(hf(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,c)=>{let u=o.gradFunc(l,c),d=Array.isArray(u)?u:[u];M(d.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),M(d.every(f=>f instanceof ut),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return d.forEach((f,m)=>{p[m]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){let r=sd(),o=await this.backend.time(e);return o.wallMs=sd()-r,o}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Tb;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return t.nextTensorId=0,t.nextVariableId=0,t})();function Qoe(t){let n=kg(Ot(t),"float32");return k.makeTensor(n,t,"float32")}function gT(){let t=lT();if(t._tfengine==null){let n=new Og(t);t._tfengine=new Yoe(n)}return v$(t._tfengine.ENV),k$(()=>t._tfengine),t._tfengine}var k=gT();function Zoe(t,n){let e={a:t,b:n};return k.runKernel(Ni,e)}var Mc={};Wi(Mc,{isBrowser:()=>yT,isMobile:()=>eie});function Joe(){return typeof navigator<"u"&&navigator!=null}function eie(t){if(t||Joe()){if(t||(t=navigator),t.product==="ReactNative")return!0;let n=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function yT(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var ki=H();ki.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ki.registerFlag("IS_BROWSER",()=>yT());ki.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ki.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ki.registerFlag("PROD",()=>!1);ki.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ki.getBool("DEBUG"));ki.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ki.registerFlag("IS_TEST",()=>!1);ki.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);ki.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);function ld(t,n){let e=t;if(Jr(t))return n==="string"?[]:[t.length];if(!Array.isArray(t))return[];let r=[];for(;Array.isArray(e)||Jr(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&V$(t,r,[]),r}function V$(t,n,e){if(e=e||[],!Array.isArray(t)&&!Jr(t)){M(n.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);return}M(n.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${t.length} elements`),M(t.length===n[0],()=>`Element arr[${e.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);let r=n.slice(1);for(let o=0;o<t.length;++o)V$(t[o],r,e.concat(o))}function L$(t,n,e,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==n||t==="numeric"&&n==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${t} tensor, but got ${n} tensor`)}}function N(t,n,e,r="numeric"){if(t instanceof ut)return L$(r,t.dtype,n,e),t;let o=mf(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),L$(r,o,n,e),t==null||!Jr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${n}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=ld(t,o);!Jr(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?qf(t,o):zl(t,[],!0);return k.makeTensor(a,i,o)}function Db(t,n,e,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${n} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,s)=>N(i,`${n}[${s}]`,e,r))}var tie="__op";function A(t){let n=Object.keys(t);if(n.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${n.length} keys.`);let e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+tie;let o=(...i)=>{k.startScope(e);try{let s=r(...i);return Rg(s)&&console.error("Cannot return a Promise inside of tidy."),k.endScope(s),s}catch(s){throw k.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function nie(t,n){let e=N(t,"real","complex"),r=N(n,"imag","complex");tb(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return k.runKernel(_f,o)}var Ai=A({complex_:nie});function Fc(t,n,e,r){if(r==null&&(r=mf(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Jr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Ag(n);let o=Ot(n),i=Ot(e);M(o===i,()=>`Based on the provided shape, [${n}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==Ot(n.slice(s)):!0;M(e[s]===n[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${n}). `)}}return!Jr(t)&&!Array.isArray(t)&&(t=[t]),n=n||e,t=r!=="string"?qf(t,r):zl(t,[],!0),k.makeTensor(t,n,r)}function Pc(t,n,e){let r=ld(t,e);return Fc(t,n,r,e)}var Bg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var Nb=4;async function z$(t,n){let e=[],r=[],o=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(t)?t[s].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let u=new Promise(async d=>{let p=await l.bytes(),f=p.reduce((g,x)=>g+x.length,0)+Nb*p.length,m=new Uint8Array(f),h=0;for(let g=0;g<p.length;g++){let x=p[g],b=new Uint8Array(new Uint32Array([x.length]).buffer);m.set(b,h),h+=Nb,m.set(x,h),h+=x.length}d(m)});r.push(u)}else r.push(l.data());n!=null&&(c.group=n),e.push(c)}let i=await Promise.all(r);return{data:rie(i),specs:e}}function kb(t,n){let e={},r,o=0;for(let i of n){let s=i.name,a=i.dtype,l=i.shape,c=Ot(l),u;if("quantization"in i){let d=i.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${i.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${i.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let p=Bg[d.dtype],f=t.slice(o,o+c*p),m=d.dtype==="uint8"?new Uint8Array(f):new Uint16Array(f);if(a==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){u=new Float32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=g*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=aie()),u=r(m);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(a==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);u=new Int32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=Math.round(g*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*p}else if(a==="string"){let d=Ot(i.shape);u=[];for(let p=0;p<d;p++){let f=new Uint32Array(t.slice(o,o+Nb))[0];o+=Nb;let m=new Uint8Array(t.slice(o,o+f));u.push(m),o+=f}}else{let d=Bg[a],p=t.slice(o,o+c*d);if(a==="float32")u=new Float32Array(p);else if(a==="int32")u=new Int32Array(p);else if(a==="bool")u=new Uint8Array(p);else if(a==="complex64"){u=new Float32Array(p);let f=new Float32Array(u.length/2),m=new Float32Array(u.length/2);for(let x=0;x<f.length;x++)f[x]=u[x*2],m[x]=u[x*2+1];let h=Pc(f,l,"float32"),g=Pc(m,l,"float32");e[s]=Ai(h,g),h.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*d}a!=="complex64"&&(e[s]=Pc(u,l,a))}return e}function rie(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let n=0,e=[];t.forEach(i=>{if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(n),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var xT=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function B$(t){return xT?Buffer.byteLength(t):new Blob([t]).size}function U$(t){if(xT)return Buffer.from(t).toString("base64");let n=new Uint8Array(t),e="";for(let r=0,o=n.length;r<o;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function j$(t){if(xT){let r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;++r)e.set([n.charCodeAt(r)],r);return e.buffer}function Qf(t){if(t.length===1)return t[0];let n=0;t.forEach(o=>{n+=o.byteLength});let e=new Uint8Array(n),r=0;return t.forEach(o=>{e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function vT(t){let n="/";for(t=t.trim();t.endsWith(n);)t=t.slice(0,t.length-1);let e=t.split(n);return e[e.length-1]}function ds(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:B$(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:B$(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function oie(){let t=e=>{let r=e<<13,o=0;for(;!(r&8388608);)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},n=new Uint32Array(2048);n[0]=0;for(let e=1;e<1024;e++)n[e]=t(e);for(let e=1024;e<2048;e++)n[e]=939524096+(e-1024<<13);return n}function iie(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let n=1;n<31;n++)t[n]=n<<23;for(let n=33;n<63;n++)t[n]=2147483648+(n-32<<23);return t}function sie(){let t=new Uint32Array(64);for(let n=0;n<64;n++)t[n]=1024;return t[0]=t[32]=0,t}function aie(){let t=oie(),n=iie(),e=sie();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=t[e[a>>10]+(a&1023)]+n[a>>10];i[s]=l}return new Float32Array(o)}}var An=class t{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerSaveRouter(n){t.getInstance().saveRouters.push(n)}static registerLoadRouter(n){t.getInstance().loadRouters.push(n)}static getSaveHandlers(n){return t.getHandlers(n,"save")}static getLoadHandlers(n,e){return t.getHandlers(n,"load",e)}static getHandlers(n,e,r){let o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(s=>{let a=s(n,r);a!==null&&o.push(a)}),o}},G$=t=>An.registerSaveRouter(t),W$=t=>An.registerLoadRouter(t),H$=t=>An.getSaveHandlers(t),q$=(t,n)=>An.getLoadHandlers(t,n);var bT="tensorflowjs",wT=1,cd="models_store",$c="model_info_store";function K$(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function CT(t){let n=t.result;n.createObjectStore(cd,{keyPath:"modelPath"}),n.createObjectStore($c,{keyPath:"modelPath"})}var ud=(()=>{class t{constructor(e){if(this.indexedDB=K$(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(bT,wT);s.onupgradeneeded=()=>CT(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(cd,"readonly"),u=l.objectStore(cd).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>a.close()}else{let l=ds(r),c=a.transaction($c,"readwrite"),u=c.objectStore($c),d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l}),p;d.onsuccess=()=>{p=a.transaction(cd,"readwrite");let m=p.objectStore(cd).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l});m.onsuccess=()=>o({modelArtifactsInfo:l}),m.onerror=h=>{u=c.objectStore($c);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(m.error)),g.onerror=x=>(a.close(),i(m.error))}},d.onerror=f=>(a.close(),i(d.error)),c.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return t.URL_SCHEME="indexeddb://",t})(),X$=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ud.URL_SCHEME)?lie(t.slice(ud.URL_SCHEME.length)):null;An.registerSaveRouter(X$);An.registerLoadRouter(X$);function lie(t){return new ud(t)}function cie(t){return t.startsWith(ud.URL_SCHEME)?t.slice(ud.URL_SCHEME.length):t}var Ab=class{constructor(){this.indexedDB=K$()}async listModels(){return new Promise((n,e)=>{let r=this.indexedDB.open(bT,wT);r.onupgradeneeded=()=>CT(r),r.onsuccess=()=>{let o=r.result,i=o.transaction($c,"readonly"),a=i.objectStore($c).getAll();a.onsuccess=()=>{let l={};for(let c of a.result)l[c.modelPath]=c.modelArtifactsInfo;n(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})}async removeModel(n){return n=cie(n),new Promise((e,r)=>{let o=this.indexedDB.open(bT,wT);o.onupgradeneeded=()=>CT(o),o.onsuccess=()=>{let i=o.result,s=i.transaction($c,"readwrite"),a=s.objectStore($c),l=a.get(n),c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${n}' in IndexedDB.`));{let u=a.delete(n),d=()=>{c=i.transaction(cd,"readwrite");let f=c.objectStore(cd).delete(n);f.onsuccess=()=>e(l.result.modelArtifactsInfo),f.onerror=m=>r(l.error)};u.onsuccess=d,u.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=u=>(i.close(),r(l.error)),s.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})}};var qa="/",Zf="tensorflowjs_models",Y$="info",uie="model_topology",die="weight_specs",pie="weight_data",fie="model_metadata";function Q$(t){return{info:[Zf,t,Y$].join(qa),topology:[Zf,t,uie].join(qa),weightSpecs:[Zf,t,die].join(qa),weightData:[Zf,t,pie].join(qa),modelMetadata:[Zf,t,fie].join(qa)}}function mie(t){let n=t.split(qa);if(n.length<3)throw new Error(`Invalid key format: ${t}`);return n.slice(1,n.length-1).join(qa)}function hie(t){return t.startsWith(dd.URL_SCHEME)?t.slice(dd.URL_SCHEME.length):t}var dd=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=Q$(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=ds(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,U$(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=j$(a),r}}return t.URL_SCHEME="localstorage://",t})(),Z$=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(dd.URL_SCHEME)?gie(t.slice(dd.URL_SCHEME.length)):null;An.registerSaveRouter(Z$);An.registerLoadRouter(Z$);function gie(t){return new dd(t)}var Rb=class{constructor(){M(H().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),M(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let n={},e=Zf+qa,r=qa+Y$;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=mie(i);n[s]=JSON.parse(this.LS.getItem(i))}}return n}async removeModel(n){n=hie(n);let e=Q$(n);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${n}'`);let r=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),r}};var Jf="://",Ri=class t{constructor(){this.managers={}}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerManager(n,e){M(n!=null,()=>"scheme must not be undefined or null."),n.endsWith(Jf)&&(n=n.slice(0,n.indexOf(Jf))),M(n.length>0,()=>"scheme must not be an empty string.");let r=t.getInstance();M(r.managers[n]==null,()=>`A model store manager is already registered for scheme '${n}'.`),r.managers[n]=e}static getManager(n){let e=this.getInstance().managers[n];if(e==null)throw new Error(`Cannot find model manager for scheme '${n}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}};function Ob(t){if(t.indexOf(Jf)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ri.getSchemes().join(",")}`);return{scheme:t.split(Jf)[0],path:t.split(Jf)[1]}}async function J$(t,n,e=!1){M(t!==n,()=>`Old path and new path are the same: '${t}'`);let r=An.getLoadHandlers(t);M(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),M(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);let o=r[0],i=An.getSaveHandlers(n);M(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${n}.`),M(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${n}.`);let s=i[0],a=Ob(t).scheme,l=Ob(t).path,c=a===Ob(t).scheme,u=await o.load();e&&c&&await Ri.getManager(a).removeModel(l);let d=await s.save(u);return e&&!c&&await Ri.getManager(a).removeModel(l),d.modelArtifactsInfo}async function eL(){let t=Ri.getSchemes(),n={};for(let e of t){let r=await Ri.getManager(e).listModels();for(let o in r){let i=e+Jf+o;n[i]=r[o]}}return n}async function tL(t){let n=Ob(t);return Ri.getManager(n.scheme).removeModel(n.path)}async function nL(t,n){return J$(t,n,!1)}async function rL(t,n){return J$(t,n,!0)}var _T=class{fetch(n,e){return fetch(n,e)}now(){return performance.now()}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)}decode(n,e){return new TextDecoder(e).decode(n)}};if(H().get("IS_BROWSER")){H().setPlatform("browser",new _T);try{Ri.registerManager(dd.URL_SCHEME,new Rb)}catch{}try{Ri.registerManager(ud.URL_SCHEME,new Ab)}catch{}}var xie={importFetch:()=>iL()},ST;var ET=class{constructor(){this.util=sL(),this.textEncoder=new this.util.TextEncoder}fetch(n,e){return H().global.fetch!=null?H().global.fetch(n,e):(ST==null&&(ST=xie.importFetch()),ST(n,e))}now(){let n=process.hrtime();return n[0]*1e3+n[1]/1e6}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(n)}decode(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)}};H().get("IS_NODE")&&H().setPlatform("node",new ET);function Ee(t,n="float32",e){return n=n||"float32",Ag(t),new Dt(t,n,e)}function vie(t,n){let e=N(t,"x","cast");if(!oT(n))throw new Error(`Failed to cast to unknown dtype ${n}`);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:n};return k.runKernel(as,r,o)}var ce=A({cast_:vie});function bie(t){let e={x:N(t,"x","clone","string_or_numeric")};return k.runKernel(ls,e)}var Oi=A({clone_:bie});function aL(t,n=!1){console.log(t.toString(n))}gT();var wie={buffer:Ee,cast:ce,clone:Oi,print:aL};A$(wie);var Ko={};Wi(Ko,{browserFiles:()=>cL,browserHTTPRequest:()=>fL,concatenateArrayBuffers:()=>Qf,copyModel:()=>nL,decodeWeights:()=>kb,encodeWeights:()=>z$,fromMemory:()=>mL,getLoadHandlers:()=>q$,getModelArtifactsInfoForJSON:()=>ds,getSaveHandlers:()=>H$,http:()=>Fb,isHTTPScheme:()=>Mb,listModels:()=>eL,loadWeights:()=>uL,moveModel:()=>rL,registerLoadRouter:()=>W$,registerSaveRouter:()=>G$,removeModel:()=>tL,weightsLoaderFactory:()=>kT,withSaveHandler:()=>hL});var Cie="model",_ie=".json",Sie=".weights.bin";function lL(t){return new Promise(n=>setTimeout(n)).then(t)}var IT=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),(e==null||e.length===0)&&(e=Cie),this.modelTopologyFileName=e+_ie,this.weightDataFileName=e+Sie}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer);let s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=s,await lL(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await lL(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ds(e)}}}}return t.URL_SCHEME="downloads://",t})(),TT=class{constructor(n){if(n==null||n.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${n}`);this.files=n}async load(){let n=this.files[0],e=this.files.slice(1);return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=JSON.parse(s.target.result),l=a.modelTopology;if(l==null){o(new Error(`modelTopology field is missing from file ${n.name}`));return}e.length===0&&r({modelTopology:l});let c=a.weightsManifest;if(c==null){o(new Error(`weightManifest field is missing from file ${n.name}`));return}let u;try{u=this.checkManifestAndWeightFiles(c,e)}catch(m){o(m);return}let d=[],p=[],f=[];c.forEach(m=>{m.paths.forEach(h=>{p.push(h),f.push(null)}),d.push(...m.weights)}),c.forEach(m=>{m.paths.forEach(h=>{let g=new FileReader;g.onload=x=>{let b=x.target.result,S=p.indexOf(h);if(f[S]=b,f.indexOf(null)===-1){let _={modelTopology:l,weightSpecs:d,weightData:Qf(f),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};a.signature!=null&&(_.signature=a.signature),a.userDefinedMetadata!=null&&(_.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(_.modelInitializer=a.modelInitializer),r(_)}},g.onerror=x=>o(`Failed to weights data from file of path '${h}'.`),g.readAsArrayBuffer(u[h])})})},i.onerror=s=>o(`Failed to read model topology and weights manifest JSON from file '${n.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(n)})}checkManifestAndWeightFiles(n,e){let r=[],o=e.map(s=>vT(s.name)),i={};for(let s of n)s.paths.forEach(a=>{let l=vT(a);if(r.indexOf(l)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${l}'`);if(r.push(l),o.indexOf(l)===-1)throw new Error(`Weight file with basename '${l}' is not provided.`);i[a]=e[o.indexOf(l)]});if(r.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${e.length}).`);return i}},Eie=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(IT.URL_SCHEME)?Iie(t.slice(IT.URL_SCHEME.length)):null;An.registerSaveRouter(Eie);function Iie(t="model"){return new IT(t)}function cL(t){return new TT(t)}function DT(t,n,e,r){s(t),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(c=>{let u=e+ ++o/t.length*(r-e);return n(u),c}),l);function s(l){M(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){M(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),M(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),M(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}async function NT(t,n){n==null&&(n={});let e=n.fetchFunc==null?H().platform.fetch:n.fetchFunc,r=t.map(d=>e(d,n.requestInit,{isBinary:!0})),a=(n.onProgress==null?await Promise.all(r):await DT(r,n.onProgress,0,.5)).map(d=>d.arrayBuffer());return n.onProgress==null?await Promise.all(a):await DT(a,n.onProgress,.5,1)}async function uL(t,n="",e,r){return kT(s=>NT(s,{requestInit:r}))(t,n,e)}function kT(t){return async(n,e="",r)=>{let o=n.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(n.forEach((f,m)=>{let h=0;f.weights.forEach(g=>{let x="quantization"in g?g.quantization.dtype:g.dtype,b=Bg[x]*Ot(g.shape),S=()=>{o[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:g,groupOffset:h,sizeBytes:b})};r!=null?r.forEach((_,E)=>{_===g.name&&(S(),s[E]=!0)}):S(),a.push(g.name),h+=b})}),!s.every(f=>f)){let f=r.filter((m,h)=>!s[h]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((f,m,h)=>(m&&f.push(h),f),[]),c=[];l.forEach(f=>{n[f].paths.forEach(m=>{let h=e+(e.endsWith("/")?"":"/")+m;c.push(h)})});let u=await t(c),d={},p=0;return l.forEach(f=>{let m=n[f].paths.length,h=0;for(let _=0;_<m;_++)h+=u[p+_].byteLength;let g=new ArrayBuffer(h),x=new Uint8Array(g),b=0;for(let _=0;_<m;_++){let E=new Uint8Array(u[p+_]);x.set(E,b),b+=E.byteLength}i[f].forEach(_=>{let E=g.slice(_.groupOffset,_.groupOffset+_.sizeBytes),I=kb(E,[_.manifestEntry]);for(let D in I)d[D]=I[D]}),p+=m}),d}}var Tie="application/octet-stream",Die="application/json",dL=(()=>{class t{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(M(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=H().platform.fetch,M(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&M(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(i)],{type:Die}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:Tie}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:ds(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let g=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?g+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":g+=" Please make sure the server is serving valid JSON for this request.",new Error(g)}let o=r.modelTopology,i=r.weightsManifest,s=r.generatedBy,a=r.convertedBy,l=r.format,c=r.signature,u=r.userDefinedMetadata;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let d,p;i!=null&&([d,p]=await this.loadWeights(i));let f={modelTopology:o,weightSpecs:d,weightData:p,generatedBy:s,convertedBy:a,format:l};c!=null&&(f.signature=c),u!=null&&(f.userDefinedMetadata=u);let m=r.modelInitializer;return m&&(f.modelInitializer=m),f}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=Nie(r),s=this.weightPathPrefix||o,a=[];for(let d of e)a.push(...d.weights);let l=[],c=[];for(let d of e)for(let p of d.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(p)):l.push(s+p+i);this.weightUrlConverter&&l.push(...await Promise.all(c));let u=await NT(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,Qf(u)]}}return t.URL_SCHEME_REGEX=/^https?:\/\//,t})();function Nie(t){let n=t.lastIndexOf("/"),e=t.lastIndexOf("?"),r=t.substring(0,n),o=e>n?t.substring(e):"";return[r+"/",o]}function Mb(t){return t.match(dL.URL_SCHEME_REGEX)!=null}var pL=(t,n)=>{if(typeof fetch>"u"&&(n==null||n.fetchFunc==null))return null;{let e=!0;if(Array.isArray(t)?e=t.every(r=>Mb(r)):e=Mb(t),e)return Fb(t,n)}return null};An.registerSaveRouter(pL);An.registerLoadRouter(pL);function Fb(t,n){return new dL(t,n)}function fL(t,n){return Fb(t,n)}var zg=class{constructor(n){this.modelArtifacts=n}async load(){return this.modelArtifacts}},AT=class{constructor(n){this.saveHandler=n}async save(n){return this.saveHandler(n)}};function mL(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new zg(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zg({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zg({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))}function hL(t){return new AT(t)}function kie(t,n,e=!1,r=!1){let o=N(t,"a","matMul"),i=N(n,"b","matMul");[o,i]=Ye(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return k.runKernel(ql,s,a)}var yt=A({matMul_:kie});function Aie(t,n,e=1,r=0){if(n<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${n}`);let i={indices:N(t,"indices","oneHot","int32")},s={depth:n,onValue:e,offValue:r};return k.runKernel(gc,i,s)}var tm=A({oneHot_:Aie});function Rie(t,n){let e=N(t,"x","transpose");if(n==null&&(n=e.shape.map((i,s)=>s).reverse()),M(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of perm ${n}.`),n.forEach(i=>{M(i>=0&&i<e.rank,()=>`All entries in 'perm' must be between 0 and ${e.rank-1} but got ${n}`)}),e.rank<=1)return e.clone();let r={x:e},o={perm:n};return k.runKernel(kc,r,o)}var ot=A({transpose_:Rie});function Oie(t,n){let e=t.shape.length,r=n.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(n.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${n.shape[r-1]} vs. ${e}`);if(Ot(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=n.shape,i=o[o.length-1],s=1;for(let d=0;d<o.length-1;++d)s*=o[d];let a=t.shape,l=o.slice();l.pop();let c=1;for(let d=i;d<e;++d)c*=a[d],l.push(a[d]);let u=[...ss(t.shape).map(d=>d/c),1].slice(0,i);return[l,s,c,u]}function gL(t,n,e){let r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${n.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(t.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+t.length-r)throw new Error(i+` update.rank != ${o+t.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==n.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${n.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==t[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${t[s+o]})`)}function Mie(t,n,e){if(n.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${n.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(n.size===0)throw new Error(`Indices specified for empty output. indices shape: ${n.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}gL(e,n,t)}function Fie(t,n,e){let r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,s=1;for(let d=o;d<i;++d)s*=e[d];let a=o<1?1:o,l=Ot(n.shape)/a,c=[...ss(e.slice(0,o)),1],u=Ot(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}var Xn={};Wi(Xn,{assertParamsValid:()=>Pie,computeFlatOffset:()=>Lie,computeOutShape:()=>yL,getNormalizedAxes:()=>wL,isSliceContinous:()=>$ie,maskToAxes:()=>Pb,parseSliceParams:()=>RT,sliceInfo:()=>Vie,startForAxis:()=>EL,startIndicesWithElidedDims:()=>CL,stopForAxis:()=>IL,stopIndicesWithElidedDims:()=>_L,stridesForAxis:()=>SL,stridesWithElidedDims:()=>xL});function Pie(t,n,e){let r=t.shape.length;M(r===n.length,()=>`Error in slice${r}D: Length of begin ${n} must match the rank of the array (${r}).`),M(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)M(n[o]+e[o]<=t.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${n[o]+e[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function Pb(t){let n=[],e=0;for(;t>0;)t&1&&n.push(e),t/=2,e++;return n}function yL(t,n,e){let r=[];for(let o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function xL(t,n,e,r){let o=[...t];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[n]=1:(o.splice(n,0,1),o.pop());return o}function vL(t,n,e){return e<=t?e:e-(n-1)}function bL(t,n){let e=[];for(let r=0;r<t;r++)e.push(n+r);return e}function wL(t,n,e,r,o,i,s,a,l){let c=t.length,u=new Array(c),d=new Array(c),p=new Array(c);if(n.length&&e>0){let f=n[0],m=e+1;u=CL(s,f,m,r,t),d=_L(a,f,m,o,t),p=xL(i,f,m,t)}else for(let f=0;f<c;f++)u[f]=EL(s,r,i,t,f,l),d[f]=IL(a,o,i,t,f,l),p[f]=SL(i,f,l);return{begin:u,end:d,strides:p}}function CL(t,n,e,r,o){let i=[...o],s=bL(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=vL(n,e,a),c=r[l];t&1<<l&&(c=0),i[a]=c}return i}function _L(t,n,e,r,o){let i=[...o],s=bL(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=vL(n,e,a),c=r[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=pf(0,i[a],o[a])}return i}function SL(t,n,e){let r=t[n];return(e&1<<n||r==null)&&(r=1),r}function EL(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=pf(0,s,l-1),s}function IL(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=pf(0,s,l):s=pf(-1,s,l-1),s}function $ie(t,n,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function Lie(t,n){let e=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function RT(t,n,e){let r,o=t.shape.length;typeof n=="number"?r=[n,...new Array(o-1).fill(0)]:n.length<o?r=n.concat(new Array(o-n.length).fill(0)):r=n.slice(),r.forEach(s=>{M(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(M(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function Vie(t,n,e,r,o,i,s,a,l){let c=n.slice(),u=e.slice(),d=r;r==null&&(d=new Array(c.length));let p=Pb(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(s!==0&&a!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(s!==0&&l!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let f=t.length-c.length,m=Pb(a),h=t.slice();m.forEach(D=>{c[D]=0,u[D]=1,h.splice(D,0,1)});let{begin:g,end:x,strides:b}=wL(h,p,f,c,u,d,o,i,s);c=g,u=x,d=b;let S=Pb(l);S.forEach(D=>{u[D]=c[D]+1,d[D]=1});let _=yL(c,u,d),E=_.filter((D,O)=>S.indexOf(O)===-1);return{nonStrided:d.every(D=>D===1),$begin:c,$end:u,$strides:d,size:_,newShape:h,outShape:E}}var Q={};Wi(Q,{Serializable:()=>Ug,SerializationMap:()=>$b,registerClass:()=>Fr});var Ug=class{getClassName(){return this.constructor.className}static fromConfig(n,e){return new n(e)}},$b=class t{constructor(){this.classNameMap={}}static getMap(){return t.instance==null&&(t.instance=new t),t.instance}static register(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]}};function Fr(t){M(t.className!=null,()=>"Class being registered does not have the static className property defined."),M(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),M(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),$b.register(t)}function Bie(t){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}R$(Bie);function Ka(){return k}function jg(){return k.memory()}function z(t,n){return k.tidy(t,n)}function Fe(t){Ib(t).forEach(e=>e.dispose())}function Rn(t){return k.keep(t)}function Lb(t,n,e=1){return k.registerBackend(t,n,e)}function TL(){return k.backend}function zie(t,n){let e=N(t,"a","add"),r=N(n,"b","add");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(Ni,o)}var te=A({add_:zie});function Uie(t,n){let e=N(t,"a","floorDiv"),r=N(n,"b","floorDiv");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(ya,o)}var Vb=A({floorDiv_:Uie});function jie(t,n){let e=N(t,"a","div"),r=N(n,"b","div");if([e,r]=Ye(e,r),e.dtype==="int32"&&r.dtype==="int32")return Vb(e,r);let o={a:e,b:r},i={};return k.runKernel(da,o,i)}var he=A({div_:jie});function Gie(t,n){let e=N(t,"a","mul"),r=N(n,"b","mul");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(Ta,o)}var V=A({mul_:Gie});function Wie(t){let n=N(t,"x","abs");if(n.dtype==="complex64"){let e={x:n};return k.runKernel(Xl,e)}else{let e={x:n};return k.runKernel(Ul,e)}}var wn=A({abs_:Wie});function Hie(t){let e={x:N(t,"x","acos")};return k.runKernel(ea,e)}var OT=A({acos_:Hie});function qie(t){let e={x:N(t,"x","acosh")};return k.runKernel(ta,e)}var MT=A({acosh_:qie});function Kie(t,n=null,e=!1){let o={x:N(t,"x","all","bool")},i={axis:n,keepDims:e};return k.runKernel(vf,o,i)}var Gg=A({all_:Kie});function Xie(t,n=null,e=!1){let o={x:N(t,"x","any","bool")},i={axis:n,keepDims:e};return k.runKernel(bf,o,i)}var nm=A({any_:Xie});function Yie(t,n=0){let r={x:N(t,"x","argMax")},o={axis:n};return k.runKernel(jl,r,o)}var rm=A({argMax_:Yie});function Qie(t,n=0){let r={x:N(t,"x","argMin")},o={axis:n};return k.runKernel(Gl,r,o)}var DL=A({argMin_:Qie});function Zie(t){let e={x:N(t,"x","asin")};return k.runKernel(na,e)}var FT=A({asin_:Zie});function Jie(t){let e={x:N(t,"x","asinh")};return k.runKernel(ra,e)}var PT=A({asinh_:Jie});function ese(t){let e={x:N(t,"x","atan")};return k.runKernel(oa,e)}var $T=A({atan_:ese});function tse(t,n){let e=N(t,"a","atan2"),r=N(n,"b","atan2");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(sa,o)}var NL=A({atan2_:tse});function nse(t){let e={x:N(t,"x","atanh")};return k.runKernel(ia,e)}var LT=A({atanh_:nse});function rse(t,n,e,r,o="NHWC",i){let s=t[3],a=[...n,s],l=AL(o);return md(t,a,e,i,r,null,null,l)}function BT(t,n,e,r,o,i,s="channelsLast"){let[a,l]=Bb(n),c;if(s==="channelsLast")c=[a,l,t[3],t[3]];else if(s==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return md(t,c,e,r,o,i,!1,s)}function ose(t,n,e,r,o,i,s="NDHWC"){let[a,l,c]=VT(n),u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return kL(t,u,e,r,o,!1,d,i)}function md(t,n,e,r,o,i,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);let[p,f,,m]=n,[h,g]=Bb(e),[x,b]=Bb(r),S=om(p,x),_=om(f,b),{padInfo:E,outHeight:I,outWidth:D}=ase(o,c,u,h,g,S,_,i,a),O=s?m*d:m,R;return a==="channelsFirst"?R=[l,O,I,D]:a==="channelsLast"&&(R=[l,I,D,O]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:I,outWidth:D,outChannels:O,padInfo:E,strideHeight:h,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:S,effectiveFilterWidth:_,dilationHeight:x,dilationWidth:b,inShape:t,outShape:R,filterShape:n}}function kL(t,n,e,r,o,i=!1,s="channelsLast",a){let[l,c,u,d,p]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,p]=t;else if(s==="channelsFirst")[l,p,c,u,d]=t;else throw new Error(`Unknown dataFormat ${s}`);let[f,m,h,,g]=n,[x,b,S]=VT(e),[_,E,I]=VT(r),D=om(f,_),O=om(m,E),R=om(h,I),{padInfo:$,outDepth:G,outHeight:W,outWidth:q}=lse(o,c,u,d,x,b,S,D,O,R,a),X=i?g*p:g,K;return s==="channelsFirst"?K=[l,X,G,W,q]:s==="channelsLast"&&(K=[l,G,W,q,X]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:p,outDepth:G,outHeight:W,outWidth:q,outChannels:X,padInfo:$,strideDepth:x,strideHeight:b,strideWidth:S,filterDepth:f,filterHeight:m,filterWidth:h,effectiveFilterDepth:D,effectiveFilterHeight:O,effectiveFilterWidth:R,dilationDepth:_,dilationHeight:E,dilationWidth:I,inShape:t,outShape:K,filterShape:n}}function ise(t,n,e,r,o){r==null&&(r=zT(t,n,e));let i=t[0],s=t[1],a=fd((i-n+2*r)/e+1,o),l=fd((s-n+2*r)/e+1,o);return[a,l]}function sse(t,n,e,r,o,i){o==null&&(o=zT(t,n,r));let s=t[0],a=t[1],l=t[2],c=fd((s-n+2*o)/r+1,i),u=fd((a-n+2*o)/r+1,i),d=fd((l-n+2*o)/r+1,i);return[c,u,d,e]}function zT(t,n,e,r=1){let o=om(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function Bb(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function VT(t){return typeof t=="number"?[t,t,t]:t}function om(t,n){return n<=1?t:t+(t-1)*(n-1)}function ase(t,n,e,r,o,i,s,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let f=ise([n,e],i,r,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(n/r),d=Math.ceil(e/o);let p=Math.max(0,(u-1)*r+i-n),f=Math.max(0,(d-1)*o+s-e),m=Math.floor(p/2),h=p-m,g=Math.floor(f/2),x=f-g;c={top:m,bottom:h,left:g,right:x,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((n-i+1)/r),d=Math.ceil((e-s+1)/o);else if(typeof t=="object"){let p=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];c={top:p,bottom:f,left:m,right:h,type:p===0&&f===0&&m===0&&h===0?"VALID":"EXPLICIT"},u=fd((n-i+p+f)/r+1,a),d=fd((e-s+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function lse(t,n,e,r,o,i,s,a,l,c,u){let d,p,f,m;if(typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=sse([n,e,r,1],a,1,o,t,u);p=g[0],f=g[1],m=g[2]}else if(t==="same"){p=Math.ceil(n/o),f=Math.ceil(e/i),m=Math.ceil(r/s);let h=(p-1)*o+a-n,g=(f-1)*i+l-e,x=(m-1)*s+c-r,b=Math.floor(h/2),S=h-b,_=Math.floor(g/2),E=g-_,I=Math.floor(x/2),D=x-I;d={top:_,bottom:E,left:I,right:D,front:b,back:S,type:"SAME"}}else if(t==="valid")d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((n-a+1)/o),f=Math.ceil((e-l+1)/i),m=Math.ceil((r-c+1)/s);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:p,outHeight:f,outWidth:m}}function fd(t,n){if(!n)return Math.trunc(t);switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${n}`)}}function xo(t){let[n,e,r]=Bb(t);return n===1&&e===1&&r===1}function Vn(t,n){return xo(t)||xo(n)}function AL(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function cse(t,n){let r={x:N(t,"x","reshape","string_or_numeric")},o={shape:n};return k.runKernel(bc,r,o)}var B=A({reshape_:cse});function use(t,n,e,r,o){let i=N(t,"x","avgPool","float32"),s=1;M(Vn(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),o!=null&&M(gt(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(Wl,c,u);return d=ce(d,i.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var hd=A({avgPool_:use});function dse(t,n,e,r,o,i="NDHWC"){let s=N(t,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&M(gt(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(Hl,c,u);return d=ce(d,a.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var UT=A({avgPool3d_:dse});function pse(t,n=0){M(t.length>=1,()=>"Pass at least one tensor to concat");let e=Db(t,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Oi(e[0]);let r=e,o={axis:n};return k.runKernel(Yl,r,o)}var Bt=A({concat_:pse});function fse(t){let e={x:N(t,"x","sigmoid")};return k.runKernel(La,e)}var Xo=A({sigmoid_:fse});function mse(t,n,e){let r=N(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:n,size:e};return k.runKernel(Ec,o,i)}var st=A({slice_:mse});function hse(t){let e={x:N(t,"x","tanh")};return k.runKernel(Ga,e)}var im=A({tanh_:hse});function gse(t,n,e){let r=N(t,"x","batchToSpaceND"),o=n.reduce((a,l)=>a*l);M(r.rank>=1+n.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${n.length}`),M(e.length===n.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${n.length}`),M(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${n.join(" * ")} === ${o}`);let i={x:r},s={blockShape:n,crops:e};return k.runKernel(Kl,i,s)}var sm=A({batchToSpaceND_:gse});function RL(t){let n;return t.rank===0||t.rank===1?n=B(t,[1,1,1,t.size]):t.rank===2?n=B(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?n=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]):n=t,n}function yse(t,n,e,r,o,i){i==null&&(i=.001);let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;r!=null&&(u=N(r,"offset","batchNorm")),M(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),M(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),M(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:RL(s),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},m=k.runKernel(oc,p,f);return B(m,s.shape)}var Lc=A({batchNorm_:yse});function xse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),M(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),M(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Lc(s,a,l,u,c,i)}var jT=A({batchNorm2d_:xse});function vse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),M(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),M(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Lc(s,a,l,u,c,i)}var GT=A({batchNorm3d_:vse});function bse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),M(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),M(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Lc(s,a,l,u,c,i)}var WT=A({batchNorm4d_:bse});function wse(t,n){let e=N(t,"broadcastTo","x"),r=e.shape;if(n.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${n}].`);if(n.length<e.rank)throw new Error(`broadcastTo(): shape.length=${n.length} < input.rank=${e.rank}.`);if(n.length>e.rank){let c=e.shape.slice();for(;c.length<n.length;)c.unshift(1);e=B(e,c)}let o=e.shape,i=Array.from(n);for(let c=n.length-1;c>=0;c--)if(o[c]===n[c])i[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${n}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Oi(e);let a={x:e},l={reps:i};return k.runKernel(cs,a,l)}var am=A({broadcastTo_:wse});function Cse(t){let e={x:N(t,"x","ceil")};return k.runKernel(aa,e)}var HT=A({ceil_:Cse});function _se(t,n,e){let r=N(t,"x","clipByValue");M(n<=e,()=>`Error in clip: min (${n}) must be less than or equal to max (${e}).`);let o={x:r},i={clipValueMin:n,clipValueMax:e};return k.runKernel(la,o,i)}var Bn=A({clipByValue_:_se});function Sse(t){return Bt(t,0)}var qT=A({concat1d_:Sse});function Ese(t,n){return Bt(t,n)}var KT=A({concat2d_:Ese});function Ise(t,n){return Bt(t,n)}var XT=A({concat3d_:Ise});function Tse(t,n){return Bt(t,n)}var YT=A({concat4d_:Tse});function Dse(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","conv2d"),l=N(n,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),s!=null&&M(gt(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d=o==="NHWC"?c.shape[3]:c.shape[1];M(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),M(Vn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},m=k.runKernel(Ql,p,f);return u?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var eo=A({conv2d_:Dse});function Nse(t,n,e,r,o="NWC",i=1,s){let a=N(t,"x","conv1d"),l=N(n,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1]])),M(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),M(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),s!=null&&M(gt(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),M(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),M(Vn(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),M(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let d=B(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=B(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=eo(p,d,[1,e],r,"NHWC",[1,i],s);return u?B(g,[g.shape[2],g.shape[3]]):B(g,[g.shape[0],g.shape[2],g.shape[3]])}var Wg=A({conv1d_:Nse});function kse(t,n,e,r,o,i="NHWC",s){M(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let a=t,l=n,c=!1;n.rank===3&&(c=!0,l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]),a=[1,t[0],t[1],t[2]]),M(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),M(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),M(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];M(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),M(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),s!=null&&M(gt(o),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let p={dy:l,filter:e},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},m=k.runKernel(Zl,p,f);return c?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var lm=A({conv2DBackpropInput_:kse});function Ase(t,n,e,r,o,i){let s=N(t,"x","conv2dTranspose"),a=N(n,"filter","conv2dTranspose");return lm(e,s,a,r,o,"NHWC",i)}var Hg=A({conv2dTranspose_:Ase});function Rse(t,n,e,r,o="NDHWC",i=[1,1,1]){let s=N(t,"x","conv3d"),a=N(n,"filter","conv3d"),l=s,c=!1;s.rank===4&&(c=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),M(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),M(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),M(Vn(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),M(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let u={x:l,filter:a},d={strides:e,pad:r,dataFormat:o,dilations:i},p=k.runKernel(Jl,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var QT=A({conv3d_:Rse});function Ose(t,n,e,r,o){M(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let i=t,s=n,a=!1;n.rank===4&&(a=!0,s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);let l=i[4],c=s.shape[4];M(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),M(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),M(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),M(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),M(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let u={dy:s,filter:e},d={pad:o,strides:r,inputShape:i},p=k.runKernel(If,u,d);return a?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var zb=A({conv3DBackpropInput_:Ose});function Mse(t,n,e,r,o){let i=N(t,"x","conv3dTranspose"),s=N(n,"filter","conv3dTranspose");return zb(e,i,s,r,o)}var ZT=A({conv3dTranspose_:Mse});function Fse(t){let e={x:N(t,"x","cos")};return k.runKernel(ca,e)}var gd=A({cos_:Fse});function Pse(t){let e={x:N(t,"x","cosh")};return k.runKernel(ua,e)}var qg=A({cosh_:Pse});function $se(t,n=0,e=!1,r=!1){let i={x:N(t,"x","cumsum")},s={axis:n,exclusive:e,reverse:r};return k.runKernel(ec,i,s)}var Ub=A({cumsum_:$se});function Lse(t,n,e="NHWC"){let r=N(t,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];M(o*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${n}  for depthToSpace with input shape
    ${r.shape}`),M(i*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${n} for depthToSpace with input shape
        ${r.shape}`),M(s%(n*n)===0,()=>`Dimension size must be evenly divisible by ${n*n} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:n,dataFormat:e};return k.runKernel(Tf,a,l)}var OL=A({depthToSpace_:Lse});function Vse(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","depthwiseConv2d"),l=N(n,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`),M(c.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),s!=null&&M(gt(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d={x:c,filter:l},p={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},f=k.runKernel(tc,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Ya=A({depthwiseConv2d_:Vse});function Bse(t,n,e,r,o=[1,1],i="NHWC"){let s=N(t,"x","dilation2d"),a=N(n,"filter","dilation2d");M(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),M(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),M(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,c=!1;s.rank===3&&(l=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0);let u={x:l,filter:a},d={strides:e,pad:r,dilations:o},p=k.runKernel(nc,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ML=A({dilation2d_:Bse});function zse(t,n){let e=t.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=t[i]||1;(n[n.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function Mt(t,n){let e=[];for(let r=0;r<n.length;r++){let o=t[t.length-r-1],i=n.length-r-1,s=n[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function je(t,n){let e=[],r=Math.max(t.length,n.length);for(let o=0;o<r;o++){let i=t[t.length-o-1];i==null&&(i=1);let s=n[n.length-o-1];if(s==null&&(s=1),i===1)e.unshift(s);else if(s===1)e.unshift(i);else if(i!==s){let a=`Operands could not be broadcast together with shapes ${t} and ${n}.`;throw Error(a)}else e.unshift(i)}return e}function Use(t,n){let e=N(t,"a","equal"),r=N(n,"b","equal");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Xu,o)}var Yo=A({equal_:Use});function jse(t,n,e){let r=N(n,"a","where"),o=N(e,"b","where"),i=N(t,"condition","where","bool"),s=je(je(i.shape,r.shape),o.shape),a=am(i,s),l=am(r,s),c=am(o,s),u={condition:a,t:l,e:c};return k.runKernel(Sc,u)}var an=A({where_:jse});function Gse(t){let e={x:N(t,"x","zerosLike")};return k.runKernel(Oc,e)}var Ie=A({zerosLike_:Gse});function Wse(t,n){let e=N(t,"a","div"),r=N(n,"b","div");[e,r]=Ye(e,r);let o=he(e,r),i=Ie(o),s=Yo(r,i);return an(s,i,o)}var FL=A({divNoNan_:Wse});function Hse(t,n){let e=N(t,"t1","dot"),r=N(n,"t2","dot");M((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(M(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=B(e,[1,-1]),a=B(r,[-1,1]),l=yt(s,a);return B(l,[])}else if(e.rank===1&&r.rank===2){let s=B(e,[1,-1]),a=B(r,[r.shape[0],r.shape[1]]),l=yt(s,a);return B(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=B(r,[-1,1]),a=yt(e,s);return B(a,[a.size])}else{let s=B(r,[r.shape[0],r.shape[1]]);return yt(e,s)}}var PL=A({dot_:Hse});function qse(t){let e={x:N(t,"x","elu")};return k.runKernel(pa,e)}var Qa=A({elu_:qse});function Kse(t){let n=N(t,"x","erf");M(n.dtype==="int32"||n.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),n.dtype==="int32"&&(n=ce(n,"float32"));let e={x:n};return k.runKernel(fa,e)}var JT=A({erf_:Kse});function Xse(t){let e={x:N(t,"x","exp")};return k.runKernel(ma,e)}var xr=A({exp_:Xse});function Yse(t,n=0){let e=N(t,"x","expandDims","string_or_numeric");M(n<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:n};return k.runKernel(rc,r,o)}var Yn=A({expandDims_:Yse});function Qse(t){let e={x:N(t,"x","expm1")};return k.runKernel(ha,e)}var eD=A({expm1_:Qse});function Zse(t,n){let e=N(t,"x","tile","string_or_numeric");M(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${n}.`);let r={x:e},o={reps:n};return k.runKernel(cs,r,o)}var Mi=A({tile_:Zse});function Jse(t,n,e,r="float32"){n==null&&(n=t);let o=Ee([t,n],r),i=t<=n?t:n;for(let a=0;a<i;++a)o.set(1,a,a);let s=B(o.toTensor(),[t,n]);if(e==null)return s;if(e.length===1)return Mi(Yn(s,0),[e[0],1,1]);if(e.length===2)return Mi(Yn(Yn(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return Mi(Yn(Yn(Yn(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var cm=A({eye_:Jse});function Kg(t,n,e){let r={shape:t,value:n,dtype:e};return k.runKernel(Rf,{},r)}function eae(t){let e={x:N(t,"x","floor")};return k.runKernel(ga,e)}var Za=A({floor_:eae});function tae(t,n,e=0,r=0){let o=N(t,"x","gather"),i=N(n,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return k.runKernel(ic,s,a)}var yd=A({gather_:tae});function nae(t,n){let e=N(t,"a","greater"),r=N(n,"b","greater");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Yu,o)}var zn=A({greater_:nae});function rae(t,n){let e=N(t,"a","greaterEqual"),r=N(n,"b","greaterEqual");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(xa,o)}var vo=A({greaterEqual_:rae});function oae(t){let e={input:N(t,"input","imag")};return k.runKernel(Mf,e)}var jb=A({imag_:oae});function iae(t){let e={x:N(t,"x","isFinite")};return k.runKernel(va,e)}var tD=A({isFinite_:iae});function sae(t){let e={x:N(t,"x","isInf")};return k.runKernel(ba,e)}var nD=A({isInf_:sae});function aae(t){let e={x:N(t,"x","isNaN")};return k.runKernel(wa,e)}var rD=A({isNaN_:aae});function lae(t,n=.2){let r={x:N(t,"x","leakyRelu")},o={alpha:n};return k.runKernel(sc,r,o)}var xd=A({leakyRelu_:lae});function cae(t,n){let e=N(t,"a","less"),r=N(n,"b","less");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Qu,o)}var Gb=A({less_:cae});function uae(t,n){let e=N(t,"a","lessEqual"),r=N(n,"b","lessEqual");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Zu,o)}var ps=A({lessEqual_:uae});function dae(t,n=5,e=1,r=1,o=.5){let i=N(t,"x","localResponseNormalization");M(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),M(gt(n),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${n}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=B(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},c={depthRadius:n,bias:e,alpha:r,beta:o},u=k.runKernel(ac,l,c);return a?B(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var $L=A({localResponseNormalization_:dae});function pae(t){let e={x:N(t,"x","log")};return k.runKernel(Ca,e)}var vr=A({log_:pae});function fae(t){let e={x:N(t,"x","log1p")};return k.runKernel(_a,e)}var oD=A({log1p_:fae});function iD(t,n){M(hf(t),()=>"The f passed in variableGrads(f) must be a function"),M(n==null||Array.isArray(n)&&n.every(c=>c instanceof Ha),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=n!=null;if(!e){n=[];for(let c in k.registeredVariables)n.push(k.registeredVariables[c])}let r=e?n.filter(c=>!c.trainable):null,o=n.length;n=n.filter(c=>c.trainable),M(n.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=k.gradients(t,n,null,i);M(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),M(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return n.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:s,grads:l}}function bo(t){return k.customGrad(t)}function mae(t){let e={x:N(t,"x","neg")};return k.runKernel(mc,e)}var xt=A({neg_:mae});function hae(t){let e={x:N(t,"x","softplus")};return k.runKernel(Va,e)}var fs=A({softplus_:hae});function gae(t){let n=N(t,"x","logSigmoid");return bo(r=>({value:xt(fs(xt(r))),gradFunc:s=>V(s,Xo(xt(r)))}))(n)}var sD=A({logSigmoid_:gae});function yae(t,n=null,e=!1){let o={x:N(t,"x","max")},i={reductionIndices:n,keepDims:e};return k.runKernel(lc,o,i)}var Un=A({max_:yae});function xae(t,n){let e=N(t,"a","sub"),r=N(n,"b","sub");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(Ua,o)}var Se=A({sub_:xae});function vae(t,n=null,e=!1){let r=N(t,"x","sum");r.dtype==="bool"&&(r=ce(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(Ic,o,i)}var we=A({sum_:vae});function bae(t,n=-1){let e=N(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${n}`);return bo((o,i)=>{let a=Un(o,n,!0),l=Se(o,a),c=Se(ce(l,"float32"),vr(we(xr(l),n,!0)));return i([c]),{value:c,gradFunc:(d,p)=>{let[f]=p,m=!0,h=xr(f);return Se(d,V(we(d,n,m),h))}}})(e)}var Xg=A({logSoftmax_:bae});function aD(t,n){for(let e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function LL(t,n,e){let r=t.length+n.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(t[i++]):o.push(n[s++]);return o}function lD(t,n){let e=[],r=t.length;for(let i=0;i<r;i++)n.indexOf(i)===-1&&e.push(t[i]);let o=n.map(i=>t[i]);return[e,o]}function ms(t,n){let e=n.map(r=>1);return LL(t,e,n)}function wae(t,n,e){M(aD(n,e),()=>`${t} supports only inner-most axes for now. Got axes ${n} and rank-${e} input.`)}function cD(t,n){if(aD(t,n))return null;let e=[];for(let r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(r=>e.push(r)),e}function Yg(t){return t.map((n,e)=>[e,n]).sort((n,e)=>n[1]-e[1]).map(n=>n[0])}function Cae(t,n){let e=[];for(let r=n-t;r<n;++r)e.push(r);return e}function _ae(t,n=null,e=!1){let r=N(t,"x","logSumExp"),o=bn(n,r.shape),i=Un(r,o,!0),s=Se(r,i),a=xr(s),l=we(a,o),c=vr(l),u=te(B(i,c.shape),c);if(e){let d=ms(u.shape,o);return B(u,d)}return u}var VL=A({logSumExp_:_ae});function Sae(t,n){let e=N(t,"a","logicalAnd","bool"),r=N(n,"b","logicalAnd","bool");je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Ju,o)}var cr=A({logicalAnd_:Sae});function Eae(t){let e={x:N(t,"x","logicalNot","bool")};return k.runKernel(ed,e)}var um=A({logicalNot_:Eae});function Iae(t,n){let e=N(t,"a","logicalOr","bool"),r=N(n,"b","logicalOr","bool");je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(td,o)}var Wb=A({logicalOr_:Iae});function Tae(t,n){let e=N(t,"a","logicalXor","bool"),r=N(n,"b","logicalXor","bool");return je(e.shape,r.shape),cr(Wb(t,n),um(cr(t,n)))}var BL=A({logicalXor_:Tae});function Dae(t,n,e,r,o){let i=N(t,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),M(Vn(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),o!=null&&M(gt(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(cc,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var vd=A({maxPool_:Dae});function Nae(t,n=[1,1,1],e,r,o,i="NDHWC"){let s=N(t,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&M(gt(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(uc,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var dD=A({maxPool3d_:Nae});function kae(t,n){let e=N(t,"a","maximum"),r=N(n,"b","maximum");[e,r]=Ye(e,r),e.dtype==="bool"&&(e=ce(e,"int32"),r=ce(r,"int32")),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Sa,o)}var to=A({maximum_:kae});function Aae(t,n=null,e=!1){let o={x:N(t,"x","mean")},i={axis:n,keepDims:e};return k.runKernel(dc,o,i)}var Gt=A({mean_:Aae});function zt(t,n="float32"){if(n==="complex64"){let r=zt(t,"float32"),o=zt(t,"float32");return Ai(r,o)}let e=yf(Ot(t),n);return k.makeTensor(e,t,n)}function no(t,n="float32"){if(n==="complex64"){let r=no(t,"float32"),o=zt(t,"float32");return Ai(r,o)}let e=kg(Ot(t),n);return k.makeTensor(e,t,n)}function Rae(t,n=null,e=!1){let o={x:N(t,"x","min")},i={axis:n,keepDims:e};return k.runKernel(pc,o,i)}var Bc=A({min_:Rae});function Oae(t,n){let e=N(t,"a","minimum"),r=N(n,"b","minimum");[e,r]=Ye(e,r),e.dtype==="bool"&&(e=ce(e,"int32"),r=ce(r,"int32")),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Ea,o)}var bd=A({minimum_:Oae});function Mae(t,n,e){M(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=N(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");M(n.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${n.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)M(n[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),M(n[a][0]>=0&&n[a][0]<=r.shape[a]-o&&n[a][1]>=0&&n[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:n,mode:e},s={x:r};return k.runKernel(fc,s,i)}var zL=A({mirrorPad_:Mae});function Fae(t,n){let e=N(t,"a","mod"),r=N(n,"b","mod");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(Ia,o)}var UL=A({mod_:Fae});function Pae(t){let n=N(t,"x","square"),e={};return k.runKernel("Square",{x:n},e)}var We=A({square_:Pae});function $ae(t,n=null,e=!1){t=N(t,"x","moments");let r=bn(n,t.shape),o=Gt(t,r,e),i=o.shape;e||(i=ms(o.shape,r));let s=We(Se(ce(t,"float32"),B(o,i))),a=Gt(s,r,e);return{mean:o,variance:a}}var dm=A({moments_:$ae});function Lae(t,n){let e=N(t,"a","notEqual"),r=N(n,"b","notEqual");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(nd,o)}var zc=A({notEqual_:Lae});function Vae(t){let e={x:N(t,"x","onesLike")};return k.runKernel(hc,e)}var On=A({onesLike_:Vae});function Bae(t,n,e=0){let r=N(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:n,constantValue:e},i={x:r};return k.runKernel(xc,i,o)}var wd=A({pad_:Bae});function zae(t,n,e){let r=N(t,"x","spaceToBatchND");M(r.rank>=1+n.length,()=>`input rank ${r.rank} should be > than [blockShape] ${n.length}`),M(e.length===n.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${n.length}`),M(r.shape.reduce((s,a,l)=>l>0&&l<=n.length?s&&(a+e[l-1][0]+e[l-1][1])%n[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${n.toString()}`);let o={x:r},i={blockShape:n,paddings:e};return k.runKernel(Tc,o,i)}var pm=A({spaceToBatchND_:zae});function Uae(t,n,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=N(t,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]])),M(Vn(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let c=BT(a.shape,n,i,o,r),u=[c.dilationHeight,c.dilationWidth],d;r==="same"?d=Gae([c.filterHeight,c.filterWidth],u):d=[[0,0],[0,0]];let p=u[0]===1&&u[1]===1,[f,m]=jae([c.inHeight,c.inWidth],u,d),h=p?r:"valid",g=p?a:pm(a,u,f),b=(e==="avg"?()=>hd(g,n,i,h):()=>vd(g,n,i,h))(),S=p?b:sm(b,u,m);return l?B(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function jae(t,n,e){let r=e.map(u=>u[0]),o=e.map(u=>u[1]),i=t.concat(r,o),s=n.map((u,d)=>(u-i[d]%u)%u),a=o.map((u,d)=>u+s[d]),l=n.map((u,d)=>[r[d],a[d]]),c=n.map((u,d)=>[0,s[d]]);return[l,c]}function Gae(t,n){let r=t.map((s,a)=>s+(s-1)*(n[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var jL=A({pool_:Uae});function Wae(t,n){let e=N(t,"base","pow"),r=N(n,"exp","pow");[e,r]=Ye(e,r);let o={a:e,b:r};return k.runKernel(Da,o)}var Qo=A({pow_:Wae});function Hae(t,n){let e=N(t,"x","prelu"),r=N(n,"alpha","prelu"),o={x:e,alpha:r};return k.runKernel(vc,o)}var Cd=A({prelu_:Hae});function qae(t,n=null,e=!1){let r=N(t,"x","prod");r.dtype==="bool"&&(r=ce(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(Lf,o,i)}var GL=A({prod_:qae});var xD=Zm(i3());var fm=class{constructor(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=xD.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let n,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(n))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(n)}convertValue(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)}isValidTruncated(n){return n<=this.upper&&n>=this.lower}};var Kb=class{constructor(n=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${n} - ${e} <= 1 and dtype is not float`);this.random=xD.alea(o)}convertValue(n){return this.canReturnFloat()?n:Math.round(n)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function ele(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new fm(n,e,r,!1,o),s=Ee(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Xb=A({randomNormal_:ele});function tle(t,n=0,e=1,r="float32",o){let i=Ee(t,r),s=new Kb(n,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var Ja=A({randomUniform_:tle});function vD(t,n,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:n,step:e,dtype:r};return k.runKernel(Vf,{},o)}function nle(t){let e={input:N(t,"input","real")};return k.runKernel(Bf,e)}var Qg=A({real_:nle});function rle(t){let e={x:N(t,"x","reciprocal")};return k.runKernel(Na,e)}var bD=A({reciprocal_:rle});function ole(t){let e={x:N(t,"x","relu")};return k.runKernel(ka,e)}var Zo=A({relu_:ole});function ile(t){let e={x:N(t,"x","relu6")};return k.runKernel(Aa,e)}var Yb=A({relu6_:ile});function sle(t,n){let r={x:N(t,"x","reverse")},o={dims:n};return k.runKernel(_c,r,o)}var wo=A({reverse_:sle});function ale(t){let e={x:N(t,"x","round")};return k.runKernel(Ra,e)}var wD=A({round_:ale});function lle(t){let e={x:N(t,"x","rsqrt")};return k.runKernel(Oa,e)}var Zg=A({rsqrt_:lle});function Ae(t,n){if((Jr(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Jr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Fc(t,[],[],n)}function cle(t){let e={x:N(t,"x","selu")};return k.runKernel(Ma,e)}var Jg=A({selu_:cle});function ule(t,n,e,r,o,i=[1,1],s="NHWC"){let a=N(t,"x","separableConv2d"),l=N(n,"depthwiseFilter","separableConv2d"),c=N(e,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");M(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),M(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),M(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),M(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),M(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let p=l.shape[2],f=l.shape[3];M(c.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`);let m=Ya(u,l,r,o,s,i),g=eo(m,c,1,"valid",s);return d?B(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var ey=A({separableConv2d_:ule});function dle(t){let e={x:N(t,"x","sign")};return k.runKernel($a,e)}var CD=A({sign_:dle});function ple(t){let e={x:N(t,"x","sin")};return k.runKernel(Fa,e)}var ty=A({sin_:ple});function fle(t){let e={x:N(t,"x","sinh")};return k.runKernel(Pa,e)}var ny=A({sinh_:fle});function mle(t,n,e){let r=N(t,"x","slice1d");return M(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),st(r,[n],[e])}var ry=A({slice1d_:mle});function hle(t,n,e){let r=N(t,"x","slice2d");return M(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),st(r,n,e)}var Qb=A({slice2d_:hle});function gle(t,n,e){let r=N(t,"x","slice3d");return M(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),st(r,n,e)}var oy=A({slice3d_:gle});function yle(t,n,e){let r=N(t,"x","slice4d");return M(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),st(r,n,e)}var mm=A({slice4d_:yle});function xle(t,n=-1){let e=N(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${n}`);let r={logits:e},o={dim:n};return k.runKernel(Nc,r,o)}var Sd=A({softmax_:xle});function vle(t){M(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Af,n)}var iy=A({fft_:vle});function ble(t){M(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Of,n)}var hm=A({ifft_:ble});function wle(t){let n=t.shape[t.shape.length-1],e=t.size/n,r;if(n<=2){let o=B(t,[e,n]);r=hm(o)}else{let o=[e,2*(n-1)],i=B(Qg(t),[e,n]),s=B(jb(t),[e,n]),a=wo(st(i,[0,1],[e,n-2]),1),l=V(wo(st(s,[0,1],[e,n-2]),1),Ae(-1)),c=Bt([i,a],1),u=Bt([s,l],1),d=B(Ai(c,u),[o[0],o[1]]);r=hm(d)}if(r=Qg(r),t.rank===3&&t.shape[0]!==0){let o=r,i=t.shape[0];r=B(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var _D=A({irfft_:wle});function Cle(t,n,e=0){let o={x:N(t,"x","split")},i={numOrSizeSplits:n,axis:e};return k.runKernel(Dc,o,i)}var jn=A({split_:Cle});function _le(t,n){M(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let e=t.shape[t.shape.length-1],r=t.size/e,o;if(n!=null&&n<e){let m=t.shape.map(g=>0),h=t.shape.map(g=>g);h[t.shape.length-1]=n,o=st(t,m,h),e=n}else if(n!=null&&n>e){let m=t.shape.map(h=>h);m[t.shape.length-1]=n-e,o=Bt([t,zt(m)],t.shape.length-1),e=n}else o=t;let i=Ie(o),s=B(Ai(o,i),[r,e]),a=iy(s),l=Math.floor(e/2)+1,c=Qg(a),u=jb(a),d=jn(c,[l,e-l],c.shape.length-1),p=jn(u,[l,e-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,B(Ai(d[0],p[0]),f)}var SD=A({rfft_:_le});function Sle(t){let e={x:N(t,"x","sqrt")};return k.runKernel(Ba,e)}var Ut=A({sqrt_:Sle});function Ele(t,n){let e=N(t,"a","squaredDifference"),r=N(n,"b","squaredDifference");[e,r]=Ye(e,r),je(e.shape,r.shape);let o={a:e,b:r},i={};return k.runKernel(za,o,i)}var s3=A({squaredDifference_:Ele});function Ile(t,n){let e=N(t,"x","squeeze");return B(e,tT(e.shape,n).newShape)}var Ed=A({squeeze_:Ile});function Tle(t,n=0){let e=Db(t,"tensors","stack","string_or_numeric");M(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&M(n<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:n};return k.runKernel(yc,r,o)}var Qn=A({stack_:Tle});function Dle(t,n=0){let r={x:N(t,"x","step")},o={alpha:n};return k.runKernel(Wa,r,o)}var Fi=A({step_:Dle});function Nle(t,n,e,r,o=0,i=0,s=0,a=0,l=0){let u={x:N(t,"x","stridedSlice")},d={begin:n,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return k.runKernel(Gf,u,d)}var ED=A({stridedSlice_:Nle});function kle(t){let e={x:N(t,"x","tan")};return k.runKernel(ja,e)}var ID=A({tan_:kle});function Jo(t,n){Ng(t);let e=ld(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Fc(t,null,e,n)}function Uc(t,n,e){if(Ng(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=ld(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Fc(t,n,r,e)}function Ale(t,n=1,e=!0){let r=N(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(n>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${n}`);let i={x:r},s={k:n,sorted:e},[a,l]=k.runKernel(Wf,i,s);return{values:a,indices:l}}var a3=A({topk_:Ale});function Rle(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new fm(n,e,r,!0,o),s=Ee(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var sy=A({truncatedNormal_:Rle});function Ole(t,n=0){let e=N(t,"x","unique","string_or_numeric");M(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:n},[i,s]=k.runKernel(Hf,r,o);return{values:i,indices:s}}var l3=A({unique_:Ole});function Mle(t,n,e){let r=N(t,"x","unsortedSegmentSum"),o=N(n,"segmentIds","unsortedSegmentSum","int32");M(gt(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return k.runKernel(Rc,i,s)}var Zb=A({unsortedSegmentSum_:Mle});function Fle(t,n=0){let e=N(t,"x","unstack","string_or_numeric");M(n>=-e.shape.length&&n<e.shape.length,()=>`Axis = ${n} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:n};return k.runKernel(Ac,r,o)}var Pr=A({unstack_:Fle});function TD(t,n=!0,e,r){return k.makeVariable(t,n,e,r)}function c3(t,n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(i);let r=Ee(t,"int32"),o=Ee([e.length,t.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*t.length;o.values.set(s,a)}return o.toTensor()}function Ple(t,n="euclidean",e=null,r=!1){t=N(t,"x","norm");let o=u3(t,n,e),i=o.shape;if(r){let s=bn(e,t.shape);i=ms(o.shape,s)}return B(o,i)}function u3(t,n,e=null){if(t.rank===0)return wn(t);if(t.rank!==1&&e===null)return u3(B(t,[-1]),n,e);if(t.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(n===1)return we(wn(t),e);if(n===1/0)return Un(wn(t),e);if(n===-1/0)return Bc(wn(t),e);if(n==="euclidean"||n===2)return Ut(we(Qo(wn(t),Ae(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}if(Array.isArray(e)&&e.length===2){if(n===1)return Un(we(wn(t),e[0]),e[1]-1);if(n===1/0)return Un(we(wn(t),e[1]),e[0]);if(n===-1/0)return Bc(we(wn(t),e[1]),e[0]);if(n==="fro"||n==="euclidean")return Ut(we(We(t),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var gm=A({norm_:Ple});function d3(t,n){if(n==null)return t.shape.slice();if(is(t.shape,n))return n;if(t.shape.length===n.length){let e=[];for(let r=0;r<t.shape.length;r++)n[r]==null&&t.shape[r]!=null?e.push(t.shape[r]):e.push(n[r]);return e}return n}function $le(t,n,e,r){let o=N(t,"x","dropout");if(M(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),M(n>=0&&n<1,()=>`rate must be a float in the range [0, 1), but got ${n}.`),n===0)return t instanceof ut?o.clone():o;let i=d3(o,e),s=1-n,a=he(Za(te(Ja(i,0,1,"float32",r),s)),s);return V(o,a)}var p3=A({dropout_:$le});var kd={};Wi(kd,{conv2d:()=>f3,depthwiseConv2d:()=>m3,matMul:()=>h3});function Lle(t,n,e,r,o,i="NHWC",s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]])),M(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),M(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),M(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];M(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),M(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),s!=null&&M(gt(o),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let d={x:a,dy:l},p={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return k.runKernel(Sf,d,p)}var ym=A({conv2DBackpropFilter_:Lle});function Id(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return V(t,Fi(n));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Td(t,n){let e=n,r=Mt(t.shape,n.shape);return r.length>0&&(e=we(e,r)),B(e,t.shape)}function Dd(t,n,e,r){if(n==="linear")return t;if(n==="relu")return Zo(t);if(n==="elu")return Qa(t);if(n==="relu6")return Yb(t);if(n==="prelu")return Cd(t,e);if(n==="leakyrelu")return xd(t,r);if(n==="sigmoid")return Xo(t);throw new Error(`Unknown fused activation ${n}.`)}var Nd=(t,n)=>!(t>0)||n==="linear";function Vle({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Nd(k.state.gradientDepth,l)===!1){let E=eo(t,n,e,r,o,i,s);return a!=null&&(E=te(E,a)),Dd(E,l,c,u)}let d=N(t,"x","conv2d"),p=N(n,"filter","conv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),M(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),M(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),s!=null&&M(gt(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),M(f.shape[3]===p.shape[2],()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${p.shape[2]}.`),M(Vn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),M(o==="NHWC",()=>`Error in conv2d: got dataFormat of ${o} but only NHWC is currently supported.`);let h=md(f.shape,p.shape,e,i,r,s),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Ye(g,d),je(h.outShape,g.shape));let x;c!=null&&(x=N(c,"prelu weights","fused conv2d"));let b=(E,I)=>{let[D,O,R,$]=I,G=Id(E,R,l);M(xo(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let W=lm(O.shape,G,D,e,r),q=ym(O,G,D.shape,e,r),X=[W,q];if($!=null){let K=Td($,G);X.push(K)}return X},S={x:f,filter:p,bias:g,preluActivationWeights:x},_={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?bo((I,D,O)=>{let R=k.runKernel(od,S,_);return O([D,I,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(f,p):bo((I,D,O,R)=>{let $=k.runKernel(od,S,_);return R([D,I,$,O]),m&&($=B($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(f,p,g)}var f3=A({fusedConv2d_:Vle});function Ble(t,n,e,r,o,i=[1,1],s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return k.runKernel(Df,c,u)}var Jb=A({depthwiseConv2dNativeBackpropFilter_:Ble});function zle(t,n,e,r,o,i=[1,1],s){let a=n,l=!1;n.rank===3&&(l=!0,a=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={dy:a,filter:e},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:t},d=k.runKernel(Nf,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var ew=A({depthwiseConv2dNativeBackpropInput_:zle});function Ule({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(Nd(k.state.gradientDepth,l)===!1){let E=Ya(t,n,e,r,o,i,s);return a!=null&&(E=te(E,a)),Dd(E,l,c,u)}let d=N(t,"x","depthwiseConv2d"),p=N(n,"filter","depthwiseConv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),M(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),M(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),M(f.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),M(Vn(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),s!=null&&M(gt(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${s} but got pad ${r}.`);let h=md(f.shape,p.shape,e,i,r,s,!0),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Ye(g,d),je(h.outShape,g.shape));let x;c!=null&&(x=N(c,"prelu weights","fused depthwiseConv2d"));let b=(E,I)=>{M(xo(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[D,O,R,$]=I,G=Id(E,R,l),W=ew(O.shape,G,D,e,r,i,s),q=Jb(O,G,D.shape,e,r,i,s);if($!=null){let X=Td(g,G);return[W,q,X]}return[W,q]},S={x:f,filter:p,bias:g,preluActivationWeights:x},_={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?bo((I,D,O)=>{let R=k.runKernel(id,S,_);return O([D,I,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(f,p):bo((I,D,O,R)=>{let $=k.runKernel(id,S,_);return R([D,I,$,O]),m&&($=B($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(f,p,g)}var m3=A({fusedDepthwiseConv2d_:Ule});function jle({a:t,b:n,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a}){if(Nd(k.state.gradientDepth,i)===!1){let $=yt(t,n,e,r);return o!=null&&($=te($,o)),Dd($,i,s,a)}let l=N(t,"a","fused matMul"),c=N(n,"b","fused matMul");[l,c]=Ye(l,c);let u=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=e?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],m=l.shape.slice(0,-2),h=c.shape.slice(0,-2),g=Ot(m),x=Ot(h);M(l.rank>=2&&c.rank>=2&&l.rank===c.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${l.rank} and ${c.rank}.`),M(is(m,h),()=>`Error in fused matMul: outer dimensions (${m}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} must match.`),M(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let b=l.shape.slice(0,-2).concat([p,f]),S=e?B(l,[g,u,p]):B(l,[g,p,u]),_=r?B(c,[x,f,d]):B(c,[x,d,f]),E;o!=null&&(E=N(o,"bias","fused matMul"),[E]=Ye(E,l),je(b,E.shape));let I;s!=null&&(I=N(s,"prelu weights","fused matMul"));let D=($,G)=>{let[W,q,X,K]=G,Y=Id(B($,X.shape),X,i),re,J;if(!e&&!r?(re=yt(Y,q,!1,!0),J=yt(W,Y,!0,!1)):!e&&r?(re=yt(Y,q,!1,!1),J=yt(Y,W,!0,!1)):e&&!r?(re=yt(q,Y,!1,!0),J=yt(W,Y,!1,!1)):(re=yt(q,Y,!0,!0),J=yt(Y,W,!0,!0)),o!=null){let ne=Td(K,Y);return[re,J,ne]}else return[re,J]},O={a:S,b:_,bias:E,preluActivationWeights:I},R={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?bo((G,W,q)=>{let X=k.runKernel(rd,O,R);return q([G,W,X]),{value:B(X,b),gradFunc:D}})(S,_):bo((G,W,q,X)=>{let K=k.runKernel(rd,O,R);return X([G,W,K,q]),{value:B(K,b),gradFunc:D}})(S,_,E)}var h3=A({fusedMatMul_:jle});function g3(t,n,e){let r=Gle(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function Gle(t,n,e){return Hle(t,n,e||Wle)}function Wle(t,n){return t>n?1:t<n?-1:0}function Hle(t,n,e){let r=0,o=t.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(n,t[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function x3(t,n,e,r,o){return DD(t,n,e,r,o,0)}function v3(t,n,e,r,o,i){return DD(t,n,e,r,o,0,!1,i,!0)}function b3(t,n,e,r,o,i){return DD(t,n,e,r,o,i,!0)}function DD(t,n,e,r,o,i,s=!1,a=!1,l=!1){let c=[];for(let g=0;g<n.length;g++)n[g]>o&&c.push({score:n[g],boxIndex:g,suppressBeginIndex:0});c.sort(y3);let u=i>0?-.5/i:0,d=[],p=[];for(;d.length<e&&c.length>0;){let g=c.pop(),{score:x,boxIndex:b,suppressBeginIndex:S}=g;if(x<o)break;let _=!1;for(let E=d.length-1;E>=S;--E){let I=qle(t,b,d[E]);if(I>=r){_=!0;break}if(g.score=g.score*Kle(r,u,I),g.score<=o)break}g.suppressBeginIndex=d.length,_||(g.score===x?(d.push(b),p.push(g.score)):g.score>o&&g3(c,g,y3))}let f=d.length,m=e-f;a&&m>0&&(d.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));let h={selectedIndices:d};return s&&(h.selectedScores=p),l&&(h.validOutputs=f),h}function qle(t,n,e){let r=t.subarray(n*4,n*4+4),o=t.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(a-i)*(l-s),m=(d-c)*(p-u);if(f<=0||m<=0)return 0;let h=Math.max(i,c),g=Math.max(s,u),x=Math.min(a,d),b=Math.min(l,p),S=Math.max(x-h,0)*Math.max(b-g,0);return S/(f+m-S)}function Kle(t,n,e){let r=Math.exp(n*e*e);return e<=t?r:0}function y3(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function Xle(t,n,e=!1,r=!1){let o=N(t,"images","resizeBilinear");M(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),M(n.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${n}.`),M(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(Cc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var w3=A({resizeBilinear_:Xle});function Yle(t,n,e=!1,r=!1){let o=N(t,"images","resizeNearestNeighbor");M(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),M(n.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${n}.`),M(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),M(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(wc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var C3=A({resizeNearestNeighbor_:Yle});function Qle(t,n,e){M(n%1===0,()=>`bandPart(): numLower must be an integer, got ${n}.`),M(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`);let r=N(t,"a","bandPart");M(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2);if(!(n<=i))throw new Error(`bandPart(): numLower (${n}) must not be greater than the number of rows (${i}).`);if(!(e<=s))throw new Error(`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`);n<0&&(n=i),e<0&&(e=s);let a=B(vD(0,i,1,"int32"),[-1,1]),l=vD(0,s,1,"int32"),c=Se(a,l),u=cr(ps(c,Ae(+n,"int32")),vo(c,Ae(-e,"int32"))),d=zt([i,s],r.dtype);return B(Qn(Pr(B(r,[-1,i,s])).map(p=>an(u,p,d))),o)}var _3=A({bandPart_:Qle});function Zle(t){let n;if(Array.isArray(t)){n=!1,M(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let i=1;i<t.length;++i)M(t[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${o})`)}else n=!0,t=jn(t,t.shape[0],0).map(o=>Ed(o,[0]));M(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let e=[],r=t;for(let o=0;o<t.length;++o)e.push(k.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=V(we(V(e[s],i)),e[s]);i=Se(i,a)}return he(i,gm(i,"euclidean"))}));return n?Qn(e,0):e}var S3=A({gramSchmidt_:Zle});function Jle(t,n=!1){if(M(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return E3(t,n);{let e=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),r=Pr(B(t,[e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[c,u]=E3(l,n);o.push(c),i.push(u)});let s=B(Qn(o,0),t.shape),a=B(Qn(i,0),t.shape);return[s,a]}}function E3(t,n=!1){return k.tidy(()=>{M(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let e=t.shape[0],r=t.shape[1],o=cm(e),i=Oi(t),s=Uc([[1]],[1,1]),a=Oi(s),l=e>=r?r:e;for(let c=0;c<l;++c){let u=i,d=a,p=o;[a,i,o]=k.tidy(()=>{let f=st(i,[c,c],[e-c,1]),m=gm(f),h=st(i,[c,c],[1,1]),g=an(zn(h,0),Uc([[-1]]),Uc([[1]])),x=Se(h,V(g,m)),b=he(f,x);b.shape[0]===1?a=Oi(s):a=Bt([s,st(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);let S=xt(he(yt(g,x),m)),_=st(i,[c,0],[e-c,r]),E=V(S,a),I=ot(a);if(c===0)i=Se(_,yt(E,yt(I,_)));else{let R=Se(_,yt(E,yt(I,_)));i=Bt([st(i,[0,0],[c,r]),R],0)}let D=ot(E),O=st(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=Se(O,yt(yt(O,a),D));else{let R=Se(O,yt(yt(O,a),D));o=Bt([st(o,[0,0],[e,c]),R],1)}return[a,i,o]}),Fe([u,d,p])}return!n&&e>r&&(o=st(o,[0,0],[e,r]),i=st(i,[0,0],[r,r])),[o,i]})}var I3=A({qr_:Jle});var T3={bandPart:_3,gramSchmidt:S3,qr:I3};var Zn=class extends Ug{minimize(n,e=!1,r){let{value:o,grads:i}=this.computeGradients(n,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return Fe(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(n,e){return iD(n,e)}dispose(){this.iterations_!=null&&Fe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ae(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(n){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(n){return this.iterations_=(await n[0].tensor.data())[0],n.slice(1)}};Object.defineProperty(Zn,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var ND=(()=>{class t extends Zn{constructor(e,r,o=null){super(),this.learningRate=e,this.rho=r,this.epsilon=o,this.accumulatedGrads=[],this.accumulatedUpdates=[],o==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accum_grad`,variable:z(()=>Ie(s).variable(a))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${o}/accum_var`,variable:z(()=>Ie(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedGrads[i].variable,u=this.accumulatedUpdates[i].variable;z(()=>{let d=te(V(c,this.rho),V(We(l),1-this.rho)),p=V(he(Ut(te(u,this.epsilon)),Ut(te(c,this.epsilon))),l),f=te(V(u,this.rho),V(We(p),1-this.rho));c.assign(d),u.assign(f);let m=te(V(p,-this.learningRate),s);s.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Fe(this.accumulatedGrads.map(e=>e.variable)),Fe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,o=!1;this.accumulatedGrads=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedUpdates=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}}return t.className="Adadelta",t})();Fr(ND);var kD=(()=>{class t extends Zn{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accumulator`,variable:z(()=>Kg(s.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[i].tensor:e[o];if(a==null)return;let l=this.accumulatedGrads[i].variable;z(()=>{let c=te(l,We(a));l.assign(c);let u=te(V(he(a,Ut(te(c,k.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Fe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}}return t.className="Adagrad",t})();Fr(kD);var AD=(()=>{class t extends Zn{constructor(e,r,o,i=null){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],z(()=>{this.accBeta1=Ae(r).variable(),this.accBeta2=Ae(o).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);z(()=>{let o=Se(1,this.accBeta1),i=Se(1,this.accBeta2);r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:z(()=>Ie(l).variable(c))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${s}/v`,variable:z(()=>Ie(l).variable(c))});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,f=te(V(d,this.beta1),V(u,1-this.beta1)),m=te(V(p,this.beta2),V(We(u),1-this.beta2)),h=he(f,o),g=he(m,i);d.assign(f),p.assign(m);let x=te(V(he(h,te(Ut(g),this.epsilon)),-this.learningRate),l);l.assign(x)}),this.accBeta1.assign(V(this.accBeta1,this.beta1)),this.accBeta2.assign(V(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Fe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Fe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),z(()=>{this.accBeta1.assign(Qo(this.beta1,this.iterations_+1)),this.accBeta2.assign(Qo(this.beta2,this.iterations_+1))});let r=e.length/2,o=!1;this.accumulatedFirstMoment=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}}return t.className="Adam",t})();Fr(AD);var RD=(()=>{class t extends Zn{constructor(e,r,o,i=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],z(()=>{this.iteration=Ae(0).variable(),this.accBeta1=Ae(r).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);z(()=>{let o=Se(1,this.accBeta1),i=he(-this.learningRate,te(V(this.iteration,this.decay),1));r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:Ie(l).variable(c)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${s}/v`,variable:Ie(l).variable(c)});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,f=te(V(d,this.beta1),V(u,1-this.beta1)),m=V(p,this.beta2),h=wn(u),g=to(m,h);d.assign(f),p.assign(g);let x=te(V(he(i,o),he(f,te(g,this.epsilon))),l);l.assign(x)}),this.iteration.assign(te(this.iteration,1)),this.accBeta1.assign(V(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Fe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Fe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}}return t.className="Adamax",t})();Fr(RD);var ay=(()=>{class t extends Zn{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=Array.isArray(e)?e[i].tensor:e[o];if(s==null)return;let a=k.registeredVariables[o];z(()=>{let l=te(V(this.c,s),a);a.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Rn(Ae(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}}return t.className="SGD",t})();Fr(ay);var OD=(()=>{class t extends ay{constructor(e,r,o=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=o,this.accumulations=[],this.m=Ae(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${o}/momentum`,variable:z(()=>Ie(s).variable(!1))});let a=this.accumulations[i].variable,l=Array.isArray(e)?e[i].tensor:e[o];l!=null&&z(()=>{let c,u=te(V(this.m,a),l);this.useNesterov?c=te(V(this.c,te(l,V(u,this.m))),s):c=te(V(this.c,u),s),a.assign(u),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Fe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}}return t.className="Momentum",t})();Fr(OD);var MD=(()=>{class t extends Zn{constructor(e,r=.9,o=0,i=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=o,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=k.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${o}/rms`,variable:z(()=>Ie(s).variable(a))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${o}/momentum`,variable:z(()=>Ie(s).variable(a))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${o}/mg`,variable:z(()=>Ie(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedMeanSquares[i].variable,u=this.accumulatedMoments[i].variable;z(()=>{let d=te(V(c,this.decay),V(We(l),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[i].variable,f=te(V(p,this.decay),V(l,1-this.decay)),m=he(V(l,this.learningRate),Ut(Se(d,te(We(f),this.epsilon)))),h=te(V(u,this.momentum),m);c.assign(d),p.assign(f),u.assign(h);let g=Se(s,h);s.assign(g)}else{let p=te(V(c,this.decay),V(We(l),1-this.decay)),f=te(V(u,this.momentum),he(V(l,this.learningRate),Ut(te(p,this.epsilon))));c.assign(p),u.assign(f);let m=Se(s,f);s.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Fe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Fe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Fe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,o=!1;this.accumulatedMeanSquares=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedMoments=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}}return t.className="RMSProp",t})();Fr(MD);var hs=class{static sgd(n){return new ay(n)}static momentum(n,e,r=!1){return new OD(n,e,r)}static rmsprop(n,e=.9,r=0,o=null,i=!1){return new MD(n,e,r,o,i)}static adam(n=.001,e=.9,r=.999,o=null){return new AD(n,e,r,o)}static adadelta(n=.001,e=.95,r=null){return new ND(n,e,r)}static adamax(n=.002,e=.9,r=.999,o=null,i=0){return new RD(n,e,r,o,i)}static adagrad(n,e=.1){return new kD(n,e)}};var Ad={sgd:hs.sgd,momentum:hs.momentum,adadelta:hs.adadelta,adagrad:hs.adagrad,rmsprop:hs.rmsprop,adamax:hs.adamax,adam:hs.adam};var ece=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function ly(){return new Promise(t=>ece(()=>t()))}var T={};Wi(T,{ERF_A1:()=>dce,ERF_A2:()=>pce,ERF_A3:()=>fce,ERF_A4:()=>mce,ERF_A5:()=>hce,ERF_P:()=>uce,PARALLELIZE_THRESHOLD:()=>tw,SELU_SCALE:()=>PD,SELU_SCALEALPHA:()=>FD,applyActivation:()=>Dd,assertAndGetBroadcastShape:()=>je,assertAxesAreInnerMostDims:()=>wae,assertParamsConsistent:()=>tce,assignToTypedArray:()=>_ce,axesAreInnerMostDims:()=>aD,calculateShapes:()=>Fie,checkEinsumDimSizes:()=>Nce,combineLocations:()=>LL,complexWithEvenIndex:()=>bce,complexWithOddIndex:()=>wce,computeConv2DInfo:()=>md,computeConv3DInfo:()=>kL,computeDefaultPad:()=>zT,computeDilation2DInfo:()=>rse,computeOptimalWindowSize:()=>rce,computeOutAndReduceShapes:()=>lD,computeOutShape:()=>nce,computePool2DInfo:()=>BT,computePool3DInfo:()=>ose,convertConv2DDataFormat:()=>AL,decodeEinsumEquation:()=>Tce,eitherStridesOrDilationsAreOne:()=>Vn,expandShapeToKeepDim:()=>ms,exponent:()=>Ece,exponents:()=>Sce,fromStringArrayToUint8:()=>Lce,fromUint8ToStringArray:()=>$ce,getAxesPermutation:()=>cD,getBroadcastDims:()=>zse,getComplexWithIndex:()=>Cce,getEinsumComputePath:()=>kce,getEinsumPermutation:()=>Dce,getFusedBiasGradient:()=>Td,getFusedDyActivation:()=>Id,getImageCenter:()=>oce,getInnerMostAxes:()=>Cae,getPermuted:()=>sce,getReductionAxes:()=>Mt,getReshaped:()=>ice,getReshapedPermuted:()=>ace,getSliceBeginCoords:()=>lce,getSliceSize:()=>cce,getUndoAxesPermutation:()=>Yg,isIdentityPermutation:()=>Ace,log:()=>yce,mergeRealAndImagArrays:()=>xce,prepareAndValidate:()=>Oie,prepareSplitSize:()=>Oce,segment_util:()=>LD,shouldFuse:()=>Nd,slice_util:()=>Xn,splitRealAndImagArrays:()=>vce,tupleValuesAreOne:()=>xo,upcastType:()=>_n,validateInput:()=>Mie,validateUpdateShape:()=>gL,warn:()=>gce});function tce(t,n){let e=t[0].length;t.forEach((o,i)=>{M(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),M(n>=0&&n<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=t[0];t.forEach((o,i)=>{for(let s=0;s<e;s++)M(s===n||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function nce(t,n){let e=t[0].slice();for(let r=1;r<t.length;r++)e[n]+=t[r][n];return e}var tw=30;function rce(t){return t<=tw?t:gf(t,Math.floor(Math.sqrt(t)))}function oce(t,n,e){let r=e*(typeof t=="number"?t:t[0]),o=n*(typeof t=="number"?t:t[1]);return[r,o]}function ice(t,n,e,r=!0){let o=[];if(r)o=o.concat(n.slice(0)),o.push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let i=n.length;for(let s=0;s<i;++s)o=o.concat([t[s+1]/n[s],n[s]]);o=o.concat(t.slice(i+1))}return o}function sce(t,n,e=!0){let r=[];if(e){r.push(n);for(let o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<t;++s)s>=n*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function ace(t,n,e,r=!0){let o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(let i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function lce(t,n){let e=[0];for(let r=0;r<n;++r)e.push(t[r][0]);return e}function cce(t,n,e){let r=t.slice(0,1);for(let o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}var FD=1.7580993408473768,PD=1.0507009873554805;var uce=.3275911,dce=.254829592,pce=-.284496736,fce=1.421413741,mce=-1.453152027,hce=1.061405429;function gce(...t){H().getBool("IS_TEST")||console.warn(...t)}function yce(...t){H().getBool("IS_TEST")||console.log(...t)}function xce(t,n){if(t.length!==n.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${n.length}.`);let e=new Float32Array(t.length*2);for(let r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function vce(t){let n=new Float32Array(t.length/2),e=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=t[r],e[r/2]=t[r+1];return{real:n,imag:e}}function bce(t){let n=Math.ceil(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=0;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function wce(t){let n=Math.floor(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=2;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function Cce(t,n){let e=t[n*2],r=t[n*2+1];return{real:e,imag:r}}function _ce(t,n,e,r){t[r*2]=n,t[r*2+1]=e}function Sce(t,n){let e=new Float32Array(t/2),r=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let i=(n?2:-2)*Math.PI*(o/t);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function Ece(t,n,e){let r=(e?2:-2)*Math.PI*(t/n),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var $D="->",Ice=/->/g,D3=",",N3="...";function Tce(t,n){t=t.replace(/\s/g,"");let e=(t.length-t.replace(Ice,"").length)/$D.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${$D}").`);let[r,o]=t.split($D);M(r.indexOf(N3)===-1,()=>`The ellipsis notation ("${N3}") is not supported yet.`);let i=r.split(D3),s=i.length;if(n!==s)throw new Error(`Expected ${s} input tensors, received ${n}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let p=0;p<o.length;++p){let f=o[p];if(!i.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<r.length;++p){let f=r[p];a.indexOf(f)===-1&&f!==D3&&a.push(f)}let l=new Array(i.length);for(let p=0;p<s;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let f=0;f<i[p].length;++f)l[p].push(a.indexOf(i[p][f]))}let c=a.length,u=o.length,d=[];for(let p=u;p<c;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function Dce(t,n){let e=new Array(t);e.fill(-1);for(let o=0;o<n.length;++o)e[n[o]]=o;let r=[];for(let o=0;o<t;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function Nce(t,n,e){let r=new Array(t);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<n[o].length;++s)r[n[o][s]]===void 0?r[n[o][s]]=i[s]:M(r[n[o][s]]===i[s],()=>`Expected dimension ${r[n[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function kce(t,n){let e=t,r=[],o=0;t.length===0&&e.push(-1),o=t.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=Rce(n,a);for(let c of l)i.indexOf(c)===-1&&(r[s].push(c),i.push(c))}return{path:e,steps:r}}function Ace(t){return t.every((n,e)=>n===e)}function Rce(t,n){let e=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(n)!==-1||n===-1)&&e.push(r);return e}function Oce(t,n,e=0){let r=[];if(typeof n=="number")M(t.shape[e]%n===0,()=>"Number of splits must evenly divide the axis."),r=new Array(n).fill(t.shape[e]/n);else{let o=n.reduce((s,a)=>(a===-1&&(s+=1),s),0);M(o<=1,()=>"There should be only one negative value in split array.");let i=n.indexOf(-1);if(i!==-1){let s=n.reduce((a,l)=>l>0?a+l:a);n[i]=t.shape[e]-s}M(t.shape[e]===n.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=n}return r}var LD={};Wi(LD,{collectGatherOpShapeInfo:()=>Pce,computeOutShape:()=>Fce,segOpComputeOptimalWindowSize:()=>Mce});function Mce(t,n){let e=!1,r;for(t<=tw?(r=t,e=!0):r=gf(t,Math.floor(Math.sqrt(t)));!e;)r>n||r===t?e=!0:r=gf(t,r+1);return r}function Fce(t,n,e){let r=[],o=t.length;for(let i=0;i<o;i++)i!==n?r.push(t[i]):r.push(e);return r}function Pce(t,n,e,r){let o=n.shape.length,i=t.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let d=0;d<r;++d)if(t.shape[d]!==n.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${n.shape[d]}.`);let s=t.shape[e],a=[],l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=r;d<e;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=r;d<o;d++)a.push(n.shape[d]);for(let d=e+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}function $ce(t){try{return t.map(n=>Xf(n))}catch(n){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${n}`)}}function Lce(t){return t.map(n=>Kf(n))}var Jn={};Wi(Jn,{nonMaxSuppressionV3Impl:()=>x3,nonMaxSuppressionV4Impl:()=>v3,nonMaxSuppressionV5Impl:()=>b3,whereImpl:()=>c3});var nw={kernelName:Ul,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Fi(ce(e,"float32"),-1))}}};var k3={kernelName:ea,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=We(ce(e,"float32")),o=Ut(Se(Ae(1),r));return xt(he(t,o))}}}};var A3={kernelName:ta,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Ut(Se(We(ce(e,"float32")),1));return he(t,r)}}}};var R3={kernelName:Ni,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=t,l=Mt(e.shape,o);return l.length>0&&(a=we(a,l)),B(a,e.shape)},b:()=>{let a=t,l=Mt(r.shape,o);return l.length>0&&(a=we(a,l)),B(a,r.shape)}}}};var O3={kernelName:xf,saveAllInputs:!0,gradFunc:(t,n)=>{let e={};return n.forEach((r,o)=>{e[o]=()=>t.clone()}),e}};var M3={kernelName:jl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Ie(e)}}};var F3={kernelName:Gl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Ie(e)}}};var P3={kernelName:na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,Ut(Se(Ae(1),We(ce(e,"float32")))))}}};var $3={kernelName:ra,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Ut(te(Ae(1),We(ce(e,"float32"))));return he(t,r)}}}};var L3={kernelName:sa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=te(We(e),We(r)),l=V(t,he(r,a)),c=Mt(e.shape,o);return c.length>0&&(l=we(l,c)),B(l,e.shape)},b:()=>{let a=te(We(e),We(r)),l=xt(V(t,he(e,a))),c=Mt(r.shape,o);return c.length>0&&(l=we(l,c)),B(l,r.shape)}}}};var V3={kernelName:oa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,te(We(ce(e,"float32")),1))}}};var B3={kernelName:ia,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,Se(Ae(1),We(ce(e,"float32"))))}}};function Vce(t,n,e,r,o,i){let s=N(t,"dy","avgPool3dGrad"),a=N(n,"input","avgPool3dGrad"),l=s,c=a,u=!1;a.rank===4&&(u=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),M(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),M(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),i!=null&&M(gt(o),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let d={dy:l,input:c},p={filterSize:e,strides:r,pad:o,dimRoundingMode:i},f=k.runKernel(Cf,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var z3=A({avgPool3dGrad_:Vce});var U3={kernelName:Hl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>z3(t,r,o,i,s,a)}}};function Bce(t,n,e,r,o){let i=N(t,"dy","avgPoolGrad"),s=N(n,"input","avgPoolGrad");M(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,c=!1;s.rank===3&&(c=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),M(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:l,input:a},d={filterSize:e,strides:r,pad:o},p=k.runKernel(wf,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var j3=A({avgPoolGrad_:Bce});var G3={kernelName:Wl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s}=e;return{x:()=>j3(t,r,o,i,s)}}};var W3={kernelName:ql,inputsToSave:["a","b"],gradFunc:(t,n,e)=>{let[r,o]=n,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>yt(t,o,!1,!0),b:()=>yt(r,t,!0,!1)}:!i&&s?{a:()=>yt(t,o,!1,!1),b:()=>yt(t,r,!0,!1)}:i&&!s?{a:()=>yt(o,t,!1,!0),b:()=>yt(r,t,!1,!1)}:{a:()=>yt(o,t,!0,!0),b:()=>yt(t,r,!0,!0)}}};var H3={kernelName:Kl,gradFunc:(t,n,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>pm(t,r,o)}}};var q3={kernelName:b$,gradFunc:(t,n,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>we(t,a,!0)}}};var K3={kernelName:as,gradFunc:t=>({x:()=>t.clone()})};var X3={kernelName:aa,gradFunc:t=>({x:()=>Ie(t)})};var Y3={kernelName:la,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>an(cr(vo(r,o),ps(r,i)),t,Ie(t))}}};var Q3={kernelName:Xl,inputsToSave:["x"],gradFunc:nw.gradFunc};var Z3={kernelName:Yl,saveAllInputs:!0,gradFunc:(t,n,e)=>{let r=n.map(l=>l.shape),{axis:o}=e,i=bn(o,n[0].shape)[0],s=r.map(l=>l[i]);return jn(t,s,i).map(l=>()=>l)}};var J3={kernelName:Ql,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return M(xo(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>lm(r.shape,t,o,s,a,l),filter:()=>ym(r,t,o.shape,s,a,l)}}};var eV={kernelName:Zl,inputsToSave:["dy","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>eo(t,o,i,s,a,1,l),filter:()=>ym(t,r,o.shape,i,s,a,l)}}};function zce(t,n,e,r,o){let i=t;t.rank===4&&(i=B(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let s=n;s.rank===4&&(s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]])),M(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),M(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),M(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),M(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),M(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return k.runKernel(Ef,a,l)}var tV=A({conv3DBackpropFilter_:zce});var nV={kernelName:Jl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i}=e;M(xo(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=n;return{x:()=>zb(s.shape,t,a,o,i),filter:()=>tV(s,t,a.shape,o,i)}}};var rV={kernelName:ca,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(xt(ty(ce(e,"float32"))),t)}}};var oV={kernelName:ua,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(ny(ce(e,"float32")),t)}}};var iV={kernelName:ec,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=cD([o],r.rank),l=Ub(t,o,i,!s);return a!=null&&(l=ot(l,a)),l}}}};var sV={kernelName:tc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];M(xo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,c]=n;return M(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),M(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),M(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),M(Vn(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),s!=null&&M(gt(i),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`),{x:()=>ew(l.shape,t,c,o,i,r,s),filter:()=>Jb(l,t,c.shape,o,i,r,s)}}};var aV={kernelName:nc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,i={x:r,filter:o,dy:t},s={x:r,filter:o,dy:t};return{x:()=>k.runKernel(Fg,i,e),filter:()=>k.runKernel(Pg,s,e)}}};var lV={kernelName:pa,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n,r={dy:t,y:e};return{x:()=>k.runKernel(kf,r)}}};var cV={kernelName:fa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(xr(xt(We(e))),2/Math.sqrt(Math.PI));return{x:()=>V(t,r)}}};var uV={kernelName:ma,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,e)}}};var dV={kernelName:rc,inputsToSave:["input"],gradFunc:(t,n)=>{let[e]=n;return{input:()=>B(t,e.shape)}}};var pV={kernelName:ha,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,xr(e))}}};var fV={kernelName:ga,gradFunc:t=>({x:()=>Ie(t)})};var mV={kernelName:ya,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=he(t,ce(r,"float32")),l=Mt(e.shape,o);return l.length>0?B(we(a,l),e.shape):a},b:()=>{let a=V(t,ce(e,"float32")),l=Mt(r.shape,o);l.length>0&&(a=B(we(a,l),r.shape));let c=We(r);return xt(he(a,ce(c,"float32")))}}}};var hV={kernelName:oc,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,n,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=n,l=a??Ae(1),c=Mt(i.shape,o.shape),u=[];if(i.rank===1){for(let _=0;_<o.shape.length-1;++_)u.push(o.shape[_]);u.push(1)}let d=Se(o,i),p=V(t,l),f=Zg(te(s,Ae(r))),m=V(V(V(f,f),f),Ae(-.5));return{x:()=>i.rank===1?B(V(V(t,Mi(B(f,[1,1,1,i.shape[0]]),u)),l),o.shape):B(V(V(t,f),l),o.shape),mean:()=>{let _=V(V(f,Ae(-1)),p);return i.rank===1&&(_=we(_,c)),B(_,i.shape)},variance:()=>{let _=V(V(m,d),p);return i.rank===1&&(_=we(_,c)),B(_,i.shape)},scale:()=>{let _=V(d,f),E=V(t,_);return i.rank===1&&(E=we(E,c)),B(E,i.shape)},offset:()=>{let _=t;return i.rank===1&&(_=we(_,c)),B(_,i.shape)}}}};var xV={kernelName:ic,inputsToSave:["x","indices"],gradFunc:(t,n,e)=>{let[r,o]=n,{axis:i}=e,s=bn(i,r.shape)[0];return{x:()=>{let l=r.shape,c=o.size,u=l.slice(0,s),d=u.length,p=l.slice(i,l.length).slice(1),f=p.length,m=gV(0,d),h=gV(d+1,d+1+f),g=yV([u,[c],p]),x=B(t,g),b=B(o,[c]),S=yV([[d],m,h]),_=ot(x,S),E=Zb(_,b,r.shape[s]),I=Yg(S);return E=ot(E,I),E},indices:()=>o}}};function gV(t,n){let e=[];for(let r=t;r<n;++r)e.push(r);return e}function yV(t){let n=[];for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var vV={kernelName:xa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>Ie(e),b:()=>Ie(r)}}};var bV={kernelName:ls,gradFunc:t=>({x:()=>ce(t,"float32")})};var wV={kernelName:va,gradFunc:t=>({x:()=>Ie(t)})};var CV={kernelName:ba,gradFunc:t=>({x:()=>Ie(t)})};var _V={kernelName:wa,gradFunc:t=>({x:()=>Ie(t)})};var SV={kernelName:sc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{alpha:o}=e,i=zn(r,0);return{x:()=>an(i,t,V(t,o))}}};var EV={kernelName:_a,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,te(e,1))}}};var IV={kernelName:Ca,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,ce(e,"float32"))}}};var TV={kernelName:w$,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e;return{logits:()=>{let s=xr(r);return Se(t,V(we(t,o,!0),s))}}}};function Uce(t,n,e,r=5,o=1,i=1,s=.5){let a={x:t,y:n,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return k.runKernel(Ff,a,l)}var DV=A({localResponseNormalizationBackprop_:Uce});var NV={kernelName:ac,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>DV(r,o,t,i,s,a,l)}}};function rw(t,n,e,r){return n.rank<e.rank&&(n=B(n,ms(n.shape,r))),t.rank<e.rank&&(t=B(t,ms(t.shape,r))),{x:()=>V(t,ce(Yo(e,n),t.dtype))}}var VD={kernelName:lc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{reductionIndices:o}=r,i=n[0],s=n[1],a=bn(o,i.shape),l=rw(t,s,i,a);return{x:()=>l.x()}}};var kV={kernelName:Sa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,ce(vo(e,r),"float32")),b:()=>V(t,ce(Gb(e,r),"float32"))}}};function jce(t,n,e,r,o,i,s){let a=N(t,"dy","maxPool3dGrad"),l=N(n,"input","maxPool3dGrad"),c=N(e,"output","maxPool3dGrad"),u=a,d=l,p=c,f=!1;l.rank===4&&(f=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=B(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=B(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),M(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),M(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),M(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),s!=null&&M(gt(i),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let m={dy:u,input:d,output:p},h={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=k.runKernel($f,m,h);return f?B(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var AV=A({maxPool3dGrad_:jce});var RV={kernelName:uc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>AV(t,r,o,i,s,a,l)}}};function Gce(t,n,e,r,o,i,s){let a=N(t,"dy","maxPoolGrad"),l=N(n,"input","maxPoolGrad"),c=N(e,"output","maxPoolGrad");M(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),M(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),M(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),s!=null&&M(gt(i),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return k.runKernel(Pf,u,d)}var OV=A({maxPoolGrad_:Gce});var MV={kernelName:cc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a}=e;return{x:()=>OV(t,r,o,i,s,a)}}};var FV={kernelName:dc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=bn(o,r.shape),a=lD(r.shape,i)[1],l=Ot(a);return{x:()=>{let u=r.shape.slice();i.forEach(f=>{u[f]=1});let d=B(t,u);return he(V(d,no(r.shape,"float32")),l)}}}};var PV={kernelName:pc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{axis:o}=r,[i,s]=n,a=bn(o,i.shape),l=rw(t,s,i,a);return{x:()=>l.x()}}};var $V={kernelName:Ea,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,ce(ps(e,r),"float32")),b:()=>V(t,ce(zn(e,r),"float32"))}}};var LV={kernelName:fc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>st(t,i,r.shape)}}};var VV={kernelName:Ia,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=Mt(e.shape,o);return a.length>0?B(we(t,a),e.shape):t},b:()=>{let a=V(t,xt(Za(he(e,r)))),l=Mt(r.shape,o);return l.length>0?B(we(a,l),r.shape):a}}}};var BV={kernelName:Ta,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=V(t,ce(r,"float32")),l=Mt(e.shape,o);return l.length>0?B(we(a,l),e.shape):a},b:()=>{let a=V(t,ce(e,"float32")),l=Mt(r.shape,o);return l.length>0?B(we(a,l),r.shape):a}}}};var zV={kernelName:mc,gradFunc:t=>({x:()=>xt(t)})};var UV={kernelName:gc,inputsToSave:["indices"],gradFunc:(t,n)=>{let e=n[0];return{indices:()=>zt(e.shape,"float32")}}};var jV={kernelName:hc,gradFunc:t=>({x:()=>Ie(t)})};var GV={kernelName:yc,saveAllInputs:!0,gradFunc:(t,n,e)=>{let{axis:r}=e;return Pr(t,r).map(i=>()=>i)}};var BD={kernelName:xc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>st(t,i,r.shape)}}};var WV={kernelName:Da,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,n)=>{let[e,r,o]=n,i=e,s=r,a=je(i.shape,s.shape);return{a:()=>{let u=ce(s,"float32"),d=V(t,V(u,Qo(i,Se(u,Ae(1))))),p=Mt(i.shape,a);return p.length>0&&(d=we(d,p)),B(d,i.shape)},b:()=>{let u=zn(i,0),d=an(u,vr(i),Ie(i)),p=V(t,V(o,d)),f=Mt(s.shape,a);return f.length>0&&(p=we(p,f)),B(p,s.shape)}}}};var HV={kernelName:vc,inputsToSave:["x","alpha"],gradFunc:(t,n)=>{let[e,r]=n,o=zn(e,0);return{x:()=>an(o,t,V(t,r)),alpha:()=>{let i=an(o,Ie(t),V(t,e)),s=Mt(r.shape,t.shape);return s.length>0&&(i=we(i,s)),B(i,r.shape)}}}};var qV={kernelName:da,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=he(t,ce(r,"float32")),l=Mt(e.shape,o);return l.length>0?B(we(a,l),e.shape):a},b:()=>{let a=V(t,ce(e,"float32")),l=Mt(r.shape,o);l.length>0&&(a=B(we(a,l),r.shape));let c=We(r);return xt(he(a,ce(c,"float32")))}}}};var KV={kernelName:Na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,xt(We(e)))}}};var XV={kernelName:Aa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(ps(e,6),Fi(e));return{x:()=>V(t,ce(r,"float32"))}}};var YV={kernelName:ka,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,ce(Fi(e),"float32"))}}};var QV={kernelName:bc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>B(t,e.shape)}}};var ZV={kernelName:Cc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(Uf,o,e)}}};var JV={kernelName:wc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(zf,o,e)}}};var eB={kernelName:_c,gradFunc:(t,n,e)=>{let{dims:r}=e,o=bn(r,t.shape);return{x:()=>wo(t,o)}}};var tB={kernelName:Ra,gradFunc:t=>({x:()=>Ie(t)})};var nB={kernelName:Oa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>xt(he(t,V(Qo(e,1.5),2)))}}};var rB={kernelName:Sc,inputsToSave:["condition"],gradFunc:(t,n)=>{let[e]=n;return{condition:()=>ce(Ie(e),"float32"),t:()=>V(t,ce(e,t.dtype)),e:()=>V(t,ce(um(e),t.dtype))}}};var oB={kernelName:Ma,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=zn(e,Ae(0)),o=Ae(FD),i=Ae(PD),s=V(t,i),a=V(V(t,o),xr(ce(e,"float32")));return an(r,s,a)}}}};var iB={kernelName:La,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(e,Se(Ae(1),e)))}}};var sB={kernelName:$a,gradFunc:t=>({x:()=>Ie(t)})};var aB={kernelName:Fa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(gd(ce(e,"float32")),t)}}};var lB={kernelName:Pa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(qg(ce(e,"float32")),t)}}};var cB={kernelName:Ec,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{begin:o,size:i}=e,s=r.shape,[a,l]=RT(r,o,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>wd(t,c)}}};var uB={kernelName:Nc,outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{dim:o}=e,i=!0,s=V(t,r);return{logits:()=>Se(s,V(we(s,[o],i),r))}}};var dB={kernelName:Va,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Xo(e))}}};var zD={kernelName:Tc,gradFunc:(t,n,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>sm(t,r,o)}}};var UD={kernelName:Dc,gradFunc:(t,n,e)=>{let{axis:r}=e;return{x:()=>Bt(t,r)}}};var pB={kernelName:Ba,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,V(Ut(ce(e,"float32")),2))}}};var fB={kernelName:jf,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(ce(e,"float32"),2))}}};var mB={kernelName:za,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ae(2);return{a:()=>V(t,V(o,Se(e,r))),b:()=>V(t,V(o,Se(r,e)))}}};var hB={kernelName:Wa,gradFunc:t=>({x:()=>Ie(t)})};var gB={kernelName:Ua,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=je(e.shape,r.shape);return{a:()=>{let a=t,l=Mt(e.shape,o);return l.length>0&&(a=we(a,l)),B(a,e.shape)},b:()=>{let a=t,l=Mt(r.shape,o);return l.length>0&&(a=we(a,l)),B(xt(a),r.shape)}}}};var yB={kernelName:Ic,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,o=r.shape.slice(),{axis:i}=e;bn(i,r.shape).forEach(c=>{o[c]=1});let a=B(t,o),l=V(a,no(r.shape,"float32"));return{x:()=>l}}};var xB={kernelName:ja,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>he(t,We(gd(e)))}}};var vB={kernelName:Ga,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Se(Ae(1),We(e)),t)}}};var bB={kernelName:cs,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{reps:o}=e;return{x:()=>{let s=Ie(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=te(s,st(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=te(s,st(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)s=te(s,st(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)s=te(s,st(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var wB={kernelName:kc,gradFunc:(t,n,e)=>{let r=e,{perm:o}=r,i=Yg(o);return{x:()=>ot(t,i)}}};var CB={kernelName:Ac,gradFunc:(t,n,e)=>{let r=e,{axis:o}=r;return{value:()=>Qn(t,o)}}};var _B={kernelName:Rc,inputsToSave:["segmentIds"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Wce(t,e)}}};function Wce(t,n){let e=to(n,Ie(n)),r=yd(t,e),o=vo(n,Ae(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=Yn(o,a+1);o=cr(o,no(r.shape,"bool"));let s=Ie(r);return an(o,r,s)}var SB={kernelName:Oc,gradFunc:t=>({x:()=>Ie(t)})};var Hce=[nw,k3,A3,R3,O3,M3,F3,P3,$3,L3,V3,B3,U3,G3,W3,H3,q3,K3,X3,Y3,Q3,Z3,eV,J3,nV,rV,oV,iV,sV,aV,qV,lV,cV,uV,dV,pV,mV,fV,hV,xV,vV,bV,wV,CV,_V,SV,EV,IV,TV,NV,VD,VD,kV,RV,MV,FV,PV,$V,LV,VV,BV,zV,UV,jV,GV,BD,BD,WV,HV,KV,XV,YV,QV,ZV,JV,eB,tB,nB,rB,oB,iB,sB,aB,lB,cB,uB,dB,zD,zD,UD,UD,pB,mB,fB,hB,gB,yB,xB,vB,bB,wB,CB,_B,SB];for(let t of Hce)_$(t);F().prototype.abs=function(){return this.throwIfDisposed(),wn(this)};F().prototype.acos=function(){return this.throwIfDisposed(),OT(this)};F().prototype.acosh=function(){return this.throwIfDisposed(),MT(this)};F().prototype.add=function(t){return this.throwIfDisposed(),te(this,t)};F().prototype.all=function(t,n){return this.throwIfDisposed(),Gg(this,t,n)};F().prototype.any=function(t,n){return this.throwIfDisposed(),nm(this,t,n)};F().prototype.argMax=function(t){return this.throwIfDisposed(),rm(this,t)};F().prototype.argMin=function(t){return this.throwIfDisposed(),DL(this,t)};F().prototype.asScalar=function(){return this.throwIfDisposed(),M(this.size===1,()=>"The array must have only 1 element."),B(this,[])};F().prototype.asType=function(t){return this.throwIfDisposed(),ce(this,t)};F().prototype.as1D=function(){return this.throwIfDisposed(),B(this,[this.size])};F().prototype.as2D=function(t,n){return this.throwIfDisposed(),B(this,[t,n])};F().prototype.as3D=function(t,n,e){return this.throwIfDisposed(),B(this,[t,n,e])};F().prototype.as4D=function(t,n,e,r){return this.throwIfDisposed(),B(this,[t,n,e,r])};F().prototype.as5D=function(t,n,e,r,o){return this.throwIfDisposed(),B(this,[t,n,e,r,o])};F().prototype.asin=function(){return this.throwIfDisposed(),FT(this)};F().prototype.asinh=function(){return this.throwIfDisposed(),PT(this)};F().prototype.atan=function(){return this.throwIfDisposed(),$T(this)};F().prototype.atan2=function(t){return this.throwIfDisposed(),NL(this,t)};F().prototype.atanh=function(){return this.throwIfDisposed(),LT(this)};F().prototype.avgPool=function(t,n,e,r){return this.throwIfDisposed(),hd(this,t,n,e,r)};F().prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),sm(this,t,n)};F().prototype.batchNorm=function(t,n,e,r,o){return this.throwIfDisposed(),Lc(this,t,n,e,r,o)};F().prototype.broadcastTo=function(t){return this.throwIfDisposed(),am(this,t)};F().prototype.cast=function(t){return this.throwIfDisposed(),ce(this,t)};F().prototype.ceil=function(){return this.throwIfDisposed(),HT(this)};F().prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Bn(this,t,n)};F().prototype.concat=function(t,n){return this.throwIfDisposed(),t instanceof ut&&(t=[t]),Bt([this,...t],n)};F().prototype.conv1d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Wg(this,t,n,e,r,o,i)};F().prototype.conv2dTranspose=function(t,n,e,r,o){return this.throwIfDisposed(),Hg(this,t,n,e,r,o)};F().prototype.conv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),eo(this,t,n,e,r,o,i)};F().prototype.cos=function(){return this.throwIfDisposed(),gd(this)};F().prototype.cosh=function(){return this.throwIfDisposed(),qg(this)};F().prototype.cumsum=function(t,n,e){return this.throwIfDisposed(),Ub(this,t,n,e)};F().prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),OL(this,t,n)};F().prototype.depthwiseConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Ya(this,t,n,e,r,o,i)};F().prototype.dilation2d=function(t,n,e,r,o){return this.throwIfDisposed(),ML(this,t,n,e,r,o)};F().prototype.divNoNan=function(t){return this.throwIfDisposed(),FL(this,t)};F().prototype.div=function(t){return this.throwIfDisposed(),he(this,t)};F().prototype.dot=function(t){return this.throwIfDisposed(),PL(this,t)};F().prototype.elu=function(){return this.throwIfDisposed(),Qa(this)};F().prototype.equal=function(t){return this.throwIfDisposed(),Yo(this,t)};F().prototype.erf=function(){return this.throwIfDisposed(),JT(this)};F().prototype.exp=function(){return this.throwIfDisposed(),xr(this)};F().prototype.expandDims=function(t){return this.throwIfDisposed(),Yn(this,t)};F().prototype.expm1=function(){return this.throwIfDisposed(),eD(this)};F().prototype.fft=function(){return this.throwIfDisposed(),iy(this)};F().prototype.flatten=function(){return this.throwIfDisposed(),B(this,[this.size])};F().prototype.floor=function(){return this.throwIfDisposed(),Za(this)};F().prototype.floorDiv=function(t){return this.throwIfDisposed(),Vb(this,t)};F().prototype.gather=function(t,n){return this.throwIfDisposed(),yd(this,t,n)};F().prototype.greaterEqual=function(t){return this.throwIfDisposed(),vo(this,t)};F().prototype.greater=function(t){return this.throwIfDisposed(),zn(this,t)};F().prototype.ifft=function(){return this.throwIfDisposed(),hm(this)};F().prototype.irfft=function(){return this.throwIfDisposed(),_D(this)};F().prototype.isFinite=function(){return this.throwIfDisposed(),tD(this)};F().prototype.isInf=function(){return this.throwIfDisposed(),nD(this)};F().prototype.isNaN=function(){return this.throwIfDisposed(),rD(this)};F().prototype.leakyRelu=function(t){return this.throwIfDisposed(),xd(this,t)};F().prototype.lessEqual=function(t){return this.throwIfDisposed(),ps(this,t)};F().prototype.less=function(t){return this.throwIfDisposed(),Gb(this,t)};F().prototype.localResponseNormalization=function(t,n,e,r){return this.throwIfDisposed(),$L(this,t,n,e,r)};F().prototype.logSigmoid=function(){return this.throwIfDisposed(),sD(this)};F().prototype.logSoftmax=function(t){return this.throwIfDisposed(),Xg(this,t)};F().prototype.logSumExp=function(t,n){return this.throwIfDisposed(),VL(this,t,n)};F().prototype.log=function(){return this.throwIfDisposed(),vr(this)};F().prototype.log1p=function(){return this.throwIfDisposed(),oD(this)};F().prototype.logicalAnd=function(t){return this.throwIfDisposed(),cr(this,t)};F().prototype.logicalNot=function(){return this.throwIfDisposed(),um(this)};F().prototype.logicalOr=function(t){return this.throwIfDisposed(),Wb(this,t)};F().prototype.logicalXor=function(t){return this.throwIfDisposed(),BL(this,t)};F().prototype.matMul=function(t,n,e){return this.throwIfDisposed(),yt(this,t,n,e)};F().prototype.maxPool=function(t,n,e,r){return this.throwIfDisposed(),vd(this,t,n,e,r)};F().prototype.max=function(t,n){return this.throwIfDisposed(),Un(this,t,n)};F().prototype.maximum=function(t){return this.throwIfDisposed(),to(this,t)};F().prototype.mean=function(t,n){return this.throwIfDisposed(),Gt(this,t,n)};F().prototype.min=function(t,n){return this.throwIfDisposed(),Bc(this,t,n)};F().prototype.minimum=function(t){return this.throwIfDisposed(),bd(this,t)};F().prototype.mirrorPad=function(t,n){return this.throwIfDisposed(),zL(this,t,n)};F().prototype.mod=function(t){return this.throwIfDisposed(),UL(this,t)};F().prototype.mul=function(t){return this.throwIfDisposed(),V(this,t)};F().prototype.neg=function(){return this.throwIfDisposed(),xt(this)};F().prototype.norm=function(t,n,e){return this.throwIfDisposed(),gm(this,t,n,e)};F().prototype.notEqual=function(t){return this.throwIfDisposed(),zc(this,t)};F().prototype.oneHot=function(t,n=1,e=0){return this.throwIfDisposed(),tm(this,t,n,e)};F().prototype.onesLike=function(){return this.throwIfDisposed(),On(this)};F().prototype.pad=function(t,n){return this.throwIfDisposed(),wd(this,t,n)};F().prototype.pool=function(t,n,e,r,o){return this.throwIfDisposed(),jL(this,t,n,e,r,o)};F().prototype.pow=function(t){return this.throwIfDisposed(),Qo(this,t)};F().prototype.prelu=function(t){return this.throwIfDisposed(),Cd(this,t)};F().prototype.prod=function(t,n){return this.throwIfDisposed(),GL(this,t,n)};F().prototype.reciprocal=function(){return this.throwIfDisposed(),bD(this)};F().prototype.relu=function(){return this.throwIfDisposed(),Zo(this)};F().prototype.relu6=function(){return this.throwIfDisposed(),Yb(this)};F().prototype.reshapeAs=function(t){return this.throwIfDisposed(),B(this,t.shape)};F().prototype.reshape=function(t){return this.throwIfDisposed(),B(this,t)};F().prototype.resizeBilinear=function(t,n,e){return this.throwIfDisposed(),w3(this,t,n,e)};F().prototype.resizeNearestNeighbor=function(t,n,e){return this.throwIfDisposed(),C3(this,t,n,e)};F().prototype.reverse=function(t){return this.throwIfDisposed(),wo(this,t)};F().prototype.rfft=function(){return this.throwIfDisposed(),SD(this)};F().prototype.round=function(){return this.throwIfDisposed(),wD(this)};F().prototype.rsqrt=function(){return this.throwIfDisposed(),Zg(this)};F().prototype.selu=function(){return this.throwIfDisposed(),Jg(this)};F().prototype.separableConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),ey(this,t,n,e,r,o,i)};F().prototype.sigmoid=function(){return this.throwIfDisposed(),Xo(this)};F().prototype.sign=function(){return this.throwIfDisposed(),CD(this)};F().prototype.sin=function(){return this.throwIfDisposed(),ty(this)};F().prototype.sinh=function(){return this.throwIfDisposed(),ny(this)};F().prototype.slice=function(t,n){return this.throwIfDisposed(),st(this,t,n)};F().prototype.softmax=function(t){return this.throwIfDisposed(),Sd(this,t)};F().prototype.softplus=function(){return this.throwIfDisposed(),fs(this)};F().prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),pm(this,t,n)};F().prototype.split=function(t,n){return this.throwIfDisposed(),jn(this,t,n)};F().prototype.sqrt=function(){return this.throwIfDisposed(),Ut(this)};F().prototype.square=function(){return this.throwIfDisposed(),We(this)};F().prototype.squaredDifference=function(t){return this.throwIfDisposed(),s3(this,t)};F().prototype.squeeze=function(t){return this.throwIfDisposed(),Ed(this,t)};F().prototype.stack=function(t,n){this.throwIfDisposed();let e=t instanceof ut?[this,t]:[this,...t];return Qn(e,n)};F().prototype.step=function(t){return this.throwIfDisposed(),Fi(this,t)};F().prototype.stridedSlice=function(t,n,e,r,o,i,s,a){return this.throwIfDisposed(),ED(this,t,n,e,r,o,i,s,a)};F().prototype.sub=function(t){return this.throwIfDisposed(),Se(this,t)};F().prototype.sum=function(t,n){return this.throwIfDisposed(),we(this,t,n)};F().prototype.tan=function(){return this.throwIfDisposed(),ID(this)};F().prototype.tanh=function(){return this.throwIfDisposed(),im(this)};F().prototype.tile=function(t){return this.throwIfDisposed(),Mi(this,t)};F().prototype.toBool=function(){return this.throwIfDisposed(),ce(this,"bool")};F().prototype.toFloat=function(){return this.throwIfDisposed(),ce(this,"float32")};F().prototype.toInt=function(){return this.throwIfDisposed(),ce(this,"int32")};F().prototype.topk=function(t,n){return this.throwIfDisposed(),a3(this,t,n)};F().prototype.transpose=function(t){return this.throwIfDisposed(),ot(this,t)};F().prototype.unique=function(t){return this.throwIfDisposed(),l3(this,t)};F().prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Zb(this,t,n)};F().prototype.unstack=function(t){return this.throwIfDisposed(),Pr(this,t)};F().prototype.where=function(t,n){return this.throwIfDisposed(),an(t,this,n)};F().prototype.zerosLike=function(){return this.throwIfDisposed(),Ie(this)};var jD;function gn(){return jD==null&&(jD=TL().epsilon()),jD}function br(){return"channelsLast"}var Co=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},wr=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},L=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Ne=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},ow=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}};function ti(t,n){if(Array.isArray(t)){let e=[];for(let r=0;r<n;r++)e=e.concat(t);return e}else{let e=new Array(n);return e.fill(t),e}}function _o(t,n){if(!t)throw new ow(n)}function WD(t,n){let e=0;for(let r of t)r===n&&e++;return e}function Mn(t){return t.length===1?t[0]:t}function Nt(t){return Array.isArray(t)?t:[t]}function ni(t){let e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function el(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(n,e)=>e.toUpperCase())}var ei={};function xm(t){if(t==null)return null;let n={};return n.className=t.getClassName(),n.config=t.getConfig(),n}function GD(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(n=>GD(n));else{let n=Object.keys(t);for(let e of n){let r=t[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[e]=r.value:GD(r))}}}function gs(t,n={},e={},r="object",o=!1){if(typeof t=="string"){let i=t,s;if(i in e)s=e[i];else if(i in ei)s=ei[i];else if(s=n[i],s==null)throw new L(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=t;if(i.className==null||i.config==null)throw new L(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in ei?[a,l]=ei.className:s in n&&([a,l]=n[s]),a==null)throw new L(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let c={};for(let f of Object.keys(ei))c[f]=ei[f];for(let f of Object.keys(e))c[f]=e[f];let u=i.config;u.customObjects=c;let d=Object.assign({},ei);for(let f of Object.keys(e))ei[f]=e[f];GD(i.config);let p=l(a,i.config,e,o);return ei=Object.assign({},d),p}else{let c=Object.assign({},ei);for(let d of Object.keys(e))ei[d]=e[d];let u=new a(i.config);return ei=Object.assign({},c),u}}}function qce(t,n){return t<n?-1:t>n?1:0}function cy(t,n){return-1*qce(t,n)}function ri(t){if(t==null)return t;let n=[];for(let e of t)n.indexOf(e)===-1&&n.push(e);return n}function EB(t){if(t==null)throw new L(`Invalid value in obj: ${JSON.stringify(t)}`);for(let n in t)if(t.hasOwnProperty(n))return!1;return!0}function ys(t,n,e){if(e!=null&&t.indexOf(e)<0)throw new L(`${e} is not a valid ${n}.  Valid values are ${t} or null/undefined.`)}function iw(t,n,e=0,r=1/0){return _o(e>=0),_o(r>=e),Array.isArray(t)&&t.length>=e&&t.length<=r&&t.every(o=>typeof o===n)}function ln(t,n){Array.isArray(t)?(w.assert(t.length>0,()=>`${n} is unexpectedly an empty array.`),t.forEach((e,r)=>ln(e,`element ${r+1} of ${n}`))):w.assert(Number.isInteger(t)&&t>0,()=>`Expected ${n} to be a positive integer, but got ${IB(t)}.`)}function IB(t){return t===null?"null":Array.isArray(t)?"["+t.map(n=>IB(n)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function TB(t,n){let e=w.now(),r;return(...i)=>{let s=w.now();return s-e<n||(e=s,r=t(...i)),r}}function sw(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}function HD(t,n){return z(()=>Ut(we(V(t,t),n,!0)))}var Rd=class extends Q.Serializable{getConfig(){return{}}},kB=(()=>{class t extends Rd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>{let r=HD(e,this.axis),o=Bn(r,0,this.maxValue);return V(e,he(o,te(gn(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return t.className="MaxNorm",t})();Q.registerClass(kB);var AB=(()=>{class t extends Rd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>he(e,te(gn(),HD(e,this.axis))))}getConfig(){return{axis:this.axis}}}return t.className="UnitNorm",t})();Q.registerClass(AB);var RB=(()=>{class t extends Rd{apply(e){return Zo(e)}}return t.className="NonNeg",t})();Q.registerClass(RB);var OB=(()=>{class t extends Rd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>{let r=HD(e,this.axis),o=te(V(this.rate,Bn(r,this.minValue,this.maxValue)),V(1-this.rate,r));return V(e,he(o,te(gn(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return t.className="MinMaxNorm",t})();Q.registerClass(OB);var DB={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Zt(t){return xm(t)}function NB(t,n={}){return gs(t,Q.SerializationMap.getMap().classNameMap,n,"constraint")}function Jt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in DB?DB[t]:t,config:{}};return NB(e)}else return t instanceof Rd?t:NB(t)}var MB=["channelsFirst","channelsLast"],FB=["nearest","bilinear"],PB=["valid","same","causal"],$B=["max","avg"],LB=["sum","mul","concat","ave"];var vm=new Map;function Wt(t){ys(MB,"DataFormat",t)}function BB(t){ys(FB,"InterpolationFormat",t)}function Cr(t){ys(PB,"PaddingMode",t)}function qD(t){ys($B,"PoolMode",t)}var uy=[],VB="/";function $i(t,n){uy.push(t);try{let e=n();return uy.pop(),e}catch(e){throw uy.pop(),e}}function Xce(){return uy.length===0?"":uy.join(VB)+VB}function aw(t){if(!zB(t))throw new Error("Not a valid tensor name: '"+t+"'");return Xce()+t}function lw(t){if(!zB(t))throw new Error("Not a valid tensor name: '"+t+"'");vm.has(t)||vm.set(t,0);let n=vm.get(t);if(vm.set(t,vm.get(t)+1),n>0){let e=`${t}_${n}`;return vm.set(e,1),e}else return t}var Yce=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function zB(t){return!!t.match(Yce)}function UB(t){return t===parseInt(t.toString(),10)}function oi(t,n,e){n==null&&(n=0),e==null&&(e=t.length);let r=1;for(let o=n;o<e;++o)r*=t[o];return r}function jB(t){return t=Array.isArray(t)?new Float32Array(t):t,Jo(t)}function Od(t){return Bc(jB(t)).dataSync()[0]}function Li(t){return Un(jB(t)).dataSync()[0]}function ur(t,n){if(n<t)throw new L(`end (${n}) < begin (${t}) is forbidden.`);let e=[];for(let r=t;r<n;++r)e.push(r);return e}function nl(t,n){return t.asType(n)}function rl(t,n=-1){let e=t.shape.slice();return n<0&&(n=e.length+n+1),e.splice(n,0,1),t.reshape(e)}function GB(t,n){return z(()=>{if(t.shape.length!==2)throw new L(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let e=rl(t,1);return uw(e,[1,n,1])})}function WB(t){let n=[oi(t.shape)];return t.reshape(n)}function HB(t){if(t.rank<=1)throw new L(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let n=[t.shape[0],oi(t.shape,1)];return t.reshape(n)}function tl(t,n,e){return z(()=>{switch(t.rank){case 1:return ry(t,n,e);case 2:return Qb(t,[n,0],[e,t.shape[1]]);case 3:return oy(t,[n,0,0],[e,t.shape[1],t.shape[2]]);case 4:return mm(t,[n,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3]]);case 5:return st(t,[n,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return st(t,[n,0,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new L(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function KD(t,n,e){return z(()=>{switch(t.rank){case 1:return ry(t,n,e);case 2:return Qb(t,[0,n],[t.shape[0],e]);case 3:return oy(t,[0,0,n],[t.shape[0],t.shape[1],e]);case 4:return mm(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],e]);default:throw new L(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function dy(t,n,e,r){return z(()=>{switch(t.rank){case 1:return ry(t,n,e);case 2:switch(r){case 1:return tl(t,n,e);case 2:return KD(t,n,e);default:throw new L(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return tl(t,n,e);case 2:return oy(t,[0,n,0],[t.shape[0],e,t.shape[2]]);case 3:return KD(t,n,e);default:throw new L(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return tl(t,n,e);case 2:return mm(t,[0,n,0,0],[t.shape[0],e,t.shape[2],t.shape[3]]);case 3:return mm(t,[0,0,n,0],[t.shape[0],t.shape[1],e,t.shape[3]]);case 4:return KD(t,n,e);default:throw new L(`The axis is not within the rank of the tensor ${r}`)}default:throw new L(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function bm(t,n=-1){let e;return n<0&&(e=t[0].rank,e!==0?n=e:n=0),n===t[0].rank&&(n=-1),Bt(t,n)}function YD(t,n){switch(t.rank){case 1:return qT([t,n]);case 2:return KT([t,n],0);case 3:return XT([t,n],0);case 4:return YT([t,n],0);default:throw new L(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function uw(t,n){if(Array.isArray(n)||(n=[n]),t.rank!==n.length)throw new L(`The length of input n (${n.length}) does not match the number of dimensions in input x (${t.rank})`);return Mi(t,n)}function wm(t,n=0,e=1,r,o){return Xb(t,n,e,r,o)}function ii(t,n,e,r){if(t.rank<2||n.rank<2)throw new Ne(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${n.shape}`);if(n.rank>=3){let o=t.shape.slice(-1)[0],i=n.shape.slice(-2)[0];if(o!==i)throw new Ne(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${n.shape}`)}if(t.rank===2&&n.rank===2)return kd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?XD(t.rank,r,br()):null,activation:e});{let o=t.shape.slice(),i=o.pop();t=t.reshape([-1,i]);let s=n.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:n.rank},(m,h)=>h===0?n.rank-2:h<=n.rank-2?h-1:h);n=n.transpose(u).reshape([l,-1]);let d=[...o,...c];return kd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?XD(t.rank,r,br()):null,activation:e}).reshape(d)}}function dw(t,n,e){return z(()=>(Array.isArray(n)?n=Jo(n,"int32"):n=n.toInt(),yd(t,n,e)))}function Md(t){return V(t,t)}function XD(t,n,e){let r=n.shape;if(n.rank!==1&&n.rank!==t)throw new L(`Unexpected bias dimensions: ${n.rank}; expected it to be 1 or ${t}`);if(t===5){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1,1]):n.reshape([1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===4){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1]):n.reshape([1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===3){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1]):n.reshape([1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,r[0]]):n.reshape([1].concat(r))}else if(t<3)return n;throw new L(`Unsupported input rank by biasAdd: ${n.rank}`)}function _r(t,n,e){return z(()=>(e==null&&(e=br()),Wt(e),t.add(XD(t.rank,n,e))))}function qB(t,n=1){if(n!==1)throw new Ne(`Support for alpha values other than 1 (${n}) is not implemented yet.`);return Qa(t)}function KB(t){return z(()=>he(t,wn(t).add(1)))}function pw(t,n,e,r){return z(()=>p3(t,n,e,r))}function XB(t){return z(()=>{let n=te(.5,V(.2,t));return Bn(n,0,1)})}function jc(t,n,e=!1){return e?t():n()}var YB=["fanIn","fanOut","fanAvg"],QB=["normal","uniform","truncatedNormal"];function Qce(t){ys(YB,"FanMode",t)}function Zce(t){ys(QB,"Distribution",t)}var Er=class extends Q.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},ez=(()=>{class t extends Er{apply(e,r){return zt(e,r)}}return t.className="Zeros",t})();Q.registerClass(ez);var fw=(()=>{class t extends Er{apply(e,r){return no(e,r)}}return t.className="Ones",t})();Q.registerClass(fw);var tz=(()=>{class t extends Er{constructor(e){if(super(),typeof e!="object")throw new L(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new L(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return z(()=>V(Ae(this.value),no(e,r)))}getConfig(){return{value:this.value}}}return t.className="Constant",t})();Q.registerClass(tz);var nz=(()=>{class t extends Er{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return Ja(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return t.className="RandomUniform",t})();Q.registerClass(nz);var rz=(()=>{class t extends Er{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ne(`randomNormal does not support dType ${r}.`);return wm(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="RandomNormal",t})();Q.registerClass(rz);var oz=(()=>{class t extends Er{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ne(`truncatedNormal does not support dType ${r}.`);return sy(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="TruncatedNormal",t})();Q.registerClass(oz);var iz=(()=>{class t extends Er{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return z(()=>{if(e.length!==2||e[0]!==e[1])throw new L("Identity matrix initializer can only be used for 2D square matrices.");return V(this.gain,cm(e[0]))})}getConfig(){return{gain:this.gain}}}return t.className="Identity",t})();Q.registerClass(iz);function Jce(t,n="channelsLast"){let e,r;if(Wt(n),t.length===2)e=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(n==="channelsFirst"){let o=oi(t,2);e=t[1]*o,r=t[0]*o}else if(n==="channelsLast"){let o=oi(t,0,t.length-2);e=t[t.length-2]*o,r=t[t.length-1]*o}}else{let o=oi(t);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var ro=(()=>{class t extends Er{constructor(e){if(super(),e.scale<0)throw new L(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Qce(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Zce(this.distribution),this.seed=e.seed}apply(e,r){let o=Jce(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ne(`${this.getClassName()} does not support dType ${r}.`);return sy(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return Ja(e,-l,l,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return t.className="VarianceScaling",t})();Q.registerClass(ro);var QD=(()=>{class t extends ro{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return ro.className}}return t.className="GlorotUniform",t})();Q.registerClass(QD);var ZD=(()=>{class t extends ro{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return ro.className}}return t.className="GlorotNormal",t})();Q.registerClass(ZD);var JD=(()=>{class t extends ro{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return ro.className}}return t.className="HeNormal",t})();Q.registerClass(JD);var eN=(()=>{class t extends ro{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return ro.className}}return t.className="HeUniform",t})();Q.registerClass(eN);var tN=(()=>{class t extends ro{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return ro.className}}return t.className="LeCunNormal",t})();Q.registerClass(tN);var nN=(()=>{class t extends ro{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return ro.className}}return t.className="LeCunNormal",t})();Q.registerClass(nN);var sz=(()=>{class t extends Er{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Ne("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return z(()=>{if(e.length<2)throw new Ne("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let o=e[0]>e[1]?[e[1],e[0]]:e,i=wm(o,0,1,"float32"),s=T3.gramSchmidt(i);return e[0]>e[1]&&(s=s.transpose()),V(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}}return t.className="Orthogonal",t})();Q.registerClass(sz);var ZB={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function JB(t,n={}){return gs(t,Q.SerializationMap.getMap().classNameMap,n,"initializer")}function Ft(t){return xm(t)}function It(t){if(typeof t=="string"){let n=t in ZB?ZB[t]:t;if(n==="GlorotNormal")return new ZD;if(n==="GlorotUniform")return new QD;if(n==="HeNormal")return new JD;if(n==="HeUniform")return new eN;if(n==="LeCunNormal")return new tN;if(n==="LeCunUniform")return new nN;{let e={};return e.className=n,e.config={},JB(e)}}else return t instanceof Er?t:JB(t)}var tue=0;function hw(){return tue++}var mw={};function Gc(t=""){return t in mw||(mw[t]=0),mw[t]+=1,t+mw[t].toString()}function gw(t){return Array.isArray(t)&&Array.isArray(t[0])}function Cm(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Le(t){let n;if(Array.isArray(t)){if(t.length!==1)throw new L(`Expected Tensor length to be 1; got ${t.length}`);n=t[0]}else n=t;return n}function Ze(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new L(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function _m(t){let n=0;for(let e of t)e.shape.length===0?n+=1:n+=e.shape.reduce((r,o)=>r*o);return n}var lz="Variable",py=class{constructor(n,e="float32",r=lz,o=!0,i=null){this.dtype=e??"float32",this.shape=n.shape,this.id=hw(),r=r??lz,this.originalName=aw(r),this.name=lw(this.originalName),this.trainable_=o,this.constraint=i,this.val=TD(n,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(n){return this.assertNotDisposed(),rue(this.val,n),this.val.id!==n.id&&(this.val.assign(n),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(n){this.trainable_=n,this.val.trainable=n}};function rue(t,n){if(t.shape.toString()!==n.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(n.shape))}function fy(t){return t.map(n=>n.read())}function Sm(t){t.forEach(n=>{n[0].write(n[1])})}var kt=class{constructor(n){this.dtype=n.dtype,this.shape=n.shape,n.shape!=null?this.ndim=n.shape.length:this.ndim=n.ndim,this.maxNDim=n.maxNDim,this.minNDim=n.minNDim,this.axes=n.axes||{}}},dr=class{constructor(n,e,r,o,i,s,a){this.dtype=n,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=hw(),s!=null&&(this.originalName=aw(s),this.name=lw(this.originalName)),this.rank=e.length}},oue=0,ol=class{constructor(n,e){this.callArgs=e,this.id=oue++,this.outboundLayer=n.outboundLayer,this.inboundLayers=n.inboundLayers,this.nodeIndices=n.nodeIndices,this.tensorIndices=n.tensorIndices,this.inputTensors=n.inputTensors,this.outputTensors=n.outputTensors,this.inputMasks=n.inputMasks,this.outputMasks=n.outputMasks,this.inputShapes=n.inputShapes,this.outputShapes=n.outputShapes;for(let r of n.inboundLayers)r?.outboundNodes.push(this);n.outboundLayer.inboundNodes.push(this)}getConfig(){let n=[];for(let e of this.inboundLayers)e!=null?n.push(e.name):n.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},iue=0,Ue=class extends Q.Serializable{constructor(n={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=iue++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=n.name;if(!e){let r=this.getClassName();e=ni(r)+"_"+Gc(r)}if(this.name=e,this.trainable_=n.trainable==null?!0:n.trainable,n.inputShape!=null||n.batchInputShape!=null){let r;if(n.batchInputShape!=null)r=n.batchInputShape;else if(n.inputShape!=null){let i=null;n.batchSize!=null&&(i=n.batchSize),r=[i].concat(n.inputShape)}this.batchInputShape=r;let o=n.dtype;o==null&&(o=n.inputDType),o==null&&(o="float32"),this.dtype=o}n.weights!=null?this.initialWeights=n.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(n,e){return n.name+"_ib-"+e.toString()}getNodeAtIndex(n,e){if(this.inboundNodes.length===0)throw new wr(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=n)throw new L(`Asked to get ${e} at node ${n}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[n]}getInputAt(n){return Mn(this.getNodeAtIndex(n,"input").inputTensors)}getOutputAt(n){return Mn(this.getNodeAtIndex(n,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Co(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Co(`Layer ${this.name} is not connected, no input to return.`);return Mn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Co(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Co(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Mn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(n=>n())}get updates(){return this._updates}get built(){return this._built}set built(n){this._built=n}get trainable(){return this.trainable_}set trainable(n){this._trainableWeights.forEach(e=>e.trainable=n),this.trainable_=n}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(n=>n.trainable):[]}set trainableWeights(n){this._trainableWeights=n}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(n=>!n.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(n){this._nonTrainableWeights=n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(n){if(n=Nt(n),this.inputSpec==null||this.inputSpec.length===0)return;let e=Nt(this.inputSpec);if(n.length!==e.length)throw new L(`Layer ${this.name} expects ${e.length} inputs, but it received ${n.length} input tensors. Input received: ${n}`);for(let r=0;r<n.length;r++){let o=n[r],i=e[r];if(i==null)continue;let s=o.rank;if(i.ndim!=null&&s!==i.ndim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(i.maxNDim!=null&&s>i.maxNDim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(i.minNDim!=null&&s<i.minNDim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new L(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){let a=o.shape;for(let l in i.axes){let c=Number(l),u=i.axes[l],d=c>=0?a[c]:a[a.length+c];if(u!=null&&[u,null].indexOf(d)===-1)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${a}.`)}}if(i.shape!=null)for(let a=0;a<i.shape.length;++a){let l=i.shape[a],c=o.shape[a];if(l!=null&&c!=null&&l!==c)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(n,e){return n}invokeCallHook(n,e){this._callHook!=null&&this._callHook(n,e)}setCallHook(n){this._callHook=n}clearCallHook(){this._callHook=null}apply(n,e){e=e||{},this.assertNotDisposed();let r=Nt(n),o=!0;for(let s of r)if(!(s instanceof dr)){o=!1;break}let i=!0;for(let s of r)if(s instanceof dr){i=!1;break}if(o===i)throw new L("Arguments to apply() must be all SymbolicTensors or all Tensors");return $i(this.name,()=>{if(!this.built){this.assertInputCompatibility(n);let s=[];for(let a of Nt(n))s.push(a.shape);this.build(Mn(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(n),i){let s=this.call(n,e),a=Nt(s),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=Mn(l),this.activityRegularizer!=null)throw new Ne("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=sue(n),a=this.computeOutputShape(s),l,c=aue(n);if(this.warnOnIncompatibleInputShape(Array.isArray(n)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new dr(c,u,this,Nt(n),e,this.name,d)):l=new dr(c,a,this,Nt(n),e,this.name),this.addInboundNode(n,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new Ne("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(n){if(this.batchInputShape!=null)if(n.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(n)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&n[o]!=null&&n[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(n)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Co(`The layer ${this.name} has never been called and thus has no defined output shape.`);let n=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);n.indexOf(r)===-1&&n.push(r)}if(n.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Co(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new wr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return _m(this.weights)}build(n){this.built=!0}getWeights(n=!1){return fy(n?this.trainableWeights:this.weights)}setWeights(n){z(()=>{let e=this.weights;if(e.length!==n.length)throw new L(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${n.length}, but the layer was expecting ${e.length} weights. Provided weights: ${n}...`);if(e.length===0)return;let r=[],o=fy(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=n[i];if(!w.arraysEqual(s.shape,l.shape))throw new L(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}Sm(r)})}addWeight(n,e,r,o,i,s,a){if(this._addedWeightNames.indexOf(n)!==-1)throw new L(`Duplicate weight name ${n} for layer ${this.name}`);this._addedWeightNames.push(n),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=It("zeros"));let l=o.apply(e,r),c=new py(l,r,n,s,a);return l.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),s==null&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(n){this.fastWeightInitDuringBuild=n}addLoss(n){n==null||Array.isArray(n)&&n.length===0||(n=Nt(n),this._losses!==void 0&&this._losses!==null&&this.losses.push(...n))}computeOutputShape(n){return n}computeMask(n,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(n,e,r,o,i,s,a=null){let l=Nt(n);e=Nt(e),r=Nt(r),o=Nt(o),i=Cm(i),s=Cm(s);let c=[],u=[],d=[];for(let p of l)c.push(p.sourceLayer),u.push(p.nodeIndex),d.push(p.tensorIndex);new ol({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let p=0;p<e.length;p++)e[p].sourceLayer=this,e[p].nodeIndex=this.inboundNodes.length-1,e[p].tensorIndex=p}getConfig(){let n={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(n.batchInputShape=this.batchInputShape),this.dtype!=null&&(n.dtype=this.dtype),n}disposeWeights(){return this.weights.forEach(n=>n.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let n=0;return--this._refCount===0&&(n=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:n}}};function sue(t){t=Nt(t);let n=[];for(let e of t)n.push(e.shape);return Mn(n)}function aue(t){return"float32"}function rN(t,n,e){if((n==null||e!=null&&e>0)&&(n=t.sourceLayer,e=t.nodeIndex),n.inboundNodes.length===0)return[t];{let r=n.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=rN(s,a,l);for(let u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}var Fd=(()=>{class t extends Ue{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Gc("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new L("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new L("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new L("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new dr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new ol({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new L(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return t.className="InputLayer",t})();Q.registerClass(Fd);function oN(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new L("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let n=t.batchShape;t.shape!=null&&n==null&&(n=[null].concat(t.shape));let e=t.dtype;return e==null&&(e="float32"),new Fd({batchInputShape:n,name:t.name,dtype:e,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}async function il(t){if(t==null)return;let n=[],e=[],r=[];for(let o in t){let i=t[o];if(typeof i!="number"){let s=i;n.push(s.data()),e.push(o),r.push(s)}}if(n.length>0){let o=await Promise.all(n);for(let i=0;i<o.length;++i)t[e[i]]=o[i][0];Fe(r)}}function yw(t){if(t!=null)for(let n in t){let e=t[n];typeof e!="number"&&e.dispose()}}var lue=125,Wc=class{constructor(){this.validationData=null}setParams(n){this.params=n}async onEpochBegin(n,e){}async onEpochEnd(n,e){}async onBatchBegin(n,e){}async onBatchEnd(n,e){}async onTrainBegin(n){}async onTrainEnd(n){}setModel(n){}},xw=class{constructor(n,e=10){n==null&&(n=[]),this.callbacks=n,this.queueLength=e}append(n){this.callbacks.push(n)}setParams(n){for(let e of this.callbacks)e.setParams(n)}setModel(n){for(let e of this.callbacks)e.setModel(n)}async onEpochBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochBegin(n,e)}async onEpochEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochEnd(n,e)}async onBatchBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchBegin(n,e)}async onBatchEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchEnd(n,e)}async onTrainBegin(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainBegin(n)}async onTrainEnd(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainEnd(n)}},iN=class extends Wc{constructor(){super()}async onEpochBegin(n){this.seen=0,this.totals={}}async onBatchEnd(n,e){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=z(()=>te(this.totals[o],V(i,r)));this.totals[o]=a,s?.dispose()}}}async onEpochEnd(n,e){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:z(()=>{let o=V(he(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),Rn(e[r])}))}},vw=class extends Wc{async onTrainBegin(n){this.epoch=[],this.history={}}async onEpochEnd(n,e){e==null&&(e={}),this.epoch.push(n);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])}async syncData(){let n=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];n.push(l.data()),e.push(i),r.push(a)}}let o=await Promise.all(n);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]}},bw=class extends Wc{constructor(n,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=lue),this.yieldEvery==="never"&&n.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");w.isNumber(this.yieldEvery)&&(this.maybeWait=TB(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=n.onTrainBegin,this.trainEnd=n.onTrainEnd,this.epochBegin=n.onEpochBegin,this.epochEnd=n.onEpochEnd,this.batchBegin=n.onBatchBegin,this.batchEnd=n.onBatchEnd,this.yield=n.onYield}async maybeWait(n,e,r){let o=[];this.yield!=null&&(await il(r),o.push(this.yield(n,e,r))),o.push(ly()),await Promise.all(o)}async onEpochBegin(n,e){this.currentEpoch=n,this.epochBegin!=null&&(await il(e),await this.epochBegin(n,e))}async onEpochEnd(n,e){let r=[];this.epochEnd!=null&&(await il(e),r.push(this.epochEnd(n,e))),this.yieldEvery==="epoch"&&r.push(ly()),await Promise.all(r)}async onBatchBegin(n,e){this.batchBegin!=null&&(await il(e),await this.batchBegin(n,e))}async onBatchEnd(n,e){let r=[];this.batchEnd!=null&&(await il(e),r.push(this.batchEnd(n,e))),this.yieldEvery==="batch"?r.push(ly()):w.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,n,e)),await Promise.all(r)}async onTrainBegin(n){this.trainBegin!=null&&(await il(n),await this.trainBegin(n))}async onTrainEnd(n){this.trainEnd!=null&&(await il(n),await this.trainEnd(n))}};function ww(t,n){return t==null&&(t={}),t instanceof Wc?[t]:Array.isArray(t)&&t[0]instanceof Wc?t:Nt(t).map(r=>new bw(r,n))}var cz=(()=>{class t{constructor(){}static registerCallbackConstructor(e,r){w.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),t.checkForDuplicate(r),t.constructors[e]==null&&(t.constructors[e]=[]),t.constructors[e].push(r)}static checkForDuplicate(e){for(let r in t.constructors)t.constructors[+r].forEach(i=>{if(i===e)throw new L("Duplicate callback constructor.")})}static clear(){t.constructors={}}static createCallbacks(e){let r=[];for(let o in t.constructors){let i=+o;e>=i&&r.push(...t.constructors[i])}return r.map(o=>new o)}}return t.constructors={},t})();function Cw(t,n,e,r,o,i,s,a,l){let c=new vw,u=[new iN,...cz.createCallbacks(n)];t!=null&&u.push(...t),u.push(c);let d=new xw(u);return d.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:n,doValidation:a,metrics:l}),{callbackList:d,history:c}}function $r(t,n={},e=!1){return gs(t,Q.SerializationMap.getMap().classNameMap,n,"layer",e)}function my(t,n){return z(()=>{t.dtype!=="float32"&&(t=t.asType("float32"));let e=we(Md(t),n,!0),r=Kg(e.shape,gn()),o=Ut(to(e,r));return he(t,o)})}function Pd(t,n){return z(()=>Gt(Md(Se(n,t)),-1))}function gy(t,n){return z(()=>Gt(wn(Se(n,t)),-1))}function yy(t,n){return z(()=>{let e=Se(t,n),r=Bn(wn(t),gn(),Number.MAX_VALUE),o=wn(he(e,r));return V(100,Gt(o,-1))})}function cue(t,n){return z(()=>{let e=Bn(n,gn(),Number.MAX_VALUE),r=vr(te(1,e)),o=Bn(t,gn(),Number.MAX_VALUE),i=vr(te(1,o));return Gt(Md(Se(r,i)),-1)})}function uue(t,n){return z(()=>{let e=to(0,Se(1,V(t,n)));return Gt(Md(e),-1)})}function due(t,n){return z(()=>{let e=to(0,Se(1,V(t,n)));return Gt(e,-1)})}function pue(t,n){return z(()=>{let e=we(V(t,n),-1),r=Un(V(Se(1,t),n),-1);return to(0,te(1,Se(r,e)))})}function fue(t,n){return z(()=>{let e=Math.log(2),r=Se(n,t),o=Se(te(r,fs(V(-2,r))),e);return Gt(o,-1)})}function $d(t,n,e=!1){return z(()=>{if(e)n=Sd(n);else{let r=we(n,n.shape.length-1,!0);n=he(n,r)}return n=Bn(n,gn(),1-gn()),xt(we(V(t.toFloat(),vr(n)),n.shape.length-1))})}function Em(t,n,e=!1){return z(()=>{let r=Za(WB(t)).toInt();n=Bn(n,gn(),1-gn());let o=n.shape,i=tm(r,o[o.length-1]).reshape(o);return $d(i,n,e)})}function mue(t,n){if(!w.arraysEqual(t.shape,n.shape))throw new L(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(n.shape)}`);return z(()=>{let e=n.relu(),r=n.abs().neg();return e.sub(n.mul(t)).add(r.exp().log1p())})}function Im(t,n){return z(()=>{let e;return e=Bn(n,gn(),1-gn()),e=vr(he(e,Se(1,e))),Gt(mue(t,e),-1)})}function hue(t,n){return z(()=>{let e=Bn(t,gn(),1),r=Bn(n,gn(),1);return we(V(t,vr(he(e,r))),-1)})}function gue(t,n){return z(()=>{let e=vr(te(gn(),n));return Gt(Se(n,V(t,e)),-1)})}function _w(t,n){return z(()=>{let e=my(t,-1),r=my(n,-1),o=V(e,r);return xt(we(o,-1))})}var hy={meanSquaredError:Pd,meanAbsoluteError:gy,meanAbsolutePercentageError:yy,meanSquaredLogarithmicError:cue,squaredHinge:uue,hinge:due,categoricalHinge:pue,logcosh:fue,categoricalCrossentropy:$d,sparseCategoricalCrossentropy:Em,binaryCrossentropy:Im,kullbackLeiblerDivergence:hue,poisson:gue,cosineProximity:_w};function Sw(t){if(typeof t=="string"){if(t in hy)return hy[t];let n=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new L(n)}else return t}function Iw(t,n){return z(()=>{let e=V(.5,On(n)),r=nl(zn(n,e),t.dtype);return Gt(Yo(t,r),-1)})}function Tw(t,n){return z(()=>nl(Yo(rm(t,-1),rm(n,-1)),"float32"))}function yue(t,n){return z(()=>cr(t.equal(1),n.equal(1)).sum().cast("float32"))}function xue(t,n){return z(()=>cr(t.equal(0),n.equal(1)).sum().cast("float32"))}function dz(t,n){return z(()=>{let e=yue(t,n),r=xue(t,n),o=e.add(r);return an(zn(o,0),e.div(o),0).cast("float32")})}function sN(t,n){return Im(t,n)}function aN(t,n){return t.rank===n.rank&&(t=t.squeeze([t.rank-1])),n=n.argMax(-1),n.dtype!==t.dtype&&(n=n.asType(t.dtype)),Yo(t,n).asType("float32")}var vue=Pd,bue=Pd,wue=gy,Cue=gy,_ue=yy,Sue=yy,Dw=$d,Eue=_w,lN=Em,Ew={binaryAccuracy:Iw,categoricalAccuracy:Tw,precision:dz,categoricalCrossentropy:Dw,sparseCategoricalCrossentropy:lN,mse:vue,MSE:bue,mae:wue,MAE:Cue,mape:_ue,MAPE:Sue,cosine:Eue};function pz(t){if(typeof t=="string"&&t in Ew)return Ew[t];if(typeof t!="string"&&t!=null)return t;throw new L(`Unknown metric ${t}`)}function xy(t){if(_o(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let n;for(let e of Object.keys(hy))if(hy[e]===t){n=e;break}if(n!==void 0)return n;for(let e of Object.keys(Ew))if(Ew[e]===t){n=e;break}return n!==void 0?n:t.name}}function mz(t){let n={Adagrad:()=>Ad.adagrad(.01),Adadelta:()=>Ad.adadelta(1,.95,gn()),Adam:()=>Ad.adam(.001,.9,.999,gn()),Adamax:()=>Ad.adamax(.002,.9,.999,gn(),0),RMSProp:()=>Ad.rmsprop(.001,.9,0,gn()),SGD:()=>Ad.sgd(.01)};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new L(`Unknown Optimizer ${t}`)}function uN(t,n,e=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!cN(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(t);r.length>1048576&&console.warn(`User-defined metadata of model "${n}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function cN(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let n=Object.keys(t);for(let e of n)if(typeof e!="string"||!cN(t[e]))return!1;return!0}else if(Array.isArray(t)){for(let n of t)if(!cN(n))return!1;return!0}else return!1;else{let n=typeof t;return n==="string"||n==="number"||n==="boolean"}}function hz(t,n,e,r=console.log){let o=Due(t),i=["Layer (type)","Output shape","Param #"];o?(n=n||65,e=e||[.45,.85,1]):(n=n||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(n*u)));let s;if(!o){i.push("Receives inputs"),s=[];for(let u in t.nodesByDepth)s.push(...t.nodesByDepth[u])}r("_".repeat(n)),Nw(i,e,r),r("=".repeat(n));let a=t.layers;for(let u=0;u<a.length;++u)o?Nue(a[u],e,r):kue(a[u],e,s,r),r((u===a.length-1?"=":"_").repeat(n));t.checkTrainableWeightsConsistency();let l=Tue(t),c=_m(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(n))}function Tue(t){let n;return t.collectedTrainableWeights!=null?n=_m(t.collectedTrainableWeights):n=_m(t.trainableWeights),n}function Due(t){let n=!0,e=[],r=[];for(let o in t.nodesByDepth)e.push(t.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){n=!1;break}r.push(...o)}if(n)for(let o of t.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){n=!1;break}else i=!0;if(!n)break}return n}function Nw(t,n,e=console.log){let r="";for(let o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=t[o],r=r.slice(0,n[o]),r+=" ".repeat(n[o]-r.length);e(r)}function Nue(t,n,e){let r;try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}let o=t.name,i=t.getClassName(),s=[`${o} (${i})`,r,t.countParams().toString()];Nw(s,n,e)}function kue(t,n,e,r){let o;try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let u of t.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(u)===-1))for(let d=0;d<u.inboundLayers.length;++d){let p=u.inboundLayers[d].name,f=u.nodeIndices[d],m=u.tensorIndices[d];i.push(`${p}[${f}][${m}]`)}let s=t.name,a=t.getClassName(),l=i.length===0?"":i[0],c=[`${s} (${a})`,o,t.countParams().toString(),l];Nw(c,n,r);for(let u=1;u<i.length;++u)Nw(["","","",i[u]],n,r)}function gz(t,n,e){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&n===0&&typeof e=="string"}function Tm(t,n){if(t===null)return null;if(typeof t=="string")return el(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];gz(n,o,i)?e.push(i):e.push(Tm(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=el(r);e[i]=Tm(o,i)}}return e}}function kw(t,n){if(t==null)return null;if(typeof t=="string")return ni(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];gz(n,o,i)?e.push(i):e.push(kw(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r],i=ni(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=kw(o,r)}return e}}var Dm="3.6.0";function Aue(t,n){if(t.dtype==null||t.dtype===n.dtype)return n;try{return ce(n,t.dtype)}catch{throw new L(`The dtype of the feed (${n.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var xs=class t{constructor(n){if(this.id2Value={},this.id2Mask={},this.name2Id={},n instanceof t)for(let e in n.id2Value)this.id2Value[e]=n.id2Value[e],e in n.id2Mask&&(this.id2Mask[e]=n.id2Mask[e]);else{if(n==null)return;for(let e of n)this.add(e.key,e.value)}}add(n,e,r){if(this.id2Value[n.id]==null)this.id2Value[n.id]=Aue(n,e),this.name2Id[n.name]=n.id,r!=null&&(this.id2Mask[n.id]=r);else throw new L(`Duplicate key: name=${n.name}, id=${n.id}`);return this}addFeed(n){this.add(n.key,n.value)}hasKey(n){return this.id2Value[n.id]!=null}names(){return Object.keys(this.name2Id)}getValue(n){if(n instanceof dr){if(this.id2Value[n.id]==null)throw new L(`Nonexistent key: ${n.name}`);return this.id2Value[n.id]}else{let e=this.name2Id[n];if(e==null)throw new L(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Value[e]}}getMask(n){if(n instanceof dr){if(this.id2Value[n.id]==null)throw new L(`Nonexistent key: ${n.name}`);return this.id2Mask[n.id]}else{let e=this.name2Id[n];if(e==null)throw new L(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Fe(this.id2Mask)}},dN={},yz={};function Ld(t,n,e,r){let o=e==null?!1:e.training,i=Array.isArray(t),s=i?t:[t],a=s.map(m=>m.name),l=[],c=n.names();for(let m of a)c.indexOf(m)!==-1?l.push(n.getValue(m)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let u=a.join(",")+"|"+n.names().join(","),d,p;if(dN[u]==null){let m=Rue(s,n);d=m.sorted,p=m.recipientCounts,dN[u]=d,yz[u]=p}d=dN[u],p={},o||Object.assign(p,yz[u]);let f=new xs(n);for(let m=0;m<d.length;++m){if(r!=null){let R=jg().numTensors;R>r.maxNumTensors&&(r.maxNumTensors=R),R<r.minNumTensors&&(r.minNumTensors=R)}let h=d[m],g=h.sourceLayer;if(g instanceof Fd)continue;let x=[],b=[],S=[],_=!1;for(let R of h.inputs){let $=f.getValue(R),G=f.getMask(R);x.push($),b.push(G),G!=null&&(_=!0),o||(p[R.name]--,p[R.name]===0&&!n.hasKey(R)&&a.indexOf(R.name)===-1&&!$.isDisposed&&R.sourceLayer.stateful!==!0&&S.push($))}_&&(e=e||{},e.mask=b[0]);let E=Nt(g.apply(x,e)),I=null;g.supportsMasking&&(I=g.computeMask(x,b));let D=Mue(h),O=Array.isArray(D)?D:[D];for(let R=0;R<O.length;++R){f.hasKey(O[R])||f.add(O[R],E[R],Array.isArray(I)?I[0]:I);let $=a.indexOf(O[R].name);$!==-1&&(l[$]=E[R])}o||Fe(S)}return f.disposeMasks(),i?l:l[0]}function Rue(t,n){w.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(t.length===1){let o=xz(t[0],n);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of t){let{sorted:s,recipientMap:a}=xz(i,n);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:e,recipientCounts:Oue(r)}}function Oue(t){let n={};for(let e in t)n[e]=t[e].size;return n}function xz(t,n){let e=new Set,r=[],o={};for(let a of n.names())e.add(a);let i=[],s=[];for(i.push(t);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:o}}function Mue(t){let n;if(t.sourceLayer.inboundNodes.length===1)n=t.sourceLayer.output;else{let e=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(let o of t.sourceLayer.inboundNodes[r].outputTensors)if(o.id===t.id){e=r;break}n=t.sourceLayer.getOutputAt(e)}return n}var Aw=class t extends Ue{constructor(n){if(super({}),this.containerNodes=new Set,this.name=n.name,this.name==null){let b=this.getClassName().toLowerCase();this.name=Gc(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(n.inputs)?this.inputs=n.inputs.slice():this.inputs=[n.inputs],Array.isArray(n.outputs)?this.outputs=n.outputs.slice():this.outputs=[n.outputs],ri(this.inputs).length!==this.inputs.length)throw new L(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);ri(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let b of this.outputs){let S=b.sourceLayer,_=b.nodeIndex,E=b.tensorIndex;this.outputLayers.push(S),this.outputLayersNodeIndices.push(_),this.outputLayersTensorIndices.push(E)}for(let b of this.inputs){let S=b.sourceLayer,_=b.nodeIndex,E=b.tensorIndex;_o(_===0,"input layer has >1 nodes"),_o(E===0,"input layer has >1 tensors"),this.inputLayers.push(S),this.inputLayersNodeIndices.push(_),this.inputLayersTensorIndices.push(E)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){let S=this.inputLayers[b];if(!(S instanceof Fd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${n.inputs}. Input ${b} (0-based) originates from layer type ${S.getClassName()}.`);this.inputNames.push(S.name),this.feedInputShapes.push(S.batchInputShape),this.feedInputNames.push(S.name)}for(let b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);let e={},r={},o={},i={},s={},a=[],l=(b,S,_,E,I,D)=>{(E==null||I==null||D==null)&&(E=b.sourceLayer,I=b.nodeIndex,D=b.tensorIndex);let O=E.inboundNodes[I];if(_.indexOf(O)!==-1)throw new wr(`The tensor ${b.name} at layer "${E.name}" is part of a cycle.`);if(S.indexOf(O)!==-1)return;this.containerNodes.add(t.nodeKey(E,I)),E.id in s||(s[E.id]=Object.keys(s).length),_.indexOf(O)===-1&&_.push(O);let R=O.inboundLayers.length;for(let $=0;$<R;$++){let G=O.inputTensors[$],W=O.inboundLayers[$],q=O.nodeIndices[$],X=O.tensorIndices[$];l(G,S,_,W,q,X)}for(S.push(O);_.indexOf(O)>=0;)_.splice(_.indexOf(O),1);a.push(O)},c=[],u=[];for(let b of this.outputs)l(b,c,u);let d=a.slice().reverse();for(let b of d){r[b.id]=b,b.id in e||(e[b.id]=0);let S=e[b.id],_=o[b.outboundLayer.id]==null?0:o[b.outboundLayer.id];S=Math.max(S,_),o[b.outboundLayer.id]=S,i[b.outboundLayer.id]=b.outboundLayer,e[b.id]=S;for(let E=0;E<b.inboundLayers.length;E++){let I=b.inboundLayers[E],D=b.nodeIndices[E],O=I.inboundNodes[D],R=e[O.id]==null?0:e[O.id];e[O.id]=Math.max(S+1,R),r[O.id]=O}}let p={};for(let b in e){let S=e[b];S in p||(p[S]=[]),p[S].push(r[b])}let f={};for(let b in o){let S=o[b];S in f||(f[S]=[]),f[S].push(i[b])}let m=Object.keys(f).map(b=>parseInt(b,10)).sort(cy);this.layers=[];for(let b of m){let S=f[b];S.sort((_,E)=>{let I=s[_.id],D=s[E.id];return I<D?-1:I>D?1:0});for(let _ of S)_ instanceof t&&this.internalContainerRefs.push(_),this.layers.push(_)}this.layersByDepth=f,m=Object.keys(p).map(b=>parseInt(b,10)).sort(cy);let h=this.inputs.slice(),g=[];for(let b of m)for(let S of p[b]){let _=S.outboundLayer;if(_!=null){for(let E of S.inputTensors)if(h.indexOf(E)===-1)throw new wr(`Graph disconnected: cannot obtain value for tensor ${E} at layer "${_.name}". The following previous layers were accessed without issue: ${g}`);for(let E of S.outputTensors)h.push(E);g.push(_.name)}}this.nodesByDepth=p;let x=this.layers.map(b=>b.name);for(let b of x){let S=x.filter(_=>_===b).length;if(S!==1)throw new wr(`The name "${b}" is used ${S} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new ol({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let n={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)n.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)n.numDisposedVariables+=e.dispose().numDisposedVariables}return n.refCountAfterDispose=this._refCount,n}get trainable(){return this.trainable_}set trainable(n){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=n)}),this.trainable_=n}get trainableWeights(){if(this._trainableWeights.length>0)throw new L("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let n=[];for(let e of this.layers)n=n.concat(e.trainableWeights);return n}get nonTrainableWeights(){let n=[];for(let e of this.layers)n.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(n)}return n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(n,e=!0){let r={},o=0;for(let s of this.layers)for(let a of s.weights){if(r[a.originalName]!=null)throw new L(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,o++}let i=[];for(let s in n){let a=s;if(r[s]==null){let l=s.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[a]!=null)i.push([r[a],n[s]]);else if(e)throw new L(`Provided weight data has no target variable: ${s}`);delete r[a]}if(e){let s=[];for(let a in r)s.push(a);if(s.length>0)throw new L(`${s.length} of ${o} weights are not set: ${s}`)}Sm(i)}updatedConfig(){let n=this.getConfig(),e={};return e.className=this.getClassName(),e.config=n,e.kerasVersion=`tfjs-layers ${Dm}`,e.backend="TensorFlow.js",e}toJSON(n,e=!0){let r=kw(this.updatedConfig());return e?JSON.stringify(r):r}call(n,e){return z(()=>{n=Nt(n);let r=new xs;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],n[o]);return Ld(this.outputs,r,e)})}computeMask(n,e){return z(()=>{n=Nt(n);let r;return e==null?r=ti(null,n.length):r=Nt(e),this.runInternalGraph(n,r)[1]})}computeOutputShape(n){let e=Cm(n);if(e.length!==this.inputLayers.length)throw new L(`Invalid inputShape argument ${n}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],c=e[a],u=l.name+"_0_0";r[u]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(cy);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let c of l){let u=c.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(u.id)!==-1)continue;let d=[];for(let h=0;h<c.inboundLayers.length;h++){let g=c.inboundLayers[h],x=c.nodeIndices[h],b=c.tensorIndices[h],S=`${g.name}_${x}_${b}`,_=r[S];d.push(_)}let p=u.computeOutputShape(Mn(d)),f=Cm(p),m=u.inboundNodes.indexOf(c);for(let h=0;h<f.length;h++){let g=`${u.name}_${m}_${h}`;r[g]=f[h]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){let l=s[a];_o(l in r),i.push(r[l])}return Mn(i)}runInternalGraph(n,e){e==null&&(e=ti(null,n.length));let r={};for(let l=0;l<this.inputs.length;++l){let c=this.inputs[l],u=n[l],d=e[l];r[c.id]=[u,d]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(cy);for(let l of o){let c=this.nodesByDepth[l];for(let u of c){let d=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,m=new Array;for(let h of p)h.id in r&&m.push(r[h.id]);if(m.length===p.length){let h={},g,x,b,S;if(u.callArgs!=null&&(h=u.callArgs),m.length===1){let[_,E]=m[0];h.mask==null&&(h.mask=E),b=Nt(d.call(_,h)),S=Nt(d.computeMask(_,E)),g=[_],x=[E]}else g=m.map(_=>_[0]),x=m.map(_=>_[1]),h.mask==null&&(h.mask=x),b=Nt(d.call(g,h)),S=Nt(d.computeMask(g,x));if(d.activityRegularizer)throw new Ne("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let _=0;_<f.length;++_){let E=f[_],I=b[_],D=S[_];r[E.id]=[I,D]}}}}let i=[],s=[],a=[];for(let l of this.outputs){_o(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[c,u]=r[l.id];a.push(c.shape),i.push(c),s.push(u)}return[i,s,a]}buildNodeConversionMap(n){let e={},r;for(let o of this.layers){r=o instanceof t?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=t.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(n,e){if(e!=null){if(this.layers.length<=e)throw new L(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}else if(n==null)throw new L("Provide either a layer name or layer index");for(let r of this.layers)if(r.name===n)return r;throw new L(`No such layer: ${n}`)}calculateLosses(){return z(()=>{let n=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=t.nodeKey(e,r);this.containerNodes.has(o)&&n.push(...e.calculateLosses())}return n})}getConfig(){let n={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){let p=s.inboundNodes[d],f=t.nodeKey(s,d),m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){let h=[];for(let g=0;g<p.inboundLayers.length;g++){let x=p.inboundLayers[g],b=p.nodeIndices[g],S=p.tensorIndices[g],_=t.nodeKey(x,b),E=e[_];E==null&&(E=0),h.push([x.name,E,S,m])}c.push(h)}}}let u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}n.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.inputLayersTensorIndices[s];o.push([a.name,u,d])}n.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.outputLayersTensorIndices[s];i.push([a.name,u,d])}return n.outputLayers=i,n}static fromConfig(n,e,r={},o=!1){let i={},s={};function a(g,x){g.name in s?s[g.name].push(x):s[g.name]=[x]}function l(g,x){let b=[],S;for(let _ of x){let E=_[0],I=_[1],D=_[2];if(S=_[3]==null?{}:_[3],!(E in i)){a(g,x);return}let O=i[E];if(O.inboundNodes.length<=I){a(g,x);return}let R=O.inboundNodes[I];b.push(R.outputTensors[D])}b.length>0&&g.apply(Mn(b),S)}function c(g){let x=g.name,b=$r(g,e.customObjects!=null?e.customObjects:{});b.setFastWeightInitDuringBuild(o),i[x]=b,g.inboundNodes.forEach(_=>{if(!(_ instanceof Array))throw new L(`Corrupted configuration, expected array for nodeData: ${_}`);a(b,_)})}let u=e.name,d=e.layers;for(let g of d)c(g);for(;!EB(s);)for(let g of d){let x=i[g.name];if(x.name in s){let b=s[x.name];delete s[x.name];for(let S of b)l(x,S)}}let p=[],f=[],m=e.inputLayers;for(let g of m){let x=g[0],b=g[1],S=g[2];_o(x in i);let E=i[x].inboundNodes[b].outputTensors;p.push(E[S])}let h=e.outputLayers;for(let g of h){let x=g[0],b=g[1],S=g[2];_o(x in i);let E=i[x].inboundNodes[b].outputTensors;f.push(E[S])}return new n({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new L("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let n of this.layers)if(n.stateful)return!0;return!1}resetStates(){z(()=>{this.layers.forEach(n=>{n.stateful&&n.resetStates()})})}};function Fue(t,n,e){let r=n.length;if(t==null||Array.isArray(t)&&t.length===0)return n.map(o=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&n[0]in t?[t[n[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${e} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return n.forEach(i=>{i in t?o.push(t[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${n} keys. Provided ${e} not understood: ${JSON.stringify(t)}`)}function Rw(t,n){return Fue(t,n,"classWeight")}async function Ow(t,n,e,r){if(n!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=z(()=>{if(t.shape.length===1)return t.clone();if(t.shape.length===2){if(t.shape[1]>1)return t.argMax(1);if(t.shape[1]===1)return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await o.data());Fe(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),Jo(s,"float32")}else return null}function vz(t,n){return V(t,n)}var Pue=32;function Cz(t,n){let e,r,o=n;e=o.xs,r=o.ys,w.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${n}`);let i=bz("input",t.inputNames,e),s=bz("output",t.outputNames,r),a=i[0].shape[0];w.assert(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),w.assert(s.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)w.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<s.length;l++)w.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:s}}function bz(t,n,e){if(e instanceof ut)return[e];if(Array.isArray(e))return w.assert(e.length===n.length,()=>`Received an array of ${e.length} Tensors, but expected ${n.length} to match the ${t} keys ${n}.`),e;{let r=[];for(let o of n){if(e[o]==null)throw new L(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);r.push(e[o])}return r}}function $ue(t){if(t.length===3)throw new Ne("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function _z(t,n,e){let r=e.batchesPerEpoch!=null;if(w.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),w.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),w.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),w.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),w.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(wz(e.validationData))w.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=$ue(e.validationData);i=g.xs,s=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();let u=ww(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:p,history:f}=Cw(u,d,e.epochs,null,null,Lue(n,e),null,o,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,h=await n.iterator();for(;m<e.epochs;){let g={};await p.onEpochBegin(m);let x=0,b=0;for(r||(h=await n.iterator());!r||x<e.batchesPerEpoch;){let S=await h.next();if(r&&S.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(S.value!=null){let{xs:_,ys:E}=Cz(t,S.value),I={};I.batch=b,I.size=_[0].shape[0],await p.onBatchBegin(b,I);let D=[];if(e.classWeight!=null){let $=Rw(e.classWeight,t.outputNames);for(let G=0;G<$.length;++G)D.push(await Ow(E[G],null,$[G]))}let O=_.concat(E).concat(D),R=a(O);Fe(O);for(let $=0;$<l.length;++$){let G=l[$],W=R[$];I[G]=W,Rn(W)}await p.onBatchEnd(b,I),yw(I),b++,x++}if(r?x>=e.batchesPerEpoch:S.done){if(o){let _;wz(e.validationData)?_=Nt(await t.evaluateDataset(e.validationData,{batches:e.validationBatches})):_=Nt(t.evaluate(i,s,{batchSize:e.validationBatchSize==null?Pue:e.validationBatchSize,verbose:0}));for(let E=0;E<t.metricsNames.length;++E)g[`val_${t.metricsNames[E]}`]=_[E]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,g),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Lue(t,n){let e=null;return n.batchesPerEpoch!=null?e=n.batchesPerEpoch:Number.isFinite(t.size)&&(e=t.size),e}function wz(t){return typeof t.iterator=="function"}function Vue(t){return typeof t.next=="function"}async function Sz(t,n,e){e=e||{};let r=e.batches!=null,o=t.testFunction,i=[];if(e.verbose>0)throw new Ne("Verbose mode is not implemented yet.");w.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=Vue(n)?n:await n.iterator(),a=0,l=0;for(;!r||l<e.batches;){let c=await s.next();if(i=z(()=>{if(c.value){let{xs:u,ys:d}=Cz(t,c.value),p=u.concat(d),f=z(()=>o(p));if(Fe(p),l===0)for(let h=0;h<f.length;++h)i.push(Ae(0));let m=p[0].shape[0];for(let h=0;h<f.length;++h){let g=f[h],x=i[h];i[h]=z(()=>te(i[h],V(m,g))),l>0&&Fe(x)}Fe(f),a+=m,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){let u=i[c];i[c]=he(i[c],a),Fe(u)}return Mn(i)}function Mw(t){w.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Nm(t,n,e){return t==null?[null]:Array.isArray(t)?t.map(r=>tl(r,n,e-n)):tl(t,n,e-n)}function Fw(t,n){return z(()=>t==null?null:Array.isArray(t)?t.map(e=>Fw(e,n)):dw(t,n.dtype==="int32"?n:n.toInt()))}function Pw(t,n){let e=[],r=0,o=null;for(;r<t;)o=r+n,o>=t&&(o=t),e.push([r,o]),r=o;return e}async function Bue(t,n,e,r,o,i,s,a,l,c,u,d,p,f,m){o==null&&(o=32),i==null&&(i=1),u==null&&(u=!0),p==null&&(p=0);let h=!1;if(l!=null&&c!=null&&(h=!0),m!=null&&(h=!0,f==null))throw new L("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=t.checkNumSamples(e,o,f,"steps_per_epoch"),x;g!=null&&(x=ur(0,g)),s==null&&(s=1);let{callbackList:b,history:S}=Cw(a,s,i,p,g,f,o,h,d);b.setModel(t),t.history=S,await b.onTrainBegin(),t.stopTraining_=!1;for(let _=p;_<i;++_){await b.onEpochBegin(_);let E={};if(f!=null)throw new Ne("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Ne("batch shuffling is not implemneted yet");u&&w.shuffle(x);let I=Jo(x),D=Pw(g,o);for(let O=0;O<D.length;++O){let R={};if(await b.onBatchBegin(O,R),z(()=>{let $=D[O][0],G=D[O][1],W=tl(I,$,G-$);R.batch=O,R.size=G-$;let q=Fw(e,W),X=n(q);for(let K=0;K<r.length;++K){let Y=r[K],re=X[K];R[Y]=re,Rn(re)}if(O===D.length-1&&h){let K=t.testLoop(l,c,o);for(let Y=0;Y<r.length;++Y){let re=r[Y],J=K[Y];Rn(J),E["val_"+re]=J}}}),await b.onBatchEnd(O,R),yw(R),t.stopTraining_)break}I.dispose()}if(await b.onEpochEnd(_,E),t.stopTraining_)break}return await b.onTrainEnd(),await t.history.syncData(),t.history}async function Ez(t,n,e,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;let o,i,s,a,l,c,u;try{let d=r.batchSize==null?32:r.batchSize;Mw(d);let f=await t.standardizeUserData(n,e,r.sampleWeight,r.classWeight,!1,d);o=f[0],i=f[1],u=f[2];let m=!1,h;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)s=r.validationData[0],a=r.validationData[1];else throw r.validationData.length===3?new Ne("validationData including sample weights is not supported yet."):new L(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);let O=await t.standardizeUserData(s,a,null,null,!0,d);l=O[0],c=O[1],h=l.concat(c)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;let D=Math.floor(o[0].shape[0]*(1-r.validationSplit)),O=o[0].shape[0];l=Nm(o,D,O),o=Nm(o,0,D),c=Nm(i,D,O),i=Nm(i,0,D),h=l.concat(c)}else r.validationSteps!=null&&(m=!0);let g=o.concat(i).concat(u);t.checkTrainableWeightsConsistency();let x=t.makeTrainFunction(),b=t.getDedupedMetricsNames(),S,_;m?(t.makeTestFunction(),S=t.testFunction,_=b.slice().concat(b.map(D=>"val_"+D))):(S=null,h=[],_=b.slice());let E=ww(r.callbacks,r.yieldEvery);return await Bue(t,x,g,b,d,r.epochs,r.verbose,E,S,h,r.shuffle,_,r.initialEpoch,null,null)}finally{t.isTraining=!1,Hc(o,n),Hc(i,e),Hc(l,s),Hc(c,a),u!=null&&Fe(u)}}function pN(t){let n=[];t instanceof ut&&(t=[t]);for(let e=0;e<t.length;++e){let r=t[e];if(r.rank===1)n.push(rl(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(r)}}return n}function Hc(t,n){if(t==null)return;let e=[];if(n instanceof ut)e.push(n.id);else if(Array.isArray(n))n.forEach(o=>e.push(o.id));else if(n!=null)for(let o in n){let i=n[o];e.push(i.id)}let r=[];if(t instanceof ut)e.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(t!=null)for(let o in t){let i=t[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function zue(t){return t instanceof ut}function fN(t){return Array.isArray(t)}function Iz(t){return!zue(t)&&!fN(t)}function Tz(t,n,e,r=!0,o=""){if(n==null||n.length===0){if(t!=null){let s=!1;if(fN(t)&&t.length>0)s=!0;else if(Iz(t)){for(let a in t)if(t.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new L(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return n.map(s=>null);let i;if(Iz(t)){t=t,i=[];for(let s of n){if(t[s]==null)throw new L(`No data provided for "${s}". Need data for each key in: ${n}`);i.push(t[s])}}else if(fN(t)){if(t=t,t.length!==n.length)throw new L(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${n.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,n.length>1)throw new L(`The model ${o} expects ${n.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=pN(i),e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new L(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u>=0&&c!==u)throw new L(`Error when checking ${o}: expected ${n[s]} to have shape [${e[s]}], but got array with shape [${a.shape}].`)}}return i}function Uue(t,n,e){let r=ri(t.map(i=>i.shape[0]));r.sort();let o=ri(n.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new L(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(o.length>1)throw new L(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!w.arraysEqual(r,o))throw new L(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function jue(t,n,e){let r=[Pd,Im,$d];for(let o=0;o<t.length;++o){let i=t[o],s=n[o],a=e[o];if(s!=null){if(s===$d&&i.shape[i.shape.length-1]===1)throw new L(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){let d=l[u],p=c[u];if(p!=null&&d!==p)throw new L(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Dz(t,n,e,r=!0,o=""){let i;if(Array.isArray(t)){if(t.length!==n.length)throw new L(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${n.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(n.length>1)throw new L(`The model expects ${n.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new L(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u!==c)throw new L(`Error when checking ${o}: expected ${n[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Gue(t,n){if(t==null||Array.isArray(t)&&t.length===0)return n.map(r=>[]);let e;if(typeof t=="string"||typeof t=="function")e=[t];else if(Array.isArray(t)||typeof t=="object")e=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(e))return n.map(r=>e);{let r=[];for(let o of n){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var Wue="layers-model",sl=(()=>{class t extends Aw{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new L("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");hz(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=mz(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Zn))throw new L("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new L(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(Sw(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new L(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>Sw(l))}else{let a=Sw(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],$i("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=Gue(e.metrics,this.outputNames),s=(a,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,a])};$i("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(u=>{let d="",p,f,m;for(let h of u){if(typeof h=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(h)!==-1){let x=this.internalOutputShapes[a];x[x.length-1]===1||this.lossFunctions[a]===Im?["accuracy","acc"].indexOf(h)!==-1?f=Iw:["crossentropy","ce"].indexOf(h)!==-1&&(f=sN):this.lossFunctions[a]===Em?["accuracy","acc"].indexOf(h)!==-1?f=aN:["crossentropy","ce"].indexOf(h)!==-1&&(f=lN):["accuracy","acc"].indexOf(h)!==-1?f=Tw:["crossentropy","ce"].indexOf(h)!==-1&&(f=Dw);let b;["accuracy","acc"].indexOf(h)!==-1?b="acc":["crossentropy","ce"].indexOf(h)!==-1&&(b="ce"),m=f,p=d+b}else m=pz(h),p=d+xy(h);let g;$i(p,()=>{g=m}),s(a,p,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;Mw(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,u=this.testLoop(c,l,i,o.verbose,o.steps);return Mn(u)}finally{Hc(a[0],e),Hc(a[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),Sz(this,e,r)}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new L(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new L(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new L("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new xs;if(e instanceof ut&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new L(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let u=e[c.name];if(u==null)throw new L(`No value is provided for the model's input ${c.name}`);a.add(c,u)}let l=Ld(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=ti(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let c=a.indexOf(e[l]);if(c!==-1&&(r[l]=s[c],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new L(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return z(()=>{let i=this.checkNumSamples(e);if(o)throw new Ne("Verbose predictLoop() is not implemented yet.");let s=Pw(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)z(()=>{let u=s[l][0],d=s[l][1],p=Nm(e,u,d),f=[];if(Array.isArray(p))for(let h=0;h<p.length;++h)f.push({key:this.inputs[h],value:p[h]});else f.push({key:this.inputs[0],value:p});let m=new xs(f);return Ld(this.outputs,m)}).forEach((u,d)=>a[d].push(u));return Mn(a.map(l=>Bt(l,0)))})}predict(e,r={}){let o=pN(e);Dz(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return Mw(i),this.predictLoop(o,i)}finally{Hc(o,e)}}predictOnBatch(e){Dz(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new wr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===Em?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=Tz(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=Tz(r,this.feedOutputNames,s,!1,"target"),Uue(e,r,null),jue(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new L(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,o,i,s=!0,a){let[l,c]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(i!=null){let d=Rw(i,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(await Ow(c[p],null,d[p]))}return[l,c,u]}testLoop(e,r,o,i=0,s){return z(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new Ne("Verbose mode is not implemented yet.");if(s!=null)throw new Ne("steps mode in testLoop() is not implemented yet");{let c=Pw(a,o),u=Jo(ur(0,a));for(let d=0;d<c.length;++d){let p=c[d][0],f=c[d][1],m=tl(u,p,f-p),h=Fw(r,m),g=e(h);if(d===0)for(let x=0;x<g.length;++x)l.push(Ae(0));for(let x=0;x<g.length;++x){let b=g[x];l[x]=te(l[x],V(f-p,b))}}for(let d=0;d<l.length;++d)l[d]=he(l[d],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(WD(e,i)>1){let a=WD(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let p=[];for(let g=0;g<this.inputs.length;++g)p.push({key:this.inputs[g],value:o[g]});let f=new xs(p),m=Ld(this.outputs,f,{training:!0}),h;for(let g=0;g<this.lossFunctions.length;++g){let x=this.lossFunctions[g],b=x(i[g],m[g]);s[g]!=null&&(b=vz(b,s[g]));let S=Gt(b);r.push(S),g===0?h=b:h=te(h,b)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=r[g];else{let b=this.metricsTensors[g][0],S=this.metricsTensors[g][1];x=Gt(b(i[S],m[S]))}Rn(x),a.push(x)}return h=Gt(h),this.calculateLosses().forEach(g=>{h=te(h,g)}),h},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>z(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:i[u]});let l=new xs(a),c=Ld(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],p=Gt(d(s[u],c[u]));u===0?o=p:o=te(o,p),r.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=Gt(d(s[p],c[p]));r.push(f)}return r})}async fit(e,r,o={}){return Ez(this,e,r,o)}async fitDataset(e,r){return _z(this,e,r)}async trainOnBatch(e,r){let o=await this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),c=[];for(let u of l){let d=await u.data();c.push(d[0])}return Fe(l),Mn(c)}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=jg().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-jg().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ni(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>ni(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=ni(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ni(xy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ni(xy(e)));{let e={};for(let r in this.metrics)e[r]=ni(xy(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=Tm(e.optimizer_config),o=$r(r),i;if(typeof e.loss=="string")i=el(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>el(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=el(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>el(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=el(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}async save(e,r){if(typeof e=="string"){let u=Ko.getSaveHandlers(e);if(u.length===0)throw new L(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new L(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new L("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=await Ko.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:Wue,generatedBy:`TensorFlow.js tfjs-layers v${Dm}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:d,specs:p}=await Ko.encodeWeights(await this.optimizer.getWeights(),u);o.specs.push(...p),o.data=Ko.concatenateArrayBuffers([o.data,d])}return this.userDefinedMetadata!=null&&(uN(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)}setUserDefinedMetadata(e){uN(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return t.className="Model",t})();Q.registerClass(sl);var Hue=(()=>{class t extends sl{}return t.className="Functional",t})();Q.registerClass(Hue);async function Nz(t,n){if(n==null&&(n={}),typeof t=="string"){let e=Ko.getLoadHandlers(t,n);if(e.length===0)e.push(Ko.browserHTTPRequest(t,n));else if(e.length>1)throw new L(`Found more than one (${e.length}) load handlers for URL '${t}'`);t=e[0]}return que(t,void 0,n)}async function que(t,n,e){if(e==null&&(e={}),t.load==null)throw new L("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await t.load(),o=r.modelTopology;o.model_config!=null&&(o=o.model_config);let i=e.strict==null?!0:e.strict,s=r.weightData!=null&&r.weightSpecs!=null&&i,a=$r(Tm(o),n,s),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new L("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:c,optimizerWeights:u}=Kue(r.weightData,r.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Fe(c),Fe(u.map(d=>d.tensor))}return a}function Kue(t,n){let e=Ko.decodeWeights(t,n),r={},o=[];return n.forEach(i=>{i.group==="optimizer"?o.push({name:i.name,tensor:e[i.name]}):r[i.name]=e[i.name]}),{modelWeights:r,optimizerWeights:o}}var mN=(()=>{class t extends sl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Gc("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new L(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof t||e instanceof sl,o;if(r){if(o=e,o.outputs.length!==1)throw new L("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new L("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new L("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=oN({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new L(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new L("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=rN(this.outputs[0])}this.inboundNodes=[],new ol({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ti(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Ze(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new sl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}async evaluateDataset(e,r){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,o={}){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.fit(e,r,o)}async fitDataset(e,r){if(!this.built)throw new wr("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new L("Legacy serialization format not supported yet.");s=r}else w.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof t))throw new Ne(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=$r(c,void 0,i);i&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new L("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new L("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return t.className="Sequential",t})();Q.registerClass(mN);function hN(t,n){return n==null&&(n={}),Nz(t,n)}var pr=class extends Q.Serializable{getConfig(){return{}}},Xue=(()=>{class t extends pr{apply(e,r=1){return qB(e,r)}}return t.className="elu",t})();Q.registerClass(Xue);var Yue=(()=>{class t extends pr{apply(e){return Jg(e)}}return t.className="selu",t})();Q.registerClass(Yue);var Que=(()=>{class t extends pr{apply(e){return Zo(e)}}return t.className="relu",t})();Q.registerClass(Que);var Zue=(()=>{class t extends pr{apply(e){return z(()=>bd(6,Zo(e)))}}return t.className="relu6",t})();Q.registerClass(Zue);var Jue=(()=>{class t extends pr{apply(e){return e}}return t.className="linear",t})();Q.registerClass(Jue);var ede=(()=>{class t extends pr{apply(e){return Xo(e)}}return t.className="sigmoid",t})();Q.registerClass(ede);var tde=(()=>{class t extends pr{apply(e){return XB(e)}}return t.className="hardSigmoid",t})();Q.registerClass(tde);var nde=(()=>{class t extends pr{apply(e){return fs(e)}}return t.className="softplus",t})();Q.registerClass(nde);var rde=(()=>{class t extends pr{apply(e){return KB(e)}}return t.className="softsign",t})();Q.registerClass(rde);var ode=(()=>{class t extends pr{apply(e){return im(e)}}return t.className="tanh",t})();Q.registerClass(ode);var yN=(()=>{class t extends pr{apply(e,r=-1){return Sd(e,r)}}return t.className="softmax",t})();Q.registerClass(yN);var ide=(()=>{class t extends pr{apply(e,r=-1){return Xg(e,r)}}return t.className="logSoftmax",t})();Q.registerClass(ide);var sde=(()=>{class t extends pr{apply(e,r=1){return z(()=>Xo(e.mul(r)).mul(e))}}return t.className="swish",t})();Q.registerClass(sde);var ade=(()=>{class t extends pr{apply(e){return z(()=>V(e,im(fs(e))))}}return t.className="mish",t})();Q.registerClass(ade);function Vi(t){return t.getClassName()}function gN(t,n={}){return gs(t,Q.SerializationMap.getMap().classNameMap,n,"activation")}function Bi(t){if(t==null){let n={};return n.className="linear",n.config={},gN(n)}if(typeof t=="string"){let n={};return n.className=t,n.config={},gN(n)}else return t instanceof pr?t:gN(t)}function lde(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var $w=class extends Q.Serializable{},Rz=(()=>{class t extends $w{constructor(e){super(),lde(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return z(()=>{let r=zt([1]);return this.hasL1&&(r=te(r,we(V(this.l1,wn(e))))),this.hasL2&&(r=te(r,we(V(this.l2,Md(e))))),r.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return t.className="L1L2",t})();Q.registerClass(Rz);var kz={l1l2:"L1L2"};function bt(t){return xm(t)}function Az(t,n={}){return gs(t,Q.SerializationMap.getMap().classNameMap,n,"regularizer")}function At(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in kz?kz[t]:t,config:{}};return Az(e)}else return t instanceof $w?t:Az(t)}var Oz=(()=>{class t extends Ue{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=Le(e);let o=Zo(e);return this.maxValue!=null&&(o=Bn(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ReLU",t})();Q.registerClass(Oz);var Mz=(()=>{class t extends Ue{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Le(e);return xd(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LeakyReLU",t})();Q.registerClass(Mz);var Fz=(()=>{class t extends Ue{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=It(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=At(e.alphaRegularizer),this.alphaConstraint=Jt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new L(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ze(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new kt({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=Le(e),Cd(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Ft(this.alphaInitializer),alphaRegularizer:bt(this.alphaRegularizer),alphaConstraint:Zt(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return t.className="PReLU",t})();Q.registerClass(Fz);var Pz=(()=>{class t extends Ue{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ne(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Le(e);return Qa(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ELU",t})();Q.registerClass(Pz);var $z=(()=>{class t extends Ue{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=Le(e);return o.mul(nl(o.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ThresholdedReLU",t})();Q.registerClass($z);var Lz=(()=>{class t extends Ue{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new yN().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let o=Le(e);return this.softmax(o,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Softmax",t})();Q.registerClass(Lz);function qc(t,n,e){if(typeof t=="number")return ti(t,n);if(t.length!==n)throw new L(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${t.length} elements.`);for(let r=0;r<n;++r){let o=t[r];if(!UB(o))throw new L(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Lr(t,n,e,r,o=1){if(t==null)return t;let i=n+(n-1)*(o-1),s;return e==="same"?s=t:s=t-i+1,Math.floor((s+r-1)/r)}function zi(t,n,e,r){if(t==null)return null;if(r==="valid")t=t*n+Li([e-n,0]);else if(r==="same")t=t*n;else throw new L(`Unsupport padding mode: ${r}.`);return t}function by(t,n){return z(()=>(Wt(n),n==="channelsFirst"?ot(t,[0,2,3,1]):t))}function xN(t,n){return z(()=>(Wt(n),n==="channelsFirst"?ot(t,[0,2,3,4,1]):t))}function ude(t,n,e,r=1,o="valid",i,s=1){return z(()=>{if(i==null&&(i=br()),Wt(i),t.shape.length!==3)throw new L(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(n.shape.length!==3)throw new L(`The kernel for a conv1dWithBias operation should be 3, but is ${n.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new L(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=ot(t,[0,2,1])),o==="causal")throw new Ne("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Wg(t,n,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=_r(a,e)),a})}function Vz(t,n,e,r=[1,1],o="valid",i,s,a=null){return z(()=>{if(i==null&&(i=br()),Wt(i),t.rank!==3&&t.rank!==4)throw new L(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(n.rank!==3&&n.rank!==4)throw new L(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=by(t,i);if(o==="causal")throw new Ne("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=kd.conv2d({x:l,filter:n,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=ot(l,[0,3,1,2])),l})}function dde(t,n,e,r=[1,1,1],o="valid",i,s){return z(()=>{if(i==null&&(i=br()),Wt(i),t.rank!==4&&t.rank!==5)throw new L(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(n.rank!==4&&n.rank!==5)throw new L(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=xN(t,i);if(o==="causal")throw new Ne("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=QT(a,n,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=_r(a,e)),i==="channelsFirst"&&(a=ot(a,[0,4,1,2,3])),a})}var vy=class t extends Ue{constructor(n,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(e),this.rank=n,ln(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ne(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=qc(e.kernelSize,n,"kernelSize"),this.strides=qc(e.strides==null?1:e.strides,n,"strides"),this.padding=e.padding==null?"valid":e.padding,Cr(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),this.activation=Bi(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Jt(e.biasConstraint),this.biasRegularizer=At(e.biasRegularizer),this.activityRegularizer=At(e.activityRegularizer),this.dilationRate=qc(e.dilationRate==null?1:e.dilationRate,n,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new L(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new L(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new L(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(n){if(_o("kernelSize"in n,"required key 'kernelSize' not in config"),typeof n.kernelSize!="number"&&!iw(n.kernelSize,"number",1,3))throw new L(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(n.kernelSize)}.`)}getConfig(){let n={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Vi(this.activation),useBias:this.useBias,biasInitializer:Ft(this.biasInitializer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),biasConstraint:Zt(this.biasConstraint)},e=super.getConfig();return Object.assign(n,e),n}},km=class t extends vy{constructor(n,e){super(n,e),this.kernel=null,t.verifyArgs(e),this.filters=e.filters,ln(this.filters,"filters"),this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Jt(e.kernelConstraint),this.kernelRegularizer=At(e.kernelRegularizer)}build(n){n=Ze(n);let e=this.dataFormat==="channelsFirst"?1:n.length-1;if(n[e]==null)throw new L(`The channel dimension of the input should be defined. Found ${n[e]}`);let r=n[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(n,e){return z(()=>{n=Le(n);let r,o=this.bias==null?null:this.bias.read(),i=sw(this.activation.getClassName());if(i!=null&&this.rank===2)r=Vz(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=ude(n,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=Vz(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=dde(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ne("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(n){n=Ze(n);let e=[],r=this.dataFormat==="channelsLast"?n.slice(1,n.length-1):n.slice(2);for(let i=0;i<r.length;++i){let s=Lr(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[n[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let n={filters:this.filters,kernelInitializer:Ft(this.kernelInitializer),kernelRegularizer:bt(this.kernelRegularizer),kernelConstraint:Zt(this.kernelConstraint)},e=super.getConfig();return Object.assign(n,e),n}static verifyArgs(n){if(!("filters"in n)||typeof n.filters!="number"||n.filters<1)throw new L(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(n.filters)}`)}},vN=(()=>{class t extends km{constructor(e){super(2,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!iw(e.kernelSize,"number",1,2))throw new L(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv2D",t})();Q.registerClass(vN);var bN=(()=>{class t extends km{constructor(e){super(3,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new L(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv3D",t})();Q.registerClass(bN);var Bz=(()=>{class t extends vN{constructor(e){if(super(e),this.inputSpec=[new kt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new L(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ze(e),e.length!==4)throw new L("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new L("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new kt({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{let o=Le(e);if(o.shape.length!==4)throw new L(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let c=i[a],u=i[l],d=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],m=this.strides[1],h=zi(c,f,d,this.padding),g=zi(u,m,p,this.padding),x=[s,h,g,this.filters];this.dataFormat!=="channelsLast"&&(o=ot(o,[0,2,3,1]));let b=Hg(o,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=ot(b,[0,3,1,2])),this.bias!=null&&(b=_r(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=Ze(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return r[o]=this.filters,r[i]=zi(r[i],c,a,this.padding),r[s]=zi(r[s],u,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv2DTranspose",t})();Q.registerClass(Bz);var zz=(()=>{class t extends bN{constructor(e){if(super(e),this.inputSpec=[new kt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new L(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ze(e),e.length!==5)throw new L("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new L("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new kt({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{let o=Le(e);if(o.shape.length!==5)throw new L(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,c;this.dataFormat==="channelsFirst"?(c=2,a=3,l=4):(c=1,a=2,l=3);let u=i[c],d=i[a],p=i[l],f=this.kernelSize[0],m=this.kernelSize[1],h=this.kernelSize[2],g=this.strides[0],x=this.strides[1],b=this.strides[2],S=zi(u,g,f,this.padding),_=zi(d,x,m,this.padding),E=zi(p,b,h,this.padding),I=[s,S,_,E,this.filters];this.dataFormat!=="channelsLast"&&(o=ot(o,[0,2,3,4,1]));let D=ZT(o,this.kernel.read(),I,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=ot(D,[0,4,1,2,3])),this.bias!==null&&(D=_r(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=Ze(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],f=this.strides[2];return r[o]=this.filters,r[i]=zi(r[i],d,l,this.padding),r[s]=zi(r[s],p,c,this.padding),r[a]=zi(r[a],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv3DTranspose",t})();Q.registerClass(zz);var pde=(()=>{class t extends km{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new L("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new L("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new L(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=It(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=At(r.depthwiseRegularizer),this.depthwiseConstraint=Jt(r.depthwiseConstraint),this.pointwiseInitializer=It(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=At(r.pointwiseRegularizer),this.pointwiseConstraint=Jt(r.pointwiseConstraint)}build(e){if(e=Ze(e),e.length<this.rank+2)throw new L(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new L(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new kt({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{e=Le(e);let o;if(this.rank===1)throw new Ne("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ot(e,[0,2,3,1])),o=ey(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=_r(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=ot(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Ft(this.depthwiseInitializer),e.pointwiseInitializer=Ft(this.pointwiseInitializer),e.depthwiseRegularizer=bt(this.depthwiseRegularizer),e.pointwiseRegularizer=bt(this.pointwiseRegularizer),e.depthwiseConstraint=Zt(this.depthwiseConstraint),e.pointwiseConstraint=Zt(this.pointwiseConstraint),e}}return t.className="SeparableConv",t})(),Uz=(()=>{class t extends pde{constructor(e){super(2,e)}}return t.className="SeparableConv2D",t})();Q.registerClass(Uz);var jz=(()=>{class t extends km{constructor(e){super(1,e),t.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!iw(e.kernelSize,"number",1,1))throw new L(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv1D",t})();Q.registerClass(jz);var Gz=(()=>{class t extends Ue{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return z(()=>{if(e=Le(e),this.dataFormat==="channelsLast"){let o=dy(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return dy(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=dy(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return dy(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Cropping2D",t})();Q.registerClass(Gz);var Wz=(()=>{class t extends Ue{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,BB(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return z(()=>{let o=Le(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=ot(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a]);return ot(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="UpSampling2D",t})();Q.registerClass(Wz);function fde(t,n,e=[1,1],r="valid",o,i){return z(()=>{o==null&&(o=br()),Wt(o);let s=by(t,o);if(t.rank!==4)throw new L(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(n.rank!==4)throw new L(`depthwiseKernel is required to be 4-D, but is instead ${n.rank}-D`);return s=Ya(s,n,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=ot(s,[0,3,1,2])),s})}var Hz=(()=>{class t extends vy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=It(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Jt(e.depthwiseConstraint),this.depthwiseRegularizer=At(e.depthwiseRegularizer)}build(e){if(e=Ze(e),e.length<4)throw new L(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new L(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{e=Le(e);let o=fde(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=_r(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=Ze(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=Lr(r,this.kernelSize[0],this.padding,this.strides[0]),a=Lr(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Ft(this.depthwiseInitializer),e.depthwiseRegularizer=bt(this.depthwiseRegularizer),e.depthwiseConstraint=Zt(this.depthwiseRegularizer),e}}return t.className="DepthwiseConv2D",t})();Q.registerClass(Hz);function wN(t,n,e,r){if(Array.isArray(t)){if(n!=null||e!=null)throw new L("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(n=t.slice(1,t.length)),t=t[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return n=o(n),e=o(e),{inputs:t,initialState:n,constants:e}}function CN(t,n,e,r=!1,o,i,s=!1,a=!1){return z(()=>{let l=n.shape.length;if(l<3)throw new L(`Input should be at least 3D, but is ${l}D.`);let c=[1,0].concat(ur(2,l));if(n=ot(n,c),i!=null)throw new Ne("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=o.asType("bool").asType("float32"),o.rank===l-1&&(o=Yn(o,-1)),o=ot(o,c)),r&&(n=wo(n,0),o!=null&&(o=wo(o,0)));let u=[],d,p=e,f=n.shape[0],m=Pr(n),h;o!=null&&(h=Pr(o));for(let x=0;x<f;++x){let b=m[x],S=z(()=>t(b,p));if(o==null)d=S[0],p=S[1];else{let _=z(()=>{let E=h[x],I=On(E).sub(E),D=S[0].mul(E).add(p[0].mul(I)),O=p.map((R,$)=>S[1][$].mul(E).add(R.mul(I)));return{output:D,newStates:O}});d=_.output,p=_.newStates}a&&u.push(d)}let g;return a&&(g=Qn(u,1)),[d,g,p]})}var Xc=(()=>{class t extends Ue{constructor(e){super(e);let r;if(e.cell==null)throw new L("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new EN({cells:e.cell}):r=e.cell,r.stateSize==null)throw new L("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new kt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return ur(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){gw(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return z(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ne("Constants support is not implemented in RNN yet.");gw(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new kt({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!w.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new L(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new kt({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){z(()=>{if(!this.stateful)throw new Co("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new L("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>zt([o,i])):this.states_=[zt([o,this.cell.stateSize])];else if(e==null)Fe(this.states_),this.keptStates!=null&&(Fe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>zt([o,i])):this.states_[0]=zt([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new L(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Fe(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!w.arraysEqual(s.shape,l))throw new L(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>Rn(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=wN(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new kt({shape:u.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof dr){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return z(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=Le(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new L(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},u=CN((h,g)=>{let x=this.cell.call([h].concat(g),l);return[x[0],x.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),d=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,i);let m=this.returnSequences?p:d;return this.returnState?[m].concat(f):m})}getInitialState(e){return z(()=>{let r=zt(e.shape);return r=we(r,[1,2]),r=rl(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?uw(r,[1,o]):r):this.cell.stateSize>1?[uw(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===t.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign({},o,e,r)}static fromConfig(e,r,o={}){let i=r.cell,s=$r(i,o);return new e(Object.assign(r,{cell:s}))}}return t.className="RNN",t})();Q.registerClass(Xc);var Kc=class extends Ue{},_N=(()=>{class t extends Kc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ln(this.units,"units"),this.activation=Bi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=At(e.kernelRegularizer),this.recurrentRegularizer=At(e.recurrentRegularizer),this.biasRegularizer=At(e.biasRegularizer),this.kernelConstraint=Jt(e.kernelConstraint),this.recurrentConstraint=Jt(e.recurrentConstraint),this.biasConstraint=Jt(e.biasConstraint),this.dropout=Od([1,Li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Od([1,Li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ze(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{if(e=e,e.length!==2)throw new L(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=al({ones:()=>On(e),rate:this.dropout,training:i})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=al({ones:()=>On(o),rate:this.recurrentDropout,training:i}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=ii(V(e,a),this.kernel.read()):s=ii(e,this.kernel.read()),this.bias!=null&&(s=_r(s,this.bias.read())),l!=null&&(o=V(o,l));let c=te(s,ii(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Vi(this.activation),useBias:this.useBias,kernelInitializer:Ft(this.kernelInitializer),recurrentInitializer:Ft(this.recurrentInitializer),biasInitializer:Ft(this.biasInitializer),kernelRegularizer:bt(this.kernelRegularizer),recurrentRegularizer:bt(this.recurrentRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:Zt(this.kernelConstraint),recurrentConstraint:Zt(this.recurrentConstraint),biasConstraint:Zt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,r)}}return t.className="SimpleRNNCell",t})();Q.registerClass(_N);var qz=(()=>{class t extends Xc{constructor(e){e.cell=new _N(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return t.className="SimpleRNN",t})();Q.registerClass(qz);var SN=(()=>{class t extends Kc{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new L("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ln(this.units,"units"),this.activation=Bi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Bi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=At(e.kernelRegularizer),this.recurrentRegularizer=At(e.recurrentRegularizer),this.biasRegularizer=At(e.biasRegularizer),this.kernelConstraint=Jt(e.kernelConstraint),this.recurrentConstraint=Jt(e.recurrentConstraint),this.biasConstraint=Jt(e.biasConstraint),this.dropout=Od([1,Li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Od([1,Li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ze(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{if(e=e,e.length!==2)throw new L(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=al({ones:()=>On(e),rate:this.dropout,training:o,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=al({ones:()=>On(i),rate:this.recurrentDropout,training:o,count:3}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,c,u;0<this.dropout&&this.dropout<1&&(e=V(e,s[0]));let d=ii(e,this.kernel.read());this.useBias&&(d=_r(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,a[0]));let p=this.recurrentKernel.read(),[f,m]=jn(p,[2*this.units,this.units],p.rank-1),h=ii(i,f),[g,x,b]=jn(d,3,d.rank-1),[S,_]=jn(h,2,h.rank-1);l=this.recurrentActivation.apply(te(g,S)),c=this.recurrentActivation.apply(te(x,_));let E=ii(V(c,i),m);u=this.activation.apply(te(b,E));let I=te(V(l,i),V(te(1,xt(l)),u));return[I,I]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Vi(this.activation),recurrentActivation:Vi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ft(this.kernelInitializer),recurrentInitializer:Ft(this.recurrentInitializer),biasInitializer:Ft(this.biasInitializer),kernelRegularizer:bt(this.kernelRegularizer),recurrentRegularizer:bt(this.recurrentRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:Zt(this.kernelConstraint),recurrentConstraint:Zt(this.recurrentConstraint),biasConstraint:Zt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,r)}}return t.className="GRUCell",t})();Q.registerClass(SN);var Kz=(()=>{class t extends Xc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new SN(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="GRU",t})();Q.registerClass(Kz);var wy=(()=>{class t extends Kc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ln(this.units,"units"),this.activation=Bi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=Bi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=At(e.kernelRegularizer),this.recurrentRegularizer=At(e.recurrentRegularizer),this.biasRegularizer=At(e.biasRegularizer),this.kernelConstraint=Jt(e.kernelConstraint),this.recurrentConstraint=Jt(e.recurrentConstraint),this.biasConstraint=Jt(e.biasConstraint),this.dropout=Od([1,Li([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Od([1,Li([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Ze(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends Er{apply(c,u){let d=s.apply([a]),p=new fw().apply([a]),f=s.apply([a*2]);return YD(YD(d,p),f)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return z(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new L(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=al({ones:()=>On(e),rate:this.dropout,training:o,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=al({ones:()=>On(i),rate:this.recurrentDropout,training:o,count:4}));let a=this.dropoutMask,l=this.recurrentDropoutMask,c,u,d,p;0<this.dropout&&this.dropout<1&&(e=V(e,a[0]));let f=ii(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,l[0])),f=te(f,ii(i,this.recurrentKernel.read())),this.useBias&&(f=_r(f,this.bias.read()));let[m,h,g,x]=jn(f,4,f.rank-1);c=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(h),d=te(V(u,s),V(c,this.activation.apply(g))),p=this.recurrentActivation.apply(x);let b=V(p,this.activation.apply(d));return[b,b,d]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Vi(this.activation),recurrentActivation:Vi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Ft(this.kernelInitializer),recurrentInitializer:Ft(this.recurrentInitializer),biasInitializer:Ft(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:bt(this.kernelRegularizer),recurrentRegularizer:bt(this.recurrentRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:Zt(this.kernelConstraint),recurrentConstraint:Zt(this.recurrentConstraint),biasConstraint:Zt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,r)}}return t.className="LSTMCell",t})();Q.registerClass(wy);var Xz=(()=>{class t extends Xc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new wy(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="LSTM",t})();Q.registerClass(Xz);var EN=(()=>{class t extends Kc{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return z(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let c=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){gw(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{$i(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign({},e,i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push($r(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return fy(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}Sm(r)}}return t.className="StackedRNNCells",t})();Q.registerClass(EN);function al(t){let{ones:n,rate:e,training:r=!1,count:o=1}=t,i=()=>pw(n(),e),s=()=>jc(i,n,r);return!o||o<=1?Rn(s().clone()):Array(o).fill(void 0).map(s).map(l=>Rn(l.clone()))}var mde=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e};var hde=(()=>{class t extends Xc{constructor(e){if(e.unroll)throw new Ne("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ne("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new kt({ndim:5})]}call(e,r){return z(()=>{if(this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new L("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return z(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=zt(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){z(()=>{if(!this.stateful)throw new Co("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new L("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zt(s)):this.states_=[zt(s)];else if(e==null)Fe(this.states_),this.keptStates!=null&&(Fe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>zt(s)):this.states_[0]=zt(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new L(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Fe(this.states_);for(let l=0;l<this.states_.length;++l){let c=e[l],u=s;if(!w.arraysEqual(c.shape,u))throw new L(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>Rn(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,c=r==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=Lr(u,i[0],s,a[0],l[0]),f=Lr(d,i[1],s,a[1],l[1]);return[...e.slice(0,2),...c?[o,p,f]:[p,f,o]]}}return t.className="ConvRNN2D",t})(),IN=(()=>{class t extends wy{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign({},e,{units:r})),this.filters=r,ln(this.filters,"filters"),this.kernelSize=qc(o,2,"kernelSize"),this.kernelSize.forEach(c=>ln(c,"kernelSize")),this.strides=qc(i||1,2,"strides"),this.strides.forEach(c=>ln(c,"strides")),this.padding=s||"valid",Cr(this.padding),this.dataFormat=a||"channelsLast",Wt(this.dataFormat),this.dilationRate=qc(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>ln(c,"dilationRate"))}build(e){var r;e=Ze(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new L(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;c=new(r=class extends Er{apply(f,m){let h=u.apply([d]),g=no([d]),x=u.apply([d*2]);return bm([h,g,x])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return z(()=>{if(e.length!==3)throw new L(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=al({ones:()=>On(i),rate:this.dropout,training:o,count:l}));let c=this.dropoutMask,u=(ue,fe,de)=>!fe||!fe[de]?ue:V(fe[de],ue),d=u(i,c,0),p=u(i,c,1),f=u(i,c,2),m=u(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=al({ones:()=>On(s),rate:this.recurrentDropout,training:o,count:l}));let h=this.recurrentDropoutMask,g=u(s,h,0),x=u(s,h,1),b=u(s,h,2),S=u(s,h,3),_=3,[E,I,D,O]=jn(this.kernel.read(),l,_),[R,$,G,W]=this.useBias?jn(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,E,R,this.padding),p=this.inputConv(p,I,$,this.padding),f=this.inputConv(f,D,G,this.padding),m=this.inputConv(m,O,W,this.padding);let[q,X,K,Y]=jn(this.recurrentKernel.read(),l,_);g=this.recurrentConv(g,q),x=this.recurrentConv(x,X),b=this.recurrentConv(b,K),S=this.recurrentConv(S,Y);let re=this.recurrentActivation.apply(te(d,g)),J=this.recurrentActivation.apply(te(p,x)),ne=te(V(J,a),V(re,this.activation.apply(te(f,b)))),se=V(this.recurrentActivation.apply(te(m,S)),this.activation.apply(ne));return[se,se,ne]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=mde(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},o,i)}inputConv(e,r,o,i){let s=eo(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?_r(s,o,this.dataFormat):s}recurrentConv(e,r){return eo(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return t.className="ConvLSTM2DCell",t})();Q.registerClass(IN);var Yz=(()=>{class t extends hde{constructor(e){let r=new IN(e);super(Object.assign({},e,{cell:r}))}static fromConfig(e,r){return new e(r)}}return t.className="ConvLSTM2D",t})();Q.registerClass(Yz);var TN=(()=>{class t extends Ue{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return jc(()=>pw(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return t.className="Dropout",t})();Q.registerClass(TN);var Qz=(()=>{class t extends TN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return t.className="SpatialDropout1D",t})();Q.registerClass(Qz);var Zz=(()=>{class t extends Ue{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,ln(this.units,"units"),this.activation=Bi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Jt(e.kernelConstraint),this.biasConstraint=Jt(e.biasConstraint),this.kernelRegularizer=At(e.kernelRegularizer),this.biasRegularizer=At(e.biasRegularizer),this.activityRegularizer=At(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ze(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Ze(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),i=sw(this.activation.getClassName()),s;return i!=null?s=ii(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=ii(o,this.kernel.read()),this.bias!=null&&(s=_r(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Vi(this.activation),useBias:this.useBias,kernelInitializer:Ft(this.kernelInitializer),biasInitializer:Ft(this.biasInitializer),kernelRegularizer:bt(this.kernelRegularizer),biasRegularizer:bt(this.biasRegularizer),activityRegularizer:bt(this.activityRegularizer),kernelConstraint:Zt(this.kernelConstraint),biasConstraint:Zt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dense",t})();Q.registerClass(Zz);var Jz=(()=>{class t extends Ue{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ze(e);for(let r of e.slice(1))if(r==null)throw new L(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],oi(e,1)]}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=o.transpose(i)}return HB(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return t.className="Flatten",t})();Q.registerClass(Jz);var e4=(()=>{class t extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.activation=Bi(e.activation)}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return this.activation.apply(o)})}getConfig(){let e={activation:Vi(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Activation",t})();Q.registerClass(e4);var t4=(()=>{class t extends Ue{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return z(()=>(e=Le(e),GB(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return t.className="RepeatVector",t})();Q.registerClass(t4);var n4=(()=>{class t extends Ue{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let c=0;c<i.length;++c){let u=i[c];if(this.isUnknown(u))if(a===null)a=c;else throw new L("Can only specifiy one unknown dimension.");else s*=u}let l=oi(e);if(a!==null){if(s===0||l%s!==0)throw new L(o);i[a]=l/s}else if(l!==s)throw new L(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return o.reshape(s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Reshape",t})();Q.registerClass(n4);var r4=(()=>{class t extends Ue{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=ur(1,e.dims.length+1);if(!w.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new kt({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ze(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return ot(Le(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Permute",t})();Q.registerClass(r4);var o4=(()=>{class t extends Ue{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=Le(e);return nm(zc(o,this.maskValue),-1)}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),a=nm(zc(o,this.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})}}return t.className="Masking",t})();Q.registerClass(o4);var i4=(()=>{class t extends Ue{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(Nt(e.inputLength))}this.inputDim=e.inputDim,ln(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ln(this.outputDim,"outputDim"),this.embeddingsInitializer=It(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=At(e.embeddingsRegularizer),this.activityRegularizer=At(e.activityRegularizer),this.embeddingsConstraint=Jt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return z(()=>this.maskZero?(e=Le(e),zc(e,Ie(e))):null)}computeOutputShape(e){if(e=Ze(e),this.inputLength==null)return[...e,this.outputDim];let r=Nt(this.inputLength);if(r.length!==e.length-1)throw new L(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new L(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return o.dtype!=="int32"&&(o=nl(o,"int32")),dw(this.embeddings.read(),o.as1D()).reshape(Ze(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Ft(this.embeddingsInitializer),embeddingsRegularizer:bt(this.embeddingsRegularizer),activityRegularizer:bt(this.activityRegularizer),embeddingsConstraint:Zt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Embedding",t})();Q.registerClass(i4);var ll=class extends Ue{constructor(n){super(n||{}),this.supportsMasking=!0}mergeFunction(n){throw new Ne}computeElementwiseOpOutputShape(n,e){if(n==null||e==null)return null;if(n.length<e.length)return this.computeElementwiseOpOutputShape(e,n);if(e.length===0)return n;let r=n.slice(0,n.length-e.length);for(let o=0;o<e.length;++o){let i=n[n.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new L("Operands could not be broadcast together with shapes "+JSON.stringify(n)+" "+JSON.stringify(e));r.push(i)}}return r}build(n){if(Array.isArray(n)&&!Array.isArray(n[0])&&(n=[Ze(n)]),n=n,n.length<2)throw new L(`A merge layer should be called on an Array of at least 2 inputs. Got ${n.length} input(s).`);let e=[];for(let i of n)i!=null&&i[0]!==null&&e.push(i[0]);if(e=ri(e),e.length>1)throw new L(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(n)}.`);let r=n[0]==null?null:n[0].slice(1);for(let i=1;i<n.length;++i){let s=n[i]==null?null:n[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=n.map(i=>i.length);n.indexOf(null)===-1&&ri(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(n,e){return z(()=>{if(n=n,this.reshapeRequired){let r=[],o=n.map(i=>i.rank);if(o.indexOf(null)===-1){let i=Li(o);for(let s of n){let a=s.rank;for(let l=0;l<i-a;++l)s=rl(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of n){let c=l.rank;if(c==null){let u=l.shape,d=u[0],p=u.slice(1).concat([d]),f=l.reshape([d].concat(oi(u.slice(1))));f=ot(f,[1,0]),f=f.reshape(p),r.push(f),i=!0}else if(c>1){let u=ur(1,c).concat([0]);r.push(ot(l,u)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=ot(s.reshape([-1,u]),[1,0]).reshape(d)}else if(a>1){let l=[a-1].concat(ur(0,a-1));s=ot(s,l)}}return s}}else return this.mergeFunction(n)})}computeOutputShape(n){n=n;let e;n[0]==null?e=null:e=n[0].slice(1);for(let o=1;o<n.length;++o){let i=n[o]==null?null:n[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of n)o!=null&&o[0]!==null&&r.push(o[0]);return r=ri(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(n,e){return z(()=>{if(e==null)return null;if(!Array.isArray(e))throw new L("`mask` should be an Array");if(!Array.isArray(n))throw new L("`inputs` should be an Array");if(e.length!==n.length)throw new L(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${n.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:Yn(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=cr(r,e[o]);return r})}},s4=(()=>{class t extends ll{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=te(r,e[o]);return r})}}return t.className="Add",t})();Q.registerClass(s4);var a4=(()=>{class t extends ll{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=V(r,e[o]);return r})}}return t.className="Multiply",t})();Q.registerClass(a4);var l4=(()=>{class t extends ll{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=te(r,e[o]);return V(1/e.length,r)})}}return t.className="Average",t})();Q.registerClass(l4);var c4=(()=>{class t extends ll{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=to(r,e[o]);return r})}}return t.className="Maximum",t})();Q.registerClass(c4);var u4=(()=>{class t extends ll{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=bd(r,e[o]);return r})}}return t.className="Minimum",t})();Q.registerClass(u4);var d4=(()=>{class t extends ll{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new L("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(w.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new L("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return z(()=>bm(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new L("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new L("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new L("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new L(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return z(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(On(e[a]).asType("bool")):r[a].rank<e[a].rank?i.push(Yn(r[a],-1)):i.push(r[a]);let s=Bt(i,this.axis);return Gg(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Concatenate",t})();Q.registerClass(d4);function Cy(t,n){for(;t<0;)t+=n;return t}function gde(t,n,e){if(t.shape.length>3||n.shape.length>3)throw new Ne("batchDot is not implemented for tensors of 4D or higher rank yet");if(w.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),w.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${n.shape.length}`),typeof e=="number"&&(e=[e,e]),t.dtype==="complex64"||n.dtype==="complex64")throw new Ne("batchDot is not implemented for complex64-type Tensors yet.");let r=t.shape.length,o=n.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return z(()=>{let s;if(r>o){s=r-o;let l=[];for(let c=0;c<s;++c)l.push(1);n=n.reshape(n.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let c=0;c<s;++c)l.push(1);t=t.reshape(t.shape.concat(l))}else s=0;let a;if(t.shape.length===2&&n.shape.length===2)i[0]===i[1]?a=t.mul(n).sum(i[0]):a=t.transpose([1,0]).mul(n).sum(i[1]);else{let l=i[0]!==t.shape.length-1,c=i[1]===n.shape.length-1;a=t.matMul(n,l,c)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let c=[];for(let u=l;u<l+s;++u)c.push(u);a=a.squeeze(c)}return a.shape.length===1&&(a=a.expandDims(1)),a})}var p4=(()=>{class t extends ll{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new Ne("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new L(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new L(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>Cy(s,e[a].shape.length)):i=[Cy(this.axes,r.shape.length),Cy(this.axes,o.shape.length)],this.normalize&&(r=my(r,i[0]),o=my(o,i[1])),gde(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[Cy(this.axes,e.length),Cy(this.axes,r.length)],o}computeOutputShape(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new Ne("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dot",t})();Q.registerClass(p4);var f4=(()=>{class t extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return jc(()=>wm(o.shape,0,this.stddev).add(o),()=>o,r.training||!1)})}}return t.className="GaussianNoise",t})();Q.registerClass(f4);var m4=(()=>{class t extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return this.rate>0&&this.rate<1?jc(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return o.mul(wm(o.shape,1,s))},()=>o,r.training||!1):o})}}return t.className="GaussianDropout",t})();Q.registerClass(m4);var h4=(()=>{class t extends Ue{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Le(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return z(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return jc(()=>{let s=Le(e),c=-1.6732632423543772*1.0507009873554805,u=vo(Ja(o),this.rate);u=nl(u,"float32");let d=((1-this.rate)*(1+this.rate*c**2))**-.5,p=-d*c*this.rate;return s.mul(u).add(u.add(-1).mul(c)).mul(d).add(p)},()=>Le(e),r.training||!1)}return e})}}return t.className="AlphaDropout",t})();Q.registerClass(h4);function _y(t,n,e,r,o,i=.001){let s;if(t.rank===2)s=jT(t,n,e,r,o,i);else if(t.rank===3)s=GT(t,n,e,r,o,i);else if(t.rank===4)s=WT(t,n,e,r,o,i);else throw new Ne(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return s}function yde(t,n,e,r,o=.001){return z(()=>{let i=dm(t,r),s=i.mean,a=i.variance;return[_y(t,s,a,e,n,o),s,a]})}function xde(t,n,e,r,o=.001){return z(()=>{let i=dm(t,r),s=i.mean,a=i.variance,l=[];for(let m of ur(0,t.rank))r.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let c=s.reshape(l),u=a.reshape(l),d=n==null?null:n.reshape(l),p=e==null?null:e.reshape(l);return[_y(t,c,u,p,d,o),s,a]})}function vde(t,n,e,r,o=.001){return w.arraysEqual(r.slice().sort(),ur(0,t.rank-1))?yde(t,n,e,r,o):xde(t,n,e,r,o)}var g4=(()=>{class t extends Ue{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=It(e.betaInitializer||"zeros"),this.gammaInitializer=It(e.gammaInitializer||"ones"),this.movingMeanInitializer=It(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=It(e.movingVarianceInitializer||"ones"),this.betaConstraint=Jt(e.betaConstraint),this.gammaConstraint=Jt(e.gammaConstraint),this.betaRegularizer=At(e.betaRegularizer),this.gammaRegularizer=At(e.gammaRegularizer)}build(e){e=Ze(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new L(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new kt({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return z(()=>{let o=r.training==null?!1:r.training,i=Le(e),s=i.shape,a=s.length,l=ur(0,a),c=this.axis>=0?this.axis:this.axis+a;l.splice(c,1);let u=ti(1,a);u[c]=s[c];let d=l.slice();d.sort();let p=!w.arraysEqual(d,ur(0,a).slice(0,a-1)),f=()=>{if(p){let S=this.movingMean.read().reshape(u),_=this.movingVariance.read().reshape(u),E=this.center?this.beta.read().reshape(u):null,I=this.scale?this.gamma.read().reshape(u):null;return _y(i,S,_,E,I,this.epsilon)}else return _y(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return f();let[m,h,g]=vde(i,this.gamma.read(),this.beta.read(),l,this.epsilon),x=(S,_,E)=>{z(()=>{let I=1-E,D=S.read(),O=D.sub(_).mul(I);S.write(D.sub(O))})};return(()=>{x(this.movingMean,h,this.momentum),x(this.movingVariance,g,this.momentum)})(),m})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ft(this.betaInitializer),gammaInitializer:Ft(this.gammaInitializer),movingMeanInitializer:Ft(this.movingMeanInitializer),movingVarianceInitializer:Ft(this.movingVarianceInitializer),betaRegularizer:bt(this.betaRegularizer),gammaRegularizer:bt(this.gammaRegularizer),betaConstraint:Zt(this.betaConstraint),gammaConstraint:Zt(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BatchNormalization",t})();Q.registerClass(g4);var y4=(()=>{class t extends Ue{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=It(e.betaInitializer||"zeros"),this.gammaInitializer=It(e.gammaInitializer||"ones"),this.betaRegularizer=At(e.betaRegularizer),this.gammaRegularizer=At(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ze(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==ri(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=Le(e),i=o.shape,s=i.length;return z(()=>{let{mean:l,variance:c}=dm(o,this.axis,!0),u=ti(1,s);for(let g of this.axis)u[g]=i[g];let d=g=>g!=null&&g.shape.length!==s&&this.axis!==[s-1]?g.reshape(u):g,p=d(this.gamma.read()),f=d(this.beta.read()),m=[],h=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(m.push(i[g]),h.push(1)):(m.push(1),h.push(i[g]));return l=l.tile(m),c=c.tile(m),p=p.tile(h),f=f.tile(h),_y(o,l,c,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Ft(this.betaInitializer),gammaInitializer:Ft(this.gammaInitializer),betaRegularizer:bt(this.betaRegularizer),gammaRegularizer:bt(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LayerNormalization",t})();Q.registerClass(y4);function bde(t,n,e){return z(()=>{if(t.rank!==4)throw new L(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(n==null&&(n=[[1,1],[1,1]]),n.length!==2||n[0].length!==2||n[1].length!==2)throw new L("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=br()),e!=="channelsLast"&&e!=="channelsFirst")throw new L(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],n[0],n[1]]:r=[[0,0],n[0],n[1],[0,0]],wd(t,r)})}var x4=(()=>{class t extends Ue{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?br():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new L(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new L(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new L(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new kt({ndim:4})]}computeOutputShape(e){e=Ze(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return z(()=>bde(Le(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ZeroPadding2D",t})();Q.registerClass(x4);function jw(t,n,e,r,o,i){return z(()=>{Wt(o),qD(i),Cr(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=br()),i==null&&(i="max"),t=by(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=vd(t,n,e,a):s=hd(t,n,e,a),o==="channelsFirst"&&(s=ot(s,[0,3,1,2])),s})}function v4(t,n,e,r,o,i){return z(()=>{Wt(o),qD(i),Cr(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=br()),i==null&&(i="max"),t=xN(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=dD(t,n,e,a):s=UT(t,n,e,a),o==="channelsFirst"&&(s=ot(s,[0,4,1,2,3])),s})}var Lw=class extends Ue{constructor(n){if(n.poolSize==null&&(n.poolSize=2),super(n),typeof n.poolSize=="number")this.poolSize=[n.poolSize];else if(Array.isArray(n.poolSize)&&n.poolSize.length===1&&typeof n.poolSize[0]=="number")this.poolSize=n.poolSize;else throw new L(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.poolSize)}`);if(ln(this.poolSize,"poolSize"),n.strides==null)this.strides=this.poolSize;else if(typeof n.strides=="number")this.strides=[n.strides];else if(Array.isArray(n.strides)&&n.strides.length===1&&typeof n.strides[0]=="number")this.strides=n.strides;else throw new L(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.strides)}`);ln(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,Cr(this.padding),this.inputSpec=[new kt({ndim:3})]}computeOutputShape(n){n=Ze(n);let e=Lr(n[1],this.poolSize[0],this.padding,this.strides[0]);return[n[0],e,n[2]]}call(n,e){return z(()=>{this.invokeCallHook(n,e),n=rl(Le(n),2);let r=this.poolingFunction(Le(n),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ed(r,[2])})}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(n,e),n}},b4=(()=>{class t extends Lw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),Cr(i),jw(e,r,o,i,s,"max")}}return t.className="MaxPooling1D",t})();Q.registerClass(b4);var w4=(()=>{class t extends Lw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),Cr(i),jw(e,r,o,i,s,"avg")}}return t.className="AveragePooling1D",t})();Q.registerClass(w4);var Vw=class extends Ue{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==2)throw new L(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides];ln(this.poolSize,"poolSize"),ln(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Wt(this.dataFormat),Cr(this.padding),this.inputSpec=[new kt({ndim:4})]}computeOutputShape(n){n=Ze(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2];return e=Lr(e,this.poolSize[0],this.padding,this.strides[0]),r=Lr(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r]:[n[0],e,r,n[3]]}call(n,e){return z(()=>(this.invokeCallHook(n,e),this.poolingFunction(Le(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},C4=(()=>{class t extends Vw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),Cr(i),jw(e,r,o,i,s,"max")}}return t.className="MaxPooling2D",t})();Q.registerClass(C4);var _4=(()=>{class t extends Vw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),Cr(i),jw(e,r,o,i,s,"avg")}}return t.className="AveragePooling2D",t})();Q.registerClass(_4);var Bw=class extends Ue{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==3)throw new L(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides,n.strides];ln(this.poolSize,"poolSize"),ln(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Wt(this.dataFormat),Cr(this.padding),this.inputSpec=[new kt({ndim:5})]}computeOutputShape(n){n=Ze(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2],o=this.dataFormat==="channelsFirst"?n[4]:n[3];return e=Lr(e,this.poolSize[0],this.padding,this.strides[0]),r=Lr(r,this.poolSize[1],this.padding,this.strides[1]),o=Lr(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r,o]:[n[0],e,r,o,n[4]]}call(n,e){return z(()=>(this.invokeCallHook(n,e),this.poolingFunction(Le(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},S4=(()=>{class t extends Bw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),Cr(i),v4(e,r,o,i,s,"max")}}return t.className="MaxPooling3D",t})();Q.registerClass(S4);var E4=(()=>{class t extends Bw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),Cr(i),v4(e,r,o,i,s,"avg")}}return t.className="AveragePooling3D",t})();Q.registerClass(E4);var zw=class extends Ue{constructor(n){super(n),this.inputSpec=[new kt({ndim:3})]}computeOutputShape(n){return[n[0],n[2]]}call(n,e){throw new Ne}},I4=(()=>{class t extends zw{constructor(e){super(e||{})}call(e,r){return z(()=>{let o=Le(e);return Gt(o,1)})}}return t.className="GlobalAveragePooling1D",t})();Q.registerClass(I4);var T4=(()=>{class t extends zw{constructor(e){super(e||{})}call(e,r){return z(()=>{let o=Le(e);return Un(o,1)})}}return t.className="GlobalMaxPooling1D",t})();Q.registerClass(T4);var Uw=class extends Ue{constructor(n){super(n),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Wt(this.dataFormat),this.inputSpec=[new kt({ndim:4})]}computeOutputShape(n){return n=n,this.dataFormat==="channelsLast"?[n[0],n[3]]:[n[0],n[1]]}call(n,e){throw new Ne}getConfig(){let n={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},D4=(()=>{class t extends Uw{call(e,r){return z(()=>{let o=Le(e);return this.dataFormat==="channelsLast"?Gt(o,[1,2]):Gt(o,[2,3])})}}return t.className="GlobalAveragePooling2D",t})();Q.registerClass(D4);var N4=(()=>{class t extends Uw{call(e,r){return z(()=>{let o=Le(e);return this.dataFormat==="channelsLast"?Un(o,[1,2]):Un(o,[2,3])})}}return t.className="GlobalMaxPooling2D",t})();Q.registerClass(N4);var Gw=class extends Ue{constructor(n){super(n),this.layer=n.layer}build(n){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(n){this.layer!=null&&(this.layer.trainable=n)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(n){this.layer.setWeights(n)}getConfig(){let n={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(n,e),n}setFastWeightInitDuringBuild(n){super.setFastWeightInitDuringBuild(n),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(n)}static fromConfig(n,e,r={}){let o=e.layer,i=$r(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new n(s)}},k4=(()=>{class t extends Gw{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ze(e),e.length<3)throw new L(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ze(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return z(()=>(e=Le(e),CN((a,l)=>[Le(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return t.className="TimeDistributed",t})();Q.registerClass(k4);function wde(t){ys(LB,"BidirectionalMergeMode",t)}var Cde="concat",A4=(()=>{class t extends Gw{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=$r(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=$r(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?Cde:e.mergeMode,wde(this.mergeMode),e.weights)throw new Ne("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):Mn(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=wN(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let u=o.length;if(u%2>0)throw new L("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let d=o.map(p=>new kt({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(i!=null)throw new Ne("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof dr;for(let u of a)if(u instanceof dr!==c)throw new L("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return z(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),u=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=wo(s,1));let l;return this.mergeMode==="concat"?l=bm([i,s]):this.mergeMode==="sum"?l=te(i,s):this.mergeMode==="ave"?l=V(.5,te(i,s)):this.mergeMode==="mul"?l=V(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){$i(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),$i(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=$r(r.layer);if(delete r.layer,r.numConstants!=null)throw new Ne("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return t.className="Bidirectional",t})();Q.registerClass(A4);var R4;(function(t){let n;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(R4||(R4={}));var Tpe=Zm(MN());var Epe=Zm(MN());var rCt=Symbol("out"),oCt=Symbol("field"),iCt=Symbol("quote"),sCt=Symbol("quoteafterquote"),aCt=Symbol("quoteinquote");function Z(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&w.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the CPU backend.`)})}var Lpe=Jn.whereImpl,K4=(()=>{class t extends Js{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Hu(this,Ka())}nextDataId(){return t.nextDataId++}write(e,r,o){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&T.warn(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&w.isString(o[0])){let s=o.map(a=>w.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return T.mergeRealAndImagArrays(i,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>w.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ee(e.shape,e.dtype,o)}makeOutput(e,r,o){let i=this.write(e,r,o);return Ka().makeTensorFromDataId(i,r,o,this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=w.now();return e(),{kernelMs:w.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Z([e],"where");let r=this.readSync(e.dataId);return Lpe(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return t.nextDataId=0,t})();var tk={};Wi(tk,{addImpl:()=>$N,bincountImpl:()=>Om,bincountReduceImpl:()=>qw,ceilImpl:()=>LN,concatImpl:()=>Kw,expImpl:()=>VN,expm1Impl:()=>zN,floorImpl:()=>UN,gatherV2Impl:()=>Xw,greaterImpl:()=>jN,lessImpl:()=>GN,linSpaceImpl:()=>Yw,logImpl:()=>WN,maxImpl:()=>Qw,maximumImpl:()=>HN,minimumImpl:()=>qN,multiplyImpl:()=>Sy,negImpl:()=>KN,notEqualImpl:()=>XN,prodImpl:()=>YN,rangeImpl:()=>Zw,rsqrtImpl:()=>QN,simpleAbsImpl:()=>PN,sliceImpl:()=>ZN,sparseFillEmptyRowsImpl:()=>Jw,sparseReshapeImpl:()=>eC,squaredDifferenceImpl:()=>JN,stridedSliceImpl:()=>tC,subImpl:()=>ek,tileImpl:()=>nC,topKImpl:()=>rC,transposeImpl:()=>Mm,uniqueImpl:()=>oC});function PN(t){let n=new Float32Array(t.length);for(let e=0;e<t.length;++e)n[e]=Math.abs(t[e]);return n}var Vpe=t=>{let{x:n}=t.inputs,e=t.backend;Z(n,"abs");let r=new Float32Array(w.sizeFromShape(n.shape)),o=e.data.get(n.dataId).values;return r=PN(o),e.makeOutput(r,n.shape,"float32")},X4={kernelName:Ul,backendName:"cpu",kernelFunc:Vpe};function et(t){return(n,e,r,o,i)=>{let s=T.assertAndGetBroadcastShape(n,e),a=s.length,l=w.computeStrides(s),c=w.sizeFromShape(s),u=w.getTypedArrayFromDType(i,c),d=n.length,p=e.length,f=w.computeStrides(n),m=w.computeStrides(e),h=T.getBroadcastDims(n,s),g=T.getBroadcastDims(e,s);if(h.length+g.length===0)for(let x=0;x<u.length;++x)u[x]=t(r[x%r.length],o[x%o.length]);else for(let x=0;x<u.length;++x){let b=w.indexToLoc(x,a,l),S=b.slice(-d);h.forEach(D=>S[D]=0);let _=w.locToIndex(S,d,f),E=b.slice(-p);g.forEach(D=>E[D]=0);let I=w.locToIndex(E,p,m);u[x]=t(r[_],o[I])}return[u,s]}}function Sn(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var Y4={kernelName:_f,backendName:"cpu",kernelFunc:Sn};function Am(t,n,e="float32"){if(e==="complex64"){let o=Am(t,n,"float32"),i=Am(t,n,"float32");return Sn({inputs:{real:o,imag:i},backend:t})}let r=w.makeZerosTypedArray(w.sizeFromShape(n),e);return t.makeTensorInfo(n,e,r)}function tr(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Q4={kernelName:ls,backendName:"cpu",kernelFunc:tr};function si(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var Z4={kernelName:Bf,backendName:"cpu",kernelFunc:si};function ai(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return tr({inputs:{x:o},backend:e});let s=Am(e,o.shape,o.dtype),a=ai({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Sn({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=si({inputs:{input:o},backend:e}),a=ai({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!w.hasEncodingLoss(o.dtype,i)){let s=tr({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32"){let s=e.data.get(o.dataId).values,a=Int32Array.from(s);return e.makeTensorInfo(o.shape,"int32",a)}if(i==="bool"){let s=e.data.get(o.dataId).values,a=w.toTypedArray([0],o.dtype),[l,c]=et((u,d)=>u!==d?1:0)(o.shape,[],s,a,"bool");return e.makeTensorInfo(c,"bool",l)}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var J4={kernelName:as,backendName:"cpu",kernelFunc:ai};function dt(t,n,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;Z([s,a],t);let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let c=ai({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,m=l.data.get(p.dataId).values,h=ai({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(h.dataId),x=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,S=l.data.get(x.dataId).values,_=l.data.get(b.dataId).values,[E,I,D]=e(s.shape,a.shape,f,m,S,_),O=l.makeTensorInfo(D,"float32",E),R=l.makeTensorInfo(D,"float32",I),$=Sn({inputs:{real:O,imag:R},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(O),l.disposeIntermediateTensorInfo(R),$}else{let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}}}function Rm(t){return(n,e,r,o,i,s)=>{let a=T.assertAndGetBroadcastShape(n,e),l=w.sizeFromShape(a),c=a.length,u=w.computeStrides(a),d=w.getTypedArrayFromDType("float32",l),p=w.getTypedArrayFromDType("float32",l),f=T.getBroadcastDims(n,a),m=T.getBroadcastDims(e,a),h=T.mergeRealAndImagArrays(r,o),g=T.mergeRealAndImagArrays(i,s),x=n.length,b=w.computeStrides(n),S=e.length,_=w.computeStrides(e);if(f.length+m.length===0)for(let E=0;E<d.length;E++){let I=E%h.length,D=E%g.length,O=t(h[I*2],h[I*2+1],g[D*2],g[D*2+1]);d[E]=O.real,p[E]=O.imag}else for(let E=0;E<d.length;E++){let I=w.indexToLoc(E,c,u),D=I.slice(-x);f.forEach(W=>D[W]=0);let O=w.locToIndex(D,x,b),R=I.slice(-S);m.forEach(W=>R[W]=0);let $=w.locToIndex(R,S,_),G=t(h[O*2],h[O*2+1],g[$*2],g[$*2+1]);d[E]=G.real,p[E]=G.imag}return[d,p,a]}}var $N=et((t,n)=>t+n),Bpe=Rm((t,n,e,r)=>({real:t+e,imag:n+r})),cl=dt(Ni,$N,Bpe),eU={kernelName:Ni,backendName:"cpu",kernelFunc:cl};function Om(t,n,e,r,o){let i=w.sizeFromShape(r),s=w.makeZerosTypedArray(o,e);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=n[a]:s[l]+=1)}return s}function qw(t,n,e,r=!1){let o=t.shape[0],i=t.shape[1],s=Ee([o,e],n.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?s.set(1,a,c):n.size>0?s.set(s.get(a,c)+n.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}function li(t){return(n,e,r)=>{let o=w.getTypedArrayFromDType(e,n.length);for(let i=0;i<n.length;++i)o[i]=t(n[i],r);return o}}function Oe(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(Z(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=w.sizeFromShape(s.shape),u=e||s.dtype,d=w.getArrayFromDType(u,c);for(let p=0;p<c;++p)d[p]=n(l[p],o);return a.makeTensorInfo(s.shape,u,d)}}function ci(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(Z(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=e||s.dtype,u=n(l,c,o);return a.makeTensorInfo(s.shape,c,u)}}var LN=li(t=>Math.ceil(t)),zpe=ci(aa,LN),tU={kernelName:aa,backendName:"cpu",kernelFunc:zpe};function Kw(t,n,e,r){let o=w.getArrayFromDType(e,w.sizeFromShape(n));if(r&&e!=="string"){let i=0;t.forEach(s=>{let a=w.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;t.forEach(s=>{let a=e==="string"?T.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let c=0;c<s.shape[0];++c){let u=c*n[1]+i;for(let d=0;d<s.shape[1];++d)o[u+d]=a[l++]}i+=s.shape[1]})}return o}var VN=li(t=>Math.exp(t)),BN=ci(ma,VN),nU={kernelName:ma,backendName:"cpu",kernelFunc:BN};var zN=li(t=>Math.expm1(t)),Upe=ci(ha,zN),rU={kernelName:ha,backendName:"cpu",kernelFunc:Upe};var UN=li(t=>Math.floor(t)),jpe=ci(ga,UN),oU={kernelName:ga,backendName:"cpu",kernelFunc:jpe};function Xw(t,n,e){let r=Ee(e,t.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],c=n.locToIndex([a,l]);s[2]=n.values[c];let u=t.locToIndex(s);r.values[o]=t.values[u]}return r}var jN=et((t,n)=>t>n?1:0),Gpe=dt(Yu,jN,null,"bool"),iU={kernelName:Yu,backendName:"cpu",kernelFunc:Gpe};var GN=et((t,n)=>t<n?1:0),Wpe=dt(Qu,GN,null,"bool"),sU={kernelName:Qu,backendName:"cpu",kernelFunc:Wpe};function Yw(t,n,e){let r=(n-t)/(e-1),o=w.makeZerosTypedArray(e,"float32");o[0]=t;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var WN=li(t=>Math.log(t)),Hpe=ci(Ca,WN),aU={kernelName:Ca,backendName:"cpu",kernelFunc:Hpe};function Qw(t,n,e,r){let o=w.getTypedArrayFromDType(r,w.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*n,a=t[s];for(let l=0;l<n;++l){let c=t[s+l];c>a&&(a=c)}o[i]=a}return o}var HN=et((t,n)=>Math.max(t,n)),qpe=dt(Sa,HN),lU={kernelName:Sa,backendName:"cpu",kernelFunc:qpe};var qN=et((t,n)=>Math.min(t,n)),Kpe=dt(Ea,qN),cU={kernelName:Ea,backendName:"cpu",kernelFunc:Kpe};var Sy=et((t,n)=>t*n),Xpe=Rm((t,n,e,r)=>({real:t*e-n*r,imag:t*r+n*e})),Bd=dt(Ta,Sy,Xpe),uU={kernelName:Ta,backendName:"cpu",kernelFunc:Bd};function KN(t,n,e){let r=w.createScalarValue(-1,e);return Sy([],n,r,t,e)}function Ype(t){let{inputs:n,backend:e}=t,{x:r}=n;Z(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=KN(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var dU={kernelName:mc,backendName:"cpu",kernelFunc:Ype};var XN=et((t,n)=>t!==n?1:0),Qpe=dt(nd,XN,null,"bool"),pU={kernelName:nd,backendName:"cpu",kernelFunc:Qpe};function Mm(t,n,e,r,o){let i=n.length,s=w.sizeFromShape(n),a=w.computeStrides(n),l=w.computeStrides(o),c=w.getTypedArrayFromDType(e,w.sizeFromShape(o));for(let u=0;u<s;++u){let d=w.indexToLoc(u,i,a),p=new Array(d.length);for(let m=0;m<p.length;m++)p[m]=d[r[m]];let f=w.locToIndex(p,i,l);c[f]=t[u]}return c}function fn(t){let{inputs:n,attrs:e,backend:r}=t,{x:o}=n,{perm:i}=e;Z(o,"transpose");let s=o.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=o.shape[i[d]];let l=r.data.get(o.dataId).values,c=Mm(l,o.shape,o.dtype,i,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var fU={kernelName:kc,backendName:"cpu",kernelFunc:fn};function YN(t,n,e,r){let[o,i]=T.computeOutAndReduceShapes(t,r),s=_n(n,"int32"),a=w.makeZerosTypedArray(w.sizeFromShape(o),s),l=w.sizeFromShape(i);for(let c=0;c<a.length;++c){let u=c*l,d=1;for(let p=0;p<l;++p)d*=e[u+p];a[c]=d}return{outVals:a,outShape:o,outDtype:s}}function Zpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"prod");let a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=T.getAxesPermutation(l,a),u=l,d=o,p=[];c!=null&&(d=fn({inputs:{x:o},backend:e,attrs:{perm:c}}),p.push(d),u=T.getInnerMostAxes(u.length,a));let f=e.data.get(d.dataId).values,{outVals:m,outShape:h,outDtype:g}=YN(d.shape,d.dtype,f,u),x=h;return s&&(x=T.expandShapeToKeepDim(h,l)),p.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(x,g,m)}var mU={kernelName:Lf,backendName:"cpu",kernelFunc:Zpe};function Zw(t,n,e,r){let o=t===n,i=t<n&&e<0,s=n<t&&e>1;if(o||i||s)return w.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((n-t)/e)),l=w.makeZerosTypedArray(a,r);n<t&&e===1&&(e=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+e;return l}var QN=li(t=>1/Math.sqrt(t)),Jpe=ci(Oa,QN),hU={kernelName:Oa,backendName:"cpu",kernelFunc:Jpe};function ZN(t,n,e,r,o){let i=Xn.isSliceContinous(r,n,e),s=w.sizeFromShape(e),a=w.computeStrides(r);if(i){let d=Xn.computeFlatOffset(n,a);return o==="string"?t.slice(d,d+s):t.subarray(d,d+s)}let l=o==="string"?T.fromUint8ToStringArray(t):t,c=Ee(r,o,l),u=Ee(e,o);for(let d=0;d<u.size;++d){let p=u.indexToLoc(d),f=p.map((m,h)=>m+n[h]);u.set(c.get(...f),...p)}return o==="string"?T.fromStringArrayToUint8(u.values):u.values}function ui(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r;Z(o,"slice");let[a,l]=Xn.parseSliceParams(o,i,s);Xn.assertParamsValid(o,a,l);let c=e.data.get(o.dataId).values,u=ZN(c,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,u)}var gU={kernelName:Ec,backendName:"cpu",kernelFunc:ui};function Jw(t,n,e,r,o,i,s){let a=n[0],l=i[0],c=new Array(l),u=new Array(a),d=n[1];if(l===0){if(a!==0)throw new Error(`Received SparseTensor with denseShape[0] = 0 but
         indices.shape[0] = ${a}`);let g=w.getArrayFromDType(e,0),x=w.getArrayFromDType(o,0);return[g,[0,d],x,c,u]}let p=!0,f=0,m=new Array(l).fill(0);for(let g=0;g<a;++g){let x=t[g*d];if(x<0)throw new Error(`indices(${g}, 0) is invalid: ${x} < 0`);if(x>=l)throw new Error(`indices(${g}, 0) is invalid: ${x} >= ${l}`);++m[x],p=p&&x>=f,f=x}let h=!0;for(let g=0;g<l;++g){let x=m[g]===0;c[g]=x,h=h&&!x,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(h&&p){let g=t,x=r;for(let b=0;b<a;++b)u[b]=b;return[g,[a,d],x,c,u]}else{let g=m[l-1],x=w.getArrayFromDType(e,g*d),b=w.getArrayFromDType(o,g),S=new Array(l).fill(0);for(let _=0;_<a;++_){let E=t[_*d],I=S[E],D=(E===0?0:m[E-1])+I;S[E]++;for(let O=0;O<d;++O)x[D*d+O]=t[_*d+O];b[D]=r[_],u[_]=D}for(let _=0;_<l;++_)if(S[_]===0){let I=_===0?0:m[_-1];x[I*d+0]=_;for(let D=1;D<d;++D)x[I*d+D]=0;b[I]=s}return[x,[a,d],b,c,u]}}function eC(t,n,e,r,o){let i=w.sizeFromShape(r),s=n[0],a=o.length,l=[],c=1,u=-1;for(let g=0;g<a;++g){let x=o[g];if(x===-1){if(u!==-1)throw new Error(`only one output dimension may be -1, not both ${u} and ${g}`);u=g,l.push(1)}else{if(x<0)throw new Error(`size ${g} must be non-negative, not ${x}`);c*=x,l.push(x)}}if(u!==-1){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");let g=Math.trunc(i/c);if(c*g!==i)throw new Error(`Input to reshape is a SparseTensor with ${i}
          dense values, but the requested shape requires a multiple of ${c}. inputShape=${r} outputShape= ${l}`);l[u]=g}let d=w.sizeFromShape(l);if(d!==i)throw new Error(`Input to reshape is a tensor with ${i} dense values, but the requested shape has ${d}. inputShape=${r} outputShape=${l}`);let p=r.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}let m=[];if(a>0){m[a-1]=1;for(let g=a-2;g>=0;--g)m[g]=m[g+1]*l[g+1]}let h=w.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let x=0;for(let b=0;b<p;++b)x+=t[g*p+b]*f[b];for(let b=0;b<a;++b)h[g*a+b]=Math.trunc(x/m[b]),x%=m[b]}return[h,[s,a],l]}var JN=et((t,n)=>{let e=t-n;return e*e}),efe=dt(za,JN),yU={kernelName:za,backendName:"cpu",kernelFunc:efe};function tC(t,n,e,r){let o=Ee(t,n.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(n.get(...a),...s)}return o}var ek=et((t,n)=>t-n),tfe=Rm((t,n,e,r)=>({real:t-e,imag:n-r})),Ey=dt(Ua,ek,tfe),xU={kernelName:Ua,backendName:"cpu",kernelFunc:Ey};function nC(t,n){let e=new Array(t.rank);for(let o=0;o<e.length;o++)e[o]=t.shape[o]*n[o];let r=Ee(e,t.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(t.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%t.shape[l];let a=t.locToIndex(s);r.values[o]=t.values[a]}return r}function rC(t,n,e,r,o){let i=n[n.length-1],[s,a]=[t.length/i,i],l=w.getTypedArrayFromDType(e,s*r),c=w.getTypedArrayFromDType("int32",s*r);for(let d=0;d<s;d++){let p=d*a,f=t.subarray(p,p+a),m=[];for(let b=0;b<f.length;b++)m.push({value:f[b],index:b});m.sort((b,S)=>S.value-b.value);let h=d*r,g=l.subarray(h,h+r),x=c.subarray(h,h+r);for(let b=0;b<r;b++)g[b]=m[b].value,x[b]=m[b].index}let u=n.slice();return u[u.length-1]=r,[Ee(u,e,l),Ee(u,"int32",c)]}function oC(t,n,e,r){let o=w.parseAxisParam(n,e)[0],i=[1,e[0],1];for(let m=0;m<o;m++)i[0]*=e[m];i[1]=e[o];for(let m=o+1;m<e.length;m++)i[2]*=e[m];let s={},a=new Int32Array(e[o]),l=new Dt(i,r,t),c=[],u=i[0]===1&&i[2]===1;for(let m=0;m<e[o];m++){let h;if(u)h=t[m].toString();else{let g=[];for(let x=0;x<i[0];x++)for(let b=0;b<i[2];b++)g.push(l.get(x,m,b));h=g.join(",")}if(s[h]!==void 0)a[m]=s[h];else{let g=Object.keys(s).length;s[h]=g,a[m]=g,c.push(m)}}let d=i.slice();d[1]=Object.keys(s).length;let p=new Dt(d,r);c.forEach((m,h)=>{for(let g=0;g<i[0];g++)for(let x=0;x<i[2];x++)p.set(l.get(g,m,x),g,h,x)});let f=e.slice();return f[o]=d[1],{outputValues:p.values,outputShape:f,indices:a}}Lb("cpu",()=>new K4,1);var nk=Oe(pa,t=>t>=0?t:Math.exp(t)-1),vU={kernelName:pa,backendName:"cpu",kernelFunc:nk};function rk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r;Z([o],"leakyRelu");let s=w.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=w.getTypedArrayFromDType("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",l)}var bU={kernelName:sc,backendName:"cpu",kernelFunc:rk};var nfe=et((t,n)=>t<0?n*t:t);function ok(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n;Z([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=nfe(r.shape,o.shape,i,s,r.dtype);return e.makeTensorInfo(l,r.dtype,a)}var wU={kernelName:vc,backendName:"cpu",kernelFunc:ok};var ik=Oe(ka,t=>Math.max(0,t)),CU={kernelName:ka,backendName:"cpu",kernelFunc:ik};var sk=Oe(Aa,t=>Math.min(Math.max(0,t),6)),_U={kernelName:Aa,backendName:"cpu",kernelFunc:sk};var ak=Oe(La,t=>1/(1+Math.exp(-t))),SU={kernelName:La,backendName:"cpu",kernelFunc:ak};function Fm(t,n,e,r,o){if(e==="linear")return tr({inputs:{x:n},backend:t});if(e==="relu")return ik({inputs:{x:n},backend:t});if(e==="elu")return nk({inputs:{x:n},backend:t});if(e==="relu6")return sk({inputs:{x:n},backend:t});if(e==="prelu")return ok({inputs:{x:n,alpha:r},backend:t});if(e==="leakyrelu")return rk({inputs:{x:n},backend:t,attrs:{alpha:o}});if(e==="sigmoid")return ak({inputs:{x:n},backend:t});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function tt(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=w.sizeFromShape(o.shape),a=w.inferFromImplicitShape(i,s),l=w.sizeFromShape(a);w.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var EU={kernelName:bc,backendName:"cpu",kernelFunc:tt};function lk(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;Z([o,i],"matMul");let l=o.shape.length,c=i.shape.length,u=s?o.shape[l-2]:o.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],p=s?o.shape[l-1]:o.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],m=o.shape.slice(0,-2),h=i.shape.slice(0,-2),g=w.sizeFromShape(m),x=w.sizeFromShape(h),b=g===x||g===1||x===1;w.assert(l>=2&&c>=2&&b,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${h}).`);let _=(g>x?o.shape.slice(0,-2):i.shape.slice(0,-2)).concat([p,f]);w.assert(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let E=s?[g,u,p]:[g,p,u],I=a?[x,f,d]:[x,d,f],D=tt({inputs:{x:o},backend:e,attrs:{shape:E}}),O=tt({inputs:{x:i},backend:e,attrs:{shape:I}}),R=s?D.shape[1]:D.shape[2],$=s?D.shape[2]:D.shape[1],G=a?O.shape[1]:O.shape[2],W=Math.max(g,x),q=e.data.get(D.dataId).values,X=e.data.get(O.dataId).values,K=w.computeStrides(D.shape),Y=w.computeStrides(O.shape),[re,J,ne]=s?[K[0],1,K[1]]:[K[0],K[1],1],[se,ue,fe]=a?[1,Y[1],Y[0]]:[Y[1],1,Y[0]],de=$*G,xe=Ee([W,$,G],D.dtype),ve=xe.values,be=e.blockSize;for(let Te=0;Te<W;Te++)for(let Pe=0;Pe<$;Pe+=be)for(let Ve=0;Ve<G;Ve+=be)for(let He=0;He<R;He+=be){let lt=Math.min(Pe+be,$),Pt=Math.min(Ve+be,G),dn=Math.min(He+be,R);for(let tn=Pe;tn<lt;tn++)for(let qt=Ve;qt<Pt;qt++){let Kt=0;for(let nn=He;nn<dn;nn++){let yn=Math.min(Te,g-1)*re,Cs=Math.min(Te,x-1)*fe,Gn=q[yn+tn*J+nn*ne],Gi=X[nn*se+qt*ue+Cs];Kt+=Gn*Gi}ve[Te*de+(tn*G+qt)]+=Kt}}return e.disposeIntermediateTensorInfo(D),e.disposeIntermediateTensorInfo(O),e.makeTensorInfo(_,xe.dtype,xe.values)}var IU={kernelName:ql,backendName:"cpu",kernelFunc:lk};function rfe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r,p,f,m,h=[];p=lk({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:e}),s&&(f=cl({inputs:{a:p,b:s},backend:e}),h.push(p),p=f),u&&(m=Fm(e,p,u,a,d),h.push(p),p=m);for(let x of h)e.disposeIntermediateTensorInfo(x);return p}var TU={kernelName:rd,backendName:"cpu",kernelFunc:rfe};var ofe=Oe(ea,t=>Math.acos(t)),DU={kernelName:ea,backendName:"cpu",kernelFunc:ofe};var ife=Oe(ta,t=>Math.acosh(t)),NU={kernelName:ta,backendName:"cpu",kernelFunc:ife};function sfe(t){let{inputs:n,backend:e}=t,r=n;Z(n,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=Ee(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var kU={kernelName:xf,backendName:"cpu",kernelFunc:sfe};function afe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"all");let a=w.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=fn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=w.sizeFromShape(p),m=w.makeZerosTypedArray(w.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,S=h[b];for(let _=0;_<f;++_){let E=h[b+_];S=S&&E}m[x]=S}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=tt({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var AU={kernelName:vf,backendName:"cpu",kernelFunc:afe};function lfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"any");let a=w.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=fn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=w.sizeFromShape(p),m=w.makeZerosTypedArray(w.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,S=h[b];for(let _=0;_<f;++_){let E=h[b+_];S=S||E}m[x]=S}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=tt({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var RU={kernelName:bf,backendName:"cpu",kernelFunc:lfe};function cfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Z(o,"argMax");let s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=fn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=w.sizeFromShape(u),f=w.makeZerosTypedArray(p,"int32"),m=w.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let x=g*m,b=h[x],S=0;for(let _=0;_<m;++_){let E=h[x+_];E>b&&(b=E,S=_)}f[g]=S}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var OU={kernelName:jl,backendName:"cpu",kernelFunc:cfe};function ufe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Z(o,"argMin");let s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=fn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=w.sizeFromShape(u),f=w.makeZerosTypedArray(p,"int32"),m=w.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let x=g*m,b=h[x],S=0;for(let _=0;_<m;++_){let E=h[x+_];E<b&&(b=E,S=_)}f[g]=S}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var MU={kernelName:Gl,backendName:"cpu",kernelFunc:ufe};var dfe=Oe(na,t=>Math.asin(t)),FU={kernelName:na,backendName:"cpu",kernelFunc:dfe};var pfe=Oe(ra,t=>Math.asinh(t)),PU={kernelName:ra,backendName:"cpu",kernelFunc:pfe};var ffe=Oe(oa,t=>Math.atan(t)),$U={kernelName:oa,backendName:"cpu",kernelFunc:ffe};var mfe=et((t,n)=>Math.atan2(t,n)),hfe=dt(sa,mfe),LU={kernelName:sa,backendName:"cpu",kernelFunc:hfe};var gfe=Oe(ia,t=>Math.atanh(t)),VU={kernelName:ia,backendName:"cpu",kernelFunc:gfe};function Pm(t,n,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=o.padInfo.top,f=o.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Ee(o.outShape,e),g=h.values,x=o.outShape[1]*o.outShape[2]*o.outShape[3],b=o.outShape[2]*o.outShape[3],S=o.outShape[3];for(let _=0;_<o.batchSize;++_){let E=_*x,I=_*r[0];for(let D=0;D<o.inChannels;++D)for(let O=0;O<o.outHeight;++O){let R=O*s-p,$=Math.max(0,R),G=Math.min(o.inHeight,u+R),W=E+O*b;for(let q=0;q<o.outWidth;++q){let X=q*a-f,K=Math.max(0,X),Y=Math.min(o.inWidth,d+X),re=m,J=0,ne=0;for(let ue=$;ue<G;ue+=l){let fe=I+ue*r[1];for(let de=K;de<Y;de+=c){let xe=fe+de*r[2],ve=t[xe+D];i==="max"&&ve>re?re=ve:i==="avg"&&(J+=ve,ne++)}if(isNaN(re))break}let se=W+q*S+D;g[se]=i==="avg"?J/ne:re}}}return h}function iC(t,n,e,r,o=!1,i=!1){let s=Ee(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left,h=Ee(n,e,t);for(let g=0;g<r.batchSize;++g)for(let x=0;x<r.inChannels;++x)for(let b=0;b<r.outHeight;++b){let S=b*a-f,_=S;for(;_<0;)_+=c;let E=Math.min(r.inHeight,d+S);for(let I=0;I<r.outWidth;++I){let D=I*l-m,O=D;for(;O<0;)O+=u;let R=Math.min(r.inWidth,p+D),$=Number.NEGATIVE_INFINITY,G=-1;for(let W=_;W<E;W+=c){let q=W-S;for(let X=O;X<R;X+=u){let K=X-D,Y=h.get(g,W,X,x);Y>$&&($=Y,o?G=i?((g*r.inHeight+W)*r.inWidth+X)*r.inChannels+x:(W*r.inWidth+X)*r.inChannels+x:G=q*p+K)}}s.set(G,g,b,I,x)}}return s}function sC(t,n,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,g=o.padInfo.top,x=o.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=Ee(o.outShape,e),_=S.values,E=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],I=o.outShape[2]*o.outShape[3]*o.outShape[4],D=o.outShape[3]*o.outShape[4],O=o.outShape[4];for(let R=0;R<o.batchSize;++R){let $=R*E,G=R*r[0];for(let W=0;W<o.inChannels;++W)for(let q=0;q<o.outDepth;++q){let X=q*s-h,K=X;for(;K<0;)K+=c;let Y=Math.min(o.inDepth,p+X),re=$+q*I;for(let J=0;J<o.outHeight;++J){let ne=J*a-g,se=ne;for(;se<0;)se+=u;let ue=Math.min(o.inHeight,f+ne),fe=re+J*D;for(let de=0;de<o.outWidth;++de){let xe=de*l-x,ve=xe;for(;ve<0;)ve+=d;let be=Math.min(o.inWidth,m+xe),Te=fe+de*O,Pe=b,Ve=0,He=0;for(let Pt=K;Pt<Y;Pt+=c){let dn=G+Pt*r[1];for(let tn=se;tn<ue;tn+=u){let qt=dn+tn*r[2];for(let Kt=ve;Kt<be;Kt+=d){let nn=qt+Kt*r[3],yn=t[nn+W];if(i==="max"&&yn>Pe?Pe=yn:i==="avg"&&(Ve+=yn,He++),isNaN(Pe))break}if(isNaN(Pe))break}if(isNaN(Pe))break}let lt=Te+W;_[lt]=i==="avg"?Ve/He:Pe}}}}return S}function BU(t,n){let e=Ee(n.outShape,"int32"),r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,u=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,f=n.padInfo.top,m=n.padInfo.left;for(let h=0;h<n.batchSize;++h)for(let g=0;g<n.inChannels;++g)for(let x=0;x<n.outDepth;++x){let b=x*r-p,S=b;for(;S<0;)S+=s;let _=Math.min(n.inDepth,c+b);for(let E=0;E<n.outHeight;++E){let I=E*o-f,D=I;for(;D<0;)D+=a;let O=Math.min(n.inHeight,u+I);for(let R=0;R<n.outWidth;++R){let $=R*i-m,G=$;for(;G<0;)G+=l;let W=Math.min(n.inWidth,d+$),q=Number.NEGATIVE_INFINITY,X=-1;for(let K=S;K<_;K+=s){let Y=K-b;for(let re=D;re<O;re+=a){let J=re-I;for(let ne=G;ne<W;ne+=l){let se=ne-$,ue=t.get(h,K,re,ne,g);ue>=q&&(q=ue,X=Y*u*d+J*u+se)}}}e.set(X,h,x,E,R,g)}}}return e}function yfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Z(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))d=tr({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=w.computeStrides(o.shape),m=Pm(p,o.shape,o.dtype,f,u,"avg");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var zU={kernelName:Wl,backendName:"cpu",kernelFunc:yfe};function xfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;Z(o,"avgPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=sC(d,o.shape,o.dtype,w.computeStrides(o.shape),u,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var UU={kernelName:Hl,backendName:"cpu",kernelFunc:xfe};function vfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;Z([o,i],"avgPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.filterDepth,h=u.filterHeight,g=u.filterWidth,x=u.dilationDepth,b=u.dilationHeight,S=u.dilationWidth,_=u.effectiveFilterDepth,E=u.effectiveFilterHeight,I=u.effectiveFilterWidth,D=_-1-u.padInfo.front,O=I-1-u.padInfo.left,R=E-1-u.padInfo.top,$=Ee(i.shape,"float32"),G=1/(m*h*g),W=e.bufferSync(o);for(let q=0;q<u.batchSize;++q)for(let X=0;X<u.inChannels;++X)for(let K=0;K<u.inDepth;++K)for(let Y=0;Y<u.inHeight;++Y)for(let re=0;re<u.inWidth;++re){let J=K-D,ne=Y-R,se=re-O,ue=0;for(let fe=0;fe<_;fe+=x){let de=(J+fe)/d;if(!(de<0||de>=u.outDepth||Math.floor(de)!==de))for(let xe=0;xe<E;xe+=b){let ve=(ne+xe)/p;if(!(ve<0||ve>=u.outHeight||Math.floor(ve)!==ve))for(let be=0;be<I;be+=S){let Te=(se+be)/f;if(Te<0||Te>=u.outWidth||Math.floor(Te)!==Te)continue;let Pe=W.get(q,de,ve,Te,X);ue+=Pe}}}$.set(ue*G,q,K,Y,re,X)}return e.makeTensorInfo($.shape,$.dtype,$.values)}var jU={kernelName:Cf,backendName:"cpu",kernelFunc:vfe};function bfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;Z([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=u.strideHeight,p=u.strideWidth,f=u.filterHeight,m=u.filterWidth,h=u.dilationHeight,g=u.dilationWidth,x=u.effectiveFilterHeight,b=u.effectiveFilterWidth,S=b-1-u.padInfo.left,_=x-1-u.padInfo.top,E=Ee(s.shape,"float32"),I=1/(f*m),D=e.data.get(o.dataId).values,O=Ee(o.shape,"float32",D);for(let R=0;R<u.batchSize;++R)for(let $=0;$<u.inChannels;++$)for(let G=0;G<u.inHeight;++G)for(let W=0;W<u.inWidth;++W){let q=G-_,X=W-S,K=0;for(let Y=0;Y<x;Y+=h){let re=(q+Y)/d;if(!(re<0||re>=u.outHeight||Math.floor(re)!==re))for(let J=0;J<b;J+=g){let ne=(X+J)/p;if(ne<0||ne>=u.outWidth||Math.floor(ne)!==ne)continue;let se=O.get(R,re,ne,$);K+=se}}E.set(K*I,R,G,W,$)}return e.makeTensorInfo(E.shape,E.dtype,E.values)}var GU={kernelName:wf,backendName:"cpu",kernelFunc:bfe};function wfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,scale:i,offset:s,mean:a,variance:l}=n;w.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Z([o,a,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,p=e.data.get(l.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),m=s?e.data.get(s.dataId).values:new Float32Array([0]),h=new Float32Array(u.length),g=m.length,x=f.length,b=p.length,S=d.length,_=0,E=0,I=0,D=0;for(let O=0;O<u.length;++O)h[O]=m[_++]+(u[O]-d[E++])*f[I++]/Math.sqrt(p[D++]+c),_>=g&&(_=0),E>=S&&(E=0),I>=x&&(I=0),D>=b&&(D=0);return e.makeTensorInfo(o.shape,o.dtype,h)}var WU={kernelName:oc,backendName:"cpu",kernelFunc:wfe};function Cfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;Z([o],"batchToSpaceND");let a=i.reduce((x,b)=>x*b),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=tt({inputs:{x:o},backend:e,attrs:{shape:l}}),m=fn({inputs:{x:f},backend:e,attrs:{perm:c}}),h=tt({inputs:{x:m},backend:e,attrs:{shape:u}}),g=ui({inputs:{x:h},backend:e,attrs:{begin:d,size:p}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var HU={kernelName:Kl,backendName:"cpu",kernelFunc:Cfe};function _fe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=Om(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var qU={kernelName:rb,backendName:"cpu",kernelFunc:_fe};var Sfe=Oe(la,(t,n)=>{let e=n;return t>e.clipValueMax?e.clipValueMax:t<e.clipValueMin?e.clipValueMin:t}),KU={kernelName:la,backendName:"cpu",kernelFunc:Sfe};var Efe=t=>{let{x:n}=t.inputs,e=t.backend,r=new Float32Array(w.sizeFromShape(n.shape)),o=e.data.get(n.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let c=0;c<a.length;c++){let u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return e.makeOutput(r,n.shape,"float32")},XU={kernelName:Xl,backendName:"cpu",kernelFunc:Efe};function vs(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var YU={kernelName:Mf,backendName:"cpu",kernelFunc:vs};function Yc(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=w.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(h=>h.shape),i);if(w.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(h=>w.sizeFromShape(h.shape)>0);if(a.length===1)return tr({inputs:{x:a[0]},backend:e});let l=a.map(h=>h.shape);if(T.assertParamsConsistent(l,i),a[0].dtype==="complex64"){let h=a.map(_=>si({inputs:{input:_},backend:e})),g=a.map(_=>vs({inputs:{input:_},backend:e})),x=Yc({inputs:h,backend:e,attrs:{axis:i}}),b=Yc({inputs:g,backend:e,attrs:{axis:i}}),S=Sn({inputs:{real:x,imag:b},backend:e});return h.forEach(_=>e.disposeIntermediateTensorInfo(_)),g.forEach(_=>e.disposeIntermediateTensorInfo(_)),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),S}let c=a.map(h=>{let x=[-1,w.sizeFromShape(h.shape.slice(i))];return tt({inputs:{x:h},backend:e,attrs:{shape:x}})}),u=c.map(h=>({vals:e.data.get(h.dataId).values,shape:h.shape}));s=T.computeOutShape(c.map(h=>h.shape),1);let d=c[0].shape[0]===1,p=Kw(u,s,n[0].dtype,d),f=T.computeOutShape(a.map(h=>h.shape),i),m=e.makeTensorInfo(f,n[0].dtype,p);return c.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var QU={kernelName:Yl,backendName:"cpu",kernelFunc:Yc};function ck(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;Z([o,i],"conv2d");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f=p.filterHeight,m=p.filterWidth,h=p.dilationHeight,g=p.dilationWidth,x=p.padInfo.left,b=p.padInfo.top,S=p.dataFormat==="channelsLast",_=new Dt(p.outShape,o.dtype),E=w.computeStrides(o.shape),I=w.computeStrides(i.shape),D=E[0],O=S?E[1]:E[2],R=S?E[2]:1,$=S?1:E[1],G=_.strides[0],W=S?_.strides[1]:_.strides[2],q=S?_.strides[2]:1,X=S?1:_.strides[1],K=e.data.get(o.dataId).values,Y=e.data.get(i.dataId).values,re=_.values;for(let J=0;J<p.batchSize;++J){let ne=J*D,se=J*G;for(let ue=0;ue<p.outHeight;++ue){let fe=se+ue*W,de=ue*p.strideHeight-b;for(let xe=0;xe<f;++xe){let ve=de+xe*h;if(ve<0||ve>=p.inHeight)continue;let be=xe*I[0],Te=ne+ve*O;for(let Pe=0;Pe<p.outWidth;++Pe){let Ve=fe+Pe*q,He=Pe*p.strideWidth-x;for(let lt=0;lt<m;++lt){let Pt=He+lt*g;if(Pt<0||Pt>=p.inWidth)continue;let dn=be+lt*I[1],tn=Te+Pt*R,qt=dn;for(let Kt=0;Kt<p.inChannels;++Kt){let nn=K[tn+Kt*$];for(let yn=0;yn<p.outChannels;++yn)re[Ve+yn*X]+=nn*Y[qt+yn];qt+=p.outChannels}}}}}}return e.makeTensorInfo(_.shape,_.dtype,re)}var ZU={kernelName:Ql,backendName:"cpu",kernelFunc:ck};function Ife(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;Z([o,i],"conv2dBackpropFilter");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),{strideHeight:f,strideWidth:m,filterHeight:h,filterWidth:g}=p,x=p.dataFormat==="channelsLast",b=new Dt(p.filterShape,"float32"),S=p.padInfo.left,_=p.padInfo.top,E=e.data.get(o.dataId).values,I=e.data.get(i.dataId).values,D=new Dt(o.shape,o.dtype,E),O=new Dt(i.shape,i.dtype,I);for(let R=0;R<h;++R){let $=Math.max(0,Math.ceil((_-R)/f)),G=Math.min(p.outHeight,(p.inHeight+_-R)/f);for(let W=0;W<g;++W){let q=Math.max(0,Math.ceil((S-W)/m)),X=Math.min(p.outWidth,(p.inWidth+S-W)/m);for(let K=0;K<p.inChannels;++K)for(let Y=0;Y<p.outChannels;++Y){let re=0;for(let J=0;J<p.batchSize;++J)for(let ne=$;ne<G;++ne){let se=R+ne*f-_;for(let ue=q;ue<X;++ue){let fe=W+ue*m-S;x?re+=D.get(J,se,fe,K)*O.get(J,ne,ue,Y):re+=D.get(J,K,se,fe)*O.get(J,Y,ne,ue)}}b.set(re,R,W,K,Y)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var JU={kernelName:Sf,backendName:"cpu",kernelFunc:Ife};function Tfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;Z([o,i],"conv2dBackpropInput");let d=w.computeStrides(i.shape),p=w.computeStrides(o.shape),f=T.convertConv2DDataFormat(c),m=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,f),h=new Dt(m.inShape,"float32"),g=h.values,x=e.data.get(o.dataId).values,b=e.data.get(i.dataId).values,[S,_,E]=d,{batchSize:I,filterHeight:D,filterWidth:O,inChannels:R,inHeight:$,inWidth:G,outChannels:W,outHeight:q,outWidth:X,strideHeight:K,strideWidth:Y}=m;f=m.dataFormat;let re=D-1-m.padInfo.top,J=O-1-m.padInfo.left,ne=f==="channelsLast",se=h.strides[0],ue=ne?h.strides[1]:h.strides[2],fe=ne?h.strides[2]:1,de=ne?1:h.strides[1],xe=p[0],ve=ne?p[1]:p[2],be=ne?p[2]:1,Te=ne?1:p[1];for(let Pe=0;Pe<I;++Pe)for(let Ve=0;Ve<R;++Ve)for(let He=0;He<$;++He){let lt=He-re,Pt=Math.max(0,Math.ceil(lt/K)),dn=Math.min(q,(D+lt)/K);for(let tn=0;tn<G;++tn){let qt=tn-J,Kt=Math.max(0,Math.ceil(qt/Y)),nn=Math.min(X,(O+qt)/Y),yn=0;for(let Gn=Pt;Gn<dn;++Gn){let Gi=Gn*K-lt;for(let io=Kt;io<nn;++io){let ou=io*Y-qt,fi=xe*Pe+ve*Gn+be*io,_s=S*(D-1-Gi)+_*(O-1-ou)+E*Ve;for(let ml=0;ml<W;++ml){let hl=x[fi+Te*ml],gl=b[_s+ml];yn+=hl*gl}}}let Cs=se*Pe+ue*He+fe*tn+de*Ve;g[Cs]=yn}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var ej={kernelName:Zl,backendName:"cpu",kernelFunc:Tfe};function Dfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r;Z([o,i],"conv3d");let c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:h,padInfo:g}=c,x=g.front,b=g.left,S=g.top,_=new Dt(c.outShape,o.dtype),E=e.data.get(o.dataId).values,I=e.data.get(i.dataId).values,D=_.values,O=w.computeStrides(o.shape),R=w.computeStrides(i.shape);for(let $=0;$<c.batchSize;++$){let G=$*O[0],W=$*_.strides[0];for(let q=0;q<c.outDepth;++q){let X=W+q*_.strides[1],K=q*c.strideDepth-x;for(let Y=0;Y<u;++Y){let re=K+Y*f;if(re<0||re>=c.inDepth)continue;let J=Y*R[0],ne=G+re*O[1];for(let se=0;se<c.outHeight;++se){let ue=X+se*_.strides[2],fe=se*c.strideHeight-S;for(let de=0;de<d;++de){let xe=fe+de*m;if(xe<0||xe>=c.inHeight)continue;let ve=J+de*R[1],be=ne+xe*O[2];for(let Te=0;Te<c.outWidth;++Te){let Pe=ue+Te*c.outChannels,Ve=Te*c.strideWidth-b;for(let He=0;He<p;++He){let lt=Ve+He*h;if(lt<0||lt>=c.inWidth)continue;let Pt=ve+He*R[2],dn=be+lt*c.inChannels,tn=Pt;for(let qt=0;qt<c.inChannels;++qt){let Kt=E[dn+qt];for(let nn=0;nn<c.outChannels;++nn)D[Pe+nn]+=Kt*I[tn+nn];tn+=c.outChannels}}}}}}}}return e.makeTensorInfo(_.shape,_.dtype,_.values)}var tj={kernelName:Jl,backendName:"cpu",kernelFunc:Dfe};function Nfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r;Z([o,i],"conv3dBackpropFilterV2");let c=w.computeStrides(o.shape),u=w.computeStrides(i.shape),d=T.computeConv3DInfo(o.shape,l,s,1,a),p=d.strideDepth,f=d.strideHeight,m=d.strideWidth,h=d.filterDepth,g=d.filterHeight,x=d.filterWidth,b=new Dt(d.filterShape,"float32"),S=b.values,[_,E,I,D]=b.strides,O=e.data.get(i.dataId).values,[R,$,G,W]=u,q=e.data.get(o.dataId).values,[X,K,Y,re]=c,J=d.padInfo.front,ne=d.padInfo.left,se=d.padInfo.top;for(let ue=0;ue<h;++ue){let fe=Math.max(0,Math.ceil((J-ue)/p)),de=Math.min(d.outDepth,(d.inDepth+J-ue)/p),xe=ue*_;for(let ve=0;ve<g;++ve){let be=Math.max(0,Math.ceil((se-ve)/f)),Te=Math.min(d.outHeight,(d.inHeight+se-ve)/f),Pe=ve*E+xe;for(let Ve=0;Ve<x;++Ve){let He=Math.max(0,Math.ceil((ne-Ve)/m)),lt=Math.min(d.outWidth,(d.inWidth+ne-Ve)/m),Pt=Ve*I+Pe;for(let dn=0;dn<d.inChannels;++dn){let tn=dn*D+Pt;for(let qt=0;qt<d.outChannels;++qt){let Kt=0;for(let nn=0;nn<d.batchSize;++nn){let yn=nn*X,Cs=nn*R;for(let Gn=fe;Gn<de;++Gn){let io=(ue+Gn*p-J)*K+yn,ou=Gn*$+Cs;for(let fi=be;fi<Te;++fi){let ml=(ve+fi*f-se)*Y+io,hl=fi*G+ou;for(let gl=He;gl<lt;++gl){let X_=(Ve+gl*m-ne)*re+ml,Y_=gl*W+hl;Kt+=q[X_+dn]*O[Y_+qt]}}}}S[tn+qt]=Kt}}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var nj={kernelName:Ef,backendName:"cpu",kernelFunc:Nfe};function kfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r;Z([o],"conv3dBackpropInputV2");let c=w.computeStrides(o.shape),u=w.computeStrides(i.shape),d=T.computeConv3DInfo(l,i.shape,a,1,s),p=new Dt(d.inShape,"float32"),f=p.values,[m,h,g,x]=p.strides,b=e.data.get(o.dataId).values,[S,_,E,I]=c,D=e.data.get(i.dataId).values,[O,R,$,G]=u,{batchSize:W,filterDepth:q,filterHeight:X,filterWidth:K,inChannels:Y,inDepth:re,inHeight:J,inWidth:ne,outChannels:se,outDepth:ue,outHeight:fe,outWidth:de,strideDepth:xe,strideHeight:ve,strideWidth:be}=d,Te=q-1-d.padInfo.front,Pe=X-1-d.padInfo.top,Ve=K-1-d.padInfo.left;for(let He=0;He<W;++He)for(let lt=0;lt<Y;++lt)for(let Pt=0;Pt<re;++Pt){let dn=Pt-Te,tn=Math.max(0,Math.ceil(dn/xe)),qt=Math.min(ue,(q+dn)/xe);for(let Kt=0;Kt<J;++Kt){let nn=Kt-Pe,yn=Math.max(0,Math.ceil(nn/ve)),Cs=Math.min(fe,(X+nn)/ve);for(let Gn=0;Gn<ne;++Gn){let Gi=Gn-Ve,io=Math.max(0,Math.ceil(Gi/be)),ou=Math.min(de,(K+Gi)/be),fi=0;for(let _s=tn;_s<qt;++_s){let ml=_s*xe-dn;for(let hl=yn;hl<Cs;++hl){let gl=hl*ve-nn;for(let Qm=io;Qm<ou;++Qm){let X_=Qm*be-Gi,Y_=S*He+_*_s+E*hl+I*Qm,p6=O*(q-1-ml)+R*(X-1-gl)+$*(K-1-X_)+G*lt;for(let jy=0;jy<se;++jy){let f6=b[Y_+jy],m6=D[p6+jy];fi+=f6*m6}}}}f[m*He+h*Pt+g*Kt+x*Gn+lt]=fi}}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var rj={kernelName:If,backendName:"cpu",kernelFunc:kfe};var Afe=Oe(ca,t=>Math.cos(t)),oj={kernelName:ca,backendName:"cpu",kernelFunc:Afe};var Rfe=Oe(ua,t=>Math.cosh(t)),ij={kernelName:ua,backendName:"cpu",kernelFunc:Rfe};function Ofe(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,p,f]=o.shape,m=i.shape[0],[h,g]=a,x=Ee([m,h,g,f],"float32"),b=e.data.get(i.dataId).values,S=e.data.get(s.dataId).values,_=e.data.get(o.dataId).values,E=w.computeStrides(o.shape),I=w.computeStrides(x.shape);for(let D=0;D<m;D++){let O=D*4,R=b[O],$=b[O+1],G=b[O+2],W=b[O+3],q=S[D];if(q>=u)continue;let X=h>1?(G-R)*(d-1)/(h-1):0,K=g>1?(W-$)*(p-1)/(g-1):0;for(let Y=0;Y<h;Y++){let re=h>1?R*(d-1)+Y*X:.5*(R+G)*(d-1);if(re<0||re>d-1){for(let J=0;J<g;J++)for(let ne=0;ne<f;ne++){let se=ne+J*I[2]+Y*I[1]+D*I[0];x.values[se]=c}continue}if(l==="bilinear"){let J=Math.floor(re),ne=Math.ceil(re),se=re-J;for(let ue=0;ue<g;ue++){let fe=g>1?$*(p-1)+ue*K:.5*($+W)*(p-1);if(fe<0||fe>p-1){for(let be=0;be<f;be++){let Te=be+ue*I[2]+Y*I[1]+D*I[0];x.values[Te]=c}continue}let de=Math.floor(fe),xe=Math.ceil(fe),ve=fe-de;for(let be=0;be<f;be++){let Te=be+de*E[2]+J*E[1]+q*E[0],Pe=_[Te];Te=be+xe*E[2]+J*E[1]+q*E[0];let Ve=_[Te];Te=be+de*E[2]+ne*E[1]+q*E[0];let He=_[Te];Te=be+xe*E[2]+ne*E[1]+q*E[0];let lt=_[Te],Pt=Pe+(Ve-Pe)*ve,dn=He+(lt-He)*ve;Te=be+ue*I[2]+Y*I[1]+D*I[0],x.values[Te]=Pt+(dn-Pt)*se}}}else for(let J=0;J<g;++J){let ne=g>1?$*(p-1)+J*K:.5*($+W)*(p-1);if(ne<0||ne>p-1){for(let fe=0;fe<f;fe++){let de=fe+J*I[2]+Y*I[1]+D*I[0];x.values[de]=c}continue}let se=Math.round(ne),ue=Math.round(re);for(let fe=0;fe<f;fe++){let de=fe+se*E[2]+ue*E[1]+q*E[0],xe=fe+J*I[2]+Y*I[1]+D*I[0];x.values[xe]=_[de]}}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var sj={kernelName:ob,backendName:"cpu",kernelFunc:Ofe};function Mfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;Z(o,"cumsum");let l=T.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=fn({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=T.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=_n(c.dtype,"int32"),p=w.makeZerosTypedArray(w.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],h=a?(x,b)=>x+m-b-1:(x,b)=>x+b;for(let x=0;x<f.length;x+=m)for(let b=0;b<m;b++){let S=h(x,b);if(b===0)p[S]=s?0:f[S];else{let _=h(x,b-1);p[S]=s?f[_]+p[_]:f[S]+p[_]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let x=T.getUndoAxesPermutation(l),b=fn({inputs:{x:g},backend:e,attrs:{perm:x}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),b}return g}var aj={kernelName:ec,backendName:"cpu",kernelFunc:Mfe};function Ffe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Om(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=qw(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var lj={kernelName:ib,backendName:"cpu",kernelFunc:Ffe};function Pfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;w.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`),w.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*i,p=c*i,f=u/(i*i),m=e.data.get(o.dataId).values,h=new Float32Array(a*d*p*f),g=0;for(let x=0;x<a;++x)for(let b=0;b<d;++b){let S=Math.floor(b/i),_=b%i;for(let E=0;E<p;++E){let I=Math.floor(E/i),D=E%i,O=(_*i+D)*f;for(let R=0;R<f;++R){let G=R+O+u*(I+c*(S+l*x));h[g++]=m[G]}}}return e.makeTensorInfo([a,d,p,f],o.dtype,h)}var cj={kernelName:Tf,backendName:"cpu",kernelFunc:Pfe};function uk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r;Z([o,i],"depthwiseConv2DNative");let u=w.computeStrides(o.shape),d=w.computeStrides(i.shape),p=l;p==null&&(p=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(s,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`);let f=T.computeConv2DInfo(o.shape,i.shape,s,p,a,c,!0),{filterHeight:m,filterWidth:h,dilationHeight:g,dilationWidth:x,padInfo:b}=f,S=b.left,_=b.top,E=f.outChannels/f.inChannels,I=new Dt(f.outShape,o.dtype),D=e.data.get(o.dataId).values,O=e.data.get(i.dataId).values,R=I.values;for(let $=0;$<f.batchSize;++$){let G=$*u[0],W=$*I.strides[0];for(let q=0;q<f.outHeight;++q){let X=W+q*I.strides[1],K=q*f.strideHeight-_;for(let Y=0;Y<m;++Y){let re=K+Y*g;if(re<0||re>=f.inHeight)continue;let J=Y*d[0],ne=G+re*u[1];for(let se=0;se<f.outWidth;++se){let ue=X+se*I.strides[2],fe=se*f.strideWidth-S;for(let de=0;de<h;++de){let xe=fe+de*x;if(xe<0||xe>=f.inWidth)continue;let ve=J+de*d[1],be=ne+xe*f.inChannels,Te=ue,Pe=ve;for(let Ve=0;Ve<f.inChannels;++Ve){let He=D[be+Ve];for(let lt=0;lt<E;++lt)R[Te+lt]+=He*O[Pe+lt];Te+=E,Pe+=E}}}}}}return e.makeTensorInfo(I.shape,I.dtype,I.values)}var uj={kernelName:tc,backendName:"cpu",kernelFunc:uk};function $fe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;Z([o,i],"depthwiseConv2dNativeBackpropFilter");let d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:h}=d,g=new Dt(d.filterShape,"float32"),x=d.padInfo.left,b=d.padInfo.top,S=d.outChannels/d.inChannels,_=e.data.get(o.dataId).values,E=new Dt(o.shape,o.dtype,_),I=e.data.get(i.dataId).values,D=new Dt(i.shape,i.dtype,I);for(let O=0;O<m;++O){let R=Math.max(0,Math.ceil((b-O)/p)),$=Math.min(d.outHeight,(d.inHeight+b-O)/p);for(let G=0;G<h;++G){let W=Math.max(0,Math.ceil((x-G)/f)),q=Math.min(d.outWidth,(d.inWidth+x-G)/f);for(let X=0;X<d.outChannels;++X){let K=Math.trunc(X/S),Y=X%S,re=0;for(let J=0;J<d.batchSize;++J)for(let ne=R;ne<$;++ne){let se=O+ne*p-b;for(let ue=W;ue<q;++ue){let fe=G+ue*f-x;re+=E.get(J,se,fe,K)*D.get(J,ne,ue,X)}}g.set(re,O,G,K,Y)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var dj={kernelName:Df,backendName:"cpu",kernelFunc:$fe};function Lfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;Z([o,i],"depthwiseConv2DNativeBackpropInput");let d=w.computeStrides(o.shape),p=w.computeStrides(i.shape),f=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),m=new Dt(f.inShape,"float32"),h=m.values,[g,x,b]=m.strides,S=e.data.get(o.dataId).values,[_,E,I]=d,D=e.data.get(i.dataId).values,[O,R,$]=p,{batchSize:G,filterHeight:W,filterWidth:q,inChannels:X,inHeight:K,inWidth:Y,outChannels:re,outHeight:J,outWidth:ne,strideHeight:se,strideWidth:ue}=f,fe=W-1-f.padInfo.top,de=q-1-f.padInfo.left,xe=re/X;for(let ve=0;ve<G;++ve)for(let be=0;be<X;++be)for(let Te=0;Te<K;++Te){let Pe=Te-fe,Ve=Math.max(0,Math.ceil(Pe/se)),He=Math.min(J,(W+Pe)/se);for(let lt=0;lt<Y;++lt){let Pt=lt-de,dn=Math.max(0,Math.ceil(Pt/ue)),tn=Math.min(ne,(q+Pt)/ue),qt=0;for(let Kt=Ve;Kt<He;++Kt){let nn=Kt*se-Pe;for(let yn=dn;yn<tn;++yn){let Cs=yn*ue-Pt,Gn=_*ve+E*Kt+I*yn,Gi=O*(W-1-nn)+R*(q-1-Cs)+$*be;for(let io=0;io<xe;++io){let ou=be*xe+io,fi=S[Gn+ou],_s=D[Gi+io];qt+=fi*_s}}}h[g*ve+x*Te+b*lt+be]=qt}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var pj={kernelName:Nf,backendName:"cpu",kernelFunc:Lfe};function Vfe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=w.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=Ee([o,o],r.dtype),a=s.values;for(let c=0;c<i.length;c++)a[c*o+c]=i[c];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var fj={kernelName:sb,backendName:"cpu",kernelFunc:Vfe};var mj={kernelName:nc,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o}=t,{strides:i,pad:s,dilations:a}=e,l=n,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:f,inHeight:m,inWidth:h,inChannels:g,outHeight:x,outWidth:b,padInfo:S,strideHeight:_,strideWidth:E,filterHeight:I,filterWidth:D,dilationHeight:O,dilationWidth:R,outShape:$}=T.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),G=w.sizeFromShape($),W=$.length,q=w.getArrayFromDType(r.dtype,G);for(let K=0;K<f;++K)for(let Y=0;Y<x;++Y){let re=Y*_-S.top;for(let J=0;J<b;++J){let ne=J*E-S.left;for(let se=0;se<g;++se){let ue=Number.MIN_SAFE_INTEGER;for(let de=0;de<I;++de){let xe=re+de*O;if(xe>=0&&xe<m)for(let ve=0;ve<D;++ve){let be=ne+ve*R;if(be>=0&&be<h){let Te=w.locToIndex([K,xe,be,se],u,w.computeStrides(r.shape)),Pe=w.locToIndex([de,ve,se],p,w.computeStrides(o.shape)),Ve=c[Te]+d[Pe];Ve>ue&&(ue=Ve)}}}let fe=w.locToIndex([K,Y,J,se],W,w.computeStrides($));q[fe]=ue}}}return{dataId:l.write(w.toTypedArray(q,r.dtype),$,r.dtype),shape:$,dtype:r.dtype}}};var hj={kernelName:Pg,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=w.toNestedArray(r.shape,c.data.get(r.dataId).values),d=w.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:b,strideHeight:S,strideWidth:_,filterHeight:E,filterWidth:I,dilationHeight:D,dilationWidth:O,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);w.assert(i.rank===R.length,()=>`Error in ${Pg}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let $=w.toNestedArray(R,c.data.get(i.dataId).values),G=w.makeZerosNestedTypedArray(o.shape,o.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*S-b.top;for(let Y=0;Y<x;++Y){let re=Y*_-b.left;for(let J=0;J<h;++J){let ne=Number.MIN_SAFE_INTEGER,se=0,ue=0;for(let fe=0;fe<E;++fe){let de=K+fe*D;if(de>=0&&de<f)for(let xe=0;xe<I;++xe){let ve=re+xe*O;if(ve>=0&&ve<m){let be=u[q][de][ve][J]+d[fe][xe][J];be>ne&&(ne=be,se=fe,ue=xe)}}}G[se][ue][J]+=$[q][X][Y][J]}}}return{dataId:c.write(w.toTypedArray(G,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var gj={kernelName:Fg,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=w.toNestedArray(r.shape,c.data.get(r.dataId).values),d=w.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:b,strideHeight:S,strideWidth:_,filterHeight:E,filterWidth:I,dilationHeight:D,dilationWidth:O,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);w.assert(i.rank===R.length,()=>`Error in ${Fg}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let $=w.toNestedArray(R,c.data.get(i.dataId).values),G=w.makeZerosNestedTypedArray(r.shape,r.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*S-b.top;for(let Y=0;Y<x;++Y){let re=Y*_-b.left;for(let J=0;J<h;++J){let ne=Number.MIN_SAFE_INTEGER,se=K<0?0:K,ue=re<0?0:re;for(let fe=0;fe<E;++fe){let de=K+fe*D;if(de>=0&&de<f)for(let xe=0;xe<I;++xe){let ve=re+xe*O;if(ve>=0&&ve<m){let be=u[q][de][ve][J]+d[fe][xe][J];be>ne&&(ne=be,se=de,ue=ve)}}}G[q][se][ue][J]+=$[q][X][Y][J]}}}return{dataId:c.write(w.toTypedArray(G,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function ul(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"sum");let a;o.dtype==="bool"?a=ai({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=tr({inputs:{x:o},backend:e});let l=a.shape.length,c=w.parseAxisParam(i,a.shape),u=T.getAxesPermutation(c,l),d=c,p=a;u!=null&&(p=fn({inputs:{x:a},backend:e,attrs:{perm:u}}),d=T.getInnerMostAxes(d.length,l)),T.assertAxesAreInnerMostDims("sum",d,p.shape.length);let[f,m]=T.computeOutAndReduceShapes(p.shape,d),h=T.upcastType(p.dtype,"int32"),g=Am(e,f,h),x=w.sizeFromShape(m),b=e.data.get(g.dataId).values,S=e.data.get(p.dataId).values;for(let _=0;_<b.length;++_){let E=_*x,I=0;for(let D=0;D<x;++D)I+=S[E+D];b[_]=I}if(s){let _=T.expandShapeToKeepDim(g.shape,c),E=g;g=tt({inputs:{x:g},backend:e,attrs:{shape:_}}),e.disposeIntermediateTensorInfo(E)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(p),g}var yj={kernelName:Ic,backendName:"cpu",kernelFunc:ul};function Bfe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:x,expandDims:b}=T.getEinsumPermutation(f,l[g]),S;T.isIdentityPermutation(x)?S=i[g]:(S=fn({inputs:{x:i[g]},backend:e,attrs:{perm:x}}),m.push(S));let _=S.shape.slice();for(let E=0;E<b.length;++E)_.splice(b[E],0,1);w.arraysEqual(S.shape,_)||(S=tt({inputs:{x:S},backend:e,attrs:{shape:_}}),m.push(S)),p===null?p=S:(p=Bd({inputs:{a:S,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=ul({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var xj={kernelName:ab,backendName:"cpu",kernelFunc:Bfe};function zfe(t){let{inputs:n,backend:e}=t,{dy:r,y:o}=n;Z([r,o],"eluGrad");let i=new Float32Array(w.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let c=s[l];c>=1?i[l]=a[l]:i[l]=a[l]*(c+1)}return e.makeTensorInfo(o.shape,"float32",i)}var vj={kernelName:kf,backendName:"cpu",kernelFunc:zfe};var Ufe=et((t,n)=>t===n?1:0),dk=dt(Xu,Ufe,null,"bool"),bj={kernelName:Xu,backendName:"cpu",kernelFunc:dk};var jfe=T.ERF_P,Gfe=T.ERF_A1,Wfe=T.ERF_A2,Hfe=T.ERF_A3,qfe=T.ERF_A4,Kfe=T.ERF_A5,Xfe=Oe(fa,t=>{let n=Math.sign(t),e=Math.abs(t),r=1/(1+jfe*e);return n*(1-((((Kfe*r+qfe)*r+Hfe)*r+Wfe)*r+Gfe)*r*Math.exp(-e*e))}),wj={kernelName:fa,backendName:"cpu",kernelFunc:Xfe};function $m(t){let{inputs:n,backend:e,attrs:r}=t,{input:o}=n,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(w.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),tt({inputs:{x:o},backend:e,attrs:{shape:a}})}var Cj={kernelName:rc,backendName:"cpu",kernelFunc:$m};var Yfe=et((t,n)=>t/n),Iy=dt(da,Yfe),Ty={kernelName:da,backendName:"cpu",kernelFunc:Iy};function aC(t,n,e){let r=t.shape,o=r[0],i=r[1],s=e.data.get(t.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[o,i],u=w.sizeFromShape(c),d=w.getTypedArrayFromDType("float32",u),p=w.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let x=ui({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),b=ui({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),S=Sn({inputs:{real:x,imag:b},backend:e}),{real:_,imag:E}=Qfe(S,n,e),I=T.mergeRealAndImagArrays(_,E);for(let D=0;D<i;D++){let O=T.getComplexWithIndex(I,D);d[g*i+D]=O.real,p[g*i+D]=O.imag}e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(S)}let f=e.makeTensorInfo(c,"float32",d),m=e.makeTensorInfo(c,"float32",p),h=Sn({inputs:{real:f,imag:m},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),h}function Qfe(t,n,e){let r=w.sizeFromShape(t.shape),o=e.data.get(t.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(Zfe(r)){let a=pk(i,s,r,n,e),l=[t.shape[0],t.shape[1]];if(n){let c=e.makeTensorInfo(l,"float32",a.real),u=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",w.createScalarValue(r,"float32")),p=tr({inputs:{x:d},backend:e}),f=Ty.kernelFunc({inputs:{a:c,b:d},backend:e}),m=Ty.kernelFunc({inputs:{a:u,b:p},backend:e}),h=e.data.get(f.dataId).values,g=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),{real:h,imag:g}}return a}else{let a=T.mergeRealAndImagArrays(i,s),l=Jfe(a,r,n);return T.splitRealAndImagArrays(l)}}function Zfe(t){return(t&t-1)===0}function pk(t,n,e,r,o){if(e===1)return{real:t,imag:n};let i=T.mergeRealAndImagArrays(t,n),s=e/2,a=T.complexWithEvenIndex(i),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),p=o.makeTensorInfo(u,"float32",c),f=Sn({inputs:{real:d,imag:p},backend:o}),m=T.complexWithOddIndex(i),h=m.real,g=m.imag,x=[h.length],b=o.makeTensorInfo(x,"float32",h),S=o.makeTensorInfo(x,"float32",g),_=Sn({inputs:{real:b,imag:S},backend:o}),E=pk(l,c,s,r,o),I=E.real,D=E.imag,O=[I.length],R=o.makeTensorInfo(O,"float32",I),$=o.makeTensorInfo(O,"float32",D),G=Sn({inputs:{real:R,imag:$},backend:o}),W=pk(h,g,s,r,o),q=W.real,X=W.imag,K=[q.length],Y=o.makeTensorInfo(K,"float32",q),re=o.makeTensorInfo(K,"float32",X),J=Sn({inputs:{real:Y,imag:re},backend:o}),ne=T.exponents(e,r),se=[ne.real.length],ue=o.makeTensorInfo(se,"float32",ne.real),fe=o.makeTensorInfo(se,"float32",ne.imag),de=Sn({inputs:{real:ue,imag:fe},backend:o}),xe=Bd({inputs:{a:de,b:J},backend:o}),ve=cl({inputs:{a:G,b:xe},backend:o}),be=Ey({inputs:{a:G,b:xe},backend:o}),Te=si({inputs:{input:ve},backend:o}),Pe=si({inputs:{input:be},backend:o}),Ve=vs({inputs:{input:ve},backend:o}),He=vs({inputs:{input:be},backend:o}),lt=Yc({inputs:[Te,Pe],backend:o,attrs:{axis:0}}),Pt=Yc({inputs:[Ve,He],backend:o,attrs:{axis:0}}),dn=o.data.get(lt.dataId).values,tn=o.data.get(Pt.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(S),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(R),o.disposeIntermediateTensorInfo($),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(re),o.disposeIntermediateTensorInfo(J),o.disposeIntermediateTensorInfo(ue),o.disposeIntermediateTensorInfo(fe),o.disposeIntermediateTensorInfo(de),o.disposeIntermediateTensorInfo(xe),o.disposeIntermediateTensorInfo(ve),o.disposeIntermediateTensorInfo(be),o.disposeIntermediateTensorInfo(Te),o.disposeIntermediateTensorInfo(Ve),o.disposeIntermediateTensorInfo(Pe),o.disposeIntermediateTensorInfo(He),o.disposeIntermediateTensorInfo(lt),o.disposeIntermediateTensorInfo(Pt),{real:dn,imag:tn}}function Jfe(t,n,e){let r=new Float32Array(n*2);for(let o=0;o<n;o++){let i=0,s=0;for(let a=0;a<n;a++){let l=T.exponent(o*a,n,e),c=T.getComplexWithIndex(t,a);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}e&&(i/=n,s/=n),T.assignToTypedArray(r,i,s,o)}return r}function eme(t){let{inputs:n,backend:e}=t,{input:r}=n,o=w.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=tt({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=aC(a,!1,e),c=tt({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var _j={kernelName:Af,backendName:"cpu",kernelFunc:eme};function Dy(t){let{backend:n,attrs:e}=t,{shape:r,value:o,dtype:i}=e,s=i||w.inferDtype(o),a=w.getArrayFromDType(s,w.sizeFromShape(r));return tme(a,o,s),n.makeTensorInfo(r,s,a)}var Sj={kernelName:Rf,backendName:"cpu",kernelFunc:Dy};function tme(t,n,e){t.fill(n)}var Ej={kernelName:lb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,o=e,i=w.getTypedArrayFromDType(r.dtype,w.sizeFromShape(r.shape)),[s,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let p=0;p<s;p++){let f=p*l*a*c;for(let m=0;m<a;m++){let h=m*(l*c);for(let g=0;g<l;g++){let x=g*c;for(let b=0;b<c;b++){let _=[s,m,g,b][2],E=Math.round(l-_),I=f+h+x+b,D=u[I];if(E>=0&&E<l){let O=E*c,R=f+h+O+b;D=u[R]}i[I]=D}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var nme=et((t,n)=>Math.floor(t/n)),rme=dt(ya,nme,null,"int32"),Ij={kernelName:ya,backendName:"cpu",kernelFunc:rme};function ome(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=ck({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=cl({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=Fm(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var Tj={kernelName:od,backendName:"cpu",kernelFunc:ome};function ime(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=uk({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=cl({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=Fm(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var Dj={kernelName:id,backendName:"cpu",kernelFunc:ime};function sme(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=w.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,c,u,d]=T.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(l,r.dtype,[]);let p=Ee([c,u],r.dtype),f=e.data.get(o.dataId).values,m=e.data.get(r.dataId).values;for(let h=0;h<c;h++){let g=[],x=0;for(let b=0;b<a;b++){let S=f[h*a+b];x+=S*d[b],g.push(S)}if(x<0||x>=i/u)throw new Error(`Invalid indices: ${g} does not index into ${r.shape}`);for(let b=0;b<u;b++)p.values[h*u+b]=m[x*u+b]}return e.makeTensorInfo(l,p.dtype,p.values)}var Nj={kernelName:cb,backendName:"cpu",kernelFunc:sme};function ame(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r;Z([o,i],"gatherV2");let l=a;a==null&&(l=0);let c=w.sizeFromShape(i.shape),u=w.parseAxisParam(s,o.shape)[0],d=T.segment_util.collectGatherOpShapeInfo(o,i,u,l),p=tt({inputs:{x:o},backend:e,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=tt({inputs:{x:i},backend:e,attrs:{shape:[d.batchSize,c/d.batchSize]}}),m=[d.batchSize,d.outerSize,c/d.batchSize,d.sliceSize],h=e.bufferSync(f),g=e.bufferSync(p),x=Xw(g,h,m);return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.makeTensorInfo(d.outputShape,x.dtype,x.values)}var kj={kernelName:ic,backendName:"cpu",kernelFunc:ame};var lme=et((t,n)=>t>=n?1:0),cme=dt(xa,lme,null,"bool"),Aj={kernelName:xa,backendName:"cpu",kernelFunc:cme};function ume(t){let{inputs:n,backend:e}=t,{input:r}=n,o=w.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=tt({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=aC(a,!0,e),c=tt({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var Rj={kernelName:Of,backendName:"cpu",kernelFunc:ume};var dme=Oe(va,t=>Number.isFinite(t)?1:0,"bool"),Oj={kernelName:va,backendName:"cpu",kernelFunc:dme};var pme=Oe(ba,t=>Math.abs(t)===1/0?1:0,"bool"),Mj={kernelName:ba,backendName:"cpu",kernelFunc:pme};var fme=Oe(wa,t=>Number.isNaN(t)?1:0,"bool"),Fj={kernelName:wa,backendName:"cpu",kernelFunc:fme};var mme=et((t,n)=>t<=n?1:0),hme=dt(Zu,mme,null,"bool"),Pj={kernelName:Zu,backendName:"cpu",kernelFunc:hme};function gme(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=Yw(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var $j={kernelName:ub,backendName:"cpu",kernelFunc:gme};var yme=Oe(_a,t=>Math.log1p(t)),Lj={kernelName:_a,backendName:"cpu",kernelFunc:yme};var xme=et((t,n)=>t&&n),vme=dt(Ju,xme,null,"bool"),Vj={kernelName:Ju,backendName:"cpu",kernelFunc:vme};var bme=Oe(ed,t=>t?0:1,"bool"),Bj={kernelName:ed,backendName:"cpu",kernelFunc:bme};var wme=et((t,n)=>t||n),Cme=dt(td,wme,null,"bool"),zj={kernelName:td,backendName:"cpu",kernelFunc:Cme};function _me(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r;Z(o,"LRN");let c=o.shape[3],u=c-1,d=e.data.get(o.dataId).values,p=w.sizeFromShape(o.shape),f=new Float32Array(p);function m(h){let g=h%c,x=h-g+Math.max(0,g-i),b=h-g+Math.min(g+i,u),S=0;for(;x<=b;x++){let _=d[x];S+=_*_}return S}for(let h=0;h<p;h++){let g=m(h),x=d[h]*Math.pow(s+a*g,-l);f[h]=x}return e.makeTensorInfo(o.shape,o.dtype,f)}var Uj={kernelName:ac,backendName:"cpu",kernelFunc:_me};function Sme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r;Z(s,"LRNGrad");let d=w.sizeFromShape(s.shape),p=s.shape[3],f=e.data.get(s.dataId).values,m=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values,g=new Float32Array(d),x=d;for(let b=0;b<x;b++){let S=b%p,_=b-S+Math.max(0,S-a),E=b-S+Math.min(p,S+a+1),I=0;for(let D=_;D<E;D++)I+=Math.pow(m[D],2);I=c*I+l;for(let D=_;D<E;D++){let O=-2*c*u*m[D]*h[b]/I;b===D&&(O+=Math.pow(I,-u)),O*=f[b],g[D]+=O}}return e.makeTensorInfo(s.shape,o.dtype,g)}var jj={kernelName:Ff,backendName:"cpu",kernelFunc:Sme};function fk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,c=l.length,u=w.parseAxisParam(i,l),d=u,p=T.getAxesPermutation(d,c),f=a.data.get(o.dataId).values;if(p!=null){let _=new Array(c);for(let E=0;E<_.length;E++)_[E]=l[p[E]];f=Mm(f,l,o.dtype,p,_),d=T.getInnerMostAxes(d.length,c),l=_}Z(o,"max"),T.assertAxesAreInnerMostDims("max",d,c);let[m,h]=T.computeOutAndReduceShapes(l,d),g=w.sizeFromShape(h),x=Qw(f,g,m,o.dtype),b=a.write(x,m,o.dtype),S=m;return s&&(S=T.expandShapeToKeepDim(m,u)),{dataId:b,shape:S,dtype:o.dtype}}var Gj={kernelName:lc,backendName:"cpu",kernelFunc:fk};function Eme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Z(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))d=tr({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=w.computeStrides(o.shape),m=Pm(p,o.shape,o.dtype,f,u,"max");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var Wj={kernelName:cc,backendName:"cpu",kernelFunc:Eme};function Ime(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;Z(o,"maxPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=sC(d,o.shape,o.dtype,w.computeStrides(o.shape),u,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var Hj={kernelName:uc,backendName:"cpu",kernelFunc:Ime};function Tme(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;Z([o,i],"maxPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=e.bufferSync(i),p=BU(d,u),f=u.strideDepth,m=u.strideHeight,h=u.strideWidth,g=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,S=u.effectiveFilterDepth,_=u.effectiveFilterHeight,E=u.effectiveFilterWidth,I=S-1-u.padInfo.front,D=E-1-u.padInfo.left,O=_-1-u.padInfo.top,R=Ee(i.shape,"float32"),$=e.bufferSync(o);for(let G=0;G<u.batchSize;++G)for(let W=0;W<u.inChannels;++W)for(let q=0;q<u.inDepth;++q)for(let X=0;X<u.inHeight;++X)for(let K=0;K<u.inWidth;++K){let Y=q-I,re=X-O,J=K-D,ne=0;for(let se=0;se<S;se+=g){let ue=(Y+se)/f;if(!(ue<0||ue>=u.outDepth||Math.floor(ue)!==ue))for(let fe=0;fe<_;fe+=x){let de=(re+fe)/m;if(!(de<0||de>=u.outHeight||Math.floor(de)!==de))for(let xe=0;xe<E;xe+=b){let ve=(J+xe)/h;if(ve<0||ve>=u.outWidth||Math.floor(ve)!==ve)continue;let be=S*_*E-1-p.get(G,ue,de,ve,W),Te=se*_*E+fe*E+xe,Pe=be===Te?1:0;if(Pe===0)continue;let Ve=$.get(G,ue,de,ve,W);ne+=Ve*Pe}}}R.set(ne,G,q,X,K,W)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}var qj={kernelName:$f,backendName:"cpu",kernelFunc:Tme};function Dme(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;Z([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=e.data.get(a.dataId).values,m=Ee(p.outShape,a.dtype,iC(f,a.shape,a.dtype,p).values),h=p.strideHeight,g=p.strideWidth,x=p.dilationHeight,b=p.dilationWidth,S=p.effectiveFilterHeight,_=p.effectiveFilterWidth,E=_-1-p.padInfo.left,I=S-1-p.padInfo.top,D=Ee(a.shape,"float32"),O=e.data.get(o.dataId).values,R=Ee(o.shape,"float32",O);for(let $=0;$<p.batchSize;++$)for(let G=0;G<p.inChannels;++G)for(let W=0;W<p.inHeight;++W)for(let q=0;q<p.inWidth;++q){let X=W-I,K=q-E,Y=0;for(let re=0;re<S;re+=x){let J=(X+re)/h;if(!(J<0||J>=p.outHeight||Math.floor(J)!==J))for(let ne=0;ne<_;ne+=b){let se=(K+ne)/g;if(se<0||se>=p.outWidth||Math.floor(se)!==se)continue;let ue=S*_-1-m.get($,J,se,G),fe=re*_+ne,de=ue===fe?1:0;if(de===0)continue;let xe=R.get($,J,se,G);Y+=xe*de}}D.set(Y,$,W,q,G)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}var Kj={kernelName:Pf,backendName:"cpu",kernelFunc:Dme};function Xj(t,n,e,r,o){let i=w.computeStrides(n),s=Pm(t,n,e,i,o,"max"),a=iC(t,n,e,o,!0,r);return[s.values,a.values]}var Yj={kernelName:db,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;Z(r,"MaxPoolWithArgmax");let c=l.data.get(r.dataId).values,u=T.computePool2DInfo(r.shape,o,i,[1,1],s),[d,p]=Xj(c,r.shape,r.dtype,a,u),f=l.write(d,u.outShape,r.dtype),m=l.write(p,u.outShape,r.dtype);return[{dataId:f,shape:u.outShape,dtype:r.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};function Nme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=w.parseAxisParam(i,o.shape),c=T.computeOutAndReduceShapes(o.shape,a)[1],u=w.sizeFromShape(c),d=[],p=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(p);let f=ai({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});d.push(f);let m=Iy({inputs:{a:f,b:p},backend:e});d.push(m);let h=ul({inputs:{x:m},backend:e,attrs:{axis:i,keepDims:s}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),h}var Qj={kernelName:dc,backendName:"cpu",kernelFunc:Nme};function kme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"min");let a=w.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=fn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=w.sizeFromShape(p),m=w.makeZerosTypedArray(w.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,S=h[b];for(let _=0;_<f;++_){let E=h[b+_];E<S&&(S=E)}m[x]=S}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=tt({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var Zj={kernelName:pc,backendName:"cpu",kernelFunc:kme};function Ame(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,mode:s}=r;Z(o,"mirrorPad");let a=i.map((S,_)=>S[0]+o.shape[_]+S[1]),l=i.map(S=>S[0]),c=i.map((S,_)=>S[0]+o.shape[_]),u=s==="reflect"?0:1,d=e.data.get(o.dataId).values,p=o.shape.length,f=w.computeStrides(o.shape),m=w.sizeFromShape(a),h=a.length,g=w.computeStrides(a),x=w.getTypedArrayFromDType(o.dtype,m);for(let S=0;S<m;S++){let _=w.indexToLoc(S,h,g);for(let I=0;I<h;I++)_[I]<l[I]?_[I]=l[I]*2-_[I]-u:_[I]>=c[I]&&(_[I]=(c[I]-1)*2-_[I]+u);_=_.map((I,D)=>I-l[D]);let E=w.locToIndex(_,p,f);x[S]=d[E]}return{dataId:e.write(x,a,o.dtype),shape:a,dtype:o.dtype}}var Jj={kernelName:fc,backendName:"cpu",kernelFunc:Ame};var Rme=et((t,n)=>{let e=t%n;return t<0&&n<0||t>=0&&n>=0?e:(e+n)%n}),Ome=dt(Ia,Rme),eG={kernelName:Ia,backendName:"cpu",kernelFunc:Ome};var yG=Zm(hG());function bk(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=w.parseAxisParam([a],o.shape),c=fk({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=T.expandShapeToKeepDim(c.shape,l),d=tt({inputs:{x:c},backend:e,attrs:{shape:u}}),p=Ey({inputs:{a:o,b:d},backend:e}),f=BN({inputs:{x:p},backend:e}),m=ul({inputs:{x:f},backend:e,attrs:{axis:l,keepDims:!1}}),h=tt({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Iy({inputs:{a:f,b:h},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var gG={kernelName:Nc,backendName:"cpu",kernelFunc:bk};function Bme(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r;Z(o,"multinomial");let l=a?o:bk({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,p=[c,i],f=w.makeZerosTypedArray(w.sizeFromShape(p),"int32");for(let m=0;m<c;++m){let h=m*u,g=new Float32Array(u-1);g[0]=d[h];for(let S=1;S<g.length;++S)g[S]=g[S-1]+d[h+S];let x=yG.alea(s.toString()),b=m*i;for(let S=0;S<i;++S){let _=x();f[b+S]=g.length;for(let E=0;E<g.length;E++)if(_<g[E]){f[b+S]=E;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(p,"int32",f)}var xG={kernelName:pb,backendName:"cpu",kernelFunc:Bme};var zme=Jn.nonMaxSuppressionV3Impl;function Ume(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;Z(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,{selectedIndices:d}=zme(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var vG={kernelName:fb,backendName:"cpu",kernelFunc:Ume};var jme=Jn.nonMaxSuppressionV4Impl;function Gme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;Z(o,"NonMaxSuppressionPadded");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=jme(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var bG={kernelName:mb,backendName:"cpu",kernelFunc:Gme};var Wme=Jn.nonMaxSuppressionV5Impl;function Hme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;Z(o,"NonMaxSuppressionWithScore");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:x}=Wme(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var wG={kernelName:hb,backendName:"cpu",kernelFunc:Hme};function qme(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r;Z(o,"oneHot");let l=w.sizeFromShape(o.shape),c=new Float32Array(l*i);c.fill(a);let u=e.data.get(o.dataId).values;for(let d=0;d<l;++d)u[d]>=0&&u[d]<i&&(c[d*i+u[d]]=s);return e.makeTensorInfo([...o.shape,i],"int32",c)}var CG={kernelName:gc,backendName:"cpu",kernelFunc:qme};function Ny(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=si({inputs:{input:r},backend:e}),i=Ny({inputs:{x:o},backend:e}),s=vs({inputs:{input:r},backend:e}),a=Ny({inputs:{x:s},backend:e}),l=Sn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Dy({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var _G={kernelName:Oc,backendName:"cpu",kernelFunc:Ny};function SG(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=si({inputs:{input:r},backend:e}),i=SG({inputs:{x:o},backend:e}),s=vs({inputs:{input:r},backend:e}),a=Ny({inputs:{x:s},backend:e}),l=Sn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Dy({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var EG={kernelName:hc,backendName:"cpu",kernelFunc:SG};function wk(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return $m({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{w.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),w.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=$m({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Yc({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var IG={kernelName:yc,backendName:"cpu",kernelFunc:wk};function Kme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;Z(o,"pad");let a=i.map((b,S)=>b[0]+o.shape[S]+b[1]),l=i.map(b=>b[0]),c=e.data.get(o.dataId).values,u=w.sizeFromShape(o.shape),d=o.shape.length,p=w.computeStrides(o.shape),f=w.sizeFromShape(a),m=a.length,h=w.computeStrides(a),g=w.getTypedArrayFromDType(o.dtype,f);s!==0&&g.fill(s);for(let b=0;b<u;b++){let _=w.indexToLoc(b,d,p).map((I,D)=>I+l[D]),E=w.locToIndex(_,m,h);g[E]=c[b]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var cC={kernelName:xc,backendName:"cpu",kernelFunc:Kme};var Xme=et((t,n)=>Math.pow(t,n)),Yme=dt(Da,Xme),TG={kernelName:Da,backendName:"cpu",kernelFunc:Yme};function Qme(t){let{backend:n,attrs:e}=t,{start:r,stop:o,dtype:i,step:s}=e,a=Zw(r,o,s,i);return n.makeTensorInfo([a.length],i,a)}var DG={kernelName:Vf,backendName:"cpu",kernelFunc:Qme};var Zme=Oe(Na,t=>1/t),NG={kernelName:Na,backendName:"cpu",kernelFunc:Zme};function Jme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Z(o,"resizeBilinear");let l=w.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(w.sizeFromShape([d,c,u,m])),x=[i&&c>1?p-1:p,i&&u>1?f-1:f],b=[i&&c>1?c-1:c,i&&u>1?u-1:u],S=0,_=x[0]/b[0],E=x[1]/b[1];for(let I=0;I<d;I++)for(let D=0;D<c;D++){let O;s?O=_*(D+.5)-.5:O=_*D;let R=Math.max(0,Math.floor(O)),$=O-R,G=Math.min(p-1,Math.ceil(O)),W=I*l[0]+R*l[1],q=I*l[0]+G*l[1];for(let X=0;X<u;X++){let K;s?K=E*(X+.5)-.5:K=E*X;let Y=Math.max(0,Math.floor(K)),re=K-Y,J=Math.min(f-1,Math.ceil(K)),ne=W+Y*l[2],se=q+Y*l[2],ue=W+J*l[2],fe=q+J*l[2];for(let de=0;de<m;de++){let xe=h[ne+de],ve=h[se+de],be=h[ue+de],Te=h[fe+de],Pe=xe+(be-xe)*re,Ve=ve+(Te-ve)*re,He=Pe+(Ve-Pe)*$;g[S++]=He}}}return e.makeTensorInfo([d,c,u,m],"float32",g)}var kG={kernelName:Cc,backendName:"cpu",kernelFunc:Jme};function ehe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Z([i,o],"resizeBilinearGrad");let a=w.computeStrides(o.shape),[l,c,u,d]=o.shape,[,p,f]=i.shape,m=new Float32Array(l*c*u*d),h=[s&&p>1?c-1:c,s&&f>1?u-1:u],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],x=h[0]/g[0],b=h[1]/g[1],S=e.data.get(i.dataId).values,_=0;for(let E=0;E<l;E++){let I=E*a[0];for(let D=0;D<p;D++){let O=D*x,R=Math.floor(O),$=Math.min(Math.ceil(O),c-1),G=I+R*a[1],W=I+$*a[1],q=O-R,X=1-q;for(let K=0;K<f;K++){let Y=K*b,re=Math.floor(Y),J=Math.min(Math.ceil(Y),u-1),ne=Y-re,se=1-ne,ue=G+re*a[2],fe=G+J*a[2],de=W+re*a[2],xe=W+J*a[2],ve=X*se,be=X*ne,Te=q*se,Pe=q*ne;for(let Ve=0;Ve<d;Ve++){let He=S[_++];m[ue+Ve]+=He*ve,m[fe+Ve]+=He*be,m[de+Ve]+=He*Te,m[xe+Ve]+=He*Pe}}}}return e.makeTensorInfo([l,u,c,d],"float32",m)}var AG={kernelName:Uf,backendName:"cpu",kernelFunc:ehe};function the(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Z(o,"resizeNearestNeighbor");let l=w.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(d*c*u*m),x=[i&&c>1?p-1:p,i&&u>1?f-1:f],b=[i&&c>1?c-1:c,i&&u>1?u-1:u],S=x[0]/b[0],_=x[1]/b[1],E=0;for(let I=0;I<d;I++){let D=I*l[0];for(let O=0;O<c;O++){let R=s?S*(O+.5):S*O,$=Math.min(p-1,i?Math.round(R):Math.floor(R));s&&($=Math.max(0,$));let G=D+$*l[1];for(let W=0;W<u;W++){let q=s?_*(W+.5):_*W,X=Math.min(f-1,i?Math.round(q):Math.floor(q));s&&(X=Math.max(0,X));let K=G+X*l[2];for(let Y=0;Y<m;Y++){let re=h[K+Y];g[E++]=re}}}}return e.makeTensorInfo([d,c,u,m],o.dtype,g)}var RG={kernelName:wc,backendName:"cpu",kernelFunc:the};function nhe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Z([i,o],"resizeNearestNeighborGrad");let a=w.computeStrides(o.shape),l=w.computeStrides(i.shape),[c,u,d,p]=o.shape,[,f,m]=i.shape,h=new Float32Array(c*u*d*p),g=e.data.get(i.dataId).values,x=[s&&f>1?u-1:u,s&&m>1?d-1:d],b=[s&&f>1?f-1:f,s&&m>1?m-1:m],S=x[0]/b[0],_=x[1]/b[1],E=1/S,I=1/_,D=Math.ceil(E)*2+2,O=Math.ceil(I)*2+2;for(let R=0;R<c;R++){let $=R*a[0];for(let G=0;G<u;G++){let W=$+G*a[1],q=Math.floor(G*E),X=Math.floor(q-D/2);for(let K=0;K<d;K++){let Y=W+K*a[2],re=Math.floor(K*I),J=Math.floor(re-O/2);for(let ne=0;ne<p;ne++){let se=0;for(let ue=0;ue<D;ue++){let fe=ue+X;if(fe<0||fe>=f)continue;let de=$+fe*l[1],xe=fe*S,ve=Math.min(u-1,s?Math.round(xe):Math.floor(xe));if(G===ve)for(let be=0;be<O;be++){let Te=be+J;if(Te<0||Te>=m)continue;let Pe=de+Te*l[2],Ve=Te*_,He=Math.min(d-1,s?Math.round(Ve):Math.floor(Ve));K===He&&(se+=g[Pe+ne])}}h[Y+ne]=se}}}}return e.makeTensorInfo(o.shape,o.dtype,h)}var OG={kernelName:zf,backendName:"cpu",kernelFunc:nhe};function rhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r;Z(o,"reverse");let s=o.shape.length,a=w.parseAxisParam(i,o.shape);if(s===0)return tr({inputs:{x:o},backend:e});let l=new Dt(o.shape,o.dtype),c=e.bufferSync(o);for(let u=0;u<l.size;u++){let d=l.indexToLoc(u),p=d.slice();a.forEach(f=>p[f]=o.shape[f]-1-p[f]),l.set(c.get(...p),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var MG={kernelName:_c,backendName:"cpu",kernelFunc:rhe};var FG={kernelName:wb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=w.getTypedArrayFromDType(r.dtype,w.sizeFromShape(r.shape)),[c,u,d,p]=r.shape,[f,m]=T.getImageCenter(s,u,d),h=255,g=Math.sin(o),x=Math.cos(o),b=a.data.get(r.dataId).values;for(let _=0;_<c;_++){let E=_*d*u*p;for(let I=0;I<u;I++){let D=I*(d*p);for(let O=0;O<d;O++){let R=O*p;for(let $=0;$<p;$++){let G=[c,I,O,$],W=G[2],q=G[1],X=(W-f)*x-(q-m)*g,K=(W-f)*g+(q-m)*x;X=Math.round(X+f),K=Math.round(K+m);let Y=i;if(typeof i!="number"&&($===3?Y=h:Y=i[$]),X>=0&&X<d&&K>=0&&K<u){let J=K*(d*p),ne=X*p,se=E+J+ne+$;Y=b[se]}let re=E+D+R+$;l[re]=Y}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var ohe=Oe(Ra,t=>{let n=Math.floor(t);return t-n<.5?Math.floor(t):t-n>.5?Math.ceil(t):n%2===0?n:n+1}),PG={kernelName:Ra,backendName:"cpu",kernelFunc:ohe};function uC(t,n,e,r,o,i,s,a,l,c){let u=[r/o,o],d=t.values,p=n.values;if(r===0)return Ee(e,n.dtype);let f=Ee(u,n.dtype);f.values.fill(l);for(let m=0;m<i;m++){let h=[],g=0;for(let x=0;x<s;x++){let b=d[m*s+x];h.push(b),g+=b*a[x]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${h} does not index into ${e}`);for(let x=0;x<o;x++)c?f.values[g*o+x]+=p[m*o+x]:f.values[g*o+x]=n.rank===0?p[0]:p[m*o+x]}return f}function ihe(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=!0,f=e.bufferSync(o),m=e.bufferSync(i),h=uC(f,m,s,d,c,l,a,u,0,p);return e.makeTensorInfo(s,h.dtype,h.values)}var $G={kernelName:gb,backendName:"cpu",kernelFunc:ihe};function she(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n;Z([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=_n(o.dtype,i.dtype),d=w.makeZerosTypedArray(w.sizeFromShape(o.shape),u),p=0,f=s===0||s>1||o.shape.length===1?1:w.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<f;h++)a[m]===1?d[p++]=l[m]:d[p++]=c[m];return e.makeTensorInfo(o.shape,u,d)}var LG={kernelName:Sc,backendName:"cpu",kernelFunc:she};var ahe=T.SELU_SCALEALPHA,lhe=T.SELU_SCALE,che=Oe(Ma,t=>t>=0?lhe*t:ahe*(Math.exp(t)-1)),VG={kernelName:Ma,backendName:"cpu",kernelFunc:che};var uhe=Oe($a,t=>t<0?-1:t>0?1:0),BG={kernelName:$a,backendName:"cpu",kernelFunc:uhe};var dhe=Oe(Fa,t=>Math.sin(t)),zG={kernelName:Fa,backendName:"cpu",kernelFunc:dhe};var phe=Oe(Pa,t=>Math.sinh(t)),UG={kernelName:Pa,backendName:"cpu",kernelFunc:phe};var fhe=11920928955078125e-23,jG=Math.log(fhe)+2,mhe=Oe(Va,t=>{let n=t>-jG,e=t<jG,r=Math.exp(t),o;return e?o=r:n?o=t:o=Math.log(1+r),o}),GG={kernelName:Va,backendName:"cpu",kernelFunc:mhe};function hhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;Z([o],"spaceToBatchND");let a=w.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let I=1+i.length;I<o.shape.length;++I)l.push([0,0]);let c=cC.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),u=T.getReshaped(c.shape,i,a,!1),d=T.getPermuted(u.length,i.length,!1),p=T.getReshapedPermuted(c.shape,i,a,!1),h=tt({inputs:{x:c},backend:e,attrs:{shape:u}}),b=fn({inputs:{x:h},backend:e,attrs:{perm:d}}),E=tt({inputs:{x:b},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(b),E}var WG={kernelName:Tc,backendName:"cpu",kernelFunc:hhe};function ghe(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=e.data.get(s.dataId).values[0],[d,p,f,m,h]=Jw(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var HG={kernelName:yb,backendName:"cpu",kernelFunc:ghe};function yhe(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[c,u,d]=eC(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var qG={kernelName:xb,backendName:"cpu",kernelFunc:yhe};function xhe(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1,m=e.bufferSync(o),h=e.bufferSync(i),g=e.data.get(s.dataId).values[0],x=uC(m,h,a,p,u,c,l,d,g,f);return e.makeTensorInfo(a,x.dtype,x.values)}var KG={kernelName:vb,backendName:"cpu",kernelFunc:xhe};function vhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=w.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{let p=[...u];p[a]=d;let f=ui({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[a]+=d,f})}var XG={kernelName:Dc,backendName:"cpu",kernelFunc:vhe};var bhe=Oe(Ba,t=>Math.sqrt(t)),YG={kernelName:Ba,backendName:"cpu",kernelFunc:bhe};var QG={kernelName:jf,backendName:"cpu",kernelFunc:({inputs:t,backend:n})=>{let{x:e}=t,r=n;Z(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var whe=Oe(Wa,(t,n)=>{let e=n;return isNaN(t)?NaN:t>0?1:e.alpha}),ZG={kernelName:Wa,backendName:"cpu",kernelFunc:whe};function Che(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r;Z(o,"stridedSlice");let{nonStrided:f,$begin:m,$strides:h,size:g,newShape:x,outShape:b}=Xn.sliceInfo(o.shape,i,s,a,l,c,u,d,p),S=tt({inputs:{x:o},backend:e,attrs:{shape:x}}),_;if(f){let I=ui({inputs:{x:S},backend:e,attrs:{begin:m,size:g}});_=tt({inputs:{x:I},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(I)}else if(b.some(I=>I===0))_=e.makeTensorInfo(b,o.dtype,[]);else{let I=e.bufferSync(S),D=tC(b,I,h,m);_=e.makeTensorInfo(D.shape,D.dtype,D.values)}let E=tt({inputs:{x:_},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(_),E}var JG={kernelName:Gf,backendName:"cpu",kernelFunc:Che};var _he=Oe(ja,t=>Math.tan(t)),eW={kernelName:ja,backendName:"cpu",kernelFunc:_he};var She=Oe(Ga,t=>Math.tanh(t)),tW={kernelName:Ga,backendName:"cpu",kernelFunc:She};function Ehe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;Z(o,"tile");let s=nC(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var nW={kernelName:cs,backendName:"cpu",kernelFunc:Ehe};function Ihe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r;Z(o,"topk");let a=e.data.get(o.dataId).values,[l,c]=rC(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var rW={kernelName:Wf,backendName:"cpu",kernelFunc:Ihe};function The(t){let{inputs:n,attrs:e,backend:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=e,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],x=w.computeStrides(o.shape),b=x[0],S=x[1],_=x[2],E=w.getTypedArrayFromDType(o.dtype,w.sizeFromShape(g));E.fill(l);let I=r.data.get(o.dataId).values,D=r.data.get(i.dataId).values;for(let R=0;R<u;++R){let $=i.shape[0]===1?D:D.subarray(R*8,R*8+8);for(let G=0;G<m;++G)for(let W=0;W<h;++W)for(let q=0;q<f;++q){let X,K=$[6]*W+$[7]*G+1;if(K===0)continue;let Y=($[0]*W+$[1]*G+$[2])/K,re=($[3]*W+$[4]*G+$[5])/K,J=oW(Y,p,a),ne=oW(re,d,a);switch(s){case"nearest":X=Rhe(I,d,p,b,S,_,R,ne,J,q,l);break;case"bilinear":X=Ohe(I,d,p,b,S,_,R,ne,J,q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let se=R*b+G*S+W*_+q;E[se]=X}return r.makeTensorInfo(g,o.dtype,E)}return{dataId:r.write(E,g,o.dtype),shape:o.shape,dtype:o.dtype}}var iW={kernelName:bb,backendName:"cpu",kernelFunc:The};function oW(t,n,e){switch(e){case"reflect":return Dhe(t,n);case"wrap":return Nhe(t,n);case"nearest":return Ahe(t,n);case"constant":default:return khe(t,n)}}function Dhe(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=2*n;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-n?e+r:-e-1}else if(e>n-1)if(n<=1)e=0;else{let r=2*n;e-=r*Math.trunc(e/r),e>=n&&(e=r-e-1)}return w.clamp(0,e,n-1)}function Nhe(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=n-1;e+=n*(Math.trunc(-e/r)+1)}else if(e>n-1)if(n<=1)e=0;else{let r=n-1;e-=n*Math.trunc(e/r)}return w.clamp(0,e,n-1)}function khe(t,n){return t}function Ahe(t,n){return w.clamp(0,t,n-1)}function ky(t,n,e,r,o,i,s,a,l,c,u){let d=s*r+a*o+l*i+c;return 0<=a&&a<n&&0<=l&&l<e?t[d]:u}function Rhe(t,n,e,r,o,i,s,a,l,c,u){let d=Math.round(a),p=Math.round(l);return ky(t,n,e,r,o,i,s,d,p,c,u)}function Ohe(t,n,e,r,o,i,s,a,l,c,u){let d=Math.floor(a),p=Math.floor(l),f=d+1,m=p+1,h=(m-l)*ky(t,n,e,r,o,i,s,d,p,c,u)+(l-p)*ky(t,n,e,r,o,i,s,d,m,c,u),g=(m-l)*ky(t,n,e,r,o,i,s,f,p,c,u)+(l-p)*ky(t,n,e,r,o,i,s,f,m,c,u);return(f-a)*h+(a-d)*g}function Mhe(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;Z(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=oC(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var sW={kernelName:Hf,backendName:"cpu",kernelFunc:Mhe};function Fhe(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),c=0;for(let f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);let u=new Array(s).fill(0),d=o.shape.slice();d[i]=1;let p=new Array(a);for(let f=0;f<p.length;f++){u[i]=f;let m=ui({inputs:{x:o},backend:e,attrs:{begin:u,size:d}});p[f]=tt({inputs:{x:m},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(m)}return p}var aW={kernelName:Ac,backendName:"cpu",kernelFunc:Fhe};function Phe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r;Z(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,c=[],u=[],d=a-l,p=i;for(let m=0;m<d;++m){let h=$m({inputs:{input:p},backend:e,attrs:{dim:m+1}});p=h,u.push(h)}for(let m=0;m<s;++m){let h=w.createScalarValue(m,"int32"),g=e.makeTensorInfo([],"int32",h),x=dk({inputs:{a:g,b:p},backend:e}),b=ai({inputs:{x},backend:e,attrs:{dtype:"float32"}}),S=Bd({inputs:{a:b,b:o},backend:e}),_=ul({inputs:{x:S},backend:e,attrs:{axis:0,keepDims:!1}});c.push(_),u.push(g),u.push(x),u.push(b),u.push(S),u.push(_)}let f=wk({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var lW={kernelName:Rc,backendName:"cpu",kernelFunc:Phe};var $he=[TU,X4,DU,NU,eU,kU,AU,RU,OU,MU,FU,PU,$U,LU,VU,zU,UU,jU,GU,IU,WU,HU,qU,J4,tU,KU,Y4,XU,QU,JU,ej,ZU,nj,rj,tj,oj,ij,sj,aj,lj,cj,uj,dj,pj,fj,mj,gj,hj,Ty,xj,vU,vj,bj,wj,nU,Cj,rU,_j,Sj,Ej,oU,Ij,Tj,Dj,Nj,kj,iU,Aj,Q4,Rj,YU,Oj,Mj,Fj,bU,sU,Pj,$j,aU,Lj,Vj,Bj,zj,Uj,jj,lU,Wj,Hj,qj,Kj,Yj,Gj,Qj,Zj,cU,Jj,eG,xG,uU,dU,vG,bG,wG,pU,CG,EG,IG,cC,TG,wU,mU,DG,Z4,NG,CU,_U,EU,kG,AG,RG,OG,MG,FG,PG,hU,$G,LG,VG,SU,BG,zG,UG,gU,gG,GG,WG,HG,qG,KG,XG,YG,QG,yU,ZG,JG,xU,yj,eW,tW,nW,rW,fU,iW,sW,aW,lW,_G];for(let t of $he)_b(t);var Ud={},Ck={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function cW(t,n){Ud[t]=n}function So(t){if(!(t in Ud)){let e=Vhe(t);if(e!==null)Ud[t]=e;else return console.log("Could not get context for WebGL version",t),null}let n=Ud[t];return n.isContextLost()?(delete Ud[t],So(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Ud[t])}function Lhe(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Vhe(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=Lhe(t);return n.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete Ud[t]},!1),t===1?n.getContext("webgl",Ck)||n.getContext("experimental-webgl",Ck):n.getContext("webgl2",Ck)}var jd=function(t){return t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH",t}(jd||{}),fr=function(t){return t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD",t}(fr||{}),nr=function(t){return t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",t}(nr||{});function Gd(t,n){return[n,t]}function uW(t,n){return t*n}function Qc(t){let n=w.sizeFromShape(t),e=Math.ceil(n/4);return w.sizeToSquarishShape(e)}function bs(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function dW(t,n){let[e,r]=bs(t,n);return e*r*4}function Ay(t,n){let e=t,r,o,i,s,a,l,c,u,d,p;return H().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,c=4,u=1,d=e.HALF_FLOAT,p=e.FLOAT):(r=t.RGBA,o=t.RGBA,i=t.RGBA,s=e.RGBA,a=t.RGBA,c=4,u=4,d=n!=null?n.HALF_FLOAT_OES:null,p=t.FLOAT),l=t.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:p}}function ke(t,n){let e=n();return H().getBool("DEBUG")&&Bhe(t),e}function Bhe(t){let n=t.getError();if(n!==t.NO_ERROR)throw new Error("WebGL Error: "+jhe(t,n))}var zhe=596e-10,Uhe=65504;function pW(t){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||zhe<Math.abs(t)&&Math.abs(t)<Uhe)}function jhe(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${n}`}}function Ry(t,n){return dl(t,()=>t.getExtension(n),'Extension "'+n+'" not supported on this browser.')}function fW(t,n){let e=dl(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ke(t,()=>t.shaderSource(e,n)),ke(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function mW(t,n){let e=dl(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ke(t,()=>t.shaderSource(e,n)),ke(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw Whe(n,t.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var Ghe=/ERROR: [0-9]+:([0-9]+):/g;function Whe(t,n){let e=Ghe.exec(n);if(e==null){console.log(`Couldn't parse line number in error: ${n}`),console.log(t);return}let r=+e[1],o=t.split(`
`),i=o.length.toString().length+2,s=o.map((d,p)=>w.rightPad((p+1).toString(),i)+d),a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);let l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join(`
`)),console.log(n.split(`
`)[0]),console.log(`%c ${w.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function hW(t){return dl(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function gW(t,n){if(ke(t,()=>t.linkProgram(n)),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function pC(t,n){if(ke(t,()=>t.validateProgram(n)),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function yW(t,n){let e=dl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),ke(t,()=>t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function xW(t,n){let e=dl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)),ke(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function vW(t){return dl(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function bW(t,n){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){let r=`[${t}x${n}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e){let r=`[${t}x${n}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function wW(t){return dl(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Tk(t,n,e,r,o,i,s){let a=t.getAttribLocation(n,e);return a===-1?!1:(ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),ke(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,i,s)),ke(t,()=>t.enableVertexAttribArray(a)),!0)}function Hhe(t,n,e){Khe(t,e),ke(t,()=>t.activeTexture(t.TEXTURE0+e)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,n))}function CW(t,n,e){return dl(t,()=>t.getUniformLocation(n,e),'uniform "'+e+'" not present in program.')}function _W(t,n,e){return t.getUniformLocation(n,e)}function SW(t,n,e,r){ke(t,()=>Hhe(t,n,r)),ke(t,()=>t.uniform1i(e,r))}function fC(t,n,e){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0))}function Dk(t,n){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Oy(t){let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+qhe(t,n))}function qhe(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${n}`}}function dl(t,n,e){let r=ke(t,()=>n());if(r==null)throw new Error(e);return r}function Khe(t,n){let e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Zc(t,n=2){return w.sizeFromShape(t.slice(0,t.length-n))}function Jc(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function mC(t){let n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[Zc(t),...Jc(t)]),n}function EW(t,n=!1){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");n&&(e=e*2,t=t.map((o,i)=>i>=t.length-2?w.nearestLargerEven(t[i]):t[i]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=w.squeezeShape(t).newShape);let r=w.sizeFromShape(t);if(t.length<=1&&r<=e)return[1,r];if(t.length===2&&t[0]<=e&&t[1]<=e)return t;if(t.length===3&&t[0]*t[1]<=e&&t[2]<=e)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=e&&t[1]*t[2]<=e)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=e&&t[3]<=e)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=e&&t[1]*t[2]*t[3]<=e)return[t[0],t[1]*t[2]*t[3]];if(n){let o=Zc(t),i=2,s=2;return t.length&&([i,s]=Jc(t)),r=o*(i/2)*(s/2),w.sizeToSquarishShape(r).map(a=>a*2)}return w.sizeToSquarishShape(r)}function dC(t){return t%2===0}function Wd(t,n){if(t=t.slice(-2),n=n.slice(-2),w.arraysEqual(t,n)||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){let e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||dC(e)&&dC(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&dC(t[0])&&dC(n[0])}var Sk,Ek;function IW(t){if(Sk==null){let n=So(t);Sk=n.getParameter(n.MAX_TEXTURE_SIZE)}return Sk}function TW(t){if(Ek==null){let n=So(t);Ek=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Ek)}function DW(t){if(t===0)return 0;let n,e=So(t);return Eo(e,"EXT_disjoint_timer_query_webgl2")&&t===2?n=2:Eo(e,"EXT_disjoint_timer_query")?n=1:n=0,n}function Eo(t,n){return t.getExtension(n)!=null}function Nk(t){try{if(So(t)!=null)return!0}catch(n){return console.log("Error when getting WebGL context: ",n),!1}return!1}function NW(t){if(t===0)return!1;let n=So(t);if(t===1){if(!Eo(n,"OES_texture_float"))return!1}else if(!Eo(n,"EXT_color_buffer_float"))return!1;return Ik(n)}function kW(t){if(t===0)return!1;let n=So(t);if(t===1){if(!Eo(n,"OES_texture_float")||!Eo(n,"WEBGL_color_buffer_float"))return!1}else{if(Eo(n,"EXT_color_buffer_float"))return Ik(n);let r="EXT_color_buffer_half_float";if(Eo(n,r)){let o=n.getExtension(r);return Xhe(n,o)}return!1}return Ik(n)}function Ik(t){let n=Ay(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(i),s}function Xhe(t,n){let e=Ay(t,n),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function AW(t){return t!==2?!1:So(t).fenceSync!=null}function ws(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&w.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the WebGL backend.`)})}var Be=H();Be.registerFlag("HAS_WEBGL",()=>Be.getNumber("WEBGL_VERSION")>0);Be.registerFlag("WEBGL_VERSION",()=>Nk(2)?2:Nk(1)?1:0);Be.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Be.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Be.get("WEBGL_VERSION")===2);Be.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Be.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Be.registerFlag("WEBGL_PACK",()=>Be.getBool("HAS_WEBGL"));Be.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_CLIP",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_REDUCE",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_LAZILY_UNPACK",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_CONV_IM2COL",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>IW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>TW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=Be.getNumber("WEBGL_VERSION");return t===0?0:DW(t)});Be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Mc.isMobile());Be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>NW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Be.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>kW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_FENCE_API_ENABLED",()=>AW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Be.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Be.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Mc.isMobile()&&Be.getBool("IS_CHROME")?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});function en(){let t,n,e,r,o,i,s,a,l,c;return H().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function Ui(t,n,e="index"){let r=w.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * ${o}`:`index -= ${t[i]} * ${o}`;return`${s}; ${a};`}).join("")}function Lm(t){let n=w.computeStrides(t).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${n[0]} + coords.y * ${n[1]} + coords.z;
  }
`}var gC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var yC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=jd.DENSE;let e=Qc(n),r=en();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Ui(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var xC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=jd.DENSE;let e=Qc(n),r=en();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Ui(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var vC=class{constructor(n){this.variableNames=["A"],this.outTexUsage=fr.DOWNLOAD;let e=en();this.outputShape=n,this.userCode=`
      ${gC}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var bC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=fr.DOWNLOAD;let e=en();this.outputShape=n,this.userCode=`
      ${gC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var wC=class{constructor(n,e,r=!1){this.variableNames=["A"];let o=en(),[i,s]=e;this.outputShape=n;let a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${Lm(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${s};
        int c = imod(flatIndex, ${s});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
        vec4 values = ${o.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}};var CC=class{constructor(n,e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let o=en(),[i,s]=e;this.outputShape=n;let a="",l="result";r&&(l="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let d=c*2+u;a+=`
          localCoords = coords;
          if(localCoords[2] + ${u} < ${n[2]}) {
            localCoords[2] += ${u};
            if(localCoords[1] + ${c} < ${n[1]}) {
              localCoords[1] += ${c};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${s};
              c = imod(flatIndex, ${s});
              uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
              values = ${o.texture2D}(A, uv);

              if(offset == 0) {
                result[${d}] = values[0];
              } else if(offset == 1) {
                result[${d}] = values[1];
              } else if(offset == 2) {
                result[${d}] = values[2];
              } else {
                result[${d}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${Lm(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${a}

        ${o.output} = ${l};
      }
    `}};function RW(t){let n=en(),e=`${n.version}
    precision highp float;
    ${n.attribute} vec3 clipSpacePos;
    ${n.attribute} vec2 uv;
    ${n.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return fW(t,e)}function OW(t){let n=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return yW(t,n)}function MW(t){let n=new Uint16Array([0,1,2,2,1,3]);return xW(t,n)}function My(t,n,e,r,o,i){bW(n,e);let s=vW(t),a=t.TEXTURE_2D;return ke(t,()=>t.bindTexture(a,s)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ke(t,()=>t.texImage2D(a,0,r,n,e,0,o,i,null)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null)),s}function kk(t){return t.internalFormatFloat}function FW(t,n,e,r){let[o,i]=Gd(n,e);return My(t,o,i,kk(r),r.textureFormatFloat,t.FLOAT)}function Ak(t){return t.internalFormatHalfFloat}function PW(t,n,e,r){let[o,i]=Gd(n,e);return My(t,o,i,Ak(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function Rk(t){return t.downloadTextureFormat}function $W(t,n,e,r){let[o,i]=Gd(n,e);return My(t,o,i,Rk(r),t.RGBA,t.UNSIGNED_BYTE)}function Ok(t){return t.internalFormatPackedFloat}function LW(t,n,e,r){let[o,i]=bs(n,e);return My(t,o,i,Ok(r),t.RGBA,t.FLOAT)}function Mk(t){return t.internalFormatPackedHalfFloat}function VW(t,n,e,r){let[o,i]=bs(n,e);return My(t,o,i,Mk(r),t.RGBA,r.textureTypeHalfFloat)}function BW(t,n,e){return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),Tk(t,n,"clipSpacePos",e,3,20,0)&&Tk(t,n,"uv",e,2,20,12)}function zW(t,n,e,r,o,i){ke(t,()=>t.bindTexture(t.TEXTURE_2D,n));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(e*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),s.set(o),ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,e,r,0,t.RGBA,a,s)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function UW(t,n,e){ke(t,()=>t.bindTexture(t.TEXTURE_2D,n)),e.data instanceof Uint8Array?ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e.data)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function jW(t,n,e,r){let o=t.createBuffer();ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*n*e;return ke(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ke(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,0)),ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function GW(t,n,e){let r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function WW(t,n,e,r){let[o,i]=Gd(n,e),s=4,a=new Uint8Array(uW(n*e,s));return ke(t,()=>t.readPixels(0,0,o,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function HW(t,n,e,r,o,i,s,a){let l=t,c=new Float32Array(dW(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,n),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function qW(t,n,e){let r=new Float32Array(n*e*4);return ke(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,r)),r}var _C=class{constructor(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let e=H().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,cW(e,n)):this.gl=So(e);let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(H().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=Ry(this.gl,i),Eo(this.gl,s))this.textureHalfFloatExtension=Ry(this.gl,s);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Eo(this.gl,o))this.colorBufferHalfFloatExtension=Ry(this.gl,o);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Eo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Eo(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=OW(this.gl),this.indexBuffer=MW(this.gl),this.framebuffer=wW(this.gl),this.textureConfig=Ay(this.gl,this.textureHalfFloatExtension)}get debug(){return H().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let n=this.gl;ke(n,()=>n.finish()),ke(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),ke(n,()=>n.deleteFramebuffer(this.framebuffer)),ke(n,()=>n.bindBuffer(n.ARRAY_BUFFER,null)),ke(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)),ke(n,()=>n.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(n,e){return this.throwIfDisposed(),FW(this.gl,n,e,this.textureConfig)}createFloat16MatrixTexture(n,e){return this.throwIfDisposed(),PW(this.gl,n,e,this.textureConfig)}createUnsignedBytesMatrixTexture(n,e){return this.throwIfDisposed(),$W(this.gl,n,e,this.textureConfig)}uploadPixelDataToTexture(n,e){this.throwIfDisposed(),UW(this.gl,n,e)}uploadDenseMatrixToTexture(n,e,r,o){this.throwIfDisposed(),zW(this.gl,n,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(n,e){return this.throwIfDisposed(),VW(this.gl,n,e,this.textureConfig)}createPackedMatrixTexture(n,e){return this.throwIfDisposed(),LW(this.gl,n,e,this.textureConfig)}deleteMatrixTexture(n){this.throwIfDisposed(),this.outputTexture===n&&(Dk(this.gl,this.framebuffer),this.outputTexture=null),ke(this.gl,()=>this.gl.deleteTexture(n))}downloadByteEncodedFloatMatrixFromOutputTexture(n,e,r){return this.downloadMatrixDriver(n,()=>WW(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(n,e,r,o,i,s){return HW(this.gl,n,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(n,e){return GW(this.gl,n,e)}createBufferFromTexture(n,e,r){this.bindTextureToFrameBuffer(n);let o=jW(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let n=this.createFence(this.gl);return this.pollFence(n)}createFence(n){let e,r;if(H().getBool("WEBGL_FENCE_API_ENABLED")){let o=n,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(n,e,r){return this.downloadMatrixDriver(n,()=>qW(this.gl,e,r))}createProgram(n){this.throwIfDisposed();let e=this.gl,r=mW(e,n);this.vertexShader==null&&(this.vertexShader=RW(e));let o=hW(e);return ke(e,()=>e.attachShader(o,this.vertexShader)),ke(e,()=>e.attachShader(o,r)),gW(e,o),this.debug&&pC(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=BW(e,this.program,this.vertexBuffer)),o}deleteProgram(n){this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&ke(this.gl,()=>this.gl.deleteProgram(n))}setProgram(n){this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&pC(this.gl,this.program),ke(this.gl,()=>this.gl.useProgram(n))}getUniformLocation(n,e,r=!0){return this.throwIfDisposed(),r?CW(this.gl,n,e):_W(this.gl,n,e)}getAttributeLocation(n,e){return this.throwIfDisposed(),ke(this.gl,()=>this.gl.getAttribLocation(n,e))}getUniformLocationNoThrow(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)}setInputMatrixTexture(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),SW(this.gl,n,e,r)}setOutputMatrixTexture(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)}setOutputPackedMatrixTexture(n,e,r){this.throwIfDisposed();let[o,i]=bs(e,r);this.setOutputMatrixTextureDriver(n,o,i)}setOutputMatrixWriteRegion(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)}setOutputPackedMatrixWriteRegion(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&pC(this.gl,this.program),Oy(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let n=this.gl;this.debug&&this.debugValidate(),ke(n,()=>n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ke(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ry(this.gl,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let n=this.getQueryTimerExtensionWebGL1(),e=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),e}endQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(n){return await w.repeatedTry(()=>this.disposed||this.isQueryAvailable(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(n,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(n,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(n){return new Promise(e=>{this.addItemToPoll(()=>n.isFencePassed(),()=>e())})}pollItems(){let n=Qhe(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=n;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(n+1)}addItemToPoll(n,e){this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),!(this.itemsToPoll.length>1)&&w.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(n){this.throwIfDisposed(),fC(this.gl,n,this.framebuffer),this.debug&&Oy(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(fC(this.gl,this.outputTexture,this.framebuffer),this.debug&&Oy(this.gl)):Dk(this.gl,this.framebuffer)}downloadMatrixDriver(n,e){this.bindTextureToFrameBuffer(n);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(n,e,r){this.throwIfDisposed();let o=this.gl;fC(o,n,this.framebuffer),this.debug&&Oy(o),this.outputTexture=n,ke(o,()=>o.viewport(0,0,e,r)),ke(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(n,e,r,o){this.throwIfDisposed(),ke(this.gl,()=>this.gl.scissor(n,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function Qhe(t){let n=0;for(;n<t.length&&t[n]();++n);return n-1}var{getBroadcastDims:KW}=T;function XW(t,n,e,r){let o=[];t.forEach(m=>{let h=w.sizeFromShape(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?o.push(`uniform float ${m.name}${h>1?`[${h}]`:""};`):(o.push(`uniform sampler2D ${m.name};`),o.push(`uniform int offset${m.name};`))});let i=o.join(`
`),s=t.map(m=>Zhe(m,n,r)).join(`
`),a=n.texShape,l=en(),c=tge(l),u,d,p=oge(l);return n.isPacked?(u=Jhe(n.logicalShape,a),d=rge(l)):(u=ege(n.logicalShape,a),d=nge(l)),r&&(p+=lge),[p,c,d,i,u,s,e].join(`
`)}function Bm(t){let n=t.shapeInfo.logicalShape;switch(n.length){case 0:return bge(t);case 1:return Cge(t);case 2:return Sge(t);case 3:return Ige(t);case 4:return Dge(t);case 5:return Nge(t);case 6:return kge(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function YW(t){switch(t.shapeInfo.logicalShape.length){case 0:return vge(t);case 1:return wge(t);case 2:return _ge(t);case 3:return Ege(t);default:return Tge(t)}}function Zhe(t,n,e=!1){let r="";e?r+=YW(t):r+=Bm(t);let o=t.shapeInfo.logicalShape,i=n.logicalShape;return o.length<=i.length&&(e?r+=Age(t,n):r+=Rge(t,n)),r}function Jhe(t,n){switch(t.length){case 0:return QW();case 1:return cge(t,n);case 2:return yge(t,n);case 3:return dge(t,n);default:return fge(t,n)}}function ege(t,n){switch(t.length){case 0:return QW();case 1:return uge(t,n);case 2:return xge(t,n);case 3:return pge(t,n);case 4:return mge(t,n);case 5:return hge(t,n);case 6:return gge(t,n);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function tge(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function nge(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function rge(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function oge(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${ige}
    ${sge}
    ${age}
  `}var ige=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,sge=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,age=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,lge=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function QW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function cge(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${e[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return 2 * (resTexRC.x * ${e[1]} + resTexRC.y);
    }
  `}function uge(t,n){return n[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${n[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return resTexRC.x * ${n[1]} + resTexRC.y;
    }
  `}function dge(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function pge(t,n){let e=Ui(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec3(r, c, d);
    }
  `}function fge(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,s="",a="b, r, c";for(let l=2;l<t.length-1;l++)i*=t[t.length-l-1],s=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+s,a=`b${l}, `+a;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${a});
    }
  `}function mge(t,n){let e=Ui(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec4(r, c, d, d2);
    }
  `}function hge(t,n){let e=Ui(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${n[0]},
                             ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function gge(t,n){let e=Ui(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function yge(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(w.arraysEqual(t,n))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `;let r=Math.ceil(t[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function xge(t,n){return w.arraysEqual(t,n)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `:t[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Hd(t){return`offset${t}`}function vge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=en();return`
    vec4 ${e}() {
      return ${r.texture2D}(${n}, halfCR);
    }
  `}function bge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${e}() {return ${n};}`;let[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${e}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let[i,s]=t.shapeInfo.texShape,a=Hd(n);return`
    float ${e}() {
      vec2 uv = uvFromFlat(${i}, ${s}, ${a});
      return sampleTexture(${n}, uv);
    }
  `}function wge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=en();return`
    vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function Cge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${e}(int index) {
        ${zm(t)}
      }
    `;let r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${e}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let s=Hd(n);return i===1?`
      float ${e}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?`
      float ${e}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${e}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${s});
      return sampleTexture(${n}, uv);
    }
  `}function _ge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=o[0],s=o[1],a=en();if(o!=null&&w.arraysEqual(n,o))return`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${i}.0);

        return ${a.texture2D}(${e}, uv);
      }
    `;let l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${a.texture2D}(${e}, uv);
    }
  `}function Sge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape;if(o!=null&&w.arraysEqual(n,o)){let d=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${e}, uv);
    }
  `}let{newShape:i,keptDims:s}=w.squeezeShape(n),a=i;if(a.length<n.length){let d=Um(t,a),p=["row","col"];return`
      ${Bm(d)}
      float ${r}(int row, int col) {
        return ${r}(${jm(p,s)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${zm(t)}
      }
    `;let l=o[0],c=o[1],u=Hd(e);return c===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${e}, uv);
    }
  `:l===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${e}, uv);
    }
  `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${u};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${e}, uv);
  }
`}function Ege(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){let d=n.slice(1),p=[1,2],f=Um(t,d),m=["b","row","col"];return`
        ${YW(f)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${jm(m,p)});
        }
      `}let s=i[0],a=i[1],l=Math.ceil(n[2]/2),c=l*Math.ceil(n[1]/2),u=en();return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${s}, ${a}, ${c}, ${l}, b, row, col);
      return ${u.texture2D}(${e}, uv);
    }
  `}function Ige(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[1]*n[2],i=n[2],{newShape:s,keptDims:a}=w.squeezeShape(n),l=s;if(l.length<n.length){let m=Um(t,l),h=["row","col","depth"];return`
        ${Bm(m)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${jm(h,a)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${zm(t)}
      }
    `;let c=t.shapeInfo.texShape,u=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===o&&p==null)return`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${u}.0);
          return sampleTexture(${e}, uv);
        }
      `;if(d===i&&p==null)return`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${u}.0);
      return sampleTexture(${e}, uv);
    }
  `;let f=Hd(e);return`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${u}, ${d}, index);
        return sampleTexture(${e}, uv);
      }
  `}function Tge(t){let n=t.shapeInfo.logicalShape,e=n.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],a=s[0],l=s[1],c=Math.ceil(n[e-1]/2),u=c*Math.ceil(n[e-2]/2),d="int b, int row, int col",p=`b * ${u} + (row / 2) * ${c} + (col / 2)`;for(let m=2;m<e-1;m++)d=`int b${m}, `+d,u*=n[e-m-1],p=`b${m} * ${u} + `+p;let f=en();return`
    vec4 ${o}(${d}) {
      int index = ${p};
      int texR = index / ${l};
      int texC = index - texR * ${l};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${a});
      return ${f.texture2D}(${r}, uv);
    }
  `}function Dge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[3],i=n[2]*o,s=n[1]*i,{newShape:a,keptDims:l}=w.squeezeShape(n);if(a.length<n.length){let m=Um(t,a),h=["row","col","depth","depth2"];return`
      ${Bm(m)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${jm(h,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${s}, ${i}, ${o}, 1)));
        ${zm(t)}
      }
    `;let c=t.shapeInfo.flatOffset,u=t.shapeInfo.texShape,d=u[0],p=u[1];if(p===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let f=Hd(e);return`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${f});
      return sampleTexture(${e}, uv);
    }
  `}function Nge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[4],i=n[3]*o,s=n[2]*i,a=n[1]*s,{newShape:l,keptDims:c}=w.squeezeShape(n);if(l.length<n.length){let h=Um(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Bm(h)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${jm(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${zm(t)}
      }
    `;let u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]},
               ${n[2]*n[3]}, ${n[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=Hd(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function kge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=w.squeezeShape(n);if(o.length<n.length){let g=Um(t,o),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${Bm(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${jm(x,i)});
      }
    `}let s=n[5],a=n[4]*s,l=n[3]*a,c=n[2]*l,u=n[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${zm(t)}
      }
    `;let d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];if(m===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]*n[4]},
               ${n[2]*n[3]*n[4]},
               ${n[3]*n[4]},
               ${n[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=Hd(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${h};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function zm(t){let n=t.name,e=w.sizeFromShape(t.shapeInfo.logicalShape);return e<2?`return ${n};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${n}[i];
      }
    }
  `}function Age(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=n.logicalShape.length,a=KW(t.shapeInfo.logicalShape,n.logicalShape),l=Ge(s),c=s-i,u,d=["x","y","z","w","u","v"];i===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(b=>`coords.${d[b+c]} = 0;`).join(`
`);let p="";s<2&&i>0?p="coords":p=t.shapeInfo.logicalShape.map((b,S)=>`coords.${d[S+c]}`).join(", ");let f="return outputValue;",h=w.sizeFromShape(t.shapeInfo.logicalShape)===1,x=w.sizeFromShape(n.logicalShape)===1;if(i===1&&!h&&!x)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!x)s===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){let b=i-2,S=i-1;a.indexOf(b)>-1&&a.indexOf(S)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${f}
    }
  `}function Rge(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&w.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=Ge(l),u=KW(t.shapeInfo.logicalShape,n.logicalShape),d=l-a,p,f=["x","y","z","w","u","v"];a===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(h=>`coords.${f[h+d]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${m});
    }
  `}function Ge(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Um(t,n){let e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function jm(t,n){return n.map(e=>t[e]).join(", ")}function JW(t,n,e,r){let o=n.userCode,i=e.map((f,m)=>{let h={logicalShape:f.shape,texShape:f.isUniform?null:f.texData.texShape,isUniform:f.isUniform,isPacked:f.isUniform?!1:f.texData.isPacked,flatOffset:null};return f.texData!=null&&f.texData.slice!=null&&f.texData.slice.flatOffset>0&&(h.flatOffset=f.texData.slice.flatOffset),{name:n.variableNames[m],shapeInfo:h}}),s=i.map(f=>f.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=XW(i,a,o,n.packedInputs),c=t.createProgram(l),u=null,d=t.getUniformLocation(c,"NAN",!1);H().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(c,"INFINITY",!1));let p={};for(let f=0;f<n.variableNames.length;f++){let m=n.variableNames[f],h=!1;p[m]=t.getUniformLocation(c,m,h),p[`offset${m}`]=t.getUniformLocation(c,`offset${m}`,h)}return{program:n,source:l,webGLProgram:c,uniformLocations:p,inShapeInfos:s,outShapeInfo:a,infLoc:u,nanLoc:d}}function ZW(t,n){if(t.length!==n.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${n.length} inputs`);t.forEach((e,r)=>{let o=e.logicalShape,i=n[r],s=i.shape;if(!w.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!w.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function eH(t,n,e,r,o){ZW(n.inShapeInfos,e),ZW([n.outShapeInfo],[r]);let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,s[0],s[1]):t.setOutputMatrixTexture(i,s[0],s[1]),t.setProgram(n.webGLProgram),H().getNumber("WEBGL_VERSION")===1&&n.infLoc!==null&&t.gl.uniform1f(n.infLoc,1/0),n.nanLoc!==null&&t.gl.uniform1f(n.nanLoc,NaN),e.forEach((a,l)=>{let c=n.program.variableNames[l],u=n.uniformLocations[c],d=n.uniformLocations[`offset${c}`];if(u!=null){if(a.isUniform){if(w.sizeFromShape(a.shape)<2)t.gl.uniform1f(u,a.uniformValues[0]);else{let p=a.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}return}a.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,a.texData.slice.flatOffset),t.setInputMatrixTexture(a.texData.texture,u,l)}}),o?.(t,n.webGLProgram),t.executeProgram()}function tH(t,n,e){let r="";n.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0,l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`});let o=t.userCode,i=t.constructor.name;return i+="_"+r+"_"+o,i}var{addImpl:nH,bincountImpl:SC,bincountReduceImpl:rH,ceilImpl:oH,concatImpl:iH,expImpl:sH,expm1Impl:aH,floorImpl:lH,gatherV2Impl:cH,greaterImpl:uH,lessImpl:dH,linSpaceImpl:pH,logImpl:fH,maxImpl:mH,maximumImpl:hH,minimumImpl:gH,multiplyImpl:yH,negImpl:xH,prodImpl:vH,rangeImpl:bH,rsqrtImpl:wH,simpleAbsImpl:EC,sliceImpl:CH,sparseFillEmptyRowsImpl:_H,sparseReshapeImpl:SH,stridedSliceImpl:EH,subImpl:IH,tileImpl:TH,topKImpl:DH,transposeImpl:qd,uniqueImpl:NH}=tk;function Fk(t,n){return["x","y","z","w","u","v"].slice(0,n).map(e=>`${t}.${e}`)}function cn(t,n){return n===1?[t]:Fk(t,n)}function kH(t,n){if(t===1)return"rc";let e="";for(let r=0;r<t;r++)e+=n[r],r<t-1&&(e+=",");return e}var IC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;let e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=cn("rc",e),o=Ge(e),i=Pge(e,n,r),s=$ge(e,n[n.length-1],n[n.length-2],r),a=Lge(n,r);this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${a}));
          }
        }
      `}}};function Fge(t,n){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<t;s++)i=`${n[n.length-1-s]},`+i;e.push(i)}return e}function Pge(t,n,e){if(t===1)return`rc > ${n[0]}`;let r="";for(let o=t-2;o<t;o++)r+=`${e[o]} >= ${n[o]}`,o<t-1&&(r+="||");return r}function $ge(t,n,e,r){if(t===1)return"";let o=r.slice(-2);return`
    int r = ${o[0]};
    int c = ${o[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${n};
    bool rEdge = rp1 >= ${e};
  `}function Lge(t,n){let e=t.length,r=Fge(e,n);return e===1?`getA(rc),
            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${r[0]}),
          cEdge ? 0. : getA(${r[1]}),
          rEdge ? 0. : getA(${r[2]}),
          rEdge || cEdge ? 0. : getA(${r[3]})`}var Gm=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${Vge(e)}
      ${Lm(n)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${n[1]};
        int cols = ${n[2]};

        ${r}

        setOutput(result);
      }
    `}};function Vge(t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${Ui(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var TC=class{constructor(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(n,e,r){let o=RH(e,r),i=OH(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=AH(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].shift();return this.usedTextures[i].push(l),l}let a;return o===nr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===nr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===nr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===nr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===nr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(n,e,r,o){if(this.freeTextures==null)return;let i=RH(r,o),s=OH(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=AH(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=H().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(n),this._numBytesAllocated-=a):(this.freeTextures[s].push(n),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[s],u=c.indexOf(n);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(u,1),this.log()}log(){if(!this.logEnabled)return;let n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${n})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let n in this.freeTextures)this.freeTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(let n in this.usedTextures)this.usedTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function Bge(t,n){let e=t;if(n===e.R32F)return 4;if(n===e.R16F)return 2;if(n===e.RGBA32F)return 16;if(n===t.RGBA)return 16;if(n===e.RGBA16F)return 8;throw new Error(`Unknown internal format ${n}`)}function AH(t,n,e,r,o){let i=zge(n,r),s;if(o){let[l,c]=bs(t[0],t[1]);s=l*c}else{let[l,c]=Gd(t[0],t[1]);s=l*c}let a=Bge(e,i);return s*a}function zge(t,n){switch(t){case nr.PACKED_2X2_FLOAT32:return Ok(n);case nr.PACKED_2X2_FLOAT16:return Mk(n);case nr.UNPACKED_FLOAT32:return kk(n);case nr.UNPACKED_FLOAT16:return Ak(n);case nr.PACKED_4X1_UNSIGNED_BYTE:return Rk(n);default:throw new Error(`Unknown physical texture type ${t}`)}}function Uge(t){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?nr.PACKED_2X2_FLOAT32:nr.UNPACKED_FLOAT32:t?nr.PACKED_2X2_FLOAT16:nr.UNPACKED_FLOAT16}function RH(t,n){if(t===fr.UPLOAD)return nr.PACKED_2X2_FLOAT32;if(t===fr.RENDER||t==null)return Uge(n);if(t===fr.DOWNLOAD||t===fr.PIXELS)return nr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function OH(t,n,e){return`${t[0]}_${t[1]}_${n}_${e}`}var Ir=class{constructor(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Fn="if (isnan(x)) return x;",MH="return x;",Pk="return abs(x);";var FH="return (x >= 0.0) ? x : (exp(x) - 1.0);",PH=Fn+`
  return (x < 0.0) ? 0.0 : x;
`,$H=Fn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Fy="return x;",LH="return 1.0 / (1.0 + exp(-1.0 * x));";var BH="return x;",zH=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,UH=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,jH=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,GH="return 1.0 / (1.0 + exp(-1.0 * x));",di=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var DC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;let e=n.length,r=cn("rc",e),o=Ge(e),i=kH(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Gge=Jn.whereImpl,Wge=1e-7,Hge=1e-4,NC={};function qge(t){return t in NC||(NC[t]={}),NC[t]}var Kge=128,Xge=600;function Yge(){return H().global.screen==null?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*Xge/1024/1024}var WH=(()=>{class t extends Js{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){let r=So(H().getNumber("WEBGL_VERSION"));this.binaryCache=qge(H().getNumber("WEBGL_VERSION")),this.gpgpu=new _C(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new TC(this.gpgpu),this.numMBBeforeWarning=Yge(),this.texData=new Hu(this,Ka())}nextDataId(){return t.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,r,o){if((H().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||H().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:fr.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(H().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:fr.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:c}=r;if(a!=null){let f;c?f=new di(l,Fy):f=new Ir(l,Fy);let m=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),h=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),h}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let u=this.activeTimers!=null,d;u&&(d=w.now());let p;if(i==="complex64"){let f=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,m)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=w.now()-d),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let h=this.pendingRead.get(e);return new Promise(g=>h.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:c}=r;if(s!=null){let h;c?h=new di(i,Fy):h=new Ir(i,Fy);let g=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:a}],a),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(o!=null)return this.convertAndCacheOnCPU(e);if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&H().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(a!=="complex64"&&H().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);let h=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(h.texture,...Qc(i))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){let h=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=h[0],x=h[1];p=T.mergeRealAndImagArrays(g,x)}else if(u==null)p=this.getValuesFromTexture(e);else{let h=w.sizeFromShape(i);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,h)}d!=null&&this.disposeIntermediateTensorInfo(d);let f=this.convertAndCacheOnCPU(e,p),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(h=>h(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ka().removeDataId(e,this),this.pendingDeletes--),f}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>w.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ee(e.shape,e.dtype,o)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!pW(o))throw H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=w.sizeFromShape(r);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),m=this.texData.get(f.dataId),h=this.gpgpu.downloadMatrixFromPackedTexture(m.texture,...Qc(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),h}let a=H().getBool("WEBGL_PACK")&&i===!0,l=a?mC(r):r,c=a?new bC(l):new vC(l),u=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=w.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=w.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=await Promise.all(s);l.kernelMs=w.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:w.now(),endMs:null}}endTimer(e){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=w.now(),e)}async getQueryTime(e){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=Kge){return H().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&w.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Gge(e.shape,r)}packedUnaryOp(e,r,o){let i=new di(e.shape,r),s=this.compileAndRun(i,[e],o);return Ka().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=EC(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Pk,e.dtype);let r=new Ir(e.shape,Pk),o=this.compileAndRun(r,[e]);return Ka().makeTensorFromDataId(o.dataId,o.shape,o.dtype)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&w.isString(o[0])){let s=o.map(a=>w.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){let{dataId:i}=this.makeTensorInfo(e,r,o);return Ka().makeTensorFromDataId(i,e,r,this)}unpackTensor(e){let r=new DC(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new IC(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[Zc(e.shape),...Jc(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[Zc(r),...Jc(r)],a=new Gm(s,o),c=this.runWebGLProgram(a,[i],e.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}}decode(e){let r=this.texData.get(e),{isPacked:o,shape:i,dtype:s}=r,a=mC(i),l;o?l=new xC(a):l=new yC(a);let u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],s,null,!0);return{dtype:s,shape:i,dataId:u.dataId}}runWebGLProgram(e,r,o,i,s=!1){let a=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===jd.DENSE){let x=Qc(e.outputShape);l.texShape=x.map(b=>b*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),w.sizeFromShape(a.shape)===0)return l.values=w.getTypedArrayFromDType(a.dtype,0),a;let c=[],u=r.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!e.packedInputs&&w.sizeFromShape(x.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}else if(!!b.isPacked!=!!e.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),c.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!Wd(b.shape,x.shape)){let S=x,_=x.shape;x.shape=b.shape,x=this.packedReshape(x,_),c.push(x),b=this.texData.get(x.dataId),S.shape=_}return this.uploadToGPU(x.dataId),{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);let d={shape:a.shape,texData:l,isUniform:!1},p=tH(e,u,d),f=this.getAndSaveBinary(p,()=>JW(this.gpgpu,e,u,d)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),eH(this.gpgpu,f,u,d,i),c.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let g=H().get("WEBGL_FLUSH_THRESHOLD");if(g>0){let x=w.now();x-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!H().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let x=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),x}return a}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(H().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=z(()=>{if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=H().getBool("DEBUG");H().set("DEBUG",!1);let r=this.abs(Ae(1e-8)).dataSync()[0];if(H().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Wge:Hge}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:c}=r;if(a!=null)return;let u=this.activeTimers!=null,d;u&&(d=w.now());let p=r.texShape;if(p==null&&(p=EW(o,c),r.texShape=p),s!=null){let f=mC(o),m,h=p[1],g=p[0],x=s instanceof Uint8Array;c?([h,g]=bs(p[0],p[1]),m=new CC(f,[g,h],x)):m=new wC(f,[g,h],x);let b=this.makeTensorInfo([g,h],i);x?this.texData.get(b.dataId).usage=fr.PIXELS:this.texData.get(b.dataId).usage=fr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),h,g,s);let _=this.runWebGLProgram(m,[b],i,null,!0),E=this.texData.get(_.dataId);r.texture=E.texture,r.texShape=E.texShape,r.isPacked=E.isPacked,r.usage=E.usage,this.disposeIntermediateTensorInfo(b),this.texData.delete(_.dataId),r.values=null,u&&(this.uploadWaitMs+=w.now()-d)}else{let f=this.acquireTexture(p,l,i,c);r.texture=f}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return this.releaseGPUData(e),r!=null&&(o.values=Qge(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*w.bytesPerElement(r)}}return t.nextDataId=0,t})();function Qge(t,n){if(n==="float32"||n==="complex64")return t;if(n==="int32"||n==="bool"){let e=n==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<e.length;++r)e[r]=Math.round(t[r]);return e}else throw new Error(`Unknown dtype ${n}`)}Mc.isBrowser()&&Lb("webgl",()=>new WH,2);var kC=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var Io=class{constructor(n,e,r){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOperation(float a, float b) {
        ${n}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var eu=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;var pi=class{constructor(n,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length,s="";if(o)if(i===0||w.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${Ge(i)} coords = getOutputCoords();
        `,i===1)s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=cn("coords",i);s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${n}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function un(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var HH={kernelName:ls,backendName:"webgl",kernelFunc:un};function Vr(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=un({inputs:{x:r},backend:e}),l=un({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var qH={kernelName:_f,backendName:"webgl",kernelFunc:Vr};var $k="return (a < 0.) ? b * a : a;",Lk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Zge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r,s=e.makeTensorInfo([],"float32",w.createScalarValue(i,"float32")),a=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pi(Lk,o.shape,s.shape):new Io($k,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],o.dtype);return e.disposeIntermediateTensorInfo(s),l}var KH={kernelName:sc,backendName:"webgl",kernelFunc:Zge};var Vk="return (a < 0.) ? b * a : a;",Bk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Jge(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pi(Bk,r.shape,o.shape):new Io(Vk,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)}var XH={kernelName:vc,backendName:"webgl",kernelFunc:Jge};var AC="if (isnan(x)) return x;",YH=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,QH=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function Ce({opSnippet:t,packedOpSnippet:n,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let d=a.texData.get(s.dataId),p=e(d.values,l);return a.makeTensorInfo(s.shape,l,p)}let c=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&n!=null,u;return c?u=new di(s.shape,n):u=new Ir(s.shape,t),a.runWebGLProgram(u,[s],l)}}function vt({opSnippet:t,packedOpSnippet:n,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:c}=s,u=a;if(r&&l.dtype==="complex64"){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,x]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(S=>{let[_,E]=S,I={dataId:_.dataId,dtype:_.dtype,shape:l.shape},D={dataId:E.dataId,dtype:E.dtype,shape:c.shape},O=new Io(t,l.shape,c.shape);return u.runWebGLProgram(O,[I,D],_n(_.dtype,E.dtype))}),b=Vr({inputs:{real:g,imag:x},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(x),b}let d=i||_n(l.dtype,c.dtype);if(u.shouldExecuteOnCPU([l,c])&&o!=null){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,x]=o(l.shape,c.shape,m.values,h.values,d),b=u.makeTensorInfo(x,d),S=u.texData.get(b.dataId);return S.values=g,b}let p=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&n!=null,f;return p?f=new pi(n,l.shape,c.shape,e):f=new Io(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function tu(t,n=!1){if(t==="linear")return n?BH:MH;if(t==="relu")return n?UH:PH;if(t==="elu")return n?zH:FH;if(t==="relu6")return n?jH:$H;if(t==="prelu")return n?Bk:Vk;if(t==="leakyrelu")return n?Lk:$k;if(t==="sigmoid")return n?GH:LH;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var Wm=class{constructor(n,e,r,o=!1,i=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;let u=o?n[1]:n[2],d=Math.ceil(u/2),p=o?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",x="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,x="result = activation(result);");let b=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let S="rc.x",_="rc.x";n[0]<e[0]?S=`int(min(float(rc.x), ${n[0]-1}.))`:e[0]<n[0]&&(_=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`
      ${g}

      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${d}; i++) {
          int batchA = ${S};
          int batchB = ${_};
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${x}

        setOutput(result);
      }
    `}};var zk={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},Py=class{constructor(n,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${n}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var ZH="return a * b;";function $y(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=T.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),c=new Py(zk.REAL,r.shape,o.shape),u=new Py(zk.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Vr({inputs:{real:p,imag:f},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[c,u]=yH(r.shape,o.shape,a.values,l.values,i),d=e.makeTensorInfo(u,i),p=e.texData.get(d.dataId);return p.values=c,d}let s;return H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new pi(ZH,r.shape,o.shape):s=new Io(ZH,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var JH={kernelName:Ta,backendName:"webgl",kernelFunc:$y};function eq(t,n,e){let r=[Zc(t.shape),...Jc(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},i=[Zc(n),...Jc(n)],s=new Gm(i,r),l=e.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}}function ae(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=e,a=w.sizeFromShape(o.shape),l=w.inferFromImplicitShape(i,a),c=w.sizeFromShape(l);w.assert(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=s.texData.get(o.dataId);return u.isPacked&&!Wd(o.shape,l)&&!(u.texture!==null&&Wd(u.shape,l))?eq(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var tq={kernelName:bc,backendName:"webgl",kernelFunc:ae};var Ly=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,c="sumValue += dot(values, ones);";if(e!=null){let d=1/e;c=`sumValue += dot(values * ${w.isInt(d)?d.toPrecision(2):d}, ones);`}let u="";i%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var RC=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let u=Math.floor(r/4)*4,d=r%4,p=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function tye(t){let n=[];for(;n.length===0||n[n.length-1].outSize!==1;){let e=n.length?n[n.length-1].outSize:t[1],r=T.computeOptimalWindowSize(e);n.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return n}function oo(t,n,e,r){let o=tye(t.shape),i=t;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:c}=o[s],u,d;e==="mean"?u=s===0?new Ly({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new Ly({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new RC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},e),d=i,i=r.runWebGLProgram(u,[i],n),d.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(d)}return i}var OC=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[e[s]];this.outputShape=r,this.rank=r.length;let o=Ge(this.rank),i=nye(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function nye(t){let n=t.length;if(n>6)throw Error(`Transpose for rank ${n} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(n);for(let o=0;o<t.length;o++)r[t[o]]=e[o];return r.join()}var MC=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(n.length);for(let u=0;u<r.length;u++)r[u]=n[e[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=Ge(this.rank),i=Fk("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function nu(t,n,e){let r=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MC(t.shape,n):new OC(t.shape,n);return e.runWebGLProgram(r,[t],t.dtype)}function nq(t,n,e,r){let o=n,i=t.shape.length,s=w.parseAxisParam(o,t.shape),a=s,l=T.getAxesPermutation(a,i),c=l!=null,u=t;c&&(u=nu(t,l,r),a=T.getInnerMostAxes(a.length,i)),T.assertAxesAreInnerMostDims("sum",a,i);let[d,p]=T.computeOutAndReduceShapes(u.shape,a),f=d;e&&(f=T.expandShapeToKeepDim(d,s));let m=w.sizeFromShape(p),g=w.sizeFromShape(t.shape)/m,x=ae({inputs:{x:u},attrs:{shape:[g,m]},backend:r}),b=ad(t.dtype),S=oo(x,b,"sum",r),_=ae({inputs:{x:S},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(S),c&&r.disposeIntermediateTensorInfo(u),_}function Kd(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;return nq(o,i,s,e)}var rq={kernelName:Ic,backendName:"webgl",kernelFunc:Kd};function Ht(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];let c;if(s.shouldExecuteOnCPU([o])){let d=s.texData.get(o.dataId).values,p=qd(d,o.shape,o.dtype,i,l);c=s.makeTensorInfo(l,o.dtype);let f=s.texData.get(c.dataId);f.values=p}else c=nu(o,i,s);return c}var oq={kernelName:kc,backendName:"webgl",kernelFunc:Ht};var Uk=1e3;function Xd({a:t,b:n,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=t.shape.length,u=n.shape.length,d=e?t.shape[c-2]:t.shape[c-1],p=r?n.shape[u-1]:n.shape[u-2],f=e?t.shape[c-1]:t.shape[c-2],m=r?n.shape[u-2]:n.shape[u-1],h=t.shape.slice(0,-2),g=n.shape.slice(0,-2),x=w.sizeFromShape(h),b=w.sizeFromShape(g),S=x===b||x===1||b===1;w.assert(c>=2&&u>=2&&S,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${h}) and (${g}).`);let E=(x>b?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([f,m]);w.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${t.shape} and ${n.shape} and transposeA=${e} and transposeB=${r} must match.`);let I=e?[x,d,f]:[x,f,d],D=r?[b,m,p]:[b,p,m],O=ae({inputs:{x:t},backend:o,attrs:{shape:I}}),R=ae({inputs:{x:n},backend:o,attrs:{shape:D}}),$=[O,R],G=Math.max(x,b),W=e?O.shape[1]:O.shape[2],q=i!=null,X=s!=null,K=l==="leakyrelu",Y=l!=null?tu(l,!0):null,re=q||X||K||Y!=null,J;if((f===1||m===1)&&W>Uk&&re===!1){let se=O,ue=R;e&&(se=Ht({inputs:{x:O},backend:o,attrs:{perm:[0,2,1]}}),$.push(se)),r&&(ue=Ht({inputs:{x:R},backend:o,attrs:{perm:[0,2,1]}}),$.push(ue));let fe=m!==1,de=m===1,xe=se;fe&&(xe=ae({inputs:{x:se},backend:o,attrs:{shape:[G,W,1]}}),$.push(xe));let ve=m===1?2:1,be=ue;de&&(be=ae({inputs:{x:ue},backend:o,attrs:{shape:[G,1,W]}}),$.push(be));let Te=$y({inputs:{a:xe,b:be},backend:o});J=Kd({inputs:{x:Te},backend:o,attrs:{axis:ve,keepDims:!0}}),$.push(Te)}else{let se=_n(t.dtype,n.dtype),ue=new Wm(I,D,[G,f,m],e,r,q,Y,X,K),fe=[O,R];if(i!=null&&fe.push(i),X&&fe.push(s),K){let de=o.makeTensorInfo([],"float32",w.createScalarValue(a,"float32"));fe.push(de),$.push(de)}J=o.runWebGLProgram(ue,fe,se)}let ne=ae({inputs:{x:J},backend:o,attrs:{shape:E}});$.push(J);for(let se of $)o.disposeIntermediateTensorInfo(se);return ne}function rye(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return Xd({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var iq={kernelName:rd,backendName:"webgl",kernelFunc:rye};var sq="return abs(x);";function oye(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=EC(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new di(r.shape,sq):o=new Ir(r.shape,sq),e.runWebGLProgram(o,[r],r.dtype)}var aq={kernelName:Ul,backendName:"webgl",kernelFunc:oye};var iye=Fn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,sye=Ce({opSnippet:iye}),lq={kernelName:ea,backendName:"webgl",kernelFunc:sye};var aye=Fn+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,lye=Ce({opSnippet:aye}),cq={kernelName:ta,backendName:"webgl",kernelFunc:lye};var uq="return a + b;",cye=vt({opSnippet:uq,packedOpSnippet:uq,supportsComplex:!0,cpuKernelImpl:nH}),dq={kernelName:Ni,backendName:"webgl",kernelFunc:cye};var FC=class{constructor(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var PC=class{constructor(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function $C(t){let{inputs:n,backend:e}=t,r=n;if(r.length===1)return un({inputs:{x:r[0]},backend:e});if(r.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=$C({inputs:r.slice(0,l),backend:e}),u=$C({inputs:r.slice(l),backend:e});return $C({inputs:[c,u],backend:e})}let o=r.map(l=>l.dtype).reduce((l,c)=>_n(l,c)),i=r.map(l=>l.shape),a=H().getBool("WEBGL_PACK")?new PC(r[0].shape,i):new FC(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var pq={kernelName:xf,backendName:"webgl",kernelFunc:$C};function uye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("all",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=w.sizeFromShape(f),h=ae({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=oo(h,h.dtype,"all",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=ae({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=ae({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var fq={kernelName:vf,backendName:"webgl",kernelFunc:uye};function dye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("any",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=w.sizeFromShape(f),h=ae({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=oo(h,h.dtype,"any",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=ae({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=ae({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var mq={kernelName:bf,backendName:"webgl",kernelFunc:dye};var LC=class{constructor(n,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=n;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var VC=class{constructor(n,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,w.assert(n.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,c=Ge(l),u=cn("coords",l),d,p;if(s===1){p=l+1;let O=Ge(p);d=`
        ${O} sourceLocR = ${O}(${u.join()}, 0);
        ++${u[l-1]};
        ${O} sourceLocG = ${O}(${u.join()}, 0);
        ++${u[l-2]};
        ${O} sourceLocA = ${O}(${u.join()}, 0);
        --${u[l-1]};
        ${O} sourceLocB = ${O}(${u.join()}, 0);
        --${u[l-2]};`}else p=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;let f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],h=f.map(O=>"int "+O),g=cn("sourceLocR",p-1).concat("inIdx.r"),x=cn("sourceLocG",p-1).concat("inIdx.g"),b=cn("sourceLocB",p-1).concat("inIdx.b"),S=cn("sourceLocA",p-1).concat("inIdx.a"),_=r==="max"?"greaterThan":"lessThan",E=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${S.join()})));`,I=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,D=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${I};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${E}
          vec4 candidate = ${I};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${_}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function hq(t,n,e,r=null){let o=n.shape[0],i=n.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=T.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new LC(a,e,r==null),c=[n];r!=null&&c.push(r);let u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;let d=hq(t,n,e,u);return t.disposeIntermediateTensorInfo(u),d}function gq(t,n,e,r=null){let o=r!=null?r.shape:n.shape,i=o[o.length-1],s=T.computeOptimalWindowSize(i),a=new VC(o,s,e,r==null),l=r==null?[n]:[n,r],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===n.shape.length){let u=gq(t,n,e,c);return t.disposeIntermediateTensorInfo(c),u}return c}function BC(t,n,e,r){let o=[e];if(T.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,n.shape.length),!H().getBool("WEBGL_PACK_REDUCE")||n.shape.length<=2){let i=[],[s,a]=T.computeOutAndReduceShapes(n.shape,o),l=w.sizeFromShape(a),c=ae({inputs:{x:n},backend:t,attrs:{shape:[-1,l]}});i.push(c);let u=hq(t,c,r);i.push(u);let d=ae({inputs:{x:u},backend:t,attrs:{shape:s}});return i.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}return gq(t,n,r)}function pye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Ht({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=BC(e,l,s[0],"max");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var yq={kernelName:jl,backendName:"webgl",kernelFunc:pye};function fye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Ht({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=BC(e,l,s[0],"min");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var xq={kernelName:Gl,backendName:"webgl",kernelFunc:fye};var mye=Fn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,hye=Ce({opSnippet:mye}),vq={kernelName:na,backendName:"webgl",kernelFunc:hye};var gye=Fn+"return log(x + sqrt(x * x + 1.0));",yye=Ce({opSnippet:gye}),bq={kernelName:ra,backendName:"webgl",kernelFunc:yye};var xye=Fn+`
  return atan(x);
`,vye=Ce({opSnippet:xye}),wq={kernelName:oa,backendName:"webgl",kernelFunc:vye};var bye=YH+`
  return atan(a, b);
`,wye=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+QH+`
  return result;
`,Cye=vt({opSnippet:bye,packedOpSnippet:wye}),Cq={kernelName:sa,backendName:"webgl",kernelFunc:Cye};var _ye=Fn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,Sye=Ce({opSnippet:_ye}),_q={kernelName:ia,backendName:"webgl",kernelFunc:Sye};var ji=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;let h=e==="avg",g=`((batch  * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + d`,x=`(xR * ${n.inWidth} + xC) * ${n.inChannels} + d`,b="0.0";if(h||(b="-1.0 / 1e-20"),r){let O=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${O} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:x:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let S="max",_=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(_="avgValue / count");let E=Math.floor(s/4)*4,I=s%4,D=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${E}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${E};
          if (${I===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${I===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${I===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${_});
      }
    `}},ru=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideDepth,l=n.strideHeight,c=n.strideWidth,u=n.dilationDepth,d=n.dilationHeight,p=n.dilationWidth,f=n.effectiveFilterDepth,m=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.front,x=n.padInfo.top,b=n.padInfo.left;this.outputShape=n.outShape;let S=e==="avg",_="0.0";if(S||(_="-1.0 / 1e-20"),r){let $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${x}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${n.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${n.inDepth} + xD) * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`((xD * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let E="max",I=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(I="avgValue / count");let D=Math.floor(s/4)*4,O=s%4,R=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${E}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${x}, ${b});
      const float initializationValue = ${_};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${_});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${D};
            if (${O===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${O===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${O===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${R}
            }
          }
          setOutput(${I});
        }
      }
    `}};function Eye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;ws(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))return un({inputs:{x:o},backend:e});let d=new ji(u,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}var Sq={kernelName:Wl,backendName:"webgl",kernelFunc:Eye};function Iye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,l,c),p=new ru(d,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var Eq={kernelName:Hl,backendName:"webgl",kernelFunc:Iye};var zC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=l-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},UC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,h=p-1-n.padInfo.top,g=f-1-n.padInfo.left,x=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Tye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new UC(p);return e.runWebGLProgram(f,[o],s.dtype)}var Iq={kernelName:Cf,backendName:"webgl",kernelFunc:Tye};function Dye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;ws([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=new zC(u);return e.runWebGLProgram(d,[o],s.dtype)}var Tq={kernelName:wf,backendName:"webgl",kernelFunc:Dye};function Nye(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;return Xd({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var Dq={kernelName:ql,backendName:"webgl",kernelFunc:Nye};var jC=class{constructor(n,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var GC=class{constructor(n,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var kye=({inputs:t,backend:n,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=t;w.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let c=[r,o,i],u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));let p=H().getBool("WEBGL_PACK_NORMALIZATION")?new GC(r.shape,o.shape,i.shape,u,d,l):new jC(r.shape,o.shape,i.shape,u,d,l);return n.runWebGLProgram(p,c,c[0].dtype)},Nq={kernelName:oc,backendName:"webgl",kernelFunc:kye};var WC=class{constructor(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;let e=Ge(this.rank),r=`uniform int start[${this.rank}];`,o=Aye(this.rank),i,s=n.map((a,l)=>`sourceLoc.${jk[l]} = start[${l}] + coords.${jk[l]};`);i=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      ${r}
      void main() {
        ${i}
        setOutput(getSource(${o}));
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}},jk=["x","y","z","w","u","v"];function Aye(t){if(t===1)return"sourceLoc";if(t<=6)return jk.slice(0,t).map(n=>"sourceLoc."+n).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var HC=class{constructor(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;let e=Ge(this.rank),r=cn("coords",this.rank),o=cn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${n[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${n.map((u,d)=>`start[${d}]`).join()});`:n.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}};function Rye(t,n,e,r){let o=r.texData.get(t.dataId),i=r.makeTensorInfo(e,t.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=t.dtype;let a=Xn.computeFlatOffset(n,w.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function pl(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r,[a,l]=Xn.parseSliceParams(o,i,s);if(Xn.assertParamsValid(o,a,l),w.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.texData.get(o.dataId),p=CH(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}let{isPacked:c}=e.texData.get(o.dataId),u=Xn.isSliceContinous(o.shape,a,l);if(c||!u){let d=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new HC(l):new WC(l),p=d.getCustomSetupFunc(a);return e.runWebGLProgram(d,[o],o.dtype,p)}return e.uploadToGPU(o.dataId),Rye(o,a,l,e)}var kq={kernelName:Ec,backendName:"webgl",kernelFunc:pl};var Oye=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;w.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((b,S)=>b*S),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=[],m=ae({inputs:{x:o},backend:e,attrs:{shape:l}}),h=Ht({inputs:{x:m},backend:e,attrs:{perm:c}}),g=ae({inputs:{x:h},backend:e,attrs:{shape:u}}),x=pl({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(m),f.push(h),f.push(g),f.forEach(b=>e.disposeIntermediateTensorInfo(b)),x},Aq={kernelName:Kl,backendName:"webgl",kernelFunc:Oye};function Mye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),c=SC(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var Rq={kernelName:rb,backendName:"webgl",kernelFunc:Mye};var Fye="return float(a != b);",Gk=vt({opSnippet:Fye,dtype:"bool"}),Oq={kernelName:nd,backendName:"webgl",kernelFunc:Gk};function fl(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return un({inputs:{x:o.complexTensorInfos.real},backend:e})}var Mq={kernelName:Bf,backendName:"webgl",kernelFunc:fl};var Pye="return float(int(x));";function Fq(t,n){let e=new Ir(t.shape,Pye),r=n.runWebGLProgram(e,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function Wk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return un({inputs:{x:o},backend:e});let s=zt(o.shape),a=Wk({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Vr({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=fl({inputs:{input:o},backend:e}),a=Wk({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!w.hasEncodingLoss(o.dtype,i)){let s=un({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32")return Fq(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",w.getTypedArrayFromDType("bool",1)),l=Gk({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var Pq={kernelName:as,backendName:"webgl",kernelFunc:Wk};var $q="return ceil(x);",$ye=Ce({opSnippet:$q,packedOpSnippet:$q,cpuKernelImpl:oH}),Lq={kernelName:aa,backendName:"webgl",kernelFunc:$ye};var qC=class{constructor(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};var KC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};function Lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{clipValueMin:i,clipValueMax:s}=r,a;H().getBool("WEBGL_PACK_CLIP")?a=new KC(o.shape):a=new qC(o.shape);let l=a.getCustomSetupFunc(i,s);return e.runWebGLProgram(a,[o],o.dtype,l)}var Vq={kernelName:la,backendName:"webgl",kernelFunc:Lye};var XC=class{constructor(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function Bq(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}}function Vye(t){let{inputs:n,backend:e}=t,{x:r}=n,o=e.texData.get(r.dataId),i=new XC(r.shape),s=[Bq(r,o.complexTensorInfos.real),Bq(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var zq={kernelName:Xl,backendName:"webgl",kernelFunc:Vye};var YC=class{constructor(n){this.outputShape=[],this.outputShape=T.computeOutShape(n,1),this.variableNames=n.map((s,a)=>`T${a}`);let e=new Array(n.length-1);e[0]=n[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+n[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var ZC=class{constructor(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(n,e);let r=this.outputShape,o=r.length,i=Ge(o),s=cn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=n.map((h,g)=>`T${g}`);let l=new Array(n.length-1);l[0]=n[0][e];for(let h=1;h<l.length;h++)l[h]=l[h-1]+n[h][e];let c=a[e],u=a.slice(-2),d=a.join(),p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let h=1;h<l.length;h++){let g=l[h-1];p+=`
        if (${c} < ${l[h]}  && ${c} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${QC(a,c,g)}),
            vec2(${QC(u,c,g)}));
        }`}let f=l.length,m=l[l.length-1];p+=`
        return getChannel(
          getT${f}(${QC(a,c,m)}),
          vec2(${QC(u,c,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function QC(t,n,e){let r=t.indexOf(n);return t.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function Yd(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return un({inputs:{x:o.complexTensorInfos.imag},backend:e})}var Uq={kernelName:Mf,backendName:"webgl",kernelFunc:Yd};function Qd(t,n,e){let r=t[0].dtype;if(r==="complex64"){let u=t.map(h=>fl({inputs:{input:h},backend:e})),d=t.map(h=>Yd({inputs:{input:h},backend:e})),p=Qd(u,n,e),f=Qd(d,n,e),m=Vr({inputs:{real:p,imag:f},backend:e});return u.forEach(h=>e.disposeIntermediateTensorInfo(h)),d.forEach(h=>e.disposeIntermediateTensorInfo(h)),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}let o=e.shouldExecuteOnCPU(t);if(r==="string"&&(o=!0),o){let u=t.map(x=>{let S=[-1,w.sizeFromShape(x.shape.slice(n))];return ae({inputs:{x},backend:e,attrs:{shape:S}})}),d=u.map(x=>({vals:e.readSync(x.dataId),shape:x.shape})),p=T.computeOutShape(u.map(x=>x.shape),1),f=u[0].shape[0]===1,m=iH(d,p,r,f),h=T.computeOutShape(t.map(x=>x.shape),n),g=e.makeTensorInfo(h,r,m);return u.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}if(t.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(t.length/2),d=Qd(t.slice(0,u),n,e),p=Qd(t.slice(u),n,e),f=Qd([d,p],n,e);return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),f}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){let u=new ZC(t.map(d=>d.shape),n);return e.runWebGLProgram(u,t,r)}let{tensors2D:i,outShape:s}=Bye(t,n,e),a=new YC(i.map(u=>u.shape)),l=e.runWebGLProgram(a,i,r);i.forEach(u=>e.disposeIntermediateTensorInfo(u));let c=ae({inputs:{x:l},attrs:{shape:s},backend:e});return e.disposeIntermediateTensorInfo(l),c}function Bye(t,n,e){let r=T.computeOutShape(t.map(i=>i.shape),n);return{tensors2D:t.map(i=>ae({inputs:{x:i},attrs:{shape:[-1,w.sizeFromShape(i.shape.slice(n))]},backend:e})),outShape:r}}function Hk(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=w.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(c=>c.shape),i);if(w.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(c=>w.sizeFromShape(c.shape)>0);if(a.length===1)return un({inputs:{x:a[0]},backend:e});let l=a.map(c=>c.shape);return T.assertParamsConsistent(l,i),Qd(a,i,e)}var jq={kernelName:Yl,backendName:"webgl",kernelFunc:Hk};var Hm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4,g=n.dataFormat==="channelsLast",x=g?1:2,b=g?2:3,S=g?3:1,_="",E="";r&&(o?_=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?_=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:_=`
          float activation(float x) {
            ${r}
          }
        `,E="result = activation(result);");let I=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${_}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${n.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${I}
        ${E}
        setOutput(result);
      }
    `}},JC=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let e=n.padInfo.front,r=n.padInfo.top,o=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var e_=class{constructor(n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let{filterWidth:o,inChannels:i,strideWidth:s,strideHeight:a,padInfo:l,outWidth:c,dilationWidth:u,dilationHeight:d,dataFormat:p}=r,{left:f,top:m}=l,h=i*o,g=en(),x=p==="channelsLast",b=x?0:1,S=x?1:2,_="";for(let E=0;E<=1;E++)for(let I=0;I<=1;I++)_+=`
          blockIndex = rc.y + ${I};
          pos = rc.x + ${E};

          if(blockIndex < ${n[1]} && pos < ${n[0]}) {
            offsetY = int(blockIndex / (${c})) * ${a} - ${m};
            d0 = offsetY + ${d} * (pos / ${h});

            if(d0 < ${e[b]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${c}.) * ${s}. - ${f}.);
              d1 = offsetX + ${u} * (int(mod(float(pos), ${h}.) / ${i}.));

              if(d1 < ${e[S]} && d1 >= 0) {

                ch = int(mod(float(pos), ${i}.));

                if (${x}) {
                  innerDims = vec2(d1, ch);
                  result[${E*2+I}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${E*2+I}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${_}

        ${g.output} = result;
      }
    `}};function t_({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=t.shape,c=r.texData.get(t.dataId),u=e.inChannels,d=l[0]*l[1]*l[2],p=e.outChannels,f=e.dataFormat==="channelsLast",m=!1,h=!1,g,x=[],b=(d===1||p===1)&&u>Uk,S=l[2]%2!==0&&!!c.isPacked;if(b||!H().getBool("WEBGL_LAZILY_UNPACK")||!H().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!S){let _=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],E=ae({inputs:{x:t},backend:r,attrs:{shape:[1,_,e.inChannels]}}),I=ae({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=Xd({a:E,b:I,transposeA:m,transposeB:h,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=ae({inputs:{x:D},backend:r,attrs:{shape:e.outShape}}),x.push(E),x.push(I),x.push(D)}else{let _=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),E={dataId:t.dataId,shape:[1,_,e.inChannels],dtype:t.dtype},I=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,w.assert(Wd(c.shape,E.shape),()=>`packed reshape ${c.shape} to ${E.shape} isn't free`);let D=ae({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});x.push(D);let O=Xd({a:E,b:D,backend:r,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),R=r.texData.get(O.dataId);w.assert(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=I,R.shape=e.outShape,g=un({inputs:{x:O},backend:r}),g.shape=e.outShape,x.push(O)}for(let _ of x)r.disposeIntermediateTensorInfo(_);return g}function n_({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:p,dataFormat:f}=e,m=f==="channelsLast",h=l*c*u,g=p*d,x=[h,g],b=!0,S=!1,_=[],E=ae({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),I=ae({inputs:{x:n},backend:r,attrs:{shape:[1,h,w.sizeFromShape(n.shape)/h]}});_.push(E),_.push(I);let D=new e_(x,E.shape,e),O=r.runWebGLProgram(D,[E],"float32"),R=ae({inputs:{x:O},backend:r,attrs:{shape:[1,x[0],x[1]]}});_.push(O),_.push(R);let $=o!=null,G=i!=null,W=a==="leakyrelu",q=a?tu(a,!0):null,X=new Wm(R.shape,I.shape,[1,g,e.outChannels],b,S,$,q,G,W),K=[R,I];if(o&&K.push(o),G&&K.push(i),W){let ne=r.makeTensorInfo([],"float32",w.createScalarValue(s,"float32"));K.push(ne),_.push(ne)}let Y=r.runWebGLProgram(X,K,"float32"),re=m?[1,p,d,e.outChannels]:[1,e.outChannels,p,d],J=ae({inputs:{x:Y},backend:r,attrs:{shape:re}});_.push(Y);for(let ne of _)r.disposeIntermediateTensorInfo(ne);return J}function zye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=t_({x:o,filter:i,convInfo:p,backend:e});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)f=n_({x:o,filter:i,convInfo:p,backend:e});else{let h=new Hm(p);f=e.runWebGLProgram(h,[o,i],"float32")}let m=ae({inputs:{x:f},backend:e,attrs:{shape:p.outShape}});return e.disposeIntermediateTensorInfo(f),m}var Gq={kernelName:Ql,backendName:"webgl",kernelFunc:zye};var r_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              if (${s}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},o_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,l=r-1-n.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${n.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},i_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yF = 0; yF < ${n.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${n.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${n.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${n.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},s_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=e-1-n.padInfo.front,c=r-1-n.padInfo.top,u=o-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${n.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${n.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Uye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new r_(p);return e.runWebGLProgram(f,[o,i],"float32")}var Wq={kernelName:Sf,backendName:"webgl",kernelFunc:Uye};function jye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(c),p=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d),f=new o_(p);return e.runWebGLProgram(f,[o,i],"float32")}var Hq={kernelName:Zl,backendName:"webgl",kernelFunc:jye};function Gye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),u=new JC(c);return e.runWebGLProgram(u,[o,i],"float32")}var qq={kernelName:Jl,backendName:"webgl",kernelFunc:Gye};function Wye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r,c=T.computeConv3DInfo(o.shape,l,s,1,a),u=new i_(c);return e.runWebGLProgram(u,[o,i],"float32")}var Kq={kernelName:Ef,backendName:"webgl",kernelFunc:Wye};function Hye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r,c=T.computeConv3DInfo(l,i.shape,a,1,s),u=new s_(c);return e.runWebGLProgram(u,[o,i],"float32")}var Xq={kernelName:If,backendName:"webgl",kernelFunc:Hye};var qye=AC+`
  return cos(x);
`,Kye=Ce({opSnippet:qye}),Yq={kernelName:ca,backendName:"webgl",kernelFunc:Kye};var Xye=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Yye=Ce({opSnippet:Xye}),Qq={kernelName:ua,backendName:"webgl",kernelFunc:Yye};var a_=class{constructor(n,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,c]=n,[u]=e,[d,p]=r;this.outputShape=[u,d,p,c];let f=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[g,x,b]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[S,_,E]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${_};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${E};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var Qye=t=>{let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,u=new a_(o.shape,i.shape,a,l,c);return e.runWebGLProgram(u,[o,i,s],"float32")},Zq={kernelName:ob,backendName:"webgl",kernelFunc:Qye};var Vy=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=n;let o=n.length,i=e?"0.0":`getX(${Jq(o,"coords")})`,s=n[n.length-1],a="",l="";e?(a=r?`end != ${s-1}`:"end != 0",l=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${s}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${Ge(o)} coords = getOutputCoords();
        int end = ${e5(o,"coords")};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${l};
          ${e5(o,"coords")} = idx;
          val += getX(${Jq(o,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.index==null&&(this.index=e.getUniformLocation(r,"index")),e.gl.uniform1f(this.index,n)}}};function Jq(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.x, ${n}.y`;if(t===3)return`${n}.x, ${n}.y, ${n}.z`;if(t===4)return`${n}.x, ${n}.y, ${n}.z, ${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function e5(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.y`;if(t===3)return`${n}.z`;if(t===4)return`${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Zye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r,l=o.shape.length,c=T.getAxesPermutation([i],l),u=o;c!=null&&(u=Ht({inputs:{x:o},backend:e,attrs:{perm:c}}));let d=T.getInnerMostAxes(1,l)[0];if(d!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${o.shape.length-1} but got axis=${i}`);let p=u.shape[d],f=un({inputs:{x:u},backend:e});for(let m=0;m<=Math.ceil(Math.log2(p))-1;m++){let h=new Vy(u.shape,!1,a),g=h.getCustomSetupFunc(m),x=f;f=e.runWebGLProgram(h,[f],f.dtype,g),e.disposeIntermediateTensorInfo(x)}if(s){let m=new Vy(u.shape,s,a),h=f;f=e.runWebGLProgram(m,[f],f.dtype),e.disposeIntermediateTensorInfo(h)}if(c!=null){let m=T.getUndoAxesPermutation(c),h=Ht({inputs:{x:f},backend:e,attrs:{perm:m}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(u),h}return f}var t5={kernelName:ec,backendName:"webgl",kernelFunc:Zye};function Jye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=SC(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=rH(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var n5={kernelName:ib,backendName:"webgl",kernelFunc:Jye};var l_=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function e0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;w.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),m=s==="NHWC"?[a,d,p,f]:[a,f,d,p],h=new l_(m,i,s);return e.runWebGLProgram(h,[o],o.dtype)}var r5={kernelName:Tf,backendName:"webgl",kernelFunc:e0e};var qm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.inHeight,a=n.inWidth,l=n.padInfo.top,c=n.padInfo.left,u=n.strideHeight,d=n.strideWidth,p=n.dilationHeight,f=n.dilationWidth,m=n.filterHeight,h=n.filterWidth,g=n.outChannels/n.inChannels,x="",b="";r&&(o?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`
          float activation(float x) {
            ${r}
          }
        `,b="result = activation(result);");let S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${u}, ${d});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${g};
        int q = d2 - d1 * ${g};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${s}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${a}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${S}
        ${b}
        setOutput(result);
      }
    `}};var Km=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;let s=n.outChannels/n.inChannels,a=n.inHeight,l=n.inWidth,c=n.padInfo.top,u=n.padInfo.left,d=n.strideHeight,p=n.strideWidth,f=n.dilationHeight,m=n.dilationWidth,h=n.filterHeight,g=n.filterWidth,x=g,b=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let I=0;I<g;I++)b+=`
          vec4 xTexelC${I*2};
          int xTexelC${I*2}Ready;
          vec4 xC${I};`;for(let I=0;I<h;I++){for(let D=0;D<g;D++)b+=`
          xTexelC${D*2} = vec4(0.0);
          xTexelC${D*2}Ready = 0;
          xC${D} = vec4(0.0);`;b+=`
        xR = xRCorner + ${I*f};
        if (xR >=0 && xR < ${a}) {
      `;for(let D=0;D<(x+1)/2;D++){let O=D*2,R=O*m;if(b+=`
          xC = xCCorner + ${R};
          `,p===1){if(O<g&&(u%2===1?(b+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }
              `,m===1&&R>0?b+=`
                xC${O} = vec4(xTexelC${R-2}.zw, xTexelC${R}.xy);
                `:b+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < ${l}) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      previous.zw = vec2(0.0);
                    }

                    xC${O} = vec4(previous.zw, xTexelC${R}.xy);
                  } else {
                    xC${O} = vec4(0.0, 0.0, xTexelC${R}.xy);
                  }
                  `):b+=`
                if (xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xC${O} = xTexelC${R};
                `,R+1<g)){let $=u%2===0?w.nearestLargerEven(m):m;m%2===0&&u%2===1||m%2!==0&&u%2!==1?(b+=`
                  xCOffset = xC + ${u%2} + ${$};

                  if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                    xTexelC${R+2} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      xTexelC${R+2}.zw = vec2(0.0);
                    }
                    xTexelC${R+2}Ready = 1;
                  }
                  `,m>1&&(b+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                      xTexelC${R} = getX(batch, xR, xCOffset, d1);
                      xTexelC${R}Ready = 1;
                    }
                    `),b+=`
                  xC${O+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.xy);
                  `):$===1?b+=`
                    xC${O+1} = xTexelC${R};
                    `:b+=`
                    xCOffset = xC + ${$};

                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                      xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= ${l}) {
                        xTexelC${R+2}.zw = vec2(0.0);
                      }
                      xTexelC${R+2}Ready = 1;
                    }

                    xC${O+1} = xTexelC${R+2};
                    `}}else R<g&&(u%2===1?(b+=`
                xCOffset = xC + 1 - ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.0);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${O} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
              `,R+1<g&&(b+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + ${p};
                  if(xCOffset >= 0 && xCOffset < ${l}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${O+1} = vec4(xTexelC${R+2}.xy, final.xy);
                `)):(b+=`
                if(xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xCOffset = xC + ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${O} = vec4(
                  xTexelC${R}.xy, xTexelC${R+2}.xy);
              `,R+1<g&&(b+=`
                  xC${O+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
                `)));O<g&&(b+=`
            wTexel = getW(${I}, ${R}, d1, q);
            dotProd += xC${O} * vec4(wTexel.xz, wTexel.xz);
          `,R+1<g&&(b+=`
              wTexel = getW(${I}, ${R+1}, d1, q);
              dotProd += xC${O+1} * vec4(wTexel.xz, wTexel.xz);
            `))}b+=`
        }
      `}let S="",_="";r&&(o?S=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?S=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:S=`vec4 activation(vec4 x) {
          ${r}
        }`,_="result = activation(result);");let E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${d}, ${p});
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${b}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${E}
        ${_}
        setOutput(result);
      }
    `}};function t0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r,u=l;u==null&&(u=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let d=T.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!0),p;return H().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new Km(d):p=new qm(d),e.runWebGLProgram(p,[o,i],"float32")}var o5={kernelName:tc,backendName:"webgl",kernelFunc:t0e};var c_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},u_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,a=r-1-n.padInfo.left,l=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function n0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new c_(d);return e.runWebGLProgram(p,[o,i],"float32")}var i5={kernelName:Df,backendName:"webgl",kernelFunc:n0e};function r0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new u_(d);return e.runWebGLProgram(p,[o,i],"float32")}var s5={kernelName:Nf,backendName:"webgl",kernelFunc:r0e};var d_=class{constructor(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function o0e(t){let{inputs:n,backend:e}=t,{x:r}=n,o=[...r.shape,...r.shape],i=w.sizeFromShape(r.shape),s=ae({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new d_(i),l=e.runWebGLProgram(a,[s],s.dtype),c=ae({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),c}var a5={kernelName:sb,backendName:"webgl",kernelFunc:o0e};var p_=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=n,{top:d,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function i0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u,d=new p_(c);u=e.runWebGLProgram(d,[o,i],"float32");let p=ae({inputs:{x:u},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(u),p}var l5={kernelName:nc,backendName:"webgl",kernelFunc:i0e};function s0e(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:x,expandDims:b}=T.getEinsumPermutation(f,l[g]),S;T.isIdentityPermutation(x)?S=i[g]:(S=Ht({inputs:{x:i[g]},backend:e,attrs:{perm:x}}),m.push(S));let _=S.shape.slice();for(let E=0;E<b.length;++E)_.splice(b[E],0,1);w.arraysEqual(S.shape,_)||(S=ae({inputs:{x:S},backend:e,attrs:{shape:_}}),m.push(S)),p===null?p=S:(p=$y({inputs:{a:S,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=Kd({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var c5={kernelName:ab,backendName:"webgl",kernelFunc:s0e};var a0e="return (x >= 0.0) ? x : (exp(x) - 1.0);",l0e=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,c0e=Ce({opSnippet:a0e,packedOpSnippet:l0e}),u5={kernelName:pa,backendName:"webgl",kernelFunc:c0e};var u0e="return (b >= 1.0) ? a : a * (b + 1.0);",d0e=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,p0e=t=>{let{inputs:n,backend:e}=t,{dy:r,y:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new pi(d0e,r.shape,o.shape):new Io(u0e,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},d5={kernelName:kf,backendName:"webgl",kernelFunc:p0e};var f0e=`
  return vec4(equal(a, b));
`,m0e="return float(a == b);",h0e=vt({opSnippet:m0e,packedOpSnippet:f0e,dtype:"bool"}),p5={kernelName:Xu,backendName:"webgl",kernelFunc:h0e};var g0e=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,y0e=Ce({opSnippet:g0e}),f5={kernelName:fa,backendName:"webgl",kernelFunc:y0e};var m5="return exp(x);",qk=Ce({opSnippet:m5,packedOpSnippet:m5,cpuKernelImpl:sH}),h5={kernelName:ma,backendName:"webgl",kernelFunc:qk};function f_(t){let{inputs:n,attrs:e,backend:r}=t,{dim:o}=e,{input:i}=n,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(w.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),ae({inputs:{x:i},backend:r,attrs:{shape:a}})}var g5={kernelName:rc,backendName:"webgl",kernelFunc:f_};var y5="return exp(x) - 1.0;",x0e=Ce({opSnippet:y5,packedOpSnippet:y5,cpuKernelImpl:aH}),x5={kernelName:ha,backendName:"webgl",kernelFunc:x0e};var By=class{constructor(n,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(n==="real")a="return real * expR - imag * expI;";else if(n==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${n}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function m_(t,n,e){let r=e.texData.get(t.dataId),o=w.sizeFromShape(t.shape),i=t.shape[t.shape.length-1],s=o/i,a=ae({inputs:{x:t},backend:e,attrs:{shape:[s,i]}}),l=a.shape,c=new By("real",l,n),u=new By("imag",l,n),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Vr({inputs:{real:p,imag:f},backend:e});e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f);let h=ae({inputs:{x:m},backend:e,attrs:{shape:t.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(m),h}function v0e(t){let{inputs:n,backend:e}=t,{input:r}=n;return m_(r,!1,e)}var v5={kernelName:Af,backendName:"webgl",kernelFunc:v0e};var h_=class{constructor(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};function zy(t){let{backend:n,attrs:e}=t,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||w.inferDtype(o),i==="string"){let s=w.getArrayFromDType(i,w.sizeFromShape(r));return s.fill(o),n.makeTensorInfo(r,i,s)}else{let s=new h_(r,o),a=s.getCustomSetupFunc(o);return n.runWebGLProgram(s,[],i,a)}}var b5={kernelName:Rf,backendName:"webgl",kernelFunc:zy};var g_=class{constructor(n){this.variableNames=["Image"],this.outputShape=[];let e=n[2];this.outputShape=n,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var w5={kernelName:lb,backendName:"webgl",kernelFunc:({inputs:t,backend:n})=>{let{image:e}=t,r=n,o=new g_(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var C5="return floor(x);",b0e=Ce({opSnippet:C5,packedOpSnippet:C5,cpuKernelImpl:lH}),_5={kernelName:ga,backendName:"webgl",kernelFunc:b0e};var w0e=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,C0e=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,_0e=vt({opSnippet:w0e,packedOpSnippet:C0e,dtype:"int32"}),S5={kernelName:ya,backendName:"webgl",kernelFunc:_0e};var y_=class{constructor(n){this.variableNames=["A"];let e=en(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var x_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=en(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var E5={kernelName:C$,backendName:"webgl",kernelFunc:S0e},Xm;function S0e(t){let{inputs:n,backend:e,attrs:r}=t,{pixels:o}=n,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,i];(a||s)&&(Xm==null&&(Xm=document.createElement("canvas").getContext("2d")),Xm.canvas.width=l,Xm.canvas.height=c,Xm.drawImage(o,0,0,l,c),o=Xm.canvas);let p=e.makeTensorInfo(u,"int32");e.texData.get(p.dataId).usage=fr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);let f=H().getBool("WEBGL_PACK")?new x_(d):new y_(d),m=e.runWebGLProgram(f,[p],"int32");return e.disposeData(p.dataId),m}function E0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=T.convertConv2DDataFormat(u),g=T.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,h),x,b=[];if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))x=t_({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)x=n_({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{let _=s!=null,E=a!=null,I=f==="leakyrelu",D=f?tu(f,!1):null,O=new Hm(g,_,D,E,I),R=[o,i];if(s&&R.push(s),a&&R.push(a),I){let $=e.makeTensorInfo([],"float32",w.createScalarValue(m,"float32"));R.push($),b.push($)}x=e.runWebGLProgram(O,R,"float32")}let S=ae({inputs:{x},backend:e,attrs:{shape:g.outShape}});return b.push(x),b.forEach(_=>e.disposeIntermediateTensorInfo(_)),S}var I5={kernelName:od,backendName:"webgl",kernelFunc:E0e};function I0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[],h=u;h==null&&(h=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let g=T.computeConv2DInfo(o.shape,i.shape,l,h,c,d,!0),x=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=p?tu(p,x):null,S=[o,i],_=s!=null,E=a!=null,I=p==="leakyrelu";if(_&&S.push(s),E&&S.push(a),I){let R=e.makeTensorInfo([],"float32",w.createScalarValue(f,"float32"));S.push(R),m.push(R)}let D;x?D=new Km(g,_,b,E,I):D=new qm(g,_,b,E,I);let O=e.runWebGLProgram(D,S,"float32");return m.forEach(R=>e.disposeIntermediateTensorInfo(R)),O}var T5={kernelName:id,backendName:"webgl",kernelFunc:I0e};var v_=class{constructor(n,e,r){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;let o=Ge(e.length),i=Ge(r.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${o} strides = ${o}(${this.strides});
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${s};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}};function T0e(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=o.shape,s=i[i.length-1],[a,l,c,u]=T.prepareAndValidate(r,o),d=ae({inputs:{x:o},backend:e,attrs:{shape:[l,s]}}),p=ae({inputs:{x:r},backend:e,attrs:{shape:[w.sizeFromShape(r.shape)/c,c]}}),f=new v_(s,u,[l,c]),m=e.runWebGLProgram(f,[p,d],p.dtype),h=ae({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),h}var D5={kernelName:cb,backendName:"webgl",kernelFunc:T0e};var b_=class{constructor(n,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=Ge(this.rank),o=D0e(n,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}};function D0e(t,n){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<t.length;o++)o===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${e[o]}`);return r.join()}function N0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r,l=w.parseAxisParam(s,o.shape)[0],c=T.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=w.sizeFromShape(i.shape),d=[],p=ae({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=ae({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let m=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let b=e.bufferSync(f),S=e.bufferSync(p),_=cH(S,b,m);return d.forEach(E=>e.disposeIntermediateTensorInfo(E)),e.makeTensorInfo(c.outputShape,_.dtype,_.values)}let h=new b_(p.shape,m),g=e.runWebGLProgram(h,[p,f],p.dtype);d.push(g);let x=ae({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(b=>e.disposeIntermediateTensorInfo(b)),x}var N5={kernelName:ic,backendName:"webgl",kernelFunc:N0e};var k0e="return float(a > b);",A0e=`
  return vec4(greaterThan(a, b));
`,R0e=vt({opSnippet:k0e,packedOpSnippet:A0e,cpuKernelImpl:uH,dtype:"bool"}),k5={kernelName:Yu,backendName:"webgl",kernelFunc:R0e};var O0e="return float(a >= b);",M0e=`
  return vec4(greaterThanEqual(a, b));
`,F0e=vt({opSnippet:O0e,packedOpSnippet:M0e,dtype:"bool"}),A5={kernelName:xa,backendName:"webgl",kernelFunc:F0e};function P0e(t){let{inputs:n,backend:e}=t,{input:r}=n;return m_(r,!0,e)}var R5={kernelName:Of,backendName:"webgl",kernelFunc:P0e};var $0e="return float(!isnan(x) && !isinf(x));",L0e=Ce({opSnippet:$0e,dtype:"bool"}),O5={kernelName:va,backendName:"webgl",kernelFunc:L0e};var V0e="return float(isinf(x));",B0e=Ce({opSnippet:V0e,dtype:"bool"}),M5={kernelName:ba,backendName:"webgl",kernelFunc:B0e};var z0e="return float(isnan(x));",U0e=Ce({opSnippet:z0e,dtype:"bool"}),F5={kernelName:wa,backendName:"webgl",kernelFunc:U0e};var j0e="return float(a < b);",G0e=`
  return vec4(lessThan(a, b));
`,W0e=vt({opSnippet:j0e,packedOpSnippet:G0e,cpuKernelImpl:dH,dtype:"bool"}),P5={kernelName:Qu,backendName:"webgl",kernelFunc:W0e};var H0e="return float(a <= b);",q0e=`
  return vec4(lessThanEqual(a, b));
`,K0e=vt({opSnippet:H0e,packedOpSnippet:q0e,dtype:"bool"}),$5={kernelName:Zu,backendName:"webgl",kernelFunc:K0e};function X0e(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=pH(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var L5={kernelName:ub,backendName:"webgl",kernelFunc:X0e};var Y0e=`if (x < 0.0) return NAN;
  return log(x);`,Q0e=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,Z0e=Ce({opSnippet:Y0e,packedOpSnippet:Q0e,cpuKernelImpl:fH}),V5={kernelName:Ca,backendName:"webgl",kernelFunc:Z0e};var J0e="return log(1.0 + x);",exe=Ce({opSnippet:J0e}),B5={kernelName:_a,backendName:"webgl",kernelFunc:exe};var txe="return float(a >= 1.0 && b >= 1.0);",nxe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,rxe=vt({opSnippet:txe,packedOpSnippet:nxe,dtype:"bool"}),z5={kernelName:Ju,backendName:"webgl",kernelFunc:rxe};var oxe="return float(!(x >= 1.0));",ixe=Ce({opSnippet:oxe}),U5={kernelName:ed,backendName:"webgl",kernelFunc:ixe};var sxe="return float(a >= 1.0 || b >= 1.0);",axe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,lxe=vt({opSnippet:sxe,packedOpSnippet:axe,dtype:"bool"}),j5={kernelName:td,backendName:"webgl",kernelFunc:lxe};var w_=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var C_=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var cxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c=H().getBool("WEBGL_PACK_NORMALIZATION")?new C_(o.shape,i,s,a,l):new w_(o.shape,i,s,a,l);return e.runWebGLProgram(c,[o],o.dtype)},G5={kernelName:ac,backendName:"webgl",kernelFunc:cxe};var __=class{constructor(n,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var uxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new __(o.shape,a,l,c,u);return e.runWebGLProgram(d,[o,i,s],o.dtype)},W5={kernelName:Ff,backendName:"webgl",kernelFunc:uxe};function H5(t,n,e,r){let o=w.sizeFromShape(n),s=w.sizeFromShape(t.shape)/o,a=ae({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=oo(a,t.dtype,"max",r),c=ae({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function Kk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=e.shouldExecuteOnCPU([o]),f=o;if(d){if(p){let S=e.texData.get(f.dataId).values,_=new Array(a);for(let D=0;D<_.length;D++)_[D]=o.shape[u[D]];let E=qd(S,o.shape,o.dtype,u,_);f=e.makeTensorInfo(_,o.dtype);let I=e.texData.get(f.dataId);I.values=E}else f=nu(o,u,e);c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("max",c,a);let[m,h]=T.computeOutAndReduceShapes(f.shape,c),g=m;s&&(g=T.expandShapeToKeepDim(m,l));let x;if(p){let S=e.texData.get(f.dataId).values,_=mH(S,w.sizeFromShape(h),g,o.dtype);x=e.makeTensorInfo(g,o.dtype);let E=e.texData.get(x.dataId);E.values=_}else x=H5(f,h,g,e);return d&&e.disposeIntermediateTensorInfo(f),x}var q5={kernelName:lc,backendName:"webgl",kernelFunc:Kk};var dxe=kC+`
  return max(a, b);
`,pxe=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+eu+`
  return result;
`,fxe=vt({opSnippet:dxe,packedOpSnippet:pxe,cpuKernelImpl:hH}),K5={kernelName:Sa,backendName:"webgl",kernelFunc:fxe};function mxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;ws(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))return un({inputs:{x:o},backend:e});let d=new ji(u,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}var X5={kernelName:cc,backendName:"webgl",kernelFunc:mxe};function hxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new ru(d,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var Y5={kernelName:uc,backendName:"webgl",kernelFunc:hxe};var S_=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideHeight,r=n.strideWidth,o=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,a=i-1-n.padInfo.top,l=s-1-n.padInfo.left,c=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},E_=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterDepth,c=n.effectiveFilterHeight,u=n.effectiveFilterWidth,d=l-1-n.padInfo.front,p=c-1-n.padInfo.top,f=u-1-n.padInfo.left,m=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function gxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new ru(p,"max",!0),m=e.runWebGLProgram(f,[s],s.dtype),h=new E_(p),g=e.runWebGLProgram(h,[o,m],s.dtype);return e.disposeIntermediateTensorInfo(m),g}var Q5={kernelName:$f,backendName:"webgl",kernelFunc:gxe};function yxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;ws([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=!0,m=new ji(p,"max",f),h=e.runWebGLProgram(m,[a],a.dtype),g=new S_(p),x=e.runWebGLProgram(g,[o,h],a.dtype);return e.disposeIntermediateTensorInfo(h),x}var Z5={kernelName:Pf,backendName:"webgl",kernelFunc:yxe};function J5(t,n,e,r){let o=new ji(e,"max",!1),i=r.runWebGLProgram(o,[t],"float32");o=new ji(e,"max",!0,!0,n);let s=r.runWebGLProgram(o,[t],"float32");return[i,s]}var e8={kernelName:db,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;w.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];w.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=T.computePool2DInfo(r.shape,o,i,c,s),[d,p]=J5(r,a,u,l);return[d,p]}};function t8(t,n,e,r){let o=w.sizeFromShape(n),s=w.sizeFromShape(t.shape)/o,a=ae({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=oo(a,"float32","mean",r),c=ae({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}var n8={kernelName:dc,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{keepDims:o,axis:i}=n,s=e,a=r.shape.length,l=w.parseAxisParam(i,r.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=s.shouldExecuteOnCPU([r]),f=[],m=r;if(d){if(p){let _=s.texData.get(m.dataId).values,E=new Array(a);for(let O=0;O<E.length;O++)E[O]=r.shape[u[O]];let I=qd(_,r.shape,r.dtype,u,E);m=s.makeTensorInfo(E,r.dtype);let D=s.texData.get(m.dataId);D.values=I}else m=nu(r,u,s);f.push(m),c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("sum",c,a);let[h,g]=T.computeOutAndReduceShapes(m.shape,c),x=h;o&&(x=T.expandShapeToKeepDim(h,l));let b=t8(m,g,x,s);for(let S of f)s.disposeIntermediateTensorInfo(S);return b}};function xxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=w.sizeFromShape(f),h=ae({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=oo(h,h.dtype,"min",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=ae({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=ae({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var r8={kernelName:pc,backendName:"webgl",kernelFunc:xxe};var vxe=kC+`
  return min(a, b);
`,bxe=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+eu+`
  return result;
`,wxe=vt({opSnippet:vxe,packedOpSnippet:bxe,cpuKernelImpl:gH}),o8={kernelName:Ea,backendName:"webgl",kernelFunc:wxe};var I_=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((u,d)=>u[0]+n[d]+u[1]);let o=n.length,i=Ge(o),s=e.map(u=>u[0]).join(","),a=e.map((u,d)=>u[0]+n[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var T_=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,h)=>m[0]+n[h]+m[1]);let o=n.length,i=Ge(o),s=e.map(m=>m[0]).join(","),a=e.map((m,h)=>m[0]+n[h]).join(","),l=cn("rc",o),c=cn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1,f="";if(o===1){let m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{let m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var Cxe=({inputs:t,backend:n,attrs:e})=>{let{x:r}=t,{paddings:o,mode:i}=e,s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new T_(r.shape,o,i):new I_(r.shape,o,i);return n.runWebGLProgram(s,[r],r.dtype)},i8={kernelName:fc,backendName:"webgl",kernelFunc:Cxe};var _xe=`if (b == 0.0) return NAN;
  return mod(a, b);`,Sxe=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+eu+`
  return result;
`,Exe=vt({opSnippet:_xe,packedOpSnippet:Sxe}),s8={kernelName:Ia,backendName:"webgl",kernelFunc:Exe};var D_=class{constructor(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.seedLoc==null&&(this.seedLoc=e.getUniformLocation(r,"seed")),e.gl.uniform1f(this.seedLoc,n)}}};var Ixe=`
if (a == b) {
  return 1.0;
};
return a / b;`,Txe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,Xk=vt({opSnippet:Ixe,packedOpSnippet:Txe,checkOutOfBounds:!0}),a8={kernelName:da,backendName:"webgl",kernelFunc:Xk};var l8="return a - b;",Yk=vt({opSnippet:l8,packedOpSnippet:l8,supportsComplex:!0,cpuKernelImpl:IH}),c8={kernelName:Ua,backendName:"webgl",kernelFunc:Yk};function Qk(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=w.parseAxisParam([i],o.shape),a=Kk({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,s),c=ae({inputs:{x:a},backend:e,attrs:{shape:l}}),u=Yk({inputs:{a:o,b:c},backend:e}),d=qk({inputs:{x:u},backend:e}),p=Kd({inputs:{x:d},backend:e,attrs:{axis:s,keepDims:!1}}),f=ae({inputs:{x:p},backend:e,attrs:{shape:l}}),m=Xk({inputs:{a:d,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}var u8={kernelName:Nc,backendName:"webgl",kernelFunc:Qk};function Dxe(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r,l=a?o:Qk({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new D_(c,u,i),p=d.getCustomSetupFunc(s),f=e.runWebGLProgram(d,[l],"int32",p);return a||e.disposeIntermediateTensorInfo(l),f}var d8={kernelName:pb,backendName:"webgl",kernelFunc:Dxe};var p8="return -x;";function Nxe(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=xH(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new di(r.shape,p8):o=new Ir(r.shape,p8),e.runWebGLProgram(o,[r],r.dtype)}var f8={kernelName:mc,backendName:"webgl",kernelFunc:Nxe};var kxe=Jn.nonMaxSuppressionV3Impl;function Axe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=kxe(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var m8={kernelName:fb,backendName:"webgl",kernelFunc:Axe};var Rxe=Jn.nonMaxSuppressionV4Impl;function Oxe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=Rxe(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var h8={kernelName:mb,backendName:"webgl",kernelFunc:Oxe};var Mxe=Jn.nonMaxSuppressionV5Impl;function Fxe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:x}=Mxe(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var g8={kernelName:hb,backendName:"webgl",kernelFunc:Fxe};var N_=class{constructor(n,e,r,o){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var Pxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r,l=w.sizeFromShape(o.shape),c=new N_(l,i,s,a),u=ae({inputs:{x:o},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[u],o.dtype);e.disposeIntermediateTensorInfo(u);let p=[...o.shape,i],f=ae({inputs:{x:d},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(d),f},y8={kernelName:gc,backendName:"webgl",kernelFunc:Pxe};function Uy(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="complex64"){let o=fl({inputs:{input:r},backend:e}),i=Uy({inputs:{x:o},backend:e}),s=Yd({inputs:{input:r},backend:e}),a=Uy({inputs:{x:s},backend:e}),l=Vr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return zy({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var x8={kernelName:Oc,backendName:"webgl",kernelFunc:Uy};function v8(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=fl({inputs:{input:r},backend:e}),i=v8({inputs:{x:o},backend:e}),s=Yd({inputs:{input:r},backend:e}),a=Uy({inputs:{x:s},backend:e}),l=Vr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return zy({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var b8={kernelName:hc,backendName:"webgl",kernelFunc:v8};function $xe(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return f_({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{w.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),w.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=f_({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Hk({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var w8={kernelName:yc,backendName:"webgl",kernelFunc:$xe};var k_=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((c,u)=>c[0]+n[u]+c[1]);let o=n.length,i=Ge(o),s=e.map(c=>c[0]).join(","),a=e.map((c,u)=>c[0]+n[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};
        uniform float value;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var A_=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,g)=>h[0]+n[g]+h[1]);let o=n.length,i=Ge(o),s=e.map(h=>h[0]).join(","),a=e.map((h,g)=>h[0]+n[g]).join(","),l=cn("rc",o),c=cn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,g=o===1?2:4;h<g;h++)m+=`
        ${p[h]}
        if (${f}) {
          result[${h}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${h}] = getChannel(getX(${c.join()}), ${d});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var Zk=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r,a=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new A_(o.shape,i,s):new k_(o.shape,i,s),l=a.getCustomSetupFunc(s);return e.runWebGLProgram(a,[o],o.dtype,l)},C8={kernelName:xc,backendName:"webgl",kernelFunc:Zk};var Lxe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Vxe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+eu+`
  return result;
`,Bxe=vt({opSnippet:Lxe,packedOpSnippet:Vxe}),_8={kernelName:Da,backendName:"webgl",kernelFunc:Bxe};function zxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],c=w.parseAxisParam(i,o.shape),u=c,d=T.getAxesPermutation(u,a),p=o;d!=null&&(p=Ht({inputs:{x:o},backend:e,attrs:{perm:d}}),u=T.getInnerMostAxes(u.length,a),l.push(p)),T.assertAxesAreInnerMostDims("prod",u,a);let f;if(e.shouldExecuteOnCPU([p])){let m=e.texData.get(p.dataId).values,{outVals:h,outShape:g,outDtype:x}=vH(p.shape,p.dtype,m,u);f=e.makeTensorInfo(g,x,h)}else{let[m,h]=T.computeOutAndReduceShapes(p.shape,u),g=w.sizeFromShape(h),x=ae({inputs:{x:p},backend:e,attrs:{shape:[-1,g]}}),b=ad(o.dtype),S=oo(x,b,"prod",e);f=ae({inputs:{x:S},backend:e,attrs:{shape:m}}),l.push(x),l.push(S)}if(s){l.push(f);let m=T.expandShapeToKeepDim(f.shape,c);f=ae({inputs:{x:f},backend:e,attrs:{shape:m}})}return l.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var S8={kernelName:Lf,backendName:"webgl",kernelFunc:zxe};var Jk=t=>{let{backend:n,attrs:e}=t,{start:r,stop:o,step:i,dtype:s}=e,a=bH(r,o,i,s);return n.makeTensorInfo([a.length],s,a)},E8={kernelName:Vf,backendName:"webgl",kernelFunc:Jk};var Uxe="return 1.0 / x;",jxe=Ce({opSnippet:Uxe}),I8={kernelName:Na,backendName:"webgl",kernelFunc:jxe};var Gxe=Fn+`
  return (x < 0.0) ? 0.0 : x;
`,Wxe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Hxe=Ce({opSnippet:Gxe,packedOpSnippet:Wxe}),T8={kernelName:ka,backendName:"webgl",kernelFunc:Hxe};var qxe=Fn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Kxe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Xxe=Ce({opSnippet:qxe,packedOpSnippet:Kxe}),D8={kernelName:Aa,backendName:"webgl",kernelFunc:Xxe};var R_=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var O_=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function Yxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new O_(o.shape,l,c,i,s):new R_(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],"float32")}var N8={kernelName:Cc,backendName:"webgl",kernelFunc:Yxe};var M_=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Qxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new M_(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var k8={kernelName:Uf,backendName:"webgl",kernelFunc:Qxe};var F_=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var P_=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function Zxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new P_(o.shape,l,c,i,s):new F_(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],o.dtype)}var A8={kernelName:wc,backendName:"webgl",kernelFunc:Zxe};var $_=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Jxe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new $_(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var R8={kernelName:zf,backendName:"webgl",kernelFunc:Jxe};var L_=class{constructor(n,e){this.variableNames=["x"];let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=n,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${n[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&n[a]!==1?`${n[a]} - coords[${a}] - 1`:`coords[${a}]`,i=n.map((a,l)=>o(l)).join(","),s=Ge(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var V_=class{constructor(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=n;let o=cn("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=Ge(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${n[0]} - rc - 1),
            ${n[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${n[0]} - (rc  + 1) - 1),
                ${n[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${c(o.slice())};
          }
          if(${s}) {
            result.b = ${u(o.slice())};
            if(${i}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return p(m)}function c(m){return m[r-1]="("+m[r-1]+" + 1)",p(m)}function u(m){return m[r-2]="("+m[r-2]+" + 1)",p(m)}function d(m){return m[r-1]="("+m[r-1]+" + 1)",m[r-2]="("+m[r-2]+" + 1)",p(m)}function p(m){let h=n.map((b,S)=>f(S,m)),g=h.join(","),x=h.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function f(m,h){return e.indexOf(m)!==-1&&n[m]!==1?`${n[m]} - ${h[m]} - 1`:`${h[m]}`}}};function eve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r,s=o.shape.length,a=w.parseAxisParam(i,o.shape);if(s===0)return un({inputs:{x:o},backend:e});let l=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new V_(o.shape,a):new L_(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var O8={kernelName:_c,backendName:"webgl",kernelFunc:eve};var B_=class{constructor(n,e){this.variableNames=["Image"],this.outputShape=[];let r=n[1],o=n[2];this.outputShape=n;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        uniform vec4 params;
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}getCustomSetupFunc(n,e,r,o){return(i,s)=>{this.paramsLoc==null&&(this.paramsLoc=i.getUniformLocationNoThrow(s,"params")),i.gl.uniform4f(this.paramsLoc,n,e,r,o)}}};var M8={kernelName:wb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=new B_(r.shape,i),[c,u]=T.getImageCenter(s,r.shape[1],r.shape[2]),d=l.getCustomSetupFunc(c,u,Math.sin(o),Math.cos(o));return a.runWebGLProgram(l,[r],r.dtype,d)}};var tve=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,nve=Ce({opSnippet:tve}),F8={kernelName:Ra,backendName:"webgl",kernelFunc:nve};var rve="return inversesqrt(x);",ove=Ce({opSnippet:rve,cpuKernelImpl:wH}),P8={kernelName:Oa,backendName:"webgl",kernelFunc:ove};var Ym=class{constructor(n,e,r,o,i,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=Ge(i.length),c=Ge(s.length),u="";r===1?u="i":r===2&&(u="i, j");let d=`getIndices(${u})`,p="";o===1?p="i":o===2&&(p="i, coords[1]");let f=`getUpdates(${p})`,m=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${n}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function ive(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=ae({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),m=ae({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),h=e.makeTensorInfo([],"float32",new Float32Array([0])),g=new Ym(l,a,f.shape.length,m.shape.length,u,p),x=e.runWebGLProgram(g,[m,f,h],m.dtype),b=ae({inputs:{x},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(h),b}var $8={kernelName:gb,backendName:"webgl",kernelFunc:ive};var z_=class{constructor(n,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<e.length;u++)c.push(`${a[u]}`),u<n&&l.push(`${a[u]}`);o=l.join(),i=c.join()}let s=Ge(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function sve(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n,s=new z_(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],_n(o.dtype,i.dtype))}var L8={kernelName:Sc,backendName:"webgl",kernelFunc:sve};var ave=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,lve=Ce({opSnippet:ave}),V8={kernelName:Ma,backendName:"webgl",kernelFunc:lve};var cve="return 1.0 / (1.0 + exp(-1.0 * x));",uve=Ce({opSnippet:cve}),B8={kernelName:La,backendName:"webgl",kernelFunc:uve};var dve=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,pve=Ce({opSnippet:dve}),z8={kernelName:$a,backendName:"webgl",kernelFunc:pve};var fve=AC+`
  return sin(x);
`,mve=Ce({opSnippet:fve}),U8={kernelName:Fa,backendName:"webgl",kernelFunc:mve};var hve=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,gve=Ce({opSnippet:hve}),j8={kernelName:Pa,backendName:"webgl",kernelFunc:gve};var yve=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,xve=Ce({opSnippet:yve}),G8={kernelName:Va,backendName:"webgl",kernelFunc:xve};var vve=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;w.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((x,b)=>x*b),l=[[0,0]];l.push(...s);for(let x=1+i.length;x<o.shape.length;++x)l.push([0,0]);let c=[],u=Zk({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),d=T.getReshaped(u.shape,i,a,!1),p=T.getPermuted(d.length,i.length,!1),f=T.getReshapedPermuted(u.shape,i,a,!1),m=ae({inputs:{x:u},backend:e,attrs:{shape:d}}),h=Ht({inputs:{x:m},backend:e,attrs:{perm:p}}),g=ae({inputs:{x:h},backend:e,attrs:{shape:f}});return c.push(u),c.push(m),c.push(h),c.forEach(x=>e.disposeIntermediateTensorInfo(x)),g},W8={kernelName:Tc,backendName:"webgl",kernelFunc:vve};function bve(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=e.readSync(s.dataId)[0],[d,p,f,m,h]=_H(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var H8={kernelName:yb,backendName:"webgl",kernelFunc:bve};function wve(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[c,u,d]=SH(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var q8={kernelName:xb,backendName:"webgl",kernelFunc:wve};function Cve(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,strides:u,outputSize:d}=T.calculateShapes(i,o,a),p=!1,f=new Ym(c,l,o.shape.length,i.shape.length,u,[d,1],p),m=e.runWebGLProgram(f,[i,o,s],i.dtype),h=ae({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),h}var K8={kernelName:vb,backendName:"webgl",kernelFunc:Cve};function _ve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=w.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let m=pl({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,m})}var X8={kernelName:Dc,backendName:"webgl",kernelFunc:_ve};var Sve="return sqrt(x);",Eve=Ce({opSnippet:Sve}),Y8={kernelName:Ba,backendName:"webgl",kernelFunc:Eve};var Ive="return x * x;",Tve=Ce({opSnippet:Ive}),Q8={kernelName:jf,backendName:"webgl",kernelFunc:Tve};var Z8="return (a - b) * (a - b);",Dve=vt({opSnippet:Z8,packedOpSnippet:Z8}),J8={kernelName:za,backendName:"webgl",kernelFunc:Dve};function Nve({inputs:t,attrs:n,backend:e}){let{x:r}=t,o=Fn+`
    return x > 0.0 ? 1.0 : float(${n.alpha});
  `,i=new Ir(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var e6={kernelName:Wa,backendName:"webgl",kernelFunc:Nve};var U_=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=Ge(r.length),s=Ge(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${n});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function kve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{nonStrided:f,$begin:m,$strides:h,size:g,newShape:x,outShape:b}=Xn.sliceInfo(o.shape,i,s,a,l,c,u,d,p),S=ae({inputs:{x:o},backend:e,attrs:{shape:x}}),_;if(f){let I=pl({inputs:{x:S},backend:e,attrs:{begin:m,size:g}});_=ae({inputs:{x:I},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(I)}else if(b.some(I=>I===0))_=e.makeTensorInfo(b,o.dtype,[]);else if(e.shouldExecuteOnCPU([S])){let O=e.texData.get(S.dataId).values,R=Ee(S.shape,S.dtype,O),$=EH(b,R,h,m);_=e.makeTensorInfo(b,S.dtype,$.values)}else{let D=new U_(m,h,b);_=e.runWebGLProgram(D,[S],S.dtype)}let E=ae({inputs:{x:_},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(_),E}var t6={kernelName:Gf,backendName:"webgl",kernelFunc:kve};var Ave="return tan(x);",Rve=Ce({opSnippet:Ave}),n6={kernelName:ja,backendName:"webgl",kernelFunc:Rve};var Ove=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Mve=Ce({opSnippet:Ove}),r6={kernelName:Ga,backendName:"webgl",kernelFunc:Mve};var j_=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[s]*e[s];this.outputShape=r,this.rank=r.length;let o=Ge(this.rank),i=Fve(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function Fve(t){let n=t.length;if(n>5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`imod(resRC, ${t[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<t.length;o++)r.push(`imod(${e[o]}, ${t[o]})`);return r.join()}function eA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>w.decodeString(p)):l,u=Ee(o.shape,o.dtype,c),d=TH(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new j_(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var o6={kernelName:cs,backendName:"webgl",kernelFunc:eA};function Pve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r,a=e.readSync(o.dataId),[l,c]=DH(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var i6={kernelName:Wf,backendName:"webgl",kernelFunc:Pve};var G_=class{constructor(n,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${n} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${n}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function $ve(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],x=new G_(d,p,s,a,l,g);return e.runWebGLProgram(x,[o,i],"float32")}var s6={kernelName:bb,backendName:"webgl",kernelFunc:$ve};function Lve(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;ws(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=NH(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var a6={kernelName:Hf,backendName:"webgl",kernelFunc:Lve};function Vve(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let h=0;h<a;h++)h!==i&&(c[u++]=s.shape[h]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let m=new Array(l);for(let h=0;h<m.length;h++){p[i]=h;let g=pl({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),x=ae({inputs:{x:g},backend:e,attrs:{shape:c}});m[h]=x,d.push(g)}return d.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var l6={kernelName:Ac,backendName:"webgl",kernelFunc:Vve};var W_=class{constructor(n,e){this.variableNames=["x","segmentIds"];let r=n.windowSize,o=n.batchSize,i=n.inSize,s=n.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `,f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function Bve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=T.getAxesPermutation([c],a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=T.getInnerMostAxes(1,a)[0]);let p=T.segment_util.computeOutShape(d.shape,c,s),f=w.sizeFromShape([d.shape[c]]),m=ae({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(m);let h=ad(o.dtype),g=(_,E,I,D,O)=>{let R=_.shape[0],$=_.shape[1],G=T.segment_util.segOpComputeOptimalWindowSize($,O),W={windowSize:G,inSize:$,batchSize:R,numSegments:O},q=new W_(W,E),X=e.compileAndRun(q,[_,I],D);if(l.push(X),X.shape[1]===O)return X;let K=Jk({backend:e,attrs:{start:0,stop:O,step:1,dtype:"float32"}}),Y=eA({inputs:{x:K},backend:e,attrs:{reps:[$/G]}});return l.push(K),l.push(Y),g(X,E,Y,D,O)},x=g(m,"unsortedSegmentSum",i,h,s),b=ae({inputs:{x},backend:e,attrs:{shape:p}}),S=b;if(u!=null){l.push(b);let _=T.getUndoAxesPermutation(u);S=Ht({inputs:{x:S},backend:e,attrs:{perm:_}})}return l.forEach(_=>e.disposeIntermediateTensorInfo(_)),S}var c6={kernelName:Rc,backendName:"webgl",kernelFunc:Bve};var zve=[G5,W5,iq,aq,lq,cq,dq,pq,fq,mq,yq,xq,vq,bq,Cq,wq,_q,Eq,Sq,Iq,Tq,Dq,Nq,Aq,Rq,Pq,Lq,Vq,zq,qH,jq,Wq,Hq,Gq,Kq,Xq,qq,Yq,Qq,Zq,t5,n5,r5,i5,s5,o5,a5,l5,c5,u5,d5,p5,f5,h5,g5,x5,v5,b5,w5,_5,S5,E5,I5,T5,D5,N5,k5,A5,HH,R5,Uq,O5,M5,F5,KH,P5,$5,L5,B5,V5,z5,U5,j5,q5,Y5,X5,Q5,Z5,e8,K5,n8,r8,o8,i8,s8,d8,JH,f8,m8,h8,g8,Oq,y8,b8,w8,C8,_8,XH,S8,E8,Mq,a8,I8,D8,T8,tq,N8,k8,A8,R8,O8,M8,F8,P8,$8,L8,V8,B8,z8,U8,j8,kq,u8,G8,W8,H8,q8,K8,X8,Y8,Q8,J8,e6,t6,c8,rq,n6,r6,o6,i6,s6,oq,a6,l6,c6,x8];for(let t of zve)_b(t);function jve(t,n){if(t&1&&(v(0,"p",7),C(1," Predicted Emotion: "),v(2,"strong"),C(3),y()()),t&2){let e=ee();P(3),ht(e.predictedEmotion)}}var H_=class t{constructor(n){this.cdr=n;this.loadModel()}inputText="";predictedEmotion=null;model;tokenizer={};emotions=["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","optimism","pride","realization","relief","remorse","sadness","surprise","neutral"];VOCAB_SIZE=1e3;MAX_LENGTH=50;OOV_INDEX=1;async loadModel(){this.model=await hN("/assets/models/model.json"),console.log("Model loaded successfully:"),this.model.summary();let n=await fetch("/assets/models/tokenizer.json");this.tokenizer=await n.json(),console.log("Tokenizer mapping loaded:",this.tokenizer)}textToSequence(n){let e=n.trim().toLowerCase().split(/\s+/),r=[];for(let o of e){let i=this.tokenizer[o];(!i||i>=this.VOCAB_SIZE)&&(i=this.OOV_INDEX),r.push(i)}return r}padSequence(n){if(n.length>this.MAX_LENGTH)return n.slice(0,this.MAX_LENGTH);for(;n.length<this.MAX_LENGTH;)n.push(0);return n}async predictEmotion(){if(console.log("button clicked"),!this.model){console.error("Model not loaded yet.");return}let n=this.textToSequence(this.inputText);n=this.padSequence(n);let e=Uc([n],[1,this.MAX_LENGTH],"int32"),o=await this.model.predict(e).data(),i=o.indexOf(Math.max(...o));this.predictedEmotion=this.emotions[i],this.cdr.markForCheck(),console.log("Predicted Emotion:",this.predictedEmotion)}static \u0275fac=function(e){return new(e||t)(oe($t))};static \u0275cmp=Tt({type:t,selectors:[["app-emotion-analyze-prototype"]],decls:10,vars:2,consts:[[1,"container","mt-5"],[1,"card","shadow-lg","p-4"],[1,"text-center","text-primary","mb-4"],[1,"form-group"],["rows","3","placeholder","Enter your text here...",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-block",3,"click"],["class","mt-3 alert alert-info text-center",4,"ngIf"],[1,"mt-3","alert","alert-info","text-center"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1)(2,"h2",2),C(3,"Emotion Classifier"),y(),v(4,"div",3)(5,"textarea",4),Kr("ngModelChange",function(i){return po(r.inputText,i)||(r.inputText=i),i}),C(6,"            "),y()(),v(7,"button",5),le("click",function(){return r.predictEmotion()}),C(8," Predict Emotion "),y(),ie(9,jve,4,1,"p",6),y()()),e&2&&(P(5),qr("ngModel",r.inputText),P(4),j("ngIf",r.predictedEmotion))},dependencies:[Qt,pn,lf,Kn,yr,Gu],encapsulation:2})};function Gve(t,n){if(t&1&&(v(0,"div",14),C(1),y()),t&2){let e=ee();P(),ht(e.actionSuccess)}}function Wve(t,n){if(t&1&&(v(0,"div",15),C(1),y()),t&2){let e=ee();P(),ht(e.actionError)}}function Hve(t,n){if(t&1){let e=it();v(0,"li",16)(1,"div",17)(2,"i",18),le("click",function(){let o=ge(e).$implicit,i=ee();return ye(i.onRowClick(o))}),y(),v(3,"div",19),le("click",function(){let o=ge(e).$implicit,i=ee();return ye(i.onRowClick(o))}),v(4,"h5",20),C(5),y(),v(6,"span",21)(7,"span",22),C(8),y(),C(9," | "),v(10,"span",22),C(11),y(),C(12," | "),v(13,"span",22),C(14),Ci(15,"date"),y()()(),v(16,"div",23),le("click",function(){let o=ge(e).$implicit,i=ee();return ye(i.deleteAccount(o.account_id))}),U(17,"i",24),y()()()}if(t&2){let e=n.$implicit;P(5),ht(e.account_name),P(3),ze("Broker: ",e.broker_name,""),P(3),Tu("Balance: ",e.balance," ",e.currency,""),P(3),ze("Created At: ",_i(15,5,e.created_at,"y, MMMM, d h:mm a"),"")}}function qve(t,n){if(t&1&&(v(0,"div",15),C(1),y()),t&2){let e=ee(2);P(),ht(e.formError)}}function Kve(t,n){if(t&1){let e=it();v(0,"div",25),le("click",function(o){ge(e);let i=ee();return ye(i.closeFormOnOutside(o))})("keydown.escape",function(){ge(e);let o=ee();return ye(o.toggleForm())}),v(1,"div",26),le("click",function(o){return ge(e),ye(o.stopPropagation())}),v(2,"nav",27)(3,"ol",28)(4,"li",3)(5,"a",4),C(6,"Dashboard"),y()(),v(7,"li",3)(8,"a",29),le("click",function(o){ge(e);let i=ee();return ye(i.closeFormOnOutside(o))}),C(9,"Trading Accounts"),y()(),v(10,"li",5),C(11,"Create Manual Account"),y()()(),v(12,"h4",30),C(13,"Create Manual Account"),y(),v(14,"p",31),C(15,"Set up a manual trading account to track your trades"),y(),v(16,"form",32),le("ngSubmit",function(){ge(e);let o=ee();return ye(o.submitForm())}),v(17,"div",33)(18,"label",34),C(19,"Account Name"),y(),U(20,"input",35),y(),v(21,"div",33)(22,"label",34),C(23,"Broker Name"),y(),U(24,"input",36),y(),v(25,"div",33)(26,"label",34),C(27,"Account Type"),y(),U(28,"input",37),y(),v(29,"div",33)(30,"label",34),C(31,"Currency"),y(),U(32,"input",38),y(),v(33,"div",33)(34,"label",34),C(35,"Initial Balance"),y(),U(36,"input",39),y(),v(37,"div",33)(38,"label",34),C(39,"Account Notes (Optional)"),y(),U(40,"textarea",40),y(),v(41,"h5",8),C(42,"Trading Preferences"),y(),v(43,"div",41),U(44,"input",42),v(45,"label",43),C(46,"Track P&L"),y(),v(47,"small",44),C(48,"Enable profit and loss tracking for this account"),y()(),v(49,"div",41),U(50,"input",45),v(51,"label",46),C(52,"Include in Analytics"),y(),v(53,"small",44),C(54,"Include this account in overall performance metrics"),y()(),v(55,"div",33)(56,"label",34),C(57,"Trading Instruments"),y(),v(58,"select",47)(59,"option",48),C(60,"Select"),y(),v(61,"option",49),C(62,"Stocks"),y(),v(63,"option",50),C(64,"Options"),y(),v(65,"option",51),C(66,"Futures"),y(),v(67,"option",52),C(68,"Crypto"),y()()(),ie(69,qve,2,1,"div",10),v(70,"div",53)(71,"button",54),le("click",function(){ge(e);let o=ee();return ye(o.toggleForm())}),C(72,"Cancel"),y(),v(73,"button",55),C(74,"Create Account"),y()()()()()}if(t&2){let e=ee();P(16),j("formGroup",e.tradeAccountForm),P(53),j("ngIf",e.formError)}}function Xve(t,n){if(t&1){let e=it();v(0,"div",25),le("click",function(){ge(e);let o=ee();return ye(o.cancelDelete())})("keydown.escape",function(){ge(e);let o=ee();return ye(o.cancelDelete())}),v(1,"div",26),le("click",function(o){return ge(e),ye(o.stopPropagation())}),v(2,"h5",33),C(3,"Confirm Deletion"),y(),v(4,"p"),C(5,"Are you sure you want to delete this trading account and all its associated data?"),y(),v(6,"div",53)(7,"button",56),le("click",function(){ge(e);let o=ee();return ye(o.cancelDelete())}),C(8,"Cancel"),y(),v(9,"button",57),le("click",function(){ge(e);let o=ee();return ye(o.confirmDelete())}),C(10,"Delete"),y()()()()}}var q_=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r;this.tradeAccountForm=this.fb.group({account_name:["",_e.required],broker_name:[""],account_type:[""],currency:["USD"],balance:[0,_e.min(0)],track_pl:[!1],include_in_analytics:[!1],trading_instruments:[""]})}tradeAccounts=[];showForm=!1;tradeAccountForm;formError=null;actionError=null;actionSuccess=null;selectedAccountId=null;showDeleteConfirm=!1;pendingDeleteAccountId=null;ngOnInit(){this.loadAccounts()}async loadAccounts(){try{this.tradeAccounts=await this.supabaseService.getUserTradeAccounts()}catch{this.actionError="Failed to load accounts. Please try again."}finally{this.cdr.markForCheck()}}async onRowClick(n){this.selectedAccountId=n.account_id,this.tradeAccountForm.patchValue({account_name:n.account_name,broker_name:n.broker_name,account_type:n.account_type,currency:n.currency,balance:n.balance,track_pl:n.metadata?.track_pl||!1,include_in_analytics:n.metadata?.include_in_analytics||!1,trading_instruments:n.metadata?.trading_instruments||""}),this.showForm=!0}toggleForm(){this.showForm=!this.showForm,this.formError=null,this.actionSuccess=null,this.actionError=null,this.selectedAccountId=null,this.showForm||this.tradeAccountForm.reset({currency:"USD",balance:0})}async submitForm(){if(this.formError="",this.tradeAccountForm.valid){let n=this.tradeAccountForm.value;this.selectedAccountId?await this.supabaseService.editTradeAccount(this.selectedAccountId,n)?(this.actionSuccess="Account updated successfully",this.loadAccounts(),this.toggleForm()):this.formError="Failed to update account":await this.supabaseService.addTradeAccount(n)?(this.actionSuccess="Account added successfully",this.loadAccounts(),this.toggleForm()):this.formError="Failed to add account"}this.cdr.markForCheck()}async deleteAccount(n){this.showDeleteConfirm=!0,this.pendingDeleteAccountId=n}confirmDelete(){this.pendingDeleteAccountId&&this.performAccountDeletion(this.pendingDeleteAccountId),this.showDeleteConfirm=!1,this.pendingDeleteAccountId=null}cancelDelete(){this.showDeleteConfirm=!1,this.pendingDeleteAccountId=null}async performAccountDeletion(n){this.actionError=null,this.actionSuccess=null;try{await this.supabaseService.RemoveTradeAccount(n)?(this.loadAccounts(),this.actionSuccess="Account deleted successfully."):this.actionError="Failed to delete account."}catch{this.actionError="An unexpected error occurred while deleting."}finally{this.cdr.markForCheck(),setTimeout(()=>{this.actionSuccess="",this.cdr.markForCheck()},5e3)}}handleEscape(n){this.showForm&&this.toggleForm()}closeFormOnOutside(n){n.target===n.currentTarget&&this.toggleForm()}static \u0275fac=function(e){return new(e||t)(oe(os),oe(Vt),oe($t))};static \u0275cmp=Tt({type:t,selectors:[["app-tradeaccountmanage"]],hostBindings:function(e,r){e&1&&le("keydown.escape",function(i){return r.handleEscape(i)},!1,eO)},decls:23,vars:5,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"btn","btn-tr",3,"click"],[1,"mt-4"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"list-group"],["class","list-group-item bg-transparent",4,"ngFor","ngForOf"],["class","overlay","tabindex","0",3,"click","keydown.escape",4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[1,"list-group-item","bg-transparent"],[1,"d-flex","align-items-center"],[1,"logo-circle","bi","bi-star-fill","text-primary",2,"font-size","2rem",3,"click"],[1,"ms-3",3,"click"],[1,"mt-2"],[1,"d-block","row","text-muted"],[1,"col-4"],["title","Delete Account",1,"delete-button","justify-content-end",3,"click"],[1,"bi","bi-trash"],["tabindex","0",1,"overlay",3,"click","keydown.escape"],[1,"modal-card",3,"click"],["aria-label","breadcrumb"],[1,"breadcrumb","small"],[3,"click"],[1,"mb-1"],[1,"text-muted","mb-3"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","account_name","placeholder","e.g., My Futures Account",1,"form-control"],["type","text","formControlName","broker_name","placeholder","e.g., NinjaTrader, TastyWorks",1,"form-control"],["type","text","formControlName","account_type","placeholder","e.g., Margin, Cash",1,"form-control"],["type","text","formControlName","currency","placeholder","USD",1,"form-control"],["type","number","formControlName","balance",1,"form-control"],["rows","3","placeholder","Add any additional information about this account","disabled","",1,"form-control"],[1,"form-check","form-switch","mb-2"],["type","checkbox","formControlName","track_pl","id","track_pl",1,"form-check-input"],["for","track_pl",1,"form-check-label"],[1,"text-muted","d-block","ms-4"],["type","checkbox","formControlName","include_in_analytics","id","include_in_analytics",1,"form-check-input"],["for","include_in_analytics",1,"form-check-label"],["formControlName","trading_instruments",1,"form-select"],["value",""],["value","Stocks"],["value","Options"],["value","Futures"],["value","Crypto"],[1,"d-flex","justify-content-end","gap-2","mt-3"],["type","button",1,"btn","btn-outline-secondary",3,"click"],["type","submit",1,"btn","btn-tr"],[1,"btn","btn-outline-secondary",3,"click"],[1,"btn","btn-danger",3,"click"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Trading Accounts"),y()()(),v(8,"div",6)(9,"h3"),C(10,"Your Trade Accounts"),y(),v(11,"button",7),le("click",function(){return r.toggleForm()}),C(12,"Add Account"),y()(),v(13,"div",8)(14,"h5"),C(15,"Manage your trading accounts"),y()(),ie(16,Gve,2,1,"div",9)(17,Wve,2,1,"div",10),v(18,"div",0)(19,"ul",11),ie(20,Hve,18,8,"li",12),y()(),ie(21,Kve,75,2,"div",13)(22,Xve,11,0,"div",13),y()),e&2&&(P(16),j("ngIf",r.actionSuccess),P(),j("ngIf",r.actionError),P(3),j("ngForOf",r.tradeAccounts),P(),j("ngIf",r.showForm),P(),j("ngIf",r.showDeleteConfirm))},dependencies:[Ho,zo,Go,Wo,Kn,Ys,ju,jo,yr,Bo,Uo,Di,Qt,mr,pn,es,hr],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;z-index:1050}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 25px #00000026}.list-group-item[_ngcontent-%COMP%]{cursor:pointer}.delete-button[_ngcontent-%COMP%]{color:red;display:none;margin-left:auto}.list-group-item[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{color:red;display:block}"]})};var u6=[{path:"",component:Qv,canActivate:[Ov]},{path:"home",component:Rv,canActivate:[gr]},{path:"pretrades",component:qv,canActivate:[gr]},{path:"pretradelog",component:cf,canActivate:[gr]},{path:"posttrades",component:Kv,canActivate:[gr]},{path:"posttradelog",component:uf,canActivate:[gr]},{path:"emotions",component:Yv,canActivate:[gr]},{path:"tradejournal",component:Zv,canActivate:[gr]},{path:"individualTrade",component:df,canActivate:[gr]},{path:"meditationhub",component:Jv,canActivate:[gr]},{path:"analytics",component:eb,canActivate:[gr]},{path:"admin/emotionquestion",component:Xv,canActivate:[gr]},{path:"tradeaccounts",component:q_,canActivate:[gr]},{path:"mlemotion",component:H_,canActivate:[gr]},{path:"**",redirectTo:""}];var d6={providers:[eM(),TF(u6),OM(MM())]};function Yve(t,n){t&1&&(Bs(0),v(1,"div",1),U(2,"router-outlet"),y(),zs())}function Qve(t,n){if(t&1){let e=it();v(0,"div",19)(1,"a",20),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/home"))}),U(2,"i",21),C(3,"Dashboard"),y(),v(4,"a",20),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/emotions"))}),U(5,"i",22),C(6,"Morning Check-In"),y(),v(7,"a",20),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/tradejournal"))}),U(8,"i",23),C(9,"Trade Journal"),y(),v(10,"a",20),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/meditationhub"))}),U(11,"i",24),C(12,"Meditation Hub"),y(),v(13,"a",20),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/analytics"))}),U(14,"i",25),C(15,"Analytics"),y(),v(16,"a",20),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/tradeaccounts"))}),U(17,"i",26),C(18,"Trade Accounts"),y()()}}function Zve(t,n){if(t&1){let e=it();v(0,"div",27)(1,"div",28)(2,"button",29),U(3,"i",30),y(),C(4,"\xA0\xA0 "),v(5,"p",31),C(6),y()(),v(7,"button",32),le("click",function(){ge(e);let o=ee(2);return ye(o.logOut())}),C(8,"Logout\xA0\xA0\xA0"),U(9,"i",33),y()()}if(t&2){let e=ee(2);P(2),j("disabled",!0),P(4),ze("Welcome, ",e.supabaseService.currentUsername(),"!")}}function Jve(t,n){if(t&1){let e=it();v(0,"button",34),le("click",function(){ge(e);let o=ee(2);return ye(o.navigateToUrl("/home"))}),U(1,"img",35),y()}}function ebe(t,n){if(t&1){let e=it();Bs(0),v(1,"div",2)(2,"nav",3)(3,"div",4)(4,"div",5)(5,"button",6),le("click",function(){ge(e);let o=ee();return ye(o.navigateToUrl("/home"))}),v(6,"img",7),le("click",function(){ge(e);let o=ee();return ye(o.navigateToUrl("/home"))}),y()(),v(7,"button",8),le("click",function(){ge(e);let o=ee();return ye(o.closeSidebar())}),y()(),ie(8,Qve,19,0,"div",9),y(),ie(9,Zve,10,2,"div",10),y(),v(10,"div",11)(11,"nav",12)(12,"div",13)(13,"div",14)(14,"button",15),le("click",function(){ge(e);let o=ee();return ye(o.toggleSidebar())}),U(15,"span",16),y(),ie(16,Jve,2,0,"button",17),y()()(),v(17,"div",18),U(18,"router-outlet"),y()()(),zs()}if(t&2){let e=ee();P(2),Qi("collapsed",e.sidebarCollapsed()),P(6),j("ngIf",e.loginStatus()),P(),j("ngIf",e.loginStatus()),P(),Qi("expanded",e.sidebarCollapsed()),P(6),j("ngIf",e.sidebarCollapsed())}}var K_=class t{constructor(n,e,r,o,i){this.cdr=n;this.supabaseService=e;this.router=r;this.route=o;this.platformId=i;this.loginStatus=Dl(()=>e.loginStatus())}title="TR-prototype";loginStatus;sidebarCollapsed=uo(!1);isMobile=uo(!1);resizeObserver;ngOnInit(){this.checkScreenSize(),vn(this.platformId)&&(this.sidebarCollapsed.set(this.isMobile()),this.resizeObserver=new ResizeObserver(()=>{this.checkScreenSize(),this.cdr.detectChanges()}),this.resizeObserver.observe(document.body),console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngAfterViewInit(){vn(this.platformId)&&(console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngOnDestroy(){vn(this.platformId)&&this.resizeObserver&&this.resizeObserver.disconnect()}async logOut(){await this.supabaseService.signOut(),this.router.navigateByUrl("/")}toggleSidebar(){this.sidebarCollapsed.update(n=>!n),this.cdr.detectChanges()}navigateToUrl(n){this.router.navigateByUrl(n)}closeSidebar(){this.sidebarCollapsed.set(!0),this.cdr.detectChanges()}checkScreenSize(){vn(this.platformId)&&this.isMobile.set(window.innerWidth<768)}static \u0275fac=function(e){return new(e||t)(oe($t),oe(Vt),oe(go),oe(Ii),oe(Oo))};static \u0275cmp=Tt({type:t,selectors:[["app-root"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"container-fluid","p-0"],[1,"sidebar-container"],["id","sidebar",1,"d-flex","flex-column","h-100"],[1,"p-3","flex-grow-1"],[1,"mb-3","d-flex","align-items-center","justify-content-between"],[1,"text-decoration-none","me-auto","btn","btn-link","p-0","me-3",3,"click"],["src","/trading_rehab_main_logo.png",1,"img-fluid",2,"height","36px",3,"click"],["type","button",1,"btn-close","d-md-none",3,"click"],["class","nav flex-column",4,"ngIf"],["class","p-3 border-top mt-auto",4,"ngIf"],[1,"content"],[1,"navbar","navbar-expand-lg"],[1,"container-fluid"],[1,"d-flex","align-items-center"],[1,"btn","me-2",3,"click"],[1,"navbar-toggler-icon"],["class","btn navbar-branding text-decoration-none me-auto",3,"click",4,"ngIf"],[1,"container-fluid","ps-5"],[1,"nav","flex-column"],[1,"nav-link",3,"click"],[1,"bi","bi-columns-gap","me-3"],[1,"bi","bi-brightness-high","me-3"],[1,"bi","bi-bookmark-check","me-3"],[1,"bi","bi-person-arms-up","me-3"],[1,"bi","bi-clipboard-data","me-3"],[1,"bi","bi-journals","me-3"],[1,"p-3","border-top","mt-auto"],[1,"d-flex","align-items-center","mb-2"],["title","Profile",1,"btn","btn-link","p-0","me-2",3,"disabled"],[1,"bi","bi-person-circle","text-black",2,"font-size","30px"],[1,"text-black","mb-0"],[1,"btn","btn-outline-secondary","btn-tr","w-100",3,"click"],[1,"bi","bi-box-arrow-right"],[1,"btn","navbar-branding","text-decoration-none","me-auto",3,"click"],["src","/trading-rehab-logo.png","width","50px",1,"img-fluid"]],template:function(e,r){e&1&&ie(0,Yve,3,0,"ng-container",0)(1,ebe,19,7,"ng-container",0),e&2&&(j("ngIf",!r.supabaseService.loginStatus()),P(),j("ngIf",r.supabaseService.loginStatus()))},dependencies:[Qt,pn,lI],styles:[".sidebar-container[_ngcontent-%COMP%]{display:flex;width:100%;position:relative}#sidebar[_ngcontent-%COMP%]{width:250px;position:fixed;top:0;left:0;height:100vh;z-index:999;background:#634aff0d;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);transition:all .3s;box-shadow:0 0 10px #0000001a}#sidebar.collapsed[_ngcontent-%COMP%]{margin-left:-250px}.content[_ngcontent-%COMP%]{width:calc(100% - 250px);margin-left:250px;transition:all .3s;min-height:100vh}.content.expanded[_ngcontent-%COMP%]{width:100%;margin-left:0}@media (max-width: 768px){#sidebar[_ngcontent-%COMP%]{margin-left:-250px}#sidebar[_ngcontent-%COMP%]:not(.collapsed){margin-left:0}.content[_ngcontent-%COMP%]{width:100%;margin-left:0}}.nav-link[_ngcontent-%COMP%]{padding:15px 20px;color:#333;border-bottom:1px solid #ddd}.nav-link[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.navbar[_ngcontent-%COMP%]{padding:15px 10px}"]})};GM(K_,d6).catch(t=>console.error(t));
