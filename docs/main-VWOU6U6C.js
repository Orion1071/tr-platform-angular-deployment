import{b as cR,c as uR,f as l9,g as dR}from"./chunk-65CJINC2.js";import{a as fe,b as qe,c as p0,e as yt,f as Qi,g as mh,h as a9}from"./chunk-VOSPIT4N.js";var dT=yt(uT=>{"use strict";Object.defineProperty(uT,"__esModule",{value:!0});var cT=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}};uT.default=cT});var fT=yt(wg=>{"use strict";var tL=wg&&wg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(wg,"__esModule",{value:!0});var Rne=tL((dR(),a9(l9))),Mne=tL(dT()),pT=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=Rne.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=Object.assign({},this.headers),this.headers[n]=e,this}then(n,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var s,a,l;let c=null,u=null,d=null,p=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){let x=await i.text();x===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=x:u=JSON.parse(x))}let h=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),g=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");h&&g&&g.length>1&&(d=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,p=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let h=await i.text();try{c=JSON.parse(h),Array.isArray(c)&&i.status===404&&(u=[],c=null,p=200,f="OK")}catch{i.status===404&&h===""?(p=204,f="No Content"):c={message:h}}if(c&&this.isMaybeSingle&&(!((l=c?.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,p=200,f="OK"),c&&this.shouldThrowOnError)throw new Mne.default(c)}return{error:c,data:u,count:d,status:p,statusText:f}});return this.shouldThrowOnError||(o=o.catch(i=>{var s,a,l;return{error:{message:`${(s=i?.name)!==null&&s!==void 0?s:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),o.then(n,e)}};wg.default=pT});var hT=yt(Cg=>{"use strict";var Fne=Cg&&Cg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Cg,"__esModule",{value:!0});var One=Fne(fT()),mT=class extends One.default{select(n){let e=!1,r=(n??"*").split("").map(o=>/\s/.test(o)&&!e?"":(o==='"'&&(e=!e),o)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:e=!0,nullsFirst:r,foreignTable:o,referencedTable:i=o}={}){let s=i?`${i}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:r=e}={}){let o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,e,{foreignTable:r,referencedTable:o=r}={}){let i=typeof o>"u"?"offset":`${o}.offset`,s=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(s,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:e=!1,settings:r=!1,buffers:o=!1,wal:i=!1,format:s="text"}={}){var a;let l=[n?"analyze":null,e?"verbose":null,r?"settings":null,o?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`,s==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};Cg.default=mT});var zx=yt(_g=>{"use strict";var Pne=_g&&_g.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(_g,"__esModule",{value:!0});var Lne=Pne(hT()),gT=class extends Lne.default{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}in(n,e){let r=Array.from(new Set(e)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${r})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:r,type:o}={}){let i="";o==="plain"?i="pl":o==="phrase"?i="ph":o==="websearch"&&(i="w");let s=r===void 0?"":`(${r})`;return this.url.searchParams.append(n,`${i}fts${s}.${e}`),this}match(n){return Object.entries(n).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(n,e,r){return this.url.searchParams.append(n,`not.${e}.${r}`),this}or(n,{foreignTable:e,referencedTable:r=e}={}){let o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,e,r){return this.url.searchParams.append(n,`${e}.${r}`),this}};_g.default=gT});var vT=yt(Eg=>{"use strict";var $ne=Eg&&Eg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Eg,"__esModule",{value:!0});var Ig=$ne(zx()),yT=class{constructor(n,{headers:e={},schema:r,fetch:o}){this.url=n,this.headers=e,this.schema=r,this.fetch=o}select(n,{head:e=!1,count:r}={}){let o=e?"HEAD":"GET",i=!1,s=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),new Ig.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:e,defaultToNull:r=!0}={}){let o="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(n)){let s=n.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(s.length>0){let a=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new Ig.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:e,ignoreDuplicates:r=!1,count:o,defaultToNull:i=!0}={}){let s="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),o&&a.push(`count=${o}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(n)){let l=n.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){let c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new Ig.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:e}={}){let r="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),e&&o.push(`count=${e}`),this.headers.Prefer=o.join(","),new Ig.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){let e="DELETE",r=[];return n&&r.push(`count=${n}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new Ig.default({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Eg.default=yT});var nL=yt(Ux=>{"use strict";Object.defineProperty(Ux,"__esModule",{value:!0});Ux.version=void 0;Ux.version="0.0.0-automated"});var rL=yt(jx=>{"use strict";Object.defineProperty(jx,"__esModule",{value:!0});jx.DEFAULT_HEADERS=void 0;var Vne=nL();jx.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${Vne.version}`}});var iL=yt(Sg=>{"use strict";var oL=Sg&&Sg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Sg,"__esModule",{value:!0});var Bne=oL(vT()),zne=oL(zx()),Une=rL(),xT=class t{constructor(n,{headers:e={},schema:r,fetch:o}={}){this.url=n,this.headers=Object.assign(Object.assign({},Une.DEFAULT_HEADERS),e),this.schemaName=r,this.fetch=o}from(n){let e=new URL(`${this.url}/${n}`);return new Bne.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new t(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,e={},{head:r=!1,get:o=!1,count:i}={}){let s,a=new URL(`${this.url}/rpc/${n}`),l;r||o?(s=r?"HEAD":"GET",Object.entries(e).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{a.searchParams.append(u,d)})):(s="POST",l=e);let c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new zne.default({method:s,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};Sg.default=xT});var pL=yt(yr=>{"use strict";var sf=yr&&yr.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(yr,"__esModule",{value:!0});yr.PostgrestError=yr.PostgrestBuilder=yr.PostgrestTransformBuilder=yr.PostgrestFilterBuilder=yr.PostgrestQueryBuilder=yr.PostgrestClient=void 0;var sL=sf(iL());yr.PostgrestClient=sL.default;var aL=sf(vT());yr.PostgrestQueryBuilder=aL.default;var lL=sf(zx());yr.PostgrestFilterBuilder=lL.default;var cL=sf(hT());yr.PostgrestTransformBuilder=cL.default;var uL=sf(fT());yr.PostgrestBuilder=uL.default;var dL=sf(dT());yr.PostgrestError=dL.default;yr.default={PostgrestClient:sL.default,PostgrestQueryBuilder:aL.default,PostgrestFilterBuilder:lL.default,PostgrestTransformBuilder:cL.default,PostgrestBuilder:uL.default,PostgrestError:dL.default}});var Z3=yt((gm,Y3)=>{"use strict";var Zae=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Nd=Zae();Y3.exports=gm=Nd.fetch;Nd.fetch&&(gm.default=Nd.fetch.bind(Nd));gm.Headers=Nd.Headers;gm.Request=Nd.Request;gm.Response=Nd.Response});var Q3=yt(()=>{"use strict"});var $V=yt((LV,bN)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(LV,typeof bN=="object"&&bN,typeof define=="function"&&define)});var BV=yt((VV,wN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(VV,typeof wN=="object"&&wN,typeof define=="function"&&define)});var UV=yt((zV,CN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(zV,typeof CN=="object"&&CN,typeof define=="function"&&define)});var GV=yt((jV,_N)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(jV,typeof _N=="object"&&_N,typeof define=="function"&&define)});var HV=yt((WV,IN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(WV,typeof IN=="object"&&IN,typeof define=="function"&&define)});var KV=yt((qV,EN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(qV,typeof EN=="object"&&EN,typeof define=="function"&&define)});var Ew=yt(()=>{"use strict"});var XV=yt((nqe,Sw)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(I,_,E){var S=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[I,b(t)]:I??x(),3),S),M=new f(S),R=function(){for(var L=M.g(o),G=a,W=0;L<l;)L=(L+W)*r,G*=r,W=M.g(1);for(;L>=c;)L/=2,G/=2,W>>>=1;return(L+W)/G};return R.int32=function(){return M.g(4)|0},R.quick=function(){return M.g(4)/4294967296},R.double=R,g(b(M.S),t),(_.pass||E||function(L,G,W,q){return q&&(q.S&&m(q,M),L.state=function(){return m(M,{})}),W?(n[s]=L,G):L})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(I){var _,E=I.length,S=this,D=0,M=S.i=S.j=0,R=S.S=[];for(E||(I=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[M=u&M+I[D%E]+(_=R[D])],R[M]=_;(S.g=function(L){for(var G,W=0,q=S.i,X=S.j,K=S.S;L--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return S.i=q,S.j=X,W})(r)}function m(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function h(I,_){var E=[],S=typeof I,D;if(_&&S=="object")for(D in I)try{E.push(h(I[D],_-1))}catch{}return E.length?E:S=="string"?I:I+"\0"}function g(I,_){for(var E=I+"",S,D=0;D<E.length;)_[u&D]=u&(S^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(I){return String.fromCharCode.apply(0,I)}if(g(n.random(),t),typeof Sw=="object"&&Sw.exports){Sw.exports=p;try{d=Ew()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var ZV=yt((rqe,YV)=>{"use strict";var Due=$V(),Nue=BV(),kue=UV(),Aue=GV(),Rue=HV(),Mue=KV(),Bd=XV();Bd.alea=Due;Bd.xor128=Nue;Bd.xorwow=kue;Bd.xorshift7=Aue;Bd.xor4096=Rue;Bd.tychei=Mue;YV.exports=Bd});var Sj=yt((Ej,Pk)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(Ej,typeof Pk=="object"&&Pk,typeof define=="function"&&define)});var Dj=yt((Tj,Lk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(Tj,typeof Lk=="object"&&Lk,typeof define=="function"&&define)});var kj=yt((Nj,$k)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(Nj,typeof $k=="object"&&$k,typeof define=="function"&&define)});var Rj=yt((Aj,Vk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(Aj,typeof Vk=="object"&&Vk,typeof define=="function"&&define)});var Fj=yt((Mj,Bk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(Mj,typeof Bk=="object"&&Bk,typeof define=="function"&&define)});var Pj=yt((Oj,zk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(Oj,typeof zk=="object"&&zk,typeof define=="function"&&define)});var Lj=yt((JEt,EC)=>{"use strict";(function(t,n){var e=(0,eval)("this"),r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(I,_,E){var S=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[I,b(t)]:I??x(),3),S),M=new f(S),R=function(){for(var L=M.g(o),G=a,W=0;L<l;)L=(L+W)*r,G*=r,W=M.g(1);for(;L>=c;)L/=2,G/=2,W>>>=1;return(L+W)/G};return R.int32=function(){return M.g(4)|0},R.quick=function(){return M.g(4)/4294967296},R.double=R,g(b(M.S),t),(_.pass||E||function(L,G,W,q){return q&&(q.S&&m(q,M),L.state=function(){return m(M,{})}),W?(n[s]=L,G):L})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(I){var _,E=I.length,S=this,D=0,M=S.i=S.j=0,R=S.S=[];for(E||(I=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[M=u&M+I[D%E]+(_=R[D])],R[M]=_;(S.g=function(L){for(var G,W=0,q=S.i,X=S.j,K=S.S;L--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return S.i=q,S.j=X,W})(r)}function m(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function h(I,_){var E=[],S=typeof I,D;if(_&&S=="object")for(D in I)try{E.push(h(I[D],_-1))}catch{}return E.length?E:S=="string"?I:I+"\0"}function g(I,_){for(var E=I+"",S,D=0;D<E.length;)_[u&D]=u&(S^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(I){return String.fromCharCode.apply(0,I)}if(g(n.random(),t),typeof EC=="object"&&EC.exports){EC.exports=p;try{d=Ew()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var Uk=yt((eSt,$j)=>{"use strict";var Yme=Sj(),Zme=Dj(),Qme=kj(),Jme=Rj(),ehe=Fj(),the=Pj(),np=Lj();np.alea=Yme;np.xor128=Zme;np.xorwow=Qme;np.xorshift7=Jme;np.xor4096=ehe;np.tychei=the;$j.exports=np});var KW=yt((qW,CA)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(qW,typeof CA=="object"&&CA,typeof define=="function"&&define)});var YW=yt((XW,_A)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(XW,typeof _A=="object"&&_A,typeof define=="function"&&define)});var QW=yt((ZW,IA)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(ZW,typeof IA=="object"&&IA,typeof define=="function"&&define)});var eH=yt((JW,EA)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(JW,typeof EA=="object"&&EA,typeof define=="function"&&define)});var nH=yt((tH,SA)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],x=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,x=Math.max(x,u.length)),f=0,m=-32;m<x;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(tH,typeof SA=="object"&&SA,typeof define=="function"&&define)});var oH=yt((rH,TA)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(rH,typeof TA=="object"&&TA,typeof define=="function"&&define)});var iH=yt((gOt,zC)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(I,_,E){var S=[];_=_==!0?{entropy:!0}:_||{};var D=g(h(_.entropy?[I,b(t)]:I??x(),3),S),M=new f(S),R=function(){for(var L=M.g(o),G=a,W=0;L<l;)L=(L+W)*r,G*=r,W=M.g(1);for(;L>=c;)L/=2,G/=2,W>>>=1;return(L+W)/G};return R.int32=function(){return M.g(4)|0},R.quick=function(){return M.g(4)/4294967296},R.double=R,g(b(M.S),t),(_.pass||E||function(L,G,W,q){return q&&(q.S&&m(q,M),L.state=function(){return m(M,{})}),W?(n[s]=L,G):L})(R,D,"global"in _?_.global:this==n,_.state)}n["seed"+s]=p;function f(I){var _,E=I.length,S=this,D=0,M=S.i=S.j=0,R=S.S=[];for(E||(I=[E++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[M=u&M+I[D%E]+(_=R[D])],R[M]=_;(S.g=function(L){for(var G,W=0,q=S.i,X=S.j,K=S.S;L--;)G=K[q=u&q+1],W=W*r+K[u&(K[q]=K[X=u&X+G])+(K[X]=G)];return S.i=q,S.j=X,W})(r)}function m(I,_){return _.i=I.i,_.j=I.j,_.S=I.S.slice(),_}function h(I,_){var E=[],S=typeof I,D;if(_&&S=="object")for(D in I)try{E.push(h(I[D],_-1))}catch{}return E.length?E:S=="string"?I:I+"\0"}function g(I,_){for(var E=I+"",S,D=0;D<E.length;)_[u&D]=u&(S^=_[u&D]*19)+E.charCodeAt(D++);return b(_)}function x(){try{var I;return d&&(I=d.randomBytes)?I=I(r):(I=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(I)),b(I)}catch{var _=e.navigator,E=_&&_.plugins;return[+new Date,e,E,e.screen,b(t)]}}function b(I){return String.fromCharCode.apply(0,I)}if(g(n.random(),t),typeof zC=="object"&&zC.exports){zC.exports=p;try{d=Ew()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var aH=yt((yOt,sH)=>{"use strict";var mye=KW(),hye=YW(),gye=QW(),yye=eH(),vye=nH(),xye=oH(),op=iH();op.alea=mye;op.xor128=hye;op.xorwow=gye;op.xorshift7=yye;op.xor4096=vye;op.tychei=xye;sH.exports=op});function fR(t,n){return Object.is(t,n)}var Un=null,hh=!1,FI=1,Zr=Symbol("SIGNAL");function St(t){let n=Un;return Un=t,n}function mR(){return Un}function c9(){return hh}var xu={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function m0(t){if(hh)throw new Error("");if(Un===null)return;Un.consumerOnSignalRead(t);let n=Un.nextProducerIndex++;if(g0(Un),n<Un.producerNode.length&&Un.producerNode[n]!==t&&gh(Un)){let e=Un.producerNode[n];h0(e,Un.producerIndexOfThis[n])}Un.producerNode[n]!==t&&(Un.producerNode[n]=t,Un.producerIndexOfThis[n]=gh(Un)?xR(t,Un,n):0),Un.producerLastReadVersion[n]=t.version}function u9(){FI++}function hR(t){if(!(gh(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===FI)){if(!t.producerMustRecompute(t)&&!vh(t)){pR(t);return}t.producerRecomputeValue(t),pR(t)}}function gR(t){if(t.liveConsumerNode===void 0)return;let n=hh;hh=!0;try{for(let e of t.liveConsumerNode)e.dirty||vR(e)}finally{hh=n}}function yR(){return Un?.consumerAllowSignalWrites!==!1}function vR(t){t.dirty=!0,gR(t),t.consumerMarkedDirty?.(t)}function pR(t){t.dirty=!1,t.lastCleanEpoch=FI}function hp(t){return t&&(t.nextProducerIndex=0),St(t)}function yh(t,n){if(St(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(gh(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)h0(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function vh(t){g0(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(hR(e),r!==e.version))return!0}return!1}function gp(t){if(g0(t),gh(t))for(let n=0;n<t.producerNode.length;n++)h0(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function xR(t,n,e){if(bR(t),t.liveConsumerNode.length===0&&wR(t))for(let r=0;r<t.producerNode.length;r++)t.producerIndexOfThis[r]=xR(t.producerNode[r],t,r);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function h0(t,n){if(bR(t),t.liveConsumerNode.length===1&&wR(t))for(let r=0;r<t.producerNode.length;r++)h0(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];g0(o),o.producerIndexOfThis[r]=n}}function gh(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function g0(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function bR(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function wR(t){return t.producerNode!==void 0}function CR(t){let n=Object.create(d9);n.computation=t;let e=()=>{if(hR(n),m0(n),n.value===f0)throw n.error;return n.value};return e[Zr]=n,e}var AI=Symbol("UNSET"),RI=Symbol("COMPUTING"),f0=Symbol("ERRORED"),d9=qe(fe({},xu),{value:AI,dirty:!0,error:null,equal:fR,kind:"computed",producerMustRecompute(t){return t.value===AI||t.value===RI},producerRecomputeValue(t){if(t.value===RI)throw new Error("Detected cycle in computations.");let n=t.value;t.value=RI;let e=hp(t),r,o=!1;try{r=t.computation(),St(null),o=n!==AI&&n!==f0&&r!==f0&&t.equal(n,r)}catch(i){r=f0,t.error=i}finally{yh(t,e)}if(o){t.value=n;return}t.value=r,t.version++}});function p9(){throw new Error}var _R=p9;function IR(){_R()}function ER(t){_R=t}var f9=null;function SR(t){let n=Object.create(OI);n.value=t;let e=()=>(m0(n),n.value);return e[Zr]=n,e}function y0(t,n){yR()||IR(),t.equal(t.value,n)||(t.value=n,m9(t))}function TR(t,n){yR()||IR(),y0(t,n(t.value))}var OI=qe(fe({},xu),{equal:fR,value:void 0,kind:"signal"});function m9(t){t.version++,u9(),gR(t),f9?.()}function DR(t,n,e){let r=Object.create(h9);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;let o=l=>{r.cleanupFn=l};function i(l){return l.fn===null&&l.schedule===null}function s(l){i(l)||(gp(l),l.cleanupFn(),l.fn=null,l.schedule=null,l.cleanupFn=MI)}let a=()=>{if(r.fn===null)return;if(c9())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(r.dirty=!1,r.hasRun&&!vh(r))return;r.hasRun=!0;let l=hp(r);try{r.cleanupFn(),r.cleanupFn=MI,r.fn(o)}finally{yh(r,l)}};return r.ref={notify:()=>vR(r),run:a,cleanup:()=>r.cleanupFn(),destroy:()=>s(r),[Zr]:r},r.ref}var MI=()=>{},h9=qe(fe({},xu),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule!==null&&t.schedule(t.ref)},hasRun:!1,cleanupFn:MI});function Qe(t){return typeof t=="function"}function yp(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var v0=yp(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function bu(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var gn=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Qe(r))try{r()}catch(i){n=i instanceof v0?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{NR(i)}catch(s){n=n??[],s instanceof v0?n=[...n,...s.errors]:n.push(s)}}if(n)throw new v0(n)}}add(n){var e;if(n&&n!==this)if(this.closed)NR(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&bu(e,n)}remove(n){let{_finalizers:e}=this;e&&bu(e,n),n instanceof t&&n._removeParent(this)}};gn.EMPTY=(()=>{let t=new gn;return t.closed=!0,t})();var PI=gn.EMPTY;function x0(t){return t instanceof gn||t&&"closed"in t&&Qe(t.remove)&&Qe(t.add)&&Qe(t.unsubscribe)}function NR(t){Qe(t)?t():t.unsubscribe()}var Ci={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var vp={setTimeout(t,n,...e){let{delegate:r}=vp;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=vp;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function b0(t){vp.setTimeout(()=>{let{onUnhandledError:n}=Ci;if(n)n(t);else throw t})}function xh(){}var kR=LI("C",void 0,void 0);function AR(t){return LI("E",void 0,t)}function RR(t){return LI("N",t,void 0)}function LI(t,n,e){return{kind:t,value:n,error:e}}var wu=null;function xp(t){if(Ci.useDeprecatedSynchronousErrorHandling){let n=!wu;if(n&&(wu={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=wu;if(wu=null,e)throw r}}else t()}function MR(t){Ci.useDeprecatedSynchronousErrorHandling&&wu&&(wu.errorThrown=!0,wu.error=t)}var Cu=class extends gn{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,x0(n)&&n.add(this)):this.destination=v9}static create(n,e,r){return new Fs(n,e,r)}next(n){this.isStopped?VI(RR(n),this):this._next(n)}error(n){this.isStopped?VI(AR(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?VI(kR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},g9=Function.prototype.bind;function $I(t,n){return g9.call(t,n)}var BI=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){w0(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){w0(r)}else w0(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){w0(e)}}},Fs=class extends Cu{constructor(n,e,r){super();let o;if(Qe(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&Ci.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&$I(n.next,i),error:n.error&&$I(n.error,i),complete:n.complete&&$I(n.complete,i)}):o=n}this.destination=new BI(o)}};function w0(t){Ci.useDeprecatedSynchronousErrorHandling?MR(t):b0(t)}function y9(t){throw t}function VI(t,n){let{onStoppedNotification:e}=Ci;e&&vp.setTimeout(()=>e(t,n))}var v9={closed:!0,next:xh,error:y9,complete:xh};var bp=typeof Symbol=="function"&&Symbol.observable||"@@observable";function wo(t){return t}function zI(...t){return UI(t)}function UI(t){return t.length===0?wo:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var vt=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=b9(e)?e:new Fs(e,r,o);return xp(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=FR(r),new r((o,i)=>{let s=new Fs({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[bp](){return this}pipe(...e){return UI(e)(this)}toPromise(e){return e=FR(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return t.create=n=>new t(n),t})();function FR(t){var n;return(n=t??Ci.Promise)!==null&&n!==void 0?n:Promise}function x9(t){return t&&Qe(t.next)&&Qe(t.error)&&Qe(t.complete)}function b9(t){return t&&t instanceof Cu||x9(t)&&x0(t)}function jI(t){return Qe(t?.lift)}function ut(t){return n=>{if(jI(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function dt(t,n,e,r,o){return new GI(t,n,e,r,o)}var GI=class extends Cu{constructor(n,e,r,o,i,s){super(n),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){n.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function wp(){return ut((t,n)=>{let e=null;t._refCount++;let r=dt(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var Cp=class extends vt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,jI(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new gn;let e=this.getSubject();n.add(this.source.subscribe(dt(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=gn.EMPTY)}return n}refCount(){return wp()(this)}};var OR=yp(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var vn=(()=>{class t extends vt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new C0(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new OR}next(e){xp(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){xp(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){xp(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?PI:(this.currentObservers=null,i.push(e),new gn(()=>{this.currentObservers=null,bu(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new vt;return e.source=this,e}}return t.create=(n,e)=>new C0(n,e),t})(),C0=class extends vn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:PI}};var cr=class extends vn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var WI={now(){return(WI.delegate||Date).now()},delegate:void 0};var _0=class extends gn{constructor(n,e){super()}schedule(n,e=0){return this}};var bh={setInterval(t,n,...e){let{delegate:r}=bh;return r?.setInterval?r.setInterval(t,n,...e):setInterval(t,n,...e)},clearInterval(t){let{delegate:n}=bh;return(n?.clearInterval||clearInterval)(t)},delegate:void 0};var I0=class extends _0{constructor(n,e){super(n,e),this.scheduler=n,this.work=e,this.pending=!1}schedule(n,e=0){var r;if(this.closed)return this;this.state=n;let o=this.id,i=this.scheduler;return o!=null&&(this.id=this.recycleAsyncId(i,o,e)),this.pending=!0,this.delay=e,this.id=(r=this.id)!==null&&r!==void 0?r:this.requestAsyncId(i,this.id,e),this}requestAsyncId(n,e,r=0){return bh.setInterval(n.flush.bind(n,this),r)}recycleAsyncId(n,e,r=0){if(r!=null&&this.delay===r&&this.pending===!1)return e;e!=null&&bh.clearInterval(e)}execute(n,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;let r=this._execute(n,e);if(r)return r;this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(n,e){let r=!1,o;try{this.work(n)}catch(i){r=!0,o=i||new Error("Scheduled action threw falsy error")}if(r)return this.unsubscribe(),o}unsubscribe(){if(!this.closed){let{id:n,scheduler:e}=this,{actions:r}=e;this.work=this.state=this.scheduler=null,this.pending=!1,bu(r,this),n!=null&&(this.id=this.recycleAsyncId(e,n,null)),this.delay=null,super.unsubscribe()}}};var _p=class t{constructor(n,e=t.now){this.schedulerActionCtor=n,this.now=e}schedule(n,e=0,r){return new this.schedulerActionCtor(this,n).schedule(r,e)}};_p.now=WI.now;var E0=class extends _p{constructor(n,e=_p.now){super(n,e),this.actions=[],this._active=!1}flush(n){let{actions:e}=this;if(this._active){e.push(n);return}let r;this._active=!0;do if(r=n.execute(n.state,n.delay))break;while(n=e.shift());if(this._active=!1,r){for(;n=e.shift();)n.unsubscribe();throw r}}};var PR=new E0(I0);var Qr=new vt(t=>t.complete());function LR(t){return t&&Qe(t.schedule)}function $R(t){return t[t.length-1]}function S0(t){return Qe($R(t))?t.pop():void 0}function Dl(t){return LR($R(t))?t.pop():void 0}function BR(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})}function VR(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function _u(t){return this instanceof _u?(this.v=t,this):new _u(t)}function zR(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){r[f]&&(o[f]=function(h){return new Promise(function(g,x){i.push([f,h,g,x])>1||l(f,h)})},m&&(o[f]=m(o[f])))}function l(f,m){try{c(r[f](m))}catch(h){p(i[0][3],h)}}function c(f){f.value instanceof _u?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function p(f,m){f(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function UR(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof VR=="function"?VR(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}var T0=t=>t&&typeof t.length=="number"&&typeof t!="function";function D0(t){return Qe(t?.then)}function N0(t){return Qe(t[bp])}function k0(t){return Symbol.asyncIterator&&Qe(t?.[Symbol.asyncIterator])}function A0(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function w9(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var R0=w9();function M0(t){return Qe(t?.[R0])}function F0(t){return zR(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield _u(e.read());if(o)return yield _u(void 0);yield yield _u(r)}}finally{e.releaseLock()}})}function O0(t){return Qe(t?.getReader)}function xn(t){if(t instanceof vt)return t;if(t!=null){if(N0(t))return C9(t);if(T0(t))return _9(t);if(D0(t))return I9(t);if(k0(t))return jR(t);if(M0(t))return E9(t);if(O0(t))return S9(t)}throw A0(t)}function C9(t){return new vt(n=>{let e=t[bp]();if(Qe(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function _9(t){return new vt(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function I9(t){return new vt(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,b0)})}function E9(t){return new vt(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function jR(t){return new vt(n=>{T9(t,n).catch(e=>n.error(e))})}function S9(t){return jR(F0(t))}function T9(t,n){var e,r,o,i;return BR(this,void 0,void 0,function*(){try{for(e=UR(t);r=yield e.next(),!r.done;){let s=r.value;if(n.next(s),n.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function Jr(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function P0(t,n=0){return ut((e,r)=>{e.subscribe(dt(r,o=>Jr(r,t,()=>r.next(o),n),()=>Jr(r,t,()=>r.complete(),n),o=>Jr(r,t,()=>r.error(o),n)))})}function L0(t,n=0){return ut((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function GR(t,n){return xn(t).pipe(L0(n),P0(n))}function WR(t,n){return xn(t).pipe(L0(n),P0(n))}function HR(t,n){return new vt(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function qR(t,n){return new vt(e=>{let r;return Jr(e,n,()=>{r=t[R0](),Jr(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>Qe(r?.return)&&r.return()})}function $0(t,n){if(!t)throw new Error("Iterable cannot be null");return new vt(e=>{Jr(e,n,()=>{let r=t[Symbol.asyncIterator]();Jr(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function KR(t,n){return $0(F0(t),n)}function XR(t,n){if(t!=null){if(N0(t))return GR(t,n);if(T0(t))return HR(t,n);if(D0(t))return WR(t,n);if(k0(t))return $0(t,n);if(M0(t))return qR(t,n);if(O0(t))return KR(t,n)}throw A0(t)}function bn(t,n){return n?XR(t,n):xn(t)}function Ue(...t){let n=Dl(t);return bn(t,n)}function Nl(t,n){let e=Qe(t)?t:()=>t,r=o=>o.error(e());return new vt(n?o=>n.schedule(r,0,o):r)}function HI(t){return!!t&&(t instanceof vt||Qe(t.lift)&&Qe(t.subscribe))}var Os=yp(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function Ge(t,n){return ut((e,r)=>{let o=0;e.subscribe(dt(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:D9}=Array;function N9(t,n){return D9(n)?t(...n):t(n)}function V0(t){return Ge(n=>N9(t,n))}var{isArray:k9}=Array,{getPrototypeOf:A9,prototype:R9,keys:M9}=Object;function B0(t){if(t.length===1){let n=t[0];if(k9(n))return{args:n,keys:null};if(F9(n)){let e=M9(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function F9(t){return t&&typeof t=="object"&&A9(t)===R9}function z0(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function Ip(...t){let n=Dl(t),e=S0(t),{args:r,keys:o}=B0(t);if(r.length===0)return bn([],n);let i=new vt(O9(r,n,o?s=>z0(o,s):wo));return e?i.pipe(V0(e)):i}function O9(t,n,e=wo){return r=>{YR(n,()=>{let{length:o}=t,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)YR(n,()=>{let c=bn(t[l],n),u=!1;c.subscribe(dt(r,d=>{i[l]=d,u||(u=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function YR(t,n,e){t?Jr(e,t,n):n()}function ZR(t,n,e,r,o,i,s,a){let l=[],c=0,u=0,d=!1,p=()=>{d&&!l.length&&!c&&n.complete()},f=h=>c<r?m(h):l.push(h),m=h=>{i&&n.next(h),c++;let g=!1;xn(e(h,u++)).subscribe(dt(n,x=>{o?.(x),i?f(x):n.next(x)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){let x=l.shift();s?Jr(n,s,()=>m(x)):m(x)}p()}catch(x){n.error(x)}}))};return t.subscribe(dt(n,f,()=>{d=!0,p()})),()=>{a?.()}}function jn(t,n,e=1/0){return Qe(n)?jn((r,o)=>Ge((i,s)=>n(r,i,o,s))(xn(t(r,o))),e):(typeof n=="number"&&(e=n),ut((r,o)=>ZR(r,o,t,e)))}function qI(t=1/0){return jn(wo,t)}function QR(){return qI(1)}function kl(...t){return QR()(bn(t,Dl(t)))}function U0(t){return new vt(n=>{xn(t()).subscribe(n)})}function wh(...t){let n=S0(t),{args:e,keys:r}=B0(t),o=new vt(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let d=!1;xn(e[u]).subscribe(dt(i,p=>{d||(d=!0,c--),a[u]=p},()=>l--,void 0,()=>{(!l||!d)&&(c||i.next(r?z0(r,a):a),i.complete())}))}});return n?o.pipe(V0(n)):o}function Lr(t,n){return ut((e,r)=>{let o=0;e.subscribe(dt(r,i=>t.call(n,i,o++)&&r.next(i)))})}function Ji(t){return ut((n,e)=>{let r=null,o=!1,i;r=n.subscribe(dt(e,void 0,void 0,s=>{i=xn(t(s,Ji(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function JR(t,n,e,r,o){return(i,s)=>{let a=e,l=n,c=0;i.subscribe(dt(s,u=>{let d=c++;l=a?t(l,u,d):(a=!0,u),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function Al(t,n){return Qe(n)?jn(t,n,1):jn(t,1)}function KI(t,n=PR){return ut((e,r)=>{let o=null,i=null,s=null,a=()=>{if(o){o.unsubscribe(),o=null;let c=i;i=null,r.next(c)}};function l(){let c=s+t,u=n.now();if(u<c){o=this.schedule(void 0,c-u),r.add(o);return}a()}e.subscribe(dt(r,c=>{i=c,s=n.now(),o||(o=n.schedule(l,t),r.add(o))},()=>{a(),r.complete()},void 0,()=>{i=o=null}))})}function Rl(t){return ut((n,e)=>{let r=!1;n.subscribe(dt(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function Co(t){return t<=0?()=>Qr:ut((n,e)=>{let r=0;n.subscribe(dt(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function j0(t=P9){return ut((n,e)=>{let r=!1;n.subscribe(dt(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function P9(){return new Os}function Ps(t){return ut((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function Ls(t,n){let e=arguments.length>=2;return r=>r.pipe(t?Lr((o,i)=>t(o,i,r)):wo,Co(1),e?Rl(n):j0(()=>new Os))}function Ep(t){return t<=0?()=>Qr:ut((n,e)=>{let r=[];n.subscribe(dt(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function XI(t,n){let e=arguments.length>=2;return r=>r.pipe(t?Lr((o,i)=>t(o,i,r)):wo,Ep(1),e?Rl(n):j0(()=>new Os))}function YI(t,n){return ut(JR(t,n,arguments.length>=2,!0))}function QI(t={}){let{connector:n=()=>new vn,resetOnError:e=!0,resetOnComplete:r=!0,resetOnRefCountZero:o=!0}=t;return i=>{let s,a,l,c=0,u=!1,d=!1,p=()=>{a?.unsubscribe(),a=void 0},f=()=>{p(),s=l=void 0,u=d=!1},m=()=>{let h=s;f(),h?.unsubscribe()};return ut((h,g)=>{c++,!d&&!u&&p();let x=l=l??n();g.add(()=>{c--,c===0&&!d&&!u&&(a=ZI(m,o))}),x.subscribe(g),!s&&c>0&&(s=new Fs({next:b=>x.next(b),error:b=>{d=!0,p(),a=ZI(f,e,b),x.error(b)},complete:()=>{u=!0,p(),a=ZI(f,r),x.complete()}}),xn(h).subscribe(s))})(i)}}function ZI(t,n,...e){if(n===!0){t();return}if(n===!1)return;let r=new Fs({next:()=>{r.unsubscribe(),t()}});return xn(n(...e)).subscribe(r)}function JI(t){return Lr((n,e)=>t<=e)}function Ch(...t){let n=Dl(t);return ut((e,r)=>{(n?kl(t,e,n):kl(t,e)).subscribe(r)})}function _o(t,n){return ut((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(dt(r,l=>{o?.unsubscribe();let c=0,u=i++;xn(t(l,u)).subscribe(o=dt(r,d=>r.next(n?n(l,d,u,c++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function _h(t){return ut((n,e)=>{xn(t).subscribe(dt(e,()=>e.complete(),xh)),!e.closed&&n.subscribe(e)})}function In(t,n,e){let r=Qe(t)||n||e?{next:t,error:n,complete:e}:t;return r?ut((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(dt(i,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),i.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):wo}var V2="https://g.co/ng/security#xss",Ie=class extends Error{code;constructor(n,e){super(kv(n,e)),this.code=n}};function kv(t,n){return`${`NG0${Math.abs(t)}`}${n?": "+n:""}`}var B2=Symbol("InputSignalNode#UNSET"),L9=qe(fe({},OI),{transformFn:void 0,applyValueToInputSignal(t,n){y0(t,n)}});function z2(t,n){let e=Object.create(L9);e.value=t,e.transformFn=n?.transform;function r(){if(m0(e),e.value===B2)throw new Ie(-950,!1);return e.value}return r[Zr]=e,r}function Lh(t){return{toString:t}.toString()}var G0="__parameters__";function $9(t){return function(...e){if(t){let r=t(...e);for(let o in r)this[o]=r[o]}}}function U2(t,n,e){return Lh(()=>{let r=$9(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,c,u){let d=l.hasOwnProperty(G0)?l[G0]:Object.defineProperty(l,G0,{value:[]})[G0];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var $s=globalThis;function Qt(t){for(let n in t)if(t[n]===Qt)return n;throw Error("Could not find renamed property on target object.")}function V9(t,n){for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Vr(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Vr).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let n=t.toString();if(n==null)return""+n;let e=n.indexOf(`
`);return e===-1?n:n.substring(0,e)}function pE(t,n){return t==null||t===""?n===null?"":n:n==null||n===""?t:t+" "+n}var B9=Qt({__forward_ref__:Qt});function ur(t){return t.__forward_ref__=ur,t.toString=function(){return Vr(this())},t}function $r(t){return j2(t)?t():t}function j2(t){return typeof t=="function"&&t.hasOwnProperty(B9)&&t.__forward_ref__===ur}function be(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Zn(t){return{providers:t.providers||[],imports:t.imports||[]}}function Av(t){return e2(t,W2)||e2(t,H2)}function G2(t){return Av(t)!==null}function e2(t,n){return t.hasOwnProperty(n)?t[n]:null}function z9(t){let n=t&&(t[W2]||t[H2]);return n||null}function t2(t){return t&&(t.hasOwnProperty(n2)||t.hasOwnProperty(U9))?t[n2]:null}var W2=Qt({\u0275prov:Qt}),n2=Qt({\u0275inj:Qt}),H2=Qt({ngInjectableDef:Qt}),U9=Qt({ngInjectorDef:Qt}),ke=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=be({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function q2(t){return t&&!!t.\u0275providers}var j9=Qt({\u0275cmp:Qt}),G9=Qt({\u0275dir:Qt}),W9=Qt({\u0275pipe:Qt}),H9=Qt({\u0275mod:Qt}),nv=Qt({\u0275fac:Qt}),Th=Qt({__NG_ELEMENT_ID__:Qt}),r2=Qt({__NG_ENV_ID__:Qt});function Vs(t){return typeof t=="string"?t:t==null?"":String(t)}function q9(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():Vs(t)}function K9(t,n){let e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new Ie(-200,t)}function cS(t,n){throw new Ie(-201,!1)}var lt=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(lt||{}),fE;function K2(){return fE}function eo(t){let n=fE;return fE=t,n}function X2(t,n,e){let r=Av(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&lt.Optional)return null;if(n!==void 0)return n;cS(t,"Injector")}var X9={},Dh=X9,mE="__NG_DI_FLAG__",rv="ngTempTokenPath",Y9="ngTokenPath",Z9=/\n/gm,Q9="\u0275",o2="__source",Np;function J9(){return Np}function Ml(t){let n=Np;return Np=t,n}function e7(t,n=lt.Default){if(Np===void 0)throw new Ie(-203,!1);return Np===null?X2(t,void 0,n):Np.get(t,n&lt.Optional?null:void 0,n)}function Me(t,n=lt.Default){return(K2()||e7)($r(t),n)}function ie(t,n=lt.Default){return Me(t,Rv(n))}function Rv(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function hE(t){let n=[];for(let e=0;e<t.length;e++){let r=$r(t[e]);if(Array.isArray(r)){if(r.length===0)throw new Ie(900,!1);let o,i=lt.Default;for(let s=0;s<r.length;s++){let a=r[s],l=t7(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}n.push(Me(o,i))}else n.push(Me(r))}return n}function Y2(t,n){return t[mE]=n,t.prototype[mE]=n,t}function t7(t){return t[mE]}function n7(t,n,e,r){let o=t[rv];throw n[o2]&&o.unshift(n[o2]),t.message=r7(`
`+t.message,o,e,r),t[Y9]=o,t[rv]=null,t}function r7(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==Q9?t.slice(2):t;let o=Vr(n);if(Array.isArray(n))o=n.map(Vr).join(" -> ");else if(typeof n=="object"){let i=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Vr(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(Z9,`
  `)}`}var uS=Y2(U2("Optional"),8);var Z2=Y2(U2("SkipSelf"),4);function Su(t,n){let e=t.hasOwnProperty(nv);return e?t[nv]:null}function dS(t,n){t.forEach(e=>Array.isArray(e)?dS(e,n):n(e))}function Q2(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function ov(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function o7(t,n){let e=[];for(let r=0;r<t;r++)e.push(n);return e}function i7(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(o===1)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;){let i=o-2;t[o]=t[i],o--}t[n]=e,t[n+1]=r}}function pS(t,n,e){let r=$h(t,n);return r>=0?t[r|1]=e:(r=~r,i7(t,r,n,e)),r}function eE(t,n){let e=$h(t,n);if(e>=0)return t[e|1]}function $h(t,n){return s7(t,n,1)}function s7(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=t[i<<e];if(n===s)return i<<e;s>n?o=i:r=i+1}return~(o<<e)}var Ap={},to=[],Rp=new ke(""),J2=new ke("",-1),eM=new ke(""),iv=class{get(n,e=Dh){if(e===Dh){let r=new Error(`NullInjectorError: No provider for ${Vr(n)}!`);throw r.name="NullInjectorError",r}return e}};function tM(t,n){let e=t[H9]||null;if(!e&&n===!0)throw new Error(`Type ${Vr(t)} does not have '\u0275mod' property.`);return e}function Tu(t){return t[j9]||null}function nM(t){return t[G9]||null}function rM(t){return t[W9]||null}function oM(t){let n=Tu(t)||nM(t)||rM(t);return n!==null&&n.standalone}function zp(t){return{\u0275providers:t}}function a7(...t){return{\u0275providers:iM(!0,t),\u0275fromNgModule:!0}}function iM(t,...n){let e=[],r=new Set,o,i=s=>{e.push(s)};return dS(n,s=>{let a=s;gE(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&sM(o,i),e}function sM(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];fS(o,i=>{n(i,r)})}}function gE(t,n,e,r){if(t=$r(t),!t)return!1;let o=null,i=t2(t),s=!i&&Tu(t);if(!i&&!s){let l=t.ngModule;if(i=t2(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=t}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)gE(c,n,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let c;try{dS(i.imports,u=>{gE(u,n,e,r)&&(c||=[],c.push(u))})}finally{}c!==void 0&&sM(c,n)}if(!a){let c=Su(o)||(()=>new o);n({provide:o,useFactory:c,deps:to},o),n({provide:eM,useValue:o,multi:!0},o),n({provide:Rp,useValue:()=>Me(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let c=t;fS(l,u=>{n(u,c)})}}else return!1;return o!==t&&t.providers!==void 0}function fS(t,n){for(let e of t)q2(e)&&(e=e.\u0275providers),Array.isArray(e)?fS(e,n):n(e)}var l7=Qt({provide:String,useValue:Qt});function aM(t){return t!==null&&typeof t=="object"&&l7 in t}function c7(t){return!!(t&&t.useExisting)}function u7(t){return!!(t&&t.useFactory)}function Mp(t){return typeof t=="function"}function d7(t){return!!t.useClass}var Mv=new ke(""),Y0={},p7={},tE;function mS(){return tE===void 0&&(tE=new iv),tE}var no=class{},Nh=class extends no{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,vE(n,s=>this.processProvider(s)),this.records.set(J2,Sp(void 0,this)),o.has("environment")&&this.records.set(no,Sp(void 0,this));let i=this.records.get(Mv);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(eM,to,lt.Self))}destroy(){Eh(this),this._destroyed=!0;let n=St(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),St(n)}}onDestroy(n){return Eh(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){Eh(this);let e=Ml(this),r=eo(void 0),o;try{return n()}finally{Ml(e),eo(r)}}get(n,e=Dh,r=lt.Default){if(Eh(this),n.hasOwnProperty(r2))return n[r2](this);r=Rv(r);let o,i=Ml(this),s=eo(void 0);try{if(!(r&lt.SkipSelf)){let l=this.records.get(n);if(l===void 0){let c=y7(n)&&Av(n);c&&this.injectableDefInScope(c)?l=Sp(yE(n),Y0):l=null,this.records.set(n,l)}if(l!=null)return this.hydrate(n,l)}let a=r&lt.Self?mS():this.parent;return e=r&lt.Optional&&e===Dh?null:e,a.get(n,e)}catch(a){if(a.name==="NullInjectorError"){if((a[rv]=a[rv]||[]).unshift(Vr(n)),i)throw a;return n7(a,n,"R3InjectorError",this.source)}else throw a}finally{eo(s),Ml(i)}}resolveInjectorInitializers(){let n=St(null),e=Ml(this),r=eo(void 0),o;try{let i=this.get(Rp,to,lt.Self);for(let s of i)s()}finally{Ml(e),eo(r),St(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Vr(r));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=$r(n);let e=Mp(n)?n:$r(n&&n.provide),r=m7(n);if(!Mp(n)&&n.multi===!0){let o=this.records.get(e);o||(o=Sp(void 0,Y0,!0),o.factory=()=>hE(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){let r=St(null);try{return e.value===Y0&&(e.value=p7,e.value=e.factory()),typeof e.value=="object"&&e.value&&g7(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{St(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=$r(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function yE(t){let n=Av(t),e=n!==null?n.factory:Su(t);if(e!==null)return e;if(t instanceof ke)throw new Ie(204,!1);if(t instanceof Function)return f7(t);throw new Ie(204,!1)}function f7(t){if(t.length>0)throw new Ie(204,!1);let e=z9(t);return e!==null?()=>e.factory(t):()=>new t}function m7(t){if(aM(t))return Sp(void 0,t.useValue);{let n=lM(t);return Sp(n,Y0)}}function lM(t,n,e){let r;if(Mp(t)){let o=$r(t);return Su(o)||yE(o)}else if(aM(t))r=()=>$r(t.useValue);else if(u7(t))r=()=>t.useFactory(...hE(t.deps||[]));else if(c7(t))r=()=>Me($r(t.useExisting));else{let o=$r(t&&(t.useClass||t.provide));if(h7(t))r=()=>new o(...hE(t.deps));else return Su(o)||yE(o)}return r}function Eh(t){if(t.destroyed)throw new Ie(205,!1)}function Sp(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function h7(t){return!!t.deps}function g7(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function y7(t){return typeof t=="function"||typeof t=="object"&&t instanceof ke}function vE(t,n){for(let e of t)Array.isArray(e)?vE(e,n):e&&q2(e)?vE(e.\u0275providers,n):n(e)}function dr(t,n){t instanceof Nh&&Eh(t);let e,r=Ml(t),o=eo(void 0);try{return n()}finally{Ml(r),eo(o)}}function cM(){return K2()!==void 0||J9()!=null}function uM(t){if(!cM())throw new Ie(-203,!1)}function v7(t){return typeof t=="function"}var Hs=0,Tt=1,Ye=2,Br=3,Ei=4,oo=5,kh=6,sv=7,Go=8,Ah=9,Bs=10,wn=11,Rh=12,i2=13,Up=14,Wo=15,Fp=16,Tp=17,Op=18,Fv=19,dM=20,Fl=21,Z0=22,Du=23,Io=24,ro=25,pM=1;var Nu=7,av=8,lv=9,jo=10;function Ol(t){return Array.isArray(t)&&typeof t[pM]=="object"}function qs(t){return Array.isArray(t)&&t[pM]===!0}function hS(t){return(t.flags&4)!==0}function Pu(t){return t.componentOffset>-1}function Ov(t){return(t.flags&1)===1}function zs(t){return!!t.template}function cv(t){return(t[Ye]&512)!==0}function Vh(t){return(t[Ye]&256)===256}var xE=class{previousValue;currentValue;firstChange;constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function fM(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}var Ho=(()=>{let t=()=>mM;return t.ngInherit=!0,t})();function mM(t){return t.type.prototype.ngOnChanges&&(t.setInput=b7),x7}function x7(){let t=gM(this),n=t?.current;if(n){let e=t.previous;if(e===Ap)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function b7(t,n,e,r,o){let i=this.declaredInputs[r],s=gM(t)||w7(t,{previous:Ap,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[i];a[i]=new xE(c&&c.currentValue,e,l===Ap),fM(t,n,o,e)}var hM="__ngSimpleChanges__";function gM(t){return t[hM]||null}function w7(t,n){return t[hM]=n}var s2=null;var Uo=function(t,n,e){s2?.(t,n,e)},C7="svg",_7="math";function ts(t){for(;Array.isArray(t);)t=t[Hs];return t}function yM(t,n){return ts(n[t])}function Si(t,n){return ts(n[t.index])}function vM(t,n){return t.data[n]}function I7(t,n){return t[n]}function ns(t,n){let e=n[t];return Ol(e)?e:e[Hs]}function gS(t){return(t[Ye]&128)===128}function E7(t){return qs(t[Br])}function Pp(t,n){return n==null?null:t[n]}function xM(t){t[Tp]=0}function yS(t){t[Ye]&1024||(t[Ye]|=1024,gS(t)&&Bh(t))}function S7(t,n){for(;t>0;)n=n[Up],t--;return n}function Pv(t){return!!(t[Ye]&9216||t[Io]?.dirty)}function bE(t){t[Bs].changeDetectionScheduler?.notify(9),t[Ye]&64&&(t[Ye]|=1024),Pv(t)&&Bh(t)}function Bh(t){t[Bs].changeDetectionScheduler?.notify(0);let n=ku(t);for(;n!==null&&!(n[Ye]&8192||(n[Ye]|=8192,!gS(n)));)n=ku(n)}function bM(t,n){if(Vh(t))throw new Ie(911,!1);t[Fl]===null&&(t[Fl]=[]),t[Fl].push(n)}function T7(t,n){if(t[Fl]===null)return;let e=t[Fl].indexOf(n);e!==-1&&t[Fl].splice(e,1)}function ku(t){let n=t[Br];return qs(n)?n[Br]:n}function D7(t){return t[sv]??=[]}function N7(t){return t.cleanup??=[]}var pt={lFrame:NM(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var wE=!1;function k7(){return pt.lFrame.elementDepthCount}function A7(){pt.lFrame.elementDepthCount++}function R7(){pt.lFrame.elementDepthCount--}function wM(){return pt.bindingsEnabled}function CM(){return pt.skipHydrationRootTNode!==null}function M7(t){return pt.skipHydrationRootTNode===t}function F7(){pt.skipHydrationRootTNode=null}function xt(){return pt.lFrame.lView}function Gn(){return pt.lFrame.tView}function me(t){return pt.lFrame.contextLView=t,t[Go]}function he(t){return pt.lFrame.contextLView=null,t}function zr(){let t=_M();for(;t!==null&&t.type===64;)t=t.parent;return t}function _M(){return pt.lFrame.currentTNode}function O7(){let t=pt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function Lu(t,n){let e=pt.lFrame;e.currentTNode=t,e.isParent=n}function vS(){return pt.lFrame.isParent}function xS(){pt.lFrame.isParent=!1}function IM(){return wE}function uv(t){let n=wE;return wE=t,n}function bS(){let t=pt.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function EM(){return pt.lFrame.bindingIndex}function P7(t){return pt.lFrame.bindingIndex=t}function Lv(){return pt.lFrame.bindingIndex++}function $v(t){let n=pt.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function L7(){return pt.lFrame.inI18n}function $7(t,n){let e=pt.lFrame;e.bindingIndex=e.bindingRootIndex=t,CE(n)}function V7(){return pt.lFrame.currentDirectiveIndex}function CE(t){pt.lFrame.currentDirectiveIndex=t}function B7(t){let n=pt.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function SM(t){pt.lFrame.currentQueryIndex=t}function z7(t){let n=t[Tt];return n.type===2?n.declTNode:n.type===1?t[oo]:null}function TM(t,n,e){if(e&lt.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&lt.Host);)if(o=z7(i),o===null||(i=i[Up],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=pt.lFrame=DM();return r.currentTNode=n,r.lView=t,!0}function wS(t){let n=DM(),e=t[Tt];pt.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function DM(){let t=pt.lFrame,n=t===null?null:t.child;return n===null?NM(t):n}function NM(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function kM(){let t=pt.lFrame;return pt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var AM=kM;function CS(){let t=kM();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function U7(t){return(pt.lFrame.contextLView=S7(t,pt.lFrame.contextLView))[Go]}function Ks(){return pt.lFrame.selectedIndex}function Au(t){pt.lFrame.selectedIndex=t}function Vv(){let t=pt.lFrame;return vM(t.tView,t.selectedIndex)}function j7(){return pt.lFrame.currentNamespace}var RM=!0;function Bv(){return RM}function zv(t){RM=t}function G7(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let s=mM(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function Uv(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),l&&(t.viewHooks??=[]).push(-e,l),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),u!=null&&(t.destroyHooks??=[]).push(e,u)}}function Q0(t,n,e){MM(t,n,3,e)}function J0(t,n,e,r){(t[Ye]&3)===e&&MM(t,n,e,r)}function nE(t,n){let e=t[Ye];(e&3)===n&&(e&=16383,e+=1,t[Ye]=e)}function MM(t,n,e,r){let o=r!==void 0?t[Tp]&65535:0,i=r??-1,s=n.length-1,a=0;for(let l=o;l<s;l++)if(typeof n[l+1]=="number"){if(a=n[l],r!=null&&a>=r)break}else n[l]<0&&(t[Tp]+=65536),(a<i||i==-1)&&(W7(t,e,n,l),t[Tp]=(t[Tp]&4294901760)+l+2),l++}function a2(t,n){Uo(4,t,n);let e=St(null);try{n.call(t)}finally{St(e),Uo(5,t,n)}}function W7(t,n,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=t[s];o?t[Ye]>>14<t[Tp]>>16&&(t[Ye]&3)===n&&(t[Ye]+=16384,a2(a,i)):a2(a,i)}var kp=-1,Ru=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,r){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=r}};function H7(t){return t instanceof Ru}function q7(t){return(t.flags&8)!==0}function K7(t){return(t.flags&16)!==0}function X7(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,i)}else{let i=o,s=e[++r];Y7(i)?t.setProperty(n,i,s):t.setAttribute(n,i,s),r++}}return r}function FM(t){return t===3||t===4||t===6}function Y7(t){return t.charCodeAt(0)===64}function Lp(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?l2(t,e,o,null,n[++r]):l2(t,e,o,null,null))}}return t}function l2(t,n,e,r,o){let i=0,s=t.length;if(n===-1)s=-1;else for(;i<t.length;){let a=t[i++];if(typeof a=="number"){if(a===n){s=-1;break}else if(a>n){s=i-1;break}}}for(;i<t.length;){let a=t[i];if(typeof a=="number")break;if(a===e){if(r===null){o!==null&&(t[i+1]=o);return}else if(r===t[i+1]){t[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}s!==-1&&(t.splice(s,0,n),i=s+1),t.splice(i++,0,e),r!==null&&t.splice(i++,0,r),o!==null&&t.splice(i++,0,o)}var rE={},_E=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=Rv(r);let o=this.injector.get(n,rE,r);return o!==rE||e===rE?o:this.parentInjector.get(n,e,r)}};function OM(t){return t!==kp}function dv(t){return t&32767}function Z7(t){return t>>16}function pv(t,n){let e=Z7(t),r=n;for(;e>0;)r=r[Up],e--;return r}var IE=!0;function fv(t){let n=IE;return IE=t,n}var Q7=256,PM=Q7-1,LM=5,J7=0,es={};function eX(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(Th)&&(r=e[Th]),r==null&&(r=e[Th]=J7++);let o=r&PM,i=1<<o;n.data[t+(o>>LM)]|=i}function mv(t,n){let e=$M(t,n);if(e!==-1)return e;let r=n[Tt];r.firstCreatePass&&(t.injectorIndex=n.length,oE(r.data,t),oE(n,null),oE(r.blueprint,null));let o=_S(t,n),i=t.injectorIndex;if(OM(o)){let s=dv(o),a=pv(o,n),l=a[Tt].data;for(let c=0;c<8;c++)n[i+c]=a[s+c]|l[s+c]}return n[i+8]=o,i}function oE(t,n){t.push(0,0,0,0,0,0,0,0,n)}function $M(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function _S(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=jM(o),r===null)return kp;if(e++,o=o[Up],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return kp}function EE(t,n,e){eX(t,n,e)}function tX(t,n){if(n==="class")return t.classes;if(n==="style")return t.styles;let e=t.attrs;if(e){let r=e.length,o=0;for(;o<r;){let i=e[o];if(FM(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<r&&typeof e[o]=="string";)o++;else{if(i===n)return e[o+1];o=o+2}}}return null}function VM(t,n,e){if(e&lt.Optional||t!==void 0)return t;cS(n,"NodeInjector")}function BM(t,n,e,r){if(e&lt.Optional&&r===void 0&&(r=null),!(e&(lt.Self|lt.Host))){let o=t[Ah],i=eo(void 0);try{return o?o.get(n,r,e&lt.Optional):X2(n,r,e&lt.Optional)}finally{eo(i)}}return VM(r,n,e)}function zM(t,n,e,r=lt.Default,o){if(t!==null){if(n[Ye]&2048&&!(r&lt.Self)){let s=sX(t,n,e,r,es);if(s!==es)return s}let i=UM(t,n,e,r,es);if(i!==es)return i}return BM(n,e,r,o)}function UM(t,n,e,r,o){let i=oX(e);if(typeof i=="function"){if(!TM(n,t,r))return r&lt.Host?VM(o,e,r):BM(n,e,r,o);try{let s;if(s=i(r),s==null&&!(r&lt.Optional))cS(e);else return s}finally{AM()}}else if(typeof i=="number"){let s=null,a=$M(t,n),l=kp,c=r&lt.Host?n[Wo][oo]:null;for((a===-1||r&lt.SkipSelf)&&(l=a===-1?_S(t,n):n[a+8],l===kp||!u2(r,!1)?a=-1:(s=n[Tt],a=dv(l),n=pv(l,n)));a!==-1;){let u=n[Tt];if(c2(i,a,u.data)){let d=nX(a,n,e,s,r,c);if(d!==es)return d}l=n[a+8],l!==kp&&u2(r,n[Tt].data[a+8]===c)&&c2(i,a,n)?(s=u,a=dv(l),n=pv(l,n)):a=-1}}return o}function nX(t,n,e,r,o,i){let s=n[Tt],a=s.data[t+8],l=r==null?Pu(a)&&IE:r!=s&&(a.type&3)!==0,c=o&lt.Host&&i===a,u=rX(a,s,e,l,c);return u!==null?hv(n,s,u,a):es}function rX(t,n,e,r,o){let i=t.providerIndexes,s=n.data,a=i&1048575,l=t.directiveStart,c=t.directiveEnd,u=i>>20,d=r?a:a+u,p=o?a+u:c;for(let f=d;f<p;f++){let m=s[f];if(f<l&&e===m||f>=l&&m.type===e)return f}if(o){let f=s[l];if(f&&zs(f)&&f.type===e)return l}return null}function hv(t,n,e,r){let o=t[e],i=n.data;if(H7(o)){let s=o;s.resolving&&K9(q9(i[e]));let a=fv(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?eo(s.injectImpl):null,u=TM(t,r,lt.Default);try{o=t[e]=s.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&G7(e,i[e],n)}finally{c!==null&&eo(c),fv(a),s.resolving=!1,AM()}}return o}function oX(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(Th)?t[Th]:void 0;return typeof n=="number"?n>=0?n&PM:iX:n}function c2(t,n,e){let r=1<<t;return!!(e[n+(t>>LM)]&r)}function u2(t,n){return!(t&lt.Self)&&!(t&lt.Host&&n)}var Eu=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return zM(this._tNode,this._lView,n,Rv(r),e)}};function iX(){return new Eu(zr(),xt())}function qo(t){return Lh(()=>{let n=t.prototype.constructor,e=n[nv]||SE(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[nv]||SE(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function SE(t){return j2(t)?()=>{let n=SE($r(t));return n&&n()}:Su(t)}function sX(t,n,e,r,o){let i=t,s=n;for(;i!==null&&s!==null&&s[Ye]&2048&&!cv(s);){let a=UM(i,s,e,r|lt.Self,es);if(a!==es)return a;let l=i.parent;if(!l){let c=s[dM];if(c){let u=c.get(e,es,r);if(u!==es)return u}l=jM(s),s=s[Up]}i=l}return o}function jM(t){let n=t[Tt],e=n.type;return e===2?n.declTNode:e===1?t[oo]:null}function jv(t){return tX(zr(),t)}function d2(t,n=null,e=null,r){let o=GM(t,n,e,r);return o.resolveInjectorInitializers(),o}function GM(t,n=null,e=null,r,o=new Set){let i=[e||to,a7(t)];return r=r||(typeof t=="object"?void 0:Vr(t)),new Nh(i,n||mS(),r||null,o)}var kn=class t{static THROW_IF_NOT_FOUND=Dh;static NULL=new iv;static create(n,e){if(Array.isArray(n))return d2({name:""},e,n,"");{let r=n.name??"";return d2({name:r},n.parent,n.providers,r)}}static \u0275prov=be({token:t,providedIn:"any",factory:()=>Me(J2)});static __NG_ELEMENT_ID__=-1};var gv=class{attributeName;constructor(n){this.attributeName=n}__NG_ELEMENT_ID__=()=>jv(this.attributeName);toString(){return`HostAttributeToken ${this.attributeName}`}},aX=new ke("");aX.__NG_ELEMENT_ID__=t=>{let n=zr();if(n===null)throw new Ie(204,!1);if(n.type&2)return n.value;if(t&lt.Optional)return null;throw new Ie(204,!1)};var WM=!1,jp=(()=>{class t{static __NG_ELEMENT_ID__=lX;static __NG_ENV_ID__=e=>e}return t})(),yv=class extends jp{_lView;constructor(n){super(),this._lView=n}onDestroy(n){return bM(this._lView,n),()=>T7(this._lView,n)}};function lX(){return new yv(xt())}var Mu=class{},Gv=new ke("",{providedIn:"root",factory:()=>!1});var HM=new ke(""),IS=new ke(""),Xs=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new cr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=be({token:t,providedIn:"root",factory:()=>new t})}return t})();var TE=class extends vn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,cM()&&(this.destroyRef=ie(jp,{optional:!0})??void 0,this.pendingTasks=ie(Xs,{optional:!0})??void 0)}emit(n){let e=St(null);try{super.next(n)}finally{St(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),s=r;if(n&&typeof n=="object"){let l=n;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return n instanceof gn&&n.add(a),a}wrapInTimeout(n){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{n(e),r!==void 0&&this.pendingTasks?.remove(r)})}}},Ot=TE;function Mh(...t){}function qM(t){let n,e;function r(){t=Mh;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{t(),r()})),()=>r()}function p2(t){return queueMicrotask(()=>t()),()=>{t=Mh}}var ES="isAngularZone",vv=ES+"_ID",cX=0,sn=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new Ot(!1);onMicrotaskEmpty=new Ot(!1);onStable=new Ot(!1);onError=new Ot(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=WM}=n;if(typeof Zone>"u")throw new Ie(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,pX(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(ES)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new Ie(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new Ie(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,n,uX,Mh,Mh);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},uX={};function SS(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function dX(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){qM(()=>{t.callbackScheduled=!1,DE(t),t.isCheckStableRunning=!0,SS(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),DE(t)}function pX(t){let n=()=>{dX(t)},e=cX++;t._inner=t._inner.fork({name:"angular",properties:{[ES]:!0,[vv]:e,[vv+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(fX(l))return r.invokeTask(i,s,a,l);try{return f2(t),r.invokeTask(i,s,a,l)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),m2(t)}},onInvoke:(r,o,i,s,a,l,c)=>{try{return f2(t),r.invoke(i,s,a,l,c)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!mX(l)&&n(),m2(t)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,DE(t),SS(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function DE(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function f2(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function m2(t){t._nesting--,SS(t)}var xv=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new Ot;onMicrotaskEmpty=new Ot;onStable=new Ot;onError=new Ot;run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}};function fX(t){return KM(t,"__ignore_ng_zone__")}function mX(t){return KM(t,"__scheduler_tick__")}function KM(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var Eo=class{_console=console;handleError(n){this._console.error("ERROR",n)}},hX=new ke("",{providedIn:"root",factory:()=>{let t=ie(sn),n=ie(Eo);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function h2(t,n){return z2(t,n)}function gX(t){return z2(B2,t)}var XM=(h2.required=gX,h2);function yX(){return Wv(zr(),xt())}function Wv(t,n){return new Er(Si(t,n))}var Er=(()=>{class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=yX}return t})();var g2=new Set;function $l(t){g2.has(t)||(g2.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function TS(t){return typeof t=="function"&&t[Zr]!==void 0}function io(t,n){$l("NgSignals");let e=SR(t),r=e[Zr];return n?.equal&&(r.equal=n.equal),e.set=o=>y0(r,o),e.update=o=>TR(r,o),e.asReadonly=vX.bind(e),e}function vX(){let t=this[Zr];if(t.readonlyFn===void 0){let n=()=>this();n[Zr]=t,t.readonlyFn=n}return t.readonlyFn}function YM(t){return TS(t)&&typeof t.set=="function"}function ZM(t){return(t.flags&128)===128}var QM=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(QM||{}),JM=new Map,xX=0;function bX(){return xX++}function wX(t){JM.set(t[Fv],t)}function NE(t){JM.delete(t[Fv])}var y2="__ngContext__";function $u(t,n){Ol(n)?(t[y2]=n[Fv],wX(n)):t[y2]=n}function eF(t){return nF(t[Rh])}function tF(t){return nF(t[Ei])}function nF(t){for(;t!==null&&!qs(t);)t=t[Ei];return t}var kE;function rF(t){kE=t}function CX(){if(kE!==void 0)return kE;if(typeof document<"u")return document;throw new Ie(210,!1)}var Hv=new ke("",{providedIn:"root",factory:()=>_X}),_X="ng",DS=new ke(""),so=new ke("",{providedIn:"platform",factory:()=>"unknown"});var zh=new ke("",{providedIn:"root",factory:()=>CX().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var IX="h",EX="b";var oF=!1,SX=new ke("",{providedIn:"root",factory:()=>oF});var iF=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(iF||{}),qv=new ke("");var TX=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=be({token:t,providedIn:"root",factory:()=>new t})}return t})();var DX=()=>null;function sF(t,n,e=!1){return DX(t,n,e)}function aF(t,n){let e=t.contentQueries;if(e!==null){let r=St(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=t.data[s];SM(i),a.contentQueries(2,n[s],s)}}}finally{St(r)}}}function AE(t,n,e){SM(0);let r=St(null);try{n(t,e)}finally{St(r)}}function NS(t,n,e){if(hS(n)){let r=St(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let s=o;s<i;s++){let a=t.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{St(r)}}}var rs=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(rs||{}),W0;function NX(){if(W0===void 0&&(W0=null,$s.trustedTypes))try{W0=$s.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return W0}function Kv(t){return NX()?.createHTML(t)||t}var H0;function kX(){if(H0===void 0&&(H0=null,$s.trustedTypes))try{H0=$s.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return H0}function v2(t){return kX()?.createScriptURL(t)||t}var Us=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${V2})`}},RE=class extends Us{getTypeName(){return"HTML"}},ME=class extends Us{getTypeName(){return"Style"}},FE=class extends Us{getTypeName(){return"Script"}},OE=class extends Us{getTypeName(){return"URL"}},PE=class extends Us{getTypeName(){return"ResourceURL"}};function Ti(t){return t instanceof Us?t.changingThisBreaksApplicationSecurity:t}function Vl(t,n){let e=AX(t);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${V2})`)}return e===n}function AX(t){return t instanceof Us&&t.getTypeName()||null}function lF(t){return new RE(t)}function cF(t){return new ME(t)}function uF(t){return new FE(t)}function dF(t){return new OE(t)}function pF(t){return new PE(t)}function RX(t){let n=new $E(t);return MX()?new LE(n):n}var LE=class{inertDocumentHelper;constructor(n){this.inertDocumentHelper=n}getInertBodyElement(n){n="<body><remove></remove>"+n;try{let e=new window.DOMParser().parseFromString(Kv(n),"text/html").body;return e===null?this.inertDocumentHelper.getInertBodyElement(n):(e.firstChild?.remove(),e)}catch{return null}}},$E=class{defaultDoc;inertDocument;constructor(n){this.defaultDoc=n,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert")}getInertBodyElement(n){let e=this.inertDocument.createElement("template");return e.innerHTML=Kv(n),e}};function MX(){try{return!!new window.DOMParser().parseFromString(Kv(""),"text/html")}catch{return!1}}var FX=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function Xv(t){return t=String(t),t.match(FX)?t:"unsafe:"+t}function Ys(t){let n={};for(let e of t.split(","))n[e]=!0;return n}function Uh(...t){let n={};for(let e of t)for(let r in e)e.hasOwnProperty(r)&&(n[r]=!0);return n}var fF=Ys("area,br,col,hr,img,wbr"),mF=Ys("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),hF=Ys("rp,rt"),OX=Uh(hF,mF),PX=Uh(mF,Ys("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),LX=Uh(hF,Ys("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),x2=Uh(fF,PX,LX,OX),gF=Ys("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),$X=Ys("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),VX=Ys("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext"),BX=Uh(gF,$X,VX),zX=Ys("script,style,template"),VE=class{sanitizedSomething=!1;buf=[];sanitizeChildren(n){let e=n.firstChild,r=!0,o=[];for(;e;){if(e.nodeType===Node.ELEMENT_NODE?r=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,r&&e.firstChild){o.push(e),e=GX(e);continue}for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let i=jX(e);if(i){e=i;break}e=o.pop()}}return this.buf.join("")}startElement(n){let e=b2(n).toLowerCase();if(!x2.hasOwnProperty(e))return this.sanitizedSomething=!0,!zX.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);let r=n.attributes;for(let o=0;o<r.length;o++){let i=r.item(o),s=i.name,a=s.toLowerCase();if(!BX.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let l=i.value;gF[a]&&(l=Xv(l)),this.buf.push(" ",s,'="',w2(l),'"')}return this.buf.push(">"),!0}endElement(n){let e=b2(n).toLowerCase();x2.hasOwnProperty(e)&&!fF.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(n){this.buf.push(w2(n))}};function UX(t,n){return(t.compareDocumentPosition(n)&Node.DOCUMENT_POSITION_CONTAINED_BY)!==Node.DOCUMENT_POSITION_CONTAINED_BY}function jX(t){let n=t.nextSibling;if(n&&t!==n.previousSibling)throw yF(n);return n}function GX(t){let n=t.firstChild;if(n&&UX(t,n))throw yF(n);return n}function b2(t){let n=t.nodeName;return typeof n=="string"?n:"FORM"}function yF(t){return new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`)}var WX=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,HX=/([^\#-~ |!])/g;function w2(t){return t.replace(/&/g,"&amp;").replace(WX,function(n){let e=n.charCodeAt(0),r=n.charCodeAt(1);return"&#"+((e-55296)*1024+(r-56320)+65536)+";"}).replace(HX,function(n){return"&#"+n.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}var q0;function vF(t,n){let e=null;try{q0=q0||RX(t);let r=n?String(n):"";e=q0.getInertBodyElement(r);let o=5,i=r;do{if(o===0)throw new Error("Failed to sanitize html because the input is unstable");o--,r=i,i=e.innerHTML,e=q0.getInertBodyElement(r)}while(r!==i);let a=new VE().sanitizeChildren(C2(e)||e);return Kv(a)}finally{if(e){let r=C2(e)||e;for(;r.firstChild;)r.firstChild.remove()}}}function C2(t){return"content"in t&&qX(t)?t.content:null}function qX(t){return t.nodeType===Node.ELEMENT_NODE&&t.nodeName==="TEMPLATE"}var Sr=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(Sr||{});function Bl(t){let n=bF();return n?n.sanitize(Sr.URL,t)||"":Vl(t,"URL")?Ti(t):Xv(Vs(t))}function KX(t){let n=bF();if(n)return v2(n.sanitize(Sr.RESOURCE_URL,t)||"");if(Vl(t,"ResourceURL"))return v2(Ti(t));throw new Ie(904,!1)}function XX(t,n){return n==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||n==="href"&&(t==="base"||t==="link")?KX:Bl}function xF(t,n,e){return XX(n,e)(t)}function bF(){let t=xt();return t&&t[Bs].sanitizer}var YX=/^>|^->|<!--|-->|--!>|<!-$/g,ZX=/(<|>)/g,QX="\u200B$1\u200B";function JX(t){return t.replace(YX,n=>n.replace(ZX,QX))}function wF(t){return t.ownerDocument}function CF(t){return t instanceof Function?t():t}var Pl=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(Pl||{});function eY(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}var _F="ng-template";function tY(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&eY(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if(kS(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function kS(t){return t.type===4&&t.value!==_F}function nY(t,n,e){let r=t.type===4&&!e?_F:t.value;return n===r}function rY(t,n,e){let r=4,o=t.attrs,i=o!==null?sY(o):0,s=!1;for(let a=0;a<n.length;a++){let l=n[a];if(typeof l=="number"){if(!s&&!_i(r)&&!_i(l))return!1;if(s&&_i(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!nY(t,l,e)||l===""&&n.length===1){if(_i(r))return!1;s=!0}}else if(r&8){if(o===null||!tY(t,o,l,e)){if(_i(r))return!1;s=!0}}else{let c=n[++a],u=oY(l,o,kS(t),e);if(u===-1){if(_i(r))return!1;s=!0;continue}if(c!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),r&2&&c!==d){if(_i(r))return!1;s=!0}}}}return _i(r)||s}function _i(t){return(t&1)===0}function oY(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let s=n[o];if(s===t)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=n[++o];for(;typeof a=="string";)a=n[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return aY(n,t)}function IF(t,n,e=!1){for(let r=0;r<n.length;r++)if(rY(t,n[r],e))return!0;return!1}function iY(t){let n=t.attrs;if(n!=null){let e=n.indexOf(5);if(!(e&1))return n[e+1]}return null}function sY(t){for(let n=0;n<t.length;n++){let e=t[n];if(FM(e))return n}return t.length}function aY(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function lY(t,n){e:for(let e=0;e<n.length;e++){let r=n[e];if(t.length===r.length){for(let o=0;o<t.length;o++)if(t[o]!==r[o])continue e;return!0}}return!1}function _2(t,n){return t?":not("+n.trim()+")":n}function cY(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let s=t[e];if(typeof s=="string")if(r&2){let a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!_i(s)&&(n+=_2(i,o),o=""),r=s,i=i||!_i(r);e++}return o!==""&&(n+=_2(i,o)),n}function uY(t){return t.map(cY).join(",")}function dY(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!_i(o))break;o=i}r++}return e.length&&n.push(1,...e),n}var ao={};function pY(t,n){return t.createText(n)}function fY(t,n,e){t.setValue(n,e)}function mY(t,n){return t.createComment(JX(n))}function EF(t,n,e){return t.createElement(n,e)}function bv(t,n,e,r,o){t.insertBefore(n,e,r,o)}function SF(t,n,e){t.appendChild(n,e)}function I2(t,n,e,r,o){r!==null?bv(t,n,e,r,o):SF(t,n,e)}function hY(t,n,e){t.removeChild(null,n,e)}function gY(t,n,e){t.setAttribute(n,"style",e)}function yY(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function TF(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&X7(t,n,r),o!==null&&yY(t,n,o),i!==null&&gY(t,n,i)}function O(t=1){DF(Gn(),xt(),Ks()+t,!1)}function DF(t,n,e,r){if(!r)if((n[Ye]&3)===3){let i=t.preOrderCheckHooks;i!==null&&Q0(n,i,e)}else{let i=t.preOrderHooks;i!==null&&J0(n,i,0,e)}Au(e)}function ne(t,n=lt.Default){let e=xt();if(e===null)return Me(t,n);let r=zr();return zM(r,e,$r(t),n)}function NF(t,n,e,r,o,i){let s=St(null);try{let a=null;o&Pl.SignalBased&&(a=n[r][Zr]),a!==null&&a.transformFn!==void 0&&(i=a.transformFn(i)),o&Pl.HasDecoratorInputTransform&&(i=t.inputTransforms[r].call(n,i)),t.setInput!==null?t.setInput(n,a,i,e,r):fM(n,a,r,i)}finally{St(s)}}function AS(t,n,e,r,o,i,s,a,l,c,u){let d=n.blueprint.slice();return d[Hs]=o,d[Ye]=r|4|128|8|64|1024,(c!==null||t&&t[Ye]&2048)&&(d[Ye]|=2048),xM(d),d[Br]=d[Up]=t,d[Go]=e,d[Bs]=s||t&&t[Bs],d[wn]=a||t&&t[wn],d[Ah]=l||t&&t[Ah]||null,d[oo]=i,d[Fv]=bX(),d[kh]=u,d[dM]=c,d[Wo]=n.type==2?t[Wo]:d,d}function kF(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function AF(t,n,e,r,o){let i=Ks(),s=r&2;try{Au(-1),s&&n.length>ro&&DF(t,n,ro,!1),Uo(s?2:0,o),e(r,o)}finally{Au(i),Uo(s?3:1,o)}}function RS(t,n,e){wM()&&($u(Si(e,n),n),RF(t,n,e))}function RF(t,n,e){DY(t,n,e),(e.flags&64)===64&&NY(t,n,e)}function MS(t,n,e=Si){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(n,t):t[s];t[o++]=a}}}function vY(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=FS(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function FS(t,n,e,r,o,i,s,a,l,c,u){let d=ro+r,p=d+o,f=xY(d,p),m=typeof c=="function"?c():c;return f[Tt]={type:t,blueprint:f,template:e,queries:null,viewQuery:a,declTNode:n,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:m,incompleteFirstPass:!1,ssrId:u}}function xY(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:ao);return e}function bY(t,n,e,r){let i=r.get(SX,oF)||e===rs.ShadowDom,s=t.selectRootElement(n,i);return wY(s),s}function wY(t){CY(t)}var CY=()=>null;function E2(t,n,e,r,o){for(let i in n){if(!n.hasOwnProperty(i))continue;let s=n[i];if(s===void 0)continue;r??={};let a,l=Pl.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}t===0?S2(r,e,c,a,l):S2(r,e,c,a)}return r}function S2(t,n,e,r,o){let i;t.hasOwnProperty(e)?(i=t[e]).push(n,r):i=t[e]=[n,r],o!==void 0&&i.push(o)}function _Y(t,n,e){let r=n.directiveStart,o=n.directiveEnd,i=t.data,s=n.attrs,a=[],l=null,c=null;for(let u=r;u<o;u++){let d=i[u],p=e?e.get(d):null,f=p?p.inputs:null,m=p?p.outputs:null;l=E2(0,d.inputs,u,l,f),c=E2(1,d.outputs,u,c,m);let h=l!==null&&s!==null&&!kS(n)?UY(l,u,s):null;a.push(h)}l!==null&&(l.hasOwnProperty("class")&&(n.flags|=8),l.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=a,n.inputs=l,n.outputs=c}function IY(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function OS(t,n,e,r,o,i,s,a){let l=Si(n,e),c=n.inputs,u;!a&&c!=null&&(u=c[r])?($S(t,e,u,r,o),Pu(n)&&EY(e,n.index)):n.type&3?(r=IY(r),o=s!=null?s(o,n.value||"",r):o,i.setProperty(l,r,o)):n.type&12}function EY(t,n){let e=ns(n,t);e[Ye]&16||(e[Ye]|=64)}function PS(t,n,e,r){if(wM()){let o=r===null?null:{"":-1},i=AY(t,e);if(i!==null){let[s,a]=FF(t,e,i);MF(t,n,e,s,o,a)}o&&MY(e,r,o)}e.mergedAttrs=Lp(e.mergedAttrs,e.attrs)}function MF(t,n,e,r,o,i){for(let c=0;c<r.length;c++)EE(mv(e,n),t,r[c].type);OY(e,t.data.length,r.length);for(let c=0;c<r.length;c++){let u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=kF(t,n,r.length,null);for(let c=0;c<r.length;c++){let u=r[c];e.mergedAttrs=Lp(e.mergedAttrs,u.hostAttrs),PY(t,e,n,l,u),FY(l,u,o),u.contentQueries!==null&&(e.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(e.flags|=64);let d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),l++}_Y(t,e,i)}function SY(t,n,e,r,o){let i=o.hostBindings;if(i){let s=t.hostBindingOpCodes;s===null&&(s=t.hostBindingOpCodes=[]);let a=~n.index;TY(s)!=a&&s.push(a),s.push(e,r,i)}}function TY(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function DY(t,n,e){let r=e.directiveStart,o=e.directiveEnd;Pu(e)&&$Y(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||mv(e,n);let i=e.initialInputs;for(let s=r;s<o;s++){let a=t.data[s],l=hv(n,t,s,e);if($u(l,n),i!==null&&zY(n,s-r,l,a,e,i),zs(a)){let c=ns(e.index,n);c[Go]=hv(n,t,s,e)}}}function NY(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=V7();try{Au(i);for(let a=r;a<o;a++){let l=t.data[a],c=n[a];CE(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&kY(l,c)}}finally{Au(-1),CE(s)}}function kY(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function AY(t,n){let e=t.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];IF(n,i.selectors,!1)&&(r??=[],zs(i)?r.unshift(i):r.push(i))}return r}function FF(t,n,e){let r=[],o=null;for(let i of e)i.findHostDirectiveDefs!==null&&(o??=new Map,i.findHostDirectiveDefs(i,r,o)),zs(i)&&(r.push(i),RY(t,n,r.length-1));return Pu(n)?r.push(...e.slice(1)):r.push(...e),[r,o]}function RY(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function MY(t,n,e){if(n){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new Ie(-301,!1);r.push(n[o],i)}}}function FY(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;zs(n)&&(e[""]=t)}}function OY(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function PY(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=Su(o.type,!0)),s=new Ru(i,zs(o),ne);t.blueprint[r]=s,e[r]=s,SY(t,n,r,kF(t,e,o.hostVars,ao),o)}function LY(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function $Y(t,n,e){let r=Si(n,t),o=vY(e),i=t[Bs].rendererFactory,s=LS(t,AS(t,o,null,LY(e),r,n,null,i.createRenderer(r,e),null,null,null));return t[n.index]=s}function VY(t,n,e,r,o,i){let s=Si(t,n);BY(n[wn],s,i,t.value,e,r,o)}function BY(t,n,e,r,o,i,s){if(i==null)t.removeAttribute(n,o,e);else{let a=s==null?Vs(i):s(i,r||"",o);t.setAttribute(n,o,a,e)}}function zY(t,n,e,r,o,i){let s=i[n];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],u=s[a++],d=s[a++];NF(r,e,l,c,u,d)}}function UY(t,n,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(t.hasOwnProperty(i)){r===null&&(r=[]);let s=t[i];for(let a=0;a<s.length;a+=3)if(s[a]===n){r.push(i,s[a+1],s[a+2],e[o+1]);break}}o+=2}return r}function OF(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function LS(t,n){return t[Rh]?t[i2][Ei]=n:t[Rh]=n,t[i2]=n,n}function PF(t,n){let e=t[Ah],r=e?e.get(Eo,null):null;r&&r.handleError(n)}function $S(t,n,e,r,o){for(let i=0;i<e.length;){let s=e[i++],a=e[i++],l=e[i++],c=n[s],u=t.data[s];NF(u,c,r,a,l,o)}}function jY(t,n){let e=ns(n,t),r=e[Tt];GY(r,e);let o=e[Hs];o!==null&&e[kh]===null&&(e[kh]=sF(o,e[Ah])),VS(r,e,e[Go])}function GY(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function VS(t,n,e){wS(n);try{let r=t.viewQuery;r!==null&&AE(1,r,e);let o=t.template;o!==null&&AF(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[Op]?.finishViewCreation(t),t.staticContentQueries&&aF(t,n),t.staticViewQueries&&AE(2,t.viewQuery,e);let i=t.components;i!==null&&WY(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Ye]&=-5,CS()}}function WY(t,n){for(let e=0;e<n.length;e++)jY(t,n[e])}var js=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(js||{}),HY;function BS(t,n){return HY(t,n)}function zS(t){return(t.flags&32)===32}function Dp(t,n,e,r,o){if(r!=null){let i,s=!1;qs(r)?i=r:Ol(r)&&(s=!0,r=r[Hs]);let a=ts(r);t===0&&e!==null?o==null?SF(n,e,a):bv(n,e,a,o||null,!0):t===1&&e!==null?bv(n,e,a,o||null,!0):t===2?hY(n,a,s):t===3&&n.destroyNode(a),i!=null&&rZ(n,t,i,e,o)}}function qY(t,n){LF(t,n),n[Hs]=null,n[oo]=null}function KY(t,n,e,r,o,i){r[Hs]=o,r[oo]=n,Zv(t,r,e,1,o,i)}function LF(t,n){n[Bs].changeDetectionScheduler?.notify(10),Zv(t,n,n[wn],2,null,null)}function XY(t){let n=t[Rh];if(!n)return iE(t[Tt],t);for(;n;){let e=null;if(Ol(n))e=n[Rh];else{let r=n[jo];r&&(e=r)}if(!e){for(;n&&!n[Ei]&&n!==t;)Ol(n)&&iE(n[Tt],n),n=n[Br];n===null&&(n=t),Ol(n)&&iE(n[Tt],n),e=n&&n[Ei]}n=e}}function YY(t,n,e,r){let o=jo+r,i=e.length;r>0&&(e[o-1][Ei]=n),r<i-jo?(n[Ei]=e[o],Q2(e,jo+r,n)):(e.push(n),n[Ei]=null),n[Br]=e;let s=n[Fp];s!==null&&e!==s&&$F(s,n);let a=n[Op];a!==null&&a.insertView(t),bE(n),n[Ye]|=128}function $F(t,n){let e=t[lv],r=n[Br];if(Ol(r))t[Ye]|=2;else{let o=r[Br][Wo];n[Wo]!==o&&(t[Ye]|=2)}e===null?t[lv]=[n]:e.push(n)}function US(t,n){let e=t[lv],r=e.indexOf(n);e.splice(r,1)}function BE(t,n){if(t.length<=jo)return;let e=jo+n,r=t[e];if(r){let o=r[Fp];o!==null&&o!==t&&US(o,r),n>0&&(t[e-1][Ei]=r[Ei]);let i=ov(t,jo+n);qY(r[Tt],r);let s=i[Op];s!==null&&s.detachView(i[Tt]),r[Br]=null,r[Ei]=null,r[Ye]&=-129}return r}function VF(t,n){if(Vh(n))return;let e=n[wn];e.destroyNode&&Zv(t,n,e,3,null,null),XY(n)}function iE(t,n){if(Vh(n))return;let e=St(null);try{n[Ye]&=-129,n[Ye]|=256,n[Io]&&gp(n[Io]),QY(t,n),ZY(t,n),n[Tt].type===1&&n[wn].destroy();let r=n[Fp];if(r!==null&&qs(n[Br])){r!==n[Br]&&US(r,n);let o=n[Op];o!==null&&o.detachView(t)}NE(n)}finally{St(e)}}function ZY(t,n){let e=t.cleanup,r=n[sv];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(n[sv]=null);let o=n[Fl];if(o!==null){n[Fl]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=n[Du];if(i!==null){n[Du]=null;for(let s of i)s.destroy()}}function QY(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof Ru)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];Uo(4,a,l);try{l.call(a)}finally{Uo(5,a,l)}}else{Uo(4,o,i);try{i.call(o)}finally{Uo(5,o,i)}}}}}function BF(t,n,e){return JY(t,n.parent,e)}function JY(t,n,e){let r=n;for(;r!==null&&r.type&168;)n=r,r=n.parent;if(r===null)return e[Hs];if(Pu(r)){let{encapsulation:o}=t.data[r.directiveStart+r.componentOffset];if(o===rs.None||o===rs.Emulated)return null}return Si(r,e)}function zF(t,n,e){return tZ(t,n,e)}function eZ(t,n,e){return t.type&40?Si(t,e):null}var tZ=eZ,T2;function Yv(t,n,e,r){let o=BF(t,r,n),i=n[wn],s=r.parent||n[oo],a=zF(s,r,n);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)I2(i,o,e[l],a,!1);else I2(i,o,e,a,!1);T2!==void 0&&T2(i,r,n,e,o)}function Sh(t,n){if(n!==null){let e=n.type;if(e&3)return Si(n,t);if(e&4)return zE(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return Sh(t,r);{let o=t[n.index];return qs(o)?zE(-1,o):ts(o)}}else{if(e&128)return Sh(t,n.next);if(e&32)return BS(n,t)()||ts(t[n.index]);{let r=UF(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=ku(t[Wo]);return Sh(o,r)}else return Sh(t,n.next)}}}return null}function UF(t,n){if(n!==null){let r=t[Wo][oo],o=n.projection;return r.projection[o]}return null}function zE(t,n){let e=jo+t+1;if(e<n.length){let r=n[e],o=r[Tt].firstChild;if(o!==null)return Sh(r,o)}return n[Nu]}function jS(t,n,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&n===0&&(a&&$u(ts(a),r),e.flags|=2),!zS(e))if(l&8)jS(t,n,e.child,r,o,i,!1),Dp(n,t,o,a,i);else if(l&32){let c=BS(e,r),u;for(;u=c();)Dp(n,t,o,u,i);Dp(n,t,o,a,i)}else l&16?jF(t,n,r,e,o,i):Dp(n,t,o,a,i);e=s?e.projectionNext:e.next}}function Zv(t,n,e,r,o,i){jS(e,r,t.firstChild,n,o,i,!1)}function nZ(t,n,e){let r=n[wn],o=BF(t,e,n),i=e.parent||n[oo],s=zF(i,e,n);jF(r,0,n,e,o,s)}function jF(t,n,e,r,o,i){let s=e[Wo],l=s[oo].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];Dp(n,t,o,u,i)}else{let c=l,u=s[Br];ZM(r)&&(c.flags|=128),jS(t,n,c,u,o,i,!0)}}function rZ(t,n,e,r,o){let i=e[Nu],s=ts(e);i!==s&&Dp(n,t,r,i,o);for(let a=jo;a<e.length;a++){let l=e[a];Zv(l[Tt],l,t,n,r,i)}}function oZ(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:js.DashCase;o==null?t.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=js.Important),t.setStyle(e,r,o,i))}}function GF(t,n,e,r){let o=St(null);try{let i=n.tView,a=t[Ye]&4096?4096:16,l=AS(t,i,e,a,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=t[n.index];l[Fp]=c;let u=t[Op];return u!==null&&(l[Op]=u.createEmbeddedView(i)),VS(i,l,e),l}finally{St(o)}}function UE(t,n){return!n||n.firstChild===null||ZM(t)}function WF(t,n,e,r=!0){let o=n[Tt];if(YY(o,n,t,e),r){let s=zE(e,t),a=n[wn],l=a.parentNode(t[Nu]);l!==null&&KY(o,t[oo],a,n,l,s)}let i=n[kh];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function wv(t,n,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=n[e.index];i!==null&&r.push(ts(i)),qs(i)&&iZ(i,r);let s=e.type;if(s&8)wv(t,n,e.child,r);else if(s&32){let a=BS(e,n),l;for(;l=a();)r.push(l)}else if(s&16){let a=UF(n,e);if(Array.isArray(a))r.push(...a);else{let l=ku(n[Wo]);wv(l[Tt],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function iZ(t,n){for(let e=jo;e<t.length;e++){let r=t[e],o=r[Tt].firstChild;o!==null&&wv(r[Tt],r,o,n)}t[Nu]!==t[Hs]&&n.push(t[Nu])}var HF=[];function sZ(t){return t[Io]??aZ(t)}function aZ(t){let n=HF.pop()??Object.create(cZ);return n.lView=t,n}function lZ(t){t.lView[Io]!==t&&(t.lView=null,HF.push(t))}var cZ=qe(fe({},xu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{Bh(t.lView)},consumerOnSignalRead(){this.lView[Io]=this}});function uZ(t){let n=t[Io]??Object.create(dZ);return n.lView=t,n}var dZ=qe(fe({},xu),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=ku(t.lView);for(;n&&!qF(n[Tt]);)n=ku(n);n&&yS(n)},consumerOnSignalRead(){this.lView[Io]=this}});function qF(t){return t.type!==2}function KF(t){if(t[Du]===null)return;let n=!0;for(;n;){let e=!1;for(let r of t[Du])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));n=e&&!!(t[Ye]&8192)}}var pZ=100;function XF(t,n=!0,e=0){let o=t[Bs].rendererFactory,i=!1;i||o.begin?.();try{fZ(t,e)}catch(s){throw n&&PF(t,s),s}finally{i||o.end?.()}}function fZ(t,n){let e=IM();try{uv(!0),jE(t,n);let r=0;for(;Pv(t);){if(r===pZ)throw new Ie(103,!1);r++,jE(t,1)}}finally{uv(e)}}function mZ(t,n,e,r){if(Vh(n))return;let o=n[Ye],i=!1,s=!1;wS(n);let a=!0,l=null,c=null;i||(qF(t)?(c=sZ(n),l=hp(c)):mR()===null?(a=!1,c=uZ(n),l=hp(c)):n[Io]&&(gp(n[Io]),n[Io]=null));try{xM(n),P7(t.bindingStartIndex),e!==null&&AF(t,n,e,2,r);let u=(o&3)===3;if(!i)if(u){let f=t.preOrderCheckHooks;f!==null&&Q0(n,f,null)}else{let f=t.preOrderHooks;f!==null&&J0(n,f,0,null),nE(n,0)}if(s||hZ(n),KF(n),YF(n,0),t.contentQueries!==null&&aF(t,n),!i)if(u){let f=t.contentCheckHooks;f!==null&&Q0(n,f)}else{let f=t.contentHooks;f!==null&&J0(n,f,1),nE(n,1)}yZ(t,n);let d=t.components;d!==null&&QF(n,d,0);let p=t.viewQuery;if(p!==null&&AE(2,p,r),!i)if(u){let f=t.viewCheckHooks;f!==null&&Q0(n,f)}else{let f=t.viewHooks;f!==null&&J0(n,f,2),nE(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[Z0]){for(let f of n[Z0])f();n[Z0]=null}i||(n[Ye]&=-73)}catch(u){throw i||Bh(n),u}finally{c!==null&&(yh(c,l),a&&lZ(c)),CS()}}function YF(t,n){for(let e=eF(t);e!==null;e=tF(e))for(let r=jo;r<e.length;r++){let o=e[r];ZF(o,n)}}function hZ(t){for(let n=eF(t);n!==null;n=tF(n)){if(!(n[Ye]&2))continue;let e=n[lv];for(let r=0;r<e.length;r++){let o=e[r];yS(o)}}}function gZ(t,n,e){let r=ns(n,t);ZF(r,e)}function ZF(t,n){gS(t)&&jE(t,n)}function jE(t,n){let r=t[Tt],o=t[Ye],i=t[Io],s=!!(n===0&&o&16);if(s||=!!(o&64&&n===0),s||=!!(o&1024),s||=!!(i?.dirty&&vh(i)),s||=!1,i&&(i.dirty=!1),t[Ye]&=-9217,s)mZ(r,t,r.template,t[Go]);else if(o&8192){KF(t),YF(t,1);let a=r.components;a!==null&&QF(t,a,1)}}function QF(t,n,e){for(let r=0;r<n.length;r++)gZ(t,n[r],e)}function yZ(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)Au(~o);else{let i=o,s=e[++r],a=e[++r];$7(s,i);let l=n[i];Uo(24,l),a(2,l),Uo(25,l)}}}finally{Au(-1)}}function GS(t,n){let e=IM()?64:1088;for(t[Bs].changeDetectionScheduler?.notify(n);t;){t[Ye]|=e;let r=ku(t);if(cv(t)&&!r)return t;t=r}return null}var Fu=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let n=this._lView,e=n[Tt];return wv(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[Go]}get dirty(){return!!(this._lView[Ye]&9280)||!!this._lView[Io]?.dirty}set context(n){this._lView[Go]=n}get destroyed(){return Vh(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[Br];if(qs(n)){let e=n[av],r=e?e.indexOf(this):-1;r>-1&&(BE(n,r),ov(e,r))}this._attachedToViewContainer=!1}VF(this._lView[Tt],this._lView)}onDestroy(n){bM(this._lView,n)}markForCheck(){GS(this._cdRefInjectingView||this._lView,4)}markForRefresh(){yS(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ye]&=-129}reattach(){bE(this._lView),this._lView[Ye]|=128}detectChanges(){this._lView[Ye]|=1024,XF(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Ie(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=cv(this._lView),e=this._lView[Fp];e!==null&&!n&&US(e,this._lView),LF(this._lView[Tt],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new Ie(902,!1);this._appRef=n;let e=cv(this._lView),r=this._lView[Fp];r!==null&&!e&&$F(r,this._lView),bE(this._lView)}},Qv=(()=>{class t{static __NG_ELEMENT_ID__=bZ}return t})(),vZ=Qv,xZ=class extends vZ{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=GF(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new Fu(o)}};function bZ(){return wZ(zr(),xt())}function wZ(t,n){return t.type&4?new xZ(n,t,Wv(t,n)):null}function Gp(t,n,e,r,o){let i=t.data[n];if(i===null)i=CZ(t,n,e,r,o),L7()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=O7();i.injectorIndex=s===null?-1:s.injectorIndex}return Lu(i,!0),i}function CZ(t,n,e,r,o){let i=_M(),s=vS(),a=s?i:i&&i.parent,l=t.data[n]=IZ(t,a,e,n,r,o);return _Z(t,l,i,s),l}function _Z(t,n,e,r){t.firstChild===null&&(t.firstChild=n),e!==null&&(r?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function IZ(t,n,e,r,o,i){let s=n?n.injectorIndex:-1,a=0;return CM()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var iDe=new RegExp(`^(\\d+)*(${EX}|${IX})*(.*)`);var EZ=()=>null;function GE(t,n){return EZ(t,n)}var WE=class{},Cv=class{},HE=class{resolveComponentFactory(n){throw Error(`No component factory found for ${Vr(n)}.`)}},$p=class{static NULL=new HE},Vp=class{},Di=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>SZ()}return t})();function SZ(){let t=xt(),n=zr(),e=ns(n.index,t);return(Ol(e)?e:t)[wn]}var TZ=(()=>{class t{static \u0275prov=be({token:t,providedIn:"root",factory:()=>null})}return t})();function _v(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let s=0;s<n.length;s++){let a=n[s];if(typeof a=="number")i=a;else if(i==1)o=pE(o,a);else if(i==2){let l=a,c=n[++s];r=pE(r,l+": "+c+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}var Iv=class extends $p{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=Tu(n);return new Fh(e,this.ngModule)}};function D2(t,n){let e=[];for(let r in t){if(!t.hasOwnProperty(r))continue;let o=t[r];if(o===void 0)continue;let i=Array.isArray(o),s=i?o[0]:o,a=i?o[1]:Pl.None;n?e.push({propName:s,templateName:r,isSignal:(a&Pl.SignalBased)!==0}):e.push({propName:s,templateName:r})}return e}function DZ(t){let n=t.toLowerCase();return n==="svg"?C7:n==="math"?_7:null}var Fh=class extends Cv{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let n=this.componentDef,e=n.inputTransforms,r=D2(n.inputs,!0);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return D2(this.componentDef.outputs,!1)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=uY(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,r,o){let i=St(null);try{o=o||this.ngModule;let s=o instanceof no?o:o?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new _E(n,s):n,l=a.get(Vp,null);if(l===null)throw new Ie(407,!1);let c=a.get(TZ,null),u=a.get(Mu,null),d={rendererFactory:l,sanitizer:c,changeDetectionScheduler:u},p=l.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",m=r?bY(p,r,this.componentDef.encapsulation,a):EF(p,f,DZ(f)),h=512;this.componentDef.signals?h|=4096:this.componentDef.onPush||(h|=16);let g=null;m!==null&&(g=sF(m,a,!0));let x=FS(0,null,null,1,0,null,null,null,null,null,null),b=AS(null,x,null,h,null,null,d,p,a,null,g);b[ro]=m,wS(b);let I=null;try{let _=r?["ng-version","19.1.4"]:dY(this.componentDef.selectors[0]),E=Gp(x,ro,2,"#host",_),[S,D]=FF(x,E,[this.componentDef]);MF(x,b,E,S,{},D);for(let M of S)E.mergedAttrs=Lp(E.mergedAttrs,M.hostAttrs);E.mergedAttrs=Lp(E.mergedAttrs,_),_v(E,E.mergedAttrs,!0),m&&(TF(p,m,E),$u(m,b)),e!==void 0&&NZ(E,this.ngContentSelectors,e),RF(x,b,E),NS(x,E,b),Uv(x,E),I=ns(E.index,b),b[Go]=I[Go],VS(x,b,null)}catch(_){throw I!==null&&NE(I),NE(b),_}finally{CS()}return new qE(this.componentType,b)}finally{St(i)}}},qE=class extends WE{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=vM(e[Tt],ro),this.location=Wv(this._tNode,e),this.instance=ns(this._tNode.index,e)[Go],this.hostView=this.changeDetectorRef=new Fu(e,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let i=this._rootLView;$S(i[Tt],i,o,n,e),this.previousInputValues.set(n,e);let s=ns(this._tNode.index,i);GS(s,1)}}get injector(){return new Eu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function NZ(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var Wp=(()=>{class t{static __NG_ELEMENT_ID__=kZ}return t})();function kZ(){let t=zr();return RZ(t,xt())}var AZ=Wp,JF=class extends AZ{_lContainer;_hostTNode;_hostLView;constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return Wv(this._hostTNode,this._hostLView)}get injector(){return new Eu(this._hostTNode,this._hostLView)}get parentInjector(){let n=_S(this._hostTNode,this._hostLView);if(OM(n)){let e=pv(n,this._hostLView),r=dv(n),o=e[Tt].data[r+8];return new Eu(o,e)}else return new Eu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=N2(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-jo}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=GE(this._lContainer,n.ssrId),a=n.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,UE(this._hostTNode,s)),a}createComponent(n,e,r,o,i){let s=n&&!v7(n),a;if(s)a=e;else{let m=e||{};a=m.index,r=m.injector,o=m.projectableNodes,i=m.environmentInjector||m.ngModuleRef}let l=s?n:new Fh(Tu(n)),c=r||this.parentInjector;if(!i&&l.ngModule==null){let h=(s?c:this.parentInjector).get(no,null);h&&(i=h)}let u=Tu(l.componentType??{}),d=GE(this._lContainer,u?.id??null),p=d?.firstChild??null,f=l.create(c,o,p,i);return this.insertImpl(f.hostView,a,UE(this._hostTNode,d)),f}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(E7(o)){let a=this.indexOf(n);if(a!==-1)this.detach(a);else{let l=o[Br],c=new JF(l,l[oo],l[Br]);c.detach(c.indexOf(n))}}let i=this._adjustIndex(e),s=this._lContainer;return WF(s,o,i,r),n.attachToViewContainerRef(),Q2(sE(s),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=N2(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=BE(this._lContainer,e);r&&(ov(sE(this._lContainer),e),VF(r[Tt],r))}detach(n){let e=this._adjustIndex(n,-1),r=BE(this._lContainer,e);return r&&ov(sE(this._lContainer),e)!=null?new Fu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function N2(t){return t[av]}function sE(t){return t[av]||(t[av]=[])}function RZ(t,n){let e,r=n[t.index];return qs(r)?e=r:(e=OF(r,n,null,t),n[t.index]=e,LS(n,e)),FZ(e,n,t,r),new JF(e,t,n)}function MZ(t,n){let e=t[wn],r=e.createComment(""),o=Si(n,t),i=e.parentNode(o);return bv(e,i,r,e.nextSibling(o),!1),r}var FZ=LZ,OZ=()=>!1;function PZ(t,n,e){return OZ(t,n,e)}function LZ(t,n,e,r){if(t[Nu])return;let o;e.type&8?o=ts(r):o=MZ(n,e),t[Nu]=o}var Ll=class{},Oh=class{};var KE=class extends Ll{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Iv(this);constructor(n,e,r,o=!0){super(),this.ngModuleType=n,this._parent=e;let i=tM(n);this._bootstrapComponents=CF(i.bootstrap),this._r3Injector=GM(n,e,[{provide:Ll,useValue:this},{provide:$p,useValue:this.componentFactoryResolver},...r],Vr(n),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},XE=class extends Oh{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new KE(this.moduleType,n,[])}};var Ev=class extends Ll{injector;componentFactoryResolver=new Iv(this);instance=null;constructor(n){super();let e=new Nh([...n.providers,{provide:Ll,useValue:this},{provide:$p,useValue:this.componentFactoryResolver}],n.parent||mS(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function WS(t,n,e=null){return new Ev({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var $Z=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=iM(!1,e.type),o=r.length>0?WS([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=be({token:t,providedIn:"environment",factory:()=>new t(Me(no))})}return t})();function ht(t){return Lh(()=>{let n=tO(t),e=qe(fe({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===QM.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?o=>o.get($Z).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||rs.Emulated,styles:t.styles||to,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&$l("NgStandalone"),nO(e);let r=t.dependencies;return e.directiveDefs=A2(r,!1),e.pipeDefs=A2(r,!0),e.id=zZ(e),e})}function VZ(t){return Tu(t)||nM(t)}function BZ(t){return t!==null}function Qn(t){return Lh(()=>({type:t.type,bootstrap:t.bootstrap||to,declarations:t.declarations||to,imports:t.imports||to,exports:t.exports||to,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function k2(t,n){if(t==null)return Ap;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,s,a=Pl.None;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i):(i=o,s=o),n?(e[i]=a!==Pl.None?[r,a]:r,n[i]=s):e[i]=r}return e}function Dt(t){return Lh(()=>{let n=tO(t);return nO(n),n})}function eO(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function tO(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||Ap,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||to,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:k2(t.inputs,n),outputs:k2(t.outputs),debugInfo:null}}function nO(t){t.features?.forEach(n=>n(t))}function A2(t,n){if(!t)return null;let e=n?rM:VZ;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(BZ)}function zZ(t){let n=0,e=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,e,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let i of r.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function UZ(t){return Object.getPrototypeOf(t.prototype).constructor}function An(t){let n=UZ(t.type),e=!0,r=[t];for(;n;){let o;if(zs(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new Ie(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);let s=t;s.inputs=K0(t.inputs),s.inputTransforms=K0(t.inputTransforms),s.declaredInputs=K0(t.declaredInputs),s.outputs=K0(t.outputs);let a=o.hostBindings;a&&qZ(t,a);let l=o.viewQuery,c=o.contentQueries;if(l&&WZ(t,l),c&&HZ(t,c),jZ(t,o),V9(t.outputs,o.outputs),zs(o)&&o.data.animation){let u=t.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(t),a===An&&(e=!1)}}n=Object.getPrototypeOf(n)}GZ(r)}function jZ(t,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;let r=n.inputs[e];if(r!==void 0&&(t.inputs[e]=r,t.declaredInputs[e]=n.declaredInputs[e],n.inputTransforms!==null)){let o=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(o))continue;t.inputTransforms??={},t.inputTransforms[o]=n.inputTransforms[o]}}}function GZ(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){let o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=Lp(o.hostAttrs,e=Lp(e,o.hostAttrs))}}function K0(t){return t===Ap?{}:t===to?[]:t}function WZ(t,n){let e=t.viewQuery;e?t.viewQuery=(r,o)=>{n(r,o),e(r,o)}:t.viewQuery=n}function HZ(t,n){let e=t.contentQueries;e?t.contentQueries=(r,o,i)=>{n(r,o,i),e(r,o,i)}:t.contentQueries=n}function qZ(t,n){let e=t.hostBindings;e?t.hostBindings=(r,o)=>{n(r,o),e(r,o)}:t.hostBindings=n}function Vu(t){let n=t.inputConfig,e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r];Array.isArray(o)&&o[3]&&(e[r]=o[3])}t.inputTransforms=e}function rO(t){return XZ(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function KZ(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{let e=t[Symbol.iterator](),r;for(;!(r=e.next()).done;)n(r.value)}}function XZ(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function oO(t,n,e){return t[n]=e}function Gs(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function HS(t,n,e,r){let o=Gs(t,n,e);return Gs(t,n+1,r)||o}function iO(t,n,e,r,o){let i=HS(t,n,e,r);return Gs(t,n+2,o)||i}function YZ(t,n,e,r,o,i,s,a,l){let c=n.consts,u=Gp(n,t,4,s||null,a||null);PS(n,e,u,Pp(c,l)),Uv(n,u);let d=u.tView=FS(2,u,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return n.queries!==null&&(n.queries.template(n,u),d.queries=n.queries.embeddedTView(u)),u}function sO(t,n,e,r,o,i,s,a,l,c){let u=e+ro,d=n.firstCreatePass?YZ(u,n,t,r,o,i,s,a,l):n.data[u];Lu(d,!1);let p=ZZ(n,t,d,e);Bv()&&Yv(n,t,p,d),$u(p,t);let f=OF(p,t,p,d);return t[u]=f,LS(t,f),PZ(f,d,t),Ov(d)&&RS(n,t,d),l!=null&&MS(t,d,c),d}function te(t,n,e,r,o,i,s,a){let l=xt(),c=Gn(),u=Pp(c.consts,i);return sO(l,c,t,n,e,r,o,u,s,a),te}var ZZ=QZ;function QZ(t,n,e,r){return zv(!0),n[wn].createComment("")}var qS=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var aO=new ke("");function Bu(t){return!!t&&typeof t.then=="function"}function lO(t){return!!t&&typeof t.subscribe=="function"}var cO=new ke("");var uO=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=ie(cO,{optional:!0})??[];injector=ie(kn);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=dr(this.injector,o);if(Bu(i))e.push(i);else if(lO(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),dO=(()=>{class t{static \u0275prov=be({token:t,providedIn:"root",factory:()=>new Sv})}return t})(),Sv=class{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){let e=n.zone,r=this.queues.get(e);r.has(n)&&(r.delete(n),this.queuedEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(n)||(this.queuedEffectCount++,r.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,e]of this.queues)n===null?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(let e of n)n.delete(e),this.queuedEffectCount--,e.run()}},Jv=new ke("");function JZ(){ER(()=>{throw new Ie(600,!1)})}function eQ(t){return t.isBoundToModule}var tQ=10;function nQ(t,n,e){try{let r=e();return Bu(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var Ws=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=ie(hX);afterRenderManager=ie(TX);zonelessEnabled=ie(Gv);rootEffectScheduler=ie(dO);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new vn;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=ie(Xs).hasPendingTasks.pipe(Ge(e=>!e));constructor(){ie(qv,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=ie(no);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){let o=e instanceof Cv;if(!this._injector.get(uO).done){let p=!o&&oM(e),f=!1;throw new Ie(405,f)}let s;o?s=e:s=this._injector.get($p).resolveComponentFactory(e),this.componentTypes.push(s.componentType);let a=eQ(s)?void 0:this._injector.get(Ll),l=r||s.selector,c=s.create(kn.NULL,[],l,a),u=c.location.nativeElement,d=c.injector.get(aO,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),ev(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(iF.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new Ie(101,!1);let e=St(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,St(e),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(Vp,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let e=0;for(;this.dirtyFlags!==0&&e++<tQ;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)rQ(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>Pv(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;ev(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(Jv,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>ev(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new Ie(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function ev(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function rQ(t,n,e,r){if(!e&&!Pv(t))return;XF(t,n,e&&!r?0:1)}function os(t,n,e,r){let o=xt(),i=Lv();if(Gs(o,i,n)){let s=Gn(),a=Vv();VY(a,o,t,n,e,r)}return os}function pO(t,n,e,r){return Gs(t,Lv(),e)?n+Vs(e)+r:ao}function oQ(t,n,e,r,o,i){let s=EM(),a=HS(t,s,e,o);return $v(2),a?n+Vs(e)+r+Vs(o)+i:ao}function iQ(t,n,e,r,o,i,s,a){let l=EM(),c=iO(t,l,e,o,s);return $v(3),c?n+Vs(e)+r+Vs(o)+i+Vs(s)+a:ao}function X0(t,n){return t<<17|n<<2}function Ou(t){return t>>17&32767}function sQ(t){return(t&2)==2}function aQ(t,n){return t&131071|n<<17}function YE(t){return t|2}function Bp(t){return(t&131068)>>2}function aE(t,n){return t&-131069|n<<2}function lQ(t){return(t&1)===1}function ZE(t){return t|1}function cQ(t,n,e,r,o,i){let s=i?n.classBindings:n.styleBindings,a=Ou(s),l=Bp(s);t[r]=e;let c=!1,u;if(Array.isArray(e)){let d=e;u=d[1],(u===null||$h(d,u)>0)&&(c=!0)}else u=e;if(o)if(l!==0){let p=Ou(t[a+1]);t[r+1]=X0(p,a),p!==0&&(t[p+1]=aE(t[p+1],r)),t[a+1]=aQ(t[a+1],r)}else t[r+1]=X0(a,0),a!==0&&(t[a+1]=aE(t[a+1],r)),a=r;else t[r+1]=X0(l,0),a===0?a=r:t[l+1]=aE(t[l+1],r),l=r;c&&(t[r+1]=YE(t[r+1])),R2(t,u,r,!0),R2(t,u,r,!1),uQ(n,u,t,r,i),s=X0(a,l),i?n.classBindings=s:n.styleBindings=s}function uQ(t,n,e,r,o){let i=o?t.residualClasses:t.residualStyles;i!=null&&typeof n=="string"&&$h(i,n)>=0&&(e[r+1]=ZE(e[r+1]))}function R2(t,n,e,r){let o=t[e+1],i=n===null,s=r?Ou(o):Bp(o),a=!1;for(;s!==0&&(a===!1||i);){let l=t[s],c=t[s+1];dQ(l,n)&&(a=!0,t[s+1]=r?ZE(c):YE(c)),s=r?Ou(c):Bp(c)}a&&(t[e+1]=r?YE(o):ZE(o))}function dQ(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?$h(t,n)>=0:!1}var Ii={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function pQ(t){return t.substring(Ii.key,Ii.keyEnd)}function fQ(t){return mQ(t),fO(t,mO(t,0,Ii.textEnd))}function fO(t,n){let e=Ii.textEnd;return e===n?-1:(n=Ii.keyEnd=hQ(t,Ii.key=n,e),mO(t,n,e))}function mQ(t){Ii.key=0,Ii.keyEnd=0,Ii.value=0,Ii.valueEnd=0,Ii.textEnd=t.length}function mO(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function hQ(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}function U(t,n,e){let r=xt(),o=Lv();if(Gs(r,o,n)){let i=Gn(),s=Vv();OS(i,s,r,t,n,r[wn],e,!1)}return U}function QE(t,n,e,r,o){let i=n.inputs,s=o?"class":"style";$S(t,e,i[s],s,r)}function Hp(t,n,e){return hO(t,n,e,!1),Hp}function So(t,n){return hO(t,n,null,!0),So}function ex(t){yQ(_Q,gQ,t,!0)}function gQ(t,n){for(let e=fQ(n);e>=0;e=fO(n,e))pS(t,pQ(n),!0)}function hO(t,n,e,r){let o=xt(),i=Gn(),s=$v(2);if(i.firstUpdatePass&&yO(i,t,s,r),n!==ao&&Gs(o,s,n)){let a=i.data[Ks()];vO(i,a,o,o[wn],t,o[s+1]=EQ(n,e),r,s)}}function yQ(t,n,e,r){let o=Gn(),i=$v(2);o.firstUpdatePass&&yO(o,null,i,r);let s=xt();if(e!==ao&&Gs(s,i,e)){let a=o.data[Ks()];if(xO(a,r)&&!gO(o,i)){let l=r?a.classesWithoutHost:a.stylesWithoutHost;l!==null&&(e=pE(l,e||"")),QE(o,a,s,e,r)}else IQ(o,a,s,s[wn],s[i+1],s[i+1]=CQ(t,n,e),r,i)}}function gO(t,n){return n>=t.expandoStartIndex}function yO(t,n,e,r){let o=t.data;if(o[e+1]===null){let i=o[Ks()],s=gO(t,e);xO(i,r)&&n===null&&!s&&(n=!1),n=vQ(o,i,n,r),cQ(o,i,n,e,s,r)}}function vQ(t,n,e,r){let o=B7(t),i=r?n.residualClasses:n.residualStyles;if(o===null)(r?n.classBindings:n.styleBindings)===0&&(e=lE(null,t,n,e,r),e=Ph(e,n.attrs,r),i=null);else{let s=n.directiveStylingLast;if(s===-1||t[s]!==o)if(e=lE(o,t,n,e,r),i===null){let l=xQ(t,n,r);l!==void 0&&Array.isArray(l)&&(l=lE(null,t,n,l[1],r),l=Ph(l,n.attrs,r),bQ(t,n,r,l))}else i=wQ(t,n,r)}return i!==void 0&&(r?n.residualClasses=i:n.residualStyles=i),e}function xQ(t,n,e){let r=e?n.classBindings:n.styleBindings;if(Bp(r)!==0)return t[Ou(r)]}function bQ(t,n,e,r){let o=e?n.classBindings:n.styleBindings;t[Ou(o)]=r}function wQ(t,n,e){let r,o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++){let s=t[i].hostAttrs;r=Ph(r,s,e)}return Ph(r,n.attrs,e)}function lE(t,n,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=n[a],r=Ph(r,i.hostAttrs,o),i!==t);)a++;return t!==null&&(e.directiveStylingLast=a),r}function Ph(t,n,e){let r=e?1:2,o=-1;if(n!==null)for(let i=0;i<n.length;i++){let s=n[i];typeof s=="number"?o=s:o===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),pS(t,s,e?!0:n[++i]))}return t===void 0?null:t}function CQ(t,n,e){if(e==null||e==="")return to;let r=[],o=Ti(e);if(Array.isArray(o))for(let i=0;i<o.length;i++)t(r,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&t(r,i,o[i]);else typeof o=="string"&&n(r,o);return r}function _Q(t,n,e){let r=String(n);r!==""&&!r.includes(" ")&&pS(t,r,e)}function IQ(t,n,e,r,o,i,s,a){o===ao&&(o=to);let l=0,c=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let p=l<o.length?o[l+1]:void 0,f=c<i.length?i[c+1]:void 0,m=null,h;u===d?(l+=2,c+=2,p!==f&&(m=d,h=f)):d===null||u!==null&&u<d?(l+=2,m=u):(c+=2,m=d,h=f),m!==null&&vO(t,n,e,r,m,h,s,a),u=l<o.length?o[l]:null,d=c<i.length?i[c]:null}}function vO(t,n,e,r,o,i,s,a){if(!(n.type&3))return;let l=t.data,c=l[a+1],u=lQ(c)?M2(l,n,e,o,Bp(c),s):void 0;if(!Tv(u)){Tv(i)||sQ(c)&&(i=M2(l,null,e,o,a,s));let d=yM(Ks(),e);oZ(r,s,d,o,i)}}function M2(t,n,e,r,o,i){let s=n===null,a;for(;o>0;){let l=t[o],c=Array.isArray(l),u=c?l[1]:l,d=u===null,p=e[o+1];p===ao&&(p=d?to:void 0);let f=d?eE(p,r):u===r?p:void 0;if(c&&!Tv(f)&&(f=eE(l,r)),Tv(f)&&(a=f,s))return a;let m=t[o+1];o=s?Ou(m):Bp(m)}if(n!==null){let l=i?n.residualClasses:n.residualStyles;l!=null&&(a=eE(l,r))}return a}function Tv(t){return t!==void 0}function EQ(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Vr(Ti(t)))),t}function xO(t,n){return(t.flags&(n?8:16))!==0}function SQ(t,n,e,r,o,i){let s=n.consts,a=Pp(s,o),l=Gp(n,t,2,r,a);return PS(n,e,l,Pp(s,i)),l.attrs!==null&&_v(l,l.attrs,!1),l.mergedAttrs!==null&&_v(l,l.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,l),l}function v(t,n,e,r){let o=xt(),i=Gn(),s=ro+t,a=o[wn],l=i.firstCreatePass?SQ(s,i,o,n,e,r):i.data[s],c=TQ(i,o,l,a,n,t);o[s]=c;let u=Ov(l);return Lu(l,!0),TF(a,c,l),!zS(l)&&Bv()&&Yv(i,o,c,l),k7()===0&&$u(c,o),A7(),u&&(RS(i,o,l),NS(i,l,o)),r!==null&&MS(o,l),v}function y(){let t=zr();vS()?xS():(t=t.parent,Lu(t,!1));let n=t;M7(n)&&F7(),R7();let e=Gn();return e.firstCreatePass&&(Uv(e,t),hS(t)&&e.queries.elementEnd(t)),n.classesWithoutHost!=null&&q7(n)&&QE(e,n,xt(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&K7(n)&&QE(e,n,xt(),n.stylesWithoutHost,!1),y}function z(t,n,e,r){return v(t,n,e,r),y(),z}var TQ=(t,n,e,r,o,i)=>(zv(!0),EF(r,o,j7()));function DQ(t,n,e,r,o){let i=n.consts,s=Pp(i,r),a=Gp(n,t,8,"ng-container",s);s!==null&&_v(a,s,!0);let l=Pp(i,o);return PS(n,e,a,l),n.queries!==null&&n.queries.elementStart(n,a),a}function Zs(t,n,e){let r=xt(),o=Gn(),i=t+ro,s=o.firstCreatePass?DQ(i,o,r,n,e):o.data[i];Lu(s,!0);let a=NQ(o,r,s,t);return r[i]=a,Bv()&&Yv(o,r,a,s),$u(a,r),Ov(s)&&(RS(o,r,s),NS(o,s,r)),e!=null&&MS(r,s),Zs}function Qs(){let t=zr(),n=Gn();return vS()?xS():(t=t.parent,Lu(t,!1)),n.firstCreatePass&&(Uv(n,t),hS(t)&&n.queries.elementEnd(t)),Qs}var NQ=(t,n,e,r)=>(zv(!0),mY(n[wn],""));function et(){return xt()}var Iu=void 0;function kQ(t){let n=t,e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return e===1&&r===0?1:5}var AQ=["en",[["a","p"],["AM","PM"],Iu],[["AM","PM"],Iu,Iu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Iu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Iu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Iu,"{1} 'at' {0}",Iu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",kQ],cE={};function Ko(t){let n=RQ(t),e=F2(n);if(e)return e;let r=n.split("-")[0];if(e=F2(r),e)return e;if(r==="en")return AQ;throw new Ie(701,!1)}function F2(t){return t in cE||(cE[t]=$s.ng&&$s.ng.common&&$s.ng.common.locales&&$s.ng.common.locales[t]),cE[t]}var Tn=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(Tn||{});function RQ(t){return t.toLowerCase().replace(/_/g,"-")}var Dv="en-US";var MQ=Dv;function FQ(t){typeof t=="string"&&(MQ=t.toLowerCase().replace(/_/g,"-"))}var OQ=(t,n,e)=>{};function ae(t,n,e,r){let o=xt(),i=Gn(),s=zr();return bO(i,o,o[wn],s,t,n,r),ae}function PQ(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=n[sv],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function bO(t,n,e,r,o,i,s){let a=Ov(r),c=t.firstCreatePass&&N7(t),u=n[Go],d=D7(n),p=!0;if(r.type&3||s){let h=Si(r,n),g=s?s(h):h,x=d.length,b=s?_=>s(ts(_[r.index])):r.index,I=null;if(!s&&a&&(I=PQ(t,n,o,r.index)),I!==null){let _=I.__ngLastListenerFn__||I;_.__ngNextListenerFn__=i,I.__ngLastListenerFn__=i,p=!1}else{i=P2(r,n,u,i),OQ(h,o,i);let _=e.listen(g,o,i);d.push(i,_),c&&c.push(o,b,x,x+1)}}else i=P2(r,n,u,i);let f=r.outputs,m;if(p&&f!==null&&(m=f[o])){let h=m.length;if(h)for(let g=0;g<h;g+=2){let x=m[g],b=m[g+1],E=n[x][b].subscribe(i),S=d.length;d.push(i,E),c&&c.push(o,r.index,S,-(S+1))}}}function O2(t,n,e,r){let o=St(null);try{return Uo(6,n,e),e(r)!==!1}catch(i){return PF(t,i),!1}finally{Uo(7,n,e),St(o)}}function P2(t,n,e,r){return function o(i){if(i===Function)return r;let s=Pu(t)?ns(t.index,n):n;GS(s,5);let a=O2(n,e,r,i),l=o.__ngNextListenerFn__;for(;l;)a=O2(n,e,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function Y(t=1){return U7(t)}function LQ(t,n){let e=null,r=iY(t);for(let o=0;o<n.length;o++){let i=n[o];if(i==="*"){e=o;continue}if(r===null?IF(t,i,!0):lY(r,i))return o}return e}function KS(t){let n=xt()[Wo][oo];if(!n.projection){let e=t?t.length:1,r=n.projection=o7(e,null),o=r.slice(),i=n.child;for(;i!==null;){if(i.type!==128){let s=t?LQ(i,t):0;s!==null&&(o[s]?o[s].projectionNext=i:r[s]=i,o[s]=i)}i=i.next}}}function XS(t,n=0,e,r,o,i){let s=xt(),a=Gn(),l=r?t+1:null;l!==null&&sO(s,a,l,r,o,i,null,e);let c=Gp(a,ro+t,16,null,e||null);c.projection===null&&(c.projection=n),xS();let d=!s[kh]||CM();s[Wo][oo].projection[c.projection]===null&&l!==null?$Q(s,a,l):d&&!zS(c)&&nZ(a,s,c)}function $Q(t,n,e){let r=ro+e,o=n.data[r],i=t[r],s=GE(i,o.tView.ssrId),a=GF(t,o,void 0,{dehydratedView:s});WF(i,a,0,UE(o,s))}function zu(t,n,e){return tx(t,"",n,"",e),zu}function tx(t,n,e,r,o){let i=xt(),s=pO(i,n,e,r);if(s!==ao){let a=Gn(),l=Vv();OS(a,l,i,t,s,i[wn],o,!1)}return tx}function VQ(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}function C(t,n=""){let e=xt(),r=Gn(),o=t+ro,i=r.firstCreatePass?Gp(r,o,1,n,null):r.data[o],s=BQ(r,e,i,n,t);e[o]=s,Bv()&&Yv(r,e,s,i),Lu(i,!1)}var BQ=(t,n,e,r,o)=>(zv(!0),pY(n[wn],r));function tt(t){return $e("",t,""),tt}function $e(t,n,e){let r=xt(),o=pO(r,t,n,e);return o!==ao&&YS(r,Ks(),o),$e}function Uu(t,n,e,r,o){let i=xt(),s=oQ(i,t,n,e,r,o);return s!==ao&&YS(i,Ks(),s),Uu}function jh(t,n,e,r,o,i,s){let a=xt(),l=iQ(a,t,n,e,r,o,i,s);return l!==ao&&YS(a,Ks(),l),jh}function YS(t,n,e){let r=yM(n,t);fY(t[wn],r,e)}function pr(t,n,e){YM(n)&&(n=n());let r=xt(),o=Lv();if(Gs(r,o,n)){let i=Gn(),s=Vv();OS(i,s,r,t,n,r[wn],e,!1)}return pr}function Tr(t,n){let e=YM(t);return e&&t.set(n),e}function fr(t,n){let e=xt(),r=Gn(),o=zr();return bO(r,e,e[wn],o,t,n),fr}function zQ(t,n,e){let r=Gn();if(r.firstCreatePass){let o=zs(t);JE(e,r.data,r.blueprint,o,!0),JE(n,r.data,r.blueprint,o,!1)}}function JE(t,n,e,r,o){if(t=$r(t),Array.isArray(t))for(let i=0;i<t.length;i++)JE(t[i],n,e,r,o);else{let i=Gn(),s=xt(),a=zr(),l=Mp(t)?t:$r(t.provide),c=lM(t),u=a.providerIndexes&1048575,d=a.directiveStart,p=a.providerIndexes>>20;if(Mp(t)||!t.multi){let f=new Ru(c,o,ne),m=dE(l,n,o?u:u+p,d);m===-1?(EE(mv(a,s),i,l),uE(i,t,n.length),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(f),s.push(f)):(e[m]=f,s[m]=f)}else{let f=dE(l,n,u+p,d),m=dE(l,n,u,u+p),h=f>=0&&e[f],g=m>=0&&e[m];if(o&&!g||!o&&!h){EE(mv(a,s),i,l);let x=GQ(o?jQ:UQ,e.length,o,r,c);!o&&g&&(e[m].providerFactory=x),uE(i,t,n.length,0),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(x),s.push(x)}else{let x=wO(e[o?m:f],c,!o&&r);uE(i,t,f>-1?f:m,x)}!o&&r&&g&&e[m].componentProviders++}}}function uE(t,n,e,r){let o=Mp(n),i=d7(n);if(o||i){let l=(i?$r(n.useClass):n).prototype.ngOnDestroy;if(l){let c=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){let u=c.indexOf(e);u===-1?c.push(e,[r,l]):c[u+1].push(r,l)}else c.push(e,l)}}}function wO(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function dE(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function UQ(t,n,e,r){return eS(this.multi,[])}function jQ(t,n,e,r){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=hv(e,e[Tt],this.providerFactory.index,r);i=a.slice(0,s),eS(o,i);for(let l=s;l<a.length;l++)i.push(a[l])}else i=[],eS(o,i);return i}function eS(t,n){for(let e=0;e<t.length;e++){let r=t[e];n.push(r())}return n}function GQ(t,n,e,r,o){let i=new Ru(t,e,ne);return i.multi=[],i.index=n,i.componentProviders=0,wO(i,o,r&&!e),i}function mr(t,n=[]){return e=>{e.providersResolver=(r,o)=>zQ(r,o?o(t):t,n)}}function is(t,n,e,r,o){return _O(xt(),bS(),t,n,e,r,o)}function zl(t,n,e,r,o,i){return WQ(xt(),bS(),t,n,e,r,o,i)}function CO(t,n){let e=t[n];return e===ao?void 0:e}function _O(t,n,e,r,o,i,s){let a=n+e;return HS(t,a,o,i)?oO(t,a+2,s?r.call(s,o,i):r(o,i)):CO(t,a+2)}function WQ(t,n,e,r,o,i,s,a){let l=n+e;return iO(t,l,o,i,s)?oO(t,l+3,a?r.call(a,o,i,s):r(o,i,s)):CO(t,l+3)}function Ni(t,n){let e=Gn(),r,o=t+ro;e.firstCreatePass?(r=HQ(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks??=[]).push(o,r.onDestroy)):r=e.data[o];let i=r.factory||(r.factory=Su(r.type,!0)),s,a=eo(ne);try{let l=fv(!1),c=i();return fv(l),VQ(e,xt(),o,c),c}finally{eo(a)}}function HQ(t,n){if(n)for(let e=n.length-1;e>=0;e--){let r=n[e];if(t===r.name)return r}}function ki(t,n,e,r){let o=t+ro,i=xt(),s=I7(i,o);return qQ(i,o)?_O(i,bS(),n,s.transform,e,r,s):s.transform(e,r)}function qQ(t,n){return t[Tt].data[n].pure}var tS=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},ZS=(()=>{class t{compileModuleSync(e){return new XE(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=tM(e),i=CF(o.declarations).reduce((s,a)=>{let l=Tu(a);return l&&s.push(new Fh(l)),s},[]);return new tS(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var KQ=(()=>{class t{zone=ie(sn);changeDetectionScheduler=ie(Mu);applicationRef=ie(Ws);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function XQ({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new sn(qe(fe({},YQ()),{scheduleInRootZone:e})),[{provide:sn,useFactory:t},{provide:Rp,multi:!0,useFactory:()=>{let r=ie(KQ,{optional:!0});return()=>r.initialize()}},{provide:Rp,multi:!0,useFactory:()=>{let r=ie(ZQ);return()=>{r.initialize()}}},n===!0?{provide:HM,useValue:!0}:[],{provide:IS,useValue:e??WM}]}function YQ(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var ZQ=(()=>{class t{subscription=new gn;initialized=!1;zone=ie(sn);pendingTasks=ie(Xs);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{sn.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{sn.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var IO=(()=>{class t{appRef=ie(Ws);taskService=ie(Xs);ngZone=ie(sn);zonelessEnabled=ie(Gv);tracing=ie(qv,{optional:!0});disableScheduling=ie(HM,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new gn;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(vv):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(ie(IS,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof xv||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?p2:qM;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(vv+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,p2(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function EO(){return $l("NgZoneless"),zp([{provide:Mu,useExisting:IO},{provide:sn,useClass:xv},{provide:Gv,useValue:!0},{provide:IS,useValue:!1},[]])}function QQ(){return typeof $localize<"u"&&$localize.locale||Dv}var Gh=new ke("",{providedIn:"root",factory:()=>ie(Gh,lt.Optional|lt.SkipSelf)||QQ()});var nS=new ke(""),JQ=new ke("");function Ih(t){return!t.moduleRef}function eJ(t){let n=Ih(t)?t.r3Injector:t.moduleRef.injector,e=n.get(sn);return e.run(()=>{Ih(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=n.get(Eo,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),Ih(t)){let i=()=>n.destroy(),s=t.platformInjector.get(nS);s.add(i),n.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>t.moduleRef.destroy(),s=t.platformInjector.get(nS);s.add(i),t.moduleRef.onDestroy(()=>{ev(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(i)})}return nQ(r,e,()=>{let i=n.get(uO);return i.runInitializers(),i.donePromise.then(()=>{let s=n.get(Gh,Dv);if(FQ(s||Dv),!n.get(JQ,!0))return Ih(t)?n.get(Ws):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(Ih(t)){let l=n.get(Ws);return t.rootComponent!==void 0&&l.bootstrap(t.rootComponent),l}else return tJ(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function tJ(t,n){let e=t.injector.get(Ws);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(e);else throw new Ie(-403,!1);n.push(t)}var tv=null;function nJ(t=[],n){return kn.create({name:n,providers:[{provide:Mv,useValue:"platform"},{provide:nS,useValue:new Set([()=>tv=null])},...t]})}function rJ(t=[]){if(tv)return tv;let n=nJ(t);return tv=n,JZ(),oJ(n),n}function oJ(t){let n=t.get(DS,null);dr(t,()=>{n?.forEach(e=>e())})}var It=(()=>{class t{static __NG_ELEMENT_ID__=iJ}return t})();function iJ(t){return sJ(zr(),xt(),(t&16)===16)}function sJ(t,n,e){if(Pu(t)&&!e){let r=ns(t.index,n);return new Fu(r,r)}else if(t.type&175){let r=n[Wo];return new Fu(r,n)}return null}var rS=class{constructor(){}supports(n){return rO(n)}create(n){return new oS(n)}},aJ=(t,n)=>n,oS=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||aJ}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<L2(r,o,i)?e:r,a=L2(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let c=a-o,u=l-o;if(c!=u){for(let p=0;p<c;p++){let f=p<i.length?i[p]:i[p]=0,m=f+p;u<=m&&m<c&&(i[p]=f+1)}let d=s.previousIndex;i[d]=u-c}}a!==l&&n(s,a,l)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!rO(n))throw new Ie(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)i=n[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,KZ(n,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):(n=this._linkedRecords===null?null:this._linkedRecords.get(r,o),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new iS(e,r),i,o)),n}_verifyReinsertion(n,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let o=n._prevRemoved,i=n._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){let o=e===null?this._itHead:e._next;return n._next=o,n._prev=e,o===null?this._itTail=n:o._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new Nv),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,r=n._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new Nv),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},iS=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},sS=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){let e=n._prevDup,r=n._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},Nv=class{map=new Map;put(n){let e=n.trackById,r=this.map.get(e);r||(r=new sS,this.map.set(e,r)),r.add(n)}get(n,e){let r=n,o=this.map.get(r);return o?o.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function L2(t,n,e){let r=t.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}function $2(){return new QS([new rS])}var QS=(()=>{class t{factories;static \u0275prov=be({token:t,providedIn:"root",factory:$2});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||$2()),deps:[[t,new Z2,new uS]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new Ie(901,!1)}}return t})();function SO(t){try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=rJ(r),i=[XQ({}),{provide:Mu,useExisting:IO},...e||[]],s=new Ev({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return eJ({r3Injector:s.injector,platformInjector:o,rootComponent:n})}catch(n){return Promise.reject(n)}}function Ai(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function Ul(t,n){$l("NgSignals");let e=CR(t);return n?.equal&&(e[Zr].equal=n.equal),e}function ss(t){let n=St(null);try{return t()}finally{St(n)}}var TO=(()=>{class t{view;node;constructor(e,r){this.view=e,this.node=r}static __NG_ELEMENT_ID__=lJ}return t})();function lJ(){return new TO(xt(),zr())}var cJ=!1,uJ=(()=>{class t extends Sv{pendingTasks=ie(Xs);taskId=null;schedule(e){super.schedule(e),this.taskId===null&&(this.taskId=this.pendingTasks.add(),queueMicrotask(()=>this.flush()))}flush(){try{super.flush()}finally{this.taskId!==null&&(this.pendingTasks.remove(this.taskId),this.taskId=null)}}static \u0275prov=be({token:t,providedIn:"root",factory:()=>new t})}return t})(),aS=class{scheduler;effectFn;zone;injector;unregisterOnDestroy;watcher;constructor(n,e,r,o,i,s){this.scheduler=n,this.effectFn=e,this.zone=r,this.injector=i,this.watcher=DR(a=>this.runEffect(a),()=>this.schedule(),s),this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}runEffect(n){try{this.effectFn(n)}catch(e){this.injector.get(Eo,null,{optional:!0})?.handleError(e)}}run(){this.watcher.run()}schedule(){this.scheduler.schedule(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function dJ(){}function pJ(t,n){$l("NgSignals"),!n?.injector&&uM(dJ);let e=n?.injector??ie(kn),r=n?.manualCleanup!==!0?e.get(jp):null,o=new aS(e.get(uJ),t,typeof Zone>"u"?null:Zone.current,r,e,n?.allowSignalWrites??!1),i=e.get(It,null,{optional:!0});return!i||!(i._lView[Ye]&8)?o.watcher.notify():(i._lView[Z0]??=[]).push(o.watcher.notify),o}var fJ=cJ;var lS=class{[Zr];constructor(n){this[Zr]=n}destroy(){this[Zr].destroy()}};function qp(t,n){if(fJ)return pJ(t,n);$l("NgSignals"),!n?.injector&&uM(qp);let e=n?.injector??ie(kn),r=n?.manualCleanup!==!0?e.get(jp):null,o,i=e.get(TO,null,{optional:!0}),s=e.get(Mu);return i!==null&&!n?.forceRoot?(o=gJ(i.view,s,t),r instanceof yv&&r._lView===i.view&&(r=null)):o=yJ(t,e.get(dO),s),o.injector=e,r!==null&&(o.onDestroyFn=r.onDestroy(()=>o.destroy())),new lS(o)}var DO=qe(fe({},xu),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:Mh,run(){if(this.dirty=!1,this.hasRun&&!vh(this))return;this.hasRun=!0;let t=r=>(this.cleanupFns??=[]).push(r),n=hp(this),e=uv(!1);try{this.maybeCleanup(),this.fn(t)}finally{uv(e),yh(this,n)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),mJ=qe(fe({},DO),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(13)},destroy(){gp(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),hJ=qe(fe({},DO),{consumerMarkedDirty(){this.view[Ye]|=8192,Bh(this.view),this.notifier.notify(14)},destroy(){gp(this),this.onDestroyFn(),this.maybeCleanup(),this.view[Du]?.delete(this)}});function gJ(t,n,e){let r=Object.create(hJ);return r.view=t,r.zone=typeof Zone<"u"?Zone.current:null,r.notifier=n,r.fn=e,t[Du]??=new Set,t[Du].add(r),r.consumerMarkedDirty(r),r}function yJ(t,n,e){let r=Object.create(mJ);return r.fn=t,r.scheduler=n,r.notifier=e,r.zone=typeof Zone<"u"?Zone.current:null,r.scheduler.schedule(r),r.notifier.notify(13),r}var OO=null;function ea(){return OO}function PO(t){OO??=t}var ux=class{};var Mn=new ke(""),LO=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>ie(vJ),providedIn:"platform"})}return t})();var vJ=(()=>{class t extends LO{_location;_history;_doc=ie(Mn);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return ea().getBaseHref(this._doc)}onPopState(e){let r=ea().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=ea().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function $O(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function NO(t){let n=t.match(/#|\?|$/),e=n&&n.index||t.length,r=e-(t[e-1]==="/"?1:0);return t.slice(0,r)+t.slice(e)}function ju(t){return t&&t[0]!=="?"?"?"+t:t}var Xp=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>ie(VO),providedIn:"root"})}return t})(),xJ=new ke(""),VO=(()=>{class t extends Xp{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??ie(Mn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return $O(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+ju(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+ju(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+ju(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||t)(Me(LO),Me(xJ,8))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Wh=(()=>{class t{_subject=new vn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=CJ(NO(kO(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+ju(r))}normalize(e){return t.stripTrailingSlash(wJ(this._basePath,kO(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ju(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+ju(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=ju;static joinWithSlash=$O;static stripTrailingSlash=NO;static \u0275fac=function(r){return new(r||t)(Me(Xp))};static \u0275prov=be({token:t,factory:()=>bJ(),providedIn:"root"})}return t})();function bJ(){return new Wh(Me(Xp))}function wJ(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function kO(t){return t.replace(/\/index.html$/,"")}function CJ(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}var Ur=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Ur||{}),Jt=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Jt||{}),To=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(To||{}),jl={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function _J(t){return Ko(t)[Tn.LocaleId]}function IJ(t,n,e){let r=Ko(t),o=[r[Tn.DayPeriodsFormat],r[Tn.DayPeriodsStandalone]],i=Xo(o,n);return Xo(i,e)}function EJ(t,n,e){let r=Ko(t),o=[r[Tn.DaysFormat],r[Tn.DaysStandalone]],i=Xo(o,n);return Xo(i,e)}function SJ(t,n,e){let r=Ko(t),o=[r[Tn.MonthsFormat],r[Tn.MonthsStandalone]],i=Xo(o,n);return Xo(i,e)}function TJ(t,n){let r=Ko(t)[Tn.Eras];return Xo(r,n)}function nx(t,n){let e=Ko(t);return Xo(e[Tn.DateFormat],n)}function rx(t,n){let e=Ko(t);return Xo(e[Tn.TimeFormat],n)}function ox(t,n){let r=Ko(t)[Tn.DateTimeFormat];return Xo(r,n)}function fx(t,n){let e=Ko(t),r=e[Tn.NumberSymbols][n];if(typeof r>"u"){if(n===jl.CurrencyDecimal)return e[Tn.NumberSymbols][jl.Decimal];if(n===jl.CurrencyGroup)return e[Tn.NumberSymbols][jl.Group]}return r}function BO(t){if(!t[Tn.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[Tn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function DJ(t){let n=Ko(t);return BO(n),(n[Tn.ExtraData][2]||[]).map(r=>typeof r=="string"?JS(r):[JS(r[0]),JS(r[1])])}function NJ(t,n,e){let r=Ko(t);BO(r);let o=[r[Tn.ExtraData][0],r[Tn.ExtraData][1]],i=Xo(o,n)||[];return Xo(i,e)||[]}function Xo(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function JS(t){let[n,e]=t.split(":");return{hours:+n,minutes:+e}}var kJ=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,ix={},AJ=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function RJ(t,n,e,r){let o=zJ(t);n=Js(e,n)||n;let s=[],a;for(;n;)if(a=AJ.exec(n),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;n=u}else{s.push(n);break}let l=o.getTimezoneOffset();r&&(l=UO(r,l),o=BJ(o,r,!0));let c="";return s.forEach(u=>{let d=$J(u);c+=d?d(o,e,l):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function dx(t,n,e){let r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function Js(t,n){let e=_J(t);if(ix[e]??={},ix[e][n])return ix[e][n];let r="";switch(n){case"shortDate":r=nx(t,To.Short);break;case"mediumDate":r=nx(t,To.Medium);break;case"longDate":r=nx(t,To.Long);break;case"fullDate":r=nx(t,To.Full);break;case"shortTime":r=rx(t,To.Short);break;case"mediumTime":r=rx(t,To.Medium);break;case"longTime":r=rx(t,To.Long);break;case"fullTime":r=rx(t,To.Full);break;case"short":let o=Js(t,"shortTime"),i=Js(t,"shortDate");r=sx(ox(t,To.Short),[o,i]);break;case"medium":let s=Js(t,"mediumTime"),a=Js(t,"mediumDate");r=sx(ox(t,To.Medium),[s,a]);break;case"long":let l=Js(t,"longTime"),c=Js(t,"longDate");r=sx(ox(t,To.Long),[l,c]);break;case"full":let u=Js(t,"fullTime"),d=Js(t,"fullDate");r=sx(ox(t,To.Full),[u,d]);break}return r&&(ix[e][n]=r),r}function sx(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return n!=null&&r in n?n[r]:e})),t}function Ri(t,n,e="-",r,o){let i="";(t<0||o&&t<=0)&&(o?t=-t+1:(t=-t,i=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),i+s}function MJ(t,n){return Ri(t,3).substring(0,n)}function Rn(t,n,e=0,r=!1,o=!1){return function(i,s){let a=FJ(t,i);if((e>0||a>-e)&&(a+=e),t===3)a===0&&e===-12&&(a=12);else if(t===6)return MJ(a,n);let l=fx(s,jl.MinusSign);return Ri(a,n,l,r,o)}}function FJ(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}function an(t,n,e=Ur.Format,r=!1){return function(o,i){return OJ(o,i,t,n,e,r)}}function OJ(t,n,e,r,o,i){switch(e){case 2:return SJ(n,o,r)[t.getMonth()];case 1:return EJ(n,o,r)[t.getDay()];case 0:let s=t.getHours(),a=t.getMinutes();if(i){let c=DJ(n),u=NJ(n,o,r),d=c.findIndex(p=>{if(Array.isArray(p)){let[f,m]=p,h=s>=f.hours&&a>=f.minutes,g=s<m.hours||s===m.hours&&a<m.minutes;if(f.hours<m.hours){if(h&&g)return!0}else if(h||g)return!0}else if(p.hours===s&&p.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return IJ(n,o,r)[s<12?0:1];case 3:return TJ(n,r)[t.getFullYear()<=0?0:1];default:let l=e;throw new Error(`unexpected translation type ${l}`)}}function ax(t){return function(n,e,r){let o=-1*r,i=fx(e,jl.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case 0:return(o>=0?"+":"")+Ri(s,2,i)+Ri(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+Ri(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+Ri(s,2,i)+":"+Ri(Math.abs(o%60),2,i);case 3:return r===0?"Z":(o>=0?"+":"")+Ri(s,2,i)+":"+Ri(Math.abs(o%60),2,i);default:throw new Error(`Unknown zone width "${t}"`)}}}var PJ=0,cx=4;function LJ(t){let n=dx(t,PJ,1).getDay();return dx(t,0,1+(n<=cx?cx:cx+7)-n)}function zO(t){let n=t.getDay(),e=n===0?-3:cx-n;return dx(t.getFullYear(),t.getMonth(),t.getDate()+e)}function e1(t,n=!1){return function(e,r){let o;if(n){let i=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+i)/7)}else{let i=zO(e),s=LJ(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return Ri(o,t,fx(r,jl.MinusSign))}}function lx(t,n=!1){return function(e,r){let i=zO(e).getFullYear();return Ri(i,t,fx(r,jl.MinusSign),n)}}var t1={};function $J(t){if(t1[t])return t1[t];let n;switch(t){case"G":case"GG":case"GGG":n=an(3,Jt.Abbreviated);break;case"GGGG":n=an(3,Jt.Wide);break;case"GGGGG":n=an(3,Jt.Narrow);break;case"y":n=Rn(0,1,0,!1,!0);break;case"yy":n=Rn(0,2,0,!0,!0);break;case"yyy":n=Rn(0,3,0,!1,!0);break;case"yyyy":n=Rn(0,4,0,!1,!0);break;case"Y":n=lx(1);break;case"YY":n=lx(2,!0);break;case"YYY":n=lx(3);break;case"YYYY":n=lx(4);break;case"M":case"L":n=Rn(1,1,1);break;case"MM":case"LL":n=Rn(1,2,1);break;case"MMM":n=an(2,Jt.Abbreviated);break;case"MMMM":n=an(2,Jt.Wide);break;case"MMMMM":n=an(2,Jt.Narrow);break;case"LLL":n=an(2,Jt.Abbreviated,Ur.Standalone);break;case"LLLL":n=an(2,Jt.Wide,Ur.Standalone);break;case"LLLLL":n=an(2,Jt.Narrow,Ur.Standalone);break;case"w":n=e1(1);break;case"ww":n=e1(2);break;case"W":n=e1(1,!0);break;case"d":n=Rn(2,1);break;case"dd":n=Rn(2,2);break;case"c":case"cc":n=Rn(7,1);break;case"ccc":n=an(1,Jt.Abbreviated,Ur.Standalone);break;case"cccc":n=an(1,Jt.Wide,Ur.Standalone);break;case"ccccc":n=an(1,Jt.Narrow,Ur.Standalone);break;case"cccccc":n=an(1,Jt.Short,Ur.Standalone);break;case"E":case"EE":case"EEE":n=an(1,Jt.Abbreviated);break;case"EEEE":n=an(1,Jt.Wide);break;case"EEEEE":n=an(1,Jt.Narrow);break;case"EEEEEE":n=an(1,Jt.Short);break;case"a":case"aa":case"aaa":n=an(0,Jt.Abbreviated);break;case"aaaa":n=an(0,Jt.Wide);break;case"aaaaa":n=an(0,Jt.Narrow);break;case"b":case"bb":case"bbb":n=an(0,Jt.Abbreviated,Ur.Standalone,!0);break;case"bbbb":n=an(0,Jt.Wide,Ur.Standalone,!0);break;case"bbbbb":n=an(0,Jt.Narrow,Ur.Standalone,!0);break;case"B":case"BB":case"BBB":n=an(0,Jt.Abbreviated,Ur.Format,!0);break;case"BBBB":n=an(0,Jt.Wide,Ur.Format,!0);break;case"BBBBB":n=an(0,Jt.Narrow,Ur.Format,!0);break;case"h":n=Rn(3,1,-12);break;case"hh":n=Rn(3,2,-12);break;case"H":n=Rn(3,1);break;case"HH":n=Rn(3,2);break;case"m":n=Rn(4,1);break;case"mm":n=Rn(4,2);break;case"s":n=Rn(5,1);break;case"ss":n=Rn(5,2);break;case"S":n=Rn(6,1);break;case"SS":n=Rn(6,2);break;case"SSS":n=Rn(6,3);break;case"Z":case"ZZ":case"ZZZ":n=ax(0);break;case"ZZZZZ":n=ax(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=ax(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=ax(2);break;default:return null}return t1[t]=n,n}function UO(t,n){t=t.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function VJ(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function BJ(t,n,e){let r=e?-1:1,o=t.getTimezoneOffset(),i=UO(n,o);return VJ(t,r*(i-o))}function zJ(t){if(AO(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[o,i=1,s=1]=t.split("-").map(a=>+a);return dx(o,i-1,s)}let e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(kJ))return UJ(r)}let n=new Date(t);if(!AO(n))throw new Error(`Unable to convert "${t}" into a date`);return n}function UJ(t){let n=new Date(0),e=0,r=0,o=t[8]?n.setUTCFullYear:n.setFullYear,i=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),o.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,l=Number(t[6]||0),c=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return i.call(n,s,a,l,c),n}function AO(t){return t instanceof Date&&!isNaN(t.valueOf())}function mx(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var n1=/\s+/,RO=[],Yo=(()=>{class t{_ngEl;_renderer;initialClasses=RO;rawClass;stateMap=new Map;constructor(e,r){this._ngEl=e,this._renderer=r}set klass(e){this.initialClasses=e!=null?e.trim().split(n1):RO}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(n1):e}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let r of e)this._updateState(r,!0);else if(e!=null)for(let r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){let o=this.stateMap.get(e);o!==void 0?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){e=e.trim(),e.length>0&&e.split(n1).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(r){return new(r||t)(ne(Er),ne(Di))};static \u0275dir=Dt({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var r1=class{$implicit;ngForOf;index;count;constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Jn=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new r1(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),MO(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);MO(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(ne(Wp),ne(Qv),ne(QS))};static \u0275dir=Dt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function MO(t,n){t.context.$implicit=n.item}var Ht=(()=>{class t{_viewContainer;_context=new o1;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){FO("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){FO("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(ne(Wp),ne(Qv))};static \u0275dir=Dt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),o1=class{$implicit=null;ngIf=null};function FO(t,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${Vr(n)}'.`)}function jJ(t,n){return new Ie(2100,!1)}var GJ="mediumDate",WJ=new ke(""),HJ=new ke(""),as=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,r,o){this.locale=e,this.defaultTimezone=r,this.defaultOptions=o}transform(e,r,o,i){if(e==null||e===""||e!==e)return null;try{let s=r??this.defaultOptions?.dateFormat??GJ,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return RJ(e,s,i||this.locale,a)}catch(s){throw jJ(t,s.message)}}static \u0275fac=function(r){return new(r||t)(ne(Gh,16),ne(WJ,24),ne(HJ,24))};static \u0275pipe=eO({name:"date",type:t,pure:!0})}return t})();var Pt=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({})}return t})(),i1="browser",qJ="server";function cn(t){return t===i1}function s1(t){return t===qJ}var Kp=class{};var Kh=class{},Xh=class{},ta=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=e.slice(r+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.addHeaderEntry(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new t;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,e);let o=(n.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=n.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(n,e){let r=n.toLowerCase();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(e):this.headers.set(r,[e])}setHeaderEntries(n,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var c1=class{encodeKey(n){return jO(n)}encodeValue(n){return jO(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function KJ(t,n){let e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],l=e.get(s)||[];l.push(a),e.set(s,l)}),e}var XJ=/%(\d[a-f0-9])/gi,YJ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function jO(t){return encodeURIComponent(t).replace(XJ,(n,e)=>YJ[e]??n)}function hx(t){return`${t}`}var Wl=class t{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new c1,n.fromString){if(n.fromObject)throw new Ie(2805,!1);this.map=KJ(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let r=n.fromObject[e],o=Array.isArray(r)?r.map(hx):[hx(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(r=>{let o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new t({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push(hx(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let r=this.map.get(n.param)||[],o=r.indexOf(hx(n.value));o!==-1&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var u1=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function ZJ(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function GO(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function WO(t){return typeof Blob<"u"&&t instanceof Blob}function HO(t){return typeof FormData<"u"&&t instanceof FormData}function QJ(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var Hh="Content-Type",gx="Accept",f1="X-Request-URL",YO="text/plain",ZO="application/json",QO=`${ZO}, ${YO}, */*`,qh=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(n,e,r,o){this.url=e,this.method=n.toUpperCase();let i;if(ZJ(this.method)||o?(this.body=r!==void 0?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new ta,this.context??=new u1,!this.params)this.params=new Wl,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),l=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||GO(this.body)||WO(this.body)||HO(this.body)||QJ(this.body)?this.body:this.body instanceof Wl?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||HO(this.body)?null:WO(this.body)?this.body.type||null:GO(this.body)?null:typeof this.body=="string"?YO:this.body instanceof Wl?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?ZO:null}clone(n={}){let e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=n.transferCache??this.transferCache,s=n.body!==void 0?n.body:this.body,a=n.withCredentials??this.withCredentials,l=n.reportProgress??this.reportProgress,c=n.headers||this.headers,u=n.params||this.params,d=n.context??this.context;return n.setHeaders!==void 0&&(c=Object.keys(n.setHeaders).reduce((p,f)=>p.set(f,n.setHeaders[f]),c)),n.setParams&&(u=Object.keys(n.setParams).reduce((p,f)=>p.set(f,n.setParams[f]),u)),new t(e,r,s,{params:u,headers:c,context:d,reportProgress:l,responseType:o,withCredentials:a,transferCache:i})}},Hl=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Hl||{}),Yh=class{headers;status;statusText;url;ok;type;constructor(n,e=200,r="OK"){this.headers=n.headers||new ta,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},yx=class t extends Yh{constructor(n={}){super(n)}type=Hl.ResponseHeader;clone(n={}){return new t({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Zh=class t extends Yh{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=Hl.Response;clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Gl=class extends Yh{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},JO=200,JJ=204;function a1(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}var m1=(()=>{class t{handler;constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof qh)i=e;else{let l;o.headers instanceof ta?l=o.headers:l=new ta(o.headers);let c;o.params&&(o.params instanceof Wl?c=o.params:c=new Wl({fromObject:o.params})),i=new qh(e,r,o.body!==void 0?o.body:null,{headers:l,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let s=Ue(i).pipe(Al(l=>this.handler.handle(l)));if(e instanceof qh||o.observe==="events")return s;let a=s.pipe(Lr(l=>l instanceof Zh));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(Ge(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new Ie(2806,!1);return l.body}));case"blob":return a.pipe(Ge(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new Ie(2807,!1);return l.body}));case"text":return a.pipe(Ge(l=>{if(l.body!==null&&typeof l.body!="string")throw new Ie(2808,!1);return l.body}));case"json":default:return a.pipe(Ge(l=>l.body))}case"response":return a;default:throw new Ie(2809,!1)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:new Wl().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,a1(o,r))}post(e,r,o={}){return this.request("POST",e,a1(o,r))}put(e,r,o={}){return this.request("PUT",e,a1(o,r))}static \u0275fac=function(r){return new(r||t)(Me(Kh))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),eee=/^\)\]\}',?\n/;function qO(t){if(t.url)return t.url;let n=f1.toLocaleLowerCase();return t.headers.get(n)}var eP=new ke(""),l1=(()=>{class t{fetchImpl=ie(d1,{optional:!0})?.fetch??((...e)=>globalThis.fetch(...e));ngZone=ie(sn);handle(e){return new vt(r=>{let o=new AbortController;return this.doRequest(e,o.signal,r).then(p1,i=>r.error(new Gl({error:i}))),()=>o.abort()})}async doRequest(e,r,o){let i=this.createRequestInit(e),s;try{let f=this.ngZone.runOutsideAngular(()=>this.fetchImpl(e.urlWithParams,fe({signal:r},i)));tee(f),o.next({type:Hl.Sent}),s=await f}catch(f){o.error(new Gl({error:f,status:f.status??0,statusText:f.statusText,url:e.urlWithParams,headers:f.headers}));return}let a=new ta(s.headers),l=s.statusText,c=qO(s)??e.urlWithParams,u=s.status,d=null;if(e.reportProgress&&o.next(new yx({headers:a,status:u,statusText:l,url:c})),s.body){let f=s.headers.get("content-length"),m=[],h=s.body.getReader(),g=0,x,b,I=typeof Zone<"u"&&Zone.current;await this.ngZone.runOutsideAngular(async()=>{for(;;){let{done:E,value:S}=await h.read();if(E)break;if(m.push(S),g+=S.length,e.reportProgress){b=e.responseType==="text"?(b??"")+(x??=new TextDecoder).decode(S,{stream:!0}):void 0;let D=()=>o.next({type:Hl.DownloadProgress,total:f?+f:void 0,loaded:g,partialText:b});I?I.run(D):D()}}});let _=this.concatChunks(m,g);try{let E=s.headers.get(Hh)??"";d=this.parseBody(e,_,E)}catch(E){o.error(new Gl({error:E,headers:new ta(s.headers),status:s.status,statusText:s.statusText,url:qO(s)??e.urlWithParams}));return}}u===0&&(u=d?JO:0),u>=200&&u<300?(o.next(new Zh({body:d,headers:a,status:u,statusText:l,url:c})),o.complete()):o.error(new Gl({error:d,headers:a,status:u,statusText:l,url:c}))}parseBody(e,r,o){switch(e.responseType){case"json":let i=new TextDecoder().decode(r).replace(eee,"");return i===""?null:JSON.parse(i);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:o});case"arraybuffer":return r.buffer}}createRequestInit(e){let r={},o=e.withCredentials?"include":void 0;if(e.headers.forEach((i,s)=>r[i]=s.join(",")),e.headers.has(gx)||(r[gx]=QO),!e.headers.has(Hh)){let i=e.detectContentTypeHeader();i!==null&&(r[Hh]=i)}return{body:e.serializeBody(),method:e.method,headers:r,credentials:o}}concatChunks(e,r){let o=new Uint8Array(r),i=0;for(let s of e)o.set(s,i),i+=s.length;return o}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),d1=class{};function p1(){}function tee(t){t.then(p1,p1)}function nee(t,n){return n(t)}function ree(t,n,e){return(r,o)=>dr(e,()=>n(r,i=>t(i,o)))}var tP=new ke(""),oee=new ke(""),iee=new ke("",{providedIn:"root",factory:()=>!0});var KO=(()=>{class t extends Kh{backend;injector;chain=null;pendingTasks=ie(Xs);contributeToStability=ie(iee);constructor(e,r){super(),this.backend=e,this.injector=r}handle(e){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(tP),...this.injector.get(oee,[])]));this.chain=r.reduceRight((o,i)=>ree(o,i,this.injector),nee)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(Ps(()=>this.pendingTasks.remove(r)))}else return this.chain(e,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||t)(Me(Xh),Me(no))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})();var see=/^\)\]\}',?\n/,aee=RegExp(`^${f1}:`,"m");function lee(t){return"responseURL"in t&&t.responseURL?t.responseURL:aee.test(t.getAllResponseHeaders())?t.getResponseHeader(f1):null}var XO=(()=>{class t{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new Ie(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?bn(r.\u0275loadImpl()):Ue(null)).pipe(_o(()=>new vt(i=>{let s=r.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((h,g)=>s.setRequestHeader(h,g.join(","))),e.headers.has(gx)||s.setRequestHeader(gx,QO),!e.headers.has(Hh)){let h=e.detectContentTypeHeader();h!==null&&s.setRequestHeader(Hh,h)}if(e.responseType){let h=e.responseType.toLowerCase();s.responseType=h!=="json"?h:"text"}let a=e.serializeBody(),l=null,c=()=>{if(l!==null)return l;let h=s.statusText||"OK",g=new ta(s.getAllResponseHeaders()),x=lee(s)||e.url;return l=new yx({headers:g,status:s.status,statusText:h,url:x}),l},u=()=>{let{headers:h,status:g,statusText:x,url:b}=c(),I=null;g!==JJ&&(I=typeof s.response>"u"?s.responseText:s.response),g===0&&(g=I?JO:0);let _=g>=200&&g<300;if(e.responseType==="json"&&typeof I=="string"){let E=I;I=I.replace(see,"");try{I=I!==""?JSON.parse(I):null}catch(S){I=E,_&&(_=!1,I={error:S,text:I})}}_?(i.next(new Zh({body:I,headers:h,status:g,statusText:x,url:b||void 0})),i.complete()):i.error(new Gl({error:I,headers:h,status:g,statusText:x,url:b||void 0}))},d=h=>{let{url:g}=c(),x=new Gl({error:h,status:s.status||0,statusText:s.statusText||"Unknown Error",url:g||void 0});i.error(x)},p=!1,f=h=>{p||(i.next(c()),p=!0);let g={type:Hl.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),e.responseType==="text"&&s.responseText&&(g.partialText=s.responseText),i.next(g)},m=h=>{let g={type:Hl.UploadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),i.next(g)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),e.reportProgress&&(s.addEventListener("progress",f),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:Hl.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),e.reportProgress&&(s.removeEventListener("progress",f),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(r){return new(r||t)(Me(Kp))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),nP=new ke(""),cee="XSRF-TOKEN",uee=new ke("",{providedIn:"root",factory:()=>cee}),dee="X-XSRF-TOKEN",pee=new ke("",{providedIn:"root",factory:()=>dee}),vx=class{},fee=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o}getToken(){if(this.platform==="server")return null;let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=mx(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(r){return new(r||t)(Me(Mn),Me(so),Me(uee))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})();function mee(t,n){let e=t.url.toLowerCase();if(!ie(nP)||t.method==="GET"||t.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return n(t);let r=ie(vx).getToken(),o=ie(pee);return r!=null&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var rP=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(rP||{});function hee(t,n){return{\u0275kind:t,\u0275providers:n}}function oP(...t){let n=[m1,XO,KO,{provide:Kh,useExisting:KO},{provide:Xh,useFactory:()=>ie(eP,{optional:!0})??ie(XO)},{provide:tP,useValue:mee,multi:!0},{provide:nP,useValue:!0},{provide:vx,useClass:fee}];for(let e of t)n.push(...e.\u0275providers);return zp(n)}function iP(){return hee(rP.Fetch,[l1,{provide:eP,useExisting:l1},{provide:Xh,useExisting:l1}])}var g1=class extends ux{supportsDOMEvents=!0},y1=class t extends g1{static makeCurrent(){PO(new t)}onAndCancel(n,e,r,o){return n.addEventListener(e,r,o),()=>{n.removeEventListener(e,r,o)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=yee();return e==null?null:vee(e)}resetBaseElement(){Qh=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return mx(document.cookie,n)}},Qh=null;function yee(){return Qh=Qh||document.querySelector("base"),Qh?Qh.getAttribute("href"):null}function vee(t){return new URL(t,document.baseURI).pathname}var xee=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),v1=new ke(""),dP=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new Ie(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||t)(Me(v1),Me(sn))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),bx=class{_doc;constructor(n){this._doc=n}manager},xx="ng-app-id";function sP(t){for(let n of t)n.remove()}function aP(t,n){let e=n.createElement("style");return e.textContent=t,e}function bee(t,n,e,r){let o=t.head?.querySelectorAll(`style[${xx}="${n}"],link[${xx}="${n}"]`);if(o)for(let i of o)i.removeAttribute(xx),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function x1(t,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}var pP=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=s1(i),bee(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,aP);r?.forEach(o=>this.addUsage(o,this.external,x1))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(sP(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])sP(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,aP(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,x1(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(xx,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||t)(Me(Mn),Me(Hv),Me(zh,8),Me(so))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),h1={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},w1=/%COMP%/g;var fP="%COMP%",wee=`_nghost-${fP}`,Cee=`_ngcontent-${fP}`,_ee=!0,Iee=new ke("",{providedIn:"root",factory:()=>_ee});function Eee(t){return Cee.replace(w1,t)}function See(t){return wee.replace(w1,t)}function mP(t,n){return n.map(e=>e.replace(w1,t))}var lP=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=s1(a),this.defaultRenderer=new Jh(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===rs.ShadowDom&&(r=qe(fe({},r),{encapsulation:rs.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof wx?o.applyToHost(e):o instanceof eg&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,p=this.tracingService;switch(r.encapsulation){case rs.Emulated:i=new wx(l,c,r,this.appId,u,s,a,d,p);break;case rs.ShadowDom:return new b1(l,c,e,r,s,a,this.nonce,d,p);default:i=new eg(l,c,r,u,s,a,d,p);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||t)(Me(dP),Me(pP),Me(Hv),Me(Iee),Me(Mn),Me(so),Me(sn),Me(zh),Me(qv,8))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),Jh=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,r,o,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(h1[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(cP(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(cP(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){e.remove()}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new Ie(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=h1[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=h1[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(js.DashCase|js.Important)?n.style.setProperty(e,r,o&js.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&js.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r,o){if(typeof n=="string"&&(n=ea().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${e}`);let i=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,e,i)),this.eventManager.addEventListener(n,e,i,o)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function cP(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var b1=class extends Jh{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,l,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=mP(o.id,u);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let d=o.getExternalStyles?.();if(d)for(let p of d){let f=x1(p,i);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},eg=class extends Jh{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let u=r.styles;this.styles=c?mP(c,u):u,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},wx=class extends eg{contentAttr;hostAttr;constructor(n,e,r,o,i,s,a,l,c){let u=o+"-"+r.id;super(n,e,r,i,s,a,l,c,u),this.contentAttr=Eee(u),this.hostAttr=See(u)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}},Tee=(()=>{class t extends bx{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||t)(Me(Mn))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})(),uP=["alt","control","meta","shift"],Dee={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Nee={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},kee=(()=>{class t extends bx{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>ea().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),uP.forEach(c=>{let u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=Dee[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),uP.forEach(s=>{if(s!==o){let a=Nee[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||t)(Me(Mn))};static \u0275prov=be({token:t,factory:t.\u0275fac})}return t})();function hP(t,n){return SO(fe({rootComponent:t},Aee(n)))}function Aee(t){return{appProviders:[...Pee,...t?.providers??[]],platformProviders:Oee}}function Ree(){y1.makeCurrent()}function Mee(){return new Eo}function Fee(){return rF(document),document}var Oee=[{provide:so,useValue:i1},{provide:DS,useValue:Ree,multi:!0},{provide:Mn,useFactory:Fee,deps:[]}];var Pee=[{provide:Mv,useValue:"root"},{provide:Eo,useFactory:Mee,deps:[]},{provide:v1,useClass:Tee,multi:!0,deps:[Mn,sn,so]},{provide:v1,useClass:kee,multi:!0,deps:[Mn]},lP,pP,dP,{provide:Vp,useExisting:lP},{provide:Kp,useClass:xee,deps:[]},[]];var gP=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||t)(Me(Mn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var C1=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:function(r){let o=null;return r?o=new(r||t):o=Me(Lee),o},providedIn:"root"})}return t})(),Lee=(()=>{class t extends C1{_doc;constructor(e){super(),this._doc=e}sanitize(e,r){if(r==null)return null;switch(e){case Sr.NONE:return r;case Sr.HTML:return Vl(r,"HTML")?Ti(r):vF(this._doc,String(r)).toString();case Sr.STYLE:return Vl(r,"Style")?Ti(r):r;case Sr.SCRIPT:if(Vl(r,"Script"))return Ti(r);throw new Ie(5200,!1);case Sr.URL:return Vl(r,"URL")?Ti(r):Xv(String(r));case Sr.RESOURCE_URL:if(Vl(r,"ResourceURL"))return Ti(r);throw new Ie(5201,!1);default:throw new Ie(5202,!1)}}bypassSecurityTrustHtml(e){return lF(e)}bypassSecurityTrustStyle(e){return cF(e)}bypassSecurityTrustScript(e){return uF(e)}bypassSecurityTrustUrl(e){return dF(e)}bypassSecurityTrustResourceUrl(e){return pF(e)}static \u0275fac=function(r){return new(r||t)(Me(Mn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var it="primary",hg=Symbol("RouteTitle"),T1=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function tf(t){return new T1(t)}function zee(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=t[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function Uee(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!ls(t[e],n[e]))return!1;return!0}function ls(t,n){let e=t?D1(t):void 0,r=n?D1(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!EP(t[o],n[o]))return!1;return!0}function D1(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function EP(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function SP(t){return t.length>0?t[t.length-1]:null}function Kl(t){return HI(t)?t:Bu(t)?bn(Promise.resolve(t)):Ue(t)}var jee={exact:DP,subset:NP},TP={exact:Gee,subset:Wee,ignored:()=>!0};function vP(t,n,e){return jee[e.paths](t.root,n.root,e.matrixParams)&&TP[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function Gee(t,n){return ls(t,n)}function DP(t,n,e){if(!Wu(t.segments,n.segments)||!Ix(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!DP(t.children[r],n.children[r],e))return!1;return!0}function Wee(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>EP(t[e],n[e]))}function NP(t,n,e){return kP(t,n,n.segments,e)}function kP(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!Wu(o,e)||n.hasChildren()||!Ix(o,e,r))}else if(t.segments.length===e.length){if(!Wu(t.segments,e)||!Ix(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!NP(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!Wu(t.segments,o)||!Ix(t.segments,o,r)||!t.children[it]?!1:kP(t.children[it],n,i,r)}}function Ix(t,n,e){return n.every((r,o)=>TP[e](t[o].parameters,r.parameters))}var ra=class{root;queryParams;fragment;_queryParamMap;constructor(n=new Ut([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=tf(this.queryParams),this._queryParamMap}toString(){return Kee.serialize(this)}},Ut=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Ex(this)}},Gu=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=tf(this.parameters),this._parameterMap}toString(){return RP(this)}};function Hee(t,n){return Wu(t,n)&&t.every((e,r)=>ls(e.parameters,n[r].parameters))}function Wu(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function qee(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===it&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==it&&(e=e.concat(n(o,r)))}),e}var eT=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>new sg,providedIn:"root"})}return t})(),sg=class{parse(n){let e=new k1(n);return new ra(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${tg(n.root,!0)}`,r=Zee(n.queryParams),o=typeof n.fragment=="string"?`#${Xee(n.fragment)}`:"";return`${e}${r}${o}`}},Kee=new sg;function Ex(t){return t.segments.map(n=>RP(n)).join("/")}function tg(t,n){if(!t.hasChildren())return Ex(t);if(n){let e=t.children[it]?tg(t.children[it],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==it&&r.push(`${o}:${tg(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=qee(t,(r,o)=>o===it?[tg(t.children[it],!1)]:[`${o}:${tg(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[it]!=null?`${Ex(t)}/${e[0]}`:`${Ex(t)}/(${e.join("//")})`}}function AP(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Cx(t){return AP(t).replace(/%3B/gi,";")}function Xee(t){return encodeURI(t)}function N1(t){return AP(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Sx(t){return decodeURIComponent(t)}function xP(t){return Sx(t.replace(/\+/g,"%20"))}function RP(t){return`${N1(t.path)}${Yee(t.parameters)}`}function Yee(t){return Object.entries(t).map(([n,e])=>`;${N1(n)}=${N1(e)}`).join("")}function Zee(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${Cx(e)}=${Cx(o)}`).join("&"):`${Cx(e)}=${Cx(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var Qee=/^[^\/()?;#]+/;function _1(t){let n=t.match(Qee);return n?n[0]:""}var Jee=/^[^\/()?;=#]+/;function ete(t){let n=t.match(Jee);return n?n[0]:""}var tte=/^[^=?&#]+/;function nte(t){let n=t.match(tte);return n?n[0]:""}var rte=/^[^&#]+/;function ote(t){let n=t.match(rte);return n?n[0]:""}var k1=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Ut([],{}):new Ut([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[it]=new Ut(n,e)),r}parseSegment(){let n=_1(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new Ie(4009,!1);return this.capture(n),new Gu(Sx(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=ete(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=_1(this.remaining);o&&(r=o,this.capture(r))}n[Sx(e)]=Sx(r)}parseQueryParam(n){let e=nte(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=ote(this.remaining);s&&(r=s,this.capture(r))}let o=xP(e),i=xP(r);if(n.hasOwnProperty(o)){let s=n[o];Array.isArray(s)||(s=[s],n[o]=s),s.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=_1(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new Ie(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=it);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[it]:new Ut([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new Ie(4011,!1)}};function MP(t){return t.segments.length>0?new Ut([],{[it]:t}):t}function FP(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=FP(o);if(r===it&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))n[s]=a;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new Ut(t.segments,n);return ite(e)}function ite(t){if(t.numberOfChildren===1&&t.children[it]){let n=t.children[it];return new Ut(t.segments.concat(n.segments),n.children)}return t}function Hu(t){return t instanceof ra}function ste(t,n,e=null,r=null){let o=OP(t);return PP(o,n,e,r)}function OP(t){let n;function e(i){let s={};for(let l of i.children){let c=e(l);s[l.outlet]=c}let a=new Ut(i.url,s);return i===t&&(n=a),a}let r=e(t.root),o=MP(r);return n??o}function PP(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return I1(o,o,o,e,r);let i=ate(n);if(i.toRoot())return I1(o,o,new Ut([],{}),e,r);let s=lte(i,o,t),a=s.processChildren?rg(s.segmentGroup,s.index,i.commands):$P(s.segmentGroup,s.index,i.commands);return I1(o,s.segmentGroup,a,e,r)}function Tx(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function ag(t){return typeof t=="object"&&t!=null&&t.outlets}function I1(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([l,c])=>{i[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;t===n?s=e:s=LP(t,n,e);let a=MP(FP(s));return new ra(a,i,o)}function LP(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=LP(i,n,e)}),new Ut(t.segments,r)}var Dx=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Tx(r[0]))throw new Ie(4003,!1);let o=r.find(ag);if(o&&o!==SP(r))throw new Ie(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ate(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new Dx(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?n++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new Dx(e,n,r)}var Qp=class{segmentGroup;processChildren;index;constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function lte(t,n,e){if(t.isAbsolute)return new Qp(n,!0,0);if(!e)return new Qp(n,!1,NaN);if(e.parent===null)return new Qp(e,!0,0);let r=Tx(t.commands[0])?0:1,o=e.segments.length-1+r;return cte(e,o,t.numberOfDoubleDots)}function cte(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new Ie(4005,!1);o=r.segments.length}return new Qp(r,!1,o-i)}function ute(t){return ag(t[0])?t[0].outlets:{[it]:t}}function $P(t,n,e){if(t??=new Ut([],{}),t.segments.length===0&&t.hasChildren())return rg(t,n,e);let r=dte(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new Ut(t.segments.slice(0,r.pathIndex),{});return i.children[it]=new Ut(t.segments.slice(r.pathIndex),t.children),rg(i,0,o)}else return r.match&&o.length===0?new Ut(t.segments,{}):r.match&&!t.hasChildren()?A1(t,n,e):r.match?rg(t,0,o):A1(t,n,e)}function rg(t,n,e){if(e.length===0)return new Ut(t.segments,{});{let r=ute(e),o={};if(Object.keys(r).some(i=>i!==it)&&t.children[it]&&t.numberOfChildren===1&&t.children[it].segments.length===0){let i=rg(t.children[it],n,e);return new Ut(t.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=$P(t.children[i],n,s))}),Object.entries(t.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new Ut(t.segments,o)}}function dte(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let s=t.segments[o],a=e[r];if(ag(a))break;let l=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!wP(l,c,s))return i;r+=2}else{if(!wP(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function A1(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(ag(i)){let l=pte(i.outlets);return new Ut(r,l)}if(o===0&&Tx(e[0])){let l=t.segments[n];r.push(new Gu(l.path,bP(e[0]))),o++;continue}let s=ag(i)?i.outlets[it]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&Tx(a)?(r.push(new Gu(s,bP(a))),o+=2):(r.push(new Gu(s,{})),o++)}return new Ut(r,{})}function pte(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=A1(new Ut([],{}),0,r))}),n}function bP(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function wP(t,n,e){return t==e.path&&ls(n,e.parameters)}var og="imperative",gr=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(gr||{}),Zo=class{id;url;constructor(n,e){this.id=n,this.url=e}},lg=class extends Zo{type=gr.NavigationStart;navigationTrigger;restoredState;constructor(n,e,r="imperative",o=null){super(n,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},ql=class extends Zo{urlAfterRedirects;type=gr.NavigationEnd;constructor(n,e,r){super(n,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},No=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(No||{}),R1=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(R1||{}),na=class extends Zo{reason;code;type=gr.NavigationCancel;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},qu=class extends Zo{reason;code;type=gr.NavigationSkipped;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}},cg=class extends Zo{error;target;type=gr.NavigationError;constructor(n,e,r,o){super(n,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},Nx=class extends Zo{urlAfterRedirects;state;type=gr.RoutesRecognized;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},M1=class extends Zo{urlAfterRedirects;state;type=gr.GuardsCheckStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},F1=class extends Zo{urlAfterRedirects;state;shouldActivate;type=gr.GuardsCheckEnd;constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},O1=class extends Zo{urlAfterRedirects;state;type=gr.ResolveStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},P1=class extends Zo{urlAfterRedirects;state;type=gr.ResolveEnd;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},L1=class{route;type=gr.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},$1=class{route;type=gr.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},V1=class{snapshot;type=gr.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},B1=class{snapshot;type=gr.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},z1=class{snapshot;type=gr.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},U1=class{snapshot;type=gr.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var ug=class{},nf=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function fte(t,n){return t.providers&&!t._injector&&(t._injector=WS(t.providers,n,`Route: ${t.path}`)),t._injector??n}function Mi(t){return t.outlet||it}function mte(t,n){let e=t.filter(r=>Mi(r)===n);return e.push(...t.filter(r=>Mi(r)!==n)),e}function gg(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var j1=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return gg(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new Px(this.rootInjector)}},Px=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new j1(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||t)(Me(no))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),kx=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=G1(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=G1(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=W1(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return W1(n,this._root).map(e=>e.value)}};function G1(t,n){if(t===n.value)return n;for(let e of n.children){let r=G1(t,e);if(r)return r}return null}function W1(t,n){if(t===n.value)return[n];for(let e of n.children){let r=W1(t,e);if(r.length)return r.unshift(n),r}return[]}var Do=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function Zp(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var Ax=class extends kx{snapshot;constructor(n,e){super(n),this.snapshot=e,tT(this,n)}toString(){return this.snapshot.toString()}};function VP(t){let n=hte(t),e=new cr([new Gu("",{})]),r=new cr({}),o=new cr({}),i=new cr({}),s=new cr(""),a=new Fi(e,r,i,s,o,it,t,n.root);return a.snapshot=n.root,new Ax(new Do(a,[]),n)}function hte(t){let n={},e={},r={},o="",i=new Jp([],n,r,o,e,it,t,null,{});return new Mx("",new Do(i,[]))}var Fi=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,r,o,i,s,a,l){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(Ge(c=>c[hg]))??Ue(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(Ge(n=>tf(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(Ge(n=>tf(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function Rx(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:fe(fe({},n.params),t.params),data:fe(fe({},n.data),t.data),resolve:fe(fe(fe(fe({},t.data),n.data),o?.data),t._resolvedData)}:r={params:fe({},t.params),data:fe({},t.data),resolve:fe(fe({},t.data),t._resolvedData??{})},o&&zP(o)&&(r.resolve[hg]=o.title),r}var Jp=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[hg]}constructor(n,e,r,o,i,s,a,l,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=tf(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=tf(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},Mx=class extends kx{url;constructor(n,e){super(e),this.url=n,tT(this,e)}toString(){return BP(this._root)}};function tT(t,n){n.value._routerState=t,n.children.forEach(e=>tT(t,e))}function BP(t){let n=t.children.length>0?` { ${t.children.map(BP).join(", ")} } `:"";return`${t.value}${n}`}function E1(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,ls(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),ls(n.params,e.params)||t.paramsSubject.next(e.params),Uee(n.url,e.url)||t.urlSubject.next(e.url),ls(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function H1(t,n){let e=ls(t.params,n.params)&&Hee(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||H1(t.parent,n.parent))}function zP(t){return typeof t.title=="string"||t.title===null}var gte=new ke(""),nT=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=it;activateEvents=new Ot;deactivateEvents=new Ot;attachEvents=new Ot;detachEvents=new Ot;routerOutletData=XM(void 0);parentContexts=ie(Px);location=ie(Wp);changeDetector=ie(It);inputBinder=ie(rT,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Ie(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Ie(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Ie(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new Ie(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new q1(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Dt({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[Ho]})}return t})(),q1=class t{route;childContexts;parent;outletData;__ngOutletInjector(n){return new t(this.route,this.childContexts,n,this.outletData)}constructor(n,e,r,o){this.route=n,this.childContexts=e,this.parent=r,this.outletData=o}get(n,e){return n===Fi?this.route:n===Px?this.childContexts:n===gte?this.outletData:this.parent.get(n,e)}},rT=new ke("");function yte(t,n,e){let r=dg(t,n._root,e?e._root:void 0);return new Ax(r,n)}function dg(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=vte(t,n,e);return new Do(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>dg(t,a)),s}}let r=xte(n.value),o=n.children.map(i=>dg(t,i));return new Do(r,o)}}function vte(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return dg(t,r,o);return dg(t,r)})}function xte(t){return new Fi(new cr(t.url),new cr(t.params),new cr(t.queryParams),new cr(t.fragment),new cr(t.data),t.outlet,t.component,t)}var pg=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},UP="ngNavigationCancelingError";function Fx(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Hu(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=jP(!1,No.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function jP(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[UP]=!0,e.cancellationCode=n,e}function bte(t){return GP(t)&&Hu(t.url)}function GP(t){return!!t&&t[UP]}var wte=(t,n,e,r)=>Ge(o=>(new K1(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),K1=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),E1(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=Zp(e);n.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Zp(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Zp(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=Zp(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new U1(i.value.snapshot))}),n.children.length&&this.forwardEvent(new B1(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(E1(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),E1(a.route.value),this.activateChildRoutes(n,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(n,null,s.children)}else this.activateChildRoutes(n,null,r)}},Ox=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},ef=class{component;route;constructor(n,e){this.component=n,this.route=e}};function Cte(t,n,e){let r=t._root,o=n?n._root:null;return ng(r,o,e,[r.value])}function _te(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function of(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!G2(t)?t:n.get(t):r}function ng(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Zp(n);return t.children.forEach(s=>{Ite(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>ig(a,e.getContext(s),o)),o}function Ite(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=Ete(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new Ox(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?ng(t,n,a?a.children:null,r,o):ng(t,n,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new ef(a.outlet.component,s))}else s&&ig(n,a,o),o.canActivateChecks.push(new Ox(r)),i.component?ng(t,null,a?a.children:null,r,o):ng(t,null,e,r,o);return o}function Ete(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!Wu(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Wu(t.url,n.url)||!ls(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!H1(t,n)||!ls(t.queryParams,n.queryParams);case"paramsChange":default:return!H1(t,n)}}function ig(t,n,e){let r=Zp(t),o=t.value;Object.entries(r).forEach(([i,s])=>{o.component?n?ig(s,n.children.getContext(i),e):ig(s,null,e):ig(s,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new ef(n.outlet.component,o)):e.canDeactivateChecks.push(new ef(null,o)):e.canDeactivateChecks.push(new ef(null,o))}function yg(t){return typeof t=="function"}function Ste(t){return typeof t=="boolean"}function Tte(t){return t&&yg(t.canLoad)}function Dte(t){return t&&yg(t.canActivate)}function Nte(t){return t&&yg(t.canActivateChild)}function kte(t){return t&&yg(t.canDeactivate)}function Ate(t){return t&&yg(t.canMatch)}function WP(t){return t instanceof Os||t?.name==="EmptyError"}var _x=Symbol("INITIAL_VALUE");function rf(){return _o(t=>Ip(t.map(n=>n.pipe(Co(1),Ch(_x)))).pipe(Ge(n=>{for(let e of n)if(e!==!0){if(e===_x)return _x;if(e===!1||Rte(e))return e}return!0}),Lr(n=>n!==_x),Co(1)))}function Rte(t){return Hu(t)||t instanceof pg}function Mte(t,n){return jn(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?Ue(qe(fe({},e),{guardsResult:!0})):Fte(s,r,o,t).pipe(jn(a=>a&&Ste(a)?Ote(r,i,t,n):Ue(a)),Ge(a=>qe(fe({},e),{guardsResult:a})))})}function Fte(t,n,e,r){return bn(t).pipe(jn(o=>Bte(o.component,o.route,e,n,r)),Ls(o=>o!==!0,!0))}function Ote(t,n,e,r){return bn(n).pipe(Al(o=>kl(Lte(o.route.parent,r),Pte(o.route,r),Vte(t,o.path,e),$te(t,o.route,e))),Ls(o=>o!==!0,!0))}function Pte(t,n){return t!==null&&n&&n(new z1(t)),Ue(!0)}function Lte(t,n){return t!==null&&n&&n(new V1(t)),Ue(!0)}function $te(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return Ue(!0);let o=r.map(i=>U0(()=>{let s=gg(n)??e,a=of(i,s),l=Dte(a)?a.canActivate(n,t):dr(s,()=>a(n,t));return Kl(l).pipe(Ls())}));return Ue(o).pipe(rf())}function Vte(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(s=>_te(s)).filter(s=>s!==null).map(s=>U0(()=>{let a=s.guards.map(l=>{let c=gg(s.node)??e,u=of(l,c),d=Nte(u)?u.canActivateChild(r,t):dr(c,()=>u(r,t));return Kl(d).pipe(Ls())});return Ue(a).pipe(rf())}));return Ue(i).pipe(rf())}function Bte(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return Ue(!0);let s=i.map(a=>{let l=gg(n)??o,c=of(a,l),u=kte(c)?c.canDeactivate(t,n,e,r):dr(l,()=>c(t,n,e,r));return Kl(u).pipe(Ls())});return Ue(s).pipe(rf())}function zte(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return Ue(!0);let i=o.map(s=>{let a=of(s,t),l=Tte(a)?a.canLoad(n,e):dr(t,()=>a(n,e));return Kl(l)});return Ue(i).pipe(rf(),HP(r))}function HP(t){return zI(In(n=>{if(typeof n!="boolean")throw Fx(t,n)}),Ge(n=>n===!0))}function Ute(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return Ue(!0);let i=o.map(s=>{let a=of(s,t),l=Ate(a)?a.canMatch(n,e):dr(t,()=>a(n,e));return Kl(l)});return Ue(i).pipe(rf(),HP(r))}var fg=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},mg=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function Yp(t){return Nl(new fg(t))}function jte(t){return Nl(new Ie(4e3,!1))}function Gte(t){return Nl(jP(!1,No.GuardRejected))}var X1=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return Ue(r);if(o.numberOfChildren>1||!o.children[it])return jte(`${n.redirectTo}`);o=o.children[it]}}applyRedirectCommands(n,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,params:f,data:m,title:h}=o,g=dr(i,()=>a({params:f,data:m,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,title:h}));if(g instanceof ra)throw new mg(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e[0]==="/")throw new mg(s);return s}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new ra(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(n,l,r,o)}),new Ut(i,s)}createSegments(n,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new Ie(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},Y1={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Wte(t,n,e,r,o){let i=qP(t,n,e);return i.matched?(r=fte(n,r),Ute(r,n,e,o).pipe(Ge(s=>s===!0?i:fe({},Y1)))):Ue(i)}function qP(t,n,e){if(n.path==="**")return Hte(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?fe({},Y1):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||zee)(e,t,n);if(!o)return fe({},Y1);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?fe(fe({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function Hte(t){return{matched:!0,parameters:t.length>0?SP(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function CP(t,n,e,r){return e.length>0&&Xte(t,e,r)?{segmentGroup:new Ut(n,Kte(r,new Ut(e,t.children))),slicedSegments:[]}:e.length===0&&Yte(t,e,r)?{segmentGroup:new Ut(t.segments,qte(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new Ut(t.segments,t.children),slicedSegments:e}}function qte(t,n,e,r){let o={};for(let i of e)if(Lx(t,n,i)&&!r[Mi(i)]){let s=new Ut([],{});o[Mi(i)]=s}return fe(fe({},r),o)}function Kte(t,n){let e={};e[it]=n;for(let r of t)if(r.path===""&&Mi(r)!==it){let o=new Ut([],{});e[Mi(r)]=o}return e}function Xte(t,n,e){return e.some(r=>Lx(t,n,r)&&Mi(r)!==it)}function Yte(t,n,e){return e.some(r=>Lx(t,n,r))}function Lx(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function Zte(t,n,e){return n.length===0&&!t.children[e]}var Z1=class{};function Qte(t,n,e,r,o,i,s="emptyOnly"){return new Q1(t,n,e,r,o,s,i).recognize()}var Jte=31,Q1=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,r,o,i,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new X1(this.urlSerializer,this.urlTree)}noMatchError(n){return new Ie(4002,`'${n.segmentGroup}'`)}recognize(){let n=CP(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(Ge(({children:e,rootSnapshot:r})=>{let o=new Do(r,e),i=new Mx("",o),s=ste(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(n){let e=new Jp([],Object.freeze({}),Object.freeze(fe({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),it,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,it,e).pipe(Ge(r=>({children:r,rootSnapshot:e})),Ji(r=>{if(r instanceof mg)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof fg?this.noMatchError(r):r}))}processSegmentGroup(n,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r,i):this.processSegment(n,e,r,r.segments,o,!0,i).pipe(Ge(s=>s instanceof Do?[s]:[]))}processChildren(n,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return bn(i).pipe(Al(s=>{let a=r.children[s],l=mte(e,s);return this.processSegmentGroup(n,l,a,s,o)}),YI((s,a)=>(s.push(...a),s)),Rl(null),XI(),jn(s=>{if(s===null)return Yp(r);let a=KP(s);return ene(a),Ue(a)}))}processSegment(n,e,r,o,i,s,a){return bn(e).pipe(Al(l=>this.processSegmentAgainstRoute(l._injector??n,e,l,r,o,i,s,a).pipe(Ji(c=>{if(c instanceof fg)return Ue(null);throw c}))),Ls(l=>!!l),Ji(l=>{if(WP(l))return Zte(r,o,i)?Ue(new Z1):Yp(r);throw l}))}processSegmentAgainstRoute(n,e,r,o,i,s,a,l){return Mi(r)!==s&&(s===it||!Lx(o,i,r))?Yp(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,s,l):Yp(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:p}=qP(e,o,i);if(!l)return Yp(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>Jte&&(this.allowRedirects=!1));let f=new Jp(i,c,Object.freeze(fe({},this.urlTree.queryParams)),this.urlTree.fragment,_P(o),Mi(o),o.component??o._loadedComponent??null,o,IP(o)),m=Rx(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(m.params),f.data=Object.freeze(m.data);let h=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,f,n);return this.applyRedirects.lineralizeSegments(o,h).pipe(jn(g=>this.processSegment(n,r,e,g.concat(p),s,!1,a)))}matchSegmentAgainstRoute(n,e,r,o,i,s){let a=Wte(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(_o(l=>l.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(_o(({routes:c})=>{let u=r._loadedInjector??n,{parameters:d,consumedSegments:p,remainingSegments:f}=l,m=new Jp(p,d,Object.freeze(fe({},this.urlTree.queryParams)),this.urlTree.fragment,_P(r),Mi(r),r.component??r._loadedComponent??null,r,IP(r)),h=Rx(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(h.params),m.data=Object.freeze(h.data);let{segmentGroup:g,slicedSegments:x}=CP(e,p,f,c);if(x.length===0&&g.hasChildren())return this.processChildren(u,c,g,m).pipe(Ge(I=>new Do(m,I)));if(c.length===0&&x.length===0)return Ue(new Do(m,[]));let b=Mi(r)===i;return this.processSegment(u,c,g,x,b?it:i,!0,m).pipe(Ge(I=>new Do(m,I instanceof Do?[I]:[])))}))):Yp(e)))}getChildConfig(n,e,r){return e.children?Ue({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?Ue({routes:e._loadedRoutes,injector:e._loadedInjector}):zte(n,e,r,this.urlSerializer).pipe(jn(o=>o?this.configLoader.loadChildren(n,e).pipe(In(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):Gte(e))):Ue({routes:[],injector:n})}};function ene(t){t.sort((n,e)=>n.value.outlet===it?-1:e.value.outlet===it?1:n.value.outlet.localeCompare(e.value.outlet))}function tne(t){let n=t.value.routeConfig;return n&&n.path===""}function KP(t){let n=[],e=new Set;for(let r of t){if(!tne(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=KP(r.children);n.push(new Do(r.value,o))}return n.filter(r=>!e.has(r))}function _P(t){return t.data||{}}function IP(t){return t.resolve||{}}function nne(t,n,e,r,o,i){return jn(s=>Qte(t,n,e,r,s.extractedUrl,o,i).pipe(Ge(({state:a,tree:l})=>qe(fe({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function rne(t,n){return jn(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return Ue(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let c of XP(l))s.add(c);let a=0;return bn(s).pipe(Al(l=>i.has(l)?one(l,r,t,n):(l.data=Rx(l,l.parent,t).resolve,Ue(void 0))),In(()=>a++),Ep(1),jn(l=>a===s.size?Ue(e):Qr))})}function XP(t){let n=t.children.map(e=>XP(e)).flat();return[t,...n]}function one(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!zP(o)&&(i[hg]=o.title),ine(i,t,n,r).pipe(Ge(s=>(t._resolvedData=s,t.data=Rx(t,t.parent,e).resolve,null)))}function ine(t,n,e,r){let o=D1(t);if(o.length===0)return Ue({});let i={};return bn(o).pipe(jn(s=>sne(t[s],n,e,r).pipe(Ls(),In(a=>{if(a instanceof pg)throw Fx(new sg,a);i[s]=a}))),Ep(1),Ge(()=>i),Ji(s=>WP(s)?Qr:Nl(s)))}function sne(t,n,e,r){let o=gg(n)??r,i=of(t,o),s=i.resolve?i.resolve(n,e):dr(o,()=>i(n,e));return Kl(s)}function S1(t){return _o(n=>{let e=t(n);return e?bn(e).pipe(Ge(()=>n)):Ue(n)})}var YP=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===it);return r}getResolvedTitleForRoute(e){return e.data[hg]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>ie(ane),providedIn:"root"})}return t})(),ane=(()=>{class t extends YP{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)(Me(gP))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),oT=new ke("",{providedIn:"root",factory:()=>({})}),lne=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=ht({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&z(0,"router-outlet")},dependencies:[nT],encapsulation:2})}return t})();function iT(t){let n=t.children&&t.children.map(iT),e=n?qe(fe({},t),{children:n}):fe({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==it&&(e.component=lne),e}var sT=new ke(""),cne=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=ie(ZS);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return Ue(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=Kl(e.loadComponent()).pipe(Ge(ZP),In(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),Ps(()=>{this.componentLoaders.delete(e)})),o=new Cp(r,()=>new vn).pipe(wp());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return Ue({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=une(r,this.compiler,e,this.onLoadEndListener).pipe(Ps(()=>{this.childrenLoaders.delete(r)})),s=new Cp(i,()=>new vn).pipe(wp());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function une(t,n,e,r){return Kl(t.loadChildren()).pipe(Ge(ZP),jn(o=>o instanceof Oh||Array.isArray(o)?Ue(o):bn(n.compileModuleAsync(o))),Ge(o=>{r&&r(t);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(sT,[],{optional:!0,self:!0}).flat()),{routes:s.map(iT),injector:i}}))}function dne(t){return t&&typeof t=="object"&&"default"in t}function ZP(t){return dne(t)?t.default:t}var aT=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>ie(pne),providedIn:"root"})}return t})(),pne=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),fne=new ke("");var mne=new ke(""),hne=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new vn;transitionAbortSubject=new vn;configLoader=ie(cne);environmentInjector=ie(no);destroyRef=ie(jp);urlSerializer=ie(eT);rootContexts=ie(Px);location=ie(Wh);inputBindingEnabled=ie(rT,{optional:!0})!==null;titleStrategy=ie(YP);options=ie(oT,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=ie(aT);createViewTransition=ie(fne,{optional:!0});navigationErrorHandler=ie(mne,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>Ue(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new L1(o)),r=o=>this.events.next(new $1(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(qe(fe(fe({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new cr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:og,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(Lr(i=>i.id!==0),Ge(i=>qe(fe({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),_o(i=>{let s=!1,a=!1;return Ue(i).pipe(_o(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",No.SupersededByNewNavigation),Qr;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?qe(fe({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&u!=="reload"){let d="";return this.events.next(new qu(l.id,this.urlSerializer.serialize(l.rawUrl),d,R1.IgnoredSameUrlNavigation)),l.resolve(!1),Qr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return Ue(l).pipe(_o(d=>{let p=this.transitions?.getValue();return this.events.next(new lg(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?Qr:Promise.resolve(d)}),nne(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),In(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=qe(fe({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let p=new Nx(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:p,source:f,restoredState:m,extras:h}=l,g=new lg(d,this.urlSerializer.serialize(p),f,m);this.events.next(g);let x=VP(this.rootComponentType).snapshot;return this.currentTransition=i=qe(fe({},l),{targetSnapshot:x,urlAfterRedirects:p,extras:qe(fe({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,Ue(i)}else{let d="";return this.events.next(new qu(l.id,this.urlSerializer.serialize(l.extractedUrl),d,R1.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Qr}}),In(l=>{let c=new M1(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),Ge(l=>(this.currentTransition=i=qe(fe({},l),{guards:Cte(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),Mte(this.environmentInjector,l=>this.events.next(l)),In(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw Fx(this.urlSerializer,l.guardsResult);let c=new F1(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),Lr(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",No.GuardRejected),!1)),S1(l=>{if(l.guards.canActivateChecks.length)return Ue(l).pipe(In(c=>{let u=new O1(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),_o(c=>{let u=!1;return Ue(c).pipe(rne(this.paramsInheritanceStrategy,this.environmentInjector),In({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",No.NoDataFromResolver)}}))}),In(c=>{let u=new P1(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),S1(l=>{let c=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(In(p=>{u.component=p}),Ge(()=>{})));for(let p of u.children)d.push(...c(p));return d};return Ip(c(l.targetSnapshot.root)).pipe(Rl(null),Co(1))}),S1(()=>this.afterPreactivation()),_o(()=>{let{currentSnapshot:l,targetSnapshot:c}=i,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?bn(u).pipe(Ge(()=>i)):Ue(i)}),Ge(l=>{let c=yte(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=qe(fe({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),In(()=>{this.events.next(new ug)}),wte(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),Co(1),In({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new ql(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),_h(this.transitionAbortSubject.pipe(In(l=>{throw l}))),Ps(()=>{!s&&!a&&this.cancelNavigationTransition(i,"",No.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),Ji(l=>{if(this.destroyed)return i.resolve(!1),Qr;if(a=!0,GP(l))this.events.next(new na(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),bte(l)?this.events.next(new nf(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let c=new cg(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let u=dr(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof pg){let{message:d,cancellationCode:p}=Fx(this.urlSerializer,u);this.events.next(new na(i.id,this.urlSerializer.serialize(i.extractedUrl),d,p)),this.events.next(new nf(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return Qr}))}))}cancelNavigationTransition(e,r,o){let i=new na(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function gne(t){return t!==og}var yne=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>ie(vne),providedIn:"root"})}return t})(),J1=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},vne=(()=>{class t extends J1{static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),QP=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:()=>ie(xne),providedIn:"root"})}return t})(),xne=(()=>{class t extends QP{location=ie(Wh);urlSerializer=ie(eT);options=ie(oT,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=ie(aT);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new ra;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=VP(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof lg)this.stateMemento=this.createStateMemento();else if(e instanceof qu)this.rawUrlTree=r.initialUrl;else if(e instanceof Nx){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else e instanceof ug?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):e instanceof na&&(e.code===No.GuardRejected||e.code===No.NoDataFromResolver)?this.restoreHistory(r):e instanceof cg?this.restoreHistory(r,!0):e instanceof ql&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=e instanceof ra?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,s=fe(fe({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",s)}else{let i=fe(fe({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function bne(t,n){t.events.pipe(Lr(e=>e instanceof ql||e instanceof na||e instanceof cg||e instanceof qu),Ge(e=>e instanceof ql||e instanceof qu?0:(e instanceof na?e.code===No.Redirect||e.code===No.SupersededByNewNavigation:!1)?2:1),Lr(e=>e!==2),Co(1)).subscribe(()=>{n()})}var wne={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Cne={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},ko=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=ie(qS);stateManager=ie(QP);options=ie(oT,{optional:!0})||{};pendingTasks=ie(Xs);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=ie(hne);urlSerializer=ie(eT);location=ie(Wh);urlHandlingStrategy=ie(aT);_events=new vn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=ie(yne);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=ie(sT,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!ie(rT,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new gn;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof na&&r.code!==No.Redirect&&r.code!==No.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof ql)this.navigated=!0;else if(r instanceof nf){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=fe({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||gne(o.source)},s);this.scheduleNavigation(a,og,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}Ine(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),og,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=fe({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(iT),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=fe(fe({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let p=o?o.snapshot:this.routerState.snapshot.root;d=OP(p)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),d=this.currentUrlTree.root}return PP(d,e,u,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Hu(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,og,null,r)}navigate(e,r={skipLocationChange:!1}){return _ne(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=fe({},wne):r===!1?o=fe({},Cne):o=r,Hu(e))return vP(this.currentUrlTree,e,o);let i=this.parseUrl(e);return vP(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,p)=>{a=d,l=p});let u=this.pendingTasks.add();return bne(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function _ne(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new Ie(4008,!1)}function Ine(t){return!(t instanceof ug)&&!(t instanceof nf)}var Fn=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new vn;constructor(e,r,o,i,s,a){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a;let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof ql&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Hu(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,r,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||r||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.href=e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;let r=this.href===null?null:xF(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(e,r){let o=this.renderer,i=this.el.nativeElement;r!==null?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return this.routerLinkInput===null?null:Hu(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(r){return new(r||t)(ne(ko),ne(Fi),jv("tabindex"),ne(Di),ne(Er),ne(Xp))};static \u0275dir=Dt({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,o){r&1&&ae("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),r&2&&os("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Ai],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Ai],replaceUrl:[2,"replaceUrl","replaceUrl",Ai],routerLink:"routerLink"},features:[Vu,Ho]})}return t})();var Ene=new ke("");function JP(t,...n){return zp([{provide:sT,multi:!0,useValue:t},[],{provide:Fi,useFactory:Sne,deps:[ko]},{provide:Jv,multi:!0,useFactory:Tne},n.map(e=>e.\u0275providers)])}function Sne(t){return t.routerState.root}function Tne(){let t=ie(kn);return n=>{let e=t.get(Ws);if(n!==e.components[0])return;let r=t.get(ko),o=t.get(Dne);t.get(Nne)===1&&r.initialNavigation(),t.get(kne,null,lt.Optional)?.setUpPreloading(),t.get(Ene,null,lt.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var Dne=new ke("",{factory:()=>new vn}),Nne=new ke("",{providedIn:"root",factory:()=>1});var kne=new ke("");var eL=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)};var xg=class extends Error{constructor(n,e="FunctionsError",r){super(n),this.name=e,this.context=r}},$x=class extends xg{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}},Vx=class extends xg{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}},Bx=class extends xg{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}},lT=function(t){return t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2",t}(lT||{});var Ane=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},bg=class{constructor(n,{headers:e={},customFetch:r,region:o=lT.Any}={}){this.url=n,this.headers=e,this.region=o,this.fetch=eL(r)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,e={}){var r;return Ane(this,void 0,void 0,function*(){try{let{headers:o,method:i,body:s}=e,a={},{region:l}=e;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;s&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=s):typeof s=="string"?(a["Content-Type"]="text/plain",c=s):typeof FormData<"u"&&s instanceof FormData?c=s:(a["Content-Type"]="application/json",c=JSON.stringify(s)));let u=yield this.fetch(`${this.url}/${n}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:c}).catch(m=>{throw new $x(m)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new Vx(u);if(!u.ok)throw new Bx(u);let p=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return p==="application/json"?f=yield u.json():p==="application/octet-stream"?f=yield u.blob():p==="text/event-stream"?f=u:p==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(o){return{data:null,error:o}}})}};var fL=mh(pL(),1),{PostgrestClient:mL,PostgrestQueryBuilder:YNe,PostgrestFilterBuilder:ZNe,PostgrestTransformBuilder:QNe,PostgrestBuilder:JNe,PostgrestError:jne}=fL.default;var hL="2.11.2";var gL={"X-Client-Info":`realtime-js/${hL}`},yL="1.0.0",Gx=1e4,vL=1e3,af=function(t){return t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed",t}(af||{}),Ao=function(t){return t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving",t}(Ao||{}),Qo=function(t){return t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token",t}(Qo||{}),bT=function(t){return t.websocket="websocket",t}(bT||{}),Ku=function(t){return t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed",t}(Ku||{});var Wx=class{constructor(){this.HEADER_LENGTH=1}decode(n,e){return n.constructor===ArrayBuffer?e(this._binaryDecode(n)):e(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){let e=new DataView(n),r=new TextDecoder;return this._decodeBroadcast(n,e,r)}_decodeBroadcast(n,e,r){let o=e.getUint8(1),i=e.getUint8(2),s=this.HEADER_LENGTH+2,a=r.decode(n.slice(s,s+o));s=s+o;let l=r.decode(n.slice(s,s+i));s=s+i;let c=JSON.parse(r.decode(n.slice(s,n.byteLength)));return{ref:null,topic:a,event:l,payload:c}}};var lf=class{constructor(n,e){this.callback=n,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var un=function(t){return t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange",t}(un||{}),CT=(t,n,e={})=>{var r;let o=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(n).reduce((i,s)=>(i[s]=Gne(s,t,n,o),i),{})},Gne=(t,n,e,r)=>{let o=n.find(a=>a.name===t),i=o?.type,s=e[t];return i&&!r.includes(i)?xL(i,s):wT(s)},xL=(t,n)=>{if(t.charAt(0)==="_"){let e=t.slice(1,t.length);return Kne(n,e)}switch(t){case un.bool:return Wne(n);case un.float4:case un.float8:case un.int2:case un.int4:case un.int8:case un.numeric:case un.oid:return Hne(n);case un.json:case un.jsonb:return qne(n);case un.timestamp:return Xne(n);case un.abstime:case un.date:case un.daterange:case un.int4range:case un.int8range:case un.money:case un.reltime:case un.text:case un.time:case un.timestamptz:case un.timetz:case un.tsrange:case un.tstzrange:return wT(n);default:return wT(n)}},wT=t=>t,Wne=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},Hne=t=>{if(typeof t=="string"){let n=parseFloat(t);if(!Number.isNaN(n))return n}return t},qne=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(n){return console.log(`JSON parse error: ${n}`),t}return t},Kne=(t,n)=>{if(typeof t!="string")return t;let e=t.length-1,r=t[e];if(t[0]==="{"&&r==="}"){let i,s=t.slice(1,e);try{i=JSON.parse("["+s+"]")}catch{i=s?s.split(","):[]}return i.map(a=>xL(n,a))}return t},Xne=t=>typeof t=="string"?t.replace(" ","T"):t,Hx=t=>{let n=t;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};var cf=class{constructor(n,e,r={},o=Gx){this.channel=n,this.event=e,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,e){var r;return this._hasReceived(n)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:n,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let n=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:e}){this.recHooks.filter(r=>r.status===n).forEach(r=>r.callback(e))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}};var Tg=class t{constructor(n,e){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,o,i,s),this.pendingDiffs.forEach(l=>{this.state=t.syncDiff(this.state,l,i,s)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t.syncDiff(this.state,o,i,s),a())}),this.onJoin((o,i,s)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:i,newPresences:s})}),this.onLeave((o,i,s)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:i,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,e,r,o){let i=this.cloneDeep(n),s=this.transformState(e),a={},l={};return this.map(i,(c,u)=>{s[c]||(l[c]=u)}),this.map(s,(c,u)=>{let d=i[c];if(d){let p=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),h=d.filter(g=>p.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),h.length>0&&(l[c]=h)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,o)}static syncDiff(n,e,r,o){let{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(i,(a,l)=>{var c;let u=(c=n[a])!==null&&c!==void 0?c:[];if(n[a]=this.cloneDeep(l),u.length>0){let d=n[a].map(f=>f.presence_ref),p=u.filter(f=>d.indexOf(f.presence_ref)<0);n[a].unshift(...p)}r(a,u,l)}),this.map(s,(a,l)=>{let c=n[a];if(!c)return;let u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),n[a]=c,o(a,c,l),c.length===0&&delete n[a]}),n}static map(n,e){return Object.getOwnPropertyNames(n).map(r=>e(r,n[r]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((e,r)=>{let o=n[r];return"metas"in o?e[r]=o.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=o,e},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var oa=function(t){return t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR",t}(oa||{});var Dg=class t{constructor(n,e={config:{}},r){this.topic=n,this.params=e,this.socket=r,this.bindings={},this.state=Ao.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new cf(this,Qo.join,this.params,this.timeout),this.rejoinTimer=new lf(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Ao.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Ao.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Ao.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Ao.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Qo.reply,{},(o,i)=>{this._trigger(this._replyEventName(i),o)}),this.presence=new Tg(this),this.broadcastEndpointURL=Hx(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(n,e=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:s,private:a}}=this.params;this._onError(u=>n?.(oa.CHANNEL_ERROR,u)),this._onClose(()=>n?.(oa.CLOSED));let l={},c={broadcast:i,presence:s,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){n?.(oa.SUBSCRIBED);return}else{let p=this.bindings.postgres_changes,f=(d=p?.length)!==null&&d!==void 0?d:0,m=[];for(let h=0;h<f;h++){let g=p[h],{filter:{event:x,schema:b,table:I,filter:_}}=g,E=u&&u[h];if(E&&E.event===x&&E.schema===b&&E.table===I&&E.filter===_)m.push(Object.assign(Object.assign({},g),{id:E.id}));else{this.unsubscribe(),n?.(oa.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,n&&n(oa.SUBSCRIBED);return}}).receive("error",u=>{n?.(oa.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{n?.(oa.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,e={}){return await this.send({type:"presence",event:"track",payload:n},e.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,e,r){return this._on(n,e,r)}async send(n,e={}){var r,o;if(!this._canPush()&&n.type==="broadcast"){let{event:i,payload:s}=n,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s,private:this.private}]})};try{let c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var s,a,l;let c=this._push(n.type,n,e.timeout||this.timeout);n.type==="broadcast"&&!(!((l=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=Ao.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Qo.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let o=new cf(this,Qo.leave,{},n);o.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}async _fetchWithTimeout(n,e,r){let o=new AbortController,i=setTimeout(()=>o.abort(),r),s=await this.socket.fetch(n,Object.assign(Object.assign({},e),{signal:o.signal}));return clearTimeout(i),s}_push(n,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new cf(this,n,e,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(n,e,r){return e}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,e,r){var o,i;let s=n.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Qo;if(r&&[a,l,c,u].indexOf(s)>=0&&r!==this._joinRef())return;let p=this._onMessage(s,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var m,h,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(h=f.filter)===null||h===void 0?void 0:h.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===s}).map(f=>f.callback(p,r)):(i=this.bindings[s])===null||i===void 0||i.filter(f=>{var m,h,g,x,b,I;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in f){let _=f.id,E=(m=f.filter)===null||m===void 0?void 0:m.event;return _&&((h=e.ids)===null||h===void 0?void 0:h.includes(_))&&(E==="*"||E?.toLocaleLowerCase()===((g=e.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let _=(b=(x=f?.filter)===null||x===void 0?void 0:x.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return _==="*"||_===((I=e?.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===s}).map(f=>{if(typeof p=="object"&&"ids"in p){let m=p.data,{schema:h,table:g,commit_timestamp:x,type:b,errors:I}=m;p=Object.assign(Object.assign({},{schema:h,table:g,commit_timestamp:x,eventType:b,new:{},old:{},errors:I}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===Ao.closed}_isJoined(){return this.state===Ao.joined}_isJoining(){return this.state===Ao.joining}_isLeaving(){return this.state===Ao.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,e,r){let o=n.toLocaleLowerCase(),i={type:o,filter:e,callback:r};return this.bindings[o]?this.bindings[o].push(i):this.bindings[o]=[i],this}_off(n,e){let r=n.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var i;return!(((i=o.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&t.isEqual(o.filter,e))}),this}static isEqual(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(let r in n)if(n[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Qo.close,{},n)}_onError(n){this._on(Qo.error,{},e=>n(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Ao.joining,this.joinPush.resend(n))}_getPayloadRecords(n){let e={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(e.new=CT(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(e.old=CT(n.columns,n.old_record)),e}};var Zne=()=>{},Qne=typeof WebSocket<"u",Jne=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,Ng=class{constructor(n,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=gL,this.params={},this.timeout=Gx,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Zne,this.conn=null,this.sendBuffer=[],this.serializer=new Wx,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...a)=>import("./chunk-MAQGHWLI.js").then(({default:l})=>l(...a)):s=fetch,(...a)=>s(...a)},this.endPoint=`${n}/${bT.websocket}`,this.httpEndpoint=Hx(n),e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let o=(r=e?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e?.encode?e.encode:(i,s)=>s(JSON.stringify(i)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new lf(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch),e?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=e?.worker||!1,this.workerUrl=e?.workerUrl}this.accessToken=e?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(Qne){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new _T(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-KYSFV2V4.js").then(({default:n})=>{this.conn=new n(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:yL}))}disconnect(n,e){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){let e=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){let n=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),n}log(n,e,r){this.logger(n,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case af.connecting:return Ku.Connecting;case af.open:return Ku.Open;case af.closing:return Ku.Closing;default:return Ku.Closed}}isConnected(){return this.connectionState()===Ku.Open}channel(n,e={config:{}}){let r=new Dg(`realtime:${n}`,e,this);return this.channels.push(r),r}push(n){let{topic:e,event:r,payload:o,ref:i}=n,s=()=>{this.encode(n,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${r} (${i})`,o),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(n=null){let e=n||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(o=>{e&&o.updateJoinPayload({access_token:e}),o.joinedOnce&&o._isJoined()&&o._push(Qo.access_token,{access_token:e})})}}async sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(vL,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let e=this.channels.find(r=>r.topic===n&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${n}"`),e.unsubscribe())}_remove(n){this.channels=this.channels.filter(e=>e._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_onConnMessage(n){this.decode(n.data,e=>{let{topic:r,event:o,payload:i,ref:s}=e;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${o} ${s&&"("+s+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,i,s)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(Qo.error))}_appendParams(n,e){if(Object.keys(e).length===0)return n;let r=n.match(/\?/)?"&":"?",o=new URLSearchParams(e);return`${n}${r}${o}`}_workerObjectUrl(n){let e;if(n)e=n;else{let r=new Blob([Jne],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}};var _T=class{constructor(n,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=af.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=r.close}};var uf=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function On(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var qx=class extends uf{constructor(n,e){super(n),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},Xu=class extends uf{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};var ere=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Xx=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},bL=()=>ere(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-MAQGHWLI.js")).Response:Response}),Kx=t=>{if(Array.isArray(t))return t.map(e=>Kx(e));if(typeof t=="function"||t!==Object(t))return t;let n={};return Object.entries(t).forEach(([e,r])=>{let o=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));n[o]=Kx(r)}),n};var Yu=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},IT=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),tre=(t,n,e)=>Yu(void 0,void 0,void 0,function*(){let r=yield bL();t instanceof r&&!e?.noResolveJson?t.json().then(o=>{n(new qx(IT(o),t.status||500))}).catch(o=>{n(new Xu(IT(o),o))}):n(new Xu(IT(t),t))}),nre=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},n?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),e))};function kg(t,n,e,r,o,i){return Yu(this,void 0,void 0,function*(){return new Promise((s,a)=>{t(e,nre(n,r,o,i)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>tre(l,a,r))})})}function df(t,n,e,r){return Yu(this,void 0,void 0,function*(){return kg(t,"GET",n,e,r)})}function cs(t,n,e,r,o){return Yu(this,void 0,void 0,function*(){return kg(t,"POST",n,r,o,e)})}function wL(t,n,e,r,o){return Yu(this,void 0,void 0,function*(){return kg(t,"PUT",n,r,o,e)})}function CL(t,n,e,r){return Yu(this,void 0,void 0,function*(){return kg(t,"HEAD",n,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function Yx(t,n,e,r,o){return Yu(this,void 0,void 0,function*(){return kg(t,"DELETE",n,r,o,e)})}var lo=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},rre={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},_L={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},Zx=class{constructor(n,e={},r,o){this.url=n,this.headers=e,this.bucketId=r,this.fetch=Xx(o)}uploadOrUpdate(n,e,r,o){return lo(this,void 0,void 0,function*(){try{let i,s=Object.assign(Object.assign({},_L),o),a=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(s.upsert)}),l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let c=this._removeEmptyFolders(e),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:n,body:i,headers:a},s?.duplex?{duplex:s.duplex}:{})),p=yield d.json();return d.ok?{data:{path:c,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(On(i))return{data:null,error:i};throw i}})}upload(n,e,r){return lo(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,e,r)})}uploadToSignedUrl(n,e,r,o){return lo(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(n),s=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let l,c=Object.assign({upsert:_L.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(l){if(On(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(n,e){return lo(this,void 0,void 0,function*(){try{let r=this._getFinalPath(n),o=Object.assign({},this.headers);e?.upsert&&(o["x-upsert"]="true");let i=yield cs(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),s=new URL(this.url+i.url),a=s.searchParams.get("token");if(!a)throw new uf("No token returned by API");return{data:{signedUrl:s.toString(),path:n,token:a},error:null}}catch(r){if(On(r))return{data:null,error:r};throw r}})}update(n,e,r){return lo(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,e,r)})}move(n,e,r){return lo(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(On(o))return{data:null,error:o};throw o}})}copy(n,e,r){return lo(this,void 0,void 0,function*(){try{return{data:{path:(yield cs(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(On(o))return{data:null,error:o};throw o}})}createSignedUrl(n,e,r){return lo(this,void 0,void 0,function*(){try{let o=this._getFinalPath(n),i=yield cs(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(o){if(On(o))return{data:null,error:o};throw o}})}createSignedUrls(n,e,r){return lo(this,void 0,void 0,function*(){try{let o=yield cs(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:n},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${i}`):null})),error:null}}catch(o){if(On(o))return{data:null,error:o};throw o}})}download(n,e){return lo(this,void 0,void 0,function*(){let o=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),s=i?`?${i}`:"";try{let a=this._getFinalPath(n);return{data:yield(yield df(this.fetch,`${this.url}/${o}/${a}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(On(a))return{data:null,error:a};throw a}})}info(n){return lo(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{let r=yield df(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:Kx(r),error:null}}catch(r){if(On(r))return{data:null,error:r};throw r}})}exists(n){return lo(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{return yield CL(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(On(r)&&r instanceof Xu){let o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(n,e){let r=this._getFinalPath(n),o=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&o.push(i);let a=typeof e?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(e?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(n){return lo(this,void 0,void 0,function*(){try{return{data:yield Yx(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(e){if(On(e))return{data:null,error:e};throw e}})}list(n,e,r){return lo(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},rre),e),{prefix:n||""});return{data:yield cs(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(On(o))return{data:null,error:o};throw o}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){let e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};var IL="2.7.1";var EL={"X-Client-Info":`storage-js/${IL}`};var pf=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Qx=class{constructor(n,e={},r){this.url=n,this.headers=Object.assign(Object.assign({},EL),e),this.fetch=Xx(r)}listBuckets(){return pf(this,void 0,void 0,function*(){try{return{data:yield df(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(On(n))return{data:null,error:n};throw n}})}getBucket(n){return pf(this,void 0,void 0,function*(){try{return{data:yield df(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(e){if(On(e))return{data:null,error:e};throw e}})}createBucket(n,e={public:!1}){return pf(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(On(r))return{data:null,error:r};throw r}})}updateBucket(n,e){return pf(this,void 0,void 0,function*(){try{return{data:yield wL(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(On(r))return{data:null,error:r};throw r}})}emptyBucket(n){return pf(this,void 0,void 0,function*(){try{return{data:yield cs(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(On(e))return{data:null,error:e};throw e}})}deleteBucket(n){return pf(this,void 0,void 0,function*(){try{return{data:yield Yx(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(e){if(On(e))return{data:null,error:e};throw e}})}};var Ag=class extends Qx{constructor(n,e={},r){super(n,e,r)}from(n){return new Zx(this.url,this.headers,n,this.fetch)}};var SL="2.48.1";var Rg="";typeof Deno<"u"?Rg="deno":typeof document<"u"?Rg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Rg="react-native":Rg="node";var ore={"X-Client-Info":`supabase-js-${Rg}/${SL}`},TL={headers:ore},DL={schema:"public"},NL={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},kL={};dR();var ire=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},sre=t=>{let n;return t?n=t:typeof fetch>"u"?n=cR:n=fetch,(...e)=>n(...e)},are=()=>typeof Headers>"u"?uR:Headers,AL=(t,n,e)=>{let r=sre(e),o=are();return(i,s)=>ire(void 0,void 0,void 0,function*(){var a;let l=(a=yield n())!==null&&a!==void 0?a:t,c=new o(s?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},s),{headers:c}))})};var lre=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})};function RL(t){return t.replace(/\/$/,"")}function ML(t,n){let{db:e,auth:r,realtime:o,global:i}=t,{db:s,auth:a,realtime:l,global:c}=n,u={db:Object.assign(Object.assign({},s),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),o),global:Object.assign(Object.assign({},c),i),accessToken:()=>lre(this,void 0,void 0,function*(){return""})};return t.accessToken?u.accessToken=t.accessToken:delete u.accessToken,u}var Jx="2.67.3";var FL="http://localhost:9999",OL="supabase.auth.token";var PL={"X-Client-Info":`gotrue-js/${Jx}`},ET=10;var Mg="X-Supabase-Api-Version",ST={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function LL(t){return Math.round(Date.now()/1e3)+t}function $L(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=Math.random()*16|0;return(t=="x"?n:n&3|8).toString(16)})}var Oi=()=>typeof window<"u"&&typeof document<"u",Zu={tested:!1,writable:!1},Xl=()=>{if(!Oi())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Zu.tested)return Zu.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Zu.tested=!0,Zu.writable=!0}catch{Zu.tested=!0,Zu.writable=!1}return Zu.writable};function VL(t){let n={},e=new URL(t);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((o,i)=>{n[i]=o})}catch{}return e.searchParams.forEach((r,o)=>{n[o]=r}),n}var eb=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-MAQGHWLI.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},BL=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",TT=async(t,n,e)=>{await t.setItem(n,JSON.stringify(e))},Og=async(t,n)=>{let e=await t.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch{return e}},Pg=async(t,n)=>{await t.removeItem(n)};function cre(t){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,o,i,s,a,l,c,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)s=n.indexOf(t.charAt(u++)),a=n.indexOf(t.charAt(u++)),l=n.indexOf(t.charAt(u++)),c=n.indexOf(t.charAt(u++)),r=s<<2|a>>4,o=(a&15)<<4|l>>2,i=(l&3)<<6|c,e=e+String.fromCharCode(r),l!=64&&o!=0&&(e=e+String.fromCharCode(o)),c!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}var Fg=class t{constructor(){this.promise=new t.promiseConstructor((n,e)=>{this.resolve=n,this.reject=e})}};Fg.promiseConstructor=Promise;function DT(t){let n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=t.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(cre(r))}async function zL(t){return await new Promise(n=>{setTimeout(()=>n(null),t)})}function UL(t,n){return new Promise((r,o)=>{(async()=>{for(let i=0;i<1/0;i++)try{let s=await t(i);if(!n(i,null,s)){r(s);return}}catch(s){if(!n(i,s)){o(s);return}}})()})}function ure(t){return("0"+t.toString(16)).substr(-2)}function dre(){let n=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,o="";for(let i=0;i<56;i++)o+=e.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(n),Array.from(n,ure).join("")}async function pre(t){let e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",e),o=new Uint8Array(r);return Array.from(o).map(i=>String.fromCharCode(i)).join("")}function fre(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function mre(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let e=await pre(t);return fre(e)}async function Qu(t,n,e=!1){let r=dre(),o=r;e&&(o+="/PASSWORD_RECOVERY"),await TT(t,`${n}-code-verifier`,o);let i=await mre(r);return[i,r===i?"plain":"s256"]}var hre=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function jL(t){let n=t.headers.get(Mg);if(!n||!n.match(hre))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}var Lg=class extends Error{constructor(n,e,r){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}};function nt(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var tb=class extends Lg{constructor(n,e,r){super(n,e,r),this.name="AuthApiError",this.status=e,this.code=r}};function GL(t){return nt(t)&&t.name==="AuthApiError"}var ff=class extends Lg{constructor(n,e){super(n),this.name="AuthUnknownError",this.originalError=e}},ia=class extends Lg{constructor(n,e,r,o){super(n,r,o),this.name=e,this.status=r}},Jo=class extends ia{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function WL(t){return nt(t)&&t.name==="AuthSessionMissingError"}var mf=class extends ia{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Ju=class extends ia{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}},ed=class extends ia{constructor(n,e=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function HL(t){return nt(t)&&t.name==="AuthImplicitGrantRedirectError"}var $g=class extends ia{constructor(n,e=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},hf=class extends ia{constructor(n,e){super(n,"AuthRetryableFetchError",e,void 0)}};function nb(t){return nt(t)&&t.name==="AuthRetryableFetchError"}var Vg=class extends ia{constructor(n,e,r){super(n,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}};var gre=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},td=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),yre=[502,503,504];async function qL(t){var n;if(!BL(t))throw new hf(td(t),0);if(yre.includes(t.status))throw new hf(td(t),t.status);let e;try{e=await t.json()}catch(i){throw new ff(td(i),i)}let r,o=jL(t);if(o&&o.getTime()>=ST["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new Vg(td(e),t.status,((n=e.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(r==="session_not_found")throw new Jo}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,s)=>i&&typeof s=="string",!0))throw new Vg(td(e),t.status,e.weak_password.reasons);throw new tb(td(e),t.status||500,r)}var vre=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),e))};async function gt(t,n,e,r){var o;let i=Object.assign({},r?.headers);i[Mg]||(i[Mg]=ST["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let s=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(s.redirect_to=r.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await xre(t,n,e+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function xre(t,n,e,r,o,i){let s=vre(n,r,o,i),a;try{a=await t(e,Object.assign({},s))}catch(l){throw console.error(l),new hf(td(l),0)}if(a.ok||await qL(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await qL(l)}}function sa(t){var n;let e=null;bre(t)&&(e=Object.assign({},t),t.expires_at||(e.expires_at=LL(t.expires_in)));let r=(n=t.user)!==null&&n!==void 0?n:t;return{data:{session:e,user:r},error:null}}function NT(t){let n=sa(t);return!n.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(n.data.weak_password=t.weak_password),n}function us(t){var n;return{data:{user:(n=t.user)!==null&&n!==void 0?n:t},error:null}}function KL(t){return{data:t,error:null}}function XL(t){let{action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i}=t,s=gre(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i},l=Object.assign({},s);return{data:{properties:a,user:l},error:null}}function YL(t){return t}function bre(t){return t.access_token&&t.refresh_token&&t.expires_in}var wre=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},gf=class{constructor({url:n="",headers:e={},fetch:r}){this.url=n,this.headers=e,this.fetch=eb(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,e="global"){try{return await gt(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(r){if(nt(r))return{data:null,error:r};throw r}}async inviteUserByEmail(n,e={}){try{return await gt(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:us})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async generateLink(n){try{let{options:e}=n,r=wre(n,["options"]),o=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await gt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:XL,redirectTo:e?.redirectTo})}catch(e){if(nt(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(n){try{return await gt(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:us})}catch(e){if(nt(e))return{data:{user:null},error:e};throw e}}async listUsers(n){var e,r,o,i,s,a,l;try{let c={nextPage:null,lastPage:0,total:0},u=await gt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=n?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=n?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:YL});if(u.error)throw u.error;let d=await u.json(),p=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{let h=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=h}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(nt(c))return{data:{users:[]},error:c};throw c}}async getUserById(n){try{return await gt(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:us})}catch(e){if(nt(e))return{data:{user:null},error:e};throw e}}async updateUserById(n,e){try{return await gt(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:e,headers:this.headers,xform:us})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async deleteUser(n,e=!1){try{return await gt(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:e},xform:us})}catch(r){if(nt(r))return{data:{user:null},error:r};throw r}}async _listFactors(n){try{let{data:e,error:r}=await gt(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:e,error:r}}catch(e){if(nt(e))return{data:null,error:e};throw e}}async _deleteFactor(n){try{return{data:await gt(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(e){if(nt(e))return{data:null,error:e};throw e}}};var ZL={getItem:t=>Xl()?globalThis.localStorage.getItem(t):null,setItem:(t,n)=>{Xl()&&globalThis.localStorage.setItem(t,n)},removeItem:t=>{Xl()&&globalThis.localStorage.removeItem(t)}};function kT(t={}){return{getItem:n=>t[n]||null,setItem:(n,e)=>{t[n]=e},removeItem:n=>{delete t[n]}}}function QL(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var nd={debug:!!(globalThis&&Xl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},Bg=class extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}},rb=class extends Bg{};async function AT(t,n,e){nd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,n);let r=new globalThis.AbortController;return n>0&&setTimeout(()=>{r.abort(),nd.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){nd.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await e()}finally{nd.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(n===0)throw nd.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new rb(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(nd.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}QL();var Cre={url:FL,storageKey:OL,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:PL,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},zg=30*1e3,JL=3;async function e$(t,n,e){return await e()}var RT=(()=>{class t{constructor(e){var r,o;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&Oi()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},Cre),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new gf({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=eb(i.fetch),this.lock=i.lock||e$,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Oi()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=AT:this.lock=e$,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:Xl()?this.storage=ZL:(this.memoryStorage={},this.storage=kT(this.memoryStorage)):(this.memoryStorage={},this.storage=kT(this.memoryStorage)),Oi()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Jx}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r=VL(window.location.href),o="none";if(this._isImplicitGrantCallback(r)?o="implicit":await this._isPKCECallback(r)&&(o="pkce"),Oi()&&this.detectSessionInUrl&&o!=="none"){let{data:i,error:s}=await this._getSessionFromURL(r,o);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),HL(s)){let c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return nt(r)?{error:r}:{error:new ff("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,o,i;try{let s=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:sa}),{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(nt(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,o,i;try{let s;if("email"in e){let{email:d,password:p,options:f}=e,m=null,h=null;this.flowType==="pkce"&&([m,h]=await Qu(this.storage,this.storageKey)),s=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:h},xform:sa})}else if("phone"in e){let{phone:d,password:p,options:f}=e;s=await gt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(o=f?.data)!==null&&o!==void 0?o:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:sa})}else throw new Ju("You must provide either an email or phone number and a password");let{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(nt(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){let{email:s,password:a,options:l}=e;r=await gt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:NT})}else if("phone"in e){let{phone:s,password:a,options:l}=e;r=await gt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:NT})}else throw new Ju("You must provide either an email or phone number and a password");let{data:o,error:i}=r;return i?{data:{user:null,session:null},error:i}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new mf}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:i})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,o,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let r=await Og(this.storage,`${this.storageKey}-code-verifier`),[o,i]=(r??"").split("/");try{let{data:s,error:a}=await gt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:o},xform:sa});if(await Pg(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new mf}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:a})}catch(s){if(nt(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:r,provider:o,token:i,access_token:s,nonce:a}=e,l=await gt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:sa}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new mf}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,o,i,s,a;try{if("email"in e){let{email:l,options:c}=e,u=null,d=null;this.flowType==="pkce"&&([u,d]=await Qu(this.storage,this.storageKey));let{error:p}=await gt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:l,options:c}=e,{data:u,error:d}=await gt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Ju("You must provide either an email or phone number.")}catch(l){if(nt(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,o;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(o=e.options)===null||o===void 0?void 0:o.captchaToken);let{data:a,error:l}=await gt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:sa});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");let c=a.session,u=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(nt(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var r,o,i;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await Qu(this.storage,this.storageKey)),await gt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&o!==void 0?o:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:KL})}catch(s){if(nt(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:r},error:o}=e;if(o)throw o;if(!r)throw new Jo;let{error:i}=await gt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(nt(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let r=`${this.url}/resend`;if("email"in e){let{email:o,type:i,options:s}=e,{error:a}=await gt(this.fetch,"POST",r,{headers:this.headers,body:{email:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:o,type:i,options:s}=e,{data:a,error:l}=await gt(this.fetch,"POST",r,{headers:this.headers,body:{phone:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:l}}throw new Ju("You must provide either an email or phone number and a type")}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await o,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let o=r();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=await Og(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let o=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",e.expires_at),!o){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await gt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:us}):await this._useSession(async r=>{var o,i,s;let{data:a,error:l}=r;if(l)throw l;return!(!((o=a.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Jo}:await gt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:us})})}catch(r){if(nt(r))return WL(r)&&(await this._removeSession(),await Pg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async o=>{let{data:i,error:s}=o;if(s)throw s;if(!i.session)throw new Jo;let a=i.session,l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await Qu(this.storage,this.storageKey));let{data:u,error:d}=await gt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:us});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(o){if(nt(o))return{data:{user:null},error:o};throw o}}_decodeJWT(e){return DT(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Jo;let r=Date.now()/1e3,o=r,i=!0,s=null,a=DT(e.access_token);if(a.exp&&(o=a.exp,i=o<=r),i){let{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};s=l}else{let{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:o-r,expires_at:o},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(nt(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var o;if(!e){let{data:a,error:l}=r;if(l)throw l;e=(o=a.session)!==null&&o!==void 0?o:void 0}if(!e?.refresh_token)throw new Jo;let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(nt(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!Oi())throw new ed("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ed(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new $g("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ed("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new $g("No code detected.");let{data:I,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;let E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:I.session,redirectType:null},error:null}}let{provider_token:o,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!a||!u)throw new ed("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(l),f=d+p;c&&(f=parseInt(c));let m=f-d;m*1e3<=zg&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${p}s`);let h=f-p;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,f,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,f,d);let{data:g,error:x}=await this._getUser(s);if(x)throw x;let b={provider_token:o,provider_refresh_token:i,access_token:s,expires_in:p,expires_at:f,refresh_token:a,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:b,redirectType:e.type},error:null}}catch(o){if(nt(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let r=await Og(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{error:s};let a=(o=i.session)===null||o===void 0?void 0:o.access_token;if(a){let{error:l}=await this.admin.signOut(a,e);if(l&&!(GL(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Pg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let r=$L(),o={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,o),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:o}}}async _emitInitialSession(e){return await this._useSession(async r=>{var o,i;try{let{data:{session:s},error:a}=r;if(a)throw a;await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let o=null,i=null;this.flowType==="pkce"&&([o,i]=await Qu(this.storage,this.storageKey,!0));try{return await gt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(nt(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:r,error:o}=await this.getUser();if(o)throw o;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(nt(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{let{data:o,error:i}=await this._useSession(async s=>{var a,l,c,u,d;let{data:p,error:f}=s;if(f)throw f;let m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await gt(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=p.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return Oi()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:e.provider,url:o?.url},error:null}}catch(o){if(nt(o))return{data:{provider:e.provider,url:null},error:o};throw o}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)throw a;return await gt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(o=s.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let o=Date.now();return await UL(async i=>(i>0&&await zL(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await gt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:sa})),(i,s)=>{let a=200*Math.pow(2,i);return s&&nb(s)&&Date.now()+a-o<zg})}catch(o){if(this._debug(r,"error",o),nt(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){let o=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",o),Oi()&&!r.skipBrowserRedirect&&window.location.assign(o),{data:{provider:e,url:o},error:null}}async _recoverAndRefresh(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=await Og(this.storage,this.storageKey);if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}let i=Math.round(Date.now()/1e3),s=((e=o.expires_at)!==null&&e!==void 0?e:1/0)<i+ET;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${ET}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=await this._callRefreshToken(o.refresh_token);a&&(console.error(a),nb(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,o;if(!e)throw new Jo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Fg;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Jo;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),nt(s)){let a={session:null,error:s};return nb(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,o=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:e,session:r});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){s.push(c)}});if(await Promise.all(a),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await TT(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await Pg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Oi()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),zg);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async r=>{let{data:{session:o}}=r;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((o.expires_at*1e3-e)/zg);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${zg}ms, refresh threshold is ${JL} ticks`),i<=JL&&await this._callRefreshToken(o.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof Bg)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Oi()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,o){let i=[`provider=${encodeURIComponent(r)}`];if(o?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&i.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){let[s,a]=await Qu(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(l.toString())}if(o?.queryParams){let s=new URLSearchParams(o.queryParams);i.push(s.toString())}return o?.skipBrowserRedirect&&i.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await gt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)return{data:null,error:a};let l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await gt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(nt(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{data:null,error:s};let{data:a,error:l}=await gt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(r){if(nt(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await gt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(nt(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){let{data:r,error:o}=await this._challenge({factorId:e.factorId});return o?{data:null,error:o}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){let{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};let o=e?.factors||[],i=o.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=o.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:o,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,o;let{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),l=null;a.aal&&(l=a.aal);let c=l;((o=(r=i.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(c="aal2");let d=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}}return t.nextInstanceID=0,t})();var _re=RT,MT=_re;var ob=class extends MT{constructor(n){super(n)}};var Ire=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},ib=class{constructor(n,e,r){var o,i,s;if(this.supabaseUrl=n,this.supabaseKey=e,!n)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let a=RL(n);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:DL,realtime:kL,auth:Object.assign(Object.assign({},NL),{storageKey:l}),global:TL},u=ML(r??{},c);this.storageKey=(o=u.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=u.auth)!==null&&s!==void 0?s:{},this.headers,u.global.fetch),this.fetch=AL(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new mL(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new bg(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ag(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},r={}){return this.rest.rpc(n,e,r)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,e;return Ire(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,storageKey:i,flowType:s,lock:a,debug:l},c,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ob({url:this.authUrl,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,flowType:s,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new Ng(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(n,e,r){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var t$=(t,n,e)=>new ib(t,n,e);var PT=(t,n)=>n.some(e=>t instanceof e),n$,r$;function Ere(){return n$||(n$=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Sre(){return r$||(r$=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var LT=new WeakMap,FT=new WeakMap,sb=new WeakMap;function Tre(t){let n=new Promise((e,r)=>{let o=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(rd(t.result)),o()},s=()=>{r(t.error),o()};t.addEventListener("success",i),t.addEventListener("error",s)});return sb.set(n,t),n}function Dre(t){if(LT.has(t))return;let n=new Promise((e,r)=>{let o=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),o()},s=()=>{r(t.error||new DOMException("AbortError","AbortError")),o()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});LT.set(t,n)}var $T={get(t,n,e){if(t instanceof IDBTransaction){if(n==="done")return LT.get(t);if(n==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return rd(t[n])},set(t,n,e){return t[n]=e,!0},has(t,n){return t instanceof IDBTransaction&&(n==="done"||n==="store")?!0:n in t}};function a$(t){$T=t($T)}function Nre(t){return Sre().includes(t)?function(...n){return t.apply(VT(this),n),rd(this.request)}:function(...n){return rd(t.apply(VT(this),n))}}function kre(t){return typeof t=="function"?Nre(t):(t instanceof IDBTransaction&&Dre(t),PT(t,Ere())?new Proxy(t,$T):t)}function rd(t){if(t instanceof IDBRequest)return Tre(t);if(FT.has(t))return FT.get(t);let n=kre(t);return n!==t&&(FT.set(t,n),sb.set(n,t)),n}var VT=t=>sb.get(t);function zT(t,n,{blocked:e,upgrade:r,blocking:o,terminated:i}={}){let s=indexedDB.open(t,n),a=rd(s);return r&&s.addEventListener("upgradeneeded",l=>{r(rd(s.result),l.oldVersion,l.newVersion,rd(s.transaction),l)}),e&&s.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{i&&l.addEventListener("close",()=>i()),o&&l.addEventListener("versionchange",c=>o(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var Are=["get","getKey","getAll","getAllKeys","count"],Rre=["put","add","delete","clear"],OT=new Map;function o$(t,n){if(!(t instanceof IDBDatabase&&!(n in t)&&typeof n=="string"))return;if(OT.get(n))return OT.get(n);let e=n.replace(/FromIndex$/,""),r=n!==e,o=Rre.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(o||Are.includes(e)))return;let i=async function(s,...a){let l=this.transaction(s,o?"readwrite":"readonly"),c=l.store;return r&&(c=c.index(a.shift())),(await Promise.all([c[e](...a),o&&l.done]))[0]};return OT.set(n,i),i}a$(t=>qe(fe({},t),{get:(n,e,r)=>o$(n,e)||t.get(n,e,r),has:(n,e)=>!!o$(n,e)||t.has(n,e)}));var Mre=["continue","continuePrimaryKey","advance"],i$={},BT=new WeakMap,l$=new WeakMap,Fre={get(t,n){if(!Mre.includes(n))return t[n];let e=i$[n];return e||(e=i$[n]=function(...r){BT.set(this,l$.get(this)[n](...r))}),e}};async function*Ore(...t){let n=this;if(n instanceof IDBCursor||(n=await n.openCursor(...t)),!n)return;n=n;let e=new Proxy(n,Fre);for(l$.set(e,n),sb.set(e,VT(n));n;)yield e,n=await(BT.get(e)||n.continue()),BT.delete(e)}function s$(t,n){return n===Symbol.asyncIterator&&PT(t,[IDBIndex,IDBObjectStore,IDBCursor])||n==="iterate"&&PT(t,[IDBIndex,IDBObjectStore])}a$(t=>qe(fe({},t),{get(n,e,r){return s$(n,e)?Ore:t.get(n,e,r)},has(n,e){return s$(n,e)||t.has(n,e)}}));var ab={API_URL:"https://jsgltiaidlacvchyjjha.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzZ2x0aWFpZGxhY3ZjaHlqamhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2NjIzNDIsImV4cCI6MjA1NTIzODM0Mn0.bPtRMhXapLzUgPEIf6GoW9r52umh0F1YZhG1bfLyb0s",supabase_LocalStorage_key:"sb-jsgltiaidlacvchyjjha-auth-token"};var kt=class t{constructor(n){this.platformId=n;this.supabase=t$(ab.API_URL,ab.anon_key,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),this.initializeAuthState()}supabase;user=io(null);currentUsername=io(null);loginStatus=io(null);ngOnInit(){this.initializeAuthState()}initializeAuthState(){if(!cn(this.platformId))return;let n=this.getStoredSession();n&&this.updateSession(n),this.refreshSessionFromApi(),this.supabase.auth.onAuthStateChange((e,r)=>{this.updateSession(r)})}getStoredSession(){try{let n=localStorage.getItem(ab.supabase_LocalStorage_key);if(!n)return null;let e=JSON.parse(n);if(!e||!e.expires_at)return null;let r=e.expires_at*1e3;return Date.now()>=r?null:e}catch(n){return console.error("Error parsing stored session",n),null}}async refreshSessionFromApi(){try{let{data:n,error:e}=await this.supabase.auth.getSession();if(e)throw e;this.updateSession(n.session)}catch(n){console.error("Failed to refresh session:",n),this.updateSession(null)}}updateSession(n){if(n){this.user.set(n.user);let e=n.user?.identities?.[0]?.identity_data?.firstname||null;this.currentUsername.set(e),this.loginStatus.set(!0)}else this.user.set(null),this.currentUsername.set(null),this.loginStatus.set(!1)}initializeApp(){return new Promise(n=>{if(!cn(this.platformId))return this.loginStatus.set(!1),n(!1);let e=this.getStoredSession();e&&this.updateSession(e),this.supabase.auth.getSession().then(({data:r,error:o})=>{o?(console.error("Failed to get session:",o),this.updateSession(null)):this.updateSession(r.session),this.supabase.auth.onAuthStateChange((i,s)=>{this.updateSession(s)}),n(!0)})})}async signIn(n,e){try{let{error:r}=await this.supabase.auth.signInWithPassword({email:n,password:e});if(r)throw r;return{success:!0}}catch(r){return console.error("Sign in error:",r),{success:!1,error:r}}}async signOut(){try{let{error:n}=await this.supabase.auth.signOut();if(n)throw n;return this.clearStorages(),this.updateSession(null),{success:!0}}catch(n){return console.error("Sign out error:",n),{success:!1,error:n}}}async signUp(n,e,r,o){let{data:i,error:s}=await this.supabase.auth.signUp({email:n,password:e,options:{data:{firstname:r,lastname:o}}});if(s)throw s;setTimeout(()=>{i.user?.id&&this.createUserAccount(n,r,o)},500)}clearStorages(){cn(this.platformId)&&(localStorage.clear(),sessionStorage.clear())}async addTradeLog(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");n.userid=r.id;let{data:o,error:i}=await this.supabase.from(e).insert([n]);if(i)throw console.error("Error inserting trade log: ",i),i;return cn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async getTradeLogs(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=!1,o=null;if(cn(this.platformId)){r=sessionStorage.getItem(`${n}_refresh`)==="yes";let a=sessionStorage.getItem(n);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade logs:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(n).select("*").eq("userid",e.id);if(s)throw console.error("Error fetching trade logs:",s),s;return cn(this.platformId)&&(sessionStorage.setItem(n,JSON.stringify(i)),sessionStorage.removeItem(`${n}_refresh`)),i}async getTradeLogsOfSelectedAccount(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");let o=`${n}_${e}`,i=`${o}_refresh`,s=!1,a=null;if(cn(this.platformId)){s=sessionStorage.getItem(i)==="yes";let u=sessionStorage.getItem(o);if(u)try{a=JSON.parse(u)}catch(d){console.error("Error parsing cached trade logs:",d),a=null}}if(!s&&a)return a;let{data:l,error:c}=await this.supabase.from(n).select("*").eq("userid",r.id).eq("trade_account_id",e);if(c)throw console.error("Error fetching trade logs:",c),c;return cn(this.platformId)&&(sessionStorage.setItem(o,JSON.stringify(l)),sessionStorage.removeItem(i)),l}async addTradeLogOfSelectedAccount(n,e,r){let o=this.user();if(!o)throw new Error("User not authenticated");n.userid=o.id;let{data:i,error:s}=await this.supabase.from(e).insert([n]);if(s)throw console.error("Error inserting trade log: ",s),s;return cn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async updateTradeLogOfSelectedAccount(n,e,r){if(!this.user())throw new Error("User not authenticated");let{data:i,error:s}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(s)throw console.error("Error updating trade log: ",s),s;return cn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async deleteTradeLogOfSelectedAccount(n,e,r){if(!this.user())throw new Error("User not authenticated");let{data:i,error:s}=await this.supabase.from(e).delete().eq("tradeid",n);if(s)throw console.error("Error deleting trade log: ",s),s;return cn(this.platformId)&&sessionStorage.setItem(`${e}_${r}_refresh`,"yes"),i}async updateTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(i)throw console.error("Error updating trade log: ",i),i;return cn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async deleteTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).delete().eq("tradeid",n);if(i)throw console.error("Error deleting trade log: ",i),i;return cn(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async loadQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminLoadQuestions(){let{data:n,error:e}=await this.supabase.from("adminquestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminSaveQuestions(n){let e=null;for(let r of n.filter(o=>o.isModified))if(r.question_id){let{data:o,error:i}=await this.supabase.from("adminquestions").update({question_data:r.question_data,active:r.active}).eq("question_id",r.question_id).select().single();if(i){console.error("Error updating question:",i),e=i;break}else r.updated_at=o.updated_at,r.isModified=!1}else{let{data:o,error:i}=await this.supabase.from("adminquestions").insert([{question_data:r.question_data,active:r.active}]).select().single();if(i){console.error("Error inserting question:",i),e=i;break}else r.question_id=o.question_id,r.created_at=o.created_at,r.updated_at=o.updated_at,r.isModified=!1}return{error:e}}async deleteQuestion(n){let{error:e}=await this.supabase.from("adminquestions").delete().eq("question_id",n.question_id);return{error:e}}async getActiveQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");return{data:n,error:e}}async submitUserAnswers(n){let{error:e}=await this.supabase.from("answers").insert(n);return{error:e}}async getUserTradeAccounts(){let n=this.user();if(!n)throw new Error("User not authenticated");let e="tradeaccount",r=!1,o=null;if(cn(this.platformId)){r=sessionStorage.getItem(`${e}_refresh`)==="yes";let a=sessionStorage.getItem(e);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade accounts:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(e).select("*").eq("user_id",n.id);if(s)throw console.error("Error fetching trade accounts:",s),s;return cn(this.platformId)&&(sessionStorage.setItem(e,JSON.stringify(i)),sessionStorage.removeItem(`${e}_refresh`)),i||[]}async addTradeAccount(n){let e=this.user();if(!e)throw new Error("User not authenticated");let c=n,{track_pl:r,include_in_analytics:o,trading_instruments:i}=c,s=p0(c,["track_pl","include_in_analytics","trading_instruments"]),a={track_pl:r,include_in_analytics:o,trading_instruments:i},{error:l}=await this.supabase.from("tradeaccount").insert([qe(fe({},s),{user_id:e.id,metadata:a})]);return l?(console.error("Failed to add trade account:",l),!1):(sessionStorage.setItem("tradeaccount_refresh","yes"),!0)}async editTradeAccount(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");let u=e,{track_pl:o,include_in_analytics:i,trading_instruments:s}=u,a=p0(u,["track_pl","include_in_analytics","trading_instruments"]),l={track_pl:o,include_in_analytics:i,trading_instruments:s},{error:c}=await this.supabase.from("tradeaccount").update(qe(fe({},a),{metadata:l})).eq("account_id",n).eq("user_id",r.id);return c?(console.error("Failed to update trade account:",c),!1):(sessionStorage.setItem("tradeaccount_refresh","yes"),!0)}async RemoveTradeAccount(n){let e=this.user();if(!e)throw new Error("User not authenticated");let{error:r}=await this.supabase.from("tradejournal").delete().eq("trade_account_id",n).eq("userid",e.id);if(r)return console.error("Failed to delete associated trade logs:",r),!1;let{error:o}=await this.supabase.from("tradeaccount").delete().eq("account_id",n).eq("user_id",e.id);return o?(console.error("Failed to remove trade account:",o),!1):(cn(this.platformId)&&(sessionStorage.setItem("tradeaccount_refresh","yes"),sessionStorage.setItem(`tradejournal_${n}_refresh`,"yes")),!0)}async createUserAccount(n,e,r){let o=this.user();if(!o)throw new Error("User not authenticated");let{error:i}=await this.supabase.from("usersaccount").insert({user_id:o.id,email:n||"",firstname:e||"",lastname:r||""});i&&console.error("Failed to create user account record:",i)}async getProfile(){let n=this.user();if(!n)throw new Error("User not authenticated");return this.supabase.from("usersaccount").select("*").eq("user_id",n.id).single()}async updateProfile(n){let e=this.user();if(!e)throw new Error("User not authenticated");return this.supabase.from("usersaccount").update(n).eq("user_id",e.id)}async uploadProfilePicture(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=n.name.split(".").pop(),o=`${e.id}/profile.${r}`,{error:i}=await this.supabase.storage.from("user-profile-pictures").upload(o,n,{upsert:!0});return i?null:o}async cacheProfilePictureBlob(n,e){await(await zT("profile-cache",1,{upgrade(o){o.createObjectStore("pictures")}})).put("pictures",e,n)}async getCachedProfilePictureBlobUrl(n){if(!n)return null;let e=await zT("profile-cache",1,{upgrade(a){a.createObjectStore("pictures")}}),r=await e.get("pictures",n);if(r)return URL.createObjectURL(r);let o=await this.getPublicUrl(n);if(!o)return null;let i=await fetch(o);if(!i.ok)return null;let s=await i.blob();return await e.put("pictures",s,n),URL.createObjectURL(s)}clearCachedProfilePictureBlobUrl(){if(cn(this.platformId)){let n=sessionStorage.getItem("profile_picture_blob_url");n&&(URL.revokeObjectURL(n),sessionStorage.removeItem("profile_picture_blob_url"))}}async deleteProfilePicture(){let{data:{user:n}}=await this.supabase.auth.getUser();if(!n)return;let e=`profile-pictures/${n.id}`;await this.supabase.storage.from("user-profile-pictures").remove([e])}async getPublicUrl(n){let{data:e}=await this.supabase.storage.from("user-profile-pictures").createSignedUrl(n,60);return e?.signedUrl??null}supaScream(){return"SupaScream"}static \u0275fac=function(e){return new(e||t)(Me(so))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})};function Pre(t,n){if(t&1&&(v(0,"div",11)(1,"div",12)(2,"div",8)(3,"h5",13),C(4),y(),v(5,"p",14),C(6),y(),v(7,"a",15),C(8),y()()()()),t&2){let e=n.$implicit;O(4),tt(e.title),O(2),tt(e.description),O(),U("routerLink",e.link),O(),tt(e.buttonText)}}var lb=class t{constructor(n){this.supabaseService=n;this.userFirstName=this.supabaseService.currentUsername()}userFirstName;steps=[{title:"Step 1: Daily Emotional Check-in",description:"Understand your emotional state before making trading decisions.",buttonText:"Begin Emotional Check-in",link:"/emotions"},{title:"Step 2: Plan Your Trades",description:"Document your trading plan before executing any trades.",buttonText:"Plan your trade",link:"/tradejournal"},{title:"Step 3: Update your Trades",description:"Record results and analyze your trading performance.",buttonText:"Execute your trades",link:"/tradejournal"},{title:"Step 4: Reflection & Meditation",description:"Clear your mind with mindfulness practices.",buttonText:"Start Reflection",link:"/reflection"}];static \u0275fac=function(e){return new(e||t)(ne(kt))};static \u0275cmp=ht({type:t,selectors:[["app-landing-page"]],decls:22,vars:1,consts:[[1,"container","mt-4"],[1,"mb-4"],[1,""],[1,"mt-3"],["class","col-12 mt-3",4,"ngFor","ngForOf"],[1,"row","mb-5"],[1,"col-12"],[1,"card","h-100","bg-transparent"],[1,"card-body"],[1,"card-title"],["routerLink","/meditationhub",1,"btn","btn-secondary","btn-tr"],[1,"col-12","mt-3"],[1,"card","h-100","bg-transparent","mt-3"],[1,"card-title","mt-3"],[1,"card-text","mt-3"],[1,"btn","btn-primary","btn-tr","mt-3",3,"routerLink"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"h2",1),C(2,"Begin Your Trading Transformation"),y(),v(3,"h3",1),C(4,"Your Daily Trading Routine"),y(),v(5,"p",2),C(6," Welcome to your personalized trading journey. Each day follows a structured approach designed to build discipline and improve your trading performance. "),y(),v(7,"div",3),te(8,Pre,9,4,"div",4),y(),z(9,"hr"),v(10,"h2",1),C(11,"Additional Resources"),y(),v(12,"div",5)(13,"div",6)(14,"div",7)(15,"div",8)(16,"h5",9),C(17,"Meditation Hub"),y(),v(18,"p"),C(19,"Clear your mind and reduce emotional reactivity with guided meditations."),y(),v(20,"a",10),C(21,"Visit Meditation Hub"),y()()()()()()),e&2&&(O(8),U("ngForOf",r.steps))},dependencies:[Fn,Pt,Jn],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:8px}.card-body[_ngcontent-%COMP%]{padding-left:0}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.75rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-custom[_ngcontent-%COMP%]{border-radius:20px;font-weight:600}@media (max-width: 576px){.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.btn-custom[_ngcontent-%COMP%]{padding:.5rem 1rem}}"]})};var vr=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return new Promise(o=>{dr(this.injector,()=>{qp(()=>{this.supabaseService.loginStatus()&&o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()||o(this.router.createUrlTree([""],{queryParams:{returnUrl:e.url}}))},100)})}static \u0275fac=function(e){return new(e||t)(Me(kt),Me(ko),Me(kn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})};var cb=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return r?!1:r?new Promise(o=>{dr(this.injector,()=>{qp(()=>{this.supabaseService.loginStatus()||o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()&&o(this.router.createUrlTree(["/home"]))},100)}):!0}static \u0275fac=function(e){return new(e||t)(Me(kt),Me(ko),Me(kn))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})};var v$=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||t)(ne(Di),ne(Er))};static \u0275dir=Dt({type:t})}return t})(),wf=(()=>{class t extends v${static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,features:[An]})}return t})(),Jl=new ke(""),Lre={provide:Jl,useExisting:ur(()=>od),multi:!0},od=(()=>{class t extends wf{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){r&1&&ae("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[mr([Lre]),An]})}return t})(),$re={provide:Jl,useExisting:ur(()=>Pn),multi:!0};function Vre(){let t=ea()?ea().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var Bre=new ke(""),Pn=(()=>{class t extends v${_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!Vre())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||t)(ne(Di),ne(Er),ne(Bre,8))};static \u0275dir=Dt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&ae("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[mr([$re]),An]})}return t})();function Yl(t){return t==null||(typeof t=="string"||Array.isArray(t))&&t.length===0}function x$(t){return t!=null&&typeof t.length=="number"}var ec=new ke(""),Cf=new ke(""),zre=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,Ee=class{static min(n){return b$(n)}static max(n){return w$(n)}static required(n){return Ure(n)}static requiredTrue(n){return jre(n)}static email(n){return Gre(n)}static minLength(n){return Wre(n)}static maxLength(n){return Hre(n)}static pattern(n){return qre(n)}static nullValidator(n){return db(n)}static compose(n){return T$(n)}static composeAsync(n){return D$(n)}};function b$(t){return n=>{if(Yl(n.value)||Yl(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function w$(t){return n=>{if(Yl(n.value)||Yl(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}function Ure(t){return Yl(t.value)?{required:!0}:null}function jre(t){return t.value===!0?null:{required:!0}}function Gre(t){return Yl(t.value)||zre.test(t.value)?null:{email:!0}}function Wre(t){return n=>Yl(n.value)||!x$(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}function Hre(t){return n=>x$(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}function qre(t){if(!t)return db;let n,e;return typeof t=="string"?(e="",t.charAt(0)!=="^"&&(e+="^"),e+=t,t.charAt(t.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),r=>{if(Yl(r.value))return null;let o=r.value;return n.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}function db(t){return null}function C$(t){return t!=null}function _$(t){return Bu(t)?bn(t):t}function I$(t){let n={};return t.forEach(e=>{n=e!=null?fe(fe({},n),e):n}),Object.keys(n).length===0?null:n}function E$(t,n){return n.map(e=>e(t))}function Kre(t){return!t.validate}function S$(t){return t.map(n=>Kre(n)?n:e=>n.validate(e))}function T$(t){if(!t)return null;let n=t.filter(C$);return n.length==0?null:function(e){return I$(E$(e,n))}}function qT(t){return t!=null?T$(S$(t)):null}function D$(t){if(!t)return null;let n=t.filter(C$);return n.length==0?null:function(e){let r=E$(e,n).map(_$);return wh(r).pipe(Ge(I$))}}function KT(t){return t!=null?D$(S$(t)):null}function c$(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function N$(t){return t._rawValidators}function k$(t){return t._rawAsyncValidators}function UT(t){return t?Array.isArray(t)?t:[t]:[]}function pb(t,n){return Array.isArray(t)?t.includes(n):t===n}function u$(t,n){let e=UT(n);return UT(t).forEach(o=>{pb(e,o)||e.push(o)}),e}function d$(t,n){return UT(n).filter(e=>!pb(t,e))}var fb=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=qT(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=KT(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},Wr=class extends fb{name;get formDirective(){return null}get path(){return null}},Zl=class extends fb{_parent=null;name=null;valueAccessor=null},mb=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Xre={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},YRe=qe(fe({},Xre),{"[class.ng-submitted]":"isSubmitted"}),er=(()=>{class t extends mb{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(ne(Zl,2))};static \u0275dir=Dt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&So("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[An]})}return t})(),co=(()=>{class t extends mb{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(ne(Wr,10))};static \u0275dir=Dt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){r&2&&So("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[An]})}return t})();var Ug="VALID",ub="INVALID",yf="PENDING",jg="DISABLED",Ql=class{},hb=class extends Ql{value;source;constructor(n,e){super(),this.value=n,this.source=e}},Wg=class extends Ql{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},Hg=class extends Ql{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},vf=class extends Ql{status;source;constructor(n,e){super(),this.status=n,this.source=e}},jT=class extends Ql{source;constructor(n){super(),this.source=n}},GT=class extends Ql{source;constructor(n){super(),this.source=n}};function XT(t){return(xb(t)?t.validators:t)||null}function Yre(t){return Array.isArray(t)?qT(t):t||null}function ZT(t,n){return(xb(n)?n.asyncValidators:t)||null}function Zre(t){return Array.isArray(t)?KT(t):t||null}function xb(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function A$(t,n,e){let r=t.controls;if(!(n?Object.keys(r):r).length)throw new Ie(1e3,"");if(!r[e])throw new Ie(1001,"")}function R$(t,n,e){t._forEachChild((r,o)=>{if(e[o]===void 0)throw new Ie(1002,"")})}var xf=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return ss(this.statusReactive)}set status(n){ss(()=>this.statusReactive.set(n))}_status=Ul(()=>this.statusReactive());statusReactive=io(void 0);get valid(){return this.status===Ug}get invalid(){return this.status===ub}get pending(){return this.status==yf}get disabled(){return this.status===jg}get enabled(){return this.status!==jg}errors;get pristine(){return ss(this.pristineReactive)}set pristine(n){ss(()=>this.pristineReactive.set(n))}_pristine=Ul(()=>this.pristineReactive());pristineReactive=io(!0);get dirty(){return!this.pristine}get touched(){return ss(this.touchedReactive)}set touched(n){ss(()=>this.touchedReactive.set(n))}_touched=Ul(()=>this.touchedReactive());touchedReactive=io(!1);get untouched(){return!this.touched}_events=new vn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(u$(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(u$(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(d$(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(d$(n,this._rawAsyncValidators))}hasValidator(n){return pb(this._rawValidators,n)}hasAsyncValidator(n){return pb(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(qe(fe({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Hg(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),e&&n.emitEvent!==!1&&this._events.next(new Hg(!1,r))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(qe(fe({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Wg(!1,r))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),e&&n.emitEvent!==!1&&this._events.next(new Wg(!0,r))}markAsPending(n={}){this.status=yf;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new vf(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(qe(fe({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=jg,this.errors=null,this._forEachChild(o=>{o.disable(qe(fe({},n),{onlySelf:!0}))}),this._updateValue();let r=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new hb(this.value,r)),this._events.next(new vf(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(qe(fe({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=Ug,this._forEachChild(r=>{r.enable(qe(fe({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(qe(fe({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ug||this.status===yf)&&this._runAsyncValidator(r,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new hb(this.value,e)),this._events.next(new vf(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(qe(fe({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?jg:Ug}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=yf,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=_$(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new vf(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,r)}_initObservables(){this.valueChanges=new Ot,this.statusChanges=new Ot}_calculateStatus(){return this._allControlsDisabled()?jg:this.errors?ub:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(yf)?yf:this._anyControlsHaveStatus(ub)?ub:Ug}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),o&&this._events.next(new Wg(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new Hg(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){xb(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=Yre(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=Zre(this._rawAsyncValidators)}},bf=class extends xf{constructor(n,e,r){super(XT(e),ZT(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){R$(this,!0,n),Object.keys(n).forEach(r=>{A$(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(r=>{let o=this.controls[r];o&&o.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,o)=>{r.reset(n?n[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>r._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var WT=class extends bf{};var _f=new ke("",{providedIn:"root",factory:()=>Kg}),Kg="always";function bb(t,n){return[...n.path,t]}function gb(t,n,e=Kg){QT(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),Jre(t,n),toe(t,n),eoe(t,n),Qre(t,n)}function p$(t,n,e=!0){let r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),vb(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function yb(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function Qre(t,n){if(n.valueAccessor.setDisabledState){let e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}function QT(t,n){let e=N$(t);n.validator!==null?t.setValidators(c$(e,n.validator)):typeof e=="function"&&t.setValidators([e]);let r=k$(t);n.asyncValidator!==null?t.setAsyncValidators(c$(r,n.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let o=()=>t.updateValueAndValidity();yb(n._rawValidators,o),yb(n._rawAsyncValidators,o)}function vb(t,n){let e=!1;if(t!==null){if(n.validator!==null){let o=N$(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.validator);i.length!==o.length&&(e=!0,t.setValidators(i))}}if(n.asyncValidator!==null){let o=k$(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.asyncValidator);i.length!==o.length&&(e=!0,t.setAsyncValidators(i))}}}let r=()=>{};return yb(n._rawValidators,r),yb(n._rawAsyncValidators,r),e}function Jre(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&M$(t,n)})}function eoe(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&M$(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function M$(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function toe(t,n){let e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}function F$(t,n){t==null,QT(t,n)}function noe(t,n){return vb(t,n)}function O$(t,n){if(!t.hasOwnProperty("model"))return!1;let e=t.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function roe(t){return Object.getPrototypeOf(t.constructor)===wf}function P$(t,n){t._syncPendingControls(),n.forEach(e=>{let r=e.control;r.updateOn==="submit"&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function L$(t,n){if(!n)return null;Array.isArray(n);let e,r,o;return n.forEach(i=>{i.constructor===Pn?e=i:roe(i)?r=i:o=i}),o||r||e||null}function ooe(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}var ioe={provide:Wr,useExisting:ur(()=>JT)},Gg=Promise.resolve(),JT=(()=>{class t extends Wr{callSetDisabledState;get submitted(){return ss(this.submittedReactive)}_submitted=Ul(()=>this.submittedReactive());submittedReactive=io(!1);_directives=new Set;form;ngSubmit=new Ot;options;constructor(e,r,o){super(),this.callSetDisabledState=o,this.form=new bf({},qT(e),KT(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Gg.then(()=>{let r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),gb(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Gg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Gg.then(()=>{let r=this._findContainer(e.path),o=new bf({});F$(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Gg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){Gg.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),P$(this.form,this._directives),this.ngSubmit.emit(e),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(r){return new(r||t)(ne(ec,10),ne(Cf,10),ne(_f,8))};static \u0275dir=Dt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&ae("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[mr([ioe]),An]})}return t})();function f$(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function m$(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var qg=class extends xf{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,r){super(XT(e),ZT(r,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),xb(e)&&(e.nonNullable||e.initialValueIsDefault)&&(m$(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){f$(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){f$(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){m$(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var soe=t=>t instanceof qg,aoe=(()=>{class t extends Wr{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return bb(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,standalone:!1,features:[An]})}return t})();var loe={provide:Zl,useExisting:ur(()=>id)},h$=Promise.resolve(),id=(()=>{class t extends Zl{_changeDetectorRef;callSetDisabledState;control=new qg;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new Ot;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=L$(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),O$(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){gb(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){h$.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&Ai(r);h$.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?bb(e,this._parent):[e]}static \u0275fac=function(r){return new(r||t)(ne(Wr,9),ne(ec,10),ne(Cf,10),ne(Jl,10),ne(It,8),ne(_f,8))};static \u0275dir=Dt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[mr([loe]),An,Ho]})}return t})(),uo=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275dir=Dt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})(),coe={provide:Jl,useExisting:ur(()=>aa),multi:!0},aa=(()=>{class t extends wf{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&ae("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[mr([coe]),An]})}return t})(),uoe={provide:Jl,useExisting:ur(()=>la),multi:!0};var doe=(()=>{class t{_accessors=[];add(e,r){this._accessors.push([e,r])}remove(e){for(let r=this._accessors.length-1;r>=0;--r)if(this._accessors[r][1]===e){this._accessors.splice(r,1);return}}select(e){this._accessors.forEach(r=>{this._isSameGroup(r,e)&&r[1]!==e&&r[1].fireUncheck(e.value)})}_isSameGroup(e,r){return e[0].control?e[0]._parent===r._control._parent&&e[1].name===r.name:!1}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),la=(()=>{class t extends wf{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=ie(_f,{optional:!0})??Kg;constructor(e,r,o,i){super(e,r),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get(Zl),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(r){return new(r||t)(ne(Di),ne(Er),ne(doe),ne(kn))};static \u0275dir=Dt({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(r,o){r&1&&ae("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[mr([uoe]),An]})}return t})();var $$=new ke("");var poe={provide:Wr,useExisting:ur(()=>po)},po=(()=>{class t extends Wr{callSetDisabledState;get submitted(){return ss(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=Ul(()=>this._submittedReactive());_submittedReactive=io(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new Ot;constructor(e,r,o){super(),this.callSetDisabledState=o,this._setValidators(e),this._setAsyncValidators(r)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(vb(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let r=this.form.get(e.path);return gb(r,e,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),r}getControl(e){return this.form.get(e.path)}removeControl(e){p$(e.control||null,e,!1),ooe(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,r){this.form.get(e.path).setValue(r)}onSubmit(e){return this._submittedReactive.set(!0),P$(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new jT(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new GT(this.form))}_updateDomValue(){this.directives.forEach(e=>{let r=e.control,o=this.form.get(e.path);r!==o&&(p$(r||null,e),soe(o)&&(gb(o,e,this.callSetDisabledState),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let r=this.form.get(e.path);F$(r,e),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let r=this.form.get(e.path);r&&noe(r,e)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){QT(this.form,this),this._oldForm&&vb(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(r){return new(r||t)(ne(ec,10),ne(Cf,10),ne(_f,8))};static \u0275dir=Dt({type:t,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&ae("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[mr([poe]),An,Ho]})}return t})(),foe={provide:Wr,useExisting:ur(()=>wb)},wb=(()=>{class t extends aoe{name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}_checkParentType(){V$(this._parent)}static \u0275fac=function(r){return new(r||t)(ne(Wr,13),ne(ec,10),ne(Cf,10))};static \u0275dir=Dt({type:t,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[mr([foe]),An]})}return t})(),moe={provide:Wr,useExisting:ur(()=>Cb)},Cb=(()=>{class t extends Wr{_parent;name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}ngOnInit(){this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return bb(this.name==null?this.name:this.name.toString(),this._parent)}_checkParentType(){V$(this._parent)}static \u0275fac=function(r){return new(r||t)(ne(Wr,13),ne(ec,10),ne(Cf,10))};static \u0275dir=Dt({type:t,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[mr([moe]),An]})}return t})();function V$(t){return!(t instanceof wb)&&!(t instanceof po)&&!(t instanceof Cb)}var hoe={provide:Zl,useExisting:ur(()=>Ro)},Ro=(()=>{class t extends Zl{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new Ot;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,r,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=L$(this,i)}ngOnChanges(e){this._added||this._setUpControl(),O$(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return bb(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||t)(ne(Wr,13),ne(ec,10),ne(Cf,10),ne(Jl,10),ne($$,8))};static \u0275dir=Dt({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[mr([hoe]),An,Ho]})}return t})(),goe={provide:Jl,useExisting:ur(()=>ds),multi:!0};function B$(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function yoe(t){return t.split(":")[0]}var ds=(()=>{class t extends wf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=B$(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=yoe(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&ae("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[mr([goe]),An]})}return t})(),ps=(()=>{class t{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(B$(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(ne(Er),ne(Di),ne(ds,9))};static \u0275dir=Dt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),voe={provide:Jl,useExisting:ur(()=>z$),multi:!0};function g$(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function xoe(t){return t.split(":")[0]}var z$=(()=>{class t extends wf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);o.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);o.push(c)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=xoe(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&ae("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[mr([voe]),An]})}return t})(),fs=(()=>{class t{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(g$(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(g$(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(ne(Er),ne(Di),ne(z$,9))};static \u0275dir=Dt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function U$(t){return typeof t=="number"?t:parseFloat(t)}var j$=(()=>{class t{_validator=db;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):db,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||t)};static \u0275dir=Dt({type:t,features:[Ho]})}return t})(),boe={provide:ec,useExisting:ur(()=>eD),multi:!0},eD=(()=>{class t extends j${max;inputName="max";normalizeInput=e=>U$(e);createValidator=e=>w$(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&os("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[mr([boe]),An]})}return t})(),woe={provide:ec,useExisting:ur(()=>Xg),multi:!0},Xg=(()=>{class t extends j${min;inputName="min";normalizeInput=e=>U$(e);createValidator=e=>b$(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=qo(t)))(o||t)}})();static \u0275dir=Dt({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&os("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[mr([woe]),An]})}return t})();var G$=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({})}return t})(),HT=class extends xf{constructor(n,e,r){super(XT(e),ZT(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,r={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,e={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,r={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),e&&(this.controls.splice(o,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){R$(this,!1,n),n.forEach((r,o)=>{A$(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((r,o)=>{r.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,r)=>r._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,r)=>{n(e,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function y$(t){return!!t&&(t.asyncValidators!==void 0||t.validators!==void 0||t.updateOn!==void 0)}var ei=(()=>{class t{useNonNullable=!1;get nonNullable(){let e=new t;return e.useNonNullable=!0,e}group(e,r=null){let o=this._reduceControls(e),i={};return y$(r)?i=r:r!==null&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new bf(o,i)}record(e,r=null){let o=this._reduceControls(e);return new WT(o,r)}control(e,r,o){let i={};return this.useNonNullable?(y$(r)?i=r:(i.validators=r,i.asyncValidators=o),new qg(e,qe(fe({},i),{nonNullable:!0}))):new qg(e,r,o)}array(e,r,o){let i=e.map(s=>this._createControl(s));return new HT(i,r,o)}_reduceControls(e){let r={};return Object.keys(e).forEach(o=>{r[o]=this._createControl(e[o])}),r}_createControl(e){if(e instanceof qg)return e;if(e instanceof xf)return e;if(Array.isArray(e)){let r=e[0],o=e.length>1?e[1]:null,i=e.length>2?e[2]:null;return this.control(r,o,i)}else return this.control(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var If=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:_f,useValue:e.callSetDisabledState??Kg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({imports:[G$]})}return t})(),fo=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:$$,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:_f,useValue:e.callSetDisabledState??Kg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({imports:[G$]})}return t})();var xr=[];for(let t=0;t<256;++t)xr.push((t+256).toString(16).slice(1));function W$(t,n=0){return(xr[t[n+0]]+xr[t[n+1]]+xr[t[n+2]]+xr[t[n+3]]+"-"+xr[t[n+4]]+xr[t[n+5]]+"-"+xr[t[n+6]]+xr[t[n+7]]+"-"+xr[t[n+8]]+xr[t[n+9]]+"-"+xr[t[n+10]]+xr[t[n+11]]+xr[t[n+12]]+xr[t[n+13]]+xr[t[n+14]]+xr[t[n+15]]).toLowerCase()}var tD,Coe=new Uint8Array(16);function nD(){if(!tD){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");tD=crypto.getRandomValues.bind(crypto)}return tD(Coe)}var _oe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),rD={randomUUID:_oe};function Ioe(t,n,e){if(rD.randomUUID&&!n&&!t)return rD.randomUUID();t=t||{};let r=t.random??t.rng?.()??nD();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let o=0;o<16;++o)n[e+o]=r[o];return n}return W$(r)}var sd=Ioe;var Eoe=(t,n)=>({"text-success":t,"text-danger":n});function Soe(t,n){if(t&1&&(v(0,"div",138),z(1,"div",139),y()),t&2){let e=Y();O(),Hp("width",e.calculateFormProgress()+"%")}}function Toe(t,n){if(t&1&&(v(0,"span",140),C(1),y()),t&2){let e=Y();O(),$e("",e.calculateFormProgress(),"% Complete")}}function Doe(t,n){t&1&&(v(0,"div",141),C(1," Account name is required "),y())}function Noe(t,n){t&1&&(v(0,"div",141),C(1," Please select an instrument type "),y())}function koe(t,n){t&1&&(v(0,"div",141),C(1," Trade symbol is required "),y())}function Aoe(t,n){t&1&&(v(0,"div",141),C(1," Please select trade direction "),y())}function Roe(t,n){t&1&&(v(0,"div",141),C(1," Time frame selection is required "),y())}function Moe(t,n){t&1&&(v(0,"div",141),C(1," Please select an analysis type "),y())}function Foe(t,n){t&1&&(v(0,"div",141),C(1," Strategy name is required "),y())}function Ooe(t,n){t&1&&(v(0,"div",141),C(1," Order type is required "),y())}function Poe(t,n){t&1&&(v(0,"div",141),C(1," Entry criteria is required (min 10 characters) "),y())}function Loe(t,n){t&1&&(v(0,"div",141),C(1," Exit strategy is required (min 10 characters) "),y())}function $oe(t,n){t&1&&(v(0,"div",141),C(1," Valid account balance is required "),y())}function Voe(t,n){t&1&&(v(0,"div",141),C(1," Position size is required "),y())}function Boe(t,n){t&1&&(v(0,"div",141),C(1," Valid entry price is required "),y())}function zoe(t,n){t&1&&(v(0,"div",141),C(1," Entry date/time is required "),y())}function Uoe(t,n){t&1&&(v(0,"div",141),C(1," Stop loss price is required "),y())}function joe(t,n){t&1&&(v(0,"div",141),C(1," Take profit price is required "),y())}function Goe(t,n){t&1&&(v(0,"div",141),C(1," Risk percentage is required "),y())}function Woe(t,n){t&1&&(v(0,"div",142),z(1,"i",143),C(2," Risk exceeds recommended 2% "),y())}function Hoe(t,n){t&1&&(v(0,"div",141),C(1," Estimated reward is required "),y())}function qoe(t,n){t&1&&(v(0,"div",141),C(1," Please select your emotional state "),y())}function Koe(t,n){t&1&&(v(0,"div",142),z(1,"i",143),C(2," Consider if this emotional state might negatively impact your decision making "),y())}function Xoe(t,n){t&1&&(v(0,"div",144),C(1," Please rate your confidence "),y())}function Yoe(t,n){t&1&&(v(0,"div",141),C(1," Please identify potential biases (min 5 characters) "),y())}function Zoe(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Setup"),y())}function Qoe(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Strategy Details"),y())}function Joe(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Risk Management"),y())}function eie(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Psychological Analysis"),y())}function tie(t,n){if(t&1&&(v(0,"div",145),z(1,"i",146),v(2,"strong"),C(3,"Please fix the errors highlighted above before submitting."),y(),v(4,"ul",147),te(5,Zoe,2,0,"li",148)(6,Qoe,2,0,"li",148)(7,Joe,2,0,"li",148)(8,eie,2,0,"li",148),y()()),t&2){let e=Y();O(5),U("ngIf",e.hasErrors("tradeSetup")),O(),U("ngIf",e.hasErrors("strategyDetails")),O(),U("ngIf",e.hasErrors("riskManagement")),O(),U("ngIf",e.hasErrors("psychologicalAnalysis"))}}function nie(t,n){if(t&1){let e=et();v(0,"button",149),ae("click",function(){me(e);let o=Y();return he(o.onCancel())}),z(1,"i",150),C(2,"Cancel "),y()}}function rie(t,n){if(t&1&&(v(0,"div",151),z(1,"i",152),C(2),y()),t&2){let e=Y();O(2),$e("",e.message," ")}}function oie(t,n){if(t&1&&(v(0,"div",153),z(1,"i",146),C(2),y()),t&2){let e=Y();O(2),$e("",e.errorMessage," ")}}var Ef=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r}tradeLogData=null;formSubmitted=new Ot;cancel=new Ot;preTradeTableName="pretrade";postTradeTableName="posttrade";preTradeForm;postTradeForm;showEmotionalSection=!1;message="";errorMessage="";formSubmitMarker=!1;ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=sd();this.preTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[this.tradeLogData?.createdtime??new Date().toISOString()],accountname:[this.tradeLogData?.accountname??"",Ee.required],instrumenttype:[this.tradeLogData?.instrumenttype??"",Ee.required],analysistype:[this.tradeLogData?.analysistype??"",Ee.required],tradesymbol:[this.tradeLogData?.tradesymbol??"",Ee.required],tradetype:[this.tradeLogData?.tradetype??"Long",Ee.required],timeframe:[this.tradeLogData?.timeframe??"Day",Ee.required],strategyname:[this.tradeLogData?.strategyname??""],typeoforder:[this.tradeLogData?.typeoforder??"",Ee.required],entrycriteria:[this.tradeLogData?.entrycriteria??""],exitstrategy:[this.tradeLogData?.exitstrategy??""],entrydatetime:[this.tradeLogData?.entrydatetime??""],entryprice:[this.tradeLogData?.entryprice??""],accountbalance:[this.tradeLogData?.accountbalance??null,[Ee.required,Ee.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",Ee.required],estimatedrisk:[this.tradeLogData?.estimatedrisk??null,Ee.required],estimatedpnl:[this.tradeLogData?.estimatedpnl??null,Ee.required],estimatedstoploss:[this.tradeLogData?.estimatedstoploss??null,Ee.required],estimatedtakeprofit:[this.tradeLogData?.estimatedtakeprofit??null,Ee.required],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],tradeconfidence:[this.tradeLogData?.tradeconfidence??"1"],isopen:!0,emotionalstatebefore:[this.tradeLogData?.emotionalstatebefore??"",Ee.required],potentialbiases:[this.tradeLogData?.potentialbiases??"",Ee.required],notes:[this.tradeLogData?.notes??""],updatedtime:[new Date().toISOString()]})}toggleEmotionalSection(){this.showEmotionalSection=!this.showEmotionalSection}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.preTradeForm.patchValue({setupscreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.preTradeForm.invalid){this.preTradeForm.markAllAsTouched();return}let n=this.preTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.preTradeTableName):await this.supabaseService.addTradeLog(n,this.preTradeTableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.preTradeForm.reset(),this.preTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.preTradeTableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateFormProgress(){let e=0;return this.preTradeForm.get("accountname")?.valid&&e++,this.preTradeForm.get("instrumenttype")?.valid&&e++,this.preTradeForm.get("tradesymbol")?.valid&&e++,this.preTradeForm.get("tradetype")?.valid&&e++,this.preTradeForm.get("timeframe")?.valid&&e++,this.preTradeForm.get("analysistype")?.valid&&e++,this.preTradeForm.get("strategyname")?.valid&&e++,this.preTradeForm.get("typeoforder")?.valid&&e++,this.preTradeForm.get("entrycriteria")?.valid&&e++,this.preTradeForm.get("exitstrategy")?.valid&&e++,this.preTradeForm.get("accountbalance")?.valid&&e++,this.preTradeForm.get("positionsize")?.valid&&e++,this.preTradeForm.get("entryprice")?.valid&&e++,this.preTradeForm.get("entrydatetime")?.valid&&e++,this.preTradeForm.get("estimatedstoploss")?.valid&&e++,this.preTradeForm.get("estimatedtakeprofit")?.valid&&e++,this.preTradeForm.get("estimatedrisk")?.valid&&e++,this.preTradeForm.get("estimatedpnl")?.valid&&e++,this.preTradeForm.get("emotionalstatebefore")?.valid&&e++,this.preTradeForm.get("tradeConfidence")?.valid&&e++,this.preTradeForm.get("potentialbiases")?.valid&&e++,Math.round(e/18*100)}calculateRiskRewardRatio(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?"N/A":`1:${(e/n).toFixed(2)}`}isGoodRiskReward(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?!1:e/n>=2}isNegativeEmotionalState(){let n=this.preTradeForm.get("emotionalstatebefore")?.value;return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}hasErrors(n){switch(n){case"tradeSetup":return this.preTradeForm.get("accountname")?.invalid||this.preTradeForm.get("instrumenttype")?.invalid||this.preTradeForm.get("tradesymbol")?.invalid||this.preTradeForm.get("tradetype")?.invalid||this.preTradeForm.get("timeframe")?.invalid||this.preTradeForm.get("analysistype")?.invalid||!1;case"strategyDetails":return this.preTradeForm.get("strategyname")?.invalid||this.preTradeForm.get("typeoforder")?.invalid||this.preTradeForm.get("entrycriteria")?.invalid||this.preTradeForm.get("exitstrategy")?.invalid||!1;case"riskManagement":return this.preTradeForm.get("accountbalance")?.invalid||this.preTradeForm.get("positionsize")?.invalid||this.preTradeForm.get("entryprice")?.invalid||this.preTradeForm.get("entrydatetime")?.invalid||this.preTradeForm.get("estimatedstoploss")?.invalid||this.preTradeForm.get("estimatedtakeprofit")?.invalid||this.preTradeForm.get("estimatedrisk")?.invalid||this.preTradeForm.get("estimatedpnl")?.invalid||!1;case"psychologicalAnalysis":return this.preTradeForm.get("emotionalstatebefore")?.invalid||this.preTradeForm.get("tradeConfidence")?.invalid||this.preTradeForm.get("potentialbiases")?.invalid||!1;default:return!1}}static \u0275fac=function(e){return new(e||t)(ne(ei),ne(kt),ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-pre-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:332,vars:40,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],[3,"click"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","entrycriteria",1,"form-label"],["id","entrycriteria","formControlName","entrycriteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)","rows","3",1,"form-control"],[1,"form-text"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Define your profit targets and stop loss levels","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],["type","button","data-bs-toggle","tooltip","title","Calculate based on risk",1,"btn","btn-outline-secondary"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Planned entry price",1,"form-control"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","estimatedstoploss",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedstoploss","formControlName","estimatedstoploss","placeholder","Stop loss price level",1,"form-control"],["for","estimatedtakeprofit",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedtakeprofit","formControlName","estimatedtakeprofit","placeholder","Target price level",1,"form-control"],[1,"mb-3"],[1,"col-md-4"],["for","estimatedrisk",1,"form-label"],["type","number","step","0.01","min","0","max","100","id","estimatedrisk","formControlName","estimatedrisk","placeholder","1-2% recommended",1,"form-control"],["class","text-warning mt-1 small",4,"ngIf"],["for","estimatedpnl",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedpnl","formControlName","estimatedpnl","placeholder","Expected % gain",1,"form-control"],[1,"form-label"],["type","text","readonly","",1,"form-control","bg-light",3,"value"],[1,"form-text",3,"ngClass"],[1,"bi","bi-5-circle","me-2"],["for","emotionalstatebefore",1,"form-label"],["id","emotionalstatebefore","formControlName","emotionalstatebefore",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],[1,"form-label","d-block"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","tradeconfidence","id","confidence1","value","1",1,"btn-check"],["for","confidence1",1,"btn","btn-outline-danger"],["type","radio","formControlName","tradeconfidence","id","confidence2","value","2",1,"btn-check"],["for","confidence2",1,"btn","btn-outline-warning"],["type","radio","formControlName","tradeconfidence","id","confidence3","value","3",1,"btn-check"],["for","confidence3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","tradeconfidence","id","confidence4","value","4",1,"btn-check"],["for","confidence4",1,"btn","btn-outline-primary"],["type","radio","formControlName","tradeconfidence","id","confidence5","value","5",1,"btn-check"],["for","confidence5",1,"btn","btn-outline-success"],[1,"form-text","text-center","mt-1"],["class","text-danger mt-1 small text-center",4,"ngIf"],["for","potentialbiases",1,"form-label"],["id","potentialbiases","formControlName","potentialbiases","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO, overconfidence)","rows","3",1,"form-control"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"text-warning","mt-1","small"],[1,"bi","bi-exclamation-triangle"],[1,"text-danger","mt-1","small","text-center"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),ae("click",function(){return r.onCancel()}),C(8,"Pre-Trade Logs"),y()(),v(9,"li",6),C(10,"Pre-Trading Journal"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),C(14),y(),v(15,"p",10),C(16,"Document your strategy before entering positions to maintain discipline and clarity"),y()(),v(17,"div",11),te(18,Soe,2,2,"div",12)(19,Toe,2,1,"span",13),y()(),v(20,"form",14),ae("ngSubmit",function(){return r.onSubmit()}),v(21,"div",15)(22,"div",16)(23,"h5",17),z(24,"i",18),C(25,"Trade Setup "),y(),v(26,"span",19),C(27,"Required"),y()(),v(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),C(32,"Account Name"),y(),v(33,"div",24)(34,"span",25),z(35,"i",26),y(),z(36,"input",27),y(),te(37,Doe,2,0,"div",28),y(),v(38,"div",22)(39,"label",29),C(40,"Instrument Type"),y(),v(41,"select",30)(42,"option",31),C(43,"Choose instrument type"),y(),v(44,"option",32),C(45,"Forex"),y(),v(46,"option",33),C(47,"Stocks"),y(),v(48,"option",34),C(49,"Futures"),y(),v(50,"option",35),C(51,"Crypto"),y(),v(52,"option",36),C(53,"Options"),y(),v(54,"option",37),C(55,"ETF"),y(),v(56,"option",38),C(57,"Other"),y()(),te(58,Noe,2,0,"div",28),y(),v(59,"div",22)(60,"label",39),C(61,"Trade Symbol"),y(),v(62,"div",24)(63,"span",25),z(64,"i",40),y(),z(65,"input",41),y(),te(66,koe,2,0,"div",28),y(),v(67,"div",22)(68,"label",42),C(69,"Trade Direction"),y(),v(70,"div",43),z(71,"input",44),v(72,"label",45),C(73,"Long"),y(),z(74,"input",46),v(75,"label",47),C(76,"Short"),y()(),te(77,Aoe,2,0,"div",28),y(),v(78,"div",22)(79,"label",48),C(80,"Time Frame"),y(),v(81,"select",49)(82,"option",31),C(83,"Select time frame"),y(),v(84,"option",50),C(85,"Scalp (minutes)"),y(),v(86,"option",51),C(87,"Day Trade (hours)"),y(),v(88,"option",52),C(89,"Swing (days-weeks)"),y(),v(90,"option",53),C(91,"Position (weeks-months)"),y(),v(92,"option",54),C(93,"Long Term (months+)"),y()(),te(94,Roe,2,0,"div",28),y(),v(95,"div",22)(96,"label",55),C(97,"Analysis Type"),y(),v(98,"select",56)(99,"option",31),C(100,"Choose analysis method"),y(),v(101,"option",57),C(102,"Technical"),y(),v(103,"option",58),C(104,"Fundamental"),y(),v(105,"option",59),C(106,"Both"),y(),v(107,"option",60),C(108,"Sentiment"),y(),v(109,"option",38),C(110,"Other"),y()(),te(111,Moe,2,0,"div",28),y()()()(),v(112,"div",15)(113,"div",16)(114,"h5",17),z(115,"i",61),C(116,"Strategy Details "),y(),v(117,"span",19),C(118,"Required"),y()(),v(119,"div",20)(120,"div",21)(121,"div",22)(122,"label",62),C(123,"Strategy Name"),y(),z(124,"input",63),te(125,Foe,2,0,"div",28),y(),v(126,"div",22)(127,"label",64),C(128,"Type of Order"),y(),v(129,"select",65)(130,"option",31),C(131,"Choose order type"),y(),v(132,"option",66),C(133,"Market"),y(),v(134,"option",67),C(135,"Limit"),y(),v(136,"option",68),C(137,"Stop"),y(),v(138,"option",69),C(139,"Stop Limit"),y(),v(140,"option",70),C(141,"Trailing Stop"),y()(),te(142,Ooe,2,0,"div",28),y(),v(143,"div",71)(144,"label",72),C(145,"Entry Criteria "),v(146,"span",10),C(147,"(Why are you taking this trade?)"),y()(),z(148,"textarea",73),v(149,"div",74),C(150,"Be specific about what signals or conditions must be met for entry."),y(),te(151,Poe,2,0,"div",28),y(),v(152,"div",71)(153,"label",75),C(154,"Exit Strategy "),v(155,"span",10),C(156,"(How will you close this position?)"),y()(),z(157,"textarea",76),v(158,"div",74),C(159,"Include both profit-taking and loss-cutting criteria."),y(),te(160,Loe,2,0,"div",28),y()()()(),v(161,"div",15)(162,"div",16)(163,"h5",17),z(164,"i",77),C(165,"Risk Management "),y(),v(166,"span",19),C(167,"Required"),y()(),v(168,"div",20)(169,"div",21)(170,"div",22)(171,"label",78),C(172,"Account Balance"),y(),v(173,"div",24)(174,"span",25),C(175,"$"),y(),z(176,"input",79),y(),te(177,$oe,2,0,"div",28),y(),v(178,"div",22)(179,"label",80),C(180,"Position Size"),y(),v(181,"div",24),z(182,"input",81),v(183,"button",82),C(184,"Calculate"),y()(),te(185,Voe,2,0,"div",28),y(),v(186,"div",22)(187,"label",83),C(188,"Entry Price"),y(),v(189,"div",24)(190,"span",25),C(191,"$"),y(),z(192,"input",84),y(),te(193,Boe,2,0,"div",28),y(),v(194,"div",22)(195,"label",85),C(196,"Entry Date/Time"),y(),z(197,"input",86),te(198,zoe,2,0,"div",28),y(),v(199,"div",22)(200,"label",87),C(201,"Stop Loss Price"),y(),v(202,"div",24)(203,"span",25),C(204,"$"),y(),z(205,"input",88),y(),te(206,Uoe,2,0,"div",28),y(),v(207,"div",22)(208,"label",89),C(209,"Take Profit Price"),y(),v(210,"div",24)(211,"span",25),C(212,"$"),y(),z(213,"input",90),y(),te(214,joe,2,0,"div",28),y(),v(215,"div",71),z(216,"hr"),v(217,"h6",91),C(218,"Risk/Reward Analysis"),y()(),v(219,"div",92)(220,"label",93),C(221,"Risk Per Trade"),y(),v(222,"div",24),z(223,"input",94),v(224,"span",25),C(225,"%"),y()(),v(226,"div",74),C(227,"Percentage of account at risk"),y(),te(228,Goe,2,0,"div",28)(229,Woe,3,0,"div",95),y(),v(230,"div",92)(231,"label",96),C(232,"Estimated Reward"),y(),v(233,"div",24),z(234,"input",97),v(235,"span",25),C(236,"%"),y()(),te(237,Hoe,2,0,"div",28),y(),v(238,"div",92)(239,"label",98),C(240,"Risk/Reward Ratio"),y(),v(241,"div",24),z(242,"input",99),v(243,"span",25),C(244,"R:R"),y()(),v(245,"div",100),z(246,"i"),C(247),y()()()()(),v(248,"div",15)(249,"div",16)(250,"h5",17),z(251,"i",101),C(252,"Psychological Analysis "),y(),v(253,"span",19),C(254,"Required"),y()(),v(255,"div",20)(256,"div",21)(257,"div",22)(258,"label",102),C(259,"Current Emotional State"),y(),v(260,"select",103)(261,"option",31),C(262,"How are you feeling?"),y(),v(263,"option",104),C(264,"Calm & Focused"),y(),v(265,"option",105),C(266,"Excited"),y(),v(267,"option",106),C(268,"Anxious"),y(),v(269,"option",107),C(270,"Frustrated"),y(),v(271,"option",108),C(272,"Overconfident"),y(),v(273,"option",109),C(274,"Fearful"),y(),v(275,"option",110),C(276,"Neutral"),y(),v(277,"option",38),C(278,"Other"),y()(),te(279,qoe,2,0,"div",28)(280,Koe,3,0,"div",95),y(),v(281,"div",22)(282,"label",111),C(283,"Trading Confidence"),y(),v(284,"div",112),z(285,"input",113),v(286,"label",114),C(287,"1"),y(),z(288,"input",115),v(289,"label",116),C(290,"2"),y(),z(291,"input",117),v(292,"label",118),C(293,"3"),y(),z(294,"input",119),v(295,"label",120),C(296,"4"),y(),z(297,"input",121),v(298,"label",122),C(299,"5"),y()(),v(300,"div",123),C(301,"Low (1) to High (5)"),y(),te(302,Xoe,2,0,"div",124),y(),v(303,"div",71)(304,"label",125),C(305,"Potential Biases"),y(),z(306,"textarea",126),v(307,"div",74),C(308,"Identifying biases helps improve future decision making"),y(),te(309,Yoe,2,0,"div",28),y()()()(),v(310,"div",15)(311,"div",16)(312,"h5",17),z(313,"i",127),C(314,"Additional Notes "),y(),v(315,"span",128),C(316,"Optional"),y()(),v(317,"div",20)(318,"div",21)(319,"div",71)(320,"label",129),C(321,"Notes"),y(),z(322,"textarea",130),y()()()(),te(323,tie,9,4,"div",131),v(324,"div",132),te(325,nie,3,0,"button",133),v(326,"div")(327,"button",134),z(328,"i",135),C(329),y()()(),te(330,rie,3,1,"div",136)(331,oie,3,1,"div",137),y()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,x,b,I,_,E,S,D,M,R;O(14),tt(r.tradeLogData?"Edit Pre-Trading Journal":"Create Pre-Trading Journal"),O(4),U("ngIf",!r.tradeLogData),O(),U("ngIf",!r.tradeLogData),O(),U("formGroup",r.preTradeForm),O(17),U("ngIf",((o=r.preTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.preTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.preTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),O(21),U("ngIf",((i=r.preTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.preTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.preTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),O(8),U("ngIf",((s=r.preTradeForm.get("tradesymbol"))==null?null:s.invalid)&&(((s=r.preTradeForm.get("tradesymbol"))==null?null:s.dirty)||((s=r.preTradeForm.get("tradesymbol"))==null?null:s.touched)||r.formSubmitMarker)),O(11),U("ngIf",((a=r.preTradeForm.get("tradetype"))==null?null:a.invalid)&&(((a=r.preTradeForm.get("tradetype"))==null?null:a.dirty)||((a=r.preTradeForm.get("tradetype"))==null?null:a.touched)||r.formSubmitMarker)),O(17),U("ngIf",((l=r.preTradeForm.get("timeframe"))==null?null:l.invalid)&&(((l=r.preTradeForm.get("timeframe"))==null?null:l.dirty)||((l=r.preTradeForm.get("timeframe"))==null?null:l.touched)||r.formSubmitMarker)),O(17),U("ngIf",((c=r.preTradeForm.get("analysistype"))==null?null:c.invalid)&&(((c=r.preTradeForm.get("analysistype"))==null?null:c.dirty)||((c=r.preTradeForm.get("analysistype"))==null?null:c.touched)||r.formSubmitMarker)),O(14),U("ngIf",((u=r.preTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.preTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.preTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),O(17),U("ngIf",((d=r.preTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.preTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.preTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),O(9),U("ngIf",((p=r.preTradeForm.get("entrycriteria"))==null?null:p.invalid)&&(((p=r.preTradeForm.get("entrycriteria"))==null?null:p.dirty)||((p=r.preTradeForm.get("entrycriteria"))==null?null:p.touched)||r.formSubmitMarker)),O(9),U("ngIf",((f=r.preTradeForm.get("exitstrategy"))==null?null:f.invalid)&&(((f=r.preTradeForm.get("exitstrategy"))==null?null:f.dirty)||((f=r.preTradeForm.get("exitstrategy"))==null?null:f.touched)||r.formSubmitMarker)),O(17),U("ngIf",((m=r.preTradeForm.get("accountbalance"))==null?null:m.invalid)&&(((m=r.preTradeForm.get("accountbalance"))==null?null:m.dirty)||((m=r.preTradeForm.get("accountbalance"))==null?null:m.touched)||r.formSubmitMarker)),O(8),U("ngIf",((h=r.preTradeForm.get("positionsize"))==null?null:h.invalid)&&(((h=r.preTradeForm.get("positionsize"))==null?null:h.dirty)||((h=r.preTradeForm.get("positionsize"))==null?null:h.touched)||r.formSubmitMarker)),O(8),U("ngIf",((g=r.preTradeForm.get("entryprice"))==null?null:g.invalid)&&(((g=r.preTradeForm.get("entryprice"))==null?null:g.dirty)||((g=r.preTradeForm.get("entryprice"))==null?null:g.touched)||r.formSubmitMarker)),O(5),U("ngIf",((x=r.preTradeForm.get("entrydatetime"))==null?null:x.invalid)&&(((x=r.preTradeForm.get("entrydatetime"))==null?null:x.dirty)||((x=r.preTradeForm.get("entrydatetime"))==null?null:x.touched)||r.formSubmitMarker)),O(8),U("ngIf",((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.invalid)&&(((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.dirty)||((b=r.preTradeForm.get("estimatedstoploss"))==null?null:b.touched)||r.formSubmitMarker)),O(8),U("ngIf",((I=r.preTradeForm.get("estimatedtakeprofit"))==null?null:I.invalid)&&(((I=r.preTradeForm.get("estimatedtakeprofit"))==null?null:I.dirty)||((I=r.preTradeForm.get("estimatedtakeprofit"))==null?null:I.touched)||r.formSubmitMarker)),O(14),U("ngIf",((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.invalid)&&(((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.dirty)||((_=r.preTradeForm.get("estimatedrisk"))==null?null:_.touched)||r.formSubmitMarker)),O(),U("ngIf",((E=r.preTradeForm.get("estimatedrisk"))==null?null:E.value)>2),O(8),U("ngIf",((S=r.preTradeForm.get("estimatedpnl"))==null?null:S.invalid)&&(((S=r.preTradeForm.get("estimatedpnl"))==null?null:S.dirty)||((S=r.preTradeForm.get("estimatedpnl"))==null?null:S.touched)||r.formSubmitMarker)),O(5),U("value",r.calculateRiskRewardRatio()),O(3),U("ngClass",is(37,Eoe,r.isGoodRiskReward(),!r.isGoodRiskReward())),O(),ex(r.isGoodRiskReward()?"bi bi-check-circle":"bi bi-x-circle"),O(),$e(" ",r.isGoodRiskReward()?"Good risk/reward ratio":"Risk/reward should be at least 1:2"," "),O(32),U("ngIf",((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.invalid)&&(((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.dirty)||((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.touched)||r.formSubmitMarker)),O(),U("ngIf",r.isNegativeEmotionalState()),O(22),U("ngIf",((M=r.preTradeForm.get("tradeconfidence"))==null?null:M.invalid)&&(((M=r.preTradeForm.get("tradeconfidence"))==null?null:M.dirty)||((M=r.preTradeForm.get("tradeconfidence"))==null?null:M.touched)||r.formSubmitMarker)),O(7),U("ngIf",((R=r.preTradeForm.get("potentialbiases"))==null?null:R.invalid)&&(((R=r.preTradeForm.get("potentialbiases"))==null?null:R.dirty)||((R=r.preTradeForm.get("potentialbiases"))==null?null:R.touched)||r.formSubmitMarker)),O(14),U("ngIf",r.formSubmitMarker&&r.preTradeForm.invalid),O(2),U("ngIf",r.tradeLogData),O(4),$e("",r.tradeLogData?"Update":"Submit"," "),O(),U("ngIf",r.message),O(),U("ngIf",r.errorMessage)}},dependencies:[Pt,Yo,Ht,fo,uo,ps,fs,Pn,aa,ds,la,er,co,Xg,eD,po,Ro,Fn],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function iie(t,n){t&1&&(v(0,"div",12),C(1,"Loading trade logs..."),y())}function sie(t,n){if(t&1&&(v(0,"div",13),C(1),y()),t&2){let e=Y();O(),tt(e.errorMessage)}}function aie(t,n){if(t&1){let e=et();v(0,"div",16)(1,"div",17),ae("click",function(){let o=me(e).$implicit,i=Y(2);return he(i.openEditModal(o))}),v(2,"div",18),z(3,"i",19),C(4," Planned "),y(),v(5,"div",20),ae("click",function(o){let i=me(e).$implicit,s=Y(2);return he(s.onDeleteTradeLog(i,o))}),z(6,"i",21),y(),v(7,"div",22)(8,"h4",23),C(9),y(),v(10,"h5",24),C(11),y(),v(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),C(16,"Analysis:"),y(),C(17),y(),v(18,"div",27)(19,"strong"),C(20,"Order:"),y(),C(21),y()(),v(22,"div",26)(23,"div",27)(24,"strong"),C(25,"Stop Loss:"),y(),C(26),y(),v(27,"div",27)(28,"strong"),C(29,"Take Profit:"),y(),C(30),y()(),v(31,"div",26)(32,"div",27)(33,"strong"),C(34,"Risk:"),y(),C(35),y(),v(36,"div",27)(37,"strong"),C(38,"Est. PnL:"),y(),C(39),y()(),v(40,"div",28)(41,"div",29)(42,"strong"),C(43,"Account:"),y(),C(44),y()()(),v(45,"div",30)(46,"small",31),C(47),Ni(48,"date"),y()()()()()}if(t&2){let e=n.$implicit;O(9),tt(e.tradesymbol),O(2),Uu(" ",e.tradetype," | ",e.instrumenttype," "),O(6),$e(" ",e.analysistype," "),O(4),$e(" ",e.typeoforder," "),O(5),$e(" ",e.estimatedstoploss," "),O(4),$e(" ",e.estimatedtakeprofit," "),O(5),$e(" ",e.estimatedrisk," "),O(4),$e(" ",e.estimatedpnl," "),O(5),$e(" ",e.accountname," "),O(3),tt(ki(48,11,e.createdtime,"medium"))}}function lie(t,n){if(t&1&&(v(0,"div",14),te(1,aie,49,14,"div",15),y()),t&2){let e=Y();O(),U("ngForOf",e.tradeLogs)}}function cie(t,n){t&1&&(v(0,"div",32),C(1," No trade logs found. "),y())}function uie(t,n){if(t&1){let e=et();v(0,"div",33),ae("click",function(o){me(e);let i=Y();return he(i.closeModalOnOverlayClick(o))}),v(1,"div",34),ae("click",function(o){return me(e),he(o.stopPropagation())}),v(2,"app-pre-trade-log",35),ae("formSubmitted",function(){me(e);let o=Y();return he(o.onFormSubmitted())})("cancel",function(){me(e);let o=Y();return he(o.closeModal())}),y()()()}if(t&2){let e=Y();O(2),U("tradeLogData",e.selectedTradeLog)}}var _b=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="pretrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName)}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(ne(kt),ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-pre-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/pretradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click"],[1,"trade-status-indicator","status-planned"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Pre-Trade Logs"),y(),v(8,"li",3)(9,"a",6),C(10,"Pre-Trading Journal"),y()()()(),v(11,"h2"),C(12,"Pre Trade Logs"),y(),te(13,iie,2,0,"div",7)(14,sie,2,1,"div",8)(15,lie,2,1,"div",9)(16,cie,2,0,"div",10),y(),te(17,uie,3,1,"div",11)),e&2&&(O(13),U("ngIf",r.loading),O(),U("ngIf",r.errorMessage),O(),U("ngIf",r.tradeLogs&&r.tradeLogs.length),O(),U("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),O(),U("ngIf",r.showModal))},dependencies:[Fn,Pt,Jn,Ht,as,Ef],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease;border-left:4px solid #6c757d!important}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-planned[_ngcontent-%COMP%]{background-color:#6c757d}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0})};function die(t,n){if(t&1&&(v(0,"div",131),z(1,"div",132),y()),t&2){let e=Y();O(),Hp("width",e.calculateFormProgress()+"%")}}function pie(t,n){if(t&1&&(v(0,"span",133),C(1),y()),t&2){let e=Y();O(),$e("",e.calculateFormProgress(),"% Complete")}}function fie(t,n){t&1&&(v(0,"div",134),C(1," Account name is required "),y())}function mie(t,n){t&1&&(v(0,"div",134),C(1," Please select an instrument type "),y())}function hie(t,n){t&1&&(v(0,"div",134),C(1," Please select an analysis type "),y())}function gie(t,n){t&1&&(v(0,"div",134),C(1," Trade symbol is required "),y())}function yie(t,n){t&1&&(v(0,"div",134),C(1," Please select trade direction "),y())}function vie(t,n){t&1&&(v(0,"div",134),C(1," Time frame selection is required "),y())}function xie(t,n){t&1&&(v(0,"div",134),C(1," Strategy name is required "),y())}function bie(t,n){t&1&&(v(0,"div",134),C(1," Order type is required "),y())}function wie(t,n){t&1&&(v(0,"div",134),C(1," Entry date/time is required "),y())}function Cie(t,n){t&1&&(v(0,"div",134),C(1," Exit date/time is required "),y())}function _ie(t,n){t&1&&(v(0,"div",134),C(1," Valid entry price is required "),y())}function Iie(t,n){t&1&&(v(0,"div",134),C(1," Valid exit price is required "),y())}function Eie(t,n){t&1&&(v(0,"div",134),C(1," Position size is required "),y())}function Sie(t,n){t&1&&(v(0,"div",134),C(1," Please select trade outcome "),y())}function Tie(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Details"),y())}function Die(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Strategy Information"),y())}function Nie(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Execution"),y())}function kie(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Trade Outcome"),y())}function Aie(t,n){t&1&&(v(0,"li"),C(1,"Complete all required fields in Post-Trade Analysis"),y())}function Rie(t,n){if(t&1&&(v(0,"div",135),z(1,"i",136),v(2,"strong"),C(3,"Please fix the errors highlighted above before submitting."),y(),v(4,"ul",137),te(5,Tie,2,0,"li",138)(6,Die,2,0,"li",138)(7,Nie,2,0,"li",138)(8,kie,2,0,"li",138)(9,Aie,2,0,"li",138),y()()),t&2){let e=Y();O(5),U("ngIf",e.hasErrors("tradeDetails")),O(),U("ngIf",e.hasErrors("strategyInformation")),O(),U("ngIf",e.hasErrors("tradeExecution")),O(),U("ngIf",e.hasErrors("tradeOutcome")),O(),U("ngIf",e.hasErrors("postTradeAnalysis"))}}function Mie(t,n){if(t&1){let e=et();v(0,"button",139),ae("click",function(){me(e);let o=Y();return he(o.onCancel())}),z(1,"i",140),C(2,"Cancel "),y()}}function Fie(t,n){if(t&1&&(v(0,"div",141),z(1,"i",142),C(2),y()),t&2){let e=Y();O(2),$e("",e.message," ")}}function Oie(t,n){if(t&1&&(v(0,"div",143),z(1,"i",136),C(2),y()),t&2){let e=Y();O(2),$e("",e.errorMessage," ")}}var Sf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabaseService=r}tradeLogData=null;formSubmitted=new Ot;cancel=new Ot;tableName="posttrade";postTradeForm;message="";errorMessage="";formSubmitMarker=!1;tradeOutcomes=["Win","Loss","Breakeven"];tradeDirections=["Long","Short"];ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=sd();this.postTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[new Date().toISOString(),Ee.required],accountname:[this.tradeLogData?.accountname,[Ee.required,Ee.maxLength(255)]],accountbalance:[this.tradeLogData?.accountbalance??""],instrumenttype:[this.tradeLogData?.instrumenttype??"",[Ee.required,Ee.maxLength(50)]],analysistype:[this.tradeLogData?.analysistype??"",[Ee.required,Ee.maxLength(100)]],tradesymbol:[this.tradeLogData?.tradesymbol??"",[Ee.required,Ee.maxLength(50)]],tradetype:[this.tradeLogData?.tradetype??"",[Ee.required,Ee.maxLength(50)]],timeframe:[this.tradeLogData?.timeframe??"",[Ee.required,Ee.maxLength(50)]],entrydatetime:[this.tradeLogData?.entrydatetime??"",Ee.required],strategyname:[this.tradeLogData?.strategyname??"",[Ee.required,Ee.maxLength(255)]],typeoforder:[this.tradeLogData?.typeoforder??"",[Ee.required,Ee.maxLength(50)]],exitstrategy:[this.tradeLogData?.exitstrategy??""],entryprice:[this.tradeLogData?.entryprice??"",[Ee.required,Ee.min(0)]],exitprice:[this.tradeLogData?.exitprice??"",[Ee.required,Ee.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",[Ee.required,Ee.maxLength(50)]],exitdatetime:[this.tradeLogData?.exitdatetime??"",Ee.required],tradeoutcome:[this.tradeLogData?.tradeoutcome??"",Ee.required],profitlossamount:[this.tradeLogData?.profitlossamount??""],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],emotionalstateafter:[this.tradeLogData?.emotionalstateafter??""],emotionalimpactondecision:[this.tradeLogData?.emotionalimpactondecision??""],whatwentwell:[this.tradeLogData?.whatwentwell??""],whatcouldimprove:[this.tradeLogData?.whatcouldimprove??""],notes:[this.tradeLogData?.notes??""],isopen:[this.tradeLogData?.isopen??!0,Ee.required],updatedtime:[new Date().toDateString(),Ee.required]})}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.postTradeForm.patchValue({setupScreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.postTradeForm.invalid){this.postTradeForm.markAllAsTouched();return}let n=this.postTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.tableName):await this.supabaseService.addTradeLog(n,this.tableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.postTradeForm.reset(),this.postTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.tableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateProfitLoss(){let n=this.postTradeForm.get("entryprice")?.value,e=this.postTradeForm.get("exitprice")?.value,r=parseFloat(this.postTradeForm.get("positionsize")?.value),o=this.postTradeForm.get("tradetype")?.value;if(n&&e&&r&&o){let i=0;o==="Long"?i=(e-n)*r:o==="Short"&&(i=(n-e)*r),this.postTradeForm.get("profitlossamount")?.setValue(i.toFixed(2)),i>0?this.postTradeForm.get("tradeoutcome")?.setValue("Win"):i<0?this.postTradeForm.get("tradeoutcome")?.setValue("Loss"):this.postTradeForm.get("tradeoutcome")?.setValue("Breakeven")}}calculateFormProgress(){let n=Object.keys(this.postTradeForm.controls).filter(r=>this.postTradeForm.get(r)?.validator!==null),e=n.filter(r=>this.postTradeForm.get(r)?.valid);return Math.round(e.length/n.length*100)}hasErrors(n){let e=!1,r={tradeDetails:["accountname","instrumenttype","analysistype","tradesymbol","tradetype","timeframe"],strategyInformation:["strategyname","typeoforder"],tradeExecution:["entrydatetime","exitdatetime","entryprice","exitprice","positionsize"],tradeOutcome:["tradeoutcome"],postTradeAnalysis:["emotionalstateafter","whatwentwell","whatcouldimprove"]};return r[n]&&r[n].forEach(o=>{this.postTradeForm.get(o)?.invalid&&(e=!0)}),e}static \u0275fac=function(e){return new(e||t)(ne(ei),ne(It),ne(kt))};static \u0275cmp=ht({type:t,selectors:[["app-post-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:299,vars:23,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["routerLink","/posttrades"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Describe the exit strategy you implemented","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","exitdatetime",1,"form-label"],["type","datetime-local","id","exitdatetime","formControlName","exitdatetime",1,"form-control"],[1,"col-md-4"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Actual entry price",1,"form-control"],["for","exitprice",1,"form-label"],["type","number","id","exitprice","formControlName","exitprice","step","0.01","min","0","placeholder","Actual exit price",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],[1,"bi","bi-4-circle","me-2"],["for","tradeoutcome",1,"form-label"],["role","group","aria-label","Trade outcome",1,"btn-group","w-100"],["type","radio","name","tradeoutcome","id","tradeoutcome_win","value","Win","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_win",1,"btn","btn-outline-success"],["type","radio","name","tradeoutcome","id","tradeoutcome_loss","value","Loss","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_loss",1,"btn","btn-outline-danger"],["type","radio","name","tradeoutcome","id","tradeoutcome_breakeven","value","Breakeven","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_breakeven",1,"btn","btn-outline-warning"],["for","profitlossamount",1,"form-label"],["type","number","step","0.01","id","profitlossamount","formControlName","profitlossamount","placeholder","e.g. 50.25 or -30.50",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-6-circle","me-2"],["for","emotionalstateafter",1,"form-label"],["id","emotionalstateafter","formControlName","emotionalstateafter",1,"form-select"],["value","Satisfied"],["value","Excited"],["value","Relieved"],["value","Disappointed"],["value","Frustrated"],["value","Neutral"],["value","Angry"],["for","emotionalimpactondecision",1,"form-label"],["id","emotionalimpactondecision","formControlName","emotionalimpactondecision","placeholder","How did your emotions affect your trading decisions?","rows","3",1,"form-control"],["for","whatwentwell",1,"form-label"],["id","whatwentwell","formControlName","whatwentwell","placeholder","What aspects of this trade did you execute correctly?","rows","3",1,"form-control"],["for","whatcouldimprove",1,"form-label"],["id","whatcouldimprove","formControlName","whatcouldimprove","placeholder","What could you have done better in this trade?","rows","3",1,"form-control"],["for","isopen",1,"form-label"],[1,"form-check","form-switch"],["type","checkbox","id","isopen","formControlName","isopen",1,"form-check-input"],["for","isopen",1,"form-check-label"],[1,"bi","bi-7-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-tr-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-tr-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),C(8,"Trade Logs"),y()(),v(9,"li",6),C(10,"Post-Trading Journal"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),C(14),y(),v(15,"p",10),C(16,"Document your completed trades to analyze performance and improve your strategy"),y()(),v(17,"div",11),te(18,die,2,2,"div",12)(19,pie,2,1,"span",13),y()(),v(20,"form",14),ae("ngSubmit",function(){return r.onSubmit()}),v(21,"div",15)(22,"div",16)(23,"h5",17),z(24,"i",18),C(25,"Trade Details "),y(),v(26,"span",19),C(27,"Required"),y()(),v(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),C(32,"Account Name"),y(),v(33,"div",24)(34,"span",25),z(35,"i",26),y(),z(36,"input",27),y(),te(37,fie,2,0,"div",28),y(),v(38,"div",22)(39,"label",29),C(40,"Account Balance"),y(),v(41,"div",24)(42,"span",25),C(43,"$"),y(),z(44,"input",30),y()(),v(45,"div",22)(46,"label",31),C(47,"Instrument Type"),y(),v(48,"select",32)(49,"option",33),C(50,"Choose instrument type"),y(),v(51,"option",34),C(52,"Forex"),y(),v(53,"option",35),C(54,"Stocks"),y(),v(55,"option",36),C(56,"Futures"),y(),v(57,"option",37),C(58,"Crypto"),y(),v(59,"option",38),C(60,"Options"),y(),v(61,"option",39),C(62,"ETF"),y(),v(63,"option",40),C(64,"Other"),y()(),te(65,mie,2,0,"div",28),y(),v(66,"div",22)(67,"label",41),C(68,"Analysis Type"),y(),v(69,"select",42)(70,"option",33),C(71,"Choose analysis method"),y(),v(72,"option",43),C(73,"Technical"),y(),v(74,"option",44),C(75,"Fundamental"),y(),v(76,"option",45),C(77,"Both"),y(),v(78,"option",46),C(79,"Sentiment"),y(),v(80,"option",40),C(81,"Other"),y()(),te(82,hie,2,0,"div",28),y(),v(83,"div",22)(84,"label",47),C(85,"Trade Symbol"),y(),v(86,"div",24)(87,"span",25),z(88,"i",48),y(),z(89,"input",49),y(),te(90,gie,2,0,"div",28),y(),v(91,"div",22)(92,"label",50),C(93,"Trade Direction"),y(),v(94,"div",51),z(95,"input",52),v(96,"label",53),C(97,"Long"),y(),z(98,"input",54),v(99,"label",55),C(100,"Short"),y()(),te(101,yie,2,0,"div",28),y(),v(102,"div",22)(103,"label",56),C(104,"Time Frame"),y(),v(105,"select",57)(106,"option",33),C(107,"Select time frame"),y(),v(108,"option",58),C(109,"Scalp (minutes)"),y(),v(110,"option",59),C(111,"Day Trade (hours)"),y(),v(112,"option",60),C(113,"Swing (days-weeks)"),y(),v(114,"option",61),C(115,"Position (weeks-months)"),y(),v(116,"option",62),C(117,"Long Term (months+)"),y()(),te(118,vie,2,0,"div",28),y()()()(),v(119,"div",15)(120,"div",16)(121,"h5",17),z(122,"i",63),C(123,"Strategy Information "),y(),v(124,"span",19),C(125,"Required"),y()(),v(126,"div",20)(127,"div",21)(128,"div",22)(129,"label",64),C(130,"Strategy Name"),y(),z(131,"input",65),te(132,xie,2,0,"div",28),y(),v(133,"div",22)(134,"label",66),C(135,"Type of Order"),y(),v(136,"select",67)(137,"option",33),C(138,"Choose order type"),y(),v(139,"option",68),C(140,"Market"),y(),v(141,"option",69),C(142,"Limit"),y(),v(143,"option",70),C(144,"Stop"),y(),v(145,"option",71),C(146,"Stop Limit"),y(),v(147,"option",72),C(148,"Trailing Stop"),y()(),te(149,bie,2,0,"div",28),y(),v(150,"div",73)(151,"label",74),C(152,"Exit Strategy Used"),y(),z(153,"textarea",75),y()()()(),v(154,"div",15)(155,"div",16)(156,"h5",17),z(157,"i",76),C(158,"Trade Execution "),y(),v(159,"span",19),C(160,"Required"),y()(),v(161,"div",20)(162,"div",21)(163,"div",22)(164,"label",77),C(165,"Entry Date/Time"),y(),z(166,"input",78),te(167,wie,2,0,"div",28),y(),v(168,"div",22)(169,"label",79),C(170,"Exit Date/Time"),y(),z(171,"input",80),te(172,Cie,2,0,"div",28),y(),v(173,"div",81)(174,"label",82),C(175,"Entry Price"),y(),v(176,"div",24)(177,"span",25),C(178,"$"),y(),z(179,"input",83),y(),te(180,_ie,2,0,"div",28),y(),v(181,"div",81)(182,"label",84),C(183,"Exit Price"),y(),v(184,"div",24)(185,"span",25),C(186,"$"),y(),z(187,"input",85),y(),te(188,Iie,2,0,"div",28),y(),v(189,"div",81)(190,"label",86),C(191,"Position Size"),y(),v(192,"div",24),z(193,"input",87),y(),te(194,Eie,2,0,"div",28),y()()()(),v(195,"div",15)(196,"div",16)(197,"h5",17),z(198,"i",88),C(199,"Trade Outcome "),y(),v(200,"span",19),C(201,"Required"),y()(),v(202,"div",20)(203,"div",21)(204,"div",22)(205,"label",89),C(206,"Trade Result"),y(),v(207,"div",90),z(208,"input",91),v(209,"label",92),C(210,"Win"),y(),z(211,"input",93),v(212,"label",94),C(213,"Loss"),y(),z(214,"input",95),v(215,"label",96),C(216,"Breakeven"),y()(),te(217,Sie,2,0,"div",28),y(),v(218,"div",22)(219,"label",97),C(220,"Profit/Loss Amount"),y(),v(221,"div",24)(222,"span",25),C(223,"$"),y(),z(224,"input",98),v(225,"button",99),ae("click",function(){return r.calculateProfitLoss()}),C(226," Calculate "),y()()()()()(),v(227,"div",15)(228,"div",16)(229,"h5",17),z(230,"i",100),C(231,"Post-Trade Analysis "),y(),v(232,"span",19),C(233,"Required"),y()(),v(234,"div",20)(235,"div",21)(236,"div",22)(237,"label",101),C(238,"Emotional State After Trade"),y(),v(239,"select",102)(240,"option",33),C(241,"How do you feel now?"),y(),v(242,"option",103),C(243,"Satisfied"),y(),v(244,"option",104),C(245,"Excited"),y(),v(246,"option",105),C(247,"Relieved"),y(),v(248,"option",106),C(249,"Disappointed"),y(),v(250,"option",107),C(251,"Frustrated"),y(),v(252,"option",108),C(253,"Neutral"),y(),v(254,"option",109),C(255,"Angry"),y(),v(256,"option",40),C(257,"Other"),y()()(),v(258,"div",73)(259,"label",110),C(260,"Emotional Impact on Decisions"),y(),z(261,"textarea",111),y(),v(262,"div",73)(263,"label",112),C(264,"What Went Well"),y(),z(265,"textarea",113),y(),v(266,"div",73)(267,"label",114),C(268,"Areas for Improvement"),y(),z(269,"textarea",115),y(),v(270,"div",22)(271,"label",116),C(272,"Trade Status"),y(),v(273,"div",117),z(274,"input",118),v(275,"label",119),C(276,"This position is still open"),y()()()()()(),v(277,"div",15)(278,"div",16)(279,"h5",17),z(280,"i",120),C(281,"Additional Notes "),y(),v(282,"span",121),C(283,"Optional"),y()(),v(284,"div",20)(285,"div",21)(286,"div",73)(287,"label",122),C(288,"Notes"),y(),z(289,"textarea",123),y()()()(),te(290,Rie,10,5,"div",124),v(291,"div",125),te(292,Mie,3,0,"button",126),v(293,"div")(294,"button",127),z(295,"i",128),C(296),y()()(),te(297,Fie,3,1,"div",129)(298,Oie,3,1,"div",130),y()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,x;O(14),tt(r.tradeLogData?"Edit Post-Trading Journal":"Create Post-Trading Journal"),O(4),U("ngIf",!r.tradeLogData),O(),U("ngIf",!r.tradeLogData),O(),U("formGroup",r.postTradeForm),O(17),U("ngIf",((o=r.postTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.postTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.postTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),O(28),U("ngIf",((i=r.postTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.postTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.postTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),O(17),U("ngIf",((s=r.postTradeForm.get("analysistype"))==null?null:s.invalid)&&(((s=r.postTradeForm.get("analysistype"))==null?null:s.dirty)||((s=r.postTradeForm.get("analysistype"))==null?null:s.touched)||r.formSubmitMarker)),O(8),U("ngIf",((a=r.postTradeForm.get("tradesymbol"))==null?null:a.invalid)&&(((a=r.postTradeForm.get("tradesymbol"))==null?null:a.dirty)||((a=r.postTradeForm.get("tradesymbol"))==null?null:a.touched)||r.formSubmitMarker)),O(11),U("ngIf",((l=r.postTradeForm.get("tradetype"))==null?null:l.invalid)&&(((l=r.postTradeForm.get("tradetype"))==null?null:l.dirty)||((l=r.postTradeForm.get("tradetype"))==null?null:l.touched)||r.formSubmitMarker)),O(17),U("ngIf",((c=r.postTradeForm.get("timeframe"))==null?null:c.invalid)&&(((c=r.postTradeForm.get("timeframe"))==null?null:c.dirty)||((c=r.postTradeForm.get("timeframe"))==null?null:c.touched)||r.formSubmitMarker)),O(14),U("ngIf",((u=r.postTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.postTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.postTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),O(17),U("ngIf",((d=r.postTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.postTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.postTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),O(18),U("ngIf",((p=r.postTradeForm.get("entrydatetime"))==null?null:p.invalid)&&(((p=r.postTradeForm.get("entrydatetime"))==null?null:p.dirty)||((p=r.postTradeForm.get("entrydatetime"))==null?null:p.touched)||r.formSubmitMarker)),O(5),U("ngIf",((f=r.postTradeForm.get("exitdatetime"))==null?null:f.invalid)&&(((f=r.postTradeForm.get("exitdatetime"))==null?null:f.dirty)||((f=r.postTradeForm.get("exitdatetime"))==null?null:f.touched)||r.formSubmitMarker)),O(8),U("ngIf",((m=r.postTradeForm.get("entryprice"))==null?null:m.invalid)&&(((m=r.postTradeForm.get("entryprice"))==null?null:m.dirty)||((m=r.postTradeForm.get("entryprice"))==null?null:m.touched)||r.formSubmitMarker)),O(8),U("ngIf",((h=r.postTradeForm.get("exitprice"))==null?null:h.invalid)&&(((h=r.postTradeForm.get("exitprice"))==null?null:h.dirty)||((h=r.postTradeForm.get("exitprice"))==null?null:h.touched)||r.formSubmitMarker)),O(6),U("ngIf",((g=r.postTradeForm.get("positionsize"))==null?null:g.invalid)&&(((g=r.postTradeForm.get("positionsize"))==null?null:g.dirty)||((g=r.postTradeForm.get("positionsize"))==null?null:g.touched)||r.formSubmitMarker)),O(23),U("ngIf",((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.invalid)&&(((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.dirty)||((x=r.postTradeForm.get("tradeoutcome"))==null?null:x.touched)||r.formSubmitMarker)),O(73),U("ngIf",r.formSubmitMarker&&r.postTradeForm.invalid),O(2),U("ngIf",r.tradeLogData),O(4),$e("",r.tradeLogData?"Update":"Submit"," "),O(),U("ngIf",r.message),O(),U("ngIf",r.errorMessage)}},dependencies:[Pt,Ht,fo,uo,ps,fs,Pn,aa,od,ds,la,er,co,Xg,po,Ro,Fn],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};var Pie=(t,n,e)=>({"open-trade":t,"win-trade":n,"loss-trade":e}),Lie=(t,n,e)=>({"status-open":t,"status-win":n,"status-loss":e}),$ie=(t,n,e)=>({"bi-clock-history":t,"bi-check-circle":n,"bi-x-circle":e}),Vie=(t,n,e)=>({"text-success":t,"text-danger":n,"text-secondary":e});function Bie(t,n){t&1&&(v(0,"div",12),C(1,"Loading trade logs..."),y())}function zie(t,n){if(t&1&&(v(0,"div",13),C(1),y()),t&2){let e=Y();O(),tt(e.errorMessage)}}function Uie(t,n){if(t&1){let e=et();v(0,"div",16)(1,"div",17),ae("click",function(){let o=me(e).$implicit,i=Y(2);return he(i.openEditModal(o))}),v(2,"div",18),z(3,"i",19),C(4),y(),v(5,"div",20),ae("click",function(o){let i=me(e).$implicit,s=Y(2);return he(s.onDeleteTradeLog(i,o))}),z(6,"i",21),y(),v(7,"div",22)(8,"h4",23),C(9),y(),v(10,"h5",24),C(11),y(),v(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),C(16,"Strategy:"),y(),C(17),y(),v(18,"div",27)(19,"strong"),C(20,"Analysis:"),y(),C(21),y()(),v(22,"div",26)(23,"div",27)(24,"strong"),C(25,"Entry:"),y(),C(26),y(),v(27,"div",27)(28,"strong"),C(29,"Exit:"),y(),C(30),y()(),v(31,"div",26)(32,"div",27)(33,"strong"),C(34,"Date:"),y(),C(35),Ni(36,"date"),y(),v(37,"div",27)(38,"strong"),C(39,"Account:"),y(),C(40),y()(),v(41,"div",28)(42,"div",29)(43,"strong"),C(44,"P/L:"),y(),v(45,"span",30),C(46),y()()()(),v(47,"div",31)(48,"small",32),C(49),Ni(50,"date"),y()()()()()}if(t&2){let e=n.$implicit;O(),U("ngClass",zl(23,Pie,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),O(),U("ngClass",zl(27,Lie,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),O(),U("ngClass",zl(31,$ie,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),O(),$e(" ",e.isopen?"In Progress":e.tradeoutcome," "),O(5),tt(e.tradesymbol),O(2),jh(" ",e.tradetype," | ",e.instrumenttype," | ",e.timeframe," "),O(6),$e(" ",e.strategyname," "),O(4),$e(" ",e.analysistype," "),O(5),$e(" ",e.entryprice," "),O(4),$e(" ",e.isopen?"Pending":e.exitprice," "),O(5),$e(" ",ki(36,17,e.entrydatetime,"shortDate")," "),O(5),$e(" ",e.accountname," "),O(5),U("ngClass",zl(35,Vie,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss",e.isopen)),O(),$e(" ",e.isopen?"Trade in progress":e.profitlossamount," "),O(3),tt(ki(50,20,e.createdtime,"medium"))}}function jie(t,n){if(t&1&&(v(0,"div",14),te(1,Uie,51,39,"div",15),y()),t&2){let e=Y();O(),U("ngForOf",e.tradeLogs)}}function Gie(t,n){t&1&&(v(0,"div",33),C(1," No trade logs found. "),y())}function Wie(t,n){if(t&1){let e=et();v(0,"div",34),ae("click",function(o){me(e);let i=Y();return he(i.closeModalOnOverlayClick(o))}),v(1,"div",35),ae("click",function(o){return me(e),he(o.stopPropagation())}),v(2,"app-post-trade-log",36),ae("formSubmitted",function(){me(e);let o=Y();return he(o.onFormSubmitted())})("cancel",function(){me(e);let o=Y();return he(o.closeModal())}),y()()()}if(t&2){let e=Y();O(2),U("tradeLogData",e.selectedTradeLog)}}var Ib=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="posttrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.detectChanges()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName),this.cdr.detectChanges()}catch(n){console.error("Error fetching trade logs",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(ne(kt),ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-post-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/posttradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[3,"ngClass"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Post-Trade Logs"),y(),v(8,"li",3)(9,"a",6),C(10,"Post-Trading Journal"),y()()()(),v(11,"h2"),C(12,"Post Trade Logs"),y(),te(13,Bie,2,0,"div",7)(14,zie,2,1,"div",8)(15,jie,2,1,"div",9)(16,Gie,2,0,"div",10),y(),te(17,Wie,3,1,"div",11)),e&2&&(O(13),U("ngIf",r.loading),O(),U("ngIf",r.errorMessage),O(),U("ngIf",r.tradeLogs&&r.tradeLogs.length),O(),U("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),O(),U("ngIf",r.showModal))},dependencies:[Fn,Pt,Yo,Jn,Ht,as,Sf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.open-trade[_ngcontent-%COMP%]{border-left:4px solid #17a2b8!important}.win-trade[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.loss-trade[_ngcontent-%COMP%]{border-left:4px solid #dc3545!important}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-open[_ngcontent-%COMP%]{background-color:#17a2b8}.status-win[_ngcontent-%COMP%]{background-color:#28a745}.status-loss[_ngcontent-%COMP%]{background-color:#dc3545}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"]})};var Hie=(t,n)=>({"alert-success":t,"alert-danger":n});function qie(t,n){if(t&1&&(v(0,"div",18),C(1),y()),t&2){let e=Y();U("ngClass",is(2,Hie,e.messageType==="success",e.messageType==="error")),O(),$e(" ",e.message," ")}}function Kie(t,n){if(t&1){let e=et();Zs(0),v(1,"input",27),fr("ngModelChange",function(o){me(e);let i=Y().$implicit;return Tr(i.choicesInput,o)||(i.choicesInput=o),he(o)}),ae("change",function(){me(e);let o=Y().$implicit,i=Y();return he(i.updateChoices(o))}),y(),v(2,"div",28),C(3,'e.g., "Option A, Option B, Option C"'),y(),Qs()}if(t&2){let e=Y().$implicit;O(),pr("ngModel",e.choicesInput)}}function Xie(t,n){if(t&1){let e=et();v(0,"tr")(1,"td")(2,"select",19),fr("ngModelChange",function(o){let i=me(e).$implicit;return Tr(i.question_data.question_type,o)||(i.question_data.question_type=o),he(o)}),ae("change",function(){let o=me(e).$implicit,i=Y();return he(i.onQuestionChange(o))}),v(3,"option",9),C(4,"Fill"),y(),v(5,"option",10),C(6,"Multiple"),y(),v(7,"option",11),C(8,"Select One"),y()()(),v(9,"td")(10,"input",20),fr("ngModelChange",function(o){let i=me(e).$implicit;return Tr(i.question_data.question_icon,o)||(i.question_data.question_icon=o),he(o)}),ae("change",function(){let o=me(e).$implicit,i=Y();return he(i.onQuestionChange(o))}),y()(),v(11,"td")(12,"input",21),fr("ngModelChange",function(o){let i=me(e).$implicit;return Tr(i.question_data.question_title,o)||(i.question_data.question_title=o),he(o)}),ae("change",function(){let o=me(e).$implicit,i=Y();return he(i.onQuestionChange(o))}),y()(),v(13,"td")(14,"textarea",22),fr("ngModelChange",function(o){let i=me(e).$implicit;return Tr(i.question_data.question,o)||(i.question_data.question=o),he(o)}),ae("change",function(){let o=me(e).$implicit,i=Y();return he(i.onQuestionChange(o))}),y()(),v(15,"td"),te(16,Kie,4,1,"ng-container",23),y(),v(17,"td")(18,"input",24),fr("ngModelChange",function(o){let i=me(e).$implicit;return Tr(i.question_data.placeholder,o)||(i.question_data.placeholder=o),he(o)}),ae("change",function(){let o=me(e).$implicit,i=Y();return he(i.onQuestionChange(o))}),y()(),v(19,"td")(20,"div",25)(21,"input",26),fr("ngModelChange",function(o){let i=me(e).$implicit;return Tr(i.active,o)||(i.active=o),he(o)}),ae("change",function(){let o=me(e).$implicit,i=Y();return he(i.onQuestionChange(o))}),y()()(),v(22,"td"),C(23),Ni(24,"date"),y()()}if(t&2){let e=n.$implicit;O(2),pr("ngModel",e.question_data.question_type),O(8),pr("ngModel",e.question_data.question_icon),O(2),pr("ngModel",e.question_data.question_title),O(2),pr("ngModel",e.question_data.question),O(2),U("ngIf",e.question_data.question_type!=="fill"),O(2),pr("ngModel",e.question_data.placeholder),O(3),pr("ngModel",e.active),O(2),tt(ki(24,8,e.updated_at,"short"))}}function Yie(t,n){if(t&1){let e=et();v(0,"div",29)(1,"input",30),fr("ngModelChange",function(o){me(e);let i=Y();return Tr(i.newQuestionChoices,o)||(i.newQuestionChoices=o),he(o)}),y()()}if(t&2){let e=Y();O(),pr("ngModel",e.newQuestionChoices)}}var Eb=class t{constructor(n,e){this.cdr=n;this.supabaseService=e}questions=[];newQuestionText="";newQuestionType="fill";newQuestionChoices="";message="";messageType="success";async ngOnInit(){let n=await this.supabaseService.adminLoadQuestions();this.questions=n.map(e=>qe(fe({},e),{choicesInput:e.question_data.choices?.join(", ")||""})),this.cdr.markForCheck()}onQuestionChange(n){n.isModified=!0}updateChoices(n){let e=n.choicesInput??"";n.question_data.choices=e.split(",").map(r=>r.trim()).filter(r=>r),n.isModified=!0}addQuestion(){if(!this.newQuestionText.trim())return;let n={question_type:this.newQuestionType,question:this.newQuestionText.trim(),placeholder:this.newQuestionText.trim()};if(this.newQuestionType!=="fill"){let e=this.newQuestionChoices.split(",").map(r=>r.trim()).filter(r=>r);n.choices=e}this.questions.push({question_data:n,choicesInput:this.newQuestionChoices,active:!0,isModified:!0}),this.newQuestionText="",this.newQuestionChoices="",this.newQuestionType="fill",this.cdr.detectChanges()}async saveChanges(){let{error:n}=await this.supabaseService.adminSaveQuestions(this.questions);n?this.showMessage("Error saving questions","error"):this.showMessage("Questions saved successfully","success"),this.cdr.detectChanges()}async deleteQuestion(n){if(!n.question_id){this.questions=this.questions.filter(r=>r!==n),this.showMessage("Question removed locally","success"),this.cdr.markForCheck();return}let{error:e}=await this.supabaseService.deleteQuestion(n);e?this.showMessage("Error deleting question","error"):(this.questions=this.questions.filter(r=>r.question_id!==n.question_id),this.showMessage("Question deleted successfully","success")),this.cdr.markForCheck()}showMessage(n,e){this.message=n,this.messageType=e,this.cdr.markForCheck(),setTimeout(()=>{this.message="",this.cdr.markForCheck()},4e3)}hasChanges(){return this.questions.some(n=>n.isModified)}static \u0275fac=function(e){return new(e||t)(ne(It),ne(kt))};static \u0275cmp=ht({type:t,selectors:[["app-admin-emotion-dashboard"]],decls:53,vars:6,consts:[[1,"container-fluid","mt-4","p-5"],["class","alert",3,"ngClass",4,"ngIf"],[1,"table","mt-5"],[4,"ngFor","ngForOf"],["href","https://icons.getbootstrap.com/","target","_blank"],[1,"mt-4"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","ngModel"],["value","fill"],["value","multiple"],["value","select-one"],[1,"col-md-5"],["type","text","placeholder","Enter question text",1,"form-control",3,"ngModelChange","ngModel"],["class","col-md-4",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-success",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"form-select",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Enter icon URL or name",1,"form-control",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Enter question title",1,"form-control",3,"ngModelChange","change","ngModel"],["type","text",1,"form-control",3,"ngModelChange","change","ngModel"],[4,"ngIf"],["type","text","placeholder","Enter placeholder text",1,"form-control",3,"ngModelChange","change","ngModel"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"],["type","text","placeholder","Comma-separated choices",1,"form-control","mb-1",3,"ngModelChange","change","ngModel"],[1,"text-muted","small"],[1,"col-md-4"],["type","text","placeholder","Comma-separated choices",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,r){e&1&&(v(0,"div",0),te(1,qie,2,5,"div",1),v(2,"h1"),C(3,"Admin Emotion Question Dashboard"),y(),v(4,"table",2)(5,"thead")(6,"tr")(7,"th"),C(8,"Type"),y(),v(9,"th"),C(10,"Question Icon"),y(),v(11,"th"),C(12,"Question Title"),y(),v(13,"th"),C(14,"Question Text"),y(),v(15,"th"),C(16,"Choices"),y(),v(17,"th"),C(18,"Placeholder"),y(),v(19,"th"),C(20,"Active"),y(),v(21,"th"),C(22,"Last Updated"),y()()(),v(23,"tbody"),te(24,Xie,25,11,"tr",3),y()(),v(25,"label"),C(26,"For icons, go to this website: "),v(27,"a",4),C(28,"https://icons.getbootstrap.com/"),y(),C(29,". "),z(30,"br"),C(31,'Search for favourite icon. When you click your icon, you will see something like this. <i class="bi bi-emoji-smile"></i>. '),z(32,"br"),C(33,'Then copy this part "bi bi-emoji-smile" and put it into the space'),y(),v(34,"h4",5),C(35,"Add New Question"),y(),v(36,"div",6)(37,"div",7)(38,"select",8),fr("ngModelChange",function(i){return Tr(r.newQuestionType,i)||(r.newQuestionType=i),i}),v(39,"option",9),C(40,"Fill"),y(),v(41,"option",10),C(42,"Multiple"),y(),v(43,"option",11),C(44,"Select One"),y()()(),v(45,"div",12)(46,"input",13),fr("ngModelChange",function(i){return Tr(r.newQuestionText,i)||(r.newQuestionText=i),i}),y()(),te(47,Yie,2,1,"div",14),y(),v(48,"div",15)(49,"button",16),ae("click",function(){return r.addQuestion()}),C(50,"Add Question"),y(),v(51,"button",17),ae("click",function(){return r.saveChanges()}),C(52,"Save Changes"),y()()()),e&2&&(O(),U("ngIf",r.message),O(23),U("ngForOf",r.questions),O(14),pr("ngModel",r.newQuestionType),O(8),pr("ngModel",r.newQuestionText),O(),U("ngIf",r.newQuestionType!=="fill"),O(4),U("disabled",!r.hasChanges()))},dependencies:[If,ps,fs,Pn,od,ds,er,id,Pt,Yo,Jn,Ht,as],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.question-row[_ngcontent-%COMP%]{position:relative}.delete-button[_ngcontent-%COMP%]{display:none;position:absolute;right:10px;top:50%;transform:translateY(-50%)}.question-row[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{display:block}.alert[_ngcontent-%COMP%]{padding:10px 20px;margin-bottom:15px;border-radius:4px;text-align:center}.table[_ngcontent-%COMP%]{--bs-table-bg: transparent}"]})};var oD;try{oD=typeof Intl<"u"&&Intl.v8BreakIterator}catch{oD=!1}var Sb=(()=>{class t{_platformId=ie(so);isBrowser=this._platformId?cn(this._platformId):typeof document=="object"&&!!document;EDGE=this.isBrowser&&/(edge)/i.test(navigator.userAgent);TRIDENT=this.isBrowser&&/(msie|trident)/i.test(navigator.userAgent);BLINK=this.isBrowser&&!!(window.chrome||oD)&&typeof CSS<"u"&&!this.EDGE&&!this.TRIDENT;WEBKIT=this.isBrowser&&/AppleWebKit/i.test(navigator.userAgent)&&!this.BLINK&&!this.EDGE&&!this.TRIDENT;IOS=this.isBrowser&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!("MSStream"in window);FIREFOX=this.isBrowser&&/(firefox|minefield)/i.test(navigator.userAgent);ANDROID=this.isBrowser&&/android/i.test(navigator.userAgent)&&!this.TRIDENT;SAFARI=this.isBrowser&&/safari/i.test(navigator.userAgent)&&this.WEBKIT;constructor(){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function iD(t){return Array.isArray(t)?t:[t]}var H$=new Set,ad,Zie=(()=>{class t{_platform=ie(Sb);_nonce=ie(zh,{optional:!0});_matchMedia;constructor(){this._matchMedia=this._platform.isBrowser&&window.matchMedia?window.matchMedia.bind(window):Jie}matchMedia(e){return(this._platform.WEBKIT||this._platform.BLINK)&&Qie(e,this._nonce),this._matchMedia(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Qie(t,n){if(!H$.has(t))try{ad||(ad=document.createElement("style"),n&&ad.setAttribute("nonce",n),ad.setAttribute("type","text/css"),document.head.appendChild(ad)),ad.sheet&&(ad.sheet.insertRule(`@media ${t} {body{ }}`,0),H$.add(t))}catch(e){console.error(e)}}function Jie(t){return{matches:t==="all"||t==="",media:t,addListener:()=>{},removeListener:()=>{}}}var K$=(()=>{class t{_mediaMatcher=ie(Zie);_zone=ie(sn);_queries=new Map;_destroySubject=new vn;constructor(){}ngOnDestroy(){this._destroySubject.next(),this._destroySubject.complete()}isMatched(e){return q$(iD(e)).some(o=>this._registerQuery(o).mql.matches)}observe(e){let o=q$(iD(e)).map(s=>this._registerQuery(s).observable),i=Ip(o);return i=kl(i.pipe(Co(1)),i.pipe(JI(1),KI(0))),i.pipe(Ge(s=>{let a={matches:!1,breakpoints:{}};return s.forEach(({matches:l,query:c})=>{a.matches=a.matches||l,a.breakpoints[c]=l}),a}))}_registerQuery(e){if(this._queries.has(e))return this._queries.get(e);let r=this._mediaMatcher.matchMedia(e),i={observable:new vt(s=>{let a=l=>this._zone.run(()=>s.next(l));return r.addListener(a),()=>{r.removeListener(a)}}).pipe(Ch(r),Ge(({matches:s})=>({query:e,matches:s})),_h(this._destroySubject)),mql:r};return this._queries.set(e,i),i}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function q$(t){return t.map(n=>n.split(",")).reduce((n,e)=>n.concat(e)).map(n=>n.trim())}var ld=function(t){return t[t.NONE=0]="NONE",t[t.BLACK_ON_WHITE=1]="BLACK_ON_WHITE",t[t.WHITE_ON_BLACK=2]="WHITE_ON_BLACK",t}(ld||{}),X$="cdk-high-contrast-black-on-white",Y$="cdk-high-contrast-white-on-black",sD="cdk-high-contrast-active",Z$=(()=>{class t{_platform=ie(Sb);_hasCheckedHighContrastMode;_document=ie(Mn);_breakpointSubscription;constructor(){this._breakpointSubscription=ie(K$).observe("(forced-colors: active)").subscribe(()=>{this._hasCheckedHighContrastMode&&(this._hasCheckedHighContrastMode=!1,this._applyBodyHighContrastModeCssClasses())})}getHighContrastMode(){if(!this._platform.isBrowser)return ld.NONE;let e=this._document.createElement("div");e.style.backgroundColor="rgb(1,2,3)",e.style.position="absolute",this._document.body.appendChild(e);let r=this._document.defaultView||window,o=r&&r.getComputedStyle?r.getComputedStyle(e):null,i=(o&&o.backgroundColor||"").replace(/ /g,"");switch(e.remove(),i){case"rgb(0,0,0)":case"rgb(45,50,54)":case"rgb(32,32,32)":return ld.WHITE_ON_BLACK;case"rgb(255,255,255)":case"rgb(255,250,239)":return ld.BLACK_ON_WHITE}return ld.NONE}ngOnDestroy(){this._breakpointSubscription.unsubscribe()}_applyBodyHighContrastModeCssClasses(){if(!this._hasCheckedHighContrastMode&&this._platform.isBrowser&&this._document.body){let e=this._document.body.classList;e.remove(sD,X$,Y$),this._hasCheckedHighContrastMode=!0;let r=this.getHighContrastMode();r===ld.BLACK_ON_WHITE?e.add(sD,X$):r===ld.WHITE_ON_BLACK&&e.add(sD,Y$)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var aD=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({})}return t})();var lD=(()=>{class t{constructor(){ie(Z$)._applyBodyHighContrastModeCssClasses()}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({imports:[aD,aD]})}return t})();var ese=["*"],Tb;function tse(){if(Tb===void 0&&(Tb=null,typeof window<"u")){let t=window;t.trustedTypes!==void 0&&(Tb=t.trustedTypes.createPolicy("angular#components",{createHTML:n=>n}))}return Tb}function Yg(t){return tse()?.createHTML(t)||t}function Q$(t){return Error(`Unable to find icon with the name "${t}"`)}function nse(){return Error("Could not find HttpClient for use with Angular Material icons. Please add provideHttpClient() to your providers.")}function J$(t){return Error(`The URL provided to MatIconRegistry was not trusted as a resource URL via Angular's DomSanitizer. Attempted URL was "${t}".`)}function e3(t){return Error(`The literal provided to MatIconRegistry was not trusted as safe HTML by Angular's DomSanitizer. Attempted literal was "${t}".`)}var ca=class{url;svgText;options;svgElement;constructor(n,e,r){this.url=n,this.svgText=e,this.options=r}},rse=(()=>{class t{_httpClient;_sanitizer;_errorHandler;_document;_svgIconConfigs=new Map;_iconSetConfigs=new Map;_cachedIconsByUrl=new Map;_inProgressUrlFetches=new Map;_fontCssClassesByAlias=new Map;_resolvers=[];_defaultFontSetClass=["material-icons","mat-ligature-font"];constructor(e,r,o,i){this._httpClient=e,this._sanitizer=r,this._errorHandler=i,this._document=o}addSvgIcon(e,r,o){return this.addSvgIconInNamespace("",e,r,o)}addSvgIconLiteral(e,r,o){return this.addSvgIconLiteralInNamespace("",e,r,o)}addSvgIconInNamespace(e,r,o,i){return this._addSvgIconConfig(e,r,new ca(o,null,i))}addSvgIconResolver(e){return this._resolvers.push(e),this}addSvgIconLiteralInNamespace(e,r,o,i){let s=this._sanitizer.sanitize(Sr.HTML,o);if(!s)throw e3(o);let a=Yg(s);return this._addSvgIconConfig(e,r,new ca("",a,i))}addSvgIconSet(e,r){return this.addSvgIconSetInNamespace("",e,r)}addSvgIconSetLiteral(e,r){return this.addSvgIconSetLiteralInNamespace("",e,r)}addSvgIconSetInNamespace(e,r,o){return this._addSvgIconSetConfig(e,new ca(r,null,o))}addSvgIconSetLiteralInNamespace(e,r,o){let i=this._sanitizer.sanitize(Sr.HTML,r);if(!i)throw e3(r);let s=Yg(i);return this._addSvgIconSetConfig(e,new ca("",s,o))}registerFontClassAlias(e,r=e){return this._fontCssClassesByAlias.set(e,r),this}classNameForFontAlias(e){return this._fontCssClassesByAlias.get(e)||e}setDefaultFontSetClass(...e){return this._defaultFontSetClass=e,this}getDefaultFontSetClass(){return this._defaultFontSetClass}getSvgIconFromUrl(e){let r=this._sanitizer.sanitize(Sr.RESOURCE_URL,e);if(!r)throw J$(e);let o=this._cachedIconsByUrl.get(r);return o?Ue(Db(o)):this._loadSvgIconFromConfig(new ca(e,null)).pipe(In(i=>this._cachedIconsByUrl.set(r,i)),Ge(i=>Db(i)))}getNamedSvgIcon(e,r=""){let o=t3(r,e),i=this._svgIconConfigs.get(o);if(i)return this._getSvgFromConfig(i);if(i=this._getIconConfigFromResolvers(r,e),i)return this._svgIconConfigs.set(o,i),this._getSvgFromConfig(i);let s=this._iconSetConfigs.get(r);return s?this._getSvgFromIconSetConfigs(e,s):Nl(Q$(o))}ngOnDestroy(){this._resolvers=[],this._svgIconConfigs.clear(),this._iconSetConfigs.clear(),this._cachedIconsByUrl.clear()}_getSvgFromConfig(e){return e.svgText?Ue(Db(this._svgElementFromConfig(e))):this._loadSvgIconFromConfig(e).pipe(Ge(r=>Db(r)))}_getSvgFromIconSetConfigs(e,r){let o=this._extractIconWithNameFromAnySet(e,r);if(o)return Ue(o);let i=r.filter(s=>!s.svgText).map(s=>this._loadSvgIconSetFromConfig(s).pipe(Ji(a=>{let c=`Loading icon set URL: ${this._sanitizer.sanitize(Sr.RESOURCE_URL,s.url)} failed: ${a.message}`;return this._errorHandler.handleError(new Error(c)),Ue(null)})));return wh(i).pipe(Ge(()=>{let s=this._extractIconWithNameFromAnySet(e,r);if(!s)throw Q$(e);return s}))}_extractIconWithNameFromAnySet(e,r){for(let o=r.length-1;o>=0;o--){let i=r[o];if(i.svgText&&i.svgText.toString().indexOf(e)>-1){let s=this._svgElementFromConfig(i),a=this._extractSvgIconFromSet(s,e,i.options);if(a)return a}}return null}_loadSvgIconFromConfig(e){return this._fetchIcon(e).pipe(In(r=>e.svgText=r),Ge(()=>this._svgElementFromConfig(e)))}_loadSvgIconSetFromConfig(e){return e.svgText?Ue(null):this._fetchIcon(e).pipe(In(r=>e.svgText=r))}_extractSvgIconFromSet(e,r,o){let i=e.querySelector(`[id="${r}"]`);if(!i)return null;let s=i.cloneNode(!0);if(s.removeAttribute("id"),s.nodeName.toLowerCase()==="svg")return this._setSvgAttributes(s,o);if(s.nodeName.toLowerCase()==="symbol")return this._setSvgAttributes(this._toSvgElement(s),o);let a=this._svgElementFromString(Yg("<svg></svg>"));return a.appendChild(s),this._setSvgAttributes(a,o)}_svgElementFromString(e){let r=this._document.createElement("DIV");r.innerHTML=e;let o=r.querySelector("svg");if(!o)throw Error("<svg> tag not found");return o}_toSvgElement(e){let r=this._svgElementFromString(Yg("<svg></svg>")),o=e.attributes;for(let i=0;i<o.length;i++){let{name:s,value:a}=o[i];s!=="id"&&r.setAttribute(s,a)}for(let i=0;i<e.childNodes.length;i++)e.childNodes[i].nodeType===this._document.ELEMENT_NODE&&r.appendChild(e.childNodes[i].cloneNode(!0));return r}_setSvgAttributes(e,r){return e.setAttribute("fit",""),e.setAttribute("height","100%"),e.setAttribute("width","100%"),e.setAttribute("preserveAspectRatio","xMidYMid meet"),e.setAttribute("focusable","false"),r&&r.viewBox&&e.setAttribute("viewBox",r.viewBox),e}_fetchIcon(e){let{url:r,options:o}=e,i=o?.withCredentials??!1;if(!this._httpClient)throw nse();if(r==null)throw Error(`Cannot fetch icon from URL "${r}".`);let s=this._sanitizer.sanitize(Sr.RESOURCE_URL,r);if(!s)throw J$(r);let a=this._inProgressUrlFetches.get(s);if(a)return a;let l=this._httpClient.get(s,{responseType:"text",withCredentials:i}).pipe(Ge(c=>Yg(c)),Ps(()=>this._inProgressUrlFetches.delete(s)),QI());return this._inProgressUrlFetches.set(s,l),l}_addSvgIconConfig(e,r,o){return this._svgIconConfigs.set(t3(e,r),o),this}_addSvgIconSetConfig(e,r){let o=this._iconSetConfigs.get(e);return o?o.push(r):this._iconSetConfigs.set(e,[r]),this}_svgElementFromConfig(e){if(!e.svgElement){let r=this._svgElementFromString(e.svgText);this._setSvgAttributes(r,e.options),e.svgElement=r}return e.svgElement}_getIconConfigFromResolvers(e,r){for(let o=0;o<this._resolvers.length;o++){let i=this._resolvers[o](r,e);if(i)return ose(i)?new ca(i.url,null,i.options):new ca(i,null)}}static \u0275fac=function(r){return new(r||t)(Me(m1,8),Me(C1),Me(Mn,8),Me(Eo))};static \u0275prov=be({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Db(t){return t.cloneNode(!0)}function t3(t,n){return t+":"+n}function ose(t){return!!(t.url&&t.options)}var ise=new ke("MAT_ICON_DEFAULT_OPTIONS"),sse=new ke("mat-icon-location",{providedIn:"root",factory:ase});function ase(){let t=ie(Mn),n=t?t.location:null;return{getPathname:()=>n?n.pathname+n.search:""}}var n3=["clip-path","color-profile","src","cursor","fill","filter","marker","marker-start","marker-mid","marker-end","mask","stroke"],lse=n3.map(t=>`[${t}]`).join(", "),cse=/^url\(['"]?#(.*?)['"]?\)$/,r3=(()=>{class t{_elementRef=ie(Er);_iconRegistry=ie(rse);_location=ie(sse);_errorHandler=ie(Eo);_defaultColor;get color(){return this._color||this._defaultColor}set color(e){this._color=e}_color;inline=!1;get svgIcon(){return this._svgIcon}set svgIcon(e){e!==this._svgIcon&&(e?this._updateSvgIcon(e):this._svgIcon&&this._clearSvgElement(),this._svgIcon=e)}_svgIcon;get fontSet(){return this._fontSet}set fontSet(e){let r=this._cleanupFontValue(e);r!==this._fontSet&&(this._fontSet=r,this._updateFontIconClasses())}_fontSet;get fontIcon(){return this._fontIcon}set fontIcon(e){let r=this._cleanupFontValue(e);r!==this._fontIcon&&(this._fontIcon=r,this._updateFontIconClasses())}_fontIcon;_previousFontSetClass=[];_previousFontIconClass;_svgName;_svgNamespace;_previousPath;_elementsWithExternalReferences;_currentIconFetch=gn.EMPTY;constructor(){let e=ie(new gv("aria-hidden"),{optional:!0}),r=ie(ise,{optional:!0});r&&(r.color&&(this.color=this._defaultColor=r.color),r.fontSet&&(this.fontSet=r.fontSet)),e||this._elementRef.nativeElement.setAttribute("aria-hidden","true")}_splitIconName(e){if(!e)return["",""];let r=e.split(":");switch(r.length){case 1:return["",r[0]];case 2:return r;default:throw Error(`Invalid icon name: "${e}"`)}}ngOnInit(){this._updateFontIconClasses()}ngAfterViewChecked(){let e=this._elementsWithExternalReferences;if(e&&e.size){let r=this._location.getPathname();r!==this._previousPath&&(this._previousPath=r,this._prependPathToReferences(r))}}ngOnDestroy(){this._currentIconFetch.unsubscribe(),this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear()}_usingFontIcon(){return!this.svgIcon}_setSvgElement(e){this._clearSvgElement();let r=this._location.getPathname();this._previousPath=r,this._cacheChildrenWithExternalReferences(e),this._prependPathToReferences(r),this._elementRef.nativeElement.appendChild(e)}_clearSvgElement(){let e=this._elementRef.nativeElement,r=e.childNodes.length;for(this._elementsWithExternalReferences&&this._elementsWithExternalReferences.clear();r--;){let o=e.childNodes[r];(o.nodeType!==1||o.nodeName.toLowerCase()==="svg")&&o.remove()}}_updateFontIconClasses(){if(!this._usingFontIcon())return;let e=this._elementRef.nativeElement,r=(this.fontSet?this._iconRegistry.classNameForFontAlias(this.fontSet).split(/ +/):this._iconRegistry.getDefaultFontSetClass()).filter(o=>o.length>0);this._previousFontSetClass.forEach(o=>e.classList.remove(o)),r.forEach(o=>e.classList.add(o)),this._previousFontSetClass=r,this.fontIcon!==this._previousFontIconClass&&!r.includes("mat-ligature-font")&&(this._previousFontIconClass&&e.classList.remove(this._previousFontIconClass),this.fontIcon&&e.classList.add(this.fontIcon),this._previousFontIconClass=this.fontIcon)}_cleanupFontValue(e){return typeof e=="string"?e.trim().split(" ")[0]:e}_prependPathToReferences(e){let r=this._elementsWithExternalReferences;r&&r.forEach((o,i)=>{o.forEach(s=>{i.setAttribute(s.name,`url('${e}#${s.value}')`)})})}_cacheChildrenWithExternalReferences(e){let r=e.querySelectorAll(lse),o=this._elementsWithExternalReferences=this._elementsWithExternalReferences||new Map;for(let i=0;i<r.length;i++)n3.forEach(s=>{let a=r[i],l=a.getAttribute(s),c=l?l.match(cse):null;if(c){let u=o.get(a);u||(u=[],o.set(a,u)),u.push({name:s,value:c[1]})}})}_updateSvgIcon(e){if(this._svgNamespace=null,this._svgName=null,this._currentIconFetch.unsubscribe(),e){let[r,o]=this._splitIconName(e);r&&(this._svgNamespace=r),o&&(this._svgName=o),this._currentIconFetch=this._iconRegistry.getNamedSvgIcon(o,r).pipe(Co(1)).subscribe(i=>this._setSvgElement(i),i=>{let s=`Error retrieving icon ${r}:${o}! ${i.message}`;this._errorHandler.handleError(new Error(s))})}}static \u0275fac=function(r){return new(r||t)};static \u0275cmp=ht({type:t,selectors:[["mat-icon"]],hostAttrs:["role","img",1,"mat-icon","notranslate"],hostVars:10,hostBindings:function(r,o){r&2&&(os("data-mat-icon-type",o._usingFontIcon()?"font":"svg")("data-mat-icon-name",o._svgName||o.fontIcon)("data-mat-icon-namespace",o._svgNamespace||o.fontSet)("fontIcon",o._usingFontIcon()?o.fontIcon:null),ex(o.color?"mat-"+o.color:""),So("mat-icon-inline",o.inline)("mat-icon-no-color",o.color!=="primary"&&o.color!=="accent"&&o.color!=="warn"))},inputs:{color:"color",inline:[2,"inline","inline",Ai],svgIcon:"svgIcon",fontSet:"fontSet",fontIcon:"fontIcon"},exportAs:["matIcon"],features:[Vu],ngContentSelectors:ese,decls:1,vars:0,template:function(r,o){r&1&&(KS(),XS(0))},styles:["mat-icon,mat-icon.mat-primary,mat-icon.mat-accent,mat-icon.mat-warn{color:var(--mat-icon-color, inherit)}.mat-icon{-webkit-user-select:none;user-select:none;background-repeat:no-repeat;display:inline-block;fill:currentColor;height:24px;width:24px;overflow:hidden}.mat-icon.mat-icon-inline{font-size:inherit;height:inherit;line-height:inherit;width:inherit}.mat-icon.mat-ligature-font[fontIcon]::before{content:attr(fontIcon)}[dir=rtl] .mat-icon-rtl-mirror{transform:scale(-1, 1)}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon{display:block}.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-prefix .mat-icon-button .mat-icon,.mat-form-field:not(.mat-form-field-appearance-legacy) .mat-form-field-suffix .mat-icon-button .mat-icon{margin:auto}"],encapsulation:2,changeDetection:0})}return t})(),o3=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Qn({type:t});static \u0275inj=Zn({imports:[lD,lD]})}return t})();var dse=(t,n)=>({"alert-success":t,"alert-danger":n});function pse(t,n){if(t&1&&(v(0,"div",9),C(1),y()),t&2){let e=Y();U("ngClass",is(2,dse,e.messageType==="success",e.messageType==="error")),O(),$e(" ",e.message," ")}}function fse(t,n){if(t&1){let e=et();v(0,"textarea",17),fr("ngModelChange",function(o){me(e);let i=Y().$implicit;return Tr(i.answer,o)||(i.answer=o),he(o)}),y()}if(t&2){let e=Y().$implicit;zu("name",e.question_id),zu("placeholder",e.question_data.placeholder),pr("ngModel",e.answer)}}function mse(t,n){if(t&1){let e=et();v(0,"div",20)(1,"input",21),fr("ngModelChange",function(o){me(e);let i=Y(2).$implicit;return Tr(i.answer,o)||(i.answer=o),he(o)}),y(),v(2,"label",22),C(3),y()()}if(t&2){let e=n.$implicit,r=Y(2).$implicit;O(),zu("name",r.question_id),U("value",e),pr("ngModel",r.answer),O(2),tt(e)}}function hse(t,n){if(t&1&&(v(0,"div",18),te(1,mse,4,4,"div",19),y()),t&2){let e=Y().$implicit;O(),U("ngForOf",e.question_data.choices)}}function gse(t,n){if(t&1){let e=et();v(0,"div",24)(1,"input",25),ae("change",function(){let o=me(e).$implicit,i=Y(2).$implicit,s=Y();return he(s.toggleMultipleChoice(i,o))}),y(),v(2,"label",22),C(3),y()()}if(t&2){let e=n.$implicit,r=Y(2).$implicit;O(),U("checked",r.multipleAnswers==null?null:r.multipleAnswers.includes(e)),O(2),tt(e)}}function yse(t,n){if(t&1&&(v(0,"div",18),te(1,gse,4,2,"div",23),y()),t&2){let e=Y().$implicit;O(),U("ngForOf",e.question_data.choices)}}function vse(t,n){if(t&1&&(v(0,"div",10)(1,"div",11)(2,"mat-icon",12),C(3),y(),v(4,"h2",13),C(5),y(),v(6,"h6",14),C(7),y()(),te(8,fse,1,3,"textarea",15)(9,hse,2,1,"div",16)(10,yse,2,1,"div",16),y()),t&2){let e=n.$implicit;O(3),tt(e.question_data.question_icon),O(2),tt(e.question_data.question_title),O(2),tt(e.question_data.question),O(),U("ngIf",e.question_data.question_type==="fill"),O(),U("ngIf",e.question_data.question_type==="select-one"),O(),U("ngIf",e.question_data.question_type==="multiple")}}var Nb=class t{constructor(n,e,r){this.supabaseService=n;this.cdr=e;this.router=r}questions=[];message="";messageType="success";ngOnInit(){this.loadQuestions()}async loadQuestions(){let{data:n,error:e}=await this.supabaseService.getActiveQuestions();e?(console.error("Error loading questions:",e),this.message="Error loading questions.",this.messageType="error"):n&&(this.questions=n),this.cdr.markForCheck()}allQuestionsAnswered(){return this.questions.every(n=>n.question_data.question_type==="multiple"?n.multipleAnswers&&n.multipleAnswers.length>0:n.answer&&n.answer.trim().length>0)}toggleMultipleChoice(n,e){n.multipleAnswers||(n.multipleAnswers=[]);let r=n.multipleAnswers.indexOf(e);r>-1?n.multipleAnswers.splice(r,1):n.multipleAnswers.push(e)}async submitAnswers(){if(!this.allQuestionsAnswered()){this.message="Please answer all questions before submitting.",this.messageType="error",this.cdr.markForCheck();return}let n=this.supabaseService.user()?.id;if(!n){this.message="User not authenticated.",this.messageType="error",this.cdr.markForCheck();return}let e=this.questions.map(o=>({question_id:o.question_id,answer:o.question_data.question_type==="multiple"?o.multipleAnswers?.join(", ")??"":o.answer?.trim()??"",user_id:n})),{error:r}=await this.supabaseService.submitUserAnswers(e);r?(console.error("Error submitting answers:",r),this.message="Error submitting answers.",this.messageType="error"):(this.message="Answers submitted successfully. redirecting in 5 seconds.",this.messageType="success"),this.cdr.markForCheck(),setTimeout(()=>{this.router.navigateByUrl("/home")},5e3)}static \u0275fac=function(e){return new(e||t)(ne(kt),ne(It),ne(ko))};static \u0275cmp=ht({type:t,selectors:[["app-user-emotion-questionnaire"]],decls:15,vars:3,consts:[[1,"container","mt-4","mb-5"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],["class","alert",3,"ngClass",4,"ngIf"],["class","mb-4",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-primary",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"mb-4"],[1,"card-header","form-label","question-label","mt-3","mb-5","pt-2","pb-2","ps-2","col-12"],[1,"question-icon","fs-2","ps-3","mt-4","mb-2"],[1,"fs-2","ps-3","pe-3","mt-2","mb-3","fw-bold"],[1,"ps-3","pe-3","mt-2","mb-3"],["class","form-control card-body p-3","rows","3",3,"ngModel","name","placeholder","ngModelChange",4,"ngIf"],["class","card-body p-4",4,"ngIf"],["rows","3",1,"form-control","card-body","p-3",3,"ngModelChange","ngModel","name","placeholder"],[1,"card-body","p-4"],["class","btn-radio-tr form-check",4,"ngFor","ngForOf"],[1,"btn-radio-tr","form-check"],["type","radio",1,"form-check-input","mb-2",3,"ngModelChange","name","value","ngModel"],[1,"form-check-label"],["class","btn-check-tr form-check",4,"ngFor","ngForOf"],[1,"btn-check-tr","form-check"],["type","checkbox",1,"form-check-input","mb-2",3,"change","checked"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Emotion Questions"),y()()(),te(8,pse,2,5,"div",6),v(9,"h1"),C(10,"User Emotion Questionnaire"),y(),v(11,"form"),te(12,vse,11,6,"div",7),v(13,"button",8),ae("click",function(){return r.submitAnswers()}),C(14," Submit Answers "),y()()()),e&2&&(O(8),U("ngIf",r.message),O(4),U("ngForOf",r.questions),O(),U("disabled",!r.allQuestionsAnswered()))},dependencies:[If,uo,Pn,la,er,co,id,JT,Pt,Yo,Jn,Ht,o3,r3],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.alert[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}h1[_ngcontent-%COMP%]{margin-bottom:20px}.question-label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#333;background-color:#f0f0ff;border-radius:20px;display:inline-block}.question-icon[_ngcontent-%COMP%]{color:#634aff;min-height:24px;overflow:visible}"]})};function xse(t,n){if(t&1&&(v(0,"div",13),C(1),y()),t&2){let e=Y();O(),$e(" ",e.errorMessage," ")}}function bse(t,n){t&1&&(v(0,"div",28),C(1," A valid email is required. "),y())}function wse(t,n){t&1&&(v(0,"div",28),C(1," Password must be at least 6 characters. "),y())}function Cse(t,n){if(t&1){let e=et();v(0,"form",14),ae("ngSubmit",function(){me(e);let o=Y();return he(o.onSubmit())}),v(1,"div",15)(2,"label",16),C(3,"Email"),y(),z(4,"input",17),te(5,bse,2,0,"div",18),y(),v(6,"div",15)(7,"label",19),C(8,"Password"),y(),z(9,"input",20),te(10,wse,2,0,"div",18),v(11,"div",21)(12,"a",22),C(13,"Forgot password?"),y()()(),v(14,"div",23)(15,"button",24),C(16,"Continue"),y()(),v(17,"div",25)(18,"p",26),C(19,"Don't have an account? "),v(20,"a",27),ae("click",function(){me(e);let o=Y();return he(o.setActiveTab("signup"))}),C(21,"Sign up"),y()()()()}if(t&2){let e,r,o=Y();U("formGroup",o.signinForm),O(5),U("ngIf",((e=o.signinForm.get("email"))==null?null:e.invalid)&&((e=o.signinForm.get("email"))==null?null:e.touched)),O(5),U("ngIf",((r=o.signinForm.get("password"))==null?null:r.invalid)&&((r=o.signinForm.get("password"))==null?null:r.touched)),O(5),U("disabled",o.signinForm.invalid)}}function _se(t,n){t&1&&(v(0,"small",43),C(1," First name is required "),y())}function Ise(t,n){t&1&&(v(0,"small",43),C(1," Last name is required "),y())}function Ese(t,n){t&1&&(v(0,"small",43),C(1," Valid email is required "),y())}function Sse(t,n){t&1&&(v(0,"small",43),C(1," Password must be at least 6 characters "),y())}function Tse(t,n){t&1&&(v(0,"small",43),C(1," Passwords do not match "),y())}function Dse(t,n){if(t&1){let e=et();v(0,"form",14),ae("ngSubmit",function(){me(e);let o=Y();return he(o.onSignupSubmit())}),v(1,"div",29)(2,"div",30)(3,"label",31),C(4,"First Name"),y(),z(5,"input",32),te(6,_se,2,0,"small",33),y(),v(7,"div",30)(8,"label",34),C(9,"Last Name"),y(),z(10,"input",35),te(11,Ise,2,0,"small",33),y()(),v(12,"div",15)(13,"label",36),C(14,"Email"),y(),z(15,"input",37),te(16,Ese,2,0,"small",33),y(),v(17,"div",15)(18,"label",38),C(19,"Password"),y(),z(20,"input",39),te(21,Sse,2,0,"small",33),y(),v(22,"div",15)(23,"label",40),C(24,"Confirm Password"),y(),z(25,"input",41),te(26,Tse,2,0,"small",33),y(),v(27,"div",23)(28,"button",24),C(29,"Create Account"),y()(),v(30,"div",25)(31,"p",26),C(32,"Already have an account? "),v(33,"a",42),ae("click",function(){me(e);let o=Y();return he(o.setActiveTab("login"))}),C(34,"Login"),y()()()()}if(t&2){let e,r,o,i,s,a=Y();U("formGroup",a.signupForm),O(6),U("ngIf",((e=a.signupForm.get("firstname"))==null?null:e.invalid)&&((e=a.signupForm.get("firstname"))==null?null:e.touched)),O(5),U("ngIf",((r=a.signupForm.get("lastname"))==null?null:r.invalid)&&((r=a.signupForm.get("lastname"))==null?null:r.touched)),O(5),U("ngIf",((o=a.signupForm.get("email"))==null?null:o.invalid)&&((o=a.signupForm.get("email"))==null?null:o.touched)),O(5),U("ngIf",((i=a.signupForm.get("password"))==null?null:i.invalid)&&((i=a.signupForm.get("password"))==null?null:i.touched)),O(5),U("ngIf",a.signupForm.hasError("mismatch")&&((s=a.signupForm.get("confirmPassword"))==null?null:s.touched)),O(2),U("disabled",a.signupForm.invalid)}}var kb=class t{constructor(n,e,r,o){this.fb=n;this.router=e;this.route=r;this.supabaseService=o;this.signinForm=this.fb.group({email:["",[Ee.required,Ee.email]],password:["",[Ee.required,Ee.minLength(6)]]}),this.signupForm=this.fb.group({firstname:["",Ee.required],lastname:["",Ee.required],email:["",[Ee.required,Ee.email]],password:["",[Ee.required,Ee.minLength(6)]],confirmPassword:["",Ee.required]},{validators:this.passwordMatchValidator})}activeTab="login";signinForm;signupForm;errorMessage=null;ngOnInit(){this.route.queryParams.subscribe(n=>{n.mode==="signup"&&(this.activeTab="signup")})}passwordMatchValidator(n){let e=n.get("password")?.value,r=n.get("confirmPassword")?.value;return e===r?null:{mismatch:!0}}setActiveTab(n){this.activeTab=n,this.errorMessage=null}async onSubmit(){if(this.signinForm.invalid){this.signinForm.markAllAsTouched();return}let{email:n,password:e}=this.signinForm.getRawValue();try{if(await this.supabaseService.signIn(n,e),!this.supabaseService.currentUsername()){this.errorMessage="Login failed. Please try again.";return}this.signinForm.reset();let r=this.route.snapshot.queryParams.returnUrl||"/home";this.router.navigateByUrl(r)}catch(r){this.errorMessage=r.message||"An unexpected error occurred."}}onSignupSubmit(){if(this.signupForm.invalid){this.signupForm.markAllAsTouched();return}let{email:n,password:e,firstname:r,lastname:o}=this.signupForm.getRawValue();this.supabaseService.signUp(n,e,r,o).then(()=>{this.signupForm.reset(),this.router.navigateByUrl("/home")}).catch(i=>{this.errorMessage=i.message||"An unexpected error occurred.",console.error(i)})}static \u0275fac=function(e){return new(e||t)(ne(ei),ne(ko),ne(Fi),ne(kt))};static \u0275cmp=ht({type:t,selectors:[["app-login-signup"]],decls:20,vars:7,consts:[[1,"auth-container"],[1,"auth-card"],[1,"text-center","mb-4"],[1,"logo-circle","mx-auto"],["src","/trading-rehab-logo.png","alt","Logo",1,"img-fluid"],[1,"brand-name","mt-3"],[1,"brand-tagline"],[1,"auth-tabs","d-flex","justify-content-center","mb-4"],[1,"tabs-container"],[1,"tab",3,"click"],[1,"mx-2","tab-separator"],["class","alert alert-danger mb-3",4,"ngIf"],["class","auth-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"alert","alert-danger","mb-3"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Enter your email",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Enter your password",1,"form-control"],[1,"d-flex","justify-content-end","mt-2"],["href","#",1,"forgot-link"],[1,"d-grid","gap-2","mt-4"],["type","submit",1,"btn","btn-tr","btn-primary","btn-md",3,"disabled"],[1,"text-center","mt-4"],[1,"mb-0"],["href","javascript:void(0)",1,"signup-link",3,"click"],[1,"text-danger","small","mt-1"],[1,"row"],[1,"col-md-6","mb-3"],["for","firstname",1,"form-label"],["type","text","id","firstname","formControlName","firstname","placeholder","First name",1,"form-control"],["class","text-danger",4,"ngIf"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","placeholder","Last name",1,"form-control"],["for","signup-email",1,"form-label"],["type","email","id","signup-email","formControlName","email","placeholder","Enter your email",1,"form-control"],["for","signup-password",1,"form-label"],["type","password","id","signup-password","formControlName","password","placeholder","Create a password",1,"form-control"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm your password",1,"form-control"],["href","javascript:void(0)",1,"login-link",3,"click"],[1,"text-danger"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),z(4,"img",4),y(),v(5,"h2",5),C(6,"TRADING REHAB"),y(),v(7,"p",6),C(8,"Where Disciplined Trading Begins"),y()(),v(9,"div",7)(10,"div",8)(11,"span",9),ae("click",function(){return r.setActiveTab("login")}),C(12,"Login"),y(),v(13,"span",10),C(14,"\u2022"),y(),v(15,"span",9),ae("click",function(){return r.setActiveTab("signup")}),C(16,"Sign Up"),y()()(),te(17,xse,2,1,"div",11)(18,Cse,22,4,"form",12)(19,Dse,35,7,"form",12),y()()),e&2&&(O(11),So("active",r.activeTab==="login"),O(4),So("active",r.activeTab==="signup"),O(2),U("ngIf",r.errorMessage),O(),U("ngIf",r.activeTab==="login"),O(),U("ngIf",r.activeTab==="signup"))},dependencies:[Pt,Ht,fo,uo,Pn,er,co,po,Ro],styles:['.auth-container[_ngcontent-%COMP%]{min-height:100vh;background:conic-gradient(#eaeafd,#9c9ce4,#eaeafd);display:flex;align-items:center;justify-content:center}.auth-card[_ngcontent-%COMP%]{background-color:transparent;border-radius:12px;width:100%;max-width:450px;padding:30px}.logo-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:transparent;position:relative;display:flex;align-items:center;justify-content:center;margin:0 auto}.dots-circle[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;position:relative;background-image:radial-gradient(circle,#5046e5 3px,transparent 3px);background-size:15px 15px;transform:rotate(45deg)}.brand-name[_ngcontent-%COMP%]{font-weight:700;font-size:24px;margin-bottom:5px;letter-spacing:.5px}.brand-tagline[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.tabs-container[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-bottom:1px solid #eee;padding-bottom:5px}.tab[_ngcontent-%COMP%]{padding:8px 15px;cursor:pointer;color:#888;font-weight:500;font-size:16px;transition:color .2s}.tab.active[_ngcontent-%COMP%]{color:#5046e5;border-bottom:2px solid #5046e5}.tab-separator[_ngcontent-%COMP%]{color:#ccc}.auth-form[_ngcontent-%COMP%]{margin-top:10px}.form-control[_ngcontent-%COMP%]{height:auto;padding:12px 15px;border-radius:8px;border:1px solid #ddd;transition:border-color .2s,box-shadow .2s}.form-control[_ngcontent-%COMP%]:focus{border-color:#5046e5;box-shadow:0 0 0 .2rem #5046e526}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#555;margin-bottom:8px}.forgot-link[_ngcontent-%COMP%]{font-size:14px;color:#5046e5;text-decoration:none}.forgot-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.signup-link[_ngcontent-%COMP%], .login-link[_ngcontent-%COMP%]{color:#5046e5;font-weight:500;text-decoration:none}.signup-link[_ngcontent-%COMP%]:hover, .login-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn-primary[_ngcontent-%COMP%]{background-color:#5046e5;border-color:#5046e5;padding:12px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover, .btn-primary[_ngcontent-%COMP%]:focus{background-color:#4238d0;border-color:#4238d0}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#a8a4e0;border-color:#a8a4e0}.separator[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#888;font-size:14px}.separator[_ngcontent-%COMP%]:before, .separator[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #ddd}.separator[_ngcontent-%COMP%]:before{margin-right:1em}.separator[_ngcontent-%COMP%]:after{margin-left:1em}.google-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#fff;border:1px solid #ddd;color:#333;padding:12px;font-weight:500}.google-btn[_ngcontent-%COMP%]:hover{background-color:#f8f8f8;color:#333}@media (max-width: 576px){.auth-card[_ngcontent-%COMP%]{padding:20px 15px}.brand-name[_ngcontent-%COMP%]{font-size:20px}.form-control[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{padding:10px}}']})};var i3=(t,n)=>({"btn-tr text-dark":t,"btn-tr":n}),Nse=(t,n)=>({"btn-tr  text-dark":t,"btn-tr  btn-outline-primary":n});function kse(t,n){if(t&1){let e=et();v(0,"button",15),ae("click",function(){let o;me(e);let i=Y();return he((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Executing"))}),z(1,"i",75),C(2," Executing "),y()}if(t&2){let e,r=Y();U("ngClass",is(1,i3,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Executing",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Executing"))}}function Ase(t,n){if(t&1){let e=et();v(0,"button",15),ae("click",function(){let o;me(e);let i=Y();return he((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Completed"))}),z(1,"i",76),C(2," Completed "),y()}if(t&2){let e,r=Y();U("ngClass",is(1,Nse,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Completed",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Completed"))}}function Rse(t,n){if(t&1){let e=et();v(0,"div",82)(1,"button",83),ae("click",function(){let o=me(e).index,i=Y(2);return he(i.removePlannedTrade(o))}),z(2,"i",84),y(),v(3,"h6",85),C(4),y(),v(5,"div",24)(6,"div",86)(7,"label",87),C(8,"Direction"),y(),v(9,"div",88),z(10,"input",89),v(11,"label",90),C(12,"Long"),y(),z(13,"input",91),v(14,"label",92),C(15,"Short"),y()()(),v(16,"div",86)(17,"label",87),C(18,"Entry Price"),y(),v(19,"div",27)(20,"span",28),C(21,"$"),y(),z(22,"input",93),y()(),v(23,"div",86)(24,"label",87),C(25,"Stop Loss"),y(),v(26,"div",27)(27,"span",28),C(28,"$"),y(),z(29,"input",94),y()(),v(30,"div",86)(31,"label",87),C(32,"Exit Price"),y(),v(33,"div",27)(34,"span",28),C(35,"$"),y(),z(36,"input",95),y()(),v(37,"div",25)(38,"label",87),C(39,"Planned Entry Time"),y(),z(40,"input",96),y(),v(41,"div",25)(42,"label",87),C(43,"Planned Exit Time"),y(),z(44,"input",97),y(),v(45,"div",25)(46,"label",87),C(47,"Exit Type"),y(),v(48,"select",98)(49,"option",33),C(50,"Select exit type"),y(),v(51,"option",99),C(52,"Target"),y(),v(53,"option",100),C(54,"Stop Loss"),y(),v(55,"option",101),C(56,"Manual"),y()()(),v(57,"div",25)(58,"label",87),C(59,"Position Size ($)"),y(),v(60,"div",27)(61,"span",28),C(62,"$"),y(),z(63,"input",102),y()(),v(64,"div",25)(65,"label",87),C(66,"Contracts/Shares"),y(),z(67,"input",103),y(),v(68,"div",25)(69,"label",87),C(70,"Multiplier"),y(),z(71,"input",104),y()(),v(72,"div",105)(73,"div",106),z(74,"div",107),y()()()}if(t&2){let e=n.index;U("formGroupName",e),O(4),$e("Planned Trade #",e+1,""),O(6),U("id","direction_long_"+e),O(),U("for","direction_long_"+e),O(2),U("id","direction_short_"+e),O(),U("for","direction_short_"+e)}}function Mse(t,n){if(t&1){let e=et();v(0,"div",18)(1,"div",19)(2,"h5",20),z(3,"i",77),C(4,"Planned Trades "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",78),te(9,Rse,75,6,"div",79),v(10,"button",80),ae("click",function(){me(e);let o=Y();return he(o.addPlannedTrade())}),z(11,"i",81),C(12,"Add Planned Trade "),y()()()()}if(t&2){let e=Y();O(9),U("ngForOf",e.plannedTrades.controls)}}function Fse(t,n){if(t&1){let e=et();v(0,"div",82)(1,"button",83),ae("click",function(){let o=me(e).index,i=Y(2);return he(i.removeExecutingTrade(o))}),z(2,"i",84),y(),v(3,"h6",85),C(4),y(),v(5,"div",24)(6,"div",86)(7,"label",87),C(8,"Direction"),y(),v(9,"div",88),z(10,"input",89),v(11,"label",90),C(12,"Long"),y(),z(13,"input",91),v(14,"label",92),C(15,"Short"),y()()(),v(16,"div",86)(17,"label",87),C(18,"Entry Price"),y(),v(19,"div",27)(20,"span",28),C(21,"$"),y(),z(22,"input",93),y()(),v(23,"div",86)(24,"label",87),C(25,"Stop Loss"),y(),v(26,"div",27)(27,"span",28),C(28,"$"),y(),z(29,"input",94),y()(),v(30,"div",86)(31,"label",87),C(32,"Exit Price"),y(),v(33,"div",27)(34,"span",28),C(35,"$"),y(),z(36,"input",95),y()(),v(37,"div",25)(38,"label",87),C(39,"Entry Time"),y(),z(40,"input",96),y(),v(41,"div",25)(42,"label",87),C(43,"Exit Time"),y(),z(44,"input",97),y(),v(45,"div",25)(46,"label",87),C(47,"Exit Type"),y(),v(48,"select",98)(49,"option",33),C(50,"Select exit type"),y(),v(51,"option",99),C(52,"Target"),y(),v(53,"option",100),C(54,"Stop Loss"),y(),v(55,"option",101),C(56,"Manual"),y()()(),v(57,"div",25)(58,"label",87),C(59,"Position Size ($)"),y(),v(60,"div",27)(61,"span",28),C(62,"$"),y(),z(63,"input",102),y()(),v(64,"div",25)(65,"label",87),C(66,"Contracts/Shares"),y(),z(67,"input",103),y(),v(68,"div",25)(69,"label",87),C(70,"Multiplier"),y(),z(71,"input",104),y()()()}if(t&2){let e=n.index;U("formGroupName",e),O(4),$e("Trade Execution #",e+1,""),O(6),U("id","exec_direction_long_"+e),O(),U("for","exec_direction_long_"+e),O(2),U("id","exec_direction_short_"+e),O(),U("for","exec_direction_short_"+e)}}function Ose(t,n){if(t&1){let e=et();v(0,"div",18)(1,"div",19)(2,"h5",20),z(3,"i",77),C(4,"Executing Trades "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",108),te(9,Fse,72,6,"div",79),v(10,"button",80),ae("click",function(){me(e);let o=Y();return he(o.addExecutingTrade())}),z(11,"i",81),C(12,"Add Executing Trade "),y()()()()}if(t&2){let e=Y();O(9),U("ngForOf",e.executingTrades.controls)}}function Pse(t,n){t&1&&(v(0,"div",64),z(1,"i",135),v(2,"span",136),C(3," Consider if this emotional state might negatively impact your decision making"),y()())}function Lse(t,n){if(t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),z(3,"i",109),C(4,"Emotional Analysis "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",110)(9,"div",24)(10,"div",39)(11,"label",111),C(12,"Emotional State"),y(),v(13,"select",112)(14,"option",33),C(15,"How are you feeling?"),y(),v(16,"option",113),C(17,"Calm & Focused"),y(),v(18,"option",114),C(19,"Excited"),y(),v(20,"option",115),C(21,"Anxious"),y(),v(22,"option",116),C(23,"Frustrated"),y(),v(24,"option",117),C(25,"Overconfident"),y(),v(26,"option",118),C(27,"Fearful"),y(),v(28,"option",119),C(29,"Neutral"),y(),v(30,"option",38),C(31,"Other"),y()(),te(32,Pse,4,0,"div",120),y(),v(33,"div",39)(34,"label",121),C(35,"Trade Confidence"),y(),v(36,"div",88),z(37,"input",122),v(38,"label",123),C(39,"1"),y(),z(40,"input",124),v(41,"label",125),C(42,"2"),y(),z(43,"input",126),v(44,"label",127),C(45,"3"),y(),z(46,"input",128),v(47,"label",129),C(48,"4"),y(),z(49,"input",130),v(50,"label",131),C(51,"5"),y()(),v(52,"div",132),C(53,"Low (1) to High (5)"),y()()(),v(54,"div",55)(55,"label",133),C(56,"Reflection"),y(),z(57,"textarea",134),y()()()()),t&2){let e=Y();O(32),U("ngIf",e.isNegativeEmotionalState())}}function $se(t,n){t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),z(3,"i",109),C(4,"Profit Analysis "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",24)(9,"div",25)(10,"label",137),C(11,"Realized Profit"),y(),v(12,"div",27)(13,"span",28),C(14,"$"),y(),z(15,"input",138),y()(),v(16,"div",25)(17,"label",139),C(18,"Unrealized Profit"),y(),v(19,"div",27)(20,"span",28),C(21,"$"),y(),z(22,"input",140),y()(),v(23,"div",25)(24,"label",141),C(25,"Total Profit"),y(),v(26,"div",27)(27,"span",28),C(28,"$"),y(),z(29,"input",142),y()()()()())}function Vse(t,n){t&1&&(v(0,"div",18)(1,"div",19)(2,"h5",20),z(3,"i",143),C(4,"Post-Trade Reflection "),y(),v(5,"span",22),C(6,"Required"),y()(),v(7,"div",23)(8,"div",144)(9,"div",24)(10,"div",39)(11,"label",145),C(12,"Emotional State"),y(),v(13,"select",146)(14,"option",33),C(15,"How are you feeling?"),y(),v(16,"option",147),C(17,"Satisfied"),y(),v(18,"option",114),C(19,"Excited"),y(),v(20,"option",148),C(21,"Disappointed"),y(),v(22,"option",116),C(23,"Frustrated"),y(),v(24,"option",117),C(25,"Overconfident"),y(),v(26,"option",119),C(27,"Neutral"),y(),v(28,"option",38),C(29,"Other"),y()()(),v(30,"div",39)(31,"label",149),C(32,"Trade Confidence for Next Time"),y(),v(33,"div",88),z(34,"input",150),v(35,"label",151),C(36,"1"),y(),z(37,"input",152),v(38,"label",153),C(39,"2"),y(),z(40,"input",154),v(41,"label",155),C(42,"3"),y(),z(43,"input",156),v(44,"label",157),C(45,"4"),y(),z(46,"input",158),v(47,"label",159),C(48,"5"),y()(),v(49,"div",132),C(50,"Low (1) to High (5)"),y()()(),v(51,"div",55)(52,"label",160),C(53,"Trade Reflection"),y(),z(54,"textarea",161),y()()()())}var Tf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabase=r}tradeData;mode="create";tradeAccountId;formSubmitted=new Ot;cancel=new Ot;tradeForm;tableName="tradejournal";trade_account_id;ngOnInit(){this.trade_account_id=this.tradeAccountId??"",this.initForm()}ngOnChanges(n){n.tradeAccountId&&(this.trade_account_id=n.tradeAccountId.currentValue),n.tradeData&&!n.tradeData.firstChange&&(this.populateForm(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)}),this.tradeData&&(this.mode="edit"))}initForm(){let n=this.mode==="create"?sd():this.tradeData?.tradeid;this.tradeForm=this.fb.group({tradeid:n,userid:this.supabase.user()?.id,updated_time:[""],trade_symbol:["",Ee.required],trade_analysis:[""],trade_instrument:[""],type_of_order:[""],market_condition:[""],trade_status:["Planned"],strategy_name:[""],entry_criteria:[""],exit_criteria:[""],planned_trade:this.fb.array([]),executing_trades:this.fb.array([]),realized_profit:[0,Ee.required],unrealized_profit:[0,Ee.required],planned_profit:[0,Ee.required],emotion_before:this.fb.group({emotional_state_before:[""],trade_confidence_before:[""],reflection_before:[""]}),emotion_after:this.fb.group({emotional_state_after:[""],trade_confidence_after:[""],reflection_after:[""]}),notes:[""],trade_account_id:this.trade_account_id}),this.tradeForm.get("trade_status")?.valueChanges.subscribe(e=>{this.handleStatusChange(e)}),this.handleStatusChange("Planned"),this.tradeData&&(this.populateForm(),this.mode="edit")}get plannedTrades(){return this.tradeForm.get("planned_trade")}get executingTrades(){return this.tradeForm.get("executing_trades")}newTradeGroup(n=!1){let e={entry_price:[""],exit_price:[""],stop_loss:[""],trade_direction:[""],entry_time:[""],exit_time:[""],exit:[""],position_size:[""],contracts:[""],contract_multiplier:[""]};return n&&(e.profit=[""]),this.fb.group(e)}addPlannedTrade(){this.plannedTrades.push(this.newTradeGroup())}removePlannedTrade(n){this.plannedTrades.removeAt(n)}addExecutingTrade(){this.executingTrades.push(this.newTradeGroup(!0))}removeExecutingTrade(n){this.executingTrades.removeAt(n)}populateForm(){this.tradeData&&(this.tradeForm.patchValue(this.tradeData),this.plannedTrades.clear(),this.executingTrades.clear(),this.tradeData.planned_trade?.forEach(n=>{this.plannedTrades.push(this.fb.group(n))}),this.tradeData.executing_trades?.forEach(n=>{this.executingTrades.push(this.fb.group(n))}),this.handleStatusChange(this.tradeData.trade_status))}handleStatusChange(n){let e=this.tradeForm.get("emotion_after"),r=this.tradeForm.get("emotion_before");n==="Planned"?(this.executingTrades.disable(),e.disable(),r.enable()):n==="Executing"?(this.executingTrades.enable(),e.disable(),r.enable(),this.executingTrades.length===0&&this.plannedTrades.length>0&&this.plannedTrades.controls.forEach(o=>{this.executingTrades.push(this.fb.group(o.value))})):n==="Completed"&&(this.executingTrades.enable(),e.enable(),r.disable()),this.cdr.markForCheck(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)})}async onSubmit(){if(this.tradeForm.valid){this.tradeForm.patchValue({updated_time:new Date().toISOString()});let n=this.tradeForm.getRawValue();try{this.mode==="create"?await this.supabase.addTradeLogOfSelectedAccount(n,this.tableName,this.tradeAccountId):this.mode==="edit"&&await this.supabase.updateTradeLogOfSelectedAccount(n,this.tableName,this.tradeAccountId),this.formSubmitted.emit()}catch(e){console.error("Error submitting trade:",e)}}else console.log("Invalid form")}onCancel(){this.cancel.emit()}isNegativeEmotionalState(){let n=this.tradeData?this.tradeData.emotion_before:"calm";return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}static \u0275fac=function(e){return new(e||t)(ne(ei),ne(It),ne(kt))};static \u0275cmp=ht({type:t,selectors:[["app-individual-trade"]],inputs:{tradeData:"tradeData",mode:"mode",tradeAccountId:"tradeAccountId"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},features:[Ho],decls:147,vars:14,consts:[[1,"container","my-4"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["routerLink","/tradejournal",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"needs-validation",3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","d-block","mb-2"],["role","group","aria-label","Trade status toggle",1,"btn-group","w-100","shadow-sm"],["type","button",1,"btn",3,"click","ngClass"],[1,"bi","bi-hourglass","me-1"],["type","button","class","btn",3,"ngClass","click",4,"ngIf"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],["for","trade_symbol",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-tag"],["type","text","id","trade_symbol","formControlName","trade_symbol","placeholder","Enter ticker symbol",1,"form-control"],["for","trade_analysis",1,"form-label"],["id","trade_analysis","formControlName","trade_analysis",1,"form-select"],["value","","selected","","disabled",""],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["value","Other"],[1,"col-md-6"],["for","trade_instrument",1,"form-label"],["id","trade_instrument","formControlName","trade_instrument",1,"form-select"],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["for","type_of_order",1,"form-label"],["id","type_of_order","formControlName","type_of_order",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","market_condition",1,"form-label"],["id","market_condition","rows","3","formControlName","market_condition","placeholder","Describe current market conditions and relevant factors",1,"form-control"],[1,"bi","bi-2-circle","me-2"],[1,"card-body","col-12"],["for","strategy_name",1,"form-label"],["type","text","id","strategy_name","formControlName","strategy_name","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","entry_criteria",1,"form-label"],["id","entry_criteria","rows","4","formControlName","entry_criteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)",1,"form-control"],[1,"form-text"],["for","exit_criteria",1,"form-label"],["id","exit_criteria","rows","4","formControlName","exit_criteria","placeholder","Define your profit targets and stop loss levels",1,"form-control"],["class","card mb-4 shadow-sm",4,"ngIf"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],[1,"p-3"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-tr-secondary","me-2","mt-3",3,"click"],["type","submit",1,"btn","btn-primary","btn-tr","mt-3"],[1,"bi","bi-play-fill","me-1"],[1,"bi","bi-check-circle","me-1"],[1,"bi","bi-3-circle","me-2"],["formArrayName","planned_trade"],["class","border rounded p-3 mb-3 position-relative",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-outline-primary","w-100",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"border","rounded","p-3","mb-3","position-relative",3,"formGroupName"],["type","button",1,"btn","btn-sm","btn-danger","position-absolute","end-0","top-0","m-2",3,"click"],[1,"bi","bi-x"],[1,"mb-3"],[1,"col-md-3"],[1,"form-label"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","trade_direction","value","Long",1,"btn-check",3,"id"],[1,"btn","btn-outline-success",3,"for"],["type","radio","formControlName","trade_direction","value","Short",1,"btn-check",3,"id"],[1,"btn","btn-outline-danger",3,"for"],["type","number","step","0.01","placeholder","Entry Price","formControlName","entry_price",1,"form-control"],["type","number","step","0.01","placeholder","Stop Loss","formControlName","stop_loss",1,"form-control"],["type","number","step","0.01","placeholder","Exit Price","formControlName","exit_price",1,"form-control"],["type","datetime-local","formControlName","entry_time",1,"form-control"],["type","datetime-local","formControlName","exit_time",1,"form-control"],["formControlName","exit",1,"form-select"],["value","Target"],["value","StopLoss"],["value","Manual"],["type","number","step","0.01","placeholder","Position Size","formControlName","position_size",1,"form-control"],["type","number","placeholder","Contracts","formControlName","contracts",1,"form-control"],["type","number","step","0.01","placeholder","Multiplier","formControlName","contract_multiplier",1,"form-control"],[1,"mt-3"],[1,"progress",2,"height","5px"],["role","progressbar",1,"progress-bar",2,"width","100%"],["formArrayName","executing_trades"],[1,"bi","bi-4-circle","me-2"],["formGroupName","emotion_before"],["for","emotional_state_before",1,"form-label"],["id","emotional_state_before","formControlName","emotional_state_before",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],["class","form-text",4,"ngIf"],["for","trade_confidence_before",1,"form-label"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_1","value","1",1,"btn-check"],["for","confidence_before_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_2","value","2",1,"btn-check"],["for","confidence_before_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_3","value","3",1,"btn-check"],["for","confidence_before_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_4","value","4",1,"btn-check"],["for","confidence_before_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_5","value","5",1,"btn-check"],["for","confidence_before_5",1,"btn","btn-outline-success"],[1,"form-text","text-center"],["for","reflection_before",1,"form-label"],["id","reflection_before","formControlName","reflection_before","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO)","rows","2",1,"form-control"],[1,"bi","bi-exclamation-triangle","text-warning"],[1,"text-warning"],["for","realized_profit",1,"form-label"],["type","number","step","0.01","id","realized_profit","formControlName","realized_profit",1,"form-control"],["for","unrealized_profit",1,"form-label"],["type","number","step","0.01","id","unrealized_profit","formControlName","unrealized_profit",1,"form-control"],["for","planned_profit",1,"form-label"],["type","number","step","0.01","id","planned_profit","formControlName","planned_profit",1,"form-control"],[1,"bi","bi-5-circle","me-2"],["formGroupName","emotion_after"],["for","emotional_state_after",1,"form-label"],["id","emotional_state_after","formControlName","emotional_state_after",1,"form-select"],["value","Satisfied"],["value","Disappointed"],["for","trade_confidence_after",1,"form-label"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_1","value","1",1,"btn-check"],["for","confidence_after_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_2","value","2",1,"btn-check"],["for","confidence_after_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_3","value","3",1,"btn-check"],["for","confidence_after_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_4","value","4",1,"btn-check"],["for","confidence_after_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_5","value","5",1,"btn-check"],["for","confidence_after_5",1,"btn","btn-outline-success"],["for","reflection_after",1,"form-label"],["id","reflection_after","formControlName","reflection_after","placeholder","What did you learn? What could be improved?","rows","2",1,"form-control"]],template:function(e,r){if(e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",3)(7,"a",5),C(8,"Trade Logs"),y()(),v(9,"li",6),C(10,"Trade Form"),y()()(),v(11,"div",7)(12,"div",8)(13,"h2",9),C(14),y(),v(15,"p",10),C(16,"Document your trading strategy and execution to maintain discipline and improve performance"),y()()(),v(17,"form",11),ae("ngSubmit",function(){return r.onSubmit()}),v(18,"div",12)(19,"label",13),C(20,"Trade Status"),y(),v(21,"div",14)(22,"button",15),ae("click",function(){let i;return(i=r.tradeForm.get("trade_status"))==null?null:i.setValue("Planned")}),z(23,"i",16),C(24," Planned "),y(),te(25,kse,3,4,"button",17)(26,Ase,3,4,"button",17),y()(),v(27,"div",18)(28,"div",19)(29,"h5",20),z(30,"i",21),C(31,"Trade Setup "),y(),v(32,"span",22),C(33,"Required"),y()(),v(34,"div",23)(35,"div",24)(36,"div",25)(37,"label",26),C(38,"Trade Symbol"),y(),v(39,"div",27)(40,"span",28),z(41,"i",29),y(),z(42,"input",30),y()(),v(43,"div",25)(44,"label",31),C(45,"Trade Analysis"),y(),v(46,"select",32)(47,"option",33),C(48,"Choose analysis method"),y(),v(49,"option",34),C(50,"Technical"),y(),v(51,"option",35),C(52,"Fundamental"),y(),v(53,"option",36),C(54,"Both"),y(),v(55,"option",37),C(56,"Sentiment"),y(),v(57,"option",38),C(58,"Other"),y()()(),v(59,"div",39)(60,"label",40),C(61,"Trade Instrument"),y(),v(62,"select",41)(63,"option",33),C(64,"Choose instrument type"),y(),v(65,"option",42),C(66,"Forex"),y(),v(67,"option",43),C(68,"Stocks"),y(),v(69,"option",44),C(70,"Futures"),y(),v(71,"option",45),C(72,"Crypto"),y(),v(73,"option",46),C(74,"Options"),y(),v(75,"option",47),C(76,"ETF"),y(),v(77,"option",38),C(78,"Other"),y()()(),v(79,"div",39)(80,"label",48),C(81,"Type of Order"),y(),v(82,"select",49)(83,"option",33),C(84,"Choose order type"),y(),v(85,"option",50),C(86,"Market"),y(),v(87,"option",51),C(88,"Limit"),y(),v(89,"option",52),C(90,"Stop"),y(),v(91,"option",53),C(92,"Stop Limit"),y(),v(93,"option",54),C(94,"Trailing Stop"),y()()(),v(95,"div",55)(96,"label",56),C(97,"Market Condition"),y(),z(98,"textarea",57),y()()()(),v(99,"div",18)(100,"div",19)(101,"h5",20),z(102,"i",58),C(103,"Trade Strategy "),y(),v(104,"span",22),C(105,"Required"),y()(),v(106,"div",59)(107,"label",60),C(108,"Strategy Name"),y(),z(109,"input",61),y(),v(110,"div",23)(111,"div",24)(112,"div",39)(113,"label",62),C(114,"Entry Criteria "),v(115,"span",10),C(116,"(Why are you taking this trade?)"),y()(),z(117,"textarea",63),v(118,"div",64),C(119,"Be specific about what signals or conditions must be met for entry."),y()(),v(120,"div",39)(121,"label",65),C(122,"Exit Criteria "),v(123,"span",10),C(124,"(How will you close this position?)"),y()(),z(125,"textarea",66),v(126,"div",64),C(127,"Include both profit-taking and loss-cutting criteria."),y()()()()(),te(128,Mse,13,1,"div",67)(129,Ose,13,1,"div",67)(130,Lse,58,1,"div",67)(131,$se,30,0,"div",67)(132,Vse,55,0,"div",67),v(133,"div",18)(134,"div",19)(135,"h5",20),z(136,"i",68),C(137,"Additional Notes "),y(),v(138,"span",69),C(139,"Optional"),y()(),v(140,"div",70),z(141,"textarea",71),y()(),v(142,"div",72)(143,"button",73),ae("click",function(){return r.onCancel()}),C(144,"Cancel"),y(),v(145,"button",74),C(146),y()()()()),e&2){let o,i,s,a,l,c;O(14),tt(r.mode==="edit"?"Edit Trade":"Create Trade"),O(3),U("formGroup",r.tradeForm),O(5),U("ngClass",is(11,i3,((o=r.tradeForm.get("trade_status"))==null?null:o.value)==="Planned",((o=r.tradeForm.get("trade_status"))==null?null:o.value)!=="Planned")),O(3),U("ngIf",r.mode==="edit"),O(),U("ngIf",r.mode==="edit"),O(102),U("ngIf",((i=r.tradeForm.get("trade_status"))==null?null:i.value)==="Planned"),O(),U("ngIf",((s=r.tradeForm.get("trade_status"))==null?null:s.value)!=="Planned"),O(),U("ngIf",((a=r.tradeForm.get("trade_status"))==null?null:a.value)!=="Completed"),O(),U("ngIf",((l=r.tradeForm.get("trade_status"))==null?null:l.value)==="Completed"),O(),U("ngIf",((c=r.tradeForm.get("trade_status"))==null?null:c.value)==="Completed"),O(14),$e(" ",r.mode==="edit"?"Update Trade":"Save Trade"," ")}},dependencies:[Pt,Yo,Jn,Ht,fo,uo,ps,fs,Pn,aa,ds,la,er,co,po,Ro,wb,Cb,Fn],encapsulation:2})};var Bse=(t,n,e)=>({"status-planned-card":t,"status-executing-card":n,"status-completed-card":e}),zse=(t,n,e)=>({"status-planned":t,"status-executing":n,"status-completed":e});function Use(t,n){if(t&1&&(v(0,"option",18),C(1),y()),t&2){let e=n.$implicit,r=Y();U("value",e.account_id)("selected",e.account_id===r.tradeAccountId),O(),$e(" ",e.account_name," ")}}function jse(t,n){t&1&&(v(0,"div",19),C(1,"Loading trade logs..."),y())}function Gse(t,n){if(t&1&&(v(0,"div",20),C(1),y()),t&2){let e=Y();O(),tt(e.errorMessage)}}function Wse(t,n){if(t&1){let e=et();Zs(0),v(1,"div",27)(2,"div",28),ae("click",function(){me(e);let o=Y().$implicit,i=Y(3);return he(i.openEditModal(o))}),v(3,"div",29),z(4,"i",30),C(5),y(),v(6,"div",31),ae("click",function(o){me(e);let i=Y().$implicit,s=Y(3);return he(s.onDeleteTradeLog(i,o))}),z(7,"i",32),y(),v(8,"div",33)(9,"h4",34),C(10),y(),v(11,"h5",35),C(12),y(),v(13,"div",36)(14,"div",37)(15,"strong"),C(16,"Account Name:"),y(),C(17),y(),v(18,"div",37)(19,"strong"),C(20,"Analysis:"),y(),C(21),y(),v(22,"div",37)(23,"strong"),C(24,"Profit:"),y(),C(25),y()(),v(26,"div",38)(27,"small",39),C(28),Ni(29,"date"),y()()()()(),Qs()}if(t&2){let e=Y().$implicit;O(2),U("ngClass",zl(15,Bse,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),O(),U("ngClass",zl(19,zse,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),O(2),$e(" ",e.trade_status," "),O(5),tt(e.trade_symbol),O(2),Uu(" ",e.trade_instrument," | ",e.type_of_order," "),O(5),$e(" ",e.account_name," "),O(4),$e(" ",e.trade_analysis," "),O(4),jh(" Realized: ",e.realized_profit," | Unrealized: ",e.unrealized_profit," | Planned: ",e.planned_profit," "),O(3),$e("Last modified: ",ki(29,12,e.updated_time,"medium"),"")}}function Hse(t,n){if(t&1&&(Zs(0),te(1,Wse,30,23,"ng-container",26),Qs()),t&2){let e=n.$implicit,r=Y().$implicit;O(),U("ngIf",e.trade_status===r.status)}}function qse(t,n){if(t&1&&(v(0,"div",23)(1,"h3"),C(2),y(),v(3,"div",24),te(4,Hse,2,1,"ng-container",25),y()()),t&2){let e=n.$implicit,r=Y(2);O(2),tt(e.title),O(2),U("ngForOf",r.tradeLogs)}}function Kse(t,n){if(t&1&&(v(0,"div",21),te(1,qse,5,2,"div",22),y()),t&2){let e=Y();O(),U("ngForOf",e.tradeStatus)}}function Xse(t,n){t&1&&(v(0,"div",40),C(1," No trade logs found. "),y())}function Yse(t,n){if(t&1){let e=et();v(0,"div",41),ae("click",function(o){me(e);let i=Y();return he(i.closeModalOnOverlayClick(o))}),v(1,"div",42),ae("click",function(o){return me(e),he(o.stopPropagation())}),v(2,"app-individual-trade",43),ae("formSubmitted",function(){me(e);let o=Y();return he(o.onFormSubmitted())})("cancel",function(){me(e);let o=Y();return he(o.closeModal())}),y()()()}if(t&2){let e=Y();O(2),U("tradeData",e.selectedTradeLog)("mode",e.selectedTradeLog?"edit":"create")("tradeAccountId",e.tradeAccountId)}}var Ab=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="tradejournal";tradeLogs=[];tradeAccounts=[];loading=!1;errorMessage="";tradeAccountId="";showModal=!1;selectedTradeLog=null;tradeStatus=[{status:"Planned",title:"Planning Phase"},{status:"Executing",title:"Executing Phase"},{status:"Completed",title:"Completed Phase"}];async ngOnInit(){this.loading=!0,await this.fetchTradeAccounts(),await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{let n=await this.supabaseService.getTradeLogsOfSelectedAccount(this.tableName,this.tradeAccountId);this.tradeLogs=n.sort((e,r)=>new Date(r.updated_time).getDate()-new Date(e.updated_time).getTime()),this.cdr.markForCheck()}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}async fetchTradeAccounts(){try{this.tradeAccounts=await this.supabaseService.getUserTradeAccounts(),this.tradeAccounts.length&&(this.tradeAccountId=this.tradeAccounts[0].account_id)}catch(n){console.error("Error fetching trade accounts:",n),this.errorMessage="Error loading trade accounts."}}onAccountChange(n){let e=n.target;this.tradeAccountId=e.value,this.fetchTradeLogs(),this.cdr.markForCheck()}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}openAddModal(){this.selectedTradeLog=null,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal(),this.cdr.markForCheck()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLogOfSelectedAccount(n.tradeid,this.tableName,this.tradeAccountId),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(ne(kt),ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-trade-journal"]],decls:25,vars:6,consts:[[1,"container","mt-3"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","justify-content-center"],[1,"btn","btn-tr","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"form-group","mt-4","mb-3"],["for","accountSelector"],["id","accountSelector",1,"form-control","w-auto","d-inline-block","ms-2",3,"change"],[3,"value","selected",4,"ngFor","ngForOf"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[3,"value","selected"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"mt-5"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"mt-3","row"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"col-md-3","col-sm-6","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"mb-2"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeData","mode","tradeAccountId"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Trade Journal"),y()()(),v(8,"div",6)(9,"h2"),C(10,"Trade Journal"),y(),v(11,"button",7),ae("click",function(){return r.openAddModal()}),z(12,"i",8),C(13," Add "),y()(),v(14,"div",9)(15,"label",10)(16,"strong"),C(17,"Select Trade Account:"),y()(),v(18,"select",11),ae("change",function(i){return r.onAccountChange(i)}),te(19,Use,2,3,"option",12),y()(),te(20,jse,2,0,"div",13)(21,Gse,2,1,"div",14)(22,Kse,2,1,"div",15)(23,Xse,2,0,"div",16),y(),te(24,Yse,3,3,"div",17)),e&2&&(O(19),U("ngForOf",r.tradeAccounts),O(),U("ngIf",r.loading),O(),U("ngIf",r.errorMessage),O(),U("ngIf",r.tradeLogs&&r.tradeLogs.length),O(),U("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),O(),U("ngIf",r.showModal))},dependencies:[fo,ps,fs,Pt,Yo,Jn,Ht,as,Tf,Fn],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:5px;color:#fff;font-size:.7rem}.status-planned[_ngcontent-%COMP%]{background-color:#007bff}.status-executing[_ngcontent-%COMP%]{background-color:#ffc107}.status-completed[_ngcontent-%COMP%]{background-color:#28a745}.status-planned-card[_ngcontent-%COMP%]{border-left:4px solid #007bff!important}.status-executing-card[_ngcontent-%COMP%]{border-left:4px solid #ffc107!important}.status-completed-card[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;display:none;color:red;cursor:pointer}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;max-width:800px;width:100%;position:relative;max-height:98vh;overflow-y:auto}"]})};function Zse(t,n){if(t&1&&(v(0,"p",10),C(1),y()),t&2){let e=Y().$implicit;O(),$e("Duration: ",e.duration,"")}}function Qse(t,n){if(t&1&&z(0,"div",11),t&2){let e=Y().index;tx("id","player-",e,"")}}function Jse(t,n){if(t&1){let e=et();v(0,"div",3)(1,"div",4)(2,"img",5),ae("click",function(){let o=me(e).$implicit,i=Y();return he(i.togglePlayer(o))}),y(),v(3,"div",6)(4,"h5",7),C(5),y(),te(6,Zse,2,1,"p",8),y(),te(7,Qse,1,2,"div",9),y()()}if(t&2){let e=n.$implicit;O(2),U("src",e.thumbnail,Bl),O(2),zu("title",e.title),O(),tt(e.title),O(),U("ngIf",e.duration),O(),U("ngIf",e.isPlayerVisible)}}var Rb=class t{cdr=ie(It);ngZone=ie(sn);videoUrls=["https://www.youtube.com/watch?v=1kXLsrun51s","https://youtu.be/wbjNtTH0lJo?si=dnO-8ek8lvqNvOxm","https://www.youtube.com/watch?v=-t-EIBKd90c3"];videos=[];ngOnInit(){this.initializeVideos(),this.fetchVideoTitles()}ngAfterViewInit(){this.loadYouTubeAPI()}initializeVideos(){this.videos=this.videoUrls.map(n=>{let e=this.extractVideoId(n);return e?{url:n,id:e,thumbnail:`https://img.youtube.com/vi/${e}/hqdefault.jpg`,isPlayerVisible:!1}:null}).filter(n=>n!==null)}fetchVideoTitles(){this.videos.forEach(n=>{fetch(`https://www.youtube.com/oembed?url=${encodeURIComponent(`https://www.youtube.com/watch?v=${n.id}`)}&format=json`).then(e=>e.json()).then(e=>{this.ngZone.run(()=>{n.title=e.title,this.cdr.markForCheck()})}).catch(()=>{this.ngZone.run(()=>{n.title="Unknown Title",this.cdr.markForCheck()})})})}loadYouTubeAPI(){window.YT||this.ngZone.runOutsideAngular(()=>{let n=document.createElement("script");n.src="https://www.youtube.com/iframe_api",document.body.appendChild(n)}),window.onYouTubeIframeAPIReady=()=>{this.ngZone.runOutsideAngular(()=>{this.videos.forEach((n,e)=>{new YT.Player(`player-${e}`,{height:"360",width:"640",videoId:n.id,events:{onReady:r=>{let o=r.target.getDuration(),i=this.formatDuration(o);this.ngZone.run(()=>{n.duration=i,this.cdr.markForCheck()})}}})})})}}extractVideoId(n){let e=n.match(/(?:youtube\.com\/(?:.*v=)|youtu\.be\/)\S*?([a-zA-Z0-9_-]{11})/);return e?e[1]:null}formatDuration(n){let e=Math.floor(n/60),r=n%60;return`${e}:${r<10?"0"+r:r}`}togglePlayer(n){this.ngZone.run(()=>{n.isPlayerVisible=!n.isPlayerVisible,this.cdr.markForCheck()})}static \u0275fac=function(e){return new(e||t)};static \u0275cmp=ht({type:t,selectors:[["app-meditation-hub"]],decls:5,vars:1,consts:[[1,"container","mt-4"],[1,"row"],["class","col-sm-6 col-md-4 col-lg-3 mb-4",4,"ngFor","ngForOf"],[1,"col-sm-6","col-md-4","col-lg-3","mb-4"],[1,"card","h-100","shadow-sm"],["alt","Video thumbnail",1,"card-img-top",3,"click","src"],[1,"card-body","d-flex","flex-column"],[1,"card-title","text-truncate",3,"title"],["class","card-text mt-auto",4,"ngIf"],[3,"id",4,"ngIf"],[1,"card-text","mt-auto"],[3,"id"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"h2"),C(2,"Meditation Videos"),y(),v(3,"div",1),te(4,Jse,8,5,"div",2),y()()),e&2&&(O(4),U("ngForOf",r.videos))},dependencies:[Pt,Jn,Ht],encapsulation:2,changeDetection:0})};var Mb=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=ht({type:t,selectors:[["app-analytics"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(v(0,"h1",0),C(1,"Analytics Coming soon"),y())},encapsulation:2})};var cd=class{constructor(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)}set(n,e){this.dataIdsCount++,this.data.set(n,e)}has(n){return this.data.has(n)}delete(n){return this.dataIdsCount--,this.data.delete(n)}numDataIds(){return this.dataIdsCount}},ua=class{refCount(n){return ti("refCount")}incRef(n){return ti("incRef")}timerAvailable(){return!0}time(n){return ti("time")}read(n){return ti("read")}readSync(n){return ti("readSync")}numDataIds(){return ti("numDataIds")}disposeData(n,e){return ti("disposeData")}write(n,e,r){return ti("write")}move(n,e,r,o,i){return ti("move")}memory(){return ti("memory")}floatPrecision(){return ti("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return ti("dispose")}};function ti(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function s3(t){let n=t.length,e=0,r=0;for(;n>0;)r=Math.random()*n|0,n--,e=t[n],t[n]=t[r],t[r]=e}function eae(t,n){if(t.length!==n.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${n.length}`);let e=t.length,r,o,i=0;for(;e>0;)i=Math.random()*e|0,e--,r=t[e],o=n[e],t[e]=t[i],n[e]=n[i],t[i]=r,n[i]=o}function Df(t,n,e){return Math.max(t,Math.min(n,e))}function tae(t){return t%2===0?t:t+1}function nae(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function rae(t,n){let e=Math.random();return n*e+(1-e)*t}function oae(t,n){let e=0;for(let r=0;r<t.length;r++){let o=Number(t[r])-Number(n[r]);e+=o*o}return e}function F(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function Fb(t,n,e=""){F(hs(t,n),()=>e+` Shapes ${t} and ${n} must match`)}function Zg(t){F(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function tc(t,n=[],e=!1){if(n==null&&(n=[]),Array.isArray(t)||mo(t)&&!e)for(let r=0;r<t.length;++r)tc(t[r],n,e);else n.push(t);return n}function Lt(t){if(t.length===0)return 1;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];return n}function iae(t){return t.length===0}function hs(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function bt(t){return t%1===0}function sae(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let n=Math.exp(2*t);return(n-1)/(n+1)}}function aae(t){let n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function lae(t){let n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return s3(n),n}function dd(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function cae(t,n=r=>0,e){return new Promise((r,o)=>{let i=0,s=()=>{if(t()){r();return}i++;let a=n(i);if(e!=null&&i>=e){o();return}setTimeout(s,a)};s()})}function uae(t,n){let e=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(n>0&&n!==e)throw Error(`Size(${n}) must match the product of shape ${t}`);return t}if(e===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(n%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${n} / ${e}`);let o=t.slice();return o[r]=n/e,o}function En(t,n){let e=n.length;return t=t==null?n.map((r,o)=>o):[].concat(t),F(t.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${t}`),F(t.every(r=>bt(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?e+r:r)}function cD(t,n){let e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:En(n,t).sort(),s=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[s]==null||i[s]>a)&&t[a]===1&&(e.push(t[a]),r.push(a)),i[s]<=a&&s++}t[a]!==1&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function dae(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);return e}function uD(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else if(t==="string")e=new Array(n);else throw new Error(`Unknown data type ${t}`);return e}function dD(t,n){for(let e=0;e<t.length;e++){let r=t[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${n} being uploaded contains ${r}.`)}}function pD(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function pae(t,n){return!(n==="complex64"||n==="float32"&&t!=="complex64"||n==="int32"&&t!=="float32"&&t!=="complex64"||n==="bool"&&t==="bool")}function mo(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Ob(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function fD(t){if(t==null)return 0;let n=0;return t.forEach(e=>n+=e.length),n}function Nf(t){return typeof t=="string"||t instanceof String}function a3(t){return typeof t=="boolean"}function l3(t){return typeof t=="number"}function kf(t){return Array.isArray(t)?kf(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":l3(t)?"float32":Nf(t)?"string":a3(t)?"bool":"float32"}function Af(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Rf(t,n){for(let e=n;e<t;++e)if(t%e===0)return e;return t}function gs(t){let n=t.length;if(n<2)return[];let e=new Array(n-1);e[n-2]=t[n-1];for(let r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function c3(t,n,e,r=!1){let o=new Array;if(n.length===1){let i=n[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[t+s]}else{let i=n[0],s=n.slice(1),a=s.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)o[l]=c3(t+l*a,s,e,r)}return o}function ud(t,n,e=!1){if(t.length===0)return n[0];let r=t.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==n.length)throw new Error(`[${t}] does not match the input size ${n.length}${e?" for a complex tensor":""}.`);return c3(0,t,n,e)}function Qg(t,n){let e=Mf(t,n);for(let r=0;r<e.length;r++)e[r]=1;return e}function Mf(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${n}`)}function fae(t,n){let e=t.reduce((r,o)=>r*o,1);if(n==null||n==="float32")return ud(t,new Float32Array(e));if(n==="int32")return ud(t,new Int32Array(e));if(n==="bool")return ud(t,new Uint8Array(e));throw new Error(`Unknown data type ${n}`)}function Jg(t){t.forEach(n=>{F(Number.isInteger(n)&&n>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function mae(t,n,e){if(n===0)return 0;if(n===1)return t[0];let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function hae(t,n,e){if(n===0)return[];if(n===1)return[t];let r=new Array(n);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}function ey(t){return t&&t.then&&typeof t.then=="function"}var u3="tfjsflags",ty=class{constructor(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=yae,this.populateURLFlags()}setPlatform(n,e){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=n,this.platform=e}registerFlag(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){let o=this.urlFlags[n];console.warn(`Setting feature override from URL ${n}: ${o}.`),this.set(n,o)}}async getAsync(n){return n in this.flags?this.flags[n]:(this.flags[n]=await this.evaluateFlag(n),this.flags[n])}get(n){if(n in this.flags)return this.flags[n];let e=this.evaluateFlag(n);if(ey(e))throw new Error(`Flag ${n} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[n]=e,this.flags[n]}getNumber(n){return this.get(n)}getBool(n){return this.get(n)}getFlags(){return this.flags}get features(){return this.flags}set(n,e){if(this.flagRegistry[n]==null)throw new Error(`Cannot set flag ${n} as it has not been registered.`);this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)}evaluateFlag(n){if(this.flagRegistry[n]==null)throw new Error(`Cannot evaluate flag '${n}': no evaluation function found.`);return this.flagRegistry[n].evaluationFn()}setFlags(n){this.flags=Object.assign({},n)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let n=this.getQueryParams(this.global.location.search);u3 in n&&n[u3].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=xae(o,i)})}};function yae(t){let n={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(vae(n,r[0],r[1]),r.join("="))),n}function vae(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function xae(t,n){if(n=n.toLowerCase(),n==="true"||n==="false")return n==="true";if(`${+n}`===n)return+n;throw new Error(`Could not parse value flag value ${n} for flag ${t}.`)}function H(){return mD}var mD=null;function d3(t){mD=t}var hD;function gD(){if(hD==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");hD=t}return hD}function bae(){let t=gD();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function ny(t,n){let e=bae();if(e.has(t))return e.get(t);{let r=n();return e.set(t,r),e.get(t)}}var nc="Abs",da="Acos",pa="Acosh",Pi="Add",Ff="AddN",Of="All",Pf="Any",rc="ArgMax",oc="ArgMin",fa="Asin",ma="Asinh",ha="Atan",ga="Atanh",ya="Atan2",ic="AvgPool",Lf="AvgPoolGrad",sc="AvgPool3D",$f="AvgPool3DGrad",ac="BatchMatMul",lc="BatchToSpaceND",Pb="Bincount",p3="BroadcastTo",ys="Cast",va="Ceil",xa="ClipByValue",Vf="Complex",cc="ComplexAbs",uc="Concat",dc="Conv2D",Bf="Conv2DBackpropFilter",pc="Conv2DBackpropInput",fc="Conv3D",zf="Conv3DBackpropFilterV2",Uf="Conv3DBackpropInputV2",ba="Cos",wa="Cosh",mc="Cumsum",Lb="CropAndResize",$b="DenseBincount",jf="DepthToSpace",hc="DepthwiseConv2dNative",Gf="DepthwiseConv2dNativeBackpropFilter",Wf="DepthwiseConv2dNativeBackpropInput",Vb="Diag",gc="Dilation2D",ry="Dilation2DBackpropInput",oy="Dilation2DBackpropFilter",Ca="RealDiv",Bb="Einsum",_a="Elu",Hf="EluGrad",Ia="Erf",pd="Equal",Ea="Exp",yc="ExpandDims",Sa="Expm1",qf="FFT",Kf="Fill",zb="FlipLeftRight",Ta="Floor",Da="FloorDiv",vc="FusedBatchNorm",xc="GatherV2",Ub="GatherNd",fd="Greater",Na="GreaterEqual",vs="Identity",Xf="IFFT",Yf="Imag",ka="IsFinite",Aa="IsInf",Ra="IsNan",bc="LeakyRelu",md="Less",hd="LessEqual",jb="LinSpace",Ma="Log",Fa="Log1p",gd="LogicalAnd",yd="LogicalNot",vd="LogicalOr",f3="LogSoftmax",wc="LRN",Zf="LRNGrad",Cc="Max",Oa="Maximum",_c="MaxPool",Qf="MaxPoolGrad",Ic="MaxPool3D",Jf="MaxPool3DGrad",Gb="MaxPoolWithArgmax",Ec="Mean",Sc="Min",Pa="Minimum",Tc="MirrorPad",La="Mod",Wb="Multinomial",$a="Multiply",Dc="Neg",xd="NotEqual",Hb="NonMaxSuppressionV3",qb="NonMaxSuppressionV4",Kb="NonMaxSuppressionV5",Nc="OnesLike",kc="OneHot",Ac="Pack",Rc="PadV2";var Va="Pow",Mc="Prelu",em="Prod",tm="Range",nm="Real",Ba="Reciprocal",za="Relu",Fc="Reshape",Oc="ResizeNearestNeighbor",rm="ResizeNearestNeighborGrad",Pc="ResizeBilinear",om="ResizeBilinearGrad",Ua="Relu6",Lc="Reverse",ja="Round",Ga="Rsqrt",Xb="ScatterNd",$c="Select",Wa="Selu",Vc="Slice",Ha="Sin",qa="Sinh",Ka="Sign",Xa="Sigmoid",Ya="Softplus",Za="Sqrt",Bc="Sum",zc="SpaceToBatchND",Uc="SplitV",jc="Softmax",Yb="SparseFillEmptyRows",Zb="SparseReshape",Qb="SparseToDense",Qa="SquaredDifference",im="Square",sm="StridedSlice",Ja="Sub",el="Tan",tl="Tanh",xs="Tile",am="TopK",Jb="Transform",Gc="Transpose",lm="Unique",Wc="Unpack",Hc="UnsortedSegmentSum",qc="ZerosLike",nl="Step",m3="FromPixels",ew="RotateWithOffset",bd="_FusedMatMul",wd="FusedConv2D",Cd="FusedDepthwiseConv2D";var tw=ny("kernelRegistry",()=>new Map),yD=ny("gradRegistry",()=>new Map);function vD(t,n){let e=g3(t,n);return tw.get(e)}function xD(t){return yD.get(t)}function bD(t){let n=tw.entries(),e=[];for(;;){let{done:r,value:o}=n.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===t&&e.push(s)}return e}function nw(t){let{kernelName:n,backendName:e}=t,r=g3(n,e);tw.has(r)&&console.warn(`The kernel '${n}' for backend '${e}' is already registered`),tw.set(r,t)}function h3(t){let{kernelName:n}=t;yD.has(n)&&H().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${n}'`),yD.set(n,t)}function g3(t,n){return`${n}_${t}`}var w={};Qi(w,{arraysEqual:()=>hs,assert:()=>F,assertNonNegativeIntegerDimensions:()=>Jg,assertNonNull:()=>Zg,assertShapesMatch:()=>Fb,bytesFromStringArray:()=>fD,bytesPerElement:()=>Ob,checkConversionForErrors:()=>dD,clamp:()=>Df,computeStrides:()=>gs,createScalarValue:()=>wae,createShuffledIndices:()=>lae,decodeString:()=>dm,distSquared:()=>oae,encodeString:()=>um,fetch:()=>_ae,flatten:()=>tc,getArrayFromDType:()=>uD,getTypedArrayFromDType:()=>dae,hasEncodingLoss:()=>pae,indexToLoc:()=>hae,inferDtype:()=>kf,inferFromImplicitShape:()=>uae,isBoolean:()=>a3,isFunction:()=>Af,isInt:()=>bt,isNumber:()=>l3,isPromise:()=>ey,isScalarShape:()=>iae,isString:()=>Nf,isTypedArray:()=>mo,isValidDtype:()=>pD,locToIndex:()=>mae,makeOnesTypedArray:()=>Qg,makeZerosNestedTypedArray:()=>fae,makeZerosTypedArray:()=>Mf,nearestDivisor:()=>Rf,nearestLargerEven:()=>tae,now:()=>_d,parseAxisParam:()=>En,randUniform:()=>rae,repeatedTry:()=>cae,rightPad:()=>dd,shuffle:()=>s3,shuffleCombo:()=>eae,sizeFromShape:()=>Lt,sizeToSquarishShape:()=>aae,squeezeShape:()=>cD,sum:()=>nae,tanh:()=>sae,toNestedArray:()=>ud,toTypedArray:()=>cm});function wae(t,n){return n==="string"?um(t):cm([t],n)}function Cae(t,n){return t instanceof Float32Array&&n==="float32"||t instanceof Int32Array&&n==="int32"||t instanceof Uint8Array&&n==="bool"}function cm(t,n){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=tc(t)),H().getBool("DEBUG")&&dD(t,n),Cae(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){let e=new Uint8Array(t.length);for(let r=0;r<e.length;++r)Math.round(t[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${n}`)}function _d(){return H().platform.now()}function _ae(t,n){return H().platform.fetch(t,n)}function um(t,n="utf-8"){return n=n||"utf-8",H().platform.encode(t,n)}function dm(t,n="utf-8"){return n=n||"utf-8",H().platform.decode(t,n)}var rw=class{constructor(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new wD)}profileKernel(n,e,r){let o,i=()=>{o=r()},s,a=_d();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let c of o)c.dataSync();s=Promise.resolve({kernelMs:_d()-a})}if(H().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let u=o[c];u.data().then(d=>{Iae(d,u.dtype,n)})}return{kernelName:n,outputs:o,inputs:e,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(n){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=n;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function Iae(t,n,e){if(n!=="float32")return!1;for(let r=0;r<t.length;r++){let o=t[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var wD=class{logKernelProfile(n,e,r,o,i,s){let a=typeof o=="number"?dd(`${o}ms`,9):o.error,l=dd(n,25),c=e.rank,u=e.size,d=dd(e.shape.toString(),14),p="";for(let f in i){let m=i[f];if(m!=null){let h=m.shape||e.shape,g=h.length;p+=`${f}: ${g}D ${g>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function y3(t,n,e){let r={},o={};for(let l=0;l<n.length;l++)r[n[l].id]=!0;for(let l=0;l<t.length;l++){let c=t[l],u=c.inputs;for(let d in u){let p=u[d],f=!1;for(let m=0;m<n.length;m++)if(r[p.id]){c.outputs.forEach(h=>r[h.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}let i={};i[e.id]=!0;let s={};for(let l=t.length-1;l>=0;l--){let c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(let p in u)i[u[p].id]=!0,s[c.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let c=t[l];if(o[c.id]&&s[c.id]){let u={};for(let p in c.inputs){let f=c.inputs[p];r[f.id]&&(u[p]=f)}let d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function v3(t,n,e,r){for(let o=n.length-1;o>=0;o--){let i=n[o],s=[];if(i.outputs.forEach(l=>{let c=t[l.id];c!=null?s.push(c):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);let u=i.inputs[l];if(!hs(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{let d=t[u.id];t[u.id]=r(d,c),d.dispose()}}}}var x3=20,iy=3,CD=7;function b3(t,n,e,r){let o=gs(n),i=Eae(t,n,e,o),s=n.length,a=ow(t,n,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${n}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function Eae(t,n,e,r){let o=Lt(n),i=r[r.length-1],s=new Array(i).fill(0),a=n.length,l=e==="complex64"?ay(t):t;if(a>1)for(let c=0;c<o/i;c++){let u=c*i;for(let d=0;d<i;d++)s[d]=Math.max(s[d],sy(l[u+d],0,e).length)}return s}function sy(t,n,e){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(CD))} + ${parseFloat(t[1].toFixed(CD))}j`:Nf(t)?r=`'${t}'`:e==="bool"?r=w3(t):r=parseFloat(t.toFixed(CD)).toString(),dd(r,n)}function w3(t){return t===0?"false":"true"}function ow(t,n,e,r,o,i=!0){let s=e==="complex64"?2:1,a=n[0],l=n.length;if(l===0){if(e==="complex64"){let h=ay(t);return[sy(h[0],0,e)]}return e==="bool"?[w3(t[0])]:[t[0].toString()]}if(l===1){if(a>x3){let g=iy*s,x=Array.from(t.slice(0,g)),b=Array.from(t.slice((a-iy)*s,a*s));return e==="complex64"&&(x=ay(x),b=ay(b)),["["+x.map((I,_)=>sy(I,o[_],e)).join(", ")+", ..., "+b.map((I,_)=>sy(I,o[a-iy+_],e)).join(", ")+"]"]}return["["+(e==="complex64"?ay(t):Array.from(t)).map((g,x)=>sy(g,o[x],e)).join(", ")+"]"]}let c=n.slice(1),u=r.slice(1),d=r[0]*s,p=[];if(a>x3){for(let h=0;h<iy;h++){let g=h*d,x=g+d;p.push(...ow(t.slice(g,x),c,e,u,o,!1))}p.push("...");for(let h=a-iy;h<a;h++){let g=h*d,x=g+d;p.push(...ow(t.slice(g,x),c,e,u,o,h===a-1))}}else for(let h=0;h<a;h++){let g=h*d,x=g+d;p.push(...ow(t.slice(g,x),c,e,u,o,h===a-1))}let f=l===2?",":"";p[0]="["+p[0]+f;for(let h=1;h<p.length-1;h++)p[h]=" "+p[h]+f;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":m),p}function ay(t){let n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var At=class{constructor(n,e,r){if(this.dtype=e,this.shape=n.slice(),this.size=Lt(n),r!=null){let o=r.length;F(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||uD(e,this.size),this.strides=gs(n)}set(n,...e){e.length===0&&(e=[0]),F(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=n}get(...n){n.length===0&&(n=[0]);let e=0;for(let o of n){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${n}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=this.strides[o]*n[o];return this.values[r]}locToIndex(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];let e=n[n.length-1];for(let r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e}indexToLoc(n){if(this.rank===0)return[];if(this.rank===1)return[n];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e}get rank(){return this.shape.length}toTensor(){return bs().makeTensor(this.values,this.shape,this.dtype)}},bs=null,pm=null,Sae=null;function C3(t){bs=t}function _3(t){pm=t}function I3(t){Sae=t}var ft=class{constructor(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=Lt(n),this.strides=gs(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let n=await this.data();return pm.buffer(this.shape,this.dtype,n)}bufferSync(){return pm.buffer(this.shape,this.dtype,this.dataSync())}async array(){let n=await this.data();return ud(this.shape,n,this.dtype==="complex64")}arraySync(){return ud(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let n=bs().read(this.dataId);if(this.dtype==="string"){let e=await n;try{return e.map(r=>dm(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return n}dataSync(){this.throwIfDisposed();let n=bs().readSync(this.dataId);if(this.dtype==="string")try{return n.map(e=>dm(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n}async bytes(){this.throwIfDisposed();let n=await bs().read(this.dataId);return this.dtype==="string"?n:new Uint8Array(n.buffer)}dispose(){this.isDisposed||(bs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(n=!1){return pm.print(this,n)}clone(){return this.throwIfDisposed(),pm.clone(this)}toString(n=!1){let e=this.dataSync();return b3(e,this.shape,this.dtype,n)}cast(n){return this.throwIfDisposed(),pm.cast(this,n)}variable(n=!0,e,r){return this.throwIfDisposed(),bs().makeVariable(this,n,e,r)}};Object.defineProperty(ft,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function P(){return ny("Tensor",()=>ft)}P();var rl=class extends ft{constructor(n,e,r,o){super(n.shape,n.dtype,n.dataId,o),this.trainable=e,this.name=r}assign(n){if(n.dtype!==this.dtype)throw new Error(`dtype of the new value (${n.dtype}) and previous value (${this.dtype}) must match`);if(!hs(n.shape,this.shape))throw new Error(`shape of the new value (${n.shape}) and previous value (${this.shape}) must match`);bs().disposeTensor(this),this.dataId=n.dataId,bs().incRef(this,null)}dispose(){bs().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(rl,Symbol.hasInstance,{value:t=>t instanceof ft&&t.assign!=null&&t.assign instanceof Function});var E3=function(t){return t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64",t}(E3||{}),S3=function(t){return t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64",t}(S3||{}),T3=function(t){return t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64",t}(T3||{}),D3=function(t){return t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64",t}(D3||{}),Tae={float32:T3,int32:E3,bool:S3,complex64:D3};function Dn(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error(`Can not upcast ${t} with ${n}`)}return Tae[t][n]}function Id(t){return Dn(t,"int32")}function Ze(t,n){if(t.dtype===n.dtype)return[t,n];let e=Dn(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function iw(t){let n=[];return N3(t,n,new Set),n}function N3(t,n,e){if(t==null)return;if(t instanceof ft){n.push(t);return}if(!Dae(t))return;let r=t;for(let o in r){let i=r[o];e.has(i)||(e.add(i),N3(i,n,e))}}function Dae(t){return Array.isArray(t)||typeof t=="object"}function _D(t){return t.kernelName!=null}var sw=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(n=>n.name)))}}}dispose(){for(let n in this.registeredVariables)this.registeredVariables[n].dispose()}},kae=(()=>{class t{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new sw}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(await this.initializeBackend(o).success){await this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(console.warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new rw(this.backendInstance),!0}setupRegisteredKernels(){bD(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){bD(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof ua)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return console.warn(`Initialization of backend ${e} failed`),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return t.nextTensorId++}nextVariableId(){return t.nextVariableId++}clone(e){let r=k.runKernel(vs,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",c={x:a},u={dtype:l};return k.runKernel(ys,c,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(!(vD(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(c=>{s+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,u=_D(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(_D(e)){let{kernelName:h,inputs:g,attrs:x}=e;this.backendName==null&&this.backend;let b=vD(h,this.backendName);F(b!=null,()=>`Cannot find registered kernel '${h}' for backend '${this.backendName}'`),l=()=>{let I=this.backend.numDataIds();c=b.kernelFunc({inputs:g,attrs:x,backend:this.backend});let _=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,I,_);let E=_.map(S=>{if(S.rank!=null)return S;let{dataId:D,shape:M,dtype:R}=S;return this.makeTensorFromDataId(D,M,R)});if(i){let S=this.getTensorsForGradient(h,g,E);o=this.saveTensorsForBackwardMode(S)}return E}}else{let{forwardFunc:h}=e,g=x=>{i&&(o=x.map(b=>this.keep(this.clone(b))))};l=()=>{let x=this.backend.numDataIds();c=this.tidy(()=>h(this.backend,g));let b=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,x,b),b}}let{inputs:d,attrs:p}=e,f=_D(e)?null:e.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(m=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),r=m.outputs)}),i&&this.addTapeNode(u,d,r,f,o,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(h=>d[h]!=null?d[h].shape:null),outputShapes:r.map(h=>h.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(c)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=xD(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(F(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(u=>r[u])):l=s.map(u=>r[u]);let c=o.filter((u,d)=>a[d]);return l.concat(c)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&Nf(e[0])&&(s=e.map(c=>um(c)));let a=i.write(s,r,o),l=new ft(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let c=this.state.tensorInfo.get(a),u=fD(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s=new ft(r,o,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new rl(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*Ob(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof rl||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*Ob(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},c=xD(e);c!=null&&(i=c.gradFunc),i!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){let f=o[p],m=Mf(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return d}),i(u.length>1?u:u[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=iw(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(F(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));F(s instanceof ft,()=>"The result y returned by f() must be a tensor.");let a=y3(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??Aae(s.shape),v3(l,a,u=>this.tidy(u),Rae);let c=r.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let d of u.saved)d.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return F(Af(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{F(r.every(l=>l instanceof ft),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,c)=>{i[c]=l});let s=(l,c)=>(o=e(...r,c),F(o.value instanceof ft,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),F(Af(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,c)=>{let u=o.gradFunc(l,c),d=Array.isArray(u)?u:[u];F(d.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),F(d.every(f=>f instanceof ft),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return d.forEach((f,m)=>{p[m]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){let r=_d(),o=await this.backend.time(e);return o.wallMs=_d()-r,o}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new sw;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return t.nextTensorId=0,t.nextVariableId=0,t})();function Aae(t){let n=Qg(Lt(t),"float32");return k.makeTensor(n,t,"float32")}function ID(){let t=gD();if(t._tfengine==null){let n=new ty(t);t._tfengine=new kae(n)}return d3(t._tfengine.ENV),C3(()=>t._tfengine),t._tfengine}var k=ID();function Rae(t,n){let e={a:t,b:n};return k.runKernel(Pi,e)}var Kc={};Qi(Kc,{isBrowser:()=>ED,isMobile:()=>Fae});function Mae(){return typeof navigator<"u"&&navigator!=null}function Fae(t){if(t||Mae()){if(t||(t=navigator),t.product==="ReactNative")return!0;let n=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function ED(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var Li=H();Li.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});Li.registerFlag("IS_BROWSER",()=>ED());Li.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");Li.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));Li.registerFlag("PROD",()=>!1);Li.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>Li.getBool("DEBUG"));Li.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);Li.registerFlag("IS_TEST",()=>!1);Li.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);Li.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);function Ed(t,n){let e=t;if(mo(t))return n==="string"?[]:[t.length];if(!Array.isArray(t))return[];let r=[];for(;Array.isArray(e)||mo(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&A3(t,r,[]),r}function A3(t,n,e){if(e=e||[],!Array.isArray(t)&&!mo(t)){F(n.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);return}F(n.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${t.length} elements`),F(t.length===n[0],()=>`Element arr[${e.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);let r=n.slice(1);for(let o=0;o<t.length;++o)A3(t[o],r,e.concat(o))}function k3(t,n,e,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==n||t==="numeric"&&n==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${t} tensor, but got ${n} tensor`)}}function N(t,n,e,r="numeric"){if(t instanceof ft)return k3(r,t.dtype,n,e),t;let o=kf(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),k3(r,o,n,e),t==null||!mo(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${n}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=Ed(t,o);!mo(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?cm(t,o):tc(t,[],!0);return k.makeTensor(a,i,o)}function aw(t,n,e,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${n} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,s)=>N(i,`${n}[${s}]`,e,r))}var Oae="__op";function A(t){let n=Object.keys(t);if(n.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${n.length} keys.`);let e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+Oae;let o=(...i)=>{k.startScope(e);try{let s=r(...i);return ey(s)&&console.error("Cannot return a Promise inside of tidy."),k.endScope(s),s}catch(s){throw k.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function Pae(t,n){let e=N(t,"real","complex"),r=N(n,"imag","complex");Fb(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return k.runKernel(Vf,o)}var $i=A({complex_:Pae});function Xc(t,n,e,r){if(r==null&&(r=kf(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!mo(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Jg(n);let o=Lt(n),i=Lt(e);F(o===i,()=>`Based on the provided shape, [${n}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==Lt(n.slice(s)):!0;F(e[s]===n[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${n}). `)}}return!mo(t)&&!Array.isArray(t)&&(t=[t]),n=n||e,t=r!=="string"?cm(t,r):tc(t,[],!0),k.makeTensor(t,n,r)}function Yc(t,n,e){let r=Ed(t,e);return Xc(t,n,r,e)}var ly={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var lw=4;async function M3(t,n){let e=[],r=[],o=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(t)?t[s].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let u=new Promise(async d=>{let p=await l.bytes(),f=p.reduce((g,x)=>g+x.length,0)+lw*p.length,m=new Uint8Array(f),h=0;for(let g=0;g<p.length;g++){let x=p[g],b=new Uint8Array(new Uint32Array([x.length]).buffer);m.set(b,h),h+=lw,m.set(x,h),h+=x.length}d(m)});r.push(u)}else r.push(l.data());n!=null&&(c.group=n),e.push(c)}let i=await Promise.all(r);return{data:Lae(i),specs:e}}function cw(t,n){let e={},r,o=0;for(let i of n){let s=i.name,a=i.dtype,l=i.shape,c=Lt(l),u;if("quantization"in i){let d=i.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${i.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${i.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let p=ly[d.dtype],f=t.slice(o,o+c*p),m=d.dtype==="uint8"?new Uint8Array(f):new Uint16Array(f);if(a==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){u=new Float32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=g*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=zae()),u=r(m);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(a==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);u=new Int32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=Math.round(g*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*p}else if(a==="string"){let d=Lt(i.shape);u=[];for(let p=0;p<d;p++){let f=new Uint32Array(t.slice(o,o+lw))[0];o+=lw;let m=new Uint8Array(t.slice(o,o+f));u.push(m),o+=f}}else{let d=ly[a],p=t.slice(o,o+c*d);if(a==="float32")u=new Float32Array(p);else if(a==="int32")u=new Int32Array(p);else if(a==="bool")u=new Uint8Array(p);else if(a==="complex64"){u=new Float32Array(p);let f=new Float32Array(u.length/2),m=new Float32Array(u.length/2);for(let x=0;x<f.length;x++)f[x]=u[x*2],m[x]=u[x*2+1];let h=Yc(f,l,"float32"),g=Yc(m,l,"float32");e[s]=$i(h,g),h.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*d}a!=="complex64"&&(e[s]=Yc(u,l,a))}return e}function Lae(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let n=0,e=[];t.forEach(i=>{if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(n),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var SD=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function R3(t){return SD?Buffer.byteLength(t):new Blob([t]).size}function F3(t){if(SD)return Buffer.from(t).toString("base64");let n=new Uint8Array(t),e="";for(let r=0,o=n.length;r<o;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function O3(t){if(SD){let r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;++r)e.set([n.charCodeAt(r)],r);return e.buffer}function fm(t){if(t.length===1)return t[0];let n=0;t.forEach(o=>{n+=o.byteLength});let e=new Uint8Array(n),r=0;return t.forEach(o=>{e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function TD(t){let n="/";for(t=t.trim();t.endsWith(n);)t=t.slice(0,t.length-1);let e=t.split(n);return e[e.length-1]}function ws(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:R3(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:R3(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function $ae(){let t=e=>{let r=e<<13,o=0;for(;!(r&8388608);)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},n=new Uint32Array(2048);n[0]=0;for(let e=1;e<1024;e++)n[e]=t(e);for(let e=1024;e<2048;e++)n[e]=939524096+(e-1024<<13);return n}function Vae(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let n=1;n<31;n++)t[n]=n<<23;for(let n=33;n<63;n++)t[n]=2147483648+(n-32<<23);return t}function Bae(){let t=new Uint32Array(64);for(let n=0;n<64;n++)t[n]=1024;return t[0]=t[32]=0,t}function zae(){let t=$ae(),n=Vae(),e=Bae();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=t[e[a>>10]+(a&1023)]+n[a>>10];i[s]=l}return new Float32Array(o)}}var Ln=class t{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerSaveRouter(n){t.getInstance().saveRouters.push(n)}static registerLoadRouter(n){t.getInstance().loadRouters.push(n)}static getSaveHandlers(n){return t.getHandlers(n,"save")}static getLoadHandlers(n,e){return t.getHandlers(n,"load",e)}static getHandlers(n,e,r){let o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(s=>{let a=s(n,r);a!==null&&o.push(a)}),o}},P3=t=>Ln.registerSaveRouter(t),L3=t=>Ln.registerLoadRouter(t),$3=t=>Ln.getSaveHandlers(t),V3=(t,n)=>Ln.getLoadHandlers(t,n);var DD="tensorflowjs",ND=1,Sd="models_store",Zc="model_info_store";function B3(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function kD(t){let n=t.result;n.createObjectStore(Sd,{keyPath:"modelPath"}),n.createObjectStore(Zc,{keyPath:"modelPath"})}var Td=(()=>{class t{constructor(e){if(this.indexedDB=B3(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(DD,ND);s.onupgradeneeded=()=>kD(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(Sd,"readonly"),u=l.objectStore(Sd).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>a.close()}else{let l=ws(r),c=a.transaction(Zc,"readwrite"),u=c.objectStore(Zc),d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l}),p;d.onsuccess=()=>{p=a.transaction(Sd,"readwrite");let m=p.objectStore(Sd).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l});m.onsuccess=()=>o({modelArtifactsInfo:l}),m.onerror=h=>{u=c.objectStore(Zc);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(m.error)),g.onerror=x=>(a.close(),i(m.error))}},d.onerror=f=>(a.close(),i(d.error)),c.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return t.URL_SCHEME="indexeddb://",t})(),z3=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Td.URL_SCHEME)?Uae(t.slice(Td.URL_SCHEME.length)):null;Ln.registerSaveRouter(z3);Ln.registerLoadRouter(z3);function Uae(t){return new Td(t)}function jae(t){return t.startsWith(Td.URL_SCHEME)?t.slice(Td.URL_SCHEME.length):t}var uw=class{constructor(){this.indexedDB=B3()}async listModels(){return new Promise((n,e)=>{let r=this.indexedDB.open(DD,ND);r.onupgradeneeded=()=>kD(r),r.onsuccess=()=>{let o=r.result,i=o.transaction(Zc,"readonly"),a=i.objectStore(Zc).getAll();a.onsuccess=()=>{let l={};for(let c of a.result)l[c.modelPath]=c.modelArtifactsInfo;n(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})}async removeModel(n){return n=jae(n),new Promise((e,r)=>{let o=this.indexedDB.open(DD,ND);o.onupgradeneeded=()=>kD(o),o.onsuccess=()=>{let i=o.result,s=i.transaction(Zc,"readwrite"),a=s.objectStore(Zc),l=a.get(n),c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${n}' in IndexedDB.`));{let u=a.delete(n),d=()=>{c=i.transaction(Sd,"readwrite");let f=c.objectStore(Sd).delete(n);f.onsuccess=()=>e(l.result.modelArtifactsInfo),f.onerror=m=>r(l.error)};u.onsuccess=d,u.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=u=>(i.close(),r(l.error)),s.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})}};var ol="/",mm="tensorflowjs_models",U3="info",Gae="model_topology",Wae="weight_specs",Hae="weight_data",qae="model_metadata";function j3(t){return{info:[mm,t,U3].join(ol),topology:[mm,t,Gae].join(ol),weightSpecs:[mm,t,Wae].join(ol),weightData:[mm,t,Hae].join(ol),modelMetadata:[mm,t,qae].join(ol)}}function Kae(t){let n=t.split(ol);if(n.length<3)throw new Error(`Invalid key format: ${t}`);return n.slice(1,n.length-1).join(ol)}function Xae(t){return t.startsWith(Dd.URL_SCHEME)?t.slice(Dd.URL_SCHEME.length):t}var Dd=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=j3(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=ws(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,F3(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=O3(a),r}}return t.URL_SCHEME="localstorage://",t})(),G3=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Dd.URL_SCHEME)?Yae(t.slice(Dd.URL_SCHEME.length)):null;Ln.registerSaveRouter(G3);Ln.registerLoadRouter(G3);function Yae(t){return new Dd(t)}var dw=class{constructor(){F(H().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),F(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let n={},e=mm+ol,r=ol+U3;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=Kae(i);n[s]=JSON.parse(this.LS.getItem(i))}}return n}async removeModel(n){n=Xae(n);let e=j3(n);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${n}'`);let r=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),r}};var hm="://",Vi=class t{constructor(){this.managers={}}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerManager(n,e){F(n!=null,()=>"scheme must not be undefined or null."),n.endsWith(hm)&&(n=n.slice(0,n.indexOf(hm))),F(n.length>0,()=>"scheme must not be an empty string.");let r=t.getInstance();F(r.managers[n]==null,()=>`A model store manager is already registered for scheme '${n}'.`),r.managers[n]=e}static getManager(n){let e=this.getInstance().managers[n];if(e==null)throw new Error(`Cannot find model manager for scheme '${n}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}};function pw(t){if(t.indexOf(hm)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Vi.getSchemes().join(",")}`);return{scheme:t.split(hm)[0],path:t.split(hm)[1]}}async function W3(t,n,e=!1){F(t!==n,()=>`Old path and new path are the same: '${t}'`);let r=Ln.getLoadHandlers(t);F(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),F(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);let o=r[0],i=Ln.getSaveHandlers(n);F(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${n}.`),F(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${n}.`);let s=i[0],a=pw(t).scheme,l=pw(t).path,c=a===pw(t).scheme,u=await o.load();e&&c&&await Vi.getManager(a).removeModel(l);let d=await s.save(u);return e&&!c&&await Vi.getManager(a).removeModel(l),d.modelArtifactsInfo}async function H3(){let t=Vi.getSchemes(),n={};for(let e of t){let r=await Vi.getManager(e).listModels();for(let o in r){let i=e+hm+o;n[i]=r[o]}}return n}async function q3(t){let n=pw(t);return Vi.getManager(n.scheme).removeModel(n.path)}async function K3(t,n){return W3(t,n,!1)}async function X3(t,n){return W3(t,n,!0)}var AD=class{fetch(n,e){return fetch(n,e)}now(){return performance.now()}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)}decode(n,e){return new TextDecoder(e).decode(n)}};if(H().get("IS_BROWSER")){H().setPlatform("browser",new AD);try{Vi.registerManager(Dd.URL_SCHEME,new dw)}catch{}try{Vi.registerManager(Td.URL_SCHEME,new uw)}catch{}}var Qae={importFetch:()=>Z3()},RD;var MD=class{constructor(){this.util=Q3(),this.textEncoder=new this.util.TextEncoder}fetch(n,e){return H().global.fetch!=null?H().global.fetch(n,e):(RD==null&&(RD=Qae.importFetch()),RD(n,e))}now(){let n=process.hrtime();return n[0]*1e3+n[1]/1e6}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(n)}decode(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)}};H().get("IS_NODE")&&H().setPlatform("node",new MD);function Te(t,n="float32",e){return n=n||"float32",Jg(t),new At(t,n,e)}function Jae(t,n){let e=N(t,"x","cast");if(!pD(n))throw new Error(`Failed to cast to unknown dtype ${n}`);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:n};return k.runKernel(ys,r,o)}var ue=A({cast_:Jae});function ele(t){let e={x:N(t,"x","clone","string_or_numeric")};return k.runKernel(vs,e)}var Bi=A({clone_:ele});function J3(t,n=!1){console.log(t.toString(n))}ID();var tle={buffer:Te,cast:ue,clone:Bi,print:J3};_3(tle);var ni={};Qi(ni,{browserFiles:()=>tV,browserHTTPRequest:()=>iV,concatenateArrayBuffers:()=>fm,copyModel:()=>K3,decodeWeights:()=>cw,encodeWeights:()=>M3,fromMemory:()=>sV,getLoadHandlers:()=>V3,getModelArtifactsInfoForJSON:()=>ws,getSaveHandlers:()=>$3,http:()=>mw,isHTTPScheme:()=>fw,listModels:()=>H3,loadWeights:()=>nV,moveModel:()=>X3,registerLoadRouter:()=>L3,registerSaveRouter:()=>P3,removeModel:()=>q3,weightsLoaderFactory:()=>$D,withSaveHandler:()=>aV});var nle="model",rle=".json",ole=".weights.bin";function eV(t){return new Promise(n=>setTimeout(n)).then(t)}var FD=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),(e==null||e.length===0)&&(e=nle),this.modelTopologyFileName=e+rle,this.weightDataFileName=e+ole}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer);let s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=s,await eV(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await eV(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:ws(e)}}}}return t.URL_SCHEME="downloads://",t})(),OD=class{constructor(n){if(n==null||n.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${n}`);this.files=n}async load(){let n=this.files[0],e=this.files.slice(1);return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=JSON.parse(s.target.result),l=a.modelTopology;if(l==null){o(new Error(`modelTopology field is missing from file ${n.name}`));return}e.length===0&&r({modelTopology:l});let c=a.weightsManifest;if(c==null){o(new Error(`weightManifest field is missing from file ${n.name}`));return}let u;try{u=this.checkManifestAndWeightFiles(c,e)}catch(m){o(m);return}let d=[],p=[],f=[];c.forEach(m=>{m.paths.forEach(h=>{p.push(h),f.push(null)}),d.push(...m.weights)}),c.forEach(m=>{m.paths.forEach(h=>{let g=new FileReader;g.onload=x=>{let b=x.target.result,I=p.indexOf(h);if(f[I]=b,f.indexOf(null)===-1){let _={modelTopology:l,weightSpecs:d,weightData:fm(f),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};a.signature!=null&&(_.signature=a.signature),a.userDefinedMetadata!=null&&(_.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(_.modelInitializer=a.modelInitializer),r(_)}},g.onerror=x=>o(`Failed to weights data from file of path '${h}'.`),g.readAsArrayBuffer(u[h])})})},i.onerror=s=>o(`Failed to read model topology and weights manifest JSON from file '${n.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(n)})}checkManifestAndWeightFiles(n,e){let r=[],o=e.map(s=>TD(s.name)),i={};for(let s of n)s.paths.forEach(a=>{let l=TD(a);if(r.indexOf(l)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${l}'`);if(r.push(l),o.indexOf(l)===-1)throw new Error(`Weight file with basename '${l}' is not provided.`);i[a]=e[o.indexOf(l)]});if(r.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${e.length}).`);return i}},ile=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(FD.URL_SCHEME)?sle(t.slice(FD.URL_SCHEME.length)):null;Ln.registerSaveRouter(ile);function sle(t="model"){return new FD(t)}function tV(t){return new OD(t)}function PD(t,n,e,r){s(t),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(c=>{let u=e+ ++o/t.length*(r-e);return n(u),c}),l);function s(l){F(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){F(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),F(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),F(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}async function LD(t,n){n==null&&(n={});let e=n.fetchFunc==null?H().platform.fetch:n.fetchFunc,r=t.map(d=>e(d,n.requestInit,{isBinary:!0})),a=(n.onProgress==null?await Promise.all(r):await PD(r,n.onProgress,0,.5)).map(d=>d.arrayBuffer());return n.onProgress==null?await Promise.all(a):await PD(a,n.onProgress,.5,1)}async function nV(t,n="",e,r){return $D(s=>LD(s,{requestInit:r}))(t,n,e)}function $D(t){return async(n,e="",r)=>{let o=n.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(n.forEach((f,m)=>{let h=0;f.weights.forEach(g=>{let x="quantization"in g?g.quantization.dtype:g.dtype,b=ly[x]*Lt(g.shape),I=()=>{o[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:g,groupOffset:h,sizeBytes:b})};r!=null?r.forEach((_,E)=>{_===g.name&&(I(),s[E]=!0)}):I(),a.push(g.name),h+=b})}),!s.every(f=>f)){let f=r.filter((m,h)=>!s[h]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((f,m,h)=>(m&&f.push(h),f),[]),c=[];l.forEach(f=>{n[f].paths.forEach(m=>{let h=e+(e.endsWith("/")?"":"/")+m;c.push(h)})});let u=await t(c),d={},p=0;return l.forEach(f=>{let m=n[f].paths.length,h=0;for(let _=0;_<m;_++)h+=u[p+_].byteLength;let g=new ArrayBuffer(h),x=new Uint8Array(g),b=0;for(let _=0;_<m;_++){let E=new Uint8Array(u[p+_]);x.set(E,b),b+=E.byteLength}i[f].forEach(_=>{let E=g.slice(_.groupOffset,_.groupOffset+_.sizeBytes),S=cw(E,[_.manifestEntry]);for(let D in S)d[D]=S[D]}),p+=m}),d}}var ale="application/octet-stream",lle="application/json",rV=(()=>{class t{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(F(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=H().platform.fetch,F(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&F(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(i)],{type:lle}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:ale}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:ws(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let g=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?g+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":g+=" Please make sure the server is serving valid JSON for this request.",new Error(g)}let o=r.modelTopology,i=r.weightsManifest,s=r.generatedBy,a=r.convertedBy,l=r.format,c=r.signature,u=r.userDefinedMetadata;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let d,p;i!=null&&([d,p]=await this.loadWeights(i));let f={modelTopology:o,weightSpecs:d,weightData:p,generatedBy:s,convertedBy:a,format:l};c!=null&&(f.signature=c),u!=null&&(f.userDefinedMetadata=u);let m=r.modelInitializer;return m&&(f.modelInitializer=m),f}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=cle(r),s=this.weightPathPrefix||o,a=[];for(let d of e)a.push(...d.weights);let l=[],c=[];for(let d of e)for(let p of d.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(p)):l.push(s+p+i);this.weightUrlConverter&&l.push(...await Promise.all(c));let u=await LD(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,fm(u)]}}return t.URL_SCHEME_REGEX=/^https?:\/\//,t})();function cle(t){let n=t.lastIndexOf("/"),e=t.lastIndexOf("?"),r=t.substring(0,n),o=e>n?t.substring(e):"";return[r+"/",o]}function fw(t){return t.match(rV.URL_SCHEME_REGEX)!=null}var oV=(t,n)=>{if(typeof fetch>"u"&&(n==null||n.fetchFunc==null))return null;{let e=!0;if(Array.isArray(t)?e=t.every(r=>fw(r)):e=fw(t),e)return mw(t,n)}return null};Ln.registerSaveRouter(oV);Ln.registerLoadRouter(oV);function mw(t,n){return new rV(t,n)}function iV(t,n){return mw(t,n)}var cy=class{constructor(n){this.modelArtifacts=n}async load(){return this.modelArtifacts}},VD=class{constructor(n){this.saveHandler=n}async save(n){return this.saveHandler(n)}};function sV(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new cy(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cy({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new cy({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))}function aV(t){return new VD(t)}function ule(t,n,e=!1,r=!1){let o=N(t,"a","matMul"),i=N(n,"b","matMul");[o,i]=Ze(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return k.runKernel(ac,s,a)}var wt=A({matMul_:ule});function dle(t,n,e=1,r=0){if(n<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${n}`);let i={indices:N(t,"indices","oneHot","int32")},s={depth:n,onValue:e,offValue:r};return k.runKernel(kc,i,s)}var ym=A({oneHot_:dle});function ple(t,n){let e=N(t,"x","transpose");if(n==null&&(n=e.shape.map((i,s)=>s).reverse()),F(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of perm ${n}.`),n.forEach(i=>{F(i>=0&&i<e.rank,()=>`All entries in 'perm' must be between 0 and ${e.rank-1} but got ${n}`)}),e.rank<=1)return e.clone();let r={x:e},o={perm:n};return k.runKernel(Gc,r,o)}var st=A({transpose_:ple});function fle(t,n){let e=t.shape.length,r=n.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(n.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${n.shape[r-1]} vs. ${e}`);if(Lt(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=n.shape,i=o[o.length-1],s=1;for(let d=0;d<o.length-1;++d)s*=o[d];let a=t.shape,l=o.slice();l.pop();let c=1;for(let d=i;d<e;++d)c*=a[d],l.push(a[d]);let u=[...gs(t.shape).map(d=>d/c),1].slice(0,i);return[l,s,c,u]}function lV(t,n,e){let r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${n.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(t.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+t.length-r)throw new Error(i+` update.rank != ${o+t.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==n.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${n.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==t[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${t[s+o]})`)}function mle(t,n,e){if(n.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${n.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(n.size===0)throw new Error(`Indices specified for empty output. indices shape: ${n.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}lV(e,n,t)}function hle(t,n,e){let r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,s=1;for(let d=o;d<i;++d)s*=e[d];let a=o<1?1:o,l=Lt(n.shape)/a,c=[...gs(e.slice(0,o)),1],u=Lt(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}var tr={};Qi(tr,{assertParamsValid:()=>gle,computeFlatOffset:()=>vle,computeOutShape:()=>cV,getNormalizedAxes:()=>fV,isSliceContinous:()=>yle,maskToAxes:()=>hw,parseSliceParams:()=>BD,sliceInfo:()=>xle,startForAxis:()=>yV,startIndicesWithElidedDims:()=>mV,stopForAxis:()=>vV,stopIndicesWithElidedDims:()=>hV,stridesForAxis:()=>gV,stridesWithElidedDims:()=>uV});function gle(t,n,e){let r=t.shape.length;F(r===n.length,()=>`Error in slice${r}D: Length of begin ${n} must match the rank of the array (${r}).`),F(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)F(n[o]+e[o]<=t.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${n[o]+e[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function hw(t){let n=[],e=0;for(;t>0;)t&1&&n.push(e),t/=2,e++;return n}function cV(t,n,e){let r=[];for(let o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function uV(t,n,e,r){let o=[...t];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[n]=1:(o.splice(n,0,1),o.pop());return o}function dV(t,n,e){return e<=t?e:e-(n-1)}function pV(t,n){let e=[];for(let r=0;r<t;r++)e.push(n+r);return e}function fV(t,n,e,r,o,i,s,a,l){let c=t.length,u=new Array(c),d=new Array(c),p=new Array(c);if(n.length&&e>0){let f=n[0],m=e+1;u=mV(s,f,m,r,t),d=hV(a,f,m,o,t),p=uV(i,f,m,t)}else for(let f=0;f<c;f++)u[f]=yV(s,r,i,t,f,l),d[f]=vV(a,o,i,t,f,l),p[f]=gV(i,f,l);return{begin:u,end:d,strides:p}}function mV(t,n,e,r,o){let i=[...o],s=pV(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=dV(n,e,a),c=r[l];t&1<<l&&(c=0),i[a]=c}return i}function hV(t,n,e,r,o){let i=[...o],s=pV(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=dV(n,e,a),c=r[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=Df(0,i[a],o[a])}return i}function gV(t,n,e){let r=t[n];return(e&1<<n||r==null)&&(r=1),r}function yV(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=Df(0,s,l-1),s}function vV(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=Df(0,s,l):s=Df(-1,s,l-1),s}function yle(t,n,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function vle(t,n){let e=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function BD(t,n,e){let r,o=t.shape.length;typeof n=="number"?r=[n,...new Array(o-1).fill(0)]:n.length<o?r=n.concat(new Array(o-n.length).fill(0)):r=n.slice(),r.forEach(s=>{F(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(F(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function xle(t,n,e,r,o,i,s,a,l){let c=n.slice(),u=e.slice(),d=r;r==null&&(d=new Array(c.length));let p=hw(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(s!==0&&a!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(s!==0&&l!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let f=t.length-c.length,m=hw(a),h=t.slice();m.forEach(D=>{c[D]=0,u[D]=1,h.splice(D,0,1)});let{begin:g,end:x,strides:b}=fV(h,p,f,c,u,d,o,i,s);c=g,u=x,d=b;let I=hw(l);I.forEach(D=>{u[D]=c[D]+1,d[D]=1});let _=cV(c,u,d),E=_.filter((D,M)=>I.indexOf(M)===-1);return{nonStrided:d.every(D=>D===1),$begin:c,$end:u,$strides:d,size:_,newShape:h,outShape:E}}var Q={};Qi(Q,{Serializable:()=>uy,SerializationMap:()=>gw,registerClass:()=>Hr});var uy=class{getClassName(){return this.constructor.className}static fromConfig(n,e){return new n(e)}},gw=class t{constructor(){this.classNameMap={}}static getMap(){return t.instance==null&&(t.instance=new t),t.instance}static register(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]}};function Hr(t){F(t.className!=null,()=>"Class being registered does not have the static className property defined."),F(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),F(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),gw.register(t)}function ble(t){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}I3(ble);function il(){return k}function dy(){return k.memory()}function j(t,n){return k.tidy(t,n)}function Pe(t){iw(t).forEach(e=>e.dispose())}function $n(t){return k.keep(t)}function yw(t,n,e=1){return k.registerBackend(t,n,e)}function xV(){return k.backend}function wle(t,n){let e=N(t,"a","add"),r=N(n,"b","add");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel(Pi,o)}var re=A({add_:wle});function Cle(t,n){let e=N(t,"a","floorDiv"),r=N(n,"b","floorDiv");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel(Da,o)}var vw=A({floorDiv_:Cle});function _le(t,n){let e=N(t,"a","div"),r=N(n,"b","div");if([e,r]=Ze(e,r),e.dtype==="int32"&&r.dtype==="int32")return vw(e,r);let o={a:e,b:r},i={};return k.runKernel(Ca,o,i)}var ye=A({div_:_le});function Ile(t,n){let e=N(t,"a","mul"),r=N(n,"b","mul");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel($a,o)}var V=A({mul_:Ile});function Ele(t){let n=N(t,"x","abs");if(n.dtype==="complex64"){let e={x:n};return k.runKernel(cc,e)}else{let e={x:n};return k.runKernel(nc,e)}}var Sn=A({abs_:Ele});function Sle(t){let e={x:N(t,"x","acos")};return k.runKernel(da,e)}var zD=A({acos_:Sle});function Tle(t){let e={x:N(t,"x","acosh")};return k.runKernel(pa,e)}var UD=A({acosh_:Tle});function Dle(t,n=null,e=!1){let o={x:N(t,"x","all","bool")},i={axis:n,keepDims:e};return k.runKernel(Of,o,i)}var py=A({all_:Dle});function Nle(t,n=null,e=!1){let o={x:N(t,"x","any","bool")},i={axis:n,keepDims:e};return k.runKernel(Pf,o,i)}var vm=A({any_:Nle});function kle(t,n=0){let r={x:N(t,"x","argMax")},o={axis:n};return k.runKernel(rc,r,o)}var xm=A({argMax_:kle});function Ale(t,n=0){let r={x:N(t,"x","argMin")},o={axis:n};return k.runKernel(oc,r,o)}var bV=A({argMin_:Ale});function Rle(t){let e={x:N(t,"x","asin")};return k.runKernel(fa,e)}var jD=A({asin_:Rle});function Mle(t){let e={x:N(t,"x","asinh")};return k.runKernel(ma,e)}var GD=A({asinh_:Mle});function Fle(t){let e={x:N(t,"x","atan")};return k.runKernel(ha,e)}var WD=A({atan_:Fle});function Ole(t,n){let e=N(t,"a","atan2"),r=N(n,"b","atan2");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel(ya,o)}var wV=A({atan2_:Ole});function Ple(t){let e={x:N(t,"x","atanh")};return k.runKernel(ga,e)}var HD=A({atanh_:Ple});function Lle(t,n,e,r,o="NHWC",i){let s=t[3],a=[...n,s],l=_V(o);return Ad(t,a,e,i,r,null,null,l)}function KD(t,n,e,r,o,i,s="channelsLast"){let[a,l]=xw(n),c;if(s==="channelsLast")c=[a,l,t[3],t[3]];else if(s==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return Ad(t,c,e,r,o,i,!1,s)}function $le(t,n,e,r,o,i,s="NDHWC"){let[a,l,c]=qD(n),u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return CV(t,u,e,r,o,!1,d,i)}function Ad(t,n,e,r,o,i,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);let[p,f,,m]=n,[h,g]=xw(e),[x,b]=xw(r),I=bm(p,x),_=bm(f,b),{padInfo:E,outHeight:S,outWidth:D}=zle(o,c,u,h,g,I,_,i,a),M=s?m*d:m,R;return a==="channelsFirst"?R=[l,M,S,D]:a==="channelsLast"&&(R=[l,S,D,M]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:S,outWidth:D,outChannels:M,padInfo:E,strideHeight:h,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:I,effectiveFilterWidth:_,dilationHeight:x,dilationWidth:b,inShape:t,outShape:R,filterShape:n}}function CV(t,n,e,r,o,i=!1,s="channelsLast",a){let[l,c,u,d,p]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,p]=t;else if(s==="channelsFirst")[l,p,c,u,d]=t;else throw new Error(`Unknown dataFormat ${s}`);let[f,m,h,,g]=n,[x,b,I]=qD(e),[_,E,S]=qD(r),D=bm(f,_),M=bm(m,E),R=bm(h,S),{padInfo:L,outDepth:G,outHeight:W,outWidth:q}=Ule(o,c,u,d,x,b,I,D,M,R,a),X=i?g*p:g,K;return s==="channelsFirst"?K=[l,X,G,W,q]:s==="channelsLast"&&(K=[l,G,W,q,X]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:p,outDepth:G,outHeight:W,outWidth:q,outChannels:X,padInfo:L,strideDepth:x,strideHeight:b,strideWidth:I,filterDepth:f,filterHeight:m,filterWidth:h,effectiveFilterDepth:D,effectiveFilterHeight:M,effectiveFilterWidth:R,dilationDepth:_,dilationHeight:E,dilationWidth:S,inShape:t,outShape:K,filterShape:n}}function Vle(t,n,e,r,o){r==null&&(r=XD(t,n,e));let i=t[0],s=t[1],a=kd((i-n+2*r)/e+1,o),l=kd((s-n+2*r)/e+1,o);return[a,l]}function Ble(t,n,e,r,o,i){o==null&&(o=XD(t,n,r));let s=t[0],a=t[1],l=t[2],c=kd((s-n+2*o)/r+1,i),u=kd((a-n+2*o)/r+1,i),d=kd((l-n+2*o)/r+1,i);return[c,u,d,e]}function XD(t,n,e,r=1){let o=bm(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function xw(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function qD(t){return typeof t=="number"?[t,t,t]:t}function bm(t,n){return n<=1?t:t+(t-1)*(n-1)}function zle(t,n,e,r,o,i,s,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let f=Vle([n,e],i,r,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(n/r),d=Math.ceil(e/o);let p=Math.max(0,(u-1)*r+i-n),f=Math.max(0,(d-1)*o+s-e),m=Math.floor(p/2),h=p-m,g=Math.floor(f/2),x=f-g;c={top:m,bottom:h,left:g,right:x,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((n-i+1)/r),d=Math.ceil((e-s+1)/o);else if(typeof t=="object"){let p=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];c={top:p,bottom:f,left:m,right:h,type:p===0&&f===0&&m===0&&h===0?"VALID":"EXPLICIT"},u=kd((n-i+p+f)/r+1,a),d=kd((e-s+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function Ule(t,n,e,r,o,i,s,a,l,c,u){let d,p,f,m;if(typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=Ble([n,e,r,1],a,1,o,t,u);p=g[0],f=g[1],m=g[2]}else if(t==="same"){p=Math.ceil(n/o),f=Math.ceil(e/i),m=Math.ceil(r/s);let h=(p-1)*o+a-n,g=(f-1)*i+l-e,x=(m-1)*s+c-r,b=Math.floor(h/2),I=h-b,_=Math.floor(g/2),E=g-_,S=Math.floor(x/2),D=x-S;d={top:_,bottom:E,left:S,right:D,front:b,back:I,type:"SAME"}}else if(t==="valid")d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((n-a+1)/o),f=Math.ceil((e-l+1)/i),m=Math.ceil((r-c+1)/s);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:p,outHeight:f,outWidth:m}}function kd(t,n){if(!n)return Math.trunc(t);switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${n}`)}}function Mo(t){let[n,e,r]=xw(t);return n===1&&e===1&&r===1}function Wn(t,n){return Mo(t)||Mo(n)}function _V(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function jle(t,n){let r={x:N(t,"x","reshape","string_or_numeric")},o={shape:n};return k.runKernel(Fc,r,o)}var B=A({reshape_:jle});function Gle(t,n,e,r,o){let i=N(t,"x","avgPool","float32"),s=1;F(Wn(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),o!=null&&F(bt(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(ic,c,u);return d=ue(d,i.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Rd=A({avgPool_:Gle});function Wle(t,n,e,r,o,i="NDHWC"){let s=N(t,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),F(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&F(bt(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(sc,c,u);return d=ue(d,a.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var YD=A({avgPool3d_:Wle});function Hle(t,n=0){F(t.length>=1,()=>"Pass at least one tensor to concat");let e=aw(t,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Bi(e[0]);let r=e,o={axis:n};return k.runKernel(uc,r,o)}var jt=A({concat_:Hle});function qle(t){let e={x:N(t,"x","sigmoid")};return k.runKernel(Xa,e)}var ri=A({sigmoid_:qle});function Kle(t,n,e){let r=N(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:n,size:e};return k.runKernel(Vc,o,i)}var at=A({slice_:Kle});function Xle(t){let e={x:N(t,"x","tanh")};return k.runKernel(tl,e)}var wm=A({tanh_:Xle});function Yle(t,n,e){let r=N(t,"x","batchToSpaceND"),o=n.reduce((a,l)=>a*l);F(r.rank>=1+n.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${n.length}`),F(e.length===n.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${n.length}`),F(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${n.join(" * ")} === ${o}`);let i={x:r},s={blockShape:n,crops:e};return k.runKernel(lc,i,s)}var Cm=A({batchToSpaceND_:Yle});function IV(t){let n;return t.rank===0||t.rank===1?n=B(t,[1,1,1,t.size]):t.rank===2?n=B(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?n=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]):n=t,n}function Zle(t,n,e,r,o,i){i==null&&(i=.001);let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;r!=null&&(u=N(r,"offset","batchNorm")),F(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),F(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),F(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:IV(s),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},m=k.runKernel(vc,p,f);return B(m,s.shape)}var Qc=A({batchNorm_:Zle});function Qle(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),F(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),F(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),F(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Qc(s,a,l,u,c,i)}var ZD=A({batchNorm2d_:Qle});function Jle(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),F(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),F(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),F(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Qc(s,a,l,u,c,i)}var QD=A({batchNorm3d_:Jle});function ece(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),F(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),F(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),F(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&F(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&F(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Qc(s,a,l,u,c,i)}var JD=A({batchNorm4d_:ece});function tce(t,n){let e=N(t,"broadcastTo","x"),r=e.shape;if(n.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${n}].`);if(n.length<e.rank)throw new Error(`broadcastTo(): shape.length=${n.length} < input.rank=${e.rank}.`);if(n.length>e.rank){let c=e.shape.slice();for(;c.length<n.length;)c.unshift(1);e=B(e,c)}let o=e.shape,i=Array.from(n);for(let c=n.length-1;c>=0;c--)if(o[c]===n[c])i[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${n}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Bi(e);let a={x:e},l={reps:i};return k.runKernel(xs,a,l)}var _m=A({broadcastTo_:tce});function nce(t){let e={x:N(t,"x","ceil")};return k.runKernel(va,e)}var eN=A({ceil_:nce});function rce(t,n,e){let r=N(t,"x","clipByValue");F(n<=e,()=>`Error in clip: min (${n}) must be less than or equal to max (${e}).`);let o={x:r},i={clipValueMin:n,clipValueMax:e};return k.runKernel(xa,o,i)}var Hn=A({clipByValue_:rce});function oce(t){return jt(t,0)}var tN=A({concat1d_:oce});function ice(t,n){return jt(t,n)}var nN=A({concat2d_:ice});function sce(t,n){return jt(t,n)}var rN=A({concat3d_:sce});function ace(t,n){return jt(t,n)}var oN=A({concat4d_:ace});function lce(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","conv2d"),l=N(n,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),s!=null&&F(bt(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d=o==="NHWC"?c.shape[3]:c.shape[1];F(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),F(Wn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},m=k.runKernel(dc,p,f);return u?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var ho=A({conv2d_:lce});function cce(t,n,e,r,o="NWC",i=1,s){let a=N(t,"x","conv1d"),l=N(n,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1]])),F(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),F(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),s!=null&&F(bt(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),F(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),F(Wn(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),F(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let d=B(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=B(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=ho(p,d,[1,e],r,"NHWC",[1,i],s);return u?B(g,[g.shape[2],g.shape[3]]):B(g,[g.shape[0],g.shape[2],g.shape[3]])}var fy=A({conv1d_:cce});function uce(t,n,e,r,o,i="NHWC",s){F(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let a=t,l=n,c=!1;n.rank===3&&(c=!0,l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]),a=[1,t[0],t[1],t[2]]),F(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),F(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),F(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];F(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),F(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),s!=null&&F(bt(o),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let p={dy:l,filter:e},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},m=k.runKernel(pc,p,f);return c?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Im=A({conv2DBackpropInput_:uce});function dce(t,n,e,r,o,i){let s=N(t,"x","conv2dTranspose"),a=N(n,"filter","conv2dTranspose");return Im(e,s,a,r,o,"NHWC",i)}var my=A({conv2dTranspose_:dce});function pce(t,n,e,r,o="NDHWC",i=[1,1,1]){let s=N(t,"x","conv3d"),a=N(n,"filter","conv3d"),l=s,c=!1;s.rank===4&&(c=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),F(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),F(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),F(Wn(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),F(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let u={x:l,filter:a},d={strides:e,pad:r,dataFormat:o,dilations:i},p=k.runKernel(fc,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var iN=A({conv3d_:pce});function fce(t,n,e,r,o){F(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let i=t,s=n,a=!1;n.rank===4&&(a=!0,s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);let l=i[4],c=s.shape[4];F(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),F(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),F(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),F(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),F(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let u={dy:s,filter:e},d={pad:o,strides:r,inputShape:i},p=k.runKernel(Uf,u,d);return a?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var bw=A({conv3DBackpropInput_:fce});function mce(t,n,e,r,o){let i=N(t,"x","conv3dTranspose"),s=N(n,"filter","conv3dTranspose");return bw(e,i,s,r,o)}var sN=A({conv3dTranspose_:mce});function hce(t){let e={x:N(t,"x","cos")};return k.runKernel(ba,e)}var Md=A({cos_:hce});function gce(t){let e={x:N(t,"x","cosh")};return k.runKernel(wa,e)}var hy=A({cosh_:gce});function yce(t,n=0,e=!1,r=!1){let i={x:N(t,"x","cumsum")},s={axis:n,exclusive:e,reverse:r};return k.runKernel(mc,i,s)}var ww=A({cumsum_:yce});function vce(t,n,e="NHWC"){let r=N(t,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];F(o*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${n}  for depthToSpace with input shape
    ${r.shape}`),F(i*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${n} for depthToSpace with input shape
        ${r.shape}`),F(s%(n*n)===0,()=>`Dimension size must be evenly divisible by ${n*n} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:n,dataFormat:e};return k.runKernel(jf,a,l)}var EV=A({depthToSpace_:vce});function xce(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","depthwiseConv2d"),l=N(n,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),F(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),F(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`),F(c.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),s!=null&&F(bt(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d={x:c,filter:l},p={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},f=k.runKernel(hc,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var al=A({depthwiseConv2d_:xce});function bce(t,n,e,r,o=[1,1],i="NHWC"){let s=N(t,"x","dilation2d"),a=N(n,"filter","dilation2d");F(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),F(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),F(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,c=!1;s.rank===3&&(l=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0);let u={x:l,filter:a},d={strides:e,pad:r,dilations:o},p=k.runKernel(gc,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var SV=A({dilation2d_:bce});function wce(t,n){let e=t.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=t[i]||1;(n[n.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function $t(t,n){let e=[];for(let r=0;r<n.length;r++){let o=t[t.length-r-1],i=n.length-r-1,s=n[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function We(t,n){let e=[],r=Math.max(t.length,n.length);for(let o=0;o<r;o++){let i=t[t.length-o-1];i==null&&(i=1);let s=n[n.length-o-1];if(s==null&&(s=1),i===1)e.unshift(s);else if(s===1)e.unshift(i);else if(i!==s){let a=`Operands could not be broadcast together with shapes ${t} and ${n}.`;throw Error(a)}else e.unshift(i)}return e}function Cce(t,n){let e=N(t,"a","equal"),r=N(n,"b","equal");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(pd,o)}var oi=A({equal_:Cce});function _ce(t,n,e){let r=N(n,"a","where"),o=N(e,"b","where"),i=N(t,"condition","where","bool"),s=We(We(i.shape,r.shape),o.shape),a=_m(i,s),l=_m(r,s),c=_m(o,s),u={condition:a,t:l,e:c};return k.runKernel($c,u)}var dn=A({where_:_ce});function Ice(t){let e={x:N(t,"x","zerosLike")};return k.runKernel(qc,e)}var De=A({zerosLike_:Ice});function Ece(t,n){let e=N(t,"a","div"),r=N(n,"b","div");[e,r]=Ze(e,r);let o=ye(e,r),i=De(o),s=oi(r,i);return dn(s,i,o)}var TV=A({divNoNan_:Ece});function Sce(t,n){let e=N(t,"t1","dot"),r=N(n,"t2","dot");F((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(F(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=B(e,[1,-1]),a=B(r,[-1,1]),l=wt(s,a);return B(l,[])}else if(e.rank===1&&r.rank===2){let s=B(e,[1,-1]),a=B(r,[r.shape[0],r.shape[1]]),l=wt(s,a);return B(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=B(r,[-1,1]),a=wt(e,s);return B(a,[a.size])}else{let s=B(r,[r.shape[0],r.shape[1]]);return wt(e,s)}}var DV=A({dot_:Sce});function Tce(t){let e={x:N(t,"x","elu")};return k.runKernel(_a,e)}var ll=A({elu_:Tce});function Dce(t){let n=N(t,"x","erf");F(n.dtype==="int32"||n.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),n.dtype==="int32"&&(n=ue(n,"float32"));let e={x:n};return k.runKernel(Ia,e)}var aN=A({erf_:Dce});function Nce(t){let e={x:N(t,"x","exp")};return k.runKernel(Ea,e)}var Dr=A({exp_:Nce});function kce(t,n=0){let e=N(t,"x","expandDims","string_or_numeric");F(n<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:n};return k.runKernel(yc,r,o)}var nr=A({expandDims_:kce});function Ace(t){let e={x:N(t,"x","expm1")};return k.runKernel(Sa,e)}var lN=A({expm1_:Ace});function Rce(t,n){let e=N(t,"x","tile","string_or_numeric");F(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${n}.`);let r={x:e},o={reps:n};return k.runKernel(xs,r,o)}var zi=A({tile_:Rce});function Mce(t,n,e,r="float32"){n==null&&(n=t);let o=Te([t,n],r),i=t<=n?t:n;for(let a=0;a<i;++a)o.set(1,a,a);let s=B(o.toTensor(),[t,n]);if(e==null)return s;if(e.length===1)return zi(nr(s,0),[e[0],1,1]);if(e.length===2)return zi(nr(nr(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return zi(nr(nr(nr(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var Em=A({eye_:Mce});function gy(t,n,e){let r={shape:t,value:n,dtype:e};return k.runKernel(Kf,{},r)}function Fce(t){let e={x:N(t,"x","floor")};return k.runKernel(Ta,e)}var cl=A({floor_:Fce});function Oce(t,n,e=0,r=0){let o=N(t,"x","gather"),i=N(n,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return k.runKernel(xc,s,a)}var Fd=A({gather_:Oce});function Pce(t,n){let e=N(t,"a","greater"),r=N(n,"b","greater");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(fd,o)}var qn=A({greater_:Pce});function Lce(t,n){let e=N(t,"a","greaterEqual"),r=N(n,"b","greaterEqual");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Na,o)}var Fo=A({greaterEqual_:Lce});function $ce(t){let e={input:N(t,"input","imag")};return k.runKernel(Yf,e)}var Cw=A({imag_:$ce});function Vce(t){let e={x:N(t,"x","isFinite")};return k.runKernel(ka,e)}var cN=A({isFinite_:Vce});function Bce(t){let e={x:N(t,"x","isInf")};return k.runKernel(Aa,e)}var uN=A({isInf_:Bce});function zce(t){let e={x:N(t,"x","isNaN")};return k.runKernel(Ra,e)}var dN=A({isNaN_:zce});function Uce(t,n=.2){let r={x:N(t,"x","leakyRelu")},o={alpha:n};return k.runKernel(bc,r,o)}var Od=A({leakyRelu_:Uce});function jce(t,n){let e=N(t,"a","less"),r=N(n,"b","less");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(md,o)}var _w=A({less_:jce});function Gce(t,n){let e=N(t,"a","lessEqual"),r=N(n,"b","lessEqual");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(hd,o)}var Cs=A({lessEqual_:Gce});function Wce(t,n=5,e=1,r=1,o=.5){let i=N(t,"x","localResponseNormalization");F(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),F(bt(n),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${n}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=B(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},c={depthRadius:n,bias:e,alpha:r,beta:o},u=k.runKernel(wc,l,c);return a?B(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var NV=A({localResponseNormalization_:Wce});function Hce(t){let e={x:N(t,"x","log")};return k.runKernel(Ma,e)}var Nr=A({log_:Hce});function qce(t){let e={x:N(t,"x","log1p")};return k.runKernel(Fa,e)}var pN=A({log1p_:qce});function fN(t,n){F(Af(t),()=>"The f passed in variableGrads(f) must be a function"),F(n==null||Array.isArray(n)&&n.every(c=>c instanceof rl),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=n!=null;if(!e){n=[];for(let c in k.registeredVariables)n.push(k.registeredVariables[c])}let r=e?n.filter(c=>!c.trainable):null,o=n.length;n=n.filter(c=>c.trainable),F(n.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=k.gradients(t,n,null,i);F(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),F(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return n.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:s,grads:l}}function Oo(t){return k.customGrad(t)}function Kce(t){let e={x:N(t,"x","neg")};return k.runKernel(Dc,e)}var Ct=A({neg_:Kce});function Xce(t){let e={x:N(t,"x","softplus")};return k.runKernel(Ya,e)}var _s=A({softplus_:Xce});function Yce(t){let n=N(t,"x","logSigmoid");return Oo(r=>({value:Ct(_s(Ct(r))),gradFunc:s=>V(s,ri(Ct(r)))}))(n)}var mN=A({logSigmoid_:Yce});function Zce(t,n=null,e=!1){let o={x:N(t,"x","max")},i={reductionIndices:n,keepDims:e};return k.runKernel(Cc,o,i)}var Kn=A({max_:Zce});function Qce(t,n){let e=N(t,"a","sub"),r=N(n,"b","sub");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel(Ja,o)}var Se=A({sub_:Qce});function Jce(t,n=null,e=!1){let r=N(t,"x","sum");r.dtype==="bool"&&(r=ue(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(Bc,o,i)}var Ce=A({sum_:Jce});function eue(t,n=-1){let e=N(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${n}`);return Oo((o,i)=>{let a=Kn(o,n,!0),l=Se(o,a),c=Se(ue(l,"float32"),Nr(Ce(Dr(l),n,!0)));return i([c]),{value:c,gradFunc:(d,p)=>{let[f]=p,m=!0,h=Dr(f);return Se(d,V(Ce(d,n,m),h))}}})(e)}var yy=A({logSoftmax_:eue});function hN(t,n){for(let e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function kV(t,n,e){let r=t.length+n.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(t[i++]):o.push(n[s++]);return o}function gN(t,n){let e=[],r=t.length;for(let i=0;i<r;i++)n.indexOf(i)===-1&&e.push(t[i]);let o=n.map(i=>t[i]);return[e,o]}function Is(t,n){let e=n.map(r=>1);return kV(t,e,n)}function tue(t,n,e){F(hN(n,e),()=>`${t} supports only inner-most axes for now. Got axes ${n} and rank-${e} input.`)}function yN(t,n){if(hN(t,n))return null;let e=[];for(let r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(r=>e.push(r)),e}function vy(t){return t.map((n,e)=>[e,n]).sort((n,e)=>n[1]-e[1]).map(n=>n[0])}function nue(t,n){let e=[];for(let r=n-t;r<n;++r)e.push(r);return e}function rue(t,n=null,e=!1){let r=N(t,"x","logSumExp"),o=En(n,r.shape),i=Kn(r,o,!0),s=Se(r,i),a=Dr(s),l=Ce(a,o),c=Nr(l),u=re(B(i,c.shape),c);if(e){let d=Is(u.shape,o);return B(u,d)}return u}var AV=A({logSumExp_:rue});function oue(t,n){let e=N(t,"a","logicalAnd","bool"),r=N(n,"b","logicalAnd","bool");We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(gd,o)}var br=A({logicalAnd_:oue});function iue(t){let e={x:N(t,"x","logicalNot","bool")};return k.runKernel(yd,e)}var Sm=A({logicalNot_:iue});function sue(t,n){let e=N(t,"a","logicalOr","bool"),r=N(n,"b","logicalOr","bool");We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(vd,o)}var Iw=A({logicalOr_:sue});function aue(t,n){let e=N(t,"a","logicalXor","bool"),r=N(n,"b","logicalXor","bool");return We(e.shape,r.shape),br(Iw(t,n),Sm(br(t,n)))}var RV=A({logicalXor_:aue});function lue(t,n,e,r,o){let i=N(t,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),F(Wn(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),o!=null&&F(bt(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(_c,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Pd=A({maxPool_:lue});function cue(t,n=[1,1,1],e,r,o,i="NDHWC"){let s=N(t,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),F(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),F(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&F(bt(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(Ic,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var xN=A({maxPool3d_:cue});function uue(t,n){let e=N(t,"a","maximum"),r=N(n,"b","maximum");[e,r]=Ze(e,r),e.dtype==="bool"&&(e=ue(e,"int32"),r=ue(r,"int32")),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Oa,o)}var go=A({maximum_:uue});function due(t,n=null,e=!1){let o={x:N(t,"x","mean")},i={axis:n,keepDims:e};return k.runKernel(Ec,o,i)}var qt=A({mean_:due});function Gt(t,n="float32"){if(n==="complex64"){let r=Gt(t,"float32"),o=Gt(t,"float32");return $i(r,o)}let e=Mf(Lt(t),n);return k.makeTensor(e,t,n)}function yo(t,n="float32"){if(n==="complex64"){let r=yo(t,"float32"),o=Gt(t,"float32");return $i(r,o)}let e=Qg(Lt(t),n);return k.makeTensor(e,t,n)}function pue(t,n=null,e=!1){let o={x:N(t,"x","min")},i={axis:n,keepDims:e};return k.runKernel(Sc,o,i)}var eu=A({min_:pue});function fue(t,n){let e=N(t,"a","minimum"),r=N(n,"b","minimum");[e,r]=Ze(e,r),e.dtype==="bool"&&(e=ue(e,"int32"),r=ue(r,"int32")),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Pa,o)}var Ld=A({minimum_:fue});function mue(t,n,e){F(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=N(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");F(n.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${n.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)F(n[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),F(n[a][0]>=0&&n[a][0]<=r.shape[a]-o&&n[a][1]>=0&&n[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:n,mode:e},s={x:r};return k.runKernel(Tc,s,i)}var MV=A({mirrorPad_:mue});function hue(t,n){let e=N(t,"a","mod"),r=N(n,"b","mod");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel(La,o)}var FV=A({mod_:hue});function gue(t){let n=N(t,"x","square"),e={};return k.runKernel("Square",{x:n},e)}var Ke=A({square_:gue});function yue(t,n=null,e=!1){t=N(t,"x","moments");let r=En(n,t.shape),o=qt(t,r,e),i=o.shape;e||(i=Is(o.shape,r));let s=Ke(Se(ue(t,"float32"),B(o,i))),a=qt(s,r,e);return{mean:o,variance:a}}var Tm=A({moments_:yue});function vue(t,n){let e=N(t,"a","notEqual"),r=N(n,"b","notEqual");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(xd,o)}var tu=A({notEqual_:vue});function xue(t){let e={x:N(t,"x","onesLike")};return k.runKernel(Nc,e)}var Vn=A({onesLike_:xue});function bue(t,n,e=0){let r=N(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:n,constantValue:e},i={x:r};return k.runKernel(Rc,i,o)}var $d=A({pad_:bue});function wue(t,n,e){let r=N(t,"x","spaceToBatchND");F(r.rank>=1+n.length,()=>`input rank ${r.rank} should be > than [blockShape] ${n.length}`),F(e.length===n.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${n.length}`),F(r.shape.reduce((s,a,l)=>l>0&&l<=n.length?s&&(a+e[l-1][0]+e[l-1][1])%n[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${n.toString()}`);let o={x:r},i={blockShape:n,paddings:e};return k.runKernel(zc,o,i)}var Dm=A({spaceToBatchND_:wue});function Cue(t,n,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=N(t,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]])),F(Wn(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let c=KD(a.shape,n,i,o,r),u=[c.dilationHeight,c.dilationWidth],d;r==="same"?d=Iue([c.filterHeight,c.filterWidth],u):d=[[0,0],[0,0]];let p=u[0]===1&&u[1]===1,[f,m]=_ue([c.inHeight,c.inWidth],u,d),h=p?r:"valid",g=p?a:Dm(a,u,f),b=(e==="avg"?()=>Rd(g,n,i,h):()=>Pd(g,n,i,h))(),I=p?b:Cm(b,u,m);return l?B(I,[I.shape[1],I.shape[2],I.shape[3]]):I}function _ue(t,n,e){let r=e.map(u=>u[0]),o=e.map(u=>u[1]),i=t.concat(r,o),s=n.map((u,d)=>(u-i[d]%u)%u),a=o.map((u,d)=>u+s[d]),l=n.map((u,d)=>[r[d],a[d]]),c=n.map((u,d)=>[0,s[d]]);return[l,c]}function Iue(t,n){let r=t.map((s,a)=>s+(s-1)*(n[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var OV=A({pool_:Cue});function Eue(t,n){let e=N(t,"base","pow"),r=N(n,"exp","pow");[e,r]=Ze(e,r);let o={a:e,b:r};return k.runKernel(Va,o)}var ii=A({pow_:Eue});function Sue(t,n){let e=N(t,"x","prelu"),r=N(n,"alpha","prelu"),o={x:e,alpha:r};return k.runKernel(Mc,o)}var Vd=A({prelu_:Sue});function Tue(t,n=null,e=!1){let r=N(t,"x","prod");r.dtype==="bool"&&(r=ue(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(em,o,i)}var PV=A({prod_:Tue});var SN=mh(ZV());var Nm=class{constructor(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=SN.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let n,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(n))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(n)}convertValue(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)}isValidTruncated(n){return n<=this.upper&&n>=this.lower}};var Tw=class{constructor(n=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${n} - ${e} <= 1 and dtype is not float`);this.random=SN.alea(o)}convertValue(n){return this.canReturnFloat()?n:Math.round(n)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Fue(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new Nm(n,e,r,!1,o),s=Te(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Dw=A({randomNormal_:Fue});function Oue(t,n=0,e=1,r="float32",o){let i=Te(t,r),s=new Tw(n,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var ul=A({randomUniform_:Oue});function TN(t,n,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:n,step:e,dtype:r};return k.runKernel(tm,{},o)}function Pue(t){let e={input:N(t,"input","real")};return k.runKernel(nm,e)}var xy=A({real_:Pue});function Lue(t){let e={x:N(t,"x","reciprocal")};return k.runKernel(Ba,e)}var DN=A({reciprocal_:Lue});function $ue(t){let e={x:N(t,"x","relu")};return k.runKernel(za,e)}var si=A({relu_:$ue});function Vue(t){let e={x:N(t,"x","relu6")};return k.runKernel(Ua,e)}var Nw=A({relu6_:Vue});function Bue(t,n){let r={x:N(t,"x","reverse")},o={dims:n};return k.runKernel(Lc,r,o)}var Po=A({reverse_:Bue});function zue(t){let e={x:N(t,"x","round")};return k.runKernel(ja,e)}var NN=A({round_:zue});function Uue(t){let e={x:N(t,"x","rsqrt")};return k.runKernel(Ga,e)}var by=A({rsqrt_:Uue});function Fe(t,n){if((mo(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&mo(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Xc(t,[],[],n)}function jue(t){let e={x:N(t,"x","selu")};return k.runKernel(Wa,e)}var wy=A({selu_:jue});function Gue(t,n,e,r,o,i=[1,1],s="NHWC"){let a=N(t,"x","separableConv2d"),l=N(n,"depthwiseFilter","separableConv2d"),c=N(e,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");F(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),F(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),F(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),F(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let p=l.shape[2],f=l.shape[3];F(c.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`);let m=al(u,l,r,o,s,i),g=ho(m,c,1,"valid",s);return d?B(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Cy=A({separableConv2d_:Gue});function Wue(t){let e={x:N(t,"x","sign")};return k.runKernel(Ka,e)}var kN=A({sign_:Wue});function Hue(t){let e={x:N(t,"x","sin")};return k.runKernel(Ha,e)}var _y=A({sin_:Hue});function que(t){let e={x:N(t,"x","sinh")};return k.runKernel(qa,e)}var Iy=A({sinh_:que});function Kue(t,n,e){let r=N(t,"x","slice1d");return F(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),at(r,[n],[e])}var Ey=A({slice1d_:Kue});function Xue(t,n,e){let r=N(t,"x","slice2d");return F(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),at(r,n,e)}var kw=A({slice2d_:Xue});function Yue(t,n,e){let r=N(t,"x","slice3d");return F(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),at(r,n,e)}var Sy=A({slice3d_:Yue});function Zue(t,n,e){let r=N(t,"x","slice4d");return F(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),at(r,n,e)}var km=A({slice4d_:Zue});function Que(t,n=-1){let e=N(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${n}`);let r={logits:e},o={dim:n};return k.runKernel(jc,r,o)}var zd=A({softmax_:Que});function Jue(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(qf,n)}var Ty=A({fft_:Jue});function ede(t){F(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Xf,n)}var Am=A({ifft_:ede});function tde(t){let n=t.shape[t.shape.length-1],e=t.size/n,r;if(n<=2){let o=B(t,[e,n]);r=Am(o)}else{let o=[e,2*(n-1)],i=B(xy(t),[e,n]),s=B(Cw(t),[e,n]),a=Po(at(i,[0,1],[e,n-2]),1),l=V(Po(at(s,[0,1],[e,n-2]),1),Fe(-1)),c=jt([i,a],1),u=jt([s,l],1),d=B($i(c,u),[o[0],o[1]]);r=Am(d)}if(r=xy(r),t.rank===3&&t.shape[0]!==0){let o=r,i=t.shape[0];r=B(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var AN=A({irfft_:tde});function nde(t,n,e=0){let o={x:N(t,"x","split")},i={numOrSizeSplits:n,axis:e};return k.runKernel(Uc,o,i)}var Xn=A({split_:nde});function rde(t,n){F(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let e=t.shape[t.shape.length-1],r=t.size/e,o;if(n!=null&&n<e){let m=t.shape.map(g=>0),h=t.shape.map(g=>g);h[t.shape.length-1]=n,o=at(t,m,h),e=n}else if(n!=null&&n>e){let m=t.shape.map(h=>h);m[t.shape.length-1]=n-e,o=jt([t,Gt(m)],t.shape.length-1),e=n}else o=t;let i=De(o),s=B($i(o,i),[r,e]),a=Ty(s),l=Math.floor(e/2)+1,c=xy(a),u=Cw(a),d=Xn(c,[l,e-l],c.shape.length-1),p=Xn(u,[l,e-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,B($i(d[0],p[0]),f)}var RN=A({rfft_:rde});function ode(t){let e={x:N(t,"x","sqrt")};return k.runKernel(Za,e)}var Wt=A({sqrt_:ode});function ide(t,n){let e=N(t,"a","squaredDifference"),r=N(n,"b","squaredDifference");[e,r]=Ze(e,r),We(e.shape,r.shape);let o={a:e,b:r},i={};return k.runKernel(Qa,o,i)}var QV=A({squaredDifference_:ide});function sde(t,n){let e=N(t,"x","squeeze");return B(e,cD(e.shape,n).newShape)}var Ud=A({squeeze_:sde});function ade(t,n=0){let e=aw(t,"tensors","stack","string_or_numeric");F(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&F(n<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:n};return k.runKernel(Ac,r,o)}var rr=A({stack_:ade});function lde(t,n=0){let r={x:N(t,"x","step")},o={alpha:n};return k.runKernel(nl,r,o)}var Ui=A({step_:lde});function cde(t,n,e,r,o=0,i=0,s=0,a=0,l=0){let u={x:N(t,"x","stridedSlice")},d={begin:n,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return k.runKernel(sm,u,d)}var MN=A({stridedSlice_:cde});function ude(t){let e={x:N(t,"x","tan")};return k.runKernel(el,e)}var FN=A({tan_:ude});function ai(t,n){Zg(t);let e=Ed(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Xc(t,null,e,n)}function nu(t,n,e){if(Zg(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=Ed(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Xc(t,n,r,e)}function dde(t,n=1,e=!0){let r=N(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(n>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${n}`);let i={x:r},s={k:n,sorted:e},[a,l]=k.runKernel(am,i,s);return{values:a,indices:l}}var JV=A({topk_:dde});function pde(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new Nm(n,e,r,!0,o),s=Te(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Dy=A({truncatedNormal_:pde});function fde(t,n=0){let e=N(t,"x","unique","string_or_numeric");F(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:n},[i,s]=k.runKernel(lm,r,o);return{values:i,indices:s}}var eB=A({unique_:fde});function mde(t,n,e){let r=N(t,"x","unsortedSegmentSum"),o=N(n,"segmentIds","unsortedSegmentSum","int32");F(bt(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return k.runKernel(Hc,i,s)}var Aw=A({unsortedSegmentSum_:mde});function hde(t,n=0){let e=N(t,"x","unstack","string_or_numeric");F(n>=-e.shape.length&&n<e.shape.length,()=>`Axis = ${n} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:n};return k.runKernel(Wc,r,o)}var qr=A({unstack_:hde});function ON(t,n=!0,e,r){return k.makeVariable(t,n,e,r)}function tB(t,n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(i);let r=Te(t,"int32"),o=Te([e.length,t.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*t.length;o.values.set(s,a)}return o.toTensor()}function gde(t,n="euclidean",e=null,r=!1){t=N(t,"x","norm");let o=nB(t,n,e),i=o.shape;if(r){let s=En(e,t.shape);i=Is(o.shape,s)}return B(o,i)}function nB(t,n,e=null){if(t.rank===0)return Sn(t);if(t.rank!==1&&e===null)return nB(B(t,[-1]),n,e);if(t.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(n===1)return Ce(Sn(t),e);if(n===1/0)return Kn(Sn(t),e);if(n===-1/0)return eu(Sn(t),e);if(n==="euclidean"||n===2)return Wt(Ce(ii(Sn(t),Fe(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}if(Array.isArray(e)&&e.length===2){if(n===1)return Kn(Ce(Sn(t),e[0]),e[1]-1);if(n===1/0)return Kn(Ce(Sn(t),e[1]),e[0]);if(n===-1/0)return eu(Ce(Sn(t),e[1]),e[0]);if(n==="fro"||n==="euclidean")return Wt(Ce(Ke(t),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var Rm=A({norm_:gde});function rB(t,n){if(n==null)return t.shape.slice();if(hs(t.shape,n))return n;if(t.shape.length===n.length){let e=[];for(let r=0;r<t.shape.length;r++)n[r]==null&&t.shape[r]!=null?e.push(t.shape[r]):e.push(n[r]);return e}return n}function yde(t,n,e,r){let o=N(t,"x","dropout");if(F(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),F(n>=0&&n<1,()=>`rate must be a float in the range [0, 1), but got ${n}.`),n===0)return t instanceof ft?o.clone():o;let i=rB(o,e),s=1-n,a=ye(cl(re(ul(i,0,1,"float32",r),s)),s);return V(o,a)}var oB=A({dropout_:yde});var qd={};Qi(qd,{conv2d:()=>iB,depthwiseConv2d:()=>sB,matMul:()=>aB});function vde(t,n,e,r,o,i="NHWC",s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]])),F(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),F(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),F(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];F(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),F(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),s!=null&&F(bt(o),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let d={x:a,dy:l},p={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return k.runKernel(Bf,d,p)}var Mm=A({conv2DBackpropFilter_:vde});function jd(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return V(t,Ui(n));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Gd(t,n){let e=n,r=$t(t.shape,n.shape);return r.length>0&&(e=Ce(e,r)),B(e,t.shape)}function Wd(t,n,e,r){if(n==="linear")return t;if(n==="relu")return si(t);if(n==="elu")return ll(t);if(n==="relu6")return Nw(t);if(n==="prelu")return Vd(t,e);if(n==="leakyrelu")return Od(t,r);if(n==="sigmoid")return ri(t);throw new Error(`Unknown fused activation ${n}.`)}var Hd=(t,n)=>!(t>0)||n==="linear";function xde({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Hd(k.state.gradientDepth,l)===!1){let E=ho(t,n,e,r,o,i,s);return a!=null&&(E=re(E,a)),Wd(E,l,c,u)}let d=N(t,"x","conv2d"),p=N(n,"filter","conv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),F(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),s!=null&&F(bt(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),F(f.shape[3]===p.shape[2],()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${p.shape[2]}.`),F(Wn(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),F(o==="NHWC",()=>`Error in conv2d: got dataFormat of ${o} but only NHWC is currently supported.`);let h=Ad(f.shape,p.shape,e,i,r,s),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Ze(g,d),We(h.outShape,g.shape));let x;c!=null&&(x=N(c,"prelu weights","fused conv2d"));let b=(E,S)=>{let[D,M,R,L]=S,G=jd(E,R,l);F(Mo(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let W=Im(M.shape,G,D,e,r),q=Mm(M,G,D.shape,e,r),X=[W,q];if(L!=null){let K=Gd(L,G);X.push(K)}return X},I={x:f,filter:p,bias:g,preluActivationWeights:x},_={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?Oo((S,D,M)=>{let R=k.runKernel(wd,I,_);return M([D,S,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(f,p):Oo((S,D,M,R)=>{let L=k.runKernel(wd,I,_);return R([D,S,L,M]),m&&(L=B(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:b}})(f,p,g)}var iB=A({fusedConv2d_:xde});function bde(t,n,e,r,o,i=[1,1],s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return k.runKernel(Gf,c,u)}var Rw=A({depthwiseConv2dNativeBackpropFilter_:bde});function wde(t,n,e,r,o,i=[1,1],s){let a=n,l=!1;n.rank===3&&(l=!0,a=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={dy:a,filter:e},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:t},d=k.runKernel(Wf,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Mw=A({depthwiseConv2dNativeBackpropInput_:wde});function Cde({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(Hd(k.state.gradientDepth,l)===!1){let E=al(t,n,e,r,o,i,s);return a!=null&&(E=re(E,a)),Wd(E,l,c,u)}let d=N(t,"x","depthwiseConv2d"),p=N(n,"filter","depthwiseConv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),F(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),F(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),F(f.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),F(Wn(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),s!=null&&F(bt(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${s} but got pad ${r}.`);let h=Ad(f.shape,p.shape,e,i,r,s,!0),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Ze(g,d),We(h.outShape,g.shape));let x;c!=null&&(x=N(c,"prelu weights","fused depthwiseConv2d"));let b=(E,S)=>{F(Mo(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[D,M,R,L]=S,G=jd(E,R,l),W=Mw(M.shape,G,D,e,r,i,s),q=Rw(M,G,D.shape,e,r,i,s);if(L!=null){let X=Gd(g,G);return[W,q,X]}return[W,q]},I={x:f,filter:p,bias:g,preluActivationWeights:x},_={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?Oo((S,D,M)=>{let R=k.runKernel(Cd,I,_);return M([D,S,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:b}})(f,p):Oo((S,D,M,R)=>{let L=k.runKernel(Cd,I,_);return R([D,S,L,M]),m&&(L=B(L,[L.shape[1],L.shape[2],L.shape[3]])),{value:L,gradFunc:b}})(f,p,g)}var sB=A({fusedDepthwiseConv2d_:Cde});function _de({a:t,b:n,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a}){if(Hd(k.state.gradientDepth,i)===!1){let L=wt(t,n,e,r);return o!=null&&(L=re(L,o)),Wd(L,i,s,a)}let l=N(t,"a","fused matMul"),c=N(n,"b","fused matMul");[l,c]=Ze(l,c);let u=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=e?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],m=l.shape.slice(0,-2),h=c.shape.slice(0,-2),g=Lt(m),x=Lt(h);F(l.rank>=2&&c.rank>=2&&l.rank===c.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${l.rank} and ${c.rank}.`),F(hs(m,h),()=>`Error in fused matMul: outer dimensions (${m}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} must match.`),F(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let b=l.shape.slice(0,-2).concat([p,f]),I=e?B(l,[g,u,p]):B(l,[g,p,u]),_=r?B(c,[x,f,d]):B(c,[x,d,f]),E;o!=null&&(E=N(o,"bias","fused matMul"),[E]=Ze(E,l),We(b,E.shape));let S;s!=null&&(S=N(s,"prelu weights","fused matMul"));let D=(L,G)=>{let[W,q,X,K]=G,Z=jd(B(L,X.shape),X,i),se,ee;if(!e&&!r?(se=wt(Z,q,!1,!0),ee=wt(W,Z,!0,!1)):!e&&r?(se=wt(Z,q,!1,!1),ee=wt(Z,W,!0,!1)):e&&!r?(se=wt(q,Z,!1,!0),ee=wt(W,Z,!1,!1)):(se=wt(q,Z,!0,!0),ee=wt(Z,W,!0,!0)),o!=null){let oe=Gd(K,Z);return[se,ee,oe]}else return[se,ee]},M={a:I,b:_,bias:E,preluActivationWeights:S},R={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?Oo((G,W,q)=>{let X=k.runKernel(bd,M,R);return q([G,W,X]),{value:B(X,b),gradFunc:D}})(I,_):Oo((G,W,q,X)=>{let K=k.runKernel(bd,M,R);return X([G,W,K,q]),{value:B(K,b),gradFunc:D}})(I,_,E)}var aB=A({fusedMatMul_:_de});function lB(t,n,e){let r=Ide(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function Ide(t,n,e){return Sde(t,n,e||Ede)}function Ede(t,n){return t>n?1:t<n?-1:0}function Sde(t,n,e){let r=0,o=t.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(n,t[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function uB(t,n,e,r,o){return PN(t,n,e,r,o,0)}function dB(t,n,e,r,o,i){return PN(t,n,e,r,o,0,!1,i,!0)}function pB(t,n,e,r,o,i){return PN(t,n,e,r,o,i,!0)}function PN(t,n,e,r,o,i,s=!1,a=!1,l=!1){let c=[];for(let g=0;g<n.length;g++)n[g]>o&&c.push({score:n[g],boxIndex:g,suppressBeginIndex:0});c.sort(cB);let u=i>0?-.5/i:0,d=[],p=[];for(;d.length<e&&c.length>0;){let g=c.pop(),{score:x,boxIndex:b,suppressBeginIndex:I}=g;if(x<o)break;let _=!1;for(let E=d.length-1;E>=I;--E){let S=Tde(t,b,d[E]);if(S>=r){_=!0;break}if(g.score=g.score*Dde(r,u,S),g.score<=o)break}g.suppressBeginIndex=d.length,_||(g.score===x?(d.push(b),p.push(g.score)):g.score>o&&lB(c,g,cB))}let f=d.length,m=e-f;a&&m>0&&(d.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));let h={selectedIndices:d};return s&&(h.selectedScores=p),l&&(h.validOutputs=f),h}function Tde(t,n,e){let r=t.subarray(n*4,n*4+4),o=t.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(a-i)*(l-s),m=(d-c)*(p-u);if(f<=0||m<=0)return 0;let h=Math.max(i,c),g=Math.max(s,u),x=Math.min(a,d),b=Math.min(l,p),I=Math.max(x-h,0)*Math.max(b-g,0);return I/(f+m-I)}function Dde(t,n,e){let r=Math.exp(n*e*e);return e<=t?r:0}function cB(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function Nde(t,n,e=!1,r=!1){let o=N(t,"images","resizeBilinear");F(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),F(n.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${n}.`),F(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(Pc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var fB=A({resizeBilinear_:Nde});function kde(t,n,e=!1,r=!1){let o=N(t,"images","resizeNearestNeighbor");F(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),F(n.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${n}.`),F(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),F(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(Oc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var mB=A({resizeNearestNeighbor_:kde});function Ade(t,n,e){F(n%1===0,()=>`bandPart(): numLower must be an integer, got ${n}.`),F(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`);let r=N(t,"a","bandPart");F(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2);if(!(n<=i))throw new Error(`bandPart(): numLower (${n}) must not be greater than the number of rows (${i}).`);if(!(e<=s))throw new Error(`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`);n<0&&(n=i),e<0&&(e=s);let a=B(TN(0,i,1,"int32"),[-1,1]),l=TN(0,s,1,"int32"),c=Se(a,l),u=br(Cs(c,Fe(+n,"int32")),Fo(c,Fe(-e,"int32"))),d=Gt([i,s],r.dtype);return B(rr(qr(B(r,[-1,i,s])).map(p=>dn(u,p,d))),o)}var hB=A({bandPart_:Ade});function Rde(t){let n;if(Array.isArray(t)){n=!1,F(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let i=1;i<t.length;++i)F(t[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${o})`)}else n=!0,t=Xn(t,t.shape[0],0).map(o=>Ud(o,[0]));F(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let e=[],r=t;for(let o=0;o<t.length;++o)e.push(k.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=V(Ce(V(e[s],i)),e[s]);i=Se(i,a)}return ye(i,Rm(i,"euclidean"))}));return n?rr(e,0):e}var gB=A({gramSchmidt_:Rde});function Mde(t,n=!1){if(F(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return yB(t,n);{let e=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),r=qr(B(t,[e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[c,u]=yB(l,n);o.push(c),i.push(u)});let s=B(rr(o,0),t.shape),a=B(rr(i,0),t.shape);return[s,a]}}function yB(t,n=!1){return k.tidy(()=>{F(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let e=t.shape[0],r=t.shape[1],o=Em(e),i=Bi(t),s=nu([[1]],[1,1]),a=Bi(s),l=e>=r?r:e;for(let c=0;c<l;++c){let u=i,d=a,p=o;[a,i,o]=k.tidy(()=>{let f=at(i,[c,c],[e-c,1]),m=Rm(f),h=at(i,[c,c],[1,1]),g=dn(qn(h,0),nu([[-1]]),nu([[1]])),x=Se(h,V(g,m)),b=ye(f,x);b.shape[0]===1?a=Bi(s):a=jt([s,at(b,[1,0],[b.shape[0]-1,b.shape[1]])],0);let I=Ct(ye(wt(g,x),m)),_=at(i,[c,0],[e-c,r]),E=V(I,a),S=st(a);if(c===0)i=Se(_,wt(E,wt(S,_)));else{let R=Se(_,wt(E,wt(S,_)));i=jt([at(i,[0,0],[c,r]),R],0)}let D=st(E),M=at(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=Se(M,wt(wt(M,a),D));else{let R=Se(M,wt(wt(M,a),D));o=jt([at(o,[0,0],[e,c]),R],1)}return[a,i,o]}),Pe([u,d,p])}return!n&&e>r&&(o=at(o,[0,0],[e,r]),i=at(i,[0,0],[r,r])),[o,i]})}var vB=A({qr_:Mde});var xB={bandPart:hB,gramSchmidt:gB,qr:vB};var or=class extends uy{minimize(n,e=!1,r){let{value:o,grads:i}=this.computeGradients(n,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return Pe(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(n,e){return fN(n,e)}dispose(){this.iterations_!=null&&Pe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Fe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(n){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(n){return this.iterations_=(await n[0].tensor.data())[0],n.slice(1)}};Object.defineProperty(or,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var LN=(()=>{class t extends or{constructor(e,r,o=null){super(),this.learningRate=e,this.rho=r,this.epsilon=o,this.accumulatedGrads=[],this.accumulatedUpdates=[],o==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accum_grad`,variable:j(()=>De(s).variable(a))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${o}/accum_var`,variable:j(()=>De(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedGrads[i].variable,u=this.accumulatedUpdates[i].variable;j(()=>{let d=re(V(c,this.rho),V(Ke(l),1-this.rho)),p=V(ye(Wt(re(u,this.epsilon)),Wt(re(c,this.epsilon))),l),f=re(V(u,this.rho),V(Ke(p),1-this.rho));c.assign(d),u.assign(f);let m=re(V(p,-this.learningRate),s);s.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Pe(this.accumulatedGrads.map(e=>e.variable)),Pe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,o=!1;this.accumulatedGrads=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedUpdates=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}}return t.className="Adadelta",t})();Hr(LN);var $N=(()=>{class t extends or{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accumulator`,variable:j(()=>gy(s.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[i].tensor:e[o];if(a==null)return;let l=this.accumulatedGrads[i].variable;j(()=>{let c=re(l,Ke(a));l.assign(c);let u=re(V(ye(a,Wt(re(c,k.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Pe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}}return t.className="Adagrad",t})();Hr($N);var VN=(()=>{class t extends or{constructor(e,r,o,i=null){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],j(()=>{this.accBeta1=Fe(r).variable(),this.accBeta2=Fe(o).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);j(()=>{let o=Se(1,this.accBeta1),i=Se(1,this.accBeta2);r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:j(()=>De(l).variable(c))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${s}/v`,variable:j(()=>De(l).variable(c))});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,f=re(V(d,this.beta1),V(u,1-this.beta1)),m=re(V(p,this.beta2),V(Ke(u),1-this.beta2)),h=ye(f,o),g=ye(m,i);d.assign(f),p.assign(m);let x=re(V(ye(h,re(Wt(g),this.epsilon)),-this.learningRate),l);l.assign(x)}),this.accBeta1.assign(V(this.accBeta1,this.beta1)),this.accBeta2.assign(V(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Pe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Pe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),j(()=>{this.accBeta1.assign(ii(this.beta1,this.iterations_+1)),this.accBeta2.assign(ii(this.beta2,this.iterations_+1))});let r=e.length/2,o=!1;this.accumulatedFirstMoment=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}}return t.className="Adam",t})();Hr(VN);var BN=(()=>{class t extends or{constructor(e,r,o,i=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],j(()=>{this.iteration=Fe(0).variable(),this.accBeta1=Fe(r).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);j(()=>{let o=Se(1,this.accBeta1),i=ye(-this.learningRate,re(V(this.iteration,this.decay),1));r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:De(l).variable(c)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${s}/v`,variable:De(l).variable(c)});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,f=re(V(d,this.beta1),V(u,1-this.beta1)),m=V(p,this.beta2),h=Sn(u),g=go(m,h);d.assign(f),p.assign(g);let x=re(V(ye(i,o),ye(f,re(g,this.epsilon))),l);l.assign(x)}),this.iteration.assign(re(this.iteration,1)),this.accBeta1.assign(V(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Pe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Pe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}}return t.className="Adamax",t})();Hr(BN);var Ny=(()=>{class t extends or{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=Array.isArray(e)?e[i].tensor:e[o];if(s==null)return;let a=k.registeredVariables[o];j(()=>{let l=re(V(this.c,s),a);a.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=$n(Fe(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}}return t.className="SGD",t})();Hr(Ny);var zN=(()=>{class t extends Ny{constructor(e,r,o=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=o,this.accumulations=[],this.m=Fe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${o}/momentum`,variable:j(()=>De(s).variable(!1))});let a=this.accumulations[i].variable,l=Array.isArray(e)?e[i].tensor:e[o];l!=null&&j(()=>{let c,u=re(V(this.m,a),l);this.useNesterov?c=re(V(this.c,re(l,V(u,this.m))),s):c=re(V(this.c,u),s),a.assign(u),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Pe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}}return t.className="Momentum",t})();Hr(zN);var UN=(()=>{class t extends or{constructor(e,r=.9,o=0,i=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=o,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=k.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${o}/rms`,variable:j(()=>De(s).variable(a))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${o}/momentum`,variable:j(()=>De(s).variable(a))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${o}/mg`,variable:j(()=>De(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedMeanSquares[i].variable,u=this.accumulatedMoments[i].variable;j(()=>{let d=re(V(c,this.decay),V(Ke(l),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[i].variable,f=re(V(p,this.decay),V(l,1-this.decay)),m=ye(V(l,this.learningRate),Wt(Se(d,re(Ke(f),this.epsilon)))),h=re(V(u,this.momentum),m);c.assign(d),p.assign(f),u.assign(h);let g=Se(s,h);s.assign(g)}else{let p=re(V(c,this.decay),V(Ke(l),1-this.decay)),f=re(V(u,this.momentum),ye(V(l,this.learningRate),Wt(re(p,this.epsilon))));c.assign(p),u.assign(f);let m=Se(s,f);s.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Pe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Pe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Pe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,o=!1;this.accumulatedMeanSquares=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedMoments=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}}return t.className="RMSProp",t})();Hr(UN);var Es=class{static sgd(n){return new Ny(n)}static momentum(n,e,r=!1){return new zN(n,e,r)}static rmsprop(n,e=.9,r=0,o=null,i=!1){return new UN(n,e,r,o,i)}static adam(n=.001,e=.9,r=.999,o=null){return new VN(n,e,r,o)}static adadelta(n=.001,e=.95,r=null){return new LN(n,e,r)}static adamax(n=.002,e=.9,r=.999,o=null,i=0){return new BN(n,e,r,o,i)}static adagrad(n,e=.1){return new $N(n,e)}};var Kd={sgd:Es.sgd,momentum:Es.momentum,adadelta:Es.adadelta,adagrad:Es.adagrad,rmsprop:Es.rmsprop,adamax:Es.adamax,adam:Es.adam};var Fde=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function ky(){return new Promise(t=>Fde(()=>t()))}var T={};Qi(T,{ERF_A1:()=>Wde,ERF_A2:()=>Hde,ERF_A3:()=>qde,ERF_A4:()=>Kde,ERF_A5:()=>Xde,ERF_P:()=>Gde,PARALLELIZE_THRESHOLD:()=>Fw,SELU_SCALE:()=>GN,SELU_SCALEALPHA:()=>jN,applyActivation:()=>Wd,assertAndGetBroadcastShape:()=>We,assertAxesAreInnerMostDims:()=>tue,assertParamsConsistent:()=>Ode,assignToTypedArray:()=>rpe,axesAreInnerMostDims:()=>hN,calculateShapes:()=>hle,checkEinsumDimSizes:()=>cpe,combineLocations:()=>kV,complexWithEvenIndex:()=>epe,complexWithOddIndex:()=>tpe,computeConv2DInfo:()=>Ad,computeConv3DInfo:()=>CV,computeDefaultPad:()=>XD,computeDilation2DInfo:()=>Lle,computeOptimalWindowSize:()=>Lde,computeOutAndReduceShapes:()=>gN,computeOutShape:()=>Pde,computePool2DInfo:()=>KD,computePool3DInfo:()=>$le,convertConv2DDataFormat:()=>_V,decodeEinsumEquation:()=>ape,eitherStridesOrDilationsAreOne:()=>Wn,expandShapeToKeepDim:()=>Is,exponent:()=>ipe,exponents:()=>ope,fromStringArrayToUint8:()=>vpe,fromUint8ToStringArray:()=>ype,getAxesPermutation:()=>yN,getBroadcastDims:()=>wce,getComplexWithIndex:()=>npe,getEinsumComputePath:()=>upe,getEinsumPermutation:()=>lpe,getFusedBiasGradient:()=>Gd,getFusedDyActivation:()=>jd,getImageCenter:()=>$de,getInnerMostAxes:()=>nue,getPermuted:()=>Bde,getReductionAxes:()=>$t,getReshaped:()=>Vde,getReshapedPermuted:()=>zde,getSliceBeginCoords:()=>Ude,getSliceSize:()=>jde,getUndoAxesPermutation:()=>vy,isIdentityPermutation:()=>dpe,log:()=>Zde,mergeRealAndImagArrays:()=>Qde,prepareAndValidate:()=>fle,prepareSplitSize:()=>fpe,segment_util:()=>HN,shouldFuse:()=>Hd,slice_util:()=>tr,splitRealAndImagArrays:()=>Jde,tupleValuesAreOne:()=>Mo,upcastType:()=>Dn,validateInput:()=>mle,validateUpdateShape:()=>lV,warn:()=>Yde});function Ode(t,n){let e=t[0].length;t.forEach((o,i)=>{F(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),F(n>=0&&n<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=t[0];t.forEach((o,i)=>{for(let s=0;s<e;s++)F(s===n||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function Pde(t,n){let e=t[0].slice();for(let r=1;r<t.length;r++)e[n]+=t[r][n];return e}var Fw=30;function Lde(t){return t<=Fw?t:Rf(t,Math.floor(Math.sqrt(t)))}function $de(t,n,e){let r=e*(typeof t=="number"?t:t[0]),o=n*(typeof t=="number"?t:t[1]);return[r,o]}function Vde(t,n,e,r=!0){let o=[];if(r)o=o.concat(n.slice(0)),o.push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let i=n.length;for(let s=0;s<i;++s)o=o.concat([t[s+1]/n[s],n[s]]);o=o.concat(t.slice(i+1))}return o}function Bde(t,n,e=!0){let r=[];if(e){r.push(n);for(let o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<t;++s)s>=n*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function zde(t,n,e,r=!0){let o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(let i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function Ude(t,n){let e=[0];for(let r=0;r<n;++r)e.push(t[r][0]);return e}function jde(t,n,e){let r=t.slice(0,1);for(let o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}var jN=1.7580993408473768,GN=1.0507009873554805;var Gde=.3275911,Wde=.254829592,Hde=-.284496736,qde=1.421413741,Kde=-1.453152027,Xde=1.061405429;function Yde(...t){H().getBool("IS_TEST")||console.warn(...t)}function Zde(...t){H().getBool("IS_TEST")||console.log(...t)}function Qde(t,n){if(t.length!==n.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${n.length}.`);let e=new Float32Array(t.length*2);for(let r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function Jde(t){let n=new Float32Array(t.length/2),e=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=t[r],e[r/2]=t[r+1];return{real:n,imag:e}}function epe(t){let n=Math.ceil(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=0;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function tpe(t){let n=Math.floor(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=2;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function npe(t,n){let e=t[n*2],r=t[n*2+1];return{real:e,imag:r}}function rpe(t,n,e,r){t[r*2]=n,t[r*2+1]=e}function ope(t,n){let e=new Float32Array(t/2),r=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let i=(n?2:-2)*Math.PI*(o/t);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function ipe(t,n,e){let r=(e?2:-2)*Math.PI*(t/n),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var WN="->",spe=/->/g,bB=",",wB="...";function ape(t,n){t=t.replace(/\s/g,"");let e=(t.length-t.replace(spe,"").length)/WN.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${WN}").`);let[r,o]=t.split(WN);F(r.indexOf(wB)===-1,()=>`The ellipsis notation ("${wB}") is not supported yet.`);let i=r.split(bB),s=i.length;if(n!==s)throw new Error(`Expected ${s} input tensors, received ${n}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let p=0;p<o.length;++p){let f=o[p];if(!i.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<r.length;++p){let f=r[p];a.indexOf(f)===-1&&f!==bB&&a.push(f)}let l=new Array(i.length);for(let p=0;p<s;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let f=0;f<i[p].length;++f)l[p].push(a.indexOf(i[p][f]))}let c=a.length,u=o.length,d=[];for(let p=u;p<c;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function lpe(t,n){let e=new Array(t);e.fill(-1);for(let o=0;o<n.length;++o)e[n[o]]=o;let r=[];for(let o=0;o<t;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function cpe(t,n,e){let r=new Array(t);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<n[o].length;++s)r[n[o][s]]===void 0?r[n[o][s]]=i[s]:F(r[n[o][s]]===i[s],()=>`Expected dimension ${r[n[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function upe(t,n){let e=t,r=[],o=0;t.length===0&&e.push(-1),o=t.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=ppe(n,a);for(let c of l)i.indexOf(c)===-1&&(r[s].push(c),i.push(c))}return{path:e,steps:r}}function dpe(t){return t.every((n,e)=>n===e)}function ppe(t,n){let e=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(n)!==-1||n===-1)&&e.push(r);return e}function fpe(t,n,e=0){let r=[];if(typeof n=="number")F(t.shape[e]%n===0,()=>"Number of splits must evenly divide the axis."),r=new Array(n).fill(t.shape[e]/n);else{let o=n.reduce((s,a)=>(a===-1&&(s+=1),s),0);F(o<=1,()=>"There should be only one negative value in split array.");let i=n.indexOf(-1);if(i!==-1){let s=n.reduce((a,l)=>l>0?a+l:a);n[i]=t.shape[e]-s}F(t.shape[e]===n.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=n}return r}var HN={};Qi(HN,{collectGatherOpShapeInfo:()=>gpe,computeOutShape:()=>hpe,segOpComputeOptimalWindowSize:()=>mpe});function mpe(t,n){let e=!1,r;for(t<=Fw?(r=t,e=!0):r=Rf(t,Math.floor(Math.sqrt(t)));!e;)r>n||r===t?e=!0:r=Rf(t,r+1);return r}function hpe(t,n,e){let r=[],o=t.length;for(let i=0;i<o;i++)i!==n?r.push(t[i]):r.push(e);return r}function gpe(t,n,e,r){let o=n.shape.length,i=t.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let d=0;d<r;++d)if(t.shape[d]!==n.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${n.shape[d]}.`);let s=t.shape[e],a=[],l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=r;d<e;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=r;d<o;d++)a.push(n.shape[d]);for(let d=e+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}function ype(t){try{return t.map(n=>dm(n))}catch(n){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${n}`)}}function vpe(t){return t.map(n=>um(n))}var ir={};Qi(ir,{nonMaxSuppressionV3Impl:()=>uB,nonMaxSuppressionV4Impl:()=>dB,nonMaxSuppressionV5Impl:()=>pB,whereImpl:()=>tB});var Ow={kernelName:nc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Ui(ue(e,"float32"),-1))}}};var CB={kernelName:da,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Ke(ue(e,"float32")),o=Wt(Se(Fe(1),r));return Ct(ye(t,o))}}}};var _B={kernelName:pa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Wt(Se(Ke(ue(e,"float32")),1));return ye(t,r)}}}};var IB={kernelName:Pi,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=t,l=$t(e.shape,o);return l.length>0&&(a=Ce(a,l)),B(a,e.shape)},b:()=>{let a=t,l=$t(r.shape,o);return l.length>0&&(a=Ce(a,l)),B(a,r.shape)}}}};var EB={kernelName:Ff,saveAllInputs:!0,gradFunc:(t,n)=>{let e={};return n.forEach((r,o)=>{e[o]=()=>t.clone()}),e}};var SB={kernelName:rc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>De(e)}}};var TB={kernelName:oc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>De(e)}}};var DB={kernelName:fa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Wt(Se(Fe(1),Ke(ue(e,"float32")))))}}};var NB={kernelName:ma,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Wt(re(Fe(1),Ke(ue(e,"float32"))));return ye(t,r)}}}};var kB={kernelName:ya,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=re(Ke(e),Ke(r)),l=V(t,ye(r,a)),c=$t(e.shape,o);return c.length>0&&(l=Ce(l,c)),B(l,e.shape)},b:()=>{let a=re(Ke(e),Ke(r)),l=Ct(V(t,ye(e,a))),c=$t(r.shape,o);return c.length>0&&(l=Ce(l,c)),B(l,r.shape)}}}};var AB={kernelName:ha,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,re(Ke(ue(e,"float32")),1))}}};var RB={kernelName:ga,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Se(Fe(1),Ke(ue(e,"float32"))))}}};function xpe(t,n,e,r,o,i){let s=N(t,"dy","avgPool3dGrad"),a=N(n,"input","avgPool3dGrad"),l=s,c=a,u=!1;a.rank===4&&(u=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),F(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),F(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),i!=null&&F(bt(o),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let d={dy:l,input:c},p={filterSize:e,strides:r,pad:o,dimRoundingMode:i},f=k.runKernel($f,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var MB=A({avgPool3dGrad_:xpe});var FB={kernelName:sc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>MB(t,r,o,i,s,a)}}};function bpe(t,n,e,r,o){let i=N(t,"dy","avgPoolGrad"),s=N(n,"input","avgPoolGrad");F(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,c=!1;s.rank===3&&(c=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),F(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),F(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:l,input:a},d={filterSize:e,strides:r,pad:o},p=k.runKernel(Lf,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var OB=A({avgPoolGrad_:bpe});var PB={kernelName:ic,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s}=e;return{x:()=>OB(t,r,o,i,s)}}};var LB={kernelName:ac,inputsToSave:["a","b"],gradFunc:(t,n,e)=>{let[r,o]=n,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>wt(t,o,!1,!0),b:()=>wt(r,t,!0,!1)}:!i&&s?{a:()=>wt(t,o,!1,!1),b:()=>wt(t,r,!0,!1)}:i&&!s?{a:()=>wt(o,t,!1,!0),b:()=>wt(r,t,!1,!1)}:{a:()=>wt(o,t,!0,!0),b:()=>wt(t,r,!0,!0)}}};var $B={kernelName:lc,gradFunc:(t,n,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>Dm(t,r,o)}}};var VB={kernelName:p3,gradFunc:(t,n,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>Ce(t,a,!0)}}};var BB={kernelName:ys,gradFunc:t=>({x:()=>t.clone()})};var zB={kernelName:va,gradFunc:t=>({x:()=>De(t)})};var UB={kernelName:xa,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>dn(br(Fo(r,o),Cs(r,i)),t,De(t))}}};var jB={kernelName:cc,inputsToSave:["x"],gradFunc:Ow.gradFunc};var GB={kernelName:uc,saveAllInputs:!0,gradFunc:(t,n,e)=>{let r=n.map(l=>l.shape),{axis:o}=e,i=En(o,n[0].shape)[0],s=r.map(l=>l[i]);return Xn(t,s,i).map(l=>()=>l)}};var WB={kernelName:dc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return F(Mo(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>Im(r.shape,t,o,s,a,l),filter:()=>Mm(r,t,o.shape,s,a,l)}}};var HB={kernelName:pc,inputsToSave:["dy","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>ho(t,o,i,s,a,1,l),filter:()=>Mm(t,r,o.shape,i,s,a,l)}}};function wpe(t,n,e,r,o){let i=t;t.rank===4&&(i=B(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let s=n;s.rank===4&&(s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]])),F(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),F(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),F(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),F(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),F(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return k.runKernel(zf,a,l)}var qB=A({conv3DBackpropFilter_:wpe});var KB={kernelName:fc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i}=e;F(Mo(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=n;return{x:()=>bw(s.shape,t,a,o,i),filter:()=>qB(s,t,a.shape,o,i)}}};var XB={kernelName:ba,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Ct(_y(ue(e,"float32"))),t)}}};var YB={kernelName:wa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Iy(ue(e,"float32")),t)}}};var ZB={kernelName:mc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=yN([o],r.rank),l=ww(t,o,i,!s);return a!=null&&(l=st(l,a)),l}}}};var QB={kernelName:hc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];F(Mo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,c]=n;return F(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),F(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),F(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),F(Wn(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),s!=null&&F(bt(i),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`),{x:()=>Mw(l.shape,t,c,o,i,r,s),filter:()=>Rw(l,t,c.shape,o,i,r,s)}}};var JB={kernelName:gc,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,i={x:r,filter:o,dy:t},s={x:r,filter:o,dy:t};return{x:()=>k.runKernel(ry,i,e),filter:()=>k.runKernel(oy,s,e)}}};var ez={kernelName:_a,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n,r={dy:t,y:e};return{x:()=>k.runKernel(Hf,r)}}};var tz={kernelName:Ia,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(Dr(Ct(Ke(e))),2/Math.sqrt(Math.PI));return{x:()=>V(t,r)}}};var nz={kernelName:Ea,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,e)}}};var rz={kernelName:yc,inputsToSave:["input"],gradFunc:(t,n)=>{let[e]=n;return{input:()=>B(t,e.shape)}}};var oz={kernelName:Sa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Dr(e))}}};var iz={kernelName:Ta,gradFunc:t=>({x:()=>De(t)})};var sz={kernelName:Da,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=ye(t,ue(r,"float32")),l=$t(e.shape,o);return l.length>0?B(Ce(a,l),e.shape):a},b:()=>{let a=V(t,ue(e,"float32")),l=$t(r.shape,o);l.length>0&&(a=B(Ce(a,l),r.shape));let c=Ke(r);return Ct(ye(a,ue(c,"float32")))}}}};var az={kernelName:vc,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,n,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=n,l=a??Fe(1),c=$t(i.shape,o.shape),u=[];if(i.rank===1){for(let _=0;_<o.shape.length-1;++_)u.push(o.shape[_]);u.push(1)}let d=Se(o,i),p=V(t,l),f=by(re(s,Fe(r))),m=V(V(V(f,f),f),Fe(-.5));return{x:()=>i.rank===1?B(V(V(t,zi(B(f,[1,1,1,i.shape[0]]),u)),l),o.shape):B(V(V(t,f),l),o.shape),mean:()=>{let _=V(V(f,Fe(-1)),p);return i.rank===1&&(_=Ce(_,c)),B(_,i.shape)},variance:()=>{let _=V(V(m,d),p);return i.rank===1&&(_=Ce(_,c)),B(_,i.shape)},scale:()=>{let _=V(d,f),E=V(t,_);return i.rank===1&&(E=Ce(E,c)),B(E,i.shape)},offset:()=>{let _=t;return i.rank===1&&(_=Ce(_,c)),B(_,i.shape)}}}};var uz={kernelName:xc,inputsToSave:["x","indices"],gradFunc:(t,n,e)=>{let[r,o]=n,{axis:i}=e,s=En(i,r.shape)[0];return{x:()=>{let l=r.shape,c=o.size,u=l.slice(0,s),d=u.length,p=l.slice(i,l.length).slice(1),f=p.length,m=lz(0,d),h=lz(d+1,d+1+f),g=cz([u,[c],p]),x=B(t,g),b=B(o,[c]),I=cz([[d],m,h]),_=st(x,I),E=Aw(_,b,r.shape[s]),S=vy(I);return E=st(E,S),E},indices:()=>o}}};function lz(t,n){let e=[];for(let r=t;r<n;++r)e.push(r);return e}function cz(t){let n=[];for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var dz={kernelName:Na,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>De(e),b:()=>De(r)}}};var pz={kernelName:vs,gradFunc:t=>({x:()=>ue(t,"float32")})};var fz={kernelName:ka,gradFunc:t=>({x:()=>De(t)})};var mz={kernelName:Aa,gradFunc:t=>({x:()=>De(t)})};var hz={kernelName:Ra,gradFunc:t=>({x:()=>De(t)})};var gz={kernelName:bc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{alpha:o}=e,i=qn(r,0);return{x:()=>dn(i,t,V(t,o))}}};var yz={kernelName:Fa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,re(e,1))}}};var vz={kernelName:Ma,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,ue(e,"float32"))}}};var xz={kernelName:f3,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e;return{logits:()=>{let s=Dr(r);return Se(t,V(Ce(t,o,!0),s))}}}};function Cpe(t,n,e,r=5,o=1,i=1,s=.5){let a={x:t,y:n,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return k.runKernel(Zf,a,l)}var bz=A({localResponseNormalizationBackprop_:Cpe});var wz={kernelName:wc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>bz(r,o,t,i,s,a,l)}}};function Pw(t,n,e,r){return n.rank<e.rank&&(n=B(n,Is(n.shape,r))),t.rank<e.rank&&(t=B(t,Is(t.shape,r))),{x:()=>V(t,ue(oi(e,n),t.dtype))}}var qN={kernelName:Cc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{reductionIndices:o}=r,i=n[0],s=n[1],a=En(o,i.shape),l=Pw(t,s,i,a);return{x:()=>l.x()}}};var Cz={kernelName:Oa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,ue(Fo(e,r),"float32")),b:()=>V(t,ue(_w(e,r),"float32"))}}};function _pe(t,n,e,r,o,i,s){let a=N(t,"dy","maxPool3dGrad"),l=N(n,"input","maxPool3dGrad"),c=N(e,"output","maxPool3dGrad"),u=a,d=l,p=c,f=!1;l.rank===4&&(f=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=B(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=B(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),F(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),F(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),F(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),s!=null&&F(bt(i),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let m={dy:u,input:d,output:p},h={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=k.runKernel(Jf,m,h);return f?B(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var _z=A({maxPool3dGrad_:_pe});var Iz={kernelName:Ic,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>_z(t,r,o,i,s,a,l)}}};function Ipe(t,n,e,r,o,i,s){let a=N(t,"dy","maxPoolGrad"),l=N(n,"input","maxPoolGrad"),c=N(e,"output","maxPoolGrad");F(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),F(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),F(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),s!=null&&F(bt(i),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return k.runKernel(Qf,u,d)}var Ez=A({maxPoolGrad_:Ipe});var Sz={kernelName:_c,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a}=e;return{x:()=>Ez(t,r,o,i,s,a)}}};var Tz={kernelName:Ec,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=En(o,r.shape),a=gN(r.shape,i)[1],l=Lt(a);return{x:()=>{let u=r.shape.slice();i.forEach(f=>{u[f]=1});let d=B(t,u);return ye(V(d,yo(r.shape,"float32")),l)}}}};var Dz={kernelName:Sc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{axis:o}=r,[i,s]=n,a=En(o,i.shape),l=Pw(t,s,i,a);return{x:()=>l.x()}}};var Nz={kernelName:Pa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,ue(Cs(e,r),"float32")),b:()=>V(t,ue(qn(e,r),"float32"))}}};var kz={kernelName:Tc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>at(t,i,r.shape)}}};var Az={kernelName:La,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=$t(e.shape,o);return a.length>0?B(Ce(t,a),e.shape):t},b:()=>{let a=V(t,Ct(cl(ye(e,r)))),l=$t(r.shape,o);return l.length>0?B(Ce(a,l),r.shape):a}}}};var Rz={kernelName:$a,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=V(t,ue(r,"float32")),l=$t(e.shape,o);return l.length>0?B(Ce(a,l),e.shape):a},b:()=>{let a=V(t,ue(e,"float32")),l=$t(r.shape,o);return l.length>0?B(Ce(a,l),r.shape):a}}}};var Mz={kernelName:Dc,gradFunc:t=>({x:()=>Ct(t)})};var Fz={kernelName:kc,inputsToSave:["indices"],gradFunc:(t,n)=>{let e=n[0];return{indices:()=>Gt(e.shape,"float32")}}};var Oz={kernelName:Nc,gradFunc:t=>({x:()=>De(t)})};var Pz={kernelName:Ac,saveAllInputs:!0,gradFunc:(t,n,e)=>{let{axis:r}=e;return qr(t,r).map(i=>()=>i)}};var KN={kernelName:Rc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>at(t,i,r.shape)}}};var Lz={kernelName:Va,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,n)=>{let[e,r,o]=n,i=e,s=r,a=We(i.shape,s.shape);return{a:()=>{let u=ue(s,"float32"),d=V(t,V(u,ii(i,Se(u,Fe(1))))),p=$t(i.shape,a);return p.length>0&&(d=Ce(d,p)),B(d,i.shape)},b:()=>{let u=qn(i,0),d=dn(u,Nr(i),De(i)),p=V(t,V(o,d)),f=$t(s.shape,a);return f.length>0&&(p=Ce(p,f)),B(p,s.shape)}}}};var $z={kernelName:Mc,inputsToSave:["x","alpha"],gradFunc:(t,n)=>{let[e,r]=n,o=qn(e,0);return{x:()=>dn(o,t,V(t,r)),alpha:()=>{let i=dn(o,De(t),V(t,e)),s=$t(r.shape,t.shape);return s.length>0&&(i=Ce(i,s)),B(i,r.shape)}}}};var Vz={kernelName:Ca,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=ye(t,ue(r,"float32")),l=$t(e.shape,o);return l.length>0?B(Ce(a,l),e.shape):a},b:()=>{let a=V(t,ue(e,"float32")),l=$t(r.shape,o);l.length>0&&(a=B(Ce(a,l),r.shape));let c=Ke(r);return Ct(ye(a,ue(c,"float32")))}}}};var Bz={kernelName:Ba,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Ct(Ke(e)))}}};var zz={kernelName:Ua,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(Cs(e,6),Ui(e));return{x:()=>V(t,ue(r,"float32"))}}};var Uz={kernelName:za,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,ue(Ui(e),"float32"))}}};var jz={kernelName:Fc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>B(t,e.shape)}}};var Gz={kernelName:Pc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(om,o,e)}}};var Wz={kernelName:Oc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(rm,o,e)}}};var Hz={kernelName:Lc,gradFunc:(t,n,e)=>{let{dims:r}=e,o=En(r,t.shape);return{x:()=>Po(t,o)}}};var qz={kernelName:ja,gradFunc:t=>({x:()=>De(t)})};var Kz={kernelName:Ga,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Ct(ye(t,V(ii(e,1.5),2)))}}};var Xz={kernelName:$c,inputsToSave:["condition"],gradFunc:(t,n)=>{let[e]=n;return{condition:()=>ue(De(e),"float32"),t:()=>V(t,ue(e,t.dtype)),e:()=>V(t,ue(Sm(e),t.dtype))}}};var Yz={kernelName:Wa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=qn(e,Fe(0)),o=Fe(jN),i=Fe(GN),s=V(t,i),a=V(V(t,o),Dr(ue(e,"float32")));return dn(r,s,a)}}}};var Zz={kernelName:Xa,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(e,Se(Fe(1),e)))}}};var Qz={kernelName:Ka,gradFunc:t=>({x:()=>De(t)})};var Jz={kernelName:Ha,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Md(ue(e,"float32")),t)}}};var e4={kernelName:qa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(hy(ue(e,"float32")),t)}}};var t4={kernelName:Vc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{begin:o,size:i}=e,s=r.shape,[a,l]=BD(r,o,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>$d(t,c)}}};var n4={kernelName:jc,outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{dim:o}=e,i=!0,s=V(t,r);return{logits:()=>Se(s,V(Ce(s,[o],i),r))}}};var r4={kernelName:Ya,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,ri(e))}}};var XN={kernelName:zc,gradFunc:(t,n,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>Cm(t,r,o)}}};var YN={kernelName:Uc,gradFunc:(t,n,e)=>{let{axis:r}=e;return{x:()=>jt(t,r)}}};var o4={kernelName:Za,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,V(Wt(ue(e,"float32")),2))}}};var i4={kernelName:im,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(ue(e,"float32"),2))}}};var s4={kernelName:Qa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Fe(2);return{a:()=>V(t,V(o,Se(e,r))),b:()=>V(t,V(o,Se(r,e)))}}};var a4={kernelName:nl,gradFunc:t=>({x:()=>De(t)})};var l4={kernelName:Ja,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=We(e.shape,r.shape);return{a:()=>{let a=t,l=$t(e.shape,o);return l.length>0&&(a=Ce(a,l)),B(a,e.shape)},b:()=>{let a=t,l=$t(r.shape,o);return l.length>0&&(a=Ce(a,l)),B(Ct(a),r.shape)}}}};var c4={kernelName:Bc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,o=r.shape.slice(),{axis:i}=e;En(i,r.shape).forEach(c=>{o[c]=1});let a=B(t,o),l=V(a,yo(r.shape,"float32"));return{x:()=>l}}};var u4={kernelName:el,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>ye(t,Ke(Md(e)))}}};var d4={kernelName:tl,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(Se(Fe(1),Ke(e)),t)}}};var p4={kernelName:xs,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{reps:o}=e;return{x:()=>{let s=De(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=re(s,at(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=re(s,at(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)s=re(s,at(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)s=re(s,at(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var f4={kernelName:Gc,gradFunc:(t,n,e)=>{let r=e,{perm:o}=r,i=vy(o);return{x:()=>st(t,i)}}};var m4={kernelName:Wc,gradFunc:(t,n,e)=>{let r=e,{axis:o}=r;return{value:()=>rr(t,o)}}};var h4={kernelName:Hc,inputsToSave:["segmentIds"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Epe(t,e)}}};function Epe(t,n){let e=go(n,De(n)),r=Fd(t,e),o=Fo(n,Fe(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=nr(o,a+1);o=br(o,yo(r.shape,"bool"));let s=De(r);return dn(o,r,s)}var g4={kernelName:qc,gradFunc:t=>({x:()=>De(t)})};var Spe=[Ow,CB,_B,IB,EB,SB,TB,DB,NB,kB,AB,RB,FB,PB,LB,$B,VB,BB,zB,UB,jB,GB,HB,WB,KB,XB,YB,ZB,QB,JB,Vz,ez,tz,nz,rz,oz,sz,iz,az,uz,dz,pz,fz,mz,hz,gz,yz,vz,xz,wz,qN,qN,Cz,Iz,Sz,Tz,Dz,Nz,kz,Az,Rz,Mz,Fz,Oz,Pz,KN,KN,Lz,$z,Bz,zz,Uz,jz,Gz,Wz,Hz,qz,Kz,Xz,Yz,Zz,Qz,Jz,e4,t4,n4,r4,XN,XN,YN,YN,o4,s4,i4,a4,l4,c4,u4,d4,p4,f4,m4,h4,g4];for(let t of Spe)h3(t);P().prototype.abs=function(){return this.throwIfDisposed(),Sn(this)};P().prototype.acos=function(){return this.throwIfDisposed(),zD(this)};P().prototype.acosh=function(){return this.throwIfDisposed(),UD(this)};P().prototype.add=function(t){return this.throwIfDisposed(),re(this,t)};P().prototype.all=function(t,n){return this.throwIfDisposed(),py(this,t,n)};P().prototype.any=function(t,n){return this.throwIfDisposed(),vm(this,t,n)};P().prototype.argMax=function(t){return this.throwIfDisposed(),xm(this,t)};P().prototype.argMin=function(t){return this.throwIfDisposed(),bV(this,t)};P().prototype.asScalar=function(){return this.throwIfDisposed(),F(this.size===1,()=>"The array must have only 1 element."),B(this,[])};P().prototype.asType=function(t){return this.throwIfDisposed(),ue(this,t)};P().prototype.as1D=function(){return this.throwIfDisposed(),B(this,[this.size])};P().prototype.as2D=function(t,n){return this.throwIfDisposed(),B(this,[t,n])};P().prototype.as3D=function(t,n,e){return this.throwIfDisposed(),B(this,[t,n,e])};P().prototype.as4D=function(t,n,e,r){return this.throwIfDisposed(),B(this,[t,n,e,r])};P().prototype.as5D=function(t,n,e,r,o){return this.throwIfDisposed(),B(this,[t,n,e,r,o])};P().prototype.asin=function(){return this.throwIfDisposed(),jD(this)};P().prototype.asinh=function(){return this.throwIfDisposed(),GD(this)};P().prototype.atan=function(){return this.throwIfDisposed(),WD(this)};P().prototype.atan2=function(t){return this.throwIfDisposed(),wV(this,t)};P().prototype.atanh=function(){return this.throwIfDisposed(),HD(this)};P().prototype.avgPool=function(t,n,e,r){return this.throwIfDisposed(),Rd(this,t,n,e,r)};P().prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),Cm(this,t,n)};P().prototype.batchNorm=function(t,n,e,r,o){return this.throwIfDisposed(),Qc(this,t,n,e,r,o)};P().prototype.broadcastTo=function(t){return this.throwIfDisposed(),_m(this,t)};P().prototype.cast=function(t){return this.throwIfDisposed(),ue(this,t)};P().prototype.ceil=function(){return this.throwIfDisposed(),eN(this)};P().prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Hn(this,t,n)};P().prototype.concat=function(t,n){return this.throwIfDisposed(),t instanceof ft&&(t=[t]),jt([this,...t],n)};P().prototype.conv1d=function(t,n,e,r,o,i){return this.throwIfDisposed(),fy(this,t,n,e,r,o,i)};P().prototype.conv2dTranspose=function(t,n,e,r,o){return this.throwIfDisposed(),my(this,t,n,e,r,o)};P().prototype.conv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),ho(this,t,n,e,r,o,i)};P().prototype.cos=function(){return this.throwIfDisposed(),Md(this)};P().prototype.cosh=function(){return this.throwIfDisposed(),hy(this)};P().prototype.cumsum=function(t,n,e){return this.throwIfDisposed(),ww(this,t,n,e)};P().prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),EV(this,t,n)};P().prototype.depthwiseConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),al(this,t,n,e,r,o,i)};P().prototype.dilation2d=function(t,n,e,r,o){return this.throwIfDisposed(),SV(this,t,n,e,r,o)};P().prototype.divNoNan=function(t){return this.throwIfDisposed(),TV(this,t)};P().prototype.div=function(t){return this.throwIfDisposed(),ye(this,t)};P().prototype.dot=function(t){return this.throwIfDisposed(),DV(this,t)};P().prototype.elu=function(){return this.throwIfDisposed(),ll(this)};P().prototype.equal=function(t){return this.throwIfDisposed(),oi(this,t)};P().prototype.erf=function(){return this.throwIfDisposed(),aN(this)};P().prototype.exp=function(){return this.throwIfDisposed(),Dr(this)};P().prototype.expandDims=function(t){return this.throwIfDisposed(),nr(this,t)};P().prototype.expm1=function(){return this.throwIfDisposed(),lN(this)};P().prototype.fft=function(){return this.throwIfDisposed(),Ty(this)};P().prototype.flatten=function(){return this.throwIfDisposed(),B(this,[this.size])};P().prototype.floor=function(){return this.throwIfDisposed(),cl(this)};P().prototype.floorDiv=function(t){return this.throwIfDisposed(),vw(this,t)};P().prototype.gather=function(t,n){return this.throwIfDisposed(),Fd(this,t,n)};P().prototype.greaterEqual=function(t){return this.throwIfDisposed(),Fo(this,t)};P().prototype.greater=function(t){return this.throwIfDisposed(),qn(this,t)};P().prototype.ifft=function(){return this.throwIfDisposed(),Am(this)};P().prototype.irfft=function(){return this.throwIfDisposed(),AN(this)};P().prototype.isFinite=function(){return this.throwIfDisposed(),cN(this)};P().prototype.isInf=function(){return this.throwIfDisposed(),uN(this)};P().prototype.isNaN=function(){return this.throwIfDisposed(),dN(this)};P().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Od(this,t)};P().prototype.lessEqual=function(t){return this.throwIfDisposed(),Cs(this,t)};P().prototype.less=function(t){return this.throwIfDisposed(),_w(this,t)};P().prototype.localResponseNormalization=function(t,n,e,r){return this.throwIfDisposed(),NV(this,t,n,e,r)};P().prototype.logSigmoid=function(){return this.throwIfDisposed(),mN(this)};P().prototype.logSoftmax=function(t){return this.throwIfDisposed(),yy(this,t)};P().prototype.logSumExp=function(t,n){return this.throwIfDisposed(),AV(this,t,n)};P().prototype.log=function(){return this.throwIfDisposed(),Nr(this)};P().prototype.log1p=function(){return this.throwIfDisposed(),pN(this)};P().prototype.logicalAnd=function(t){return this.throwIfDisposed(),br(this,t)};P().prototype.logicalNot=function(){return this.throwIfDisposed(),Sm(this)};P().prototype.logicalOr=function(t){return this.throwIfDisposed(),Iw(this,t)};P().prototype.logicalXor=function(t){return this.throwIfDisposed(),RV(this,t)};P().prototype.matMul=function(t,n,e){return this.throwIfDisposed(),wt(this,t,n,e)};P().prototype.maxPool=function(t,n,e,r){return this.throwIfDisposed(),Pd(this,t,n,e,r)};P().prototype.max=function(t,n){return this.throwIfDisposed(),Kn(this,t,n)};P().prototype.maximum=function(t){return this.throwIfDisposed(),go(this,t)};P().prototype.mean=function(t,n){return this.throwIfDisposed(),qt(this,t,n)};P().prototype.min=function(t,n){return this.throwIfDisposed(),eu(this,t,n)};P().prototype.minimum=function(t){return this.throwIfDisposed(),Ld(this,t)};P().prototype.mirrorPad=function(t,n){return this.throwIfDisposed(),MV(this,t,n)};P().prototype.mod=function(t){return this.throwIfDisposed(),FV(this,t)};P().prototype.mul=function(t){return this.throwIfDisposed(),V(this,t)};P().prototype.neg=function(){return this.throwIfDisposed(),Ct(this)};P().prototype.norm=function(t,n,e){return this.throwIfDisposed(),Rm(this,t,n,e)};P().prototype.notEqual=function(t){return this.throwIfDisposed(),tu(this,t)};P().prototype.oneHot=function(t,n=1,e=0){return this.throwIfDisposed(),ym(this,t,n,e)};P().prototype.onesLike=function(){return this.throwIfDisposed(),Vn(this)};P().prototype.pad=function(t,n){return this.throwIfDisposed(),$d(this,t,n)};P().prototype.pool=function(t,n,e,r,o){return this.throwIfDisposed(),OV(this,t,n,e,r,o)};P().prototype.pow=function(t){return this.throwIfDisposed(),ii(this,t)};P().prototype.prelu=function(t){return this.throwIfDisposed(),Vd(this,t)};P().prototype.prod=function(t,n){return this.throwIfDisposed(),PV(this,t,n)};P().prototype.reciprocal=function(){return this.throwIfDisposed(),DN(this)};P().prototype.relu=function(){return this.throwIfDisposed(),si(this)};P().prototype.relu6=function(){return this.throwIfDisposed(),Nw(this)};P().prototype.reshapeAs=function(t){return this.throwIfDisposed(),B(this,t.shape)};P().prototype.reshape=function(t){return this.throwIfDisposed(),B(this,t)};P().prototype.resizeBilinear=function(t,n,e){return this.throwIfDisposed(),fB(this,t,n,e)};P().prototype.resizeNearestNeighbor=function(t,n,e){return this.throwIfDisposed(),mB(this,t,n,e)};P().prototype.reverse=function(t){return this.throwIfDisposed(),Po(this,t)};P().prototype.rfft=function(){return this.throwIfDisposed(),RN(this)};P().prototype.round=function(){return this.throwIfDisposed(),NN(this)};P().prototype.rsqrt=function(){return this.throwIfDisposed(),by(this)};P().prototype.selu=function(){return this.throwIfDisposed(),wy(this)};P().prototype.separableConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Cy(this,t,n,e,r,o,i)};P().prototype.sigmoid=function(){return this.throwIfDisposed(),ri(this)};P().prototype.sign=function(){return this.throwIfDisposed(),kN(this)};P().prototype.sin=function(){return this.throwIfDisposed(),_y(this)};P().prototype.sinh=function(){return this.throwIfDisposed(),Iy(this)};P().prototype.slice=function(t,n){return this.throwIfDisposed(),at(this,t,n)};P().prototype.softmax=function(t){return this.throwIfDisposed(),zd(this,t)};P().prototype.softplus=function(){return this.throwIfDisposed(),_s(this)};P().prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),Dm(this,t,n)};P().prototype.split=function(t,n){return this.throwIfDisposed(),Xn(this,t,n)};P().prototype.sqrt=function(){return this.throwIfDisposed(),Wt(this)};P().prototype.square=function(){return this.throwIfDisposed(),Ke(this)};P().prototype.squaredDifference=function(t){return this.throwIfDisposed(),QV(this,t)};P().prototype.squeeze=function(t){return this.throwIfDisposed(),Ud(this,t)};P().prototype.stack=function(t,n){this.throwIfDisposed();let e=t instanceof ft?[this,t]:[this,...t];return rr(e,n)};P().prototype.step=function(t){return this.throwIfDisposed(),Ui(this,t)};P().prototype.stridedSlice=function(t,n,e,r,o,i,s,a){return this.throwIfDisposed(),MN(this,t,n,e,r,o,i,s,a)};P().prototype.sub=function(t){return this.throwIfDisposed(),Se(this,t)};P().prototype.sum=function(t,n){return this.throwIfDisposed(),Ce(this,t,n)};P().prototype.tan=function(){return this.throwIfDisposed(),FN(this)};P().prototype.tanh=function(){return this.throwIfDisposed(),wm(this)};P().prototype.tile=function(t){return this.throwIfDisposed(),zi(this,t)};P().prototype.toBool=function(){return this.throwIfDisposed(),ue(this,"bool")};P().prototype.toFloat=function(){return this.throwIfDisposed(),ue(this,"float32")};P().prototype.toInt=function(){return this.throwIfDisposed(),ue(this,"int32")};P().prototype.topk=function(t,n){return this.throwIfDisposed(),JV(this,t,n)};P().prototype.transpose=function(t){return this.throwIfDisposed(),st(this,t)};P().prototype.unique=function(t){return this.throwIfDisposed(),eB(this,t)};P().prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Aw(this,t,n)};P().prototype.unstack=function(t){return this.throwIfDisposed(),qr(this,t)};P().prototype.where=function(t,n){return this.throwIfDisposed(),dn(t,this,n)};P().prototype.zerosLike=function(){return this.throwIfDisposed(),De(this)};var ZN;function Cn(){return ZN==null&&(ZN=xV().epsilon()),ZN}function kr(){return"channelsLast"}var Lo=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Ar=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},$=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Ae=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Lw=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}};function ci(t,n){if(Array.isArray(t)){let e=[];for(let r=0;r<n;r++)e=e.concat(t);return e}else{let e=new Array(n);return e.fill(t),e}}function $o(t,n){if(!t)throw new Lw(n)}function JN(t,n){let e=0;for(let r of t)r===n&&e++;return e}function Bn(t){return t.length===1?t[0]:t}function Rt(t){return Array.isArray(t)?t:[t]}function ui(t){let e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function dl(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(n,e)=>e.toUpperCase())}var li={};function Fm(t){if(t==null)return null;let n={};return n.className=t.getClassName(),n.config=t.getConfig(),n}function QN(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(n=>QN(n));else{let n=Object.keys(t);for(let e of n){let r=t[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[e]=r.value:QN(r))}}}function Ss(t,n={},e={},r="object",o=!1){if(typeof t=="string"){let i=t,s;if(i in e)s=e[i];else if(i in li)s=li[i];else if(s=n[i],s==null)throw new $(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=t;if(i.className==null||i.config==null)throw new $(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in li?[a,l]=li.className:s in n&&([a,l]=n[s]),a==null)throw new $(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let c={};for(let f of Object.keys(li))c[f]=li[f];for(let f of Object.keys(e))c[f]=e[f];let u=i.config;u.customObjects=c;let d=Object.assign({},li);for(let f of Object.keys(e))li[f]=e[f];QN(i.config);let p=l(a,i.config,e,o);return li=Object.assign({},d),p}else{let c=Object.assign({},li);for(let d of Object.keys(e))li[d]=e[d];let u=new a(i.config);return li=Object.assign({},c),u}}}function Tpe(t,n){return t<n?-1:t>n?1:0}function Ay(t,n){return-1*Tpe(t,n)}function di(t){if(t==null)return t;let n=[];for(let e of t)n.indexOf(e)===-1&&n.push(e);return n}function y4(t){if(t==null)throw new $(`Invalid value in obj: ${JSON.stringify(t)}`);for(let n in t)if(t.hasOwnProperty(n))return!1;return!0}function Ts(t,n,e){if(e!=null&&t.indexOf(e)<0)throw new $(`${e} is not a valid ${n}.  Valid values are ${t} or null/undefined.`)}function $w(t,n,e=0,r=1/0){return $o(e>=0),$o(r>=e),Array.isArray(t)&&t.length>=e&&t.length<=r&&t.every(o=>typeof o===n)}function pn(t,n){Array.isArray(t)?(w.assert(t.length>0,()=>`${n} is unexpectedly an empty array.`),t.forEach((e,r)=>pn(e,`element ${r+1} of ${n}`))):w.assert(Number.isInteger(t)&&t>0,()=>`Expected ${n} to be a positive integer, but got ${v4(t)}.`)}function v4(t){return t===null?"null":Array.isArray(t)?"["+t.map(n=>v4(n)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function x4(t,n){let e=w.now(),r;return(...i)=>{let s=w.now();return s-e<n||(e=s,r=t(...i)),r}}function Vw(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}function ek(t,n){return j(()=>Wt(Ce(V(t,t),n,!0)))}var Xd=class extends Q.Serializable{getConfig(){return{}}},C4=(()=>{class t extends Xd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>{let r=ek(e,this.axis),o=Hn(r,0,this.maxValue);return V(e,ye(o,re(Cn(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return t.className="MaxNorm",t})();Q.registerClass(C4);var _4=(()=>{class t extends Xd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>ye(e,re(Cn(),ek(e,this.axis))))}getConfig(){return{axis:this.axis}}}return t.className="UnitNorm",t})();Q.registerClass(_4);var I4=(()=>{class t extends Xd{apply(e){return si(e)}}return t.className="NonNeg",t})();Q.registerClass(I4);var E4=(()=>{class t extends Xd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return j(()=>{let r=ek(e,this.axis),o=re(V(this.rate,Hn(r,this.minValue,this.maxValue)),V(1-this.rate,r));return V(e,ye(o,re(Cn(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return t.className="MinMaxNorm",t})();Q.registerClass(E4);var b4={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function en(t){return Fm(t)}function w4(t,n={}){return Ss(t,Q.SerializationMap.getMap().classNameMap,n,"constraint")}function tn(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in b4?b4[t]:t,config:{}};return w4(e)}else return t instanceof Xd?t:w4(t)}var S4=["channelsFirst","channelsLast"],T4=["nearest","bilinear"],D4=["valid","same","causal"],N4=["max","avg"],k4=["sum","mul","concat","ave"];var Om=new Map;function Kt(t){Ts(S4,"DataFormat",t)}function R4(t){Ts(T4,"InterpolationFormat",t)}function Rr(t){Ts(D4,"PaddingMode",t)}function tk(t){Ts(N4,"PoolMode",t)}var Ry=[],A4="/";function Gi(t,n){Ry.push(t);try{let e=n();return Ry.pop(),e}catch(e){throw Ry.pop(),e}}function Npe(){return Ry.length===0?"":Ry.join(A4)+A4}function Bw(t){if(!M4(t))throw new Error("Not a valid tensor name: '"+t+"'");return Npe()+t}function zw(t){if(!M4(t))throw new Error("Not a valid tensor name: '"+t+"'");Om.has(t)||Om.set(t,0);let n=Om.get(t);if(Om.set(t,Om.get(t)+1),n>0){let e=`${t}_${n}`;return Om.set(e,1),e}else return t}var kpe=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function M4(t){return!!t.match(kpe)}function F4(t){return t===parseInt(t.toString(),10)}function pi(t,n,e){n==null&&(n=0),e==null&&(e=t.length);let r=1;for(let o=n;o<e;++o)r*=t[o];return r}function O4(t){return t=Array.isArray(t)?new Float32Array(t):t,ai(t)}function Yd(t){return eu(O4(t)).dataSync()[0]}function Wi(t){return Kn(O4(t)).dataSync()[0]}function wr(t,n){if(n<t)throw new $(`end (${n}) < begin (${t}) is forbidden.`);let e=[];for(let r=t;r<n;++r)e.push(r);return e}function fl(t,n){return t.asType(n)}function ml(t,n=-1){let e=t.shape.slice();return n<0&&(n=e.length+n+1),e.splice(n,0,1),t.reshape(e)}function P4(t,n){return j(()=>{if(t.shape.length!==2)throw new $(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let e=ml(t,1);return jw(e,[1,n,1])})}function L4(t){let n=[pi(t.shape)];return t.reshape(n)}function $4(t){if(t.rank<=1)throw new $(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let n=[t.shape[0],pi(t.shape,1)];return t.reshape(n)}function pl(t,n,e){return j(()=>{switch(t.rank){case 1:return Ey(t,n,e);case 2:return kw(t,[n,0],[e,t.shape[1]]);case 3:return Sy(t,[n,0,0],[e,t.shape[1],t.shape[2]]);case 4:return km(t,[n,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3]]);case 5:return at(t,[n,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return at(t,[n,0,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new $(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function nk(t,n,e){return j(()=>{switch(t.rank){case 1:return Ey(t,n,e);case 2:return kw(t,[0,n],[t.shape[0],e]);case 3:return Sy(t,[0,0,n],[t.shape[0],t.shape[1],e]);case 4:return km(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],e]);default:throw new $(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function My(t,n,e,r){return j(()=>{switch(t.rank){case 1:return Ey(t,n,e);case 2:switch(r){case 1:return pl(t,n,e);case 2:return nk(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return pl(t,n,e);case 2:return Sy(t,[0,n,0],[t.shape[0],e,t.shape[2]]);case 3:return nk(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return pl(t,n,e);case 2:return km(t,[0,n,0,0],[t.shape[0],e,t.shape[2],t.shape[3]]);case 3:return km(t,[0,0,n,0],[t.shape[0],t.shape[1],e,t.shape[3]]);case 4:return nk(t,n,e);default:throw new $(`The axis is not within the rank of the tensor ${r}`)}default:throw new $(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function Pm(t,n=-1){let e;return n<0&&(e=t[0].rank,e!==0?n=e:n=0),n===t[0].rank&&(n=-1),jt(t,n)}function ok(t,n){switch(t.rank){case 1:return tN([t,n]);case 2:return nN([t,n],0);case 3:return rN([t,n],0);case 4:return oN([t,n],0);default:throw new $(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function jw(t,n){if(Array.isArray(n)||(n=[n]),t.rank!==n.length)throw new $(`The length of input n (${n.length}) does not match the number of dimensions in input x (${t.rank})`);return zi(t,n)}function Lm(t,n=0,e=1,r,o){return Dw(t,n,e,r,o)}function fi(t,n,e,r){if(t.rank<2||n.rank<2)throw new Ae(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${n.shape}`);if(n.rank>=3){let o=t.shape.slice(-1)[0],i=n.shape.slice(-2)[0];if(o!==i)throw new Ae(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${n.shape}`)}if(t.rank===2&&n.rank===2)return qd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?rk(t.rank,r,kr()):null,activation:e});{let o=t.shape.slice(),i=o.pop();t=t.reshape([-1,i]);let s=n.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:n.rank},(m,h)=>h===0?n.rank-2:h<=n.rank-2?h-1:h);n=n.transpose(u).reshape([l,-1]);let d=[...o,...c];return qd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?rk(t.rank,r,kr()):null,activation:e}).reshape(d)}}function Gw(t,n,e){return j(()=>(Array.isArray(n)?n=ai(n,"int32"):n=n.toInt(),Fd(t,n,e)))}function Zd(t){return V(t,t)}function rk(t,n,e){let r=n.shape;if(n.rank!==1&&n.rank!==t)throw new $(`Unexpected bias dimensions: ${n.rank}; expected it to be 1 or ${t}`);if(t===5){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1,1]):n.reshape([1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===4){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1]):n.reshape([1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===3){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1]):n.reshape([1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,r[0]]):n.reshape([1].concat(r))}else if(t<3)return n;throw new $(`Unsupported input rank by biasAdd: ${n.rank}`)}function Mr(t,n,e){return j(()=>(e==null&&(e=kr()),Kt(e),t.add(rk(t.rank,n,e))))}function V4(t,n=1){if(n!==1)throw new Ae(`Support for alpha values other than 1 (${n}) is not implemented yet.`);return ll(t)}function B4(t){return j(()=>ye(t,Sn(t).add(1)))}function Ww(t,n,e,r){return j(()=>oB(t,n,e,r))}function z4(t){return j(()=>{let n=re(.5,V(.2,t));return Hn(n,0,1)})}function ru(t,n,e=!1){return e?t():n()}var U4=["fanIn","fanOut","fanAvg"],j4=["normal","uniform","truncatedNormal"];function Ape(t){Ts(U4,"FanMode",t)}function Rpe(t){Ts(j4,"Distribution",t)}var Or=class extends Q.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},H4=(()=>{class t extends Or{apply(e,r){return Gt(e,r)}}return t.className="Zeros",t})();Q.registerClass(H4);var Hw=(()=>{class t extends Or{apply(e,r){return yo(e,r)}}return t.className="Ones",t})();Q.registerClass(Hw);var q4=(()=>{class t extends Or{constructor(e){if(super(),typeof e!="object")throw new $(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new $(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return j(()=>V(Fe(this.value),yo(e,r)))}getConfig(){return{value:this.value}}}return t.className="Constant",t})();Q.registerClass(q4);var K4=(()=>{class t extends Or{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return ul(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return t.className="RandomUniform",t})();Q.registerClass(K4);var X4=(()=>{class t extends Or{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ae(`randomNormal does not support dType ${r}.`);return Lm(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="RandomNormal",t})();Q.registerClass(X4);var Y4=(()=>{class t extends Or{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ae(`truncatedNormal does not support dType ${r}.`);return Dy(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="TruncatedNormal",t})();Q.registerClass(Y4);var Z4=(()=>{class t extends Or{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return j(()=>{if(e.length!==2||e[0]!==e[1])throw new $("Identity matrix initializer can only be used for 2D square matrices.");return V(this.gain,Em(e[0]))})}getConfig(){return{gain:this.gain}}}return t.className="Identity",t})();Q.registerClass(Z4);function Mpe(t,n="channelsLast"){let e,r;if(Kt(n),t.length===2)e=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(n==="channelsFirst"){let o=pi(t,2);e=t[1]*o,r=t[0]*o}else if(n==="channelsLast"){let o=pi(t,0,t.length-2);e=t[t.length-2]*o,r=t[t.length-1]*o}}else{let o=pi(t);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var vo=(()=>{class t extends Or{constructor(e){if(super(),e.scale<0)throw new $(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Ape(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Rpe(this.distribution),this.seed=e.seed}apply(e,r){let o=Mpe(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ae(`${this.getClassName()} does not support dType ${r}.`);return Dy(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return ul(e,-l,l,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return t.className="VarianceScaling",t})();Q.registerClass(vo);var ik=(()=>{class t extends vo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return vo.className}}return t.className="GlorotUniform",t})();Q.registerClass(ik);var sk=(()=>{class t extends vo{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return vo.className}}return t.className="GlorotNormal",t})();Q.registerClass(sk);var ak=(()=>{class t extends vo{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return vo.className}}return t.className="HeNormal",t})();Q.registerClass(ak);var lk=(()=>{class t extends vo{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return vo.className}}return t.className="HeUniform",t})();Q.registerClass(lk);var ck=(()=>{class t extends vo{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return vo.className}}return t.className="LeCunNormal",t})();Q.registerClass(ck);var uk=(()=>{class t extends vo{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return vo.className}}return t.className="LeCunNormal",t})();Q.registerClass(uk);var Q4=(()=>{class t extends Or{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Ae("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return j(()=>{if(e.length<2)throw new Ae("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let o=e[0]>e[1]?[e[1],e[0]]:e,i=Lm(o,0,1,"float32"),s=xB.gramSchmidt(i);return e[0]>e[1]&&(s=s.transpose()),V(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}}return t.className="Orthogonal",t})();Q.registerClass(Q4);var G4={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function W4(t,n={}){return Ss(t,Q.SerializationMap.getMap().classNameMap,n,"initializer")}function Vt(t){return Fm(t)}function Nt(t){if(typeof t=="string"){let n=t in G4?G4[t]:t;if(n==="GlorotNormal")return new sk;if(n==="GlorotUniform")return new ik;if(n==="HeNormal")return new ak;if(n==="HeUniform")return new lk;if(n==="LeCunNormal")return new ck;if(n==="LeCunUniform")return new uk;{let e={};return e.className=n,e.config={},W4(e)}}else return t instanceof Or?t:W4(t)}var Ope=0;function Kw(){return Ope++}var qw={};function ou(t=""){return t in qw||(qw[t]=0),qw[t]+=1,t+qw[t].toString()}function Xw(t){return Array.isArray(t)&&Array.isArray(t[0])}function $m(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Ve(t){let n;if(Array.isArray(t)){if(t.length!==1)throw new $(`Expected Tensor length to be 1; got ${t.length}`);n=t[0]}else n=t;return n}function Je(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new $(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function Vm(t){let n=0;for(let e of t)e.shape.length===0?n+=1:n+=e.shape.reduce((r,o)=>r*o);return n}var eU="Variable",Fy=class{constructor(n,e="float32",r=eU,o=!0,i=null){this.dtype=e??"float32",this.shape=n.shape,this.id=Kw(),r=r??eU,this.originalName=Bw(r),this.name=zw(this.originalName),this.trainable_=o,this.constraint=i,this.val=ON(n,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(n){return this.assertNotDisposed(),Lpe(this.val,n),this.val.id!==n.id&&(this.val.assign(n),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(n){this.trainable_=n,this.val.trainable=n}};function Lpe(t,n){if(t.shape.toString()!==n.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(n.shape))}function Oy(t){return t.map(n=>n.read())}function Bm(t){t.forEach(n=>{n[0].write(n[1])})}var Mt=class{constructor(n){this.dtype=n.dtype,this.shape=n.shape,n.shape!=null?this.ndim=n.shape.length:this.ndim=n.ndim,this.maxNDim=n.maxNDim,this.minNDim=n.minNDim,this.axes=n.axes||{}}},Cr=class{constructor(n,e,r,o,i,s,a){this.dtype=n,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=Kw(),s!=null&&(this.originalName=Bw(s),this.name=zw(this.originalName)),this.rank=e.length}},$pe=0,hl=class{constructor(n,e){this.callArgs=e,this.id=$pe++,this.outboundLayer=n.outboundLayer,this.inboundLayers=n.inboundLayers,this.nodeIndices=n.nodeIndices,this.tensorIndices=n.tensorIndices,this.inputTensors=n.inputTensors,this.outputTensors=n.outputTensors,this.inputMasks=n.inputMasks,this.outputMasks=n.outputMasks,this.inputShapes=n.inputShapes,this.outputShapes=n.outputShapes;for(let r of n.inboundLayers)r?.outboundNodes.push(this);n.outboundLayer.inboundNodes.push(this)}getConfig(){let n=[];for(let e of this.inboundLayers)e!=null?n.push(e.name):n.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Vpe=0,je=class extends Q.Serializable{constructor(n={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Vpe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=n.name;if(!e){let r=this.getClassName();e=ui(r)+"_"+ou(r)}if(this.name=e,this.trainable_=n.trainable==null?!0:n.trainable,n.inputShape!=null||n.batchInputShape!=null){let r;if(n.batchInputShape!=null)r=n.batchInputShape;else if(n.inputShape!=null){let i=null;n.batchSize!=null&&(i=n.batchSize),r=[i].concat(n.inputShape)}this.batchInputShape=r;let o=n.dtype;o==null&&(o=n.inputDType),o==null&&(o="float32"),this.dtype=o}n.weights!=null?this.initialWeights=n.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(n,e){return n.name+"_ib-"+e.toString()}getNodeAtIndex(n,e){if(this.inboundNodes.length===0)throw new Ar(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=n)throw new $(`Asked to get ${e} at node ${n}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[n]}getInputAt(n){return Bn(this.getNodeAtIndex(n,"input").inputTensors)}getOutputAt(n){return Bn(this.getNodeAtIndex(n,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Lo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Lo(`Layer ${this.name} is not connected, no input to return.`);return Bn(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Lo(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Lo(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return Bn(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(n=>n())}get updates(){return this._updates}get built(){return this._built}set built(n){this._built=n}get trainable(){return this.trainable_}set trainable(n){this._trainableWeights.forEach(e=>e.trainable=n),this.trainable_=n}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(n=>n.trainable):[]}set trainableWeights(n){this._trainableWeights=n}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(n=>!n.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(n){this._nonTrainableWeights=n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(n){if(n=Rt(n),this.inputSpec==null||this.inputSpec.length===0)return;let e=Rt(this.inputSpec);if(n.length!==e.length)throw new $(`Layer ${this.name} expects ${e.length} inputs, but it received ${n.length} input tensors. Input received: ${n}`);for(let r=0;r<n.length;r++){let o=n[r],i=e[r];if(i==null)continue;let s=o.rank;if(i.ndim!=null&&s!==i.ndim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(i.maxNDim!=null&&s>i.maxNDim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(i.minNDim!=null&&s<i.minNDim)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new $(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){let a=o.shape;for(let l in i.axes){let c=Number(l),u=i.axes[l],d=c>=0?a[c]:a[a.length+c];if(u!=null&&[u,null].indexOf(d)===-1)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${a}.`)}}if(i.shape!=null)for(let a=0;a<i.shape.length;++a){let l=i.shape[a],c=o.shape[a];if(l!=null&&c!=null&&l!==c)throw new $(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(n,e){return n}invokeCallHook(n,e){this._callHook!=null&&this._callHook(n,e)}setCallHook(n){this._callHook=n}clearCallHook(){this._callHook=null}apply(n,e){e=e||{},this.assertNotDisposed();let r=Rt(n),o=!0;for(let s of r)if(!(s instanceof Cr)){o=!1;break}let i=!0;for(let s of r)if(s instanceof Cr){i=!1;break}if(o===i)throw new $("Arguments to apply() must be all SymbolicTensors or all Tensors");return Gi(this.name,()=>{if(!this.built){this.assertInputCompatibility(n);let s=[];for(let a of Rt(n))s.push(a.shape);this.build(Bn(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(n),i){let s=this.call(n,e),a=Rt(s),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=Bn(l),this.activityRegularizer!=null)throw new Ae("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=Bpe(n),a=this.computeOutputShape(s),l,c=zpe(n);if(this.warnOnIncompatibleInputShape(Array.isArray(n)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new Cr(c,u,this,Rt(n),e,this.name,d)):l=new Cr(c,a,this,Rt(n),e,this.name),this.addInboundNode(n,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new Ae("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(n){if(this.batchInputShape!=null)if(n.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(n)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&n[o]!=null&&n[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(n)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Lo(`The layer ${this.name} has never been called and thus has no defined output shape.`);let n=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);n.indexOf(r)===-1&&n.push(r)}if(n.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Lo(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ar(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Vm(this.weights)}build(n){this.built=!0}getWeights(n=!1){return Oy(n?this.trainableWeights:this.weights)}setWeights(n){j(()=>{let e=this.weights;if(e.length!==n.length)throw new $(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${n.length}, but the layer was expecting ${e.length} weights. Provided weights: ${n}...`);if(e.length===0)return;let r=[],o=Oy(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=n[i];if(!w.arraysEqual(s.shape,l.shape))throw new $(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}Bm(r)})}addWeight(n,e,r,o,i,s,a){if(this._addedWeightNames.indexOf(n)!==-1)throw new $(`Duplicate weight name ${n} for layer ${this.name}`);this._addedWeightNames.push(n),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=Nt("zeros"));let l=o.apply(e,r),c=new Fy(l,r,n,s,a);return l.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),s==null&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(n){this.fastWeightInitDuringBuild=n}addLoss(n){n==null||Array.isArray(n)&&n.length===0||(n=Rt(n),this._losses!==void 0&&this._losses!==null&&this.losses.push(...n))}computeOutputShape(n){return n}computeMask(n,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(n,e,r,o,i,s,a=null){let l=Rt(n);e=Rt(e),r=Rt(r),o=Rt(o),i=$m(i),s=$m(s);let c=[],u=[],d=[];for(let p of l)c.push(p.sourceLayer),u.push(p.nodeIndex),d.push(p.tensorIndex);new hl({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let p=0;p<e.length;p++)e[p].sourceLayer=this,e[p].nodeIndex=this.inboundNodes.length-1,e[p].tensorIndex=p}getConfig(){let n={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(n.batchInputShape=this.batchInputShape),this.dtype!=null&&(n.dtype=this.dtype),n}disposeWeights(){return this.weights.forEach(n=>n.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let n=0;return--this._refCount===0&&(n=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:n}}};function Bpe(t){t=Rt(t);let n=[];for(let e of t)n.push(e.shape);return Bn(n)}function zpe(t){return"float32"}function dk(t,n,e){if((n==null||e!=null&&e>0)&&(n=t.sourceLayer,e=t.nodeIndex),n.inboundNodes.length===0)return[t];{let r=n.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=dk(s,a,l);for(let u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}var Qd=(()=>{class t extends je{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:ou("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new $("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new $("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new $("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new Cr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new hl({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new $(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return t.className="InputLayer",t})();Q.registerClass(Qd);function pk(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new $("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let n=t.batchShape;t.shape!=null&&n==null&&(n=[null].concat(t.shape));let e=t.dtype;return e==null&&(e="float32"),new Qd({batchInputShape:n,name:t.name,dtype:e,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}async function gl(t){if(t==null)return;let n=[],e=[],r=[];for(let o in t){let i=t[o];if(typeof i!="number"){let s=i;n.push(s.data()),e.push(o),r.push(s)}}if(n.length>0){let o=await Promise.all(n);for(let i=0;i<o.length;++i)t[e[i]]=o[i][0];Pe(r)}}function Yw(t){if(t!=null)for(let n in t){let e=t[n];typeof e!="number"&&e.dispose()}}var Upe=125,iu=class{constructor(){this.validationData=null}setParams(n){this.params=n}async onEpochBegin(n,e){}async onEpochEnd(n,e){}async onBatchBegin(n,e){}async onBatchEnd(n,e){}async onTrainBegin(n){}async onTrainEnd(n){}setModel(n){}},Zw=class{constructor(n,e=10){n==null&&(n=[]),this.callbacks=n,this.queueLength=e}append(n){this.callbacks.push(n)}setParams(n){for(let e of this.callbacks)e.setParams(n)}setModel(n){for(let e of this.callbacks)e.setModel(n)}async onEpochBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochBegin(n,e)}async onEpochEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochEnd(n,e)}async onBatchBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchBegin(n,e)}async onBatchEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchEnd(n,e)}async onTrainBegin(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainBegin(n)}async onTrainEnd(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainEnd(n)}},fk=class extends iu{constructor(){super()}async onEpochBegin(n){this.seen=0,this.totals={}}async onBatchEnd(n,e){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=j(()=>re(this.totals[o],V(i,r)));this.totals[o]=a,s?.dispose()}}}async onEpochEnd(n,e){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:j(()=>{let o=V(ye(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),$n(e[r])}))}},Qw=class extends iu{async onTrainBegin(n){this.epoch=[],this.history={}}async onEpochEnd(n,e){e==null&&(e={}),this.epoch.push(n);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])}async syncData(){let n=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];n.push(l.data()),e.push(i),r.push(a)}}let o=await Promise.all(n);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]}},Jw=class extends iu{constructor(n,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=Upe),this.yieldEvery==="never"&&n.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");w.isNumber(this.yieldEvery)&&(this.maybeWait=x4(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=n.onTrainBegin,this.trainEnd=n.onTrainEnd,this.epochBegin=n.onEpochBegin,this.epochEnd=n.onEpochEnd,this.batchBegin=n.onBatchBegin,this.batchEnd=n.onBatchEnd,this.yield=n.onYield}async maybeWait(n,e,r){let o=[];this.yield!=null&&(await gl(r),o.push(this.yield(n,e,r))),o.push(ky()),await Promise.all(o)}async onEpochBegin(n,e){this.currentEpoch=n,this.epochBegin!=null&&(await gl(e),await this.epochBegin(n,e))}async onEpochEnd(n,e){let r=[];this.epochEnd!=null&&(await gl(e),r.push(this.epochEnd(n,e))),this.yieldEvery==="epoch"&&r.push(ky()),await Promise.all(r)}async onBatchBegin(n,e){this.batchBegin!=null&&(await gl(e),await this.batchBegin(n,e))}async onBatchEnd(n,e){let r=[];this.batchEnd!=null&&(await gl(e),r.push(this.batchEnd(n,e))),this.yieldEvery==="batch"?r.push(ky()):w.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,n,e)),await Promise.all(r)}async onTrainBegin(n){this.trainBegin!=null&&(await gl(n),await this.trainBegin(n))}async onTrainEnd(n){this.trainEnd!=null&&(await gl(n),await this.trainEnd(n))}};function eC(t,n){return t==null&&(t={}),t instanceof iu?[t]:Array.isArray(t)&&t[0]instanceof iu?t:Rt(t).map(r=>new Jw(r,n))}var tU=(()=>{class t{constructor(){}static registerCallbackConstructor(e,r){w.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),t.checkForDuplicate(r),t.constructors[e]==null&&(t.constructors[e]=[]),t.constructors[e].push(r)}static checkForDuplicate(e){for(let r in t.constructors)t.constructors[+r].forEach(i=>{if(i===e)throw new $("Duplicate callback constructor.")})}static clear(){t.constructors={}}static createCallbacks(e){let r=[];for(let o in t.constructors){let i=+o;e>=i&&r.push(...t.constructors[i])}return r.map(o=>new o)}}return t.constructors={},t})();function tC(t,n,e,r,o,i,s,a,l){let c=new Qw,u=[new fk,...tU.createCallbacks(n)];t!=null&&u.push(...t),u.push(c);let d=new Zw(u);return d.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:n,doValidation:a,metrics:l}),{callbackList:d,history:c}}function Kr(t,n={},e=!1){return Ss(t,Q.SerializationMap.getMap().classNameMap,n,"layer",e)}function Py(t,n){return j(()=>{t.dtype!=="float32"&&(t=t.asType("float32"));let e=Ce(Zd(t),n,!0),r=gy(e.shape,Cn()),o=Wt(go(e,r));return ye(t,o)})}function Jd(t,n){return j(()=>qt(Zd(Se(n,t)),-1))}function $y(t,n){return j(()=>qt(Sn(Se(n,t)),-1))}function Vy(t,n){return j(()=>{let e=Se(t,n),r=Hn(Sn(t),Cn(),Number.MAX_VALUE),o=Sn(ye(e,r));return V(100,qt(o,-1))})}function jpe(t,n){return j(()=>{let e=Hn(n,Cn(),Number.MAX_VALUE),r=Nr(re(1,e)),o=Hn(t,Cn(),Number.MAX_VALUE),i=Nr(re(1,o));return qt(Zd(Se(r,i)),-1)})}function Gpe(t,n){return j(()=>{let e=go(0,Se(1,V(t,n)));return qt(Zd(e),-1)})}function Wpe(t,n){return j(()=>{let e=go(0,Se(1,V(t,n)));return qt(e,-1)})}function Hpe(t,n){return j(()=>{let e=Ce(V(t,n),-1),r=Kn(V(Se(1,t),n),-1);return go(0,re(1,Se(r,e)))})}function qpe(t,n){return j(()=>{let e=Math.log(2),r=Se(n,t),o=Se(re(r,_s(V(-2,r))),e);return qt(o,-1)})}function ep(t,n,e=!1){return j(()=>{if(e)n=zd(n);else{let r=Ce(n,n.shape.length-1,!0);n=ye(n,r)}return n=Hn(n,Cn(),1-Cn()),Ct(Ce(V(t.toFloat(),Nr(n)),n.shape.length-1))})}function zm(t,n,e=!1){return j(()=>{let r=cl(L4(t)).toInt();n=Hn(n,Cn(),1-Cn());let o=n.shape,i=ym(r,o[o.length-1]).reshape(o);return ep(i,n,e)})}function Kpe(t,n){if(!w.arraysEqual(t.shape,n.shape))throw new $(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(n.shape)}`);return j(()=>{let e=n.relu(),r=n.abs().neg();return e.sub(n.mul(t)).add(r.exp().log1p())})}function Um(t,n){return j(()=>{let e;return e=Hn(n,Cn(),1-Cn()),e=Nr(ye(e,Se(1,e))),qt(Kpe(t,e),-1)})}function Xpe(t,n){return j(()=>{let e=Hn(t,Cn(),1),r=Hn(n,Cn(),1);return Ce(V(t,Nr(ye(e,r))),-1)})}function Ype(t,n){return j(()=>{let e=Nr(re(Cn(),n));return qt(Se(n,V(t,e)),-1)})}function nC(t,n){return j(()=>{let e=Py(t,-1),r=Py(n,-1),o=V(e,r);return Ct(Ce(o,-1))})}var Ly={meanSquaredError:Jd,meanAbsoluteError:$y,meanAbsolutePercentageError:Vy,meanSquaredLogarithmicError:jpe,squaredHinge:Gpe,hinge:Wpe,categoricalHinge:Hpe,logcosh:qpe,categoricalCrossentropy:ep,sparseCategoricalCrossentropy:zm,binaryCrossentropy:Um,kullbackLeiblerDivergence:Xpe,poisson:Ype,cosineProximity:nC};function rC(t){if(typeof t=="string"){if(t in Ly)return Ly[t];let n=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new $(n)}else return t}function iC(t,n){return j(()=>{let e=V(.5,Vn(n)),r=fl(qn(n,e),t.dtype);return qt(oi(t,r),-1)})}function sC(t,n){return j(()=>fl(oi(xm(t,-1),xm(n,-1)),"float32"))}function Zpe(t,n){return j(()=>br(t.equal(1),n.equal(1)).sum().cast("float32"))}function Qpe(t,n){return j(()=>br(t.equal(0),n.equal(1)).sum().cast("float32"))}function rU(t,n){return j(()=>{let e=Zpe(t,n),r=Qpe(t,n),o=e.add(r);return dn(qn(o,0),e.div(o),0).cast("float32")})}function mk(t,n){return Um(t,n)}function hk(t,n){return t.rank===n.rank&&(t=t.squeeze([t.rank-1])),n=n.argMax(-1),n.dtype!==t.dtype&&(n=n.asType(t.dtype)),oi(t,n).asType("float32")}var Jpe=Jd,efe=Jd,tfe=$y,nfe=$y,rfe=Vy,ofe=Vy,aC=ep,ife=nC,gk=zm,oC={binaryAccuracy:iC,categoricalAccuracy:sC,precision:rU,categoricalCrossentropy:aC,sparseCategoricalCrossentropy:gk,mse:Jpe,MSE:efe,mae:tfe,MAE:nfe,mape:rfe,MAPE:ofe,cosine:ife};function oU(t){if(typeof t=="string"&&t in oC)return oC[t];if(typeof t!="string"&&t!=null)return t;throw new $(`Unknown metric ${t}`)}function By(t){if($o(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let n;for(let e of Object.keys(Ly))if(Ly[e]===t){n=e;break}if(n!==void 0)return n;for(let e of Object.keys(oC))if(oC[e]===t){n=e;break}return n!==void 0?n:t.name}}function sU(t){let n={Adagrad:()=>Kd.adagrad(.01),Adadelta:()=>Kd.adadelta(1,.95,Cn()),Adam:()=>Kd.adam(.001,.9,.999,Cn()),Adamax:()=>Kd.adamax(.002,.9,.999,Cn(),0),RMSProp:()=>Kd.rmsprop(.001,.9,0,Cn()),SGD:()=>Kd.sgd(.01)};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new $(`Unknown Optimizer ${t}`)}function vk(t,n,e=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!yk(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(t);r.length>1048576&&console.warn(`User-defined metadata of model "${n}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function yk(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let n=Object.keys(t);for(let e of n)if(typeof e!="string"||!yk(t[e]))return!1;return!0}else if(Array.isArray(t)){for(let n of t)if(!yk(n))return!1;return!0}else return!1;else{let n=typeof t;return n==="string"||n==="number"||n==="boolean"}}function aU(t,n,e,r=console.log){let o=lfe(t),i=["Layer (type)","Output shape","Param #"];o?(n=n||65,e=e||[.45,.85,1]):(n=n||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(n*u)));let s;if(!o){i.push("Receives inputs"),s=[];for(let u in t.nodesByDepth)s.push(...t.nodesByDepth[u])}r("_".repeat(n)),lC(i,e,r),r("=".repeat(n));let a=t.layers;for(let u=0;u<a.length;++u)o?cfe(a[u],e,r):ufe(a[u],e,s,r),r((u===a.length-1?"=":"_").repeat(n));t.checkTrainableWeightsConsistency();let l=afe(t),c=Vm(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(n))}function afe(t){let n;return t.collectedTrainableWeights!=null?n=Vm(t.collectedTrainableWeights):n=Vm(t.trainableWeights),n}function lfe(t){let n=!0,e=[],r=[];for(let o in t.nodesByDepth)e.push(t.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){n=!1;break}r.push(...o)}if(n)for(let o of t.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){n=!1;break}else i=!0;if(!n)break}return n}function lC(t,n,e=console.log){let r="";for(let o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=t[o],r=r.slice(0,n[o]),r+=" ".repeat(n[o]-r.length);e(r)}function cfe(t,n,e){let r;try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}let o=t.name,i=t.getClassName(),s=[`${o} (${i})`,r,t.countParams().toString()];lC(s,n,e)}function ufe(t,n,e,r){let o;try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let u of t.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(u)===-1))for(let d=0;d<u.inboundLayers.length;++d){let p=u.inboundLayers[d].name,f=u.nodeIndices[d],m=u.tensorIndices[d];i.push(`${p}[${f}][${m}]`)}let s=t.name,a=t.getClassName(),l=i.length===0?"":i[0],c=[`${s} (${a})`,o,t.countParams().toString(),l];lC(c,n,r);for(let u=1;u<i.length;++u)lC(["","","",i[u]],n,r)}function lU(t,n,e){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&n===0&&typeof e=="string"}function jm(t,n){if(t===null)return null;if(typeof t=="string")return dl(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];lU(n,o,i)?e.push(i):e.push(jm(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=dl(r);e[i]=jm(o,i)}}return e}}function cC(t,n){if(t==null)return null;if(typeof t=="string")return ui(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];lU(n,o,i)?e.push(i):e.push(cC(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r],i=ui(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=cC(o,r)}return e}}var Gm="3.6.0";function dfe(t,n){if(t.dtype==null||t.dtype===n.dtype)return n;try{return ue(n,t.dtype)}catch{throw new $(`The dtype of the feed (${n.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var Ds=class t{constructor(n){if(this.id2Value={},this.id2Mask={},this.name2Id={},n instanceof t)for(let e in n.id2Value)this.id2Value[e]=n.id2Value[e],e in n.id2Mask&&(this.id2Mask[e]=n.id2Mask[e]);else{if(n==null)return;for(let e of n)this.add(e.key,e.value)}}add(n,e,r){if(this.id2Value[n.id]==null)this.id2Value[n.id]=dfe(n,e),this.name2Id[n.name]=n.id,r!=null&&(this.id2Mask[n.id]=r);else throw new $(`Duplicate key: name=${n.name}, id=${n.id}`);return this}addFeed(n){this.add(n.key,n.value)}hasKey(n){return this.id2Value[n.id]!=null}names(){return Object.keys(this.name2Id)}getValue(n){if(n instanceof Cr){if(this.id2Value[n.id]==null)throw new $(`Nonexistent key: ${n.name}`);return this.id2Value[n.id]}else{let e=this.name2Id[n];if(e==null)throw new $(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Value[e]}}getMask(n){if(n instanceof Cr){if(this.id2Value[n.id]==null)throw new $(`Nonexistent key: ${n.name}`);return this.id2Mask[n.id]}else{let e=this.name2Id[n];if(e==null)throw new $(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Pe(this.id2Mask)}},xk={},cU={};function tp(t,n,e,r){let o=e==null?!1:e.training,i=Array.isArray(t),s=i?t:[t],a=s.map(m=>m.name),l=[],c=n.names();for(let m of a)c.indexOf(m)!==-1?l.push(n.getValue(m)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let u=a.join(",")+"|"+n.names().join(","),d,p;if(xk[u]==null){let m=pfe(s,n);d=m.sorted,p=m.recipientCounts,xk[u]=d,cU[u]=p}d=xk[u],p={},o||Object.assign(p,cU[u]);let f=new Ds(n);for(let m=0;m<d.length;++m){if(r!=null){let R=dy().numTensors;R>r.maxNumTensors&&(r.maxNumTensors=R),R<r.minNumTensors&&(r.minNumTensors=R)}let h=d[m],g=h.sourceLayer;if(g instanceof Qd)continue;let x=[],b=[],I=[],_=!1;for(let R of h.inputs){let L=f.getValue(R),G=f.getMask(R);x.push(L),b.push(G),G!=null&&(_=!0),o||(p[R.name]--,p[R.name]===0&&!n.hasKey(R)&&a.indexOf(R.name)===-1&&!L.isDisposed&&R.sourceLayer.stateful!==!0&&I.push(L))}_&&(e=e||{},e.mask=b[0]);let E=Rt(g.apply(x,e)),S=null;g.supportsMasking&&(S=g.computeMask(x,b));let D=mfe(h),M=Array.isArray(D)?D:[D];for(let R=0;R<M.length;++R){f.hasKey(M[R])||f.add(M[R],E[R],Array.isArray(S)?S[0]:S);let L=a.indexOf(M[R].name);L!==-1&&(l[L]=E[R])}o||Pe(I)}return f.disposeMasks(),i?l:l[0]}function pfe(t,n){w.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(t.length===1){let o=uU(t[0],n);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of t){let{sorted:s,recipientMap:a}=uU(i,n);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:e,recipientCounts:ffe(r)}}function ffe(t){let n={};for(let e in t)n[e]=t[e].size;return n}function uU(t,n){let e=new Set,r=[],o={};for(let a of n.names())e.add(a);let i=[],s=[];for(i.push(t);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:o}}function mfe(t){let n;if(t.sourceLayer.inboundNodes.length===1)n=t.sourceLayer.output;else{let e=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(let o of t.sourceLayer.inboundNodes[r].outputTensors)if(o.id===t.id){e=r;break}n=t.sourceLayer.getOutputAt(e)}return n}var uC=class t extends je{constructor(n){if(super({}),this.containerNodes=new Set,this.name=n.name,this.name==null){let b=this.getClassName().toLowerCase();this.name=ou(b)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(n.inputs)?this.inputs=n.inputs.slice():this.inputs=[n.inputs],Array.isArray(n.outputs)?this.outputs=n.outputs.slice():this.outputs=[n.outputs],di(this.inputs).length!==this.inputs.length)throw new $(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(b=>b.name)}`);di(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(b=>b.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let b of this.outputs){let I=b.sourceLayer,_=b.nodeIndex,E=b.tensorIndex;this.outputLayers.push(I),this.outputLayersNodeIndices.push(_),this.outputLayersTensorIndices.push(E)}for(let b of this.inputs){let I=b.sourceLayer,_=b.nodeIndex,E=b.tensorIndex;$o(_===0,"input layer has >1 nodes"),$o(E===0,"input layer has >1 tensors"),this.inputLayers.push(I),this.inputLayersNodeIndices.push(_),this.inputLayersTensorIndices.push(E)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let b=0;b<this.inputLayers.length;b++){let I=this.inputLayers[b];if(!(I instanceof Qd))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${n.inputs}. Input ${b} (0-based) originates from layer type ${I.getClassName()}.`);this.inputNames.push(I.name),this.feedInputShapes.push(I.batchInputShape),this.feedInputNames.push(I.name)}for(let b of this.outputLayers)this.outputNames.push(b.name);this.internalInputShapes=this.inputs.map(b=>b.shape),this.internalOutputShapes=this.outputs.map(b=>b.shape);let e={},r={},o={},i={},s={},a=[],l=(b,I,_,E,S,D)=>{(E==null||S==null||D==null)&&(E=b.sourceLayer,S=b.nodeIndex,D=b.tensorIndex);let M=E.inboundNodes[S];if(_.indexOf(M)!==-1)throw new Ar(`The tensor ${b.name} at layer "${E.name}" is part of a cycle.`);if(I.indexOf(M)!==-1)return;this.containerNodes.add(t.nodeKey(E,S)),E.id in s||(s[E.id]=Object.keys(s).length),_.indexOf(M)===-1&&_.push(M);let R=M.inboundLayers.length;for(let L=0;L<R;L++){let G=M.inputTensors[L],W=M.inboundLayers[L],q=M.nodeIndices[L],X=M.tensorIndices[L];l(G,I,_,W,q,X)}for(I.push(M);_.indexOf(M)>=0;)_.splice(_.indexOf(M),1);a.push(M)},c=[],u=[];for(let b of this.outputs)l(b,c,u);let d=a.slice().reverse();for(let b of d){r[b.id]=b,b.id in e||(e[b.id]=0);let I=e[b.id],_=o[b.outboundLayer.id]==null?0:o[b.outboundLayer.id];I=Math.max(I,_),o[b.outboundLayer.id]=I,i[b.outboundLayer.id]=b.outboundLayer,e[b.id]=I;for(let E=0;E<b.inboundLayers.length;E++){let S=b.inboundLayers[E],D=b.nodeIndices[E],M=S.inboundNodes[D],R=e[M.id]==null?0:e[M.id];e[M.id]=Math.max(I+1,R),r[M.id]=M}}let p={};for(let b in e){let I=e[b];I in p||(p[I]=[]),p[I].push(r[b])}let f={};for(let b in o){let I=o[b];I in f||(f[I]=[]),f[I].push(i[b])}let m=Object.keys(f).map(b=>parseInt(b,10)).sort(Ay);this.layers=[];for(let b of m){let I=f[b];I.sort((_,E)=>{let S=s[_.id],D=s[E.id];return S<D?-1:S>D?1:0});for(let _ of I)_ instanceof t&&this.internalContainerRefs.push(_),this.layers.push(_)}this.layersByDepth=f,m=Object.keys(p).map(b=>parseInt(b,10)).sort(Ay);let h=this.inputs.slice(),g=[];for(let b of m)for(let I of p[b]){let _=I.outboundLayer;if(_!=null){for(let E of I.inputTensors)if(h.indexOf(E)===-1)throw new Ar(`Graph disconnected: cannot obtain value for tensor ${E} at layer "${_.name}". The following previous layers were accessed without issue: ${g}`);for(let E of I.outputTensors)h.push(E);g.push(_.name)}}this.nodesByDepth=p;let x=this.layers.map(b=>b.name);for(let b of x){let I=x.filter(_=>_===b).length;if(I!==1)throw new Ar(`The name "${b}" is used ${I} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new hl({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(b=>null),outputMasks:this.outputs.map(b=>null),inputShapes:this.inputs.map(b=>b.shape),outputShapes:this.outputs.map(b=>b.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let n={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)n.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)n.numDisposedVariables+=e.dispose().numDisposedVariables}return n.refCountAfterDispose=this._refCount,n}get trainable(){return this.trainable_}set trainable(n){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=n)}),this.trainable_=n}get trainableWeights(){if(this._trainableWeights.length>0)throw new $("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let n=[];for(let e of this.layers)n=n.concat(e.trainableWeights);return n}get nonTrainableWeights(){let n=[];for(let e of this.layers)n.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(n)}return n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(n,e=!0){let r={},o=0;for(let s of this.layers)for(let a of s.weights){if(r[a.originalName]!=null)throw new $(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,o++}let i=[];for(let s in n){let a=s;if(r[s]==null){let l=s.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[a]!=null)i.push([r[a],n[s]]);else if(e)throw new $(`Provided weight data has no target variable: ${s}`);delete r[a]}if(e){let s=[];for(let a in r)s.push(a);if(s.length>0)throw new $(`${s.length} of ${o} weights are not set: ${s}`)}Bm(i)}updatedConfig(){let n=this.getConfig(),e={};return e.className=this.getClassName(),e.config=n,e.kerasVersion=`tfjs-layers ${Gm}`,e.backend="TensorFlow.js",e}toJSON(n,e=!0){let r=cC(this.updatedConfig());return e?JSON.stringify(r):r}call(n,e){return j(()=>{n=Rt(n);let r=new Ds;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],n[o]);return tp(this.outputs,r,e)})}computeMask(n,e){return j(()=>{n=Rt(n);let r;return e==null?r=ci(null,n.length):r=Rt(e),this.runInternalGraph(n,r)[1]})}computeOutputShape(n){let e=$m(n);if(e.length!==this.inputLayers.length)throw new $(`Invalid inputShape argument ${n}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],c=e[a],u=l.name+"_0_0";r[u]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Ay);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let c of l){let u=c.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(u.id)!==-1)continue;let d=[];for(let h=0;h<c.inboundLayers.length;h++){let g=c.inboundLayers[h],x=c.nodeIndices[h],b=c.tensorIndices[h],I=`${g.name}_${x}_${b}`,_=r[I];d.push(_)}let p=u.computeOutputShape(Bn(d)),f=$m(p),m=u.inboundNodes.indexOf(c);for(let h=0;h<f.length;h++){let g=`${u.name}_${m}_${h}`;r[g]=f[h]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){let l=s[a];$o(l in r),i.push(r[l])}return Bn(i)}runInternalGraph(n,e){e==null&&(e=ci(null,n.length));let r={};for(let l=0;l<this.inputs.length;++l){let c=this.inputs[l],u=n[l],d=e[l];r[c.id]=[u,d]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Ay);for(let l of o){let c=this.nodesByDepth[l];for(let u of c){let d=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,m=new Array;for(let h of p)h.id in r&&m.push(r[h.id]);if(m.length===p.length){let h={},g,x,b,I;if(u.callArgs!=null&&(h=u.callArgs),m.length===1){let[_,E]=m[0];h.mask==null&&(h.mask=E),b=Rt(d.call(_,h)),I=Rt(d.computeMask(_,E)),g=[_],x=[E]}else g=m.map(_=>_[0]),x=m.map(_=>_[1]),h.mask==null&&(h.mask=x),b=Rt(d.call(g,h)),I=Rt(d.computeMask(g,x));if(d.activityRegularizer)throw new Ae("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let _=0;_<f.length;++_){let E=f[_],S=b[_],D=I[_];r[E.id]=[S,D]}}}}let i=[],s=[],a=[];for(let l of this.outputs){$o(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[c,u]=r[l.id];a.push(c.shape),i.push(c),s.push(u)}return[i,s,a]}buildNodeConversionMap(n){let e={},r;for(let o of this.layers){r=o instanceof t?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=t.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(n,e){if(e!=null){if(this.layers.length<=e)throw new $(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}else if(n==null)throw new $("Provide either a layer name or layer index");for(let r of this.layers)if(r.name===n)return r;throw new $(`No such layer: ${n}`)}calculateLosses(){return j(()=>{let n=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=t.nodeKey(e,r);this.containerNodes.has(o)&&n.push(...e.calculateLosses())}return n})}getConfig(){let n={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){let p=s.inboundNodes[d],f=t.nodeKey(s,d),m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){let h=[];for(let g=0;g<p.inboundLayers.length;g++){let x=p.inboundLayers[g],b=p.nodeIndices[g],I=p.tensorIndices[g],_=t.nodeKey(x,b),E=e[_];E==null&&(E=0),h.push([x.name,E,I,m])}c.push(h)}}}let u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}n.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.inputLayersTensorIndices[s];o.push([a.name,u,d])}n.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.outputLayersTensorIndices[s];i.push([a.name,u,d])}return n.outputLayers=i,n}static fromConfig(n,e,r={},o=!1){let i={},s={};function a(g,x){g.name in s?s[g.name].push(x):s[g.name]=[x]}function l(g,x){let b=[],I;for(let _ of x){let E=_[0],S=_[1],D=_[2];if(I=_[3]==null?{}:_[3],!(E in i)){a(g,x);return}let M=i[E];if(M.inboundNodes.length<=S){a(g,x);return}let R=M.inboundNodes[S];b.push(R.outputTensors[D])}b.length>0&&g.apply(Bn(b),I)}function c(g){let x=g.name,b=Kr(g,e.customObjects!=null?e.customObjects:{});b.setFastWeightInitDuringBuild(o),i[x]=b,g.inboundNodes.forEach(_=>{if(!(_ instanceof Array))throw new $(`Corrupted configuration, expected array for nodeData: ${_}`);a(b,_)})}let u=e.name,d=e.layers;for(let g of d)c(g);for(;!y4(s);)for(let g of d){let x=i[g.name];if(x.name in s){let b=s[x.name];delete s[x.name];for(let I of b)l(x,I)}}let p=[],f=[],m=e.inputLayers;for(let g of m){let x=g[0],b=g[1],I=g[2];$o(x in i);let E=i[x].inboundNodes[b].outputTensors;p.push(E[I])}let h=e.outputLayers;for(let g of h){let x=g[0],b=g[1],I=g[2];$o(x in i);let E=i[x].inboundNodes[b].outputTensors;f.push(E[I])}return new n({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new $("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let n of this.layers)if(n.stateful)return!0;return!1}resetStates(){j(()=>{this.layers.forEach(n=>{n.stateful&&n.resetStates()})})}};function hfe(t,n,e){let r=n.length;if(t==null||Array.isArray(t)&&t.length===0)return n.map(o=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&n[0]in t?[t[n[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${e} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return n.forEach(i=>{i in t?o.push(t[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${n} keys. Provided ${e} not understood: ${JSON.stringify(t)}`)}function dC(t,n){return hfe(t,n,"classWeight")}async function pC(t,n,e,r){if(n!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=j(()=>{if(t.shape.length===1)return t.clone();if(t.shape.length===2){if(t.shape[1]>1)return t.argMax(1);if(t.shape[1]===1)return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await o.data());Pe(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),ai(s,"float32")}else return null}function dU(t,n){return V(t,n)}var gfe=32;function mU(t,n){let e,r,o=n;e=o.xs,r=o.ys,w.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${n}`);let i=pU("input",t.inputNames,e),s=pU("output",t.outputNames,r),a=i[0].shape[0];w.assert(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),w.assert(s.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)w.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<s.length;l++)w.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:s}}function pU(t,n,e){if(e instanceof ft)return[e];if(Array.isArray(e))return w.assert(e.length===n.length,()=>`Received an array of ${e.length} Tensors, but expected ${n.length} to match the ${t} keys ${n}.`),e;{let r=[];for(let o of n){if(e[o]==null)throw new $(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);r.push(e[o])}return r}}function yfe(t){if(t.length===3)throw new Ae("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function hU(t,n,e){let r=e.batchesPerEpoch!=null;if(w.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),w.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),w.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),w.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),w.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(fU(e.validationData))w.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=yfe(e.validationData);i=g.xs,s=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();let u=eC(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:p,history:f}=tC(u,d,e.epochs,null,null,vfe(n,e),null,o,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,h=await n.iterator();for(;m<e.epochs;){let g={};await p.onEpochBegin(m);let x=0,b=0;for(r||(h=await n.iterator());!r||x<e.batchesPerEpoch;){let I=await h.next();if(r&&I.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(I.value!=null){let{xs:_,ys:E}=mU(t,I.value),S={};S.batch=b,S.size=_[0].shape[0],await p.onBatchBegin(b,S);let D=[];if(e.classWeight!=null){let L=dC(e.classWeight,t.outputNames);for(let G=0;G<L.length;++G)D.push(await pC(E[G],null,L[G]))}let M=_.concat(E).concat(D),R=a(M);Pe(M);for(let L=0;L<l.length;++L){let G=l[L],W=R[L];S[G]=W,$n(W)}await p.onBatchEnd(b,S),Yw(S),b++,x++}if(r?x>=e.batchesPerEpoch:I.done){if(o){let _;fU(e.validationData)?_=Rt(await t.evaluateDataset(e.validationData,{batches:e.validationBatches})):_=Rt(t.evaluate(i,s,{batchSize:e.validationBatchSize==null?gfe:e.validationBatchSize,verbose:0}));for(let E=0;E<t.metricsNames.length;++E)g[`val_${t.metricsNames[E]}`]=_[E]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,g),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function vfe(t,n){let e=null;return n.batchesPerEpoch!=null?e=n.batchesPerEpoch:Number.isFinite(t.size)&&(e=t.size),e}function fU(t){return typeof t.iterator=="function"}function xfe(t){return typeof t.next=="function"}async function gU(t,n,e){e=e||{};let r=e.batches!=null,o=t.testFunction,i=[];if(e.verbose>0)throw new Ae("Verbose mode is not implemented yet.");w.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=xfe(n)?n:await n.iterator(),a=0,l=0;for(;!r||l<e.batches;){let c=await s.next();if(i=j(()=>{if(c.value){let{xs:u,ys:d}=mU(t,c.value),p=u.concat(d),f=j(()=>o(p));if(Pe(p),l===0)for(let h=0;h<f.length;++h)i.push(Fe(0));let m=p[0].shape[0];for(let h=0;h<f.length;++h){let g=f[h],x=i[h];i[h]=j(()=>re(i[h],V(m,g))),l>0&&Pe(x)}Pe(f),a+=m,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){let u=i[c];i[c]=ye(i[c],a),Pe(u)}return Bn(i)}function fC(t){w.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Wm(t,n,e){return t==null?[null]:Array.isArray(t)?t.map(r=>pl(r,n,e-n)):pl(t,n,e-n)}function mC(t,n){return j(()=>t==null?null:Array.isArray(t)?t.map(e=>mC(e,n)):Gw(t,n.dtype==="int32"?n:n.toInt()))}function hC(t,n){let e=[],r=0,o=null;for(;r<t;)o=r+n,o>=t&&(o=t),e.push([r,o]),r=o;return e}async function bfe(t,n,e,r,o,i,s,a,l,c,u,d,p,f,m){o==null&&(o=32),i==null&&(i=1),u==null&&(u=!0),p==null&&(p=0);let h=!1;if(l!=null&&c!=null&&(h=!0),m!=null&&(h=!0,f==null))throw new $("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=t.checkNumSamples(e,o,f,"steps_per_epoch"),x;g!=null&&(x=wr(0,g)),s==null&&(s=1);let{callbackList:b,history:I}=tC(a,s,i,p,g,f,o,h,d);b.setModel(t),t.history=I,await b.onTrainBegin(),t.stopTraining_=!1;for(let _=p;_<i;++_){await b.onEpochBegin(_);let E={};if(f!=null)throw new Ae("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Ae("batch shuffling is not implemneted yet");u&&w.shuffle(x);let S=ai(x),D=hC(g,o);for(let M=0;M<D.length;++M){let R={};if(await b.onBatchBegin(M,R),j(()=>{let L=D[M][0],G=D[M][1],W=pl(S,L,G-L);R.batch=M,R.size=G-L;let q=mC(e,W),X=n(q);for(let K=0;K<r.length;++K){let Z=r[K],se=X[K];R[Z]=se,$n(se)}if(M===D.length-1&&h){let K=t.testLoop(l,c,o);for(let Z=0;Z<r.length;++Z){let se=r[Z],ee=K[Z];$n(ee),E["val_"+se]=ee}}}),await b.onBatchEnd(M,R),Yw(R),t.stopTraining_)break}S.dispose()}if(await b.onEpochEnd(_,E),t.stopTraining_)break}return await b.onTrainEnd(),await t.history.syncData(),t.history}async function yU(t,n,e,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;let o,i,s,a,l,c,u;try{let d=r.batchSize==null?32:r.batchSize;fC(d);let f=await t.standardizeUserData(n,e,r.sampleWeight,r.classWeight,!1,d);o=f[0],i=f[1],u=f[2];let m=!1,h;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)s=r.validationData[0],a=r.validationData[1];else throw r.validationData.length===3?new Ae("validationData including sample weights is not supported yet."):new $(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);let M=await t.standardizeUserData(s,a,null,null,!0,d);l=M[0],c=M[1],h=l.concat(c)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;let D=Math.floor(o[0].shape[0]*(1-r.validationSplit)),M=o[0].shape[0];l=Wm(o,D,M),o=Wm(o,0,D),c=Wm(i,D,M),i=Wm(i,0,D),h=l.concat(c)}else r.validationSteps!=null&&(m=!0);let g=o.concat(i).concat(u);t.checkTrainableWeightsConsistency();let x=t.makeTrainFunction(),b=t.getDedupedMetricsNames(),I,_;m?(t.makeTestFunction(),I=t.testFunction,_=b.slice().concat(b.map(D=>"val_"+D))):(I=null,h=[],_=b.slice());let E=eC(r.callbacks,r.yieldEvery);return await bfe(t,x,g,b,d,r.epochs,r.verbose,E,I,h,r.shuffle,_,r.initialEpoch,null,null)}finally{t.isTraining=!1,su(o,n),su(i,e),su(l,s),su(c,a),u!=null&&Pe(u)}}function bk(t){let n=[];t instanceof ft&&(t=[t]);for(let e=0;e<t.length;++e){let r=t[e];if(r.rank===1)n.push(ml(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(r)}}return n}function su(t,n){if(t==null)return;let e=[];if(n instanceof ft)e.push(n.id);else if(Array.isArray(n))n.forEach(o=>e.push(o.id));else if(n!=null)for(let o in n){let i=n[o];e.push(i.id)}let r=[];if(t instanceof ft)e.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(t!=null)for(let o in t){let i=t[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function wfe(t){return t instanceof ft}function wk(t){return Array.isArray(t)}function vU(t){return!wfe(t)&&!wk(t)}function xU(t,n,e,r=!0,o=""){if(n==null||n.length===0){if(t!=null){let s=!1;if(wk(t)&&t.length>0)s=!0;else if(vU(t)){for(let a in t)if(t.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new $(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return n.map(s=>null);let i;if(vU(t)){t=t,i=[];for(let s of n){if(t[s]==null)throw new $(`No data provided for "${s}". Need data for each key in: ${n}`);i.push(t[s])}}else if(wk(t)){if(t=t,t.length!==n.length)throw new $(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${n.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,n.length>1)throw new $(`The model ${o} expects ${n.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=bk(i),e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new $(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u>=0&&c!==u)throw new $(`Error when checking ${o}: expected ${n[s]} to have shape [${e[s]}], but got array with shape [${a.shape}].`)}}return i}function Cfe(t,n,e){let r=di(t.map(i=>i.shape[0]));r.sort();let o=di(n.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new $(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(o.length>1)throw new $(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!w.arraysEqual(r,o))throw new $(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function _fe(t,n,e){let r=[Jd,Um,ep];for(let o=0;o<t.length;++o){let i=t[o],s=n[o],a=e[o];if(s!=null){if(s===ep&&i.shape[i.shape.length-1]===1)throw new $(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){let d=l[u],p=c[u];if(p!=null&&d!==p)throw new $(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function bU(t,n,e,r=!0,o=""){let i;if(Array.isArray(t)){if(t.length!==n.length)throw new $(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${n.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(n.length>1)throw new $(`The model expects ${n.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new $(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u!==c)throw new $(`Error when checking ${o}: expected ${n[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Ife(t,n){if(t==null||Array.isArray(t)&&t.length===0)return n.map(r=>[]);let e;if(typeof t=="string"||typeof t=="function")e=[t];else if(Array.isArray(t)||typeof t=="object")e=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(e))return n.map(r=>e);{let r=[];for(let o of n){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var Efe="layers-model",yl=(()=>{class t extends uC{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new $("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");aU(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=sU(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof or))throw new $("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new $(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(rC(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new $(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>rC(l))}else{let a=rC(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Gi("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=Ife(e.metrics,this.outputNames),s=(a,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,a])};Gi("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(u=>{let d="",p,f,m;for(let h of u){if(typeof h=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(h)!==-1){let x=this.internalOutputShapes[a];x[x.length-1]===1||this.lossFunctions[a]===Um?["accuracy","acc"].indexOf(h)!==-1?f=iC:["crossentropy","ce"].indexOf(h)!==-1&&(f=mk):this.lossFunctions[a]===zm?["accuracy","acc"].indexOf(h)!==-1?f=hk:["crossentropy","ce"].indexOf(h)!==-1&&(f=gk):["accuracy","acc"].indexOf(h)!==-1?f=sC:["crossentropy","ce"].indexOf(h)!==-1&&(f=aC);let b;["accuracy","acc"].indexOf(h)!==-1?b="acc":["crossentropy","ce"].indexOf(h)!==-1&&(b="ce"),m=f,p=d+b}else m=oU(h),p=d+By(h);let g;Gi(p,()=>{g=m}),s(a,p,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;fC(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,u=this.testLoop(c,l,i,o.verbose,o.steps);return Bn(u)}finally{su(a[0],e),su(a[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),gU(this,e,r)}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new $(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new $(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new $("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new Ds;if(e instanceof ft&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new $(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let u=e[c.name];if(u==null)throw new $(`No value is provided for the model's input ${c.name}`);a.add(c,u)}let l=tp(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=ci(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let c=a.indexOf(e[l]);if(c!==-1&&(r[l]=s[c],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new $(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return j(()=>{let i=this.checkNumSamples(e);if(o)throw new Ae("Verbose predictLoop() is not implemented yet.");let s=hC(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)j(()=>{let u=s[l][0],d=s[l][1],p=Wm(e,u,d),f=[];if(Array.isArray(p))for(let h=0;h<p.length;++h)f.push({key:this.inputs[h],value:p[h]});else f.push({key:this.inputs[0],value:p});let m=new Ds(f);return tp(this.outputs,m)}).forEach((u,d)=>a[d].push(u));return Bn(a.map(l=>jt(l,0)))})}predict(e,r={}){let o=bk(e);bU(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return fC(i),this.predictLoop(o,i)}finally{su(o,e)}}predictOnBatch(e){bU(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new Ar("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===zm?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=xU(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=xU(r,this.feedOutputNames,s,!1,"target"),Cfe(e,r,null),_fe(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new $(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,o,i,s=!0,a){let[l,c]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(i!=null){let d=dC(i,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(await pC(c[p],null,d[p]))}return[l,c,u]}testLoop(e,r,o,i=0,s){return j(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new Ae("Verbose mode is not implemented yet.");if(s!=null)throw new Ae("steps mode in testLoop() is not implemented yet");{let c=hC(a,o),u=ai(wr(0,a));for(let d=0;d<c.length;++d){let p=c[d][0],f=c[d][1],m=pl(u,p,f-p),h=mC(r,m),g=e(h);if(d===0)for(let x=0;x<g.length;++x)l.push(Fe(0));for(let x=0;x<g.length;++x){let b=g[x];l[x]=re(l[x],V(f-p,b))}}for(let d=0;d<l.length;++d)l[d]=ye(l[d],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(JN(e,i)>1){let a=JN(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let p=[];for(let g=0;g<this.inputs.length;++g)p.push({key:this.inputs[g],value:o[g]});let f=new Ds(p),m=tp(this.outputs,f,{training:!0}),h;for(let g=0;g<this.lossFunctions.length;++g){let x=this.lossFunctions[g],b=x(i[g],m[g]);s[g]!=null&&(b=dU(b,s[g]));let I=qt(b);r.push(I),g===0?h=b:h=re(h,b)}for(let g=0;g<this.metricsTensors.length;++g){let x;if(this.outputs.length>1&&g<this.outputs.length)x=r[g];else{let b=this.metricsTensors[g][0],I=this.metricsTensors[g][1];x=qt(b(i[I],m[I]))}$n(x),a.push(x)}return h=qt(h),this.calculateLosses().forEach(g=>{h=re(h,g)}),h},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>j(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:i[u]});let l=new Ds(a),c=tp(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],p=qt(d(s[u],c[u]));u===0?o=p:o=re(o,p),r.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=qt(d(s[p],c[p]));r.push(f)}return r})}async fit(e,r,o={}){return yU(this,e,r,o)}async fitDataset(e,r){return hU(this,e,r)}async trainOnBatch(e,r){let o=await this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),c=[];for(let u of l){let d=await u.data();c.push(d[0])}return Pe(l),Bn(c)}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=dy().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-dy().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=ui(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>ui(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=ui(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[ui(By(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>ui(By(e)));{let e={};for(let r in this.metrics)e[r]=ui(By(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=jm(e.optimizer_config),o=Kr(r),i;if(typeof e.loss=="string")i=dl(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>dl(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=dl(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>dl(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=dl(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}async save(e,r){if(typeof e=="string"){let u=ni.getSaveHandlers(e);if(u.length===0)throw new $(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new $(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new $("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=await ni.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:Efe,generatedBy:`TensorFlow.js tfjs-layers v${Gm}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:d,specs:p}=await ni.encodeWeights(await this.optimizer.getWeights(),u);o.specs.push(...p),o.data=ni.concatenateArrayBuffers([o.data,d])}return this.userDefinedMetadata!=null&&(vk(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)}setUserDefinedMetadata(e){vk(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return t.className="Model",t})();Q.registerClass(yl);var Sfe=(()=>{class t extends yl{}return t.className="Functional",t})();Q.registerClass(Sfe);async function wU(t,n){if(n==null&&(n={}),typeof t=="string"){let e=ni.getLoadHandlers(t,n);if(e.length===0)e.push(ni.browserHTTPRequest(t,n));else if(e.length>1)throw new $(`Found more than one (${e.length}) load handlers for URL '${t}'`);t=e[0]}return Tfe(t,void 0,n)}async function Tfe(t,n,e){if(e==null&&(e={}),t.load==null)throw new $("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await t.load(),o=r.modelTopology;o.model_config!=null&&(o=o.model_config);let i=e.strict==null?!0:e.strict,s=r.weightData!=null&&r.weightSpecs!=null&&i,a=Kr(jm(o),n,s),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new $("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:c,optimizerWeights:u}=Dfe(r.weightData,r.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Pe(c),Pe(u.map(d=>d.tensor))}return a}function Dfe(t,n){let e=ni.decodeWeights(t,n),r={},o=[];return n.forEach(i=>{i.group==="optimizer"?o.push({name:i.name,tensor:e[i.name]}):r[i.name]=e[i.name]}),{modelWeights:r,optimizerWeights:o}}var Ck=(()=>{class t extends yl{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:ou("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new $(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof t||e instanceof yl,o;if(r){if(o=e,o.outputs.length!==1)throw new $("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new $("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new $("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=pk({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new $(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new $("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=dk(this.outputs[0])}this.inboundNodes=[],new hl({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ci(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Je(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new yl({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}async evaluateDataset(e,r){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,o={}){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.fit(e,r,o)}async fitDataset(e,r){if(!this.built)throw new Ar("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new $("Legacy serialization format not supported yet.");s=r}else w.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof t))throw new Ae(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=Kr(c,void 0,i);i&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new $("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new $("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return t.className="Sequential",t})();Q.registerClass(Ck);function _k(t,n){return n==null&&(n={}),wU(t,n)}var _r=class extends Q.Serializable{getConfig(){return{}}},Nfe=(()=>{class t extends _r{apply(e,r=1){return V4(e,r)}}return t.className="elu",t})();Q.registerClass(Nfe);var kfe=(()=>{class t extends _r{apply(e){return wy(e)}}return t.className="selu",t})();Q.registerClass(kfe);var Afe=(()=>{class t extends _r{apply(e){return si(e)}}return t.className="relu",t})();Q.registerClass(Afe);var Rfe=(()=>{class t extends _r{apply(e){return j(()=>Ld(6,si(e)))}}return t.className="relu6",t})();Q.registerClass(Rfe);var Mfe=(()=>{class t extends _r{apply(e){return e}}return t.className="linear",t})();Q.registerClass(Mfe);var Ffe=(()=>{class t extends _r{apply(e){return ri(e)}}return t.className="sigmoid",t})();Q.registerClass(Ffe);var Ofe=(()=>{class t extends _r{apply(e){return z4(e)}}return t.className="hardSigmoid",t})();Q.registerClass(Ofe);var Pfe=(()=>{class t extends _r{apply(e){return _s(e)}}return t.className="softplus",t})();Q.registerClass(Pfe);var Lfe=(()=>{class t extends _r{apply(e){return B4(e)}}return t.className="softsign",t})();Q.registerClass(Lfe);var $fe=(()=>{class t extends _r{apply(e){return wm(e)}}return t.className="tanh",t})();Q.registerClass($fe);var Ek=(()=>{class t extends _r{apply(e,r=-1){return zd(e,r)}}return t.className="softmax",t})();Q.registerClass(Ek);var Vfe=(()=>{class t extends _r{apply(e,r=-1){return yy(e,r)}}return t.className="logSoftmax",t})();Q.registerClass(Vfe);var Bfe=(()=>{class t extends _r{apply(e,r=1){return j(()=>ri(e.mul(r)).mul(e))}}return t.className="swish",t})();Q.registerClass(Bfe);var zfe=(()=>{class t extends _r{apply(e){return j(()=>V(e,wm(_s(e))))}}return t.className="mish",t})();Q.registerClass(zfe);function Hi(t){return t.getClassName()}function Ik(t,n={}){return Ss(t,Q.SerializationMap.getMap().classNameMap,n,"activation")}function qi(t){if(t==null){let n={};return n.className="linear",n.config={},Ik(n)}if(typeof t=="string"){let n={};return n.className=t,n.config={},Ik(n)}else return t instanceof _r?t:Ik(t)}function Ufe(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var gC=class extends Q.Serializable{},IU=(()=>{class t extends gC{constructor(e){super(),Ufe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return j(()=>{let r=Gt([1]);return this.hasL1&&(r=re(r,Ce(V(this.l1,Sn(e))))),this.hasL2&&(r=re(r,Ce(V(this.l2,Zd(e))))),r.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return t.className="L1L2",t})();Q.registerClass(IU);var CU={l1l2:"L1L2"};function Et(t){return Fm(t)}function _U(t,n={}){return Ss(t,Q.SerializationMap.getMap().classNameMap,n,"regularizer")}function Ft(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in CU?CU[t]:t,config:{}};return _U(e)}else return t instanceof gC?t:_U(t)}var EU=(()=>{class t extends je{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=Ve(e);let o=si(e);return this.maxValue!=null&&(o=Hn(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ReLU",t})();Q.registerClass(EU);var SU=(()=>{class t extends je{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Ve(e);return Od(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LeakyReLU",t})();Q.registerClass(SU);var TU=(()=>{class t extends je{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=Nt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Ft(e.alphaRegularizer),this.alphaConstraint=tn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new $(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Je(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new Mt({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=Ve(e),Vd(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Vt(this.alphaInitializer),alphaRegularizer:Et(this.alphaRegularizer),alphaConstraint:en(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return t.className="PReLU",t})();Q.registerClass(TU);var DU=(()=>{class t extends je{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ae(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Ve(e);return ll(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ELU",t})();Q.registerClass(DU);var NU=(()=>{class t extends je{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=Ve(e);return o.mul(fl(o.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ThresholdedReLU",t})();Q.registerClass(NU);var kU=(()=>{class t extends je{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Ek().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let o=Ve(e);return this.softmax(o,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Softmax",t})();Q.registerClass(kU);function au(t,n,e){if(typeof t=="number")return ci(t,n);if(t.length!==n)throw new $(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${t.length} elements.`);for(let r=0;r<n;++r){let o=t[r];if(!F4(o))throw new $(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Xr(t,n,e,r,o=1){if(t==null)return t;let i=n+(n-1)*(o-1),s;return e==="same"?s=t:s=t-i+1,Math.floor((s+r-1)/r)}function Ki(t,n,e,r){if(t==null)return null;if(r==="valid")t=t*n+Wi([e-n,0]);else if(r==="same")t=t*n;else throw new $(`Unsupport padding mode: ${r}.`);return t}function Uy(t,n){return j(()=>(Kt(n),n==="channelsFirst"?st(t,[0,2,3,1]):t))}function Sk(t,n){return j(()=>(Kt(n),n==="channelsFirst"?st(t,[0,2,3,4,1]):t))}function Gfe(t,n,e,r=1,o="valid",i,s=1){return j(()=>{if(i==null&&(i=kr()),Kt(i),t.shape.length!==3)throw new $(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(n.shape.length!==3)throw new $(`The kernel for a conv1dWithBias operation should be 3, but is ${n.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new $(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=st(t,[0,2,1])),o==="causal")throw new Ae("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=fy(t,n,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=Mr(a,e)),a})}function AU(t,n,e,r=[1,1],o="valid",i,s,a=null){return j(()=>{if(i==null&&(i=kr()),Kt(i),t.rank!==3&&t.rank!==4)throw new $(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(n.rank!==3&&n.rank!==4)throw new $(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Uy(t,i);if(o==="causal")throw new Ae("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=qd.conv2d({x:l,filter:n,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=st(l,[0,3,1,2])),l})}function Wfe(t,n,e,r=[1,1,1],o="valid",i,s){return j(()=>{if(i==null&&(i=kr()),Kt(i),t.rank!==4&&t.rank!==5)throw new $(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(n.rank!==4&&n.rank!==5)throw new $(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=Sk(t,i);if(o==="causal")throw new Ae("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=iN(a,n,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=Mr(a,e)),i==="channelsFirst"&&(a=st(a,[0,4,1,2,3])),a})}var zy=class t extends je{constructor(n,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(e),this.rank=n,pn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ae(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=au(e.kernelSize,n,"kernelSize"),this.strides=au(e.strides==null?1:e.strides,n,"strides"),this.padding=e.padding==null?"valid":e.padding,Rr(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Kt(this.dataFormat),this.activation=qi(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=Nt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=tn(e.biasConstraint),this.biasRegularizer=Ft(e.biasRegularizer),this.activityRegularizer=Ft(e.activityRegularizer),this.dilationRate=au(e.dilationRate==null?1:e.dilationRate,n,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new $(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new $(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new $(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(n){if($o("kernelSize"in n,"required key 'kernelSize' not in config"),typeof n.kernelSize!="number"&&!$w(n.kernelSize,"number",1,3))throw new $(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(n.kernelSize)}.`)}getConfig(){let n={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Hi(this.activation),useBias:this.useBias,biasInitializer:Vt(this.biasInitializer),biasRegularizer:Et(this.biasRegularizer),activityRegularizer:Et(this.activityRegularizer),biasConstraint:en(this.biasConstraint)},e=super.getConfig();return Object.assign(n,e),n}},Hm=class t extends zy{constructor(n,e){super(n,e),this.kernel=null,t.verifyArgs(e),this.filters=e.filters,pn(this.filters,"filters"),this.kernelInitializer=Nt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=tn(e.kernelConstraint),this.kernelRegularizer=Ft(e.kernelRegularizer)}build(n){n=Je(n);let e=this.dataFormat==="channelsFirst"?1:n.length-1;if(n[e]==null)throw new $(`The channel dimension of the input should be defined. Found ${n[e]}`);let r=n[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(n,e){return j(()=>{n=Ve(n);let r,o=this.bias==null?null:this.bias.read(),i=Vw(this.activation.getClassName());if(i!=null&&this.rank===2)r=AU(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=Gfe(n,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=AU(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=Wfe(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ae("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(n){n=Je(n);let e=[],r=this.dataFormat==="channelsLast"?n.slice(1,n.length-1):n.slice(2);for(let i=0;i<r.length;++i){let s=Xr(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[n[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let n={filters:this.filters,kernelInitializer:Vt(this.kernelInitializer),kernelRegularizer:Et(this.kernelRegularizer),kernelConstraint:en(this.kernelConstraint)},e=super.getConfig();return Object.assign(n,e),n}static verifyArgs(n){if(!("filters"in n)||typeof n.filters!="number"||n.filters<1)throw new $(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(n.filters)}`)}},Tk=(()=>{class t extends Hm{constructor(e){super(2,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!$w(e.kernelSize,"number",1,2))throw new $(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv2D",t})();Q.registerClass(Tk);var Dk=(()=>{class t extends Hm{constructor(e){super(3,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new $(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv3D",t})();Q.registerClass(Dk);var RU=(()=>{class t extends Tk{constructor(e){if(super(e),this.inputSpec=[new Mt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new $(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Je(e),e.length!==4)throw new $("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new $("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Mt({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return j(()=>{let o=Ve(e);if(o.shape.length!==4)throw new $(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let c=i[a],u=i[l],d=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],m=this.strides[1],h=Ki(c,f,d,this.padding),g=Ki(u,m,p,this.padding),x=[s,h,g,this.filters];this.dataFormat!=="channelsLast"&&(o=st(o,[0,2,3,1]));let b=my(o,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=st(b,[0,3,1,2])),this.bias!=null&&(b=Mr(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=Je(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return r[o]=this.filters,r[i]=Ki(r[i],c,a,this.padding),r[s]=Ki(r[s],u,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv2DTranspose",t})();Q.registerClass(RU);var MU=(()=>{class t extends Dk{constructor(e){if(super(e),this.inputSpec=[new Mt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new $(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Je(e),e.length!==5)throw new $("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new $("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Mt({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return j(()=>{let o=Ve(e);if(o.shape.length!==5)throw new $(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,c;this.dataFormat==="channelsFirst"?(c=2,a=3,l=4):(c=1,a=2,l=3);let u=i[c],d=i[a],p=i[l],f=this.kernelSize[0],m=this.kernelSize[1],h=this.kernelSize[2],g=this.strides[0],x=this.strides[1],b=this.strides[2],I=Ki(u,g,f,this.padding),_=Ki(d,x,m,this.padding),E=Ki(p,b,h,this.padding),S=[s,I,_,E,this.filters];this.dataFormat!=="channelsLast"&&(o=st(o,[0,2,3,4,1]));let D=sN(o,this.kernel.read(),S,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=st(D,[0,4,1,2,3])),this.bias!==null&&(D=Mr(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=Je(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],f=this.strides[2];return r[o]=this.filters,r[i]=Ki(r[i],d,l,this.padding),r[s]=Ki(r[s],p,c,this.padding),r[a]=Ki(r[a],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv3DTranspose",t})();Q.registerClass(MU);var Hfe=(()=>{class t extends Hm{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new $("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new $("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new $(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=Nt(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Ft(r.depthwiseRegularizer),this.depthwiseConstraint=tn(r.depthwiseConstraint),this.pointwiseInitializer=Nt(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Ft(r.pointwiseRegularizer),this.pointwiseConstraint=tn(r.pointwiseConstraint)}build(e){if(e=Je(e),e.length<this.rank+2)throw new $(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new $(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Mt({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return j(()=>{e=Ve(e);let o;if(this.rank===1)throw new Ae("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=st(e,[0,2,3,1])),o=Cy(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=Mr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=st(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Vt(this.depthwiseInitializer),e.pointwiseInitializer=Vt(this.pointwiseInitializer),e.depthwiseRegularizer=Et(this.depthwiseRegularizer),e.pointwiseRegularizer=Et(this.pointwiseRegularizer),e.depthwiseConstraint=en(this.depthwiseConstraint),e.pointwiseConstraint=en(this.pointwiseConstraint),e}}return t.className="SeparableConv",t})(),FU=(()=>{class t extends Hfe{constructor(e){super(2,e)}}return t.className="SeparableConv2D",t})();Q.registerClass(FU);var OU=(()=>{class t extends Hm{constructor(e){super(1,e),t.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!$w(e.kernelSize,"number",1,1))throw new $(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv1D",t})();Q.registerClass(OU);var PU=(()=>{class t extends je{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return j(()=>{if(e=Ve(e),this.dataFormat==="channelsLast"){let o=My(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return My(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=My(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return My(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Cropping2D",t})();Q.registerClass(PU);var LU=(()=>{class t extends je{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Kt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,R4(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return j(()=>{let o=Ve(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=st(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a]);return st(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="UpSampling2D",t})();Q.registerClass(LU);function qfe(t,n,e=[1,1],r="valid",o,i){return j(()=>{o==null&&(o=kr()),Kt(o);let s=Uy(t,o);if(t.rank!==4)throw new $(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(n.rank!==4)throw new $(`depthwiseKernel is required to be 4-D, but is instead ${n.rank}-D`);return s=al(s,n,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=st(s,[0,3,1,2])),s})}var $U=(()=>{class t extends zy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=Nt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=tn(e.depthwiseConstraint),this.depthwiseRegularizer=Ft(e.depthwiseRegularizer)}build(e){if(e=Je(e),e.length<4)throw new $(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new $(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return j(()=>{e=Ve(e);let o=qfe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=Mr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=Je(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=Xr(r,this.kernelSize[0],this.padding,this.strides[0]),a=Xr(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Vt(this.depthwiseInitializer),e.depthwiseRegularizer=Et(this.depthwiseRegularizer),e.depthwiseConstraint=en(this.depthwiseRegularizer),e}}return t.className="DepthwiseConv2D",t})();Q.registerClass($U);function Nk(t,n,e,r){if(Array.isArray(t)){if(n!=null||e!=null)throw new $("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(n=t.slice(1,t.length)),t=t[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return n=o(n),e=o(e),{inputs:t,initialState:n,constants:e}}function kk(t,n,e,r=!1,o,i,s=!1,a=!1){return j(()=>{let l=n.shape.length;if(l<3)throw new $(`Input should be at least 3D, but is ${l}D.`);let c=[1,0].concat(wr(2,l));if(n=st(n,c),i!=null)throw new Ae("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=o.asType("bool").asType("float32"),o.rank===l-1&&(o=nr(o,-1)),o=st(o,c)),r&&(n=Po(n,0),o!=null&&(o=Po(o,0)));let u=[],d,p=e,f=n.shape[0],m=qr(n),h;o!=null&&(h=qr(o));for(let x=0;x<f;++x){let b=m[x],I=j(()=>t(b,p));if(o==null)d=I[0],p=I[1];else{let _=j(()=>{let E=h[x],S=Vn(E).sub(E),D=I[0].mul(E).add(p[0].mul(S)),M=p.map((R,L)=>I[1][L].mul(E).add(R.mul(S)));return{output:D,newStates:M}});d=_.output,p=_.newStates}a&&u.push(d)}let g;return a&&(g=rr(u,1)),[d,g,p]})}var cu=(()=>{class t extends je{constructor(e){super(e);let r;if(e.cell==null)throw new $("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new Mk({cells:e.cell}):r=e.cell,r.stateSize==null)throw new $("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Mt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return wr(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){Xw(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return j(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ae("Constants support is not implemented in RNN yet.");Xw(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Mt({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!w.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new $(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new Mt({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){j(()=>{if(!this.stateful)throw new Lo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new $("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Gt([o,i])):this.states_=[Gt([o,this.cell.stateSize])];else if(e==null)Pe(this.states_),this.keptStates!=null&&(Pe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Gt([o,i])):this.states_[0]=Gt([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new $(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Pe(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!w.arraysEqual(s.shape,l))throw new $(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>$n(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=Nk(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new Mt({shape:u.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof Cr){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return j(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=Ve(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new $(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},u=kk((h,g)=>{let x=this.cell.call([h].concat(g),l);return[x[0],x.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),d=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,i);let m=this.returnSequences?p:d;return this.returnState?[m].concat(f):m})}getInitialState(e){return j(()=>{let r=Gt(e.shape);return r=Ce(r,[1,2]),r=ml(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?jw(r,[1,o]):r):this.cell.stateSize>1?[jw(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===t.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign({},o,e,r)}static fromConfig(e,r,o={}){let i=r.cell,s=Kr(i,o);return new e(Object.assign(r,{cell:s}))}}return t.className="RNN",t})();Q.registerClass(cu);var lu=class extends je{},Ak=(()=>{class t extends lu{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,pn(this.units,"units"),this.activation=qi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Nt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Nt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Nt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ft(e.kernelRegularizer),this.recurrentRegularizer=Ft(e.recurrentRegularizer),this.biasRegularizer=Ft(e.biasRegularizer),this.kernelConstraint=tn(e.kernelConstraint),this.recurrentConstraint=tn(e.recurrentConstraint),this.biasConstraint=tn(e.biasConstraint),this.dropout=Yd([1,Wi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yd([1,Wi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Je(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return j(()=>{if(e=e,e.length!==2)throw new $(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vl({ones:()=>Vn(e),rate:this.dropout,training:i})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vl({ones:()=>Vn(o),rate:this.recurrentDropout,training:i}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=fi(V(e,a),this.kernel.read()):s=fi(e,this.kernel.read()),this.bias!=null&&(s=Mr(s,this.bias.read())),l!=null&&(o=V(o,l));let c=re(s,fi(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Hi(this.activation),useBias:this.useBias,kernelInitializer:Vt(this.kernelInitializer),recurrentInitializer:Vt(this.recurrentInitializer),biasInitializer:Vt(this.biasInitializer),kernelRegularizer:Et(this.kernelRegularizer),recurrentRegularizer:Et(this.recurrentRegularizer),biasRegularizer:Et(this.biasRegularizer),activityRegularizer:Et(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),recurrentConstraint:en(this.recurrentConstraint),biasConstraint:en(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,r)}}return t.className="SimpleRNNCell",t})();Q.registerClass(Ak);var VU=(()=>{class t extends cu{constructor(e){e.cell=new Ak(e),super(e)}call(e,r){return j(()=>{this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return t.className="SimpleRNN",t})();Q.registerClass(VU);var Rk=(()=>{class t extends lu{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new $("GRUCell does not support reset_after parameter set to true.");this.units=e.units,pn(this.units,"units"),this.activation=qi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Nt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Nt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Nt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Ft(e.kernelRegularizer),this.recurrentRegularizer=Ft(e.recurrentRegularizer),this.biasRegularizer=Ft(e.biasRegularizer),this.kernelConstraint=tn(e.kernelConstraint),this.recurrentConstraint=tn(e.recurrentConstraint),this.biasConstraint=tn(e.biasConstraint),this.dropout=Yd([1,Wi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yd([1,Wi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Je(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return j(()=>{if(e=e,e.length!==2)throw new $(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vl({ones:()=>Vn(e),rate:this.dropout,training:o,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vl({ones:()=>Vn(i),rate:this.recurrentDropout,training:o,count:3}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,c,u;0<this.dropout&&this.dropout<1&&(e=V(e,s[0]));let d=fi(e,this.kernel.read());this.useBias&&(d=Mr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,a[0]));let p=this.recurrentKernel.read(),[f,m]=Xn(p,[2*this.units,this.units],p.rank-1),h=fi(i,f),[g,x,b]=Xn(d,3,d.rank-1),[I,_]=Xn(h,2,h.rank-1);l=this.recurrentActivation.apply(re(g,I)),c=this.recurrentActivation.apply(re(x,_));let E=fi(V(c,i),m);u=this.activation.apply(re(b,E));let S=re(V(l,i),V(re(1,Ct(l)),u));return[S,S]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Hi(this.activation),recurrentActivation:Hi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Vt(this.kernelInitializer),recurrentInitializer:Vt(this.recurrentInitializer),biasInitializer:Vt(this.biasInitializer),kernelRegularizer:Et(this.kernelRegularizer),recurrentRegularizer:Et(this.recurrentRegularizer),biasRegularizer:Et(this.biasRegularizer),activityRegularizer:Et(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),recurrentConstraint:en(this.recurrentConstraint),biasConstraint:en(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,r)}}return t.className="GRUCell",t})();Q.registerClass(Rk);var BU=(()=>{class t extends cu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Rk(e),super(e)}call(e,r){return j(()=>{this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="GRU",t})();Q.registerClass(BU);var jy=(()=>{class t extends lu{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,pn(this.units,"units"),this.activation=qi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=qi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=Nt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=Nt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=Nt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Ft(e.kernelRegularizer),this.recurrentRegularizer=Ft(e.recurrentRegularizer),this.biasRegularizer=Ft(e.biasRegularizer),this.kernelConstraint=tn(e.kernelConstraint),this.recurrentConstraint=tn(e.recurrentConstraint),this.biasConstraint=tn(e.biasConstraint),this.dropout=Yd([1,Wi([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Yd([1,Wi([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Je(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends Or{apply(c,u){let d=s.apply([a]),p=new Hw().apply([a]),f=s.apply([a*2]);return ok(ok(d,p),f)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return j(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new $(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vl({ones:()=>Vn(e),rate:this.dropout,training:o,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vl({ones:()=>Vn(i),rate:this.recurrentDropout,training:o,count:4}));let a=this.dropoutMask,l=this.recurrentDropoutMask,c,u,d,p;0<this.dropout&&this.dropout<1&&(e=V(e,a[0]));let f=fi(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,l[0])),f=re(f,fi(i,this.recurrentKernel.read())),this.useBias&&(f=Mr(f,this.bias.read()));let[m,h,g,x]=Xn(f,4,f.rank-1);c=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(h),d=re(V(u,s),V(c,this.activation.apply(g))),p=this.recurrentActivation.apply(x);let b=V(p,this.activation.apply(d));return[b,b,d]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Hi(this.activation),recurrentActivation:Hi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Vt(this.kernelInitializer),recurrentInitializer:Vt(this.recurrentInitializer),biasInitializer:Vt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:Et(this.kernelRegularizer),recurrentRegularizer:Et(this.recurrentRegularizer),biasRegularizer:Et(this.biasRegularizer),activityRegularizer:Et(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),recurrentConstraint:en(this.recurrentConstraint),biasConstraint:en(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,r)}}return t.className="LSTMCell",t})();Q.registerClass(jy);var zU=(()=>{class t extends cu{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new jy(e),super(e)}call(e,r){return j(()=>{this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="LSTM",t})();Q.registerClass(zU);var Mk=(()=>{class t extends lu{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return j(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let c=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){Xw(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{Gi(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign({},e,i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push(Kr(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return Oy(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}Bm(r)}}return t.className="StackedRNNCells",t})();Q.registerClass(Mk);function vl(t){let{ones:n,rate:e,training:r=!1,count:o=1}=t,i=()=>Ww(n(),e),s=()=>ru(i,n,r);return!o||o<=1?$n(s().clone()):Array(o).fill(void 0).map(s).map(l=>$n(l.clone()))}var Kfe=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e};var Xfe=(()=>{class t extends cu{constructor(e){if(e.unroll)throw new Ae("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ae("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Mt({ndim:5})]}call(e,r){return j(()=>{if(this.cell.dropoutMask!=null&&(Pe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Pe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new $("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return j(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=Gt(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){j(()=>{if(!this.stateful)throw new Lo("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new $("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Gt(s)):this.states_=[Gt(s)];else if(e==null)Pe(this.states_),this.keptStates!=null&&(Pe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Gt(s)):this.states_[0]=Gt(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new $(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Pe(this.states_);for(let l=0;l<this.states_.length;++l){let c=e[l],u=s;if(!w.arraysEqual(c.shape,u))throw new $(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>$n(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,c=r==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=Xr(u,i[0],s,a[0],l[0]),f=Xr(d,i[1],s,a[1],l[1]);return[...e.slice(0,2),...c?[o,p,f]:[p,f,o]]}}return t.className="ConvRNN2D",t})(),Fk=(()=>{class t extends jy{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign({},e,{units:r})),this.filters=r,pn(this.filters,"filters"),this.kernelSize=au(o,2,"kernelSize"),this.kernelSize.forEach(c=>pn(c,"kernelSize")),this.strides=au(i||1,2,"strides"),this.strides.forEach(c=>pn(c,"strides")),this.padding=s||"valid",Rr(this.padding),this.dataFormat=a||"channelsLast",Kt(this.dataFormat),this.dilationRate=au(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>pn(c,"dilationRate"))}build(e){var r;e=Je(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new $(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;c=new(r=class extends Or{apply(f,m){let h=u.apply([d]),g=yo([d]),x=u.apply([d*2]);return Pm([h,g,x])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return j(()=>{if(e.length!==3)throw new $(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=vl({ones:()=>Vn(i),rate:this.dropout,training:o,count:l}));let c=this.dropoutMask,u=(de,ge,pe)=>!ge||!ge[pe]?de:V(ge[pe],de),d=u(i,c,0),p=u(i,c,1),f=u(i,c,2),m=u(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=vl({ones:()=>Vn(s),rate:this.recurrentDropout,training:o,count:l}));let h=this.recurrentDropoutMask,g=u(s,h,0),x=u(s,h,1),b=u(s,h,2),I=u(s,h,3),_=3,[E,S,D,M]=Xn(this.kernel.read(),l,_),[R,L,G,W]=this.useBias?Xn(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,E,R,this.padding),p=this.inputConv(p,S,L,this.padding),f=this.inputConv(f,D,G,this.padding),m=this.inputConv(m,M,W,this.padding);let[q,X,K,Z]=Xn(this.recurrentKernel.read(),l,_);g=this.recurrentConv(g,q),x=this.recurrentConv(x,X),b=this.recurrentConv(b,K),I=this.recurrentConv(I,Z);let se=this.recurrentActivation.apply(re(d,g)),ee=this.recurrentActivation.apply(re(p,x)),oe=re(V(ee,a),V(se,this.activation.apply(re(f,b)))),le=V(this.recurrentActivation.apply(re(m,I)),this.activation.apply(oe));return[le,le,oe]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=Kfe(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},o,i)}inputConv(e,r,o,i){let s=ho(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?Mr(s,o,this.dataFormat):s}recurrentConv(e,r){return ho(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return t.className="ConvLSTM2DCell",t})();Q.registerClass(Fk);var UU=(()=>{class t extends Xfe{constructor(e){let r=new Fk(e);super(Object.assign({},e,{cell:r}))}static fromConfig(e,r){return new e(r)}}return t.className="ConvLSTM2D",t})();Q.registerClass(UU);var Ok=(()=>{class t extends je{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return ru(()=>Ww(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return t.className="Dropout",t})();Q.registerClass(Ok);var jU=(()=>{class t extends Ok{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return t.className="SpatialDropout1D",t})();Q.registerClass(jU);var GU=(()=>{class t extends je{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,pn(this.units,"units"),this.activation=qi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=Nt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=Nt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=tn(e.kernelConstraint),this.biasConstraint=tn(e.biasConstraint),this.kernelRegularizer=Ft(e.kernelRegularizer),this.biasRegularizer=Ft(e.biasRegularizer),this.activityRegularizer=Ft(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Je(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Je(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e),i=Vw(this.activation.getClassName()),s;return i!=null?s=fi(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=fi(o,this.kernel.read()),this.bias!=null&&(s=Mr(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Hi(this.activation),useBias:this.useBias,kernelInitializer:Vt(this.kernelInitializer),biasInitializer:Vt(this.biasInitializer),kernelRegularizer:Et(this.kernelRegularizer),biasRegularizer:Et(this.biasRegularizer),activityRegularizer:Et(this.activityRegularizer),kernelConstraint:en(this.kernelConstraint),biasConstraint:en(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dense",t})();Q.registerClass(GU);var WU=(()=>{class t extends je{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Je(e);for(let r of e.slice(1))if(r==null)throw new $(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],pi(e,1)]}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=o.transpose(i)}return $4(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return t.className="Flatten",t})();Q.registerClass(WU);var HU=(()=>{class t extends je{constructor(e){super(e),this.supportsMasking=!0,this.activation=qi(e.activation)}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return this.activation.apply(o)})}getConfig(){let e={activation:Hi(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Activation",t})();Q.registerClass(HU);var qU=(()=>{class t extends je{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return j(()=>(e=Ve(e),P4(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return t.className="RepeatVector",t})();Q.registerClass(qU);var KU=(()=>{class t extends je{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let c=0;c<i.length;++c){let u=i[c];if(this.isUnknown(u))if(a===null)a=c;else throw new $("Can only specifiy one unknown dimension.");else s*=u}let l=pi(e);if(a!==null){if(s===0||l%s!==0)throw new $(o);i[a]=l/s}else if(l!==s)throw new $(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return o.reshape(s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Reshape",t})();Q.registerClass(KU);var XU=(()=>{class t extends je{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=wr(1,e.dims.length+1);if(!w.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Mt({ndim:this.dims.length+1})]}computeOutputShape(e){e=Je(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return st(Ve(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Permute",t})();Q.registerClass(XU);var YU=(()=>{class t extends je{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=Ve(e);return vm(tu(o,this.maskValue),-1)}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e),a=vm(tu(o,this.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})}}return t.className="Masking",t})();Q.registerClass(YU);var ZU=(()=>{class t extends je{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(Rt(e.inputLength))}this.inputDim=e.inputDim,pn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,pn(this.outputDim,"outputDim"),this.embeddingsInitializer=Nt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Ft(e.embeddingsRegularizer),this.activityRegularizer=Ft(e.activityRegularizer),this.embeddingsConstraint=tn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return j(()=>this.maskZero?(e=Ve(e),tu(e,De(e))):null)}computeOutputShape(e){if(e=Je(e),this.inputLength==null)return[...e,this.outputDim];let r=Rt(this.inputLength);if(r.length!==e.length-1)throw new $(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new $(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return o.dtype!=="int32"&&(o=fl(o,"int32")),Gw(this.embeddings.read(),o.as1D()).reshape(Je(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Vt(this.embeddingsInitializer),embeddingsRegularizer:Et(this.embeddingsRegularizer),activityRegularizer:Et(this.activityRegularizer),embeddingsConstraint:en(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Embedding",t})();Q.registerClass(ZU);var xl=class extends je{constructor(n){super(n||{}),this.supportsMasking=!0}mergeFunction(n){throw new Ae}computeElementwiseOpOutputShape(n,e){if(n==null||e==null)return null;if(n.length<e.length)return this.computeElementwiseOpOutputShape(e,n);if(e.length===0)return n;let r=n.slice(0,n.length-e.length);for(let o=0;o<e.length;++o){let i=n[n.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new $("Operands could not be broadcast together with shapes "+JSON.stringify(n)+" "+JSON.stringify(e));r.push(i)}}return r}build(n){if(Array.isArray(n)&&!Array.isArray(n[0])&&(n=[Je(n)]),n=n,n.length<2)throw new $(`A merge layer should be called on an Array of at least 2 inputs. Got ${n.length} input(s).`);let e=[];for(let i of n)i!=null&&i[0]!==null&&e.push(i[0]);if(e=di(e),e.length>1)throw new $(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(n)}.`);let r=n[0]==null?null:n[0].slice(1);for(let i=1;i<n.length;++i){let s=n[i]==null?null:n[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=n.map(i=>i.length);n.indexOf(null)===-1&&di(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(n,e){return j(()=>{if(n=n,this.reshapeRequired){let r=[],o=n.map(i=>i.rank);if(o.indexOf(null)===-1){let i=Wi(o);for(let s of n){let a=s.rank;for(let l=0;l<i-a;++l)s=ml(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of n){let c=l.rank;if(c==null){let u=l.shape,d=u[0],p=u.slice(1).concat([d]),f=l.reshape([d].concat(pi(u.slice(1))));f=st(f,[1,0]),f=f.reshape(p),r.push(f),i=!0}else if(c>1){let u=wr(1,c).concat([0]);r.push(st(l,u)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=st(s.reshape([-1,u]),[1,0]).reshape(d)}else if(a>1){let l=[a-1].concat(wr(0,a-1));s=st(s,l)}}return s}}else return this.mergeFunction(n)})}computeOutputShape(n){n=n;let e;n[0]==null?e=null:e=n[0].slice(1);for(let o=1;o<n.length;++o){let i=n[o]==null?null:n[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of n)o!=null&&o[0]!==null&&r.push(o[0]);return r=di(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(n,e){return j(()=>{if(e==null)return null;if(!Array.isArray(e))throw new $("`mask` should be an Array");if(!Array.isArray(n))throw new $("`inputs` should be an Array");if(e.length!==n.length)throw new $(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${n.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:nr(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=br(r,e[o]);return r})}},QU=(()=>{class t extends xl{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=re(r,e[o]);return r})}}return t.className="Add",t})();Q.registerClass(QU);var JU=(()=>{class t extends xl{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=V(r,e[o]);return r})}}return t.className="Multiply",t})();Q.registerClass(JU);var ej=(()=>{class t extends xl{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=re(r,e[o]);return V(1/e.length,r)})}}return t.className="Average",t})();Q.registerClass(ej);var tj=(()=>{class t extends xl{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=go(r,e[o]);return r})}}return t.className="Maximum",t})();Q.registerClass(tj);var nj=(()=>{class t extends xl{constructor(e){super(e)}mergeFunction(e){return j(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=Ld(r,e[o]);return r})}}return t.className="Minimum",t})();Q.registerClass(nj);var rj=(()=>{class t extends xl{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new $("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(w.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new $("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return j(()=>Pm(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new $("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new $("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new $("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new $(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return j(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(Vn(e[a]).asType("bool")):r[a].rank<e[a].rank?i.push(nr(r[a],-1)):i.push(r[a]);let s=jt(i,this.axis);return py(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Concatenate",t})();Q.registerClass(rj);function Gy(t,n){for(;t<0;)t+=n;return t}function Yfe(t,n,e){if(t.shape.length>3||n.shape.length>3)throw new Ae("batchDot is not implemented for tensors of 4D or higher rank yet");if(w.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),w.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${n.shape.length}`),typeof e=="number"&&(e=[e,e]),t.dtype==="complex64"||n.dtype==="complex64")throw new Ae("batchDot is not implemented for complex64-type Tensors yet.");let r=t.shape.length,o=n.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return j(()=>{let s;if(r>o){s=r-o;let l=[];for(let c=0;c<s;++c)l.push(1);n=n.reshape(n.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let c=0;c<s;++c)l.push(1);t=t.reshape(t.shape.concat(l))}else s=0;let a;if(t.shape.length===2&&n.shape.length===2)i[0]===i[1]?a=t.mul(n).sum(i[0]):a=t.transpose([1,0]).mul(n).sum(i[1]);else{let l=i[0]!==t.shape.length-1,c=i[1]===n.shape.length-1;a=t.matMul(n,l,c)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let c=[];for(let u=l;u<l+s;++u)c.push(u);a=a.squeeze(c)}return a.shape.length===1&&(a=a.expandDims(1)),a})}var oj=(()=>{class t extends xl{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new Ae("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new $(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new $(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>Gy(s,e[a].shape.length)):i=[Gy(this.axes,r.shape.length),Gy(this.axes,o.shape.length)],this.normalize&&(r=Py(r,i[0]),o=Py(o,i[1])),Yfe(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[Gy(this.axes,e.length),Gy(this.axes,r.length)],o}computeOutputShape(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new Ae("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dot",t})();Q.registerClass(oj);var ij=(()=>{class t extends je{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return ru(()=>Lm(o.shape,0,this.stddev).add(o),()=>o,r.training||!1)})}}return t.className="GaussianNoise",t})();Q.registerClass(ij);var sj=(()=>{class t extends je{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return j(()=>{this.invokeCallHook(e,r);let o=Ve(e);return this.rate>0&&this.rate<1?ru(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return o.mul(Lm(o.shape,1,s))},()=>o,r.training||!1):o})}}return t.className="GaussianDropout",t})();Q.registerClass(sj);var aj=(()=>{class t extends je{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Ve(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return j(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return ru(()=>{let s=Ve(e),c=-1.6732632423543772*1.0507009873554805,u=Fo(ul(o),this.rate);u=fl(u,"float32");let d=((1-this.rate)*(1+this.rate*c**2))**-.5,p=-d*c*this.rate;return s.mul(u).add(u.add(-1).mul(c)).mul(d).add(p)},()=>Ve(e),r.training||!1)}return e})}}return t.className="AlphaDropout",t})();Q.registerClass(aj);function Wy(t,n,e,r,o,i=.001){let s;if(t.rank===2)s=ZD(t,n,e,r,o,i);else if(t.rank===3)s=QD(t,n,e,r,o,i);else if(t.rank===4)s=JD(t,n,e,r,o,i);else throw new Ae(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return s}function Zfe(t,n,e,r,o=.001){return j(()=>{let i=Tm(t,r),s=i.mean,a=i.variance;return[Wy(t,s,a,e,n,o),s,a]})}function Qfe(t,n,e,r,o=.001){return j(()=>{let i=Tm(t,r),s=i.mean,a=i.variance,l=[];for(let m of wr(0,t.rank))r.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let c=s.reshape(l),u=a.reshape(l),d=n==null?null:n.reshape(l),p=e==null?null:e.reshape(l);return[Wy(t,c,u,p,d,o),s,a]})}function Jfe(t,n,e,r,o=.001){return w.arraysEqual(r.slice().sort(),wr(0,t.rank-1))?Zfe(t,n,e,r,o):Qfe(t,n,e,r,o)}var lj=(()=>{class t extends je{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Nt(e.betaInitializer||"zeros"),this.gammaInitializer=Nt(e.gammaInitializer||"ones"),this.movingMeanInitializer=Nt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=Nt(e.movingVarianceInitializer||"ones"),this.betaConstraint=tn(e.betaConstraint),this.gammaConstraint=tn(e.gammaConstraint),this.betaRegularizer=Ft(e.betaRegularizer),this.gammaRegularizer=Ft(e.gammaRegularizer)}build(e){e=Je(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new $(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Mt({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return j(()=>{let o=r.training==null?!1:r.training,i=Ve(e),s=i.shape,a=s.length,l=wr(0,a),c=this.axis>=0?this.axis:this.axis+a;l.splice(c,1);let u=ci(1,a);u[c]=s[c];let d=l.slice();d.sort();let p=!w.arraysEqual(d,wr(0,a).slice(0,a-1)),f=()=>{if(p){let I=this.movingMean.read().reshape(u),_=this.movingVariance.read().reshape(u),E=this.center?this.beta.read().reshape(u):null,S=this.scale?this.gamma.read().reshape(u):null;return Wy(i,I,_,E,S,this.epsilon)}else return Wy(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return f();let[m,h,g]=Jfe(i,this.gamma.read(),this.beta.read(),l,this.epsilon),x=(I,_,E)=>{j(()=>{let S=1-E,D=I.read(),M=D.sub(_).mul(S);I.write(D.sub(M))})};return(()=>{x(this.movingMean,h,this.momentum),x(this.movingVariance,g,this.momentum)})(),m})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Vt(this.betaInitializer),gammaInitializer:Vt(this.gammaInitializer),movingMeanInitializer:Vt(this.movingMeanInitializer),movingVarianceInitializer:Vt(this.movingVarianceInitializer),betaRegularizer:Et(this.betaRegularizer),gammaRegularizer:Et(this.gammaRegularizer),betaConstraint:en(this.betaConstraint),gammaConstraint:en(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BatchNormalization",t})();Q.registerClass(lj);var cj=(()=>{class t extends je{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=Nt(e.betaInitializer||"zeros"),this.gammaInitializer=Nt(e.gammaInitializer||"ones"),this.betaRegularizer=Ft(e.betaRegularizer),this.gammaRegularizer=Ft(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Je(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==di(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=Ve(e),i=o.shape,s=i.length;return j(()=>{let{mean:l,variance:c}=Tm(o,this.axis,!0),u=ci(1,s);for(let g of this.axis)u[g]=i[g];let d=g=>g!=null&&g.shape.length!==s&&this.axis!==[s-1]?g.reshape(u):g,p=d(this.gamma.read()),f=d(this.beta.read()),m=[],h=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(m.push(i[g]),h.push(1)):(m.push(1),h.push(i[g]));return l=l.tile(m),c=c.tile(m),p=p.tile(h),f=f.tile(h),Wy(o,l,c,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Vt(this.betaInitializer),gammaInitializer:Vt(this.gammaInitializer),betaRegularizer:Et(this.betaRegularizer),gammaRegularizer:Et(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LayerNormalization",t})();Q.registerClass(cj);function eme(t,n,e){return j(()=>{if(t.rank!==4)throw new $(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(n==null&&(n=[[1,1],[1,1]]),n.length!==2||n[0].length!==2||n[1].length!==2)throw new $("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=kr()),e!=="channelsLast"&&e!=="channelsFirst")throw new $(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],n[0],n[1]]:r=[[0,0],n[0],n[1],[0,0]],$d(t,r)})}var uj=(()=>{class t extends je{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?kr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new $(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new $(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new $(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new Mt({ndim:4})]}computeOutputShape(e){e=Je(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return j(()=>eme(Ve(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ZeroPadding2D",t})();Q.registerClass(uj);function CC(t,n,e,r,o,i){return j(()=>{Kt(o),tk(i),Rr(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=kr()),i==null&&(i="max"),t=Uy(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=Pd(t,n,e,a):s=Rd(t,n,e,a),o==="channelsFirst"&&(s=st(s,[0,3,1,2])),s})}function dj(t,n,e,r,o,i){return j(()=>{Kt(o),tk(i),Rr(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=kr()),i==null&&(i="max"),t=Sk(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=xN(t,n,e,a):s=YD(t,n,e,a),o==="channelsFirst"&&(s=st(s,[0,4,1,2,3])),s})}var yC=class extends je{constructor(n){if(n.poolSize==null&&(n.poolSize=2),super(n),typeof n.poolSize=="number")this.poolSize=[n.poolSize];else if(Array.isArray(n.poolSize)&&n.poolSize.length===1&&typeof n.poolSize[0]=="number")this.poolSize=n.poolSize;else throw new $(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.poolSize)}`);if(pn(this.poolSize,"poolSize"),n.strides==null)this.strides=this.poolSize;else if(typeof n.strides=="number")this.strides=[n.strides];else if(Array.isArray(n.strides)&&n.strides.length===1&&typeof n.strides[0]=="number")this.strides=n.strides;else throw new $(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.strides)}`);pn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,Rr(this.padding),this.inputSpec=[new Mt({ndim:3})]}computeOutputShape(n){n=Je(n);let e=Xr(n[1],this.poolSize[0],this.padding,this.strides[0]);return[n[0],e,n[2]]}call(n,e){return j(()=>{this.invokeCallHook(n,e),n=ml(Ve(n),2);let r=this.poolingFunction(Ve(n),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Ud(r,[2])})}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(n,e),n}},pj=(()=>{class t extends yC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Rr(i),CC(e,r,o,i,s,"max")}}return t.className="MaxPooling1D",t})();Q.registerClass(pj);var fj=(()=>{class t extends yC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Rr(i),CC(e,r,o,i,s,"avg")}}return t.className="AveragePooling1D",t})();Q.registerClass(fj);var vC=class extends je{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==2)throw new $(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides];pn(this.poolSize,"poolSize"),pn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Kt(this.dataFormat),Rr(this.padding),this.inputSpec=[new Mt({ndim:4})]}computeOutputShape(n){n=Je(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2];return e=Xr(e,this.poolSize[0],this.padding,this.strides[0]),r=Xr(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r]:[n[0],e,r,n[3]]}call(n,e){return j(()=>(this.invokeCallHook(n,e),this.poolingFunction(Ve(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},mj=(()=>{class t extends vC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Rr(i),CC(e,r,o,i,s,"max")}}return t.className="MaxPooling2D",t})();Q.registerClass(mj);var hj=(()=>{class t extends vC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Rr(i),CC(e,r,o,i,s,"avg")}}return t.className="AveragePooling2D",t})();Q.registerClass(hj);var xC=class extends je{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==3)throw new $(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides,n.strides];pn(this.poolSize,"poolSize"),pn(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Kt(this.dataFormat),Rr(this.padding),this.inputSpec=[new Mt({ndim:5})]}computeOutputShape(n){n=Je(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2],o=this.dataFormat==="channelsFirst"?n[4]:n[3];return e=Xr(e,this.poolSize[0],this.padding,this.strides[0]),r=Xr(r,this.poolSize[1],this.padding,this.strides[1]),o=Xr(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r,o]:[n[0],e,r,o,n[4]]}call(n,e){return j(()=>(this.invokeCallHook(n,e),this.poolingFunction(Ve(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},gj=(()=>{class t extends xC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Rr(i),dj(e,r,o,i,s,"max")}}return t.className="MaxPooling3D",t})();Q.registerClass(gj);var yj=(()=>{class t extends xC{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Kt(s),Rr(i),dj(e,r,o,i,s,"avg")}}return t.className="AveragePooling3D",t})();Q.registerClass(yj);var bC=class extends je{constructor(n){super(n),this.inputSpec=[new Mt({ndim:3})]}computeOutputShape(n){return[n[0],n[2]]}call(n,e){throw new Ae}},vj=(()=>{class t extends bC{constructor(e){super(e||{})}call(e,r){return j(()=>{let o=Ve(e);return qt(o,1)})}}return t.className="GlobalAveragePooling1D",t})();Q.registerClass(vj);var xj=(()=>{class t extends bC{constructor(e){super(e||{})}call(e,r){return j(()=>{let o=Ve(e);return Kn(o,1)})}}return t.className="GlobalMaxPooling1D",t})();Q.registerClass(xj);var wC=class extends je{constructor(n){super(n),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Kt(this.dataFormat),this.inputSpec=[new Mt({ndim:4})]}computeOutputShape(n){return n=n,this.dataFormat==="channelsLast"?[n[0],n[3]]:[n[0],n[1]]}call(n,e){throw new Ae}getConfig(){let n={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},bj=(()=>{class t extends wC{call(e,r){return j(()=>{let o=Ve(e);return this.dataFormat==="channelsLast"?qt(o,[1,2]):qt(o,[2,3])})}}return t.className="GlobalAveragePooling2D",t})();Q.registerClass(bj);var wj=(()=>{class t extends wC{call(e,r){return j(()=>{let o=Ve(e);return this.dataFormat==="channelsLast"?Kn(o,[1,2]):Kn(o,[2,3])})}}return t.className="GlobalMaxPooling2D",t})();Q.registerClass(wj);var _C=class extends je{constructor(n){super(n),this.layer=n.layer}build(n){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(n){this.layer!=null&&(this.layer.trainable=n)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(n){this.layer.setWeights(n)}getConfig(){let n={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(n,e),n}setFastWeightInitDuringBuild(n){super.setFastWeightInitDuringBuild(n),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(n)}static fromConfig(n,e,r={}){let o=e.layer,i=Kr(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new n(s)}},Cj=(()=>{class t extends _C{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Je(e),e.length<3)throw new $(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Je(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return j(()=>(e=Ve(e),kk((a,l)=>[Ve(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return t.className="TimeDistributed",t})();Q.registerClass(Cj);function tme(t){Ts(k4,"BidirectionalMergeMode",t)}var nme="concat",_j=(()=>{class t extends _C{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=Kr(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=Kr(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?nme:e.mergeMode,tme(this.mergeMode),e.weights)throw new Ae("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):Bn(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=Nk(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let u=o.length;if(u%2>0)throw new $("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let d=o.map(p=>new Mt({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(i!=null)throw new Ae("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof Cr;for(let u of a)if(u instanceof Cr!==c)throw new $("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return j(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),u=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=Po(s,1));let l;return this.mergeMode==="concat"?l=Pm([i,s]):this.mergeMode==="sum"?l=re(i,s):this.mergeMode==="ave"?l=V(.5,re(i,s)):this.mergeMode==="mul"?l=V(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Gi(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Gi(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=Kr(r.layer);if(delete r.layer,r.numConstants!=null)throw new Ae("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return t.className="Bidirectional",t})();Q.registerClass(_j);var Ij;(function(t){let n;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(Ij||(Ij={}));var ahe=mh(Uk());var ihe=mh(Uk());var kSt=Symbol("out"),ASt=Symbol("field"),RSt=Symbol("quote"),MSt=Symbol("quoteafterquote"),FSt=Symbol("quoteinquote");function J(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&w.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the CPU backend.`)})}var vhe=ir.whereImpl,Bj=(()=>{class t extends ua{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new cd(this,il())}nextDataId(){return t.nextDataId++}write(e,r,o){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&T.warn(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&w.isString(o[0])){let s=o.map(a=>w.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return T.mergeRealAndImagArrays(i,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>w.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(e.shape,e.dtype,o)}makeOutput(e,r,o){let i=this.write(e,r,o);return il().makeTensorFromDataId(i,r,o,this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=w.now();return e(),{kernelMs:w.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){J([e],"where");let r=this.readSync(e.dataId);return vhe(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return t.nextDataId=0,t})();var cA={};Qi(cA,{addImpl:()=>Wk,bincountImpl:()=>Xm,bincountReduceImpl:()=>SC,ceilImpl:()=>Hk,concatImpl:()=>TC,expImpl:()=>qk,expm1Impl:()=>Xk,floorImpl:()=>Yk,gatherV2Impl:()=>DC,greaterImpl:()=>Zk,lessImpl:()=>Qk,linSpaceImpl:()=>NC,logImpl:()=>Jk,maxImpl:()=>kC,maximumImpl:()=>eA,minimumImpl:()=>tA,multiplyImpl:()=>Hy,negImpl:()=>nA,notEqualImpl:()=>rA,prodImpl:()=>oA,rangeImpl:()=>AC,rsqrtImpl:()=>iA,simpleAbsImpl:()=>Gk,sliceImpl:()=>sA,sparseFillEmptyRowsImpl:()=>RC,sparseReshapeImpl:()=>MC,squaredDifferenceImpl:()=>aA,stridedSliceImpl:()=>FC,subImpl:()=>lA,tileImpl:()=>OC,topKImpl:()=>PC,transposeImpl:()=>Ym,uniqueImpl:()=>LC});function Gk(t){let n=new Float32Array(t.length);for(let e=0;e<t.length;++e)n[e]=Math.abs(t[e]);return n}var xhe=t=>{let{x:n}=t.inputs,e=t.backend;J(n,"abs");let r=new Float32Array(w.sizeFromShape(n.shape)),o=e.data.get(n.dataId).values;return r=Gk(o),e.makeOutput(r,n.shape,"float32")},zj={kernelName:nc,backendName:"cpu",kernelFunc:xhe};function rt(t){return(n,e,r,o,i)=>{let s=T.assertAndGetBroadcastShape(n,e),a=s.length,l=w.computeStrides(s),c=w.sizeFromShape(s),u=w.getTypedArrayFromDType(i,c),d=n.length,p=e.length,f=w.computeStrides(n),m=w.computeStrides(e),h=T.getBroadcastDims(n,s),g=T.getBroadcastDims(e,s);if(h.length+g.length===0)for(let x=0;x<u.length;++x)u[x]=t(r[x%r.length],o[x%o.length]);else for(let x=0;x<u.length;++x){let b=w.indexToLoc(x,a,l),I=b.slice(-d);h.forEach(D=>I[D]=0);let _=w.locToIndex(I,d,f),E=b.slice(-p);g.forEach(D=>E[D]=0);let S=w.locToIndex(E,p,m);u[x]=t(r[_],o[S])}return[u,s]}}function Nn(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var Uj={kernelName:Vf,backendName:"cpu",kernelFunc:Nn};function qm(t,n,e="float32"){if(e==="complex64"){let o=qm(t,n,"float32"),i=qm(t,n,"float32");return Nn({inputs:{real:o,imag:i},backend:t})}let r=w.makeZerosTypedArray(w.sizeFromShape(n),e);return t.makeTensorInfo(n,e,r)}function ar(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var jj={kernelName:vs,backendName:"cpu",kernelFunc:ar};function mi(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var Gj={kernelName:nm,backendName:"cpu",kernelFunc:mi};function hi(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return ar({inputs:{x:o},backend:e});let s=qm(e,o.shape,o.dtype),a=hi({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Nn({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=mi({inputs:{input:o},backend:e}),a=hi({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!w.hasEncodingLoss(o.dtype,i)){let s=ar({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32"){let s=e.data.get(o.dataId).values,a=Int32Array.from(s);return e.makeTensorInfo(o.shape,"int32",a)}if(i==="bool"){let s=e.data.get(o.dataId).values,a=w.toTypedArray([0],o.dtype),[l,c]=rt((u,d)=>u!==d?1:0)(o.shape,[],s,a,"bool");return e.makeTensorInfo(c,"bool",l)}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var Wj={kernelName:ys,backendName:"cpu",kernelFunc:hi};function mt(t,n,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;J([s,a],t);let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let c=hi({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,m=l.data.get(p.dataId).values,h=hi({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(h.dataId),x=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,I=l.data.get(x.dataId).values,_=l.data.get(b.dataId).values,[E,S,D]=e(s.shape,a.shape,f,m,I,_),M=l.makeTensorInfo(D,"float32",E),R=l.makeTensorInfo(D,"float32",S),L=Nn({inputs:{real:M,imag:R},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(M),l.disposeIntermediateTensorInfo(R),L}else{let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}}}function Km(t){return(n,e,r,o,i,s)=>{let a=T.assertAndGetBroadcastShape(n,e),l=w.sizeFromShape(a),c=a.length,u=w.computeStrides(a),d=w.getTypedArrayFromDType("float32",l),p=w.getTypedArrayFromDType("float32",l),f=T.getBroadcastDims(n,a),m=T.getBroadcastDims(e,a),h=T.mergeRealAndImagArrays(r,o),g=T.mergeRealAndImagArrays(i,s),x=n.length,b=w.computeStrides(n),I=e.length,_=w.computeStrides(e);if(f.length+m.length===0)for(let E=0;E<d.length;E++){let S=E%h.length,D=E%g.length,M=t(h[S*2],h[S*2+1],g[D*2],g[D*2+1]);d[E]=M.real,p[E]=M.imag}else for(let E=0;E<d.length;E++){let S=w.indexToLoc(E,c,u),D=S.slice(-x);f.forEach(W=>D[W]=0);let M=w.locToIndex(D,x,b),R=S.slice(-I);m.forEach(W=>R[W]=0);let L=w.locToIndex(R,I,_),G=t(h[M*2],h[M*2+1],g[L*2],g[L*2+1]);d[E]=G.real,p[E]=G.imag}return[d,p,a]}}var Wk=rt((t,n)=>t+n),bhe=Km((t,n,e,r)=>({real:t+e,imag:n+r})),bl=mt(Pi,Wk,bhe),Hj={kernelName:Pi,backendName:"cpu",kernelFunc:bl};function Xm(t,n,e,r,o){let i=w.sizeFromShape(r),s=w.makeZerosTypedArray(o,e);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=n[a]:s[l]+=1)}return s}function SC(t,n,e,r=!1){let o=t.shape[0],i=t.shape[1],s=Te([o,e],n.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?s.set(1,a,c):n.size>0?s.set(s.get(a,c)+n.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}function gi(t){return(n,e,r)=>{let o=w.getTypedArrayFromDType(e,n.length);for(let i=0;i<n.length;++i)o[i]=t(n[i],r);return o}}function Oe(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(J(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=w.sizeFromShape(s.shape),u=e||s.dtype,d=w.getArrayFromDType(u,c);for(let p=0;p<c;++p)d[p]=n(l[p],o);return a.makeTensorInfo(s.shape,u,d)}}function yi(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(J(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=e||s.dtype,u=n(l,c,o);return a.makeTensorInfo(s.shape,c,u)}}var Hk=gi(t=>Math.ceil(t)),whe=yi(va,Hk),qj={kernelName:va,backendName:"cpu",kernelFunc:whe};function TC(t,n,e,r){let o=w.getArrayFromDType(e,w.sizeFromShape(n));if(r&&e!=="string"){let i=0;t.forEach(s=>{let a=w.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;t.forEach(s=>{let a=e==="string"?T.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let c=0;c<s.shape[0];++c){let u=c*n[1]+i;for(let d=0;d<s.shape[1];++d)o[u+d]=a[l++]}i+=s.shape[1]})}return o}var qk=gi(t=>Math.exp(t)),Kk=yi(Ea,qk),Kj={kernelName:Ea,backendName:"cpu",kernelFunc:Kk};var Xk=gi(t=>Math.expm1(t)),Che=yi(Sa,Xk),Xj={kernelName:Sa,backendName:"cpu",kernelFunc:Che};var Yk=gi(t=>Math.floor(t)),_he=yi(Ta,Yk),Yj={kernelName:Ta,backendName:"cpu",kernelFunc:_he};function DC(t,n,e){let r=Te(e,t.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],c=n.locToIndex([a,l]);s[2]=n.values[c];let u=t.locToIndex(s);r.values[o]=t.values[u]}return r}var Zk=rt((t,n)=>t>n?1:0),Ihe=mt(fd,Zk,null,"bool"),Zj={kernelName:fd,backendName:"cpu",kernelFunc:Ihe};var Qk=rt((t,n)=>t<n?1:0),Ehe=mt(md,Qk,null,"bool"),Qj={kernelName:md,backendName:"cpu",kernelFunc:Ehe};function NC(t,n,e){let r=(n-t)/(e-1),o=w.makeZerosTypedArray(e,"float32");o[0]=t;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var Jk=gi(t=>Math.log(t)),She=yi(Ma,Jk),Jj={kernelName:Ma,backendName:"cpu",kernelFunc:She};function kC(t,n,e,r){let o=w.getTypedArrayFromDType(r,w.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*n,a=t[s];for(let l=0;l<n;++l){let c=t[s+l];c>a&&(a=c)}o[i]=a}return o}var eA=rt((t,n)=>Math.max(t,n)),The=mt(Oa,eA),eG={kernelName:Oa,backendName:"cpu",kernelFunc:The};var tA=rt((t,n)=>Math.min(t,n)),Dhe=mt(Pa,tA),tG={kernelName:Pa,backendName:"cpu",kernelFunc:Dhe};var Hy=rt((t,n)=>t*n),Nhe=Km((t,n,e,r)=>({real:t*e-n*r,imag:t*r+n*e})),rp=mt($a,Hy,Nhe),nG={kernelName:$a,backendName:"cpu",kernelFunc:rp};function nA(t,n,e){let r=w.createScalarValue(-1,e);return Hy([],n,r,t,e)}function khe(t){let{inputs:n,backend:e}=t,{x:r}=n;J(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=nA(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var rG={kernelName:Dc,backendName:"cpu",kernelFunc:khe};var rA=rt((t,n)=>t!==n?1:0),Ahe=mt(xd,rA,null,"bool"),oG={kernelName:xd,backendName:"cpu",kernelFunc:Ahe};function Ym(t,n,e,r,o){let i=n.length,s=w.sizeFromShape(n),a=w.computeStrides(n),l=w.computeStrides(o),c=w.getTypedArrayFromDType(e,w.sizeFromShape(o));for(let u=0;u<s;++u){let d=w.indexToLoc(u,i,a),p=new Array(d.length);for(let m=0;m<p.length;m++)p[m]=d[r[m]];let f=w.locToIndex(p,i,l);c[f]=t[u]}return c}function yn(t){let{inputs:n,attrs:e,backend:r}=t,{x:o}=n,{perm:i}=e;J(o,"transpose");let s=o.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=o.shape[i[d]];let l=r.data.get(o.dataId).values,c=Ym(l,o.shape,o.dtype,i,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var iG={kernelName:Gc,backendName:"cpu",kernelFunc:yn};function oA(t,n,e,r){let[o,i]=T.computeOutAndReduceShapes(t,r),s=Dn(n,"int32"),a=w.makeZerosTypedArray(w.sizeFromShape(o),s),l=w.sizeFromShape(i);for(let c=0;c<a.length;++c){let u=c*l,d=1;for(let p=0;p<l;++p)d*=e[u+p];a[c]=d}return{outVals:a,outShape:o,outDtype:s}}function Rhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"prod");let a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=T.getAxesPermutation(l,a),u=l,d=o,p=[];c!=null&&(d=yn({inputs:{x:o},backend:e,attrs:{perm:c}}),p.push(d),u=T.getInnerMostAxes(u.length,a));let f=e.data.get(d.dataId).values,{outVals:m,outShape:h,outDtype:g}=oA(d.shape,d.dtype,f,u),x=h;return s&&(x=T.expandShapeToKeepDim(h,l)),p.forEach(b=>e.disposeIntermediateTensorInfo(b)),e.makeTensorInfo(x,g,m)}var sG={kernelName:em,backendName:"cpu",kernelFunc:Rhe};function AC(t,n,e,r){let o=t===n,i=t<n&&e<0,s=n<t&&e>1;if(o||i||s)return w.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((n-t)/e)),l=w.makeZerosTypedArray(a,r);n<t&&e===1&&(e=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+e;return l}var iA=gi(t=>1/Math.sqrt(t)),Mhe=yi(Ga,iA),aG={kernelName:Ga,backendName:"cpu",kernelFunc:Mhe};function sA(t,n,e,r,o){let i=tr.isSliceContinous(r,n,e),s=w.sizeFromShape(e),a=w.computeStrides(r);if(i){let d=tr.computeFlatOffset(n,a);return o==="string"?t.slice(d,d+s):t.subarray(d,d+s)}let l=o==="string"?T.fromUint8ToStringArray(t):t,c=Te(r,o,l),u=Te(e,o);for(let d=0;d<u.size;++d){let p=u.indexToLoc(d),f=p.map((m,h)=>m+n[h]);u.set(c.get(...f),...p)}return o==="string"?T.fromStringArrayToUint8(u.values):u.values}function vi(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r;J(o,"slice");let[a,l]=tr.parseSliceParams(o,i,s);tr.assertParamsValid(o,a,l);let c=e.data.get(o.dataId).values,u=sA(c,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,u)}var lG={kernelName:Vc,backendName:"cpu",kernelFunc:vi};function RC(t,n,e,r,o,i,s){let a=n[0],l=i[0],c=new Array(l),u=new Array(a),d=n[1];if(l===0){if(a!==0)throw new Error(`Received SparseTensor with denseShape[0] = 0 but
         indices.shape[0] = ${a}`);let g=w.getArrayFromDType(e,0),x=w.getArrayFromDType(o,0);return[g,[0,d],x,c,u]}let p=!0,f=0,m=new Array(l).fill(0);for(let g=0;g<a;++g){let x=t[g*d];if(x<0)throw new Error(`indices(${g}, 0) is invalid: ${x} < 0`);if(x>=l)throw new Error(`indices(${g}, 0) is invalid: ${x} >= ${l}`);++m[x],p=p&&x>=f,f=x}let h=!0;for(let g=0;g<l;++g){let x=m[g]===0;c[g]=x,h=h&&!x,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(h&&p){let g=t,x=r;for(let b=0;b<a;++b)u[b]=b;return[g,[a,d],x,c,u]}else{let g=m[l-1],x=w.getArrayFromDType(e,g*d),b=w.getArrayFromDType(o,g),I=new Array(l).fill(0);for(let _=0;_<a;++_){let E=t[_*d],S=I[E],D=(E===0?0:m[E-1])+S;I[E]++;for(let M=0;M<d;++M)x[D*d+M]=t[_*d+M];b[D]=r[_],u[_]=D}for(let _=0;_<l;++_)if(I[_]===0){let S=_===0?0:m[_-1];x[S*d+0]=_;for(let D=1;D<d;++D)x[S*d+D]=0;b[S]=s}return[x,[a,d],b,c,u]}}function MC(t,n,e,r,o){let i=w.sizeFromShape(r),s=n[0],a=o.length,l=[],c=1,u=-1;for(let g=0;g<a;++g){let x=o[g];if(x===-1){if(u!==-1)throw new Error(`only one output dimension may be -1, not both ${u} and ${g}`);u=g,l.push(1)}else{if(x<0)throw new Error(`size ${g} must be non-negative, not ${x}`);c*=x,l.push(x)}}if(u!==-1){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");let g=Math.trunc(i/c);if(c*g!==i)throw new Error(`Input to reshape is a SparseTensor with ${i}
          dense values, but the requested shape requires a multiple of ${c}. inputShape=${r} outputShape= ${l}`);l[u]=g}let d=w.sizeFromShape(l);if(d!==i)throw new Error(`Input to reshape is a tensor with ${i} dense values, but the requested shape has ${d}. inputShape=${r} outputShape=${l}`);let p=r.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}let m=[];if(a>0){m[a-1]=1;for(let g=a-2;g>=0;--g)m[g]=m[g+1]*l[g+1]}let h=w.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let x=0;for(let b=0;b<p;++b)x+=t[g*p+b]*f[b];for(let b=0;b<a;++b)h[g*a+b]=Math.trunc(x/m[b]),x%=m[b]}return[h,[s,a],l]}var aA=rt((t,n)=>{let e=t-n;return e*e}),Fhe=mt(Qa,aA),cG={kernelName:Qa,backendName:"cpu",kernelFunc:Fhe};function FC(t,n,e,r){let o=Te(t,n.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(n.get(...a),...s)}return o}var lA=rt((t,n)=>t-n),Ohe=Km((t,n,e,r)=>({real:t-e,imag:n-r})),qy=mt(Ja,lA,Ohe),uG={kernelName:Ja,backendName:"cpu",kernelFunc:qy};function OC(t,n){let e=new Array(t.rank);for(let o=0;o<e.length;o++)e[o]=t.shape[o]*n[o];let r=Te(e,t.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(t.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%t.shape[l];let a=t.locToIndex(s);r.values[o]=t.values[a]}return r}function PC(t,n,e,r,o){let i=n[n.length-1],[s,a]=[t.length/i,i],l=w.getTypedArrayFromDType(e,s*r),c=w.getTypedArrayFromDType("int32",s*r);for(let d=0;d<s;d++){let p=d*a,f=t.subarray(p,p+a),m=[];for(let b=0;b<f.length;b++)m.push({value:f[b],index:b});m.sort((b,I)=>I.value-b.value);let h=d*r,g=l.subarray(h,h+r),x=c.subarray(h,h+r);for(let b=0;b<r;b++)g[b]=m[b].value,x[b]=m[b].index}let u=n.slice();return u[u.length-1]=r,[Te(u,e,l),Te(u,"int32",c)]}function LC(t,n,e,r){let o=w.parseAxisParam(n,e)[0],i=[1,e[0],1];for(let m=0;m<o;m++)i[0]*=e[m];i[1]=e[o];for(let m=o+1;m<e.length;m++)i[2]*=e[m];let s={},a=new Int32Array(e[o]),l=new At(i,r,t),c=[],u=i[0]===1&&i[2]===1;for(let m=0;m<e[o];m++){let h;if(u)h=t[m].toString();else{let g=[];for(let x=0;x<i[0];x++)for(let b=0;b<i[2];b++)g.push(l.get(x,m,b));h=g.join(",")}if(s[h]!==void 0)a[m]=s[h];else{let g=Object.keys(s).length;s[h]=g,a[m]=g,c.push(m)}}let d=i.slice();d[1]=Object.keys(s).length;let p=new At(d,r);c.forEach((m,h)=>{for(let g=0;g<i[0];g++)for(let x=0;x<i[2];x++)p.set(l.get(g,m,x),g,h,x)});let f=e.slice();return f[o]=d[1],{outputValues:p.values,outputShape:f,indices:a}}yw("cpu",()=>new Bj,1);var uA=Oe(_a,t=>t>=0?t:Math.exp(t)-1),dG={kernelName:_a,backendName:"cpu",kernelFunc:uA};function dA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r;J([o],"leakyRelu");let s=w.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=w.getTypedArrayFromDType("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",l)}var pG={kernelName:bc,backendName:"cpu",kernelFunc:dA};var Phe=rt((t,n)=>t<0?n*t:t);function pA(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n;J([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=Phe(r.shape,o.shape,i,s,r.dtype);return e.makeTensorInfo(l,r.dtype,a)}var fG={kernelName:Mc,backendName:"cpu",kernelFunc:pA};var fA=Oe(za,t=>Math.max(0,t)),mG={kernelName:za,backendName:"cpu",kernelFunc:fA};var mA=Oe(Ua,t=>Math.min(Math.max(0,t),6)),hG={kernelName:Ua,backendName:"cpu",kernelFunc:mA};var hA=Oe(Xa,t=>1/(1+Math.exp(-t))),gG={kernelName:Xa,backendName:"cpu",kernelFunc:hA};function Zm(t,n,e,r,o){if(e==="linear")return ar({inputs:{x:n},backend:t});if(e==="relu")return fA({inputs:{x:n},backend:t});if(e==="elu")return uA({inputs:{x:n},backend:t});if(e==="relu6")return mA({inputs:{x:n},backend:t});if(e==="prelu")return pA({inputs:{x:n,alpha:r},backend:t});if(e==="leakyrelu")return dA({inputs:{x:n},backend:t,attrs:{alpha:o}});if(e==="sigmoid")return hA({inputs:{x:n},backend:t});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function ot(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=w.sizeFromShape(o.shape),a=w.inferFromImplicitShape(i,s),l=w.sizeFromShape(a);w.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var yG={kernelName:Fc,backendName:"cpu",kernelFunc:ot};function gA(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;J([o,i],"matMul");let l=o.shape.length,c=i.shape.length,u=s?o.shape[l-2]:o.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],p=s?o.shape[l-1]:o.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],m=o.shape.slice(0,-2),h=i.shape.slice(0,-2),g=w.sizeFromShape(m),x=w.sizeFromShape(h),b=g===x||g===1||x===1;w.assert(l>=2&&c>=2&&b,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${h}).`);let _=(g>x?o.shape.slice(0,-2):i.shape.slice(0,-2)).concat([p,f]);w.assert(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let E=s?[g,u,p]:[g,p,u],S=a?[x,f,d]:[x,d,f],D=ot({inputs:{x:o},backend:e,attrs:{shape:E}}),M=ot({inputs:{x:i},backend:e,attrs:{shape:S}}),R=s?D.shape[1]:D.shape[2],L=s?D.shape[2]:D.shape[1],G=a?M.shape[1]:M.shape[2],W=Math.max(g,x),q=e.data.get(D.dataId).values,X=e.data.get(M.dataId).values,K=w.computeStrides(D.shape),Z=w.computeStrides(M.shape),[se,ee,oe]=s?[K[0],1,K[1]]:[K[0],K[1],1],[le,de,ge]=a?[1,Z[1],Z[0]]:[Z[1],1,Z[0]],pe=L*G,ve=Te([W,L,G],D.dtype),xe=ve.values,we=e.blockSize;for(let Ne=0;Ne<W;Ne++)for(let Le=0;Le<L;Le+=we)for(let Be=0;Be<G;Be+=we)for(let Xe=0;Xe<R;Xe+=we){let ct=Math.min(Le+we,L),Bt=Math.min(Be+we,G),hn=Math.min(Xe+we,R);for(let rn=Le;rn<ct;rn++)for(let Yt=Be;Yt<Bt;Yt++){let Zt=0;for(let on=Xe;on<hn;on++){let _n=Math.min(Ne,g-1)*se,Rs=Math.min(Ne,x-1)*ge,Yn=q[_n+rn*ee+on*oe],Zi=X[on*le+Yt*de+Rs];Zt+=Yn*Zi}xe[Ne*pe+(rn*G+Yt)]+=Zt}}return e.disposeIntermediateTensorInfo(D),e.disposeIntermediateTensorInfo(M),e.makeTensorInfo(_,ve.dtype,ve.values)}var vG={kernelName:ac,backendName:"cpu",kernelFunc:gA};function Lhe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r,p,f,m,h=[];p=gA({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:e}),s&&(f=bl({inputs:{a:p,b:s},backend:e}),h.push(p),p=f),u&&(m=Zm(e,p,u,a,d),h.push(p),p=m);for(let x of h)e.disposeIntermediateTensorInfo(x);return p}var xG={kernelName:bd,backendName:"cpu",kernelFunc:Lhe};var $he=Oe(da,t=>Math.acos(t)),bG={kernelName:da,backendName:"cpu",kernelFunc:$he};var Vhe=Oe(pa,t=>Math.acosh(t)),wG={kernelName:pa,backendName:"cpu",kernelFunc:Vhe};function Bhe(t){let{inputs:n,backend:e}=t,r=n;J(n,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=Te(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var CG={kernelName:Ff,backendName:"cpu",kernelFunc:Bhe};function zhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"all");let a=w.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=yn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=w.sizeFromShape(p),m=w.makeZerosTypedArray(w.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,I=h[b];for(let _=0;_<f;++_){let E=h[b+_];I=I&&E}m[x]=I}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=ot({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var _G={kernelName:Of,backendName:"cpu",kernelFunc:zhe};function Uhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"any");let a=w.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=yn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=w.sizeFromShape(p),m=w.makeZerosTypedArray(w.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,I=h[b];for(let _=0;_<f;++_){let E=h[b+_];I=I||E}m[x]=I}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=ot({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var IG={kernelName:Pf,backendName:"cpu",kernelFunc:Uhe};function jhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;J(o,"argMax");let s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=yn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=w.sizeFromShape(u),f=w.makeZerosTypedArray(p,"int32"),m=w.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let x=g*m,b=h[x],I=0;for(let _=0;_<m;++_){let E=h[x+_];E>b&&(b=E,I=_)}f[g]=I}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var EG={kernelName:rc,backendName:"cpu",kernelFunc:jhe};function Ghe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;J(o,"argMin");let s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=yn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=w.sizeFromShape(u),f=w.makeZerosTypedArray(p,"int32"),m=w.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let x=g*m,b=h[x],I=0;for(let _=0;_<m;++_){let E=h[x+_];E<b&&(b=E,I=_)}f[g]=I}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var SG={kernelName:oc,backendName:"cpu",kernelFunc:Ghe};var Whe=Oe(fa,t=>Math.asin(t)),TG={kernelName:fa,backendName:"cpu",kernelFunc:Whe};var Hhe=Oe(ma,t=>Math.asinh(t)),DG={kernelName:ma,backendName:"cpu",kernelFunc:Hhe};var qhe=Oe(ha,t=>Math.atan(t)),NG={kernelName:ha,backendName:"cpu",kernelFunc:qhe};var Khe=rt((t,n)=>Math.atan2(t,n)),Xhe=mt(ya,Khe),kG={kernelName:ya,backendName:"cpu",kernelFunc:Xhe};var Yhe=Oe(ga,t=>Math.atanh(t)),AG={kernelName:ga,backendName:"cpu",kernelFunc:Yhe};function Qm(t,n,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=o.padInfo.top,f=o.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Te(o.outShape,e),g=h.values,x=o.outShape[1]*o.outShape[2]*o.outShape[3],b=o.outShape[2]*o.outShape[3],I=o.outShape[3];for(let _=0;_<o.batchSize;++_){let E=_*x,S=_*r[0];for(let D=0;D<o.inChannels;++D)for(let M=0;M<o.outHeight;++M){let R=M*s-p,L=Math.max(0,R),G=Math.min(o.inHeight,u+R),W=E+M*b;for(let q=0;q<o.outWidth;++q){let X=q*a-f,K=Math.max(0,X),Z=Math.min(o.inWidth,d+X),se=m,ee=0,oe=0;for(let de=L;de<G;de+=l){let ge=S+de*r[1];for(let pe=K;pe<Z;pe+=c){let ve=ge+pe*r[2],xe=t[ve+D];i==="max"&&xe>se?se=xe:i==="avg"&&(ee+=xe,oe++)}if(isNaN(se))break}let le=W+q*I+D;g[le]=i==="avg"?ee/oe:se}}}return h}function $C(t,n,e,r,o=!1,i=!1){let s=Te(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left,h=Te(n,e,t);for(let g=0;g<r.batchSize;++g)for(let x=0;x<r.inChannels;++x)for(let b=0;b<r.outHeight;++b){let I=b*a-f,_=I;for(;_<0;)_+=c;let E=Math.min(r.inHeight,d+I);for(let S=0;S<r.outWidth;++S){let D=S*l-m,M=D;for(;M<0;)M+=u;let R=Math.min(r.inWidth,p+D),L=Number.NEGATIVE_INFINITY,G=-1;for(let W=_;W<E;W+=c){let q=W-I;for(let X=M;X<R;X+=u){let K=X-D,Z=h.get(g,W,X,x);Z>L&&(L=Z,o?G=i?((g*r.inHeight+W)*r.inWidth+X)*r.inChannels+x:(W*r.inWidth+X)*r.inChannels+x:G=q*p+K)}}s.set(G,g,b,S,x)}}return s}function VC(t,n,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,g=o.padInfo.top,x=o.padInfo.left,b=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,I=Te(o.outShape,e),_=I.values,E=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[2]*o.outShape[3]*o.outShape[4],D=o.outShape[3]*o.outShape[4],M=o.outShape[4];for(let R=0;R<o.batchSize;++R){let L=R*E,G=R*r[0];for(let W=0;W<o.inChannels;++W)for(let q=0;q<o.outDepth;++q){let X=q*s-h,K=X;for(;K<0;)K+=c;let Z=Math.min(o.inDepth,p+X),se=L+q*S;for(let ee=0;ee<o.outHeight;++ee){let oe=ee*a-g,le=oe;for(;le<0;)le+=u;let de=Math.min(o.inHeight,f+oe),ge=se+ee*D;for(let pe=0;pe<o.outWidth;++pe){let ve=pe*l-x,xe=ve;for(;xe<0;)xe+=d;let we=Math.min(o.inWidth,m+ve),Ne=ge+pe*M,Le=b,Be=0,Xe=0;for(let Bt=K;Bt<Z;Bt+=c){let hn=G+Bt*r[1];for(let rn=le;rn<de;rn+=u){let Yt=hn+rn*r[2];for(let Zt=xe;Zt<we;Zt+=d){let on=Yt+Zt*r[3],_n=t[on+W];if(i==="max"&&_n>Le?Le=_n:i==="avg"&&(Be+=_n,Xe++),isNaN(Le))break}if(isNaN(Le))break}if(isNaN(Le))break}let ct=Ne+W;_[ct]=i==="avg"?Be/Xe:Le}}}}return I}function RG(t,n){let e=Te(n.outShape,"int32"),r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,u=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,f=n.padInfo.top,m=n.padInfo.left;for(let h=0;h<n.batchSize;++h)for(let g=0;g<n.inChannels;++g)for(let x=0;x<n.outDepth;++x){let b=x*r-p,I=b;for(;I<0;)I+=s;let _=Math.min(n.inDepth,c+b);for(let E=0;E<n.outHeight;++E){let S=E*o-f,D=S;for(;D<0;)D+=a;let M=Math.min(n.inHeight,u+S);for(let R=0;R<n.outWidth;++R){let L=R*i-m,G=L;for(;G<0;)G+=l;let W=Math.min(n.inWidth,d+L),q=Number.NEGATIVE_INFINITY,X=-1;for(let K=I;K<_;K+=s){let Z=K-b;for(let se=D;se<M;se+=a){let ee=se-S;for(let oe=G;oe<W;oe+=l){let le=oe-L,de=t.get(h,K,se,oe,g);de>=q&&(q=de,X=Z*u*d+ee*u+le)}}}e.set(X,h,x,E,R,g)}}}return e}function Zhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;J(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))d=ar({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=w.computeStrides(o.shape),m=Qm(p,o.shape,o.dtype,f,u,"avg");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var MG={kernelName:ic,backendName:"cpu",kernelFunc:Zhe};function Qhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;J(o,"avgPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=VC(d,o.shape,o.dtype,w.computeStrides(o.shape),u,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var FG={kernelName:sc,backendName:"cpu",kernelFunc:Qhe};function Jhe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;J([o,i],"avgPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.filterDepth,h=u.filterHeight,g=u.filterWidth,x=u.dilationDepth,b=u.dilationHeight,I=u.dilationWidth,_=u.effectiveFilterDepth,E=u.effectiveFilterHeight,S=u.effectiveFilterWidth,D=_-1-u.padInfo.front,M=S-1-u.padInfo.left,R=E-1-u.padInfo.top,L=Te(i.shape,"float32"),G=1/(m*h*g),W=e.bufferSync(o);for(let q=0;q<u.batchSize;++q)for(let X=0;X<u.inChannels;++X)for(let K=0;K<u.inDepth;++K)for(let Z=0;Z<u.inHeight;++Z)for(let se=0;se<u.inWidth;++se){let ee=K-D,oe=Z-R,le=se-M,de=0;for(let ge=0;ge<_;ge+=x){let pe=(ee+ge)/d;if(!(pe<0||pe>=u.outDepth||Math.floor(pe)!==pe))for(let ve=0;ve<E;ve+=b){let xe=(oe+ve)/p;if(!(xe<0||xe>=u.outHeight||Math.floor(xe)!==xe))for(let we=0;we<S;we+=I){let Ne=(le+we)/f;if(Ne<0||Ne>=u.outWidth||Math.floor(Ne)!==Ne)continue;let Le=W.get(q,pe,xe,Ne,X);de+=Le}}}L.set(de*G,q,K,Z,se,X)}return e.makeTensorInfo(L.shape,L.dtype,L.values)}var OG={kernelName:$f,backendName:"cpu",kernelFunc:Jhe};function ege(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;J([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=u.strideHeight,p=u.strideWidth,f=u.filterHeight,m=u.filterWidth,h=u.dilationHeight,g=u.dilationWidth,x=u.effectiveFilterHeight,b=u.effectiveFilterWidth,I=b-1-u.padInfo.left,_=x-1-u.padInfo.top,E=Te(s.shape,"float32"),S=1/(f*m),D=e.data.get(o.dataId).values,M=Te(o.shape,"float32",D);for(let R=0;R<u.batchSize;++R)for(let L=0;L<u.inChannels;++L)for(let G=0;G<u.inHeight;++G)for(let W=0;W<u.inWidth;++W){let q=G-_,X=W-I,K=0;for(let Z=0;Z<x;Z+=h){let se=(q+Z)/d;if(!(se<0||se>=u.outHeight||Math.floor(se)!==se))for(let ee=0;ee<b;ee+=g){let oe=(X+ee)/p;if(oe<0||oe>=u.outWidth||Math.floor(oe)!==oe)continue;let le=M.get(R,se,oe,L);K+=le}}E.set(K*S,R,G,W,L)}return e.makeTensorInfo(E.shape,E.dtype,E.values)}var PG={kernelName:Lf,backendName:"cpu",kernelFunc:ege};function tge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,scale:i,offset:s,mean:a,variance:l}=n;w.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),J([o,a,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,p=e.data.get(l.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),m=s?e.data.get(s.dataId).values:new Float32Array([0]),h=new Float32Array(u.length),g=m.length,x=f.length,b=p.length,I=d.length,_=0,E=0,S=0,D=0;for(let M=0;M<u.length;++M)h[M]=m[_++]+(u[M]-d[E++])*f[S++]/Math.sqrt(p[D++]+c),_>=g&&(_=0),E>=I&&(E=0),S>=x&&(S=0),D>=b&&(D=0);return e.makeTensorInfo(o.shape,o.dtype,h)}var LG={kernelName:vc,backendName:"cpu",kernelFunc:tge};function nge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;J([o],"batchToSpaceND");let a=i.reduce((x,b)=>x*b),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=ot({inputs:{x:o},backend:e,attrs:{shape:l}}),m=yn({inputs:{x:f},backend:e,attrs:{perm:c}}),h=ot({inputs:{x:m},backend:e,attrs:{shape:u}}),g=vi({inputs:{x:h},backend:e,attrs:{begin:d,size:p}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var $G={kernelName:lc,backendName:"cpu",kernelFunc:nge};function rge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=Xm(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var VG={kernelName:Pb,backendName:"cpu",kernelFunc:rge};var oge=Oe(xa,(t,n)=>{let e=n;return t>e.clipValueMax?e.clipValueMax:t<e.clipValueMin?e.clipValueMin:t}),BG={kernelName:xa,backendName:"cpu",kernelFunc:oge};var ige=t=>{let{x:n}=t.inputs,e=t.backend,r=new Float32Array(w.sizeFromShape(n.shape)),o=e.data.get(n.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let c=0;c<a.length;c++){let u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return e.makeOutput(r,n.shape,"float32")},zG={kernelName:cc,backendName:"cpu",kernelFunc:ige};function Ns(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var UG={kernelName:Yf,backendName:"cpu",kernelFunc:Ns};function uu(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=w.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(h=>h.shape),i);if(w.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(h=>w.sizeFromShape(h.shape)>0);if(a.length===1)return ar({inputs:{x:a[0]},backend:e});let l=a.map(h=>h.shape);if(T.assertParamsConsistent(l,i),a[0].dtype==="complex64"){let h=a.map(_=>mi({inputs:{input:_},backend:e})),g=a.map(_=>Ns({inputs:{input:_},backend:e})),x=uu({inputs:h,backend:e,attrs:{axis:i}}),b=uu({inputs:g,backend:e,attrs:{axis:i}}),I=Nn({inputs:{real:x,imag:b},backend:e});return h.forEach(_=>e.disposeIntermediateTensorInfo(_)),g.forEach(_=>e.disposeIntermediateTensorInfo(_)),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),I}let c=a.map(h=>{let x=[-1,w.sizeFromShape(h.shape.slice(i))];return ot({inputs:{x:h},backend:e,attrs:{shape:x}})}),u=c.map(h=>({vals:e.data.get(h.dataId).values,shape:h.shape}));s=T.computeOutShape(c.map(h=>h.shape),1);let d=c[0].shape[0]===1,p=TC(u,s,n[0].dtype,d),f=T.computeOutShape(a.map(h=>h.shape),i),m=e.makeTensorInfo(f,n[0].dtype,p);return c.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var jG={kernelName:uc,backendName:"cpu",kernelFunc:uu};function yA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;J([o,i],"conv2d");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f=p.filterHeight,m=p.filterWidth,h=p.dilationHeight,g=p.dilationWidth,x=p.padInfo.left,b=p.padInfo.top,I=p.dataFormat==="channelsLast",_=new At(p.outShape,o.dtype),E=w.computeStrides(o.shape),S=w.computeStrides(i.shape),D=E[0],M=I?E[1]:E[2],R=I?E[2]:1,L=I?1:E[1],G=_.strides[0],W=I?_.strides[1]:_.strides[2],q=I?_.strides[2]:1,X=I?1:_.strides[1],K=e.data.get(o.dataId).values,Z=e.data.get(i.dataId).values,se=_.values;for(let ee=0;ee<p.batchSize;++ee){let oe=ee*D,le=ee*G;for(let de=0;de<p.outHeight;++de){let ge=le+de*W,pe=de*p.strideHeight-b;for(let ve=0;ve<f;++ve){let xe=pe+ve*h;if(xe<0||xe>=p.inHeight)continue;let we=ve*S[0],Ne=oe+xe*M;for(let Le=0;Le<p.outWidth;++Le){let Be=ge+Le*q,Xe=Le*p.strideWidth-x;for(let ct=0;ct<m;++ct){let Bt=Xe+ct*g;if(Bt<0||Bt>=p.inWidth)continue;let hn=we+ct*S[1],rn=Ne+Bt*R,Yt=hn;for(let Zt=0;Zt<p.inChannels;++Zt){let on=K[rn+Zt*L];for(let _n=0;_n<p.outChannels;++_n)se[Be+_n*X]+=on*Z[Yt+_n];Yt+=p.outChannels}}}}}}return e.makeTensorInfo(_.shape,_.dtype,se)}var GG={kernelName:dc,backendName:"cpu",kernelFunc:yA};function sge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;J([o,i],"conv2dBackpropFilter");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),{strideHeight:f,strideWidth:m,filterHeight:h,filterWidth:g}=p,x=p.dataFormat==="channelsLast",b=new At(p.filterShape,"float32"),I=p.padInfo.left,_=p.padInfo.top,E=e.data.get(o.dataId).values,S=e.data.get(i.dataId).values,D=new At(o.shape,o.dtype,E),M=new At(i.shape,i.dtype,S);for(let R=0;R<h;++R){let L=Math.max(0,Math.ceil((_-R)/f)),G=Math.min(p.outHeight,(p.inHeight+_-R)/f);for(let W=0;W<g;++W){let q=Math.max(0,Math.ceil((I-W)/m)),X=Math.min(p.outWidth,(p.inWidth+I-W)/m);for(let K=0;K<p.inChannels;++K)for(let Z=0;Z<p.outChannels;++Z){let se=0;for(let ee=0;ee<p.batchSize;++ee)for(let oe=L;oe<G;++oe){let le=R+oe*f-_;for(let de=q;de<X;++de){let ge=W+de*m-I;x?se+=D.get(ee,le,ge,K)*M.get(ee,oe,de,Z):se+=D.get(ee,K,le,ge)*M.get(ee,Z,oe,de)}}b.set(se,R,W,K,Z)}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var WG={kernelName:Bf,backendName:"cpu",kernelFunc:sge};function age(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;J([o,i],"conv2dBackpropInput");let d=w.computeStrides(i.shape),p=w.computeStrides(o.shape),f=T.convertConv2DDataFormat(c),m=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,f),h=new At(m.inShape,"float32"),g=h.values,x=e.data.get(o.dataId).values,b=e.data.get(i.dataId).values,[I,_,E]=d,{batchSize:S,filterHeight:D,filterWidth:M,inChannels:R,inHeight:L,inWidth:G,outChannels:W,outHeight:q,outWidth:X,strideHeight:K,strideWidth:Z}=m;f=m.dataFormat;let se=D-1-m.padInfo.top,ee=M-1-m.padInfo.left,oe=f==="channelsLast",le=h.strides[0],de=oe?h.strides[1]:h.strides[2],ge=oe?h.strides[2]:1,pe=oe?1:h.strides[1],ve=p[0],xe=oe?p[1]:p[2],we=oe?p[2]:1,Ne=oe?1:p[1];for(let Le=0;Le<S;++Le)for(let Be=0;Be<R;++Be)for(let Xe=0;Xe<L;++Xe){let ct=Xe-se,Bt=Math.max(0,Math.ceil(ct/K)),hn=Math.min(q,(D+ct)/K);for(let rn=0;rn<G;++rn){let Yt=rn-ee,Zt=Math.max(0,Math.ceil(Yt/Z)),on=Math.min(X,(M+Yt)/Z),_n=0;for(let Yn=Bt;Yn<hn;++Yn){let Zi=Yn*K-ct;for(let bo=Zt;bo<on;++bo){let vu=bo*Z-Yt,wi=ve*Le+xe*Yn+we*bo,Ms=I*(D-1-Zi)+_*(M-1-vu)+E*Be;for(let El=0;El<W;++El){let Sl=x[wi+Ne*El],Tl=b[Ms+El];_n+=Sl*Tl}}}let Rs=le*Le+de*Xe+ge*rn+pe*Be;g[Rs]=_n}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var HG={kernelName:pc,backendName:"cpu",kernelFunc:age};function lge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r;J([o,i],"conv3d");let c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:h,padInfo:g}=c,x=g.front,b=g.left,I=g.top,_=new At(c.outShape,o.dtype),E=e.data.get(o.dataId).values,S=e.data.get(i.dataId).values,D=_.values,M=w.computeStrides(o.shape),R=w.computeStrides(i.shape);for(let L=0;L<c.batchSize;++L){let G=L*M[0],W=L*_.strides[0];for(let q=0;q<c.outDepth;++q){let X=W+q*_.strides[1],K=q*c.strideDepth-x;for(let Z=0;Z<u;++Z){let se=K+Z*f;if(se<0||se>=c.inDepth)continue;let ee=Z*R[0],oe=G+se*M[1];for(let le=0;le<c.outHeight;++le){let de=X+le*_.strides[2],ge=le*c.strideHeight-I;for(let pe=0;pe<d;++pe){let ve=ge+pe*m;if(ve<0||ve>=c.inHeight)continue;let xe=ee+pe*R[1],we=oe+ve*M[2];for(let Ne=0;Ne<c.outWidth;++Ne){let Le=de+Ne*c.outChannels,Be=Ne*c.strideWidth-b;for(let Xe=0;Xe<p;++Xe){let ct=Be+Xe*h;if(ct<0||ct>=c.inWidth)continue;let Bt=xe+Xe*R[2],hn=we+ct*c.inChannels,rn=Bt;for(let Yt=0;Yt<c.inChannels;++Yt){let Zt=E[hn+Yt];for(let on=0;on<c.outChannels;++on)D[Le+on]+=Zt*S[rn+on];rn+=c.outChannels}}}}}}}}return e.makeTensorInfo(_.shape,_.dtype,_.values)}var qG={kernelName:fc,backendName:"cpu",kernelFunc:lge};function cge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r;J([o,i],"conv3dBackpropFilterV2");let c=w.computeStrides(o.shape),u=w.computeStrides(i.shape),d=T.computeConv3DInfo(o.shape,l,s,1,a),p=d.strideDepth,f=d.strideHeight,m=d.strideWidth,h=d.filterDepth,g=d.filterHeight,x=d.filterWidth,b=new At(d.filterShape,"float32"),I=b.values,[_,E,S,D]=b.strides,M=e.data.get(i.dataId).values,[R,L,G,W]=u,q=e.data.get(o.dataId).values,[X,K,Z,se]=c,ee=d.padInfo.front,oe=d.padInfo.left,le=d.padInfo.top;for(let de=0;de<h;++de){let ge=Math.max(0,Math.ceil((ee-de)/p)),pe=Math.min(d.outDepth,(d.inDepth+ee-de)/p),ve=de*_;for(let xe=0;xe<g;++xe){let we=Math.max(0,Math.ceil((le-xe)/f)),Ne=Math.min(d.outHeight,(d.inHeight+le-xe)/f),Le=xe*E+ve;for(let Be=0;Be<x;++Be){let Xe=Math.max(0,Math.ceil((oe-Be)/m)),ct=Math.min(d.outWidth,(d.inWidth+oe-Be)/m),Bt=Be*S+Le;for(let hn=0;hn<d.inChannels;++hn){let rn=hn*D+Bt;for(let Yt=0;Yt<d.outChannels;++Yt){let Zt=0;for(let on=0;on<d.batchSize;++on){let _n=on*X,Rs=on*R;for(let Yn=ge;Yn<pe;++Yn){let bo=(de+Yn*p-ee)*K+_n,vu=Yn*L+Rs;for(let wi=we;wi<Ne;++wi){let El=(xe+wi*f-le)*Z+bo,Sl=wi*G+vu;for(let Tl=Xe;Tl<ct;++Tl){let NI=(Be+Tl*m-oe)*se+El,kI=Tl*W+Sl;Zt+=q[NI+hn]*M[kI+Yt]}}}}I[rn+Yt]=Zt}}}}}return e.makeTensorInfo(b.shape,b.dtype,b.values)}var KG={kernelName:zf,backendName:"cpu",kernelFunc:cge};function uge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r;J([o],"conv3dBackpropInputV2");let c=w.computeStrides(o.shape),u=w.computeStrides(i.shape),d=T.computeConv3DInfo(l,i.shape,a,1,s),p=new At(d.inShape,"float32"),f=p.values,[m,h,g,x]=p.strides,b=e.data.get(o.dataId).values,[I,_,E,S]=c,D=e.data.get(i.dataId).values,[M,R,L,G]=u,{batchSize:W,filterDepth:q,filterHeight:X,filterWidth:K,inChannels:Z,inDepth:se,inHeight:ee,inWidth:oe,outChannels:le,outDepth:de,outHeight:ge,outWidth:pe,strideDepth:ve,strideHeight:xe,strideWidth:we}=d,Ne=q-1-d.padInfo.front,Le=X-1-d.padInfo.top,Be=K-1-d.padInfo.left;for(let Xe=0;Xe<W;++Xe)for(let ct=0;ct<Z;++ct)for(let Bt=0;Bt<se;++Bt){let hn=Bt-Ne,rn=Math.max(0,Math.ceil(hn/ve)),Yt=Math.min(de,(q+hn)/ve);for(let Zt=0;Zt<ee;++Zt){let on=Zt-Le,_n=Math.max(0,Math.ceil(on/xe)),Rs=Math.min(ge,(X+on)/xe);for(let Yn=0;Yn<oe;++Yn){let Zi=Yn-Be,bo=Math.max(0,Math.ceil(Zi/we)),vu=Math.min(pe,(K+Zi)/we),wi=0;for(let Ms=rn;Ms<Yt;++Ms){let El=Ms*ve-hn;for(let Sl=_n;Sl<Rs;++Sl){let Tl=Sl*xe-on;for(let fh=bo;fh<vu;++fh){let NI=fh*we-Zi,kI=I*Xe+_*Ms+E*Sl+S*fh,o9=M*(q-1-El)+R*(X-1-Tl)+L*(K-1-NI)+G*ct;for(let d0=0;d0<le;++d0){let i9=b[kI+d0],s9=D[o9+d0];wi+=i9*s9}}}}f[m*Xe+h*Bt+g*Zt+x*Yn+ct]=wi}}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var XG={kernelName:Uf,backendName:"cpu",kernelFunc:uge};var dge=Oe(ba,t=>Math.cos(t)),YG={kernelName:ba,backendName:"cpu",kernelFunc:dge};var pge=Oe(wa,t=>Math.cosh(t)),ZG={kernelName:wa,backendName:"cpu",kernelFunc:pge};function fge(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,p,f]=o.shape,m=i.shape[0],[h,g]=a,x=Te([m,h,g,f],"float32"),b=e.data.get(i.dataId).values,I=e.data.get(s.dataId).values,_=e.data.get(o.dataId).values,E=w.computeStrides(o.shape),S=w.computeStrides(x.shape);for(let D=0;D<m;D++){let M=D*4,R=b[M],L=b[M+1],G=b[M+2],W=b[M+3],q=I[D];if(q>=u)continue;let X=h>1?(G-R)*(d-1)/(h-1):0,K=g>1?(W-L)*(p-1)/(g-1):0;for(let Z=0;Z<h;Z++){let se=h>1?R*(d-1)+Z*X:.5*(R+G)*(d-1);if(se<0||se>d-1){for(let ee=0;ee<g;ee++)for(let oe=0;oe<f;oe++){let le=oe+ee*S[2]+Z*S[1]+D*S[0];x.values[le]=c}continue}if(l==="bilinear"){let ee=Math.floor(se),oe=Math.ceil(se),le=se-ee;for(let de=0;de<g;de++){let ge=g>1?L*(p-1)+de*K:.5*(L+W)*(p-1);if(ge<0||ge>p-1){for(let we=0;we<f;we++){let Ne=we+de*S[2]+Z*S[1]+D*S[0];x.values[Ne]=c}continue}let pe=Math.floor(ge),ve=Math.ceil(ge),xe=ge-pe;for(let we=0;we<f;we++){let Ne=we+pe*E[2]+ee*E[1]+q*E[0],Le=_[Ne];Ne=we+ve*E[2]+ee*E[1]+q*E[0];let Be=_[Ne];Ne=we+pe*E[2]+oe*E[1]+q*E[0];let Xe=_[Ne];Ne=we+ve*E[2]+oe*E[1]+q*E[0];let ct=_[Ne],Bt=Le+(Be-Le)*xe,hn=Xe+(ct-Xe)*xe;Ne=we+de*S[2]+Z*S[1]+D*S[0],x.values[Ne]=Bt+(hn-Bt)*le}}}else for(let ee=0;ee<g;++ee){let oe=g>1?L*(p-1)+ee*K:.5*(L+W)*(p-1);if(oe<0||oe>p-1){for(let ge=0;ge<f;ge++){let pe=ge+ee*S[2]+Z*S[1]+D*S[0];x.values[pe]=c}continue}let le=Math.round(oe),de=Math.round(se);for(let ge=0;ge<f;ge++){let pe=ge+le*E[2]+de*E[1]+q*E[0],ve=ge+ee*S[2]+Z*S[1]+D*S[0];x.values[ve]=_[pe]}}}}return e.makeTensorInfo(x.shape,x.dtype,x.values)}var QG={kernelName:Lb,backendName:"cpu",kernelFunc:fge};function mge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;J(o,"cumsum");let l=T.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=yn({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=T.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=Dn(c.dtype,"int32"),p=w.makeZerosTypedArray(w.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],h=a?(x,b)=>x+m-b-1:(x,b)=>x+b;for(let x=0;x<f.length;x+=m)for(let b=0;b<m;b++){let I=h(x,b);if(b===0)p[I]=s?0:f[I];else{let _=h(x,b-1);p[I]=s?f[_]+p[_]:f[I]+p[_]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let x=T.getUndoAxesPermutation(l),b=yn({inputs:{x:g},backend:e,attrs:{perm:x}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),b}return g}var JG={kernelName:mc,backendName:"cpu",kernelFunc:mge};function hge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Xm(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=SC(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var eW={kernelName:$b,backendName:"cpu",kernelFunc:hge};function gge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;w.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`),w.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*i,p=c*i,f=u/(i*i),m=e.data.get(o.dataId).values,h=new Float32Array(a*d*p*f),g=0;for(let x=0;x<a;++x)for(let b=0;b<d;++b){let I=Math.floor(b/i),_=b%i;for(let E=0;E<p;++E){let S=Math.floor(E/i),D=E%i,M=(_*i+D)*f;for(let R=0;R<f;++R){let G=R+M+u*(S+c*(I+l*x));h[g++]=m[G]}}}return e.makeTensorInfo([a,d,p,f],o.dtype,h)}var tW={kernelName:jf,backendName:"cpu",kernelFunc:gge};function vA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r;J([o,i],"depthwiseConv2DNative");let u=w.computeStrides(o.shape),d=w.computeStrides(i.shape),p=l;p==null&&(p=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(s,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`);let f=T.computeConv2DInfo(o.shape,i.shape,s,p,a,c,!0),{filterHeight:m,filterWidth:h,dilationHeight:g,dilationWidth:x,padInfo:b}=f,I=b.left,_=b.top,E=f.outChannels/f.inChannels,S=new At(f.outShape,o.dtype),D=e.data.get(o.dataId).values,M=e.data.get(i.dataId).values,R=S.values;for(let L=0;L<f.batchSize;++L){let G=L*u[0],W=L*S.strides[0];for(let q=0;q<f.outHeight;++q){let X=W+q*S.strides[1],K=q*f.strideHeight-_;for(let Z=0;Z<m;++Z){let se=K+Z*g;if(se<0||se>=f.inHeight)continue;let ee=Z*d[0],oe=G+se*u[1];for(let le=0;le<f.outWidth;++le){let de=X+le*S.strides[2],ge=le*f.strideWidth-I;for(let pe=0;pe<h;++pe){let ve=ge+pe*x;if(ve<0||ve>=f.inWidth)continue;let xe=ee+pe*d[1],we=oe+ve*f.inChannels,Ne=de,Le=xe;for(let Be=0;Be<f.inChannels;++Be){let Xe=D[we+Be];for(let ct=0;ct<E;++ct)R[Ne+ct]+=Xe*M[Le+ct];Ne+=E,Le+=E}}}}}}return e.makeTensorInfo(S.shape,S.dtype,S.values)}var nW={kernelName:hc,backendName:"cpu",kernelFunc:vA};function yge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;J([o,i],"depthwiseConv2dNativeBackpropFilter");let d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:h}=d,g=new At(d.filterShape,"float32"),x=d.padInfo.left,b=d.padInfo.top,I=d.outChannels/d.inChannels,_=e.data.get(o.dataId).values,E=new At(o.shape,o.dtype,_),S=e.data.get(i.dataId).values,D=new At(i.shape,i.dtype,S);for(let M=0;M<m;++M){let R=Math.max(0,Math.ceil((b-M)/p)),L=Math.min(d.outHeight,(d.inHeight+b-M)/p);for(let G=0;G<h;++G){let W=Math.max(0,Math.ceil((x-G)/f)),q=Math.min(d.outWidth,(d.inWidth+x-G)/f);for(let X=0;X<d.outChannels;++X){let K=Math.trunc(X/I),Z=X%I,se=0;for(let ee=0;ee<d.batchSize;++ee)for(let oe=R;oe<L;++oe){let le=M+oe*p-b;for(let de=W;de<q;++de){let ge=G+de*f-x;se+=E.get(ee,le,ge,K)*D.get(ee,oe,de,X)}}g.set(se,M,G,K,Z)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var rW={kernelName:Gf,backendName:"cpu",kernelFunc:yge};function vge(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;J([o,i],"depthwiseConv2DNativeBackpropInput");let d=w.computeStrides(o.shape),p=w.computeStrides(i.shape),f=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),m=new At(f.inShape,"float32"),h=m.values,[g,x,b]=m.strides,I=e.data.get(o.dataId).values,[_,E,S]=d,D=e.data.get(i.dataId).values,[M,R,L]=p,{batchSize:G,filterHeight:W,filterWidth:q,inChannels:X,inHeight:K,inWidth:Z,outChannels:se,outHeight:ee,outWidth:oe,strideHeight:le,strideWidth:de}=f,ge=W-1-f.padInfo.top,pe=q-1-f.padInfo.left,ve=se/X;for(let xe=0;xe<G;++xe)for(let we=0;we<X;++we)for(let Ne=0;Ne<K;++Ne){let Le=Ne-ge,Be=Math.max(0,Math.ceil(Le/le)),Xe=Math.min(ee,(W+Le)/le);for(let ct=0;ct<Z;++ct){let Bt=ct-pe,hn=Math.max(0,Math.ceil(Bt/de)),rn=Math.min(oe,(q+Bt)/de),Yt=0;for(let Zt=Be;Zt<Xe;++Zt){let on=Zt*le-Le;for(let _n=hn;_n<rn;++_n){let Rs=_n*de-Bt,Yn=_*xe+E*Zt+S*_n,Zi=M*(W-1-on)+R*(q-1-Rs)+L*we;for(let bo=0;bo<ve;++bo){let vu=we*ve+bo,wi=I[Yn+vu],Ms=D[Zi+bo];Yt+=wi*Ms}}}h[g*xe+x*Ne+b*ct+we]=Yt}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var oW={kernelName:Wf,backendName:"cpu",kernelFunc:vge};function xge(t){let{inputs:n,backend:e}=t,{x:r}=n,o=w.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=Te([o,o],r.dtype),a=s.values;for(let c=0;c<i.length;c++)a[c*o+c]=i[c];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var iW={kernelName:Vb,backendName:"cpu",kernelFunc:xge};var sW={kernelName:gc,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o}=t,{strides:i,pad:s,dilations:a}=e,l=n,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:f,inHeight:m,inWidth:h,inChannels:g,outHeight:x,outWidth:b,padInfo:I,strideHeight:_,strideWidth:E,filterHeight:S,filterWidth:D,dilationHeight:M,dilationWidth:R,outShape:L}=T.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),G=w.sizeFromShape(L),W=L.length,q=w.getArrayFromDType(r.dtype,G);for(let K=0;K<f;++K)for(let Z=0;Z<x;++Z){let se=Z*_-I.top;for(let ee=0;ee<b;++ee){let oe=ee*E-I.left;for(let le=0;le<g;++le){let de=Number.MIN_SAFE_INTEGER;for(let pe=0;pe<S;++pe){let ve=se+pe*M;if(ve>=0&&ve<m)for(let xe=0;xe<D;++xe){let we=oe+xe*R;if(we>=0&&we<h){let Ne=w.locToIndex([K,ve,we,le],u,w.computeStrides(r.shape)),Le=w.locToIndex([pe,xe,le],p,w.computeStrides(o.shape)),Be=c[Ne]+d[Le];Be>de&&(de=Be)}}}let ge=w.locToIndex([K,Z,ee,le],W,w.computeStrides(L));q[ge]=de}}}return{dataId:l.write(w.toTypedArray(q,r.dtype),L,r.dtype),shape:L,dtype:r.dtype}}};var aW={kernelName:oy,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=w.toNestedArray(r.shape,c.data.get(r.dataId).values),d=w.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:b,strideHeight:I,strideWidth:_,filterHeight:E,filterWidth:S,dilationHeight:D,dilationWidth:M,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);w.assert(i.rank===R.length,()=>`Error in ${oy}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let L=w.toNestedArray(R,c.data.get(i.dataId).values),G=w.makeZerosNestedTypedArray(o.shape,o.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*I-b.top;for(let Z=0;Z<x;++Z){let se=Z*_-b.left;for(let ee=0;ee<h;++ee){let oe=Number.MIN_SAFE_INTEGER,le=0,de=0;for(let ge=0;ge<E;++ge){let pe=K+ge*D;if(pe>=0&&pe<f)for(let ve=0;ve<S;++ve){let xe=se+ve*M;if(xe>=0&&xe<m){let we=u[q][pe][xe][ee]+d[ge][ve][ee];we>oe&&(oe=we,le=ge,de=ve)}}}G[le][de][ee]+=L[q][X][Z][ee]}}}return{dataId:c.write(w.toTypedArray(G,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var lW={kernelName:ry,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=w.toNestedArray(r.shape,c.data.get(r.dataId).values),d=w.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:b,strideHeight:I,strideWidth:_,filterHeight:E,filterWidth:S,dilationHeight:D,dilationWidth:M,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);w.assert(i.rank===R.length,()=>`Error in ${ry}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let L=w.toNestedArray(R,c.data.get(i.dataId).values),G=w.makeZerosNestedTypedArray(r.shape,r.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*I-b.top;for(let Z=0;Z<x;++Z){let se=Z*_-b.left;for(let ee=0;ee<h;++ee){let oe=Number.MIN_SAFE_INTEGER,le=K<0?0:K,de=se<0?0:se;for(let ge=0;ge<E;++ge){let pe=K+ge*D;if(pe>=0&&pe<f)for(let ve=0;ve<S;++ve){let xe=se+ve*M;if(xe>=0&&xe<m){let we=u[q][pe][xe][ee]+d[ge][ve][ee];we>oe&&(oe=we,le=pe,de=xe)}}}G[q][le][de][ee]+=L[q][X][Z][ee]}}}return{dataId:c.write(w.toTypedArray(G,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function wl(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"sum");let a;o.dtype==="bool"?a=hi({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=ar({inputs:{x:o},backend:e});let l=a.shape.length,c=w.parseAxisParam(i,a.shape),u=T.getAxesPermutation(c,l),d=c,p=a;u!=null&&(p=yn({inputs:{x:a},backend:e,attrs:{perm:u}}),d=T.getInnerMostAxes(d.length,l)),T.assertAxesAreInnerMostDims("sum",d,p.shape.length);let[f,m]=T.computeOutAndReduceShapes(p.shape,d),h=T.upcastType(p.dtype,"int32"),g=qm(e,f,h),x=w.sizeFromShape(m),b=e.data.get(g.dataId).values,I=e.data.get(p.dataId).values;for(let _=0;_<b.length;++_){let E=_*x,S=0;for(let D=0;D<x;++D)S+=I[E+D];b[_]=S}if(s){let _=T.expandShapeToKeepDim(g.shape,c),E=g;g=ot({inputs:{x:g},backend:e,attrs:{shape:_}}),e.disposeIntermediateTensorInfo(E)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(p),g}var cW={kernelName:Bc,backendName:"cpu",kernelFunc:wl};function bge(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:x,expandDims:b}=T.getEinsumPermutation(f,l[g]),I;T.isIdentityPermutation(x)?I=i[g]:(I=yn({inputs:{x:i[g]},backend:e,attrs:{perm:x}}),m.push(I));let _=I.shape.slice();for(let E=0;E<b.length;++E)_.splice(b[E],0,1);w.arraysEqual(I.shape,_)||(I=ot({inputs:{x:I},backend:e,attrs:{shape:_}}),m.push(I)),p===null?p=I:(p=rp({inputs:{a:I,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=wl({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var uW={kernelName:Bb,backendName:"cpu",kernelFunc:bge};function wge(t){let{inputs:n,backend:e}=t,{dy:r,y:o}=n;J([r,o],"eluGrad");let i=new Float32Array(w.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let c=s[l];c>=1?i[l]=a[l]:i[l]=a[l]*(c+1)}return e.makeTensorInfo(o.shape,"float32",i)}var dW={kernelName:Hf,backendName:"cpu",kernelFunc:wge};var Cge=rt((t,n)=>t===n?1:0),xA=mt(pd,Cge,null,"bool"),pW={kernelName:pd,backendName:"cpu",kernelFunc:xA};var _ge=T.ERF_P,Ige=T.ERF_A1,Ege=T.ERF_A2,Sge=T.ERF_A3,Tge=T.ERF_A4,Dge=T.ERF_A5,Nge=Oe(Ia,t=>{let n=Math.sign(t),e=Math.abs(t),r=1/(1+_ge*e);return n*(1-((((Dge*r+Tge)*r+Sge)*r+Ege)*r+Ige)*r*Math.exp(-e*e))}),fW={kernelName:Ia,backendName:"cpu",kernelFunc:Nge};function Jm(t){let{inputs:n,backend:e,attrs:r}=t,{input:o}=n,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(w.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),ot({inputs:{x:o},backend:e,attrs:{shape:a}})}var mW={kernelName:yc,backendName:"cpu",kernelFunc:Jm};var kge=rt((t,n)=>t/n),Ky=mt(Ca,kge),Xy={kernelName:Ca,backendName:"cpu",kernelFunc:Ky};function BC(t,n,e){let r=t.shape,o=r[0],i=r[1],s=e.data.get(t.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[o,i],u=w.sizeFromShape(c),d=w.getTypedArrayFromDType("float32",u),p=w.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let x=vi({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),b=vi({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),I=Nn({inputs:{real:x,imag:b},backend:e}),{real:_,imag:E}=Age(I,n,e),S=T.mergeRealAndImagArrays(_,E);for(let D=0;D<i;D++){let M=T.getComplexWithIndex(S,D);d[g*i+D]=M.real,p[g*i+D]=M.imag}e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(b),e.disposeIntermediateTensorInfo(I)}let f=e.makeTensorInfo(c,"float32",d),m=e.makeTensorInfo(c,"float32",p),h=Nn({inputs:{real:f,imag:m},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),h}function Age(t,n,e){let r=w.sizeFromShape(t.shape),o=e.data.get(t.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(Rge(r)){let a=bA(i,s,r,n,e),l=[t.shape[0],t.shape[1]];if(n){let c=e.makeTensorInfo(l,"float32",a.real),u=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",w.createScalarValue(r,"float32")),p=ar({inputs:{x:d},backend:e}),f=Xy.kernelFunc({inputs:{a:c,b:d},backend:e}),m=Xy.kernelFunc({inputs:{a:u,b:p},backend:e}),h=e.data.get(f.dataId).values,g=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),{real:h,imag:g}}return a}else{let a=T.mergeRealAndImagArrays(i,s),l=Mge(a,r,n);return T.splitRealAndImagArrays(l)}}function Rge(t){return(t&t-1)===0}function bA(t,n,e,r,o){if(e===1)return{real:t,imag:n};let i=T.mergeRealAndImagArrays(t,n),s=e/2,a=T.complexWithEvenIndex(i),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),p=o.makeTensorInfo(u,"float32",c),f=Nn({inputs:{real:d,imag:p},backend:o}),m=T.complexWithOddIndex(i),h=m.real,g=m.imag,x=[h.length],b=o.makeTensorInfo(x,"float32",h),I=o.makeTensorInfo(x,"float32",g),_=Nn({inputs:{real:b,imag:I},backend:o}),E=bA(l,c,s,r,o),S=E.real,D=E.imag,M=[S.length],R=o.makeTensorInfo(M,"float32",S),L=o.makeTensorInfo(M,"float32",D),G=Nn({inputs:{real:R,imag:L},backend:o}),W=bA(h,g,s,r,o),q=W.real,X=W.imag,K=[q.length],Z=o.makeTensorInfo(K,"float32",q),se=o.makeTensorInfo(K,"float32",X),ee=Nn({inputs:{real:Z,imag:se},backend:o}),oe=T.exponents(e,r),le=[oe.real.length],de=o.makeTensorInfo(le,"float32",oe.real),ge=o.makeTensorInfo(le,"float32",oe.imag),pe=Nn({inputs:{real:de,imag:ge},backend:o}),ve=rp({inputs:{a:pe,b:ee},backend:o}),xe=bl({inputs:{a:G,b:ve},backend:o}),we=qy({inputs:{a:G,b:ve},backend:o}),Ne=mi({inputs:{input:xe},backend:o}),Le=mi({inputs:{input:we},backend:o}),Be=Ns({inputs:{input:xe},backend:o}),Xe=Ns({inputs:{input:we},backend:o}),ct=uu({inputs:[Ne,Le],backend:o,attrs:{axis:0}}),Bt=uu({inputs:[Be,Xe],backend:o,attrs:{axis:0}}),hn=o.data.get(ct.dataId).values,rn=o.data.get(Bt.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(I),o.disposeIntermediateTensorInfo(_),o.disposeIntermediateTensorInfo(R),o.disposeIntermediateTensorInfo(L),o.disposeIntermediateTensorInfo(G),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(se),o.disposeIntermediateTensorInfo(ee),o.disposeIntermediateTensorInfo(de),o.disposeIntermediateTensorInfo(ge),o.disposeIntermediateTensorInfo(pe),o.disposeIntermediateTensorInfo(ve),o.disposeIntermediateTensorInfo(xe),o.disposeIntermediateTensorInfo(we),o.disposeIntermediateTensorInfo(Ne),o.disposeIntermediateTensorInfo(Be),o.disposeIntermediateTensorInfo(Le),o.disposeIntermediateTensorInfo(Xe),o.disposeIntermediateTensorInfo(ct),o.disposeIntermediateTensorInfo(Bt),{real:hn,imag:rn}}function Mge(t,n,e){let r=new Float32Array(n*2);for(let o=0;o<n;o++){let i=0,s=0;for(let a=0;a<n;a++){let l=T.exponent(o*a,n,e),c=T.getComplexWithIndex(t,a);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}e&&(i/=n,s/=n),T.assignToTypedArray(r,i,s,o)}return r}function Fge(t){let{inputs:n,backend:e}=t,{input:r}=n,o=w.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=ot({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=BC(a,!1,e),c=ot({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var hW={kernelName:qf,backendName:"cpu",kernelFunc:Fge};function Yy(t){let{backend:n,attrs:e}=t,{shape:r,value:o,dtype:i}=e,s=i||w.inferDtype(o),a=w.getArrayFromDType(s,w.sizeFromShape(r));return Oge(a,o,s),n.makeTensorInfo(r,s,a)}var gW={kernelName:Kf,backendName:"cpu",kernelFunc:Yy};function Oge(t,n,e){t.fill(n)}var yW={kernelName:zb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,o=e,i=w.getTypedArrayFromDType(r.dtype,w.sizeFromShape(r.shape)),[s,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let p=0;p<s;p++){let f=p*l*a*c;for(let m=0;m<a;m++){let h=m*(l*c);for(let g=0;g<l;g++){let x=g*c;for(let b=0;b<c;b++){let _=[s,m,g,b][2],E=Math.round(l-_),S=f+h+x+b,D=u[S];if(E>=0&&E<l){let M=E*c,R=f+h+M+b;D=u[R]}i[S]=D}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var Pge=rt((t,n)=>Math.floor(t/n)),Lge=mt(Da,Pge,null,"int32"),vW={kernelName:Da,backendName:"cpu",kernelFunc:Lge};function $ge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=yA({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=bl({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=Zm(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var xW={kernelName:wd,backendName:"cpu",kernelFunc:$ge};function Vge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=vA({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=bl({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=Zm(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var bW={kernelName:Cd,backendName:"cpu",kernelFunc:Vge};function Bge(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=w.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,c,u,d]=T.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(l,r.dtype,[]);let p=Te([c,u],r.dtype),f=e.data.get(o.dataId).values,m=e.data.get(r.dataId).values;for(let h=0;h<c;h++){let g=[],x=0;for(let b=0;b<a;b++){let I=f[h*a+b];x+=I*d[b],g.push(I)}if(x<0||x>=i/u)throw new Error(`Invalid indices: ${g} does not index into ${r.shape}`);for(let b=0;b<u;b++)p.values[h*u+b]=m[x*u+b]}return e.makeTensorInfo(l,p.dtype,p.values)}var wW={kernelName:Ub,backendName:"cpu",kernelFunc:Bge};function zge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r;J([o,i],"gatherV2");let l=a;a==null&&(l=0);let c=w.sizeFromShape(i.shape),u=w.parseAxisParam(s,o.shape)[0],d=T.segment_util.collectGatherOpShapeInfo(o,i,u,l),p=ot({inputs:{x:o},backend:e,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=ot({inputs:{x:i},backend:e,attrs:{shape:[d.batchSize,c/d.batchSize]}}),m=[d.batchSize,d.outerSize,c/d.batchSize,d.sliceSize],h=e.bufferSync(f),g=e.bufferSync(p),x=DC(g,h,m);return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.makeTensorInfo(d.outputShape,x.dtype,x.values)}var CW={kernelName:xc,backendName:"cpu",kernelFunc:zge};var Uge=rt((t,n)=>t>=n?1:0),jge=mt(Na,Uge,null,"bool"),_W={kernelName:Na,backendName:"cpu",kernelFunc:jge};function Gge(t){let{inputs:n,backend:e}=t,{input:r}=n,o=w.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=ot({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=BC(a,!0,e),c=ot({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var IW={kernelName:Xf,backendName:"cpu",kernelFunc:Gge};var Wge=Oe(ka,t=>Number.isFinite(t)?1:0,"bool"),EW={kernelName:ka,backendName:"cpu",kernelFunc:Wge};var Hge=Oe(Aa,t=>Math.abs(t)===1/0?1:0,"bool"),SW={kernelName:Aa,backendName:"cpu",kernelFunc:Hge};var qge=Oe(Ra,t=>Number.isNaN(t)?1:0,"bool"),TW={kernelName:Ra,backendName:"cpu",kernelFunc:qge};var Kge=rt((t,n)=>t<=n?1:0),Xge=mt(hd,Kge,null,"bool"),DW={kernelName:hd,backendName:"cpu",kernelFunc:Xge};function Yge(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=NC(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var NW={kernelName:jb,backendName:"cpu",kernelFunc:Yge};var Zge=Oe(Fa,t=>Math.log1p(t)),kW={kernelName:Fa,backendName:"cpu",kernelFunc:Zge};var Qge=rt((t,n)=>t&&n),Jge=mt(gd,Qge,null,"bool"),AW={kernelName:gd,backendName:"cpu",kernelFunc:Jge};var eye=Oe(yd,t=>t?0:1,"bool"),RW={kernelName:yd,backendName:"cpu",kernelFunc:eye};var tye=rt((t,n)=>t||n),nye=mt(vd,tye,null,"bool"),MW={kernelName:vd,backendName:"cpu",kernelFunc:nye};function rye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r;J(o,"LRN");let c=o.shape[3],u=c-1,d=e.data.get(o.dataId).values,p=w.sizeFromShape(o.shape),f=new Float32Array(p);function m(h){let g=h%c,x=h-g+Math.max(0,g-i),b=h-g+Math.min(g+i,u),I=0;for(;x<=b;x++){let _=d[x];I+=_*_}return I}for(let h=0;h<p;h++){let g=m(h),x=d[h]*Math.pow(s+a*g,-l);f[h]=x}return e.makeTensorInfo(o.shape,o.dtype,f)}var FW={kernelName:wc,backendName:"cpu",kernelFunc:rye};function oye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r;J(s,"LRNGrad");let d=w.sizeFromShape(s.shape),p=s.shape[3],f=e.data.get(s.dataId).values,m=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values,g=new Float32Array(d),x=d;for(let b=0;b<x;b++){let I=b%p,_=b-I+Math.max(0,I-a),E=b-I+Math.min(p,I+a+1),S=0;for(let D=_;D<E;D++)S+=Math.pow(m[D],2);S=c*S+l;for(let D=_;D<E;D++){let M=-2*c*u*m[D]*h[b]/S;b===D&&(M+=Math.pow(S,-u)),M*=f[b],g[D]+=M}}return e.makeTensorInfo(s.shape,o.dtype,g)}var OW={kernelName:Zf,backendName:"cpu",kernelFunc:oye};function wA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,c=l.length,u=w.parseAxisParam(i,l),d=u,p=T.getAxesPermutation(d,c),f=a.data.get(o.dataId).values;if(p!=null){let _=new Array(c);for(let E=0;E<_.length;E++)_[E]=l[p[E]];f=Ym(f,l,o.dtype,p,_),d=T.getInnerMostAxes(d.length,c),l=_}J(o,"max"),T.assertAxesAreInnerMostDims("max",d,c);let[m,h]=T.computeOutAndReduceShapes(l,d),g=w.sizeFromShape(h),x=kC(f,g,m,o.dtype),b=a.write(x,m,o.dtype),I=m;return s&&(I=T.expandShapeToKeepDim(m,u)),{dataId:b,shape:I,dtype:o.dtype}}var PW={kernelName:Cc,backendName:"cpu",kernelFunc:wA};function iye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;J(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))d=ar({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=w.computeStrides(o.shape),m=Qm(p,o.shape,o.dtype,f,u,"max");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var LW={kernelName:_c,backendName:"cpu",kernelFunc:iye};function sye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;J(o,"maxPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=VC(d,o.shape,o.dtype,w.computeStrides(o.shape),u,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var $W={kernelName:Ic,backendName:"cpu",kernelFunc:sye};function aye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;J([o,i],"maxPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=e.bufferSync(i),p=RG(d,u),f=u.strideDepth,m=u.strideHeight,h=u.strideWidth,g=u.dilationDepth,x=u.dilationHeight,b=u.dilationWidth,I=u.effectiveFilterDepth,_=u.effectiveFilterHeight,E=u.effectiveFilterWidth,S=I-1-u.padInfo.front,D=E-1-u.padInfo.left,M=_-1-u.padInfo.top,R=Te(i.shape,"float32"),L=e.bufferSync(o);for(let G=0;G<u.batchSize;++G)for(let W=0;W<u.inChannels;++W)for(let q=0;q<u.inDepth;++q)for(let X=0;X<u.inHeight;++X)for(let K=0;K<u.inWidth;++K){let Z=q-S,se=X-M,ee=K-D,oe=0;for(let le=0;le<I;le+=g){let de=(Z+le)/f;if(!(de<0||de>=u.outDepth||Math.floor(de)!==de))for(let ge=0;ge<_;ge+=x){let pe=(se+ge)/m;if(!(pe<0||pe>=u.outHeight||Math.floor(pe)!==pe))for(let ve=0;ve<E;ve+=b){let xe=(ee+ve)/h;if(xe<0||xe>=u.outWidth||Math.floor(xe)!==xe)continue;let we=I*_*E-1-p.get(G,de,pe,xe,W),Ne=le*_*E+ge*E+ve,Le=we===Ne?1:0;if(Le===0)continue;let Be=L.get(G,de,pe,xe,W);oe+=Be*Le}}}R.set(oe,G,q,X,K,W)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}var VW={kernelName:Jf,backendName:"cpu",kernelFunc:aye};function lye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;J([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=e.data.get(a.dataId).values,m=Te(p.outShape,a.dtype,$C(f,a.shape,a.dtype,p).values),h=p.strideHeight,g=p.strideWidth,x=p.dilationHeight,b=p.dilationWidth,I=p.effectiveFilterHeight,_=p.effectiveFilterWidth,E=_-1-p.padInfo.left,S=I-1-p.padInfo.top,D=Te(a.shape,"float32"),M=e.data.get(o.dataId).values,R=Te(o.shape,"float32",M);for(let L=0;L<p.batchSize;++L)for(let G=0;G<p.inChannels;++G)for(let W=0;W<p.inHeight;++W)for(let q=0;q<p.inWidth;++q){let X=W-S,K=q-E,Z=0;for(let se=0;se<I;se+=x){let ee=(X+se)/h;if(!(ee<0||ee>=p.outHeight||Math.floor(ee)!==ee))for(let oe=0;oe<_;oe+=b){let le=(K+oe)/g;if(le<0||le>=p.outWidth||Math.floor(le)!==le)continue;let de=I*_-1-m.get(L,ee,le,G),ge=se*_+oe,pe=de===ge?1:0;if(pe===0)continue;let ve=R.get(L,ee,le,G);Z+=ve*pe}}D.set(Z,L,W,q,G)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}var BW={kernelName:Qf,backendName:"cpu",kernelFunc:lye};function zW(t,n,e,r,o){let i=w.computeStrides(n),s=Qm(t,n,e,i,o,"max"),a=$C(t,n,e,o,!0,r);return[s.values,a.values]}var UW={kernelName:Gb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;J(r,"MaxPoolWithArgmax");let c=l.data.get(r.dataId).values,u=T.computePool2DInfo(r.shape,o,i,[1,1],s),[d,p]=zW(c,r.shape,r.dtype,a,u),f=l.write(d,u.outShape,r.dtype),m=l.write(p,u.outShape,r.dtype);return[{dataId:f,shape:u.outShape,dtype:r.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};function cye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=w.parseAxisParam(i,o.shape),c=T.computeOutAndReduceShapes(o.shape,a)[1],u=w.sizeFromShape(c),d=[],p=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(p);let f=hi({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});d.push(f);let m=Ky({inputs:{a:f,b:p},backend:e});d.push(m);let h=wl({inputs:{x:m},backend:e,attrs:{axis:i,keepDims:s}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),h}var jW={kernelName:Ec,backendName:"cpu",kernelFunc:cye};function uye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;J(o,"min");let a=w.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=yn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=w.sizeFromShape(p),m=w.makeZerosTypedArray(w.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let x=0;x<m.length;++x){let b=x*f,I=h[b];for(let _=0;_<f;++_){let E=h[b+_];E<I&&(I=E)}m[x]=I}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let x=T.expandShapeToKeepDim(d,a),b=ot({inputs:{x:g},backend:e,attrs:{shape:x}});return e.disposeIntermediateTensorInfo(g),b}return g}var GW={kernelName:Sc,backendName:"cpu",kernelFunc:uye};function dye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,mode:s}=r;J(o,"mirrorPad");let a=i.map((I,_)=>I[0]+o.shape[_]+I[1]),l=i.map(I=>I[0]),c=i.map((I,_)=>I[0]+o.shape[_]),u=s==="reflect"?0:1,d=e.data.get(o.dataId).values,p=o.shape.length,f=w.computeStrides(o.shape),m=w.sizeFromShape(a),h=a.length,g=w.computeStrides(a),x=w.getTypedArrayFromDType(o.dtype,m);for(let I=0;I<m;I++){let _=w.indexToLoc(I,h,g);for(let S=0;S<h;S++)_[S]<l[S]?_[S]=l[S]*2-_[S]-u:_[S]>=c[S]&&(_[S]=(c[S]-1)*2-_[S]+u);_=_.map((S,D)=>S-l[D]);let E=w.locToIndex(_,p,f);x[I]=d[E]}return{dataId:e.write(x,a,o.dtype),shape:a,dtype:o.dtype}}var WW={kernelName:Tc,backendName:"cpu",kernelFunc:dye};var pye=rt((t,n)=>{let e=t%n;return t<0&&n<0||t>=0&&n>=0?e:(e+n)%n}),fye=mt(La,pye),HW={kernelName:La,backendName:"cpu",kernelFunc:fye};var cH=mh(aH());function DA(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=w.parseAxisParam([a],o.shape),c=wA({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=T.expandShapeToKeepDim(c.shape,l),d=ot({inputs:{x:c},backend:e,attrs:{shape:u}}),p=qy({inputs:{a:o,b:d},backend:e}),f=Kk({inputs:{x:p},backend:e}),m=wl({inputs:{x:f},backend:e,attrs:{axis:l,keepDims:!1}}),h=ot({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Ky({inputs:{a:f,b:h},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var lH={kernelName:jc,backendName:"cpu",kernelFunc:DA};function bye(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r;J(o,"multinomial");let l=a?o:DA({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,p=[c,i],f=w.makeZerosTypedArray(w.sizeFromShape(p),"int32");for(let m=0;m<c;++m){let h=m*u,g=new Float32Array(u-1);g[0]=d[h];for(let I=1;I<g.length;++I)g[I]=g[I-1]+d[h+I];let x=cH.alea(s.toString()),b=m*i;for(let I=0;I<i;++I){let _=x();f[b+I]=g.length;for(let E=0;E<g.length;E++)if(_<g[E]){f[b+I]=E;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(p,"int32",f)}var uH={kernelName:Wb,backendName:"cpu",kernelFunc:bye};var wye=ir.nonMaxSuppressionV3Impl;function Cye(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;J(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,{selectedIndices:d}=wye(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var dH={kernelName:Hb,backendName:"cpu",kernelFunc:Cye};var _ye=ir.nonMaxSuppressionV4Impl;function Iye(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;J(o,"NonMaxSuppressionPadded");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=_ye(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var pH={kernelName:qb,backendName:"cpu",kernelFunc:Iye};var Eye=ir.nonMaxSuppressionV5Impl;function Sye(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;J(o,"NonMaxSuppressionWithScore");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:x}=Eye(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var fH={kernelName:Kb,backendName:"cpu",kernelFunc:Sye};function Tye(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r;J(o,"oneHot");let l=w.sizeFromShape(o.shape),c=new Float32Array(l*i);c.fill(a);let u=e.data.get(o.dataId).values;for(let d=0;d<l;++d)u[d]>=0&&u[d]<i&&(c[d*i+u[d]]=s);return e.makeTensorInfo([...o.shape,i],"int32",c)}var mH={kernelName:kc,backendName:"cpu",kernelFunc:Tye};function Zy(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=mi({inputs:{input:r},backend:e}),i=Zy({inputs:{x:o},backend:e}),s=Ns({inputs:{input:r},backend:e}),a=Zy({inputs:{x:s},backend:e}),l=Nn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Yy({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var hH={kernelName:qc,backendName:"cpu",kernelFunc:Zy};function gH(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=mi({inputs:{input:r},backend:e}),i=gH({inputs:{x:o},backend:e}),s=Ns({inputs:{input:r},backend:e}),a=Zy({inputs:{x:s},backend:e}),l=Nn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Yy({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var yH={kernelName:Nc,backendName:"cpu",kernelFunc:gH};function NA(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return Jm({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{w.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),w.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=Jm({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=uu({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var vH={kernelName:Ac,backendName:"cpu",kernelFunc:NA};function Dye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;J(o,"pad");let a=i.map((b,I)=>b[0]+o.shape[I]+b[1]),l=i.map(b=>b[0]),c=e.data.get(o.dataId).values,u=w.sizeFromShape(o.shape),d=o.shape.length,p=w.computeStrides(o.shape),f=w.sizeFromShape(a),m=a.length,h=w.computeStrides(a),g=w.getTypedArrayFromDType(o.dtype,f);s!==0&&g.fill(s);for(let b=0;b<u;b++){let _=w.indexToLoc(b,d,p).map((S,D)=>S+l[D]),E=w.locToIndex(_,m,h);g[E]=c[b]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var UC={kernelName:Rc,backendName:"cpu",kernelFunc:Dye};var Nye=rt((t,n)=>Math.pow(t,n)),kye=mt(Va,Nye),xH={kernelName:Va,backendName:"cpu",kernelFunc:kye};function Aye(t){let{backend:n,attrs:e}=t,{start:r,stop:o,dtype:i,step:s}=e,a=AC(r,o,s,i);return n.makeTensorInfo([a.length],i,a)}var bH={kernelName:tm,backendName:"cpu",kernelFunc:Aye};var Rye=Oe(Ba,t=>1/t),wH={kernelName:Ba,backendName:"cpu",kernelFunc:Rye};function Mye(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;J(o,"resizeBilinear");let l=w.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(w.sizeFromShape([d,c,u,m])),x=[i&&c>1?p-1:p,i&&u>1?f-1:f],b=[i&&c>1?c-1:c,i&&u>1?u-1:u],I=0,_=x[0]/b[0],E=x[1]/b[1];for(let S=0;S<d;S++)for(let D=0;D<c;D++){let M;s?M=_*(D+.5)-.5:M=_*D;let R=Math.max(0,Math.floor(M)),L=M-R,G=Math.min(p-1,Math.ceil(M)),W=S*l[0]+R*l[1],q=S*l[0]+G*l[1];for(let X=0;X<u;X++){let K;s?K=E*(X+.5)-.5:K=E*X;let Z=Math.max(0,Math.floor(K)),se=K-Z,ee=Math.min(f-1,Math.ceil(K)),oe=W+Z*l[2],le=q+Z*l[2],de=W+ee*l[2],ge=q+ee*l[2];for(let pe=0;pe<m;pe++){let ve=h[oe+pe],xe=h[le+pe],we=h[de+pe],Ne=h[ge+pe],Le=ve+(we-ve)*se,Be=xe+(Ne-xe)*se,Xe=Le+(Be-Le)*L;g[I++]=Xe}}}return e.makeTensorInfo([d,c,u,m],"float32",g)}var CH={kernelName:Pc,backendName:"cpu",kernelFunc:Mye};function Fye(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;J([i,o],"resizeBilinearGrad");let a=w.computeStrides(o.shape),[l,c,u,d]=o.shape,[,p,f]=i.shape,m=new Float32Array(l*c*u*d),h=[s&&p>1?c-1:c,s&&f>1?u-1:u],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],x=h[0]/g[0],b=h[1]/g[1],I=e.data.get(i.dataId).values,_=0;for(let E=0;E<l;E++){let S=E*a[0];for(let D=0;D<p;D++){let M=D*x,R=Math.floor(M),L=Math.min(Math.ceil(M),c-1),G=S+R*a[1],W=S+L*a[1],q=M-R,X=1-q;for(let K=0;K<f;K++){let Z=K*b,se=Math.floor(Z),ee=Math.min(Math.ceil(Z),u-1),oe=Z-se,le=1-oe,de=G+se*a[2],ge=G+ee*a[2],pe=W+se*a[2],ve=W+ee*a[2],xe=X*le,we=X*oe,Ne=q*le,Le=q*oe;for(let Be=0;Be<d;Be++){let Xe=I[_++];m[de+Be]+=Xe*xe,m[ge+Be]+=Xe*we,m[pe+Be]+=Xe*Ne,m[ve+Be]+=Xe*Le}}}}return e.makeTensorInfo([l,u,c,d],"float32",m)}var _H={kernelName:om,backendName:"cpu",kernelFunc:Fye};function Oye(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;J(o,"resizeNearestNeighbor");let l=w.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(d*c*u*m),x=[i&&c>1?p-1:p,i&&u>1?f-1:f],b=[i&&c>1?c-1:c,i&&u>1?u-1:u],I=x[0]/b[0],_=x[1]/b[1],E=0;for(let S=0;S<d;S++){let D=S*l[0];for(let M=0;M<c;M++){let R=s?I*(M+.5):I*M,L=Math.min(p-1,i?Math.round(R):Math.floor(R));s&&(L=Math.max(0,L));let G=D+L*l[1];for(let W=0;W<u;W++){let q=s?_*(W+.5):_*W,X=Math.min(f-1,i?Math.round(q):Math.floor(q));s&&(X=Math.max(0,X));let K=G+X*l[2];for(let Z=0;Z<m;Z++){let se=h[K+Z];g[E++]=se}}}}return e.makeTensorInfo([d,c,u,m],o.dtype,g)}var IH={kernelName:Oc,backendName:"cpu",kernelFunc:Oye};function Pye(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;J([i,o],"resizeNearestNeighborGrad");let a=w.computeStrides(o.shape),l=w.computeStrides(i.shape),[c,u,d,p]=o.shape,[,f,m]=i.shape,h=new Float32Array(c*u*d*p),g=e.data.get(i.dataId).values,x=[s&&f>1?u-1:u,s&&m>1?d-1:d],b=[s&&f>1?f-1:f,s&&m>1?m-1:m],I=x[0]/b[0],_=x[1]/b[1],E=1/I,S=1/_,D=Math.ceil(E)*2+2,M=Math.ceil(S)*2+2;for(let R=0;R<c;R++){let L=R*a[0];for(let G=0;G<u;G++){let W=L+G*a[1],q=Math.floor(G*E),X=Math.floor(q-D/2);for(let K=0;K<d;K++){let Z=W+K*a[2],se=Math.floor(K*S),ee=Math.floor(se-M/2);for(let oe=0;oe<p;oe++){let le=0;for(let de=0;de<D;de++){let ge=de+X;if(ge<0||ge>=f)continue;let pe=L+ge*l[1],ve=ge*I,xe=Math.min(u-1,s?Math.round(ve):Math.floor(ve));if(G===xe)for(let we=0;we<M;we++){let Ne=we+ee;if(Ne<0||Ne>=m)continue;let Le=pe+Ne*l[2],Be=Ne*_,Xe=Math.min(d-1,s?Math.round(Be):Math.floor(Be));K===Xe&&(le+=g[Le+oe])}}h[Z+oe]=le}}}}return e.makeTensorInfo(o.shape,o.dtype,h)}var EH={kernelName:rm,backendName:"cpu",kernelFunc:Pye};function Lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r;J(o,"reverse");let s=o.shape.length,a=w.parseAxisParam(i,o.shape);if(s===0)return ar({inputs:{x:o},backend:e});let l=new At(o.shape,o.dtype),c=e.bufferSync(o);for(let u=0;u<l.size;u++){let d=l.indexToLoc(u),p=d.slice();a.forEach(f=>p[f]=o.shape[f]-1-p[f]),l.set(c.get(...p),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var SH={kernelName:Lc,backendName:"cpu",kernelFunc:Lye};var TH={kernelName:ew,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=w.getTypedArrayFromDType(r.dtype,w.sizeFromShape(r.shape)),[c,u,d,p]=r.shape,[f,m]=T.getImageCenter(s,u,d),h=255,g=Math.sin(o),x=Math.cos(o),b=a.data.get(r.dataId).values;for(let _=0;_<c;_++){let E=_*d*u*p;for(let S=0;S<u;S++){let D=S*(d*p);for(let M=0;M<d;M++){let R=M*p;for(let L=0;L<p;L++){let G=[c,S,M,L],W=G[2],q=G[1],X=(W-f)*x-(q-m)*g,K=(W-f)*g+(q-m)*x;X=Math.round(X+f),K=Math.round(K+m);let Z=i;if(typeof i!="number"&&(L===3?Z=h:Z=i[L]),X>=0&&X<d&&K>=0&&K<u){let ee=K*(d*p),oe=X*p,le=E+ee+oe+L;Z=b[le]}let se=E+D+R+L;l[se]=Z}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var $ye=Oe(ja,t=>{let n=Math.floor(t);return t-n<.5?Math.floor(t):t-n>.5?Math.ceil(t):n%2===0?n:n+1}),DH={kernelName:ja,backendName:"cpu",kernelFunc:$ye};function jC(t,n,e,r,o,i,s,a,l,c){let u=[r/o,o],d=t.values,p=n.values;if(r===0)return Te(e,n.dtype);let f=Te(u,n.dtype);f.values.fill(l);for(let m=0;m<i;m++){let h=[],g=0;for(let x=0;x<s;x++){let b=d[m*s+x];h.push(b),g+=b*a[x]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${h} does not index into ${e}`);for(let x=0;x<o;x++)c?f.values[g*o+x]+=p[m*o+x]:f.values[g*o+x]=n.rank===0?p[0]:p[m*o+x]}return f}function Vye(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=!0,f=e.bufferSync(o),m=e.bufferSync(i),h=jC(f,m,s,d,c,l,a,u,0,p);return e.makeTensorInfo(s,h.dtype,h.values)}var NH={kernelName:Xb,backendName:"cpu",kernelFunc:Vye};function Bye(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n;J([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Dn(o.dtype,i.dtype),d=w.makeZerosTypedArray(w.sizeFromShape(o.shape),u),p=0,f=s===0||s>1||o.shape.length===1?1:w.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<f;h++)a[m]===1?d[p++]=l[m]:d[p++]=c[m];return e.makeTensorInfo(o.shape,u,d)}var kH={kernelName:$c,backendName:"cpu",kernelFunc:Bye};var zye=T.SELU_SCALEALPHA,Uye=T.SELU_SCALE,jye=Oe(Wa,t=>t>=0?Uye*t:zye*(Math.exp(t)-1)),AH={kernelName:Wa,backendName:"cpu",kernelFunc:jye};var Gye=Oe(Ka,t=>t<0?-1:t>0?1:0),RH={kernelName:Ka,backendName:"cpu",kernelFunc:Gye};var Wye=Oe(Ha,t=>Math.sin(t)),MH={kernelName:Ha,backendName:"cpu",kernelFunc:Wye};var Hye=Oe(qa,t=>Math.sinh(t)),FH={kernelName:qa,backendName:"cpu",kernelFunc:Hye};var qye=11920928955078125e-23,OH=Math.log(qye)+2,Kye=Oe(Ya,t=>{let n=t>-OH,e=t<OH,r=Math.exp(t),o;return e?o=r:n?o=t:o=Math.log(1+r),o}),PH={kernelName:Ya,backendName:"cpu",kernelFunc:Kye};function Xye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;J([o],"spaceToBatchND");let a=w.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let S=1+i.length;S<o.shape.length;++S)l.push([0,0]);let c=UC.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),u=T.getReshaped(c.shape,i,a,!1),d=T.getPermuted(u.length,i.length,!1),p=T.getReshapedPermuted(c.shape,i,a,!1),h=ot({inputs:{x:c},backend:e,attrs:{shape:u}}),b=yn({inputs:{x:h},backend:e,attrs:{perm:d}}),E=ot({inputs:{x:b},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(b),E}var LH={kernelName:zc,backendName:"cpu",kernelFunc:Xye};function Yye(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=e.data.get(s.dataId).values[0],[d,p,f,m,h]=RC(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var $H={kernelName:Yb,backendName:"cpu",kernelFunc:Yye};function Zye(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[c,u,d]=MC(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var VH={kernelName:Zb,backendName:"cpu",kernelFunc:Zye};function Qye(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1,m=e.bufferSync(o),h=e.bufferSync(i),g=e.data.get(s.dataId).values[0],x=jC(m,h,a,p,u,c,l,d,g,f);return e.makeTensorInfo(a,x.dtype,x.values)}var BH={kernelName:Qb,backendName:"cpu",kernelFunc:Qye};function Jye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=w.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{let p=[...u];p[a]=d;let f=vi({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[a]+=d,f})}var zH={kernelName:Uc,backendName:"cpu",kernelFunc:Jye};var e0e=Oe(Za,t=>Math.sqrt(t)),UH={kernelName:Za,backendName:"cpu",kernelFunc:e0e};var jH={kernelName:im,backendName:"cpu",kernelFunc:({inputs:t,backend:n})=>{let{x:e}=t,r=n;J(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var t0e=Oe(nl,(t,n)=>{let e=n;return isNaN(t)?NaN:t>0?1:e.alpha}),GH={kernelName:nl,backendName:"cpu",kernelFunc:t0e};function n0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r;J(o,"stridedSlice");let{nonStrided:f,$begin:m,$strides:h,size:g,newShape:x,outShape:b}=tr.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I=ot({inputs:{x:o},backend:e,attrs:{shape:x}}),_;if(f){let S=vi({inputs:{x:I},backend:e,attrs:{begin:m,size:g}});_=ot({inputs:{x:S},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(S)}else if(b.some(S=>S===0))_=e.makeTensorInfo(b,o.dtype,[]);else{let S=e.bufferSync(I),D=FC(b,S,h,m);_=e.makeTensorInfo(D.shape,D.dtype,D.values)}let E=ot({inputs:{x:_},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(I),e.disposeIntermediateTensorInfo(_),E}var WH={kernelName:sm,backendName:"cpu",kernelFunc:n0e};var r0e=Oe(el,t=>Math.tan(t)),HH={kernelName:el,backendName:"cpu",kernelFunc:r0e};var o0e=Oe(tl,t=>Math.tanh(t)),qH={kernelName:tl,backendName:"cpu",kernelFunc:o0e};function i0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;J(o,"tile");let s=OC(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var KH={kernelName:xs,backendName:"cpu",kernelFunc:i0e};function s0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r;J(o,"topk");let a=e.data.get(o.dataId).values,[l,c]=PC(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var XH={kernelName:am,backendName:"cpu",kernelFunc:s0e};function a0e(t){let{inputs:n,attrs:e,backend:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=e,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],x=w.computeStrides(o.shape),b=x[0],I=x[1],_=x[2],E=w.getTypedArrayFromDType(o.dtype,w.sizeFromShape(g));E.fill(l);let S=r.data.get(o.dataId).values,D=r.data.get(i.dataId).values;for(let R=0;R<u;++R){let L=i.shape[0]===1?D:D.subarray(R*8,R*8+8);for(let G=0;G<m;++G)for(let W=0;W<h;++W)for(let q=0;q<f;++q){let X,K=L[6]*W+L[7]*G+1;if(K===0)continue;let Z=(L[0]*W+L[1]*G+L[2])/K,se=(L[3]*W+L[4]*G+L[5])/K,ee=YH(Z,p,a),oe=YH(se,d,a);switch(s){case"nearest":X=p0e(S,d,p,b,I,_,R,oe,ee,q,l);break;case"bilinear":X=f0e(S,d,p,b,I,_,R,oe,ee,q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let le=R*b+G*I+W*_+q;E[le]=X}return r.makeTensorInfo(g,o.dtype,E)}return{dataId:r.write(E,g,o.dtype),shape:o.shape,dtype:o.dtype}}var ZH={kernelName:Jb,backendName:"cpu",kernelFunc:a0e};function YH(t,n,e){switch(e){case"reflect":return l0e(t,n);case"wrap":return c0e(t,n);case"nearest":return d0e(t,n);case"constant":default:return u0e(t,n)}}function l0e(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=2*n;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-n?e+r:-e-1}else if(e>n-1)if(n<=1)e=0;else{let r=2*n;e-=r*Math.trunc(e/r),e>=n&&(e=r-e-1)}return w.clamp(0,e,n-1)}function c0e(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=n-1;e+=n*(Math.trunc(-e/r)+1)}else if(e>n-1)if(n<=1)e=0;else{let r=n-1;e-=n*Math.trunc(e/r)}return w.clamp(0,e,n-1)}function u0e(t,n){return t}function d0e(t,n){return w.clamp(0,t,n-1)}function Qy(t,n,e,r,o,i,s,a,l,c,u){let d=s*r+a*o+l*i+c;return 0<=a&&a<n&&0<=l&&l<e?t[d]:u}function p0e(t,n,e,r,o,i,s,a,l,c,u){let d=Math.round(a),p=Math.round(l);return Qy(t,n,e,r,o,i,s,d,p,c,u)}function f0e(t,n,e,r,o,i,s,a,l,c,u){let d=Math.floor(a),p=Math.floor(l),f=d+1,m=p+1,h=(m-l)*Qy(t,n,e,r,o,i,s,d,p,c,u)+(l-p)*Qy(t,n,e,r,o,i,s,d,m,c,u),g=(m-l)*Qy(t,n,e,r,o,i,s,f,p,c,u)+(l-p)*Qy(t,n,e,r,o,i,s,f,m,c,u);return(f-a)*h+(a-d)*g}function m0e(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;J(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=LC(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var QH={kernelName:lm,backendName:"cpu",kernelFunc:m0e};function h0e(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),c=0;for(let f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);let u=new Array(s).fill(0),d=o.shape.slice();d[i]=1;let p=new Array(a);for(let f=0;f<p.length;f++){u[i]=f;let m=vi({inputs:{x:o},backend:e,attrs:{begin:u,size:d}});p[f]=ot({inputs:{x:m},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(m)}return p}var JH={kernelName:Wc,backendName:"cpu",kernelFunc:h0e};function g0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r;J(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,c=[],u=[],d=a-l,p=i;for(let m=0;m<d;++m){let h=Jm({inputs:{input:p},backend:e,attrs:{dim:m+1}});p=h,u.push(h)}for(let m=0;m<s;++m){let h=w.createScalarValue(m,"int32"),g=e.makeTensorInfo([],"int32",h),x=xA({inputs:{a:g,b:p},backend:e}),b=hi({inputs:{x},backend:e,attrs:{dtype:"float32"}}),I=rp({inputs:{a:b,b:o},backend:e}),_=wl({inputs:{x:I},backend:e,attrs:{axis:0,keepDims:!1}});c.push(_),u.push(g),u.push(x),u.push(b),u.push(I),u.push(_)}let f=NA({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var eq={kernelName:Hc,backendName:"cpu",kernelFunc:g0e};var y0e=[xG,zj,bG,wG,Hj,CG,_G,IG,EG,SG,TG,DG,NG,kG,AG,MG,FG,OG,PG,vG,LG,$G,VG,Wj,qj,BG,Uj,zG,jG,WG,HG,GG,KG,XG,qG,YG,ZG,QG,JG,eW,tW,nW,rW,oW,iW,sW,lW,aW,Xy,uW,dG,dW,pW,fW,Kj,mW,Xj,hW,gW,yW,Yj,vW,xW,bW,wW,CW,Zj,_W,jj,IW,UG,EW,SW,TW,pG,Qj,DW,NW,Jj,kW,AW,RW,MW,FW,OW,eG,LW,$W,VW,BW,UW,PW,jW,GW,tG,WW,HW,uH,nG,rG,dH,pH,fH,oG,mH,yH,vH,UC,xH,fG,sG,bH,Gj,wH,mG,hG,yG,CH,_H,IH,EH,SH,TH,DH,aG,NH,kH,AH,gG,RH,MH,FH,lG,lH,PH,LH,$H,VH,BH,zH,UH,jH,cG,GH,WH,uG,cW,HH,qH,KH,XH,iG,ZH,QH,JH,eq,hH];for(let t of y0e)nw(t);var ip={},kA={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function tq(t,n){ip[t]=n}function Vo(t){if(!(t in ip)){let e=x0e(t);if(e!==null)ip[t]=e;else return console.log("Could not get context for WebGL version",t),null}let n=ip[t];return n.isContextLost()?(delete ip[t],Vo(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),ip[t])}function v0e(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function x0e(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=v0e(t);return n.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete ip[t]},!1),t===1?n.getContext("webgl",kA)||n.getContext("experimental-webgl",kA):n.getContext("webgl2",kA)}var sp=function(t){return t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH",t}(sp||{}),Ir=function(t){return t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD",t}(Ir||{}),lr=function(t){return t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",t}(lr||{});function ap(t,n){return[n,t]}function nq(t,n){return t*n}function du(t){let n=w.sizeFromShape(t),e=Math.ceil(n/4);return w.sizeToSquarishShape(e)}function ks(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function rq(t,n){let[e,r]=ks(t,n);return e*r*4}function Jy(t,n){let e=t,r,o,i,s,a,l,c,u,d,p;return H().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,c=4,u=1,d=e.HALF_FLOAT,p=e.FLOAT):(r=t.RGBA,o=t.RGBA,i=t.RGBA,s=e.RGBA,a=t.RGBA,c=4,u=4,d=n!=null?n.HALF_FLOAT_OES:null,p=t.FLOAT),l=t.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:p}}function Re(t,n){let e=n();return H().getBool("DEBUG")&&b0e(t),e}function b0e(t){let n=t.getError();if(n!==t.NO_ERROR)throw new Error("WebGL Error: "+_0e(t,n))}var w0e=596e-10,C0e=65504;function oq(t){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||w0e<Math.abs(t)&&Math.abs(t)<C0e)}function _0e(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${n}`}}function e0(t,n){return Cl(t,()=>t.getExtension(n),'Extension "'+n+'" not supported on this browser.')}function iq(t,n){let e=Cl(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Re(t,()=>t.shaderSource(e,n)),Re(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function sq(t,n){let e=Cl(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Re(t,()=>t.shaderSource(e,n)),Re(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw E0e(n,t.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var I0e=/ERROR: [0-9]+:([0-9]+):/g;function E0e(t,n){let e=I0e.exec(n);if(e==null){console.log(`Couldn't parse line number in error: ${n}`),console.log(t);return}let r=+e[1],o=t.split(`
`),i=o.length.toString().length+2,s=o.map((d,p)=>w.rightPad((p+1).toString(),i)+d),a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);let l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join(`
`)),console.log(n.split(`
`)[0]),console.log(`%c ${w.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function aq(t){return Cl(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function lq(t,n){if(Re(t,()=>t.linkProgram(n)),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function WC(t,n){if(Re(t,()=>t.validateProgram(n)),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function cq(t,n){let e=Cl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),Re(t,()=>t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function uq(t,n){let e=Cl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Re(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)),Re(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function dq(t){return Cl(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function pq(t,n){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){let r=`[${t}x${n}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e){let r=`[${t}x${n}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function fq(t){return Cl(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function OA(t,n,e,r,o,i,s){let a=t.getAttribLocation(n,e);return a===-1?!1:(Re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),Re(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,i,s)),Re(t,()=>t.enableVertexAttribArray(a)),!0)}function S0e(t,n,e){D0e(t,e),Re(t,()=>t.activeTexture(t.TEXTURE0+e)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,n))}function mq(t,n,e){return Cl(t,()=>t.getUniformLocation(n,e),'uniform "'+e+'" not present in program.')}function hq(t,n,e){return t.getUniformLocation(n,e)}function gq(t,n,e,r){Re(t,()=>S0e(t,n,r)),Re(t,()=>t.uniform1i(e,r))}function HC(t,n,e){Re(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Re(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0))}function PA(t,n){Re(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),Re(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function t0(t){let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+T0e(t,n))}function T0e(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${n}`}}function Cl(t,n,e){let r=Re(t,()=>n());if(r==null)throw new Error(e);return r}function D0e(t,n){let e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function pu(t,n=2){return w.sizeFromShape(t.slice(0,t.length-n))}function fu(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function qC(t){let n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[pu(t),...fu(t)]),n}function yq(t,n=!1){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");n&&(e=e*2,t=t.map((o,i)=>i>=t.length-2?w.nearestLargerEven(t[i]):t[i]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=w.squeezeShape(t).newShape);let r=w.sizeFromShape(t);if(t.length<=1&&r<=e)return[1,r];if(t.length===2&&t[0]<=e&&t[1]<=e)return t;if(t.length===3&&t[0]*t[1]<=e&&t[2]<=e)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=e&&t[1]*t[2]<=e)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=e&&t[3]<=e)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=e&&t[1]*t[2]*t[3]<=e)return[t[0],t[1]*t[2]*t[3]];if(n){let o=pu(t),i=2,s=2;return t.length&&([i,s]=fu(t)),r=o*(i/2)*(s/2),w.sizeToSquarishShape(r).map(a=>a*2)}return w.sizeToSquarishShape(r)}function GC(t){return t%2===0}function lp(t,n){if(t=t.slice(-2),n=n.slice(-2),w.arraysEqual(t,n)||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){let e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||GC(e)&&GC(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&GC(t[0])&&GC(n[0])}var RA,MA;function vq(t){if(RA==null){let n=Vo(t);RA=n.getParameter(n.MAX_TEXTURE_SIZE)}return RA}function xq(t){if(MA==null){let n=Vo(t);MA=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,MA)}function bq(t){if(t===0)return 0;let n,e=Vo(t);return Bo(e,"EXT_disjoint_timer_query_webgl2")&&t===2?n=2:Bo(e,"EXT_disjoint_timer_query")?n=1:n=0,n}function Bo(t,n){return t.getExtension(n)!=null}function LA(t){try{if(Vo(t)!=null)return!0}catch(n){return console.log("Error when getting WebGL context: ",n),!1}return!1}function wq(t){if(t===0)return!1;let n=Vo(t);if(t===1){if(!Bo(n,"OES_texture_float"))return!1}else if(!Bo(n,"EXT_color_buffer_float"))return!1;return FA(n)}function Cq(t){if(t===0)return!1;let n=Vo(t);if(t===1){if(!Bo(n,"OES_texture_float")||!Bo(n,"WEBGL_color_buffer_float"))return!1}else{if(Bo(n,"EXT_color_buffer_float"))return FA(n);let r="EXT_color_buffer_half_float";if(Bo(n,r)){let o=n.getExtension(r);return N0e(n,o)}return!1}return FA(n)}function FA(t){let n=Jy(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(i),s}function N0e(t,n){let e=Jy(t,n),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function _q(t){return t!==2?!1:Vo(t).fenceSync!=null}function As(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&w.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the WebGL backend.`)})}var ze=H();ze.registerFlag("HAS_WEBGL",()=>ze.getNumber("WEBGL_VERSION")>0);ze.registerFlag("WEBGL_VERSION",()=>LA(2)?2:LA(1)?1:0);ze.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);ze.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>ze.get("WEBGL_VERSION")===2);ze.registerFlag("WEBGL_CPU_FORWARD",()=>!0);ze.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);ze.registerFlag("WEBGL_PACK",()=>ze.getBool("HAS_WEBGL"));ze.registerFlag("WEBGL_PACK_NORMALIZATION",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_CLIP",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_PACK_REDUCE",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_LAZILY_UNPACK",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_CONV_IM2COL",()=>ze.getBool("WEBGL_PACK"));ze.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>vq(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>xq(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=ze.getNumber("WEBGL_VERSION");return t===0?0:bq(t)});ze.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>ze.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Kc.isMobile());ze.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>wq(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>ze.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:ze.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));ze.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>Cq(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_FENCE_API_ENABLED",()=>_q(ze.getNumber("WEBGL_VERSION")));ze.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>ze.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);ze.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});ze.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Kc.isMobile()&&ze.getBool("IS_CHROME")?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});function nn(){let t,n,e,r,o,i,s,a,l,c;return H().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function Xi(t,n,e="index"){let r=w.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * ${o}`:`index -= ${t[i]} * ${o}`;return`${s}; ${a};`}).join("")}function eh(t){let n=w.computeStrides(t).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${n[0]} + coords.y * ${n[1]} + coords.z;
  }
`}var XC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var YC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=sp.DENSE;let e=du(n),r=nn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Xi(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var ZC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=sp.DENSE;let e=du(n),r=nn();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Xi(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var QC=class{constructor(n){this.variableNames=["A"],this.outTexUsage=Ir.DOWNLOAD;let e=nn();this.outputShape=n,this.userCode=`
      ${XC}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var JC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ir.DOWNLOAD;let e=nn();this.outputShape=n,this.userCode=`
      ${XC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var e_=class{constructor(n,e,r=!1){this.variableNames=["A"];let o=nn(),[i,s]=e;this.outputShape=n;let a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${eh(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${s};
        int c = imod(flatIndex, ${s});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
        vec4 values = ${o.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}};var t_=class{constructor(n,e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let o=nn(),[i,s]=e;this.outputShape=n;let a="",l="result";r&&(l="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let d=c*2+u;a+=`
          localCoords = coords;
          if(localCoords[2] + ${u} < ${n[2]}) {
            localCoords[2] += ${u};
            if(localCoords[1] + ${c} < ${n[1]}) {
              localCoords[1] += ${c};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${s};
              c = imod(flatIndex, ${s});
              uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
              values = ${o.texture2D}(A, uv);

              if(offset == 0) {
                result[${d}] = values[0];
              } else if(offset == 1) {
                result[${d}] = values[1];
              } else if(offset == 2) {
                result[${d}] = values[2];
              } else {
                result[${d}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${eh(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${a}

        ${o.output} = ${l};
      }
    `}};function Iq(t){let n=nn(),e=`${n.version}
    precision highp float;
    ${n.attribute} vec3 clipSpacePos;
    ${n.attribute} vec2 uv;
    ${n.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return iq(t,e)}function Eq(t){let n=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return cq(t,n)}function Sq(t){let n=new Uint16Array([0,1,2,2,1,3]);return uq(t,n)}function n0(t,n,e,r,o,i){pq(n,e);let s=dq(t),a=t.TEXTURE_2D;return Re(t,()=>t.bindTexture(a,s)),Re(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Re(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Re(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Re(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),Re(t,()=>t.texImage2D(a,0,r,n,e,0,o,i,null)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,null)),s}function $A(t){return t.internalFormatFloat}function Tq(t,n,e,r){let[o,i]=ap(n,e);return n0(t,o,i,$A(r),r.textureFormatFloat,t.FLOAT)}function VA(t){return t.internalFormatHalfFloat}function Dq(t,n,e,r){let[o,i]=ap(n,e);return n0(t,o,i,VA(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function BA(t){return t.downloadTextureFormat}function Nq(t,n,e,r){let[o,i]=ap(n,e);return n0(t,o,i,BA(r),t.RGBA,t.UNSIGNED_BYTE)}function zA(t){return t.internalFormatPackedFloat}function kq(t,n,e,r){let[o,i]=ks(n,e);return n0(t,o,i,zA(r),t.RGBA,t.FLOAT)}function UA(t){return t.internalFormatPackedHalfFloat}function Aq(t,n,e,r){let[o,i]=ks(n,e);return n0(t,o,i,UA(r),t.RGBA,r.textureTypeHalfFloat)}function Rq(t,n,e){return Re(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),OA(t,n,"clipSpacePos",e,3,20,0)&&OA(t,n,"uv",e,2,20,12)}function Mq(t,n,e,r,o,i){Re(t,()=>t.bindTexture(t.TEXTURE_2D,n));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(e*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),s.set(o),Re(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,e,r,0,t.RGBA,a,s)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Fq(t,n,e){Re(t,()=>t.bindTexture(t.TEXTURE_2D,n)),e.data instanceof Uint8Array?Re(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e.data)):Re(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)),Re(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function Oq(t,n,e,r){let o=t.createBuffer();Re(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*n*e;return Re(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Re(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,0)),Re(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function Pq(t,n,e){let r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Lq(t,n,e,r){let[o,i]=ap(n,e),s=4,a=new Uint8Array(nq(n*e,s));return Re(t,()=>t.readPixels(0,0,o,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function $q(t,n,e,r,o,i,s,a){let l=t,c=new Float32Array(rq(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,n),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function Vq(t,n,e){let r=new Float32Array(n*e*4);return Re(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,r)),r}var n_=class{constructor(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let e=H().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,tq(e,n)):this.gl=Vo(e);let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(H().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=e0(this.gl,i),Bo(this.gl,s))this.textureHalfFloatExtension=e0(this.gl,s);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Bo(this.gl,o))this.colorBufferHalfFloatExtension=e0(this.gl,o);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Bo(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Bo(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=Eq(this.gl),this.indexBuffer=Sq(this.gl),this.framebuffer=fq(this.gl),this.textureConfig=Jy(this.gl,this.textureHalfFloatExtension)}get debug(){return H().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let n=this.gl;Re(n,()=>n.finish()),Re(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),Re(n,()=>n.deleteFramebuffer(this.framebuffer)),Re(n,()=>n.bindBuffer(n.ARRAY_BUFFER,null)),Re(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)),Re(n,()=>n.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(n,e){return this.throwIfDisposed(),Tq(this.gl,n,e,this.textureConfig)}createFloat16MatrixTexture(n,e){return this.throwIfDisposed(),Dq(this.gl,n,e,this.textureConfig)}createUnsignedBytesMatrixTexture(n,e){return this.throwIfDisposed(),Nq(this.gl,n,e,this.textureConfig)}uploadPixelDataToTexture(n,e){this.throwIfDisposed(),Fq(this.gl,n,e)}uploadDenseMatrixToTexture(n,e,r,o){this.throwIfDisposed(),Mq(this.gl,n,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(n,e){return this.throwIfDisposed(),Aq(this.gl,n,e,this.textureConfig)}createPackedMatrixTexture(n,e){return this.throwIfDisposed(),kq(this.gl,n,e,this.textureConfig)}deleteMatrixTexture(n){this.throwIfDisposed(),this.outputTexture===n&&(PA(this.gl,this.framebuffer),this.outputTexture=null),Re(this.gl,()=>this.gl.deleteTexture(n))}downloadByteEncodedFloatMatrixFromOutputTexture(n,e,r){return this.downloadMatrixDriver(n,()=>Lq(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(n,e,r,o,i,s){return $q(this.gl,n,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(n,e){return Pq(this.gl,n,e)}createBufferFromTexture(n,e,r){this.bindTextureToFrameBuffer(n);let o=Oq(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let n=this.createFence(this.gl);return this.pollFence(n)}createFence(n){let e,r;if(H().getBool("WEBGL_FENCE_API_ENABLED")){let o=n,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(n,e,r){return this.downloadMatrixDriver(n,()=>Vq(this.gl,e,r))}createProgram(n){this.throwIfDisposed();let e=this.gl,r=sq(e,n);this.vertexShader==null&&(this.vertexShader=Iq(e));let o=aq(e);return Re(e,()=>e.attachShader(o,this.vertexShader)),Re(e,()=>e.attachShader(o,r)),lq(e,o),this.debug&&WC(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Rq(e,this.program,this.vertexBuffer)),o}deleteProgram(n){this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&Re(this.gl,()=>this.gl.deleteProgram(n))}setProgram(n){this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&WC(this.gl,this.program),Re(this.gl,()=>this.gl.useProgram(n))}getUniformLocation(n,e,r=!0){return this.throwIfDisposed(),r?mq(this.gl,n,e):hq(this.gl,n,e)}getAttributeLocation(n,e){return this.throwIfDisposed(),Re(this.gl,()=>this.gl.getAttribLocation(n,e))}getUniformLocationNoThrow(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)}setInputMatrixTexture(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),gq(this.gl,n,e,r)}setOutputMatrixTexture(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)}setOutputPackedMatrixTexture(n,e,r){this.throwIfDisposed();let[o,i]=ks(e,r);this.setOutputMatrixTextureDriver(n,o,i)}setOutputMatrixWriteRegion(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)}setOutputPackedMatrixWriteRegion(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&WC(this.gl,this.program),t0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let n=this.gl;this.debug&&this.debugValidate(),Re(n,()=>n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Re(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=e0(this.gl,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let n=this.getQueryTimerExtensionWebGL1(),e=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),e}endQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(n){return await w.repeatedTry(()=>this.disposed||this.isQueryAvailable(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(n,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(n,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(n){return new Promise(e=>{this.addItemToPoll(()=>n.isFencePassed(),()=>e())})}pollItems(){let n=A0e(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=n;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(n+1)}addItemToPoll(n,e){this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),!(this.itemsToPoll.length>1)&&w.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(n){this.throwIfDisposed(),HC(this.gl,n,this.framebuffer),this.debug&&t0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(HC(this.gl,this.outputTexture,this.framebuffer),this.debug&&t0(this.gl)):PA(this.gl,this.framebuffer)}downloadMatrixDriver(n,e){this.bindTextureToFrameBuffer(n);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(n,e,r){this.throwIfDisposed();let o=this.gl;HC(o,n,this.framebuffer),this.debug&&t0(o),this.outputTexture=n,Re(o,()=>o.viewport(0,0,e,r)),Re(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(n,e,r,o){this.throwIfDisposed(),Re(this.gl,()=>this.gl.scissor(n,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function A0e(t){let n=0;for(;n<t.length&&t[n]();++n);return n-1}var{getBroadcastDims:Bq}=T;function zq(t,n,e,r){let o=[];t.forEach(m=>{let h=w.sizeFromShape(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?o.push(`uniform float ${m.name}${h>1?`[${h}]`:""};`):(o.push(`uniform sampler2D ${m.name};`),o.push(`uniform int offset${m.name};`))});let i=o.join(`
`),s=t.map(m=>R0e(m,n,r)).join(`
`),a=n.texShape,l=nn(),c=O0e(l),u,d,p=$0e(l);return n.isPacked?(u=M0e(n.logicalShape,a),d=L0e(l)):(u=F0e(n.logicalShape,a),d=P0e(l)),r&&(p+=U0e),[p,c,d,i,u,s,e].join(`
`)}function nh(t){let n=t.shapeInfo.logicalShape;switch(n.length){case 0:return eve(t);case 1:return nve(t);case 2:return ove(t);case 3:return sve(t);case 4:return lve(t);case 5:return cve(t);case 6:return uve(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function Uq(t){switch(t.shapeInfo.logicalShape.length){case 0:return J0e(t);case 1:return tve(t);case 2:return rve(t);case 3:return ive(t);default:return ave(t)}}function R0e(t,n,e=!1){let r="";e?r+=Uq(t):r+=nh(t);let o=t.shapeInfo.logicalShape,i=n.logicalShape;return o.length<=i.length&&(e?r+=dve(t,n):r+=pve(t,n)),r}function M0e(t,n){switch(t.length){case 0:return jq();case 1:return j0e(t,n);case 2:return Z0e(t,n);case 3:return W0e(t,n);default:return q0e(t,n)}}function F0e(t,n){switch(t.length){case 0:return jq();case 1:return G0e(t,n);case 2:return Q0e(t,n);case 3:return H0e(t,n);case 4:return K0e(t,n);case 5:return X0e(t,n);case 6:return Y0e(t,n);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function O0e(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function P0e(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function L0e(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function $0e(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${V0e}
    ${B0e}
    ${z0e}
  `}var V0e=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,B0e=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,z0e=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,U0e=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function jq(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function j0e(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${e[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return 2 * (resTexRC.x * ${e[1]} + resTexRC.y);
    }
  `}function G0e(t,n){return n[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${n[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return resTexRC.x * ${n[1]} + resTexRC.y;
    }
  `}function W0e(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function H0e(t,n){let e=Xi(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec3(r, c, d);
    }
  `}function q0e(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,s="",a="b, r, c";for(let l=2;l<t.length-1;l++)i*=t[t.length-l-1],s=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+s,a=`b${l}, `+a;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${a});
    }
  `}function K0e(t,n){let e=Xi(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec4(r, c, d, d2);
    }
  `}function X0e(t,n){let e=Xi(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${n[0]},
                             ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function Y0e(t,n){let e=Xi(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function Z0e(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(w.arraysEqual(t,n))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `;let r=Math.ceil(t[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function Q0e(t,n){return w.arraysEqual(t,n)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `:t[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function cp(t){return`offset${t}`}function J0e(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=nn();return`
    vec4 ${e}() {
      return ${r.texture2D}(${n}, halfCR);
    }
  `}function eve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${e}() {return ${n};}`;let[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${e}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let[i,s]=t.shapeInfo.texShape,a=cp(n);return`
    float ${e}() {
      vec2 uv = uvFromFlat(${i}, ${s}, ${a});
      return sampleTexture(${n}, uv);
    }
  `}function tve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=nn();return`
    vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function nve(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${e}(int index) {
        ${rh(t)}
      }
    `;let r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${e}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let s=cp(n);return i===1?`
      float ${e}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?`
      float ${e}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${e}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${s});
      return sampleTexture(${n}, uv);
    }
  `}function rve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=o[0],s=o[1],a=nn();if(o!=null&&w.arraysEqual(n,o))return`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${i}.0);

        return ${a.texture2D}(${e}, uv);
      }
    `;let l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${a.texture2D}(${e}, uv);
    }
  `}function ove(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape;if(o!=null&&w.arraysEqual(n,o)){let d=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${e}, uv);
    }
  `}let{newShape:i,keptDims:s}=w.squeezeShape(n),a=i;if(a.length<n.length){let d=oh(t,a),p=["row","col"];return`
      ${nh(d)}
      float ${r}(int row, int col) {
        return ${r}(${ih(p,s)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${rh(t)}
      }
    `;let l=o[0],c=o[1],u=cp(e);return c===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${e}, uv);
    }
  `:l===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${e}, uv);
    }
  `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${u};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${e}, uv);
  }
`}function ive(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){let d=n.slice(1),p=[1,2],f=oh(t,d),m=["b","row","col"];return`
        ${Uq(f)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${ih(m,p)});
        }
      `}let s=i[0],a=i[1],l=Math.ceil(n[2]/2),c=l*Math.ceil(n[1]/2),u=nn();return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${s}, ${a}, ${c}, ${l}, b, row, col);
      return ${u.texture2D}(${e}, uv);
    }
  `}function sve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[1]*n[2],i=n[2],{newShape:s,keptDims:a}=w.squeezeShape(n),l=s;if(l.length<n.length){let m=oh(t,l),h=["row","col","depth"];return`
        ${nh(m)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${ih(h,a)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${rh(t)}
      }
    `;let c=t.shapeInfo.texShape,u=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===o&&p==null)return`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${u}.0);
          return sampleTexture(${e}, uv);
        }
      `;if(d===i&&p==null)return`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${u}.0);
      return sampleTexture(${e}, uv);
    }
  `;let f=cp(e);return`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${u}, ${d}, index);
        return sampleTexture(${e}, uv);
      }
  `}function ave(t){let n=t.shapeInfo.logicalShape,e=n.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],a=s[0],l=s[1],c=Math.ceil(n[e-1]/2),u=c*Math.ceil(n[e-2]/2),d="int b, int row, int col",p=`b * ${u} + (row / 2) * ${c} + (col / 2)`;for(let m=2;m<e-1;m++)d=`int b${m}, `+d,u*=n[e-m-1],p=`b${m} * ${u} + `+p;let f=nn();return`
    vec4 ${o}(${d}) {
      int index = ${p};
      int texR = index / ${l};
      int texC = index - texR * ${l};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${a});
      return ${f.texture2D}(${r}, uv);
    }
  `}function lve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[3],i=n[2]*o,s=n[1]*i,{newShape:a,keptDims:l}=w.squeezeShape(n);if(a.length<n.length){let m=oh(t,a),h=["row","col","depth","depth2"];return`
      ${nh(m)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${ih(h,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${s}, ${i}, ${o}, 1)));
        ${rh(t)}
      }
    `;let c=t.shapeInfo.flatOffset,u=t.shapeInfo.texShape,d=u[0],p=u[1];if(p===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let f=cp(e);return`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${f});
      return sampleTexture(${e}, uv);
    }
  `}function cve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[4],i=n[3]*o,s=n[2]*i,a=n[1]*s,{newShape:l,keptDims:c}=w.squeezeShape(n);if(l.length<n.length){let h=oh(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${nh(h)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${ih(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${rh(t)}
      }
    `;let u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]},
               ${n[2]*n[3]}, ${n[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=cp(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function uve(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=w.squeezeShape(n);if(o.length<n.length){let g=oh(t,o),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${nh(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${ih(x,i)});
      }
    `}let s=n[5],a=n[4]*s,l=n[3]*a,c=n[2]*l,u=n[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${rh(t)}
      }
    `;let d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];if(m===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]*n[4]},
               ${n[2]*n[3]*n[4]},
               ${n[3]*n[4]},
               ${n[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=cp(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${h};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function rh(t){let n=t.name,e=w.sizeFromShape(t.shapeInfo.logicalShape);return e<2?`return ${n};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${n}[i];
      }
    }
  `}function dve(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=n.logicalShape.length,a=Bq(t.shapeInfo.logicalShape,n.logicalShape),l=He(s),c=s-i,u,d=["x","y","z","w","u","v"];i===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(b=>`coords.${d[b+c]} = 0;`).join(`
`);let p="";s<2&&i>0?p="coords":p=t.shapeInfo.logicalShape.map((b,I)=>`coords.${d[I+c]}`).join(", ");let f="return outputValue;",h=w.sizeFromShape(t.shapeInfo.logicalShape)===1,x=w.sizeFromShape(n.logicalShape)===1;if(i===1&&!h&&!x)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!x)s===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){let b=i-2,I=i-1;a.indexOf(b)>-1&&a.indexOf(I)>-1?f="return vec4(outputValue.x);":a.indexOf(b)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(I)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${f}
    }
  `}function pve(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&w.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=He(l),u=Bq(t.shapeInfo.logicalShape,n.logicalShape),d=l-a,p,f=["x","y","z","w","u","v"];a===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(h=>`coords.${f[h+d]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${m});
    }
  `}function He(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function oh(t,n){let e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function ih(t,n){return n.map(e=>t[e]).join(", ")}function Wq(t,n,e,r){let o=n.userCode,i=e.map((f,m)=>{let h={logicalShape:f.shape,texShape:f.isUniform?null:f.texData.texShape,isUniform:f.isUniform,isPacked:f.isUniform?!1:f.texData.isPacked,flatOffset:null};return f.texData!=null&&f.texData.slice!=null&&f.texData.slice.flatOffset>0&&(h.flatOffset=f.texData.slice.flatOffset),{name:n.variableNames[m],shapeInfo:h}}),s=i.map(f=>f.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=zq(i,a,o,n.packedInputs),c=t.createProgram(l),u=null,d=t.getUniformLocation(c,"NAN",!1);H().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(c,"INFINITY",!1));let p={};for(let f=0;f<n.variableNames.length;f++){let m=n.variableNames[f],h=!1;p[m]=t.getUniformLocation(c,m,h),p[`offset${m}`]=t.getUniformLocation(c,`offset${m}`,h)}return{program:n,source:l,webGLProgram:c,uniformLocations:p,inShapeInfos:s,outShapeInfo:a,infLoc:u,nanLoc:d}}function Gq(t,n){if(t.length!==n.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${n.length} inputs`);t.forEach((e,r)=>{let o=e.logicalShape,i=n[r],s=i.shape;if(!w.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!w.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function Hq(t,n,e,r,o){Gq(n.inShapeInfos,e),Gq([n.outShapeInfo],[r]);let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,s[0],s[1]):t.setOutputMatrixTexture(i,s[0],s[1]),t.setProgram(n.webGLProgram),H().getNumber("WEBGL_VERSION")===1&&n.infLoc!==null&&t.gl.uniform1f(n.infLoc,1/0),n.nanLoc!==null&&t.gl.uniform1f(n.nanLoc,NaN),e.forEach((a,l)=>{let c=n.program.variableNames[l],u=n.uniformLocations[c],d=n.uniformLocations[`offset${c}`];if(u!=null){if(a.isUniform){if(w.sizeFromShape(a.shape)<2)t.gl.uniform1f(u,a.uniformValues[0]);else{let p=a.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}return}a.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,a.texData.slice.flatOffset),t.setInputMatrixTexture(a.texData.texture,u,l)}}),o?.(t,n.webGLProgram),t.executeProgram()}function qq(t,n,e){let r="";n.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0,l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`});let o=t.userCode,i=t.constructor.name;return i+="_"+r+"_"+o,i}var{addImpl:Kq,bincountImpl:r_,bincountReduceImpl:Xq,ceilImpl:Yq,concatImpl:Zq,expImpl:Qq,expm1Impl:Jq,floorImpl:e5,gatherV2Impl:t5,greaterImpl:n5,lessImpl:r5,linSpaceImpl:o5,logImpl:i5,maxImpl:s5,maximumImpl:a5,minimumImpl:l5,multiplyImpl:c5,negImpl:u5,prodImpl:d5,rangeImpl:p5,rsqrtImpl:f5,simpleAbsImpl:o_,sliceImpl:m5,sparseFillEmptyRowsImpl:h5,sparseReshapeImpl:g5,stridedSliceImpl:y5,subImpl:v5,tileImpl:x5,topKImpl:b5,transposeImpl:up,uniqueImpl:w5}=cA;function jA(t,n){return["x","y","z","w","u","v"].slice(0,n).map(e=>`${t}.${e}`)}function fn(t,n){return n===1?[t]:jA(t,n)}function C5(t,n){if(t===1)return"rc";let e="";for(let r=0;r<t;r++)e+=n[r],r<t-1&&(e+=",");return e}var i_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;let e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=fn("rc",e),o=He(e),i=gve(e,n,r),s=yve(e,n[n.length-1],n[n.length-2],r),a=vve(n,r);this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${a}));
          }
        }
      `}}};function hve(t,n){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<t;s++)i=`${n[n.length-1-s]},`+i;e.push(i)}return e}function gve(t,n,e){if(t===1)return`rc > ${n[0]}`;let r="";for(let o=t-2;o<t;o++)r+=`${e[o]} >= ${n[o]}`,o<t-1&&(r+="||");return r}function yve(t,n,e,r){if(t===1)return"";let o=r.slice(-2);return`
    int r = ${o[0]};
    int c = ${o[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${n};
    bool rEdge = rp1 >= ${e};
  `}function vve(t,n){let e=t.length,r=hve(e,n);return e===1?`getA(rc),
            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${r[0]}),
          cEdge ? 0. : getA(${r[1]}),
          rEdge ? 0. : getA(${r[2]}),
          rEdge || cEdge ? 0. : getA(${r[3]})`}var sh=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${xve(e)}
      ${eh(n)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${n[1]};
        int cols = ${n[2]};

        ${r}

        setOutput(result);
      }
    `}};function xve(t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${Xi(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var s_=class{constructor(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(n,e,r){let o=I5(e,r),i=E5(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=_5(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].shift();return this.usedTextures[i].push(l),l}let a;return o===lr.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===lr.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===lr.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===lr.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===lr.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(n,e,r,o){if(this.freeTextures==null)return;let i=I5(r,o),s=E5(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=_5(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=H().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(n),this._numBytesAllocated-=a):(this.freeTextures[s].push(n),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[s],u=c.indexOf(n);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(u,1),this.log()}log(){if(!this.logEnabled)return;let n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${n})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let n in this.freeTextures)this.freeTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(let n in this.usedTextures)this.usedTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function bve(t,n){let e=t;if(n===e.R32F)return 4;if(n===e.R16F)return 2;if(n===e.RGBA32F)return 16;if(n===t.RGBA)return 16;if(n===e.RGBA16F)return 8;throw new Error(`Unknown internal format ${n}`)}function _5(t,n,e,r,o){let i=wve(n,r),s;if(o){let[l,c]=ks(t[0],t[1]);s=l*c}else{let[l,c]=ap(t[0],t[1]);s=l*c}let a=bve(e,i);return s*a}function wve(t,n){switch(t){case lr.PACKED_2X2_FLOAT32:return zA(n);case lr.PACKED_2X2_FLOAT16:return UA(n);case lr.UNPACKED_FLOAT32:return $A(n);case lr.UNPACKED_FLOAT16:return VA(n);case lr.PACKED_4X1_UNSIGNED_BYTE:return BA(n);default:throw new Error(`Unknown physical texture type ${t}`)}}function Cve(t){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?lr.PACKED_2X2_FLOAT32:lr.UNPACKED_FLOAT32:t?lr.PACKED_2X2_FLOAT16:lr.UNPACKED_FLOAT16}function I5(t,n){if(t===Ir.UPLOAD)return lr.PACKED_2X2_FLOAT32;if(t===Ir.RENDER||t==null)return Cve(n);if(t===Ir.DOWNLOAD||t===Ir.PIXELS)return lr.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function E5(t,n,e){return`${t[0]}_${t[1]}_${n}_${e}`}var Pr=class{constructor(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},zn="if (isnan(x)) return x;",S5="return x;",GA="return abs(x);";var T5="return (x >= 0.0) ? x : (exp(x) - 1.0);",D5=zn+`
  return (x < 0.0) ? 0.0 : x;
`,N5=zn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,r0="return x;",k5="return 1.0 / (1.0 + exp(-1.0 * x));";var R5="return x;",M5=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,F5=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,O5=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,P5="return 1.0 / (1.0 + exp(-1.0 * x));",xi=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var a_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;let e=n.length,r=fn("rc",e),o=He(e),i=C5(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Ive=ir.whereImpl,Eve=1e-7,Sve=1e-4,l_={};function Tve(t){return t in l_||(l_[t]={}),l_[t]}var Dve=128,Nve=600;function kve(){return H().global.screen==null?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*Nve/1024/1024}var L5=(()=>{class t extends ua{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){let r=Vo(H().getNumber("WEBGL_VERSION"));this.binaryCache=Tve(H().getNumber("WEBGL_VERSION")),this.gpgpu=new n_(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new s_(this.gpgpu),this.numMBBeforeWarning=kve(),this.texData=new cd(this,il())}nextDataId(){return t.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,r,o){if((H().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||H().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:Ir.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(H().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:Ir.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:c}=r;if(a!=null){let f;c?f=new xi(l,r0):f=new Pr(l,r0);let m=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),h=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),h}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let u=this.activeTimers!=null,d;u&&(d=w.now());let p;if(i==="complex64"){let f=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,m)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=w.now()-d),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let h=this.pendingRead.get(e);return new Promise(g=>h.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:c}=r;if(s!=null){let h;c?h=new xi(i,r0):h=new Pr(i,r0);let g=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:a}],a),x=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(o!=null)return this.convertAndCacheOnCPU(e);if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&H().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(a!=="complex64"&&H().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);let h=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(h.texture,...du(i))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){let h=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=h[0],x=h[1];p=T.mergeRealAndImagArrays(g,x)}else if(u==null)p=this.getValuesFromTexture(e);else{let h=w.sizeFromShape(i);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,h)}d!=null&&this.disposeIntermediateTensorInfo(d);let f=this.convertAndCacheOnCPU(e,p),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(h=>h(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&il().removeDataId(e,this),this.pendingDeletes--),f}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>w.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Te(e.shape,e.dtype,o)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!oq(o))throw H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=w.sizeFromShape(r);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),m=this.texData.get(f.dataId),h=this.gpgpu.downloadMatrixFromPackedTexture(m.texture,...du(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),h}let a=H().getBool("WEBGL_PACK")&&i===!0,l=a?qC(r):r,c=a?new JC(l):new QC(l),u=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=w.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=w.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=await Promise.all(s);l.kernelMs=w.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:w.now(),endMs:null}}endTimer(e){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=w.now(),e)}async getQueryTime(e){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=Dve){return H().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&w.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Ive(e.shape,r)}packedUnaryOp(e,r,o){let i=new xi(e.shape,r),s=this.compileAndRun(i,[e],o);return il().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=o_(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,GA,e.dtype);let r=new Pr(e.shape,GA),o=this.compileAndRun(r,[e]);return il().makeTensorFromDataId(o.dataId,o.shape,o.dtype)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&w.isString(o[0])){let s=o.map(a=>w.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){let{dataId:i}=this.makeTensorInfo(e,r,o);return il().makeTensorFromDataId(i,e,r,this)}unpackTensor(e){let r=new a_(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new i_(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[pu(e.shape),...fu(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[pu(r),...fu(r)],a=new sh(s,o),c=this.runWebGLProgram(a,[i],e.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}}decode(e){let r=this.texData.get(e),{isPacked:o,shape:i,dtype:s}=r,a=qC(i),l;o?l=new ZC(a):l=new YC(a);let u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],s,null,!0);return{dtype:s,shape:i,dataId:u.dataId}}runWebGLProgram(e,r,o,i,s=!1){let a=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===sp.DENSE){let x=du(e.outputShape);l.texShape=x.map(b=>b*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),w.sizeFromShape(a.shape)===0)return l.values=w.getTypedArrayFromDType(a.dtype,0),a;let c=[],u=r.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let b=this.texData.get(x.dataId);if(b.texture==null){if(!e.packedInputs&&w.sizeFromShape(x.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:b.values};e.packedInputs&&(b.isPacked=!0,b.shape=x.shape)}else if(!!b.isPacked!=!!e.packedInputs)x=b.isPacked?this.unpackTensor(x):this.packTensor(x),c.push(x),b=this.texData.get(x.dataId);else if(b.isPacked&&!lp(b.shape,x.shape)){let I=x,_=x.shape;x.shape=b.shape,x=this.packedReshape(x,_),c.push(x),b=this.texData.get(x.dataId),I.shape=_}return this.uploadToGPU(x.dataId),{shape:x.shape,texData:b,isUniform:!1}});this.uploadToGPU(a.dataId);let d={shape:a.shape,texData:l,isUniform:!1},p=qq(e,u,d),f=this.getAndSaveBinary(p,()=>Wq(this.gpgpu,e,u,d)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),Hq(this.gpgpu,f,u,d,i),c.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let g=H().get("WEBGL_FLUSH_THRESHOLD");if(g>0){let x=w.now();x-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!H().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let x=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),x}return a}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(H().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=j(()=>{if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=H().getBool("DEBUG");H().set("DEBUG",!1);let r=this.abs(Fe(1e-8)).dataSync()[0];if(H().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Eve:Sve}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:c}=r;if(a!=null)return;let u=this.activeTimers!=null,d;u&&(d=w.now());let p=r.texShape;if(p==null&&(p=yq(o,c),r.texShape=p),s!=null){let f=qC(o),m,h=p[1],g=p[0],x=s instanceof Uint8Array;c?([h,g]=ks(p[0],p[1]),m=new t_(f,[g,h],x)):m=new e_(f,[g,h],x);let b=this.makeTensorInfo([g,h],i);x?this.texData.get(b.dataId).usage=Ir.PIXELS:this.texData.get(b.dataId).usage=Ir.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(b.dataId),h,g,s);let _=this.runWebGLProgram(m,[b],i,null,!0),E=this.texData.get(_.dataId);r.texture=E.texture,r.texShape=E.texShape,r.isPacked=E.isPacked,r.usage=E.usage,this.disposeIntermediateTensorInfo(b),this.texData.delete(_.dataId),r.values=null,u&&(this.uploadWaitMs+=w.now()-d)}else{let f=this.acquireTexture(p,l,i,c);r.texture=f}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return this.releaseGPUData(e),r!=null&&(o.values=Ave(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*w.bytesPerElement(r)}}return t.nextDataId=0,t})();function Ave(t,n){if(n==="float32"||n==="complex64")return t;if(n==="int32"||n==="bool"){let e=n==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<e.length;++r)e[r]=Math.round(t[r]);return e}else throw new Error(`Unknown dtype ${n}`)}Kc.isBrowser()&&yw("webgl",()=>new L5,2);var c_=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var zo=class{constructor(n,e,r){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOperation(float a, float b) {
        ${n}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var mu=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;var bi=class{constructor(n,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length,s="";if(o)if(i===0||w.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${He(i)} coords = getOutputCoords();
        `,i===1)s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=fn("coords",i);s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${n}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function mn(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var $5={kernelName:vs,backendName:"webgl",kernelFunc:mn};function Yr(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=mn({inputs:{x:r},backend:e}),l=mn({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var V5={kernelName:Vf,backendName:"webgl",kernelFunc:Yr};var WA="return (a < 0.) ? b * a : a;",HA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Rve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r,s=e.makeTensorInfo([],"float32",w.createScalarValue(i,"float32")),a=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bi(HA,o.shape,s.shape):new zo(WA,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],o.dtype);return e.disposeIntermediateTensorInfo(s),l}var B5={kernelName:bc,backendName:"webgl",kernelFunc:Rve};var qA="return (a < 0.) ? b * a : a;",KA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Mve(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bi(KA,r.shape,o.shape):new zo(qA,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)}var z5={kernelName:Mc,backendName:"webgl",kernelFunc:Mve};var u_="if (isnan(x)) return x;",U5=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,j5=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function _e({opSnippet:t,packedOpSnippet:n,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let d=a.texData.get(s.dataId),p=e(d.values,l);return a.makeTensorInfo(s.shape,l,p)}let c=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&n!=null,u;return c?u=new xi(s.shape,n):u=new Pr(s.shape,t),a.runWebGLProgram(u,[s],l)}}function _t({opSnippet:t,packedOpSnippet:n,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:c}=s,u=a;if(r&&l.dtype==="complex64"){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,x]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(I=>{let[_,E]=I,S={dataId:_.dataId,dtype:_.dtype,shape:l.shape},D={dataId:E.dataId,dtype:E.dtype,shape:c.shape},M=new zo(t,l.shape,c.shape);return u.runWebGLProgram(M,[S,D],Dn(_.dtype,E.dtype))}),b=Yr({inputs:{real:g,imag:x},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(x),b}let d=i||Dn(l.dtype,c.dtype);if(u.shouldExecuteOnCPU([l,c])&&o!=null){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,x]=o(l.shape,c.shape,m.values,h.values,d),b=u.makeTensorInfo(x,d),I=u.texData.get(b.dataId);return I.values=g,b}let p=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&n!=null,f;return p?f=new bi(n,l.shape,c.shape,e):f=new zo(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function hu(t,n=!1){if(t==="linear")return n?R5:S5;if(t==="relu")return n?F5:D5;if(t==="elu")return n?M5:T5;if(t==="relu6")return n?O5:N5;if(t==="prelu")return n?KA:qA;if(t==="leakyrelu")return n?HA:WA;if(t==="sigmoid")return n?P5:k5;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var ah=class{constructor(n,e,r,o=!1,i=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;let u=o?n[1]:n[2],d=Math.ceil(u/2),p=o?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",x="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,x="result = activation(result);");let b=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let I="rc.x",_="rc.x";n[0]<e[0]?I=`int(min(float(rc.x), ${n[0]-1}.))`:e[0]<n[0]&&(_=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`
      ${g}

      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${d}; i++) {
          int batchA = ${I};
          int batchB = ${_};
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${b}

        ${x}

        setOutput(result);
      }
    `}};var XA={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},o0=class{constructor(n,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${n}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var G5="return a * b;";function i0(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=T.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),c=new o0(XA.REAL,r.shape,o.shape),u=new o0(XA.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Yr({inputs:{real:p,imag:f},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[c,u]=c5(r.shape,o.shape,a.values,l.values,i),d=e.makeTensorInfo(u,i),p=e.texData.get(d.dataId);return p.values=c,d}let s;return H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new bi(G5,r.shape,o.shape):s=new zo(G5,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var W5={kernelName:$a,backendName:"webgl",kernelFunc:i0};function H5(t,n,e){let r=[pu(t.shape),...fu(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},i=[pu(n),...fu(n)],s=new sh(i,r),l=e.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}}function ce(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=e,a=w.sizeFromShape(o.shape),l=w.inferFromImplicitShape(i,a),c=w.sizeFromShape(l);w.assert(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=s.texData.get(o.dataId);return u.isPacked&&!lp(o.shape,l)&&!(u.texture!==null&&lp(u.shape,l))?H5(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var q5={kernelName:Fc,backendName:"webgl",kernelFunc:ce};var s0=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,c="sumValue += dot(values, ones);";if(e!=null){let d=1/e;c=`sumValue += dot(values * ${w.isInt(d)?d.toPrecision(2):d}, ones);`}let u="";i%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var d_=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let u=Math.floor(r/4)*4,d=r%4,p=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function Ove(t){let n=[];for(;n.length===0||n[n.length-1].outSize!==1;){let e=n.length?n[n.length-1].outSize:t[1],r=T.computeOptimalWindowSize(e);n.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return n}function xo(t,n,e,r){let o=Ove(t.shape),i=t;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:c}=o[s],u,d;e==="mean"?u=s===0?new s0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new s0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new d_({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},e),d=i,i=r.runWebGLProgram(u,[i],n),d.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(d)}return i}var p_=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[e[s]];this.outputShape=r,this.rank=r.length;let o=He(this.rank),i=Pve(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function Pve(t){let n=t.length;if(n>6)throw Error(`Transpose for rank ${n} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(n);for(let o=0;o<t.length;o++)r[t[o]]=e[o];return r.join()}var f_=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(n.length);for(let u=0;u<r.length;u++)r[u]=n[e[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=He(this.rank),i=jA("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function gu(t,n,e){let r=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new f_(t.shape,n):new p_(t.shape,n);return e.runWebGLProgram(r,[t],t.dtype)}function K5(t,n,e,r){let o=n,i=t.shape.length,s=w.parseAxisParam(o,t.shape),a=s,l=T.getAxesPermutation(a,i),c=l!=null,u=t;c&&(u=gu(t,l,r),a=T.getInnerMostAxes(a.length,i)),T.assertAxesAreInnerMostDims("sum",a,i);let[d,p]=T.computeOutAndReduceShapes(u.shape,a),f=d;e&&(f=T.expandShapeToKeepDim(d,s));let m=w.sizeFromShape(p),g=w.sizeFromShape(t.shape)/m,x=ce({inputs:{x:u},attrs:{shape:[g,m]},backend:r}),b=Id(t.dtype),I=xo(x,b,"sum",r),_=ce({inputs:{x:I},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(I),c&&r.disposeIntermediateTensorInfo(u),_}function dp(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;return K5(o,i,s,e)}var X5={kernelName:Bc,backendName:"webgl",kernelFunc:dp};function Xt(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];let c;if(s.shouldExecuteOnCPU([o])){let d=s.texData.get(o.dataId).values,p=up(d,o.shape,o.dtype,i,l);c=s.makeTensorInfo(l,o.dtype);let f=s.texData.get(c.dataId);f.values=p}else c=gu(o,i,s);return c}var Y5={kernelName:Gc,backendName:"webgl",kernelFunc:Xt};var YA=1e3;function pp({a:t,b:n,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=t.shape.length,u=n.shape.length,d=e?t.shape[c-2]:t.shape[c-1],p=r?n.shape[u-1]:n.shape[u-2],f=e?t.shape[c-1]:t.shape[c-2],m=r?n.shape[u-2]:n.shape[u-1],h=t.shape.slice(0,-2),g=n.shape.slice(0,-2),x=w.sizeFromShape(h),b=w.sizeFromShape(g),I=x===b||x===1||b===1;w.assert(c>=2&&u>=2&&I,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${h}) and (${g}).`);let E=(x>b?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([f,m]);w.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${t.shape} and ${n.shape} and transposeA=${e} and transposeB=${r} must match.`);let S=e?[x,d,f]:[x,f,d],D=r?[b,m,p]:[b,p,m],M=ce({inputs:{x:t},backend:o,attrs:{shape:S}}),R=ce({inputs:{x:n},backend:o,attrs:{shape:D}}),L=[M,R],G=Math.max(x,b),W=e?M.shape[1]:M.shape[2],q=i!=null,X=s!=null,K=l==="leakyrelu",Z=l!=null?hu(l,!0):null,se=q||X||K||Z!=null,ee;if((f===1||m===1)&&W>YA&&se===!1){let le=M,de=R;e&&(le=Xt({inputs:{x:M},backend:o,attrs:{perm:[0,2,1]}}),L.push(le)),r&&(de=Xt({inputs:{x:R},backend:o,attrs:{perm:[0,2,1]}}),L.push(de));let ge=m!==1,pe=m===1,ve=le;ge&&(ve=ce({inputs:{x:le},backend:o,attrs:{shape:[G,W,1]}}),L.push(ve));let xe=m===1?2:1,we=de;pe&&(we=ce({inputs:{x:de},backend:o,attrs:{shape:[G,1,W]}}),L.push(we));let Ne=i0({inputs:{a:ve,b:we},backend:o});ee=dp({inputs:{x:Ne},backend:o,attrs:{axis:xe,keepDims:!0}}),L.push(Ne)}else{let le=Dn(t.dtype,n.dtype),de=new ah(S,D,[G,f,m],e,r,q,Z,X,K),ge=[M,R];if(i!=null&&ge.push(i),X&&ge.push(s),K){let pe=o.makeTensorInfo([],"float32",w.createScalarValue(a,"float32"));ge.push(pe),L.push(pe)}ee=o.runWebGLProgram(de,ge,le)}let oe=ce({inputs:{x:ee},backend:o,attrs:{shape:E}});L.push(ee);for(let le of L)o.disposeIntermediateTensorInfo(le);return oe}function Lve(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return pp({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var Z5={kernelName:bd,backendName:"webgl",kernelFunc:Lve};var Q5="return abs(x);";function $ve(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=o_(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new xi(r.shape,Q5):o=new Pr(r.shape,Q5),e.runWebGLProgram(o,[r],r.dtype)}var J5={kernelName:nc,backendName:"webgl",kernelFunc:$ve};var Vve=zn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Bve=_e({opSnippet:Vve}),e8={kernelName:da,backendName:"webgl",kernelFunc:Bve};var zve=zn+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Uve=_e({opSnippet:zve}),t8={kernelName:pa,backendName:"webgl",kernelFunc:Uve};var n8="return a + b;",jve=_t({opSnippet:n8,packedOpSnippet:n8,supportsComplex:!0,cpuKernelImpl:Kq}),r8={kernelName:Pi,backendName:"webgl",kernelFunc:jve};var m_=class{constructor(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var h_=class{constructor(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function g_(t){let{inputs:n,backend:e}=t,r=n;if(r.length===1)return mn({inputs:{x:r[0]},backend:e});if(r.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=g_({inputs:r.slice(0,l),backend:e}),u=g_({inputs:r.slice(l),backend:e});return g_({inputs:[c,u],backend:e})}let o=r.map(l=>l.dtype).reduce((l,c)=>Dn(l,c)),i=r.map(l=>l.shape),a=H().getBool("WEBGL_PACK")?new h_(r[0].shape,i):new m_(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var o8={kernelName:Ff,backendName:"webgl",kernelFunc:g_};function Gve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("all",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=w.sizeFromShape(f),h=ce({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=xo(h,h.dtype,"all",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=ce({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=ce({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var i8={kernelName:Of,backendName:"webgl",kernelFunc:Gve};function Wve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("any",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=w.sizeFromShape(f),h=ce({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=xo(h,h.dtype,"any",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=ce({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=ce({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var s8={kernelName:Pf,backendName:"webgl",kernelFunc:Wve};var y_=class{constructor(n,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=n;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var v_=class{constructor(n,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,w.assert(n.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,c=He(l),u=fn("coords",l),d,p;if(s===1){p=l+1;let M=He(p);d=`
        ${M} sourceLocR = ${M}(${u.join()}, 0);
        ++${u[l-1]};
        ${M} sourceLocG = ${M}(${u.join()}, 0);
        ++${u[l-2]};
        ${M} sourceLocA = ${M}(${u.join()}, 0);
        --${u[l-1]};
        ${M} sourceLocB = ${M}(${u.join()}, 0);
        --${u[l-2]};`}else p=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;let f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],h=f.map(M=>"int "+M),g=fn("sourceLocR",p-1).concat("inIdx.r"),x=fn("sourceLocG",p-1).concat("inIdx.g"),b=fn("sourceLocB",p-1).concat("inIdx.b"),I=fn("sourceLocA",p-1).concat("inIdx.a"),_=r==="max"?"greaterThan":"lessThan",E=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${I.join()})));`,S=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${b.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${I.join()}) : 0.)`,D=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${S};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${E}
          vec4 candidate = ${S};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${_}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function a8(t,n,e,r=null){let o=n.shape[0],i=n.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=T.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new y_(a,e,r==null),c=[n];r!=null&&c.push(r);let u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;let d=a8(t,n,e,u);return t.disposeIntermediateTensorInfo(u),d}function l8(t,n,e,r=null){let o=r!=null?r.shape:n.shape,i=o[o.length-1],s=T.computeOptimalWindowSize(i),a=new v_(o,s,e,r==null),l=r==null?[n]:[n,r],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===n.shape.length){let u=l8(t,n,e,c);return t.disposeIntermediateTensorInfo(c),u}return c}function x_(t,n,e,r){let o=[e];if(T.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,n.shape.length),!H().getBool("WEBGL_PACK_REDUCE")||n.shape.length<=2){let i=[],[s,a]=T.computeOutAndReduceShapes(n.shape,o),l=w.sizeFromShape(a),c=ce({inputs:{x:n},backend:t,attrs:{shape:[-1,l]}});i.push(c);let u=a8(t,c,r);i.push(u);let d=ce({inputs:{x:u},backend:t,attrs:{shape:s}});return i.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}return l8(t,n,r)}function Hve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Xt({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=x_(e,l,s[0],"max");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var c8={kernelName:rc,backendName:"webgl",kernelFunc:Hve};function qve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=w.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Xt({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=x_(e,l,s[0],"min");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var u8={kernelName:oc,backendName:"webgl",kernelFunc:qve};var Kve=zn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,Xve=_e({opSnippet:Kve}),d8={kernelName:fa,backendName:"webgl",kernelFunc:Xve};var Yve=zn+"return log(x + sqrt(x * x + 1.0));",Zve=_e({opSnippet:Yve}),p8={kernelName:ma,backendName:"webgl",kernelFunc:Zve};var Qve=zn+`
  return atan(x);
`,Jve=_e({opSnippet:Qve}),f8={kernelName:ha,backendName:"webgl",kernelFunc:Jve};var exe=U5+`
  return atan(a, b);
`,txe=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+j5+`
  return result;
`,nxe=_t({opSnippet:exe,packedOpSnippet:txe}),m8={kernelName:ya,backendName:"webgl",kernelFunc:nxe};var rxe=zn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,oxe=_e({opSnippet:rxe}),h8={kernelName:ga,backendName:"webgl",kernelFunc:oxe};var Yi=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;let h=e==="avg",g=`((batch  * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + d`,x=`(xR * ${n.inWidth} + xC) * ${n.inChannels} + d`,b="0.0";if(h||(b="-1.0 / 1e-20"),r){let M=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${M} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:x:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let I="max",_=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(_="avgValue / count");let E=Math.floor(s/4)*4,S=s%4,D=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${b};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${b});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${E}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${E};
          if (${S===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${S===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${S===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${_});
      }
    `}},yu=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideDepth,l=n.strideHeight,c=n.strideWidth,u=n.dilationDepth,d=n.dilationHeight,p=n.dilationWidth,f=n.effectiveFilterDepth,m=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.front,x=n.padInfo.top,b=n.padInfo.left;this.outputShape=n.outShape;let I=e==="avg",_="0.0";if(I||(_="-1.0 / 1e-20"),r){let L=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${x}, ${b});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${n.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${L} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${n.inDepth} + xD) * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`((xD * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let E="max",S=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(S="avgValue / count");let D=Math.floor(s/4)*4,M=s%4,R=`
      if (${I}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${E}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${x}, ${b});
      const float initializationValue = ${_};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${_});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${D};
            if (${M===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${M===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${M===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${R}
            }
          }
          setOutput(${S});
        }
      }
    `}};function ixe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;As(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))return mn({inputs:{x:o},backend:e});let d=new Yi(u,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}var g8={kernelName:ic,backendName:"webgl",kernelFunc:ixe};function sxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,l,c),p=new yu(d,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var y8={kernelName:sc,backendName:"webgl",kernelFunc:sxe};var b_=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=l-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},w_=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,h=p-1-n.padInfo.top,g=f-1-n.padInfo.left,x=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function axe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new w_(p);return e.runWebGLProgram(f,[o],s.dtype)}var v8={kernelName:$f,backendName:"webgl",kernelFunc:axe};function lxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;As([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=new b_(u);return e.runWebGLProgram(d,[o],s.dtype)}var x8={kernelName:Lf,backendName:"webgl",kernelFunc:lxe};function cxe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;return pp({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var b8={kernelName:ac,backendName:"webgl",kernelFunc:cxe};var C_=class{constructor(n,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var __=class{constructor(n,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var uxe=({inputs:t,backend:n,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=t;w.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let c=[r,o,i],u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));let p=H().getBool("WEBGL_PACK_NORMALIZATION")?new __(r.shape,o.shape,i.shape,u,d,l):new C_(r.shape,o.shape,i.shape,u,d,l);return n.runWebGLProgram(p,c,c[0].dtype)},w8={kernelName:vc,backendName:"webgl",kernelFunc:uxe};var I_=class{constructor(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;let e=He(this.rank),r=`uniform int start[${this.rank}];`,o=dxe(this.rank),i,s=n.map((a,l)=>`sourceLoc.${ZA[l]} = start[${l}] + coords.${ZA[l]};`);i=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      ${r}
      void main() {
        ${i}
        setOutput(getSource(${o}));
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}},ZA=["x","y","z","w","u","v"];function dxe(t){if(t===1)return"sourceLoc";if(t<=6)return ZA.slice(0,t).map(n=>"sourceLoc."+n).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var E_=class{constructor(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;let e=He(this.rank),r=fn("coords",this.rank),o=fn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${n[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${n.map((u,d)=>`start[${d}]`).join()});`:n.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}};function pxe(t,n,e,r){let o=r.texData.get(t.dataId),i=r.makeTensorInfo(e,t.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=t.dtype;let a=tr.computeFlatOffset(n,w.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function _l(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r,[a,l]=tr.parseSliceParams(o,i,s);if(tr.assertParamsValid(o,a,l),w.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.texData.get(o.dataId),p=m5(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}let{isPacked:c}=e.texData.get(o.dataId),u=tr.isSliceContinous(o.shape,a,l);if(c||!u){let d=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new E_(l):new I_(l),p=d.getCustomSetupFunc(a);return e.runWebGLProgram(d,[o],o.dtype,p)}return e.uploadToGPU(o.dataId),pxe(o,a,l,e)}var C8={kernelName:Vc,backendName:"webgl",kernelFunc:_l};var fxe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;w.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((b,I)=>b*I),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=[],m=ce({inputs:{x:o},backend:e,attrs:{shape:l}}),h=Xt({inputs:{x:m},backend:e,attrs:{perm:c}}),g=ce({inputs:{x:h},backend:e,attrs:{shape:u}}),x=_l({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(m),f.push(h),f.push(g),f.forEach(b=>e.disposeIntermediateTensorInfo(b)),x},_8={kernelName:lc,backendName:"webgl",kernelFunc:fxe};function mxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),c=r_(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var I8={kernelName:Pb,backendName:"webgl",kernelFunc:mxe};var hxe="return float(a != b);",QA=_t({opSnippet:hxe,dtype:"bool"}),E8={kernelName:xd,backendName:"webgl",kernelFunc:QA};function Il(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return mn({inputs:{x:o.complexTensorInfos.real},backend:e})}var S8={kernelName:nm,backendName:"webgl",kernelFunc:Il};var gxe="return float(int(x));";function T8(t,n){let e=new Pr(t.shape,gxe),r=n.runWebGLProgram(e,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function JA(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return mn({inputs:{x:o},backend:e});let s=Gt(o.shape),a=JA({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Yr({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=Il({inputs:{input:o},backend:e}),a=JA({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!w.hasEncodingLoss(o.dtype,i)){let s=mn({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32")return T8(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",w.getTypedArrayFromDType("bool",1)),l=QA({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var D8={kernelName:ys,backendName:"webgl",kernelFunc:JA};var N8="return ceil(x);",yxe=_e({opSnippet:N8,packedOpSnippet:N8,cpuKernelImpl:Yq}),k8={kernelName:va,backendName:"webgl",kernelFunc:yxe};var S_=class{constructor(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};var T_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};function vxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{clipValueMin:i,clipValueMax:s}=r,a;H().getBool("WEBGL_PACK_CLIP")?a=new T_(o.shape):a=new S_(o.shape);let l=a.getCustomSetupFunc(i,s);return e.runWebGLProgram(a,[o],o.dtype,l)}var A8={kernelName:xa,backendName:"webgl",kernelFunc:vxe};var D_=class{constructor(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function R8(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}}function xxe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=e.texData.get(r.dataId),i=new D_(r.shape),s=[R8(r,o.complexTensorInfos.real),R8(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var M8={kernelName:cc,backendName:"webgl",kernelFunc:xxe};var N_=class{constructor(n){this.outputShape=[],this.outputShape=T.computeOutShape(n,1),this.variableNames=n.map((s,a)=>`T${a}`);let e=new Array(n.length-1);e[0]=n[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+n[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var A_=class{constructor(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(n,e);let r=this.outputShape,o=r.length,i=He(o),s=fn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=n.map((h,g)=>`T${g}`);let l=new Array(n.length-1);l[0]=n[0][e];for(let h=1;h<l.length;h++)l[h]=l[h-1]+n[h][e];let c=a[e],u=a.slice(-2),d=a.join(),p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let h=1;h<l.length;h++){let g=l[h-1];p+=`
        if (${c} < ${l[h]}  && ${c} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${k_(a,c,g)}),
            vec2(${k_(u,c,g)}));
        }`}let f=l.length,m=l[l.length-1];p+=`
        return getChannel(
          getT${f}(${k_(a,c,m)}),
          vec2(${k_(u,c,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function k_(t,n,e){let r=t.indexOf(n);return t.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function fp(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return mn({inputs:{x:o.complexTensorInfos.imag},backend:e})}var F8={kernelName:Yf,backendName:"webgl",kernelFunc:fp};function mp(t,n,e){let r=t[0].dtype;if(r==="complex64"){let u=t.map(h=>Il({inputs:{input:h},backend:e})),d=t.map(h=>fp({inputs:{input:h},backend:e})),p=mp(u,n,e),f=mp(d,n,e),m=Yr({inputs:{real:p,imag:f},backend:e});return u.forEach(h=>e.disposeIntermediateTensorInfo(h)),d.forEach(h=>e.disposeIntermediateTensorInfo(h)),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}let o=e.shouldExecuteOnCPU(t);if(r==="string"&&(o=!0),o){let u=t.map(x=>{let I=[-1,w.sizeFromShape(x.shape.slice(n))];return ce({inputs:{x},backend:e,attrs:{shape:I}})}),d=u.map(x=>({vals:e.readSync(x.dataId),shape:x.shape})),p=T.computeOutShape(u.map(x=>x.shape),1),f=u[0].shape[0]===1,m=Zq(d,p,r,f),h=T.computeOutShape(t.map(x=>x.shape),n),g=e.makeTensorInfo(h,r,m);return u.forEach(x=>e.disposeIntermediateTensorInfo(x)),g}if(t.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(t.length/2),d=mp(t.slice(0,u),n,e),p=mp(t.slice(u),n,e),f=mp([d,p],n,e);return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),f}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){let u=new A_(t.map(d=>d.shape),n);return e.runWebGLProgram(u,t,r)}let{tensors2D:i,outShape:s}=bxe(t,n,e),a=new N_(i.map(u=>u.shape)),l=e.runWebGLProgram(a,i,r);i.forEach(u=>e.disposeIntermediateTensorInfo(u));let c=ce({inputs:{x:l},attrs:{shape:s},backend:e});return e.disposeIntermediateTensorInfo(l),c}function bxe(t,n,e){let r=T.computeOutShape(t.map(i=>i.shape),n);return{tensors2D:t.map(i=>ce({inputs:{x:i},attrs:{shape:[-1,w.sizeFromShape(i.shape.slice(n))]},backend:e})),outShape:r}}function eR(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=w.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(c=>c.shape),i);if(w.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(c=>w.sizeFromShape(c.shape)>0);if(a.length===1)return mn({inputs:{x:a[0]},backend:e});let l=a.map(c=>c.shape);return T.assertParamsConsistent(l,i),mp(a,i,e)}var O8={kernelName:uc,backendName:"webgl",kernelFunc:eR};var lh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4,g=n.dataFormat==="channelsLast",x=g?1:2,b=g?2:3,I=g?3:1,_="",E="";r&&(o?_=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?_=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:_=`
          float activation(float x) {
            ${r}
          }
        `,E="result = activation(result);");let S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${_}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${I}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${b}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${n.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${S}
        ${E}
        setOutput(result);
      }
    `}},R_=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let e=n.padInfo.front,r=n.padInfo.top,o=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var M_=class{constructor(n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let{filterWidth:o,inChannels:i,strideWidth:s,strideHeight:a,padInfo:l,outWidth:c,dilationWidth:u,dilationHeight:d,dataFormat:p}=r,{left:f,top:m}=l,h=i*o,g=nn(),x=p==="channelsLast",b=x?0:1,I=x?1:2,_="";for(let E=0;E<=1;E++)for(let S=0;S<=1;S++)_+=`
          blockIndex = rc.y + ${S};
          pos = rc.x + ${E};

          if(blockIndex < ${n[1]} && pos < ${n[0]}) {
            offsetY = int(blockIndex / (${c})) * ${a} - ${m};
            d0 = offsetY + ${d} * (pos / ${h});

            if(d0 < ${e[b]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${c}.) * ${s}. - ${f}.);
              d1 = offsetX + ${u} * (int(mod(float(pos), ${h}.) / ${i}.));

              if(d1 < ${e[I]} && d1 >= 0) {

                ch = int(mod(float(pos), ${i}.));

                if (${x}) {
                  innerDims = vec2(d1, ch);
                  result[${E*2+S}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${E*2+S}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${_}

        ${g.output} = result;
      }
    `}};function F_({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=t.shape,c=r.texData.get(t.dataId),u=e.inChannels,d=l[0]*l[1]*l[2],p=e.outChannels,f=e.dataFormat==="channelsLast",m=!1,h=!1,g,x=[],b=(d===1||p===1)&&u>YA,I=l[2]%2!==0&&!!c.isPacked;if(b||!H().getBool("WEBGL_LAZILY_UNPACK")||!H().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!I){let _=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],E=ce({inputs:{x:t},backend:r,attrs:{shape:[1,_,e.inChannels]}}),S=ce({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=pp({a:E,b:S,transposeA:m,transposeB:h,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=ce({inputs:{x:D},backend:r,attrs:{shape:e.outShape}}),x.push(E),x.push(S),x.push(D)}else{let _=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),E={dataId:t.dataId,shape:[1,_,e.inChannels],dtype:t.dtype},S=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,w.assert(lp(c.shape,E.shape),()=>`packed reshape ${c.shape} to ${E.shape} isn't free`);let D=ce({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});x.push(D);let M=pp({a:E,b:D,backend:r,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),R=r.texData.get(M.dataId);w.assert(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=S,R.shape=e.outShape,g=mn({inputs:{x:M},backend:r}),g.shape=e.outShape,x.push(M)}for(let _ of x)r.disposeIntermediateTensorInfo(_);return g}function O_({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:p,dataFormat:f}=e,m=f==="channelsLast",h=l*c*u,g=p*d,x=[h,g],b=!0,I=!1,_=[],E=ce({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),S=ce({inputs:{x:n},backend:r,attrs:{shape:[1,h,w.sizeFromShape(n.shape)/h]}});_.push(E),_.push(S);let D=new M_(x,E.shape,e),M=r.runWebGLProgram(D,[E],"float32"),R=ce({inputs:{x:M},backend:r,attrs:{shape:[1,x[0],x[1]]}});_.push(M),_.push(R);let L=o!=null,G=i!=null,W=a==="leakyrelu",q=a?hu(a,!0):null,X=new ah(R.shape,S.shape,[1,g,e.outChannels],b,I,L,q,G,W),K=[R,S];if(o&&K.push(o),G&&K.push(i),W){let oe=r.makeTensorInfo([],"float32",w.createScalarValue(s,"float32"));K.push(oe),_.push(oe)}let Z=r.runWebGLProgram(X,K,"float32"),se=m?[1,p,d,e.outChannels]:[1,e.outChannels,p,d],ee=ce({inputs:{x:Z},backend:r,attrs:{shape:se}});_.push(Z);for(let oe of _)r.disposeIntermediateTensorInfo(oe);return ee}function wxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=F_({x:o,filter:i,convInfo:p,backend:e});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)f=O_({x:o,filter:i,convInfo:p,backend:e});else{let h=new lh(p);f=e.runWebGLProgram(h,[o,i],"float32")}let m=ce({inputs:{x:f},backend:e,attrs:{shape:p.outShape}});return e.disposeIntermediateTensorInfo(f),m}var P8={kernelName:dc,backendName:"webgl",kernelFunc:wxe};var P_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              if (${s}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},L_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,l=r-1-n.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${n.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},$_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yF = 0; yF < ${n.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${n.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${n.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${n.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},V_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=e-1-n.padInfo.front,c=r-1-n.padInfo.top,u=o-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${n.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${n.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Cxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new P_(p);return e.runWebGLProgram(f,[o,i],"float32")}var L8={kernelName:Bf,backendName:"webgl",kernelFunc:Cxe};function _xe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(c),p=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d),f=new L_(p);return e.runWebGLProgram(f,[o,i],"float32")}var $8={kernelName:pc,backendName:"webgl",kernelFunc:_xe};function Ixe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),u=new R_(c);return e.runWebGLProgram(u,[o,i],"float32")}var V8={kernelName:fc,backendName:"webgl",kernelFunc:Ixe};function Exe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r,c=T.computeConv3DInfo(o.shape,l,s,1,a),u=new $_(c);return e.runWebGLProgram(u,[o,i],"float32")}var B8={kernelName:zf,backendName:"webgl",kernelFunc:Exe};function Sxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r,c=T.computeConv3DInfo(l,i.shape,a,1,s),u=new V_(c);return e.runWebGLProgram(u,[o,i],"float32")}var z8={kernelName:Uf,backendName:"webgl",kernelFunc:Sxe};var Txe=u_+`
  return cos(x);
`,Dxe=_e({opSnippet:Txe}),U8={kernelName:ba,backendName:"webgl",kernelFunc:Dxe};var Nxe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,kxe=_e({opSnippet:Nxe}),j8={kernelName:wa,backendName:"webgl",kernelFunc:kxe};var B_=class{constructor(n,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,c]=n,[u]=e,[d,p]=r;this.outputShape=[u,d,p,c];let f=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[g,x,b]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[I,_,E]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${I});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${_};

        float in_y = ${b};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${E};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var Axe=t=>{let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,u=new B_(o.shape,i.shape,a,l,c);return e.runWebGLProgram(u,[o,i,s],"float32")},G8={kernelName:Lb,backendName:"webgl",kernelFunc:Axe};var a0=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=n;let o=n.length,i=e?"0.0":`getX(${W8(o,"coords")})`,s=n[n.length-1],a="",l="";e?(a=r?`end != ${s-1}`:"end != 0",l=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${s}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${He(o)} coords = getOutputCoords();
        int end = ${H8(o,"coords")};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${l};
          ${H8(o,"coords")} = idx;
          val += getX(${W8(o,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.index==null&&(this.index=e.getUniformLocation(r,"index")),e.gl.uniform1f(this.index,n)}}};function W8(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.x, ${n}.y`;if(t===3)return`${n}.x, ${n}.y, ${n}.z`;if(t===4)return`${n}.x, ${n}.y, ${n}.z, ${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function H8(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.y`;if(t===3)return`${n}.z`;if(t===4)return`${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Rxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r,l=o.shape.length,c=T.getAxesPermutation([i],l),u=o;c!=null&&(u=Xt({inputs:{x:o},backend:e,attrs:{perm:c}}));let d=T.getInnerMostAxes(1,l)[0];if(d!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${o.shape.length-1} but got axis=${i}`);let p=u.shape[d],f=mn({inputs:{x:u},backend:e});for(let m=0;m<=Math.ceil(Math.log2(p))-1;m++){let h=new a0(u.shape,!1,a),g=h.getCustomSetupFunc(m),x=f;f=e.runWebGLProgram(h,[f],f.dtype,g),e.disposeIntermediateTensorInfo(x)}if(s){let m=new a0(u.shape,s,a),h=f;f=e.runWebGLProgram(m,[f],f.dtype),e.disposeIntermediateTensorInfo(h)}if(c!=null){let m=T.getUndoAxesPermutation(c),h=Xt({inputs:{x:f},backend:e,attrs:{perm:m}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(u),h}return f}var q8={kernelName:mc,backendName:"webgl",kernelFunc:Rxe};function Mxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=r_(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=Xq(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var K8={kernelName:$b,backendName:"webgl",kernelFunc:Mxe};var z_=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Fxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;w.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),m=s==="NHWC"?[a,d,p,f]:[a,f,d,p],h=new z_(m,i,s);return e.runWebGLProgram(h,[o],o.dtype)}var X8={kernelName:jf,backendName:"webgl",kernelFunc:Fxe};var ch=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.inHeight,a=n.inWidth,l=n.padInfo.top,c=n.padInfo.left,u=n.strideHeight,d=n.strideWidth,p=n.dilationHeight,f=n.dilationWidth,m=n.filterHeight,h=n.filterWidth,g=n.outChannels/n.inChannels,x="",b="";r&&(o?x=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?x=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:x=`
          float activation(float x) {
            ${r}
          }
        `,b="result = activation(result);");let I=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      const ivec2 strides = ivec2(${u}, ${d});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${g};
        int q = d2 - d1 * ${g};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${s}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${a}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${I}
        ${b}
        setOutput(result);
      }
    `}};var uh=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;let s=n.outChannels/n.inChannels,a=n.inHeight,l=n.inWidth,c=n.padInfo.top,u=n.padInfo.left,d=n.strideHeight,p=n.strideWidth,f=n.dilationHeight,m=n.dilationWidth,h=n.filterHeight,g=n.filterWidth,x=g,b=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let S=0;S<g;S++)b+=`
          vec4 xTexelC${S*2};
          int xTexelC${S*2}Ready;
          vec4 xC${S};`;for(let S=0;S<h;S++){for(let D=0;D<g;D++)b+=`
          xTexelC${D*2} = vec4(0.0);
          xTexelC${D*2}Ready = 0;
          xC${D} = vec4(0.0);`;b+=`
        xR = xRCorner + ${S*f};
        if (xR >=0 && xR < ${a}) {
      `;for(let D=0;D<(x+1)/2;D++){let M=D*2,R=M*m;if(b+=`
          xC = xCCorner + ${R};
          `,p===1){if(M<g&&(u%2===1?(b+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }
              `,m===1&&R>0?b+=`
                xC${M} = vec4(xTexelC${R-2}.zw, xTexelC${R}.xy);
                `:b+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < ${l}) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      previous.zw = vec2(0.0);
                    }

                    xC${M} = vec4(previous.zw, xTexelC${R}.xy);
                  } else {
                    xC${M} = vec4(0.0, 0.0, xTexelC${R}.xy);
                  }
                  `):b+=`
                if (xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xC${M} = xTexelC${R};
                `,R+1<g)){let L=u%2===0?w.nearestLargerEven(m):m;m%2===0&&u%2===1||m%2!==0&&u%2!==1?(b+=`
                  xCOffset = xC + ${u%2} + ${L};

                  if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                    xTexelC${R+2} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      xTexelC${R+2}.zw = vec2(0.0);
                    }
                    xTexelC${R+2}Ready = 1;
                  }
                  `,m>1&&(b+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                      xTexelC${R} = getX(batch, xR, xCOffset, d1);
                      xTexelC${R}Ready = 1;
                    }
                    `),b+=`
                  xC${M+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.xy);
                  `):L===1?b+=`
                    xC${M+1} = xTexelC${R};
                    `:b+=`
                    xCOffset = xC + ${L};

                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                      xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= ${l}) {
                        xTexelC${R+2}.zw = vec2(0.0);
                      }
                      xTexelC${R+2}Ready = 1;
                    }

                    xC${M+1} = xTexelC${R+2};
                    `}}else R<g&&(u%2===1?(b+=`
                xCOffset = xC + 1 - ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.0);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${M} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
              `,R+1<g&&(b+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + ${p};
                  if(xCOffset >= 0 && xCOffset < ${l}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${M+1} = vec4(xTexelC${R+2}.xy, final.xy);
                `)):(b+=`
                if(xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xCOffset = xC + ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${M} = vec4(
                  xTexelC${R}.xy, xTexelC${R+2}.xy);
              `,R+1<g&&(b+=`
                  xC${M+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
                `)));M<g&&(b+=`
            wTexel = getW(${S}, ${R}, d1, q);
            dotProd += xC${M} * vec4(wTexel.xz, wTexel.xz);
          `,R+1<g&&(b+=`
              wTexel = getW(${S}, ${R+1}, d1, q);
              dotProd += xC${M+1} * vec4(wTexel.xz, wTexel.xz);
            `))}b+=`
        }
      `}let I="",_="";r&&(o?I=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?I=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:I=`vec4 activation(vec4 x) {
          ${r}
        }`,_="result = activation(result);");let E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${I}

      const ivec2 strides = ivec2(${d}, ${p});
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${b}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${E}
        ${_}
        setOutput(result);
      }
    `}};function Oxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r,u=l;u==null&&(u=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let d=T.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!0),p;return H().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new uh(d):p=new ch(d),e.runWebGLProgram(p,[o,i],"float32")}var Y8={kernelName:hc,backendName:"webgl",kernelFunc:Oxe};var U_=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},j_=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,a=r-1-n.padInfo.left,l=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Pxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new U_(d);return e.runWebGLProgram(p,[o,i],"float32")}var Z8={kernelName:Gf,backendName:"webgl",kernelFunc:Pxe};function Lxe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new j_(d);return e.runWebGLProgram(p,[o,i],"float32")}var Q8={kernelName:Wf,backendName:"webgl",kernelFunc:Lxe};var G_=class{constructor(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function $xe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=[...r.shape,...r.shape],i=w.sizeFromShape(r.shape),s=ce({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new G_(i),l=e.runWebGLProgram(a,[s],s.dtype),c=ce({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),c}var J8={kernelName:Vb,backendName:"webgl",kernelFunc:$xe};var W_=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=n,{top:d,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function Vxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u,d=new W_(c);u=e.runWebGLProgram(d,[o,i],"float32");let p=ce({inputs:{x:u},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(u),p}var e6={kernelName:gc,backendName:"webgl",kernelFunc:Vxe};function Bxe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:x,expandDims:b}=T.getEinsumPermutation(f,l[g]),I;T.isIdentityPermutation(x)?I=i[g]:(I=Xt({inputs:{x:i[g]},backend:e,attrs:{perm:x}}),m.push(I));let _=I.shape.slice();for(let E=0;E<b.length;++E)_.splice(b[E],0,1);w.arraysEqual(I.shape,_)||(I=ce({inputs:{x:I},backend:e,attrs:{shape:_}}),m.push(I)),p===null?p=I:(p=i0({inputs:{a:I,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=dp({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var t6={kernelName:Bb,backendName:"webgl",kernelFunc:Bxe};var zxe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Uxe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,jxe=_e({opSnippet:zxe,packedOpSnippet:Uxe}),n6={kernelName:_a,backendName:"webgl",kernelFunc:jxe};var Gxe="return (b >= 1.0) ? a : a * (b + 1.0);",Wxe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Hxe=t=>{let{inputs:n,backend:e}=t,{dy:r,y:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new bi(Wxe,r.shape,o.shape):new zo(Gxe,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},r6={kernelName:Hf,backendName:"webgl",kernelFunc:Hxe};var qxe=`
  return vec4(equal(a, b));
`,Kxe="return float(a == b);",Xxe=_t({opSnippet:Kxe,packedOpSnippet:qxe,dtype:"bool"}),o6={kernelName:pd,backendName:"webgl",kernelFunc:Xxe};var Yxe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Zxe=_e({opSnippet:Yxe}),i6={kernelName:Ia,backendName:"webgl",kernelFunc:Zxe};var s6="return exp(x);",tR=_e({opSnippet:s6,packedOpSnippet:s6,cpuKernelImpl:Qq}),a6={kernelName:Ea,backendName:"webgl",kernelFunc:tR};function H_(t){let{inputs:n,attrs:e,backend:r}=t,{dim:o}=e,{input:i}=n,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(w.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),ce({inputs:{x:i},backend:r,attrs:{shape:a}})}var l6={kernelName:yc,backendName:"webgl",kernelFunc:H_};var c6="return exp(x) - 1.0;",Qxe=_e({opSnippet:c6,packedOpSnippet:c6,cpuKernelImpl:Jq}),u6={kernelName:Sa,backendName:"webgl",kernelFunc:Qxe};var l0=class{constructor(n,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(n==="real")a="return real * expR - imag * expI;";else if(n==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${n}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function q_(t,n,e){let r=e.texData.get(t.dataId),o=w.sizeFromShape(t.shape),i=t.shape[t.shape.length-1],s=o/i,a=ce({inputs:{x:t},backend:e,attrs:{shape:[s,i]}}),l=a.shape,c=new l0("real",l,n),u=new l0("imag",l,n),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Yr({inputs:{real:p,imag:f},backend:e});e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f);let h=ce({inputs:{x:m},backend:e,attrs:{shape:t.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(m),h}function Jxe(t){let{inputs:n,backend:e}=t,{input:r}=n;return q_(r,!1,e)}var d6={kernelName:qf,backendName:"webgl",kernelFunc:Jxe};var K_=class{constructor(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};function c0(t){let{backend:n,attrs:e}=t,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||w.inferDtype(o),i==="string"){let s=w.getArrayFromDType(i,w.sizeFromShape(r));return s.fill(o),n.makeTensorInfo(r,i,s)}else{let s=new K_(r,o),a=s.getCustomSetupFunc(o);return n.runWebGLProgram(s,[],i,a)}}var p6={kernelName:Kf,backendName:"webgl",kernelFunc:c0};var X_=class{constructor(n){this.variableNames=["Image"],this.outputShape=[];let e=n[2];this.outputShape=n,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var f6={kernelName:zb,backendName:"webgl",kernelFunc:({inputs:t,backend:n})=>{let{image:e}=t,r=n,o=new X_(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var m6="return floor(x);",ebe=_e({opSnippet:m6,packedOpSnippet:m6,cpuKernelImpl:e5}),h6={kernelName:Ta,backendName:"webgl",kernelFunc:ebe};var tbe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,nbe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,rbe=_t({opSnippet:tbe,packedOpSnippet:nbe,dtype:"int32"}),g6={kernelName:Da,backendName:"webgl",kernelFunc:rbe};var Y_=class{constructor(n){this.variableNames=["A"];let e=nn(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var Z_=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=nn(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var y6={kernelName:m3,backendName:"webgl",kernelFunc:obe},dh;function obe(t){let{inputs:n,backend:e,attrs:r}=t,{pixels:o}=n,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,i];(a||s)&&(dh==null&&(dh=document.createElement("canvas").getContext("2d")),dh.canvas.width=l,dh.canvas.height=c,dh.drawImage(o,0,0,l,c),o=dh.canvas);let p=e.makeTensorInfo(u,"int32");e.texData.get(p.dataId).usage=Ir.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);let f=H().getBool("WEBGL_PACK")?new Z_(d):new Y_(d),m=e.runWebGLProgram(f,[p],"int32");return e.disposeData(p.dataId),m}function ibe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=T.convertConv2DDataFormat(u),g=T.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,h),x,b=[];if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))x=F_({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)x=O_({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{let _=s!=null,E=a!=null,S=f==="leakyrelu",D=f?hu(f,!1):null,M=new lh(g,_,D,E,S),R=[o,i];if(s&&R.push(s),a&&R.push(a),S){let L=e.makeTensorInfo([],"float32",w.createScalarValue(m,"float32"));R.push(L),b.push(L)}x=e.runWebGLProgram(M,R,"float32")}let I=ce({inputs:{x},backend:e,attrs:{shape:g.outShape}});return b.push(x),b.forEach(_=>e.disposeIntermediateTensorInfo(_)),I}var v6={kernelName:wd,backendName:"webgl",kernelFunc:ibe};function sbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[],h=u;h==null&&(h=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let g=T.computeConv2DInfo(o.shape,i.shape,l,h,c,d,!0),x=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=p?hu(p,x):null,I=[o,i],_=s!=null,E=a!=null,S=p==="leakyrelu";if(_&&I.push(s),E&&I.push(a),S){let R=e.makeTensorInfo([],"float32",w.createScalarValue(f,"float32"));I.push(R),m.push(R)}let D;x?D=new uh(g,_,b,E,S):D=new ch(g,_,b,E,S);let M=e.runWebGLProgram(D,I,"float32");return m.forEach(R=>e.disposeIntermediateTensorInfo(R)),M}var x6={kernelName:Cd,backendName:"webgl",kernelFunc:sbe};var Q_=class{constructor(n,e,r){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;let o=He(e.length),i=He(r.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${o} strides = ${o}(${this.strides});
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${s};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}};function abe(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=o.shape,s=i[i.length-1],[a,l,c,u]=T.prepareAndValidate(r,o),d=ce({inputs:{x:o},backend:e,attrs:{shape:[l,s]}}),p=ce({inputs:{x:r},backend:e,attrs:{shape:[w.sizeFromShape(r.shape)/c,c]}}),f=new Q_(s,u,[l,c]),m=e.runWebGLProgram(f,[p,d],p.dtype),h=ce({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),h}var b6={kernelName:Ub,backendName:"webgl",kernelFunc:abe};var J_=class{constructor(n,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=He(this.rank),o=lbe(n,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}};function lbe(t,n){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<t.length;o++)o===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${e[o]}`);return r.join()}function cbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r,l=w.parseAxisParam(s,o.shape)[0],c=T.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=w.sizeFromShape(i.shape),d=[],p=ce({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=ce({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let m=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let b=e.bufferSync(f),I=e.bufferSync(p),_=t5(I,b,m);return d.forEach(E=>e.disposeIntermediateTensorInfo(E)),e.makeTensorInfo(c.outputShape,_.dtype,_.values)}let h=new J_(p.shape,m),g=e.runWebGLProgram(h,[p,f],p.dtype);d.push(g);let x=ce({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(b=>e.disposeIntermediateTensorInfo(b)),x}var w6={kernelName:xc,backendName:"webgl",kernelFunc:cbe};var ube="return float(a > b);",dbe=`
  return vec4(greaterThan(a, b));
`,pbe=_t({opSnippet:ube,packedOpSnippet:dbe,cpuKernelImpl:n5,dtype:"bool"}),C6={kernelName:fd,backendName:"webgl",kernelFunc:pbe};var fbe="return float(a >= b);",mbe=`
  return vec4(greaterThanEqual(a, b));
`,hbe=_t({opSnippet:fbe,packedOpSnippet:mbe,dtype:"bool"}),_6={kernelName:Na,backendName:"webgl",kernelFunc:hbe};function gbe(t){let{inputs:n,backend:e}=t,{input:r}=n;return q_(r,!0,e)}var I6={kernelName:Xf,backendName:"webgl",kernelFunc:gbe};var ybe="return float(!isnan(x) && !isinf(x));",vbe=_e({opSnippet:ybe,dtype:"bool"}),E6={kernelName:ka,backendName:"webgl",kernelFunc:vbe};var xbe="return float(isinf(x));",bbe=_e({opSnippet:xbe,dtype:"bool"}),S6={kernelName:Aa,backendName:"webgl",kernelFunc:bbe};var wbe="return float(isnan(x));",Cbe=_e({opSnippet:wbe,dtype:"bool"}),T6={kernelName:Ra,backendName:"webgl",kernelFunc:Cbe};var _be="return float(a < b);",Ibe=`
  return vec4(lessThan(a, b));
`,Ebe=_t({opSnippet:_be,packedOpSnippet:Ibe,cpuKernelImpl:r5,dtype:"bool"}),D6={kernelName:md,backendName:"webgl",kernelFunc:Ebe};var Sbe="return float(a <= b);",Tbe=`
  return vec4(lessThanEqual(a, b));
`,Dbe=_t({opSnippet:Sbe,packedOpSnippet:Tbe,dtype:"bool"}),N6={kernelName:hd,backendName:"webgl",kernelFunc:Dbe};function Nbe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=o5(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var k6={kernelName:jb,backendName:"webgl",kernelFunc:Nbe};var kbe=`if (x < 0.0) return NAN;
  return log(x);`,Abe=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,Rbe=_e({opSnippet:kbe,packedOpSnippet:Abe,cpuKernelImpl:i5}),A6={kernelName:Ma,backendName:"webgl",kernelFunc:Rbe};var Mbe="return log(1.0 + x);",Fbe=_e({opSnippet:Mbe}),R6={kernelName:Fa,backendName:"webgl",kernelFunc:Fbe};var Obe="return float(a >= 1.0 && b >= 1.0);",Pbe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Lbe=_t({opSnippet:Obe,packedOpSnippet:Pbe,dtype:"bool"}),M6={kernelName:gd,backendName:"webgl",kernelFunc:Lbe};var $be="return float(!(x >= 1.0));",Vbe=_e({opSnippet:$be}),F6={kernelName:yd,backendName:"webgl",kernelFunc:Vbe};var Bbe="return float(a >= 1.0 || b >= 1.0);",zbe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Ube=_t({opSnippet:Bbe,packedOpSnippet:zbe,dtype:"bool"}),O6={kernelName:vd,backendName:"webgl",kernelFunc:Ube};var eI=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var tI=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var jbe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c=H().getBool("WEBGL_PACK_NORMALIZATION")?new tI(o.shape,i,s,a,l):new eI(o.shape,i,s,a,l);return e.runWebGLProgram(c,[o],o.dtype)},P6={kernelName:wc,backendName:"webgl",kernelFunc:jbe};var nI=class{constructor(n,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var Gbe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new nI(o.shape,a,l,c,u);return e.runWebGLProgram(d,[o,i,s],o.dtype)},L6={kernelName:Zf,backendName:"webgl",kernelFunc:Gbe};function $6(t,n,e,r){let o=w.sizeFromShape(n),s=w.sizeFromShape(t.shape)/o,a=ce({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=xo(a,t.dtype,"max",r),c=ce({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function nR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=e.shouldExecuteOnCPU([o]),f=o;if(d){if(p){let I=e.texData.get(f.dataId).values,_=new Array(a);for(let D=0;D<_.length;D++)_[D]=o.shape[u[D]];let E=up(I,o.shape,o.dtype,u,_);f=e.makeTensorInfo(_,o.dtype);let S=e.texData.get(f.dataId);S.values=E}else f=gu(o,u,e);c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("max",c,a);let[m,h]=T.computeOutAndReduceShapes(f.shape,c),g=m;s&&(g=T.expandShapeToKeepDim(m,l));let x;if(p){let I=e.texData.get(f.dataId).values,_=s5(I,w.sizeFromShape(h),g,o.dtype);x=e.makeTensorInfo(g,o.dtype);let E=e.texData.get(x.dataId);E.values=_}else x=$6(f,h,g,e);return d&&e.disposeIntermediateTensorInfo(f),x}var V6={kernelName:Cc,backendName:"webgl",kernelFunc:nR};var Wbe=c_+`
  return max(a, b);
`,Hbe=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+mu+`
  return result;
`,qbe=_t({opSnippet:Wbe,packedOpSnippet:Hbe,cpuKernelImpl:a5}),B6={kernelName:Oa,backendName:"webgl",kernelFunc:qbe};function Kbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;As(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;w.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&w.arraysEqual(u.inShape,u.outShape))return mn({inputs:{x:o},backend:e});let d=new Yi(u,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}var z6={kernelName:_c,backendName:"webgl",kernelFunc:Kbe};function Xbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new yu(d,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var U6={kernelName:Ic,backendName:"webgl",kernelFunc:Xbe};var rI=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideHeight,r=n.strideWidth,o=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,a=i-1-n.padInfo.top,l=s-1-n.padInfo.left,c=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},oI=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterDepth,c=n.effectiveFilterHeight,u=n.effectiveFilterWidth,d=l-1-n.padInfo.front,p=c-1-n.padInfo.top,f=u-1-n.padInfo.left,m=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Ybe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new yu(p,"max",!0),m=e.runWebGLProgram(f,[s],s.dtype),h=new oI(p),g=e.runWebGLProgram(h,[o,m],s.dtype);return e.disposeIntermediateTensorInfo(m),g}var j6={kernelName:Jf,backendName:"webgl",kernelFunc:Ybe};function Zbe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;As([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=!0,m=new Yi(p,"max",f),h=e.runWebGLProgram(m,[a],a.dtype),g=new rI(p),x=e.runWebGLProgram(g,[o,h],a.dtype);return e.disposeIntermediateTensorInfo(h),x}var G6={kernelName:Qf,backendName:"webgl",kernelFunc:Zbe};function W6(t,n,e,r){let o=new Yi(e,"max",!1),i=r.runWebGLProgram(o,[t],"float32");o=new Yi(e,"max",!0,!0,n);let s=r.runWebGLProgram(o,[t],"float32");return[i,s]}var H6={kernelName:Gb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;w.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];w.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=T.computePool2DInfo(r.shape,o,i,c,s),[d,p]=W6(r,a,u,l);return[d,p]}};function q6(t,n,e,r){let o=w.sizeFromShape(n),s=w.sizeFromShape(t.shape)/o,a=ce({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=xo(a,"float32","mean",r),c=ce({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}var K6={kernelName:Ec,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{keepDims:o,axis:i}=n,s=e,a=r.shape.length,l=w.parseAxisParam(i,r.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=s.shouldExecuteOnCPU([r]),f=[],m=r;if(d){if(p){let _=s.texData.get(m.dataId).values,E=new Array(a);for(let M=0;M<E.length;M++)E[M]=r.shape[u[M]];let S=up(_,r.shape,r.dtype,u,E);m=s.makeTensorInfo(E,r.dtype);let D=s.texData.get(m.dataId);D.values=S}else m=gu(r,u,s);f.push(m),c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("sum",c,a);let[h,g]=T.computeOutAndReduceShapes(m.shape,c),x=h;o&&(x=T.expandShapeToKeepDim(h,l));let b=q6(m,g,x,s);for(let I of f)s.disposeIntermediateTensorInfo(I);return b}};function Qbe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=w.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=w.sizeFromShape(f),h=ce({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=xo(h,h.dtype,"min",e),x;if(s){let b=T.expandShapeToKeepDim(p,l);x=ce({inputs:{x:g},backend:e,attrs:{shape:b}})}else x=ce({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),x}var X6={kernelName:Sc,backendName:"webgl",kernelFunc:Qbe};var Jbe=c_+`
  return min(a, b);
`,ewe=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+mu+`
  return result;
`,twe=_t({opSnippet:Jbe,packedOpSnippet:ewe,cpuKernelImpl:l5}),Y6={kernelName:Pa,backendName:"webgl",kernelFunc:twe};var iI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((u,d)=>u[0]+n[d]+u[1]);let o=n.length,i=He(o),s=e.map(u=>u[0]).join(","),a=e.map((u,d)=>u[0]+n[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var sI=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,h)=>m[0]+n[h]+m[1]);let o=n.length,i=He(o),s=e.map(m=>m[0]).join(","),a=e.map((m,h)=>m[0]+n[h]).join(","),l=fn("rc",o),c=fn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1,f="";if(o===1){let m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{let m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var nwe=({inputs:t,backend:n,attrs:e})=>{let{x:r}=t,{paddings:o,mode:i}=e,s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new sI(r.shape,o,i):new iI(r.shape,o,i);return n.runWebGLProgram(s,[r],r.dtype)},Z6={kernelName:Tc,backendName:"webgl",kernelFunc:nwe};var rwe=`if (b == 0.0) return NAN;
  return mod(a, b);`,owe=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+mu+`
  return result;
`,iwe=_t({opSnippet:rwe,packedOpSnippet:owe}),Q6={kernelName:La,backendName:"webgl",kernelFunc:iwe};var aI=class{constructor(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.seedLoc==null&&(this.seedLoc=e.getUniformLocation(r,"seed")),e.gl.uniform1f(this.seedLoc,n)}}};var swe=`
if (a == b) {
  return 1.0;
};
return a / b;`,awe=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,rR=_t({opSnippet:swe,packedOpSnippet:awe,checkOutOfBounds:!0}),J6={kernelName:Ca,backendName:"webgl",kernelFunc:rR};var eK="return a - b;",oR=_t({opSnippet:eK,packedOpSnippet:eK,supportsComplex:!0,cpuKernelImpl:v5}),tK={kernelName:Ja,backendName:"webgl",kernelFunc:oR};function iR(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=w.parseAxisParam([i],o.shape),a=nR({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,s),c=ce({inputs:{x:a},backend:e,attrs:{shape:l}}),u=oR({inputs:{a:o,b:c},backend:e}),d=tR({inputs:{x:u},backend:e}),p=dp({inputs:{x:d},backend:e,attrs:{axis:s,keepDims:!1}}),f=ce({inputs:{x:p},backend:e,attrs:{shape:l}}),m=rR({inputs:{a:d,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}var nK={kernelName:jc,backendName:"webgl",kernelFunc:iR};function lwe(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r,l=a?o:iR({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new aI(c,u,i),p=d.getCustomSetupFunc(s),f=e.runWebGLProgram(d,[l],"int32",p);return a||e.disposeIntermediateTensorInfo(l),f}var rK={kernelName:Wb,backendName:"webgl",kernelFunc:lwe};var oK="return -x;";function cwe(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=u5(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new xi(r.shape,oK):o=new Pr(r.shape,oK),e.runWebGLProgram(o,[r],r.dtype)}var iK={kernelName:Dc,backendName:"webgl",kernelFunc:cwe};var uwe=ir.nonMaxSuppressionV3Impl;function dwe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=uwe(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var sK={kernelName:Hb,backendName:"webgl",kernelFunc:dwe};var pwe=ir.nonMaxSuppressionV4Impl;function fwe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=pwe(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var aK={kernelName:qb,backendName:"webgl",kernelFunc:fwe};var mwe=ir.nonMaxSuppressionV5Impl;function hwe(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:x}=mwe(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var lK={kernelName:Kb,backendName:"webgl",kernelFunc:hwe};var lI=class{constructor(n,e,r,o){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var gwe=t=>{let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r,l=w.sizeFromShape(o.shape),c=new lI(l,i,s,a),u=ce({inputs:{x:o},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[u],o.dtype);e.disposeIntermediateTensorInfo(u);let p=[...o.shape,i],f=ce({inputs:{x:d},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(d),f},cK={kernelName:kc,backendName:"webgl",kernelFunc:gwe};function u0(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="complex64"){let o=Il({inputs:{input:r},backend:e}),i=u0({inputs:{x:o},backend:e}),s=fp({inputs:{input:r},backend:e}),a=u0({inputs:{x:s},backend:e}),l=Yr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return c0({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var uK={kernelName:qc,backendName:"webgl",kernelFunc:u0};function dK(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=Il({inputs:{input:r},backend:e}),i=dK({inputs:{x:o},backend:e}),s=fp({inputs:{input:r},backend:e}),a=u0({inputs:{x:s},backend:e}),l=Yr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return c0({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var pK={kernelName:Nc,backendName:"webgl",kernelFunc:dK};function ywe(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return H_({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{w.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),w.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=H_({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=eR({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var fK={kernelName:Ac,backendName:"webgl",kernelFunc:ywe};var cI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((c,u)=>c[0]+n[u]+c[1]);let o=n.length,i=He(o),s=e.map(c=>c[0]).join(","),a=e.map((c,u)=>c[0]+n[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};
        uniform float value;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var uI=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,g)=>h[0]+n[g]+h[1]);let o=n.length,i=He(o),s=e.map(h=>h[0]).join(","),a=e.map((h,g)=>h[0]+n[g]).join(","),l=fn("rc",o),c=fn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,g=o===1?2:4;h<g;h++)m+=`
        ${p[h]}
        if (${f}) {
          result[${h}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${h}] = getChannel(getX(${c.join()}), ${d});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var sR=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r,a=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new uI(o.shape,i,s):new cI(o.shape,i,s),l=a.getCustomSetupFunc(s);return e.runWebGLProgram(a,[o],o.dtype,l)},mK={kernelName:Rc,backendName:"webgl",kernelFunc:sR};var vwe=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,xwe=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+mu+`
  return result;
`,bwe=_t({opSnippet:vwe,packedOpSnippet:xwe}),hK={kernelName:Va,backendName:"webgl",kernelFunc:bwe};function wwe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],c=w.parseAxisParam(i,o.shape),u=c,d=T.getAxesPermutation(u,a),p=o;d!=null&&(p=Xt({inputs:{x:o},backend:e,attrs:{perm:d}}),u=T.getInnerMostAxes(u.length,a),l.push(p)),T.assertAxesAreInnerMostDims("prod",u,a);let f;if(e.shouldExecuteOnCPU([p])){let m=e.texData.get(p.dataId).values,{outVals:h,outShape:g,outDtype:x}=d5(p.shape,p.dtype,m,u);f=e.makeTensorInfo(g,x,h)}else{let[m,h]=T.computeOutAndReduceShapes(p.shape,u),g=w.sizeFromShape(h),x=ce({inputs:{x:p},backend:e,attrs:{shape:[-1,g]}}),b=Id(o.dtype),I=xo(x,b,"prod",e);f=ce({inputs:{x:I},backend:e,attrs:{shape:m}}),l.push(x),l.push(I)}if(s){l.push(f);let m=T.expandShapeToKeepDim(f.shape,c);f=ce({inputs:{x:f},backend:e,attrs:{shape:m}})}return l.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var gK={kernelName:em,backendName:"webgl",kernelFunc:wwe};var aR=t=>{let{backend:n,attrs:e}=t,{start:r,stop:o,step:i,dtype:s}=e,a=p5(r,o,i,s);return n.makeTensorInfo([a.length],s,a)},yK={kernelName:tm,backendName:"webgl",kernelFunc:aR};var Cwe="return 1.0 / x;",_we=_e({opSnippet:Cwe}),vK={kernelName:Ba,backendName:"webgl",kernelFunc:_we};var Iwe=zn+`
  return (x < 0.0) ? 0.0 : x;
`,Ewe=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Swe=_e({opSnippet:Iwe,packedOpSnippet:Ewe}),xK={kernelName:za,backendName:"webgl",kernelFunc:Swe};var Twe=zn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Dwe=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Nwe=_e({opSnippet:Twe,packedOpSnippet:Dwe}),bK={kernelName:Ua,backendName:"webgl",kernelFunc:Nwe};var dI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var pI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function kwe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new pI(o.shape,l,c,i,s):new dI(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],"float32")}var wK={kernelName:Pc,backendName:"webgl",kernelFunc:kwe};var fI=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Awe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new fI(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var CK={kernelName:om,backendName:"webgl",kernelFunc:Awe};var mI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var hI=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function Rwe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new hI(o.shape,l,c,i,s):new mI(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],o.dtype)}var _K={kernelName:Oc,backendName:"webgl",kernelFunc:Rwe};var gI=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Mwe(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new gI(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var IK={kernelName:rm,backendName:"webgl",kernelFunc:Mwe};var yI=class{constructor(n,e){this.variableNames=["x"];let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=n,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${n[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&n[a]!==1?`${n[a]} - coords[${a}] - 1`:`coords[${a}]`,i=n.map((a,l)=>o(l)).join(","),s=He(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var vI=class{constructor(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=n;let o=fn("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=He(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${n[0]} - rc - 1),
            ${n[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${n[0]} - (rc  + 1) - 1),
                ${n[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${c(o.slice())};
          }
          if(${s}) {
            result.b = ${u(o.slice())};
            if(${i}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return p(m)}function c(m){return m[r-1]="("+m[r-1]+" + 1)",p(m)}function u(m){return m[r-2]="("+m[r-2]+" + 1)",p(m)}function d(m){return m[r-1]="("+m[r-1]+" + 1)",m[r-2]="("+m[r-2]+" + 1)",p(m)}function p(m){let h=n.map((b,I)=>f(I,m)),g=h.join(","),x=h.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function f(m,h){return e.indexOf(m)!==-1&&n[m]!==1?`${n[m]} - ${h[m]} - 1`:`${h[m]}`}}};function Fwe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r,s=o.shape.length,a=w.parseAxisParam(i,o.shape);if(s===0)return mn({inputs:{x:o},backend:e});let l=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new vI(o.shape,a):new yI(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var EK={kernelName:Lc,backendName:"webgl",kernelFunc:Fwe};var xI=class{constructor(n,e){this.variableNames=["Image"],this.outputShape=[];let r=n[1],o=n[2];this.outputShape=n;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        uniform vec4 params;
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}getCustomSetupFunc(n,e,r,o){return(i,s)=>{this.paramsLoc==null&&(this.paramsLoc=i.getUniformLocationNoThrow(s,"params")),i.gl.uniform4f(this.paramsLoc,n,e,r,o)}}};var SK={kernelName:ew,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=new xI(r.shape,i),[c,u]=T.getImageCenter(s,r.shape[1],r.shape[2]),d=l.getCustomSetupFunc(c,u,Math.sin(o),Math.cos(o));return a.runWebGLProgram(l,[r],r.dtype,d)}};var Owe=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Pwe=_e({opSnippet:Owe}),TK={kernelName:ja,backendName:"webgl",kernelFunc:Pwe};var Lwe="return inversesqrt(x);",$we=_e({opSnippet:Lwe,cpuKernelImpl:f5}),DK={kernelName:Ga,backendName:"webgl",kernelFunc:$we};var ph=class{constructor(n,e,r,o,i,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=He(i.length),c=He(s.length),u="";r===1?u="i":r===2&&(u="i, j");let d=`getIndices(${u})`,p="";o===1?p="i":o===2&&(p="i, coords[1]");let f=`getUpdates(${p})`,m=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${n}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function Vwe(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=ce({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),m=ce({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),h=e.makeTensorInfo([],"float32",new Float32Array([0])),g=new ph(l,a,f.shape.length,m.shape.length,u,p),x=e.runWebGLProgram(g,[m,f,h],m.dtype),b=ce({inputs:{x},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(x),e.disposeIntermediateTensorInfo(h),b}var NK={kernelName:Xb,backendName:"webgl",kernelFunc:Vwe};var bI=class{constructor(n,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<e.length;u++)c.push(`${a[u]}`),u<n&&l.push(`${a[u]}`);o=l.join(),i=c.join()}let s=He(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function Bwe(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n,s=new bI(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],Dn(o.dtype,i.dtype))}var kK={kernelName:$c,backendName:"webgl",kernelFunc:Bwe};var zwe=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Uwe=_e({opSnippet:zwe}),AK={kernelName:Wa,backendName:"webgl",kernelFunc:Uwe};var jwe="return 1.0 / (1.0 + exp(-1.0 * x));",Gwe=_e({opSnippet:jwe}),RK={kernelName:Xa,backendName:"webgl",kernelFunc:Gwe};var Wwe=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Hwe=_e({opSnippet:Wwe}),MK={kernelName:Ka,backendName:"webgl",kernelFunc:Hwe};var qwe=u_+`
  return sin(x);
`,Kwe=_e({opSnippet:qwe}),FK={kernelName:Ha,backendName:"webgl",kernelFunc:Kwe};var Xwe=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,Ywe=_e({opSnippet:Xwe}),OK={kernelName:qa,backendName:"webgl",kernelFunc:Ywe};var Zwe=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Qwe=_e({opSnippet:Zwe}),PK={kernelName:Ya,backendName:"webgl",kernelFunc:Qwe};var Jwe=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;w.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((x,b)=>x*b),l=[[0,0]];l.push(...s);for(let x=1+i.length;x<o.shape.length;++x)l.push([0,0]);let c=[],u=sR({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),d=T.getReshaped(u.shape,i,a,!1),p=T.getPermuted(d.length,i.length,!1),f=T.getReshapedPermuted(u.shape,i,a,!1),m=ce({inputs:{x:u},backend:e,attrs:{shape:d}}),h=Xt({inputs:{x:m},backend:e,attrs:{perm:p}}),g=ce({inputs:{x:h},backend:e,attrs:{shape:f}});return c.push(u),c.push(m),c.push(h),c.forEach(x=>e.disposeIntermediateTensorInfo(x)),g},LK={kernelName:zc,backendName:"webgl",kernelFunc:Jwe};function eCe(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=e.readSync(s.dataId)[0],[d,p,f,m,h]=h5(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var $K={kernelName:Yb,backendName:"webgl",kernelFunc:eCe};function tCe(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[c,u,d]=g5(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var VK={kernelName:Zb,backendName:"webgl",kernelFunc:tCe};function nCe(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,strides:u,outputSize:d}=T.calculateShapes(i,o,a),p=!1,f=new ph(c,l,o.shape.length,i.shape.length,u,[d,1],p),m=e.runWebGLProgram(f,[i,o,s],i.dtype),h=ce({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),h}var BK={kernelName:Qb,backendName:"webgl",kernelFunc:nCe};function rCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=w.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let m=_l({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,m})}var zK={kernelName:Uc,backendName:"webgl",kernelFunc:rCe};var oCe="return sqrt(x);",iCe=_e({opSnippet:oCe}),UK={kernelName:Za,backendName:"webgl",kernelFunc:iCe};var sCe="return x * x;",aCe=_e({opSnippet:sCe}),jK={kernelName:im,backendName:"webgl",kernelFunc:aCe};var GK="return (a - b) * (a - b);",lCe=_t({opSnippet:GK,packedOpSnippet:GK}),WK={kernelName:Qa,backendName:"webgl",kernelFunc:lCe};function cCe({inputs:t,attrs:n,backend:e}){let{x:r}=t,o=zn+`
    return x > 0.0 ? 1.0 : float(${n.alpha});
  `,i=new Pr(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var HK={kernelName:nl,backendName:"webgl",kernelFunc:cCe};var wI=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=He(r.length),s=He(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${n});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function uCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{nonStrided:f,$begin:m,$strides:h,size:g,newShape:x,outShape:b}=tr.sliceInfo(o.shape,i,s,a,l,c,u,d,p),I=ce({inputs:{x:o},backend:e,attrs:{shape:x}}),_;if(f){let S=_l({inputs:{x:I},backend:e,attrs:{begin:m,size:g}});_=ce({inputs:{x:S},backend:e,attrs:{shape:b}}),e.disposeIntermediateTensorInfo(S)}else if(b.some(S=>S===0))_=e.makeTensorInfo(b,o.dtype,[]);else if(e.shouldExecuteOnCPU([I])){let M=e.texData.get(I.dataId).values,R=Te(I.shape,I.dtype,M),L=y5(b,R,h,m);_=e.makeTensorInfo(b,I.dtype,L.values)}else{let D=new wI(m,h,b);_=e.runWebGLProgram(D,[I],I.dtype)}let E=ce({inputs:{x:_},backend:e,attrs:{shape:b}});return e.disposeIntermediateTensorInfo(I),e.disposeIntermediateTensorInfo(_),E}var qK={kernelName:sm,backendName:"webgl",kernelFunc:uCe};var dCe="return tan(x);",pCe=_e({opSnippet:dCe}),KK={kernelName:el,backendName:"webgl",kernelFunc:pCe};var fCe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,mCe=_e({opSnippet:fCe}),XK={kernelName:tl,backendName:"webgl",kernelFunc:mCe};var CI=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[s]*e[s];this.outputShape=r,this.rank=r.length;let o=He(this.rank),i=hCe(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function hCe(t){let n=t.length;if(n>5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`imod(resRC, ${t[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<t.length;o++)r.push(`imod(${e[o]}, ${t[o]})`);return r.join()}function lR(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>w.decodeString(p)):l,u=Te(o.shape,o.dtype,c),d=x5(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new CI(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var YK={kernelName:xs,backendName:"webgl",kernelFunc:lR};function gCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r,a=e.readSync(o.dataId),[l,c]=b5(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var ZK={kernelName:am,backendName:"webgl",kernelFunc:gCe};var _I=class{constructor(n,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${n} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${n}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function yCe(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],x=new _I(d,p,s,a,l,g);return e.runWebGLProgram(x,[o,i],"float32")}var QK={kernelName:Jb,backendName:"webgl",kernelFunc:yCe};function vCe(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;As(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=w5(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var JK={kernelName:lm,backendName:"webgl",kernelFunc:vCe};function xCe(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let h=0;h<a;h++)h!==i&&(c[u++]=s.shape[h]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let m=new Array(l);for(let h=0;h<m.length;h++){p[i]=h;let g=_l({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),x=ce({inputs:{x:g},backend:e,attrs:{shape:c}});m[h]=x,d.push(g)}return d.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var e9={kernelName:Wc,backendName:"webgl",kernelFunc:xCe};var II=class{constructor(n,e){this.variableNames=["x","segmentIds"];let r=n.windowSize,o=n.batchSize,i=n.inSize,s=n.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `,f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function bCe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=T.getAxesPermutation([c],a),d=o;u!=null&&(d=Xt({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=T.getInnerMostAxes(1,a)[0]);let p=T.segment_util.computeOutShape(d.shape,c,s),f=w.sizeFromShape([d.shape[c]]),m=ce({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(m);let h=Id(o.dtype),g=(_,E,S,D,M)=>{let R=_.shape[0],L=_.shape[1],G=T.segment_util.segOpComputeOptimalWindowSize(L,M),W={windowSize:G,inSize:L,batchSize:R,numSegments:M},q=new II(W,E),X=e.compileAndRun(q,[_,S],D);if(l.push(X),X.shape[1]===M)return X;let K=aR({backend:e,attrs:{start:0,stop:M,step:1,dtype:"float32"}}),Z=lR({inputs:{x:K},backend:e,attrs:{reps:[L/G]}});return l.push(K),l.push(Z),g(X,E,Z,D,M)},x=g(m,"unsortedSegmentSum",i,h,s),b=ce({inputs:{x},backend:e,attrs:{shape:p}}),I=b;if(u!=null){l.push(b);let _=T.getUndoAxesPermutation(u);I=Xt({inputs:{x:I},backend:e,attrs:{perm:_}})}return l.forEach(_=>e.disposeIntermediateTensorInfo(_)),I}var t9={kernelName:Hc,backendName:"webgl",kernelFunc:bCe};var wCe=[P6,L6,Z5,J5,e8,t8,r8,o8,i8,s8,c8,u8,d8,p8,m8,f8,h8,y8,g8,v8,x8,b8,w8,_8,I8,D8,k8,A8,M8,V5,O8,L8,$8,P8,B8,z8,V8,U8,j8,G8,q8,K8,X8,Z8,Q8,Y8,J8,e6,t6,n6,r6,o6,i6,a6,l6,u6,d6,p6,f6,h6,g6,y6,v6,x6,b6,w6,C6,_6,$5,I6,F8,E6,S6,T6,B5,D6,N6,k6,R6,A6,M6,F6,O6,V6,U6,z6,j6,G6,H6,B6,K6,X6,Y6,Z6,Q6,rK,W5,iK,sK,aK,lK,E8,cK,pK,fK,mK,hK,z5,gK,yK,S8,J6,vK,bK,xK,q5,wK,CK,_K,IK,EK,SK,TK,DK,NK,kK,AK,RK,MK,FK,OK,C8,nK,PK,LK,$K,VK,BK,zK,UK,jK,WK,HK,qK,tK,X5,KK,XK,YK,ZK,QK,Y5,JK,e9,t9,uK];for(let t of wCe)nw(t);function _Ce(t,n){if(t&1&&(v(0,"p",7),C(1," Predicted Emotion: "),v(2,"strong"),C(3),y()()),t&2){let e=Y();O(3),tt(e.predictedEmotion)}}var EI=class t{constructor(n){this.cdr=n;this.loadModel()}inputText="";predictedEmotion=null;model;tokenizer={};emotions=["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","optimism","pride","realization","relief","remorse","sadness","surprise","neutral"];VOCAB_SIZE=1e3;MAX_LENGTH=50;OOV_INDEX=1;async loadModel(){this.model=await _k("/assets/models/model.json"),console.log("Model loaded successfully:"),this.model.summary();let n=await fetch("/assets/models/tokenizer.json");this.tokenizer=await n.json(),console.log("Tokenizer mapping loaded:",this.tokenizer)}textToSequence(n){let e=n.trim().toLowerCase().split(/\s+/),r=[];for(let o of e){let i=this.tokenizer[o];(!i||i>=this.VOCAB_SIZE)&&(i=this.OOV_INDEX),r.push(i)}return r}padSequence(n){if(n.length>this.MAX_LENGTH)return n.slice(0,this.MAX_LENGTH);for(;n.length<this.MAX_LENGTH;)n.push(0);return n}async predictEmotion(){if(console.log("button clicked"),!this.model){console.error("Model not loaded yet.");return}let n=this.textToSequence(this.inputText);n=this.padSequence(n);let e=nu([n],[1,this.MAX_LENGTH],"int32"),o=await this.model.predict(e).data(),i=o.indexOf(Math.max(...o));this.predictedEmotion=this.emotions[i],this.cdr.markForCheck(),console.log("Predicted Emotion:",this.predictedEmotion)}static \u0275fac=function(e){return new(e||t)(ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-emotion-analyze-prototype"]],decls:10,vars:2,consts:[[1,"container","mt-5"],[1,"card","shadow-lg","p-4"],[1,"text-center","text-primary","mb-4"],[1,"form-group"],["rows","3","placeholder","Enter your text here...",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-block",3,"click"],["class","mt-3 alert alert-info text-center",4,"ngIf"],[1,"mt-3","alert","alert-info","text-center"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"div",1)(2,"h2",2),C(3,"Emotion Classifier"),y(),v(4,"div",3)(5,"textarea",4),fr("ngModelChange",function(i){return Tr(r.inputText,i)||(r.inputText=i),i}),C(6,"            "),y()(),v(7,"button",5),ae("click",function(){return r.predictEmotion()}),C(8," Predict Emotion "),y(),te(9,_Ce,4,1,"p",6),y()()),e&2&&(O(5),pr("ngModel",r.inputText),O(4),U("ngIf",r.predictedEmotion))},dependencies:[Pt,Ht,If,Pn,er,id],encapsulation:2})};function ICe(t,n){if(t&1&&(v(0,"div",14),C(1),y()),t&2){let e=Y();O(),tt(e.actionSuccess)}}function ECe(t,n){if(t&1&&(v(0,"div",15),C(1),y()),t&2){let e=Y();O(),tt(e.actionError)}}function SCe(t,n){if(t&1){let e=et();v(0,"li",16)(1,"div",17)(2,"i",18),ae("click",function(){let o=me(e).$implicit,i=Y();return he(i.onRowClick(o))}),y(),v(3,"div",19),ae("click",function(){let o=me(e).$implicit,i=Y();return he(i.onRowClick(o))}),v(4,"h5",20),C(5),y(),v(6,"span",21)(7,"span",22),C(8),y(),C(9," | "),v(10,"span",22),C(11),y(),C(12," | "),v(13,"span",22),C(14),Ni(15,"date"),y()()(),v(16,"div",23),ae("click",function(){let o=me(e).$implicit,i=Y();return he(i.deleteAccount(o.account_id))}),z(17,"i",24),y()()()}if(t&2){let e=n.$implicit;O(5),tt(e.account_name),O(3),$e("Broker: ",e.broker_name,""),O(3),Uu("Balance: ",e.balance," ",e.currency,""),O(3),$e("Created At: ",ki(15,5,e.created_at,"y, MMMM, d h:mm a"),"")}}function TCe(t,n){if(t&1&&(v(0,"div",15),C(1),y()),t&2){let e=Y(2);O(),tt(e.formError)}}function DCe(t,n){if(t&1){let e=et();v(0,"div",25),ae("click",function(o){me(e);let i=Y();return he(i.closeFormOnOutside(o))})("keydown.escape",function(){me(e);let o=Y();return he(o.toggleForm())}),v(1,"div",26),ae("click",function(o){return me(e),he(o.stopPropagation())}),v(2,"nav",27)(3,"ol",28)(4,"li",3)(5,"a",4),C(6,"Dashboard"),y()(),v(7,"li",3)(8,"a",29),ae("click",function(o){me(e);let i=Y();return he(i.closeFormOnOutside(o))}),C(9,"Trading Accounts"),y()(),v(10,"li",5),C(11,"Create Manual Account"),y()()(),v(12,"h4",30),C(13,"Create Manual Account"),y(),v(14,"p",31),C(15,"Set up a manual trading account to track your trades"),y(),v(16,"form",32),ae("ngSubmit",function(){me(e);let o=Y();return he(o.submitForm())}),v(17,"div",33)(18,"label",34),C(19,"Account Name"),y(),z(20,"input",35),y(),v(21,"div",33)(22,"label",34),C(23,"Broker Name"),y(),z(24,"input",36),y(),v(25,"div",33)(26,"label",34),C(27,"Account Type"),y(),z(28,"input",37),y(),v(29,"div",33)(30,"label",34),C(31,"Currency"),y(),z(32,"input",38),y(),v(33,"div",33)(34,"label",34),C(35,"Initial Balance"),y(),z(36,"input",39),y(),v(37,"div",33)(38,"label",34),C(39,"Account Notes (Optional)"),y(),z(40,"textarea",40),y(),v(41,"h5",8),C(42,"Trading Preferences"),y(),v(43,"div",41),z(44,"input",42),v(45,"label",43),C(46,"Track P&L"),y(),v(47,"small",44),C(48,"Enable profit and loss tracking for this account"),y()(),v(49,"div",41),z(50,"input",45),v(51,"label",46),C(52,"Include in Analytics"),y(),v(53,"small",44),C(54,"Include this account in overall performance metrics"),y()(),te(55,TCe,2,1,"div",10),v(56,"div",47)(57,"button",48),ae("click",function(){me(e);let o=Y();return he(o.toggleForm())}),C(58,"Cancel"),y(),v(59,"button",49),C(60,"Create Account"),y()()()()()}if(t&2){let e=Y();O(16),U("formGroup",e.tradeAccountForm),O(39),U("ngIf",e.formError)}}function NCe(t,n){if(t&1){let e=et();v(0,"div",25),ae("click",function(){me(e);let o=Y();return he(o.cancelDelete())})("keydown.escape",function(){me(e);let o=Y();return he(o.cancelDelete())}),v(1,"div",26),ae("click",function(o){return me(e),he(o.stopPropagation())}),v(2,"h5",33),C(3,"Confirm Deletion"),y(),v(4,"p"),C(5,"Are you sure you want to delete this trading account and all its associated data?"),y(),v(6,"div",47)(7,"button",50),ae("click",function(){me(e);let o=Y();return he(o.cancelDelete())}),C(8,"Cancel"),y(),v(9,"button",7),ae("click",function(){me(e);let o=Y();return he(o.confirmDelete())}),C(10,"Delete"),y()()()()}}var SI=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r;this.tradeAccountForm=this.fb.group({account_name:["",Ee.required],broker_name:[""],account_type:[""],currency:["USD"],balance:[0,Ee.min(0)],track_pl:[!1],include_in_analytics:[!1]})}tradeAccounts=[];showForm=!1;tradeAccountForm;formError=null;actionError=null;actionSuccess=null;selectedAccountId=null;showDeleteConfirm=!1;pendingDeleteAccountId=null;ngOnInit(){this.loadAccounts()}async loadAccounts(){try{this.tradeAccounts=await this.supabaseService.getUserTradeAccounts()}catch{this.actionError="Failed to load accounts. Please try again."}finally{this.cdr.markForCheck()}}async onRowClick(n){this.selectedAccountId=n.account_id,this.tradeAccountForm.patchValue({account_name:n.account_name,broker_name:n.broker_name,account_type:n.account_type,currency:n.currency,balance:n.balance,track_pl:n.metadata?.track_pl||!1,include_in_analytics:n.metadata?.include_in_analytics||!1}),this.showForm=!0}toggleForm(){this.showForm=!this.showForm,this.formError=null,this.actionSuccess=null,this.actionError=null,this.selectedAccountId=null,this.showForm||this.tradeAccountForm.reset({currency:"USD",balance:0})}async submitForm(){if(this.formError="",this.tradeAccountForm.valid){let n=this.tradeAccountForm.value;this.selectedAccountId?await this.supabaseService.editTradeAccount(this.selectedAccountId,n)?(this.actionSuccess="Account updated successfully",this.loadAccounts(),this.toggleForm()):this.formError="Failed to update account":await this.supabaseService.addTradeAccount(n)?(this.actionSuccess="Account added successfully",this.loadAccounts(),this.toggleForm()):this.formError="Failed to add account"}this.cdr.markForCheck()}async deleteAccount(n){this.showDeleteConfirm=!0,this.pendingDeleteAccountId=n}confirmDelete(){this.pendingDeleteAccountId&&this.performAccountDeletion(this.pendingDeleteAccountId),this.showDeleteConfirm=!1,this.pendingDeleteAccountId=null}cancelDelete(){this.showDeleteConfirm=!1,this.pendingDeleteAccountId=null}async performAccountDeletion(n){this.actionError=null,this.actionSuccess=null;try{await this.supabaseService.RemoveTradeAccount(n)?(this.loadAccounts(),this.actionSuccess="Account deleted successfully."):this.actionError="Failed to delete account."}catch{this.actionError="An unexpected error occurred while deleting."}finally{this.cdr.markForCheck(),setTimeout(()=>{this.actionSuccess="",this.cdr.markForCheck()},5e3)}}handleEscape(n){this.showForm&&this.toggleForm()}closeFormOnOutside(n){n.target===n.currentTarget&&this.toggleForm()}static \u0275fac=function(e){return new(e||t)(ne(ei),ne(kt),ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-tradeaccountmanage"]],hostBindings:function(e,r){e&1&&ae("keydown.escape",function(i){return r.handleEscape(i)},!1,wF)},decls:23,vars:5,consts:[[1,"container","mt-4"],["aria-label","breadcrumb",2,"--bs-breadcrumb-divider",`url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E")`],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],[1,"btn","btn-tr",3,"click"],[1,"mt-4"],["class","alert alert-success",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],[1,"list-group"],["class","list-group-item bg-transparent",4,"ngFor","ngForOf"],["class","overlay","tabindex","0",3,"click","keydown.escape",4,"ngIf"],[1,"alert","alert-success"],[1,"alert","alert-danger"],[1,"list-group-item","bg-transparent"],[1,"d-flex","align-items-center"],[1,"logo-circle","bi","bi-star-fill","text-primary",2,"font-size","2rem",3,"click"],[1,"ms-3",3,"click"],[1,"mt-2"],[1,"d-block","row","text-muted"],[1,"col-4"],["title","Delete Account",1,"delete-button","justify-content-end",3,"click"],[1,"bi","bi-trash"],["tabindex","0",1,"overlay",3,"click","keydown.escape"],[1,"modal-card",3,"click"],["aria-label","breadcrumb"],[1,"breadcrumb","small"],[3,"click"],[1,"mb-1"],[1,"text-muted","mb-3"],[3,"ngSubmit","formGroup"],[1,"mb-3"],[1,"form-label"],["type","text","formControlName","account_name","placeholder","e.g., My Futures Account",1,"form-control"],["type","text","formControlName","broker_name","placeholder","e.g., NinjaTrader, TastyWorks",1,"form-control"],["type","text","formControlName","account_type","placeholder","e.g., Margin, Cash",1,"form-control"],["type","text","formControlName","currency","placeholder","USD",1,"form-control"],["type","number","formControlName","balance",1,"form-control"],["rows","3","placeholder","Add any additional information about this account","disabled","",1,"form-control"],[1,"form-check","form-switch","mb-2"],["type","checkbox","formControlName","track_pl","id","track_pl",1,"form-check-input"],["for","track_pl",1,"form-check-label"],[1,"text-muted","d-block","ms-4"],["type","checkbox","formControlName","include_in_analytics","id","include_in_analytics",1,"form-check-input"],["for","include_in_analytics",1,"form-check-label"],[1,"d-flex","justify-content-end","gap-2","mt-3"],["type","button",1,"btn","btn-tr-secondary",3,"click"],["type","submit",1,"btn","btn-tr"],[1,"btn","btn-tr-secondary",3,"click"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Trading Accounts"),y()()(),v(8,"div",6)(9,"h3"),C(10,"Your Trade Accounts"),y(),v(11,"button",7),ae("click",function(){return r.toggleForm()}),C(12,"Add Account"),y()(),v(13,"div",8)(14,"h5"),C(15,"Manage your trading accounts"),y()(),te(16,ICe,2,1,"div",9)(17,ECe,2,1,"div",10),v(18,"div",0)(19,"ul",11),te(20,SCe,18,8,"li",12),y()(),te(21,DCe,61,2,"div",13)(22,NCe,11,0,"div",13),y()),e&2&&(O(16),U("ngIf",r.actionSuccess),O(),U("ngIf",r.actionError),O(3),U("ngForOf",r.tradeAccounts),O(),U("ngIf",r.showForm),O(),U("ngIf",r.showDeleteConfirm))},dependencies:[fo,uo,Pn,aa,od,er,co,po,Ro,Pt,Jn,Ht,as,Fn],styles:[".modal-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background-color:#00000080;z-index:1050}.overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;padding:2rem;width:100%;max-width:600px;max-height:90vh;overflow-y:auto;box-shadow:0 10px 25px #00000026}.list-group-item[_ngcontent-%COMP%]{cursor:pointer}.delete-button[_ngcontent-%COMP%]{color:red;display:none;margin-left:auto}.list-group-item[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{color:red;display:block}"]})};function kCe(t,n){if(t&1&&z(0,"img",38),t&2){let e=Y();U("src",e.currentImageUrl,Bl)}}function ACe(t,n){if(t&1&&z(0,"img",39),t&2){let e=Y();U("src",e.previewUrl,Bl)}}function RCe(t,n){t&1&&(v(0,"div",14),C(1,"No new image selected"),y())}function MCe(t,n){if(t&1&&(v(0,"div",26)(1,"div",40),C(2),y()()),t&2){let e=Y();O(2),tt(e.errorMessage)}}function FCe(t,n){if(t&1&&(v(0,"button",41),C(1," Save Changes "),y()),t&2){let e=Y();U("disabled",e.profileForm.invalid)}}var TI=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r;this.profileForm=this.fb.group({firstname:[""],lastname:[""],email:[""],phone:[""]})}profileForm;currentImageUrl=null;previewUrl=null;selectedFile=null;userId="";originalFormValue;formChanged=!1;errorMessage="";async ngOnInit(){await this.loadProfile(),this.trackFormChanges()}async loadProfile(){let{data:n}=await this.supabaseService.getProfile();n&&(this.profileForm.patchValue({firstname:n.firstname,lastname:n.lastname,email:n.email,phone:n.phone}),this.originalFormValue=this.profileForm.getRawValue(),n.profile_picture_url&&(this.currentImageUrl=await this.supabaseService.getCachedProfilePictureBlobUrl(n.profile_picture_url)),this.cdr.markForCheck())}async removeProfilePicture(){try{await this.supabaseService.deleteProfilePicture(),this.supabaseService.clearCachedProfilePictureBlobUrl(),await this.supabaseService.updateProfile({profile_picture_url:null}),this.currentImageUrl=null,this.previewUrl=null,this.selectedFile=null,this.formChanged=!0,this.cdr.markForCheck()}catch{this.errorMessage="Failed to remove profile picture."}}trackFormChanges(){this.profileForm.valueChanges.subscribe(()=>{this.formChanged=JSON.stringify(this.profileForm.getRawValue())!==JSON.stringify(this.originalFormValue)||!!this.selectedFile}),this.cdr.markForCheck()}onFileChange(n){this.errorMessage="";let e=n.target;if(!e?.files?.length)return;let r=e.files[0];if(!["image/jpeg","image/png","image/webp"].includes(r.type)){this.errorMessage="Only JPG, PNG, or WEBP images are allowed.",this.selectedFile=null;return}if(r.size>1024*1024){this.errorMessage="File size must be less than 1MB.",this.selectedFile=null;return}this.selectedFile=r,this.currentImageUrl=this.previewUrl,this.previewUrl=URL.createObjectURL(r),this.formChanged=!0,this.cdr.markForCheck()}async saveChanges(){if(!this.formChanged){this.errorMessage="No changes detected.";return}let n=null;this.selectedFile&&(n=await this.supabaseService.uploadProfilePicture(this.selectedFile));let e=this.profileForm.getRawValue(),r={firstname:e.firstname,lastname:e.lastname,email:e.email,phone:e.phone,profile_picture_url:n,updated_at:new Date().toISOString(),preferences:{},metadata:{}};n&&(this.supabaseService.clearCachedProfilePictureBlobUrl(),this.previewUrl=await this.supabaseService.getCachedProfilePictureBlobUrl(n),this.currentImageUrl=this.previewUrl),await this.supabaseService.updateProfile(r),this.formChanged=!1,this.selectedFile=null,this.originalFormValue=this.profileForm.getRawValue(),this.cdr.markForCheck()}static \u0275fac=function(e){return new(e||t)(ne(ei),ne(kt),ne(It))};static \u0275cmp=ht({type:t,selectors:[["app-user-account-settings"]],decls:71,vars:6,consts:[[1,"container","mb-5"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],[1,"mb-2"],[1,"text-muted","mb-4"],[1,"row","g-3","mb-4"],[1,"col-md-6"],[1,"card","border-0","shadow-sm","p-3","h-100"],[1,"d-flex","align-items-center","mb-2"],["alt","Profile","class","rounded-circle me-2","style","width: 40px; height: 40px; object-fit: cover;",3,"src",4,"ngIf"],[1,"mb-0"],[1,"text-muted"],[1,"card","border-primary","shadow-sm","p-3","h-100"],[1,"bi","bi-patch-check-fill","text-primary","me-2","fs-4"],[1,"mt-3"],[1,"btn","btn-outline-primary","btn-sm"],[1,"row","g-4",3,"ngSubmit","formGroup"],[1,"fw-bold"],[1,"form-label"],["formControlName","firstname","placeholder","First name",1,"form-control"],["formControlName","lastname","placeholder","Last name",1,"form-control"],["formControlName","email","placeholder","Email","type","email",1,"form-control"],["formControlName","phone","placeholder","+1 (123) 456-7890",1,"form-control"],[1,"col-12"],[1,"fw-bold","mt-3"],[1,"card","p-3","shadow-sm","border-light","bg-light-subtle"],[1,"form-label","d-block"],["alt","Preview","class","img-thumbnail","style","width: 120px;",3,"src",4,"ngIf"],["class","text-muted",4,"ngIf"],["type","file",1,"form-control","mt-2",3,"change"],[1,"mt-2","d-flex","gap-2"],["type","button",1,"btn","btn-outline-secondary","btn-sm",3,"click"],["class","col-12",4,"ngIf"],[1,"col-12","text-end"],["type","submit","class","btn btn-tr",3,"disabled",4,"ngIf"],["alt","Profile",1,"rounded-circle","me-2",2,"width","40px","height","40px","object-fit","cover",3,"src"],["alt","Preview",1,"img-thumbnail",2,"width","120px",3,"src"],[1,"alert","alert-danger"],["type","submit",1,"btn","btn-tr",3,"disabled"]],template:function(e,r){e&1&&(v(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),C(5,"Dashboard"),y()(),v(6,"li",5),C(7,"Account Settings"),y()()(),v(8,"h2",6),C(9,"Account Settings"),y(),v(10,"p",7),C(11,"Manage your profile, subscription, and preferences"),y(),v(12,"div",8)(13,"div",9)(14,"div",10)(15,"div",11),te(16,kCe,1,1,"img",12),v(17,"h5",13),C(18,"Profile Information"),y()(),v(19,"small",14),C(20,"Update your personal details and public profile"),y()()(),v(21,"div",9)(22,"div",15)(23,"small",14),C(24,"This is placeholder."),y(),v(25,"div",11),z(26,"i",16),v(27,"h5",13),C(28,"Pro Account"),y()(),v(29,"small",14),C(30,"Active until Dec 15, 2025"),y(),v(31,"div",17)(32,"button",18),C(33,"Manage Plan"),y()()()()(),v(34,"form",19),ae("ngSubmit",function(){return r.saveChanges()}),v(35,"h5",20),C(36,"Personal Information"),y(),v(37,"div",9)(38,"label",21),C(39,"First Name"),y(),z(40,"input",22),y(),v(41,"div",9)(42,"label",21),C(43,"Last Name"),y(),z(44,"input",23),y(),v(45,"div",9)(46,"label",21),C(47,"Email Address"),y(),z(48,"input",24),y(),v(49,"div",9)(50,"label",21),C(51,"Phone"),y(),z(52,"input",25),y(),v(53,"div",26)(54,"h6",27),C(55,"Profile Picture"),y(),v(56,"div",28)(57,"div",6)(58,"label",29),C(59,"Preview New Photo"),y(),te(60,ACe,1,1,"img",30)(61,RCe,2,0,"div",31),y(),v(62,"input",32),ae("change",function(i){return r.onFileChange(i)}),y(),v(63,"small",14),C(64,"JPG, PNG or GIF. Max 1MB."),y(),v(65,"div",33)(66,"button",34),ae("click",function(){return r.removeProfilePicture()}),C(67,"Remove"),y()()()(),te(68,MCe,3,1,"div",35),v(69,"div",36),te(70,FCe,2,1,"button",37),y()()()),e&2&&(O(16),U("ngIf",r.currentImageUrl),O(18),U("formGroup",r.profileForm),O(26),U("ngIf",r.previewUrl),O(),U("ngIf",!r.previewUrl),O(7),U("ngIf",r.errorMessage),O(2),U("ngIf",r.formChanged))},dependencies:[fo,uo,Pn,er,co,po,Ro,Pt,Ht,Fn],encapsulation:2})};var n9=[{path:"",component:kb,canActivate:[cb]},{path:"home",component:lb,canActivate:[vr]},{path:"pretrades",component:_b,canActivate:[vr]},{path:"pretradelog",component:Ef,canActivate:[vr]},{path:"posttrades",component:Ib,canActivate:[vr]},{path:"posttradelog",component:Sf,canActivate:[vr]},{path:"emotions",component:Nb,canActivate:[vr]},{path:"tradejournal",component:Ab,canActivate:[vr]},{path:"individualTrade",component:Tf,canActivate:[vr]},{path:"meditationhub",component:Rb,canActivate:[vr]},{path:"analytics",component:Mb,canActivate:[vr]},{path:"admin/emotionquestion",component:Eb,canActivate:[vr]},{path:"tradeaccounts",component:SI,canActivate:[vr]},{path:"useraccount",component:TI,canActivate:[vr]},{path:"mlemotion",component:EI,canActivate:[vr]},{path:"**",redirectTo:""}];var r9={providers:[EO(),JP(n9),oP(iP())]};function OCe(t,n){t&1&&(Zs(0),v(1,"div",1),z(2,"router-outlet"),y(),Qs())}function PCe(t,n){if(t&1){let e=et();v(0,"div",19)(1,"a",20),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/home"))}),z(2,"i",21),C(3,"Dashboard"),y(),v(4,"a",20),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/emotions"))}),z(5,"i",22),C(6,"Morning Check-In"),y(),v(7,"a",20),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/tradejournal"))}),z(8,"i",23),C(9,"Trade Journal"),y(),v(10,"a",20),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/meditationhub"))}),z(11,"i",24),C(12,"Meditation Hub"),y(),v(13,"a",20),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/analytics"))}),z(14,"i",25),C(15,"Analytics"),y(),v(16,"a",20),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/tradeaccounts"))}),z(17,"i",26),C(18,"Trade Accounts"),y()()}}function LCe(t,n){if(t&1&&(v(0,"div"),z(1,"img",32),y()),t&2){let e=Y(3);O(),U("src",e.profile_image_blob_url,Bl)}}function $Ce(t,n){t&1&&(v(0,"div"),z(1,"i",33),y())}function VCe(t,n){if(t&1){let e=et();v(0,"div",27)(1,"div",28),te(2,LCe,2,1,"div",0)(3,$Ce,2,0,"div",0),C(4," \xA0\xA0 "),v(5,"p",29),C(6),y()(),v(7,"button",30),ae("click",function(){me(e);let o=Y(2);return he(o.logOut())}),C(8,"Logout\xA0\xA0\xA0"),z(9,"i",31),y()()}if(t&2){let e=Y(2);O(2),U("ngIf",e.profile_image_blob_url),O(),U("ngIf",!e.profile_image_blob_url),O(3),$e("Welcome, ",e.supabaseService.currentUsername(),"!")}}function BCe(t,n){if(t&1){let e=et();v(0,"button",34),ae("click",function(){me(e);let o=Y(2);return he(o.navigateToUrl("/home"))}),z(1,"img",35),y()}}function zCe(t,n){if(t&1){let e=et();Zs(0),v(1,"div",2)(2,"nav",3)(3,"div",4)(4,"div",5)(5,"button",6),ae("click",function(){me(e);let o=Y();return he(o.navigateToUrl("/home"))}),v(6,"img",7),ae("click",function(){me(e);let o=Y();return he(o.navigateToUrl("/home"))}),y()(),v(7,"button",8),ae("click",function(){me(e);let o=Y();return he(o.closeSidebar())}),y()(),te(8,PCe,19,0,"div",9),y(),te(9,VCe,10,3,"div",10),y(),v(10,"div",11)(11,"nav",12)(12,"div",13)(13,"div",14)(14,"button",15),ae("click",function(){me(e);let o=Y();return he(o.toggleSidebar())}),z(15,"span",16),y(),te(16,BCe,2,0,"button",17),y()()(),v(17,"div",18),z(18,"router-outlet"),y()()(),Qs()}if(t&2){let e=Y();O(2),So("collapsed",e.sidebarCollapsed()),O(6),U("ngIf",e.loginStatus()),O(),U("ngIf",e.loginStatus()),O(),So("expanded",e.sidebarCollapsed()),O(6),U("ngIf",e.sidebarCollapsed())}}var DI=class t{constructor(n,e,r,o,i){this.cdr=n;this.supabaseService=e;this.router=r;this.route=o;this.platformId=i;this.loginStatus=Ul(()=>e.loginStatus())}title="TR-prototype";profile_image_blob_url="";loginStatus;sidebarCollapsed=io(!1);isMobile=io(!1);resizeObserver;ngOnInit(){this.checkScreenSize(),cn(this.platformId)&&(this.sidebarCollapsed.set(this.isMobile()),this.resizeObserver=new ResizeObserver(()=>{this.checkScreenSize(),this.cdr.detectChanges()}),this.resizeObserver.observe(document.body),console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngAfterViewInit(){cn(this.platformId)&&(this.loadProfileImage(),this.cdr.markForCheck(),setTimeout(()=>{this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngOnDestroy(){cn(this.platformId)&&this.resizeObserver&&this.resizeObserver.disconnect()}async loadProfileImage(){let{data:n}=await this.supabaseService.getProfile();n?.profile_picture_url&&(this.profile_image_blob_url=await this.supabaseService.getCachedProfilePictureBlobUrl(n.profile_picture_url))}async logOut(){await this.supabaseService.signOut(),this.router.navigateByUrl("/")}toggleSidebar(){this.sidebarCollapsed.update(n=>!n),this.cdr.detectChanges()}navigateToUrl(n){this.router.navigateByUrl(n)}closeSidebar(){this.sidebarCollapsed.set(!0),this.cdr.detectChanges()}checkScreenSize(){cn(this.platformId)&&this.isMobile.set(window.innerWidth<768)}static \u0275fac=function(e){return new(e||t)(ne(It),ne(kt),ne(ko),ne(Fi),ne(so))};static \u0275cmp=ht({type:t,selectors:[["app-root"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"container-fluid","p-0"],[1,"sidebar-container"],["id","sidebar",1,"d-flex","flex-column","h-100"],[1,"p-3","flex-grow-1"],[1,"mb-3","d-flex","align-items-center","justify-content-between"],[1,"text-decoration-none","me-auto","btn","btn-link","p-0","me-3",3,"click"],["src","/trading_rehab_main_logo.png",1,"img-fluid",2,"height","36px",3,"click"],["type","button",1,"btn-close","d-md-none",3,"click"],["class","nav flex-column",4,"ngIf"],["class","p-3 border-top mt-auto",4,"ngIf"],[1,"content"],[1,"navbar","navbar-expand-lg"],[1,"container-fluid"],[1,"d-flex","align-items-center"],[1,"btn","me-2",3,"click"],[1,"navbar-toggler-icon"],["class","btn navbar-branding text-decoration-none me-auto",3,"click",4,"ngIf"],[1,"container-fluid","ps-3"],[1,"nav","flex-column"],[1,"nav-link",3,"click"],[1,"bi","bi-columns-gap","me-3"],[1,"bi","bi-brightness-high","me-3"],[1,"bi","bi-bookmark-check","me-3"],[1,"bi","bi-person-arms-up","me-3"],[1,"bi","bi-clipboard-data","me-3"],[1,"bi","bi-journals","me-3"],[1,"p-3","border-top","mt-auto"],["routerLink","/useraccount",1,"d-flex","align-items-center","mb-2",2,"cursor","pointer"],[1,"text-black","mb-0"],[1,"btn","btn-outline-secondary","btn-tr","w-100",3,"click"],[1,"bi","bi-box-arrow-right"],["alt","Profile",1,"rounded-circle","me-2",2,"width","40px","height","40px","object-fit","cover",3,"src"],[1,"bi","bi-person-circle","text-black",2,"font-size","30px"],[1,"btn","navbar-branding","text-decoration-none","me-auto",3,"click"],["src","/trading-rehab-logo.png","width","50px",1,"img-fluid"]],template:function(e,r){e&1&&te(0,OCe,3,0,"ng-container",0)(1,zCe,19,7,"ng-container",0),e&2&&(U("ngIf",!r.supabaseService.loginStatus()),O(),U("ngIf",r.supabaseService.loginStatus()))},dependencies:[Pt,Ht,nT,Fn],styles:[".sidebar-container[_ngcontent-%COMP%]{display:flex;width:100%;position:relative}#sidebar[_ngcontent-%COMP%]{width:250px;position:fixed;top:0;left:0;height:100vh;z-index:999;background:#634aff0d;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);transition:all .3s;box-shadow:0 0 10px #0000001a}#sidebar.collapsed[_ngcontent-%COMP%]{margin-left:-250px}.content[_ngcontent-%COMP%]{width:calc(100% - 250px);margin-left:250px;transition:all .3s;min-height:100vh}.content.expanded[_ngcontent-%COMP%]{width:100%;margin-left:0}@media (max-width: 768px){#sidebar[_ngcontent-%COMP%]{margin-left:-250px}#sidebar[_ngcontent-%COMP%]:not(.collapsed){margin-left:0}.content[_ngcontent-%COMP%]{width:100%;margin-left:0}}.nav-link[_ngcontent-%COMP%]{padding:15px 20px;color:#333;border-bottom:1px solid #ddd}.nav-link[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.navbar[_ngcontent-%COMP%]{padding:15px 10px}"]})};hP(DI,r9).catch(t=>console.error(t));
