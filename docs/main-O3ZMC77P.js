import{b as Jk,c as eA,f as f6,g as tA}from"./chunk-EA6DTDFA.js";import{a as he,b as Ze,d as pt,e as Fi,f as Ym,g as p6}from"./chunk-WMVSLYLA.js";var h1=pt(m1=>{"use strict";Object.defineProperty(m1,"__esModule",{value:!0});var f1=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}};m1.default=f1});var y1=pt(Jh=>{"use strict";var EF=Jh&&Jh.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Jh,"__esModule",{value:!0});var See=EF((tA(),p6(f6))),_ee=EF(h1()),g1=class{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=See.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,e){return this.headers=Object.assign({},this.headers),this.headers[n]=e,this}then(n,e){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");let r=this.fetch,o=r(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async i=>{var s,a,l;let c=null,u=null,d=null,p=i.status,f=i.statusText;if(i.ok){if(this.method!=="HEAD"){let y=await i.text();y===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?u=y:u=JSON.parse(y))}let h=(s=this.headers.Prefer)===null||s===void 0?void 0:s.match(/count=(exact|planned|estimated)/),g=(a=i.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");h&&g&&g.length>1&&(d=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(u)&&(u.length>1?(c={code:"PGRST116",details:`Results contain ${u.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},u=null,d=null,p=406,f="Not Acceptable"):u.length===1?u=u[0]:u=null)}else{let h=await i.text();try{c=JSON.parse(h),Array.isArray(c)&&i.status===404&&(u=[],c=null,p=200,f="OK")}catch{i.status===404&&h===""?(p=204,f="No Content"):c={message:h}}if(c&&this.isMaybeSingle&&(!((l=c?.details)===null||l===void 0)&&l.includes("0 rows"))&&(c=null,p=200,f="OK"),c&&this.shouldThrowOnError)throw new _ee.default(c)}return{error:c,data:u,count:d,status:p,statusText:f}});return this.shouldThrowOnError||(o=o.catch(i=>{var s,a,l;return{error:{message:`${(s=i?.name)!==null&&s!==void 0?s:"FetchError"}: ${i?.message}`,details:`${(a=i?.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(l=i?.code)!==null&&l!==void 0?l:""}`},data:null,count:null,status:0,statusText:""}})),o.then(n,e)}};Jh.default=g1});var v1=pt(eg=>{"use strict";var Iee=eg&&eg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(eg,"__esModule",{value:!0});var Eee=Iee(y1()),x1=class extends Eee.default{select(n){let e=!1,r=(n??"*").split("").map(o=>/\s/.test(o)&&!e?"":(o==='"'&&(e=!e),o)).join("");return this.url.searchParams.set("select",r),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(n,{ascending:e=!0,nullsFirst:r,foreignTable:o,referencedTable:i=o}={}){let s=i?`${i}.order`:"order",a=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${a?`${a},`:""}${n}.${e?"asc":"desc"}${r===void 0?"":r?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:e,referencedTable:r=e}={}){let o=typeof r>"u"?"limit":`${r}.limit`;return this.url.searchParams.set(o,`${n}`),this}range(n,e,{foreignTable:r,referencedTable:o=r}={}){let i=typeof o>"u"?"offset":`${o}.offset`,s=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(i,`${n}`),this.url.searchParams.set(s,`${e-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:n=!1,verbose:e=!1,settings:r=!1,buffers:o=!1,wal:i=!1,format:s="text"}={}){var a;let l=[n?"analyze":null,e?"verbose":null,r?"settings":null,o?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`,s==="json"?this:this}rollback(){var n;return((n=this.headers.Prefer)!==null&&n!==void 0?n:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};eg.default=x1});var dv=pt(tg=>{"use strict";var Tee=tg&&tg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(tg,"__esModule",{value:!0});var Dee=Tee(v1()),b1=class extends Dee.default{eq(n,e){return this.url.searchParams.append(n,`eq.${e}`),this}neq(n,e){return this.url.searchParams.append(n,`neq.${e}`),this}gt(n,e){return this.url.searchParams.append(n,`gt.${e}`),this}gte(n,e){return this.url.searchParams.append(n,`gte.${e}`),this}lt(n,e){return this.url.searchParams.append(n,`lt.${e}`),this}lte(n,e){return this.url.searchParams.append(n,`lte.${e}`),this}like(n,e){return this.url.searchParams.append(n,`like.${e}`),this}likeAllOf(n,e){return this.url.searchParams.append(n,`like(all).{${e.join(",")}}`),this}likeAnyOf(n,e){return this.url.searchParams.append(n,`like(any).{${e.join(",")}}`),this}ilike(n,e){return this.url.searchParams.append(n,`ilike.${e}`),this}ilikeAllOf(n,e){return this.url.searchParams.append(n,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(n,e){return this.url.searchParams.append(n,`ilike(any).{${e.join(",")}}`),this}is(n,e){return this.url.searchParams.append(n,`is.${e}`),this}in(n,e){let r=Array.from(new Set(e)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(n,`in.(${r})`),this}contains(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cs.{${e.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(e)}`),this}containedBy(n,e){return typeof e=="string"?this.url.searchParams.append(n,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(n,`cd.{${e.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(e)}`),this}rangeGt(n,e){return this.url.searchParams.append(n,`sr.${e}`),this}rangeGte(n,e){return this.url.searchParams.append(n,`nxl.${e}`),this}rangeLt(n,e){return this.url.searchParams.append(n,`sl.${e}`),this}rangeLte(n,e){return this.url.searchParams.append(n,`nxr.${e}`),this}rangeAdjacent(n,e){return this.url.searchParams.append(n,`adj.${e}`),this}overlaps(n,e){return typeof e=="string"?this.url.searchParams.append(n,`ov.${e}`):this.url.searchParams.append(n,`ov.{${e.join(",")}}`),this}textSearch(n,e,{config:r,type:o}={}){let i="";o==="plain"?i="pl":o==="phrase"?i="ph":o==="websearch"&&(i="w");let s=r===void 0?"":`(${r})`;return this.url.searchParams.append(n,`${i}fts${s}.${e}`),this}match(n){return Object.entries(n).forEach(([e,r])=>{this.url.searchParams.append(e,`eq.${r}`)}),this}not(n,e,r){return this.url.searchParams.append(n,`not.${e}.${r}`),this}or(n,{foreignTable:e,referencedTable:r=e}={}){let o=r?`${r}.or`:"or";return this.url.searchParams.append(o,`(${n})`),this}filter(n,e,r){return this.url.searchParams.append(n,`${e}.${r}`),this}};tg.default=b1});var C1=pt(rg=>{"use strict";var Nee=rg&&rg.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(rg,"__esModule",{value:!0});var ng=Nee(dv()),w1=class{constructor(n,{headers:e={},schema:r,fetch:o}){this.url=n,this.headers=e,this.schema=r,this.fetch=o}select(n,{head:e=!1,count:r}={}){let o=e?"HEAD":"GET",i=!1,s=(n??"*").split("").map(a=>/\s/.test(a)&&!i?"":(a==='"'&&(i=!i),a)).join("");return this.url.searchParams.set("select",s),r&&(this.headers.Prefer=`count=${r}`),new ng.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(n,{count:e,defaultToNull:r=!0}={}){let o="POST",i=[];if(this.headers.Prefer&&i.push(this.headers.Prefer),e&&i.push(`count=${e}`),r||i.push("missing=default"),this.headers.Prefer=i.join(","),Array.isArray(n)){let s=n.reduce((a,l)=>a.concat(Object.keys(l)),[]);if(s.length>0){let a=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",a.join(","))}}return new ng.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}upsert(n,{onConflict:e,ignoreDuplicates:r=!1,count:o,defaultToNull:i=!0}={}){let s="POST",a=[`resolution=${r?"ignore":"merge"}-duplicates`];if(e!==void 0&&this.url.searchParams.set("on_conflict",e),this.headers.Prefer&&a.push(this.headers.Prefer),o&&a.push(`count=${o}`),i||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(n)){let l=n.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){let c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new ng.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}update(n,{count:e}={}){let r="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),e&&o.push(`count=${e}`),this.headers.Prefer=o.join(","),new ng.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:n,fetch:this.fetch,allowEmpty:!1})}delete({count:n}={}){let e="DELETE",r=[];return n&&r.push(`count=${n}`),this.headers.Prefer&&r.unshift(this.headers.Prefer),this.headers.Prefer=r.join(","),new ng.default({method:e,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};rg.default=w1});var TF=pt(pv=>{"use strict";Object.defineProperty(pv,"__esModule",{value:!0});pv.version=void 0;pv.version="0.0.0-automated"});var DF=pt(fv=>{"use strict";Object.defineProperty(fv,"__esModule",{value:!0});fv.DEFAULT_HEADERS=void 0;var kee=TF();fv.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${kee.version}`}});var kF=pt(og=>{"use strict";var NF=og&&og.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(og,"__esModule",{value:!0});var Aee=NF(C1()),Ree=NF(dv()),Oee=DF(),S1=class t{constructor(n,{headers:e={},schema:r,fetch:o}={}){this.url=n,this.headers=Object.assign(Object.assign({},Oee.DEFAULT_HEADERS),e),this.schemaName=r,this.fetch=o}from(n){let e=new URL(`${this.url}/${n}`);return new Aee.default(e,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(n){return new t(this.url,{headers:this.headers,schema:n,fetch:this.fetch})}rpc(n,e={},{head:r=!1,get:o=!1,count:i}={}){let s,a=new URL(`${this.url}/rpc/${n}`),l;r||o?(s=r?"HEAD":"GET",Object.entries(e).filter(([u,d])=>d!==void 0).map(([u,d])=>[u,Array.isArray(d)?`{${d.join(",")}}`:`${d}`]).forEach(([u,d])=>{a.searchParams.append(u,d)})):(s="POST",l=e);let c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new Ree.default({method:s,url:a,headers:c,schema:this.schemaName,body:l,fetch:this.fetch,allowEmpty:!1})}};og.default=S1});var $F=pt(ir=>{"use strict";var zp=ir&&ir.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(ir,"__esModule",{value:!0});ir.PostgrestError=ir.PostgrestBuilder=ir.PostgrestTransformBuilder=ir.PostgrestFilterBuilder=ir.PostgrestQueryBuilder=ir.PostgrestClient=void 0;var AF=zp(kF());ir.PostgrestClient=AF.default;var RF=zp(C1());ir.PostgrestQueryBuilder=RF.default;var OF=zp(dv());ir.PostgrestFilterBuilder=OF.default;var MF=zp(v1());ir.PostgrestTransformBuilder=MF.default;var FF=zp(y1());ir.PostgrestBuilder=FF.default;var PF=zp(h1());ir.PostgrestError=PF.default;ir.default={PostgrestClient:AF.default,PostgrestQueryBuilder:RF.default,PostgrestFilterBuilder:OF.default,PostgrestTransformBuilder:MF.default,PostgrestBuilder:FF.default,PostgrestError:PF.default}});var nL=pt((Zf,tL)=>{"use strict";var fie=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},ud=fie();tL.exports=Zf=ud.fetch;ud.fetch&&(Zf.default=ud.fetch.bind(ud));Zf.Headers=ud.Headers;Zf.Request=ud.Request;Zf.Response=ud.Response});var rL=pt(()=>{"use strict"});var jL=pt((UL,uD)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(UL,typeof uD=="object"&&uD,typeof define=="function"&&define)});var WL=pt((GL,dD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(GL,typeof dD=="object"&&dD,typeof define=="function"&&define)});var qL=pt((HL,pD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(HL,typeof pD=="object"&&pD,typeof define=="function"&&define)});var XL=pt((KL,fD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(KL,typeof fD=="object"&&fD,typeof define=="function"&&define)});var QL=pt((YL,mD)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,m=-32;m<y;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(YL,typeof mD=="object"&&mD,typeof define=="function"&&define)});var JL=pt((ZL,hD)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(ZL,typeof hD=="object"&&hD,typeof define=="function"&&define)});var Wb=pt(()=>{"use strict"});var eV=pt((vUe,Hb)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(S,C,I){var E=[];C=C==!0?{entropy:!0}:C||{};var D=g(h(C.entropy?[S,v(t)]:S??y(),3),E),O=new f(E),R=function(){for(var P=O.g(o),U=a,G=0;P<l;)P=(P+G)*r,U*=r,G=O.g(1);for(;P>=c;)P/=2,U/=2,G>>>=1;return(P+G)/U};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(v(O.S),t),(C.pass||I||function(P,U,G,q){return q&&(q.S&&m(q,O),P.state=function(){return m(O,{})}),G?(n[s]=P,U):P})(R,D,"global"in C?C.global:this==n,C.state)}n["seed"+s]=p;function f(S){var C,I=S.length,E=this,D=0,O=E.i=E.j=0,R=E.S=[];for(I||(S=[I++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+S[D%I]+(C=R[D])],R[O]=C;(E.g=function(P){for(var U,G=0,q=E.i,X=E.j,K=E.S;P--;)U=K[q=u&q+1],G=G*r+K[u&(K[q]=K[X=u&X+U])+(K[X]=U)];return E.i=q,E.j=X,G})(r)}function m(S,C){return C.i=S.i,C.j=S.j,C.S=S.S.slice(),C}function h(S,C){var I=[],E=typeof S,D;if(C&&E=="object")for(D in S)try{I.push(h(S[D],C-1))}catch{}return I.length?I:E=="string"?S:S+"\0"}function g(S,C){for(var I=S+"",E,D=0;D<I.length;)C[u&D]=u&(E^=C[u&D]*19)+I.charCodeAt(D++);return v(C)}function y(){try{var S;return d&&(S=d.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),v(S)}catch{var C=e.navigator,I=C&&C.plugins;return[+new Date,e,I,e.screen,v(t)]}}function v(S){return String.fromCharCode.apply(0,S)}if(g(n.random(),t),typeof Hb=="object"&&Hb.exports){Hb.exports=p;try{d=Wb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var nV=pt((bUe,tV)=>{"use strict";var Gae=jL(),Wae=WL(),Hae=qL(),qae=XL(),Kae=QL(),Xae=JL(),wd=eV();wd.alea=Gae;wd.xor128=Wae;wd.xorwow=Hae;wd.xorshift7=qae;wd.xor4096=Kae;wd.tychei=Xae;tV.exports=wd});var A4=pt((k4,EN)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(k4,typeof EN=="object"&&EN,typeof define=="function"&&define)});var O4=pt((R4,TN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(R4,typeof TN=="object"&&TN,typeof define=="function"&&define)});var F4=pt((M4,DN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(M4,typeof DN=="object"&&DN,typeof define=="function"&&define)});var $4=pt((P4,NN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(P4,typeof NN=="object"&&NN,typeof define=="function"&&define)});var V4=pt((L4,kN)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,m=-32;m<y;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(L4,typeof kN=="object"&&kN,typeof define=="function"&&define)});var z4=pt((B4,AN)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(B4,typeof AN=="object"&&AN,typeof define=="function"&&define)});var U4=pt((gwt,Ww)=>{"use strict";(function(t,n){var e=(0,eval)("this"),r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(S,C,I){var E=[];C=C==!0?{entropy:!0}:C||{};var D=g(h(C.entropy?[S,v(t)]:S??y(),3),E),O=new f(E),R=function(){for(var P=O.g(o),U=a,G=0;P<l;)P=(P+G)*r,U*=r,G=O.g(1);for(;P>=c;)P/=2,U/=2,G>>>=1;return(P+G)/U};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(v(O.S),t),(C.pass||I||function(P,U,G,q){return q&&(q.S&&m(q,O),P.state=function(){return m(O,{})}),G?(n[s]=P,U):P})(R,D,"global"in C?C.global:this==n,C.state)}n["seed"+s]=p;function f(S){var C,I=S.length,E=this,D=0,O=E.i=E.j=0,R=E.S=[];for(I||(S=[I++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+S[D%I]+(C=R[D])],R[O]=C;(E.g=function(P){for(var U,G=0,q=E.i,X=E.j,K=E.S;P--;)U=K[q=u&q+1],G=G*r+K[u&(K[q]=K[X=u&X+U])+(K[X]=U)];return E.i=q,E.j=X,G})(r)}function m(S,C){return C.i=S.i,C.j=S.j,C.S=S.S.slice(),C}function h(S,C){var I=[],E=typeof S,D;if(C&&E=="object")for(D in S)try{I.push(h(S[D],C-1))}catch{}return I.length?I:E=="string"?S:S+"\0"}function g(S,C){for(var I=S+"",E,D=0;D<I.length;)C[u&D]=u&(E^=C[u&D]*19)+I.charCodeAt(D++);return v(C)}function y(){try{var S;return d&&(S=d.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),v(S)}catch{var C=e.navigator,I=C&&C.plugins;return[+new Date,e,I,e.screen,v(t)]}}function v(S){return String.fromCharCode.apply(0,S)}if(g(n.random(),t),typeof Ww=="object"&&Ww.exports){Ww.exports=p;try{d=Wb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var RN=pt((ywt,j4)=>{"use strict";var ppe=A4(),fpe=O4(),mpe=F4(),hpe=$4(),gpe=V4(),ype=z4(),$d=U4();$d.alea=ppe;$d.xor128=fpe;$d.xorwow=mpe;$d.xorshift7=hpe;$d.xor4096=gpe;$d.tychei=ype;j4.exports=$d});var Jj=pt((Zj,pk)=>{"use strict";(function(t,n,e){function r(a){var l=this,c=s();l.next=function(){var u=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=u-(l.c=u|0)},l.c=1,l.s0=c(" "),l.s1=c(" "),l.s2=c(" "),l.s0-=c(a),l.s0<0&&(l.s0+=1),l.s1-=c(a),l.s1<0&&(l.s1+=1),l.s2-=c(a),l.s2<0&&(l.s2+=1),c=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function i(a,l){var c=new r(a),u=l&&l.state,d=c.next;return d.int32=function(){return c.next()*4294967296|0},d.double=function(){return d()+(d()*2097152|0)*11102230246251565e-32},d.quick=d,u&&(typeof u=="object"&&o(u,c),d.state=function(){return o(c,{})}),d}function s(){var a=4022871197,l=function(c){c=c.toString();for(var u=0;u<c.length;u++){a+=c.charCodeAt(u);var d=.02519603282416938*a;a=d>>>0,d-=a,d*=a,a=d>>>0,d-=a,a+=d*4294967296}return(a>>>0)*23283064365386963e-26};return l}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.alea=i})(Zj,typeof pk=="object"&&pk,typeof define=="function"&&define)});var tG=pt((eG,fk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var u=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^u^u>>>8},s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor128=i})(eG,typeof fk=="object"&&fk,typeof define=="function"&&define)});var rG=pt((nG,mk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(u^u<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,s===(s|0)?a.x=s:l+=s;for(var c=0;c<l.length+64;c++)a.x^=l.charCodeAt(c)|0,c==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(s,a){return a.x=s.x,a.y=s.y,a.z=s.z,a.w=s.w,a.v=s.v,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorwow=i})(nG,typeof mk=="object"&&mk,typeof define=="function"&&define)});var iG=pt((oG,hk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.x,u=a.i,d,p,f;return d=c[u],d^=d>>>7,p=d^d<<24,d=c[u+1&7],p^=d^d>>>10,d=c[u+3&7],p^=d^d>>>3,d=c[u+4&7],p^=d^d<<7,d=c[u+7&7],d=d^d<<13,p^=d^d<<9,c[u]=p,a.i=u+1&7,p};function l(c,u){var d,p,f=[];if(u===(u|0))p=f[0]=u;else for(u=""+u,d=0;d<u.length;++d)f[d&7]=f[d&7]<<15^u.charCodeAt(d)+f[d+1&7]<<13;for(;f.length<8;)f.push(0);for(d=0;d<8&&f[d]===0;++d);for(d==8?p=f[7]=-1:p=f[d],c.x=f,c.i=0,d=256;d>0;--d)c.next()}l(a,s)}function o(s,a){return a.x=s.x.slice(),a.i=s.i,a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.x&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xorshift7=i})(oG,typeof hk=="object"&&hk,typeof define=="function"&&define)});var aG=pt((sG,gk)=>{"use strict";(function(t,n,e){function r(s){var a=this;a.next=function(){var c=a.w,u=a.X,d=a.i,p,f;return a.w=c=c+1640531527|0,f=u[d+34&127],p=u[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,f=u[d]=f^p,a.i=d,f+(c^c>>>16)|0};function l(c,u){var d,p,f,m,h,g=[],y=128;for(u===(u|0)?(p=u,u=null):(u=u+"\0",p=0,y=Math.max(y,u.length)),f=0,m=-32;m<y;++m)u&&(p^=u.charCodeAt((m+32)%u.length)),m===0&&(h=p),p^=p<<10,p^=p>>>15,p^=p<<4,p^=p>>>13,m>=0&&(h=h+1640531527|0,d=g[m&127]^=p+h,f=d==0?f+1:0);for(f>=128&&(g[(u&&u.length||0)&127]=-1),f=127,m=4*128;m>0;--m)p=g[f+34&127],d=g[f=f+1&127],p^=p<<13,d^=d<<17,p^=p>>>15,d^=d>>>12,g[f]=p^d;c.w=h,c.X=g,c.i=f}l(a,s)}function o(s,a){return a.i=s.i,a.w=s.w,a.X=s.X.slice(),a}function i(s,a){s==null&&(s=+new Date);var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(c.X&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.xor4096=i})(sG,typeof gk=="object"&&gk,typeof define=="function"&&define)});var cG=pt((lG,yk)=>{"use strict";(function(t,n,e){function r(s){var a=this,l="";a.next=function(){var u=a.b,d=a.c,p=a.d,f=a.a;return u=u<<25^u>>>7^d,d=d-p|0,p=p<<24^p>>>8^f,f=f-u|0,a.b=u=u<<20^u>>>12^d,a.c=d=d-p|0,a.d=p<<16^d>>>16^f,a.a=f-u|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,s===Math.floor(s)?(a.a=s/4294967296|0,a.b=s|0):l+=s;for(var c=0;c<l.length+20;c++)a.b^=l.charCodeAt(c)|0,a.next()}function o(s,a){return a.a=s.a,a.b=s.b,a.c=s.c,a.d=s.d,a}function i(s,a){var l=new r(s),c=a&&a.state,u=function(){return(l.next()>>>0)/4294967296};return u.double=function(){do var d=l.next()>>>11,p=(l.next()>>>0)/4294967296,f=(d+p)/(1<<21);while(f===0);return f},u.int32=l.next,u.quick=u,c&&(typeof c=="object"&&o(c,l),u.state=function(){return o(l,{})}),u}n&&n.exports?n.exports=i:e&&e.amd?e(function(){return i}):this.tychei=i})(lG,typeof yk=="object"&&yk,typeof define=="function"&&define)});var uG=pt((OAt,aC)=>{"use strict";(function(t,n){var e=this,r=256,o=6,i=52,s="random",a=n.pow(r,o),l=n.pow(2,i),c=l*2,u=r-1,d;function p(S,C,I){var E=[];C=C==!0?{entropy:!0}:C||{};var D=g(h(C.entropy?[S,v(t)]:S??y(),3),E),O=new f(E),R=function(){for(var P=O.g(o),U=a,G=0;P<l;)P=(P+G)*r,U*=r,G=O.g(1);for(;P>=c;)P/=2,U/=2,G>>>=1;return(P+G)/U};return R.int32=function(){return O.g(4)|0},R.quick=function(){return O.g(4)/4294967296},R.double=R,g(v(O.S),t),(C.pass||I||function(P,U,G,q){return q&&(q.S&&m(q,O),P.state=function(){return m(O,{})}),G?(n[s]=P,U):P})(R,D,"global"in C?C.global:this==n,C.state)}n["seed"+s]=p;function f(S){var C,I=S.length,E=this,D=0,O=E.i=E.j=0,R=E.S=[];for(I||(S=[I++]);D<r;)R[D]=D++;for(D=0;D<r;D++)R[D]=R[O=u&O+S[D%I]+(C=R[D])],R[O]=C;(E.g=function(P){for(var U,G=0,q=E.i,X=E.j,K=E.S;P--;)U=K[q=u&q+1],G=G*r+K[u&(K[q]=K[X=u&X+U])+(K[X]=U)];return E.i=q,E.j=X,G})(r)}function m(S,C){return C.i=S.i,C.j=S.j,C.S=S.S.slice(),C}function h(S,C){var I=[],E=typeof S,D;if(C&&E=="object")for(D in S)try{I.push(h(S[D],C-1))}catch{}return I.length?I:E=="string"?S:S+"\0"}function g(S,C){for(var I=S+"",E,D=0;D<I.length;)C[u&D]=u&(E^=C[u&D]*19)+I.charCodeAt(D++);return v(C)}function y(){try{var S;return d&&(S=d.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),v(S)}catch{var C=e.navigator,I=C&&C.plugins;return[+new Date,e,I,e.screen,v(t)]}}function v(S){return String.fromCharCode.apply(0,S)}if(g(n.random(),t),typeof aC=="object"&&aC.exports){aC.exports=p;try{d=Wb()}catch{}}else typeof define=="function"&&define.amd&&define(function(){return p})})([],Math)});var pG=pt((MAt,dG)=>{"use strict";var kme=Jj(),Ame=tG(),Rme=rG(),Ome=iG(),Mme=aG(),Fme=cG(),Vd=uG();Vd.alea=kme;Vd.xor128=Ame;Vd.xorwow=Rme;Vd.xorshift7=Ome;Vd.xor4096=Mme;Vd.tychei=Fme;dG.exports=Vd});function rA(t,n){return Object.is(t,n)}var Fn=null,Qm=!1,ZS=1,Fr=Symbol("SIGNAL");function bt(t){let n=Fn;return Fn=t,n}function oA(){return Fn}function m6(){return Qm}var ru={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,kind:"unknown",producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function Wy(t){if(Qm)throw new Error("");if(Fn===null)return;Fn.consumerOnSignalRead(t);let n=Fn.nextProducerIndex++;if(qy(Fn),n<Fn.producerNode.length&&Fn.producerNode[n]!==t&&Zm(Fn)){let e=Fn.producerNode[n];Hy(e,Fn.producerIndexOfThis[n])}Fn.producerNode[n]!==t&&(Fn.producerNode[n]=t,Fn.producerIndexOfThis[n]=Zm(Fn)?cA(t,Fn,n):0),Fn.producerLastReadVersion[n]=t.version}function h6(){ZS++}function iA(t){if(!(Zm(t)&&!t.dirty)&&!(!t.dirty&&t.lastCleanEpoch===ZS)){if(!t.producerMustRecompute(t)&&!eh(t)){nA(t);return}t.producerRecomputeValue(t),nA(t)}}function sA(t){if(t.liveConsumerNode===void 0)return;let n=Qm;Qm=!0;try{for(let e of t.liveConsumerNode)e.dirty||lA(e)}finally{Qm=n}}function aA(){return Fn?.consumerAllowSignalWrites!==!1}function lA(t){t.dirty=!0,sA(t),t.consumerMarkedDirty?.(t)}function nA(t){t.dirty=!1,t.lastCleanEpoch=ZS}function Yd(t){return t&&(t.nextProducerIndex=0),bt(t)}function Jm(t,n){if(bt(n),!(!t||t.producerNode===void 0||t.producerIndexOfThis===void 0||t.producerLastReadVersion===void 0)){if(Zm(t))for(let e=t.nextProducerIndex;e<t.producerNode.length;e++)Hy(t.producerNode[e],t.producerIndexOfThis[e]);for(;t.producerNode.length>t.nextProducerIndex;)t.producerNode.pop(),t.producerLastReadVersion.pop(),t.producerIndexOfThis.pop()}}function eh(t){qy(t);for(let n=0;n<t.producerNode.length;n++){let e=t.producerNode[n],r=t.producerLastReadVersion[n];if(r!==e.version||(iA(e),r!==e.version))return!0}return!1}function Qd(t){if(qy(t),Zm(t))for(let n=0;n<t.producerNode.length;n++)Hy(t.producerNode[n],t.producerIndexOfThis[n]);t.producerNode.length=t.producerLastReadVersion.length=t.producerIndexOfThis.length=0,t.liveConsumerNode&&(t.liveConsumerNode.length=t.liveConsumerIndexOfThis.length=0)}function cA(t,n,e){if(uA(t),t.liveConsumerNode.length===0&&dA(t))for(let r=0;r<t.producerNode.length;r++)t.producerIndexOfThis[r]=cA(t.producerNode[r],t,r);return t.liveConsumerIndexOfThis.push(e),t.liveConsumerNode.push(n)-1}function Hy(t,n){if(uA(t),t.liveConsumerNode.length===1&&dA(t))for(let r=0;r<t.producerNode.length;r++)Hy(t.producerNode[r],t.producerIndexOfThis[r]);let e=t.liveConsumerNode.length-1;if(t.liveConsumerNode[n]=t.liveConsumerNode[e],t.liveConsumerIndexOfThis[n]=t.liveConsumerIndexOfThis[e],t.liveConsumerNode.length--,t.liveConsumerIndexOfThis.length--,n<t.liveConsumerNode.length){let r=t.liveConsumerIndexOfThis[n],o=t.liveConsumerNode[n];qy(o),o.producerIndexOfThis[r]=n}}function Zm(t){return t.consumerIsAlwaysLive||(t?.liveConsumerNode?.length??0)>0}function qy(t){t.producerNode??=[],t.producerIndexOfThis??=[],t.producerLastReadVersion??=[]}function uA(t){t.liveConsumerNode??=[],t.liveConsumerIndexOfThis??=[]}function dA(t){return t.producerNode!==void 0}function pA(t){let n=Object.create(g6);n.computation=t;let e=()=>{if(iA(n),Wy(n),n.value===Gy)throw n.error;return n.value};return e[Fr]=n,e}var XS=Symbol("UNSET"),YS=Symbol("COMPUTING"),Gy=Symbol("ERRORED"),g6=Ze(he({},ru),{value:XS,dirty:!0,error:null,equal:rA,kind:"computed",producerMustRecompute(t){return t.value===XS||t.value===YS},producerRecomputeValue(t){if(t.value===YS)throw new Error("Detected cycle in computations.");let n=t.value;t.value=YS;let e=Yd(t),r,o=!1;try{r=t.computation(),bt(null),o=n!==XS&&n!==Gy&&r!==Gy&&t.equal(n,r)}catch(i){r=Gy,t.error=i}finally{Jm(t,e)}if(o){t.value=n;return}t.value=r,t.version++}});function y6(){throw new Error}var fA=y6;function mA(){fA()}function hA(t){fA=t}var x6=null;function gA(t){let n=Object.create(JS);n.value=t;let e=()=>(Wy(n),n.value);return e[Fr]=n,e}function Ky(t,n){aA()||mA(),t.equal(t.value,n)||(t.value=n,v6(t))}function yA(t,n){aA()||mA(),Ky(t,n(t.value))}var JS=Ze(he({},ru),{equal:rA,value:void 0,kind:"signal"});function v6(t){t.version++,h6(),sA(t),x6?.()}function xA(t,n,e){let r=Object.create(b6);e&&(r.consumerAllowSignalWrites=!0),r.fn=t,r.schedule=n;let o=l=>{r.cleanupFn=l};function i(l){return l.fn===null&&l.schedule===null}function s(l){i(l)||(Qd(l),l.cleanupFn(),l.fn=null,l.schedule=null,l.cleanupFn=QS)}let a=()=>{if(r.fn===null)return;if(m6())throw new Error("Schedulers cannot synchronously execute watches while scheduling.");if(r.dirty=!1,r.hasRun&&!eh(r))return;r.hasRun=!0;let l=Yd(r);try{r.cleanupFn(),r.cleanupFn=QS,r.fn(o)}finally{Jm(r,l)}};return r.ref={notify:()=>lA(r),run:a,cleanup:()=>r.cleanupFn(),destroy:()=>s(r),[Fr]:r},r.ref}var QS=()=>{},b6=Ze(he({},ru),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!1,consumerMarkedDirty:t=>{t.schedule!==null&&t.schedule(t.ref)},hasRun:!1,cleanupFn:QS});function Ye(t){return typeof t=="function"}function Zd(t){let e=t(r=>{Error.call(r),r.stack=new Error().stack});return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var Xy=Zd(t=>function(e){t(this),this.message=e?`${e.length} errors occurred during unsubscription:
${e.map((r,o)=>`${o+1}) ${r.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=e});function th(t,n){if(t){let e=t.indexOf(n);0<=e&&t.splice(e,1)}}var _n=class t{constructor(n){this.initialTeardown=n,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let n;if(!this.closed){this.closed=!0;let{_parentage:e}=this;if(e)if(this._parentage=null,Array.isArray(e))for(let i of e)i.remove(this);else e.remove(this);let{initialTeardown:r}=this;if(Ye(r))try{r()}catch(i){n=i instanceof Xy?i.errors:[i]}let{_finalizers:o}=this;if(o){this._finalizers=null;for(let i of o)try{vA(i)}catch(s){n=n??[],s instanceof Xy?n=[...n,...s.errors]:n.push(s)}}if(n)throw new Xy(n)}}add(n){var e;if(n&&n!==this)if(this.closed)vA(n);else{if(n instanceof t){if(n.closed||n._hasParent(this))return;n._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(n)}}_hasParent(n){let{_parentage:e}=this;return e===n||Array.isArray(e)&&e.includes(n)}_addParent(n){let{_parentage:e}=this;this._parentage=Array.isArray(e)?(e.push(n),e):e?[e,n]:n}_removeParent(n){let{_parentage:e}=this;e===n?this._parentage=null:Array.isArray(e)&&th(e,n)}remove(n){let{_finalizers:e}=this;e&&th(e,n),n instanceof t&&n._removeParent(this)}};_n.EMPTY=(()=>{let t=new _n;return t.closed=!0,t})();var e_=_n.EMPTY;function Yy(t){return t instanceof _n||t&&"closed"in t&&Ye(t.remove)&&Ye(t.add)&&Ye(t.unsubscribe)}function vA(t){Ye(t)?t():t.unsubscribe()}var ai={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var Jd={setTimeout(t,n,...e){let{delegate:r}=Jd;return r?.setTimeout?r.setTimeout(t,n,...e):setTimeout(t,n,...e)},clearTimeout(t){let{delegate:n}=Jd;return(n?.clearTimeout||clearTimeout)(t)},delegate:void 0};function Qy(t){Jd.setTimeout(()=>{let{onUnhandledError:n}=ai;if(n)n(t);else throw t})}function nh(){}var bA=t_("C",void 0,void 0);function wA(t){return t_("E",void 0,t)}function CA(t){return t_("N",t,void 0)}function t_(t,n,e){return{kind:t,value:n,error:e}}var ou=null;function ep(t){if(ai.useDeprecatedSynchronousErrorHandling){let n=!ou;if(n&&(ou={errorThrown:!1,error:null}),t(),n){let{errorThrown:e,error:r}=ou;if(ou=null,e)throw r}}else t()}function SA(t){ai.useDeprecatedSynchronousErrorHandling&&ou&&(ou.errorThrown=!0,ou.error=t)}var iu=class extends _n{constructor(n){super(),this.isStopped=!1,n?(this.destination=n,Yy(n)&&n.add(this)):this.destination=S6}static create(n,e,r){return new tp(n,e,r)}next(n){this.isStopped?r_(CA(n),this):this._next(n)}error(n){this.isStopped?r_(wA(n),this):(this.isStopped=!0,this._error(n))}complete(){this.isStopped?r_(bA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(n){this.destination.next(n)}_error(n){try{this.destination.error(n)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},w6=Function.prototype.bind;function n_(t,n){return w6.call(t,n)}var o_=class{constructor(n){this.partialObserver=n}next(n){let{partialObserver:e}=this;if(e.next)try{e.next(n)}catch(r){Zy(r)}}error(n){let{partialObserver:e}=this;if(e.error)try{e.error(n)}catch(r){Zy(r)}else Zy(n)}complete(){let{partialObserver:n}=this;if(n.complete)try{n.complete()}catch(e){Zy(e)}}},tp=class extends iu{constructor(n,e,r){super();let o;if(Ye(n)||!n)o={next:n??void 0,error:e??void 0,complete:r??void 0};else{let i;this&&ai.useDeprecatedNextContext?(i=Object.create(n),i.unsubscribe=()=>this.unsubscribe(),o={next:n.next&&n_(n.next,i),error:n.error&&n_(n.error,i),complete:n.complete&&n_(n.complete,i)}):o=n}this.destination=new o_(o)}};function Zy(t){ai.useDeprecatedSynchronousErrorHandling?SA(t):Qy(t)}function C6(t){throw t}function r_(t,n){let{onStoppedNotification:e}=ai;e&&Jd.setTimeout(()=>e(t,n))}var S6={closed:!0,next:nh,error:C6,complete:nh};var np=typeof Symbol=="function"&&Symbol.observable||"@@observable";function oo(t){return t}function i_(...t){return s_(t)}function s_(t){return t.length===0?oo:t.length===1?t[0]:function(e){return t.reduce((r,o)=>o(r),e)}}var wt=(()=>{class t{constructor(e){e&&(this._subscribe=e)}lift(e){let r=new t;return r.source=this,r.operator=e,r}subscribe(e,r,o){let i=I6(e)?e:new tp(e,r,o);return ep(()=>{let{operator:s,source:a}=this;i.add(s?s.call(i,a):a?this._subscribe(i):this._trySubscribe(i))}),i}_trySubscribe(e){try{return this._subscribe(e)}catch(r){e.error(r)}}forEach(e,r){return r=_A(r),new r((o,i)=>{let s=new tp({next:a=>{try{e(a)}catch(l){i(l),s.unsubscribe()}},error:i,complete:o});this.subscribe(s)})}_subscribe(e){var r;return(r=this.source)===null||r===void 0?void 0:r.subscribe(e)}[np](){return this}pipe(...e){return s_(e)(this)}toPromise(e){return e=_A(e),new e((r,o)=>{let i;this.subscribe(s=>i=s,s=>o(s),()=>r(i))})}}return t.create=n=>new t(n),t})();function _A(t){var n;return(n=t??ai.Promise)!==null&&n!==void 0?n:Promise}function _6(t){return t&&Ye(t.next)&&Ye(t.error)&&Ye(t.complete)}function I6(t){return t&&t instanceof iu||_6(t)&&Yy(t)}function a_(t){return Ye(t?.lift)}function Ct(t){return n=>{if(a_(n))return n.lift(function(e){try{return t(e,this)}catch(r){this.error(r)}});throw new TypeError("Unable to lift unknown Observable type")}}function ft(t,n,e,r,o){return new l_(t,n,e,r,o)}var l_=class extends iu{constructor(n,e,r,o,i,s){super(n),this.onFinalize=i,this.shouldUnsubscribe=s,this._next=e?function(a){try{e(a)}catch(l){n.error(l)}}:super._next,this._error=o?function(a){try{o(a)}catch(l){n.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=r?function(){try{r()}catch(a){n.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var n;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:e}=this;super.unsubscribe(),!e&&((n=this.onFinalize)===null||n===void 0||n.call(this))}}};function rp(){return Ct((t,n)=>{let e=null;t._refCount++;let r=ft(n,void 0,void 0,void 0,()=>{if(!t||t._refCount<=0||0<--t._refCount){e=null;return}let o=t._connection,i=e;e=null,o&&(!i||o===i)&&o.unsubscribe(),n.unsubscribe()});t.subscribe(r),r.closed||(e=t.connect())})}var op=class extends wt{constructor(n,e){super(),this.source=n,this.subjectFactory=e,this._subject=null,this._refCount=0,this._connection=null,a_(n)&&(this.lift=n.lift)}_subscribe(n){return this.getSubject().subscribe(n)}getSubject(){let n=this._subject;return(!n||n.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:n}=this;this._subject=this._connection=null,n?.unsubscribe()}connect(){let n=this._connection;if(!n){n=this._connection=new _n;let e=this.getSubject();n.add(this.source.subscribe(ft(e,void 0,()=>{this._teardown(),e.complete()},r=>{this._teardown(),e.error(r)},()=>this._teardown()))),n.closed&&(this._connection=null,n=_n.EMPTY)}return n}refCount(){return rp()(this)}};var IA=Zd(t=>function(){t(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Pn=(()=>{class t extends wt{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(e){let r=new Jy(this,this);return r.operator=e,r}_throwIfClosed(){if(this.closed)throw new IA}next(e){ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let r of this.currentObservers)r.next(e)}})}error(e){ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=e;let{observers:r}=this;for(;r.length;)r.shift().error(e)}})}complete(){ep(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:e}=this;for(;e.length;)e.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0}_trySubscribe(e){return this._throwIfClosed(),super._trySubscribe(e)}_subscribe(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)}_innerSubscribe(e){let{hasError:r,isStopped:o,observers:i}=this;return r||o?e_:(this.currentObservers=null,i.push(e),new _n(()=>{this.currentObservers=null,th(i,e)}))}_checkFinalizedStatuses(e){let{hasError:r,thrownError:o,isStopped:i}=this;r?e.error(o):i&&e.complete()}asObservable(){let e=new wt;return e.source=this,e}}return t.create=(n,e)=>new Jy(n,e),t})(),Jy=class extends Pn{constructor(n,e){super(),this.destination=n,this.source=e}next(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.next)===null||r===void 0||r.call(e,n)}error(n){var e,r;(r=(e=this.destination)===null||e===void 0?void 0:e.error)===null||r===void 0||r.call(e,n)}complete(){var n,e;(e=(n=this.destination)===null||n===void 0?void 0:n.complete)===null||e===void 0||e.call(n)}_subscribe(n){var e,r;return(r=(e=this.source)===null||e===void 0?void 0:e.subscribe(n))!==null&&r!==void 0?r:e_}};var tr=class extends Pn{constructor(n){super(),this._value=n}get value(){return this.getValue()}_subscribe(n){let e=super._subscribe(n);return!e.closed&&n.next(this._value),e}getValue(){let{hasError:n,thrownError:e,_value:r}=this;if(n)throw e;return this._throwIfClosed(),r}next(n){super.next(this._value=n)}};var Pr=new wt(t=>t.complete());function EA(t){return t&&Ye(t.schedule)}function TA(t){return t[t.length-1]}function ex(t){return Ye(TA(t))?t.pop():void 0}function dl(t){return EA(TA(t))?t.pop():void 0}function NA(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})}function DA(t){var n=typeof Symbol=="function"&&Symbol.iterator,e=n&&t[n],r=0;if(e)return e.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(n?"Object is not iterable.":"Symbol.iterator is not defined.")}function su(t){return this instanceof su?(this.v=t,this):new su(t)}function kA(t,n,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e.apply(t,n||[]),o,i=[];return o=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",s),o[Symbol.asyncIterator]=function(){return this},o;function s(f){return function(m){return Promise.resolve(m).then(f,d)}}function a(f,m){r[f]&&(o[f]=function(h){return new Promise(function(g,y){i.push([f,h,g,y])>1||l(f,h)})},m&&(o[f]=m(o[f])))}function l(f,m){try{c(r[f](m))}catch(h){p(i[0][3],h)}}function c(f){f.value instanceof su?Promise.resolve(f.value.v).then(u,d):p(i[0][2],f)}function u(f){l("next",f)}function d(f){l("throw",f)}function p(f,m){f(m),i.shift(),i.length&&l(i[0][0],i[0][1])}}function AA(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t[Symbol.asyncIterator],e;return n?n.call(t):(t=typeof DA=="function"?DA(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(i){e[i]=t[i]&&function(s){return new Promise(function(a,l){s=t[i](s),o(a,l,s.done,s.value)})}}function o(i,s,a,l){Promise.resolve(l).then(function(c){i({value:c,done:a})},s)}}var tx=t=>t&&typeof t.length=="number"&&typeof t!="function";function nx(t){return Ye(t?.then)}function rx(t){return Ye(t[np])}function ox(t){return Symbol.asyncIterator&&Ye(t?.[Symbol.asyncIterator])}function ix(t){return new TypeError(`You provided ${t!==null&&typeof t=="object"?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function E6(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var sx=E6();function ax(t){return Ye(t?.[sx])}function lx(t){return kA(this,arguments,function*(){let e=t.getReader();try{for(;;){let{value:r,done:o}=yield su(e.read());if(o)return yield su(void 0);yield yield su(r)}}finally{e.releaseLock()}})}function cx(t){return Ye(t?.getReader)}function In(t){if(t instanceof wt)return t;if(t!=null){if(rx(t))return T6(t);if(tx(t))return D6(t);if(nx(t))return N6(t);if(ox(t))return RA(t);if(ax(t))return k6(t);if(cx(t))return A6(t)}throw ix(t)}function T6(t){return new wt(n=>{let e=t[np]();if(Ye(e.subscribe))return e.subscribe(n);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function D6(t){return new wt(n=>{for(let e=0;e<t.length&&!n.closed;e++)n.next(t[e]);n.complete()})}function N6(t){return new wt(n=>{t.then(e=>{n.closed||(n.next(e),n.complete())},e=>n.error(e)).then(null,Qy)})}function k6(t){return new wt(n=>{for(let e of t)if(n.next(e),n.closed)return;n.complete()})}function RA(t){return new wt(n=>{R6(t,n).catch(e=>n.error(e))})}function A6(t){return RA(lx(t))}function R6(t,n){var e,r,o,i;return NA(this,void 0,void 0,function*(){try{for(e=AA(t);r=yield e.next(),!r.done;){let s=r.value;if(n.next(s),n.closed)return}}catch(s){o={error:s}}finally{try{r&&!r.done&&(i=e.return)&&(yield i.call(e))}finally{if(o)throw o.error}}n.complete()})}function $r(t,n,e,r=0,o=!1){let i=n.schedule(function(){e(),o?t.add(this.schedule(null,r)):this.unsubscribe()},r);if(t.add(i),!o)return i}function ux(t,n=0){return Ct((e,r)=>{e.subscribe(ft(r,o=>$r(r,t,()=>r.next(o),n),()=>$r(r,t,()=>r.complete(),n),o=>$r(r,t,()=>r.error(o),n)))})}function dx(t,n=0){return Ct((e,r)=>{r.add(t.schedule(()=>e.subscribe(r),n))})}function OA(t,n){return In(t).pipe(dx(n),ux(n))}function MA(t,n){return In(t).pipe(dx(n),ux(n))}function FA(t,n){return new wt(e=>{let r=0;return n.schedule(function(){r===t.length?e.complete():(e.next(t[r++]),e.closed||this.schedule())})})}function PA(t,n){return new wt(e=>{let r;return $r(e,n,()=>{r=t[sx](),$r(e,n,()=>{let o,i;try{({value:o,done:i}=r.next())}catch(s){e.error(s);return}i?e.complete():e.next(o)},0,!0)}),()=>Ye(r?.return)&&r.return()})}function px(t,n){if(!t)throw new Error("Iterable cannot be null");return new wt(e=>{$r(e,n,()=>{let r=t[Symbol.asyncIterator]();$r(e,n,()=>{r.next().then(o=>{o.done?e.complete():e.next(o.value)})},0,!0)})})}function $A(t,n){return px(lx(t),n)}function LA(t,n){if(t!=null){if(rx(t))return OA(t,n);if(tx(t))return FA(t,n);if(nx(t))return MA(t,n);if(ox(t))return px(t,n);if(ax(t))return PA(t,n);if(cx(t))return $A(t,n)}throw ix(t)}function fn(t,n){return n?LA(t,n):In(t)}function qe(...t){let n=dl(t);return fn(t,n)}function ip(t,n){let e=Ye(t)?t:()=>t,r=o=>o.error(e());return new wt(n?o=>n.schedule(r,0,o):r)}function c_(t){return!!t&&(t instanceof wt||Ye(t.lift)&&Ye(t.subscribe))}var ys=Zd(t=>function(){t(this),this.name="EmptyError",this.message="no elements in sequence"});function nt(t,n){return Ct((e,r)=>{let o=0;e.subscribe(ft(r,i=>{r.next(t.call(n,i,o++))}))})}var{isArray:O6}=Array;function M6(t,n){return O6(n)?t(...n):t(n)}function fx(t){return nt(n=>M6(t,n))}var{isArray:F6}=Array,{getPrototypeOf:P6,prototype:$6,keys:L6}=Object;function mx(t){if(t.length===1){let n=t[0];if(F6(n))return{args:n,keys:null};if(V6(n)){let e=L6(n);return{args:e.map(r=>n[r]),keys:e}}}return{args:t,keys:null}}function V6(t){return t&&typeof t=="object"&&P6(t)===$6}function hx(t,n){return t.reduce((e,r,o)=>(e[r]=n[o],e),{})}function gx(...t){let n=dl(t),e=ex(t),{args:r,keys:o}=mx(t);if(r.length===0)return fn([],n);let i=new wt(B6(r,n,o?s=>hx(o,s):oo));return e?i.pipe(fx(e)):i}function B6(t,n,e=oo){return r=>{VA(n,()=>{let{length:o}=t,i=new Array(o),s=o,a=o;for(let l=0;l<o;l++)VA(n,()=>{let c=fn(t[l],n),u=!1;c.subscribe(ft(r,d=>{i[l]=d,u||(u=!0,a--),a||r.next(e(i.slice()))},()=>{--s||r.complete()}))},r)},r)}}function VA(t,n,e){t?$r(e,t,n):n()}function BA(t,n,e,r,o,i,s,a){let l=[],c=0,u=0,d=!1,p=()=>{d&&!l.length&&!c&&n.complete()},f=h=>c<r?m(h):l.push(h),m=h=>{i&&n.next(h),c++;let g=!1;In(e(h,u++)).subscribe(ft(n,y=>{o?.(y),i?f(y):n.next(y)},()=>{g=!0},void 0,()=>{if(g)try{for(c--;l.length&&c<r;){let y=l.shift();s?$r(n,s,()=>m(y)):m(y)}p()}catch(y){n.error(y)}}))};return t.subscribe(ft(n,f,()=>{d=!0,p()})),()=>{a?.()}}function $n(t,n,e=1/0){return Ye(n)?$n((r,o)=>nt((i,s)=>n(r,i,o,s))(In(t(r,o))),e):(typeof n=="number"&&(e=n),Ct((r,o)=>BA(r,o,t,e)))}function u_(t=1/0){return $n(oo,t)}function zA(){return u_(1)}function sp(...t){return zA()(fn(t,dl(t)))}function yx(t){return new wt(n=>{In(t()).subscribe(n)})}function d_(...t){let n=ex(t),{args:e,keys:r}=mx(t),o=new wt(i=>{let{length:s}=e;if(!s){i.complete();return}let a=new Array(s),l=s,c=s;for(let u=0;u<s;u++){let d=!1;In(e[u]).subscribe(ft(i,p=>{d||(d=!0,c--),a[u]=p},()=>l--,void 0,()=>{(!l||!d)&&(c||i.next(r?hx(r,a):a),i.complete())}))}});return n?o.pipe(fx(n)):o}function io(t,n){return Ct((e,r)=>{let o=0;e.subscribe(ft(r,i=>t.call(n,i,o++)&&r.next(i)))})}function pl(t){return Ct((n,e)=>{let r=null,o=!1,i;r=n.subscribe(ft(e,void 0,void 0,s=>{i=In(t(s,pl(t)(n))),r?(r.unsubscribe(),r=null,i.subscribe(e)):o=!0})),o&&(r.unsubscribe(),r=null,i.subscribe(e))})}function UA(t,n,e,r,o){return(i,s)=>{let a=e,l=n,c=0;i.subscribe(ft(s,u=>{let d=c++;l=a?t(l,u,d):(a=!0,u),r&&s.next(l)},o&&(()=>{a&&s.next(l),s.complete()})))}}function fl(t,n){return Ye(n)?$n(t,n,1):$n(t,1)}function ml(t){return Ct((n,e)=>{let r=!1;n.subscribe(ft(e,o=>{r=!0,e.next(o)},()=>{r||e.next(t),e.complete()}))})}function xs(t){return t<=0?()=>Pr:Ct((n,e)=>{let r=0;n.subscribe(ft(e,o=>{++r<=t&&(e.next(o),t<=r&&e.complete())}))})}function xx(t=z6){return Ct((n,e)=>{let r=!1;n.subscribe(ft(e,o=>{r=!0,e.next(o)},()=>r?e.complete():e.error(t())))})}function z6(){return new ys}function au(t){return Ct((n,e)=>{try{n.subscribe(e)}finally{e.add(t)}})}function vs(t,n){let e=arguments.length>=2;return r=>r.pipe(t?io((o,i)=>t(o,i,r)):oo,xs(1),e?ml(n):xx(()=>new ys))}function ap(t){return t<=0?()=>Pr:Ct((n,e)=>{let r=[];n.subscribe(ft(e,o=>{r.push(o),t<r.length&&r.shift()},()=>{for(let o of r)e.next(o);e.complete()},void 0,()=>{r=null}))})}function p_(t,n){let e=arguments.length>=2;return r=>r.pipe(t?io((o,i)=>t(o,i,r)):oo,ap(1),e?ml(n):xx(()=>new ys))}function f_(t,n){return Ct(UA(t,n,arguments.length>=2,!0))}function m_(...t){let n=dl(t);return Ct((e,r)=>{(n?sp(t,e,n):sp(t,e)).subscribe(r)})}function so(t,n){return Ct((e,r)=>{let o=null,i=0,s=!1,a=()=>s&&!o&&r.complete();e.subscribe(ft(r,l=>{o?.unsubscribe();let c=0,u=i++;In(t(l,u)).subscribe(o=ft(r,d=>r.next(n?n(l,d,u,c++):d),()=>{o=null,a()}))},()=>{s=!0,a()}))})}function h_(t){return Ct((n,e)=>{In(t).subscribe(ft(e,()=>e.complete(),nh)),!e.closed&&n.subscribe(e)})}function Gn(t,n,e){let r=Ye(t)||n||e?{next:t,error:n,complete:e}:t;return r?Ct((o,i)=>{var s;(s=r.subscribe)===null||s===void 0||s.call(r);let a=!0;o.subscribe(ft(i,l=>{var c;(c=r.next)===null||c===void 0||c.call(r,l),i.next(l)},()=>{var l;a=!1,(l=r.complete)===null||l===void 0||l.call(r),i.complete()},l=>{var c;a=!1,(c=r.error)===null||c===void 0||c.call(r,l),i.error(l)},()=>{var l,c;a&&((l=r.unsubscribe)===null||l===void 0||l.call(r)),(c=r.finalize)===null||c===void 0||c.call(r)}))}):oo}var ER="https://g.co/ng/security#xss",De=class extends Error{code;constructor(n,e){super(o0(n,e)),this.code=n}};function o0(t,n){return`${`NG0${Math.abs(t)}`}${n?": "+n:""}`}var TR=Symbol("InputSignalNode#UNSET"),U6=Ze(he({},JS),{transformFn:void 0,applyValueToInputSignal(t,n){Ky(t,n)}});function DR(t,n){let e=Object.create(U6);e.value=t,e.transformFn=n?.transform;function r(){if(Wy(e),e.value===TR)throw new De(-950,!1);return e.value}return r[Fr]=e,r}function hh(t){return{toString:t}.toString()}var vx="__parameters__";function j6(t){return function(...e){if(t){let r=t(...e);for(let o in r)this[o]=r[o]}}}function NR(t,n,e){return hh(()=>{let r=j6(n);function o(...i){if(this instanceof o)return r.apply(this,i),this;let s=new o(...i);return a.annotation=s,a;function a(l,c,u){let d=l.hasOwnProperty(vx)?l[vx]:Object.defineProperty(l,vx,{value:[]})[vx];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(s),l}}return e&&(o.prototype=Object.create(e.prototype)),o.prototype.ngMetadataName=t,o.annotationCls=o,o})}var cu=globalThis;function Xt(t){for(let n in t)if(t[n]===Xt)return n;throw Error("Could not find renamed property on target object.")}function G6(t,n){for(let e in n)n.hasOwnProperty(e)&&!t.hasOwnProperty(e)&&(t[e]=n[e])}function Sr(t){if(typeof t=="string")return t;if(Array.isArray(t))return"["+t.map(Sr).join(", ")+"]";if(t==null)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;let n=t.toString();if(n==null)return""+n;let e=n.indexOf(`
`);return e===-1?n:n.substring(0,e)}function D_(t,n){return t==null||t===""?n===null?"":n:n==null||n===""?t:t+" "+n}var W6=Xt({__forward_ref__:Xt});function nr(t){return t.__forward_ref__=nr,t.toString=function(){return Sr(this())},t}function Cr(t){return kR(t)?t():t}function kR(t){return typeof t=="function"&&t.hasOwnProperty(W6)&&t.__forward_ref__===nr}function Re(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function Ts(t){return{providers:t.providers||[],imports:t.imports||[]}}function i0(t){return jA(t,RR)||jA(t,OR)}function AR(t){return i0(t)!==null}function jA(t,n){return t.hasOwnProperty(n)?t[n]:null}function H6(t){let n=t&&(t[RR]||t[OR]);return n||null}function GA(t){return t&&(t.hasOwnProperty(WA)||t.hasOwnProperty(q6))?t[WA]:null}var RR=Xt({\u0275prov:Xt}),WA=Xt({\u0275inj:Xt}),OR=Xt({ngInjectableDef:Xt}),q6=Xt({ngInjectorDef:Xt}),Me=class{_desc;ngMetadataName="InjectionToken";\u0275prov;constructor(n,e){this._desc=n,this.\u0275prov=void 0,typeof e=="number"?this.__NG_ELEMENT_ID__=e:e!==void 0&&(this.\u0275prov=Re({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};function MR(t){return t&&!!t.\u0275providers}var K6=Xt({\u0275cmp:Xt}),X6=Xt({\u0275dir:Xt}),Y6=Xt({\u0275pipe:Xt}),Q6=Xt({\u0275mod:Xt}),Nx=Xt({\u0275fac:Xt}),sh=Xt({__NG_ELEMENT_ID__:Xt}),HA=Xt({__NG_ENV_ID__:Xt});function bs(t){return typeof t=="string"?t:t==null?"":String(t)}function Z6(t){return typeof t=="function"?t.name||t.toString():typeof t=="object"&&t!=null&&typeof t.type=="function"?t.type.name||t.type.toString():bs(t)}function J6(t,n){let e=n?`. Dependency path: ${n.join(" > ")} > ${t}`:"";throw new De(-200,t)}function hI(t,n){throw new De(-201,!1)}var st=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}(st||{}),N_;function FR(){return N_}function Lr(t){let n=N_;return N_=t,n}function PR(t,n,e){let r=i0(t);if(r&&r.providedIn=="root")return r.value===void 0?r.value=r.factory():r.value;if(e&st.Optional)return null;if(n!==void 0)return n;hI(t,"Injector")}var eK={},ah=eK,k_="__NG_DI_FLAG__",kx="ngTempTokenPath",tK="ngTokenPath",nK=/\n/gm,rK="\u0275",qA="__source",dp;function oK(){return dp}function hl(t){let n=dp;return dp=t,n}function iK(t,n=st.Default){if(dp===void 0)throw new De(-203,!1);return dp===null?PR(t,void 0,n):dp.get(t,n&st.Optional?null:void 0,n)}function $e(t,n=st.Default){return(FR()||iK)(Cr(t),n)}function de(t,n=st.Default){return $e(t,s0(n))}function s0(t){return typeof t>"u"||typeof t=="number"?t:0|(t.optional&&8)|(t.host&&1)|(t.self&&2)|(t.skipSelf&&4)}function A_(t){let n=[];for(let e=0;e<t.length;e++){let r=Cr(t[e]);if(Array.isArray(r)){if(r.length===0)throw new De(900,!1);let o,i=st.Default;for(let s=0;s<r.length;s++){let a=r[s],l=sK(a);typeof l=="number"?l===-1?o=a.token:i|=l:o=a}n.push($e(o,i))}else n.push($e(r))}return n}function $R(t,n){return t[k_]=n,t.prototype[k_]=n,t}function sK(t){return t[k_]}function aK(t,n,e,r){let o=t[kx];throw n[qA]&&o.unshift(n[qA]),t.message=lK(`
`+t.message,o,e,r),t[tK]=o,t[kx]=null,t}function lK(t,n,e,r=null){t=t&&t.charAt(0)===`
`&&t.charAt(1)==rK?t.slice(2):t;let o=Sr(n);if(Array.isArray(n))o=n.map(Sr).join(" -> ");else if(typeof n=="object"){let i=[];for(let s in n)if(n.hasOwnProperty(s)){let a=n[s];i.push(s+":"+(typeof a=="string"?JSON.stringify(a):Sr(a)))}o=`{${i.join(", ")}}`}return`${e}${r?"("+r+")":""}[${o}]: ${t.replace(nK,`
  `)}`}var LR=$R(NR("Optional"),8);var cK=$R(NR("SkipSelf"),4);function du(t,n){let e=t.hasOwnProperty(Nx);return e?t[Nx]:null}function gI(t,n){t.forEach(e=>Array.isArray(e)?gI(e,n):n(e))}function VR(t,n,e){n>=t.length?t.push(e):t.splice(n,0,e)}function Ax(t,n){return n>=t.length-1?t.pop():t.splice(n,1)[0]}function uK(t,n,e,r){let o=t.length;if(o==n)t.push(e,r);else if(o===1)t.push(r,t[0]),t[0]=e;else{for(o--,t.push(t[o-1],t[o]);o>n;){let i=o-2;t[o]=t[i],o--}t[n]=e,t[n+1]=r}}function yI(t,n,e){let r=gh(t,n);return r>=0?t[r|1]=e:(r=~r,uK(t,r,n,e)),r}function g_(t,n){let e=gh(t,n);if(e>=0)return t[e|1]}function gh(t,n){return dK(t,n,1)}function dK(t,n,e){let r=0,o=t.length>>e;for(;o!==r;){let i=r+(o-r>>1),s=t[i<<e];if(n===s)return i<<e;s>n?o=i:r=i+1}return~(o<<e)}var fp={},Vr=[],mp=new Me(""),BR=new Me("",-1),zR=new Me(""),Rx=class{get(n,e=ah){if(e===ah){let r=new Error(`NullInjectorError: No provider for ${Sr(n)}!`);throw r.name="NullInjectorError",r}return e}};function UR(t,n){let e=t[Q6]||null;if(!e&&n===!0)throw new Error(`Type ${Sr(t)} does not have '\u0275mod' property.`);return e}function pu(t){return t[K6]||null}function jR(t){return t[X6]||null}function GR(t){return t[Y6]||null}function WR(t){let n=pu(t)||jR(t)||GR(t);return n!==null&&n.standalone}function Sp(t){return{\u0275providers:t}}function pK(...t){return{\u0275providers:HR(!0,t),\u0275fromNgModule:!0}}function HR(t,...n){let e=[],r=new Set,o,i=s=>{e.push(s)};return gI(n,s=>{let a=s;R_(a,i,[],r)&&(o||=[],o.push(a))}),o!==void 0&&qR(o,i),e}function qR(t,n){for(let e=0;e<t.length;e++){let{ngModule:r,providers:o}=t[e];xI(o,i=>{n(i,r)})}}function R_(t,n,e,r){if(t=Cr(t),!t)return!1;let o=null,i=GA(t),s=!i&&pu(t);if(!i&&!s){let l=t.ngModule;if(i=GA(l),i)o=l;else return!1}else{if(s&&!s.standalone)return!1;o=t}let a=r.has(o);if(s){if(a)return!1;if(r.add(o),s.dependencies){let l=typeof s.dependencies=="function"?s.dependencies():s.dependencies;for(let c of l)R_(c,n,e,r)}}else if(i){if(i.imports!=null&&!a){r.add(o);let c;try{gI(i.imports,u=>{R_(u,n,e,r)&&(c||=[],c.push(u))})}finally{}c!==void 0&&qR(c,n)}if(!a){let c=du(o)||(()=>new o);n({provide:o,useFactory:c,deps:Vr},o),n({provide:zR,useValue:o,multi:!0},o),n({provide:mp,useValue:()=>$e(o),multi:!0},o)}let l=i.providers;if(l!=null&&!a){let c=t;xI(l,u=>{n(u,c)})}}else return!1;return o!==t&&t.providers!==void 0}function xI(t,n){for(let e of t)MR(e)&&(e=e.\u0275providers),Array.isArray(e)?xI(e,n):n(e)}var fK=Xt({provide:String,useValue:Xt});function KR(t){return t!==null&&typeof t=="object"&&fK in t}function mK(t){return!!(t&&t.useExisting)}function hK(t){return!!(t&&t.useFactory)}function hp(t){return typeof t=="function"}function gK(t){return!!t.useClass}var a0=new Me(""),Sx={},yK={},y_;function vI(){return y_===void 0&&(y_=new Rx),y_}var Br=class{},lh=class extends Br{parent;source;scopes;records=new Map;_ngOnDestroyHooks=new Set;_onDestroyHooks=[];get destroyed(){return this._destroyed}_destroyed=!1;injectorDefTypes;constructor(n,e,r,o){super(),this.parent=e,this.source=r,this.scopes=o,M_(n,s=>this.processProvider(s)),this.records.set(BR,lp(void 0,this)),o.has("environment")&&this.records.set(Br,lp(void 0,this));let i=this.records.get(a0);i!=null&&typeof i.value=="string"&&this.scopes.add(i.value),this.injectorDefTypes=new Set(this.get(zR,Vr,st.Self))}destroy(){oh(this),this._destroyed=!0;let n=bt(null);try{for(let r of this._ngOnDestroyHooks)r.ngOnDestroy();let e=this._onDestroyHooks;this._onDestroyHooks=[];for(let r of e)r()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),bt(n)}}onDestroy(n){return oh(this),this._onDestroyHooks.push(n),()=>this.removeOnDestroy(n)}runInContext(n){oh(this);let e=hl(this),r=Lr(void 0),o;try{return n()}finally{hl(e),Lr(r)}}get(n,e=ah,r=st.Default){if(oh(this),n.hasOwnProperty(HA))return n[HA](this);r=s0(r);let o,i=hl(this),s=Lr(void 0);try{if(!(r&st.SkipSelf)){let l=this.records.get(n);if(l===void 0){let c=CK(n)&&i0(n);c&&this.injectableDefInScope(c)?l=lp(O_(n),Sx):l=null,this.records.set(n,l)}if(l!=null)return this.hydrate(n,l)}let a=r&st.Self?vI():this.parent;return e=r&st.Optional&&e===ah?null:e,a.get(n,e)}catch(a){if(a.name==="NullInjectorError"){if((a[kx]=a[kx]||[]).unshift(Sr(n)),i)throw a;return aK(a,n,"R3InjectorError",this.source)}else throw a}finally{Lr(s),hl(i)}}resolveInjectorInitializers(){let n=bt(null),e=hl(this),r=Lr(void 0),o;try{let i=this.get(mp,Vr,st.Self);for(let s of i)s()}finally{hl(e),Lr(r),bt(n)}}toString(){let n=[],e=this.records;for(let r of e.keys())n.push(Sr(r));return`R3Injector[${n.join(", ")}]`}processProvider(n){n=Cr(n);let e=hp(n)?n:Cr(n&&n.provide),r=vK(n);if(!hp(n)&&n.multi===!0){let o=this.records.get(e);o||(o=lp(void 0,Sx,!0),o.factory=()=>A_(o.multi),this.records.set(e,o)),e=n,o.multi.push(n)}this.records.set(e,r)}hydrate(n,e){let r=bt(null);try{return e.value===Sx&&(e.value=yK,e.value=e.factory()),typeof e.value=="object"&&e.value&&wK(e.value)&&this._ngOnDestroyHooks.add(e.value),e.value}finally{bt(r)}}injectableDefInScope(n){if(!n.providedIn)return!1;let e=Cr(n.providedIn);return typeof e=="string"?e==="any"||this.scopes.has(e):this.injectorDefTypes.has(e)}removeOnDestroy(n){let e=this._onDestroyHooks.indexOf(n);e!==-1&&this._onDestroyHooks.splice(e,1)}};function O_(t){let n=i0(t),e=n!==null?n.factory:du(t);if(e!==null)return e;if(t instanceof Me)throw new De(204,!1);if(t instanceof Function)return xK(t);throw new De(204,!1)}function xK(t){if(t.length>0)throw new De(204,!1);let e=H6(t);return e!==null?()=>e.factory(t):()=>new t}function vK(t){if(KR(t))return lp(void 0,t.useValue);{let n=XR(t);return lp(n,Sx)}}function XR(t,n,e){let r;if(hp(t)){let o=Cr(t);return du(o)||O_(o)}else if(KR(t))r=()=>Cr(t.useValue);else if(hK(t))r=()=>t.useFactory(...A_(t.deps||[]));else if(mK(t))r=()=>$e(Cr(t.useExisting));else{let o=Cr(t&&(t.useClass||t.provide));if(bK(t))r=()=>new o(...A_(t.deps));else return du(o)||O_(o)}return r}function oh(t){if(t.destroyed)throw new De(205,!1)}function lp(t,n,e=!1){return{factory:t,value:n,multi:e?[]:void 0}}function bK(t){return!!t.deps}function wK(t){return t!==null&&typeof t=="object"&&typeof t.ngOnDestroy=="function"}function CK(t){return typeof t=="function"||typeof t=="object"&&t instanceof Me}function M_(t,n){for(let e of t)Array.isArray(e)?M_(e,n):e&&MR(e)?M_(e.\u0275providers,n):n(e)}function rr(t,n){t instanceof lh&&oh(t);let e,r=hl(t),o=Lr(void 0);try{return n()}finally{hl(r),Lr(o)}}function YR(){return FR()!==void 0||oK()!=null}function QR(t){if(!YR())throw new De(-203,!1)}function SK(t){return typeof t=="function"}var Ds=0,St=1,Ke=2,_r=3,ui=4,di=5,Ox=6,Mx=7,No=8,ch=9,ws=10,gn=11,uh=12,KA=13,_p=14,$i=15,gp=16,cp=17,yp=18,l0=19,ZR=20,gl=21,_x=22,fu=23,ao=24,ko=25,JR=1;var mu=7,Fx=8,Px=9,Do=10;function yl(t){return Array.isArray(t)&&typeof t[JR]=="object"}function Ns(t){return Array.isArray(t)&&t[JR]===!0}function bI(t){return(t.flags&4)!==0}function wu(t){return t.componentOffset>-1}function c0(t){return(t.flags&1)===1}function Cs(t){return!!t.template}function $x(t){return(t[Ke]&512)!==0}function yh(t){return(t[Ke]&256)===256}var F_=class{previousValue;currentValue;firstChange;constructor(n,e,r){this.previousValue=n,this.currentValue=e,this.firstChange=r}isFirstChange(){return this.firstChange}};function e2(t,n,e,r){n!==null?n.applyValueToInputSignal(n,r):t[e]=r}var pi=(()=>{let t=()=>t2;return t.ngInherit=!0,t})();function t2(t){return t.type.prototype.ngOnChanges&&(t.setInput=IK),_K}function _K(){let t=r2(this),n=t?.current;if(n){let e=t.previous;if(e===fp)t.previous=n;else for(let r in n)e[r]=n[r];t.current=null,this.ngOnChanges(n)}}function IK(t,n,e,r,o){let i=this.declaredInputs[r],s=r2(t)||EK(t,{previous:fp,current:null}),a=s.current||(s.current={}),l=s.previous,c=l[i];a[i]=new F_(c&&c.currentValue,e,l===fp),e2(t,n,o,e)}var n2="__ngSimpleChanges__";function r2(t){return t[n2]||null}function EK(t,n){return t[n2]=n}var XA=null;var To=function(t,n,e){XA?.(t,n,e)},TK="svg",DK="math";function Li(t){for(;Array.isArray(t);)t=t[Ds];return t}function o2(t,n){return Li(n[t])}function fi(t,n){return Li(n[t.index])}function i2(t,n){return t.data[n]}function NK(t,n){return t[n]}function Vi(t,n){let e=n[t];return yl(e)?e:e[Ds]}function wI(t){return(t[Ke]&128)===128}function kK(t){return Ns(t[_r])}function xp(t,n){return n==null?null:t[n]}function s2(t){t[cp]=0}function CI(t){t[Ke]&1024||(t[Ke]|=1024,wI(t)&&xh(t))}function AK(t,n){for(;t>0;)n=n[_p],t--;return n}function u0(t){return!!(t[Ke]&9216||t[ao]?.dirty)}function P_(t){t[ws].changeDetectionScheduler?.notify(9),t[Ke]&64&&(t[Ke]|=1024),u0(t)&&xh(t)}function xh(t){t[ws].changeDetectionScheduler?.notify(0);let n=hu(t);for(;n!==null&&!(n[Ke]&8192||(n[Ke]|=8192,!wI(n)));)n=hu(n)}function a2(t,n){if(yh(t))throw new De(911,!1);t[gl]===null&&(t[gl]=[]),t[gl].push(n)}function RK(t,n){if(t[gl]===null)return;let e=t[gl].indexOf(n);e!==-1&&t[gl].splice(e,1)}function hu(t){let n=t[_r];return Ns(n)?n[_r]:n}function OK(t){return t[Mx]??=[]}function MK(t){return t.cleanup??=[]}var lt={lFrame:g2(null),bindingsEnabled:!0,skipHydrationRootTNode:null};var $_=!1;function FK(){return lt.lFrame.elementDepthCount}function PK(){lt.lFrame.elementDepthCount++}function $K(){lt.lFrame.elementDepthCount--}function l2(){return lt.bindingsEnabled}function LK(){return lt.skipHydrationRootTNode!==null}function VK(t){return lt.skipHydrationRootTNode===t}function BK(){lt.skipHydrationRootTNode=null}function _t(){return lt.lFrame.lView}function Hn(){return lt.lFrame.tView}function Ce(t){return lt.lFrame.contextLView=t,t[No]}function Se(t){return lt.lFrame.contextLView=null,t}function Ir(){let t=c2();for(;t!==null&&t.type===64;)t=t.parent;return t}function c2(){return lt.lFrame.currentTNode}function zK(){let t=lt.lFrame,n=t.currentTNode;return t.isParent?n:n.parent}function Cu(t,n){let e=lt.lFrame;e.currentTNode=t,e.isParent=n}function SI(){return lt.lFrame.isParent}function u2(){lt.lFrame.isParent=!1}function d2(){return $_}function Lx(t){let n=$_;return $_=t,n}function _I(){let t=lt.lFrame,n=t.bindingRootIndex;return n===-1&&(n=t.bindingRootIndex=t.tView.bindingStartIndex),n}function p2(){return lt.lFrame.bindingIndex}function UK(t){return lt.lFrame.bindingIndex=t}function d0(){return lt.lFrame.bindingIndex++}function p0(t){let n=lt.lFrame,e=n.bindingIndex;return n.bindingIndex=n.bindingIndex+t,e}function jK(){return lt.lFrame.inI18n}function GK(t,n){let e=lt.lFrame;e.bindingIndex=e.bindingRootIndex=t,L_(n)}function WK(){return lt.lFrame.currentDirectiveIndex}function L_(t){lt.lFrame.currentDirectiveIndex=t}function HK(t){let n=lt.lFrame.currentDirectiveIndex;return n===-1?null:t[n]}function f2(t){lt.lFrame.currentQueryIndex=t}function qK(t){let n=t[St];return n.type===2?n.declTNode:n.type===1?t[di]:null}function m2(t,n,e){if(e&st.SkipSelf){let o=n,i=t;for(;o=o.parent,o===null&&!(e&st.Host);)if(o=qK(i),o===null||(i=i[_p],o.type&10))break;if(o===null)return!1;n=o,t=i}let r=lt.lFrame=h2();return r.currentTNode=n,r.lView=t,!0}function II(t){let n=h2(),e=t[St];lt.lFrame=n,n.currentTNode=e.firstChild,n.lView=t,n.tView=e,n.contextLView=t,n.bindingIndex=e.bindingStartIndex,n.inI18n=!1}function h2(){let t=lt.lFrame,n=t===null?null:t.child;return n===null?g2(t):n}function g2(t){let n={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return t!==null&&(t.child=n),n}function y2(){let t=lt.lFrame;return lt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}var x2=y2;function EI(){let t=y2();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function KK(t){return(lt.lFrame.contextLView=AK(t,lt.lFrame.contextLView))[No]}function ks(){return lt.lFrame.selectedIndex}function gu(t){lt.lFrame.selectedIndex=t}function f0(){let t=lt.lFrame;return i2(t.tView,t.selectedIndex)}function XK(){return lt.lFrame.currentNamespace}var v2=!0;function m0(){return v2}function h0(t){v2=t}function YK(t,n,e){let{ngOnChanges:r,ngOnInit:o,ngDoCheck:i}=n.type.prototype;if(r){let s=t2(n);(e.preOrderHooks??=[]).push(t,s),(e.preOrderCheckHooks??=[]).push(t,s)}o&&(e.preOrderHooks??=[]).push(0-t,o),i&&((e.preOrderHooks??=[]).push(t,i),(e.preOrderCheckHooks??=[]).push(t,i))}function g0(t,n){for(let e=n.directiveStart,r=n.directiveEnd;e<r;e++){let i=t.data[e].type.prototype,{ngAfterContentInit:s,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=i;s&&(t.contentHooks??=[]).push(-e,s),a&&((t.contentHooks??=[]).push(e,a),(t.contentCheckHooks??=[]).push(e,a)),l&&(t.viewHooks??=[]).push(-e,l),c&&((t.viewHooks??=[]).push(e,c),(t.viewCheckHooks??=[]).push(e,c)),u!=null&&(t.destroyHooks??=[]).push(e,u)}}function Ix(t,n,e){b2(t,n,3,e)}function Ex(t,n,e,r){(t[Ke]&3)===e&&b2(t,n,e,r)}function x_(t,n){let e=t[Ke];(e&3)===n&&(e&=16383,e+=1,t[Ke]=e)}function b2(t,n,e,r){let o=r!==void 0?t[cp]&65535:0,i=r??-1,s=n.length-1,a=0;for(let l=o;l<s;l++)if(typeof n[l+1]=="number"){if(a=n[l],r!=null&&a>=r)break}else n[l]<0&&(t[cp]+=65536),(a<i||i==-1)&&(QK(t,e,n,l),t[cp]=(t[cp]&4294901760)+l+2),l++}function YA(t,n){To(4,t,n);let e=bt(null);try{n.call(t)}finally{bt(e),To(5,t,n)}}function QK(t,n,e,r){let o=e[r]<0,i=e[r+1],s=o?-e[r]:e[r],a=t[s];o?t[Ke]>>14<t[cp]>>16&&(t[Ke]&3)===n&&(t[Ke]+=16384,YA(a,i)):YA(a,i)}var pp=-1,yu=class{factory;injectImpl;resolving=!1;canSeeViewProviders;multi;componentProviders;index;providerFactory;constructor(n,e,r){this.factory=n,this.canSeeViewProviders=e,this.injectImpl=r}};function ZK(t){return t instanceof yu}function JK(t){return(t.flags&8)!==0}function e9(t){return(t.flags&16)!==0}function t9(t,n,e){let r=0;for(;r<e.length;){let o=e[r];if(typeof o=="number"){if(o!==0)break;r++;let i=e[r++],s=e[r++],a=e[r++];t.setAttribute(n,s,a,i)}else{let i=o,s=e[++r];n9(i)?t.setProperty(n,i,s):t.setAttribute(n,i,s),r++}}return r}function w2(t){return t===3||t===4||t===6}function n9(t){return t.charCodeAt(0)===64}function vp(t,n){if(!(n===null||n.length===0))if(t===null||t.length===0)t=n.slice();else{let e=-1;for(let r=0;r<n.length;r++){let o=n[r];typeof o=="number"?e=o:e===0||(e===-1||e===2?QA(t,e,o,null,n[++r]):QA(t,e,o,null,null))}}return t}function QA(t,n,e,r,o){let i=0,s=t.length;if(n===-1)s=-1;else for(;i<t.length;){let a=t[i++];if(typeof a=="number"){if(a===n){s=-1;break}else if(a>n){s=i-1;break}}}for(;i<t.length;){let a=t[i];if(typeof a=="number")break;if(a===e){if(r===null){o!==null&&(t[i+1]=o);return}else if(r===t[i+1]){t[i+2]=o;return}}i++,r!==null&&i++,o!==null&&i++}s!==-1&&(t.splice(s,0,n),i=s+1),t.splice(i++,0,e),r!==null&&t.splice(i++,0,r),o!==null&&t.splice(i++,0,o)}var v_={},V_=class{injector;parentInjector;constructor(n,e){this.injector=n,this.parentInjector=e}get(n,e,r){r=s0(r);let o=this.injector.get(n,v_,r);return o!==v_||e===v_?o:this.parentInjector.get(n,e,r)}};function C2(t){return t!==pp}function Vx(t){return t&32767}function r9(t){return t>>16}function Bx(t,n){let e=r9(t),r=n;for(;e>0;)r=r[_p],e--;return r}var B_=!0;function zx(t){let n=B_;return B_=t,n}var o9=256,S2=o9-1,_2=5,i9=0,Pi={};function s9(t,n,e){let r;typeof e=="string"?r=e.charCodeAt(0)||0:e.hasOwnProperty(sh)&&(r=e[sh]),r==null&&(r=e[sh]=i9++);let o=r&S2,i=1<<o;n.data[t+(o>>_2)]|=i}function Ux(t,n){let e=I2(t,n);if(e!==-1)return e;let r=n[St];r.firstCreatePass&&(t.injectorIndex=n.length,b_(r.data,t),b_(n,null),b_(r.blueprint,null));let o=TI(t,n),i=t.injectorIndex;if(C2(o)){let s=Vx(o),a=Bx(o,n),l=a[St].data;for(let c=0;c<8;c++)n[i+c]=a[s+c]|l[s+c]}return n[i+8]=o,i}function b_(t,n){t.push(0,0,0,0,0,0,0,0,n)}function I2(t,n){return t.injectorIndex===-1||t.parent&&t.parent.injectorIndex===t.injectorIndex||n[t.injectorIndex+8]===null?-1:t.injectorIndex}function TI(t,n){if(t.parent&&t.parent.injectorIndex!==-1)return t.parent.injectorIndex;let e=0,r=null,o=n;for(;o!==null;){if(r=k2(o),r===null)return pp;if(e++,o=o[_p],r.injectorIndex!==-1)return r.injectorIndex|e<<16}return pp}function z_(t,n,e){s9(t,n,e)}function a9(t,n){if(n==="class")return t.classes;if(n==="style")return t.styles;let e=t.attrs;if(e){let r=e.length,o=0;for(;o<r;){let i=e[o];if(w2(i))break;if(i===0)o=o+2;else if(typeof i=="number")for(o++;o<r&&typeof e[o]=="string";)o++;else{if(i===n)return e[o+1];o=o+2}}}return null}function E2(t,n,e){if(e&st.Optional||t!==void 0)return t;hI(n,"NodeInjector")}function T2(t,n,e,r){if(e&st.Optional&&r===void 0&&(r=null),!(e&(st.Self|st.Host))){let o=t[ch],i=Lr(void 0);try{return o?o.get(n,r,e&st.Optional):PR(n,r,e&st.Optional)}finally{Lr(i)}}return E2(r,n,e)}function D2(t,n,e,r=st.Default,o){if(t!==null){if(n[Ke]&2048&&!(r&st.Self)){let s=p9(t,n,e,r,Pi);if(s!==Pi)return s}let i=N2(t,n,e,r,Pi);if(i!==Pi)return i}return T2(n,e,r,o)}function N2(t,n,e,r,o){let i=u9(e);if(typeof i=="function"){if(!m2(n,t,r))return r&st.Host?E2(o,e,r):T2(n,e,r,o);try{let s;if(s=i(r),s==null&&!(r&st.Optional))hI(e);else return s}finally{x2()}}else if(typeof i=="number"){let s=null,a=I2(t,n),l=pp,c=r&st.Host?n[$i][di]:null;for((a===-1||r&st.SkipSelf)&&(l=a===-1?TI(t,n):n[a+8],l===pp||!JA(r,!1)?a=-1:(s=n[St],a=Vx(l),n=Bx(l,n)));a!==-1;){let u=n[St];if(ZA(i,a,u.data)){let d=l9(a,n,e,s,r,c);if(d!==Pi)return d}l=n[a+8],l!==pp&&JA(r,n[St].data[a+8]===c)&&ZA(i,a,n)?(s=u,a=Vx(l),n=Bx(l,n)):a=-1}}return o}function l9(t,n,e,r,o,i){let s=n[St],a=s.data[t+8],l=r==null?wu(a)&&B_:r!=s&&(a.type&3)!==0,c=o&st.Host&&i===a,u=c9(a,s,e,l,c);return u!==null?jx(n,s,u,a):Pi}function c9(t,n,e,r,o){let i=t.providerIndexes,s=n.data,a=i&1048575,l=t.directiveStart,c=t.directiveEnd,u=i>>20,d=r?a:a+u,p=o?a+u:c;for(let f=d;f<p;f++){let m=s[f];if(f<l&&e===m||f>=l&&m.type===e)return f}if(o){let f=s[l];if(f&&Cs(f)&&f.type===e)return l}return null}function jx(t,n,e,r){let o=t[e],i=n.data;if(ZK(o)){let s=o;s.resolving&&J6(Z6(i[e]));let a=zx(s.canSeeViewProviders);s.resolving=!0;let l,c=s.injectImpl?Lr(s.injectImpl):null,u=m2(t,r,st.Default);try{o=t[e]=s.factory(void 0,i,t,r),n.firstCreatePass&&e>=r.directiveStart&&YK(e,i[e],n)}finally{c!==null&&Lr(c),zx(a),s.resolving=!1,x2()}}return o}function u9(t){if(typeof t=="string")return t.charCodeAt(0)||0;let n=t.hasOwnProperty(sh)?t[sh]:void 0;return typeof n=="number"?n>=0?n&S2:d9:n}function ZA(t,n,e){let r=1<<t;return!!(e[n+(t>>_2)]&r)}function JA(t,n){return!(t&st.Self)&&!(t&st.Host&&n)}var uu=class{_tNode;_lView;constructor(n,e){this._tNode=n,this._lView=e}get(n,e,r){return D2(this._tNode,this._lView,n,s0(r),e)}};function d9(){return new uu(Ir(),_t())}function Ao(t){return hh(()=>{let n=t.prototype.constructor,e=n[Nx]||U_(n),r=Object.prototype,o=Object.getPrototypeOf(t.prototype).constructor;for(;o&&o!==r;){let i=o[Nx]||U_(o);if(i&&i!==e)return i;o=Object.getPrototypeOf(o)}return i=>new i})}function U_(t){return kR(t)?()=>{let n=U_(Cr(t));return n&&n()}:du(t)}function p9(t,n,e,r,o){let i=t,s=n;for(;i!==null&&s!==null&&s[Ke]&2048&&!$x(s);){let a=N2(i,s,e,r|st.Self,Pi);if(a!==Pi)return a;let l=i.parent;if(!l){let c=s[ZR];if(c){let u=c.get(e,Pi,r);if(u!==Pi)return u}l=k2(s),s=s[_p]}i=l}return o}function k2(t){let n=t[St],e=n.type;return e===2?n.declTNode:e===1?t[di]:null}function DI(t){return a9(Ir(),t)}function eR(t,n=null,e=null,r){let o=A2(t,n,e,r);return o.resolveInjectorInitializers(),o}function A2(t,n=null,e=null,r,o=new Set){let i=[e||Vr,pK(t)];return r=r||(typeof t=="object"?void 0:Sr(t)),new lh(i,n||vI(),r||null,o)}var Wn=class t{static THROW_IF_NOT_FOUND=ah;static NULL=new Rx;static create(n,e){if(Array.isArray(n))return eR({name:""},e,n,"");{let r=n.name??"";return eR({name:r},n.parent,n.providers,r)}}static \u0275prov=Re({token:t,providedIn:"any",factory:()=>$e(BR)});static __NG_ELEMENT_ID__=-1};var f9=new Me("");f9.__NG_ELEMENT_ID__=t=>{let n=Ir();if(n===null)throw new De(204,!1);if(n.type&2)return n.value;if(t&st.Optional)return null;throw new De(204,!1)};var R2=!1,Ip=(()=>{class t{static __NG_ELEMENT_ID__=m9;static __NG_ENV_ID__=e=>e}return t})(),Gx=class extends Ip{_lView;constructor(n){super(),this._lView=n}onDestroy(n){return a2(this._lView,n),()=>RK(this._lView,n)}};function m9(){return new Gx(_t())}var xu=class{},y0=new Me("",{providedIn:"root",factory:()=>!1});var O2=new Me(""),NI=new Me(""),As=(()=>{class t{taskId=0;pendingTasks=new Set;get _hasPendingTasks(){return this.hasPendingTasks.value}hasPendingTasks=new tr(!1);add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let e=this.taskId++;return this.pendingTasks.add(e),e}has(e){return this.pendingTasks.has(e)}remove(e){this.pendingTasks.delete(e),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}return t})();var j_=class extends Pn{__isAsync;destroyRef=void 0;pendingTasks=void 0;constructor(n=!1){super(),this.__isAsync=n,YR()&&(this.destroyRef=de(Ip,{optional:!0})??void 0,this.pendingTasks=de(As,{optional:!0})??void 0)}emit(n){let e=bt(null);try{super.next(n)}finally{bt(e)}}subscribe(n,e,r){let o=n,i=e||(()=>null),s=r;if(n&&typeof n=="object"){let l=n;o=l.next?.bind(l),i=l.error?.bind(l),s=l.complete?.bind(l)}this.__isAsync&&(i=this.wrapInTimeout(i),o&&(o=this.wrapInTimeout(o)),s&&(s=this.wrapInTimeout(s)));let a=super.subscribe({next:o,error:i,complete:s});return n instanceof _n&&n.add(a),a}wrapInTimeout(n){return e=>{let r=this.pendingTasks?.add();setTimeout(()=>{n(e),r!==void 0&&this.pendingTasks?.remove(r)})}}},zt=j_;function dh(...t){}function M2(t){let n,e;function r(){t=dh;try{e!==void 0&&typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(e),n!==void 0&&clearTimeout(n)}catch{}}return n=setTimeout(()=>{t(),r()}),typeof requestAnimationFrame=="function"&&(e=requestAnimationFrame(()=>{t(),r()})),()=>r()}function tR(t){return queueMicrotask(()=>t()),()=>{t=dh}}var kI="isAngularZone",Wx=kI+"_ID",h9=0,En=class t{hasPendingMacrotasks=!1;hasPendingMicrotasks=!1;isStable=!0;onUnstable=new zt(!1);onMicrotaskEmpty=new zt(!1);onStable=new zt(!1);onError=new zt(!1);constructor(n){let{enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:r=!1,shouldCoalesceRunChangeDetection:o=!1,scheduleInRootZone:i=R2}=n;if(typeof Zone>"u")throw new De(908,!1);Zone.assertZonePatched();let s=this;s._nesting=0,s._outer=s._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(s._inner=s._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(s._inner=s._inner.fork(Zone.longStackTraceZoneSpec)),s.shouldCoalesceEventChangeDetection=!o&&r,s.shouldCoalesceRunChangeDetection=o,s.callbackScheduled=!1,s.scheduleInRootZone=i,x9(s)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get(kI)===!0}static assertInAngularZone(){if(!t.isInAngularZone())throw new De(909,!1)}static assertNotInAngularZone(){if(t.isInAngularZone())throw new De(909,!1)}run(n,e,r){return this._inner.run(n,e,r)}runTask(n,e,r,o){let i=this._inner,s=i.scheduleEventTask("NgZoneEvent: "+o,n,g9,dh,dh);try{return i.runTask(s,e,r)}finally{i.cancelTask(s)}}runGuarded(n,e,r){return this._inner.runGuarded(n,e,r)}runOutsideAngular(n){return this._outer.run(n)}},g9={};function AI(t){if(t._nesting==0&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function y9(t){if(t.isCheckStableRunning||t.callbackScheduled)return;t.callbackScheduled=!0;function n(){M2(()=>{t.callbackScheduled=!1,G_(t),t.isCheckStableRunning=!0,AI(t),t.isCheckStableRunning=!1})}t.scheduleInRootZone?Zone.root.run(()=>{n()}):t._outer.run(()=>{n()}),G_(t)}function x9(t){let n=()=>{y9(t)},e=h9++;t._inner=t._inner.fork({name:"angular",properties:{[kI]:!0,[Wx]:e,[Wx+e]:!0},onInvokeTask:(r,o,i,s,a,l)=>{if(v9(l))return r.invokeTask(i,s,a,l);try{return nR(t),r.invokeTask(i,s,a,l)}finally{(t.shouldCoalesceEventChangeDetection&&s.type==="eventTask"||t.shouldCoalesceRunChangeDetection)&&n(),rR(t)}},onInvoke:(r,o,i,s,a,l,c)=>{try{return nR(t),r.invoke(i,s,a,l,c)}finally{t.shouldCoalesceRunChangeDetection&&!t.callbackScheduled&&!b9(l)&&n(),rR(t)}},onHasTask:(r,o,i,s)=>{r.hasTask(i,s),o===i&&(s.change=="microTask"?(t._hasPendingMicrotasks=s.microTask,G_(t),AI(t)):s.change=="macroTask"&&(t.hasPendingMacrotasks=s.macroTask))},onHandleError:(r,o,i,s)=>(r.handleError(i,s),t.runOutsideAngular(()=>t.onError.emit(s)),!1)})}function G_(t){t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&t.callbackScheduled===!0?t.hasPendingMicrotasks=!0:t.hasPendingMicrotasks=!1}function nR(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function rR(t){t._nesting--,AI(t)}var Hx=class{hasPendingMicrotasks=!1;hasPendingMacrotasks=!1;isStable=!0;onUnstable=new zt;onMicrotaskEmpty=new zt;onStable=new zt;onError=new zt;run(n,e,r){return n.apply(e,r)}runGuarded(n,e,r){return n.apply(e,r)}runOutsideAngular(n){return n()}runTask(n,e,r,o){return n.apply(e,r)}};function v9(t){return F2(t,"__ignore_ng_zone__")}function b9(t){return F2(t,"__scheduler_tick__")}function F2(t,n){return!Array.isArray(t)||t.length!==1?!1:t[0]?.data?.[n]===!0}var Ss=class{_console=console;handleError(n){this._console.error("ERROR",n)}},w9=new Me("",{providedIn:"root",factory:()=>{let t=de(En),n=de(Ss);return e=>t.runOutsideAngular(()=>n.handleError(e))}});function oR(t,n){return DR(t,n)}function C9(t){return DR(TR,t)}var P2=(oR.required=C9,oR);function S9(){return x0(Ir(),_t())}function x0(t,n){return new Ro(fi(t,n))}var Ro=(()=>{class t{nativeElement;constructor(e){this.nativeElement=e}static __NG_ELEMENT_ID__=S9}return t})();var iR=new Set;function bl(t){iR.has(t)||(iR.add(t),performance?.mark?.("mark_feature_usage",{detail:{feature:t}}))}function _9(t){return typeof t=="function"&&t[Fr]!==void 0}function lo(t,n){bl("NgSignals");let e=gA(t),r=e[Fr];return n?.equal&&(r.equal=n.equal),e.set=o=>Ky(r,o),e.update=o=>yA(r,o),e.asReadonly=I9.bind(e),e}function I9(){let t=this[Fr];if(t.readonlyFn===void 0){let n=()=>this();n[Fr]=t,t.readonlyFn=n}return t.readonlyFn}function $2(t){return _9(t)&&typeof t.set=="function"}function L2(t){return(t.flags&128)===128}var V2=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}(V2||{}),B2=new Map,E9=0;function T9(){return E9++}function D9(t){B2.set(t[l0],t)}function W_(t){B2.delete(t[l0])}var sR="__ngContext__";function Su(t,n){yl(n)?(t[sR]=n[l0],D9(n)):t[sR]=n}function z2(t){return j2(t[uh])}function U2(t){return j2(t[ui])}function j2(t){for(;t!==null&&!Ns(t);)t=t[ui];return t}var H_;function G2(t){H_=t}function N9(){if(H_!==void 0)return H_;if(typeof document<"u")return document;throw new De(210,!1)}var RI=new Me("",{providedIn:"root",factory:()=>k9}),k9="ng",OI=new Me(""),Oo=new Me("",{providedIn:"platform",factory:()=>"unknown"});var MI=new Me("",{providedIn:"root",factory:()=>N9().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});var A9="h",R9="b";var W2=!1,O9=new Me("",{providedIn:"root",factory:()=>W2});var H2=function(t){return t[t.CHANGE_DETECTION=0]="CHANGE_DETECTION",t[t.AFTER_NEXT_RENDER=1]="AFTER_NEXT_RENDER",t}(H2||{}),v0=new Me("");var M9=(()=>{class t{impl=null;execute(){this.impl?.execute()}static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}return t})();var F9=()=>null;function q2(t,n,e=!1){return F9(t,n,e)}function K2(t,n){let e=t.contentQueries;if(e!==null){let r=bt(null);try{for(let o=0;o<e.length;o+=2){let i=e[o],s=e[o+1];if(s!==-1){let a=t.data[s];f2(i),a.contentQueries(2,n[s],s)}}}finally{bt(r)}}}function q_(t,n,e){f2(0);let r=bt(null);try{n(t,e)}finally{bt(r)}}function FI(t,n,e){if(bI(n)){let r=bt(null);try{let o=n.directiveStart,i=n.directiveEnd;for(let s=o;s<i;s++){let a=t.data[s];if(a.contentQueries){let l=e[s];a.contentQueries(1,l,s)}}}finally{bt(r)}}}var Bi=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}(Bi||{});var bx;function P9(){if(bx===void 0&&(bx=null,cu.trustedTypes))try{bx=cu.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch{}return bx}function aR(t){return P9()?.createScriptURL(t)||t}var qx=class{changingThisBreaksApplicationSecurity;constructor(n){this.changingThisBreaksApplicationSecurity=n}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${ER})`}};function Ep(t){return t instanceof qx?t.changingThisBreaksApplicationSecurity:t}function PI(t,n){let e=$9(t);if(e!=null&&e!==n){if(e==="ResourceURL"&&n==="URL")return!0;throw new Error(`Required a safe ${n}, got a ${e} (see ${ER})`)}return e===n}function $9(t){return t instanceof qx&&t.getTypeName()||null}var L9=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function X2(t){return t=String(t),t.match(L9)?t:"unsafe:"+t}var b0=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}(b0||{});function V9(t){let n=Q2();return n?n.sanitize(b0.URL,t)||"":PI(t,"URL")?Ep(t):X2(bs(t))}function B9(t){let n=Q2();if(n)return aR(n.sanitize(b0.RESOURCE_URL,t)||"");if(PI(t,"ResourceURL"))return aR(Ep(t));throw new De(904,!1)}function z9(t,n){return n==="src"&&(t==="embed"||t==="frame"||t==="iframe"||t==="media"||t==="script")||n==="href"&&(t==="base"||t==="link")?B9:V9}function Y2(t,n,e){return z9(n,e)(t)}function Q2(){let t=_t();return t&&t[ws].sanitizer}var U9=/^>|^->|<!--|-->|--!>|<!-$/g,j9=/(<|>)/g,G9="\u200B$1\u200B";function W9(t){return t.replace(U9,n=>n.replace(j9,G9))}function Z2(t){return t instanceof Function?t():t}var xl=function(t){return t[t.None=0]="None",t[t.SignalBased=1]="SignalBased",t[t.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",t}(xl||{});function H9(t,n,e){let r=t.length;for(;;){let o=t.indexOf(n,e);if(o===-1)return o;if(o===0||t.charCodeAt(o-1)<=32){let i=n.length;if(o+i===r||t.charCodeAt(o+i)<=32)return o}e=o+1}}var J2="ng-template";function q9(t,n,e,r){let o=0;if(r){for(;o<n.length&&typeof n[o]=="string";o+=2)if(n[o]==="class"&&H9(n[o+1].toLowerCase(),e,0)!==-1)return!0}else if($I(t))return!1;if(o=n.indexOf(1,o),o>-1){let i;for(;++o<n.length&&typeof(i=n[o])=="string";)if(i.toLowerCase()===e)return!0}return!1}function $I(t){return t.type===4&&t.value!==J2}function K9(t,n,e){let r=t.type===4&&!e?J2:t.value;return n===r}function X9(t,n,e){let r=4,o=t.attrs,i=o!==null?Z9(o):0,s=!1;for(let a=0;a<n.length;a++){let l=n[a];if(typeof l=="number"){if(!s&&!li(r)&&!li(l))return!1;if(s&&li(l))continue;s=!1,r=l|r&1;continue}if(!s)if(r&4){if(r=2|r&1,l!==""&&!K9(t,l,e)||l===""&&n.length===1){if(li(r))return!1;s=!0}}else if(r&8){if(o===null||!q9(t,o,l,e)){if(li(r))return!1;s=!0}}else{let c=n[++a],u=Y9(l,o,$I(t),e);if(u===-1){if(li(r))return!1;s=!0;continue}if(c!==""){let d;if(u>i?d="":d=o[u+1].toLowerCase(),r&2&&c!==d){if(li(r))return!1;s=!0}}}}return li(r)||s}function li(t){return(t&1)===0}function Y9(t,n,e,r){if(n===null)return-1;let o=0;if(r||!e){let i=!1;for(;o<n.length;){let s=n[o];if(s===t)return o;if(s===3||s===6)i=!0;else if(s===1||s===2){let a=n[++o];for(;typeof a=="string";)a=n[++o];continue}else{if(s===4)break;if(s===0){o+=4;continue}}o+=i?1:2}return-1}else return J9(n,t)}function Q9(t,n,e=!1){for(let r=0;r<n.length;r++)if(X9(t,n[r],e))return!0;return!1}function Z9(t){for(let n=0;n<t.length;n++){let e=t[n];if(w2(e))return n}return t.length}function J9(t,n){let e=t.indexOf(4);if(e>-1)for(e++;e<t.length;){let r=t[e];if(typeof r=="number")return-1;if(r===n)return e;e++}return-1}function lR(t,n){return t?":not("+n.trim()+")":n}function e7(t){let n=t[0],e=1,r=2,o="",i=!1;for(;e<t.length;){let s=t[e];if(typeof s=="string")if(r&2){let a=t[++e];o+="["+s+(a.length>0?'="'+a+'"':"")+"]"}else r&8?o+="."+s:r&4&&(o+=" "+s);else o!==""&&!li(s)&&(n+=lR(i,o),o=""),r=s,i=i||!li(r);e++}return o!==""&&(n+=lR(i,o)),n}function t7(t){return t.map(e7).join(",")}function n7(t){let n=[],e=[],r=1,o=2;for(;r<t.length;){let i=t[r];if(typeof i=="string")o===2?i!==""&&n.push(i,t[++r]):o===8&&e.push(i);else{if(!li(o))break;o=i}r++}return e.length&&n.push(1,...e),n}var zr={};function r7(t,n){return t.createText(n)}function o7(t,n,e){t.setValue(n,e)}function i7(t,n){return t.createComment(W9(n))}function eO(t,n,e){return t.createElement(n,e)}function Kx(t,n,e,r,o){t.insertBefore(n,e,r,o)}function tO(t,n,e){t.appendChild(n,e)}function cR(t,n,e,r,o){r!==null?Kx(t,n,e,r,o):tO(t,n,e)}function s7(t,n,e){t.removeChild(null,n,e)}function a7(t,n,e){t.setAttribute(n,"style",e)}function l7(t,n,e){e===""?t.removeAttribute(n,"class"):t.setAttribute(n,"class",e)}function nO(t,n,e){let{mergedAttrs:r,classes:o,styles:i}=e;r!==null&&t9(t,n,r),o!==null&&l7(t,n,o),i!==null&&a7(t,n,i)}function $(t=1){rO(Hn(),_t(),ks()+t,!1)}function rO(t,n,e,r){if(!r)if((n[Ke]&3)===3){let i=t.preOrderCheckHooks;i!==null&&Ix(n,i,e)}else{let i=t.preOrderHooks;i!==null&&Ex(n,i,0,e)}gu(e)}function oe(t,n=st.Default){let e=_t();if(e===null)return $e(t,n);let r=Ir();return D2(r,e,Cr(t),n)}function oO(t,n,e,r,o,i){let s=bt(null);try{let a=null;o&xl.SignalBased&&(a=n[r][Fr]),a!==null&&a.transformFn!==void 0&&(i=a.transformFn(i)),o&xl.HasDecoratorInputTransform&&(i=t.inputTransforms[r].call(n,i)),t.setInput!==null?t.setInput(n,a,i,e,r):e2(n,a,r,i)}finally{bt(s)}}function LI(t,n,e,r,o,i,s,a,l,c,u){let d=n.blueprint.slice();return d[Ds]=o,d[Ke]=r|4|128|8|64|1024,(c!==null||t&&t[Ke]&2048)&&(d[Ke]|=2048),s2(d),d[_r]=d[_p]=t,d[No]=e,d[ws]=s||t&&t[ws],d[gn]=a||t&&t[gn],d[ch]=l||t&&t[ch]||null,d[di]=i,d[l0]=T9(),d[Ox]=u,d[ZR]=c,d[$i]=n.type==2?t[$i]:d,d}function iO(t,n,e,r){if(e===0)return-1;let o=n.length;for(let i=0;i<e;i++)n.push(r),t.blueprint.push(r),t.data.push(null);return o}function sO(t,n,e,r,o){let i=ks(),s=r&2;try{gu(-1),s&&n.length>ko&&rO(t,n,ko,!1),To(s?2:0,o),e(r,o)}finally{gu(i),To(s?3:1,o)}}function VI(t,n,e){l2()&&(Su(fi(e,n),n),aO(t,n,e))}function aO(t,n,e){v7(t,n,e),(e.flags&64)===64&&b7(t,n,e)}function BI(t,n,e=fi){let r=n.localNames;if(r!==null){let o=n.index+1;for(let i=0;i<r.length;i+=2){let s=r[i+1],a=s===-1?e(n,t):t[s];t[o++]=a}}}function c7(t){let n=t.tView;return n===null||n.incompleteFirstPass?t.tView=zI(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts,t.id):n}function zI(t,n,e,r,o,i,s,a,l,c,u){let d=ko+r,p=d+o,f=u7(d,p),m=typeof c=="function"?c():c;return f[St]={type:t,blueprint:f,template:e,queries:null,viewQuery:a,declTNode:n,data:f.slice().fill(null,d),bindingStartIndex:d,expandoStartIndex:p,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof i=="function"?i():i,pipeRegistry:typeof s=="function"?s():s,firstChild:null,schemas:l,consts:m,incompleteFirstPass:!1,ssrId:u}}function u7(t,n){let e=[];for(let r=0;r<n;r++)e.push(r<t?null:zr);return e}function d7(t,n,e,r){let i=r.get(O9,W2)||e===Bi.ShadowDom,s=t.selectRootElement(n,i);return p7(s),s}function p7(t){f7(t)}var f7=()=>null;function uR(t,n,e,r,o){for(let i in n){if(!n.hasOwnProperty(i))continue;let s=n[i];if(s===void 0)continue;r??={};let a,l=xl.None;Array.isArray(s)?(a=s[0],l=s[1]):a=s;let c=i;if(o!==null){if(!o.hasOwnProperty(i))continue;c=o[i]}t===0?dR(r,e,c,a,l):dR(r,e,c,a)}return r}function dR(t,n,e,r,o){let i;t.hasOwnProperty(e)?(i=t[e]).push(n,r):i=t[e]=[n,r],o!==void 0&&i.push(o)}function m7(t,n,e){let r=n.directiveStart,o=n.directiveEnd,i=t.data,s=n.attrs,a=[],l=null,c=null;for(let u=r;u<o;u++){let d=i[u],p=e?e.get(d):null,f=p?p.inputs:null,m=p?p.outputs:null;l=uR(0,d.inputs,u,l,f),c=uR(1,d.outputs,u,c,m);let h=l!==null&&s!==null&&!$I(n)?O7(l,u,s):null;a.push(h)}l!==null&&(l.hasOwnProperty("class")&&(n.flags|=8),l.hasOwnProperty("style")&&(n.flags|=16)),n.initialInputs=a,n.inputs=l,n.outputs=c}function h7(t){return t==="class"?"className":t==="for"?"htmlFor":t==="formaction"?"formAction":t==="innerHtml"?"innerHTML":t==="readonly"?"readOnly":t==="tabindex"?"tabIndex":t}function UI(t,n,e,r,o,i,s,a){let l=fi(n,e),c=n.inputs,u;!a&&c!=null&&(u=c[r])?(WI(t,e,u,r,o),wu(n)&&g7(e,n.index)):n.type&3?(r=h7(r),o=s!=null?s(o,n.value||"",r):o,i.setProperty(l,r,o)):n.type&12}function g7(t,n){let e=Vi(n,t);e[Ke]&16||(e[Ke]|=64)}function jI(t,n,e,r){if(l2()){let o=r===null?null:{"":-1},i=C7(t,e);if(i!==null){let[s,a]=cO(t,e,i);lO(t,n,e,s,o,a)}o&&_7(e,r,o)}e.mergedAttrs=vp(e.mergedAttrs,e.attrs)}function lO(t,n,e,r,o,i){for(let c=0;c<r.length;c++)z_(Ux(e,n),t,r[c].type);E7(e,t.data.length,r.length);for(let c=0;c<r.length;c++){let u=r[c];u.providersResolver&&u.providersResolver(u)}let s=!1,a=!1,l=iO(t,n,r.length,null);for(let c=0;c<r.length;c++){let u=r[c];e.mergedAttrs=vp(e.mergedAttrs,u.hostAttrs),T7(t,e,n,l,u),I7(l,u,o),u.contentQueries!==null&&(e.flags|=4),(u.hostBindings!==null||u.hostAttrs!==null||u.hostVars!==0)&&(e.flags|=64);let d=u.type.prototype;!s&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((t.preOrderHooks??=[]).push(e.index),s=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((t.preOrderCheckHooks??=[]).push(e.index),a=!0),l++}m7(t,e,i)}function y7(t,n,e,r,o){let i=o.hostBindings;if(i){let s=t.hostBindingOpCodes;s===null&&(s=t.hostBindingOpCodes=[]);let a=~n.index;x7(s)!=a&&s.push(a),s.push(e,r,i)}}function x7(t){let n=t.length;for(;n>0;){let e=t[--n];if(typeof e=="number"&&e<0)return e}return 0}function v7(t,n,e){let r=e.directiveStart,o=e.directiveEnd;wu(e)&&N7(n,e,t.data[r+e.componentOffset]),t.firstCreatePass||Ux(e,n);let i=e.initialInputs;for(let s=r;s<o;s++){let a=t.data[s],l=jx(n,t,s,e);if(Su(l,n),i!==null&&R7(n,s-r,l,a,e,i),Cs(a)){let c=Vi(e.index,n);c[No]=jx(n,t,s,e)}}}function b7(t,n,e){let r=e.directiveStart,o=e.directiveEnd,i=e.index,s=WK();try{gu(i);for(let a=r;a<o;a++){let l=t.data[a],c=n[a];L_(a),(l.hostBindings!==null||l.hostVars!==0||l.hostAttrs!==null)&&w7(l,c)}}finally{gu(-1),L_(s)}}function w7(t,n){t.hostBindings!==null&&t.hostBindings(1,n)}function C7(t,n){let e=t.directiveRegistry,r=null;if(e)for(let o=0;o<e.length;o++){let i=e[o];Q9(n,i.selectors,!1)&&(r??=[],Cs(i)?r.unshift(i):r.push(i))}return r}function cO(t,n,e){let r=[],o=null;for(let i of e)i.findHostDirectiveDefs!==null&&(o??=new Map,i.findHostDirectiveDefs(i,r,o)),Cs(i)&&(r.push(i),S7(t,n,r.length-1));return wu(n)?r.push(...e.slice(1)):r.push(...e),[r,o]}function S7(t,n,e){n.componentOffset=e,(t.components??=[]).push(n.index)}function _7(t,n,e){if(n){let r=t.localNames=[];for(let o=0;o<n.length;o+=2){let i=e[n[o+1]];if(i==null)throw new De(-301,!1);r.push(n[o],i)}}}function I7(t,n,e){if(e){if(n.exportAs)for(let r=0;r<n.exportAs.length;r++)e[n.exportAs[r]]=t;Cs(n)&&(e[""]=t)}}function E7(t,n,e){t.flags|=1,t.directiveStart=n,t.directiveEnd=n+e,t.providerIndexes=n}function T7(t,n,e,r,o){t.data[r]=o;let i=o.factory||(o.factory=du(o.type,!0)),s=new yu(i,Cs(o),oe);t.blueprint[r]=s,e[r]=s,y7(t,n,r,iO(t,e,o.hostVars,zr),o)}function D7(t){let n=16;return t.signals?n=4096:t.onPush&&(n=64),n}function N7(t,n,e){let r=fi(n,t),o=c7(e),i=t[ws].rendererFactory,s=GI(t,LI(t,o,null,D7(e),r,n,null,i.createRenderer(r,e),null,null,null));return t[n.index]=s}function k7(t,n,e,r,o,i){let s=fi(t,n);A7(n[gn],s,i,t.value,e,r,o)}function A7(t,n,e,r,o,i,s){if(i==null)t.removeAttribute(n,o,e);else{let a=s==null?bs(i):s(i,r||"",o);t.setAttribute(n,o,a,e)}}function R7(t,n,e,r,o,i){let s=i[n];if(s!==null)for(let a=0;a<s.length;){let l=s[a++],c=s[a++],u=s[a++],d=s[a++];oO(r,e,l,c,u,d)}}function O7(t,n,e){let r=null,o=0;for(;o<e.length;){let i=e[o];if(i===0){o+=4;continue}else if(i===5){o+=2;continue}if(typeof i=="number")break;if(t.hasOwnProperty(i)){r===null&&(r=[]);let s=t[i];for(let a=0;a<s.length;a+=3)if(s[a]===n){r.push(i,s[a+1],s[a+2],e[o+1]);break}}o+=2}return r}function uO(t,n,e,r){return[t,!0,0,n,null,r,null,e,null,null]}function GI(t,n){return t[uh]?t[KA][ui]=n:t[uh]=n,t[KA]=n,n}function dO(t,n){let e=t[ch],r=e?e.get(Ss,null):null;r&&r.handleError(n)}function WI(t,n,e,r,o){for(let i=0;i<e.length;){let s=e[i++],a=e[i++],l=e[i++],c=n[s],u=t.data[s];oO(u,c,r,a,l,o)}}function M7(t,n){let e=Vi(n,t),r=e[St];F7(r,e);let o=e[Ds];o!==null&&e[Ox]===null&&(e[Ox]=q2(o,e[ch])),HI(r,e,e[No])}function F7(t,n){for(let e=n.length;e<t.blueprint.length;e++)n.push(t.blueprint[e])}function HI(t,n,e){II(n);try{let r=t.viewQuery;r!==null&&q_(1,r,e);let o=t.template;o!==null&&sO(t,n,o,1,e),t.firstCreatePass&&(t.firstCreatePass=!1),n[yp]?.finishViewCreation(t),t.staticContentQueries&&K2(t,n),t.staticViewQueries&&q_(2,t.viewQuery,e);let i=t.components;i!==null&&P7(n,i)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),r}finally{n[Ke]&=-5,EI()}}function P7(t,n){for(let e=0;e<n.length;e++)M7(t,n[e])}var _s=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}(_s||{}),$7;function qI(t,n){return $7(t,n)}function pO(t){return(t.flags&32)===32}function up(t,n,e,r,o){if(r!=null){let i,s=!1;Ns(r)?i=r:yl(r)&&(s=!0,r=r[Ds]);let a=Li(r);t===0&&e!==null?o==null?tO(n,e,a):Kx(n,e,a,o||null,!0):t===1&&e!==null?Kx(n,e,a,o||null,!0):t===2?s7(n,a,s):t===3&&n.destroyNode(a),i!=null&&Y7(n,t,i,e,o)}}function L7(t,n){fO(t,n),n[Ds]=null,n[di]=null}function V7(t,n,e,r,o,i){r[Ds]=o,r[di]=n,C0(t,r,e,1,o,i)}function fO(t,n){n[ws].changeDetectionScheduler?.notify(10),C0(t,n,n[gn],2,null,null)}function B7(t){let n=t[uh];if(!n)return w_(t[St],t);for(;n;){let e=null;if(yl(n))e=n[uh];else{let r=n[Do];r&&(e=r)}if(!e){for(;n&&!n[ui]&&n!==t;)yl(n)&&w_(n[St],n),n=n[_r];n===null&&(n=t),yl(n)&&w_(n[St],n),e=n&&n[ui]}n=e}}function z7(t,n,e,r){let o=Do+r,i=e.length;r>0&&(e[o-1][ui]=n),r<i-Do?(n[ui]=e[o],VR(e,Do+r,n)):(e.push(n),n[ui]=null),n[_r]=e;let s=n[gp];s!==null&&e!==s&&mO(s,n);let a=n[yp];a!==null&&a.insertView(t),P_(n),n[Ke]|=128}function mO(t,n){let e=t[Px],r=n[_r];if(yl(r))t[Ke]|=2;else{let o=r[_r][$i];n[$i]!==o&&(t[Ke]|=2)}e===null?t[Px]=[n]:e.push(n)}function KI(t,n){let e=t[Px],r=e.indexOf(n);e.splice(r,1)}function K_(t,n){if(t.length<=Do)return;let e=Do+n,r=t[e];if(r){let o=r[gp];o!==null&&o!==t&&KI(o,r),n>0&&(t[e-1][ui]=r[ui]);let i=Ax(t,Do+n);L7(r[St],r);let s=i[yp];s!==null&&s.detachView(i[St]),r[_r]=null,r[ui]=null,r[Ke]&=-129}return r}function hO(t,n){if(yh(n))return;let e=n[gn];e.destroyNode&&C0(t,n,e,3,null,null),B7(n)}function w_(t,n){if(yh(n))return;let e=bt(null);try{n[Ke]&=-129,n[Ke]|=256,n[ao]&&Qd(n[ao]),j7(t,n),U7(t,n),n[St].type===1&&n[gn].destroy();let r=n[gp];if(r!==null&&Ns(n[_r])){r!==n[_r]&&KI(r,n);let o=n[yp];o!==null&&o.detachView(t)}W_(n)}finally{bt(e)}}function U7(t,n){let e=t.cleanup,r=n[Mx];if(e!==null)for(let s=0;s<e.length-1;s+=2)if(typeof e[s]=="string"){let a=e[s+3];a>=0?r[a]():r[-a].unsubscribe(),s+=2}else{let a=r[e[s+1]];e[s].call(a)}r!==null&&(n[Mx]=null);let o=n[gl];if(o!==null){n[gl]=null;for(let s=0;s<o.length;s++){let a=o[s];a()}}let i=n[fu];if(i!==null){n[fu]=null;for(let s of i)s.destroy()}}function j7(t,n){let e;if(t!=null&&(e=t.destroyHooks)!=null)for(let r=0;r<e.length;r+=2){let o=n[e[r]];if(!(o instanceof yu)){let i=e[r+1];if(Array.isArray(i))for(let s=0;s<i.length;s+=2){let a=o[i[s]],l=i[s+1];To(4,a,l);try{l.call(a)}finally{To(5,a,l)}}else{To(4,o,i);try{i.call(o)}finally{To(5,o,i)}}}}}function G7(t,n,e){return W7(t,n.parent,e)}function W7(t,n,e){let r=n;for(;r!==null&&r.type&168;)n=r,r=n.parent;if(r===null)return e[Ds];if(wu(r)){let{encapsulation:o}=t.data[r.directiveStart+r.componentOffset];if(o===Bi.None||o===Bi.Emulated)return null}return fi(r,e)}function H7(t,n,e){return K7(t,n,e)}function q7(t,n,e){return t.type&40?fi(t,e):null}var K7=q7,pR;function w0(t,n,e,r){let o=G7(t,r,n),i=n[gn],s=r.parent||n[di],a=H7(s,r,n);if(o!=null)if(Array.isArray(e))for(let l=0;l<e.length;l++)cR(i,o,e[l],a,!1);else cR(i,o,e,a,!1);pR!==void 0&&pR(i,r,n,e,o)}function ih(t,n){if(n!==null){let e=n.type;if(e&3)return fi(n,t);if(e&4)return X_(-1,t[n.index]);if(e&8){let r=n.child;if(r!==null)return ih(t,r);{let o=t[n.index];return Ns(o)?X_(-1,o):Li(o)}}else{if(e&128)return ih(t,n.next);if(e&32)return qI(n,t)()||Li(t[n.index]);{let r=gO(t,n);if(r!==null){if(Array.isArray(r))return r[0];let o=hu(t[$i]);return ih(o,r)}else return ih(t,n.next)}}}return null}function gO(t,n){if(n!==null){let r=t[$i][di],o=n.projection;return r.projection[o]}return null}function X_(t,n){let e=Do+t+1;if(e<n.length){let r=n[e],o=r[St].firstChild;if(o!==null)return ih(r,o)}return n[mu]}function XI(t,n,e,r,o,i,s){for(;e!=null;){if(e.type===128){e=e.next;continue}let a=r[e.index],l=e.type;if(s&&n===0&&(a&&Su(Li(a),r),e.flags|=2),!pO(e))if(l&8)XI(t,n,e.child,r,o,i,!1),up(n,t,o,a,i);else if(l&32){let c=qI(e,r),u;for(;u=c();)up(n,t,o,u,i);up(n,t,o,a,i)}else l&16?X7(t,n,r,e,o,i):up(n,t,o,a,i);e=s?e.projectionNext:e.next}}function C0(t,n,e,r,o,i){XI(e,r,t.firstChild,n,o,i,!1)}function X7(t,n,e,r,o,i){let s=e[$i],l=s[di].projection[r.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++){let u=l[c];up(n,t,o,u,i)}else{let c=l,u=s[_r];L2(r)&&(c.flags|=128),XI(t,n,c,u,o,i,!0)}}function Y7(t,n,e,r,o){let i=e[mu],s=Li(e);i!==s&&up(n,t,r,i,o);for(let a=Do;a<e.length;a++){let l=e[a];C0(l[St],l,t,n,r,i)}}function Q7(t,n,e,r,o){if(n)o?t.addClass(e,r):t.removeClass(e,r);else{let i=r.indexOf("-")===-1?void 0:_s.DashCase;o==null?t.removeStyle(e,r,i):(typeof o=="string"&&o.endsWith("!important")&&(o=o.slice(0,-10),i|=_s.Important),t.setStyle(e,r,o,i))}}function Z7(t,n,e,r){let o=bt(null);try{let i=n.tView,a=t[Ke]&4096?4096:16,l=LI(t,i,e,a,null,n,null,null,r?.injector??null,r?.embeddedViewInjector??null,r?.dehydratedView??null),c=t[n.index];l[gp]=c;let u=t[yp];return u!==null&&(l[yp]=u.createEmbeddedView(i)),HI(i,l,e),l}finally{bt(o)}}function fR(t,n){return!n||n.firstChild===null||L2(t)}function J7(t,n,e,r=!0){let o=n[St];if(z7(o,n,t,e),r){let s=X_(e,t),a=n[gn],l=a.parentNode(t[mu]);l!==null&&V7(o,t[di],a,n,l,s)}let i=n[Ox];i!==null&&i.firstChild!==null&&(i.firstChild=null)}function Xx(t,n,e,r,o=!1){for(;e!==null;){if(e.type===128){e=o?e.projectionNext:e.next;continue}let i=n[e.index];i!==null&&r.push(Li(i)),Ns(i)&&eX(i,r);let s=e.type;if(s&8)Xx(t,n,e.child,r);else if(s&32){let a=qI(e,n),l;for(;l=a();)r.push(l)}else if(s&16){let a=gO(n,e);if(Array.isArray(a))r.push(...a);else{let l=hu(n[$i]);Xx(l[St],l,a,r,!0)}}e=o?e.projectionNext:e.next}return r}function eX(t,n){for(let e=Do;e<t.length;e++){let r=t[e],o=r[St].firstChild;o!==null&&Xx(r[St],r,o,n)}t[mu]!==t[Ds]&&n.push(t[mu])}var yO=[];function tX(t){return t[ao]??nX(t)}function nX(t){let n=yO.pop()??Object.create(oX);return n.lView=t,n}function rX(t){t.lView[ao]!==t&&(t.lView=null,yO.push(t))}var oX=Ze(he({},ru),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{xh(t.lView)},consumerOnSignalRead(){this.lView[ao]=this}});function iX(t){let n=t[ao]??Object.create(sX);return n.lView=t,n}var sX=Ze(he({},ru),{consumerIsAlwaysLive:!0,kind:"template",consumerMarkedDirty:t=>{let n=hu(t.lView);for(;n&&!xO(n[St]);)n=hu(n);n&&CI(n)},consumerOnSignalRead(){this.lView[ao]=this}});function xO(t){return t.type!==2}function vO(t){if(t[fu]===null)return;let n=!0;for(;n;){let e=!1;for(let r of t[fu])r.dirty&&(e=!0,r.zone===null||Zone.current===r.zone?r.run():r.zone.run(()=>r.run()));n=e&&!!(t[Ke]&8192)}}var aX=100;function bO(t,n=!0,e=0){let o=t[ws].rendererFactory,i=!1;i||o.begin?.();try{lX(t,e)}catch(s){throw n&&dO(t,s),s}finally{i||o.end?.()}}function lX(t,n){let e=d2();try{Lx(!0),Y_(t,n);let r=0;for(;u0(t);){if(r===aX)throw new De(103,!1);r++,Y_(t,1)}}finally{Lx(e)}}function cX(t,n,e,r){if(yh(n))return;let o=n[Ke],i=!1,s=!1;II(n);let a=!0,l=null,c=null;i||(xO(t)?(c=tX(n),l=Yd(c)):oA()===null?(a=!1,c=iX(n),l=Yd(c)):n[ao]&&(Qd(n[ao]),n[ao]=null));try{s2(n),UK(t.bindingStartIndex),e!==null&&sO(t,n,e,2,r);let u=(o&3)===3;if(!i)if(u){let f=t.preOrderCheckHooks;f!==null&&Ix(n,f,null)}else{let f=t.preOrderHooks;f!==null&&Ex(n,f,0,null),x_(n,0)}if(s||uX(n),vO(n),wO(n,0),t.contentQueries!==null&&K2(t,n),!i)if(u){let f=t.contentCheckHooks;f!==null&&Ix(n,f)}else{let f=t.contentHooks;f!==null&&Ex(n,f,1),x_(n,1)}pX(t,n);let d=t.components;d!==null&&SO(n,d,0);let p=t.viewQuery;if(p!==null&&q_(2,p,r),!i)if(u){let f=t.viewCheckHooks;f!==null&&Ix(n,f)}else{let f=t.viewHooks;f!==null&&Ex(n,f,2),x_(n,2)}if(t.firstUpdatePass===!0&&(t.firstUpdatePass=!1),n[_x]){for(let f of n[_x])f();n[_x]=null}i||(n[Ke]&=-73)}catch(u){throw i||xh(n),u}finally{c!==null&&(Jm(c,l),a&&rX(c)),EI()}}function wO(t,n){for(let e=z2(t);e!==null;e=U2(e))for(let r=Do;r<e.length;r++){let o=e[r];CO(o,n)}}function uX(t){for(let n=z2(t);n!==null;n=U2(n)){if(!(n[Ke]&2))continue;let e=n[Px];for(let r=0;r<e.length;r++){let o=e[r];CI(o)}}}function dX(t,n,e){let r=Vi(n,t);CO(r,e)}function CO(t,n){wI(t)&&Y_(t,n)}function Y_(t,n){let r=t[St],o=t[Ke],i=t[ao],s=!!(n===0&&o&16);if(s||=!!(o&64&&n===0),s||=!!(o&1024),s||=!!(i?.dirty&&eh(i)),s||=!1,i&&(i.dirty=!1),t[Ke]&=-9217,s)cX(r,t,r.template,t[No]);else if(o&8192){vO(t),wO(t,1);let a=r.components;a!==null&&SO(t,a,1)}}function SO(t,n,e){for(let r=0;r<n.length;r++)dX(t,n[r],e)}function pX(t,n){let e=t.hostBindingOpCodes;if(e!==null)try{for(let r=0;r<e.length;r++){let o=e[r];if(o<0)gu(~o);else{let i=o,s=e[++r],a=e[++r];GK(s,i);let l=n[i];To(24,l),a(2,l),To(25,l)}}}finally{gu(-1)}}function YI(t,n){let e=d2()?64:1088;for(t[ws].changeDetectionScheduler?.notify(n);t;){t[Ke]|=e;let r=hu(t);if($x(t)&&!r)return t;t=r}return null}var vu=class{_lView;_cdRefInjectingView;notifyErrorHandler;_appRef=null;_attachedToViewContainer=!1;get rootNodes(){let n=this._lView,e=n[St];return Xx(e,n,e.firstChild,[])}constructor(n,e,r=!0){this._lView=n,this._cdRefInjectingView=e,this.notifyErrorHandler=r}get context(){return this._lView[No]}get dirty(){return!!(this._lView[Ke]&9280)||!!this._lView[ao]?.dirty}set context(n){this._lView[No]=n}get destroyed(){return yh(this._lView)}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let n=this._lView[_r];if(Ns(n)){let e=n[Fx],r=e?e.indexOf(this):-1;r>-1&&(K_(n,r),Ax(e,r))}this._attachedToViewContainer=!1}hO(this._lView[St],this._lView)}onDestroy(n){a2(this._lView,n)}markForCheck(){YI(this._cdRefInjectingView||this._lView,4)}markForRefresh(){CI(this._cdRefInjectingView||this._lView)}detach(){this._lView[Ke]&=-129}reattach(){P_(this._lView),this._lView[Ke]|=128}detectChanges(){this._lView[Ke]|=1024,bO(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new De(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null;let n=$x(this._lView),e=this._lView[gp];e!==null&&!n&&KI(e,this._lView),fO(this._lView[St],this._lView)}attachToAppRef(n){if(this._attachedToViewContainer)throw new De(902,!1);this._appRef=n;let e=$x(this._lView),r=this._lView[gp];r!==null&&!e&&mO(r,this._lView),P_(this._lView)}},S0=(()=>{class t{static __NG_ELEMENT_ID__=hX}return t})(),fX=S0,mX=class extends fX{_declarationLView;_declarationTContainer;elementRef;constructor(n,e,r){super(),this._declarationLView=n,this._declarationTContainer=e,this.elementRef=r}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(n,e){return this.createEmbeddedViewImpl(n,e)}createEmbeddedViewImpl(n,e,r){let o=Z7(this._declarationLView,this._declarationTContainer,n,{embeddedViewInjector:e,dehydratedView:r});return new vu(o)}};function hX(){return gX(Ir(),_t())}function gX(t,n){return t.type&4?new mX(n,t,x0(t,n)):null}function vh(t,n,e,r,o){let i=t.data[n];if(i===null)i=yX(t,n,e,r,o),jK()&&(i.flags|=32);else if(i.type&64){i.type=e,i.value=r,i.attrs=o;let s=zK();i.injectorIndex=s===null?-1:s.injectorIndex}return Cu(i,!0),i}function yX(t,n,e,r,o){let i=c2(),s=SI(),a=s?i:i&&i.parent,l=t.data[n]=vX(t,a,e,n,r,o);return xX(t,l,i,s),l}function xX(t,n,e,r){t.firstChild===null&&(t.firstChild=n),e!==null&&(r?e.child==null&&n.parent!==null&&(e.child=n):e.next===null&&(e.next=n,n.prev=e))}function vX(t,n,e,r,o,i){let s=n?n.injectorIndex:-1,a=0;return LK()&&(a|=128),{type:e,index:r,insertBeforeIndex:null,injectorIndex:s,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:a,providerIndexes:0,value:o,attrs:i,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:n,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}var OIe=new RegExp(`^(\\d+)*(${R9}|${A9})*(.*)`);var bX=()=>null;function mR(t,n){return bX(t,n)}var Q_=class{},Yx=class{},Z_=class{resolveComponentFactory(n){throw Error(`No component factory found for ${Sr(n)}.`)}},bp=class{static NULL=new Z_},wp=class{},mi=(()=>{class t{destroyNode=null;static __NG_ELEMENT_ID__=()=>wX()}return t})();function wX(){let t=_t(),n=Ir(),e=Vi(n.index,t);return(yl(e)?e:t)[gn]}var CX=(()=>{class t{static \u0275prov=Re({token:t,providedIn:"root",factory:()=>null})}return t})();function Qx(t,n,e){let r=e?t.styles:null,o=e?t.classes:null,i=0;if(n!==null)for(let s=0;s<n.length;s++){let a=n[s];if(typeof a=="number")i=a;else if(i==1)o=D_(o,a);else if(i==2){let l=a,c=n[++s];r=D_(r,l+": "+c+";")}}e?t.styles=r:t.stylesWithoutHost=r,e?t.classes=o:t.classesWithoutHost=o}var Zx=class extends bp{ngModule;constructor(n){super(),this.ngModule=n}resolveComponentFactory(n){let e=pu(n);return new ph(e,this.ngModule)}};function hR(t,n){let e=[];for(let r in t){if(!t.hasOwnProperty(r))continue;let o=t[r];if(o===void 0)continue;let i=Array.isArray(o),s=i?o[0]:o,a=i?o[1]:xl.None;n?e.push({propName:s,templateName:r,isSignal:(a&xl.SignalBased)!==0}):e.push({propName:s,templateName:r})}return e}function SX(t){let n=t.toLowerCase();return n==="svg"?TK:n==="math"?DK:null}var ph=class extends Yx{componentDef;ngModule;selector;componentType;ngContentSelectors;isBoundToModule;get inputs(){let n=this.componentDef,e=n.inputTransforms,r=hR(n.inputs,!0);if(e!==null)for(let o of r)e.hasOwnProperty(o.propName)&&(o.transform=e[o.propName]);return r}get outputs(){return hR(this.componentDef.outputs,!1)}constructor(n,e){super(),this.componentDef=n,this.ngModule=e,this.componentType=n.type,this.selector=t7(n.selectors),this.ngContentSelectors=n.ngContentSelectors??[],this.isBoundToModule=!!e}create(n,e,r,o){let i=bt(null);try{o=o||this.ngModule;let s=o instanceof Br?o:o?.injector;s&&this.componentDef.getStandaloneInjector!==null&&(s=this.componentDef.getStandaloneInjector(s)||s);let a=s?new V_(n,s):n,l=a.get(wp,null);if(l===null)throw new De(407,!1);let c=a.get(CX,null),u=a.get(xu,null),d={rendererFactory:l,sanitizer:c,changeDetectionScheduler:u},p=l.createRenderer(null,this.componentDef),f=this.componentDef.selectors[0][0]||"div",m=r?d7(p,r,this.componentDef.encapsulation,a):eO(p,f,SX(f)),h=512;this.componentDef.signals?h|=4096:this.componentDef.onPush||(h|=16);let g=null;m!==null&&(g=q2(m,a,!0));let y=zI(0,null,null,1,0,null,null,null,null,null,null),v=LI(null,y,null,h,null,null,d,p,a,null,g);v[ko]=m,II(v);let S=null;try{let C=r?["ng-version","19.1.4"]:n7(this.componentDef.selectors[0]),I=vh(y,ko,2,"#host",C),[E,D]=cO(y,I,[this.componentDef]);lO(y,v,I,E,{},D);for(let O of E)I.mergedAttrs=vp(I.mergedAttrs,O.hostAttrs);I.mergedAttrs=vp(I.mergedAttrs,C),Qx(I,I.mergedAttrs,!0),m&&(nO(p,m,I),Su(m,v)),e!==void 0&&_X(I,this.ngContentSelectors,e),aO(y,v,I),FI(y,I,v),g0(y,I),S=Vi(I.index,v),v[No]=S[No],HI(y,v,null)}catch(C){throw S!==null&&W_(S),W_(v),C}finally{EI()}return new J_(this.componentType,v)}finally{bt(i)}}},J_=class extends Q_{_rootLView;instance;hostView;changeDetectorRef;componentType;location;previousInputValues=null;_tNode;constructor(n,e){super(),this._rootLView=e,this._tNode=i2(e[St],ko),this.location=x0(this._tNode,e),this.instance=Vi(this._tNode.index,e)[No],this.hostView=this.changeDetectorRef=new vu(e,void 0,!1),this.componentType=n}setInput(n,e){let r=this._tNode.inputs,o;if(r!==null&&(o=r[n])){if(this.previousInputValues??=new Map,this.previousInputValues.has(n)&&Object.is(this.previousInputValues.get(n),e))return;let i=this._rootLView;WI(i[St],i,o,n,e),this.previousInputValues.set(n,e);let s=Vi(this._tNode.index,i);YI(s,1)}}get injector(){return new uu(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(n){this.hostView.onDestroy(n)}};function _X(t,n,e){let r=t.projection=[];for(let o=0;o<n.length;o++){let i=e[o];r.push(i!=null&&i.length?Array.from(i):null)}}var Tp=(()=>{class t{static __NG_ELEMENT_ID__=IX}return t})();function IX(){let t=Ir();return TX(t,_t())}var EX=Tp,_O=class extends EX{_lContainer;_hostTNode;_hostLView;constructor(n,e,r){super(),this._lContainer=n,this._hostTNode=e,this._hostLView=r}get element(){return x0(this._hostTNode,this._hostLView)}get injector(){return new uu(this._hostTNode,this._hostLView)}get parentInjector(){let n=TI(this._hostTNode,this._hostLView);if(C2(n)){let e=Bx(n,this._hostLView),r=Vx(n),o=e[St].data[r+8];return new uu(o,e)}else return new uu(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(n){let e=gR(this._lContainer);return e!==null&&e[n]||null}get length(){return this._lContainer.length-Do}createEmbeddedView(n,e,r){let o,i;typeof r=="number"?o=r:r!=null&&(o=r.index,i=r.injector);let s=mR(this._lContainer,n.ssrId),a=n.createEmbeddedViewImpl(e||{},i,s);return this.insertImpl(a,o,fR(this._hostTNode,s)),a}createComponent(n,e,r,o,i){let s=n&&!SK(n),a;if(s)a=e;else{let m=e||{};a=m.index,r=m.injector,o=m.projectableNodes,i=m.environmentInjector||m.ngModuleRef}let l=s?n:new ph(pu(n)),c=r||this.parentInjector;if(!i&&l.ngModule==null){let h=(s?c:this.parentInjector).get(Br,null);h&&(i=h)}let u=pu(l.componentType??{}),d=mR(this._lContainer,u?.id??null),p=d?.firstChild??null,f=l.create(c,o,p,i);return this.insertImpl(f.hostView,a,fR(this._hostTNode,d)),f}insert(n,e){return this.insertImpl(n,e,!0)}insertImpl(n,e,r){let o=n._lView;if(kK(o)){let a=this.indexOf(n);if(a!==-1)this.detach(a);else{let l=o[_r],c=new _O(l,l[di],l[_r]);c.detach(c.indexOf(n))}}let i=this._adjustIndex(e),s=this._lContainer;return J7(s,o,i,r),n.attachToViewContainerRef(),VR(C_(s),i,n),n}move(n,e){return this.insert(n,e)}indexOf(n){let e=gR(this._lContainer);return e!==null?e.indexOf(n):-1}remove(n){let e=this._adjustIndex(n,-1),r=K_(this._lContainer,e);r&&(Ax(C_(this._lContainer),e),hO(r[St],r))}detach(n){let e=this._adjustIndex(n,-1),r=K_(this._lContainer,e);return r&&Ax(C_(this._lContainer),e)!=null?new vu(r):null}_adjustIndex(n,e=0){return n??this.length+e}};function gR(t){return t[Fx]}function C_(t){return t[Fx]||(t[Fx]=[])}function TX(t,n){let e,r=n[t.index];return Ns(r)?e=r:(e=uO(r,n,null,t),n[t.index]=e,GI(n,e)),NX(e,n,t,r),new _O(e,t,n)}function DX(t,n){let e=t[gn],r=e.createComment(""),o=fi(n,t),i=e.parentNode(o);return Kx(e,i,r,e.nextSibling(o),!1),r}var NX=RX,kX=()=>!1;function AX(t,n,e){return kX(t,n,e)}function RX(t,n,e,r){if(t[mu])return;let o;e.type&8?o=Li(r):o=DX(n,e),t[mu]=o}var vl=class{},fh=class{};var eI=class extends vl{ngModuleType;_parent;_bootstrapComponents=[];_r3Injector;instance;destroyCbs=[];componentFactoryResolver=new Zx(this);constructor(n,e,r,o=!0){super(),this.ngModuleType=n,this._parent=e;let i=UR(n);this._bootstrapComponents=Z2(i.bootstrap),this._r3Injector=A2(n,e,[{provide:vl,useValue:this},{provide:bp,useValue:this.componentFactoryResolver},...r],Sr(n),new Set(["environment"])),o&&this.resolveInjectorInitializers()}resolveInjectorInitializers(){this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(this.ngModuleType)}get injector(){return this._r3Injector}destroy(){let n=this._r3Injector;!n.destroyed&&n.destroy(),this.destroyCbs.forEach(e=>e()),this.destroyCbs=null}onDestroy(n){this.destroyCbs.push(n)}},tI=class extends fh{moduleType;constructor(n){super(),this.moduleType=n}create(n){return new eI(this.moduleType,n,[])}};var Jx=class extends vl{injector;componentFactoryResolver=new Zx(this);instance=null;constructor(n){super();let e=new lh([...n.providers,{provide:vl,useValue:this},{provide:bp,useValue:this.componentFactoryResolver}],n.parent||vI(),n.debugName,new Set(["environment"]));this.injector=e,n.runEnvironmentInitializers&&e.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(n){this.injector.onDestroy(n)}};function QI(t,n,e=null){return new Jx({providers:t,parent:n,debugName:e,runEnvironmentInitializers:!0}).injector}var OX=(()=>{class t{_injector;cachedInjectors=new Map;constructor(e){this._injector=e}getOrCreateStandaloneInjector(e){if(!e.standalone)return null;if(!this.cachedInjectors.has(e)){let r=HR(!1,e.type),o=r.length>0?QI([r],this._injector,`Standalone[${e.type.name}]`):null;this.cachedInjectors.set(e,o)}return this.cachedInjectors.get(e)}ngOnDestroy(){try{for(let e of this.cachedInjectors.values())e!==null&&e.destroy()}finally{this.cachedInjectors.clear()}}static \u0275prov=Re({token:t,providedIn:"environment",factory:()=>new t($e(Br))})}return t})();function Pt(t){return hh(()=>{let n=EO(t),e=Ze(he({},n),{decls:t.decls,vars:t.vars,template:t.template,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,onPush:t.changeDetection===V2.OnPush,directiveDefs:null,pipeDefs:null,dependencies:n.standalone&&t.dependencies||null,getStandaloneInjector:n.standalone?o=>o.get(OX).getOrCreateStandaloneInjector(e):null,getExternalStyles:null,signals:t.signals??!1,data:t.data||{},encapsulation:t.encapsulation||Bi.Emulated,styles:t.styles||Vr,_:null,schemas:t.schemas||null,tView:null,id:""});n.standalone&&bl("NgStandalone"),TO(e);let r=t.dependencies;return e.directiveDefs=xR(r,!1),e.pipeDefs=xR(r,!0),e.id=PX(e),e})}function MX(t){return pu(t)||jR(t)}function FX(t){return t!==null}function Rs(t){return hh(()=>({type:t.type,bootstrap:t.bootstrap||Vr,declarations:t.declarations||Vr,imports:t.imports||Vr,exports:t.exports||Vr,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null}))}function yR(t,n){if(t==null)return fp;let e={};for(let r in t)if(t.hasOwnProperty(r)){let o=t[r],i,s,a=xl.None;Array.isArray(o)?(a=o[0],i=o[1],s=o[2]??i):(i=o,s=o),n?(e[i]=a!==xl.None?[r,a]:r,n[i]=s):e[i]=r}return e}function kt(t){return hh(()=>{let n=EO(t);return TO(n),n})}function IO(t){return{type:t.type,name:t.name,factory:null,pure:t.pure!==!1,standalone:t.standalone??!0,onDestroy:t.type.prototype.ngOnDestroy||null}}function EO(t){let n={};return{type:t.type,providersResolver:null,factory:null,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputTransforms:null,inputConfig:t.inputs||fp,exportAs:t.exportAs||null,standalone:t.standalone??!0,signals:t.signals===!0,selectors:t.selectors||Vr,viewQuery:t.viewQuery||null,features:t.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:yR(t.inputs,n),outputs:yR(t.outputs),debugInfo:null}}function TO(t){t.features?.forEach(n=>n(t))}function xR(t,n){if(!t)return null;let e=n?GR:MX;return()=>(typeof t=="function"?t():t).map(r=>e(r)).filter(FX)}function PX(t){let n=0,e=typeof t.consts=="function"?"":t.consts,r=[t.selectors,t.ngContentSelectors,t.hostVars,t.hostAttrs,e,t.vars,t.decls,t.encapsulation,t.standalone,t.signals,t.exportAs,JSON.stringify(t.inputs),JSON.stringify(t.outputs),Object.getOwnPropertyNames(t.type.prototype),!!t.contentQueries,!!t.viewQuery];for(let i of r.join("|"))n=Math.imul(31,n)+i.charCodeAt(0)<<0;return n+=2147483648,"c"+n}function $X(t){return Object.getPrototypeOf(t.prototype).constructor}function Tn(t){let n=$X(t.type),e=!0,r=[t];for(;n;){let o;if(Cs(t))o=n.\u0275cmp||n.\u0275dir;else{if(n.\u0275cmp)throw new De(903,!1);o=n.\u0275dir}if(o){if(e){r.push(o);let s=t;s.inputs=wx(t.inputs),s.inputTransforms=wx(t.inputTransforms),s.declaredInputs=wx(t.declaredInputs),s.outputs=wx(t.outputs);let a=o.hostBindings;a&&UX(t,a);let l=o.viewQuery,c=o.contentQueries;if(l&&BX(t,l),c&&zX(t,c),LX(t,o),G6(t.outputs,o.outputs),Cs(o)&&o.data.animation){let u=t.data;u.animation=(u.animation||[]).concat(o.data.animation)}}let i=o.features;if(i)for(let s=0;s<i.length;s++){let a=i[s];a&&a.ngInherit&&a(t),a===Tn&&(e=!1)}}n=Object.getPrototypeOf(n)}VX(r)}function LX(t,n){for(let e in n.inputs){if(!n.inputs.hasOwnProperty(e)||t.inputs.hasOwnProperty(e))continue;let r=n.inputs[e];if(r!==void 0&&(t.inputs[e]=r,t.declaredInputs[e]=n.declaredInputs[e],n.inputTransforms!==null)){let o=Array.isArray(r)?r[0]:r;if(!n.inputTransforms.hasOwnProperty(o))continue;t.inputTransforms??={},t.inputTransforms[o]=n.inputTransforms[o]}}}function VX(t){let n=0,e=null;for(let r=t.length-1;r>=0;r--){let o=t[r];o.hostVars=n+=o.hostVars,o.hostAttrs=vp(o.hostAttrs,e=vp(e,o.hostAttrs))}}function wx(t){return t===fp?{}:t===Vr?[]:t}function BX(t,n){let e=t.viewQuery;e?t.viewQuery=(r,o)=>{n(r,o),e(r,o)}:t.viewQuery=n}function zX(t,n){let e=t.contentQueries;e?t.contentQueries=(r,o,i)=>{n(r,o,i),e(r,o,i)}:t.contentQueries=n}function UX(t,n){let e=t.hostBindings;e?t.hostBindings=(r,o)=>{n(r,o),e(r,o)}:t.hostBindings=n}function ZI(t){let n=t.inputConfig,e={};for(let r in n)if(n.hasOwnProperty(r)){let o=n[r];Array.isArray(o)&&o[3]&&(e[r]=o[3])}t.inputTransforms=e}function DO(t){return GX(t)?Array.isArray(t)||!(t instanceof Map)&&Symbol.iterator in t:!1}function jX(t,n){if(Array.isArray(t))for(let e=0;e<t.length;e++)n(t[e]);else{let e=t[Symbol.iterator](),r;for(;!(r=e.next()).done;)n(r.value)}}function GX(t){return t!==null&&(typeof t=="function"||typeof t=="object")}function NO(t,n,e){return t[n]=e}function Is(t,n,e){let r=t[n];return Object.is(r,e)?!1:(t[n]=e,!0)}function JI(t,n,e,r){let o=Is(t,n,e);return Is(t,n+1,r)||o}function kO(t,n,e,r,o){let i=JI(t,n,e,r);return Is(t,n+2,o)||i}function WX(t,n,e,r,o,i,s,a,l){let c=n.consts,u=vh(n,t,4,s||null,a||null);jI(n,e,u,xp(c,l)),g0(n,u);let d=u.tView=zI(2,u,r,o,i,n.directiveRegistry,n.pipeRegistry,null,n.schemas,c,null);return n.queries!==null&&(n.queries.template(n,u),d.queries=n.queries.embeddedTView(u)),u}function HX(t,n,e,r,o,i,s,a,l,c){let u=e+ko,d=n.firstCreatePass?WX(u,n,t,r,o,i,s,a,l):n.data[u];Cu(d,!1);let p=qX(n,t,d,e);m0()&&w0(n,t,p,d),Su(p,t);let f=uO(p,t,p,d);return t[u]=f,GI(t,f),AX(f,d,t),c0(d)&&VI(n,t,d),l!=null&&BI(t,d,c),d}function ae(t,n,e,r,o,i,s,a){let l=_t(),c=Hn(),u=xp(c.consts,i);return HX(l,c,t,n,e,r,o,u,s,a),ae}var qX=KX;function KX(t,n,e,r){return h0(!0),n[gn].createComment("")}var eE=(()=>{class t{log(e){console.log(e)}warn(e){console.warn(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"platform"})}return t})();var AO=new Me("");function _u(t){return!!t&&typeof t.then=="function"}function RO(t){return!!t&&typeof t.subscribe=="function"}var OO=new Me("");var MO=(()=>{class t{resolve;reject;initialized=!1;done=!1;donePromise=new Promise((e,r)=>{this.resolve=e,this.reject=r});appInits=de(OO,{optional:!0})??[];injector=de(Wn);constructor(){}runInitializers(){if(this.initialized)return;let e=[];for(let o of this.appInits){let i=rr(this.injector,o);if(_u(i))e.push(i);else if(RO(i)){let s=new Promise((a,l)=>{i.subscribe({complete:a,error:l})});e.push(s)}}let r=()=>{this.done=!0,this.resolve()};Promise.all(e).then(()=>{r()}).catch(o=>{this.reject(o)}),e.length===0&&r(),this.initialized=!0}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),FO=(()=>{class t{static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new e0})}return t})(),e0=class{queuedEffectCount=0;queues=new Map;schedule(n){this.enqueue(n)}remove(n){let e=n.zone,r=this.queues.get(e);r.has(n)&&(r.delete(n),this.queuedEffectCount--)}enqueue(n){let e=n.zone;this.queues.has(e)||this.queues.set(e,new Set);let r=this.queues.get(e);r.has(n)||(this.queuedEffectCount++,r.add(n))}flush(){for(;this.queuedEffectCount>0;)for(let[n,e]of this.queues)n===null?this.flushQueue(e):n.run(()=>this.flushQueue(e))}flushQueue(n){for(let e of n)n.delete(e),this.queuedEffectCount--,e.run()}},_0=new Me("");function XX(){hA(()=>{throw new De(600,!1)})}function YX(t){return t.isBoundToModule}var QX=10;function ZX(t,n,e){try{let r=e();return _u(r)?r.catch(o=>{throw n.runOutsideAngular(()=>t.handleError(o)),o}):r}catch(r){throw n.runOutsideAngular(()=>t.handleError(r)),r}}var Es=(()=>{class t{_runningTick=!1;_destroyed=!1;_destroyListeners=[];_views=[];internalErrorHandler=de(w9);afterRenderManager=de(M9);zonelessEnabled=de(y0);rootEffectScheduler=de(FO);dirtyFlags=0;deferredDirtyFlags=0;tracingSnapshot=null;externalTestViews=new Set;afterTick=new Pn;get allViews(){return[...this.externalTestViews.keys(),...this._views]}get destroyed(){return this._destroyed}componentTypes=[];components=[];isStable=de(As).hasPendingTasks.pipe(nt(e=>!e));constructor(){de(v0,{optional:!0})}whenStable(){let e;return new Promise(r=>{e=this.isStable.subscribe({next:o=>{o&&r()}})}).finally(()=>{e.unsubscribe()})}_injector=de(Br);_rendererFactory=null;get injector(){return this._injector}bootstrap(e,r){let o=e instanceof Yx;if(!this._injector.get(MO).done){let p=!o&&WR(e),f=!1;throw new De(405,f)}let s;o?s=e:s=this._injector.get(bp).resolveComponentFactory(e),this.componentTypes.push(s.componentType);let a=YX(s)?void 0:this._injector.get(vl),l=r||s.selector,c=s.create(Wn.NULL,[],l,a),u=c.location.nativeElement,d=c.injector.get(AO,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),Tx(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){this.zonelessEnabled||(this.dirtyFlags|=1),this._tick()}_tick=()=>{if(this.tracingSnapshot!==null){let r=this.tracingSnapshot;this.tracingSnapshot=null,r.run(H2.CHANGE_DETECTION,this._tick),r.dispose();return}if(this._runningTick)throw new De(101,!1);let e=bt(null);try{this._runningTick=!0,this.synchronize()}catch(r){this.internalErrorHandler(r)}finally{this._runningTick=!1,bt(e),this.afterTick.next()}};synchronize(){this._rendererFactory===null&&!this._injector.destroyed&&(this._rendererFactory=this._injector.get(wp,null,{optional:!0})),this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0;let e=0;for(;this.dirtyFlags!==0&&e++<QX;)this.synchronizeOnce()}synchronizeOnce(){if(this.dirtyFlags|=this.deferredDirtyFlags,this.deferredDirtyFlags=0,this.dirtyFlags&16&&(this.dirtyFlags&=-17,this.rootEffectScheduler.flush()),this.dirtyFlags&7){let e=!!(this.dirtyFlags&1);this.dirtyFlags&=-8,this.dirtyFlags|=8;for(let{_lView:r,notifyErrorHandler:o}of this.allViews)JX(r,o,e,this.zonelessEnabled);if(this.dirtyFlags&=-5,this.syncDirtyFlagsWithViews(),this.dirtyFlags&23)return}else this._rendererFactory?.begin?.(),this._rendererFactory?.end?.();this.dirtyFlags&8&&(this.dirtyFlags&=-9,this.afterRenderManager.execute()),this.syncDirtyFlagsWithViews()}syncDirtyFlagsWithViews(){if(this.allViews.some(({_lView:e})=>u0(e))){this.dirtyFlags|=2;return}else this.dirtyFlags&=-8}attachView(e){let r=e;this._views.push(r),r.attachToAppRef(this)}detachView(e){let r=e;Tx(this._views,r),r.detachFromAppRef()}_loadComponent(e){this.attachView(e.hostView),this.tick(),this.components.push(e),this._injector.get(_0,[]).forEach(o=>o(e))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(e=>e()),this._views.slice().forEach(e=>e.destroy())}finally{this._destroyed=!0,this._views=[],this._destroyListeners=[]}}onDestroy(e){return this._destroyListeners.push(e),()=>Tx(this._destroyListeners,e)}destroy(){if(this._destroyed)throw new De(406,!1);let e=this._injector;e.destroy&&!e.destroyed&&e.destroy()}get viewCount(){return this._views.length}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function Tx(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function JX(t,n,e,r){if(!e&&!u0(t))return;bO(t,n,e&&!r?0:1)}function Dp(t,n,e,r){let o=_t(),i=d0();if(Is(o,i,n)){let s=Hn(),a=f0();k7(a,o,t,n,e,r)}return Dp}function PO(t,n,e,r){return Is(t,d0(),e)?n+bs(e)+r:zr}function eY(t,n,e,r,o,i){let s=p2(),a=JI(t,s,e,o);return p0(2),a?n+bs(e)+r+bs(o)+i:zr}function tY(t,n,e,r,o,i,s,a){let l=p2(),c=kO(t,l,e,o,s);return p0(3),c?n+bs(e)+r+bs(o)+i+bs(s)+a:zr}function Cx(t,n){return t<<17|n<<2}function bu(t){return t>>17&32767}function nY(t){return(t&2)==2}function rY(t,n){return t&131071|n<<17}function nI(t){return t|2}function Cp(t){return(t&131068)>>2}function S_(t,n){return t&-131069|n<<2}function oY(t){return(t&1)===1}function rI(t){return t|1}function iY(t,n,e,r,o,i){let s=i?n.classBindings:n.styleBindings,a=bu(s),l=Cp(s);t[r]=e;let c=!1,u;if(Array.isArray(e)){let d=e;u=d[1],(u===null||gh(d,u)>0)&&(c=!0)}else u=e;if(o)if(l!==0){let p=bu(t[a+1]);t[r+1]=Cx(p,a),p!==0&&(t[p+1]=S_(t[p+1],r)),t[a+1]=rY(t[a+1],r)}else t[r+1]=Cx(a,0),a!==0&&(t[a+1]=S_(t[a+1],r)),a=r;else t[r+1]=Cx(l,0),a===0?a=r:t[l+1]=S_(t[l+1],r),l=r;c&&(t[r+1]=nI(t[r+1])),vR(t,u,r,!0),vR(t,u,r,!1),sY(n,u,t,r,i),s=Cx(a,l),i?n.classBindings=s:n.styleBindings=s}function sY(t,n,e,r,o){let i=o?t.residualClasses:t.residualStyles;i!=null&&typeof n=="string"&&gh(i,n)>=0&&(e[r+1]=rI(e[r+1]))}function vR(t,n,e,r){let o=t[e+1],i=n===null,s=r?bu(o):Cp(o),a=!1;for(;s!==0&&(a===!1||i);){let l=t[s],c=t[s+1];aY(l,n)&&(a=!0,t[s+1]=r?rI(c):nI(c)),s=r?bu(c):Cp(c)}a&&(t[e+1]=r?nI(o):rI(o))}function aY(t,n){return t===null||n==null||(Array.isArray(t)?t[1]:t)===n?!0:Array.isArray(t)&&typeof n=="string"?gh(t,n)>=0:!1}var ci={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function lY(t){return t.substring(ci.key,ci.keyEnd)}function cY(t){return uY(t),$O(t,LO(t,0,ci.textEnd))}function $O(t,n){let e=ci.textEnd;return e===n?-1:(n=ci.keyEnd=dY(t,ci.key=n,e),LO(t,n,e))}function uY(t){ci.key=0,ci.keyEnd=0,ci.value=0,ci.valueEnd=0,ci.textEnd=t.length}function LO(t,n,e){for(;n<e&&t.charCodeAt(n)<=32;)n++;return n}function dY(t,n,e){for(;n<e&&t.charCodeAt(n)>32;)n++;return n}function W(t,n,e){let r=_t(),o=d0();if(Is(r,o,n)){let i=Hn(),s=f0();UI(i,s,r,t,n,r[gn],e,!1)}return W}function oI(t,n,e,r,o){let i=n.inputs,s=o?"class":"style";WI(t,e,i[s],s,r)}function Np(t,n,e){return BO(t,n,e,!1),Np}function zi(t,n){return BO(t,n,null,!0),zi}function VO(t){fY(vY,pY,t,!0)}function pY(t,n){for(let e=cY(n);e>=0;e=$O(n,e))yI(t,lY(n),!0)}function BO(t,n,e,r){let o=_t(),i=Hn(),s=p0(2);if(i.firstUpdatePass&&UO(i,t,s,r),n!==zr&&Is(o,s,n)){let a=i.data[ks()];jO(i,a,o,o[gn],t,o[s+1]=wY(n,e),r,s)}}function fY(t,n,e,r){let o=Hn(),i=p0(2);o.firstUpdatePass&&UO(o,null,i,r);let s=_t();if(e!==zr&&Is(s,i,e)){let a=o.data[ks()];if(GO(a,r)&&!zO(o,i)){let l=r?a.classesWithoutHost:a.stylesWithoutHost;l!==null&&(e=D_(l,e||"")),oI(o,a,s,e,r)}else bY(o,a,s,s[gn],s[i+1],s[i+1]=xY(t,n,e),r,i)}}function zO(t,n){return n>=t.expandoStartIndex}function UO(t,n,e,r){let o=t.data;if(o[e+1]===null){let i=o[ks()],s=zO(t,e);GO(i,r)&&n===null&&!s&&(n=!1),n=mY(o,i,n,r),iY(o,i,n,e,s,r)}}function mY(t,n,e,r){let o=HK(t),i=r?n.residualClasses:n.residualStyles;if(o===null)(r?n.classBindings:n.styleBindings)===0&&(e=__(null,t,n,e,r),e=mh(e,n.attrs,r),i=null);else{let s=n.directiveStylingLast;if(s===-1||t[s]!==o)if(e=__(o,t,n,e,r),i===null){let l=hY(t,n,r);l!==void 0&&Array.isArray(l)&&(l=__(null,t,n,l[1],r),l=mh(l,n.attrs,r),gY(t,n,r,l))}else i=yY(t,n,r)}return i!==void 0&&(r?n.residualClasses=i:n.residualStyles=i),e}function hY(t,n,e){let r=e?n.classBindings:n.styleBindings;if(Cp(r)!==0)return t[bu(r)]}function gY(t,n,e,r){let o=e?n.classBindings:n.styleBindings;t[bu(o)]=r}function yY(t,n,e){let r,o=n.directiveEnd;for(let i=1+n.directiveStylingLast;i<o;i++){let s=t[i].hostAttrs;r=mh(r,s,e)}return mh(r,n.attrs,e)}function __(t,n,e,r,o){let i=null,s=e.directiveEnd,a=e.directiveStylingLast;for(a===-1?a=e.directiveStart:a++;a<s&&(i=n[a],r=mh(r,i.hostAttrs,o),i!==t);)a++;return t!==null&&(e.directiveStylingLast=a),r}function mh(t,n,e){let r=e?1:2,o=-1;if(n!==null)for(let i=0;i<n.length;i++){let s=n[i];typeof s=="number"?o=s:o===r&&(Array.isArray(t)||(t=t===void 0?[]:["",t]),yI(t,s,e?!0:n[++i]))}return t===void 0?null:t}function xY(t,n,e){if(e==null||e==="")return Vr;let r=[],o=Ep(e);if(Array.isArray(o))for(let i=0;i<o.length;i++)t(r,o[i],!0);else if(typeof o=="object")for(let i in o)o.hasOwnProperty(i)&&t(r,i,o[i]);else typeof o=="string"&&n(r,o);return r}function vY(t,n,e){let r=String(n);r!==""&&!r.includes(" ")&&yI(t,r,e)}function bY(t,n,e,r,o,i,s,a){o===zr&&(o=Vr);let l=0,c=0,u=0<o.length?o[0]:null,d=0<i.length?i[0]:null;for(;u!==null||d!==null;){let p=l<o.length?o[l+1]:void 0,f=c<i.length?i[c+1]:void 0,m=null,h;u===d?(l+=2,c+=2,p!==f&&(m=d,h=f)):d===null||u!==null&&u<d?(l+=2,m=u):(c+=2,m=d,h=f),m!==null&&jO(t,n,e,r,m,h,s,a),u=l<o.length?o[l]:null,d=c<i.length?i[c]:null}}function jO(t,n,e,r,o,i,s,a){if(!(n.type&3))return;let l=t.data,c=l[a+1],u=oY(c)?bR(l,n,e,o,Cp(c),s):void 0;if(!t0(u)){t0(i)||nY(c)&&(i=bR(l,null,e,o,a,s));let d=o2(ks(),e);Q7(r,s,d,o,i)}}function bR(t,n,e,r,o,i){let s=n===null,a;for(;o>0;){let l=t[o],c=Array.isArray(l),u=c?l[1]:l,d=u===null,p=e[o+1];p===zr&&(p=d?Vr:void 0);let f=d?g_(p,r):u===r?p:void 0;if(c&&!t0(f)&&(f=g_(l,r)),t0(f)&&(a=f,s))return a;let m=t[o+1];o=s?bu(m):Cp(m)}if(n!==null){let l=i?n.residualClasses:n.residualStyles;l!=null&&(a=g_(l,r))}return a}function t0(t){return t!==void 0}function wY(t,n){return t==null||t===""||(typeof n=="string"?t=t+n:typeof t=="object"&&(t=Sr(Ep(t)))),t}function GO(t,n){return(t.flags&(n?8:16))!==0}function CY(t,n,e,r,o,i){let s=n.consts,a=xp(s,o),l=vh(n,t,2,r,a);return jI(n,e,l,xp(s,i)),l.attrs!==null&&Qx(l,l.attrs,!1),l.mergedAttrs!==null&&Qx(l,l.mergedAttrs,!0),n.queries!==null&&n.queries.elementStart(n,l),l}function w(t,n,e,r){let o=_t(),i=Hn(),s=ko+t,a=o[gn],l=i.firstCreatePass?CY(s,i,o,n,e,r):i.data[s],c=SY(i,o,l,a,n,t);o[s]=c;let u=c0(l);return Cu(l,!0),nO(a,c,l),!pO(l)&&m0()&&w0(i,o,c,l),FK()===0&&Su(c,o),PK(),u&&(VI(i,o,l),FI(i,l,o)),r!==null&&BI(o,l),w}function x(){let t=Ir();SI()?u2():(t=t.parent,Cu(t,!1));let n=t;VK(n)&&BK(),$K();let e=Hn();return e.firstCreatePass&&(g0(e,t),bI(t)&&e.queries.elementEnd(t)),n.classesWithoutHost!=null&&JK(n)&&oI(e,n,_t(),n.classesWithoutHost,!0),n.stylesWithoutHost!=null&&e9(n)&&oI(e,n,_t(),n.stylesWithoutHost,!1),x}function j(t,n,e,r){return w(t,n,e,r),x(),j}var SY=(t,n,e,r,o,i)=>(h0(!0),eO(r,o,XK()));function _Y(t,n,e,r,o){let i=n.consts,s=xp(i,r),a=vh(n,t,8,"ng-container",s);s!==null&&Qx(a,s,!0);let l=xp(i,o);return jI(n,e,a,l),n.queries!==null&&n.queries.elementStart(n,a),a}function Os(t,n,e){let r=_t(),o=Hn(),i=t+ko,s=o.firstCreatePass?_Y(i,o,r,n,e):o.data[i];Cu(s,!0);let a=IY(o,r,s,t);return r[i]=a,m0()&&w0(o,r,a,s),Su(a,r),c0(s)&&(VI(o,r,s),FI(o,s,r)),e!=null&&BI(r,s),Os}function Ms(){let t=Ir(),n=Hn();return SI()?u2():(t=t.parent,Cu(t,!1)),n.firstCreatePass&&(g0(n,t),bI(t)&&n.queries.elementEnd(t)),Ms}var IY=(t,n,e,r)=>(h0(!0),i7(n[gn],""));function mt(){return _t()}var lu=void 0;function EY(t){let n=t,e=Math.floor(Math.abs(t)),r=t.toString().replace(/^[^.]*\.?/,"").length;return e===1&&r===0?1:5}var TY=["en",[["a","p"],["AM","PM"],lu],[["AM","PM"],lu,lu],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],lu,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],lu,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",lu,"{1} 'at' {0}",lu],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",EY],I_={};function Mo(t){let n=DY(t),e=wR(n);if(e)return e;let r=n.split("-")[0];if(e=wR(r),e)return e;if(r==="en")return TY;throw new De(701,!1)}function wR(t){return t in I_||(I_[t]=cu.ng&&cu.ng.common&&cu.ng.common.locales&&cu.ng.common.locales[t]),I_[t]}var wn=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}(wn||{});function DY(t){return t.toLowerCase().replace(/_/g,"-")}var n0="en-US";var NY=n0;function kY(t){typeof t=="string"&&(NY=t.toLowerCase().replace(/_/g,"-"))}var AY=(t,n,e)=>{};function fe(t,n,e,r){let o=_t(),i=Hn(),s=Ir();return WO(i,o,o[gn],s,t,n,r),fe}function RY(t,n,e,r){let o=t.cleanup;if(o!=null)for(let i=0;i<o.length-1;i+=2){let s=o[i];if(s===e&&o[i+1]===r){let a=n[Mx],l=o[i+2];return a.length>l?a[l]:null}typeof s=="string"&&(i+=2)}return null}function WO(t,n,e,r,o,i,s){let a=c0(r),c=t.firstCreatePass&&MK(t),u=n[No],d=OK(n),p=!0;if(r.type&3||s){let h=fi(r,n),g=s?s(h):h,y=d.length,v=s?C=>s(Li(C[r.index])):r.index,S=null;if(!s&&a&&(S=RY(t,n,o,r.index)),S!==null){let C=S.__ngLastListenerFn__||S;C.__ngNextListenerFn__=i,S.__ngLastListenerFn__=i,p=!1}else{i=SR(r,n,u,i),AY(h,o,i);let C=e.listen(g,o,i);d.push(i,C),c&&c.push(o,v,y,y+1)}}else i=SR(r,n,u,i);let f=r.outputs,m;if(p&&f!==null&&(m=f[o])){let h=m.length;if(h)for(let g=0;g<h;g+=2){let y=m[g],v=m[g+1],I=n[y][v].subscribe(i),E=d.length;d.push(i,I),c&&c.push(o,r.index,E,-(E+1))}}}function CR(t,n,e,r){let o=bt(null);try{return To(6,n,e),e(r)!==!1}catch(i){return dO(t,i),!1}finally{To(7,n,e),bt(o)}}function SR(t,n,e,r){return function o(i){if(i===Function)return r;let s=wu(t)?Vi(t.index,n):n;YI(s,5);let a=CR(n,e,r,i),l=o.__ngNextListenerFn__;for(;l;)a=CR(n,e,l,i)&&a,l=l.__ngNextListenerFn__;return a}}function re(t=1){return KK(t)}function I0(t,n,e){return HO(t,"",n,"",e),I0}function HO(t,n,e,r,o){let i=_t(),s=PO(i,n,e,r);if(s!==zr){let a=Hn(),l=f0();UI(a,l,i,t,s,i[gn],o,!1)}return HO}function OY(t,n,e,r){e>=t.data.length&&(t.data[e]=null,t.blueprint[e]=null),n[e]=r}function _(t,n=""){let e=_t(),r=Hn(),o=t+ko,i=r.firstCreatePass?vh(r,o,1,n,null):r.data[o],s=MY(r,e,i,n,t);e[o]=s,m0()&&w0(r,e,s,i),Cu(i,!1)}var MY=(t,n,e,r,o)=>(h0(!0),r7(n[gn],r));function At(t){return Ge("",t,""),At}function Ge(t,n,e){let r=_t(),o=PO(r,t,n,e);return o!==zr&&tE(r,ks(),o),Ge}function bh(t,n,e,r,o){let i=_t(),s=eY(i,t,n,e,r,o);return s!==zr&&tE(i,ks(),s),bh}function wh(t,n,e,r,o,i,s){let a=_t(),l=tY(a,t,n,e,r,o,i,s);return l!==zr&&tE(a,ks(),l),wh}function tE(t,n,e){let r=o2(n,t);o7(t[gn],r,e)}function Ur(t,n,e){$2(n)&&(n=n());let r=_t(),o=d0();if(Is(r,o,n)){let i=Hn(),s=f0();UI(i,s,r,t,n,r[gn],e,!1)}return Ur}function co(t,n){let e=$2(t);return e&&t.set(n),e}function jr(t,n){let e=_t(),r=Hn(),o=Ir();return WO(r,e,e[gn],o,t,n),jr}function FY(t,n,e){let r=Hn();if(r.firstCreatePass){let o=Cs(t);iI(e,r.data,r.blueprint,o,!0),iI(n,r.data,r.blueprint,o,!1)}}function iI(t,n,e,r,o){if(t=Cr(t),Array.isArray(t))for(let i=0;i<t.length;i++)iI(t[i],n,e,r,o);else{let i=Hn(),s=_t(),a=Ir(),l=hp(t)?t:Cr(t.provide),c=XR(t),u=a.providerIndexes&1048575,d=a.directiveStart,p=a.providerIndexes>>20;if(hp(t)||!t.multi){let f=new yu(c,o,oe),m=T_(l,n,o?u:u+p,d);m===-1?(z_(Ux(a,s),i,l),E_(i,t,n.length),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(f),s.push(f)):(e[m]=f,s[m]=f)}else{let f=T_(l,n,u+p,d),m=T_(l,n,u,u+p),h=f>=0&&e[f],g=m>=0&&e[m];if(o&&!g||!o&&!h){z_(Ux(a,s),i,l);let y=LY(o?$Y:PY,e.length,o,r,c);!o&&g&&(e[m].providerFactory=y),E_(i,t,n.length,0),n.push(l),a.directiveStart++,a.directiveEnd++,o&&(a.providerIndexes+=1048576),e.push(y),s.push(y)}else{let y=qO(e[o?m:f],c,!o&&r);E_(i,t,f>-1?f:m,y)}!o&&r&&g&&e[m].componentProviders++}}}function E_(t,n,e,r){let o=hp(n),i=gK(n);if(o||i){let l=(i?Cr(n.useClass):n).prototype.ngOnDestroy;if(l){let c=t.destroyHooks||(t.destroyHooks=[]);if(!o&&n.multi){let u=c.indexOf(e);u===-1?c.push(e,[r,l]):c[u+1].push(r,l)}else c.push(e,l)}}}function qO(t,n,e){return e&&t.componentProviders++,t.multi.push(n)-1}function T_(t,n,e,r){for(let o=e;o<r;o++)if(n[o]===t)return o;return-1}function PY(t,n,e,r){return sI(this.multi,[])}function $Y(t,n,e,r){let o=this.multi,i;if(this.providerFactory){let s=this.providerFactory.componentProviders,a=jx(e,e[St],this.providerFactory.index,r);i=a.slice(0,s),sI(o,i);for(let l=s;l<a.length;l++)i.push(a[l])}else i=[],sI(o,i);return i}function sI(t,n){for(let e=0;e<t.length;e++){let r=t[e];n.push(r())}return n}function LY(t,n,e,r,o){let i=new yu(t,e,oe);return i.multi=[],i.index=n,i.componentProviders=0,qO(i,o,r&&!e),i}function Er(t,n=[]){return e=>{e.providersResolver=(r,o)=>FY(r,o?o(t):t,n)}}function Ui(t,n,e,r,o){return XO(_t(),_I(),t,n,e,r,o)}function wl(t,n,e,r,o,i){return VY(_t(),_I(),t,n,e,r,o,i)}function KO(t,n){let e=t[n];return e===zr?void 0:e}function XO(t,n,e,r,o,i,s){let a=n+e;return JI(t,a,o,i)?NO(t,a+2,s?r.call(s,o,i):r(o,i)):KO(t,a+2)}function VY(t,n,e,r,o,i,s,a){let l=n+e;return kO(t,l,o,i,s)?NO(t,l+3,a?r.call(a,o,i,s):r(o,i,s)):KO(t,l+3)}function Fs(t,n){let e=Hn(),r,o=t+ko;e.firstCreatePass?(r=BY(n,e.pipeRegistry),e.data[o]=r,r.onDestroy&&(e.destroyHooks??=[]).push(o,r.onDestroy)):r=e.data[o];let i=r.factory||(r.factory=du(r.type,!0)),s,a=Lr(oe);try{let l=zx(!1),c=i();return zx(l),OY(e,_t(),o,c),c}finally{Lr(a)}}function BY(t,n){if(n)for(let e=n.length-1;e>=0;e--){let r=n[e];if(t===r.name)return r}}function Ps(t,n,e,r){let o=t+ko,i=_t(),s=NK(i,o);return zY(i,o)?XO(i,_I(),n,s.transform,e,r,s):s.transform(e,r)}function zY(t,n){return t[St].data[n].pure}var aI=class{ngModuleFactory;componentFactories;constructor(n,e){this.ngModuleFactory=n,this.componentFactories=e}},nE=(()=>{class t{compileModuleSync(e){return new tI(e)}compileModuleAsync(e){return Promise.resolve(this.compileModuleSync(e))}compileModuleAndAllComponentsSync(e){let r=this.compileModuleSync(e),o=UR(e),i=Z2(o.declarations).reduce((s,a)=>{let l=pu(a);return l&&s.push(new ph(l)),s},[]);return new aI(r,i)}compileModuleAndAllComponentsAsync(e){return Promise.resolve(this.compileModuleAndAllComponentsSync(e))}clearCache(){}clearCacheFor(e){}getModuleId(e){}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var UY=(()=>{class t{zone=de(En);changeDetectionScheduler=de(xu);applicationRef=de(Es);_onMicrotaskEmptySubscription;initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.changeDetectionScheduler.runningTick||this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function jY({ngZoneFactory:t,ignoreChangesOutsideZone:n,scheduleInRootZone:e}){return t??=()=>new En(Ze(he({},GY()),{scheduleInRootZone:e})),[{provide:En,useFactory:t},{provide:mp,multi:!0,useFactory:()=>{let r=de(UY,{optional:!0});return()=>r.initialize()}},{provide:mp,multi:!0,useFactory:()=>{let r=de(WY);return()=>{r.initialize()}}},n===!0?{provide:O2,useValue:!0}:[],{provide:NI,useValue:e??R2}]}function GY(t){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:t?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:t?.runCoalescing??!1}}var WY=(()=>{class t{subscription=new _n;initialized=!1;zone=de(En);pendingTasks=de(As);initialize(){if(this.initialized)return;this.initialized=!0;let e=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(e=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{En.assertNotInAngularZone(),queueMicrotask(()=>{e!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(e),e=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{En.assertInAngularZone(),e??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var YO=(()=>{class t{appRef=de(Es);taskService=de(As);ngZone=de(En);zonelessEnabled=de(y0);tracing=de(v0,{optional:!0});disableScheduling=de(O2,{optional:!0})??!1;zoneIsDefined=typeof Zone<"u"&&!!Zone.root.run;schedulerTickApplyArgs=[{data:{__scheduler_tick__:!0}}];subscriptions=new _n;angularZoneId=this.zoneIsDefined?this.ngZone._inner?.get(Wx):null;scheduleInRootZone=!this.zonelessEnabled&&this.zoneIsDefined&&(de(NI,{optional:!0})??!1);cancelScheduledCallback=null;useMicrotaskScheduler=!1;runningTick=!1;pendingRenderTaskId=null;constructor(){this.subscriptions.add(this.appRef.afterTick.subscribe(()=>{this.runningTick||this.cleanup()})),this.subscriptions.add(this.ngZone.onUnstable.subscribe(()=>{this.runningTick||this.cleanup()})),this.disableScheduling||=!this.zonelessEnabled&&(this.ngZone instanceof Hx||!this.zoneIsDefined)}notify(e){if(!this.zonelessEnabled&&e===5)return;let r=!1;switch(e){case 0:{this.appRef.dirtyFlags|=2;break}case 3:case 2:case 4:case 5:case 1:{this.appRef.dirtyFlags|=4;break}case 8:{this.appRef.deferredDirtyFlags|=8;break}case 6:{this.appRef.dirtyFlags|=2,r=!0;break}case 13:{this.appRef.dirtyFlags|=16,r=!0;break}case 14:{this.appRef.dirtyFlags|=2,r=!0;break}case 12:{r=!0;break}case 10:case 9:case 7:case 11:default:this.appRef.dirtyFlags|=8}if(this.appRef.tracingSnapshot=this.tracing?.snapshot(this.appRef.tracingSnapshot)??null,!this.shouldScheduleTick(r))return;let o=this.useMicrotaskScheduler?tR:M2;this.pendingRenderTaskId=this.taskService.add(),this.scheduleInRootZone?this.cancelScheduledCallback=Zone.root.run(()=>o(()=>this.tick())):this.cancelScheduledCallback=this.ngZone.runOutsideAngular(()=>o(()=>this.tick()))}shouldScheduleTick(e){return!(this.disableScheduling&&!e||this.appRef.destroyed||this.pendingRenderTaskId!==null||this.runningTick||this.appRef._runningTick||!this.zonelessEnabled&&this.zoneIsDefined&&Zone.current.get(Wx+this.angularZoneId))}tick(){if(this.runningTick||this.appRef.destroyed)return;if(this.appRef.dirtyFlags===0){this.cleanup();return}!this.zonelessEnabled&&this.appRef.dirtyFlags&7&&(this.appRef.dirtyFlags|=1);let e=this.taskService.add();try{this.ngZone.run(()=>{this.runningTick=!0,this.appRef._tick()},void 0,this.schedulerTickApplyArgs)}catch(r){throw this.taskService.remove(e),r}finally{this.cleanup()}this.useMicrotaskScheduler=!0,tR(()=>{this.useMicrotaskScheduler=!1,this.taskService.remove(e)})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.cleanup()}cleanup(){if(this.runningTick=!1,this.cancelScheduledCallback?.(),this.cancelScheduledCallback=null,this.pendingRenderTaskId!==null){let e=this.pendingRenderTaskId;this.pendingRenderTaskId=null,this.taskService.remove(e)}}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function QO(){return bl("NgZoneless"),Sp([{provide:xu,useExisting:YO},{provide:En,useClass:Hx},{provide:y0,useValue:!0},{provide:NI,useValue:!1},[]])}function HY(){return typeof $localize<"u"&&$localize.locale||n0}var E0=new Me("",{providedIn:"root",factory:()=>de(E0,st.Optional|st.SkipSelf)||HY()});var lI=new Me(""),qY=new Me("");function rh(t){return!t.moduleRef}function KY(t){let n=rh(t)?t.r3Injector:t.moduleRef.injector,e=n.get(En);return e.run(()=>{rh(t)?t.r3Injector.resolveInjectorInitializers():t.moduleRef.resolveInjectorInitializers();let r=n.get(Ss,null),o;if(e.runOutsideAngular(()=>{o=e.onError.subscribe({next:i=>{r.handleError(i)}})}),rh(t)){let i=()=>n.destroy(),s=t.platformInjector.get(lI);s.add(i),n.onDestroy(()=>{o.unsubscribe(),s.delete(i)})}else{let i=()=>t.moduleRef.destroy(),s=t.platformInjector.get(lI);s.add(i),t.moduleRef.onDestroy(()=>{Tx(t.allPlatformModules,t.moduleRef),o.unsubscribe(),s.delete(i)})}return ZX(r,e,()=>{let i=n.get(MO);return i.runInitializers(),i.donePromise.then(()=>{let s=n.get(E0,n0);if(kY(s||n0),!n.get(qY,!0))return rh(t)?n.get(Es):(t.allPlatformModules.push(t.moduleRef),t.moduleRef);if(rh(t)){let l=n.get(Es);return t.rootComponent!==void 0&&l.bootstrap(t.rootComponent),l}else return XY(t.moduleRef,t.allPlatformModules),t.moduleRef})})})}function XY(t,n){let e=t.injector.get(Es);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>e.bootstrap(r));else if(t.instance.ngDoBootstrap)t.instance.ngDoBootstrap(e);else throw new De(-403,!1);n.push(t)}var Dx=null;function YY(t=[],n){return Wn.create({name:n,providers:[{provide:a0,useValue:"platform"},{provide:lI,useValue:new Set([()=>Dx=null])},...t]})}function QY(t=[]){if(Dx)return Dx;let n=YY(t);return Dx=n,XX(),ZY(n),n}function ZY(t){let n=t.get(OI,null);rr(t,()=>{n?.forEach(e=>e())})}var Ut=(()=>{class t{static __NG_ELEMENT_ID__=JY}return t})();function JY(t){return eQ(Ir(),_t(),(t&16)===16)}function eQ(t,n,e){if(wu(t)&&!e){let r=Vi(t.index,n);return new vu(r,r)}else if(t.type&175){let r=n[$i];return new vu(r,n)}return null}var cI=class{constructor(){}supports(n){return DO(n)}create(n){return new uI(n)}},tQ=(t,n)=>n,uI=class{length=0;collection;_linkedRecords=null;_unlinkedRecords=null;_previousItHead=null;_itHead=null;_itTail=null;_additionsHead=null;_additionsTail=null;_movesHead=null;_movesTail=null;_removalsHead=null;_removalsTail=null;_identityChangesHead=null;_identityChangesTail=null;_trackByFn;constructor(n){this._trackByFn=n||tQ}forEachItem(n){let e;for(e=this._itHead;e!==null;e=e._next)n(e)}forEachOperation(n){let e=this._itHead,r=this._removalsHead,o=0,i=null;for(;e||r;){let s=!r||e&&e.currentIndex<_R(r,o,i)?e:r,a=_R(s,o,i),l=s.currentIndex;if(s===r)o--,r=r._nextRemoved;else if(e=e._next,s.previousIndex==null)o++;else{i||(i=[]);let c=a-o,u=l-o;if(c!=u){for(let p=0;p<c;p++){let f=p<i.length?i[p]:i[p]=0,m=f+p;u<=m&&m<c&&(i[p]=f+1)}let d=s.previousIndex;i[d]=u-c}}a!==l&&n(s,a,l)}}forEachPreviousItem(n){let e;for(e=this._previousItHead;e!==null;e=e._nextPrevious)n(e)}forEachAddedItem(n){let e;for(e=this._additionsHead;e!==null;e=e._nextAdded)n(e)}forEachMovedItem(n){let e;for(e=this._movesHead;e!==null;e=e._nextMoved)n(e)}forEachRemovedItem(n){let e;for(e=this._removalsHead;e!==null;e=e._nextRemoved)n(e)}forEachIdentityChange(n){let e;for(e=this._identityChangesHead;e!==null;e=e._nextIdentityChange)n(e)}diff(n){if(n==null&&(n=[]),!DO(n))throw new De(900,!1);return this.check(n)?this:null}onDestroy(){}check(n){this._reset();let e=this._itHead,r=!1,o,i,s;if(Array.isArray(n)){this.length=n.length;for(let a=0;a<this.length;a++)i=n[a],s=this._trackByFn(a,i),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,i,s,a),r=!0):(r&&(e=this._verifyReinsertion(e,i,s,a)),Object.is(e.item,i)||this._addIdentityChange(e,i)),e=e._next}else o=0,jX(n,a=>{s=this._trackByFn(o,a),e===null||!Object.is(e.trackById,s)?(e=this._mismatch(e,a,s,o),r=!0):(r&&(e=this._verifyReinsertion(e,a,s,o)),Object.is(e.item,a)||this._addIdentityChange(e,a)),e=e._next,o++}),this.length=o;return this._truncate(e),this.collection=n,this.isDirty}get isDirty(){return this._additionsHead!==null||this._movesHead!==null||this._removalsHead!==null||this._identityChangesHead!==null}_reset(){if(this.isDirty){let n;for(n=this._previousItHead=this._itHead;n!==null;n=n._next)n._nextPrevious=n._next;for(n=this._additionsHead;n!==null;n=n._nextAdded)n.previousIndex=n.currentIndex;for(this._additionsHead=this._additionsTail=null,n=this._movesHead;n!==null;n=n._nextMoved)n.previousIndex=n.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(n,e,r,o){let i;return n===null?i=this._itTail:(i=n._prev,this._remove(n)),n=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._reinsertAfter(n,i,o)):(n=this._linkedRecords===null?null:this._linkedRecords.get(r,o),n!==null?(Object.is(n.item,e)||this._addIdentityChange(n,e),this._moveAfter(n,i,o)):n=this._addAfter(new dI(e,r),i,o)),n}_verifyReinsertion(n,e,r,o){let i=this._unlinkedRecords===null?null:this._unlinkedRecords.get(r,null);return i!==null?n=this._reinsertAfter(i,n._prev,o):n.currentIndex!=o&&(n.currentIndex=o,this._addToMoves(n,o)),n}_truncate(n){for(;n!==null;){let e=n._next;this._addToRemovals(this._unlink(n)),n=e}this._unlinkedRecords!==null&&this._unlinkedRecords.clear(),this._additionsTail!==null&&(this._additionsTail._nextAdded=null),this._movesTail!==null&&(this._movesTail._nextMoved=null),this._itTail!==null&&(this._itTail._next=null),this._removalsTail!==null&&(this._removalsTail._nextRemoved=null),this._identityChangesTail!==null&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(n,e,r){this._unlinkedRecords!==null&&this._unlinkedRecords.remove(n);let o=n._prevRemoved,i=n._nextRemoved;return o===null?this._removalsHead=i:o._nextRemoved=i,i===null?this._removalsTail=o:i._prevRemoved=o,this._insertAfter(n,e,r),this._addToMoves(n,r),n}_moveAfter(n,e,r){return this._unlink(n),this._insertAfter(n,e,r),this._addToMoves(n,r),n}_addAfter(n,e,r){return this._insertAfter(n,e,r),this._additionsTail===null?this._additionsTail=this._additionsHead=n:this._additionsTail=this._additionsTail._nextAdded=n,n}_insertAfter(n,e,r){let o=e===null?this._itHead:e._next;return n._next=o,n._prev=e,o===null?this._itTail=n:o._prev=n,e===null?this._itHead=n:e._next=n,this._linkedRecords===null&&(this._linkedRecords=new r0),this._linkedRecords.put(n),n.currentIndex=r,n}_remove(n){return this._addToRemovals(this._unlink(n))}_unlink(n){this._linkedRecords!==null&&this._linkedRecords.remove(n);let e=n._prev,r=n._next;return e===null?this._itHead=r:e._next=r,r===null?this._itTail=e:r._prev=e,n}_addToMoves(n,e){return n.previousIndex===e||(this._movesTail===null?this._movesTail=this._movesHead=n:this._movesTail=this._movesTail._nextMoved=n),n}_addToRemovals(n){return this._unlinkedRecords===null&&(this._unlinkedRecords=new r0),this._unlinkedRecords.put(n),n.currentIndex=null,n._nextRemoved=null,this._removalsTail===null?(this._removalsTail=this._removalsHead=n,n._prevRemoved=null):(n._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=n),n}_addIdentityChange(n,e){return n.item=e,this._identityChangesTail===null?this._identityChangesTail=this._identityChangesHead=n:this._identityChangesTail=this._identityChangesTail._nextIdentityChange=n,n}},dI=class{item;trackById;currentIndex=null;previousIndex=null;_nextPrevious=null;_prev=null;_next=null;_prevDup=null;_nextDup=null;_prevRemoved=null;_nextRemoved=null;_nextAdded=null;_nextMoved=null;_nextIdentityChange=null;constructor(n,e){this.item=n,this.trackById=e}},pI=class{_head=null;_tail=null;add(n){this._head===null?(this._head=this._tail=n,n._nextDup=null,n._prevDup=null):(this._tail._nextDup=n,n._prevDup=this._tail,n._nextDup=null,this._tail=n)}get(n,e){let r;for(r=this._head;r!==null;r=r._nextDup)if((e===null||e<=r.currentIndex)&&Object.is(r.trackById,n))return r;return null}remove(n){let e=n._prevDup,r=n._nextDup;return e===null?this._head=r:e._nextDup=r,r===null?this._tail=e:r._prevDup=e,this._head===null}},r0=class{map=new Map;put(n){let e=n.trackById,r=this.map.get(e);r||(r=new pI,this.map.set(e,r)),r.add(n)}get(n,e){let r=n,o=this.map.get(r);return o?o.get(n,e):null}remove(n){let e=n.trackById;return this.map.get(e).remove(n)&&this.map.delete(e),n}get isEmpty(){return this.map.size===0}clear(){this.map.clear()}};function _R(t,n,e){let r=t.previousIndex;if(r===null)return r;let o=0;return e&&r<e.length&&(o=e[r]),r+n+o}function IR(){return new rE([new cI])}var rE=(()=>{class t{factories;static \u0275prov=Re({token:t,providedIn:"root",factory:IR});constructor(e){this.factories=e}static create(e,r){if(r!=null){let o=r.factories.slice();e=e.concat(o)}return new t(e)}static extend(e){return{provide:t,useFactory:r=>t.create(e,r||IR()),deps:[[t,new cK,new LR]]}}find(e){let r=this.factories.find(o=>o.supports(e));if(r!=null)return r;throw new De(901,!1)}}return t})();function ZO(t){try{let{rootComponent:n,appProviders:e,platformProviders:r}=t,o=QY(r),i=[jY({}),{provide:xu,useExisting:YO},...e||[]],s=new Jx({providers:i,parent:o,debugName:"",runEnvironmentInitializers:!1});return KY({r3Injector:s.injector,platformInjector:o,rootComponent:n})}catch(n){return Promise.reject(n)}}function Iu(t){return typeof t=="boolean"?t:t!=null&&t!=="false"}function Cl(t,n){bl("NgSignals");let e=pA(t);return n?.equal&&(e[Fr].equal=n.equal),e}function ji(t){let n=bt(null);try{return t()}finally{bt(n)}}var JO=(()=>{class t{view;node;constructor(e,r){this.view=e,this.node=r}static __NG_ELEMENT_ID__=nQ}return t})();function nQ(){return new JO(_t(),Ir())}var rQ=!1,oQ=(()=>{class t extends e0{pendingTasks=de(As);taskId=null;schedule(e){super.schedule(e),this.taskId===null&&(this.taskId=this.pendingTasks.add(),queueMicrotask(()=>this.flush()))}flush(){try{super.flush()}finally{this.taskId!==null&&(this.pendingTasks.remove(this.taskId),this.taskId=null)}}static \u0275prov=Re({token:t,providedIn:"root",factory:()=>new t})}return t})(),fI=class{scheduler;effectFn;zone;injector;unregisterOnDestroy;watcher;constructor(n,e,r,o,i,s){this.scheduler=n,this.effectFn=e,this.zone=r,this.injector=i,this.watcher=xA(a=>this.runEffect(a),()=>this.schedule(),s),this.unregisterOnDestroy=o?.onDestroy(()=>this.destroy())}runEffect(n){try{this.effectFn(n)}catch(e){this.injector.get(Ss,null,{optional:!0})?.handleError(e)}}run(){this.watcher.run()}schedule(){this.scheduler.schedule(this)}destroy(){this.watcher.destroy(),this.unregisterOnDestroy?.()}};function iQ(){}function sQ(t,n){bl("NgSignals"),!n?.injector&&QR(iQ);let e=n?.injector??de(Wn),r=n?.manualCleanup!==!0?e.get(Ip):null,o=new fI(e.get(oQ),t,typeof Zone>"u"?null:Zone.current,r,e,n?.allowSignalWrites??!1),i=e.get(Ut,null,{optional:!0});return!i||!(i._lView[Ke]&8)?o.watcher.notify():(i._lView[_x]??=[]).push(o.watcher.notify),o}var aQ=rQ;var mI=class{[Fr];constructor(n){this[Fr]=n}destroy(){this[Fr].destroy()}};function Ch(t,n){if(aQ)return sQ(t,n);bl("NgSignals"),!n?.injector&&QR(Ch);let e=n?.injector??de(Wn),r=n?.manualCleanup!==!0?e.get(Ip):null,o,i=e.get(JO,null,{optional:!0}),s=e.get(xu);return i!==null&&!n?.forceRoot?(o=uQ(i.view,s,t),r instanceof Gx&&r._lView===i.view&&(r=null)):o=dQ(t,e.get(FO),s),o.injector=e,r!==null&&(o.onDestroyFn=r.onDestroy(()=>o.destroy())),new mI(o)}var eM=Ze(he({},ru),{consumerIsAlwaysLive:!0,consumerAllowSignalWrites:!0,dirty:!0,hasRun:!1,cleanupFns:void 0,zone:null,kind:"effect",onDestroyFn:dh,run(){if(this.dirty=!1,this.hasRun&&!eh(this))return;this.hasRun=!0;let t=r=>(this.cleanupFns??=[]).push(r),n=Yd(this),e=Lx(!1);try{this.maybeCleanup(),this.fn(t)}finally{Lx(e),Jm(this,n)}},maybeCleanup(){if(this.cleanupFns?.length)try{for(;this.cleanupFns.length;)this.cleanupFns.pop()()}finally{this.cleanupFns=[]}}}),lQ=Ze(he({},eM),{consumerMarkedDirty(){this.scheduler.schedule(this),this.notifier.notify(13)},destroy(){Qd(this),this.onDestroyFn(),this.maybeCleanup(),this.scheduler.remove(this)}}),cQ=Ze(he({},eM),{consumerMarkedDirty(){this.view[Ke]|=8192,xh(this.view),this.notifier.notify(14)},destroy(){Qd(this),this.onDestroyFn(),this.maybeCleanup(),this.view[fu]?.delete(this)}});function uQ(t,n,e){let r=Object.create(cQ);return r.view=t,r.zone=typeof Zone<"u"?Zone.current:null,r.notifier=n,r.fn=e,t[fu]??=new Set,t[fu].add(r),r.consumerMarkedDirty(r),r}function dQ(t,n,e){let r=Object.create(lQ);return r.fn=t,r.scheduler=n,r.notifier=e,r.zone=typeof Zone<"u"?Zone.current:null,r.scheduler.schedule(r),r.notifier.notify(13),r}var aM=null;function Ls(){return aM}function lM(t){aM??=t}var F0=class{};var Gr=new Me(""),cM=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>de(pQ),providedIn:"platform"})}return t})();var pQ=(()=>{class t extends cM{_location;_history;_doc=de(Gr);constructor(){super(),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ls().getBaseHref(this._doc)}onPopState(e){let r=Ls().getGlobalEventTarget(this._doc,"window");return r.addEventListener("popstate",e,!1),()=>r.removeEventListener("popstate",e)}onHashChange(e){let r=Ls().getGlobalEventTarget(this._doc,"window");return r.addEventListener("hashchange",e,!1),()=>r.removeEventListener("hashchange",e)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(e){this._location.pathname=e}pushState(e,r,o){this._history.pushState(e,r,o)}replaceState(e,r,o){this._history.replaceState(e,r,o)}forward(){this._history.forward()}back(){this._history.back()}historyGo(e=0){this._history.go(e)}getState(){return this._history.state}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>new t,providedIn:"platform"})}return t})();function uM(t,n){return t?n?t.endsWith("/")?n.startsWith("/")?t+n.slice(1):t+n:n.startsWith("/")?t+n:`${t}/${n}`:t:n}function tM(t){let n=t.match(/#|\?|$/),e=n&&n.index||t.length,r=e-(t[e-1]==="/"?1:0);return t.slice(0,r)+t.slice(e)}function Eu(t){return t&&t[0]!=="?"?"?"+t:t}var Ap=(()=>{class t{historyGo(e){throw new Error("")}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>de(dM),providedIn:"root"})}return t})(),fQ=new Me(""),dM=(()=>{class t extends Ap{_platformLocation;_baseHref;_removeListenerFns=[];constructor(e,r){super(),this._platformLocation=e,this._baseHref=r??this._platformLocation.getBaseHrefFromDOM()??de(Gr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(e){this._removeListenerFns.push(this._platformLocation.onPopState(e),this._platformLocation.onHashChange(e))}getBaseHref(){return this._baseHref}prepareExternalUrl(e){return uM(this._baseHref,e)}path(e=!1){let r=this._platformLocation.pathname+Eu(this._platformLocation.search),o=this._platformLocation.hash;return o&&e?`${r}${o}`:r}pushState(e,r,o,i){let s=this.prepareExternalUrl(o+Eu(i));this._platformLocation.pushState(e,r,s)}replaceState(e,r,o,i){let s=this.prepareExternalUrl(o+Eu(i));this._platformLocation.replaceState(e,r,s)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(e=0){this._platformLocation.historyGo?.(e)}static \u0275fac=function(r){return new(r||t)($e(cM),$e(fQ,8))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var Sh=(()=>{class t{_subject=new Pn;_basePath;_locationStrategy;_urlChangeListeners=[];_urlChangeSubscription=null;constructor(e){this._locationStrategy=e;let r=this._locationStrategy.getBaseHref();this._basePath=gQ(tM(nM(r))),this._locationStrategy.onPopState(o=>{this._subject.next({url:this.path(!0),pop:!0,state:o.state,type:o.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(e=!1){return this.normalize(this._locationStrategy.path(e))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(e,r=""){return this.path()==this.normalize(e+Eu(r))}normalize(e){return t.stripTrailingSlash(hQ(this._basePath,nM(e)))}prepareExternalUrl(e){return e&&e[0]!=="/"&&(e="/"+e),this._locationStrategy.prepareExternalUrl(e)}go(e,r="",o=null){this._locationStrategy.pushState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Eu(r)),o)}replaceState(e,r="",o=null){this._locationStrategy.replaceState(o,"",e,r),this._notifyUrlChangeListeners(this.prepareExternalUrl(e+Eu(r)),o)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(e=0){this._locationStrategy.historyGo?.(e)}onUrlChange(e){return this._urlChangeListeners.push(e),this._urlChangeSubscription??=this.subscribe(r=>{this._notifyUrlChangeListeners(r.url,r.state)}),()=>{let r=this._urlChangeListeners.indexOf(e);this._urlChangeListeners.splice(r,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(e="",r){this._urlChangeListeners.forEach(o=>o(e,r))}subscribe(e,r,o){return this._subject.subscribe({next:e,error:r??void 0,complete:o??void 0})}static normalizeQueryParams=Eu;static joinWithSlash=uM;static stripTrailingSlash=tM;static \u0275fac=function(r){return new(r||t)($e(Ap))};static \u0275prov=Re({token:t,factory:()=>mQ(),providedIn:"root"})}return t})();function mQ(){return new Sh($e(Ap))}function hQ(t,n){if(!t||!n.startsWith(t))return n;let e=n.substring(t.length);return e===""||["/",";","?","#"].includes(e[0])?e:n}function nM(t){return t.replace(/\/index.html$/,"")}function gQ(t){if(new RegExp("^(https?:)?//").test(t)){let[,e]=t.split(/\/\/[^\/]+/);return e}return t}var Tr=function(t){return t[t.Format=0]="Format",t[t.Standalone=1]="Standalone",t}(Tr||{}),Yt=function(t){return t[t.Narrow=0]="Narrow",t[t.Abbreviated=1]="Abbreviated",t[t.Wide=2]="Wide",t[t.Short=3]="Short",t}(Yt||{}),uo=function(t){return t[t.Short=0]="Short",t[t.Medium=1]="Medium",t[t.Long=2]="Long",t[t.Full=3]="Full",t}(uo||{}),Sl={Decimal:0,Group:1,List:2,PercentSign:3,PlusSign:4,MinusSign:5,Exponential:6,SuperscriptingExponent:7,PerMille:8,Infinity:9,NaN:10,TimeSeparator:11,CurrencyDecimal:12,CurrencyGroup:13};function yQ(t){return Mo(t)[wn.LocaleId]}function xQ(t,n,e){let r=Mo(t),o=[r[wn.DayPeriodsFormat],r[wn.DayPeriodsStandalone]],i=Fo(o,n);return Fo(i,e)}function vQ(t,n,e){let r=Mo(t),o=[r[wn.DaysFormat],r[wn.DaysStandalone]],i=Fo(o,n);return Fo(i,e)}function bQ(t,n,e){let r=Mo(t),o=[r[wn.MonthsFormat],r[wn.MonthsStandalone]],i=Fo(o,n);return Fo(i,e)}function wQ(t,n){let r=Mo(t)[wn.Eras];return Fo(r,n)}function T0(t,n){let e=Mo(t);return Fo(e[wn.DateFormat],n)}function D0(t,n){let e=Mo(t);return Fo(e[wn.TimeFormat],n)}function N0(t,n){let r=Mo(t)[wn.DateTimeFormat];return Fo(r,n)}function $0(t,n){let e=Mo(t),r=e[wn.NumberSymbols][n];if(typeof r>"u"){if(n===Sl.CurrencyDecimal)return e[wn.NumberSymbols][Sl.Decimal];if(n===Sl.CurrencyGroup)return e[wn.NumberSymbols][Sl.Group]}return r}function pM(t){if(!t[wn.ExtraData])throw new Error(`Missing extra locale data for the locale "${t[wn.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function CQ(t){let n=Mo(t);return pM(n),(n[wn.ExtraData][2]||[]).map(r=>typeof r=="string"?oE(r):[oE(r[0]),oE(r[1])])}function SQ(t,n,e){let r=Mo(t);pM(r);let o=[r[wn.ExtraData][0],r[wn.ExtraData][1]],i=Fo(o,n)||[];return Fo(i,e)||[]}function Fo(t,n){for(let e=n;e>-1;e--)if(typeof t[e]<"u")return t[e];throw new Error("Locale data API: locale data undefined")}function oE(t){let[n,e]=t.split(":");return{hours:+n,minutes:+e}}var _Q=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,k0={},IQ=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/;function EQ(t,n,e,r){let o=FQ(t);n=$s(e,n)||n;let s=[],a;for(;n;)if(a=IQ.exec(n),a){s=s.concat(a.slice(1));let u=s.pop();if(!u)break;n=u}else{s.push(n);break}let l=o.getTimezoneOffset();r&&(l=mM(r,l),o=MQ(o,r,!0));let c="";return s.forEach(u=>{let d=RQ(u);c+=d?d(o,e,l):u==="''"?"'":u.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),c}function P0(t,n,e){let r=new Date(0);return r.setFullYear(t,n,e),r.setHours(0,0,0),r}function $s(t,n){let e=yQ(t);if(k0[e]??={},k0[e][n])return k0[e][n];let r="";switch(n){case"shortDate":r=T0(t,uo.Short);break;case"mediumDate":r=T0(t,uo.Medium);break;case"longDate":r=T0(t,uo.Long);break;case"fullDate":r=T0(t,uo.Full);break;case"shortTime":r=D0(t,uo.Short);break;case"mediumTime":r=D0(t,uo.Medium);break;case"longTime":r=D0(t,uo.Long);break;case"fullTime":r=D0(t,uo.Full);break;case"short":let o=$s(t,"shortTime"),i=$s(t,"shortDate");r=A0(N0(t,uo.Short),[o,i]);break;case"medium":let s=$s(t,"mediumTime"),a=$s(t,"mediumDate");r=A0(N0(t,uo.Medium),[s,a]);break;case"long":let l=$s(t,"longTime"),c=$s(t,"longDate");r=A0(N0(t,uo.Long),[l,c]);break;case"full":let u=$s(t,"fullTime"),d=$s(t,"fullDate");r=A0(N0(t,uo.Full),[u,d]);break}return r&&(k0[e][n]=r),r}function A0(t,n){return n&&(t=t.replace(/\{([^}]+)}/g,function(e,r){return n!=null&&r in n?n[r]:e})),t}function hi(t,n,e="-",r,o){let i="";(t<0||o&&t<=0)&&(o?t=-t+1:(t=-t,i=e));let s=String(t);for(;s.length<n;)s="0"+s;return r&&(s=s.slice(s.length-n)),i+s}function TQ(t,n){return hi(t,3).substring(0,n)}function Dn(t,n,e=0,r=!1,o=!1){return function(i,s){let a=DQ(t,i);if((e>0||a>-e)&&(a+=e),t===3)a===0&&e===-12&&(a=12);else if(t===6)return TQ(a,n);let l=$0(s,Sl.MinusSign);return hi(a,n,l,r,o)}}function DQ(t,n){switch(t){case 0:return n.getFullYear();case 1:return n.getMonth();case 2:return n.getDate();case 3:return n.getHours();case 4:return n.getMinutes();case 5:return n.getSeconds();case 6:return n.getMilliseconds();case 7:return n.getDay();default:throw new Error(`Unknown DateType value "${t}".`)}}function nn(t,n,e=Tr.Format,r=!1){return function(o,i){return NQ(o,i,t,n,e,r)}}function NQ(t,n,e,r,o,i){switch(e){case 2:return bQ(n,o,r)[t.getMonth()];case 1:return vQ(n,o,r)[t.getDay()];case 0:let s=t.getHours(),a=t.getMinutes();if(i){let c=CQ(n),u=SQ(n,o,r),d=c.findIndex(p=>{if(Array.isArray(p)){let[f,m]=p,h=s>=f.hours&&a>=f.minutes,g=s<m.hours||s===m.hours&&a<m.minutes;if(f.hours<m.hours){if(h&&g)return!0}else if(h||g)return!0}else if(p.hours===s&&p.minutes===a)return!0;return!1});if(d!==-1)return u[d]}return xQ(n,o,r)[s<12?0:1];case 3:return wQ(n,r)[t.getFullYear()<=0?0:1];default:let l=e;throw new Error(`unexpected translation type ${l}`)}}function R0(t){return function(n,e,r){let o=-1*r,i=$0(e,Sl.MinusSign),s=o>0?Math.floor(o/60):Math.ceil(o/60);switch(t){case 0:return(o>=0?"+":"")+hi(s,2,i)+hi(Math.abs(o%60),2,i);case 1:return"GMT"+(o>=0?"+":"")+hi(s,1,i);case 2:return"GMT"+(o>=0?"+":"")+hi(s,2,i)+":"+hi(Math.abs(o%60),2,i);case 3:return r===0?"Z":(o>=0?"+":"")+hi(s,2,i)+":"+hi(Math.abs(o%60),2,i);default:throw new Error(`Unknown zone width "${t}"`)}}}var kQ=0,M0=4;function AQ(t){let n=P0(t,kQ,1).getDay();return P0(t,0,1+(n<=M0?M0:M0+7)-n)}function fM(t){let n=t.getDay(),e=n===0?-3:M0-n;return P0(t.getFullYear(),t.getMonth(),t.getDate()+e)}function iE(t,n=!1){return function(e,r){let o;if(n){let i=new Date(e.getFullYear(),e.getMonth(),1).getDay()-1,s=e.getDate();o=1+Math.floor((s+i)/7)}else{let i=fM(e),s=AQ(i.getFullYear()),a=i.getTime()-s.getTime();o=1+Math.round(a/6048e5)}return hi(o,t,$0(r,Sl.MinusSign))}}function O0(t,n=!1){return function(e,r){let i=fM(e).getFullYear();return hi(i,t,$0(r,Sl.MinusSign),n)}}var sE={};function RQ(t){if(sE[t])return sE[t];let n;switch(t){case"G":case"GG":case"GGG":n=nn(3,Yt.Abbreviated);break;case"GGGG":n=nn(3,Yt.Wide);break;case"GGGGG":n=nn(3,Yt.Narrow);break;case"y":n=Dn(0,1,0,!1,!0);break;case"yy":n=Dn(0,2,0,!0,!0);break;case"yyy":n=Dn(0,3,0,!1,!0);break;case"yyyy":n=Dn(0,4,0,!1,!0);break;case"Y":n=O0(1);break;case"YY":n=O0(2,!0);break;case"YYY":n=O0(3);break;case"YYYY":n=O0(4);break;case"M":case"L":n=Dn(1,1,1);break;case"MM":case"LL":n=Dn(1,2,1);break;case"MMM":n=nn(2,Yt.Abbreviated);break;case"MMMM":n=nn(2,Yt.Wide);break;case"MMMMM":n=nn(2,Yt.Narrow);break;case"LLL":n=nn(2,Yt.Abbreviated,Tr.Standalone);break;case"LLLL":n=nn(2,Yt.Wide,Tr.Standalone);break;case"LLLLL":n=nn(2,Yt.Narrow,Tr.Standalone);break;case"w":n=iE(1);break;case"ww":n=iE(2);break;case"W":n=iE(1,!0);break;case"d":n=Dn(2,1);break;case"dd":n=Dn(2,2);break;case"c":case"cc":n=Dn(7,1);break;case"ccc":n=nn(1,Yt.Abbreviated,Tr.Standalone);break;case"cccc":n=nn(1,Yt.Wide,Tr.Standalone);break;case"ccccc":n=nn(1,Yt.Narrow,Tr.Standalone);break;case"cccccc":n=nn(1,Yt.Short,Tr.Standalone);break;case"E":case"EE":case"EEE":n=nn(1,Yt.Abbreviated);break;case"EEEE":n=nn(1,Yt.Wide);break;case"EEEEE":n=nn(1,Yt.Narrow);break;case"EEEEEE":n=nn(1,Yt.Short);break;case"a":case"aa":case"aaa":n=nn(0,Yt.Abbreviated);break;case"aaaa":n=nn(0,Yt.Wide);break;case"aaaaa":n=nn(0,Yt.Narrow);break;case"b":case"bb":case"bbb":n=nn(0,Yt.Abbreviated,Tr.Standalone,!0);break;case"bbbb":n=nn(0,Yt.Wide,Tr.Standalone,!0);break;case"bbbbb":n=nn(0,Yt.Narrow,Tr.Standalone,!0);break;case"B":case"BB":case"BBB":n=nn(0,Yt.Abbreviated,Tr.Format,!0);break;case"BBBB":n=nn(0,Yt.Wide,Tr.Format,!0);break;case"BBBBB":n=nn(0,Yt.Narrow,Tr.Format,!0);break;case"h":n=Dn(3,1,-12);break;case"hh":n=Dn(3,2,-12);break;case"H":n=Dn(3,1);break;case"HH":n=Dn(3,2);break;case"m":n=Dn(4,1);break;case"mm":n=Dn(4,2);break;case"s":n=Dn(5,1);break;case"ss":n=Dn(5,2);break;case"S":n=Dn(6,1);break;case"SS":n=Dn(6,2);break;case"SSS":n=Dn(6,3);break;case"Z":case"ZZ":case"ZZZ":n=R0(0);break;case"ZZZZZ":n=R0(3);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":n=R0(1);break;case"OOOO":case"ZZZZ":case"zzzz":n=R0(2);break;default:return null}return sE[t]=n,n}function mM(t,n){t=t.replace(/:/g,"");let e=Date.parse("Jan 01, 1970 00:00:00 "+t)/6e4;return isNaN(e)?n:e}function OQ(t,n){return t=new Date(t.getTime()),t.setMinutes(t.getMinutes()+n),t}function MQ(t,n,e){let r=e?-1:1,o=t.getTimezoneOffset(),i=mM(n,o);return OQ(t,r*(i-o))}function FQ(t){if(rM(t))return t;if(typeof t=="number"&&!isNaN(t))return new Date(t);if(typeof t=="string"){if(t=t.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(t)){let[o,i=1,s=1]=t.split("-").map(a=>+a);return P0(o,i-1,s)}let e=parseFloat(t);if(!isNaN(t-e))return new Date(e);let r;if(r=t.match(_Q))return PQ(r)}let n=new Date(t);if(!rM(n))throw new Error(`Unable to convert "${t}" into a date`);return n}function PQ(t){let n=new Date(0),e=0,r=0,o=t[8]?n.setUTCFullYear:n.setFullYear,i=t[8]?n.setUTCHours:n.setHours;t[9]&&(e=Number(t[9]+t[10]),r=Number(t[9]+t[11])),o.call(n,Number(t[1]),Number(t[2])-1,Number(t[3]));let s=Number(t[4]||0)-e,a=Number(t[5]||0)-r,l=Number(t[6]||0),c=Math.floor(parseFloat("0."+(t[7]||0))*1e3);return i.call(n,s,a,l,c),n}function rM(t){return t instanceof Date&&!isNaN(t.valueOf())}function L0(t,n){n=encodeURIComponent(n);for(let e of t.split(";")){let r=e.indexOf("="),[o,i]=r==-1?[e,""]:[e.slice(0,r),e.slice(r+1)];if(o.trim()===n)return decodeURIComponent(i)}return null}var aE=/\s+/,oM=[],Po=(()=>{class t{_ngEl;_renderer;initialClasses=oM;rawClass;stateMap=new Map;constructor(e,r){this._ngEl=e,this._renderer=r}set klass(e){this.initialClasses=e!=null?e.trim().split(aE):oM}set ngClass(e){this.rawClass=typeof e=="string"?e.trim().split(aE):e}ngDoCheck(){for(let r of this.initialClasses)this._updateState(r,!0);let e=this.rawClass;if(Array.isArray(e)||e instanceof Set)for(let r of e)this._updateState(r,!0);else if(e!=null)for(let r of Object.keys(e))this._updateState(r,!!e[r]);this._applyStateDiff()}_updateState(e,r){let o=this.stateMap.get(e);o!==void 0?(o.enabled!==r&&(o.changed=!0,o.enabled=r),o.touched=!0):this.stateMap.set(e,{enabled:r,changed:!0,touched:!0})}_applyStateDiff(){for(let e of this.stateMap){let r=e[0],o=e[1];o.changed?(this._toggleClass(r,o.enabled),o.changed=!1):o.touched||(o.enabled&&this._toggleClass(r,!1),this.stateMap.delete(r)),o.touched=!1}}_toggleClass(e,r){e=e.trim(),e.length>0&&e.split(aE).forEach(o=>{r?this._renderer.addClass(this._ngEl.nativeElement,o):this._renderer.removeClass(this._ngEl.nativeElement,o)})}static \u0275fac=function(r){return new(r||t)(oe(Ro),oe(mi))};static \u0275dir=kt({type:t,selectors:[["","ngClass",""]],inputs:{klass:[0,"class","klass"],ngClass:"ngClass"}})}return t})();var lE=class{$implicit;ngForOf;index;count;constructor(n,e,r,o){this.$implicit=n,this.ngForOf=e,this.index=r,this.count=o}get first(){return this.index===0}get last(){return this.index===this.count-1}get even(){return this.index%2===0}get odd(){return!this.even}},Wr=(()=>{class t{_viewContainer;_template;_differs;set ngForOf(e){this._ngForOf=e,this._ngForOfDirty=!0}set ngForTrackBy(e){this._trackByFn=e}get ngForTrackBy(){return this._trackByFn}_ngForOf=null;_ngForOfDirty=!0;_differ=null;_trackByFn;constructor(e,r,o){this._viewContainer=e,this._template=r,this._differs=o}set ngForTemplate(e){e&&(this._template=e)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;let e=this._ngForOf;!this._differ&&e&&(this._differ=this._differs.find(e).create(this.ngForTrackBy))}if(this._differ){let e=this._differ.diff(this._ngForOf);e&&this._applyChanges(e)}}_applyChanges(e){let r=this._viewContainer;e.forEachOperation((o,i,s)=>{if(o.previousIndex==null)r.createEmbeddedView(this._template,new lE(o.item,this._ngForOf,-1,-1),s===null?void 0:s);else if(s==null)r.remove(i===null?void 0:i);else if(i!==null){let a=r.get(i);r.move(a,s),iM(a,o)}});for(let o=0,i=r.length;o<i;o++){let a=r.get(o).context;a.index=o,a.count=i,a.ngForOf=this._ngForOf}e.forEachIdentityChange(o=>{let i=r.get(o.currentIndex);iM(i,o)})}static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(oe(Tp),oe(S0),oe(rE))};static \u0275dir=kt({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}})}return t})();function iM(t,n){t.context.$implicit=n.item}var xn=(()=>{class t{_viewContainer;_context=new cE;_thenTemplateRef=null;_elseTemplateRef=null;_thenViewRef=null;_elseViewRef=null;constructor(e,r){this._viewContainer=e,this._thenTemplateRef=r}set ngIf(e){this._context.$implicit=this._context.ngIf=e,this._updateView()}set ngIfThen(e){sM("ngIfThen",e),this._thenTemplateRef=e,this._thenViewRef=null,this._updateView()}set ngIfElse(e){sM("ngIfElse",e),this._elseTemplateRef=e,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngIfUseIfTypeGuard;static ngTemplateGuard_ngIf;static ngTemplateContextGuard(e,r){return!0}static \u0275fac=function(r){return new(r||t)(oe(Tp),oe(S0))};static \u0275dir=kt({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}})}return t})(),cE=class{$implicit=null;ngIf=null};function sM(t,n){if(!!!(!n||n.createEmbeddedView))throw new Error(`${t} must be a TemplateRef, but received '${Sr(n)}'.`)}function $Q(t,n){return new De(2100,!1)}var LQ="mediumDate",VQ=new Me(""),BQ=new Me(""),_l=(()=>{class t{locale;defaultTimezone;defaultOptions;constructor(e,r,o){this.locale=e,this.defaultTimezone=r,this.defaultOptions=o}transform(e,r,o,i){if(e==null||e===""||e!==e)return null;try{let s=r??this.defaultOptions?.dateFormat??LQ,a=o??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return EQ(e,s,i||this.locale,a)}catch(s){throw $Q(t,s.message)}}static \u0275fac=function(r){return new(r||t)(oe(E0,16),oe(VQ,24),oe(BQ,24))};static \u0275pipe=IO({name:"date",type:t,pure:!0})}return t})();var on=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Rs({type:t});static \u0275inj=Ts({})}return t})(),dE="browser",zQ="server";function Hr(t){return t===dE}function pE(t){return t===zQ}var kp=class{};var Eh=class{},Th=class{},Vs=class t{headers;normalizedNames=new Map;lazyInit;lazyUpdate=null;constructor(n){n?typeof n=="string"?this.lazyInit=()=>{this.headers=new Map,n.split(`
`).forEach(e=>{let r=e.indexOf(":");if(r>0){let o=e.slice(0,r),i=e.slice(r+1).trim();this.addHeaderEntry(o,i)}})}:typeof Headers<"u"&&n instanceof Headers?(this.headers=new Map,n.forEach((e,r)=>{this.addHeaderEntry(r,e)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(n).forEach(([e,r])=>{this.setHeaderEntries(e,r)})}:this.headers=new Map}has(n){return this.init(),this.headers.has(n.toLowerCase())}get(n){this.init();let e=this.headers.get(n.toLowerCase());return e&&e.length>0?e[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(n){return this.init(),this.headers.get(n.toLowerCase())||null}append(n,e){return this.clone({name:n,value:e,op:"a"})}set(n,e){return this.clone({name:n,value:e,op:"s"})}delete(n,e){return this.clone({name:n,value:e,op:"d"})}maybeSetNormalizedName(n,e){this.normalizedNames.has(e)||this.normalizedNames.set(e,n)}init(){this.lazyInit&&(this.lazyInit instanceof t?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(n=>this.applyUpdate(n)),this.lazyUpdate=null))}copyFrom(n){n.init(),Array.from(n.headers.keys()).forEach(e=>{this.headers.set(e,n.headers.get(e)),this.normalizedNames.set(e,n.normalizedNames.get(e))})}clone(n){let e=new t;return e.lazyInit=this.lazyInit&&this.lazyInit instanceof t?this.lazyInit:this,e.lazyUpdate=(this.lazyUpdate||[]).concat([n]),e}applyUpdate(n){let e=n.name.toLowerCase();switch(n.op){case"a":case"s":let r=n.value;if(typeof r=="string"&&(r=[r]),r.length===0)return;this.maybeSetNormalizedName(n.name,e);let o=(n.op==="a"?this.headers.get(e):void 0)||[];o.push(...r),this.headers.set(e,o);break;case"d":let i=n.value;if(!i)this.headers.delete(e),this.normalizedNames.delete(e);else{let s=this.headers.get(e);if(!s)return;s=s.filter(a=>i.indexOf(a)===-1),s.length===0?(this.headers.delete(e),this.normalizedNames.delete(e)):this.headers.set(e,s)}break}}addHeaderEntry(n,e){let r=n.toLowerCase();this.maybeSetNormalizedName(n,r),this.headers.has(r)?this.headers.get(r).push(e):this.headers.set(r,[e])}setHeaderEntries(n,e){let r=(Array.isArray(e)?e:[e]).map(i=>i.toString()),o=n.toLowerCase();this.headers.set(o,r),this.maybeSetNormalizedName(n,o)}forEach(n){this.init(),Array.from(this.normalizedNames.keys()).forEach(e=>n(this.normalizedNames.get(e),this.headers.get(e)))}};var hE=class{encodeKey(n){return hM(n)}encodeValue(n){return hM(n)}decodeKey(n){return decodeURIComponent(n)}decodeValue(n){return decodeURIComponent(n)}};function UQ(t,n){let e=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(o=>{let i=o.indexOf("="),[s,a]=i==-1?[n.decodeKey(o),""]:[n.decodeKey(o.slice(0,i)),n.decodeValue(o.slice(i+1))],l=e.get(s)||[];l.push(a),e.set(s,l)}),e}var jQ=/%(\d[a-f0-9])/gi,GQ={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function hM(t){return encodeURIComponent(t).replace(jQ,(n,e)=>GQ[e]??n)}function V0(t){return`${t}`}var El=class t{map;encoder;updates=null;cloneFrom=null;constructor(n={}){if(this.encoder=n.encoder||new hE,n.fromString){if(n.fromObject)throw new De(2805,!1);this.map=UQ(n.fromString,this.encoder)}else n.fromObject?(this.map=new Map,Object.keys(n.fromObject).forEach(e=>{let r=n.fromObject[e],o=Array.isArray(r)?r.map(V0):[V0(r)];this.map.set(e,o)})):this.map=null}has(n){return this.init(),this.map.has(n)}get(n){this.init();let e=this.map.get(n);return e?e[0]:null}getAll(n){return this.init(),this.map.get(n)||null}keys(){return this.init(),Array.from(this.map.keys())}append(n,e){return this.clone({param:n,value:e,op:"a"})}appendAll(n){let e=[];return Object.keys(n).forEach(r=>{let o=n[r];Array.isArray(o)?o.forEach(i=>{e.push({param:r,value:i,op:"a"})}):e.push({param:r,value:o,op:"a"})}),this.clone(e)}set(n,e){return this.clone({param:n,value:e,op:"s"})}delete(n,e){return this.clone({param:n,value:e,op:"d"})}toString(){return this.init(),this.keys().map(n=>{let e=this.encoder.encodeKey(n);return this.map.get(n).map(r=>e+"="+this.encoder.encodeValue(r)).join("&")}).filter(n=>n!=="").join("&")}clone(n){let e=new t({encoder:this.encoder});return e.cloneFrom=this.cloneFrom||this,e.updates=(this.updates||[]).concat(n),e}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(n=>this.map.set(n,this.cloneFrom.map.get(n))),this.updates.forEach(n=>{switch(n.op){case"a":case"s":let e=(n.op==="a"?this.map.get(n.param):void 0)||[];e.push(V0(n.value)),this.map.set(n.param,e);break;case"d":if(n.value!==void 0){let r=this.map.get(n.param)||[],o=r.indexOf(V0(n.value));o!==-1&&r.splice(o,1),r.length>0?this.map.set(n.param,r):this.map.delete(n.param)}else{this.map.delete(n.param);break}}}),this.cloneFrom=this.updates=null)}};var gE=class{map=new Map;set(n,e){return this.map.set(n,e),this}get(n){return this.map.has(n)||this.map.set(n,n.defaultValue()),this.map.get(n)}delete(n){return this.map.delete(n),this}has(n){return this.map.has(n)}keys(){return this.map.keys()}};function WQ(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function gM(t){return typeof ArrayBuffer<"u"&&t instanceof ArrayBuffer}function yM(t){return typeof Blob<"u"&&t instanceof Blob}function xM(t){return typeof FormData<"u"&&t instanceof FormData}function HQ(t){return typeof URLSearchParams<"u"&&t instanceof URLSearchParams}var _h="Content-Type",B0="Accept",vE="X-Request-URL",CM="text/plain",SM="application/json",_M=`${SM}, ${CM}, */*`,Ih=class t{url;body=null;headers;context;reportProgress=!1;withCredentials=!1;responseType="json";method;params;urlWithParams;transferCache;constructor(n,e,r,o){this.url=e,this.method=n.toUpperCase();let i;if(WQ(this.method)||o?(this.body=r!==void 0?r:null,i=o):i=r,i&&(this.reportProgress=!!i.reportProgress,this.withCredentials=!!i.withCredentials,i.responseType&&(this.responseType=i.responseType),i.headers&&(this.headers=i.headers),i.context&&(this.context=i.context),i.params&&(this.params=i.params),this.transferCache=i.transferCache),this.headers??=new Vs,this.context??=new gE,!this.params)this.params=new El,this.urlWithParams=e;else{let s=this.params.toString();if(s.length===0)this.urlWithParams=e;else{let a=e.indexOf("?"),l=a===-1?"?":a<e.length-1?"&":"";this.urlWithParams=e+l+s}}}serializeBody(){return this.body===null?null:typeof this.body=="string"||gM(this.body)||yM(this.body)||xM(this.body)||HQ(this.body)?this.body:this.body instanceof El?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||xM(this.body)?null:yM(this.body)?this.body.type||null:gM(this.body)?null:typeof this.body=="string"?CM:this.body instanceof El?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?SM:null}clone(n={}){let e=n.method||this.method,r=n.url||this.url,o=n.responseType||this.responseType,i=n.transferCache??this.transferCache,s=n.body!==void 0?n.body:this.body,a=n.withCredentials??this.withCredentials,l=n.reportProgress??this.reportProgress,c=n.headers||this.headers,u=n.params||this.params,d=n.context??this.context;return n.setHeaders!==void 0&&(c=Object.keys(n.setHeaders).reduce((p,f)=>p.set(f,n.setHeaders[f]),c)),n.setParams&&(u=Object.keys(n.setParams).reduce((p,f)=>p.set(f,n.setParams[f]),u)),new t(e,r,s,{params:u,headers:c,context:d,reportProgress:l,responseType:o,withCredentials:a,transferCache:i})}},Tl=function(t){return t[t.Sent=0]="Sent",t[t.UploadProgress=1]="UploadProgress",t[t.ResponseHeader=2]="ResponseHeader",t[t.DownloadProgress=3]="DownloadProgress",t[t.Response=4]="Response",t[t.User=5]="User",t}(Tl||{}),Dh=class{headers;status;statusText;url;ok;type;constructor(n,e=200,r="OK"){this.headers=n.headers||new Vs,this.status=n.status!==void 0?n.status:e,this.statusText=n.statusText||r,this.url=n.url||null,this.ok=this.status>=200&&this.status<300}},z0=class t extends Dh{constructor(n={}){super(n)}type=Tl.ResponseHeader;clone(n={}){return new t({headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Nh=class t extends Dh{body;constructor(n={}){super(n),this.body=n.body!==void 0?n.body:null}type=Tl.Response;clone(n={}){return new t({body:n.body!==void 0?n.body:this.body,headers:n.headers||this.headers,status:n.status!==void 0?n.status:this.status,statusText:n.statusText||this.statusText,url:n.url||this.url||void 0})}},Il=class extends Dh{name="HttpErrorResponse";message;error;ok=!1;constructor(n){super(n,0,"Unknown Error"),this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${n.url||"(unknown url)"}`:this.message=`Http failure response for ${n.url||"(unknown url)"}: ${n.status} ${n.statusText}`,this.error=n.error||null}},IM=200,qQ=204;function fE(t,n){return{body:n,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials,transferCache:t.transferCache}}var KQ=(()=>{class t{handler;constructor(e){this.handler=e}request(e,r,o={}){let i;if(e instanceof Ih)i=e;else{let l;o.headers instanceof Vs?l=o.headers:l=new Vs(o.headers);let c;o.params&&(o.params instanceof El?c=o.params:c=new El({fromObject:o.params})),i=new Ih(e,r,o.body!==void 0?o.body:null,{headers:l,context:o.context,params:c,reportProgress:o.reportProgress,responseType:o.responseType||"json",withCredentials:o.withCredentials,transferCache:o.transferCache})}let s=qe(i).pipe(fl(l=>this.handler.handle(l)));if(e instanceof Ih||o.observe==="events")return s;let a=s.pipe(io(l=>l instanceof Nh));switch(o.observe||"body"){case"body":switch(i.responseType){case"arraybuffer":return a.pipe(nt(l=>{if(l.body!==null&&!(l.body instanceof ArrayBuffer))throw new De(2806,!1);return l.body}));case"blob":return a.pipe(nt(l=>{if(l.body!==null&&!(l.body instanceof Blob))throw new De(2807,!1);return l.body}));case"text":return a.pipe(nt(l=>{if(l.body!==null&&typeof l.body!="string")throw new De(2808,!1);return l.body}));case"json":default:return a.pipe(nt(l=>l.body))}case"response":return a;default:throw new De(2809,!1)}}delete(e,r={}){return this.request("DELETE",e,r)}get(e,r={}){return this.request("GET",e,r)}head(e,r={}){return this.request("HEAD",e,r)}jsonp(e,r){return this.request("JSONP",e,{params:new El().append(r,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(e,r={}){return this.request("OPTIONS",e,r)}patch(e,r,o={}){return this.request("PATCH",e,fE(o,r))}post(e,r,o={}){return this.request("POST",e,fE(o,r))}put(e,r,o={}){return this.request("PUT",e,fE(o,r))}static \u0275fac=function(r){return new(r||t)($e(Eh))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),XQ=/^\)\]\}',?\n/;function vM(t){if(t.url)return t.url;let n=vE.toLocaleLowerCase();return t.headers.get(n)}var EM=new Me(""),mE=(()=>{class t{fetchImpl=de(yE,{optional:!0})?.fetch??((...e)=>globalThis.fetch(...e));ngZone=de(En);handle(e){return new wt(r=>{let o=new AbortController;return this.doRequest(e,o.signal,r).then(xE,i=>r.error(new Il({error:i}))),()=>o.abort()})}async doRequest(e,r,o){let i=this.createRequestInit(e),s;try{let f=this.ngZone.runOutsideAngular(()=>this.fetchImpl(e.urlWithParams,he({signal:r},i)));YQ(f),o.next({type:Tl.Sent}),s=await f}catch(f){o.error(new Il({error:f,status:f.status??0,statusText:f.statusText,url:e.urlWithParams,headers:f.headers}));return}let a=new Vs(s.headers),l=s.statusText,c=vM(s)??e.urlWithParams,u=s.status,d=null;if(e.reportProgress&&o.next(new z0({headers:a,status:u,statusText:l,url:c})),s.body){let f=s.headers.get("content-length"),m=[],h=s.body.getReader(),g=0,y,v,S=typeof Zone<"u"&&Zone.current;await this.ngZone.runOutsideAngular(async()=>{for(;;){let{done:I,value:E}=await h.read();if(I)break;if(m.push(E),g+=E.length,e.reportProgress){v=e.responseType==="text"?(v??"")+(y??=new TextDecoder).decode(E,{stream:!0}):void 0;let D=()=>o.next({type:Tl.DownloadProgress,total:f?+f:void 0,loaded:g,partialText:v});S?S.run(D):D()}}});let C=this.concatChunks(m,g);try{let I=s.headers.get(_h)??"";d=this.parseBody(e,C,I)}catch(I){o.error(new Il({error:I,headers:new Vs(s.headers),status:s.status,statusText:s.statusText,url:vM(s)??e.urlWithParams}));return}}u===0&&(u=d?IM:0),u>=200&&u<300?(o.next(new Nh({body:d,headers:a,status:u,statusText:l,url:c})),o.complete()):o.error(new Il({error:d,headers:a,status:u,statusText:l,url:c}))}parseBody(e,r,o){switch(e.responseType){case"json":let i=new TextDecoder().decode(r).replace(XQ,"");return i===""?null:JSON.parse(i);case"text":return new TextDecoder().decode(r);case"blob":return new Blob([r],{type:o});case"arraybuffer":return r.buffer}}createRequestInit(e){let r={},o=e.withCredentials?"include":void 0;if(e.headers.forEach((i,s)=>r[i]=s.join(",")),e.headers.has(B0)||(r[B0]=_M),!e.headers.has(_h)){let i=e.detectContentTypeHeader();i!==null&&(r[_h]=i)}return{body:e.serializeBody(),method:e.method,headers:r,credentials:o}}concatChunks(e,r){let o=new Uint8Array(r),i=0;for(let s of e)o.set(s,i),i+=s.length;return o}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),yE=class{};function xE(){}function YQ(t){t.then(xE,xE)}function QQ(t,n){return n(t)}function ZQ(t,n,e){return(r,o)=>rr(e,()=>n(r,i=>t(i,o)))}var TM=new Me(""),JQ=new Me(""),eZ=new Me("",{providedIn:"root",factory:()=>!0});var bM=(()=>{class t extends Eh{backend;injector;chain=null;pendingTasks=de(As);contributeToStability=de(eZ);constructor(e,r){super(),this.backend=e,this.injector=r}handle(e){if(this.chain===null){let r=Array.from(new Set([...this.injector.get(TM),...this.injector.get(JQ,[])]));this.chain=r.reduceRight((o,i)=>ZQ(o,i,this.injector),QQ)}if(this.contributeToStability){let r=this.pendingTasks.add();return this.chain(e,o=>this.backend.handle(o)).pipe(au(()=>this.pendingTasks.remove(r)))}else return this.chain(e,r=>this.backend.handle(r))}static \u0275fac=function(r){return new(r||t)($e(Th),$e(Br))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})();var tZ=/^\)\]\}',?\n/,nZ=RegExp(`^${vE}:`,"m");function rZ(t){return"responseURL"in t&&t.responseURL?t.responseURL:nZ.test(t.getAllResponseHeaders())?t.getResponseHeader(vE):null}var wM=(()=>{class t{xhrFactory;constructor(e){this.xhrFactory=e}handle(e){if(e.method==="JSONP")throw new De(-2800,!1);let r=this.xhrFactory;return(r.\u0275loadImpl?fn(r.\u0275loadImpl()):qe(null)).pipe(so(()=>new wt(i=>{let s=r.build();if(s.open(e.method,e.urlWithParams),e.withCredentials&&(s.withCredentials=!0),e.headers.forEach((h,g)=>s.setRequestHeader(h,g.join(","))),e.headers.has(B0)||s.setRequestHeader(B0,_M),!e.headers.has(_h)){let h=e.detectContentTypeHeader();h!==null&&s.setRequestHeader(_h,h)}if(e.responseType){let h=e.responseType.toLowerCase();s.responseType=h!=="json"?h:"text"}let a=e.serializeBody(),l=null,c=()=>{if(l!==null)return l;let h=s.statusText||"OK",g=new Vs(s.getAllResponseHeaders()),y=rZ(s)||e.url;return l=new z0({headers:g,status:s.status,statusText:h,url:y}),l},u=()=>{let{headers:h,status:g,statusText:y,url:v}=c(),S=null;g!==qQ&&(S=typeof s.response>"u"?s.responseText:s.response),g===0&&(g=S?IM:0);let C=g>=200&&g<300;if(e.responseType==="json"&&typeof S=="string"){let I=S;S=S.replace(tZ,"");try{S=S!==""?JSON.parse(S):null}catch(E){S=I,C&&(C=!1,S={error:E,text:S})}}C?(i.next(new Nh({body:S,headers:h,status:g,statusText:y,url:v||void 0})),i.complete()):i.error(new Il({error:S,headers:h,status:g,statusText:y,url:v||void 0}))},d=h=>{let{url:g}=c(),y=new Il({error:h,status:s.status||0,statusText:s.statusText||"Unknown Error",url:g||void 0});i.error(y)},p=!1,f=h=>{p||(i.next(c()),p=!0);let g={type:Tl.DownloadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),e.responseType==="text"&&s.responseText&&(g.partialText=s.responseText),i.next(g)},m=h=>{let g={type:Tl.UploadProgress,loaded:h.loaded};h.lengthComputable&&(g.total=h.total),i.next(g)};return s.addEventListener("load",u),s.addEventListener("error",d),s.addEventListener("timeout",d),s.addEventListener("abort",d),e.reportProgress&&(s.addEventListener("progress",f),a!==null&&s.upload&&s.upload.addEventListener("progress",m)),s.send(a),i.next({type:Tl.Sent}),()=>{s.removeEventListener("error",d),s.removeEventListener("abort",d),s.removeEventListener("load",u),s.removeEventListener("timeout",d),e.reportProgress&&(s.removeEventListener("progress",f),a!==null&&s.upload&&s.upload.removeEventListener("progress",m)),s.readyState!==s.DONE&&s.abort()}})))}static \u0275fac=function(r){return new(r||t)($e(kp))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),DM=new Me(""),oZ="XSRF-TOKEN",iZ=new Me("",{providedIn:"root",factory:()=>oZ}),sZ="X-XSRF-TOKEN",aZ=new Me("",{providedIn:"root",factory:()=>sZ}),U0=class{},lZ=(()=>{class t{doc;platform;cookieName;lastCookieString="";lastToken=null;parseCount=0;constructor(e,r,o){this.doc=e,this.platform=r,this.cookieName=o}getToken(){if(this.platform==="server")return null;let e=this.doc.cookie||"";return e!==this.lastCookieString&&(this.parseCount++,this.lastToken=L0(e,this.cookieName),this.lastCookieString=e),this.lastToken}static \u0275fac=function(r){return new(r||t)($e(Gr),$e(Oo),$e(iZ))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})();function cZ(t,n){let e=t.url.toLowerCase();if(!de(DM)||t.method==="GET"||t.method==="HEAD"||e.startsWith("http://")||e.startsWith("https://"))return n(t);let r=de(U0).getToken(),o=de(aZ);return r!=null&&!t.headers.has(o)&&(t=t.clone({headers:t.headers.set(o,r)})),n(t)}var NM=function(t){return t[t.Interceptors=0]="Interceptors",t[t.LegacyInterceptors=1]="LegacyInterceptors",t[t.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",t[t.NoXsrfProtection=3]="NoXsrfProtection",t[t.JsonpSupport=4]="JsonpSupport",t[t.RequestsMadeViaParent=5]="RequestsMadeViaParent",t[t.Fetch=6]="Fetch",t}(NM||{});function uZ(t,n){return{\u0275kind:t,\u0275providers:n}}function kM(...t){let n=[KQ,wM,bM,{provide:Eh,useExisting:bM},{provide:Th,useFactory:()=>de(EM,{optional:!0})??de(wM)},{provide:TM,useValue:cZ,multi:!0},{provide:DM,useValue:!0},{provide:U0,useClass:lZ}];for(let e of t)n.push(...e.\u0275providers);return Sp(n)}function AM(){return uZ(NM.Fetch,[mE,{provide:EM,useExisting:mE},{provide:Th,useExisting:mE}])}var wE=class extends F0{supportsDOMEvents=!0},CE=class t extends wE{static makeCurrent(){lM(new t)}onAndCancel(n,e,r,o){return n.addEventListener(e,r,o),()=>{n.removeEventListener(e,r,o)}}dispatchEvent(n,e){n.dispatchEvent(e)}remove(n){n.remove()}createElement(n,e){return e=e||this.getDefaultDocument(),e.createElement(n)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(n){return n.nodeType===Node.ELEMENT_NODE}isShadowRoot(n){return n instanceof DocumentFragment}getGlobalEventTarget(n,e){return e==="window"?window:e==="document"?n:e==="body"?n.body:null}getBaseHref(n){let e=dZ();return e==null?null:pZ(e)}resetBaseElement(){kh=null}getUserAgent(){return window.navigator.userAgent}getCookie(n){return L0(document.cookie,n)}},kh=null;function dZ(){return kh=kh||document.querySelector("base"),kh?kh.getAttribute("href"):null}function pZ(t){return new URL(t,document.baseURI).pathname}var fZ=(()=>{class t{build(){return new XMLHttpRequest}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),SE=new Me(""),$M=(()=>{class t{_zone;_plugins;_eventNameToPlugin=new Map;constructor(e,r){this._zone=r,e.forEach(o=>{o.manager=this}),this._plugins=e.slice().reverse()}addEventListener(e,r,o,i){return this._findPluginFor(r).addEventListener(e,r,o,i)}getZone(){return this._zone}_findPluginFor(e){let r=this._eventNameToPlugin.get(e);if(r)return r;if(r=this._plugins.find(i=>i.supports(e)),!r)throw new De(5101,!1);return this._eventNameToPlugin.set(e,r),r}static \u0275fac=function(r){return new(r||t)($e(SE),$e(En))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),G0=class{_doc;constructor(n){this._doc=n}manager},j0="ng-app-id";function RM(t){for(let n of t)n.remove()}function OM(t,n){let e=n.createElement("style");return e.textContent=t,e}function mZ(t,n,e,r){let o=t.head?.querySelectorAll(`style[${j0}="${n}"],link[${j0}="${n}"]`);if(o)for(let i of o)i.removeAttribute(j0),i instanceof HTMLLinkElement?r.set(i.href.slice(i.href.lastIndexOf("/")+1),{usage:0,elements:[i]}):i.textContent&&e.set(i.textContent,{usage:0,elements:[i]})}function _E(t,n){let e=n.createElement("link");return e.setAttribute("rel","stylesheet"),e.setAttribute("href",t),e}var LM=(()=>{class t{doc;appId;nonce;inline=new Map;external=new Map;hosts=new Set;isServer;constructor(e,r,o,i={}){this.doc=e,this.appId=r,this.nonce=o,this.isServer=pE(i),mZ(e,r,this.inline,this.external),this.hosts.add(e.head)}addStyles(e,r){for(let o of e)this.addUsage(o,this.inline,OM);r?.forEach(o=>this.addUsage(o,this.external,_E))}removeStyles(e,r){for(let o of e)this.removeUsage(o,this.inline);r?.forEach(o=>this.removeUsage(o,this.external))}addUsage(e,r,o){let i=r.get(e);i?i.usage++:r.set(e,{usage:1,elements:[...this.hosts].map(s=>this.addElement(s,o(e,this.doc)))})}removeUsage(e,r){let o=r.get(e);o&&(o.usage--,o.usage<=0&&(RM(o.elements),r.delete(e)))}ngOnDestroy(){for(let[,{elements:e}]of[...this.inline,...this.external])RM(e);this.hosts.clear()}addHost(e){this.hosts.add(e);for(let[r,{elements:o}]of this.inline)o.push(this.addElement(e,OM(r,this.doc)));for(let[r,{elements:o}]of this.external)o.push(this.addElement(e,_E(r,this.doc)))}removeHost(e){this.hosts.delete(e)}addElement(e,r){return this.nonce&&r.setAttribute("nonce",this.nonce),this.isServer&&r.setAttribute(j0,this.appId),e.appendChild(r)}static \u0275fac=function(r){return new(r||t)($e(Gr),$e(RI),$e(MI,8),$e(Oo))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),bE={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/Math/MathML"},EE=/%COMP%/g;var VM="%COMP%",hZ=`_nghost-${VM}`,gZ=`_ngcontent-${VM}`,yZ=!0,xZ=new Me("",{providedIn:"root",factory:()=>yZ});function vZ(t){return gZ.replace(EE,t)}function bZ(t){return hZ.replace(EE,t)}function BM(t,n){return n.map(e=>e.replace(EE,t))}var MM=(()=>{class t{eventManager;sharedStylesHost;appId;removeStylesOnCompDestroy;doc;platformId;ngZone;nonce;tracingService;rendererByCompId=new Map;defaultRenderer;platformIsServer;constructor(e,r,o,i,s,a,l,c=null,u=null){this.eventManager=e,this.sharedStylesHost=r,this.appId=o,this.removeStylesOnCompDestroy=i,this.doc=s,this.platformId=a,this.ngZone=l,this.nonce=c,this.tracingService=u,this.platformIsServer=pE(a),this.defaultRenderer=new Ah(e,s,l,this.platformIsServer,this.tracingService)}createRenderer(e,r){if(!e||!r)return this.defaultRenderer;this.platformIsServer&&r.encapsulation===Bi.ShadowDom&&(r=Ze(he({},r),{encapsulation:Bi.Emulated}));let o=this.getOrCreateRenderer(e,r);return o instanceof W0?o.applyToHost(e):o instanceof Rh&&o.applyStyles(),o}getOrCreateRenderer(e,r){let o=this.rendererByCompId,i=o.get(r.id);if(!i){let s=this.doc,a=this.ngZone,l=this.eventManager,c=this.sharedStylesHost,u=this.removeStylesOnCompDestroy,d=this.platformIsServer,p=this.tracingService;switch(r.encapsulation){case Bi.Emulated:i=new W0(l,c,r,this.appId,u,s,a,d,p);break;case Bi.ShadowDom:return new IE(l,c,e,r,s,a,this.nonce,d,p);default:i=new Rh(l,c,r,u,s,a,d,p);break}o.set(r.id,i)}return i}ngOnDestroy(){this.rendererByCompId.clear()}componentReplaced(e){this.rendererByCompId.delete(e)}static \u0275fac=function(r){return new(r||t)($e($M),$e(LM),$e(RI),$e(xZ),$e(Gr),$e(Oo),$e(En),$e(MI),$e(v0,8))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),Ah=class{eventManager;doc;ngZone;platformIsServer;tracingService;data=Object.create(null);throwOnSyntheticProps=!0;constructor(n,e,r,o,i){this.eventManager=n,this.doc=e,this.ngZone=r,this.platformIsServer=o,this.tracingService=i}destroy(){}destroyNode=null;createElement(n,e){return e?this.doc.createElementNS(bE[e]||e,n):this.doc.createElement(n)}createComment(n){return this.doc.createComment(n)}createText(n){return this.doc.createTextNode(n)}appendChild(n,e){(FM(n)?n.content:n).appendChild(e)}insertBefore(n,e,r){n&&(FM(n)?n.content:n).insertBefore(e,r)}removeChild(n,e){e.remove()}selectRootElement(n,e){let r=typeof n=="string"?this.doc.querySelector(n):n;if(!r)throw new De(-5104,!1);return e||(r.textContent=""),r}parentNode(n){return n.parentNode}nextSibling(n){return n.nextSibling}setAttribute(n,e,r,o){if(o){e=o+":"+e;let i=bE[o];i?n.setAttributeNS(i,e,r):n.setAttribute(e,r)}else n.setAttribute(e,r)}removeAttribute(n,e,r){if(r){let o=bE[r];o?n.removeAttributeNS(o,e):n.removeAttribute(`${r}:${e}`)}else n.removeAttribute(e)}addClass(n,e){n.classList.add(e)}removeClass(n,e){n.classList.remove(e)}setStyle(n,e,r,o){o&(_s.DashCase|_s.Important)?n.style.setProperty(e,r,o&_s.Important?"important":""):n.style[e]=r}removeStyle(n,e,r){r&_s.DashCase?n.style.removeProperty(e):n.style[e]=""}setProperty(n,e,r){n!=null&&(n[e]=r)}setValue(n,e){n.nodeValue=e}listen(n,e,r,o){if(typeof n=="string"&&(n=Ls().getGlobalEventTarget(this.doc,n),!n))throw new Error(`Unsupported event target ${n} for event ${e}`);let i=this.decoratePreventDefault(r);return this.tracingService!==null&&this.tracingService.wrapEventListener&&(i=this.tracingService.wrapEventListener(n,e,i)),this.eventManager.addEventListener(n,e,i,o)}decoratePreventDefault(n){return e=>{if(e==="__ngUnwrap__")return n;(this.platformIsServer?this.ngZone.runGuarded(()=>n(e)):n(e))===!1&&e.preventDefault()}}};function FM(t){return t.tagName==="TEMPLATE"&&t.content!==void 0}var IE=class extends Ah{sharedStylesHost;hostEl;shadowRoot;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,l,c),this.sharedStylesHost=e,this.hostEl=r,this.shadowRoot=r.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let u=o.styles;u=BM(o.id,u);for(let p of u){let f=document.createElement("style");a&&f.setAttribute("nonce",a),f.textContent=p,this.shadowRoot.appendChild(f)}let d=o.getExternalStyles?.();if(d)for(let p of d){let f=_E(p,i);a&&f.setAttribute("nonce",a),this.shadowRoot.appendChild(f)}}nodeOrShadowRoot(n){return n===this.hostEl?this.shadowRoot:n}appendChild(n,e){return super.appendChild(this.nodeOrShadowRoot(n),e)}insertBefore(n,e,r){return super.insertBefore(this.nodeOrShadowRoot(n),e,r)}removeChild(n,e){return super.removeChild(null,e)}parentNode(n){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(n)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Rh=class extends Ah{sharedStylesHost;removeStylesOnCompDestroy;styles;styleUrls;constructor(n,e,r,o,i,s,a,l,c){super(n,i,s,a,l),this.sharedStylesHost=e,this.removeStylesOnCompDestroy=o;let u=r.styles;this.styles=c?BM(c,u):u,this.styleUrls=r.getExternalStyles?.(c)}applyStyles(){this.sharedStylesHost.addStyles(this.styles,this.styleUrls)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles,this.styleUrls)}},W0=class extends Rh{contentAttr;hostAttr;constructor(n,e,r,o,i,s,a,l,c){let u=o+"-"+r.id;super(n,e,r,i,s,a,l,c,u),this.contentAttr=vZ(u),this.hostAttr=bZ(u)}applyToHost(n){this.applyStyles(),this.setAttribute(n,this.hostAttr,"")}createElement(n,e){let r=super.createElement(n,e);return super.setAttribute(r,this.contentAttr,""),r}},wZ=(()=>{class t extends G0{constructor(e){super(e)}supports(e){return!0}addEventListener(e,r,o,i){return e.addEventListener(r,o,i),()=>this.removeEventListener(e,r,o,i)}removeEventListener(e,r,o,i){return e.removeEventListener(r,o,i)}static \u0275fac=function(r){return new(r||t)($e(Gr))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})(),PM=["alt","control","meta","shift"],CZ={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},SZ={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey},_Z=(()=>{class t extends G0{constructor(e){super(e)}supports(e){return t.parseEventName(e)!=null}addEventListener(e,r,o,i){let s=t.parseEventName(r),a=t.eventCallback(s.fullKey,o,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ls().onAndCancel(e,s.domEventName,a,i))}static parseEventName(e){let r=e.toLowerCase().split("."),o=r.shift();if(r.length===0||!(o==="keydown"||o==="keyup"))return null;let i=t._normalizeKey(r.pop()),s="",a=r.indexOf("code");if(a>-1&&(r.splice(a,1),s="code."),PM.forEach(c=>{let u=r.indexOf(c);u>-1&&(r.splice(u,1),s+=c+".")}),s+=i,r.length!=0||i.length===0)return null;let l={};return l.domEventName=o,l.fullKey=s,l}static matchEventFullKeyCode(e,r){let o=CZ[e.key]||e.key,i="";return r.indexOf("code.")>-1&&(o=e.code,i="code."),o==null||!o?!1:(o=o.toLowerCase(),o===" "?o="space":o==="."&&(o="dot"),PM.forEach(s=>{if(s!==o){let a=SZ[s];a(e)&&(i+=s+".")}}),i+=o,i===r)}static eventCallback(e,r,o){return i=>{t.matchEventFullKeyCode(i,e)&&o.runGuarded(()=>r(i))}}static _normalizeKey(e){return e==="esc"?"escape":e}static \u0275fac=function(r){return new(r||t)($e(Gr))};static \u0275prov=Re({token:t,factory:t.\u0275fac})}return t})();function zM(t,n){return ZO(he({rootComponent:t},IZ(n)))}function IZ(t){return{appProviders:[...kZ,...t?.providers??[]],platformProviders:NZ}}function EZ(){CE.makeCurrent()}function TZ(){return new Ss}function DZ(){return G2(document),document}var NZ=[{provide:Oo,useValue:dE},{provide:OI,useValue:EZ,multi:!0},{provide:Gr,useFactory:DZ,deps:[]}];var kZ=[{provide:a0,useValue:"root"},{provide:Ss,useFactory:TZ,deps:[]},{provide:SE,useClass:wZ,multi:!0,deps:[Gr,En,Oo]},{provide:SE,useClass:_Z,multi:!0,deps:[Gr]},MM,LM,$M,{provide:wp,useExisting:MM},{provide:kp,useClass:fZ,deps:[]},[]];var UM=(()=>{class t{_doc;constructor(e){this._doc=e}getTitle(){return this._doc.title}setTitle(e){this._doc.title=e||""}static \u0275fac=function(r){return new(r||t)($e(Gr))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var rt="primary",qh=Symbol("RouteTitle"),AE=class{params;constructor(n){this.params=n||{}}has(n){return Object.prototype.hasOwnProperty.call(this.params,n)}get(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e[0]:e}return null}getAll(n){if(this.has(n)){let e=this.params[n];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}};function $p(t){return new AE(t)}function RZ(t,n,e){let r=e.path.split("/");if(r.length>t.length||e.pathMatch==="full"&&(n.hasChildren()||r.length<t.length))return null;let o={};for(let i=0;i<r.length;i++){let s=r[i],a=t[i];if(s[0]===":")o[s.substring(1)]=a;else if(s!==a.path)return null}return{consumed:t.slice(0,r.length),posParams:o}}function OZ(t,n){if(t.length!==n.length)return!1;for(let e=0;e<t.length;++e)if(!Gi(t[e],n[e]))return!1;return!0}function Gi(t,n){let e=t?RE(t):void 0,r=n?RE(n):void 0;if(!e||!r||e.length!=r.length)return!1;let o;for(let i=0;i<e.length;i++)if(o=e[i],!YM(t[o],n[o]))return!1;return!0}function RE(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function YM(t,n){if(Array.isArray(t)&&Array.isArray(n)){if(t.length!==n.length)return!1;let e=[...t].sort(),r=[...n].sort();return e.every((o,i)=>r[i]===o)}else return t===n}function QM(t){return t.length>0?t[t.length-1]:null}function Nl(t){return c_(t)?t:_u(t)?fn(Promise.resolve(t)):qe(t)}var MZ={exact:JM,subset:eF},ZM={exact:FZ,subset:PZ,ignored:()=>!0};function jM(t,n,e){return MZ[e.paths](t.root,n.root,e.matrixParams)&&ZM[e.queryParams](t.queryParams,n.queryParams)&&!(e.fragment==="exact"&&t.fragment!==n.fragment)}function FZ(t,n){return Gi(t,n)}function JM(t,n,e){if(!Du(t.segments,n.segments)||!K0(t.segments,n.segments,e)||t.numberOfChildren!==n.numberOfChildren)return!1;for(let r in n.children)if(!t.children[r]||!JM(t.children[r],n.children[r],e))return!1;return!0}function PZ(t,n){return Object.keys(n).length<=Object.keys(t).length&&Object.keys(n).every(e=>YM(t[e],n[e]))}function eF(t,n,e){return tF(t,n,n.segments,e)}function tF(t,n,e,r){if(t.segments.length>e.length){let o=t.segments.slice(0,e.length);return!(!Du(o,e)||n.hasChildren()||!K0(o,e,r))}else if(t.segments.length===e.length){if(!Du(t.segments,e)||!K0(t.segments,e,r))return!1;for(let o in n.children)if(!t.children[o]||!eF(t.children[o],n.children[o],r))return!1;return!0}else{let o=e.slice(0,t.segments.length),i=e.slice(t.segments.length);return!Du(t.segments,o)||!K0(t.segments,o,r)||!t.children[rt]?!1:tF(t.children[rt],n,i,r)}}function K0(t,n,e){return n.every((r,o)=>ZM[e](t[o].parameters,r.parameters))}var zs=class{root;queryParams;fragment;_queryParamMap;constructor(n=new $t([],{}),e={},r=null){this.root=n,this.queryParams=e,this.fragment=r}get queryParamMap(){return this._queryParamMap??=$p(this.queryParams),this._queryParamMap}toString(){return VZ.serialize(this)}},$t=class{segments;children;parent=null;constructor(n,e){this.segments=n,this.children=e,Object.values(e).forEach(r=>r.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return X0(this)}},Tu=class{path;parameters;_parameterMap;constructor(n,e){this.path=n,this.parameters=e}get parameterMap(){return this._parameterMap??=$p(this.parameters),this._parameterMap}toString(){return rF(this)}};function $Z(t,n){return Du(t,n)&&t.every((e,r)=>Gi(e.parameters,n[r].parameters))}function Du(t,n){return t.length!==n.length?!1:t.every((e,r)=>e.path===n[r].path)}function LZ(t,n){let e=[];return Object.entries(t.children).forEach(([r,o])=>{r===rt&&(e=e.concat(n(o,r)))}),Object.entries(t.children).forEach(([r,o])=>{r!==rt&&(e=e.concat(n(o,r)))}),e}var o1=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>new Lh,providedIn:"root"})}return t})(),Lh=class{parse(n){let e=new ME(n);return new zs(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(n){let e=`/${Oh(n.root,!0)}`,r=UZ(n.queryParams),o=typeof n.fragment=="string"?`#${BZ(n.fragment)}`:"";return`${e}${r}${o}`}},VZ=new Lh;function X0(t){return t.segments.map(n=>rF(n)).join("/")}function Oh(t,n){if(!t.hasChildren())return X0(t);if(n){let e=t.children[rt]?Oh(t.children[rt],!1):"",r=[];return Object.entries(t.children).forEach(([o,i])=>{o!==rt&&r.push(`${o}:${Oh(i,!1)}`)}),r.length>0?`${e}(${r.join("//")})`:e}else{let e=LZ(t,(r,o)=>o===rt?[Oh(t.children[rt],!1)]:[`${o}:${Oh(r,!1)}`]);return Object.keys(t.children).length===1&&t.children[rt]!=null?`${X0(t)}/${e[0]}`:`${X0(t)}/(${e.join("//")})`}}function nF(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function H0(t){return nF(t).replace(/%3B/gi,";")}function BZ(t){return encodeURI(t)}function OE(t){return nF(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function Y0(t){return decodeURIComponent(t)}function GM(t){return Y0(t.replace(/\+/g,"%20"))}function rF(t){return`${OE(t.path)}${zZ(t.parameters)}`}function zZ(t){return Object.entries(t).map(([n,e])=>`;${OE(n)}=${OE(e)}`).join("")}function UZ(t){let n=Object.entries(t).map(([e,r])=>Array.isArray(r)?r.map(o=>`${H0(e)}=${H0(o)}`).join("&"):`${H0(e)}=${H0(r)}`).filter(e=>e);return n.length?`?${n.join("&")}`:""}var jZ=/^[^\/()?;#]+/;function TE(t){let n=t.match(jZ);return n?n[0]:""}var GZ=/^[^\/()?;=#]+/;function WZ(t){let n=t.match(GZ);return n?n[0]:""}var HZ=/^[^=?&#]+/;function qZ(t){let n=t.match(HZ);return n?n[0]:""}var KZ=/^[^&#]+/;function XZ(t){let n=t.match(KZ);return n?n[0]:""}var ME=class{url;remaining;constructor(n){this.url=n,this.remaining=n}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new $t([],{}):new $t([],this.parseChildren())}parseQueryParams(){let n={};if(this.consumeOptional("?"))do this.parseQueryParam(n);while(this.consumeOptional("&"));return n}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let n=[];for(this.peekStartsWith("(")||n.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),n.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let r={};return this.peekStartsWith("(")&&(r=this.parseParens(!1)),(n.length>0||Object.keys(e).length>0)&&(r[rt]=new $t(n,e)),r}parseSegment(){let n=TE(this.remaining);if(n===""&&this.peekStartsWith(";"))throw new De(4009,!1);return this.capture(n),new Tu(Y0(n),this.parseMatrixParams())}parseMatrixParams(){let n={};for(;this.consumeOptional(";");)this.parseParam(n);return n}parseParam(n){let e=WZ(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let o=TE(this.remaining);o&&(r=o,this.capture(r))}n[Y0(e)]=Y0(r)}parseQueryParam(n){let e=qZ(this.remaining);if(!e)return;this.capture(e);let r="";if(this.consumeOptional("=")){let s=XZ(this.remaining);s&&(r=s,this.capture(r))}let o=GM(e),i=GM(r);if(n.hasOwnProperty(o)){let s=n[o];Array.isArray(s)||(s=[s],n[o]=s),s.push(i)}else n[o]=i}parseParens(n){let e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let r=TE(this.remaining),o=this.remaining[r.length];if(o!=="/"&&o!==")"&&o!==";")throw new De(4010,!1);let i;r.indexOf(":")>-1?(i=r.slice(0,r.indexOf(":")),this.capture(i),this.capture(":")):n&&(i=rt);let s=this.parseChildren();e[i]=Object.keys(s).length===1?s[rt]:new $t([],s),this.consumeOptional("//")}return e}peekStartsWith(n){return this.remaining.startsWith(n)}consumeOptional(n){return this.peekStartsWith(n)?(this.remaining=this.remaining.substring(n.length),!0):!1}capture(n){if(!this.consumeOptional(n))throw new De(4011,!1)}};function oF(t){return t.segments.length>0?new $t([],{[rt]:t}):t}function iF(t){let n={};for(let[r,o]of Object.entries(t.children)){let i=iF(o);if(r===rt&&i.segments.length===0&&i.hasChildren())for(let[s,a]of Object.entries(i.children))n[s]=a;else(i.segments.length>0||i.hasChildren())&&(n[r]=i)}let e=new $t(t.segments,n);return YZ(e)}function YZ(t){if(t.numberOfChildren===1&&t.children[rt]){let n=t.children[rt];return new $t(t.segments.concat(n.segments),n.children)}return t}function Nu(t){return t instanceof zs}function QZ(t,n,e=null,r=null){let o=sF(t);return aF(o,n,e,r)}function sF(t){let n;function e(i){let s={};for(let l of i.children){let c=e(l);s[l.outlet]=c}let a=new $t(i.url,s);return i===t&&(n=a),a}let r=e(t.root),o=oF(r);return n??o}function aF(t,n,e,r){let o=t;for(;o.parent;)o=o.parent;if(n.length===0)return DE(o,o,o,e,r);let i=ZZ(n);if(i.toRoot())return DE(o,o,new $t([],{}),e,r);let s=JZ(i,o,t),a=s.processChildren?Fh(s.segmentGroup,s.index,i.commands):cF(s.segmentGroup,s.index,i.commands);return DE(o,s.segmentGroup,a,e,r)}function Q0(t){return typeof t=="object"&&t!=null&&!t.outlets&&!t.segmentPath}function Vh(t){return typeof t=="object"&&t!=null&&t.outlets}function DE(t,n,e,r,o){let i={};r&&Object.entries(r).forEach(([l,c])=>{i[l]=Array.isArray(c)?c.map(u=>`${u}`):`${c}`});let s;t===n?s=e:s=lF(t,n,e);let a=oF(iF(s));return new zs(a,i,o)}function lF(t,n,e){let r={};return Object.entries(t.children).forEach(([o,i])=>{i===n?r[o]=e:r[o]=lF(i,n,e)}),new $t(t.segments,r)}var Z0=class{isAbsolute;numberOfDoubleDots;commands;constructor(n,e,r){if(this.isAbsolute=n,this.numberOfDoubleDots=e,this.commands=r,n&&r.length>0&&Q0(r[0]))throw new De(4003,!1);let o=r.find(Vh);if(o&&o!==QM(r))throw new De(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function ZZ(t){if(typeof t[0]=="string"&&t.length===1&&t[0]==="/")return new Z0(!0,0,t);let n=0,e=!1,r=t.reduce((o,i,s)=>{if(typeof i=="object"&&i!=null){if(i.outlets){let a={};return Object.entries(i.outlets).forEach(([l,c])=>{a[l]=typeof c=="string"?c.split("/"):c}),[...o,{outlets:a}]}if(i.segmentPath)return[...o,i.segmentPath]}return typeof i!="string"?[...o,i]:s===0?(i.split("/").forEach((a,l)=>{l==0&&a==="."||(l==0&&a===""?e=!0:a===".."?n++:a!=""&&o.push(a))}),o):[...o,i]},[]);return new Z0(e,n,r)}var Mp=class{segmentGroup;processChildren;index;constructor(n,e,r){this.segmentGroup=n,this.processChildren=e,this.index=r}};function JZ(t,n,e){if(t.isAbsolute)return new Mp(n,!0,0);if(!e)return new Mp(n,!1,NaN);if(e.parent===null)return new Mp(e,!0,0);let r=Q0(t.commands[0])?0:1,o=e.segments.length-1+r;return eJ(e,o,t.numberOfDoubleDots)}function eJ(t,n,e){let r=t,o=n,i=e;for(;i>o;){if(i-=o,r=r.parent,!r)throw new De(4005,!1);o=r.segments.length}return new Mp(r,!1,o-i)}function tJ(t){return Vh(t[0])?t[0].outlets:{[rt]:t}}function cF(t,n,e){if(t??=new $t([],{}),t.segments.length===0&&t.hasChildren())return Fh(t,n,e);let r=nJ(t,n,e),o=e.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){let i=new $t(t.segments.slice(0,r.pathIndex),{});return i.children[rt]=new $t(t.segments.slice(r.pathIndex),t.children),Fh(i,0,o)}else return r.match&&o.length===0?new $t(t.segments,{}):r.match&&!t.hasChildren()?FE(t,n,e):r.match?Fh(t,0,o):FE(t,n,e)}function Fh(t,n,e){if(e.length===0)return new $t(t.segments,{});{let r=tJ(e),o={};if(Object.keys(r).some(i=>i!==rt)&&t.children[rt]&&t.numberOfChildren===1&&t.children[rt].segments.length===0){let i=Fh(t.children[rt],n,e);return new $t(t.segments,i.children)}return Object.entries(r).forEach(([i,s])=>{typeof s=="string"&&(s=[s]),s!==null&&(o[i]=cF(t.children[i],n,s))}),Object.entries(t.children).forEach(([i,s])=>{r[i]===void 0&&(o[i]=s)}),new $t(t.segments,o)}}function nJ(t,n,e){let r=0,o=n,i={match:!1,pathIndex:0,commandIndex:0};for(;o<t.segments.length;){if(r>=e.length)return i;let s=t.segments[o],a=e[r];if(Vh(a))break;let l=`${a}`,c=r<e.length-1?e[r+1]:null;if(o>0&&l===void 0)break;if(l&&c&&typeof c=="object"&&c.outlets===void 0){if(!HM(l,c,s))return i;r+=2}else{if(!HM(l,{},s))return i;r++}o++}return{match:!0,pathIndex:o,commandIndex:r}}function FE(t,n,e){let r=t.segments.slice(0,n),o=0;for(;o<e.length;){let i=e[o];if(Vh(i)){let l=rJ(i.outlets);return new $t(r,l)}if(o===0&&Q0(e[0])){let l=t.segments[n];r.push(new Tu(l.path,WM(e[0]))),o++;continue}let s=Vh(i)?i.outlets[rt]:`${i}`,a=o<e.length-1?e[o+1]:null;s&&a&&Q0(a)?(r.push(new Tu(s,WM(a))),o+=2):(r.push(new Tu(s,{})),o++)}return new $t(r,{})}function rJ(t){let n={};return Object.entries(t).forEach(([e,r])=>{typeof r=="string"&&(r=[r]),r!==null&&(n[e]=FE(new $t([],{}),0,r))}),n}function WM(t){let n={};return Object.entries(t).forEach(([e,r])=>n[e]=`${r}`),n}function HM(t,n,e){return t==e.path&&Gi(n,e.parameters)}var Ph="imperative",or=function(t){return t[t.NavigationStart=0]="NavigationStart",t[t.NavigationEnd=1]="NavigationEnd",t[t.NavigationCancel=2]="NavigationCancel",t[t.NavigationError=3]="NavigationError",t[t.RoutesRecognized=4]="RoutesRecognized",t[t.ResolveStart=5]="ResolveStart",t[t.ResolveEnd=6]="ResolveEnd",t[t.GuardsCheckStart=7]="GuardsCheckStart",t[t.GuardsCheckEnd=8]="GuardsCheckEnd",t[t.RouteConfigLoadStart=9]="RouteConfigLoadStart",t[t.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",t[t.ChildActivationStart=11]="ChildActivationStart",t[t.ChildActivationEnd=12]="ChildActivationEnd",t[t.ActivationStart=13]="ActivationStart",t[t.ActivationEnd=14]="ActivationEnd",t[t.Scroll=15]="Scroll",t[t.NavigationSkipped=16]="NavigationSkipped",t}(or||{}),$o=class{id;url;constructor(n,e){this.id=n,this.url=e}},Bh=class extends $o{type=or.NavigationStart;navigationTrigger;restoredState;constructor(n,e,r="imperative",o=null){super(n,e),this.navigationTrigger=r,this.restoredState=o}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},Dl=class extends $o{urlAfterRedirects;type=or.NavigationEnd;constructor(n,e,r){super(n,e),this.urlAfterRedirects=r}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},fo=function(t){return t[t.Redirect=0]="Redirect",t[t.SupersededByNewNavigation=1]="SupersededByNewNavigation",t[t.NoDataFromResolver=2]="NoDataFromResolver",t[t.GuardRejected=3]="GuardRejected",t}(fo||{}),PE=function(t){return t[t.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",t[t.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",t}(PE||{}),Bs=class extends $o{reason;code;type=or.NavigationCancel;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},ku=class extends $o{reason;code;type=or.NavigationSkipped;constructor(n,e,r,o){super(n,e),this.reason=r,this.code=o}},zh=class extends $o{error;target;type=or.NavigationError;constructor(n,e,r,o){super(n,e),this.error=r,this.target=o}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},J0=class extends $o{urlAfterRedirects;state;type=or.RoutesRecognized;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},$E=class extends $o{urlAfterRedirects;state;type=or.GuardsCheckStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},LE=class extends $o{urlAfterRedirects;state;shouldActivate;type=or.GuardsCheckEnd;constructor(n,e,r,o,i){super(n,e),this.urlAfterRedirects=r,this.state=o,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},VE=class extends $o{urlAfterRedirects;state;type=or.ResolveStart;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},BE=class extends $o{urlAfterRedirects;state;type=or.ResolveEnd;constructor(n,e,r,o){super(n,e),this.urlAfterRedirects=r,this.state=o}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},zE=class{route;type=or.RouteConfigLoadStart;constructor(n){this.route=n}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},UE=class{route;type=or.RouteConfigLoadEnd;constructor(n){this.route=n}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},jE=class{snapshot;type=or.ChildActivationStart;constructor(n){this.snapshot=n}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},GE=class{snapshot;type=or.ChildActivationEnd;constructor(n){this.snapshot=n}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},WE=class{snapshot;type=or.ActivationStart;constructor(n){this.snapshot=n}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},HE=class{snapshot;type=or.ActivationEnd;constructor(n){this.snapshot=n}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var Uh=class{},Lp=class{url;navigationBehaviorOptions;constructor(n,e){this.url=n,this.navigationBehaviorOptions=e}};function oJ(t,n){return t.providers&&!t._injector&&(t._injector=QI(t.providers,n,`Route: ${t.path}`)),t._injector??n}function gi(t){return t.outlet||rt}function iJ(t,n){let e=t.filter(r=>gi(r)===n);return e.push(...t.filter(r=>gi(r)!==n)),e}function Kh(t){if(!t)return null;if(t.routeConfig?._injector)return t.routeConfig._injector;for(let n=t.parent;n;n=n.parent){let e=n.routeConfig;if(e?._loadedInjector)return e._loadedInjector;if(e?._injector)return e._injector}return null}var qE=class{rootInjector;outlet=null;route=null;children;attachRef=null;get injector(){return Kh(this.route?.snapshot)??this.rootInjector}constructor(n){this.rootInjector=n,this.children=new sv(this.rootInjector)}},sv=(()=>{class t{rootInjector;contexts=new Map;constructor(e){this.rootInjector=e}onChildOutletCreated(e,r){let o=this.getOrCreateContext(e);o.outlet=r,this.contexts.set(e,o)}onChildOutletDestroyed(e){let r=this.getContext(e);r&&(r.outlet=null,r.attachRef=null)}onOutletDeactivated(){let e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let r=this.getContext(e);return r||(r=new qE(this.rootInjector),this.contexts.set(e,r)),r}getContext(e){return this.contexts.get(e)||null}static \u0275fac=function(r){return new(r||t)($e(Br))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),ev=class{_root;constructor(n){this._root=n}get root(){return this._root.value}parent(n){let e=this.pathFromRoot(n);return e.length>1?e[e.length-2]:null}children(n){let e=KE(n,this._root);return e?e.children.map(r=>r.value):[]}firstChild(n){let e=KE(n,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(n){let e=XE(n,this._root);return e.length<2?[]:e[e.length-2].children.map(o=>o.value).filter(o=>o!==n)}pathFromRoot(n){return XE(n,this._root).map(e=>e.value)}};function KE(t,n){if(t===n.value)return n;for(let e of n.children){let r=KE(t,e);if(r)return r}return null}function XE(t,n){if(t===n.value)return[n];for(let e of n.children){let r=XE(t,e);if(r.length)return r.unshift(n),r}return[]}var po=class{value;children;constructor(n,e){this.value=n,this.children=e}toString(){return`TreeNode(${this.value})`}};function Op(t){let n={};return t&&t.children.forEach(e=>n[e.value.outlet]=e),n}var tv=class extends ev{snapshot;constructor(n,e){super(n),this.snapshot=e,i1(this,n)}toString(){return this.snapshot.toString()}};function uF(t){let n=sJ(t),e=new tr([new Tu("",{})]),r=new tr({}),o=new tr({}),i=new tr({}),s=new tr(""),a=new yi(e,r,i,s,o,rt,t,n.root);return a.snapshot=n.root,new tv(new po(a,[]),n)}function sJ(t){let n={},e={},r={},o="",i=new Fp([],n,r,o,e,rt,t,null,{});return new rv("",new po(i,[]))}var yi=class{urlSubject;paramsSubject;queryParamsSubject;fragmentSubject;dataSubject;outlet;component;snapshot;_futureSnapshot;_routerState;_paramMap;_queryParamMap;title;url;params;queryParams;fragment;data;constructor(n,e,r,o,i,s,a,l){this.urlSubject=n,this.paramsSubject=e,this.queryParamsSubject=r,this.fragmentSubject=o,this.dataSubject=i,this.outlet=s,this.component=a,this._futureSnapshot=l,this.title=this.dataSubject?.pipe(nt(c=>c[qh]))??qe(void 0),this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(nt(n=>$p(n))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(nt(n=>$p(n))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function nv(t,n,e="emptyOnly"){let r,{routeConfig:o}=t;return n!==null&&(e==="always"||o?.path===""||!n.component&&!n.routeConfig?.loadComponent)?r={params:he(he({},n.params),t.params),data:he(he({},n.data),t.data),resolve:he(he(he(he({},t.data),n.data),o?.data),t._resolvedData)}:r={params:he({},t.params),data:he({},t.data),resolve:he(he({},t.data),t._resolvedData??{})},o&&pF(o)&&(r.resolve[qh]=o.title),r}var Fp=class{url;params;queryParams;fragment;data;outlet;component;routeConfig;_resolve;_resolvedData;_routerState;_paramMap;_queryParamMap;get title(){return this.data?.[qh]}constructor(n,e,r,o,i,s,a,l,c){this.url=n,this.params=e,this.queryParams=r,this.fragment=o,this.data=i,this.outlet=s,this.component=a,this.routeConfig=l,this._resolve=c}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=$p(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=$p(this.queryParams),this._queryParamMap}toString(){let n=this.url.map(r=>r.toString()).join("/"),e=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${n}', path:'${e}')`}},rv=class extends ev{url;constructor(n,e){super(e),this.url=n,i1(this,e)}toString(){return dF(this._root)}};function i1(t,n){n.value._routerState=t,n.children.forEach(e=>i1(t,e))}function dF(t){let n=t.children.length>0?` { ${t.children.map(dF).join(", ")} } `:"";return`${t.value}${n}`}function NE(t){if(t.snapshot){let n=t.snapshot,e=t._futureSnapshot;t.snapshot=e,Gi(n.queryParams,e.queryParams)||t.queryParamsSubject.next(e.queryParams),n.fragment!==e.fragment&&t.fragmentSubject.next(e.fragment),Gi(n.params,e.params)||t.paramsSubject.next(e.params),OZ(n.url,e.url)||t.urlSubject.next(e.url),Gi(n.data,e.data)||t.dataSubject.next(e.data)}else t.snapshot=t._futureSnapshot,t.dataSubject.next(t._futureSnapshot.data)}function YE(t,n){let e=Gi(t.params,n.params)&&$Z(t.url,n.url),r=!t.parent!=!n.parent;return e&&!r&&(!t.parent||YE(t.parent,n.parent))}function pF(t){return typeof t.title=="string"||t.title===null}var aJ=new Me(""),s1=(()=>{class t{activated=null;get activatedComponentRef(){return this.activated}_activatedRoute=null;name=rt;activateEvents=new zt;deactivateEvents=new zt;attachEvents=new zt;detachEvents=new zt;routerOutletData=P2(void 0);parentContexts=de(sv);location=de(Tp);changeDetector=de(Ut);inputBinder=de(a1,{optional:!0});supportsBindingToComponentInputs=!0;ngOnChanges(e){if(e.name){let{firstChange:r,previousValue:o}=e.name;if(r)return;this.isTrackedInParentContexts(o)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(o)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(e){return this.parentContexts.getContext(e)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let e=this.parentContexts.getContext(this.name);e?.route&&(e.attachRef?this.attach(e.attachRef,e.route):this.activateWith(e.route,e.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new De(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new De(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new De(4012,!1);this.location.detach();let e=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(e.instance),e}attach(e,r){this.activated=e,this._activatedRoute=r,this.location.insert(e.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(e.instance)}deactivate(){if(this.activated){let e=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(e)}}activateWith(e,r){if(this.isActivated)throw new De(4013,!1);this._activatedRoute=e;let o=this.location,s=e.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new QE(e,a,o.injector,this.routerOutletData);this.activated=o.createComponent(s,{index:o.length,injector:l,environmentInjector:r}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}static \u0275fac=function(r){return new(r||t)};static \u0275dir=kt({type:t,selectors:[["router-outlet"]],inputs:{name:"name",routerOutletData:[1,"routerOutletData"]},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],features:[pi]})}return t})(),QE=class t{route;childContexts;parent;outletData;__ngOutletInjector(n){return new t(this.route,this.childContexts,n,this.outletData)}constructor(n,e,r,o){this.route=n,this.childContexts=e,this.parent=r,this.outletData=o}get(n,e){return n===yi?this.route:n===sv?this.childContexts:n===aJ?this.outletData:this.parent.get(n,e)}},a1=new Me("");function lJ(t,n,e){let r=jh(t,n._root,e?e._root:void 0);return new tv(r,n)}function jh(t,n,e){if(e&&t.shouldReuseRoute(n.value,e.value.snapshot)){let r=e.value;r._futureSnapshot=n.value;let o=cJ(t,n,e);return new po(r,o)}else{if(t.shouldAttach(n.value)){let i=t.retrieve(n.value);if(i!==null){let s=i.route;return s.value._futureSnapshot=n.value,s.children=n.children.map(a=>jh(t,a)),s}}let r=uJ(n.value),o=n.children.map(i=>jh(t,i));return new po(r,o)}}function cJ(t,n,e){return n.children.map(r=>{for(let o of e.children)if(t.shouldReuseRoute(r.value,o.value.snapshot))return jh(t,r,o);return jh(t,r)})}function uJ(t){return new yi(new tr(t.url),new tr(t.params),new tr(t.queryParams),new tr(t.fragment),new tr(t.data),t.outlet,t.component,t)}var Gh=class{redirectTo;navigationBehaviorOptions;constructor(n,e){this.redirectTo=n,this.navigationBehaviorOptions=e}},fF="ngNavigationCancelingError";function ov(t,n){let{redirectTo:e,navigationBehaviorOptions:r}=Nu(n)?{redirectTo:n,navigationBehaviorOptions:void 0}:n,o=mF(!1,fo.Redirect);return o.url=e,o.navigationBehaviorOptions=r,o}function mF(t,n){let e=new Error(`NavigationCancelingError: ${t||""}`);return e[fF]=!0,e.cancellationCode=n,e}function dJ(t){return hF(t)&&Nu(t.url)}function hF(t){return!!t&&t[fF]}var pJ=(t,n,e,r)=>nt(o=>(new ZE(n,o.targetRouterState,o.currentRouterState,e,r).activate(t),o)),ZE=class{routeReuseStrategy;futureState;currState;forwardEvent;inputBindingEnabled;constructor(n,e,r,o,i){this.routeReuseStrategy=n,this.futureState=e,this.currState=r,this.forwardEvent=o,this.inputBindingEnabled=i}activate(n){let e=this.futureState._root,r=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,r,n),NE(this.futureState.root),this.activateChildRoutes(e,r,n)}deactivateChildRoutes(n,e,r){let o=Op(e);n.children.forEach(i=>{let s=i.value.outlet;this.deactivateRoutes(i,o[s],r),delete o[s]}),Object.values(o).forEach(i=>{this.deactivateRouteAndItsChildren(i,r)})}deactivateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(o===i)if(o.component){let s=r.getContext(o.outlet);s&&this.deactivateChildRoutes(n,e,s.children)}else this.deactivateChildRoutes(n,e,r);else i&&this.deactivateRouteAndItsChildren(e,r)}deactivateRouteAndItsChildren(n,e){n.value.component&&this.routeReuseStrategy.shouldDetach(n.value.snapshot)?this.detachAndStoreRouteSubtree(n,e):this.deactivateRouteAndOutlet(n,e)}detachAndStoreRouteSubtree(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Op(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);if(r&&r.outlet){let s=r.outlet.detach(),a=r.children.onOutletDeactivated();this.routeReuseStrategy.store(n.value.snapshot,{componentRef:s,route:n,contexts:a})}}deactivateRouteAndOutlet(n,e){let r=e.getContext(n.value.outlet),o=r&&n.value.component?r.children:e,i=Op(n);for(let s of Object.values(i))this.deactivateRouteAndItsChildren(s,o);r&&(r.outlet&&(r.outlet.deactivate(),r.children.onOutletDeactivated()),r.attachRef=null,r.route=null)}activateChildRoutes(n,e,r){let o=Op(e);n.children.forEach(i=>{this.activateRoutes(i,o[i.value.outlet],r),this.forwardEvent(new HE(i.value.snapshot))}),n.children.length&&this.forwardEvent(new GE(n.value.snapshot))}activateRoutes(n,e,r){let o=n.value,i=e?e.value:null;if(NE(o),o===i)if(o.component){let s=r.getOrCreateContext(o.outlet);this.activateChildRoutes(n,e,s.children)}else this.activateChildRoutes(n,e,r);else if(o.component){let s=r.getOrCreateContext(o.outlet);if(this.routeReuseStrategy.shouldAttach(o.snapshot)){let a=this.routeReuseStrategy.retrieve(o.snapshot);this.routeReuseStrategy.store(o.snapshot,null),s.children.onOutletReAttached(a.contexts),s.attachRef=a.componentRef,s.route=a.route.value,s.outlet&&s.outlet.attach(a.componentRef,a.route.value),NE(a.route.value),this.activateChildRoutes(n,null,s.children)}else s.attachRef=null,s.route=o,s.outlet&&s.outlet.activateWith(o,s.injector),this.activateChildRoutes(n,null,s.children)}else this.activateChildRoutes(n,null,r)}},iv=class{path;route;constructor(n){this.path=n,this.route=this.path[this.path.length-1]}},Pp=class{component;route;constructor(n,e){this.component=n,this.route=e}};function fJ(t,n,e){let r=t._root,o=n?n._root:null;return Mh(r,o,e,[r.value])}function mJ(t){let n=t.routeConfig?t.routeConfig.canActivateChild:null;return!n||n.length===0?null:{node:t,guards:n}}function Bp(t,n){let e=Symbol(),r=n.get(t,e);return r===e?typeof t=="function"&&!AR(t)?t:n.get(t):r}function Mh(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=Op(n);return t.children.forEach(s=>{hJ(s,i[s.value.outlet],e,r.concat([s.value]),o),delete i[s.value.outlet]}),Object.entries(i).forEach(([s,a])=>$h(a,e.getContext(s),o)),o}function hJ(t,n,e,r,o={canDeactivateChecks:[],canActivateChecks:[]}){let i=t.value,s=n?n.value:null,a=e?e.getContext(t.value.outlet):null;if(s&&i.routeConfig===s.routeConfig){let l=gJ(s,i,i.routeConfig.runGuardsAndResolvers);l?o.canActivateChecks.push(new iv(r)):(i.data=s.data,i._resolvedData=s._resolvedData),i.component?Mh(t,n,a?a.children:null,r,o):Mh(t,n,e,r,o),l&&a&&a.outlet&&a.outlet.isActivated&&o.canDeactivateChecks.push(new Pp(a.outlet.component,s))}else s&&$h(n,a,o),o.canActivateChecks.push(new iv(r)),i.component?Mh(t,null,a?a.children:null,r,o):Mh(t,null,e,r,o);return o}function gJ(t,n,e){if(typeof e=="function")return e(t,n);switch(e){case"pathParamsChange":return!Du(t.url,n.url);case"pathParamsOrQueryParamsChange":return!Du(t.url,n.url)||!Gi(t.queryParams,n.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!YE(t,n)||!Gi(t.queryParams,n.queryParams);case"paramsChange":default:return!YE(t,n)}}function $h(t,n,e){let r=Op(t),o=t.value;Object.entries(r).forEach(([i,s])=>{o.component?n?$h(s,n.children.getContext(i),e):$h(s,null,e):$h(s,n,e)}),o.component?n&&n.outlet&&n.outlet.isActivated?e.canDeactivateChecks.push(new Pp(n.outlet.component,o)):e.canDeactivateChecks.push(new Pp(null,o)):e.canDeactivateChecks.push(new Pp(null,o))}function Xh(t){return typeof t=="function"}function yJ(t){return typeof t=="boolean"}function xJ(t){return t&&Xh(t.canLoad)}function vJ(t){return t&&Xh(t.canActivate)}function bJ(t){return t&&Xh(t.canActivateChild)}function wJ(t){return t&&Xh(t.canDeactivate)}function CJ(t){return t&&Xh(t.canMatch)}function gF(t){return t instanceof ys||t?.name==="EmptyError"}var q0=Symbol("INITIAL_VALUE");function Vp(){return so(t=>gx(t.map(n=>n.pipe(xs(1),m_(q0)))).pipe(nt(n=>{for(let e of n)if(e!==!0){if(e===q0)return q0;if(e===!1||SJ(e))return e}return!0}),io(n=>n!==q0),xs(1)))}function SJ(t){return Nu(t)||t instanceof Gh}function _J(t,n){return $n(e=>{let{targetSnapshot:r,currentSnapshot:o,guards:{canActivateChecks:i,canDeactivateChecks:s}}=e;return s.length===0&&i.length===0?qe(Ze(he({},e),{guardsResult:!0})):IJ(s,r,o,t).pipe($n(a=>a&&yJ(a)?EJ(r,i,t,n):qe(a)),nt(a=>Ze(he({},e),{guardsResult:a})))})}function IJ(t,n,e,r){return fn(t).pipe($n(o=>AJ(o.component,o.route,e,n,r)),vs(o=>o!==!0,!0))}function EJ(t,n,e,r){return fn(n).pipe(fl(o=>sp(DJ(o.route.parent,r),TJ(o.route,r),kJ(t,o.path,e),NJ(t,o.route,e))),vs(o=>o!==!0,!0))}function TJ(t,n){return t!==null&&n&&n(new WE(t)),qe(!0)}function DJ(t,n){return t!==null&&n&&n(new jE(t)),qe(!0)}function NJ(t,n,e){let r=n.routeConfig?n.routeConfig.canActivate:null;if(!r||r.length===0)return qe(!0);let o=r.map(i=>yx(()=>{let s=Kh(n)??e,a=Bp(i,s),l=vJ(a)?a.canActivate(n,t):rr(s,()=>a(n,t));return Nl(l).pipe(vs())}));return qe(o).pipe(Vp())}function kJ(t,n,e){let r=n[n.length-1],i=n.slice(0,n.length-1).reverse().map(s=>mJ(s)).filter(s=>s!==null).map(s=>yx(()=>{let a=s.guards.map(l=>{let c=Kh(s.node)??e,u=Bp(l,c),d=bJ(u)?u.canActivateChild(r,t):rr(c,()=>u(r,t));return Nl(d).pipe(vs())});return qe(a).pipe(Vp())}));return qe(i).pipe(Vp())}function AJ(t,n,e,r,o){let i=n&&n.routeConfig?n.routeConfig.canDeactivate:null;if(!i||i.length===0)return qe(!0);let s=i.map(a=>{let l=Kh(n)??o,c=Bp(a,l),u=wJ(c)?c.canDeactivate(t,n,e,r):rr(l,()=>c(t,n,e,r));return Nl(u).pipe(vs())});return qe(s).pipe(Vp())}function RJ(t,n,e,r){let o=n.canLoad;if(o===void 0||o.length===0)return qe(!0);let i=o.map(s=>{let a=Bp(s,t),l=xJ(a)?a.canLoad(n,e):rr(t,()=>a(n,e));return Nl(l)});return qe(i).pipe(Vp(),yF(r))}function yF(t){return i_(Gn(n=>{if(typeof n!="boolean")throw ov(t,n)}),nt(n=>n===!0))}function OJ(t,n,e,r){let o=n.canMatch;if(!o||o.length===0)return qe(!0);let i=o.map(s=>{let a=Bp(s,t),l=CJ(a)?a.canMatch(n,e):rr(t,()=>a(n,e));return Nl(l)});return qe(i).pipe(Vp(),yF(r))}var Wh=class{segmentGroup;constructor(n){this.segmentGroup=n||null}},Hh=class extends Error{urlTree;constructor(n){super(),this.urlTree=n}};function Rp(t){return ip(new Wh(t))}function MJ(t){return ip(new De(4e3,!1))}function FJ(t){return ip(mF(!1,fo.GuardRejected))}var JE=class{urlSerializer;urlTree;constructor(n,e){this.urlSerializer=n,this.urlTree=e}lineralizeSegments(n,e){let r=[],o=e.root;for(;;){if(r=r.concat(o.segments),o.numberOfChildren===0)return qe(r);if(o.numberOfChildren>1||!o.children[rt])return MJ(`${n.redirectTo}`);o=o.children[rt]}}applyRedirectCommands(n,e,r,o,i){if(typeof e!="string"){let a=e,{queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,params:f,data:m,title:h}=o,g=rr(i,()=>a({params:f,data:m,queryParams:l,fragment:c,routeConfig:u,url:d,outlet:p,title:h}));if(g instanceof zs)throw new Hh(g);e=g}let s=this.applyRedirectCreateUrlTree(e,this.urlSerializer.parse(e),n,r);if(e[0]==="/")throw new Hh(s);return s}applyRedirectCreateUrlTree(n,e,r,o){let i=this.createSegmentGroup(n,e.root,r,o);return new zs(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(n,e){let r={};return Object.entries(n).forEach(([o,i])=>{if(typeof i=="string"&&i[0]===":"){let a=i.substring(1);r[o]=e[a]}else r[o]=i}),r}createSegmentGroup(n,e,r,o){let i=this.createSegments(n,e.segments,r,o),s={};return Object.entries(e.children).forEach(([a,l])=>{s[a]=this.createSegmentGroup(n,l,r,o)}),new $t(i,s)}createSegments(n,e,r,o){return e.map(i=>i.path[0]===":"?this.findPosParam(n,i,o):this.findOrReturn(i,r))}findPosParam(n,e,r){let o=r[e.path.substring(1)];if(!o)throw new De(4001,!1);return o}findOrReturn(n,e){let r=0;for(let o of e){if(o.path===n.path)return e.splice(r),o;r++}return n}},e1={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function PJ(t,n,e,r,o){let i=xF(t,n,e);return i.matched?(r=oJ(n,r),OJ(r,n,e,o).pipe(nt(s=>s===!0?i:he({},e1)))):qe(i)}function xF(t,n,e){if(n.path==="**")return $J(e);if(n.path==="")return n.pathMatch==="full"&&(t.hasChildren()||e.length>0)?he({},e1):{matched:!0,consumedSegments:[],remainingSegments:e,parameters:{},positionalParamSegments:{}};let o=(n.matcher||RZ)(e,t,n);if(!o)return he({},e1);let i={};Object.entries(o.posParams??{}).forEach(([a,l])=>{i[a]=l.path});let s=o.consumed.length>0?he(he({},i),o.consumed[o.consumed.length-1].parameters):i;return{matched:!0,consumedSegments:o.consumed,remainingSegments:e.slice(o.consumed.length),parameters:s,positionalParamSegments:o.posParams??{}}}function $J(t){return{matched:!0,parameters:t.length>0?QM(t).parameters:{},consumedSegments:t,remainingSegments:[],positionalParamSegments:{}}}function qM(t,n,e,r){return e.length>0&&BJ(t,e,r)?{segmentGroup:new $t(n,VJ(r,new $t(e,t.children))),slicedSegments:[]}:e.length===0&&zJ(t,e,r)?{segmentGroup:new $t(t.segments,LJ(t,e,r,t.children)),slicedSegments:e}:{segmentGroup:new $t(t.segments,t.children),slicedSegments:e}}function LJ(t,n,e,r){let o={};for(let i of e)if(av(t,n,i)&&!r[gi(i)]){let s=new $t([],{});o[gi(i)]=s}return he(he({},r),o)}function VJ(t,n){let e={};e[rt]=n;for(let r of t)if(r.path===""&&gi(r)!==rt){let o=new $t([],{});e[gi(r)]=o}return e}function BJ(t,n,e){return e.some(r=>av(t,n,r)&&gi(r)!==rt)}function zJ(t,n,e){return e.some(r=>av(t,n,r))}function av(t,n,e){return(t.hasChildren()||n.length>0)&&e.pathMatch==="full"?!1:e.path===""}function UJ(t,n,e){return n.length===0&&!t.children[e]}var t1=class{};function jJ(t,n,e,r,o,i,s="emptyOnly"){return new n1(t,n,e,r,o,s,i).recognize()}var GJ=31,n1=class{injector;configLoader;rootComponentType;config;urlTree;paramsInheritanceStrategy;urlSerializer;applyRedirects;absoluteRedirectCount=0;allowRedirects=!0;constructor(n,e,r,o,i,s,a){this.injector=n,this.configLoader=e,this.rootComponentType=r,this.config=o,this.urlTree=i,this.paramsInheritanceStrategy=s,this.urlSerializer=a,this.applyRedirects=new JE(this.urlSerializer,this.urlTree)}noMatchError(n){return new De(4002,`'${n.segmentGroup}'`)}recognize(){let n=qM(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(n).pipe(nt(({children:e,rootSnapshot:r})=>{let o=new po(r,e),i=new rv("",o),s=QZ(r,[],this.urlTree.queryParams,this.urlTree.fragment);return s.queryParams=this.urlTree.queryParams,i.url=this.urlSerializer.serialize(s),{state:i,tree:s}}))}match(n){let e=new Fp([],Object.freeze({}),Object.freeze(he({},this.urlTree.queryParams)),this.urlTree.fragment,Object.freeze({}),rt,this.rootComponentType,null,{});return this.processSegmentGroup(this.injector,this.config,n,rt,e).pipe(nt(r=>({children:r,rootSnapshot:e})),pl(r=>{if(r instanceof Hh)return this.urlTree=r.urlTree,this.match(r.urlTree.root);throw r instanceof Wh?this.noMatchError(r):r}))}processSegmentGroup(n,e,r,o,i){return r.segments.length===0&&r.hasChildren()?this.processChildren(n,e,r,i):this.processSegment(n,e,r,r.segments,o,!0,i).pipe(nt(s=>s instanceof po?[s]:[]))}processChildren(n,e,r,o){let i=[];for(let s of Object.keys(r.children))s==="primary"?i.unshift(s):i.push(s);return fn(i).pipe(fl(s=>{let a=r.children[s],l=iJ(e,s);return this.processSegmentGroup(n,l,a,s,o)}),f_((s,a)=>(s.push(...a),s)),ml(null),p_(),$n(s=>{if(s===null)return Rp(r);let a=vF(s);return WJ(a),qe(a)}))}processSegment(n,e,r,o,i,s,a){return fn(e).pipe(fl(l=>this.processSegmentAgainstRoute(l._injector??n,e,l,r,o,i,s,a).pipe(pl(c=>{if(c instanceof Wh)return qe(null);throw c}))),vs(l=>!!l),pl(l=>{if(gF(l))return UJ(r,o,i)?qe(new t1):Rp(r);throw l}))}processSegmentAgainstRoute(n,e,r,o,i,s,a,l){return gi(r)!==s&&(s===rt||!av(o,i,r))?Rp(o):r.redirectTo===void 0?this.matchSegmentAgainstRoute(n,o,r,i,s,l):this.allowRedirects&&a?this.expandSegmentAgainstRouteUsingRedirect(n,o,e,r,i,s,l):Rp(o)}expandSegmentAgainstRouteUsingRedirect(n,e,r,o,i,s,a){let{matched:l,parameters:c,consumedSegments:u,positionalParamSegments:d,remainingSegments:p}=xF(e,o,i);if(!l)return Rp(e);typeof o.redirectTo=="string"&&o.redirectTo[0]==="/"&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>GJ&&(this.allowRedirects=!1));let f=new Fp(i,c,Object.freeze(he({},this.urlTree.queryParams)),this.urlTree.fragment,KM(o),gi(o),o.component??o._loadedComponent??null,o,XM(o)),m=nv(f,a,this.paramsInheritanceStrategy);f.params=Object.freeze(m.params),f.data=Object.freeze(m.data);let h=this.applyRedirects.applyRedirectCommands(u,o.redirectTo,d,f,n);return this.applyRedirects.lineralizeSegments(o,h).pipe($n(g=>this.processSegment(n,r,e,g.concat(p),s,!1,a)))}matchSegmentAgainstRoute(n,e,r,o,i,s){let a=PJ(e,r,o,n,this.urlSerializer);return r.path==="**"&&(e.children={}),a.pipe(so(l=>l.matched?(n=r._injector??n,this.getChildConfig(n,r,o).pipe(so(({routes:c})=>{let u=r._loadedInjector??n,{parameters:d,consumedSegments:p,remainingSegments:f}=l,m=new Fp(p,d,Object.freeze(he({},this.urlTree.queryParams)),this.urlTree.fragment,KM(r),gi(r),r.component??r._loadedComponent??null,r,XM(r)),h=nv(m,s,this.paramsInheritanceStrategy);m.params=Object.freeze(h.params),m.data=Object.freeze(h.data);let{segmentGroup:g,slicedSegments:y}=qM(e,p,f,c);if(y.length===0&&g.hasChildren())return this.processChildren(u,c,g,m).pipe(nt(S=>new po(m,S)));if(c.length===0&&y.length===0)return qe(new po(m,[]));let v=gi(r)===i;return this.processSegment(u,c,g,y,v?rt:i,!0,m).pipe(nt(S=>new po(m,S instanceof po?[S]:[])))}))):Rp(e)))}getChildConfig(n,e,r){return e.children?qe({routes:e.children,injector:n}):e.loadChildren?e._loadedRoutes!==void 0?qe({routes:e._loadedRoutes,injector:e._loadedInjector}):RJ(n,e,r,this.urlSerializer).pipe($n(o=>o?this.configLoader.loadChildren(n,e).pipe(Gn(i=>{e._loadedRoutes=i.routes,e._loadedInjector=i.injector})):FJ(e))):qe({routes:[],injector:n})}};function WJ(t){t.sort((n,e)=>n.value.outlet===rt?-1:e.value.outlet===rt?1:n.value.outlet.localeCompare(e.value.outlet))}function HJ(t){let n=t.value.routeConfig;return n&&n.path===""}function vF(t){let n=[],e=new Set;for(let r of t){if(!HJ(r)){n.push(r);continue}let o=n.find(i=>r.value.routeConfig===i.value.routeConfig);o!==void 0?(o.children.push(...r.children),e.add(o)):n.push(r)}for(let r of e){let o=vF(r.children);n.push(new po(r.value,o))}return n.filter(r=>!e.has(r))}function KM(t){return t.data||{}}function XM(t){return t.resolve||{}}function qJ(t,n,e,r,o,i){return $n(s=>jJ(t,n,e,r,s.extractedUrl,o,i).pipe(nt(({state:a,tree:l})=>Ze(he({},s),{targetSnapshot:a,urlAfterRedirects:l}))))}function KJ(t,n){return $n(e=>{let{targetSnapshot:r,guards:{canActivateChecks:o}}=e;if(!o.length)return qe(e);let i=new Set(o.map(l=>l.route)),s=new Set;for(let l of i)if(!s.has(l))for(let c of bF(l))s.add(c);let a=0;return fn(s).pipe(fl(l=>i.has(l)?XJ(l,r,t,n):(l.data=nv(l,l.parent,t).resolve,qe(void 0))),Gn(()=>a++),ap(1),$n(l=>a===s.size?qe(e):Pr))})}function bF(t){let n=t.children.map(e=>bF(e)).flat();return[t,...n]}function XJ(t,n,e,r){let o=t.routeConfig,i=t._resolve;return o?.title!==void 0&&!pF(o)&&(i[qh]=o.title),YJ(i,t,n,r).pipe(nt(s=>(t._resolvedData=s,t.data=nv(t,t.parent,e).resolve,null)))}function YJ(t,n,e,r){let o=RE(t);if(o.length===0)return qe({});let i={};return fn(o).pipe($n(s=>QJ(t[s],n,e,r).pipe(vs(),Gn(a=>{if(a instanceof Gh)throw ov(new Lh,a);i[s]=a}))),ap(1),nt(()=>i),pl(s=>gF(s)?Pr:ip(s)))}function QJ(t,n,e,r){let o=Kh(n)??r,i=Bp(t,o),s=i.resolve?i.resolve(n,e):rr(o,()=>i(n,e));return Nl(s)}function kE(t){return so(n=>{let e=t(n);return e?fn(e).pipe(nt(()=>n)):qe(n)})}var wF=(()=>{class t{buildTitle(e){let r,o=e.root;for(;o!==void 0;)r=this.getResolvedTitleForRoute(o)??r,o=o.children.find(i=>i.outlet===rt);return r}getResolvedTitleForRoute(e){return e.data[qh]}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>de(ZJ),providedIn:"root"})}return t})(),ZJ=(()=>{class t extends wF{title;constructor(e){super(),this.title=e}updateTitle(e){let r=this.buildTitle(e);r!==void 0&&this.title.setTitle(r)}static \u0275fac=function(r){return new(r||t)($e(UM))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),l1=new Me("",{providedIn:"root",factory:()=>({})}),JJ=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275cmp=Pt({type:t,selectors:[["ng-component"]],exportAs:["emptyRouterOutlet"],decls:1,vars:0,template:function(r,o){r&1&&j(0,"router-outlet")},dependencies:[s1],encapsulation:2})}return t})();function c1(t){let n=t.children&&t.children.map(c1),e=n?Ze(he({},t),{children:n}):he({},t);return!e.component&&!e.loadComponent&&(n||e.loadChildren)&&e.outlet&&e.outlet!==rt&&(e.component=JJ),e}var u1=new Me(""),eee=(()=>{class t{componentLoaders=new WeakMap;childrenLoaders=new WeakMap;onLoadStartListener;onLoadEndListener;compiler=de(nE);loadComponent(e){if(this.componentLoaders.get(e))return this.componentLoaders.get(e);if(e._loadedComponent)return qe(e._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(e);let r=Nl(e.loadComponent()).pipe(nt(CF),Gn(i=>{this.onLoadEndListener&&this.onLoadEndListener(e),e._loadedComponent=i}),au(()=>{this.componentLoaders.delete(e)})),o=new op(r,()=>new Pn).pipe(rp());return this.componentLoaders.set(e,o),o}loadChildren(e,r){if(this.childrenLoaders.get(r))return this.childrenLoaders.get(r);if(r._loadedRoutes)return qe({routes:r._loadedRoutes,injector:r._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(r);let i=tee(r,this.compiler,e,this.onLoadEndListener).pipe(au(()=>{this.childrenLoaders.delete(r)})),s=new op(i,()=>new Pn).pipe(rp());return this.childrenLoaders.set(r,s),s}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function tee(t,n,e,r){return Nl(t.loadChildren()).pipe(nt(CF),$n(o=>o instanceof fh||Array.isArray(o)?qe(o):fn(n.compileModuleAsync(o))),nt(o=>{r&&r(t);let i,s,a=!1;return Array.isArray(o)?(s=o,a=!0):(i=o.create(e).injector,s=i.get(u1,[],{optional:!0,self:!0}).flat()),{routes:s.map(c1),injector:i}}))}function nee(t){return t&&typeof t=="object"&&"default"in t}function CF(t){return nee(t)?t.default:t}var d1=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>de(ree),providedIn:"root"})}return t})(),ree=(()=>{class t{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,r){return e}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),oee=new Me("");var iee=new Me(""),see=(()=>{class t{currentNavigation=null;currentTransition=null;lastSuccessfulNavigation=null;events=new Pn;transitionAbortSubject=new Pn;configLoader=de(eee);environmentInjector=de(Br);destroyRef=de(Ip);urlSerializer=de(o1);rootContexts=de(sv);location=de(Sh);inputBindingEnabled=de(a1,{optional:!0})!==null;titleStrategy=de(wF);options=de(l1,{optional:!0})||{};paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly";urlHandlingStrategy=de(d1);createViewTransition=de(oee,{optional:!0});navigationErrorHandler=de(iee,{optional:!0});navigationId=0;get hasRequestedNavigation(){return this.navigationId!==0}transitions;afterPreactivation=()=>qe(void 0);rootComponentType=null;destroyed=!1;constructor(){let e=o=>this.events.next(new zE(o)),r=o=>this.events.next(new UE(o));this.configLoader.onLoadEndListener=r,this.configLoader.onLoadStartListener=e,this.destroyRef.onDestroy(()=>{this.destroyed=!0})}complete(){this.transitions?.complete()}handleNavigationRequest(e){let r=++this.navigationId;this.transitions?.next(Ze(he(he({},this.transitions.value),e),{id:r}))}setupNavigations(e,r,o){return this.transitions=new tr({id:0,currentUrlTree:r,currentRawUrl:r,extractedUrl:this.urlHandlingStrategy.extract(r),urlAfterRedirects:this.urlHandlingStrategy.extract(r),rawUrl:r,extras:{},resolve:()=>{},reject:()=>{},promise:Promise.resolve(!0),source:Ph,restoredState:null,currentSnapshot:o.snapshot,targetSnapshot:null,currentRouterState:o,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(io(i=>i.id!==0),nt(i=>Ze(he({},i),{extractedUrl:this.urlHandlingStrategy.extract(i.rawUrl)})),so(i=>{let s=!1,a=!1;return qe(i).pipe(so(l=>{if(this.navigationId>i.id)return this.cancelNavigationTransition(i,"",fo.SupersededByNewNavigation),Pr;this.currentTransition=i,this.currentNavigation={id:l.id,initialUrl:l.rawUrl,extractedUrl:l.extractedUrl,targetBrowserUrl:typeof l.extras.browserUrl=="string"?this.urlSerializer.parse(l.extras.browserUrl):l.extras.browserUrl,trigger:l.source,extras:l.extras,previousNavigation:this.lastSuccessfulNavigation?Ze(he({},this.lastSuccessfulNavigation),{previousNavigation:null}):null};let c=!e.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),u=l.extras.onSameUrlNavigation??e.onSameUrlNavigation;if(!c&&u!=="reload"){let d="";return this.events.next(new ku(l.id,this.urlSerializer.serialize(l.rawUrl),d,PE.IgnoredSameUrlNavigation)),l.resolve(!1),Pr}if(this.urlHandlingStrategy.shouldProcessUrl(l.rawUrl))return qe(l).pipe(so(d=>{let p=this.transitions?.getValue();return this.events.next(new Bh(d.id,this.urlSerializer.serialize(d.extractedUrl),d.source,d.restoredState)),p!==this.transitions?.getValue()?Pr:Promise.resolve(d)}),qJ(this.environmentInjector,this.configLoader,this.rootComponentType,e.config,this.urlSerializer,this.paramsInheritanceStrategy),Gn(d=>{i.targetSnapshot=d.targetSnapshot,i.urlAfterRedirects=d.urlAfterRedirects,this.currentNavigation=Ze(he({},this.currentNavigation),{finalUrl:d.urlAfterRedirects});let p=new J0(d.id,this.urlSerializer.serialize(d.extractedUrl),this.urlSerializer.serialize(d.urlAfterRedirects),d.targetSnapshot);this.events.next(p)}));if(c&&this.urlHandlingStrategy.shouldProcessUrl(l.currentRawUrl)){let{id:d,extractedUrl:p,source:f,restoredState:m,extras:h}=l,g=new Bh(d,this.urlSerializer.serialize(p),f,m);this.events.next(g);let y=uF(this.rootComponentType).snapshot;return this.currentTransition=i=Ze(he({},l),{targetSnapshot:y,urlAfterRedirects:p,extras:Ze(he({},h),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=p,qe(i)}else{let d="";return this.events.next(new ku(l.id,this.urlSerializer.serialize(l.extractedUrl),d,PE.IgnoredByUrlHandlingStrategy)),l.resolve(!1),Pr}}),Gn(l=>{let c=new $E(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot);this.events.next(c)}),nt(l=>(this.currentTransition=i=Ze(he({},l),{guards:fJ(l.targetSnapshot,l.currentSnapshot,this.rootContexts)}),i)),_J(this.environmentInjector,l=>this.events.next(l)),Gn(l=>{if(i.guardsResult=l.guardsResult,l.guardsResult&&typeof l.guardsResult!="boolean")throw ov(this.urlSerializer,l.guardsResult);let c=new LE(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects),l.targetSnapshot,!!l.guardsResult);this.events.next(c)}),io(l=>l.guardsResult?!0:(this.cancelNavigationTransition(l,"",fo.GuardRejected),!1)),kE(l=>{if(l.guards.canActivateChecks.length)return qe(l).pipe(Gn(c=>{let u=new VE(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}),so(c=>{let u=!1;return qe(c).pipe(KJ(this.paramsInheritanceStrategy,this.environmentInjector),Gn({next:()=>u=!0,complete:()=>{u||this.cancelNavigationTransition(c,"",fo.NoDataFromResolver)}}))}),Gn(c=>{let u=new BE(c.id,this.urlSerializer.serialize(c.extractedUrl),this.urlSerializer.serialize(c.urlAfterRedirects),c.targetSnapshot);this.events.next(u)}))}),kE(l=>{let c=u=>{let d=[];u.routeConfig?.loadComponent&&!u.routeConfig._loadedComponent&&d.push(this.configLoader.loadComponent(u.routeConfig).pipe(Gn(p=>{u.component=p}),nt(()=>{})));for(let p of u.children)d.push(...c(p));return d};return gx(c(l.targetSnapshot.root)).pipe(ml(null),xs(1))}),kE(()=>this.afterPreactivation()),so(()=>{let{currentSnapshot:l,targetSnapshot:c}=i,u=this.createViewTransition?.(this.environmentInjector,l.root,c.root);return u?fn(u).pipe(nt(()=>i)):qe(i)}),nt(l=>{let c=lJ(e.routeReuseStrategy,l.targetSnapshot,l.currentRouterState);return this.currentTransition=i=Ze(he({},l),{targetRouterState:c}),this.currentNavigation.targetRouterState=c,i}),Gn(()=>{this.events.next(new Uh)}),pJ(this.rootContexts,e.routeReuseStrategy,l=>this.events.next(l),this.inputBindingEnabled),xs(1),Gn({next:l=>{s=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new Dl(l.id,this.urlSerializer.serialize(l.extractedUrl),this.urlSerializer.serialize(l.urlAfterRedirects))),this.titleStrategy?.updateTitle(l.targetRouterState.snapshot),l.resolve(!0)},complete:()=>{s=!0}}),h_(this.transitionAbortSubject.pipe(Gn(l=>{throw l}))),au(()=>{!s&&!a&&this.cancelNavigationTransition(i,"",fo.SupersededByNewNavigation),this.currentTransition?.id===i.id&&(this.currentNavigation=null,this.currentTransition=null)}),pl(l=>{if(this.destroyed)return i.resolve(!1),Pr;if(a=!0,hF(l))this.events.next(new Bs(i.id,this.urlSerializer.serialize(i.extractedUrl),l.message,l.cancellationCode)),dJ(l)?this.events.next(new Lp(l.url,l.navigationBehaviorOptions)):i.resolve(!1);else{let c=new zh(i.id,this.urlSerializer.serialize(i.extractedUrl),l,i.targetSnapshot??void 0);try{let u=rr(this.environmentInjector,()=>this.navigationErrorHandler?.(c));if(u instanceof Gh){let{message:d,cancellationCode:p}=ov(this.urlSerializer,u);this.events.next(new Bs(i.id,this.urlSerializer.serialize(i.extractedUrl),d,p)),this.events.next(new Lp(u.redirectTo,u.navigationBehaviorOptions))}else throw this.events.next(c),l}catch(u){this.options.resolveNavigationPromiseOnError?i.resolve(!1):i.reject(u)}}return Pr}))}))}cancelNavigationTransition(e,r,o){let i=new Bs(e.id,this.urlSerializer.serialize(e.extractedUrl),r,o);this.events.next(i),e.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){let e=this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))),r=this.currentNavigation?.targetBrowserUrl??this.currentNavigation?.extractedUrl;return e.toString()!==r?.toString()&&!this.currentNavigation?.extras.skipLocationChange}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function aee(t){return t!==Ph}var lee=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>de(cee),providedIn:"root"})}return t})(),r1=class{shouldDetach(n){return!1}store(n,e){}shouldAttach(n){return!1}retrieve(n){return null}shouldReuseRoute(n,e){return n.routeConfig===e.routeConfig}},cee=(()=>{class t extends r1{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),SF=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:()=>de(uee),providedIn:"root"})}return t})(),uee=(()=>{class t extends SF{location=de(Sh);urlSerializer=de(o1);options=de(l1,{optional:!0})||{};canceledNavigationResolution=this.options.canceledNavigationResolution||"replace";urlHandlingStrategy=de(d1);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";currentUrlTree=new zs;getCurrentUrlTree(){return this.currentUrlTree}rawUrlTree=this.currentUrlTree;getRawUrlTree(){return this.rawUrlTree}currentPageId=0;lastSuccessfulId=-1;restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}routerState=uF(null);getRouterState(){return this.routerState}stateMemento=this.createStateMemento();createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(e){return this.location.subscribe(r=>{r.type==="popstate"&&e(r.url,r.state)})}handleRouterEvent(e,r){if(e instanceof Bh)this.stateMemento=this.createStateMemento();else if(e instanceof ku)this.rawUrlTree=r.initialUrl;else if(e instanceof J0){if(this.urlUpdateStrategy==="eager"&&!r.extras.skipLocationChange){let o=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl);this.setBrowserUrl(r.targetBrowserUrl??o,r)}}else e instanceof Uh?(this.currentUrlTree=r.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(r.finalUrl,r.initialUrl),this.routerState=r.targetRouterState,this.urlUpdateStrategy==="deferred"&&!r.extras.skipLocationChange&&this.setBrowserUrl(r.targetBrowserUrl??this.rawUrlTree,r)):e instanceof Bs&&(e.code===fo.GuardRejected||e.code===fo.NoDataFromResolver)?this.restoreHistory(r):e instanceof zh?this.restoreHistory(r,!0):e instanceof Dl&&(this.lastSuccessfulId=e.id,this.currentPageId=this.browserPageId)}setBrowserUrl(e,r){let o=e instanceof zs?this.urlSerializer.serialize(e):e;if(this.location.isCurrentPathEqualTo(o)||r.extras.replaceUrl){let i=this.browserPageId,s=he(he({},r.extras.state),this.generateNgRouterState(r.id,i));this.location.replaceState(o,"",s)}else{let i=he(he({},r.extras.state),this.generateNgRouterState(r.id,this.browserPageId+1));this.location.go(o,"",i)}}restoreHistory(e,r=!1){if(this.canceledNavigationResolution==="computed"){let o=this.browserPageId,i=this.currentPageId-o;i!==0?this.location.historyGo(i):this.currentUrlTree===e.finalUrl&&i===0&&(this.resetState(e),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(r&&this.resetState(e),this.resetUrlToCurrentUrlTree())}resetState(e){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,e.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(e,r){return this.canceledNavigationResolution==="computed"?{navigationId:e,\u0275routerPageId:r}:{navigationId:e}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function dee(t,n){t.events.pipe(io(e=>e instanceof Dl||e instanceof Bs||e instanceof zh||e instanceof ku),nt(e=>e instanceof Dl||e instanceof ku?0:(e instanceof Bs?e.code===fo.Redirect||e.code===fo.SupersededByNewNavigation:!1)?2:1),io(e=>e!==2),xs(1)).subscribe(()=>{n()})}var pee={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},fee={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},mo=(()=>{class t{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}disposed=!1;nonRouterCurrentEntryChangeSubscription;console=de(eE);stateManager=de(SF);options=de(l1,{optional:!0})||{};pendingTasks=de(As);urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred";navigationTransitions=de(see);urlSerializer=de(o1);location=de(Sh);urlHandlingStrategy=de(d1);_events=new Pn;get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}navigated=!1;routeReuseStrategy=de(lee);onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore";config=de(u1,{optional:!0})?.flat()??[];componentInputBindingEnabled=!!de(a1,{optional:!0});constructor(){this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:e=>{this.console.warn(e)}}),this.subscribeToNavigationEvents()}eventsSubscription=new _n;subscribeToNavigationEvents(){let e=this.navigationTransitions.events.subscribe(r=>{try{let o=this.navigationTransitions.currentTransition,i=this.navigationTransitions.currentNavigation;if(o!==null&&i!==null){if(this.stateManager.handleRouterEvent(r,i),r instanceof Bs&&r.code!==fo.Redirect&&r.code!==fo.SupersededByNewNavigation)this.navigated=!0;else if(r instanceof Dl)this.navigated=!0;else if(r instanceof Lp){let s=r.navigationBehaviorOptions,a=this.urlHandlingStrategy.merge(r.url,o.currentRawUrl),l=he({browserUrl:o.extras.browserUrl,info:o.extras.info,skipLocationChange:o.extras.skipLocationChange,replaceUrl:o.extras.replaceUrl||this.urlUpdateStrategy==="eager"||aee(o.source)},s);this.scheduleNavigation(a,Ph,null,l,{resolve:o.resolve,reject:o.reject,promise:o.promise})}}hee(r)&&this._events.next(r)}catch(o){this.navigationTransitions.transitionAbortSubject.next(o)}});this.eventsSubscription.add(e)}resetRootComponentType(e){this.routerState.root.component=e,this.navigationTransitions.rootComponentType=e}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),Ph,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((e,r)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(e,"popstate",r)},0)})}navigateToSyncWithBrowser(e,r,o){let i={replaceUrl:!0},s=o?.navigationId?o:null;if(o){let l=he({},o);delete l.navigationId,delete l.\u0275routerPageId,Object.keys(l).length!==0&&(i.state=l)}let a=this.parseUrl(e);this.scheduleNavigation(a,r,s,i)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(e){this.config=e.map(c1),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this._events.unsubscribe(),this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(e,r={}){let{relativeTo:o,queryParams:i,fragment:s,queryParamsHandling:a,preserveFragment:l}=r,c=l?this.currentUrlTree.fragment:s,u=null;switch(a??this.options.defaultQueryParamsHandling){case"merge":u=he(he({},this.currentUrlTree.queryParams),i);break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=i||null}u!==null&&(u=this.removeEmptyProps(u));let d;try{let p=o?o.snapshot:this.routerState.snapshot.root;d=sF(p)}catch{(typeof e[0]!="string"||e[0][0]!=="/")&&(e=[]),d=this.currentUrlTree.root}return aF(d,e,u,c??null)}navigateByUrl(e,r={skipLocationChange:!1}){let o=Nu(e)?e:this.parseUrl(e),i=this.urlHandlingStrategy.merge(o,this.rawUrlTree);return this.scheduleNavigation(i,Ph,null,r)}navigate(e,r={skipLocationChange:!1}){return mee(e),this.navigateByUrl(this.createUrlTree(e,r),r)}serializeUrl(e){return this.urlSerializer.serialize(e)}parseUrl(e){try{return this.urlSerializer.parse(e)}catch{return this.urlSerializer.parse("/")}}isActive(e,r){let o;if(r===!0?o=he({},pee):r===!1?o=he({},fee):o=r,Nu(e))return jM(this.currentUrlTree,e,o);let i=this.parseUrl(e);return jM(this.currentUrlTree,i,o)}removeEmptyProps(e){return Object.entries(e).reduce((r,[o,i])=>(i!=null&&(r[o]=i),r),{})}scheduleNavigation(e,r,o,i,s){if(this.disposed)return Promise.resolve(!1);let a,l,c;s?(a=s.resolve,l=s.reject,c=s.promise):c=new Promise((d,p)=>{a=d,l=p});let u=this.pendingTasks.add();return dee(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(u))}),this.navigationTransitions.handleNavigationRequest({source:r,restoredState:o,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:e,extras:i,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();function mee(t){for(let n=0;n<t.length;n++)if(t[n]==null)throw new De(4008,!1)}function hee(t){return!(t instanceof Uh)&&!(t instanceof Lp)}var Kr=(()=>{class t{router;route;tabIndexAttribute;renderer;el;locationStrategy;href=null;target;queryParams;fragment;queryParamsHandling;state;info;relativeTo;isAnchorElement;subscription;onChanges=new Pn;constructor(e,r,o,i,s,a){this.router=e,this.route=r,this.tabIndexAttribute=o,this.renderer=i,this.el=s,this.locationStrategy=a;let l=s.nativeElement.tagName?.toLowerCase();this.isAnchorElement=l==="a"||l==="area",this.isAnchorElement?this.subscription=e.events.subscribe(c=>{c instanceof Dl&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}preserveFragment=!1;skipLocationChange=!1;replaceUrl=!1;setTabIndexIfNotOnNativeEl(e){this.tabIndexAttribute!=null||this.isAnchorElement||this.applyAttributeValue("tabindex",e)}ngOnChanges(e){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}routerLinkInput=null;set routerLink(e){e==null?(this.routerLinkInput=null,this.setTabIndexIfNotOnNativeEl(null)):(Nu(e)?this.routerLinkInput=e:this.routerLinkInput=Array.isArray(e)?e:[e],this.setTabIndexIfNotOnNativeEl("0"))}onClick(e,r,o,i,s){let a=this.urlTree;if(a===null||this.isAnchorElement&&(e!==0||r||o||i||s||typeof this.target=="string"&&this.target!="_self"))return!0;let l={skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state,info:this.info};return this.router.navigateByUrl(a,l),!this.isAnchorElement}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){let e=this.urlTree;this.href=e!==null&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(e)):null;let r=this.href===null?null:Y2(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",r)}applyAttributeValue(e,r){let o=this.renderer,i=this.el.nativeElement;r!==null?o.setAttribute(i,e,r):o.removeAttribute(i,e)}get urlTree(){return this.routerLinkInput===null?null:Nu(this.routerLinkInput)?this.routerLinkInput:this.router.createUrlTree(this.routerLinkInput,{relativeTo:this.relativeTo!==void 0?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}static \u0275fac=function(r){return new(r||t)(oe(mo),oe(yi),DI("tabindex"),oe(mi),oe(Ro),oe(Ap))};static \u0275dir=kt({type:t,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(r,o){r&1&&fe("click",function(s){return o.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),r&2&&Dp("target",o.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",info:"info",relativeTo:"relativeTo",preserveFragment:[2,"preserveFragment","preserveFragment",Iu],skipLocationChange:[2,"skipLocationChange","skipLocationChange",Iu],replaceUrl:[2,"replaceUrl","replaceUrl",Iu],routerLink:"routerLink"},features:[ZI,pi]})}return t})();var gee=new Me("");function _F(t,...n){return Sp([{provide:u1,multi:!0,useValue:t},[],{provide:yi,useFactory:yee,deps:[mo]},{provide:_0,multi:!0,useFactory:xee},n.map(e=>e.\u0275providers)])}function yee(t){return t.routerState.root}function xee(){let t=de(Wn);return n=>{let e=t.get(Es);if(n!==e.components[0])return;let r=t.get(mo),o=t.get(vee);t.get(bee)===1&&r.initialNavigation(),t.get(wee,null,st.Optional)?.setUpPreloading(),t.get(gee,null,st.Optional)?.init(),r.resetRootComponentType(e.componentTypes[0]),o.closed||(o.next(),o.complete(),o.unsubscribe())}}var vee=new Me("",{factory:()=>new Pn}),bee=new Me("",{providedIn:"root",factory:()=>1});var wee=new Me("");var IF=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-OBK227YL.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)};var Qh=class extends Error{constructor(n,e="FunctionsError",r){super(n),this.name=e,this.context=r}},lv=class extends Qh{constructor(n){super("Failed to send a request to the Edge Function","FunctionsFetchError",n)}},cv=class extends Qh{constructor(n){super("Relay Error invoking the Edge Function","FunctionsRelayError",n)}},uv=class extends Qh{constructor(n){super("Edge Function returned a non-2xx status code","FunctionsHttpError",n)}},p1=function(t){return t.Any="any",t.ApNortheast1="ap-northeast-1",t.ApNortheast2="ap-northeast-2",t.ApSouth1="ap-south-1",t.ApSoutheast1="ap-southeast-1",t.ApSoutheast2="ap-southeast-2",t.CaCentral1="ca-central-1",t.EuCentral1="eu-central-1",t.EuWest1="eu-west-1",t.EuWest2="eu-west-2",t.EuWest3="eu-west-3",t.SaEast1="sa-east-1",t.UsEast1="us-east-1",t.UsWest1="us-west-1",t.UsWest2="us-west-2",t}(p1||{});var Cee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Zh=class{constructor(n,{headers:e={},customFetch:r,region:o=p1.Any}={}){this.url=n,this.headers=e,this.region=o,this.fetch=IF(r)}setAuth(n){this.headers.Authorization=`Bearer ${n}`}invoke(n,e={}){var r;return Cee(this,void 0,void 0,function*(){try{let{headers:o,method:i,body:s}=e,a={},{region:l}=e;l||(l=this.region),l&&l!=="any"&&(a["x-region"]=l);let c;s&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)&&(typeof Blob<"u"&&s instanceof Blob||s instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",c=s):typeof s=="string"?(a["Content-Type"]="text/plain",c=s):typeof FormData<"u"&&s instanceof FormData?c=s:(a["Content-Type"]="application/json",c=JSON.stringify(s)));let u=yield this.fetch(`${this.url}/${n}`,{method:i||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),o),body:c}).catch(m=>{throw new lv(m)}),d=u.headers.get("x-relay-error");if(d&&d==="true")throw new cv(u);if(!u.ok)throw new uv(u);let p=((r=u.headers.get("Content-Type"))!==null&&r!==void 0?r:"text/plain").split(";")[0].trim(),f;return p==="application/json"?f=yield u.json():p==="application/octet-stream"?f=yield u.blob():p==="text/event-stream"?f=u:p==="multipart/form-data"?f=yield u.formData():f=yield u.text(),{data:f,error:null}}catch(o){return{data:null,error:o}}})}};var LF=Ym($F(),1),{PostgrestClient:VF,PostgrestQueryBuilder:F1e,PostgrestFilterBuilder:P1e,PostgrestTransformBuilder:$1e,PostgrestBuilder:L1e,PostgrestError:Mee}=LF.default;var BF="2.11.2";var zF={"X-Client-Info":`realtime-js/${BF}`},UF="1.0.0",mv=1e4,jF=1e3,Up=function(t){return t[t.connecting=0]="connecting",t[t.open=1]="open",t[t.closing=2]="closing",t[t.closed=3]="closed",t}(Up||{}),ho=function(t){return t.closed="closed",t.errored="errored",t.joined="joined",t.joining="joining",t.leaving="leaving",t}(ho||{}),Lo=function(t){return t.close="phx_close",t.error="phx_error",t.join="phx_join",t.reply="phx_reply",t.leave="phx_leave",t.access_token="access_token",t}(Lo||{}),_1=function(t){return t.websocket="websocket",t}(_1||{}),Au=function(t){return t.Connecting="connecting",t.Open="open",t.Closing="closing",t.Closed="closed",t}(Au||{});var hv=class{constructor(){this.HEADER_LENGTH=1}decode(n,e){return n.constructor===ArrayBuffer?e(this._binaryDecode(n)):e(typeof n=="string"?JSON.parse(n):{})}_binaryDecode(n){let e=new DataView(n),r=new TextDecoder;return this._decodeBroadcast(n,e,r)}_decodeBroadcast(n,e,r){let o=e.getUint8(1),i=e.getUint8(2),s=this.HEADER_LENGTH+2,a=r.decode(n.slice(s,s+o));s=s+o;let l=r.decode(n.slice(s,s+i));s=s+i;let c=JSON.parse(r.decode(n.slice(s,n.byteLength)));return{ref:null,topic:a,event:l,payload:c}}};var jp=class{constructor(n,e){this.callback=n,this.timerCalc=e,this.timer=void 0,this.tries=0,this.callback=n,this.timerCalc=e}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var sn=function(t){return t.abstime="abstime",t.bool="bool",t.date="date",t.daterange="daterange",t.float4="float4",t.float8="float8",t.int2="int2",t.int4="int4",t.int4range="int4range",t.int8="int8",t.int8range="int8range",t.json="json",t.jsonb="jsonb",t.money="money",t.numeric="numeric",t.oid="oid",t.reltime="reltime",t.text="text",t.time="time",t.timestamp="timestamp",t.timestamptz="timestamptz",t.timetz="timetz",t.tsrange="tsrange",t.tstzrange="tstzrange",t}(sn||{}),E1=(t,n,e={})=>{var r;let o=(r=e.skipTypes)!==null&&r!==void 0?r:[];return Object.keys(n).reduce((i,s)=>(i[s]=Fee(s,t,n,o),i),{})},Fee=(t,n,e,r)=>{let o=n.find(a=>a.name===t),i=o?.type,s=e[t];return i&&!r.includes(i)?GF(i,s):I1(s)},GF=(t,n)=>{if(t.charAt(0)==="_"){let e=t.slice(1,t.length);return Vee(n,e)}switch(t){case sn.bool:return Pee(n);case sn.float4:case sn.float8:case sn.int2:case sn.int4:case sn.int8:case sn.numeric:case sn.oid:return $ee(n);case sn.json:case sn.jsonb:return Lee(n);case sn.timestamp:return Bee(n);case sn.abstime:case sn.date:case sn.daterange:case sn.int4range:case sn.int8range:case sn.money:case sn.reltime:case sn.text:case sn.time:case sn.timestamptz:case sn.timetz:case sn.tsrange:case sn.tstzrange:return I1(n);default:return I1(n)}},I1=t=>t,Pee=t=>{switch(t){case"t":return!0;case"f":return!1;default:return t}},$ee=t=>{if(typeof t=="string"){let n=parseFloat(t);if(!Number.isNaN(n))return n}return t},Lee=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(n){return console.log(`JSON parse error: ${n}`),t}return t},Vee=(t,n)=>{if(typeof t!="string")return t;let e=t.length-1,r=t[e];if(t[0]==="{"&&r==="}"){let i,s=t.slice(1,e);try{i=JSON.parse("["+s+"]")}catch{i=s?s.split(","):[]}return i.map(a=>GF(n,a))}return t},Bee=t=>typeof t=="string"?t.replace(" ","T"):t,gv=t=>{let n=t;return n=n.replace(/^ws/i,"http"),n=n.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),n.replace(/\/+$/,"")};var Gp=class{constructor(n,e,r={},o=mv){this.channel=n,this.event=e,this.payload=r,this.timeout=o,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(n){this.timeout=n,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(n){this.payload=Object.assign(Object.assign({},this.payload),n)}receive(n,e){var r;return this._hasReceived(n)&&e((r=this.receivedResp)===null||r===void 0?void 0:r.response),this.recHooks.push({status:n,callback:e}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let n=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},n),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(n,e){this.refEvent&&this.channel._trigger(this.refEvent,{status:n,response:e})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:n,response:e}){this.recHooks.filter(r=>r.status===n).forEach(r=>r.callback(e))}_hasReceived(n){return this.receivedResp&&this.receivedResp.status===n}};var ig=class t{constructor(n,e){this.channel=n,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};let r=e?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(r.state,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=t.syncState(this.state,o,i,s),this.pendingDiffs.forEach(l=>{this.state=t.syncDiff(this.state,l,i,s)}),this.pendingDiffs=[],a()}),this.channel._on(r.diff,{},o=>{let{onJoin:i,onLeave:s,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(o):(this.state=t.syncDiff(this.state,o,i,s),a())}),this.onJoin((o,i,s)=>{this.channel._trigger("presence",{event:"join",key:o,currentPresences:i,newPresences:s})}),this.onLeave((o,i,s)=>{this.channel._trigger("presence",{event:"leave",key:o,currentPresences:i,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(n,e,r,o){let i=this.cloneDeep(n),s=this.transformState(e),a={},l={};return this.map(i,(c,u)=>{s[c]||(l[c]=u)}),this.map(s,(c,u)=>{let d=i[c];if(d){let p=u.map(g=>g.presence_ref),f=d.map(g=>g.presence_ref),m=u.filter(g=>f.indexOf(g.presence_ref)<0),h=d.filter(g=>p.indexOf(g.presence_ref)<0);m.length>0&&(a[c]=m),h.length>0&&(l[c]=h)}else a[c]=u}),this.syncDiff(i,{joins:a,leaves:l},r,o)}static syncDiff(n,e,r,o){let{joins:i,leaves:s}={joins:this.transformState(e.joins),leaves:this.transformState(e.leaves)};return r||(r=()=>{}),o||(o=()=>{}),this.map(i,(a,l)=>{var c;let u=(c=n[a])!==null&&c!==void 0?c:[];if(n[a]=this.cloneDeep(l),u.length>0){let d=n[a].map(f=>f.presence_ref),p=u.filter(f=>d.indexOf(f.presence_ref)<0);n[a].unshift(...p)}r(a,u,l)}),this.map(s,(a,l)=>{let c=n[a];if(!c)return;let u=l.map(d=>d.presence_ref);c=c.filter(d=>u.indexOf(d.presence_ref)<0),n[a]=c,o(a,c,l),c.length===0&&delete n[a]}),n}static map(n,e){return Object.getOwnPropertyNames(n).map(r=>e(r,n[r]))}static transformState(n){return n=this.cloneDeep(n),Object.getOwnPropertyNames(n).reduce((e,r)=>{let o=n[r];return"metas"in o?e[r]=o.metas.map(i=>(i.presence_ref=i.phx_ref,delete i.phx_ref,delete i.phx_ref_prev,i)):e[r]=o,e},{})}static cloneDeep(n){return JSON.parse(JSON.stringify(n))}onJoin(n){this.caller.onJoin=n}onLeave(n){this.caller.onLeave=n}onSync(n){this.caller.onSync=n}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}};var Us=function(t){return t.SUBSCRIBED="SUBSCRIBED",t.TIMED_OUT="TIMED_OUT",t.CLOSED="CLOSED",t.CHANNEL_ERROR="CHANNEL_ERROR",t}(Us||{});var sg=class t{constructor(n,e={config:{}},r){this.topic=n,this.params=e,this.socket=r,this.bindings={},this.state=ho.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=n.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},e.config),this.timeout=this.socket.timeout,this.joinPush=new Gp(this,Lo.join,this.params,this.timeout),this.rejoinTimer=new jp(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=ho.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=ho.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=ho.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=ho.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Lo.reply,{},(o,i)=>{this._trigger(this._replyEventName(i),o)}),this.presence=new ig(this),this.broadcastEndpointURL=gv(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(n,e=this.timeout){var r,o;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:s,private:a}}=this.params;this._onError(u=>n?.(Us.CHANNEL_ERROR,u)),this._onClose(()=>n?.(Us.CLOSED));let l={},c={broadcast:i,presence:s,postgres_changes:(o=(r=this.bindings.postgres_changes)===null||r===void 0?void 0:r.map(u=>u.filter))!==null&&o!==void 0?o:[],private:a};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:c},l)),this.joinedOnce=!0,this._rejoin(e),this.joinPush.receive("ok",async({postgres_changes:u})=>{var d;if(this.socket.setAuth(),u===void 0){n?.(Us.SUBSCRIBED);return}else{let p=this.bindings.postgres_changes,f=(d=p?.length)!==null&&d!==void 0?d:0,m=[];for(let h=0;h<f;h++){let g=p[h],{filter:{event:y,schema:v,table:S,filter:C}}=g,I=u&&u[h];if(I&&I.event===y&&I.schema===v&&I.table===S&&I.filter===C)m.push(Object.assign(Object.assign({},g),{id:I.id}));else{this.unsubscribe(),n?.(Us.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,n&&n(Us.SUBSCRIBED);return}}).receive("error",u=>{n?.(Us.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(u).join(", ")||"error")))}).receive("timeout",()=>{n?.(Us.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(n,e={}){return await this.send({type:"presence",event:"track",payload:n},e.timeout||this.timeout)}async untrack(n={}){return await this.send({type:"presence",event:"untrack"},n)}on(n,e,r){return this._on(n,e,r)}async send(n,e={}){var r,o;if(!this._canPush()&&n.type==="broadcast"){let{event:i,payload:s}=n,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:s,private:this.private}]})};try{let c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(r=e.timeout)!==null&&r!==void 0?r:this.timeout);return await((o=c.body)===null||o===void 0?void 0:o.cancel()),c.ok?"ok":"error"}catch(c){return c.name==="AbortError"?"timed out":"error"}}else return new Promise(i=>{var s,a,l;let c=this._push(n.type,n,e.timeout||this.timeout);n.type==="broadcast"&&!(!((l=(a=(s=this.params)===null||s===void 0?void 0:s.config)===null||a===void 0?void 0:a.broadcast)===null||l===void 0)&&l.ack)&&i("ok"),c.receive("ok",()=>i("ok")),c.receive("error",()=>i("error")),c.receive("timeout",()=>i("timed out"))})}updateJoinPayload(n){this.joinPush.updatePayload(n)}unsubscribe(n=this.timeout){this.state=ho.leaving;let e=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Lo.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(r=>{let o=new Gp(this,Lo.leave,{},n);o.receive("ok",()=>{e(),r("ok")}).receive("timeout",()=>{e(),r("timed out")}).receive("error",()=>{r("error")}),o.send(),this._canPush()||o.trigger("ok",{})})}async _fetchWithTimeout(n,e,r){let o=new AbortController,i=setTimeout(()=>o.abort(),r),s=await this.socket.fetch(n,Object.assign(Object.assign({},e),{signal:o.signal}));return clearTimeout(i),s}_push(n,e,r=this.timeout){if(!this.joinedOnce)throw`tried to push '${n}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let o=new Gp(this,n,e,r);return this._canPush()?o.send():(o.startTimeout(),this.pushBuffer.push(o)),o}_onMessage(n,e,r){return e}_isMember(n){return this.topic===n}_joinRef(){return this.joinPush.ref}_trigger(n,e,r){var o,i;let s=n.toLocaleLowerCase(),{close:a,error:l,leave:c,join:u}=Lo;if(r&&[a,l,c,u].indexOf(s)>=0&&r!==this._joinRef())return;let p=this._onMessage(s,e,r);if(e&&!p)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(s)?(o=this.bindings.postgres_changes)===null||o===void 0||o.filter(f=>{var m,h,g;return((m=f.filter)===null||m===void 0?void 0:m.event)==="*"||((g=(h=f.filter)===null||h===void 0?void 0:h.event)===null||g===void 0?void 0:g.toLocaleLowerCase())===s}).map(f=>f.callback(p,r)):(i=this.bindings[s])===null||i===void 0||i.filter(f=>{var m,h,g,y,v,S;if(["broadcast","presence","postgres_changes"].includes(s))if("id"in f){let C=f.id,I=(m=f.filter)===null||m===void 0?void 0:m.event;return C&&((h=e.ids)===null||h===void 0?void 0:h.includes(C))&&(I==="*"||I?.toLocaleLowerCase()===((g=e.data)===null||g===void 0?void 0:g.type.toLocaleLowerCase()))}else{let C=(v=(y=f?.filter)===null||y===void 0?void 0:y.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return C==="*"||C===((S=e?.event)===null||S===void 0?void 0:S.toLocaleLowerCase())}else return f.type.toLocaleLowerCase()===s}).map(f=>{if(typeof p=="object"&&"ids"in p){let m=p.data,{schema:h,table:g,commit_timestamp:y,type:v,errors:S}=m;p=Object.assign(Object.assign({},{schema:h,table:g,commit_timestamp:y,eventType:v,new:{},old:{},errors:S}),this._getPayloadRecords(m))}f.callback(p,r)})}_isClosed(){return this.state===ho.closed}_isJoined(){return this.state===ho.joined}_isJoining(){return this.state===ho.joining}_isLeaving(){return this.state===ho.leaving}_replyEventName(n){return`chan_reply_${n}`}_on(n,e,r){let o=n.toLocaleLowerCase(),i={type:o,filter:e,callback:r};return this.bindings[o]?this.bindings[o].push(i):this.bindings[o]=[i],this}_off(n,e){let r=n.toLocaleLowerCase();return this.bindings[r]=this.bindings[r].filter(o=>{var i;return!(((i=o.type)===null||i===void 0?void 0:i.toLocaleLowerCase())===r&&t.isEqual(o.filter,e))}),this}static isEqual(n,e){if(Object.keys(n).length!==Object.keys(e).length)return!1;for(let r in n)if(n[r]!==e[r])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(n){this._on(Lo.close,{},n)}_onError(n){this._on(Lo.error,{},e=>n(e))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(n=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=ho.joining,this.joinPush.resend(n))}_getPayloadRecords(n){let e={new:{},old:{}};return(n.type==="INSERT"||n.type==="UPDATE")&&(e.new=E1(n.columns,n.record)),(n.type==="UPDATE"||n.type==="DELETE")&&(e.old=E1(n.columns,n.old_record)),e}};var Uee=()=>{},jee=typeof WebSocket<"u",Gee=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`,ag=class{constructor(n,e){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=zF,this.params={},this.timeout=mv,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=Uee,this.conn=null,this.sendBuffer=[],this.serializer=new hv,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=i=>{let s;return i?s=i:typeof fetch>"u"?s=(...a)=>import("./chunk-OBK227YL.js").then(({default:l})=>l(...a)):s=fetch,(...a)=>s(...a)},this.endPoint=`${n}/${_1.websocket}`,this.httpEndpoint=gv(n),e?.transport?this.transport=e.transport:this.transport=null,e?.params&&(this.params=e.params),e?.headers&&(this.headers=Object.assign(Object.assign({},this.headers),e.headers)),e?.timeout&&(this.timeout=e.timeout),e?.logger&&(this.logger=e.logger),e?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=e.heartbeatIntervalMs);let o=(r=e?.params)===null||r===void 0?void 0:r.apikey;if(o&&(this.accessTokenValue=o,this.apiKey=o),this.reconnectAfterMs=e?.reconnectAfterMs?e.reconnectAfterMs:i=>[1e3,2e3,5e3,1e4][i-1]||1e4,this.encode=e?.encode?e.encode:(i,s)=>s(JSON.stringify(i)),this.decode=e?.decode?e.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new jp(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(e?.fetch),e?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=e?.worker||!1,this.workerUrl=e?.workerUrl}this.accessToken=e?.accessToken||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(jee){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new T1(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),import("./chunk-KXFMP4GI.js").then(({default:n})=>{this.conn=new n(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:UF}))}disconnect(n,e){this.conn&&(this.conn.onclose=function(){},n?this.conn.close(n,e??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(n){let e=await n.unsubscribe();return this.channels.length===0&&this.disconnect(),e}async removeAllChannels(){let n=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),n}log(n,e,r){this.logger(n,e,r)}connectionState(){switch(this.conn&&this.conn.readyState){case Up.connecting:return Au.Connecting;case Up.open:return Au.Open;case Up.closing:return Au.Closing;default:return Au.Closed}}isConnected(){return this.connectionState()===Au.Open}channel(n,e={config:{}}){let r=new sg(`realtime:${n}`,e,this);return this.channels.push(r),r}push(n){let{topic:e,event:r,payload:o,ref:i}=n,s=()=>{this.encode(n,a=>{var l;(l=this.conn)===null||l===void 0||l.send(a)})};this.log("push",`${e} ${r} (${i})`,o),this.isConnected()?s():this.sendBuffer.push(s)}async setAuth(n=null){let e=n||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(e){let r=null;try{r=JSON.parse(atob(e.split(".")[1]))}catch{}if(r&&r.exp&&!(Math.floor(Date.now()/1e3)-r.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${r.exp}`);this.accessTokenValue=e,this.channels.forEach(o=>{e&&o.updateJoinPayload({access_token:e}),o.joinedOnce&&o._isJoined()&&o._push(Lo.access_token,{access_token:e})})}}async sendHeartbeat(){var n;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),(n=this.conn)===null||n===void 0||n.close(jF,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(n=>n()),this.sendBuffer=[])}_makeRef(){let n=this.ref+1;return n===this.ref?this.ref=0:this.ref=n,this.ref.toString()}_leaveOpenTopic(n){let e=this.channels.find(r=>r.topic===n&&(r._isJoined()||r._isJoining()));e&&(this.log("transport",`leaving duplicate topic "${n}"`),e.unsubscribe())}_remove(n){this.channels=this.channels.filter(e=>e._joinRef()!==n._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=n=>this._onConnError(n),this.conn.onmessage=n=>this._onConnMessage(n),this.conn.onclose=n=>this._onConnClose(n))}_onConnMessage(n){this.decode(n.data,e=>{let{topic:r,event:o,payload:i,ref:s}=e;s&&s===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${i.status||""} ${r} ${o} ${s&&"("+s+")"||""}`,i),this.channels.filter(a=>a._isMember(r)).forEach(a=>a._trigger(o,i,s)),this.stateChangeCallbacks.message.forEach(a=>a(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let n=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(n),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{e.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(n=>n())}_onConnClose(n){this.log("transport","close",n),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(e=>e(n))}_onConnError(n){this.log("transport",n.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(e=>e(n))}_triggerChanError(){this.channels.forEach(n=>n._trigger(Lo.error))}_appendParams(n,e){if(Object.keys(e).length===0)return n;let r=n.match(/\?/)?"&":"?",o=new URLSearchParams(e);return`${n}${r}${o}`}_workerObjectUrl(n){let e;if(n)e=n;else{let r=new Blob([Gee],{type:"application/javascript"});e=URL.createObjectURL(r)}return e}};var T1=class{constructor(n,e,r){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=Up.connecting,this.send=()=>{},this.url=null,this.url=n,this.close=r.close}};var Wp=class extends Error{constructor(n){super(n),this.__isStorageError=!0,this.name="StorageError"}};function Nn(t){return typeof t=="object"&&t!==null&&"__isStorageError"in t}var yv=class extends Wp{constructor(n,e){super(n),this.name="StorageApiError",this.status=e}toJSON(){return{name:this.name,message:this.message,status:this.status}}},Ru=class extends Wp{constructor(n,e){super(n),this.name="StorageUnknownError",this.originalError=e}};var Wee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},vv=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-OBK227YL.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},WF=()=>Wee(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("./chunk-OBK227YL.js")).Response:Response}),xv=t=>{if(Array.isArray(t))return t.map(e=>xv(e));if(typeof t=="function"||t!==Object(t))return t;let n={};return Object.entries(t).forEach(([e,r])=>{let o=e.replace(/([-_][a-z])/gi,i=>i.toUpperCase().replace(/[-_]/g,""));n[o]=xv(r)}),n};var Ou=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},D1=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),Hee=(t,n,e)=>Ou(void 0,void 0,void 0,function*(){let r=yield WF();t instanceof r&&!e?.noResolveJson?t.json().then(o=>{n(new yv(D1(o),t.status||500))}).catch(o=>{n(new Ru(D1(o),o))}):n(new Ru(D1(t),t))}),qee=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json"},n?.headers),r&&(o.body=JSON.stringify(r)),Object.assign(Object.assign({},o),e))};function lg(t,n,e,r,o,i){return Ou(this,void 0,void 0,function*(){return new Promise((s,a)=>{t(e,qee(n,r,o,i)).then(l=>{if(!l.ok)throw l;return r?.noResolveJson?l:l.json()}).then(l=>s(l)).catch(l=>Hee(l,a,r))})})}function Hp(t,n,e,r){return Ou(this,void 0,void 0,function*(){return lg(t,"GET",n,e,r)})}function Wi(t,n,e,r,o){return Ou(this,void 0,void 0,function*(){return lg(t,"POST",n,r,o,e)})}function HF(t,n,e,r,o){return Ou(this,void 0,void 0,function*(){return lg(t,"PUT",n,r,o,e)})}function qF(t,n,e,r){return Ou(this,void 0,void 0,function*(){return lg(t,"HEAD",n,Object.assign(Object.assign({},e),{noResolveJson:!0}),r)})}function bv(t,n,e,r,o){return Ou(this,void 0,void 0,function*(){return lg(t,"DELETE",n,r,o,e)})}var Xr=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Kee={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},KF={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},wv=class{constructor(n,e={},r,o){this.url=n,this.headers=e,this.bucketId=r,this.fetch=vv(o)}uploadOrUpdate(n,e,r,o){return Xr(this,void 0,void 0,function*(){try{let i,s=Object.assign(Object.assign({},KF),o),a=Object.assign(Object.assign({},this.headers),n==="POST"&&{"x-upsert":String(s.upsert)}),l=s.metadata;typeof Blob<"u"&&r instanceof Blob?(i=new FormData,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l)),i.append("",r)):typeof FormData<"u"&&r instanceof FormData?(i=r,i.append("cacheControl",s.cacheControl),l&&i.append("metadata",this.encodeMetadata(l))):(i=r,a["cache-control"]=`max-age=${s.cacheControl}`,a["content-type"]=s.contentType,l&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),o?.headers&&(a=Object.assign(Object.assign({},a),o.headers));let c=this._removeEmptyFolders(e),u=this._getFinalPath(c),d=yield this.fetch(`${this.url}/object/${u}`,Object.assign({method:n,body:i,headers:a},s?.duplex?{duplex:s.duplex}:{})),p=yield d.json();return d.ok?{data:{path:c,id:p.Id,fullPath:p.Key},error:null}:{data:null,error:p}}catch(i){if(Nn(i))return{data:null,error:i};throw i}})}upload(n,e,r){return Xr(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",n,e,r)})}uploadToSignedUrl(n,e,r,o){return Xr(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(n),s=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${s}`);a.searchParams.set("token",e);try{let l,c=Object.assign({upsert:KF.upsert},o),u=Object.assign(Object.assign({},this.headers),{"x-upsert":String(c.upsert)});typeof Blob<"u"&&r instanceof Blob?(l=new FormData,l.append("cacheControl",c.cacheControl),l.append("",r)):typeof FormData<"u"&&r instanceof FormData?(l=r,l.append("cacheControl",c.cacheControl)):(l=r,u["cache-control"]=`max-age=${c.cacheControl}`,u["content-type"]=c.contentType);let d=yield this.fetch(a.toString(),{method:"PUT",body:l,headers:u}),p=yield d.json();return d.ok?{data:{path:i,fullPath:p.Key},error:null}:{data:null,error:p}}catch(l){if(Nn(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(n,e){return Xr(this,void 0,void 0,function*(){try{let r=this._getFinalPath(n),o=Object.assign({},this.headers);e?.upsert&&(o["x-upsert"]="true");let i=yield Wi(this.fetch,`${this.url}/object/upload/sign/${r}`,{},{headers:o}),s=new URL(this.url+i.url),a=s.searchParams.get("token");if(!a)throw new Wp("No token returned by API");return{data:{signedUrl:s.toString(),path:n,token:a},error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}update(n,e,r){return Xr(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",n,e,r)})}move(n,e,r){return Xr(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers}),error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}copy(n,e,r){return Xr(this,void 0,void 0,function*(){try{return{data:{path:(yield Wi(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:n,destinationKey:e,destinationBucket:r?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}createSignedUrl(n,e,r){return Xr(this,void 0,void 0,function*(){try{let o=this._getFinalPath(n),i=yield Wi(this.fetch,`${this.url}/object/sign/${o}`,Object.assign({expiresIn:e},r?.transform?{transform:r.transform}:{}),{headers:this.headers}),s=r?.download?`&download=${r.download===!0?"":r.download}`:"";return i={signedUrl:encodeURI(`${this.url}${i.signedURL}${s}`)},{data:i,error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}createSignedUrls(n,e,r){return Xr(this,void 0,void 0,function*(){try{let o=yield Wi(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:e,paths:n},{headers:this.headers}),i=r?.download?`&download=${r.download===!0?"":r.download}`:"";return{data:o.map(s=>Object.assign(Object.assign({},s),{signedUrl:s.signedURL?encodeURI(`${this.url}${s.signedURL}${i}`):null})),error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}download(n,e){return Xr(this,void 0,void 0,function*(){let o=typeof e?.transform<"u"?"render/image/authenticated":"object",i=this.transformOptsToQueryString(e?.transform||{}),s=i?`?${i}`:"";try{let a=this._getFinalPath(n);return{data:yield(yield Hp(this.fetch,`${this.url}/${o}/${a}${s}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(Nn(a))return{data:null,error:a};throw a}})}info(n){return Xr(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{let r=yield Hp(this.fetch,`${this.url}/object/info/${e}`,{headers:this.headers});return{data:xv(r),error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}exists(n){return Xr(this,void 0,void 0,function*(){let e=this._getFinalPath(n);try{return yield qF(this.fetch,`${this.url}/object/${e}`,{headers:this.headers}),{data:!0,error:null}}catch(r){if(Nn(r)&&r instanceof Ru){let o=r.originalError;if([400,404].includes(o?.status))return{data:!1,error:r}}throw r}})}getPublicUrl(n,e){let r=this._getFinalPath(n),o=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&o.push(i);let a=typeof e?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(e?.transform||{});l!==""&&o.push(l);let c=o.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${r}${c}`)}}}remove(n){return Xr(this,void 0,void 0,function*(){try{return{data:yield bv(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:n},{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}list(n,e,r){return Xr(this,void 0,void 0,function*(){try{let o=Object.assign(Object.assign(Object.assign({},Kee),e),{prefix:n||""});return{data:yield Wi(this.fetch,`${this.url}/object/list/${this.bucketId}`,o,{headers:this.headers},r),error:null}}catch(o){if(Nn(o))return{data:null,error:o};throw o}})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){let e=[];return n.width&&e.push(`width=${n.width}`),n.height&&e.push(`height=${n.height}`),n.resize&&e.push(`resize=${n.resize}`),n.format&&e.push(`format=${n.format}`),n.quality&&e.push(`quality=${n.quality}`),e.join("&")}};var XF="2.7.1";var YF={"X-Client-Info":`storage-js/${XF}`};var qp=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Cv=class{constructor(n,e={},r){this.url=n,this.headers=Object.assign(Object.assign({},YF),e),this.fetch=vv(r)}listBuckets(){return qp(this,void 0,void 0,function*(){try{return{data:yield Hp(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(n){if(Nn(n))return{data:null,error:n};throw n}})}getBucket(n){return qp(this,void 0,void 0,function*(){try{return{data:yield Hp(this.fetch,`${this.url}/bucket/${n}`,{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}createBucket(n,e={public:!1}){return qp(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/bucket`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}updateBucket(n,e){return qp(this,void 0,void 0,function*(){try{return{data:yield HF(this.fetch,`${this.url}/bucket/${n}`,{id:n,name:n,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:this.headers}),error:null}}catch(r){if(Nn(r))return{data:null,error:r};throw r}})}emptyBucket(n){return qp(this,void 0,void 0,function*(){try{return{data:yield Wi(this.fetch,`${this.url}/bucket/${n}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}deleteBucket(n){return qp(this,void 0,void 0,function*(){try{return{data:yield bv(this.fetch,`${this.url}/bucket/${n}`,{},{headers:this.headers}),error:null}}catch(e){if(Nn(e))return{data:null,error:e};throw e}})}};var cg=class extends Cv{constructor(n,e={},r){super(n,e,r)}from(n){return new wv(this.url,this.headers,n,this.fetch)}};var QF="2.48.1";var ug="";typeof Deno<"u"?ug="deno":typeof document<"u"?ug="web":typeof navigator<"u"&&navigator.product==="ReactNative"?ug="react-native":ug="node";var Xee={"X-Client-Info":`supabase-js-${ug}/${QF}`},ZF={headers:Xee},JF={schema:"public"},eP={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},tP={};tA();var Yee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Qee=t=>{let n;return t?n=t:typeof fetch>"u"?n=Jk:n=fetch,(...e)=>n(...e)},Zee=()=>typeof Headers>"u"?eA:Headers,nP=(t,n,e)=>{let r=Qee(e),o=Zee();return(i,s)=>Yee(void 0,void 0,void 0,function*(){var a;let l=(a=yield n())!==null&&a!==void 0?a:t,c=new o(s?.headers);return c.has("apikey")||c.set("apikey",t),c.has("Authorization")||c.set("Authorization",`Bearer ${l}`),r(i,Object.assign(Object.assign({},s),{headers:c}))})};var Jee=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})};function rP(t){return t.replace(/\/$/,"")}function oP(t,n){let{db:e,auth:r,realtime:o,global:i}=t,{db:s,auth:a,realtime:l,global:c}=n,u={db:Object.assign(Object.assign({},s),e),auth:Object.assign(Object.assign({},a),r),realtime:Object.assign(Object.assign({},l),o),global:Object.assign(Object.assign({},c),i),accessToken:()=>Jee(this,void 0,void 0,function*(){return""})};return t.accessToken?u.accessToken=t.accessToken:delete u.accessToken,u}var Sv="2.67.3";var iP="http://localhost:9999",sP="supabase.auth.token";var aP={"X-Client-Info":`gotrue-js/${Sv}`},N1=10;var dg="X-Supabase-Api-Version",k1={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}};function lP(t){return Math.round(Date.now()/1e3)+t}function cP(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let n=Math.random()*16|0;return(t=="x"?n:n&3|8).toString(16)})}var xi=()=>typeof window<"u"&&typeof document<"u",Mu={tested:!1,writable:!1},kl=()=>{if(!xi())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Mu.tested)return Mu.writable;let t=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(t,t),globalThis.localStorage.removeItem(t),Mu.tested=!0,Mu.writable=!0}catch{Mu.tested=!0,Mu.writable=!1}return Mu.writable};function uP(t){let n={},e=new URL(t);if(e.hash&&e.hash[0]==="#")try{new URLSearchParams(e.hash.substring(1)).forEach((o,i)=>{n[i]=o})}catch{}return e.searchParams.forEach((r,o)=>{n[o]=r}),n}var _v=t=>{let n;return t?n=t:typeof fetch>"u"?n=(...e)=>import("./chunk-OBK227YL.js").then(({default:r})=>r(...e)):n=fetch,(...e)=>n(...e)},dP=t=>typeof t=="object"&&t!==null&&"status"in t&&"ok"in t&&"json"in t&&typeof t.json=="function",A1=async(t,n,e)=>{await t.setItem(n,JSON.stringify(e))},fg=async(t,n)=>{let e=await t.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch{return e}},mg=async(t,n)=>{await t.removeItem(n)};function ete(t){let n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",e="",r,o,i,s,a,l,c,u=0;for(t=t.replace("-","+").replace("_","/");u<t.length;)s=n.indexOf(t.charAt(u++)),a=n.indexOf(t.charAt(u++)),l=n.indexOf(t.charAt(u++)),c=n.indexOf(t.charAt(u++)),r=s<<2|a>>4,o=(a&15)<<4|l>>2,i=(l&3)<<6|c,e=e+String.fromCharCode(r),l!=64&&o!=0&&(e=e+String.fromCharCode(o)),c!=64&&i!=0&&(e=e+String.fromCharCode(i));return e}var pg=class t{constructor(){this.promise=new t.promiseConstructor((n,e)=>{this.resolve=n,this.reject=e})}};pg.promiseConstructor=Promise;function R1(t){let n=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i,e=t.split(".");if(e.length!==3)throw new Error("JWT is not valid: not a JWT structure");if(!n.test(e[1]))throw new Error("JWT is not valid: payload is not in base64url format");let r=e[1];return JSON.parse(ete(r))}async function pP(t){return await new Promise(n=>{setTimeout(()=>n(null),t)})}function fP(t,n){return new Promise((r,o)=>{(async()=>{for(let i=0;i<1/0;i++)try{let s=await t(i);if(!n(i,null,s)){r(s);return}}catch(s){if(!n(i,s)){o(s);return}}})()})}function tte(t){return("0"+t.toString(16)).substr(-2)}function nte(){let n=new Uint32Array(56);if(typeof crypto>"u"){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",r=e.length,o="";for(let i=0;i<56;i++)o+=e.charAt(Math.floor(Math.random()*r));return o}return crypto.getRandomValues(n),Array.from(n,tte).join("")}async function rte(t){let e=new TextEncoder().encode(t),r=await crypto.subtle.digest("SHA-256",e),o=new Uint8Array(r);return Array.from(o).map(i=>String.fromCharCode(i)).join("")}function ote(t){return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function ite(t){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),t;let e=await rte(t);return ote(e)}async function Fu(t,n,e=!1){let r=nte(),o=r;e&&(o+="/PASSWORD_RECOVERY"),await A1(t,`${n}-code-verifier`,o);let i=await ite(r);return[i,r===i?"plain":"s256"]}var ste=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function mP(t){let n=t.headers.get(dg);if(!n||!n.match(ste))return null;try{return new Date(`${n}T00:00:00.0Z`)}catch{return null}}var hg=class extends Error{constructor(n,e,r){super(n),this.__isAuthError=!0,this.name="AuthError",this.status=e,this.code=r}};function Je(t){return typeof t=="object"&&t!==null&&"__isAuthError"in t}var Iv=class extends hg{constructor(n,e,r){super(n,e,r),this.name="AuthApiError",this.status=e,this.code=r}};function hP(t){return Je(t)&&t.name==="AuthApiError"}var Kp=class extends hg{constructor(n,e){super(n),this.name="AuthUnknownError",this.originalError=e}},js=class extends hg{constructor(n,e,r,o){super(n,r,o),this.name=e,this.status=r}},Vo=class extends js{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}};function gP(t){return Je(t)&&t.name==="AuthSessionMissingError"}var Xp=class extends js{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}},Pu=class extends js{constructor(n){super(n,"AuthInvalidCredentialsError",400,void 0)}},$u=class extends js{constructor(n,e=null){super(n,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}};function yP(t){return Je(t)&&t.name==="AuthImplicitGrantRedirectError"}var gg=class extends js{constructor(n,e=null){super(n,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=e}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}},Yp=class extends js{constructor(n,e){super(n,"AuthRetryableFetchError",e,void 0)}};function Ev(t){return Je(t)&&t.name==="AuthRetryableFetchError"}var yg=class extends js{constructor(n,e,r){super(n,"AuthWeakPasswordError",e,"weak_password"),this.reasons=r}};var ate=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},Lu=t=>t.msg||t.message||t.error_description||t.error||JSON.stringify(t),lte=[502,503,504];async function xP(t){var n;if(!dP(t))throw new Yp(Lu(t),0);if(lte.includes(t.status))throw new Yp(Lu(t),t.status);let e;try{e=await t.json()}catch(i){throw new Kp(Lu(i),i)}let r,o=mP(t);if(o&&o.getTime()>=k1["2024-01-01"].timestamp&&typeof e=="object"&&e&&typeof e.code=="string"?r=e.code:typeof e=="object"&&e&&typeof e.error_code=="string"&&(r=e.error_code),r){if(r==="weak_password")throw new yg(Lu(e),t.status,((n=e.weak_password)===null||n===void 0?void 0:n.reasons)||[]);if(r==="session_not_found")throw new Vo}else if(typeof e=="object"&&e&&typeof e.weak_password=="object"&&e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.reasons.reduce((i,s)=>i&&typeof s=="string",!0))throw new yg(Lu(e),t.status,e.weak_password.reasons);throw new Iv(Lu(e),t.status||500,r)}var cte=(t,n,e,r)=>{let o={method:t,headers:n?.headers||{}};return t==="GET"?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},n?.headers),o.body=JSON.stringify(r),Object.assign(Object.assign({},o),e))};async function dt(t,n,e,r){var o;let i=Object.assign({},r?.headers);i[dg]||(i[dg]=k1["2024-01-01"].name),r?.jwt&&(i.Authorization=`Bearer ${r.jwt}`);let s=(o=r?.query)!==null&&o!==void 0?o:{};r?.redirectTo&&(s.redirect_to=r.redirectTo);let a=Object.keys(s).length?"?"+new URLSearchParams(s).toString():"",l=await ute(t,n,e+a,{headers:i,noResolveJson:r?.noResolveJson},{},r?.body);return r?.xform?r?.xform(l):{data:Object.assign({},l),error:null}}async function ute(t,n,e,r,o,i){let s=cte(n,r,o,i),a;try{a=await t(e,Object.assign({},s))}catch(l){throw console.error(l),new Yp(Lu(l),0)}if(a.ok||await xP(a),r?.noResolveJson)return a;try{return await a.json()}catch(l){await xP(l)}}function Gs(t){var n;let e=null;dte(t)&&(e=Object.assign({},t),t.expires_at||(e.expires_at=lP(t.expires_in)));let r=(n=t.user)!==null&&n!==void 0?n:t;return{data:{session:e,user:r},error:null}}function O1(t){let n=Gs(t);return!n.error&&t.weak_password&&typeof t.weak_password=="object"&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.message&&typeof t.weak_password.message=="string"&&t.weak_password.reasons.reduce((e,r)=>e&&typeof r=="string",!0)&&(n.data.weak_password=t.weak_password),n}function Hi(t){var n;return{data:{user:(n=t.user)!==null&&n!==void 0?n:t},error:null}}function vP(t){return{data:t,error:null}}function bP(t){let{action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i}=t,s=ate(t,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:n,email_otp:e,hashed_token:r,redirect_to:o,verification_type:i},l=Object.assign({},s);return{data:{properties:a,user:l},error:null}}function wP(t){return t}function dte(t){return t.access_token&&t.refresh_token&&t.expires_in}var pte=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e},Qp=class{constructor({url:n="",headers:e={},fetch:r}){this.url=n,this.headers=e,this.fetch=_v(r),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(n,e="global"){try{return await dt(this.fetch,"POST",`${this.url}/logout?scope=${e}`,{headers:this.headers,jwt:n,noResolveJson:!0}),{data:null,error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}}async inviteUserByEmail(n,e={}){try{return await dt(this.fetch,"POST",`${this.url}/invite`,{body:{email:n,data:e.data},headers:this.headers,redirectTo:e.redirectTo,xform:Hi})}catch(r){if(Je(r))return{data:{user:null},error:r};throw r}}async generateLink(n){try{let{options:e}=n,r=pte(n,["options"]),o=Object.assign(Object.assign({},r),e);return"newEmail"in r&&(o.new_email=r?.newEmail,delete o.newEmail),await dt(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:o,headers:this.headers,xform:bP,redirectTo:e?.redirectTo})}catch(e){if(Je(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(n){try{return await dt(this.fetch,"POST",`${this.url}/admin/users`,{body:n,headers:this.headers,xform:Hi})}catch(e){if(Je(e))return{data:{user:null},error:e};throw e}}async listUsers(n){var e,r,o,i,s,a,l;try{let c={nextPage:null,lastPage:0,total:0},u=await dt(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(r=(e=n?.page)===null||e===void 0?void 0:e.toString())!==null&&r!==void 0?r:"",per_page:(i=(o=n?.perPage)===null||o===void 0?void 0:o.toString())!==null&&i!==void 0?i:""},xform:wP});if(u.error)throw u.error;let d=await u.json(),p=(s=u.headers.get("x-total-count"))!==null&&s!==void 0?s:0,f=(l=(a=u.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&l!==void 0?l:[];return f.length>0&&(f.forEach(m=>{let h=parseInt(m.split(";")[0].split("=")[1].substring(0,1)),g=JSON.parse(m.split(";")[1].split("=")[1]);c[`${g}Page`]=h}),c.total=parseInt(p)),{data:Object.assign(Object.assign({},d),c),error:null}}catch(c){if(Je(c))return{data:{users:[]},error:c};throw c}}async getUserById(n){try{return await dt(this.fetch,"GET",`${this.url}/admin/users/${n}`,{headers:this.headers,xform:Hi})}catch(e){if(Je(e))return{data:{user:null},error:e};throw e}}async updateUserById(n,e){try{return await dt(this.fetch,"PUT",`${this.url}/admin/users/${n}`,{body:e,headers:this.headers,xform:Hi})}catch(r){if(Je(r))return{data:{user:null},error:r};throw r}}async deleteUser(n,e=!1){try{return await dt(this.fetch,"DELETE",`${this.url}/admin/users/${n}`,{headers:this.headers,body:{should_soft_delete:e},xform:Hi})}catch(r){if(Je(r))return{data:{user:null},error:r};throw r}}async _listFactors(n){try{let{data:e,error:r}=await dt(this.fetch,"GET",`${this.url}/admin/users/${n.userId}/factors`,{headers:this.headers,xform:o=>({data:{factors:o},error:null})});return{data:e,error:r}}catch(e){if(Je(e))return{data:null,error:e};throw e}}async _deleteFactor(n){try{return{data:await dt(this.fetch,"DELETE",`${this.url}/admin/users/${n.userId}/factors/${n.id}`,{headers:this.headers}),error:null}}catch(e){if(Je(e))return{data:null,error:e};throw e}}};var CP={getItem:t=>kl()?globalThis.localStorage.getItem(t):null,setItem:(t,n)=>{kl()&&globalThis.localStorage.setItem(t,n)},removeItem:t=>{kl()&&globalThis.localStorage.removeItem(t)}};function M1(t={}){return{getItem:n=>t[n]||null,setItem:(n,e)=>{t[n]=e},removeItem:n=>{delete t[n]}}}function SP(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}var Vu={debug:!!(globalThis&&kl()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")},xg=class extends Error{constructor(n){super(n),this.isAcquireTimeout=!0}},Tv=class extends xg{};async function F1(t,n,e){Vu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",t,n);let r=new globalThis.AbortController;return n>0&&setTimeout(()=>{r.abort(),Vu.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",t)},n),await Promise.resolve().then(()=>globalThis.navigator.locks.request(t,n===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async o=>{if(o){Vu.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",t,o.name);try{return await e()}finally{Vu.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",t,o.name)}}else{if(n===0)throw Vu.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",t),new Tv(`Acquiring an exclusive Navigator LockManager lock "${t}" immediately failed`);if(Vu.debug)try{let i=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(i,null,"  "))}catch(i){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",i)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await e()}}))}SP();var fte={url:iP,storageKey:sP,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:aP,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1},vg=30*1e3,_P=3;async function IP(t,n,e){return await e()}var P1=(()=>{class t{constructor(e){var r,o;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t.nextInstanceID,t.nextInstanceID+=1,this.instanceID>0&&xi()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");let i=Object.assign(Object.assign({},fte),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Qp({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=_v(i.fetch),this.lock=i.lock||IP,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:xi()&&(!((r=globalThis?.navigator)===null||r===void 0)&&r.locks)?this.lock=F1:this.lock=IP,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:kl()?this.storage=CP:(this.memoryStorage={},this.storage=M1(this.memoryStorage)):(this.memoryStorage={},this.storage=M1(this.memoryStorage)),xi()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(s){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",s)}(o=this.broadcastChannel)===null||o===void 0||o.addEventListener("message",async s=>{this._debug("received broadcast notification from other tab or client",s),await this._notifyAllSubscribers(s.data.event,s.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Sv}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let r=uP(window.location.href),o="none";if(this._isImplicitGrantCallback(r)?o="implicit":await this._isPKCECallback(r)&&(o="pkce"),xi()&&this.detectSessionInUrl&&o!=="none"){let{data:i,error:s}=await this._getSessionFromURL(r,o);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),yP(s)){let c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}let{session:a,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",l),await this._saveSession(a),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(r){return Je(r)?{error:r}:{error:new Kp("Unexpected error during initialization",r)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var r,o,i;try{let s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(o=(r=e?.options)===null||r===void 0?void 0:r.data)!==null&&o!==void 0?o:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:Gs}),{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(Je(s))return{data:{user:null,session:null},error:s};throw s}}async signUp(e){var r,o,i;try{let s;if("email"in e){let{email:d,password:p,options:f}=e,m=null,h=null;this.flowType==="pkce"&&([m,h]=await Fu(this.storage,this.storageKey)),s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:p,data:(r=f?.data)!==null&&r!==void 0?r:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:m,code_challenge_method:h},xform:Gs})}else if("phone"in e){let{phone:d,password:p,options:f}=e;s=await dt(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:p,data:(o=f?.data)!==null&&o!==void 0?o:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:Gs})}else throw new Pu("You must provide either an email or phone number and a password");let{data:a,error:l}=s;if(l||!a)return{data:{user:null,session:null},error:l};let c=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(Je(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithPassword(e){try{let r;if("email"in e){let{email:s,password:a,options:l}=e;r=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:O1})}else if("phone"in e){let{phone:s,password:a,options:l}=e;r=await dt(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:a,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:O1})}else throw new Pu("You must provide either an email or phone number and a password");let{data:o,error:i}=r;return i?{data:{user:null,session:null},error:i}:!o||!o.session||!o.user?{data:{user:null,session:null},error:new Xp}:(o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),{data:Object.assign({user:o.user,session:o.session},o.weak_password?{weakPassword:o.weak_password}:null),error:i})}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOAuth(e){var r,o,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(r=e.options)===null||r===void 0?void 0:r.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let r=await fg(this.storage,`${this.storageKey}-code-verifier`),[o,i]=(r??"").split("/");try{let{data:s,error:a}=await dt(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:o},xform:Gs});if(await mg(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!s||!s.session||!s.user?{data:{user:null,session:null,redirectType:null},error:new Xp}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:a})}catch(s){if(Je(s))return{data:{user:null,session:null,redirectType:null},error:s};throw s}}async signInWithIdToken(e){try{let{options:r,provider:o,token:i,access_token:s,nonce:a}=e,l=await dt(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:o,id_token:i,access_token:s,nonce:a,gotrue_meta_security:{captcha_token:r?.captchaToken}},xform:Gs}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Xp}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithOtp(e){var r,o,i,s,a;try{if("email"in e){let{email:l,options:c}=e,u=null,d=null;this.flowType==="pkce"&&([u,d]=await Fu(this.storage,this.storageKey));let{error:p}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(r=c?.data)!==null&&r!==void 0?r:{},create_user:(o=c?.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:c?.emailRedirectTo});return{data:{user:null,session:null},error:p}}if("phone"in e){let{phone:l,options:c}=e,{data:u,error:d}=await dt(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(a=c?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new Pu("You must provide either an email or phone number.")}catch(l){if(Je(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var r,o;try{let i,s;"options"in e&&(i=(r=e.options)===null||r===void 0?void 0:r.redirectTo,s=(o=e.options)===null||o===void 0?void 0:o.captchaToken);let{data:a,error:l}=await dt(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:Gs});if(l)throw l;if(!a)throw new Error("An error occurred on token verification.");let c=a.session,u=a.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(Je(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var r,o,i;try{let s=null,a=null;return this.flowType==="pkce"&&([s,a]=await Fu(this.storage,this.storageKey)),await dt(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(o=(r=e.options)===null||r===void 0?void 0:r.redirectTo)!==null&&o!==void 0?o:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:s,code_challenge_method:a}),headers:this.headers,xform:vP})}catch(s){if(Je(s))return{data:null,error:s};throw s}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:r},error:o}=e;if(o)throw o;if(!r)throw new Vo;let{error:i}=await dt(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:r.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(Je(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let r=`${this.url}/resend`;if("email"in e){let{email:o,type:i,options:s}=e,{error:a}=await dt(this.fetch,"POST",r,{headers:this.headers,body:{email:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){let{phone:o,type:i,options:s}=e,{data:a,error:l}=await dt(this.fetch,"POST",r,{headers:this.headers,body:{phone:o,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:l}}throw new Pu("You must provide either an email or phone number and a type")}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async r=>r))}async _acquireLock(e,r){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let o=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await o,await r()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let o=r();for(this.pendingInLock.push((async()=>{try{await o}catch{}})()),await o;this.pendingInLock.length;){let i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await o}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let r=await this.__loadSession();return await e(r)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null,r=await fg(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",r),r!==null&&(this._isValidSession(r)?e=r:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let o=e.expires_at?e.expires_at<=Date.now()/1e3:!1;if(this._debug("#__loadSession()",`session has${o?"":" not"} expired`,"expires_at",e.expires_at),!o){if(this.storage.isServer){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,d))})}return{data:{session:e},error:null}}let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{session:null},error:s}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Hi}):await this._useSession(async r=>{var o,i,s;let{data:a,error:l}=r;if(l)throw l;return!(!((o=a.session)===null||o===void 0)&&o.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Vo}:await dt(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:Hi})})}catch(r){if(Je(r))return gP(r)&&(await this._removeSession(),await mg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:r};throw r}}async updateUser(e,r={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,r))}async _updateUser(e,r={}){try{return await this._useSession(async o=>{let{data:i,error:s}=o;if(s)throw s;if(!i.session)throw new Vo;let a=i.session,l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await Fu(this.storage,this.storageKey));let{data:u,error:d}=await dt(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:r?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:a.access_token,xform:Hi});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(o){if(Je(o))return{data:{user:null},error:o};throw o}}_decodeJWT(e){return R1(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Vo;let r=Date.now()/1e3,o=r,i=!0,s=null,a=R1(e.access_token);if(a.exp&&(o=a.exp,i=o<=r),i){let{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};s=l}else{let{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:o-r,expires_at:o},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return{data:{user:s.user,session:s},error:null}}catch(r){if(Je(r))return{data:{session:null,user:null},error:r};throw r}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async r=>{var o;if(!e){let{data:a,error:l}=r;if(l)throw l;e=(o=a.session)!==null&&o!==void 0?o:void 0}if(!e?.refresh_token)throw new Vo;let{session:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?{data:{user:null,session:null},error:s}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(r){if(Je(r))return{data:{user:null,session:null},error:r};throw r}}async _getSessionFromURL(e,r){try{if(!xi())throw new $u("No browser detected.");if(e.error||e.error_description||e.error_code)throw new $u(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(r){case"implicit":if(this.flowType==="pkce")throw new gg("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new $u("Not a valid implicit grant flow url.");break;default:}if(r==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new gg("No code detected.");let{data:S,error:C}=await this._exchangeCodeForSession(e.code);if(C)throw C;let I=new URL(window.location.href);return I.searchParams.delete("code"),window.history.replaceState(window.history.state,"",I.toString()),{data:{session:S.session,redirectType:null},error:null}}let{provider_token:o,provider_refresh_token:i,access_token:s,refresh_token:a,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!a||!u)throw new $u("No session defined in URL");let d=Math.round(Date.now()/1e3),p=parseInt(l),f=d+p;c&&(f=parseInt(c));let m=f-d;m*1e3<=vg&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${m}s, should have been closer to ${p}s`);let h=f-p;d-h>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",h,f,d):d-h<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",h,f,d);let{data:g,error:y}=await this._getUser(s);if(y)throw y;let v={provider_token:o,provider_refresh_token:i,access_token:s,expires_in:p,expires_at:f,refresh_token:a,token_type:u,user:g.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:v,redirectType:e.type},error:null}}catch(o){if(Je(o))return{data:{session:null,redirectType:null},error:o};throw o}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let r=await fg(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&r)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{error:s};let a=(o=i.session)===null||o===void 0?void 0:o.access_token;if(a){let{error:l}=await this.admin.signOut(a,e);if(l&&!(hP(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await mg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let r=cP(),o={id:r,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",r),this.stateChangeEmitters.delete(r)}};return this._debug("#onAuthStateChange()","registered callback with id",r),this.stateChangeEmitters.set(r,o),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(r)})))(),{data:{subscription:o}}}async _emitInitialSession(e){return await this._useSession(async r=>{var o,i;try{let{data:{session:s},error:a}=r;if(a)throw a;await((o=this.stateChangeEmitters.get(e))===null||o===void 0?void 0:o.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,r={}){let o=null,i=null;this.flowType==="pkce"&&([o,i]=await Fu(this.storage,this.storageKey,!0));try{return await dt(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:o,code_challenge_method:i,gotrue_meta_security:{captcha_token:r.captchaToken}},headers:this.headers,redirectTo:r.redirectTo})}catch(s){if(Je(s))return{data:null,error:s};throw s}}async getUserIdentities(){var e;try{let{data:r,error:o}=await this.getUser();if(o)throw o;return{data:{identities:(e=r.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(r){if(Je(r))return{data:null,error:r};throw r}}async linkIdentity(e){var r;try{let{data:o,error:i}=await this._useSession(async s=>{var a,l,c,u,d;let{data:p,error:f}=s;if(f)throw f;let m=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await dt(this.fetch,"GET",m,{headers:this.headers,jwt:(d=(u=p.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return xi()&&!(!((r=e.options)===null||r===void 0)&&r.skipBrowserRedirect)&&window.location.assign(o?.url),{data:{provider:e.provider,url:o?.url},error:null}}catch(o){if(Je(o))return{data:{provider:e.provider,url:null},error:o};throw o}}async unlinkIdentity(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)throw a;return await dt(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(o=s.session)===null||o===void 0?void 0:o.access_token)!==null&&i!==void 0?i:void 0})})}catch(r){if(Je(r))return{data:null,error:r};throw r}}async _refreshAccessToken(e){let r=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{let o=Date.now();return await fP(async i=>(i>0&&await pP(200*Math.pow(2,i-1)),this._debug(r,"refreshing attempt",i),await dt(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:Gs})),(i,s)=>{let a=200*Math.pow(2,i);return s&&Ev(s)&&Date.now()+a-o<vg})}catch(o){if(this._debug(r,"error",o),Je(o))return{data:{session:null,user:null},error:o};throw o}finally{this._debug(r,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,r){let o=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:r.redirectTo,scopes:r.scopes,queryParams:r.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",r,"url",o),xi()&&!r.skipBrowserRedirect&&window.location.assign(o),{data:{provider:e,url:o},error:null}}async _recoverAndRefresh(){var e;let r="#_recoverAndRefresh()";this._debug(r,"begin");try{let o=await fg(this.storage,this.storageKey);if(this._debug(r,"session from storage",o),!this._isValidSession(o)){this._debug(r,"session is not valid"),o!==null&&await this._removeSession();return}let i=Math.round(Date.now()/1e3),s=((e=o.expires_at)!==null&&e!==void 0?e:1/0)<i+N1;if(this._debug(r,`session has${s?"":" not"} expired with margin of ${N1}s`),s){if(this.autoRefreshToken&&o.refresh_token){let{error:a}=await this._callRefreshToken(o.refresh_token);a&&(console.error(a),Ev(a)||(this._debug(r,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",o)}catch(o){this._debug(r,"error",o),console.error(o);return}finally{this._debug(r,"end")}}async _callRefreshToken(e){var r,o;if(!e)throw new Vo;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new pg;let{data:s,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!s.session)throw new Vo;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);let l={session:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),Je(s)){let a={session:null,error:s};return Ev(s)||await this._removeSession(),(r=this.refreshingDeferred)===null||r===void 0||r.resolve(a),a}throw(o=this.refreshingDeferred)===null||o===void 0||o.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,r,o=!0){let i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",r,`broadcast = ${o}`);try{this.broadcastChannel&&o&&this.broadcastChannel.postMessage({event:e,session:r});let s=[],a=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,r)}catch(c){s.push(c)}});if(await Promise.all(a),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await A1(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await mg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&xi()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(r){console.error("removing visibilitychange callback failed",r)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),vg);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async r=>{let{data:{session:o}}=r;if(!o||!o.refresh_token||!o.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}let i=Math.floor((o.expires_at*1e3-e)/vg);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${vg}ms, refresh threshold is ${_P} ticks`),i<=_P&&await this._callRefreshToken(o.refresh_token)})}catch(r){console.error("Auto refresh tick failed with error. This is likely a transient error.",r)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof xg)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!xi()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let r=`#_onVisibilityChanged(${e})`;this._debug(r,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(r,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,r,o){let i=[`provider=${encodeURIComponent(r)}`];if(o?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(o.redirectTo)}`),o?.scopes&&i.push(`scopes=${encodeURIComponent(o.scopes)}`),this.flowType==="pkce"){let[s,a]=await Fu(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(l.toString())}if(o?.queryParams){let s=new URLSearchParams(o.queryParams);i.push(s.toString())}return o?.skipBrowserRedirect&&i.push(`skip_http_redirect=${o.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await dt(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Je(r))return{data:null,error:r};throw r}}async _enroll(e){try{return await this._useSession(async r=>{var o,i;let{data:s,error:a}=r;if(a)return{data:null,error:a};let l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await dt(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(o=s?.session)===null||o===void 0?void 0:o.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(r){if(Je(r))return{data:null,error:r};throw r}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;if(s)return{data:null,error:s};let{data:a,error:l}=await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:l})})}catch(r){if(Je(r))return{data:null,error:r};throw r}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async r=>{var o;let{data:i,error:s}=r;return s?{data:null,error:s}:await dt(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(o=i?.session)===null||o===void 0?void 0:o.access_token})})}catch(r){if(Je(r))return{data:null,error:r};throw r}})}async _challengeAndVerify(e){let{data:r,error:o}=await this._challenge({factorId:e.factorId});return o?{data:null,error:o}:await this._verify({factorId:e.factorId,challengeId:r.id,code:e.code})}async _listFactors(){let{data:{user:e},error:r}=await this.getUser();if(r)return{data:null,error:r};let o=e?.factors||[],i=o.filter(a=>a.factor_type==="totp"&&a.status==="verified"),s=o.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:o,totp:i,phone:s},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var r,o;let{data:{session:i},error:s}=e;if(s)return{data:null,error:s};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let a=this._decodeJWT(i.access_token),l=null;a.aal&&(l=a.aal);let c=l;((o=(r=i.user.factors)===null||r===void 0?void 0:r.filter(p=>p.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(c="aal2");let d=a.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:d},error:null}}))}}return t.nextInstanceID=0,t})();var mte=P1,$1=mte;var Dv=class extends $1{constructor(n){super(n)}};var hte=function(t,n,e,r){function o(i){return i instanceof e?i:new e(function(s){s(i)})}return new(e||(e=Promise))(function(i,s){function a(u){try{c(r.next(u))}catch(d){s(d)}}function l(u){try{c(r.throw(u))}catch(d){s(d)}}function c(u){u.done?i(u.value):o(u.value).then(a,l)}c((r=r.apply(t,n||[])).next())})},Nv=class{constructor(n,e,r){var o,i,s;if(this.supabaseUrl=n,this.supabaseKey=e,!n)throw new Error("supabaseUrl is required.");if(!e)throw new Error("supabaseKey is required.");let a=rP(n);this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;let l=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,c={db:JF,realtime:tP,auth:Object.assign(Object.assign({},eP),{storageKey:l}),global:ZF},u=oP(r??{},c);this.storageKey=(o=u.auth.storageKey)!==null&&o!==void 0?o:"",this.headers=(i=u.global.headers)!==null&&i!==void 0?i:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(d,p)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(p)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((s=u.auth)!==null&&s!==void 0?s:{},this.headers,u.global.fetch),this.fetch=nP(e,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new VF(`${a}/rest/v1`,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Zh(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new cg(this.storageUrl,this.headers,this.fetch)}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,e={},r={}){return this.rest.rpc(n,e,r)}channel(n,e={config:{}}){return this.realtime.channel(n,e)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var n,e;return hte(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();let{data:r}=yield this.auth.getSession();return(e=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&e!==void 0?e:null})}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,storageKey:i,flowType:s,lock:a,debug:l},c,u){let d={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new Dv({url:this.authUrl,headers:Object.assign(Object.assign({},d),c),storageKey:i,autoRefreshToken:n,persistSession:e,detectSessionInUrl:r,storage:o,flowType:s,lock:a,debug:l,fetch:u,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(n){return new ag(this.realtimeUrl,Object.assign(Object.assign({},n),{params:Object.assign({apikey:this.supabaseKey},n?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,r)=>{this._handleTokenChanged(e,"CLIENT",r?.access_token)})}_handleTokenChanged(n,e,r){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==r?this.changedAccessToken=r:n==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};var EP=(t,n,e)=>new Nv(t,n,e);var kv={API_URL:"https://jsgltiaidlacvchyjjha.supabase.co",anon_key:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpzZ2x0aWFpZGxhY3ZjaHlqamhhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk2NjIzNDIsImV4cCI6MjA1NTIzODM0Mn0.bPtRMhXapLzUgPEIf6GoW9r52umh0F1YZhG1bfLyb0s",supabase_LocalStorage_key:"sb-jsgltiaidlacvchyjjha-auth-token"};var jt=class t{constructor(n){this.platformId=n;this.supabase=EP(kv.API_URL,kv.anon_key,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0}}),this.initializeAuthState()}supabase;user=lo(null);currentUsername=lo(null);loginStatus=lo(null);ngOnInit(){this.initializeAuthState()}initializeAuthState(){if(!Hr(this.platformId))return;let n=this.getStoredSession();n&&this.updateSession(n),this.refreshSessionFromApi(),this.supabase.auth.onAuthStateChange((e,r)=>{this.updateSession(r)})}getStoredSession(){try{let n=localStorage.getItem(kv.supabase_LocalStorage_key);if(!n)return null;let e=JSON.parse(n);if(!e||!e.expires_at)return null;let r=e.expires_at*1e3;return Date.now()>=r?null:e}catch(n){return console.error("Error parsing stored session",n),null}}async refreshSessionFromApi(){try{let{data:n,error:e}=await this.supabase.auth.getSession();if(e)throw e;this.updateSession(n.session)}catch(n){console.error("Failed to refresh session:",n),this.updateSession(null)}}updateSession(n){if(n){this.user.set(n.user);let e=n.user?.identities?.[0]?.identity_data?.firstname||null;this.currentUsername.set(e),this.loginStatus.set(!0)}else this.user.set(null),this.currentUsername.set(null),this.loginStatus.set(!1)}initializeApp(){return new Promise(n=>{if(!Hr(this.platformId))return this.loginStatus.set(!1),n(!1);let e=this.getStoredSession();e&&this.updateSession(e),this.supabase.auth.getSession().then(({data:r,error:o})=>{o?(console.error("Failed to get session:",o),this.updateSession(null)):this.updateSession(r.session),this.supabase.auth.onAuthStateChange((i,s)=>{this.updateSession(s)}),n(!0)})})}async signIn(n,e){try{let{error:r}=await this.supabase.auth.signInWithPassword({email:n,password:e});if(r)throw r;return{success:!0}}catch(r){return console.error("Sign in error:",r),{success:!1,error:r}}}async signOut(){try{let{error:n}=await this.supabase.auth.signOut();if(n)throw n;return this.clearStorages(),this.updateSession(null),{success:!0}}catch(n){return console.error("Sign out error:",n),{success:!1,error:n}}}async signUp(n,e,r,o){let{error:i}=await this.supabase.auth.signUp({email:n,password:e,options:{data:{firstname:r,lastname:o}}});if(i)throw i}clearStorages(){Hr(this.platformId)&&(localStorage.clear(),sessionStorage.clear())}async addTradeLog(n,e){let r=this.user();if(!r)throw new Error("User not authenticated");n.userid=r.id;let{data:o,error:i}=await this.supabase.from(e).insert([n]);if(i)throw console.error("Error inserting trade log: ",i),i;return Hr(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async getTradeLogs(n){let e=this.user();if(!e)throw new Error("User not authenticated");let r=!1,o=null;if(Hr(this.platformId)){r=sessionStorage.getItem(`${n}_refresh`)==="yes";let a=sessionStorage.getItem(n);if(a)try{o=JSON.parse(a)}catch(l){console.error("Error parsing cached trade logs:",l),o=null}}if(!r&&o)return o;let{data:i,error:s}=await this.supabase.from(n).select("*").eq("userid",e.id);if(s)throw console.error("Error fetching trade logs:",s),s;return Hr(this.platformId)&&(sessionStorage.setItem(n,JSON.stringify(i)),sessionStorage.removeItem(`${n}_refresh`)),i}async updateTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).update(n).eq("tradeid",n.tradeid);if(i)throw console.error("Error updating trade log: ",i),i;return Hr(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async deleteTradeLog(n,e){if(!this.user())throw new Error("User not authenticated");let{data:o,error:i}=await this.supabase.from(e).delete().eq("tradeid",n);if(i)throw console.error("Error deleting trade log: ",i),i;return Hr(this.platformId)&&sessionStorage.setItem(`${e}_refresh`,"yes"),o}async loadQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminLoadQuestions(){let{data:n,error:e}=await this.supabase.from("adminquestions").select("*");if(e)throw console.error("Error loading questions: ",e),e;return n}async adminSaveQuestions(n){let e=null;for(let r of n.filter(o=>o.isModified))if(r.question_id){let{data:o,error:i}=await this.supabase.from("adminquestions").update({question_data:r.question_data,active:r.active}).eq("question_id",r.question_id).select().single();if(i){console.error("Error updating question:",i),e=i;break}else r.updated_at=o.updated_at,r.isModified=!1}else{let{data:o,error:i}=await this.supabase.from("adminquestions").insert([{question_data:r.question_data,active:r.active}]).select().single();if(i){console.error("Error inserting question:",i),e=i;break}else r.question_id=o.question_id,r.created_at=o.created_at,r.updated_at=o.updated_at,r.isModified=!1}return{error:e}}async deleteQuestion(n){let{error:e}=await this.supabase.from("adminquestions").delete().eq("question_id",n.question_id);return{error:e}}async getActiveQuestions(){let{data:n,error:e}=await this.supabase.from("activequestions").select("*");return{data:n,error:e}}async submitUserAnswers(n){let{error:e}=await this.supabase.from("answers").insert(n);return{error:e}}supaScream(){return"SupaScream"}static \u0275fac=function(e){return new(e||t)($e(Oo))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})};function gte(t,n){if(t&1&&(w(0,"div",8)(1,"div",9)(2,"div",10)(3,"h5",11),_(4),x(),w(5,"p",13),_(6),x(),w(7,"a",14),_(8),x()()()()),t&2){let e=n.$implicit;$(4),At(e.title),$(2),At(e.description),$(),W("routerLink",e.link),$(),At(e.buttonText)}}var Av=class t{constructor(n){this.supabaseService=n;this.userFirstName=this.supabaseService.currentUsername()}userFirstName;steps=[{title:"Step 1: Daily Emotional Check-in",description:"Understand your emotional state before making trading decisions.",buttonText:"Begin Emotional Check-in",link:"/emotions"},{title:"Step 2: Pre-Trade Log",description:"Document your trading plan before executing any trades.",buttonText:"Create Pre-Trade Log",link:"/pretradelog"},{title:"Step 3: Post-Trade Log",description:"Record results and analyze your trading performance.",buttonText:"Complete Post-Trade Log",link:"/posttradelog"},{title:"Step 4: Reflection & Meditation",description:"Clear your mind with mindfulness practices.",buttonText:"Start Reflection",link:"/reflection"}];static \u0275fac=function(e){return new(e||t)(oe(jt))};static \u0275cmp=Pt({type:t,selectors:[["app-landing-page"]],decls:24,vars:1,consts:[[1,"container","mt-4"],[1,"text-center","mb-4"],[1,"text-center"],[1,"container","text-center","mt-5"],[1,"row"],["class","col-12",4,"ngFor","ngForOf"],[1,"container","text-center"],[1,"mb-4"],[1,"col-12"],[1,"card","h-100"],[1,"card-body"],[1,"card-title"],["routerLink","/meditation",1,"btn","btn-secondary","btn-tr"],[1,"card-text"],[1,"btn","btn-primary","btn-tr",3,"routerLink"]],template:function(e,r){e&1&&(w(0,"div",0)(1,"h2",1),_(2,"Begin Your Trading Transformation"),x(),w(3,"h3",1),_(4,"Your Daily Trading Routine"),x(),w(5,"p",2),_(6," Welcome to your personalized trading journey. Each day follows a structured approach designed to build discipline and improve your trading performance. "),x(),w(7,"div",3)(8,"div",4),ae(9,gte,9,4,"div",5),x()(),j(10,"hr"),w(11,"div",6)(12,"h2",7),_(13,"Additional Resources"),x(),w(14,"div",4)(15,"div",8)(16,"div",9)(17,"div",10)(18,"h5",11),_(19,"Meditation Hub"),x(),w(20,"p"),_(21,"Clear your mind and reduce emotional reactivity with guided meditations."),x(),w(22,"a",12),_(23,"Visit Meditation Hub"),x()()()()()()()),e&2&&($(9),W("ngForOf",r.steps))},dependencies:[Kr,on,Wr],styles:[".card[_ngcontent-%COMP%]{border:none;border-radius:8px}.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-weight:600;margin-bottom:.75rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-bottom:1rem}.btn-custom[_ngcontent-%COMP%]{border-radius:20px;font-weight:600}@media (max-width: 576px){.card-body[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{font-size:1.1rem}.card-body[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem}.btn-custom[_ngcontent-%COMP%]{padding:.5rem 1rem}}"]})};var Dr=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return new Promise(o=>{rr(this.injector,()=>{Ch(()=>{this.supabaseService.loginStatus()&&o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()||o(this.router.createUrlTree([""],{queryParams:{returnUrl:e.url}}))},100)})}static \u0275fac=function(e){return new(e||t)($e(jt),$e(mo),$e(Wn))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})};var Rv=class t{constructor(n,e,r){this.supabaseService=n;this.router=e;this.injector=r}canActivate(n,e){let r=this.supabaseService.loginStatus();return r?!1:r?new Promise(o=>{rr(this.injector,()=>{Ch(()=>{this.supabaseService.loginStatus()||o(!0)})}),setTimeout(()=>{this.supabaseService.loginStatus()&&o(this.router.createUrlTree(["/home"]))},100)}):!0}static \u0275fac=function(e){return new(e||t)($e(jt),$e(mo),$e(Wn))};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})};var PP=(()=>{class t{_renderer;_elementRef;onChange=e=>{};onTouched=()=>{};constructor(e,r){this._renderer=e,this._elementRef=r}setProperty(e,r){this._renderer.setProperty(this._elementRef.nativeElement,e,r)}registerOnTouched(e){this.onTouched=e}registerOnChange(e){this.onChange=e}setDisabledState(e){this.setProperty("disabled",e)}static \u0275fac=function(r){return new(r||t)(oe(mi),oe(Ro))};static \u0275dir=kt({type:t})}return t})(),nf=(()=>{class t extends PP{static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,features:[Tn]})}return t})(),Ml=new Me(""),yte={provide:Ml,useExisting:nr(()=>Eg),multi:!0},Eg=(()=>{class t extends nf{writeValue(e){this.setProperty("checked",e)}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(r,o){r&1&&fe("change",function(s){return o.onChange(s.target.checked)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Er([yte]),Tn]})}return t})(),xte={provide:Ml,useExisting:nr(()=>pr),multi:!0};function vte(){let t=Ls()?Ls().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}var bte=new Me(""),pr=(()=>{class t extends PP{_compositionMode;_composing=!1;constructor(e,r,o){super(e,r),this._compositionMode=o,this._compositionMode==null&&(this._compositionMode=!vte())}writeValue(e){let r=e??"";this.setProperty("value",r)}_handleInput(e){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(e)}_compositionStart(){this._composing=!0}_compositionEnd(e){this._composing=!1,this._compositionMode&&this.onChange(e)}static \u0275fac=function(r){return new(r||t)(oe(mi),oe(Ro),oe(bte,8))};static \u0275dir=kt({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(r,o){r&1&&fe("input",function(s){return o._handleInput(s.target.value)})("blur",function(){return o.onTouched()})("compositionstart",function(){return o._compositionStart()})("compositionend",function(s){return o._compositionEnd(s.target.value)})},standalone:!1,features:[Er([xte]),Tn]})}return t})();function Al(t){return t==null||(typeof t=="string"||Array.isArray(t))&&t.length===0}function $P(t){return t!=null&&typeof t.length=="number"}var Fl=new Me(""),rf=new Me(""),wte=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,_e=class{static min(n){return LP(n)}static max(n){return VP(n)}static required(n){return Cte(n)}static requiredTrue(n){return Ste(n)}static email(n){return _te(n)}static minLength(n){return Ite(n)}static maxLength(n){return Ete(n)}static pattern(n){return Tte(n)}static nullValidator(n){return Mv(n)}static compose(n){return WP(n)}static composeAsync(n){return HP(n)}};function LP(t){return n=>{if(Al(n.value)||Al(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e<t?{min:{min:t,actual:n.value}}:null}}function VP(t){return n=>{if(Al(n.value)||Al(t))return null;let e=parseFloat(n.value);return!isNaN(e)&&e>t?{max:{max:t,actual:n.value}}:null}}function Cte(t){return Al(t.value)?{required:!0}:null}function Ste(t){return t.value===!0?null:{required:!0}}function _te(t){return Al(t.value)||wte.test(t.value)?null:{email:!0}}function Ite(t){return n=>Al(n.value)||!$P(n.value)?null:n.value.length<t?{minlength:{requiredLength:t,actualLength:n.value.length}}:null}function Ete(t){return n=>$P(n.value)&&n.value.length>t?{maxlength:{requiredLength:t,actualLength:n.value.length}}:null}function Tte(t){if(!t)return Mv;let n,e;return typeof t=="string"?(e="",t.charAt(0)!=="^"&&(e+="^"),e+=t,t.charAt(t.length-1)!=="$"&&(e+="$"),n=new RegExp(e)):(e=t.toString(),n=t),r=>{if(Al(r.value))return null;let o=r.value;return n.test(o)?null:{pattern:{requiredPattern:e,actualValue:o}}}}function Mv(t){return null}function BP(t){return t!=null}function zP(t){return _u(t)?fn(t):t}function UP(t){let n={};return t.forEach(e=>{n=e!=null?he(he({},n),e):n}),Object.keys(n).length===0?null:n}function jP(t,n){return n.map(e=>e(t))}function Dte(t){return!t.validate}function GP(t){return t.map(n=>Dte(n)?n:e=>n.validate(e))}function WP(t){if(!t)return null;let n=t.filter(BP);return n.length==0?null:function(e){return UP(jP(e,n))}}function j1(t){return t!=null?WP(GP(t)):null}function HP(t){if(!t)return null;let n=t.filter(BP);return n.length==0?null:function(e){let r=jP(e,n).map(zP);return d_(r).pipe(nt(UP))}}function G1(t){return t!=null?HP(GP(t)):null}function TP(t,n){return t===null?[n]:Array.isArray(t)?[...t,n]:[t,n]}function qP(t){return t._rawValidators}function KP(t){return t._rawAsyncValidators}function L1(t){return t?Array.isArray(t)?t:[t]:[]}function Fv(t,n){return Array.isArray(t)?t.includes(n):t===n}function DP(t,n){let e=L1(n);return L1(t).forEach(o=>{Fv(e,o)||e.push(o)}),e}function NP(t,n){return L1(n).filter(e=>!Fv(t,e))}var Pv=class{get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators=[];_rawAsyncValidators=[];_setValidators(n){this._rawValidators=n||[],this._composedValidatorFn=j1(this._rawValidators)}_setAsyncValidators(n){this._rawAsyncValidators=n||[],this._composedAsyncValidatorFn=G1(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_onDestroyCallbacks=[];_registerOnDestroy(n){this._onDestroyCallbacks.push(n)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(n=>n()),this._onDestroyCallbacks=[]}reset(n=void 0){this.control&&this.control.reset(n)}hasError(n,e){return this.control?this.control.hasError(n,e):!1}getError(n,e){return this.control?this.control.getError(n,e):null}},Nr=class extends Pv{name;get formDirective(){return null}get path(){return null}},Rl=class extends Pv{_parent=null;name=null;valueAccessor=null},$v=class{_cd;constructor(n){this._cd=n}get isTouched(){return this._cd?.control?._touched?.(),!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return this._cd?.control?._pristine?.(),!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return this._cd?.control?._status?.(),!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return this._cd?._submitted?.(),!!this._cd?.submitted}},Nte={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},ANe=Ze(he({},Nte),{"[class.ng-submitted]":"isSubmitted"}),Yr=(()=>{class t extends $v{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(oe(Rl,2))};static \u0275dir=kt({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(r,o){r&2&&zi("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)},standalone:!1,features:[Tn]})}return t})(),qi=(()=>{class t extends $v{constructor(e){super(e)}static \u0275fac=function(r){return new(r||t)(oe(Nr,10))};static \u0275dir=kt({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(r,o){r&2&&zi("ng-untouched",o.isUntouched)("ng-touched",o.isTouched)("ng-pristine",o.isPristine)("ng-dirty",o.isDirty)("ng-valid",o.isValid)("ng-invalid",o.isInvalid)("ng-pending",o.isPending)("ng-submitted",o.isSubmitted)},standalone:!1,features:[Tn]})}return t})();var bg="VALID",Ov="INVALID",Zp="PENDING",wg="DISABLED",Ol=class{},Lv=class extends Ol{value;source;constructor(n,e){super(),this.value=n,this.source=e}},Sg=class extends Ol{pristine;source;constructor(n,e){super(),this.pristine=n,this.source=e}},_g=class extends Ol{touched;source;constructor(n,e){super(),this.touched=n,this.source=e}},Jp=class extends Ol{status;source;constructor(n,e){super(),this.status=n,this.source=e}},V1=class extends Ol{source;constructor(n){super(),this.source=n}},B1=class extends Ol{source;constructor(n){super(),this.source=n}};function W1(t){return(Uv(t)?t.validators:t)||null}function kte(t){return Array.isArray(t)?j1(t):t||null}function H1(t,n){return(Uv(n)?n.asyncValidators:t)||null}function Ate(t){return Array.isArray(t)?G1(t):t||null}function Uv(t){return t!=null&&!Array.isArray(t)&&typeof t=="object"}function XP(t,n,e){let r=t.controls;if(!(n?Object.keys(r):r).length)throw new De(1e3,"");if(!r[e])throw new De(1001,"")}function YP(t,n,e){t._forEachChild((r,o)=>{if(e[o]===void 0)throw new De(1002,"")})}var ef=class{_pendingDirty=!1;_hasOwnPendingAsyncValidator=null;_pendingTouched=!1;_onCollectionChange=()=>{};_updateOn;_parent=null;_asyncValidationSubscription;_composedValidatorFn;_composedAsyncValidatorFn;_rawValidators;_rawAsyncValidators;value;constructor(n,e){this._assignValidators(n),this._assignAsyncValidators(e)}get validator(){return this._composedValidatorFn}set validator(n){this._rawValidators=this._composedValidatorFn=n}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(n){this._rawAsyncValidators=this._composedAsyncValidatorFn=n}get parent(){return this._parent}get status(){return ji(this.statusReactive)}set status(n){ji(()=>this.statusReactive.set(n))}_status=Cl(()=>this.statusReactive());statusReactive=lo(void 0);get valid(){return this.status===bg}get invalid(){return this.status===Ov}get pending(){return this.status==Zp}get disabled(){return this.status===wg}get enabled(){return this.status!==wg}errors;get pristine(){return ji(this.pristineReactive)}set pristine(n){ji(()=>this.pristineReactive.set(n))}_pristine=Cl(()=>this.pristineReactive());pristineReactive=lo(!0);get dirty(){return!this.pristine}get touched(){return ji(this.touchedReactive)}set touched(n){ji(()=>this.touchedReactive.set(n))}_touched=Cl(()=>this.touchedReactive());touchedReactive=lo(!1);get untouched(){return!this.touched}_events=new Pn;events=this._events.asObservable();valueChanges;statusChanges;get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(n){this._assignValidators(n)}setAsyncValidators(n){this._assignAsyncValidators(n)}addValidators(n){this.setValidators(DP(n,this._rawValidators))}addAsyncValidators(n){this.setAsyncValidators(DP(n,this._rawAsyncValidators))}removeValidators(n){this.setValidators(NP(n,this._rawValidators))}removeAsyncValidators(n){this.setAsyncValidators(NP(n,this._rawAsyncValidators))}hasValidator(n){return Fv(this._rawValidators,n)}hasAsyncValidator(n){return Fv(this._rawAsyncValidators,n)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(n={}){let e=this.touched===!1;this.touched=!0;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsTouched(Ze(he({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new _g(!0,r))}markAllAsTouched(n={}){this.markAsTouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:this}),this._forEachChild(e=>e.markAllAsTouched(n))}markAsUntouched(n={}){let e=this.touched===!0;this.touched=!1,this._pendingTouched=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsUntouched({onlySelf:!0,emitEvent:n.emitEvent,sourceControl:r})}),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,r),e&&n.emitEvent!==!1&&this._events.next(new _g(!1,r))}markAsDirty(n={}){let e=this.pristine===!0;this.pristine=!1;let r=n.sourceControl??this;this._parent&&!n.onlySelf&&this._parent.markAsDirty(Ze(he({},n),{sourceControl:r})),e&&n.emitEvent!==!1&&this._events.next(new Sg(!1,r))}markAsPristine(n={}){let e=this.pristine===!1;this.pristine=!0,this._pendingDirty=!1;let r=n.sourceControl??this;this._forEachChild(o=>{o.markAsPristine({onlySelf:!0,emitEvent:n.emitEvent})}),this._parent&&!n.onlySelf&&this._parent._updatePristine(n,r),e&&n.emitEvent!==!1&&this._events.next(new Sg(!0,r))}markAsPending(n={}){this.status=Zp;let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Jp(this.status,e)),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.markAsPending(Ze(he({},n),{sourceControl:e}))}disable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=wg,this.errors=null,this._forEachChild(o=>{o.disable(Ze(he({},n),{onlySelf:!0}))}),this._updateValue();let r=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Lv(this.value,r)),this._events.next(new Jp(this.status,r)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Ze(he({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(o=>o(!0))}enable(n={}){let e=this._parentMarkedDirty(n.onlySelf);this.status=bg,this._forEachChild(r=>{r.enable(Ze(he({},n),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent}),this._updateAncestors(Ze(he({},n),{skipPristineCheck:e}),this),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(n,e){this._parent&&!n.onlySelf&&(this._parent.updateValueAndValidity(n),n.skipPristineCheck||this._parent._updatePristine({},e),this._parent._updateTouched({},e))}setParent(n){this._parent=n}getRawValue(){return this.value}updateValueAndValidity(n={}){if(this._setInitialStatus(),this._updateValue(),this.enabled){let r=this._cancelExistingSubscription();this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===bg||this.status===Zp)&&this._runAsyncValidator(r,n.emitEvent)}let e=n.sourceControl??this;n.emitEvent!==!1&&(this._events.next(new Lv(this.value,e)),this._events.next(new Jp(this.status,e)),this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!n.onlySelf&&this._parent.updateValueAndValidity(Ze(he({},n),{sourceControl:e}))}_updateTreeValidity(n={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(n)),this.updateValueAndValidity({onlySelf:!0,emitEvent:n.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?wg:bg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(n,e){if(this.asyncValidator){this.status=Zp,this._hasOwnPendingAsyncValidator={emitEvent:e!==!1};let r=zP(this.asyncValidator(this));this._asyncValidationSubscription=r.subscribe(o=>{this._hasOwnPendingAsyncValidator=null,this.setErrors(o,{emitEvent:e,shouldHaveEmitted:n})})}}_cancelExistingSubscription(){if(this._asyncValidationSubscription){this._asyncValidationSubscription.unsubscribe();let n=this._hasOwnPendingAsyncValidator?.emitEvent??!1;return this._hasOwnPendingAsyncValidator=null,n}return!1}setErrors(n,e={}){this.errors=n,this._updateControlsErrors(e.emitEvent!==!1,this,e.shouldHaveEmitted)}get(n){let e=n;return e==null||(Array.isArray(e)||(e=e.split(".")),e.length===0)?null:e.reduce((r,o)=>r&&r._find(o),this)}getError(n,e){let r=e?this.get(e):this;return r&&r.errors?r.errors[n]:null}hasError(n,e){return!!this.getError(n,e)}get root(){let n=this;for(;n._parent;)n=n._parent;return n}_updateControlsErrors(n,e,r){this.status=this._calculateStatus(),n&&this.statusChanges.emit(this.status),(n||r)&&this._events.next(new Jp(this.status,e)),this._parent&&this._parent._updateControlsErrors(n,e,r)}_initObservables(){this.valueChanges=new zt,this.statusChanges=new zt}_calculateStatus(){return this._allControlsDisabled()?wg:this.errors?Ov:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Zp)?Zp:this._anyControlsHaveStatus(Ov)?Ov:bg}_anyControlsHaveStatus(n){return this._anyControls(e=>e.status===n)}_anyControlsDirty(){return this._anyControls(n=>n.dirty)}_anyControlsTouched(){return this._anyControls(n=>n.touched)}_updatePristine(n,e){let r=!this._anyControlsDirty(),o=this.pristine!==r;this.pristine=r,this._parent&&!n.onlySelf&&this._parent._updatePristine(n,e),o&&this._events.next(new Sg(this.pristine,e))}_updateTouched(n={},e){this.touched=this._anyControlsTouched(),this._events.next(new _g(this.touched,e)),this._parent&&!n.onlySelf&&this._parent._updateTouched(n,e)}_onDisabledChange=[];_registerOnCollectionChange(n){this._onCollectionChange=n}_setUpdateStrategy(n){Uv(n)&&n.updateOn!=null&&(this._updateOn=n.updateOn)}_parentMarkedDirty(n){let e=this._parent&&this._parent.dirty;return!n&&!!e&&!this._parent._anyControlsDirty()}_find(n){return null}_assignValidators(n){this._rawValidators=Array.isArray(n)?n.slice():n,this._composedValidatorFn=kte(this._rawValidators)}_assignAsyncValidators(n){this._rawAsyncValidators=Array.isArray(n)?n.slice():n,this._composedAsyncValidatorFn=Ate(this._rawAsyncValidators)}},tf=class extends ef{constructor(n,e,r){super(W1(e),H1(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;registerControl(n,e){return this.controls[n]?this.controls[n]:(this.controls[n]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(n,e,r={}){this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(n,e={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}setControl(n,e,r={}){this.controls[n]&&this.controls[n]._registerOnCollectionChange(()=>{}),delete this.controls[n],e&&this.registerControl(n,e),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(n){return this.controls.hasOwnProperty(n)&&this.controls[n].enabled}setValue(n,e={}){YP(this,!0,n),Object.keys(n).forEach(r=>{XP(this,!0,r),this.controls[r].setValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(Object.keys(n).forEach(r=>{let o=this.controls[r];o&&o.patchValue(n[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n={},e={}){this._forEachChild((r,o)=>{r.reset(n?n[o]:null,{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(n,e,r)=>(n[r]=e.getRawValue(),n))}_syncPendingControls(){let n=this._reduceChildren(!1,(e,r)=>r._syncPendingControls()?!0:e);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){Object.keys(this.controls).forEach(e=>{let r=this.controls[e];r&&n(r,e)})}_setUpControls(){this._forEachChild(n=>{n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(n){for(let[e,r]of Object.entries(this.controls))if(this.contains(e)&&n(r))return!0;return!1}_reduceValue(){let n={};return this._reduceChildren(n,(e,r,o)=>((r.enabled||this.disabled)&&(e[o]=r.value),e))}_reduceChildren(n,e){let r=n;return this._forEachChild((o,i)=>{r=e(r,o,i)}),r}_allControlsDisabled(){for(let n of Object.keys(this.controls))if(this.controls[n].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(n){return this.controls.hasOwnProperty(n)?this.controls[n]:null}};var z1=class extends tf{};var of=new Me("",{providedIn:"root",factory:()=>Tg}),Tg="always";function jv(t,n){return[...n.path,t]}function Vv(t,n,e=Tg){q1(t,n),n.valueAccessor.writeValue(t.value),(t.disabled||e==="always")&&n.valueAccessor.setDisabledState?.(t.disabled),Ote(t,n),Fte(t,n),Mte(t,n),Rte(t,n)}function kP(t,n,e=!0){let r=()=>{};n.valueAccessor&&(n.valueAccessor.registerOnChange(r),n.valueAccessor.registerOnTouched(r)),zv(t,n),t&&(n._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function Bv(t,n){t.forEach(e=>{e.registerOnValidatorChange&&e.registerOnValidatorChange(n)})}function Rte(t,n){if(n.valueAccessor.setDisabledState){let e=r=>{n.valueAccessor.setDisabledState(r)};t.registerOnDisabledChange(e),n._registerOnDestroy(()=>{t._unregisterOnDisabledChange(e)})}}function q1(t,n){let e=qP(t);n.validator!==null?t.setValidators(TP(e,n.validator)):typeof e=="function"&&t.setValidators([e]);let r=KP(t);n.asyncValidator!==null?t.setAsyncValidators(TP(r,n.asyncValidator)):typeof r=="function"&&t.setAsyncValidators([r]);let o=()=>t.updateValueAndValidity();Bv(n._rawValidators,o),Bv(n._rawAsyncValidators,o)}function zv(t,n){let e=!1;if(t!==null){if(n.validator!==null){let o=qP(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.validator);i.length!==o.length&&(e=!0,t.setValidators(i))}}if(n.asyncValidator!==null){let o=KP(t);if(Array.isArray(o)&&o.length>0){let i=o.filter(s=>s!==n.asyncValidator);i.length!==o.length&&(e=!0,t.setAsyncValidators(i))}}}let r=()=>{};return Bv(n._rawValidators,r),Bv(n._rawAsyncValidators,r),e}function Ote(t,n){n.valueAccessor.registerOnChange(e=>{t._pendingValue=e,t._pendingChange=!0,t._pendingDirty=!0,t.updateOn==="change"&&QP(t,n)})}function Mte(t,n){n.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,t.updateOn==="blur"&&t._pendingChange&&QP(t,n),t.updateOn!=="submit"&&t.markAsTouched()})}function QP(t,n){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),n.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function Fte(t,n){let e=(r,o)=>{n.valueAccessor.writeValue(r),o&&n.viewToModelUpdate(r)};t.registerOnChange(e),n._registerOnDestroy(()=>{t._unregisterOnChange(e)})}function ZP(t,n){t==null,q1(t,n)}function Pte(t,n){return zv(t,n)}function JP(t,n){if(!t.hasOwnProperty("model"))return!1;let e=t.model;return e.isFirstChange()?!0:!Object.is(n,e.currentValue)}function $te(t){return Object.getPrototypeOf(t.constructor)===nf}function e$(t,n){t._syncPendingControls(),n.forEach(e=>{let r=e.control;r.updateOn==="submit"&&r._pendingChange&&(e.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function t$(t,n){if(!n)return null;Array.isArray(n);let e,r,o;return n.forEach(i=>{i.constructor===pr?e=i:$te(i)?r=i:o=i}),o||r||e||null}function Lte(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}var Vte={provide:Nr,useExisting:nr(()=>K1)},Cg=Promise.resolve(),K1=(()=>{class t extends Nr{callSetDisabledState;get submitted(){return ji(this.submittedReactive)}_submitted=Cl(()=>this.submittedReactive());submittedReactive=lo(!1);_directives=new Set;form;ngSubmit=new zt;options;constructor(e,r,o){super(),this.callSetDisabledState=o,this.form=new tf({},j1(e),G1(r))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(e){Cg.then(()=>{let r=this._findContainer(e.path);e.control=r.registerControl(e.name,e.control),Vv(e.control,e,this.callSetDisabledState),e.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(e)})}getControl(e){return this.form.get(e.path)}removeControl(e){Cg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name),this._directives.delete(e)})}addFormGroup(e){Cg.then(()=>{let r=this._findContainer(e.path),o=new tf({});ZP(o,e),r.registerControl(e.name,o),o.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(e){Cg.then(()=>{let r=this._findContainer(e.path);r&&r.removeControl(e.name)})}getFormGroup(e){return this.form.get(e.path)}updateModel(e,r){Cg.then(()=>{this.form.get(e.path).setValue(r)})}setValue(e){this.control.setValue(e)}onSubmit(e){return this.submittedReactive.set(!0),e$(this.form,this._directives),this.ngSubmit.emit(e),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this.submittedReactive.set(!1)}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(e){return e.pop(),e.length?this.form.get(e):this.form}static \u0275fac=function(r){return new(r||t)(oe(Fl,10),oe(rf,10),oe(of,8))};static \u0275dir=kt({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(r,o){r&1&&fe("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{options:[0,"ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Er([Vte]),Tn]})}return t})();function AP(t,n){let e=t.indexOf(n);e>-1&&t.splice(e,1)}function RP(t){return typeof t=="object"&&t!==null&&Object.keys(t).length===2&&"value"in t&&"disabled"in t}var Ig=class extends ef{defaultValue=null;_onChange=[];_pendingValue;_pendingChange=!1;constructor(n=null,e,r){super(W1(e),H1(r,e)),this._applyFormState(n),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Uv(e)&&(e.nonNullable||e.initialValueIsDefault)&&(RP(n)?this.defaultValue=n.value:this.defaultValue=n)}setValue(n,e={}){this.value=this._pendingValue=n,this._onChange.length&&e.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,e.emitViewToModelChange!==!1)),this.updateValueAndValidity(e)}patchValue(n,e={}){this.setValue(n,e)}reset(n=this.defaultValue,e={}){this._applyFormState(n),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(n){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(n){this._onChange.push(n)}_unregisterOnChange(n){AP(this._onChange,n)}registerOnDisabledChange(n){this._onDisabledChange.push(n)}_unregisterOnDisabledChange(n){AP(this._onDisabledChange,n)}_forEachChild(n){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(n){RP(n)?(this.value=this._pendingValue=n.value,n.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=n}};var Bte=t=>t instanceof Ig,zte=(()=>{class t extends Nr{_parent;ngOnInit(){this._checkParentType(),this.formDirective.addFormGroup(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormGroup(this)}get control(){return this.formDirective.getFormGroup(this)}get path(){return jv(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,standalone:!1,features:[Tn]})}return t})();var Ute={provide:Rl,useExisting:nr(()=>Bu)},OP=Promise.resolve(),Bu=(()=>{class t extends Rl{_changeDetectorRef;callSetDisabledState;control=new Ig;static ngAcceptInputType_isDisabled;_registered=!1;viewModel;name="";isDisabled;model;options;update=new zt;constructor(e,r,o,i,s,a){super(),this._changeDetectorRef=s,this.callSetDisabledState=a,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=t$(this,i)}ngOnChanges(e){if(this._checkForErrors(),!this._registered||"name"in e){if(this._registered&&(this._checkName(),this.formDirective)){let r=e.name.previousValue;this.formDirective.removeControl({name:r,path:this._getPath(r)})}this._setUpControl()}"isDisabled"in e&&this._updateDisabled(e),JP(e,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){Vv(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(e){OP.then(()=>{this.control.setValue(e,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(e){let r=e.isDisabled.currentValue,o=r!==0&&Iu(r);OP.then(()=>{o&&!this.control.disabled?this.control.disable():!o&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(e){return this._parent?jv(e,this._parent):[e]}static \u0275fac=function(r){return new(r||t)(oe(Nr,9),oe(Fl,10),oe(rf,10),oe(Ml,10),oe(Ut,8),oe(of,8))};static \u0275dir=kt({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"],options:[0,"ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],standalone:!1,features:[Er([Ute]),Tn,pi]})}return t})(),Ki=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275dir=kt({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""],standalone:!1})}return t})(),jte={provide:Ml,useExisting:nr(()=>zu),multi:!0},zu=(()=>{class t extends nf{writeValue(e){let r=e??"";this.setProperty("value",r)}registerOnChange(e){this.onChange=r=>{e(r==""?null:parseFloat(r))}}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(r,o){r&1&&fe("input",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},standalone:!1,features:[Er([jte]),Tn]})}return t})(),Gte={provide:Ml,useExisting:nr(()=>Ws),multi:!0};var Wte=(()=>{class t{_accessors=[];add(e,r){this._accessors.push([e,r])}remove(e){for(let r=this._accessors.length-1;r>=0;--r)if(this._accessors[r][1]===e){this._accessors.splice(r,1);return}}select(e){this._accessors.forEach(r=>{this._isSameGroup(r,e)&&r[1]!==e&&r[1].fireUncheck(e.value)})}_isSameGroup(e,r){return e[0].control?e[0]._parent===r._control._parent&&e[1].name===r.name:!1}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})(),Ws=(()=>{class t extends nf{_registry;_injector;_state;_control;_fn;setDisabledStateFired=!1;onChange=()=>{};name;formControlName;value;callSetDisabledState=de(of,{optional:!0})??Tg;constructor(e,r,o,i){super(e,r),this._registry=o,this._injector=i}ngOnInit(){this._control=this._injector.get(Rl),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(e){this._state=e===this.value,this.setProperty("checked",this._state)}registerOnChange(e){this._fn=e,this.onChange=()=>{e(this.value),this._registry.select(this)}}setDisabledState(e){(this.setDisabledStateFired||e||this.callSetDisabledState==="whenDisabledForLegacyCode")&&this.setProperty("disabled",e),this.setDisabledStateFired=!0}fireUncheck(e){this.writeValue(e)}_checkName(){this.name&&this.formControlName&&(this.name,this.formControlName),!this.name&&this.formControlName&&(this.name=this.formControlName)}static \u0275fac=function(r){return new(r||t)(oe(mi),oe(Ro),oe(Wte),oe(Wn))};static \u0275dir=kt({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(r,o){r&1&&fe("change",function(){return o.onChange()})("blur",function(){return o.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},standalone:!1,features:[Er([Gte]),Tn]})}return t})();var n$=new Me("");var Hte={provide:Nr,useExisting:nr(()=>Xi)},Xi=(()=>{class t extends Nr{callSetDisabledState;get submitted(){return ji(this._submittedReactive)}set submitted(e){this._submittedReactive.set(e)}_submitted=Cl(()=>this._submittedReactive());_submittedReactive=lo(!1);_oldForm;_onCollectionChange=()=>this._updateDomValue();directives=[];form=null;ngSubmit=new zt;constructor(e,r,o){super(),this.callSetDisabledState=o,this._setValidators(e),this._setAsyncValidators(r)}ngOnChanges(e){this._checkFormPresent(),e.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(zv(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(e){let r=this.form.get(e.path);return Vv(r,e,this.callSetDisabledState),r.updateValueAndValidity({emitEvent:!1}),this.directives.push(e),r}getControl(e){return this.form.get(e.path)}removeControl(e){kP(e.control||null,e,!1),Lte(this.directives,e)}addFormGroup(e){this._setUpFormContainer(e)}removeFormGroup(e){this._cleanUpFormContainer(e)}getFormGroup(e){return this.form.get(e.path)}addFormArray(e){this._setUpFormContainer(e)}removeFormArray(e){this._cleanUpFormContainer(e)}getFormArray(e){return this.form.get(e.path)}updateModel(e,r){this.form.get(e.path).setValue(r)}onSubmit(e){return this._submittedReactive.set(!0),e$(this.form,this.directives),this.ngSubmit.emit(e),this.form._events.next(new V1(this.control)),e?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(e=void 0){this.form.reset(e),this._submittedReactive.set(!1),this.form._events.next(new B1(this.form))}_updateDomValue(){this.directives.forEach(e=>{let r=e.control,o=this.form.get(e.path);r!==o&&(kP(r||null,e),Bte(o)&&(Vv(o,e,this.callSetDisabledState),e.control=o))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(e){let r=this.form.get(e.path);ZP(r,e),r.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(e){if(this.form){let r=this.form.get(e.path);r&&Pte(r,e)&&r.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){q1(this.form,this),this._oldForm&&zv(this._oldForm,this)}_checkFormPresent(){this.form}static \u0275fac=function(r){return new(r||t)(oe(Fl,10),oe(rf,10),oe(of,8))};static \u0275dir=kt({type:t,selectors:[["","formGroup",""]],hostBindings:function(r,o){r&1&&fe("submit",function(s){return o.onSubmit(s)})("reset",function(){return o.onReset()})},inputs:{form:[0,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],standalone:!1,features:[Er([Hte]),Tn,pi]})}return t})(),qte={provide:Nr,useExisting:nr(()=>Gv)},Gv=(()=>{class t extends zte{name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}_checkParentType(){r$(this._parent)}static \u0275fac=function(r){return new(r||t)(oe(Nr,13),oe(Fl,10),oe(rf,10))};static \u0275dir=kt({type:t,selectors:[["","formGroupName",""]],inputs:{name:[0,"formGroupName","name"]},standalone:!1,features:[Er([qte]),Tn]})}return t})(),Kte={provide:Nr,useExisting:nr(()=>Wv)},Wv=(()=>{class t extends Nr{_parent;name=null;constructor(e,r,o){super(),this._parent=e,this._setValidators(r),this._setAsyncValidators(o)}ngOnInit(){this.formDirective.addFormArray(this)}ngOnDestroy(){this.formDirective&&this.formDirective.removeFormArray(this)}get control(){return this.formDirective.getFormArray(this)}get formDirective(){return this._parent?this._parent.formDirective:null}get path(){return jv(this.name==null?this.name:this.name.toString(),this._parent)}_checkParentType(){r$(this._parent)}static \u0275fac=function(r){return new(r||t)(oe(Nr,13),oe(Fl,10),oe(rf,10))};static \u0275dir=kt({type:t,selectors:[["","formArrayName",""]],inputs:{name:[0,"formArrayName","name"]},standalone:!1,features:[Er([Kte]),Tn]})}return t})();function r$(t){return!(t instanceof Gv)&&!(t instanceof Xi)&&!(t instanceof Wv)}var Xte={provide:Rl,useExisting:nr(()=>Hs)},Hs=(()=>{class t extends Rl{_ngModelWarningConfig;_added=!1;viewModel;control;name=null;set isDisabled(e){}model;update=new zt;static _ngModelWarningSentOnce=!1;_ngModelWarningSent=!1;constructor(e,r,o,i,s){super(),this._ngModelWarningConfig=s,this._parent=e,this._setValidators(r),this._setAsyncValidators(o),this.valueAccessor=t$(this,i)}ngOnChanges(e){this._added||this._setUpControl(),JP(e,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(e){this.viewModel=e,this.update.emit(e)}get path(){return jv(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this.control=this.formDirective.addControl(this),this._added=!0}static \u0275fac=function(r){return new(r||t)(oe(Nr,13),oe(Fl,10),oe(rf,10),oe(Ml,10),oe(n$,8))};static \u0275dir=kt({type:t,selectors:[["","formControlName",""]],inputs:{name:[0,"formControlName","name"],isDisabled:[0,"disabled","isDisabled"],model:[0,"ngModel","model"]},outputs:{update:"ngModelChange"},standalone:!1,features:[Er([Xte]),Tn,pi]})}return t})(),Yte={provide:Ml,useExisting:nr(()=>Yi),multi:!0};function o$(t,n){return t==null?`${n}`:(n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function Qte(t){return t.split(":")[0]}var Yi=(()=>{class t extends nf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r=this._getOptionId(e),o=o$(r,e);this.setProperty("value",o)}registerOnChange(e){this.onChange=r=>{this.value=this._getOptionValue(r),e(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r),e))return r;return null}_getOptionValue(e){let r=Qte(e);return this._optionMap.has(r)?this._optionMap.get(r):e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(r,o){r&1&&fe("change",function(s){return o.onChange(s.target.value)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Er([Yte]),Tn]})}return t})(),Pl=(()=>{class t{_element;_renderer;_select;id;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption())}set ngValue(e){this._select!=null&&(this._select._optionMap.set(this.id,e),this._setElementValue(o$(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._setElementValue(e),this._select&&this._select.writeValue(this._select.value)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(oe(Ro),oe(mi),oe(Yi,9))};static \u0275dir=kt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})(),Zte={provide:Ml,useExisting:nr(()=>i$),multi:!0};function MP(t,n){return t==null?`${n}`:(typeof n=="string"&&(n=`'${n}'`),n&&typeof n=="object"&&(n="Object"),`${t}: ${n}`.slice(0,50))}function Jte(t){return t.split(":")[0]}var i$=(()=>{class t extends nf{value;_optionMap=new Map;_idCounter=0;set compareWith(e){this._compareWith=e}_compareWith=Object.is;writeValue(e){this.value=e;let r;if(Array.isArray(e)){let o=e.map(i=>this._getOptionId(i));r=(i,s)=>{i._setSelected(o.indexOf(s.toString())>-1)}}else r=(o,i)=>{o._setSelected(!1)};this._optionMap.forEach(r)}registerOnChange(e){this.onChange=r=>{let o=[],i=r.selectedOptions;if(i!==void 0){let s=i;for(let a=0;a<s.length;a++){let l=s[a],c=this._getOptionValue(l.value);o.push(c)}}else{let s=r.options;for(let a=0;a<s.length;a++){let l=s[a];if(l.selected){let c=this._getOptionValue(l.value);o.push(c)}}}this.value=o,e(o)}}_registerOption(e){let r=(this._idCounter++).toString();return this._optionMap.set(r,e),r}_getOptionId(e){for(let r of this._optionMap.keys())if(this._compareWith(this._optionMap.get(r)._value,e))return r;return null}_getOptionValue(e){let r=Jte(e);return this._optionMap.has(r)?this._optionMap.get(r)._value:e}static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(r,o){r&1&&fe("change",function(s){return o.onChange(s.target)})("blur",function(){return o.onTouched()})},inputs:{compareWith:"compareWith"},standalone:!1,features:[Er([Zte]),Tn]})}return t})(),$l=(()=>{class t{_element;_renderer;_select;id;_value;constructor(e,r,o){this._element=e,this._renderer=r,this._select=o,this._select&&(this.id=this._select._registerOption(this))}set ngValue(e){this._select!=null&&(this._value=e,this._setElementValue(MP(this.id,e)),this._select.writeValue(this._select.value))}set value(e){this._select?(this._value=e,this._setElementValue(MP(this.id,e)),this._select.writeValue(this._select.value)):this._setElementValue(e)}_setElementValue(e){this._renderer.setProperty(this._element.nativeElement,"value",e)}_setSelected(e){this._renderer.setProperty(this._element.nativeElement,"selected",e)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}static \u0275fac=function(r){return new(r||t)(oe(Ro),oe(mi),oe(i$,9))};static \u0275dir=kt({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"},standalone:!1})}return t})();function s$(t){return typeof t=="number"?t:parseFloat(t)}var a$=(()=>{class t{_validator=Mv;_onChange;_enabled;ngOnChanges(e){if(this.inputName in e){let r=this.normalizeInput(e[this.inputName].currentValue);this._enabled=this.enabled(r),this._validator=this._enabled?this.createValidator(r):Mv,this._onChange&&this._onChange()}}validate(e){return this._validator(e)}registerOnValidatorChange(e){this._onChange=e}enabled(e){return e!=null}static \u0275fac=function(r){return new(r||t)};static \u0275dir=kt({type:t,features:[pi]})}return t})(),ene={provide:Fl,useExisting:nr(()=>X1),multi:!0},X1=(()=>{class t extends a${max;inputName="max";normalizeInput=e=>s$(e);createValidator=e=>VP(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,selectors:[["input","type","number","max","","formControlName",""],["input","type","number","max","","formControl",""],["input","type","number","max","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&Dp("max",o._enabled?o.max:null)},inputs:{max:"max"},standalone:!1,features:[Er([ene]),Tn]})}return t})(),tne={provide:Fl,useExisting:nr(()=>Dg),multi:!0},Dg=(()=>{class t extends a${min;inputName="min";normalizeInput=e=>s$(e);createValidator=e=>LP(e);static \u0275fac=(()=>{let e;return function(o){return(e||(e=Ao(t)))(o||t)}})();static \u0275dir=kt({type:t,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(r,o){r&2&&Dp("min",o._enabled?o.min:null)},inputs:{min:"min"},standalone:!1,features:[Er([tne]),Tn]})}return t})();var l$=(()=>{class t{static \u0275fac=function(r){return new(r||t)};static \u0275mod=Rs({type:t});static \u0275inj=Ts({})}return t})(),U1=class extends ef{constructor(n,e,r){super(W1(e),H1(r,e)),this.controls=n,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}controls;at(n){return this.controls[this._adjustIndex(n)]}push(n,e={}){this.controls.push(n),this._registerControl(n),this.updateValueAndValidity({emitEvent:e.emitEvent}),this._onCollectionChange()}insert(n,e,r={}){this.controls.splice(n,0,e),this._registerControl(e),this.updateValueAndValidity({emitEvent:r.emitEvent})}removeAt(n,e={}){let r=this._adjustIndex(n);r<0&&(r=0),this.controls[r]&&this.controls[r]._registerOnCollectionChange(()=>{}),this.controls.splice(r,1),this.updateValueAndValidity({emitEvent:e.emitEvent})}setControl(n,e,r={}){let o=this._adjustIndex(n);o<0&&(o=0),this.controls[o]&&this.controls[o]._registerOnCollectionChange(()=>{}),this.controls.splice(o,1),e&&(this.controls.splice(o,0,e),this._registerControl(e)),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(n,e={}){YP(this,!1,n),n.forEach((r,o)=>{XP(this,!1,o),this.at(o).setValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(n,e={}){n!=null&&(n.forEach((r,o)=>{this.at(o)&&this.at(o).patchValue(r,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(n=[],e={}){this._forEachChild((r,o)=>{r.reset(n[o],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e,this),this._updateTouched(e,this),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(n=>n.getRawValue())}clear(n={}){this.controls.length<1||(this._forEachChild(e=>e._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:n.emitEvent}))}_adjustIndex(n){return n<0?n+this.length:n}_syncPendingControls(){let n=this.controls.reduce((e,r)=>r._syncPendingControls()?!0:e,!1);return n&&this.updateValueAndValidity({onlySelf:!0}),n}_forEachChild(n){this.controls.forEach((e,r)=>{n(e,r)})}_updateValue(){this.value=this.controls.filter(n=>n.enabled||this.disabled).map(n=>n.value)}_anyControls(n){return this.controls.some(e=>e.enabled&&n(e))}_setUpControls(){this._forEachChild(n=>this._registerControl(n))}_allControlsDisabled(){for(let n of this.controls)if(n.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(n){n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange)}_find(n){return this.at(n)??null}};function FP(t){return!!t&&(t.asyncValidators!==void 0||t.validators!==void 0||t.updateOn!==void 0)}var Ll=(()=>{class t{useNonNullable=!1;get nonNullable(){let e=new t;return e.useNonNullable=!0,e}group(e,r=null){let o=this._reduceControls(e),i={};return FP(r)?i=r:r!==null&&(i.validators=r.validator,i.asyncValidators=r.asyncValidator),new tf(o,i)}record(e,r=null){let o=this._reduceControls(e);return new z1(o,r)}control(e,r,o){let i={};return this.useNonNullable?(FP(r)?i=r:(i.validators=r,i.asyncValidators=o),new Ig(e,Ze(he({},i),{nonNullable:!0}))):new Ig(e,r,o)}array(e,r,o){let i=e.map(s=>this._createControl(s));return new U1(i,r,o)}_reduceControls(e){let r={};return Object.keys(e).forEach(o=>{r[o]=this._createControl(e[o])}),r}_createControl(e){if(e instanceof Ig)return e;if(e instanceof ef)return e;if(Array.isArray(e)){let r=e[0],o=e.length>1?e[1]:null,i=e.length>2?e[2]:null;return this.control(r,o,i)}else return this.control(e)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=Re({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})();var sf=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:of,useValue:e.callSetDisabledState??Tg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Rs({type:t});static \u0275inj=Ts({imports:[l$]})}return t})(),Qi=(()=>{class t{static withConfig(e){return{ngModule:t,providers:[{provide:n$,useValue:e.warnOnNgModelWithFormControl??"always"},{provide:of,useValue:e.callSetDisabledState??Tg}]}}static \u0275fac=function(r){return new(r||t)};static \u0275mod=Rs({type:t});static \u0275inj=Ts({imports:[l$]})}return t})();var sr=[];for(let t=0;t<256;++t)sr.push((t+256).toString(16).slice(1));function c$(t,n=0){return(sr[t[n+0]]+sr[t[n+1]]+sr[t[n+2]]+sr[t[n+3]]+"-"+sr[t[n+4]]+sr[t[n+5]]+"-"+sr[t[n+6]]+sr[t[n+7]]+"-"+sr[t[n+8]]+sr[t[n+9]]+"-"+sr[t[n+10]]+sr[t[n+11]]+sr[t[n+12]]+sr[t[n+13]]+sr[t[n+14]]+sr[t[n+15]]).toLowerCase()}var Y1,nne=new Uint8Array(16);function Q1(){if(!Y1){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");Y1=crypto.getRandomValues.bind(crypto)}return Y1(nne)}var rne=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Z1={randomUUID:rne};function one(t,n,e){if(Z1.randomUUID&&!n&&!t)return Z1.randomUUID();t=t||{};let r=t.random??t.rng?.()??Q1();if(r.length<16)throw new Error("Random bytes length must be >= 16");if(r[6]=r[6]&15|64,r[8]=r[8]&63|128,n){if(e=e||0,e<0||e+16>n.length)throw new RangeError(`UUID byte range ${e}:${e+15} is out of buffer bounds`);for(let o=0;o<16;++o)n[e+o]=r[o];return n}return c$(r)}var ju=one;var ine=(t,n)=>({"text-success":t,"text-danger":n});function sne(t,n){if(t&1&&(w(0,"div",138),j(1,"div",139),x()),t&2){let e=re();$(),Np("width",e.calculateFormProgress()+"%")}}function ane(t,n){if(t&1&&(w(0,"span",140),_(1),x()),t&2){let e=re();$(),Ge("",e.calculateFormProgress(),"% Complete")}}function lne(t,n){t&1&&(w(0,"div",141),_(1," Account name is required "),x())}function cne(t,n){t&1&&(w(0,"div",141),_(1," Please select an instrument type "),x())}function une(t,n){t&1&&(w(0,"div",141),_(1," Trade symbol is required "),x())}function dne(t,n){t&1&&(w(0,"div",141),_(1," Please select trade direction "),x())}function pne(t,n){t&1&&(w(0,"div",141),_(1," Time frame selection is required "),x())}function fne(t,n){t&1&&(w(0,"div",141),_(1," Please select an analysis type "),x())}function mne(t,n){t&1&&(w(0,"div",141),_(1," Strategy name is required "),x())}function hne(t,n){t&1&&(w(0,"div",141),_(1," Order type is required "),x())}function gne(t,n){t&1&&(w(0,"div",141),_(1," Entry criteria is required (min 10 characters) "),x())}function yne(t,n){t&1&&(w(0,"div",141),_(1," Exit strategy is required (min 10 characters) "),x())}function xne(t,n){t&1&&(w(0,"div",141),_(1," Valid account balance is required "),x())}function vne(t,n){t&1&&(w(0,"div",141),_(1," Position size is required "),x())}function bne(t,n){t&1&&(w(0,"div",141),_(1," Valid entry price is required "),x())}function wne(t,n){t&1&&(w(0,"div",141),_(1," Entry date/time is required "),x())}function Cne(t,n){t&1&&(w(0,"div",141),_(1," Stop loss price is required "),x())}function Sne(t,n){t&1&&(w(0,"div",141),_(1," Take profit price is required "),x())}function _ne(t,n){t&1&&(w(0,"div",141),_(1," Risk percentage is required "),x())}function Ine(t,n){t&1&&(w(0,"div",142),j(1,"i",143),_(2," Risk exceeds recommended 2% "),x())}function Ene(t,n){t&1&&(w(0,"div",141),_(1," Estimated reward is required "),x())}function Tne(t,n){t&1&&(w(0,"div",141),_(1," Please select your emotional state "),x())}function Dne(t,n){t&1&&(w(0,"div",142),j(1,"i",143),_(2," Consider if this emotional state might negatively impact your decision making "),x())}function Nne(t,n){t&1&&(w(0,"div",144),_(1," Please rate your confidence "),x())}function kne(t,n){t&1&&(w(0,"div",141),_(1," Please identify potential biases (min 5 characters) "),x())}function Ane(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Trade Setup"),x())}function Rne(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Strategy Details"),x())}function One(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Risk Management"),x())}function Mne(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Psychological Analysis"),x())}function Fne(t,n){if(t&1&&(w(0,"div",145),j(1,"i",146),w(2,"strong"),_(3,"Please fix the errors highlighted above before submitting."),x(),w(4,"ul",147),ae(5,Ane,2,0,"li",148)(6,Rne,2,0,"li",148)(7,One,2,0,"li",148)(8,Mne,2,0,"li",148),x()()),t&2){let e=re();$(5),W("ngIf",e.hasErrors("tradeSetup")),$(),W("ngIf",e.hasErrors("strategyDetails")),$(),W("ngIf",e.hasErrors("riskManagement")),$(),W("ngIf",e.hasErrors("psychologicalAnalysis"))}}function Pne(t,n){if(t&1){let e=mt();w(0,"button",149),fe("click",function(){Ce(e);let o=re();return Se(o.onCancel())}),j(1,"i",150),_(2,"Cancel "),x()}}function $ne(t,n){if(t&1&&(w(0,"div",151),j(1,"i",152),_(2),x()),t&2){let e=re();$(2),Ge("",e.message," ")}}function Lne(t,n){if(t&1&&(w(0,"div",153),j(1,"i",146),_(2),x()),t&2){let e=re();$(2),Ge("",e.errorMessage," ")}}var af=class t{constructor(n,e,r){this.fb=n;this.supabaseService=e;this.cdr=r}tradeLogData=null;formSubmitted=new zt;cancel=new zt;preTradeTableName="pretrade";postTradeTableName="posttrade";preTradeForm;postTradeForm;showEmotionalSection=!1;message="";errorMessage="";formSubmitMarker=!1;ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=ju();this.preTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[this.tradeLogData?.createdtime??new Date().toISOString()],accountname:[this.tradeLogData?.accountname??"",_e.required],instrumenttype:[this.tradeLogData?.instrumenttype??"",_e.required],analysistype:[this.tradeLogData?.analysistype??"",_e.required],tradesymbol:[this.tradeLogData?.tradesymbol??"",_e.required],tradetype:[this.tradeLogData?.tradetype??"Long",_e.required],timeframe:[this.tradeLogData?.timeframe??"Day",_e.required],strategyname:[this.tradeLogData?.strategyname??""],typeoforder:[this.tradeLogData?.typeoforder??"",_e.required],entrycriteria:[this.tradeLogData?.entrycriteria??""],exitstrategy:[this.tradeLogData?.exitstrategy??""],entrydatetime:[this.tradeLogData?.entrydatetime??""],entryprice:[this.tradeLogData?.entryprice??""],accountbalance:[this.tradeLogData?.accountbalance??null,[_e.required,_e.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",_e.required],estimatedrisk:[this.tradeLogData?.estimatedrisk??null,_e.required],estimatedpnl:[this.tradeLogData?.estimatedpnl??null,_e.required],estimatedstoploss:[this.tradeLogData?.estimatedstoploss??null,_e.required],estimatedtakeprofit:[this.tradeLogData?.estimatedtakeprofit??null,_e.required],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],tradeconfidence:[this.tradeLogData?.tradeconfidence??"1"],isopen:!0,emotionalstatebefore:[this.tradeLogData?.emotionalstatebefore??"",_e.required],potentialbiases:[this.tradeLogData?.potentialbiases??"",_e.required],notes:[this.tradeLogData?.notes??""],updatedtime:[new Date().toISOString()]})}toggleEmotionalSection(){this.showEmotionalSection=!this.showEmotionalSection}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.preTradeForm.patchValue({setupscreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.preTradeForm.invalid){this.preTradeForm.markAllAsTouched();return}let n=this.preTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.preTradeTableName):await this.supabaseService.addTradeLog(n,this.preTradeTableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.preTradeForm.reset(),this.preTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.preTradeTableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateFormProgress(){let e=0;return this.preTradeForm.get("accountname")?.valid&&e++,this.preTradeForm.get("instrumenttype")?.valid&&e++,this.preTradeForm.get("tradesymbol")?.valid&&e++,this.preTradeForm.get("tradetype")?.valid&&e++,this.preTradeForm.get("timeframe")?.valid&&e++,this.preTradeForm.get("analysistype")?.valid&&e++,this.preTradeForm.get("strategyname")?.valid&&e++,this.preTradeForm.get("typeoforder")?.valid&&e++,this.preTradeForm.get("entrycriteria")?.valid&&e++,this.preTradeForm.get("exitstrategy")?.valid&&e++,this.preTradeForm.get("accountbalance")?.valid&&e++,this.preTradeForm.get("positionsize")?.valid&&e++,this.preTradeForm.get("entryprice")?.valid&&e++,this.preTradeForm.get("entrydatetime")?.valid&&e++,this.preTradeForm.get("estimatedstoploss")?.valid&&e++,this.preTradeForm.get("estimatedtakeprofit")?.valid&&e++,this.preTradeForm.get("estimatedrisk")?.valid&&e++,this.preTradeForm.get("estimatedpnl")?.valid&&e++,this.preTradeForm.get("emotionalstatebefore")?.valid&&e++,this.preTradeForm.get("tradeConfidence")?.valid&&e++,this.preTradeForm.get("potentialbiases")?.valid&&e++,Math.round(e/18*100)}calculateRiskRewardRatio(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?"N/A":`1:${(e/n).toFixed(2)}`}isGoodRiskReward(){let n=parseFloat(this.preTradeForm.get("estimatedrisk")?.value||"0"),e=parseFloat(this.preTradeForm.get("estimatedpnl")?.value||"0");return n<=0||e<=0?!1:e/n>=2}isNegativeEmotionalState(){let n=this.preTradeForm.get("emotionalstatebefore")?.value;return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}hasErrors(n){switch(n){case"tradeSetup":return this.preTradeForm.get("accountname")?.invalid||this.preTradeForm.get("instrumenttype")?.invalid||this.preTradeForm.get("tradesymbol")?.invalid||this.preTradeForm.get("tradetype")?.invalid||this.preTradeForm.get("timeframe")?.invalid||this.preTradeForm.get("analysistype")?.invalid||!1;case"strategyDetails":return this.preTradeForm.get("strategyname")?.invalid||this.preTradeForm.get("typeoforder")?.invalid||this.preTradeForm.get("entrycriteria")?.invalid||this.preTradeForm.get("exitstrategy")?.invalid||!1;case"riskManagement":return this.preTradeForm.get("accountbalance")?.invalid||this.preTradeForm.get("positionsize")?.invalid||this.preTradeForm.get("entryprice")?.invalid||this.preTradeForm.get("entrydatetime")?.invalid||this.preTradeForm.get("estimatedstoploss")?.invalid||this.preTradeForm.get("estimatedtakeprofit")?.invalid||this.preTradeForm.get("estimatedrisk")?.invalid||this.preTradeForm.get("estimatedpnl")?.invalid||!1;case"psychologicalAnalysis":return this.preTradeForm.get("emotionalstatebefore")?.invalid||this.preTradeForm.get("tradeConfidence")?.invalid||this.preTradeForm.get("potentialbiases")?.invalid||!1;default:return!1}}static \u0275fac=function(e){return new(e||t)(oe(Ll),oe(jt),oe(Ut))};static \u0275cmp=Pt({type:t,selectors:[["app-pre-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:332,vars:40,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],[3,"click"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","entrycriteria",1,"form-label"],["id","entrycriteria","formControlName","entrycriteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)","rows","3",1,"form-control"],[1,"form-text"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Define your profit targets and stop loss levels","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],["type","button","data-bs-toggle","tooltip","title","Calculate based on risk",1,"btn","btn-outline-secondary"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Planned entry price",1,"form-control"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","estimatedstoploss",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedstoploss","formControlName","estimatedstoploss","placeholder","Stop loss price level",1,"form-control"],["for","estimatedtakeprofit",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedtakeprofit","formControlName","estimatedtakeprofit","placeholder","Target price level",1,"form-control"],[1,"mb-3"],[1,"col-md-4"],["for","estimatedrisk",1,"form-label"],["type","number","step","0.01","min","0","max","100","id","estimatedrisk","formControlName","estimatedrisk","placeholder","1-2% recommended",1,"form-control"],["class","text-warning mt-1 small",4,"ngIf"],["for","estimatedpnl",1,"form-label"],["type","number","step","0.01","min","0","id","estimatedpnl","formControlName","estimatedpnl","placeholder","Expected % gain",1,"form-control"],[1,"form-label"],["type","text","readonly","",1,"form-control","bg-light",3,"value"],[1,"form-text",3,"ngClass"],[1,"bi","bi-5-circle","me-2"],["for","emotionalstatebefore",1,"form-label"],["id","emotionalstatebefore","formControlName","emotionalstatebefore",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],[1,"form-label","d-block"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","tradeconfidence","id","confidence1","value","1",1,"btn-check"],["for","confidence1",1,"btn","btn-outline-danger"],["type","radio","formControlName","tradeconfidence","id","confidence2","value","2",1,"btn-check"],["for","confidence2",1,"btn","btn-outline-warning"],["type","radio","formControlName","tradeconfidence","id","confidence3","value","3",1,"btn-check"],["for","confidence3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","tradeconfidence","id","confidence4","value","4",1,"btn-check"],["for","confidence4",1,"btn","btn-outline-primary"],["type","radio","formControlName","tradeconfidence","id","confidence5","value","5",1,"btn-check"],["for","confidence5",1,"btn","btn-outline-success"],[1,"form-text","text-center","mt-1"],["class","text-danger mt-1 small text-center",4,"ngIf"],["for","potentialbiases",1,"form-label"],["id","potentialbiases","formControlName","potentialbiases","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO, overconfidence)","rows","3",1,"form-control"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"text-warning","mt-1","small"],[1,"bi","bi-exclamation-triangle"],[1,"text-danger","mt-1","small","text-center"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(w(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),_(5,"Dashboard"),x()(),w(6,"li",3)(7,"a",5),fe("click",function(){return r.onCancel()}),_(8,"Pre-Trade Logs"),x()(),w(9,"li",6),_(10,"Pre-Trading Journal"),x()()(),w(11,"div",7)(12,"div",8)(13,"h2",9),_(14),x(),w(15,"p",10),_(16,"Document your strategy before entering positions to maintain discipline and clarity"),x()(),w(17,"div",11),ae(18,sne,2,2,"div",12)(19,ane,2,1,"span",13),x()(),w(20,"form",14),fe("ngSubmit",function(){return r.onSubmit()}),w(21,"div",15)(22,"div",16)(23,"h5",17),j(24,"i",18),_(25,"Trade Setup "),x(),w(26,"span",19),_(27,"Required"),x()(),w(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),_(32,"Account Name"),x(),w(33,"div",24)(34,"span",25),j(35,"i",26),x(),j(36,"input",27),x(),ae(37,lne,2,0,"div",28),x(),w(38,"div",22)(39,"label",29),_(40,"Instrument Type"),x(),w(41,"select",30)(42,"option",31),_(43,"Choose instrument type"),x(),w(44,"option",32),_(45,"Forex"),x(),w(46,"option",33),_(47,"Stocks"),x(),w(48,"option",34),_(49,"Futures"),x(),w(50,"option",35),_(51,"Crypto"),x(),w(52,"option",36),_(53,"Options"),x(),w(54,"option",37),_(55,"ETF"),x(),w(56,"option",38),_(57,"Other"),x()(),ae(58,cne,2,0,"div",28),x(),w(59,"div",22)(60,"label",39),_(61,"Trade Symbol"),x(),w(62,"div",24)(63,"span",25),j(64,"i",40),x(),j(65,"input",41),x(),ae(66,une,2,0,"div",28),x(),w(67,"div",22)(68,"label",42),_(69,"Trade Direction"),x(),w(70,"div",43),j(71,"input",44),w(72,"label",45),_(73,"Long"),x(),j(74,"input",46),w(75,"label",47),_(76,"Short"),x()(),ae(77,dne,2,0,"div",28),x(),w(78,"div",22)(79,"label",48),_(80,"Time Frame"),x(),w(81,"select",49)(82,"option",31),_(83,"Select time frame"),x(),w(84,"option",50),_(85,"Scalp (minutes)"),x(),w(86,"option",51),_(87,"Day Trade (hours)"),x(),w(88,"option",52),_(89,"Swing (days-weeks)"),x(),w(90,"option",53),_(91,"Position (weeks-months)"),x(),w(92,"option",54),_(93,"Long Term (months+)"),x()(),ae(94,pne,2,0,"div",28),x(),w(95,"div",22)(96,"label",55),_(97,"Analysis Type"),x(),w(98,"select",56)(99,"option",31),_(100,"Choose analysis method"),x(),w(101,"option",57),_(102,"Technical"),x(),w(103,"option",58),_(104,"Fundamental"),x(),w(105,"option",59),_(106,"Both"),x(),w(107,"option",60),_(108,"Sentiment"),x(),w(109,"option",38),_(110,"Other"),x()(),ae(111,fne,2,0,"div",28),x()()()(),w(112,"div",15)(113,"div",16)(114,"h5",17),j(115,"i",61),_(116,"Strategy Details "),x(),w(117,"span",19),_(118,"Required"),x()(),w(119,"div",20)(120,"div",21)(121,"div",22)(122,"label",62),_(123,"Strategy Name"),x(),j(124,"input",63),ae(125,mne,2,0,"div",28),x(),w(126,"div",22)(127,"label",64),_(128,"Type of Order"),x(),w(129,"select",65)(130,"option",31),_(131,"Choose order type"),x(),w(132,"option",66),_(133,"Market"),x(),w(134,"option",67),_(135,"Limit"),x(),w(136,"option",68),_(137,"Stop"),x(),w(138,"option",69),_(139,"Stop Limit"),x(),w(140,"option",70),_(141,"Trailing Stop"),x()(),ae(142,hne,2,0,"div",28),x(),w(143,"div",71)(144,"label",72),_(145,"Entry Criteria "),w(146,"span",10),_(147,"(Why are you taking this trade?)"),x()(),j(148,"textarea",73),w(149,"div",74),_(150,"Be specific about what signals or conditions must be met for entry."),x(),ae(151,gne,2,0,"div",28),x(),w(152,"div",71)(153,"label",75),_(154,"Exit Strategy "),w(155,"span",10),_(156,"(How will you close this position?)"),x()(),j(157,"textarea",76),w(158,"div",74),_(159,"Include both profit-taking and loss-cutting criteria."),x(),ae(160,yne,2,0,"div",28),x()()()(),w(161,"div",15)(162,"div",16)(163,"h5",17),j(164,"i",77),_(165,"Risk Management "),x(),w(166,"span",19),_(167,"Required"),x()(),w(168,"div",20)(169,"div",21)(170,"div",22)(171,"label",78),_(172,"Account Balance"),x(),w(173,"div",24)(174,"span",25),_(175,"$"),x(),j(176,"input",79),x(),ae(177,xne,2,0,"div",28),x(),w(178,"div",22)(179,"label",80),_(180,"Position Size"),x(),w(181,"div",24),j(182,"input",81),w(183,"button",82),_(184,"Calculate"),x()(),ae(185,vne,2,0,"div",28),x(),w(186,"div",22)(187,"label",83),_(188,"Entry Price"),x(),w(189,"div",24)(190,"span",25),_(191,"$"),x(),j(192,"input",84),x(),ae(193,bne,2,0,"div",28),x(),w(194,"div",22)(195,"label",85),_(196,"Entry Date/Time"),x(),j(197,"input",86),ae(198,wne,2,0,"div",28),x(),w(199,"div",22)(200,"label",87),_(201,"Stop Loss Price"),x(),w(202,"div",24)(203,"span",25),_(204,"$"),x(),j(205,"input",88),x(),ae(206,Cne,2,0,"div",28),x(),w(207,"div",22)(208,"label",89),_(209,"Take Profit Price"),x(),w(210,"div",24)(211,"span",25),_(212,"$"),x(),j(213,"input",90),x(),ae(214,Sne,2,0,"div",28),x(),w(215,"div",71),j(216,"hr"),w(217,"h6",91),_(218,"Risk/Reward Analysis"),x()(),w(219,"div",92)(220,"label",93),_(221,"Risk Per Trade"),x(),w(222,"div",24),j(223,"input",94),w(224,"span",25),_(225,"%"),x()(),w(226,"div",74),_(227,"Percentage of account at risk"),x(),ae(228,_ne,2,0,"div",28)(229,Ine,3,0,"div",95),x(),w(230,"div",92)(231,"label",96),_(232,"Estimated Reward"),x(),w(233,"div",24),j(234,"input",97),w(235,"span",25),_(236,"%"),x()(),ae(237,Ene,2,0,"div",28),x(),w(238,"div",92)(239,"label",98),_(240,"Risk/Reward Ratio"),x(),w(241,"div",24),j(242,"input",99),w(243,"span",25),_(244,"R:R"),x()(),w(245,"div",100),j(246,"i"),_(247),x()()()()(),w(248,"div",15)(249,"div",16)(250,"h5",17),j(251,"i",101),_(252,"Psychological Analysis "),x(),w(253,"span",19),_(254,"Required"),x()(),w(255,"div",20)(256,"div",21)(257,"div",22)(258,"label",102),_(259,"Current Emotional State"),x(),w(260,"select",103)(261,"option",31),_(262,"How are you feeling?"),x(),w(263,"option",104),_(264,"Calm & Focused"),x(),w(265,"option",105),_(266,"Excited"),x(),w(267,"option",106),_(268,"Anxious"),x(),w(269,"option",107),_(270,"Frustrated"),x(),w(271,"option",108),_(272,"Overconfident"),x(),w(273,"option",109),_(274,"Fearful"),x(),w(275,"option",110),_(276,"Neutral"),x(),w(277,"option",38),_(278,"Other"),x()(),ae(279,Tne,2,0,"div",28)(280,Dne,3,0,"div",95),x(),w(281,"div",22)(282,"label",111),_(283,"Trading Confidence"),x(),w(284,"div",112),j(285,"input",113),w(286,"label",114),_(287,"1"),x(),j(288,"input",115),w(289,"label",116),_(290,"2"),x(),j(291,"input",117),w(292,"label",118),_(293,"3"),x(),j(294,"input",119),w(295,"label",120),_(296,"4"),x(),j(297,"input",121),w(298,"label",122),_(299,"5"),x()(),w(300,"div",123),_(301,"Low (1) to High (5)"),x(),ae(302,Nne,2,0,"div",124),x(),w(303,"div",71)(304,"label",125),_(305,"Potential Biases"),x(),j(306,"textarea",126),w(307,"div",74),_(308,"Identifying biases helps improve future decision making"),x(),ae(309,kne,2,0,"div",28),x()()()(),w(310,"div",15)(311,"div",16)(312,"h5",17),j(313,"i",127),_(314,"Additional Notes "),x(),w(315,"span",128),_(316,"Optional"),x()(),w(317,"div",20)(318,"div",21)(319,"div",71)(320,"label",129),_(321,"Notes"),x(),j(322,"textarea",130),x()()()(),ae(323,Fne,9,4,"div",131),w(324,"div",132),ae(325,Pne,3,0,"button",133),w(326,"div")(327,"button",134),j(328,"i",135),_(329),x()()(),ae(330,$ne,3,1,"div",136)(331,Lne,3,1,"div",137),x()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,y,v,S,C,I,E,D,O,R;$(14),At(r.tradeLogData?"Edit Pre-Trading Journal":"Create Pre-Trading Journal"),$(4),W("ngIf",!r.tradeLogData),$(),W("ngIf",!r.tradeLogData),$(),W("formGroup",r.preTradeForm),$(17),W("ngIf",((o=r.preTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.preTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.preTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),$(21),W("ngIf",((i=r.preTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.preTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.preTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),$(8),W("ngIf",((s=r.preTradeForm.get("tradesymbol"))==null?null:s.invalid)&&(((s=r.preTradeForm.get("tradesymbol"))==null?null:s.dirty)||((s=r.preTradeForm.get("tradesymbol"))==null?null:s.touched)||r.formSubmitMarker)),$(11),W("ngIf",((a=r.preTradeForm.get("tradetype"))==null?null:a.invalid)&&(((a=r.preTradeForm.get("tradetype"))==null?null:a.dirty)||((a=r.preTradeForm.get("tradetype"))==null?null:a.touched)||r.formSubmitMarker)),$(17),W("ngIf",((l=r.preTradeForm.get("timeframe"))==null?null:l.invalid)&&(((l=r.preTradeForm.get("timeframe"))==null?null:l.dirty)||((l=r.preTradeForm.get("timeframe"))==null?null:l.touched)||r.formSubmitMarker)),$(17),W("ngIf",((c=r.preTradeForm.get("analysistype"))==null?null:c.invalid)&&(((c=r.preTradeForm.get("analysistype"))==null?null:c.dirty)||((c=r.preTradeForm.get("analysistype"))==null?null:c.touched)||r.formSubmitMarker)),$(14),W("ngIf",((u=r.preTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.preTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.preTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),$(17),W("ngIf",((d=r.preTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.preTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.preTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),$(9),W("ngIf",((p=r.preTradeForm.get("entrycriteria"))==null?null:p.invalid)&&(((p=r.preTradeForm.get("entrycriteria"))==null?null:p.dirty)||((p=r.preTradeForm.get("entrycriteria"))==null?null:p.touched)||r.formSubmitMarker)),$(9),W("ngIf",((f=r.preTradeForm.get("exitstrategy"))==null?null:f.invalid)&&(((f=r.preTradeForm.get("exitstrategy"))==null?null:f.dirty)||((f=r.preTradeForm.get("exitstrategy"))==null?null:f.touched)||r.formSubmitMarker)),$(17),W("ngIf",((m=r.preTradeForm.get("accountbalance"))==null?null:m.invalid)&&(((m=r.preTradeForm.get("accountbalance"))==null?null:m.dirty)||((m=r.preTradeForm.get("accountbalance"))==null?null:m.touched)||r.formSubmitMarker)),$(8),W("ngIf",((h=r.preTradeForm.get("positionsize"))==null?null:h.invalid)&&(((h=r.preTradeForm.get("positionsize"))==null?null:h.dirty)||((h=r.preTradeForm.get("positionsize"))==null?null:h.touched)||r.formSubmitMarker)),$(8),W("ngIf",((g=r.preTradeForm.get("entryprice"))==null?null:g.invalid)&&(((g=r.preTradeForm.get("entryprice"))==null?null:g.dirty)||((g=r.preTradeForm.get("entryprice"))==null?null:g.touched)||r.formSubmitMarker)),$(5),W("ngIf",((y=r.preTradeForm.get("entrydatetime"))==null?null:y.invalid)&&(((y=r.preTradeForm.get("entrydatetime"))==null?null:y.dirty)||((y=r.preTradeForm.get("entrydatetime"))==null?null:y.touched)||r.formSubmitMarker)),$(8),W("ngIf",((v=r.preTradeForm.get("estimatedstoploss"))==null?null:v.invalid)&&(((v=r.preTradeForm.get("estimatedstoploss"))==null?null:v.dirty)||((v=r.preTradeForm.get("estimatedstoploss"))==null?null:v.touched)||r.formSubmitMarker)),$(8),W("ngIf",((S=r.preTradeForm.get("estimatedtakeprofit"))==null?null:S.invalid)&&(((S=r.preTradeForm.get("estimatedtakeprofit"))==null?null:S.dirty)||((S=r.preTradeForm.get("estimatedtakeprofit"))==null?null:S.touched)||r.formSubmitMarker)),$(14),W("ngIf",((C=r.preTradeForm.get("estimatedrisk"))==null?null:C.invalid)&&(((C=r.preTradeForm.get("estimatedrisk"))==null?null:C.dirty)||((C=r.preTradeForm.get("estimatedrisk"))==null?null:C.touched)||r.formSubmitMarker)),$(),W("ngIf",((I=r.preTradeForm.get("estimatedrisk"))==null?null:I.value)>2),$(8),W("ngIf",((E=r.preTradeForm.get("estimatedpnl"))==null?null:E.invalid)&&(((E=r.preTradeForm.get("estimatedpnl"))==null?null:E.dirty)||((E=r.preTradeForm.get("estimatedpnl"))==null?null:E.touched)||r.formSubmitMarker)),$(5),W("value",r.calculateRiskRewardRatio()),$(3),W("ngClass",Ui(37,ine,r.isGoodRiskReward(),!r.isGoodRiskReward())),$(),VO(r.isGoodRiskReward()?"bi bi-check-circle":"bi bi-x-circle"),$(),Ge(" ",r.isGoodRiskReward()?"Good risk/reward ratio":"Risk/reward should be at least 1:2"," "),$(32),W("ngIf",((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.invalid)&&(((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.dirty)||((D=r.preTradeForm.get("emotionalstatebefore"))==null?null:D.touched)||r.formSubmitMarker)),$(),W("ngIf",r.isNegativeEmotionalState()),$(22),W("ngIf",((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.invalid)&&(((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.dirty)||((O=r.preTradeForm.get("tradeconfidence"))==null?null:O.touched)||r.formSubmitMarker)),$(7),W("ngIf",((R=r.preTradeForm.get("potentialbiases"))==null?null:R.invalid)&&(((R=r.preTradeForm.get("potentialbiases"))==null?null:R.dirty)||((R=r.preTradeForm.get("potentialbiases"))==null?null:R.touched)||r.formSubmitMarker)),$(14),W("ngIf",r.formSubmitMarker&&r.preTradeForm.invalid),$(2),W("ngIf",r.tradeLogData),$(4),Ge("",r.tradeLogData?"Update":"Submit"," "),$(),W("ngIf",r.message),$(),W("ngIf",r.errorMessage)}},dependencies:[on,Po,xn,Qi,Ki,Pl,$l,pr,zu,Yi,Ws,Yr,qi,Dg,X1,Xi,Hs,Kr],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};function Vne(t,n){t&1&&(w(0,"div",12),_(1,"Loading trade logs..."),x())}function Bne(t,n){if(t&1&&(w(0,"div",13),_(1),x()),t&2){let e=re();$(),At(e.errorMessage)}}function zne(t,n){if(t&1){let e=mt();w(0,"div",16)(1,"div",17),fe("click",function(){let o=Ce(e).$implicit,i=re(2);return Se(i.openEditModal(o))}),w(2,"div",18),j(3,"i",19),_(4," Planned "),x(),w(5,"div",20),fe("click",function(o){let i=Ce(e).$implicit,s=re(2);return Se(s.onDeleteTradeLog(i,o))}),j(6,"i",21),x(),w(7,"div",22)(8,"h4",23),_(9),x(),w(10,"h5",24),_(11),x(),w(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),_(16,"Analysis:"),x(),_(17),x(),w(18,"div",27)(19,"strong"),_(20,"Order:"),x(),_(21),x()(),w(22,"div",26)(23,"div",27)(24,"strong"),_(25,"Stop Loss:"),x(),_(26),x(),w(27,"div",27)(28,"strong"),_(29,"Take Profit:"),x(),_(30),x()(),w(31,"div",26)(32,"div",27)(33,"strong"),_(34,"Risk:"),x(),_(35),x(),w(36,"div",27)(37,"strong"),_(38,"Est. PnL:"),x(),_(39),x()(),w(40,"div",28)(41,"div",29)(42,"strong"),_(43,"Account:"),x(),_(44),x()()(),w(45,"div",30)(46,"small",31),_(47),Fs(48,"date"),x()()()()()}if(t&2){let e=n.$implicit;$(9),At(e.tradesymbol),$(2),bh(" ",e.tradetype," | ",e.instrumenttype," "),$(6),Ge(" ",e.analysistype," "),$(4),Ge(" ",e.typeoforder," "),$(5),Ge(" ",e.estimatedstoploss," "),$(4),Ge(" ",e.estimatedtakeprofit," "),$(5),Ge(" ",e.estimatedrisk," "),$(4),Ge(" ",e.estimatedpnl," "),$(5),Ge(" ",e.accountname," "),$(3),At(Ps(48,11,e.createdtime,"medium"))}}function Une(t,n){if(t&1&&(w(0,"div",14),ae(1,zne,49,14,"div",15),x()),t&2){let e=re();$(),W("ngForOf",e.tradeLogs)}}function jne(t,n){t&1&&(w(0,"div",32),_(1," No trade logs found. "),x())}function Gne(t,n){if(t&1){let e=mt();w(0,"div",33),fe("click",function(o){Ce(e);let i=re();return Se(i.closeModalOnOverlayClick(o))}),w(1,"div",34),fe("click",function(o){return Ce(e),Se(o.stopPropagation())}),w(2,"app-pre-trade-log",35),fe("formSubmitted",function(){Ce(e);let o=re();return Se(o.onFormSubmitted())})("cancel",function(){Ce(e);let o=re();return Se(o.closeModal())}),x()()()}if(t&2){let e=re();$(2),W("tradeLogData",e.selectedTradeLog)}}var Hv=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="pretrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName)}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(oe(jt),oe(Ut))};static \u0275cmp=Pt({type:t,selectors:[["app-pre-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/pretradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click"],[1,"trade-status-indicator","status-planned"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(w(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),_(5,"Dashboard"),x()(),w(6,"li",5),_(7,"Pre-Trade Logs"),x(),w(8,"li",3)(9,"a",6),_(10,"Pre-Trading Journal"),x()()()(),w(11,"h2"),_(12,"Pre Trade Logs"),x(),ae(13,Vne,2,0,"div",7)(14,Bne,2,1,"div",8)(15,Une,2,1,"div",9)(16,jne,2,0,"div",10),x(),ae(17,Gne,3,1,"div",11)),e&2&&($(13),W("ngIf",r.loading),$(),W("ngIf",r.errorMessage),$(),W("ngIf",r.tradeLogs&&r.tradeLogs.length),$(),W("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),$(),W("ngIf",r.showModal))},dependencies:[Kr,on,Wr,xn,_l,af],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease;border-left:4px solid #6c757d!important}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-planned[_ngcontent-%COMP%]{background-color:#6c757d}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"],changeDetection:0})};function Wne(t,n){if(t&1&&(w(0,"div",131),j(1,"div",132),x()),t&2){let e=re();$(),Np("width",e.calculateFormProgress()+"%")}}function Hne(t,n){if(t&1&&(w(0,"span",133),_(1),x()),t&2){let e=re();$(),Ge("",e.calculateFormProgress(),"% Complete")}}function qne(t,n){t&1&&(w(0,"div",134),_(1," Account name is required "),x())}function Kne(t,n){t&1&&(w(0,"div",134),_(1," Please select an instrument type "),x())}function Xne(t,n){t&1&&(w(0,"div",134),_(1," Please select an analysis type "),x())}function Yne(t,n){t&1&&(w(0,"div",134),_(1," Trade symbol is required "),x())}function Qne(t,n){t&1&&(w(0,"div",134),_(1," Please select trade direction "),x())}function Zne(t,n){t&1&&(w(0,"div",134),_(1," Time frame selection is required "),x())}function Jne(t,n){t&1&&(w(0,"div",134),_(1," Strategy name is required "),x())}function ere(t,n){t&1&&(w(0,"div",134),_(1," Order type is required "),x())}function tre(t,n){t&1&&(w(0,"div",134),_(1," Entry date/time is required "),x())}function nre(t,n){t&1&&(w(0,"div",134),_(1," Exit date/time is required "),x())}function rre(t,n){t&1&&(w(0,"div",134),_(1," Valid entry price is required "),x())}function ore(t,n){t&1&&(w(0,"div",134),_(1," Valid exit price is required "),x())}function ire(t,n){t&1&&(w(0,"div",134),_(1," Position size is required "),x())}function sre(t,n){t&1&&(w(0,"div",134),_(1," Please select trade outcome "),x())}function are(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Trade Details"),x())}function lre(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Strategy Information"),x())}function cre(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Trade Execution"),x())}function ure(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Trade Outcome"),x())}function dre(t,n){t&1&&(w(0,"li"),_(1,"Complete all required fields in Post-Trade Analysis"),x())}function pre(t,n){if(t&1&&(w(0,"div",135),j(1,"i",136),w(2,"strong"),_(3,"Please fix the errors highlighted above before submitting."),x(),w(4,"ul",137),ae(5,are,2,0,"li",138)(6,lre,2,0,"li",138)(7,cre,2,0,"li",138)(8,ure,2,0,"li",138)(9,dre,2,0,"li",138),x()()),t&2){let e=re();$(5),W("ngIf",e.hasErrors("tradeDetails")),$(),W("ngIf",e.hasErrors("strategyInformation")),$(),W("ngIf",e.hasErrors("tradeExecution")),$(),W("ngIf",e.hasErrors("tradeOutcome")),$(),W("ngIf",e.hasErrors("postTradeAnalysis"))}}function fre(t,n){if(t&1){let e=mt();w(0,"button",99),fe("click",function(){Ce(e);let o=re();return Se(o.onCancel())}),j(1,"i",139),_(2,"Cancel "),x()}}function mre(t,n){if(t&1&&(w(0,"div",140),j(1,"i",141),_(2),x()),t&2){let e=re();$(2),Ge("",e.message," ")}}function hre(t,n){if(t&1&&(w(0,"div",142),j(1,"i",136),_(2),x()),t&2){let e=re();$(2),Ge("",e.errorMessage," ")}}var lf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabaseService=r}tradeLogData=null;formSubmitted=new zt;cancel=new zt;tableName="posttrade";postTradeForm;message="";errorMessage="";formSubmitMarker=!1;tradeOutcomes=["Win","Loss","Breakeven"];tradeDirections=["Long","Short"];ngOnInit(){this.formSubmitMarker=!1,this.createForm()}createForm(){var n=ju();this.postTradeForm=this.fb.group({tradeid:[this.tradeLogData?.tradeid??n],userid:[this.tradeLogData?.userid??"the-db-is-likely-hacked-1234-abcd-5678-efgh"],createdtime:[new Date().toISOString(),_e.required],accountname:[this.tradeLogData?.accountname,[_e.required,_e.maxLength(255)]],accountbalance:[this.tradeLogData?.accountbalance??""],instrumenttype:[this.tradeLogData?.instrumenttype??"",[_e.required,_e.maxLength(50)]],analysistype:[this.tradeLogData?.analysistype??"",[_e.required,_e.maxLength(100)]],tradesymbol:[this.tradeLogData?.tradesymbol??"",[_e.required,_e.maxLength(50)]],tradetype:[this.tradeLogData?.tradetype??"",[_e.required,_e.maxLength(50)]],timeframe:[this.tradeLogData?.timeframe??"",[_e.required,_e.maxLength(50)]],entrydatetime:[this.tradeLogData?.entrydatetime??"",_e.required],strategyname:[this.tradeLogData?.strategyname??"",[_e.required,_e.maxLength(255)]],typeoforder:[this.tradeLogData?.typeoforder??"",[_e.required,_e.maxLength(50)]],exitstrategy:[this.tradeLogData?.exitstrategy??""],entryprice:[this.tradeLogData?.entryprice??"",[_e.required,_e.min(0)]],exitprice:[this.tradeLogData?.exitprice??"",[_e.required,_e.min(0)]],positionsize:[this.tradeLogData?.positionsize??"",[_e.required,_e.maxLength(50)]],exitdatetime:[this.tradeLogData?.exitdatetime??"",_e.required],tradeoutcome:[this.tradeLogData?.tradeoutcome??"",_e.required],profitlossamount:[this.tradeLogData?.profitlossamount??""],setupscreenshot:[this.tradeLogData?.setupscreenshot??""],emotionalstateafter:[this.tradeLogData?.emotionalstateafter??""],emotionalimpactondecision:[this.tradeLogData?.emotionalimpactondecision??""],whatwentwell:[this.tradeLogData?.whatwentwell??""],whatcouldimprove:[this.tradeLogData?.whatcouldimprove??""],notes:[this.tradeLogData?.notes??""],isopen:[this.tradeLogData?.isopen??!0,_e.required],updatedtime:[new Date().toDateString(),_e.required]})}onFileSelected(n){let e=n.target;if(!e.files||e.files.length===0)return;let r=e.files[0],o=new FileReader;o.onload=i=>{this.postTradeForm.patchValue({setupScreenshot:i.target.result})},o.readAsDataURL(r)}async onSubmit(){if(this.formSubmitMarker=!0,this.postTradeForm.invalid){this.postTradeForm.markAllAsTouched();return}let n=this.postTradeForm.value;try{this.tradeLogData?await this.supabaseService.updateTradeLog(n,this.tableName):await this.supabaseService.addTradeLog(n,this.tableName),this.message="Trade log updated successfully. Resetting in 5 seconds.",setTimeout(()=>{this.cdr.markForCheck()},0),this.formSubmitted.emit(),this.formSubmitMarker=!1,this.cdr.markForCheck(),setTimeout(()=>{this.postTradeForm.reset(),this.postTradeForm.markAsPristine(),this.message="Form has been reset",this.cdr.markForCheck()},5e3),setTimeout(()=>{this.message="",this.cdr.markForCheck()},3e3)}catch(e){console.error("Error processing trade log:",e),this.errorMessage="Something went wrong.",this.cdr.markForCheck()}}async onDelete(){if(this.tradeLogData)try{await this.supabaseService.deleteTradeLog(this.tradeLogData.tradeid,this.tableName),this.message="Trade log deleted successfully.",this.formSubmitted.emit()}catch(n){console.error("Error deleting trade log:",n),this.errorMessage="Something went wrong while deleting."}finally{this.cdr.markForCheck()}}onCancel(){this.cancel.emit()}calculateProfitLoss(){let n=this.postTradeForm.get("entryprice")?.value,e=this.postTradeForm.get("exitprice")?.value,r=parseFloat(this.postTradeForm.get("positionsize")?.value),o=this.postTradeForm.get("tradetype")?.value;if(n&&e&&r&&o){let i=0;o==="Long"?i=(e-n)*r:o==="Short"&&(i=(n-e)*r),this.postTradeForm.get("profitlossamount")?.setValue(i.toFixed(2)),i>0?this.postTradeForm.get("tradeoutcome")?.setValue("Win"):i<0?this.postTradeForm.get("tradeoutcome")?.setValue("Loss"):this.postTradeForm.get("tradeoutcome")?.setValue("Breakeven")}}calculateFormProgress(){let n=Object.keys(this.postTradeForm.controls).filter(r=>this.postTradeForm.get(r)?.validator!==null),e=n.filter(r=>this.postTradeForm.get(r)?.valid);return Math.round(e.length/n.length*100)}hasErrors(n){let e=!1,r={tradeDetails:["accountname","instrumenttype","analysistype","tradesymbol","tradetype","timeframe"],strategyInformation:["strategyname","typeoforder"],tradeExecution:["entrydatetime","exitdatetime","entryprice","exitprice","positionsize"],tradeOutcome:["tradeoutcome"],postTradeAnalysis:["emotionalstateafter","whatwentwell","whatcouldimprove"]};return r[n]&&r[n].forEach(o=>{this.postTradeForm.get(o)?.invalid&&(e=!0)}),e}static \u0275fac=function(e){return new(e||t)(oe(Ll),oe(Ut),oe(jt))};static \u0275cmp=Pt({type:t,selectors:[["app-post-trade-log"]],inputs:{tradeLogData:"tradeLogData"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},decls:299,vars:23,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["routerLink","/posttrades"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"col-lg-4","text-lg-end","d-flex","align-items-center","justify-content-lg-end","mt-3","mt-lg-0"],["class","progress w-100","style","height: 8px;",4,"ngIf"],["class","ms-2 small text-muted",4,"ngIf"],[3,"ngSubmit","formGroup"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-6"],["for","accountname",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-person"],["type","text","id","accountname","formControlName","accountname","placeholder","Enter your account name",1,"form-control"],["class","text-danger mt-1 small",4,"ngIf"],["for","accountbalance",1,"form-label"],["type","number","step","0.01","min","0","id","accountbalance","formControlName","accountbalance","placeholder","Current account value",1,"form-control"],["for","instrumenttype",1,"form-label"],["id","instrumenttype","formControlName","instrumenttype",1,"form-select"],["value","","selected","","disabled",""],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["value","Other"],["for","analysistype",1,"form-label"],["id","analysistype","formControlName","analysistype",1,"form-select"],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["for","tradesymbol",1,"form-label"],[1,"bi","bi-tag"],["type","text","id","tradesymbol","formControlName","tradesymbol","placeholder","Enter ticker symbol",1,"form-control"],["for","tradetype",1,"form-label"],["role","group","aria-label","Trade type",1,"btn-group","w-100"],["type","radio","name","tradetype","id","tradetype_long","value","Long","formControlName","tradetype",1,"btn-check"],["for","tradetype_long",1,"btn","btn-outline-success"],["type","radio","name","tradetype","id","tradetype_short","value","Short","formControlName","tradetype",1,"btn-check"],["for","tradetype_short",1,"btn","btn-outline-danger"],["for","timeframe",1,"form-label"],["id","timeframe","formControlName","timeframe",1,"form-select"],["value","Scalp"],["value","Day"],["value","Swing"],["value","Position"],["value","LongTerm"],[1,"bi","bi-2-circle","me-2"],["for","strategyname",1,"form-label"],["type","text","id","strategyname","formControlName","strategyname","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","typeoforder",1,"form-label"],["id","typeoforder","formControlName","typeoforder",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","exitstrategy",1,"form-label"],["id","exitstrategy","formControlName","exitstrategy","placeholder","Describe the exit strategy you implemented","rows","3",1,"form-control"],[1,"bi","bi-3-circle","me-2"],["for","entrydatetime",1,"form-label"],["type","datetime-local","id","entrydatetime","formControlName","entrydatetime",1,"form-control"],["for","exitdatetime",1,"form-label"],["type","datetime-local","id","exitdatetime","formControlName","exitdatetime",1,"form-control"],[1,"col-md-4"],["for","entryprice",1,"form-label"],["type","number","id","entryprice","formControlName","entryprice","step","0.01","min","0","placeholder","Actual entry price",1,"form-control"],["for","exitprice",1,"form-label"],["type","number","id","exitprice","formControlName","exitprice","step","0.01","min","0","placeholder","Actual exit price",1,"form-control"],["for","positionsize",1,"form-label"],["type","text","id","positionsize","formControlName","positionsize","placeholder","Units/Contracts/Shares",1,"form-control"],[1,"bi","bi-4-circle","me-2"],["for","tradeoutcome",1,"form-label"],["role","group","aria-label","Trade outcome",1,"btn-group","w-100"],["type","radio","name","tradeoutcome","id","tradeoutcome_win","value","Win","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_win",1,"btn","btn-outline-success"],["type","radio","name","tradeoutcome","id","tradeoutcome_loss","value","Loss","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_loss",1,"btn","btn-outline-danger"],["type","radio","name","tradeoutcome","id","tradeoutcome_breakeven","value","Breakeven","formControlName","tradeoutcome",1,"btn-check"],["for","tradeoutcome_breakeven",1,"btn","btn-outline-warning"],["for","profitlossamount",1,"form-label"],["type","number","step","0.01","id","profitlossamount","formControlName","profitlossamount","placeholder","e.g. 50.25 or -30.50",1,"form-control"],["type","button",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-6-circle","me-2"],["for","emotionalstateafter",1,"form-label"],["id","emotionalstateafter","formControlName","emotionalstateafter",1,"form-select"],["value","Satisfied"],["value","Excited"],["value","Relieved"],["value","Disappointed"],["value","Frustrated"],["value","Neutral"],["value","Angry"],["for","emotionalimpactondecision",1,"form-label"],["id","emotionalimpactondecision","formControlName","emotionalimpactondecision","placeholder","How did your emotions affect your trading decisions?","rows","3",1,"form-control"],["for","whatwentwell",1,"form-label"],["id","whatwentwell","formControlName","whatwentwell","placeholder","What aspects of this trade did you execute correctly?","rows","3",1,"form-control"],["for","whatcouldimprove",1,"form-label"],["id","whatcouldimprove","formControlName","whatcouldimprove","placeholder","What could you have done better in this trade?","rows","3",1,"form-control"],["for","isopen",1,"form-label"],[1,"form-check","form-switch"],["type","checkbox","id","isopen","formControlName","isopen",1,"form-check-input"],["for","isopen",1,"form-check-label"],[1,"bi","bi-7-circle","me-2"],[1,"badge","bg-secondary"],["for","notes",1,"form-label"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],["class","alert alert-danger mb-3",4,"ngIf"],[1,"d-flex","justify-content-between","align-items-center","mt-4"],["type","button","class","btn btn-outline-secondary",3,"click",4,"ngIf"],["type","submit",1,"btn","btn-success"],[1,"bi","bi-check-circle","me-1"],["class","alert alert-success mt-3",4,"ngIf"],["class","alert alert-danger mt-3",4,"ngIf"],[1,"progress","w-100",2,"height","8px"],["role","progressbar","aria-valuemin","0","aria-valuemax","100",1,"progress-bar","bg-success"],[1,"ms-2","small","text-muted"],[1,"text-danger","mt-1","small"],[1,"alert","alert-danger","mb-3"],[1,"bi","bi-exclamation-triangle-fill","me-2"],[1,"mb-0","mt-2"],[4,"ngIf"],[1,"bi","bi-x-circle","me-1"],[1,"alert","alert-success","mt-3"],[1,"bi","bi-check-circle-fill","me-2"],[1,"alert","alert-danger","mt-3"]],template:function(e,r){if(e&1&&(w(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),_(5,"Dashboard"),x()(),w(6,"li",3)(7,"a",5),_(8,"Trade Logs"),x()(),w(9,"li",6),_(10,"Post-Trading Journal"),x()()(),w(11,"div",7)(12,"div",8)(13,"h2",9),_(14),x(),w(15,"p",10),_(16,"Document your completed trades to analyze performance and improve your strategy"),x()(),w(17,"div",11),ae(18,Wne,2,2,"div",12)(19,Hne,2,1,"span",13),x()(),w(20,"form",14),fe("ngSubmit",function(){return r.onSubmit()}),w(21,"div",15)(22,"div",16)(23,"h5",17),j(24,"i",18),_(25,"Trade Details "),x(),w(26,"span",19),_(27,"Required"),x()(),w(28,"div",20)(29,"div",21)(30,"div",22)(31,"label",23),_(32,"Account Name"),x(),w(33,"div",24)(34,"span",25),j(35,"i",26),x(),j(36,"input",27),x(),ae(37,qne,2,0,"div",28),x(),w(38,"div",22)(39,"label",29),_(40,"Account Balance"),x(),w(41,"div",24)(42,"span",25),_(43,"$"),x(),j(44,"input",30),x()(),w(45,"div",22)(46,"label",31),_(47,"Instrument Type"),x(),w(48,"select",32)(49,"option",33),_(50,"Choose instrument type"),x(),w(51,"option",34),_(52,"Forex"),x(),w(53,"option",35),_(54,"Stocks"),x(),w(55,"option",36),_(56,"Futures"),x(),w(57,"option",37),_(58,"Crypto"),x(),w(59,"option",38),_(60,"Options"),x(),w(61,"option",39),_(62,"ETF"),x(),w(63,"option",40),_(64,"Other"),x()(),ae(65,Kne,2,0,"div",28),x(),w(66,"div",22)(67,"label",41),_(68,"Analysis Type"),x(),w(69,"select",42)(70,"option",33),_(71,"Choose analysis method"),x(),w(72,"option",43),_(73,"Technical"),x(),w(74,"option",44),_(75,"Fundamental"),x(),w(76,"option",45),_(77,"Both"),x(),w(78,"option",46),_(79,"Sentiment"),x(),w(80,"option",40),_(81,"Other"),x()(),ae(82,Xne,2,0,"div",28),x(),w(83,"div",22)(84,"label",47),_(85,"Trade Symbol"),x(),w(86,"div",24)(87,"span",25),j(88,"i",48),x(),j(89,"input",49),x(),ae(90,Yne,2,0,"div",28),x(),w(91,"div",22)(92,"label",50),_(93,"Trade Direction"),x(),w(94,"div",51),j(95,"input",52),w(96,"label",53),_(97,"Long"),x(),j(98,"input",54),w(99,"label",55),_(100,"Short"),x()(),ae(101,Qne,2,0,"div",28),x(),w(102,"div",22)(103,"label",56),_(104,"Time Frame"),x(),w(105,"select",57)(106,"option",33),_(107,"Select time frame"),x(),w(108,"option",58),_(109,"Scalp (minutes)"),x(),w(110,"option",59),_(111,"Day Trade (hours)"),x(),w(112,"option",60),_(113,"Swing (days-weeks)"),x(),w(114,"option",61),_(115,"Position (weeks-months)"),x(),w(116,"option",62),_(117,"Long Term (months+)"),x()(),ae(118,Zne,2,0,"div",28),x()()()(),w(119,"div",15)(120,"div",16)(121,"h5",17),j(122,"i",63),_(123,"Strategy Information "),x(),w(124,"span",19),_(125,"Required"),x()(),w(126,"div",20)(127,"div",21)(128,"div",22)(129,"label",64),_(130,"Strategy Name"),x(),j(131,"input",65),ae(132,Jne,2,0,"div",28),x(),w(133,"div",22)(134,"label",66),_(135,"Type of Order"),x(),w(136,"select",67)(137,"option",33),_(138,"Choose order type"),x(),w(139,"option",68),_(140,"Market"),x(),w(141,"option",69),_(142,"Limit"),x(),w(143,"option",70),_(144,"Stop"),x(),w(145,"option",71),_(146,"Stop Limit"),x(),w(147,"option",72),_(148,"Trailing Stop"),x()(),ae(149,ere,2,0,"div",28),x(),w(150,"div",73)(151,"label",74),_(152,"Exit Strategy Used"),x(),j(153,"textarea",75),x()()()(),w(154,"div",15)(155,"div",16)(156,"h5",17),j(157,"i",76),_(158,"Trade Execution "),x(),w(159,"span",19),_(160,"Required"),x()(),w(161,"div",20)(162,"div",21)(163,"div",22)(164,"label",77),_(165,"Entry Date/Time"),x(),j(166,"input",78),ae(167,tre,2,0,"div",28),x(),w(168,"div",22)(169,"label",79),_(170,"Exit Date/Time"),x(),j(171,"input",80),ae(172,nre,2,0,"div",28),x(),w(173,"div",81)(174,"label",82),_(175,"Entry Price"),x(),w(176,"div",24)(177,"span",25),_(178,"$"),x(),j(179,"input",83),x(),ae(180,rre,2,0,"div",28),x(),w(181,"div",81)(182,"label",84),_(183,"Exit Price"),x(),w(184,"div",24)(185,"span",25),_(186,"$"),x(),j(187,"input",85),x(),ae(188,ore,2,0,"div",28),x(),w(189,"div",81)(190,"label",86),_(191,"Position Size"),x(),w(192,"div",24),j(193,"input",87),x(),ae(194,ire,2,0,"div",28),x()()()(),w(195,"div",15)(196,"div",16)(197,"h5",17),j(198,"i",88),_(199,"Trade Outcome "),x(),w(200,"span",19),_(201,"Required"),x()(),w(202,"div",20)(203,"div",21)(204,"div",22)(205,"label",89),_(206,"Trade Result"),x(),w(207,"div",90),j(208,"input",91),w(209,"label",92),_(210,"Win"),x(),j(211,"input",93),w(212,"label",94),_(213,"Loss"),x(),j(214,"input",95),w(215,"label",96),_(216,"Breakeven"),x()(),ae(217,sre,2,0,"div",28),x(),w(218,"div",22)(219,"label",97),_(220,"Profit/Loss Amount"),x(),w(221,"div",24)(222,"span",25),_(223,"$"),x(),j(224,"input",98),w(225,"button",99),fe("click",function(){return r.calculateProfitLoss()}),_(226," Calculate "),x()()()()()(),w(227,"div",15)(228,"div",16)(229,"h5",17),j(230,"i",100),_(231,"Post-Trade Analysis "),x(),w(232,"span",19),_(233,"Required"),x()(),w(234,"div",20)(235,"div",21)(236,"div",22)(237,"label",101),_(238,"Emotional State After Trade"),x(),w(239,"select",102)(240,"option",33),_(241,"How do you feel now?"),x(),w(242,"option",103),_(243,"Satisfied"),x(),w(244,"option",104),_(245,"Excited"),x(),w(246,"option",105),_(247,"Relieved"),x(),w(248,"option",106),_(249,"Disappointed"),x(),w(250,"option",107),_(251,"Frustrated"),x(),w(252,"option",108),_(253,"Neutral"),x(),w(254,"option",109),_(255,"Angry"),x(),w(256,"option",40),_(257,"Other"),x()()(),w(258,"div",73)(259,"label",110),_(260,"Emotional Impact on Decisions"),x(),j(261,"textarea",111),x(),w(262,"div",73)(263,"label",112),_(264,"What Went Well"),x(),j(265,"textarea",113),x(),w(266,"div",73)(267,"label",114),_(268,"Areas for Improvement"),x(),j(269,"textarea",115),x(),w(270,"div",22)(271,"label",116),_(272,"Trade Status"),x(),w(273,"div",117),j(274,"input",118),w(275,"label",119),_(276,"This position is still open"),x()()()()()(),w(277,"div",15)(278,"div",16)(279,"h5",17),j(280,"i",120),_(281,"Additional Notes "),x(),w(282,"span",121),_(283,"Optional"),x()(),w(284,"div",20)(285,"div",21)(286,"div",73)(287,"label",122),_(288,"Notes"),x(),j(289,"textarea",123),x()()()(),ae(290,pre,10,5,"div",124),w(291,"div",125),ae(292,fre,3,0,"button",126),w(293,"div")(294,"button",127),j(295,"i",128),_(296),x()()(),ae(297,mre,3,1,"div",129)(298,hre,3,1,"div",130),x()()),e&2){let o,i,s,a,l,c,u,d,p,f,m,h,g,y;$(14),At(r.tradeLogData?"Edit Post-Trading Journal":"Create Post-Trading Journal"),$(4),W("ngIf",!r.tradeLogData),$(),W("ngIf",!r.tradeLogData),$(),W("formGroup",r.postTradeForm),$(17),W("ngIf",((o=r.postTradeForm.get("accountname"))==null?null:o.invalid)&&(((o=r.postTradeForm.get("accountname"))==null?null:o.dirty)||((o=r.postTradeForm.get("accountname"))==null?null:o.touched)||r.formSubmitMarker)),$(28),W("ngIf",((i=r.postTradeForm.get("instrumenttype"))==null?null:i.invalid)&&(((i=r.postTradeForm.get("instrumenttype"))==null?null:i.dirty)||((i=r.postTradeForm.get("instrumenttype"))==null?null:i.touched)||r.formSubmitMarker)),$(17),W("ngIf",((s=r.postTradeForm.get("analysistype"))==null?null:s.invalid)&&(((s=r.postTradeForm.get("analysistype"))==null?null:s.dirty)||((s=r.postTradeForm.get("analysistype"))==null?null:s.touched)||r.formSubmitMarker)),$(8),W("ngIf",((a=r.postTradeForm.get("tradesymbol"))==null?null:a.invalid)&&(((a=r.postTradeForm.get("tradesymbol"))==null?null:a.dirty)||((a=r.postTradeForm.get("tradesymbol"))==null?null:a.touched)||r.formSubmitMarker)),$(11),W("ngIf",((l=r.postTradeForm.get("tradetype"))==null?null:l.invalid)&&(((l=r.postTradeForm.get("tradetype"))==null?null:l.dirty)||((l=r.postTradeForm.get("tradetype"))==null?null:l.touched)||r.formSubmitMarker)),$(17),W("ngIf",((c=r.postTradeForm.get("timeframe"))==null?null:c.invalid)&&(((c=r.postTradeForm.get("timeframe"))==null?null:c.dirty)||((c=r.postTradeForm.get("timeframe"))==null?null:c.touched)||r.formSubmitMarker)),$(14),W("ngIf",((u=r.postTradeForm.get("strategyname"))==null?null:u.invalid)&&(((u=r.postTradeForm.get("strategyname"))==null?null:u.dirty)||((u=r.postTradeForm.get("strategyname"))==null?null:u.touched)||r.formSubmitMarker)),$(17),W("ngIf",((d=r.postTradeForm.get("typeoforder"))==null?null:d.invalid)&&(((d=r.postTradeForm.get("typeoforder"))==null?null:d.dirty)||((d=r.postTradeForm.get("typeoforder"))==null?null:d.touched)||r.formSubmitMarker)),$(18),W("ngIf",((p=r.postTradeForm.get("entrydatetime"))==null?null:p.invalid)&&(((p=r.postTradeForm.get("entrydatetime"))==null?null:p.dirty)||((p=r.postTradeForm.get("entrydatetime"))==null?null:p.touched)||r.formSubmitMarker)),$(5),W("ngIf",((f=r.postTradeForm.get("exitdatetime"))==null?null:f.invalid)&&(((f=r.postTradeForm.get("exitdatetime"))==null?null:f.dirty)||((f=r.postTradeForm.get("exitdatetime"))==null?null:f.touched)||r.formSubmitMarker)),$(8),W("ngIf",((m=r.postTradeForm.get("entryprice"))==null?null:m.invalid)&&(((m=r.postTradeForm.get("entryprice"))==null?null:m.dirty)||((m=r.postTradeForm.get("entryprice"))==null?null:m.touched)||r.formSubmitMarker)),$(8),W("ngIf",((h=r.postTradeForm.get("exitprice"))==null?null:h.invalid)&&(((h=r.postTradeForm.get("exitprice"))==null?null:h.dirty)||((h=r.postTradeForm.get("exitprice"))==null?null:h.touched)||r.formSubmitMarker)),$(6),W("ngIf",((g=r.postTradeForm.get("positionsize"))==null?null:g.invalid)&&(((g=r.postTradeForm.get("positionsize"))==null?null:g.dirty)||((g=r.postTradeForm.get("positionsize"))==null?null:g.touched)||r.formSubmitMarker)),$(23),W("ngIf",((y=r.postTradeForm.get("tradeoutcome"))==null?null:y.invalid)&&(((y=r.postTradeForm.get("tradeoutcome"))==null?null:y.dirty)||((y=r.postTradeForm.get("tradeoutcome"))==null?null:y.touched)||r.formSubmitMarker)),$(73),W("ngIf",r.formSubmitMarker&&r.postTradeForm.invalid),$(2),W("ngIf",r.tradeLogData),$(4),Ge("",r.tradeLogData?"Update":"Submit"," "),$(),W("ngIf",r.message),$(),W("ngIf",r.errorMessage)}},dependencies:[on,xn,Qi,Ki,Pl,$l,pr,zu,Eg,Yi,Ws,Yr,qi,Dg,Xi,Hs,Kr],styles:[".card[_ngcontent-%COMP%]{border-radius:8px;box-shadow:0 2px 5px #0000000d;border:1px solid rgba(0,0,0,.1);color:#000}.card-header[_ngcontent-%COMP%]{background-color:#f8f9fa;border-bottom:1px solid rgba(0,0,0,.1);padding:12px 16px}.form-control[_ngcontent-%COMP%], .form-select[_ngcontent-%COMP%]{border-radius:6px;padding:10px 12px;background-color:#f9f9f9;border:1px solid #ced4da}.form-control[_ngcontent-%COMP%]:focus, .form-select[_ngcontent-%COMP%]:focus{background-color:#fff;border-color:#80bdff;box-shadow:0 0 0 .25rem #0d6efd40}textarea.form-control[_ngcontent-%COMP%]{resize:vertical}.btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:6px;font-weight:500}.ng-invalid.ng-touched[_ngcontent-%COMP%]{border-color:#dc3545}"]})};var gre=(t,n,e)=>({"open-trade":t,"win-trade":n,"loss-trade":e}),yre=(t,n,e)=>({"status-open":t,"status-win":n,"status-loss":e}),xre=(t,n,e)=>({"bi-clock-history":t,"bi-check-circle":n,"bi-x-circle":e}),vre=(t,n,e)=>({"text-success":t,"text-danger":n,"text-secondary":e});function bre(t,n){t&1&&(w(0,"div",12),_(1,"Loading trade logs..."),x())}function wre(t,n){if(t&1&&(w(0,"div",13),_(1),x()),t&2){let e=re();$(),At(e.errorMessage)}}function Cre(t,n){if(t&1){let e=mt();w(0,"div",16)(1,"div",17),fe("click",function(){let o=Ce(e).$implicit,i=re(2);return Se(i.openEditModal(o))}),w(2,"div",18),j(3,"i",19),_(4),x(),w(5,"div",20),fe("click",function(o){let i=Ce(e).$implicit,s=re(2);return Se(s.onDeleteTradeLog(i,o))}),j(6,"i",21),x(),w(7,"div",22)(8,"h4",23),_(9),x(),w(10,"h5",24),_(11),x(),w(12,"div",25)(13,"div",26)(14,"div",27)(15,"strong"),_(16,"Strategy:"),x(),_(17),x(),w(18,"div",27)(19,"strong"),_(20,"Analysis:"),x(),_(21),x()(),w(22,"div",26)(23,"div",27)(24,"strong"),_(25,"Entry:"),x(),_(26),x(),w(27,"div",27)(28,"strong"),_(29,"Exit:"),x(),_(30),x()(),w(31,"div",26)(32,"div",27)(33,"strong"),_(34,"Date:"),x(),_(35),Fs(36,"date"),x(),w(37,"div",27)(38,"strong"),_(39,"Account:"),x(),_(40),x()(),w(41,"div",28)(42,"div",29)(43,"strong"),_(44,"P/L:"),x(),w(45,"span",30),_(46),x()()()(),w(47,"div",31)(48,"small",32),_(49),Fs(50,"date"),x()()()()()}if(t&2){let e=n.$implicit;$(),W("ngClass",wl(23,gre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),$(),W("ngClass",wl(27,yre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),$(),W("ngClass",wl(31,xre,e.isopen,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss")),$(),Ge(" ",e.isopen?"In Progress":e.tradeoutcome," "),$(5),At(e.tradesymbol),$(2),wh(" ",e.tradetype," | ",e.instrumenttype," | ",e.timeframe," "),$(6),Ge(" ",e.strategyname," "),$(4),Ge(" ",e.analysistype," "),$(5),Ge(" ",e.entryprice," "),$(4),Ge(" ",e.isopen?"Pending":e.exitprice," "),$(5),Ge(" ",Ps(36,17,e.entrydatetime,"shortDate")," "),$(5),Ge(" ",e.accountname," "),$(5),W("ngClass",wl(35,vre,!e.isopen&&e.tradeoutcome==="Win",!e.isopen&&e.tradeoutcome==="Loss",e.isopen)),$(),Ge(" ",e.isopen?"Trade in progress":e.profitlossamount," "),$(3),At(Ps(50,20,e.createdtime,"medium"))}}function Sre(t,n){if(t&1&&(w(0,"div",14),ae(1,Cre,51,39,"div",15),x()),t&2){let e=re();$(),W("ngForOf",e.tradeLogs)}}function _re(t,n){t&1&&(w(0,"div",33),_(1," No trade logs found. "),x())}function Ire(t,n){if(t&1){let e=mt();w(0,"div",34),fe("click",function(o){Ce(e);let i=re();return Se(i.closeModalOnOverlayClick(o))}),w(1,"div",35),fe("click",function(o){return Ce(e),Se(o.stopPropagation())}),w(2,"app-post-trade-log",36),fe("formSubmitted",function(){Ce(e);let o=re();return Se(o.onFormSubmitted())})("cancel",function(){Ce(e);let o=re();return Se(o.closeModal())}),x()()()}if(t&2){let e=re();$(2),W("tradeLogData",e.selectedTradeLog)}}var qv=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="posttrade";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.detectChanges()}async fetchTradeLogs(){try{this.tradeLogs=await this.supabaseService.getTradeLogs(this.tableName),this.cdr.detectChanges()}catch(n){console.error("Error fetching trade logs",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal()}closeModal(){this.showModal=!1,this.selectedTradeLog=null}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(oe(jt),oe(Ut))};static \u0275cmp=Pt({type:t,selectors:[["app-post-trade-table"]],decls:18,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item","text-decoration-none"],["routerLink","/home"],["aria-current","page",1,"breadcrumb-item","active"],["routerLink","/posttradelog"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","row mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"row","mt-5"],["class","col-md-4 col-12 mb-4",4,"ngFor","ngForOf"],[1,"col-md-4","col-12","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi",3,"ngClass"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"row","mb-2"],[1,"col-6"],[1,"row"],[1,"col-12"],[3,"ngClass"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeLogData"]],template:function(e,r){e&1&&(w(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),_(5,"Dashboard"),x()(),w(6,"li",5),_(7,"Post-Trade Logs"),x(),w(8,"li",3)(9,"a",6),_(10,"Post-Trading Journal"),x()()()(),w(11,"h2"),_(12,"Post Trade Logs"),x(),ae(13,bre,2,0,"div",7)(14,wre,2,1,"div",8)(15,Sre,2,1,"div",9)(16,_re,2,0,"div",10),x(),ae(17,Ire,3,1,"div",11)),e&2&&($(13),W("ngIf",r.loading),$(),W("ngIf",r.errorMessage),$(),W("ngIf",r.tradeLogs&&r.tradeLogs.length),$(),W("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),$(),W("ngIf",r.showModal))},dependencies:[Kr,on,Po,Wr,xn,_l,lf],styles:[".modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;justify-content:center;align-items:center;z-index:1000}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:5px;max-width:90%;max-height:90%;overflow:auto;position:relative}.card[_ngcontent-%COMP%]{position:relative;border:none;transition:all .2s ease}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px);box-shadow:0 10px 20px #0000001a!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;display:none;color:#dc3545;background:#fffc;border-radius:50%;padding:5px;z-index:10}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.delete-icon[_ngcontent-%COMP%]:hover{cursor:pointer}.open-trade[_ngcontent-%COMP%]{border-left:4px solid #17a2b8!important}.win-trade[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.loss-trade[_ngcontent-%COMP%]{border-left:4px solid #dc3545!important}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:8px;left:8px;padding:5px 10px;border-radius:12px;font-size:.8rem;font-weight:700;z-index:10;color:#fff}.status-open[_ngcontent-%COMP%]{background-color:#17a2b8}.status-win[_ngcontent-%COMP%]{background-color:#28a745}.status-loss[_ngcontent-%COMP%]{background-color:#dc3545}.trade-status-indicator[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:3px}"]})};var Ere=(t,n)=>({"alert-success":t,"alert-danger":n});function Tre(t,n){if(t&1&&(w(0,"div",17),_(1),x()),t&2){let e=re();W("ngClass",Ui(2,Ere,e.messageType==="success",e.messageType==="error")),$(),Ge(" ",e.message," ")}}function Dre(t,n){if(t&1){let e=mt();Os(0),w(1,"input",24),jr("ngModelChange",function(o){Ce(e);let i=re().$implicit;return co(i.choicesInput,o)||(i.choicesInput=o),Se(o)}),fe("change",function(){Ce(e);let o=re().$implicit,i=re();return Se(i.updateChoices(o))}),x(),w(2,"div",25),_(3,'e.g., "Option A, Option B, Option C"'),x(),Ms()}if(t&2){let e=re().$implicit;$(),Ur("ngModel",e.choicesInput)}}function Nre(t,n){if(t&1){let e=mt();w(0,"tr")(1,"td")(2,"select",18),jr("ngModelChange",function(o){let i=Ce(e).$implicit;return co(i.question_data.question_type,o)||(i.question_data.question_type=o),Se(o)}),fe("change",function(){let o=Ce(e).$implicit,i=re();return Se(i.onQuestionChange(o))}),w(3,"option",8),_(4,"Fill"),x(),w(5,"option",9),_(6,"Multiple"),x(),w(7,"option",10),_(8,"Select One"),x()()(),w(9,"td")(10,"textarea",19),jr("ngModelChange",function(o){let i=Ce(e).$implicit;return co(i.question_data.question,o)||(i.question_data.question=o),Se(o)}),fe("change",function(){let o=Ce(e).$implicit,i=re();return Se(i.onQuestionChange(o))}),x()(),w(11,"td"),ae(12,Dre,4,1,"ng-container",20),x(),w(13,"td")(14,"div",21)(15,"input",22),jr("ngModelChange",function(o){let i=Ce(e).$implicit;return co(i.active,o)||(i.active=o),Se(o)}),fe("change",function(){let o=Ce(e).$implicit,i=re();return Se(i.onQuestionChange(o))}),x()()(),w(16,"td"),_(17),Fs(18,"date"),x(),w(19,"td")(20,"button",23),fe("click",function(){let o=Ce(e).$implicit,i=re();return Se(i.deleteQuestion(o))}),_(21,"Delete"),x()()()}if(t&2){let e=n.$implicit;$(2),Ur("ngModel",e.question_data.question_type),$(8),Ur("ngModel",e.question_data.question),$(2),W("ngIf",e.question_data.question_type!=="fill"),$(3),Ur("ngModel",e.active),$(2),At(Ps(18,5,e.updated_at,"short"))}}function kre(t,n){if(t&1){let e=mt();w(0,"div",26)(1,"input",27),jr("ngModelChange",function(o){Ce(e);let i=re();return co(i.newQuestionChoices,o)||(i.newQuestionChoices=o),Se(o)}),x()()}if(t&2){let e=re();$(),Ur("ngModel",e.newQuestionChoices)}}var Kv=class t{constructor(n,e){this.cdr=n;this.supabaseService=e}questions=[];newQuestionText="";newQuestionType="fill";newQuestionChoices="";message="";messageType="success";async ngOnInit(){let n=await this.supabaseService.adminLoadQuestions();this.questions=n.map(e=>Ze(he({},e),{choicesInput:e.question_data.choices?.join(", ")||""})),this.cdr.markForCheck()}onQuestionChange(n){n.isModified=!0}updateChoices(n){let e=n.choicesInput??"";n.question_data.choices=e.split(",").map(r=>r.trim()).filter(r=>r),n.isModified=!0}addQuestion(){if(!this.newQuestionText.trim())return;let n={question_type:this.newQuestionType,question:this.newQuestionText.trim()};if(this.newQuestionType!=="fill"){let e=this.newQuestionChoices.split(",").map(r=>r.trim()).filter(r=>r);n.choices=e}this.questions.push({question_data:n,choicesInput:this.newQuestionChoices,active:!0,isModified:!0}),this.newQuestionText="",this.newQuestionChoices="",this.newQuestionType="fill",this.cdr.detectChanges()}async saveChanges(){let{error:n}=await this.supabaseService.adminSaveQuestions(this.questions);n?this.showMessage("Error saving questions","error"):this.showMessage("Questions saved successfully","success"),this.cdr.detectChanges()}async deleteQuestion(n){if(!n.question_id){this.questions=this.questions.filter(r=>r!==n),this.showMessage("Question removed locally","success"),this.cdr.markForCheck();return}let{error:e}=await this.supabaseService.deleteQuestion(n);e?this.showMessage("Error deleting question","error"):(this.questions=this.questions.filter(r=>r.question_id!==n.question_id),this.showMessage("Question deleted successfully","success")),this.cdr.markForCheck()}showMessage(n,e){this.message=n,this.messageType=e,setTimeout(()=>{this.message="",this.cdr.markForCheck()},4e3)}hasChanges(){return this.questions.some(n=>n.isModified)}static \u0275fac=function(e){return new(e||t)(oe(Ut),oe(jt))};static \u0275cmp=Pt({type:t,selectors:[["app-admin-emotion-dashboard"]],decls:40,vars:6,consts:[[1,"container","mt-4"],["class","alert",3,"ngClass",4,"ngIf"],[1,"table"],[4,"ngFor","ngForOf"],[1,"mt-4"],[1,"row","g-3","align-items-center","mb-3"],[1,"col-md-3"],[1,"form-select",3,"ngModelChange","ngModel"],["value","fill"],["value","multiple"],["value","select-one"],[1,"col-md-5"],["type","text","placeholder","Enter question text",1,"form-control",3,"ngModelChange","ngModel"],["class","col-md-4",4,"ngIf"],[1,"d-flex","justify-content-between"],[1,"btn","btn-primary",3,"click"],[1,"btn","btn-success",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"form-select",3,"ngModelChange","change","ngModel"],["type","text",1,"form-control",3,"ngModelChange","change","ngModel"],[4,"ngIf"],[1,"form-check","form-switch"],["type","checkbox",1,"form-check-input",3,"ngModelChange","change","ngModel"],[1,"btn","btn-danger","btn-sm",3,"click"],["type","text","placeholder","Comma-separated choices",1,"form-control","mb-1",3,"ngModelChange","change","ngModel"],[1,"text-muted","small"],[1,"col-md-4"],["type","text","placeholder","Comma-separated choices",1,"form-control",3,"ngModelChange","ngModel"]],template:function(e,r){e&1&&(w(0,"div",0),ae(1,Tre,2,5,"div",1),w(2,"h1"),_(3,"Admin Dashboard - Manage Questions"),x(),w(4,"table",2)(5,"thead")(6,"tr")(7,"th"),_(8,"Type"),x(),w(9,"th"),_(10,"Question Text"),x(),w(11,"th"),_(12,"Choices"),x(),w(13,"th"),_(14,"Active"),x(),w(15,"th"),_(16,"Last Updated"),x(),w(17,"th"),_(18,"Actions"),x()()(),w(19,"tbody"),ae(20,Nre,22,8,"tr",3),x()(),w(21,"h4",4),_(22,"Add New Question"),x(),w(23,"div",5)(24,"div",6)(25,"select",7),jr("ngModelChange",function(i){return co(r.newQuestionType,i)||(r.newQuestionType=i),i}),w(26,"option",8),_(27,"Fill"),x(),w(28,"option",9),_(29,"Multiple"),x(),w(30,"option",10),_(31,"Select One"),x()()(),w(32,"div",11)(33,"input",12),jr("ngModelChange",function(i){return co(r.newQuestionText,i)||(r.newQuestionText=i),i}),x()(),ae(34,kre,2,1,"div",13),x(),w(35,"div",14)(36,"button",15),fe("click",function(){return r.addQuestion()}),_(37,"Add Question"),x(),w(38,"button",16),fe("click",function(){return r.saveChanges()}),_(39,"Save Changes"),x()()()),e&2&&($(),W("ngIf",r.message),$(19),W("ngForOf",r.questions),$(5),Ur("ngModel",r.newQuestionType),$(8),Ur("ngModel",r.newQuestionText),$(),W("ngIf",r.newQuestionType!=="fill"),$(4),W("disabled",!r.hasChanges()))},dependencies:[sf,Pl,$l,pr,Eg,Yi,Yr,Bu,on,Po,Wr,xn,_l],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.question-row[_ngcontent-%COMP%]{position:relative}.delete-button[_ngcontent-%COMP%]{display:none;position:absolute;right:10px;top:50%;transform:translateY(-50%)}.question-row[_ngcontent-%COMP%]:hover   .delete-button[_ngcontent-%COMP%]{display:block}.alert[_ngcontent-%COMP%]{padding:10px 20px;margin-bottom:15px;border-radius:4px;text-align:center}"]})};var Are=(t,n)=>({"alert-success":t,"alert-danger":n});function Rre(t,n){if(t&1&&(w(0,"div",4),_(1),x()),t&2){let e=re();W("ngClass",Ui(2,Are,e.messageType==="success",e.messageType==="error")),$(),Ge(" ",e.message," ")}}function Ore(t,n){if(t&1){let e=mt();w(0,"textarea",9),jr("ngModelChange",function(o){Ce(e);let i=re().$implicit;return co(i.answer,o)||(i.answer=o),Se(o)}),x()}if(t&2){let e=re().$implicit;I0("name",e.question_id),Ur("ngModel",e.answer)}}function Mre(t,n){if(t&1){let e=mt();w(0,"div",12)(1,"input",13),jr("ngModelChange",function(o){Ce(e);let i=re(2).$implicit;return co(i.answer,o)||(i.answer=o),Se(o)}),x(),w(2,"label",14),_(3),x()()}if(t&2){let e=n.$implicit,r=re(2).$implicit;$(),I0("name",r.question_id),W("value",e),Ur("ngModel",r.answer),$(2),At(e)}}function Fre(t,n){if(t&1&&(w(0,"div",10),ae(1,Mre,4,4,"div",11),x()),t&2){let e=re().$implicit;$(),W("ngForOf",e.question_data.choices)}}function Pre(t,n){if(t&1){let e=mt();w(0,"div",16)(1,"input",17),fe("change",function(){let o=Ce(e).$implicit,i=re(2).$implicit,s=re();return Se(s.toggleMultipleChoice(i,o))}),x(),w(2,"label",14),_(3),x()()}if(t&2){let e=n.$implicit,r=re(2).$implicit;$(),W("checked",r.multipleAnswers==null?null:r.multipleAnswers.includes(e)),$(2),At(e)}}function $re(t,n){if(t&1&&(w(0,"div",10),ae(1,Pre,4,2,"div",15),x()),t&2){let e=re().$implicit;$(),W("ngForOf",e.question_data.choices)}}function Lre(t,n){if(t&1&&(w(0,"div",5)(1,"label",6),_(2),x(),ae(3,Ore,1,2,"textarea",7)(4,Fre,2,1,"div",8)(5,$re,2,1,"div",8),x()),t&2){let e=n.$implicit;$(2),At(e.question_data.question),$(),W("ngIf",e.question_data.question_type==="fill"),$(),W("ngIf",e.question_data.question_type==="select-one"),$(),W("ngIf",e.question_data.question_type==="multiple")}}var Xv=class t{constructor(n,e,r){this.supabaseService=n;this.cdr=e;this.router=r}questions=[];message="";messageType="success";ngOnInit(){this.loadQuestions()}async loadQuestions(){let{data:n,error:e}=await this.supabaseService.getActiveQuestions();e?(console.error("Error loading questions:",e),this.message="Error loading questions.",this.messageType="error"):n&&(this.questions=n),this.cdr.markForCheck()}allQuestionsAnswered(){return this.questions.every(n=>n.question_data.question_type==="multiple"?n.multipleAnswers&&n.multipleAnswers.length>0:n.answer&&n.answer.trim().length>0)}toggleMultipleChoice(n,e){n.multipleAnswers||(n.multipleAnswers=[]);let r=n.multipleAnswers.indexOf(e);r>-1?n.multipleAnswers.splice(r,1):n.multipleAnswers.push(e)}async submitAnswers(){if(!this.allQuestionsAnswered()){this.message="Please answer all questions before submitting.",this.messageType="error",this.cdr.markForCheck();return}let n=this.supabaseService.user()?.id;if(!n){this.message="User not authenticated.",this.messageType="error",this.cdr.markForCheck();return}let e=this.questions.map(o=>({question_id:o.question_id,answer:o.question_data.question_type==="multiple"?o.multipleAnswers?.join(", ")??"":o.answer?.trim()??"",user_id:n})),{error:r}=await this.supabaseService.submitUserAnswers(e);r?(console.error("Error submitting answers:",r),this.message="Error submitting answers.",this.messageType="error"):(this.message="Answers submitted successfully. redirecting in 5 seconds.",this.messageType="success"),this.cdr.markForCheck(),setTimeout(()=>{this.router.navigateByUrl("/home")},5e3)}static \u0275fac=function(e){return new(e||t)(oe(jt),oe(Ut),oe(mo))};static \u0275cmp=Pt({type:t,selectors:[["app-user-emotion-questionnaire"]],decls:8,vars:3,consts:[[1,"container","mt-4"],["class","alert",3,"ngClass",4,"ngIf"],["class","mb-4",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-primary",3,"click","disabled"],[1,"alert",3,"ngClass"],[1,"mb-4"],[1,"form-label","fw-bold","question-label","pt-4","pb-4","ps-3","pe-3","mt-3","mb-3","col-12"],["class","form-control card-body p-3","rows","3","placeholder","Type your answer here...",3,"ngModel","name","ngModelChange",4,"ngIf"],["class","card-body p-4",4,"ngIf"],["rows","3","placeholder","Type your answer here...",1,"form-control","card-body","p-3",3,"ngModelChange","ngModel","name"],[1,"card-body","p-4"],["class","btn-radio-tr form-check",4,"ngFor","ngForOf"],[1,"btn-radio-tr","form-check"],["type","radio",1,"form-check-input","mb-2",3,"ngModelChange","name","value","ngModel"],[1,"form-check-label"],["class","btn-check-tr form-check",4,"ngFor","ngForOf"],[1,"btn-check-tr","form-check"],["type","checkbox",1,"form-check-input","mb-2",3,"change","checked"]],template:function(e,r){e&1&&(w(0,"div",0),ae(1,Rre,2,5,"div",1),w(2,"h1"),_(3,"User Emotion Questionnaire"),x(),w(4,"form"),ae(5,Lre,6,4,"div",2),w(6,"button",3),fe("click",function(){return r.submitAnswers()}),_(7," Submit Answers "),x()()()),e&2&&($(),W("ngIf",r.message),$(4),W("ngForOf",r.questions),$(),W("disabled",!r.allQuestionsAnswered()))},dependencies:[sf,Ki,pr,Ws,Yr,qi,Bu,K1,on,Po,Wr,xn],styles:[".container[_ngcontent-%COMP%]{max-width:800px;margin:auto}.alert[_ngcontent-%COMP%]{margin-bottom:20px;text-align:center}h1[_ngcontent-%COMP%]{margin-bottom:20px}.question-label[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:700;color:#333;background-color:#f0f0ff;border-radius:20px;display:inline-block}"]})};function Vre(t,n){if(t&1&&(w(0,"div",13),_(1),x()),t&2){let e=re();$(),Ge(" ",e.errorMessage," ")}}function Bre(t,n){t&1&&(w(0,"div",28),_(1," A valid email is required. "),x())}function zre(t,n){t&1&&(w(0,"div",28),_(1," Password must be at least 6 characters. "),x())}function Ure(t,n){if(t&1){let e=mt();w(0,"form",14),fe("ngSubmit",function(){Ce(e);let o=re();return Se(o.onSubmit())}),w(1,"div",15)(2,"label",16),_(3,"Email"),x(),j(4,"input",17),ae(5,Bre,2,0,"div",18),x(),w(6,"div",15)(7,"label",19),_(8,"Password"),x(),j(9,"input",20),ae(10,zre,2,0,"div",18),w(11,"div",21)(12,"a",22),_(13,"Forgot password?"),x()()(),w(14,"div",23)(15,"button",24),_(16,"Continue"),x()(),w(17,"div",25)(18,"p",26),_(19,"Don't have an account? "),w(20,"a",27),fe("click",function(){Ce(e);let o=re();return Se(o.setActiveTab("signup"))}),_(21,"Sign up"),x()()()()}if(t&2){let e,r,o=re();W("formGroup",o.signinForm),$(5),W("ngIf",((e=o.signinForm.get("email"))==null?null:e.invalid)&&((e=o.signinForm.get("email"))==null?null:e.touched)),$(5),W("ngIf",((r=o.signinForm.get("password"))==null?null:r.invalid)&&((r=o.signinForm.get("password"))==null?null:r.touched)),$(5),W("disabled",o.signinForm.invalid)}}function jre(t,n){t&1&&(w(0,"small",43),_(1," First name is required "),x())}function Gre(t,n){t&1&&(w(0,"small",43),_(1," Last name is required "),x())}function Wre(t,n){t&1&&(w(0,"small",43),_(1," Valid email is required "),x())}function Hre(t,n){t&1&&(w(0,"small",43),_(1," Password must be at least 6 characters "),x())}function qre(t,n){t&1&&(w(0,"small",43),_(1," Passwords do not match "),x())}function Kre(t,n){if(t&1){let e=mt();w(0,"form",14),fe("ngSubmit",function(){Ce(e);let o=re();return Se(o.onSignupSubmit())}),w(1,"div",29)(2,"div",30)(3,"label",31),_(4,"First Name"),x(),j(5,"input",32),ae(6,jre,2,0,"small",33),x(),w(7,"div",30)(8,"label",34),_(9,"Last Name"),x(),j(10,"input",35),ae(11,Gre,2,0,"small",33),x()(),w(12,"div",15)(13,"label",36),_(14,"Email"),x(),j(15,"input",37),ae(16,Wre,2,0,"small",33),x(),w(17,"div",15)(18,"label",38),_(19,"Password"),x(),j(20,"input",39),ae(21,Hre,2,0,"small",33),x(),w(22,"div",15)(23,"label",40),_(24,"Confirm Password"),x(),j(25,"input",41),ae(26,qre,2,0,"small",33),x(),w(27,"div",23)(28,"button",24),_(29,"Create Account"),x()(),w(30,"div",25)(31,"p",26),_(32,"Already have an account? "),w(33,"a",42),fe("click",function(){Ce(e);let o=re();return Se(o.setActiveTab("login"))}),_(34,"Login"),x()()()()}if(t&2){let e,r,o,i,s,a=re();W("formGroup",a.signupForm),$(6),W("ngIf",((e=a.signupForm.get("firstname"))==null?null:e.invalid)&&((e=a.signupForm.get("firstname"))==null?null:e.touched)),$(5),W("ngIf",((r=a.signupForm.get("lastname"))==null?null:r.invalid)&&((r=a.signupForm.get("lastname"))==null?null:r.touched)),$(5),W("ngIf",((o=a.signupForm.get("email"))==null?null:o.invalid)&&((o=a.signupForm.get("email"))==null?null:o.touched)),$(5),W("ngIf",((i=a.signupForm.get("password"))==null?null:i.invalid)&&((i=a.signupForm.get("password"))==null?null:i.touched)),$(5),W("ngIf",a.signupForm.hasError("mismatch")&&((s=a.signupForm.get("confirmPassword"))==null?null:s.touched)),$(2),W("disabled",a.signupForm.invalid)}}var Yv=class t{constructor(n,e,r,o){this.fb=n;this.router=e;this.route=r;this.supabaseService=o;this.signinForm=this.fb.group({email:["",[_e.required,_e.email]],password:["",[_e.required,_e.minLength(6)]]}),this.signupForm=this.fb.group({firstname:["",_e.required],lastname:["",_e.required],email:["",[_e.required,_e.email]],password:["",[_e.required,_e.minLength(6)]],confirmPassword:["",_e.required]},{validators:this.passwordMatchValidator})}activeTab="login";signinForm;signupForm;errorMessage=null;ngOnInit(){this.route.queryParams.subscribe(n=>{n.mode==="signup"&&(this.activeTab="signup")})}passwordMatchValidator(n){let e=n.get("password")?.value,r=n.get("confirmPassword")?.value;return e===r?null:{mismatch:!0}}setActiveTab(n){this.activeTab=n,this.errorMessage=null}async onSubmit(){if(this.signinForm.invalid){this.signinForm.markAllAsTouched();return}let{email:n,password:e}=this.signinForm.getRawValue();try{if(await this.supabaseService.signIn(n,e),!this.supabaseService.currentUsername()){this.errorMessage="Login failed. Please try again.";return}this.signinForm.reset();let r=this.route.snapshot.queryParams.returnUrl||"/home";this.router.navigateByUrl(r)}catch(r){this.errorMessage=r.message||"An unexpected error occurred."}}onSignupSubmit(){if(this.signupForm.invalid){this.signupForm.markAllAsTouched();return}let{email:n,password:e,firstname:r,lastname:o}=this.signupForm.getRawValue();this.supabaseService.signUp(n,e,r,o).then(()=>{this.signupForm.reset(),this.router.navigateByUrl("/home")}).catch(i=>{this.errorMessage=i.message||"An unexpected error occurred.",console.error(i)})}static \u0275fac=function(e){return new(e||t)(oe(Ll),oe(mo),oe(yi),oe(jt))};static \u0275cmp=Pt({type:t,selectors:[["app-login-signup"]],decls:20,vars:7,consts:[[1,"auth-container"],[1,"auth-card"],[1,"text-center","mb-4"],[1,"logo-circle","mx-auto"],["src","/trading-rehab-logo.png","alt","Logo",1,"img-fluid"],[1,"brand-name","mt-3"],[1,"brand-tagline"],[1,"auth-tabs","d-flex","justify-content-center","mb-4"],[1,"tabs-container"],[1,"tab",3,"click"],[1,"mx-2","tab-separator"],["class","alert alert-danger mb-3",4,"ngIf"],["class","auth-form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"alert","alert-danger","mb-3"],[1,"auth-form",3,"ngSubmit","formGroup"],[1,"mb-3"],["for","email",1,"form-label"],["type","email","id","email","formControlName","email","placeholder","Enter your email",1,"form-control"],["class","text-danger small mt-1",4,"ngIf"],["for","password",1,"form-label"],["type","password","id","password","formControlName","password","placeholder","Enter your password",1,"form-control"],[1,"d-flex","justify-content-end","mt-2"],["href","#",1,"forgot-link"],[1,"d-grid","gap-2","mt-4"],["type","submit",1,"btn","btn-tr","btn-primary","btn-md",3,"disabled"],[1,"text-center","mt-4"],[1,"mb-0"],["href","javascript:void(0)",1,"signup-link",3,"click"],[1,"text-danger","small","mt-1"],[1,"row"],[1,"col-md-6","mb-3"],["for","firstname",1,"form-label"],["type","text","id","firstname","formControlName","firstname","placeholder","First name",1,"form-control"],["class","text-danger",4,"ngIf"],["for","lastname",1,"form-label"],["type","text","id","lastname","formControlName","lastname","placeholder","Last name",1,"form-control"],["for","signup-email",1,"form-label"],["type","email","id","signup-email","formControlName","email","placeholder","Enter your email",1,"form-control"],["for","signup-password",1,"form-label"],["type","password","id","signup-password","formControlName","password","placeholder","Create a password",1,"form-control"],["for","confirmPassword",1,"form-label"],["type","password","id","confirmPassword","formControlName","confirmPassword","placeholder","Confirm your password",1,"form-control"],["href","javascript:void(0)",1,"login-link",3,"click"],[1,"text-danger"]],template:function(e,r){e&1&&(w(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),j(4,"img",4),x(),w(5,"h2",5),_(6,"TRADING REHAB"),x(),w(7,"p",6),_(8,"Where Disciplined Trading Begins"),x()(),w(9,"div",7)(10,"div",8)(11,"span",9),fe("click",function(){return r.setActiveTab("login")}),_(12,"Login"),x(),w(13,"span",10),_(14,"\u2022"),x(),w(15,"span",9),fe("click",function(){return r.setActiveTab("signup")}),_(16,"Sign Up"),x()()(),ae(17,Vre,2,1,"div",11)(18,Ure,22,4,"form",12)(19,Kre,35,7,"form",12),x()()),e&2&&($(11),zi("active",r.activeTab==="login"),$(4),zi("active",r.activeTab==="signup"),$(2),W("ngIf",r.errorMessage),$(),W("ngIf",r.activeTab==="login"),$(),W("ngIf",r.activeTab==="signup"))},dependencies:[on,xn,Qi,Ki,pr,Yr,qi,Xi,Hs],styles:['.auth-container[_ngcontent-%COMP%]{min-height:100vh;background:conic-gradient(#eaeafd,#9c9ce4,#eaeafd);display:flex;align-items:center;justify-content:center}.auth-card[_ngcontent-%COMP%]{background-color:transparent;border-radius:12px;width:100%;max-width:450px;padding:30px}.logo-circle[_ngcontent-%COMP%]{width:80px;height:80px;border-radius:50%;background-color:transparent;position:relative;display:flex;align-items:center;justify-content:center;margin:0 auto}.dots-circle[_ngcontent-%COMP%]{width:60px;height:60px;border-radius:50%;position:relative;background-image:radial-gradient(circle,#5046e5 3px,transparent 3px);background-size:15px 15px;transform:rotate(45deg)}.brand-name[_ngcontent-%COMP%]{font-weight:700;font-size:24px;margin-bottom:5px;letter-spacing:.5px}.brand-tagline[_ngcontent-%COMP%]{color:#666;font-size:14px;margin:0}.tabs-container[_ngcontent-%COMP%]{display:inline-flex;align-items:center;border-bottom:1px solid #eee;padding-bottom:5px}.tab[_ngcontent-%COMP%]{padding:8px 15px;cursor:pointer;color:#888;font-weight:500;font-size:16px;transition:color .2s}.tab.active[_ngcontent-%COMP%]{color:#5046e5;border-bottom:2px solid #5046e5}.tab-separator[_ngcontent-%COMP%]{color:#ccc}.auth-form[_ngcontent-%COMP%]{margin-top:10px}.form-control[_ngcontent-%COMP%]{height:auto;padding:12px 15px;border-radius:8px;border:1px solid #ddd;transition:border-color .2s,box-shadow .2s}.form-control[_ngcontent-%COMP%]:focus{border-color:#5046e5;box-shadow:0 0 0 .2rem #5046e526}.form-label[_ngcontent-%COMP%]{font-weight:500;color:#555;margin-bottom:8px}.forgot-link[_ngcontent-%COMP%]{font-size:14px;color:#5046e5;text-decoration:none}.forgot-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.signup-link[_ngcontent-%COMP%], .login-link[_ngcontent-%COMP%]{color:#5046e5;font-weight:500;text-decoration:none}.signup-link[_ngcontent-%COMP%]:hover, .login-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.btn-primary[_ngcontent-%COMP%]{background-color:#5046e5;border-color:#5046e5;padding:12px;font-weight:500}.btn-primary[_ngcontent-%COMP%]:hover, .btn-primary[_ngcontent-%COMP%]:focus{background-color:#4238d0;border-color:#4238d0}.btn-primary[_ngcontent-%COMP%]:disabled{background-color:#a8a4e0;border-color:#a8a4e0}.separator[_ngcontent-%COMP%]{display:flex;align-items:center;text-align:center;color:#888;font-size:14px}.separator[_ngcontent-%COMP%]:before, .separator[_ngcontent-%COMP%]:after{content:"";flex:1;border-bottom:1px solid #ddd}.separator[_ngcontent-%COMP%]:before{margin-right:1em}.separator[_ngcontent-%COMP%]:after{margin-left:1em}.google-btn[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;background-color:#fff;border:1px solid #ddd;color:#333;padding:12px;font-weight:500}.google-btn[_ngcontent-%COMP%]:hover{background-color:#f8f8f8;color:#333}@media (max-width: 576px){.auth-card[_ngcontent-%COMP%]{padding:20px 15px}.brand-name[_ngcontent-%COMP%]{font-size:20px}.form-control[_ngcontent-%COMP%], .btn[_ngcontent-%COMP%]{padding:10px}}']})};var u$=(t,n)=>({"btn-tr text-dark":t,"btn-tr":n}),Xre=(t,n)=>({"btn-tr  text-dark":t,"btn-tr  btn-outline-primary":n});function Yre(t,n){if(t&1){let e=mt();w(0,"button",15),fe("click",function(){let o;Ce(e);let i=re();return Se((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Executing"))}),j(1,"i",78),_(2," Executing "),x()}if(t&2){let e,r=re();W("ngClass",Ui(1,u$,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Executing",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Executing"))}}function Qre(t,n){if(t&1){let e=mt();w(0,"button",15),fe("click",function(){let o;Ce(e);let i=re();return Se((o=i.tradeForm.get("trade_status"))==null?null:o.setValue("Completed"))}),j(1,"i",79),_(2," Completed "),x()}if(t&2){let e,r=re();W("ngClass",Ui(1,Xre,((e=r.tradeForm.get("trade_status"))==null?null:e.value)==="Completed",((e=r.tradeForm.get("trade_status"))==null?null:e.value)!=="Completed"))}}function Zre(t,n){if(t&1){let e=mt();w(0,"div",85)(1,"button",86),fe("click",function(){let o=Ce(e).index,i=re(2);return Se(i.removePlannedTrade(o))}),j(2,"i",87),x(),w(3,"h6",88),_(4),x(),w(5,"div",24)(6,"div",89)(7,"label",90),_(8,"Direction"),x(),w(9,"div",91),j(10,"input",92),w(11,"label",93),_(12,"Long"),x(),j(13,"input",94),w(14,"label",95),_(15,"Short"),x()()(),w(16,"div",89)(17,"label",90),_(18,"Entry Price"),x(),w(19,"div",27)(20,"span",28),_(21,"$"),x(),j(22,"input",96),x()(),w(23,"div",89)(24,"label",90),_(25,"Stop Loss"),x(),w(26,"div",27)(27,"span",28),_(28,"$"),x(),j(29,"input",97),x()(),w(30,"div",89)(31,"label",90),_(32,"Exit Price"),x(),w(33,"div",27)(34,"span",28),_(35,"$"),x(),j(36,"input",98),x()(),w(37,"div",25)(38,"label",90),_(39,"Planned Entry Time"),x(),j(40,"input",99),x(),w(41,"div",25)(42,"label",90),_(43,"Planned Exit Time"),x(),j(44,"input",100),x(),w(45,"div",25)(46,"label",90),_(47,"Exit Type"),x(),w(48,"select",101)(49,"option",36),_(50,"Select exit type"),x(),w(51,"option",102),_(52,"Target"),x(),w(53,"option",103),_(54,"Stop Loss"),x(),w(55,"option",104),_(56,"Manual"),x()()(),w(57,"div",25)(58,"label",90),_(59,"Position Size ($)"),x(),w(60,"div",27)(61,"span",28),_(62,"$"),x(),j(63,"input",105),x()(),w(64,"div",25)(65,"label",90),_(66,"Contracts/Shares"),x(),j(67,"input",106),x(),w(68,"div",25)(69,"label",90),_(70,"Multiplier"),x(),j(71,"input",107),x()(),w(72,"div",108)(73,"div",109),j(74,"div",110),x()()()}if(t&2){let e=n.index;W("formGroupName",e),$(4),Ge("Planned Trade #",e+1,""),$(6),W("id","direction_long_"+e),$(),W("for","direction_long_"+e),$(2),W("id","direction_short_"+e),$(),W("for","direction_short_"+e)}}function Jre(t,n){if(t&1){let e=mt();w(0,"div",18)(1,"div",19)(2,"h5",20),j(3,"i",80),_(4,"Planned Trades "),x(),w(5,"span",22),_(6,"Required"),x()(),w(7,"div",23)(8,"div",81),ae(9,Zre,75,6,"div",82),w(10,"button",83),fe("click",function(){Ce(e);let o=re();return Se(o.addPlannedTrade())}),j(11,"i",84),_(12,"Add Planned Trade "),x()()()()}if(t&2){let e=re();$(9),W("ngForOf",e.plannedTrades.controls)}}function eoe(t,n){if(t&1){let e=mt();w(0,"div",85)(1,"button",86),fe("click",function(){let o=Ce(e).index,i=re(2);return Se(i.removeExecutingTrade(o))}),j(2,"i",87),x(),w(3,"h6",88),_(4),x(),w(5,"div",24)(6,"div",89)(7,"label",90),_(8,"Direction"),x(),w(9,"div",91),j(10,"input",92),w(11,"label",93),_(12,"Long"),x(),j(13,"input",94),w(14,"label",95),_(15,"Short"),x()()(),w(16,"div",89)(17,"label",90),_(18,"Entry Price"),x(),w(19,"div",27)(20,"span",28),_(21,"$"),x(),j(22,"input",96),x()(),w(23,"div",89)(24,"label",90),_(25,"Stop Loss"),x(),w(26,"div",27)(27,"span",28),_(28,"$"),x(),j(29,"input",97),x()(),w(30,"div",89)(31,"label",90),_(32,"Exit Price"),x(),w(33,"div",27)(34,"span",28),_(35,"$"),x(),j(36,"input",98),x()(),w(37,"div",25)(38,"label",90),_(39,"Entry Time"),x(),j(40,"input",99),x(),w(41,"div",25)(42,"label",90),_(43,"Exit Time"),x(),j(44,"input",100),x(),w(45,"div",25)(46,"label",90),_(47,"Exit Type"),x(),w(48,"select",101)(49,"option",36),_(50,"Select exit type"),x(),w(51,"option",102),_(52,"Target"),x(),w(53,"option",103),_(54,"Stop Loss"),x(),w(55,"option",104),_(56,"Manual"),x()()(),w(57,"div",25)(58,"label",90),_(59,"Position Size ($)"),x(),w(60,"div",27)(61,"span",28),_(62,"$"),x(),j(63,"input",105),x()(),w(64,"div",25)(65,"label",90),_(66,"Contracts/Shares"),x(),j(67,"input",106),x(),w(68,"div",25)(69,"label",90),_(70,"Multiplier"),x(),j(71,"input",107),x()()()}if(t&2){let e=n.index;W("formGroupName",e),$(4),Ge("Trade Execution #",e+1,""),$(6),W("id","exec_direction_long_"+e),$(),W("for","exec_direction_long_"+e),$(2),W("id","exec_direction_short_"+e),$(),W("for","exec_direction_short_"+e)}}function toe(t,n){if(t&1){let e=mt();w(0,"div",18)(1,"div",19)(2,"h5",20),j(3,"i",80),_(4,"Executing Trades "),x(),w(5,"span",22),_(6,"Required"),x()(),w(7,"div",23)(8,"div",111),ae(9,eoe,72,6,"div",82),w(10,"button",83),fe("click",function(){Ce(e);let o=re();return Se(o.addExecutingTrade())}),j(11,"i",84),_(12,"Add Executing Trade "),x()()()()}if(t&2){let e=re();$(9),W("ngForOf",e.executingTrades.controls)}}function noe(t,n){t&1&&(w(0,"div",67),j(1,"i",138),w(2,"span",139),_(3," Consider if this emotional state might negatively impact your decision making"),x()())}function roe(t,n){if(t&1&&(w(0,"div",18)(1,"div",19)(2,"h5",20),j(3,"i",112),_(4,"Emotional Analysis "),x(),w(5,"span",22),_(6,"Required"),x()(),w(7,"div",23)(8,"div",113)(9,"div",24)(10,"div",42)(11,"label",114),_(12,"Emotional State"),x(),w(13,"select",115)(14,"option",36),_(15,"How are you feeling?"),x(),w(16,"option",116),_(17,"Calm & Focused"),x(),w(18,"option",117),_(19,"Excited"),x(),w(20,"option",118),_(21,"Anxious"),x(),w(22,"option",119),_(23,"Frustrated"),x(),w(24,"option",120),_(25,"Overconfident"),x(),w(26,"option",121),_(27,"Fearful"),x(),w(28,"option",122),_(29,"Neutral"),x(),w(30,"option",41),_(31,"Other"),x()(),ae(32,noe,4,0,"div",123),x(),w(33,"div",42)(34,"label",124),_(35,"Trade Confidence"),x(),w(36,"div",91),j(37,"input",125),w(38,"label",126),_(39,"1"),x(),j(40,"input",127),w(41,"label",128),_(42,"2"),x(),j(43,"input",129),w(44,"label",130),_(45,"3"),x(),j(46,"input",131),w(47,"label",132),_(48,"4"),x(),j(49,"input",133),w(50,"label",134),_(51,"5"),x()(),w(52,"div",135),_(53,"Low (1) to High (5)"),x()()(),w(54,"div",58)(55,"label",136),_(56,"Reflection"),x(),j(57,"textarea",137),x()()()()),t&2){let e=re();$(32),W("ngIf",e.isNegativeEmotionalState())}}function ooe(t,n){t&1&&(w(0,"div",18)(1,"div",19)(2,"h5",20),j(3,"i",112),_(4,"Profit Analysis "),x(),w(5,"span",22),_(6,"Required"),x()(),w(7,"div",23)(8,"div",24)(9,"div",25)(10,"label",140),_(11,"Realized Profit"),x(),w(12,"div",27)(13,"span",28),_(14,"$"),x(),j(15,"input",141),x()(),w(16,"div",25)(17,"label",142),_(18,"Unrealized Profit"),x(),w(19,"div",27)(20,"span",28),_(21,"$"),x(),j(22,"input",143),x()(),w(23,"div",25)(24,"label",144),_(25,"Total Profit"),x(),w(26,"div",27)(27,"span",28),_(28,"$"),x(),j(29,"input",145),x()()()()())}function ioe(t,n){t&1&&(w(0,"div",18)(1,"div",19)(2,"h5",20),j(3,"i",146),_(4,"Post-Trade Reflection "),x(),w(5,"span",22),_(6,"Required"),x()(),w(7,"div",23)(8,"div",147)(9,"div",24)(10,"div",42)(11,"label",148),_(12,"Emotional State"),x(),w(13,"select",149)(14,"option",36),_(15,"How are you feeling?"),x(),w(16,"option",150),_(17,"Satisfied"),x(),w(18,"option",117),_(19,"Excited"),x(),w(20,"option",151),_(21,"Disappointed"),x(),w(22,"option",119),_(23,"Frustrated"),x(),w(24,"option",120),_(25,"Overconfident"),x(),w(26,"option",122),_(27,"Neutral"),x(),w(28,"option",41),_(29,"Other"),x()()(),w(30,"div",42)(31,"label",152),_(32,"Trade Confidence for Next Time"),x(),w(33,"div",91),j(34,"input",153),w(35,"label",154),_(36,"1"),x(),j(37,"input",155),w(38,"label",156),_(39,"2"),x(),j(40,"input",157),w(41,"label",158),_(42,"3"),x(),j(43,"input",159),w(44,"label",160),_(45,"4"),x(),j(46,"input",161),w(47,"label",162),_(48,"5"),x()(),w(49,"div",135),_(50,"Low (1) to High (5)"),x()()(),w(51,"div",58)(52,"label",163),_(53,"Trade Reflection"),x(),j(54,"textarea",164),x()()()())}var cf=class t{constructor(n,e,r){this.fb=n;this.cdr=e;this.supabase=r}tradeData;mode="create";formSubmitted=new zt;cancel=new zt;tradeForm;tableName="tradejournal";ngOnInit(){this.initForm()}ngOnChanges(n){n.tradeData&&!n.tradeData.firstChange&&(this.populateForm(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)}),this.tradeData&&(this.mode="edit"))}initForm(){let n=this.mode==="create"?ju():this.tradeData?.tradeid;this.tradeForm=this.fb.group({tradeid:n,userid:this.supabase.user()?.id,updated_time:[""],account_name:["",_e.required],trade_symbol:["",_e.required],trade_analysis:[""],trade_instrument:[""],type_of_order:[""],market_condition:[""],trade_status:["Planned"],strategy_name:[""],entry_criteria:[""],exit_criteria:[""],planned_trade:this.fb.array([]),executing_trades:this.fb.array([]),realized_profit:[0,_e.required],unrealized_profit:[0,_e.required],planned_profit:[0,_e.required],emotion_before:this.fb.group({emotional_state_before:[""],trade_confidence_before:[""],reflection_before:[""]}),emotion_after:this.fb.group({emotional_state_after:[""],trade_confidence_after:[""],reflection_after:[""]}),notes:[""]}),this.tradeForm.get("trade_status")?.valueChanges.subscribe(e=>{this.handleStatusChange(e)}),this.handleStatusChange("Planned"),this.tradeData&&(this.populateForm(),this.mode="edit")}get plannedTrades(){return this.tradeForm.get("planned_trade")}get executingTrades(){return this.tradeForm.get("executing_trades")}newTradeGroup(n=!1){let e={entry_price:[""],exit_price:[""],stop_loss:[""],trade_direction:[""],entry_time:[""],exit_time:[""],exit:[""],position_size:[""],contracts:[""],contract_multiplier:[""]};return n&&(e.profit=[""]),this.fb.group(e)}addPlannedTrade(){this.plannedTrades.push(this.newTradeGroup())}removePlannedTrade(n){this.plannedTrades.removeAt(n)}addExecutingTrade(){this.executingTrades.push(this.newTradeGroup(!0))}removeExecutingTrade(n){this.executingTrades.removeAt(n)}populateForm(){this.tradeData&&(this.tradeForm.patchValue(this.tradeData),this.plannedTrades.clear(),this.executingTrades.clear(),this.tradeData.planned_trade?.forEach(n=>{this.plannedTrades.push(this.fb.group(n))}),this.tradeData.executing_trades?.forEach(n=>{this.executingTrades.push(this.fb.group(n))}),this.handleStatusChange(this.tradeData.trade_status))}handleStatusChange(n){let e=this.tradeForm.get("emotion_after"),r=this.tradeForm.get("emotion_before");n==="Planned"?(this.executingTrades.disable(),e.disable(),r.enable()):n==="Executing"?(this.executingTrades.enable(),e.disable(),r.enable(),this.executingTrades.length===0&&this.plannedTrades.length>0&&this.plannedTrades.controls.forEach(o=>{this.executingTrades.push(this.fb.group(o.value))})):n==="Completed"&&(this.executingTrades.enable(),e.enable(),r.disable()),this.cdr.markForCheck(),setTimeout(()=>{this.handleStatusChange(this.tradeForm.get("trade_status")?.value)})}async onSubmit(){if(this.tradeForm.valid){this.tradeForm.patchValue({updated_time:new Date().toISOString()});let n=this.tradeForm.getRawValue();try{this.mode==="create"?await this.supabase.addTradeLog(n,this.tableName):this.mode==="edit"&&await this.supabase.updateTradeLog(n,this.tableName),this.formSubmitted.emit()}catch(e){console.error("Error submitting trade:",e)}}else console.log("Invalid form")}onCancel(){this.cancel.emit()}isNegativeEmotionalState(){let n=this.tradeData?this.tradeData.emotion_before:"calm";return["Anxious","Frustrated","Fearful","Overconfident"].includes(n)}static \u0275fac=function(e){return new(e||t)(oe(Ll),oe(Ut),oe(jt))};static \u0275cmp=Pt({type:t,selectors:[["app-individual-trade"]],inputs:{tradeData:"tradeData",mode:"mode"},outputs:{formSubmitted:"formSubmitted",cancel:"cancel"},features:[pi],decls:154,vars:14,consts:[[1,"container","my-4"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["routerLink","/tradejournal",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"row","mb-4"],[1,"col-lg-8"],[1,"mb-2"],[1,"text-muted"],[1,"needs-validation",3,"ngSubmit","formGroup"],[1,"mb-4"],[1,"form-label","d-block","mb-2"],["role","group","aria-label","Trade status toggle",1,"btn-group","w-100","shadow-sm"],["type","button",1,"btn",3,"click","ngClass"],[1,"bi","bi-hourglass","me-1"],["type","button","class","btn",3,"ngClass","click",4,"ngIf"],[1,"card","mb-4","shadow-sm"],[1,"card-header","bg-light","d-flex","justify-content-between","align-items-center"],[1,"mb-0"],[1,"bi","bi-1-circle","me-2"],[1,"badge","bg-primary"],[1,"card-body"],[1,"row","g-3"],[1,"col-md-4"],["for","trade_symbol",1,"form-label"],[1,"input-group"],[1,"input-group-text"],[1,"bi","bi-tag"],["type","text","id","trade_symbol","formControlName","trade_symbol","placeholder","Enter ticker symbol",1,"form-control"],["for","account_name",1,"form-label"],[1,"bi","bi-person"],["type","text","id","account_name","formControlName","account_name","placeholder","Enter account name",1,"form-control"],["for","trade_analysis",1,"form-label"],["id","trade_analysis","formControlName","trade_analysis",1,"form-select"],["value","","selected","","disabled",""],["value","Technical"],["value","Fundamental"],["value","Both"],["value","Sentiment"],["value","Other"],[1,"col-md-6"],["for","trade_instrument",1,"form-label"],["id","trade_instrument","formControlName","trade_instrument",1,"form-select"],["value","Forex"],["value","Stocks"],["value","Futures"],["value","Crypto"],["value","Options"],["value","ETF"],["for","type_of_order",1,"form-label"],["id","type_of_order","formControlName","type_of_order",1,"form-select"],["value","Market"],["value","Limit"],["value","Stop"],["value","StopLimit"],["value","TrailingStop"],[1,"col-12"],["for","market_condition",1,"form-label"],["id","market_condition","rows","3","formControlName","market_condition","placeholder","Describe current market conditions and relevant factors",1,"form-control"],[1,"bi","bi-2-circle","me-2"],[1,"card-body","col-12"],["for","strategy_name",1,"form-label"],["type","text","id","strategy_name","formControlName","strategy_name","placeholder","e.g., Breakout, Reversal, Trend Following",1,"form-control"],["for","entry_criteria",1,"form-label"],["id","entry_criteria","rows","4","formControlName","entry_criteria","placeholder","Describe your specific entry conditions (e.g., technical indicators, patterns, fundamental factors)",1,"form-control"],[1,"form-text"],["for","exit_criteria",1,"form-label"],["id","exit_criteria","rows","4","formControlName","exit_criteria","placeholder","Define your profit targets and stop loss levels",1,"form-control"],["class","card mb-4 shadow-sm",4,"ngIf"],[1,"bi","bi-6-circle","me-2"],[1,"badge","bg-secondary"],[1,"p-3"],["id","notes","formControlName","notes","placeholder","Any additional information or context for this trade","rows","3",1,"form-control"],[1,"d-flex","justify-content-end"],["type","button",1,"btn","btn-tr","me-2","mt-3",3,"click"],["type","submit",1,"btn","btn-primary","btn-tr","mt-3"],[1,"bi","bi-play-fill","me-1"],[1,"bi","bi-check-circle","me-1"],[1,"bi","bi-3-circle","me-2"],["formArrayName","planned_trade"],["class","border rounded p-3 mb-3 position-relative",3,"formGroupName",4,"ngFor","ngForOf"],["type","button",1,"btn","btn-tr","btn-outline-primary","w-100",3,"click"],[1,"bi","bi-plus-circle","me-2"],[1,"border","rounded","p-3","mb-3","position-relative",3,"formGroupName"],["type","button",1,"btn","btn-sm","btn-danger","position-absolute","end-0","top-0","m-2",3,"click"],[1,"bi","bi-x"],[1,"mb-3"],[1,"col-md-3"],[1,"form-label"],["role","group",1,"btn-group","w-100"],["type","radio","formControlName","trade_direction","value","Long",1,"btn-check",3,"id"],[1,"btn","btn-outline-success",3,"for"],["type","radio","formControlName","trade_direction","value","Short",1,"btn-check",3,"id"],[1,"btn","btn-outline-danger",3,"for"],["type","number","step","0.01","placeholder","Entry Price","formControlName","entry_price",1,"form-control"],["type","number","step","0.01","placeholder","Stop Loss","formControlName","stop_loss",1,"form-control"],["type","number","step","0.01","placeholder","Exit Price","formControlName","exit_price",1,"form-control"],["type","datetime-local","formControlName","entry_time",1,"form-control"],["type","datetime-local","formControlName","exit_time",1,"form-control"],["formControlName","exit",1,"form-select"],["value","Target"],["value","StopLoss"],["value","Manual"],["type","number","step","0.01","placeholder","Position Size","formControlName","position_size",1,"form-control"],["type","number","placeholder","Contracts","formControlName","contracts",1,"form-control"],["type","number","step","0.01","placeholder","Multiplier","formControlName","contract_multiplier",1,"form-control"],[1,"mt-3"],[1,"progress",2,"height","5px"],["role","progressbar",1,"progress-bar",2,"width","100%"],["formArrayName","executing_trades"],[1,"bi","bi-4-circle","me-2"],["formGroupName","emotion_before"],["for","emotional_state_before",1,"form-label"],["id","emotional_state_before","formControlName","emotional_state_before",1,"form-select"],["value","Calm"],["value","Excited"],["value","Anxious"],["value","Frustrated"],["value","Overconfident"],["value","Fearful"],["value","Neutral"],["class","form-text",4,"ngIf"],["for","trade_confidence_before",1,"form-label"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_1","value","1",1,"btn-check"],["for","confidence_before_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_2","value","2",1,"btn-check"],["for","confidence_before_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_3","value","3",1,"btn-check"],["for","confidence_before_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_4","value","4",1,"btn-check"],["for","confidence_before_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_before","id","confidence_before_5","value","5",1,"btn-check"],["for","confidence_before_5",1,"btn","btn-outline-success"],[1,"form-text","text-center"],["for","reflection_before",1,"form-label"],["id","reflection_before","formControlName","reflection_before","placeholder","What biases might affect your decision? (e.g., revenge trading, FOMO)","rows","2",1,"form-control"],[1,"bi","bi-exclamation-triangle","text-warning"],[1,"text-warning"],["for","realized_profit",1,"form-label"],["type","number","step","0.01","id","realized_profit","formControlName","realized_profit",1,"form-control"],["for","unrealized_profit",1,"form-label"],["type","number","step","0.01","id","unrealized_profit","formControlName","unrealized_profit",1,"form-control"],["for","planned_profit",1,"form-label"],["type","number","step","0.01","id","planned_profit","formControlName","planned_profit",1,"form-control"],[1,"bi","bi-5-circle","me-2"],["formGroupName","emotion_after"],["for","emotional_state_after",1,"form-label"],["id","emotional_state_after","formControlName","emotional_state_after",1,"form-select"],["value","Satisfied"],["value","Disappointed"],["for","trade_confidence_after",1,"form-label"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_1","value","1",1,"btn-check"],["for","confidence_after_1",1,"btn","btn-outline-danger"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_2","value","2",1,"btn-check"],["for","confidence_after_2",1,"btn","btn-outline-warning"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_3","value","3",1,"btn-check"],["for","confidence_after_3",1,"btn","btn-outline-secondary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_4","value","4",1,"btn-check"],["for","confidence_after_4",1,"btn","btn-outline-primary"],["type","radio","formControlName","trade_confidence_after","id","confidence_after_5","value","5",1,"btn-check"],["for","confidence_after_5",1,"btn","btn-outline-success"],["for","reflection_after",1,"form-label"],["id","reflection_after","formControlName","reflection_after","placeholder","What did you learn? What could be improved?","rows","2",1,"form-control"]],template:function(e,r){if(e&1&&(w(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),_(5,"Dashboard"),x()(),w(6,"li",3)(7,"a",5),_(8,"Trade Logs"),x()(),w(9,"li",6),_(10,"Trade Form"),x()()(),w(11,"div",7)(12,"div",8)(13,"h2",9),_(14),x(),w(15,"p",10),_(16,"Document your trading strategy and execution to maintain discipline and improve performance"),x()()(),w(17,"form",11),fe("ngSubmit",function(){return r.onSubmit()}),w(18,"div",12)(19,"label",13),_(20,"Trade Status"),x(),w(21,"div",14)(22,"button",15),fe("click",function(){let i;return(i=r.tradeForm.get("trade_status"))==null?null:i.setValue("Planned")}),j(23,"i",16),_(24," Planned "),x(),ae(25,Yre,3,4,"button",17)(26,Qre,3,4,"button",17),x()(),w(27,"div",18)(28,"div",19)(29,"h5",20),j(30,"i",21),_(31,"Trade Setup "),x(),w(32,"span",22),_(33,"Required"),x()(),w(34,"div",23)(35,"div",24)(36,"div",25)(37,"label",26),_(38,"Trade Symbol"),x(),w(39,"div",27)(40,"span",28),j(41,"i",29),x(),j(42,"input",30),x()(),w(43,"div",25)(44,"label",31),_(45,"Account Name"),x(),w(46,"div",27)(47,"span",28),j(48,"i",32),x(),j(49,"input",33),x()(),w(50,"div",25)(51,"label",34),_(52,"Trade Analysis"),x(),w(53,"select",35)(54,"option",36),_(55,"Choose analysis method"),x(),w(56,"option",37),_(57,"Technical"),x(),w(58,"option",38),_(59,"Fundamental"),x(),w(60,"option",39),_(61,"Both"),x(),w(62,"option",40),_(63,"Sentiment"),x(),w(64,"option",41),_(65,"Other"),x()()(),w(66,"div",42)(67,"label",43),_(68,"Trade Instrument"),x(),w(69,"select",44)(70,"option",36),_(71,"Choose instrument type"),x(),w(72,"option",45),_(73,"Forex"),x(),w(74,"option",46),_(75,"Stocks"),x(),w(76,"option",47),_(77,"Futures"),x(),w(78,"option",48),_(79,"Crypto"),x(),w(80,"option",49),_(81,"Options"),x(),w(82,"option",50),_(83,"ETF"),x(),w(84,"option",41),_(85,"Other"),x()()(),w(86,"div",42)(87,"label",51),_(88,"Type of Order"),x(),w(89,"select",52)(90,"option",36),_(91,"Choose order type"),x(),w(92,"option",53),_(93,"Market"),x(),w(94,"option",54),_(95,"Limit"),x(),w(96,"option",55),_(97,"Stop"),x(),w(98,"option",56),_(99,"Stop Limit"),x(),w(100,"option",57),_(101,"Trailing Stop"),x()()(),w(102,"div",58)(103,"label",59),_(104,"Market Condition"),x(),j(105,"textarea",60),x()()()(),w(106,"div",18)(107,"div",19)(108,"h5",20),j(109,"i",61),_(110,"Trade Strategy "),x(),w(111,"span",22),_(112,"Required"),x()(),w(113,"div",62)(114,"label",63),_(115,"Strategy Name"),x(),j(116,"input",64),x(),w(117,"div",23)(118,"div",24)(119,"div",42)(120,"label",65),_(121,"Entry Criteria "),w(122,"span",10),_(123,"(Why are you taking this trade?)"),x()(),j(124,"textarea",66),w(125,"div",67),_(126,"Be specific about what signals or conditions must be met for entry."),x()(),w(127,"div",42)(128,"label",68),_(129,"Exit Criteria "),w(130,"span",10),_(131,"(How will you close this position?)"),x()(),j(132,"textarea",69),w(133,"div",67),_(134,"Include both profit-taking and loss-cutting criteria."),x()()()()(),ae(135,Jre,13,1,"div",70)(136,toe,13,1,"div",70)(137,roe,58,1,"div",70)(138,ooe,30,0,"div",70)(139,ioe,55,0,"div",70),w(140,"div",18)(141,"div",19)(142,"h5",20),j(143,"i",71),_(144,"Additional Notes "),x(),w(145,"span",72),_(146,"Optional"),x()(),w(147,"div",73),j(148,"textarea",74),x()(),w(149,"div",75)(150,"button",76),fe("click",function(){return r.onCancel()}),_(151,"Cancel"),x(),w(152,"button",77),_(153),x()()()()),e&2){let o,i,s,a,l,c;$(14),At(r.mode==="edit"?"Edit Trade":"Create Trade"),$(3),W("formGroup",r.tradeForm),$(5),W("ngClass",Ui(11,u$,((o=r.tradeForm.get("trade_status"))==null?null:o.value)==="Planned",((o=r.tradeForm.get("trade_status"))==null?null:o.value)!=="Planned")),$(3),W("ngIf",r.mode==="edit"),$(),W("ngIf",r.mode==="edit"),$(109),W("ngIf",((i=r.tradeForm.get("trade_status"))==null?null:i.value)==="Planned"),$(),W("ngIf",((s=r.tradeForm.get("trade_status"))==null?null:s.value)!=="Planned"),$(),W("ngIf",((a=r.tradeForm.get("trade_status"))==null?null:a.value)!=="Completed"),$(),W("ngIf",((l=r.tradeForm.get("trade_status"))==null?null:l.value)==="Completed"),$(),W("ngIf",((c=r.tradeForm.get("trade_status"))==null?null:c.value)==="Completed"),$(14),Ge(" ",r.mode==="edit"?"Update Trade":"Save Trade"," ")}},dependencies:[on,Po,Wr,xn,Qi,Ki,Pl,$l,pr,zu,Yi,Ws,Yr,qi,Xi,Hs,Gv,Wv,Kr],encapsulation:2})};var soe=(t,n,e)=>({"status-planned-card":t,"status-executing-card":n,"status-completed-card":e}),aoe=(t,n,e)=>({"status-planned":t,"status-executing":n,"status-completed":e});function loe(t,n){t&1&&(w(0,"div",14),_(1,"Loading trade logs..."),x())}function coe(t,n){if(t&1&&(w(0,"div",15),_(1),x()),t&2){let e=re();$(),At(e.errorMessage)}}function uoe(t,n){if(t&1){let e=mt();Os(0),w(1,"div",22)(2,"div",23),fe("click",function(){Ce(e);let o=re().$implicit,i=re(3);return Se(i.openEditModal(o))}),w(3,"div",24),j(4,"i",25),_(5),x(),w(6,"div",26),fe("click",function(o){Ce(e);let i=re().$implicit,s=re(3);return Se(s.onDeleteTradeLog(i,o))}),j(7,"i",27),x(),w(8,"div",28)(9,"h4",29),_(10),x(),w(11,"h5",30),_(12),x(),w(13,"div",31)(14,"div",32)(15,"strong"),_(16,"Account Name:"),x(),_(17),x(),w(18,"div",32)(19,"strong"),_(20,"Analysis:"),x(),_(21),x(),w(22,"div",32)(23,"strong"),_(24,"Profit:"),x(),_(25),x()(),w(26,"div",33)(27,"small",34),_(28),Fs(29,"date"),x()()()()(),Ms()}if(t&2){let e=re().$implicit;$(2),W("ngClass",wl(15,soe,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),$(),W("ngClass",wl(19,aoe,e.trade_status==="Planned",e.trade_status==="Executing",e.trade_status==="Completed")),$(2),Ge(" ",e.trade_status," "),$(5),At(e.trade_symbol),$(2),bh(" ",e.trade_instrument," | ",e.type_of_order," "),$(5),Ge(" ",e.account_name," "),$(4),Ge(" ",e.trade_analysis," "),$(4),wh(" Realized: ",e.realized_profit," | Unrealized: ",e.unrealized_profit," | Planned: ",e.planned_profit," "),$(3),Ge("Last modified: ",Ps(29,12,e.updated_time,"medium"),"")}}function doe(t,n){if(t&1&&(Os(0),ae(1,uoe,30,23,"ng-container",21),Ms()),t&2){let e=n.$implicit,r=re().$implicit;$(),W("ngIf",e.trade_status===r.status)}}function poe(t,n){if(t&1&&(w(0,"div",18)(1,"h3"),_(2),x(),w(3,"div",19),ae(4,doe,2,1,"ng-container",20),x()()),t&2){let e=n.$implicit,r=re(2);$(2),At(e.title),$(2),W("ngForOf",r.tradeLogs)}}function foe(t,n){if(t&1&&(w(0,"div",16),ae(1,poe,5,2,"div",17),x()),t&2){let e=re();$(),W("ngForOf",e.tradeStatus)}}function moe(t,n){t&1&&(w(0,"div",35),_(1," No trade logs found. "),x())}function hoe(t,n){if(t&1){let e=mt();w(0,"div",36),fe("click",function(o){Ce(e);let i=re();return Se(i.closeModalOnOverlayClick(o))}),w(1,"div",37),fe("click",function(o){return Ce(e),Se(o.stopPropagation())}),w(2,"app-individual-trade",38),fe("formSubmitted",function(){Ce(e);let o=re();return Se(o.onFormSubmitted())})("cancel",function(){Ce(e);let o=re();return Se(o.closeModal())}),x()()()}if(t&2){let e=re();$(2),W("tradeData",e.selectedTradeLog)("mode",e.selectedTradeLog?"edit":"create")}}var Qv=class t{constructor(n,e){this.supabaseService=n;this.cdr=e}tableName="tradejournal";tradeLogs=[];loading=!1;errorMessage="";showModal=!1;selectedTradeLog=null;tradeStatus=[{status:"Planned",title:"Planning Phase"},{status:"Executing",title:"Executing Phase"},{status:"Completed",title:"Completed Phase"}];async ngOnInit(){this.loading=!0,await this.fetchTradeLogs(),this.loading=!1,this.cdr.markForCheck()}async fetchTradeLogs(){try{let n=await this.supabaseService.getTradeLogs(this.tableName);this.tradeLogs=n.sort((e,r)=>new Date(r.updated_time).getDate()-new Date(e.updated_time).getTime()),console.log(this.tradeLogs),this.cdr.markForCheck()}catch(n){console.error("Error fetching trade logs:",n),this.errorMessage="Error fetching trade logs."}}openEditModal(n){this.selectedTradeLog=n,this.showModal=!0}openAddModal(){this.selectedTradeLog=null,this.showModal=!0}onFormSubmitted(){this.fetchTradeLogs(),this.closeModal(),this.cdr.markForCheck()}closeModal(){this.showModal=!1,this.selectedTradeLog=null,this.cdr.markForCheck()}closeModalOnOverlayClick(n){this.closeModal(),this.cdr.markForCheck()}async onDeleteTradeLog(n,e){e.stopPropagation();try{await this.supabaseService.deleteTradeLog(n.tradeid,this.tableName),await this.fetchTradeLogs(),this.cdr.markForCheck()}catch(r){console.error("Error deleting trade log:",r),this.errorMessage="Error deleting trade log."}}static \u0275fac=function(e){return new(e||t)(oe(jt),oe(Ut))};static \u0275cmp=Pt({type:t,selectors:[["app-trade-journal"]],decls:19,vars:5,consts:[[1,"container","mt-3"],["aria-label","breadcrumb"],[1,"breadcrumb"],[1,"breadcrumb-item"],["routerLink","/home",1,"text-decoration-none"],["aria-current","page",1,"breadcrumb-item","active"],[1,"d-flex","justify-content-between","align-items-center","justify-content-center"],[1,"btn","btn-tr","btn-primary",3,"click"],[1,"bi","bi-plus-circle","me-2"],["class","alert alert-info",4,"ngIf"],["class","alert alert-danger",4,"ngIf"],["class","mt-5",4,"ngIf"],["class","alert alert-warning",4,"ngIf"],["class","modal-overlay",3,"click",4,"ngIf"],[1,"alert","alert-info"],[1,"alert","alert-danger"],[1,"mt-5"],["class","mb-4",4,"ngFor","ngForOf"],[1,"mb-4"],[1,"mt-3","row"],[4,"ngFor","ngForOf"],[4,"ngIf"],[1,"col-md-3","col-sm-6","mb-4"],[1,"card","h-100","position-relative","shadow",2,"cursor","pointer",3,"click","ngClass"],[1,"trade-status-indicator",3,"ngClass"],[1,"bi","bi-clipboard-check"],[1,"delete-icon",3,"click"],[1,"bi","bi-trash"],[1,"card-body"],[1,"card-title","mt-5"],[1,"card-subtitle","mb-3","text-muted","fw-bold"],[1,"card-text"],[1,"mb-2"],[1,"mt-3"],[1,"text-muted"],[1,"alert","alert-warning"],[1,"modal-overlay",3,"click"],[1,"modal-content",3,"click"],[3,"formSubmitted","cancel","tradeData","mode"]],template:function(e,r){e&1&&(w(0,"div",0)(1,"nav",1)(2,"ol",2)(3,"li",3)(4,"a",4),_(5,"Dashboard"),x()(),w(6,"li",5),_(7,"Trade Journal"),x()()(),w(8,"div",6)(9,"h2"),_(10,"Trade Journal"),x(),w(11,"button",7),fe("click",function(){return r.openAddModal()}),j(12,"i",8),_(13," Add "),x()(),ae(14,loe,2,0,"div",9)(15,coe,2,1,"div",10)(16,foe,2,1,"div",11)(17,moe,2,0,"div",12),x(),ae(18,hoe,3,2,"div",13)),e&2&&($(14),W("ngIf",r.loading),$(),W("ngIf",r.errorMessage),$(),W("ngIf",r.tradeLogs&&r.tradeLogs.length),$(),W("ngIf",!r.loading&&(!r.tradeLogs||r.tradeLogs.length===0)),$(),W("ngIf",r.showModal))},dependencies:[Qi,on,Po,Wr,xn,_l,cf,Kr],styles:[".card[_ngcontent-%COMP%]{transition:transform .2s}.card[_ngcontent-%COMP%]:hover{transform:translateY(-5px)}.trade-status-indicator[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;padding:5px 10px;border-radius:5px;color:#fff;font-size:.7rem}.status-planned[_ngcontent-%COMP%]{background-color:#007bff}.status-executing[_ngcontent-%COMP%]{background-color:#ffc107}.status-completed[_ngcontent-%COMP%]{background-color:#28a745}.status-planned-card[_ngcontent-%COMP%]{border-left:4px solid #007bff!important}.status-executing-card[_ngcontent-%COMP%]{border-left:4px solid #ffc107!important}.status-completed-card[_ngcontent-%COMP%]{border-left:4px solid #28a745!important}.delete-icon[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;display:none;color:red;cursor:pointer}.card[_ngcontent-%COMP%]:hover   .delete-icon[_ngcontent-%COMP%]{display:block}.modal-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#00000080;display:flex;align-items:center;justify-content:center;z-index:1050}.modal-content[_ngcontent-%COMP%]{background-color:#fff;padding:20px;border-radius:8px;max-width:800px;width:100%;position:relative;max-height:98vh;overflow-y:auto}"]})};var Zv=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Pt({type:t,selectors:[["app-meditation-hub"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(w(0,"h1",0),_(1,"Meditation Coming soon"),x())},encapsulation:2})};var Jv=class t{static \u0275fac=function(e){return new(e||t)};static \u0275cmp=Pt({type:t,selectors:[["app-analytics"]],decls:2,vars:0,consts:[[1,"position-absolute","top-50","start-50","translate-middle"]],template:function(e,r){e&1&&(w(0,"h1",0),_(1,"Analytics Coming soon"),x())},encapsulation:2})};var Gu=class{constructor(n,e){this.backend=n,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(n){return this.data.has(n)||this.dataMover.moveData(this.backend,n),this.data.get(n)}set(n,e){this.dataIdsCount++,this.data.set(n,e)}has(n){return this.data.has(n)}delete(n){return this.dataIdsCount--,this.data.delete(n)}numDataIds(){return this.dataIdsCount}},qs=class{refCount(n){return Bo("refCount")}incRef(n){return Bo("incRef")}timerAvailable(){return!0}time(n){return Bo("time")}read(n){return Bo("read")}readSync(n){return Bo("readSync")}numDataIds(){return Bo("numDataIds")}disposeData(n,e){return Bo("disposeData")}write(n,e,r){return Bo("write")}move(n,e,r,o,i){return Bo("move")}memory(){return Bo("memory")}floatPrecision(){return Bo("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return Bo("dispose")}};function Bo(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function d$(t){let n=t.length,e=0,r=0;for(;n>0;)r=Math.random()*n|0,n--,e=t[n],t[n]=t[r],t[r]=e}function goe(t,n){if(t.length!==n.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${n.length}`);let e=t.length,r,o,i=0;for(;e>0;)i=Math.random()*e|0,e--,r=t[e],o=n[e],t[e]=t[i],n[e]=n[i],t[i]=r,n[i]=o}function uf(t,n,e){return Math.max(t,Math.min(n,e))}function yoe(t){return t%2===0?t:t+1}function xoe(t){let n=0;for(let e=0;e<t.length;e++)n+=t[e];return n}function voe(t,n){let e=Math.random();return n*e+(1-e)*t}function boe(t,n){let e=0;for(let r=0;r<t.length;r++){let o=Number(t[r])-Number(n[r]);e+=o*o}return e}function M(t,n){if(!t)throw new Error(typeof n=="string"?n:n())}function eb(t,n,e=""){M(Zi(t,n),()=>e+` Shapes ${t} and ${n} must match`)}function Ng(t){M(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function Vl(t,n=[],e=!1){if(n==null&&(n=[]),Array.isArray(t)||Qr(t)&&!e)for(let r=0;r<t.length;++r)Vl(t[r],n,e);else n.push(t);return n}function Rt(t){if(t.length===0)return 1;let n=t[0];for(let e=1;e<t.length;e++)n*=t[e];return n}function woe(t){return t.length===0}function Zi(t,n){if(t===n)return!0;if(t==null||n==null||t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e]!==n[e])return!1;return!0}function ht(t){return t%1===0}function Coe(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let n=Math.exp(2*t);return(n-1)/(n+1)}}function Soe(t){let n=Math.ceil(Math.sqrt(t));return[n,Math.ceil(t/n)]}function _oe(t){let n=new Uint32Array(t);for(let e=0;e<t;++e)n[e]=e;return d$(n),n}function Hu(t,n){return n<=t.length?t:t+" ".repeat(n-t.length)}function Ioe(t,n=r=>0,e){return new Promise((r,o)=>{let i=0,s=()=>{if(t()){r();return}i++;let a=n(i);if(e!=null&&i>=e){o();return}setTimeout(s,a)};s()})}function Eoe(t,n){let e=1,r=-1;for(let i=0;i<t.length;++i)if(t[i]>=0)e*=t[i];else if(t[i]===-1){if(r!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${r} and dim ${i}`);r=i}else if(t[i]<0)throw Error(`Shapes can not be < 0. Found ${t[i]} at dim ${i}`);if(r===-1){if(n>0&&n!==e)throw Error(`Size(${n}) must match the product of shape ${t}`);return t}if(e===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(n%e!==0)throw Error(`The implicit shape can't be a fractional number. Got ${n} / ${e}`);let o=t.slice();return o[r]=n/e,o}function vn(t,n){let e=n.length;return t=t==null?n.map((r,o)=>o):[].concat(t),M(t.every(r=>r>=-e&&r<e),()=>`All values in axis param must be in range [-${e}, ${e}) but got axis ${t}`),M(t.every(r=>ht(r)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(r=>r<0?e+r:r)}function J1(t,n){let e=[],r=[],o=n!=null&&Array.isArray(n)&&n.length===0,i=n==null||o?null:vn(n,t).sort(),s=0;for(let a=0;a<t.length;++a){if(i!=null){if(i[s]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(i[s]==null||i[s]>a)&&t[a]===1&&(e.push(t[a]),r.push(a)),i[s]<=a&&s++}t[a]!==1&&(e.push(t[a]),r.push(a))}return{newShape:e,keptDims:r}}function Toe(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else throw new Error(`Unknown data type ${t}`);return e}function eT(t,n){let e=null;if(t==null||t==="float32")e=new Float32Array(n);else if(t==="int32")e=new Int32Array(n);else if(t==="bool")e=new Uint8Array(n);else if(t==="string")e=new Array(n);else throw new Error(`Unknown data type ${t}`);return e}function tT(t,n){for(let e=0;e<t.length;e++){let r=t[e];if(isNaN(r)||!isFinite(r))throw Error(`A tensor of type ${n} being uploaded contains ${r}.`)}}function nT(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function Doe(t,n){return!(n==="complex64"||n==="float32"&&t!=="complex64"||n==="int32"&&t!=="float32"&&t!=="complex64"||n==="bool"&&t==="bool")}function Qr(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function tb(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function rT(t){if(t==null)return 0;let n=0;return t.forEach(e=>n+=e.length),n}function df(t){return typeof t=="string"||t instanceof String}function p$(t){return typeof t=="boolean"}function f$(t){return typeof t=="number"}function pf(t){return Array.isArray(t)?pf(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":f$(t)?"float32":df(t)?"string":p$(t)?"bool":"float32"}function ff(t){return!!(t&&t.constructor&&t.call&&t.apply)}function mf(t,n){for(let e=n;e<t;++e)if(t%e===0)return e;return t}function Ji(t){let n=t.length;if(n<2)return[];let e=new Array(n-1);e[n-2]=t[n-1];for(let r=n-3;r>=0;--r)e[r]=e[r+1]*t[r+1];return e}function m$(t,n,e,r=!1){let o=new Array;if(n.length===1){let i=n[0]*(r?2:1);for(let s=0;s<i;s++)o[s]=e[t+s]}else{let i=n[0],s=n.slice(1),a=s.reduce((l,c)=>l*c)*(r?2:1);for(let l=0;l<i;l++)o[l]=m$(t+l*a,s,e,r)}return o}function Wu(t,n,e=!1){if(t.length===0)return n[0];let r=t.reduce((o,i)=>o*i)*(e?2:1);if(r===0)return[];if(r!==n.length)throw new Error(`[${t}] does not match the input size ${n.length}${e?" for a complex tensor":""}.`);return m$(0,t,n,e)}function kg(t,n){let e=hf(t,n);for(let r=0;r<e.length;r++)e[r]=1;return e}function hf(t,n){if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${n}`)}function Noe(t,n){let e=t.reduce((r,o)=>r*o,1);if(n==null||n==="float32")return Wu(t,new Float32Array(e));if(n==="int32")return Wu(t,new Int32Array(e));if(n==="bool")return Wu(t,new Uint8Array(e));throw new Error(`Unknown data type ${n}`)}function Ag(t){t.forEach(n=>{M(Number.isInteger(n)&&n>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function koe(t,n,e){if(n===0)return 0;if(n===1)return t[0];let r=t[t.length-1];for(let o=0;o<t.length-1;++o)r+=e[o]*t[o];return r}function Aoe(t,n,e){if(n===0)return[];if(n===1)return[t];let r=new Array(n);for(let o=0;o<r.length-1;++o)r[o]=Math.floor(t/e[o]),t-=r[o]*e[o];return r[r.length-1]=t,r}function Rg(t){return t&&t.then&&typeof t.then=="function"}var h$="tfjsflags",Og=class{constructor(n){this.global=n,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Ooe,this.populateURLFlags()}setPlatform(n,e){this.platform!=null&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=n,this.platform=e}registerFlag(n,e,r){if(this.flagRegistry[n]={evaluationFn:e,setHook:r},this.urlFlags[n]!=null){let o=this.urlFlags[n];console.warn(`Setting feature override from URL ${n}: ${o}.`),this.set(n,o)}}async getAsync(n){return n in this.flags?this.flags[n]:(this.flags[n]=await this.evaluateFlag(n),this.flags[n])}get(n){if(n in this.flags)return this.flags[n];let e=this.evaluateFlag(n);if(Rg(e))throw new Error(`Flag ${n} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[n]=e,this.flags[n]}getNumber(n){return this.get(n)}getBool(n){return this.get(n)}getFlags(){return this.flags}get features(){return this.flags}set(n,e){if(this.flagRegistry[n]==null)throw new Error(`Cannot set flag ${n} as it has not been registered.`);this.flags[n]=e,this.flagRegistry[n].setHook!=null&&this.flagRegistry[n].setHook(e)}evaluateFlag(n){if(this.flagRegistry[n]==null)throw new Error(`Cannot evaluate flag '${n}': no evaluation function found.`);return this.flagRegistry[n].evaluationFn()}setFlags(n){this.flags=Object.assign({},n)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let n=this.getQueryParams(this.global.location.search);h$ in n&&n[h$].split(",").forEach(r=>{let[o,i]=r.split(":");this.urlFlags[o]=Foe(o,i)})}};function Ooe(t){let n={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(e,...r)=>(Moe(n,r[0],r[1]),r.join("="))),n}function Moe(t,n,e){t[decodeURIComponent(n)]=decodeURIComponent(e||"")}function Foe(t,n){if(n=n.toLowerCase(),n==="true"||n==="false")return n==="true";if(`${+n}`===n)return+n;throw new Error(`Could not parse value flag value ${n} for flag ${t}.`)}function H(){return oT}var oT=null;function g$(t){oT=t}var iT;function sT(){if(iT==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");iT=t}return iT}function Poe(){let t=sT();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function Mg(t,n){let e=Poe();if(e.has(t))return e.get(t);{let r=n();return e.set(t,r),e.get(t)}}var Bl="Abs",Ks="Acos",Xs="Acosh",vi="Add",gf="AddN",yf="All",xf="Any",zl="ArgMax",Ul="ArgMin",Ys="Asin",Qs="Asinh",Zs="Atan",Js="Atanh",ea="Atan2",jl="AvgPool",vf="AvgPoolGrad",Gl="AvgPool3D",bf="AvgPool3DGrad",Wl="BatchMatMul",Hl="BatchToSpaceND",nb="Bincount",y$="BroadcastTo",es="Cast",ta="Ceil",na="ClipByValue",wf="Complex",ql="ComplexAbs",Kl="Concat",Xl="Conv2D",Cf="Conv2DBackpropFilter",Yl="Conv2DBackpropInput",Ql="Conv3D",Sf="Conv3DBackpropFilterV2",_f="Conv3DBackpropInputV2",ra="Cos",oa="Cosh",Zl="Cumsum",rb="CropAndResize",ob="DenseBincount",If="DepthToSpace",Jl="DepthwiseConv2dNative",Ef="DepthwiseConv2dNativeBackpropFilter",Tf="DepthwiseConv2dNativeBackpropInput",ib="Diag",ec="Dilation2D",Fg="Dilation2DBackpropInput",Pg="Dilation2DBackpropFilter",ia="RealDiv",sb="Einsum",sa="Elu",Df="EluGrad",aa="Erf",qu="Equal",la="Exp",tc="ExpandDims",ca="Expm1",Nf="FFT",kf="Fill",ab="FlipLeftRight",ua="Floor",da="FloorDiv",nc="FusedBatchNorm",rc="GatherV2",lb="GatherNd",Ku="Greater",pa="GreaterEqual",ts="Identity",Af="IFFT",Rf="Imag",fa="IsFinite",ma="IsInf",ha="IsNan",oc="LeakyRelu",Xu="Less",Yu="LessEqual",cb="LinSpace",ga="Log",ya="Log1p",Qu="LogicalAnd",Zu="LogicalNot",Ju="LogicalOr",x$="LogSoftmax",ic="LRN",Of="LRNGrad",sc="Max",xa="Maximum",ac="MaxPool",Mf="MaxPoolGrad",lc="MaxPool3D",Ff="MaxPool3DGrad",ub="MaxPoolWithArgmax",cc="Mean",uc="Min",va="Minimum",dc="MirrorPad",ba="Mod",db="Multinomial",wa="Multiply",pc="Neg",ed="NotEqual",pb="NonMaxSuppressionV3",fb="NonMaxSuppressionV4",mb="NonMaxSuppressionV5",fc="OnesLike",mc="OneHot",hc="Pack",gc="PadV2";var Ca="Pow",yc="Prelu",Pf="Prod",$f="Range",Lf="Real",Sa="Reciprocal",_a="Relu",xc="Reshape",vc="ResizeNearestNeighbor",Vf="ResizeNearestNeighborGrad",bc="ResizeBilinear",Bf="ResizeBilinearGrad",Ia="Relu6",wc="Reverse",Ea="Round",Ta="Rsqrt",hb="ScatterNd",Cc="Select",Da="Selu",Sc="Slice",Na="Sin",ka="Sinh",Aa="Sign",Ra="Sigmoid",Oa="Softplus",Ma="Sqrt",_c="Sum",Ic="SpaceToBatchND",Ec="SplitV",Tc="Softmax",gb="SparseFillEmptyRows",yb="SparseReshape",xb="SparseToDense",Fa="SquaredDifference",zf="Square",Uf="StridedSlice",Pa="Sub",$a="Tan",La="Tanh",ns="Tile",jf="TopK",vb="Transform",Dc="Transpose",Gf="Unique",Nc="Unpack",kc="UnsortedSegmentSum",Ac="ZerosLike",Va="Step",v$="FromPixels",bb="RotateWithOffset",td="_FusedMatMul",nd="FusedConv2D",rd="FusedDepthwiseConv2D";var wb=Mg("kernelRegistry",()=>new Map),aT=Mg("gradRegistry",()=>new Map);function lT(t,n){let e=w$(t,n);return wb.get(e)}function cT(t){return aT.get(t)}function uT(t){let n=wb.entries(),e=[];for(;;){let{done:r,value:o}=n.next();if(r)break;let[i,s]=o,[a]=i.split("_");a===t&&e.push(s)}return e}function Cb(t){let{kernelName:n,backendName:e}=t,r=w$(n,e);wb.has(r)&&console.warn(`The kernel '${n}' for backend '${e}' is already registered`),wb.set(r,t)}function b$(t){let{kernelName:n}=t;aT.has(n)&&H().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${n}'`),aT.set(n,t)}function w$(t,n){return`${n}_${t}`}var b={};Fi(b,{arraysEqual:()=>Zi,assert:()=>M,assertNonNegativeIntegerDimensions:()=>Ag,assertNonNull:()=>Ng,assertShapesMatch:()=>eb,bytesFromStringArray:()=>rT,bytesPerElement:()=>tb,checkConversionForErrors:()=>tT,clamp:()=>uf,computeStrides:()=>Ji,createScalarValue:()=>$oe,createShuffledIndices:()=>_oe,decodeString:()=>qf,distSquared:()=>boe,encodeString:()=>Hf,fetch:()=>Voe,flatten:()=>Vl,getArrayFromDType:()=>eT,getTypedArrayFromDType:()=>Toe,hasEncodingLoss:()=>Doe,indexToLoc:()=>Aoe,inferDtype:()=>pf,inferFromImplicitShape:()=>Eoe,isBoolean:()=>p$,isFunction:()=>ff,isInt:()=>ht,isNumber:()=>f$,isPromise:()=>Rg,isScalarShape:()=>woe,isString:()=>df,isTypedArray:()=>Qr,isValidDtype:()=>nT,locToIndex:()=>koe,makeOnesTypedArray:()=>kg,makeZerosNestedTypedArray:()=>Noe,makeZerosTypedArray:()=>hf,nearestDivisor:()=>mf,nearestLargerEven:()=>yoe,now:()=>od,parseAxisParam:()=>vn,randUniform:()=>voe,repeatedTry:()=>Ioe,rightPad:()=>Hu,shuffle:()=>d$,shuffleCombo:()=>goe,sizeFromShape:()=>Rt,sizeToSquarishShape:()=>Soe,squeezeShape:()=>J1,sum:()=>xoe,tanh:()=>Coe,toNestedArray:()=>Wu,toTypedArray:()=>Wf});function $oe(t,n){return n==="string"?Hf(t):Wf([t],n)}function Loe(t,n){return t instanceof Float32Array&&n==="float32"||t instanceof Int32Array&&n==="int32"||t instanceof Uint8Array&&n==="bool"}function Wf(t,n){if(n==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=Vl(t)),H().getBool("DEBUG")&&tT(t,n),Loe(t,n))return t;if(n==null||n==="float32"||n==="complex64")return new Float32Array(t);if(n==="int32")return new Int32Array(t);if(n==="bool"){let e=new Uint8Array(t.length);for(let r=0;r<e.length;++r)Math.round(t[r])!==0&&(e[r]=1);return e}else throw new Error(`Unknown data type ${n}`)}function od(){return H().platform.now()}function Voe(t,n){return H().platform.fetch(t,n)}function Hf(t,n="utf-8"){return n=n||"utf-8",H().platform.encode(t,n)}function qf(t,n="utf-8"){return n=n||"utf-8",H().platform.decode(t,n)}var Sb=class{constructor(n,e){this.backendTimer=n,this.logger=e,e==null&&(this.logger=new dT)}profileKernel(n,e,r){let o,i=()=>{o=r()},s,a=od();if(this.backendTimer.timerAvailable())s=this.backendTimer.time(i);else{i();for(let c of o)c.dataSync();s=Promise.resolve({kernelMs:od()-a})}if(H().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let c=0;c<o.length;c++){let u=o[c];u.data().then(d=>{Boe(d,u.dtype,n)})}return{kernelName:n,outputs:o,inputs:e,timeMs:s.then(c=>c.kernelMs),extraInfo:s.then(c=>c.getExtraProfileInfo!=null?c.getExtraProfileInfo():"")}}logKernelProfile(n){let{kernelName:e,outputs:r,timeMs:o,inputs:i,extraInfo:s}=n;r.forEach(a=>{Promise.all([a.data(),o,s]).then(l=>{this.logger.logKernelProfile(e,a,l[0],l[1],i,l[2])})})}};function Boe(t,n,e){if(n!=="float32")return!1;for(let r=0;r<t.length;r++){let o=t[r];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${e}'`),!0}return!1}var dT=class{logKernelProfile(n,e,r,o,i,s){let a=typeof o=="number"?Hu(`${o}ms`,9):o.error,l=Hu(n,25),c=e.rank,u=e.size,d=Hu(e.shape.toString(),14),p="";for(let f in i){let m=i[f];if(m!=null){let h=m.shape||e.shape,g=h.length;p+=`${f}: ${g}D ${g>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${c}D ${d}	%c${u}	%c${p}	%c${s}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function C$(t,n,e){let r={},o={};for(let l=0;l<n.length;l++)r[n[l].id]=!0;for(let l=0;l<t.length;l++){let c=t[l],u=c.inputs;for(let d in u){let p=u[d],f=!1;for(let m=0;m<n.length;m++)if(r[p.id]){c.outputs.forEach(h=>r[h.id]=!0),f=!0,o[c.id]=!0;break}if(f)break}}let i={};i[e.id]=!0;let s={};for(let l=t.length-1;l>=0;l--){let c=t[l],u=c.inputs;for(let d=0;d<c.outputs.length;d++)if(i[c.outputs[d].id]){for(let p in u)i[u[p].id]=!0,s[c.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let c=t[l];if(o[c.id]&&s[c.id]){let u={};for(let p in c.inputs){let f=c.inputs[p];r[f.id]&&(u[p]=f)}let d=Object.assign({},c);d.inputs=u,d.outputs=c.outputs,a.push(d)}}return a}function S$(t,n,e,r){for(let o=n.length-1;o>=0;o--){let i=n[o],s=[];if(i.outputs.forEach(l=>{let c=t[l.id];c!=null?s.push(c):s.push(null)}),i.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${i.kernelName}.`);let a=i.gradient(s);for(let l in i.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let c=e(()=>a[l]());if(c.dtype!=="float32")throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${c.dtype}'`);let u=i.inputs[l];if(!Zi(c.shape,u.shape))throw new Error(`Error in gradient for op ${i.kernelName}. The gradient of input '${l}' has shape '${c.shape}', which does not match the shape of the input '${u.shape}'`);if(t[u.id]==null)t[u.id]=c;else{let d=t[u.id];t[u.id]=r(d,c),d.dispose()}}}}var _$=20,$g=3,pT=7;function I$(t,n,e,r){let o=Ji(n),i=zoe(t,n,e,o),s=n.length,a=_b(t,n,e,o,i),l=["Tensor"];return r&&(l.push(`  dtype: ${e}`),l.push(`  rank: ${s}`),l.push(`  shape: [${n}]`),l.push("  values:")),l.push(a.map(c=>"    "+c).join(`
`)),l.join(`
`)}function zoe(t,n,e,r){let o=Rt(n),i=r[r.length-1],s=new Array(i).fill(0),a=n.length,l=e==="complex64"?Vg(t):t;if(a>1)for(let c=0;c<o/i;c++){let u=c*i;for(let d=0;d<i;d++)s[d]=Math.max(s[d],Lg(l[u+d],0,e).length)}return s}function Lg(t,n,e){let r;return Array.isArray(t)?r=`${parseFloat(t[0].toFixed(pT))} + ${parseFloat(t[1].toFixed(pT))}j`:df(t)?r=`'${t}'`:e==="bool"?r=E$(t):r=parseFloat(t.toFixed(pT)).toString(),Hu(r,n)}function E$(t){return t===0?"false":"true"}function _b(t,n,e,r,o,i=!0){let s=e==="complex64"?2:1,a=n[0],l=n.length;if(l===0){if(e==="complex64"){let h=Vg(t);return[Lg(h[0],0,e)]}return e==="bool"?[E$(t[0])]:[t[0].toString()]}if(l===1){if(a>_$){let g=$g*s,y=Array.from(t.slice(0,g)),v=Array.from(t.slice((a-$g)*s,a*s));return e==="complex64"&&(y=Vg(y),v=Vg(v)),["["+y.map((S,C)=>Lg(S,o[C],e)).join(", ")+", ..., "+v.map((S,C)=>Lg(S,o[a-$g+C],e)).join(", ")+"]"]}return["["+(e==="complex64"?Vg(t):Array.from(t)).map((g,y)=>Lg(g,o[y],e)).join(", ")+"]"]}let c=n.slice(1),u=r.slice(1),d=r[0]*s,p=[];if(a>_$){for(let h=0;h<$g;h++){let g=h*d,y=g+d;p.push(..._b(t.slice(g,y),c,e,u,o,!1))}p.push("...");for(let h=a-$g;h<a;h++){let g=h*d,y=g+d;p.push(..._b(t.slice(g,y),c,e,u,o,h===a-1))}}else for(let h=0;h<a;h++){let g=h*d,y=g+d;p.push(..._b(t.slice(g,y),c,e,u,o,h===a-1))}let f=l===2?",":"";p[0]="["+p[0]+f;for(let h=1;h<p.length-1;h++)p[h]=" "+p[h]+f;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(i?"":m),p}function Vg(t){let n=[];for(let e=0;e<t.length;e+=2)n.push([t[e],t[e+1]]);return n}var Et=class{constructor(n,e,r){if(this.dtype=e,this.shape=n.slice(),this.size=Rt(n),r!=null){let o=r.length;M(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(e==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||eT(e,this.size),this.strides=Ji(n)}set(n,...e){e.length===0&&(e=[0]),M(e.length===this.rank,()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`);let r=this.locToIndex(e);this.values[r]=n}get(...n){n.length===0&&(n=[0]);let e=0;for(let o of n){if(o<0||o>=this.shape[e]){let i=`Requested out of range element at ${n}.   Buffer shape=${this.shape}`;throw new Error(i)}e++}let r=n[n.length-1];for(let o=0;o<n.length-1;++o)r+=this.strides[o]*n[o];return this.values[r]}locToIndex(n){if(this.rank===0)return 0;if(this.rank===1)return n[0];let e=n[n.length-1];for(let r=0;r<n.length-1;++r)e+=this.strides[r]*n[r];return e}indexToLoc(n){if(this.rank===0)return[];if(this.rank===1)return[n];let e=new Array(this.shape.length);for(let r=0;r<e.length-1;++r)e[r]=Math.floor(n/this.strides[r]),n-=e[r]*this.strides[r];return e[e.length-1]=n,e}get rank(){return this.shape.length}toTensor(){return rs().makeTensor(this.values,this.shape,this.dtype)}},rs=null,Kf=null,Uoe=null;function T$(t){rs=t}function D$(t){Kf=t}function N$(t){Uoe=t}var ct=class{constructor(n,e,r,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=n.slice(),this.dtype=e||"float32",this.size=Rt(n),this.strides=Ji(n),this.dataId=r,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let n=await this.data();return Kf.buffer(this.shape,this.dtype,n)}bufferSync(){return Kf.buffer(this.shape,this.dtype,this.dataSync())}async array(){let n=await this.data();return Wu(this.shape,n,this.dtype==="complex64")}arraySync(){return Wu(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let n=rs().read(this.dataId);if(this.dtype==="string"){let e=await n;try{return e.map(r=>qf(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return n}dataSync(){this.throwIfDisposed();let n=rs().readSync(this.dataId);if(this.dtype==="string")try{return n.map(e=>qf(e))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return n}async bytes(){this.throwIfDisposed();let n=await rs().read(this.dataId);return this.dtype==="string"?n:new Uint8Array(n.buffer)}dispose(){this.isDisposed||(rs().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(n=!1){return Kf.print(this,n)}clone(){return this.throwIfDisposed(),Kf.clone(this)}toString(n=!1){let e=this.dataSync();return I$(e,this.shape,this.dtype,n)}cast(n){return this.throwIfDisposed(),Kf.cast(this,n)}variable(n=!0,e,r){return this.throwIfDisposed(),rs().makeVariable(this,n,e,r)}};Object.defineProperty(ct,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function F(){return Mg("Tensor",()=>ct)}F();var Ba=class extends ct{constructor(n,e,r,o){super(n.shape,n.dtype,n.dataId,o),this.trainable=e,this.name=r}assign(n){if(n.dtype!==this.dtype)throw new Error(`dtype of the new value (${n.dtype}) and previous value (${this.dtype}) must match`);if(!Zi(n.shape,this.shape))throw new Error(`shape of the new value (${n.shape}) and previous value (${this.shape}) must match`);rs().disposeTensor(this),this.dataId=n.dataId,rs().incRef(this,null)}dispose(){rs().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(Ba,Symbol.hasInstance,{value:t=>t instanceof ct&&t.assign!=null&&t.assign instanceof Function});var k$=function(t){return t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64",t}(k$||{}),A$=function(t){return t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64",t}(A$||{}),R$=function(t){return t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64",t}(R$||{}),O$=function(t){return t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64",t}(O$||{}),joe={float32:R$,int32:k$,bool:A$,complex64:O$};function Cn(t,n){if(t==="string"||n==="string"){if(t==="string"&&n==="string")return"string";throw new Error(`Can not upcast ${t} with ${n}`)}return joe[t][n]}function id(t){return Cn(t,"int32")}function Xe(t,n){if(t.dtype===n.dtype)return[t,n];let e=Cn(t.dtype,n.dtype);return[t.cast(e),n.cast(e)]}function Ib(t){let n=[];return M$(t,n,new Set),n}function M$(t,n,e){if(t==null)return;if(t instanceof ct){n.push(t);return}if(!Goe(t))return;let r=t;for(let o in r){let i=r[o];e.has(i)||(e.add(i),M$(i,n,e))}}function Goe(t){return Array.isArray(t)||typeof t=="object"}function fT(t){return t.kernelName!=null}var Eb=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(n=>n.name)))}}}dispose(){for(let n in this.registeredVariables)this.registeredVariables[n].dispose()}},Hoe=(()=>{class t{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Eb}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r];if(await this.initializeBackend(o).success){await this.setBackend(o);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,o=1){return e in this.registryFactory?(console.warn(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:o},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:o}=this.initializeBackend(e);if(!(o?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new Sb(this.backendInstance),!0}setupRegisteredKernels(){uT(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){uT(e).forEach(o=>{o.disposeFunc!=null&&o.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let o=r.factory();if(o&&!(o instanceof qs)&&typeof o.then=="function"){let i=++this.pendingBackendInitId,s=o.then(a=>i<this.pendingBackendInitId?!1:(this.registry[e]=a,this.pendingBackendInit=null,!0)).catch(a=>(i<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${e} failed`),console.warn(a.stack||a.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=o,{success:!0,asyncInit:!1}}catch(o){return console.warn(`Initialization of backend ${e} failed`),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let o=e[r],{success:i,asyncInit:s}=this.initializeBackend(o);if(s||i)return{name:o,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let o=this.state.tensorInfo.get(r),i=o.backend,s=this.readSync(r),a=i.refCount(r);i.disposeData(r,!0),o.backend=e,e.move(r,s,o.shape,o.dtype,a),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let o=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=e}let i;return this.scopedRun(()=>this.startScope(o),()=>this.endScope(i),()=>(i=r(),i instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),i))}scopedRun(e,r,o){e();try{let i=o();return r(),i}catch(i){throw r(),i}}nextTensorId(){return t.nextTensorId++}nextVariableId(){return t.nextVariableId++}clone(e){let r=k.runKernel(ts,{x:e}),o={x:e},i=a=>({x:()=>{let l="float32",c={x:a},u={dtype:l};return k.runKernel(es,c,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,o,[r],i,s,{}),r}runKernel(e,r,o){if(!(lT(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:o})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,o){let i=this.backend.numDataIds(),s=0;o.forEach(c=>{s+=c.dtype==="complex64"?3:1});let a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],l=i-r-s-a;if(l>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${l} data ids) after running '${e}'`)}runKernelFunc(e){let r,o=[],i=this.isTapeOn(),s=this.state.numBytes,a=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let l;this.backendName==null&&this.backend;let c,u=fT(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(fT(e)){let{kernelName:h,inputs:g,attrs:y}=e;this.backendName==null&&this.backend;let v=lT(h,this.backendName);M(v!=null,()=>`Cannot find registered kernel '${h}' for backend '${this.backendName}'`),l=()=>{let S=this.backend.numDataIds();c=v.kernelFunc({inputs:g,attrs:y,backend:this.backend});let C=Array.isArray(c)?c:[c];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(h,S,C);let I=C.map(E=>{if(E.rank!=null)return E;let{dataId:D,shape:O,dtype:R}=E;return this.makeTensorFromDataId(D,O,R)});if(i){let E=this.getTensorsForGradient(h,g,I);o=this.saveTensorsForBackwardMode(E)}return I}}else{let{forwardFunc:h}=e,g=y=>{i&&(o=y.map(v=>this.keep(this.clone(v))))};l=()=>{let y=this.backend.numDataIds();c=this.tidy(()=>h(this.backend,g));let v=Array.isArray(c)?c:[c];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,y,v),v}}let{inputs:d,attrs:p}=e,f=fT(e)?null:e.backwardsFunc,m;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=l():(m=this.profiler.profileKernel(u,d,()=>l()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),r=m.outputs)}),i&&this.addTapeNode(u,d,r,f,o,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-a,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(h=>d[h]!=null?d[h].shape:null),outputShapes:r.map(h=>h.shape),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(c)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(o=>this.keep(this.clone(o)))}getTensorsForGradient(e,r,o){let i=cT(e);if(i!=null){let s=i.inputsToSave||[],a=i.outputsToSave||[],l;i.saveAllInputs?(M(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),l=Object.keys(r).map(u=>r[u])):l=s.map(u=>r[u]);let c=o.filter((u,d)=>a[d]);return l.concat(c)}return[]}makeTensor(e,r,o,i){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");o=o||"float32",i=i||this.backend;let s=e;o==="string"&&df(e[0])&&(s=e.map(c=>Hf(c)));let a=i.write(s,r,o),l=new ct(r,o,a,this.nextTensorId());if(this.trackTensor(l,i),o==="string"){let c=this.state.tensorInfo.get(a),u=rT(s);this.state.numBytes+=u-c.bytes,c.bytes=u}return l}makeTensorFromDataId(e,r,o,i){o=o||"float32";let s=new ct(r,o,e,this.nextTensorId());return this.trackTensor(s,i),s}makeVariable(e,r=!0,o,i){o=o||this.nextVariableId().toString(),i!=null&&i!==e.dtype&&(e=e.cast(i));let s=new Ba(e,r,o,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let o=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(o=e.size*tb(e.dtype)),this.state.numBytes+=o,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:o})),e instanceof Ba||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let o=e.size*tb(e.dtype);this.state.numBytes-=o}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,o=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(i=>i.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-o;for(let i of this.state.activeProfile.kernels)i.kernelTimeMs=await i.kernelTimeMs,i.extraInfo=await i.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,o,i,s,a){let l={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:o,saved:s},c=cT(e);c!=null&&(i=c.gradFunc),i!=null&&(l.gradient=u=>(u=u.map((d,p)=>{if(d==null){let f=o[p],m=hf(f.size,f.dtype);return this.makeTensor(m,f.shape,f.dtype)}return d}),i(u.length>1?u:u[0],s,a))),this.state.activeTape.push(l)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=Ib(e),o=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let a=this.state.activeScope.track[s];!a.kept&&!o.has(a.id)&&a.dispose()}let i=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===i.id&&this.track(s)})}gradients(e,r,o,i=!1){if(M(r.length>0,()=>"gradients() received an empty list of xs."),o!=null&&o.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${o.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));M(s instanceof ct,()=>"The result y returned by f() must be a tensor.");let a=C$(this.state.activeTape,r,s);if(!i&&a.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let l={};l[s.id]=o??qoe(s.shape),S$(l,a,u=>this.tidy(u),Koe);let c=r.map(u=>l[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let d of u.saved)d.dispose()}),this.state.activeTape=null),{value:s,grads:c}})}customGrad(e){return M(ff(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{M(r.every(l=>l instanceof ct),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let o,i={};r.forEach((l,c)=>{i[c]=l});let s=(l,c)=>(o=e(...r,c),M(o.value instanceof ct,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),M(ff(o.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),o.value),a=(l,c)=>{let u=o.gradFunc(l,c),d=Array.isArray(u)?u:[u];M(d.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),M(d.every(f=>f instanceof ct),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return d.forEach((f,m)=>{p[m]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:a,inputs:i})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}async time(e){let r=od(),o=await this.backend.time(e);return o.wallMs=od()-r,o}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Eb;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}return t.nextTensorId=0,t.nextVariableId=0,t})();function qoe(t){let n=kg(Rt(t),"float32");return k.makeTensor(n,t,"float32")}function mT(){let t=sT();if(t._tfengine==null){let n=new Og(t);t._tfengine=new Hoe(n)}return g$(t._tfengine.ENV),T$(()=>t._tfengine),t._tfengine}var k=mT();function Koe(t,n){let e={a:t,b:n};return k.runKernel(vi,e)}var Rc={};Fi(Rc,{isBrowser:()=>hT,isMobile:()=>Yoe});function Xoe(){return typeof navigator<"u"&&navigator!=null}function Yoe(t){if(t||Xoe()){if(t||(t=navigator),t.product==="ReactNative")return!0;let n=t.userAgent||t.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(n)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(n.substr(0,4))}return!1}function hT(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var bi=H();bi.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});bi.registerFlag("IS_BROWSER",()=>hT());bi.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");bi.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));bi.registerFlag("PROD",()=>!1);bi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>bi.getBool("DEBUG"));bi.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);bi.registerFlag("IS_TEST",()=>!1);bi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);bi.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);function sd(t,n){let e=t;if(Qr(t))return n==="string"?[]:[t.length];if(!Array.isArray(t))return[];let r=[];for(;Array.isArray(e)||Qr(e)&&n!=="string";)r.push(e.length),e=e[0];return Array.isArray(t)&&H().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&P$(t,r,[]),r}function P$(t,n,e){if(e=e||[],!Array.isArray(t)&&!Qr(t)){M(n.length===0,()=>`Element arr[${e.join("][")}] is a primitive, but should be an array/TypedArray of ${n[0]} elements`);return}M(n.length>0,()=>`Element arr[${e.join("][")}] should be a primitive, but is an array of ${t.length} elements`),M(t.length===n[0],()=>`Element arr[${e.join("][")}] should have ${n[0]} elements, but has ${t.length} elements`);let r=n.slice(1);for(let o=0;o<t.length;++o)P$(t[o],r,e.concat(o))}function F$(t,n,e,r){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==n||t==="numeric"&&n==="string")throw new Error(`Argument '${e}' passed to '${r}' must be ${t} tensor, but got ${n} tensor`)}}function N(t,n,e,r="numeric"){if(t instanceof ct)return F$(r,t.dtype,n,e),t;let o=pf(t);if(o!=="string"&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),F$(r,o,n,e),t==null||!Qr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${n}' passed to '${e}' must be a Tensor or TensorLike, but got '${l}'`)}let i=sd(t,o);!Qr(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?Wf(t,o):Vl(t,[],!0);return k.makeTensor(a,i,o)}function Tb(t,n,e,r="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${n} passed to ${e} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((i,s)=>N(i,`${n}[${s}]`,e,r))}var Qoe="__op";function A(t){let n=Object.keys(t);if(n.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${n.length} keys.`);let e=n[0],r=t[e];e.endsWith("_")&&(e=e.substring(0,e.length-1)),e=e+Qoe;let o=(...i)=>{k.startScope(e);try{let s=r(...i);return Rg(s)&&console.error("Cannot return a Promise inside of tidy."),k.endScope(s),s}catch(s){throw k.endScope(null),s}};return Object.defineProperty(o,"name",{value:e,configurable:!0}),o}function Zoe(t,n){let e=N(t,"real","complex"),r=N(n,"imag","complex");eb(e.shape,r.shape,`real and imag shapes, ${e.shape} and ${r.shape}, must match in call to tf.complex().`);let o={real:e,imag:r};return k.runKernel(wf,o)}var wi=A({complex_:Zoe});function Oc(t,n,e,r){if(r==null&&(r=pf(t)),r==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!Qr(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(n!=null){Ag(n);let o=Rt(n),i=Rt(e);M(o===i,()=>`Based on the provided shape, [${n}], the tensor should have ${o} values but has ${i}`);for(let s=0;s<e.length;++s){let a=e[s],l=s===e.length-1?a!==Rt(n.slice(s)):!0;M(e[s]===n[s]||!l,()=>`Error creating a new Tensor. Inferred shape (${e}) does not match the provided shape (${n}). `)}}return!Qr(t)&&!Array.isArray(t)&&(t=[t]),n=n||e,t=r!=="string"?Wf(t,r):Vl(t,[],!0),k.makeTensor(t,n,r)}function Mc(t,n,e){let r=sd(t,e);return Oc(t,n,r,e)}var Bg={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var Db=4;async function L$(t,n){let e=[],r=[],o=Array.isArray(t)?t.map(s=>s.name):Object.keys(t);for(let s=0;s<o.length;++s){let a=o[s],l=Array.isArray(t)?t[s].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let c={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let u=new Promise(async d=>{let p=await l.bytes(),f=p.reduce((g,y)=>g+y.length,0)+Db*p.length,m=new Uint8Array(f),h=0;for(let g=0;g<p.length;g++){let y=p[g],v=new Uint8Array(new Uint32Array([y.length]).buffer);m.set(v,h),h+=Db,m.set(y,h),h+=y.length}d(m)});r.push(u)}else r.push(l.data());n!=null&&(c.group=n),e.push(c)}let i=await Promise.all(r);return{data:Joe(i),specs:e}}function Nb(t,n){let e={},r,o=0;for(let i of n){let s=i.name,a=i.dtype,l=i.shape,c=Rt(l),u;if("quantization"in i){let d=i.quantization;if(d.dtype==="uint8"||d.dtype==="uint16"){if(!("min"in d&&"scale"in d))throw new Error(`Weight ${i.name} with quantization ${d.dtype} doesn't have corresponding metadata min and scale.`)}else if(d.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${i.name} is quantized with ${d.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${i.name} has unknown quantization dtype ${d.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let p=Bg[d.dtype],f=t.slice(o,o+c*p),m=d.dtype==="uint8"?new Uint8Array(f):new Uint16Array(f);if(a==="float32")if(d.dtype==="uint8"||d.dtype==="uint16"){u=new Float32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=g*d.scale+d.min}}else if(d.dtype==="float16")r===void 0&&(r=rie()),u=r(m);else throw new Error(`Unsupported quantization type ${d.dtype} for weight type float32.`);else if(a==="int32"){if(d.dtype!=="uint8"&&d.dtype!=="uint16")throw new Error(`Unsupported quantization type ${d.dtype} for weight type int32.`);u=new Int32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];u[h]=Math.round(g*d.scale+d.min)}}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*p}else if(a==="string"){let d=Rt(i.shape);u=[];for(let p=0;p<d;p++){let f=new Uint32Array(t.slice(o,o+Db))[0];o+=Db;let m=new Uint8Array(t.slice(o,o+f));u.push(m),o+=f}}else{let d=Bg[a],p=t.slice(o,o+c*d);if(a==="float32")u=new Float32Array(p);else if(a==="int32")u=new Int32Array(p);else if(a==="bool")u=new Uint8Array(p);else if(a==="complex64"){u=new Float32Array(p);let f=new Float32Array(u.length/2),m=new Float32Array(u.length/2);for(let y=0;y<f.length;y++)f[y]=u[y*2],m[y]=u[y*2+1];let h=Mc(f,l,"float32"),g=Mc(m,l,"float32");e[s]=wi(h,g),h.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${s}': ${a}`);o+=c*d}a!=="complex64"&&(e[s]=Mc(u,l,a))}return e}function Joe(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let n=0,e=[];t.forEach(i=>{if(n+=i.byteLength,e.push(i.byteLength===i.buffer.byteLength?i:new i.constructor(i)),!(i instanceof Float32Array||i instanceof Int32Array||i instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${i.constructor.name}`)});let r=new Uint8Array(n),o=0;return e.forEach(i=>{r.set(new Uint8Array(i.buffer),o),o+=i.byteLength}),r.buffer}var gT=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function $$(t){return gT?Buffer.byteLength(t):new Blob([t]).size}function V$(t){if(gT)return Buffer.from(t).toString("base64");let n=new Uint8Array(t),e="";for(let r=0,o=n.length;r<o;r++)e+=String.fromCharCode(n[r]);return btoa(e)}function B$(t){if(gT){let r=Buffer.from(t,"base64");return r.buffer.slice(r.byteOffset,r.byteOffset+r.byteLength)}let n=atob(t),e=new Uint8Array(n.length);for(let r=0;r<n.length;++r)e.set([n.charCodeAt(r)],r);return e.buffer}function Xf(t){if(t.length===1)return t[0];let n=0;t.forEach(o=>{n+=o.byteLength});let e=new Uint8Array(n),r=0;return t.forEach(o=>{e.set(new Uint8Array(o),r),r+=o.byteLength}),e.buffer}function yT(t){let n="/";for(t=t.trim();t.endsWith(n);)t=t.slice(0,t.length-1);let e=t.split(n);return e[e.length-1]}function os(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:$$(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:$$(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function eie(){let t=e=>{let r=e<<13,o=0;for(;!(r&8388608);)o-=8388608,r<<=1;return r&=-8388609,o+=947912704,r|o},n=new Uint32Array(2048);n[0]=0;for(let e=1;e<1024;e++)n[e]=t(e);for(let e=1024;e<2048;e++)n[e]=939524096+(e-1024<<13);return n}function tie(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let n=1;n<31;n++)t[n]=n<<23;for(let n=33;n<63;n++)t[n]=2147483648+(n-32<<23);return t}function nie(){let t=new Uint32Array(64);for(let n=0;n<64;n++)t[n]=1024;return t[0]=t[32]=0,t}function rie(){let t=eie(),n=tie(),e=nie();return r=>{let o=new ArrayBuffer(4*r.length),i=new Uint32Array(o);for(let s=0;s<r.length;s++){let a=r[s],l=t[e[a>>10]+(a&1023)]+n[a>>10];i[s]=l}return new Float32Array(o)}}var kn=class t{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerSaveRouter(n){t.getInstance().saveRouters.push(n)}static registerLoadRouter(n){t.getInstance().loadRouters.push(n)}static getSaveHandlers(n){return t.getHandlers(n,"save")}static getLoadHandlers(n,e){return t.getHandlers(n,"load",e)}static getHandlers(n,e,r){let o=[];return(e==="load"?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach(s=>{let a=s(n,r);a!==null&&o.push(a)}),o}},z$=t=>kn.registerSaveRouter(t),U$=t=>kn.registerLoadRouter(t),j$=t=>kn.getSaveHandlers(t),G$=(t,n)=>kn.getLoadHandlers(t,n);var xT="tensorflowjs",vT=1,ad="models_store",Fc="model_info_store";function W$(){if(!H().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,n=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(n==null)throw new Error("The current browser does not appear to support IndexedDB.");return n}function bT(t){let n=t.result;n.createObjectStore(ad,{keyPath:"modelPath"}),n.createObjectStore(Fc,{keyPath:"modelPath"})}var ld=(()=>{class t{constructor(e){if(this.indexedDB=W$(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((o,i)=>{let s=this.indexedDB.open(xT,vT);s.onupgradeneeded=()=>bT(s),s.onsuccess=()=>{let a=s.result;if(r==null){let l=a.transaction(ad,"readonly"),u=l.objectStore(ad).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return a.close(),i(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));o(u.result.modelArtifacts)},u.onerror=d=>(a.close(),i(u.error)),l.oncomplete=()=>a.close()}else{let l=os(r),c=a.transaction(Fc,"readwrite"),u=c.objectStore(Fc),d=u.put({modelPath:this.modelPath,modelArtifactsInfo:l}),p;d.onsuccess=()=>{p=a.transaction(ad,"readwrite");let m=p.objectStore(ad).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:l});m.onsuccess=()=>o({modelArtifactsInfo:l}),m.onerror=h=>{u=c.objectStore(Fc);let g=u.delete(this.modelPath);g.onsuccess=()=>(a.close(),i(m.error)),g.onerror=y=>(a.close(),i(m.error))}},d.onerror=f=>(a.close(),i(d.error)),c.oncomplete=()=>{p==null?a.close():p.oncomplete=()=>a.close()}}},s.onerror=a=>i(s.error)})}}return t.URL_SCHEME="indexeddb://",t})(),H$=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ld.URL_SCHEME)?oie(t.slice(ld.URL_SCHEME.length)):null;kn.registerSaveRouter(H$);kn.registerLoadRouter(H$);function oie(t){return new ld(t)}function iie(t){return t.startsWith(ld.URL_SCHEME)?t.slice(ld.URL_SCHEME.length):t}var kb=class{constructor(){this.indexedDB=W$()}async listModels(){return new Promise((n,e)=>{let r=this.indexedDB.open(xT,vT);r.onupgradeneeded=()=>bT(r),r.onsuccess=()=>{let o=r.result,i=o.transaction(Fc,"readonly"),a=i.objectStore(Fc).getAll();a.onsuccess=()=>{let l={};for(let c of a.result)l[c.modelPath]=c.modelArtifactsInfo;n(l)},a.onerror=l=>(o.close(),e(a.error)),i.oncomplete=()=>o.close()},r.onerror=o=>e(r.error)})}async removeModel(n){return n=iie(n),new Promise((e,r)=>{let o=this.indexedDB.open(xT,vT);o.onupgradeneeded=()=>bT(o),o.onsuccess=()=>{let i=o.result,s=i.transaction(Fc,"readwrite"),a=s.objectStore(Fc),l=a.get(n),c;l.onsuccess=()=>{if(l.result==null)return i.close(),r(new Error(`Cannot find model with path '${n}' in IndexedDB.`));{let u=a.delete(n),d=()=>{c=i.transaction(ad,"readwrite");let f=c.objectStore(ad).delete(n);f.onsuccess=()=>e(l.result.modelArtifactsInfo),f.onerror=m=>r(l.error)};u.onsuccess=d,u.onerror=p=>(d(),i.close(),r(l.error))}},l.onerror=u=>(i.close(),r(l.error)),s.oncomplete=()=>{c==null?i.close():c.oncomplete=()=>i.close()}},o.onerror=i=>r(o.error)})}};var za="/",Yf="tensorflowjs_models",q$="info",sie="model_topology",aie="weight_specs",lie="weight_data",cie="model_metadata";function K$(t){return{info:[Yf,t,q$].join(za),topology:[Yf,t,sie].join(za),weightSpecs:[Yf,t,aie].join(za),weightData:[Yf,t,lie].join(za),modelMetadata:[Yf,t,cie].join(za)}}function uie(t){let n=t.split(za);if(n.length<3)throw new Error(`Invalid key format: ${t}`);return n.slice(1,n.length-1).join(za)}function die(t){return t.startsWith(cd.URL_SCHEME)?t.slice(cd.URL_SCHEME.length):t}var cd=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=K$(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),o=JSON.stringify(e.weightSpecs),i=os(e);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,o),this.LS.setItem(this.keys.weightData,V$(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy};return e.signature!=null&&(s.signature=e.signature),e.userDefinedMetadata!=null&&(s.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(s.modelInitializer=e.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:i}}catch{throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},o=JSON.parse(this.LS.getItem(this.keys.topology));if(o==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=o;let i=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(i==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=i;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let l=JSON.parse(s);r.format=l.format,r.generatedBy=l.generatedBy,r.convertedBy=l.convertedBy,l.signature!=null&&(r.signature=l.signature),l.userDefinedMetadata!=null&&(r.userDefinedMetadata=l.userDefinedMetadata),l.modelInitializer!=null&&(r.modelInitializer=l.modelInitializer)}let a=this.LS.getItem(this.keys.weightData);if(a==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=B$(a),r}}return t.URL_SCHEME="localstorage://",t})(),X$=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(cd.URL_SCHEME)?pie(t.slice(cd.URL_SCHEME.length)):null;kn.registerSaveRouter(X$);kn.registerLoadRouter(X$);function pie(t){return new cd(t)}var Ab=class{constructor(){M(H().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),M(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let n={},e=Yf+za,r=za+q$;for(let o=0;o<this.LS.length;++o){let i=this.LS.key(o);if(i.startsWith(e)&&i.endsWith(r)){let s=uie(i);n[s]=JSON.parse(this.LS.getItem(i))}}return n}async removeModel(n){n=die(n);let e=K$(n);if(this.LS.getItem(e.info)==null)throw new Error(`Cannot find model at path '${n}'`);let r=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),r}};var Qf="://",Ci=class t{constructor(){this.managers={}}static getInstance(){return t.instance==null&&(t.instance=new t),t.instance}static registerManager(n,e){M(n!=null,()=>"scheme must not be undefined or null."),n.endsWith(Qf)&&(n=n.slice(0,n.indexOf(Qf))),M(n.length>0,()=>"scheme must not be an empty string.");let r=t.getInstance();M(r.managers[n]==null,()=>`A model store manager is already registered for scheme '${n}'.`),r.managers[n]=e}static getManager(n){let e=this.getInstance().managers[n];if(e==null)throw new Error(`Cannot find model manager for scheme '${n}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}};function Rb(t){if(t.indexOf(Qf)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${Ci.getSchemes().join(",")}`);return{scheme:t.split(Qf)[0],path:t.split(Qf)[1]}}async function Y$(t,n,e=!1){M(t!==n,()=>`Old path and new path are the same: '${t}'`);let r=kn.getLoadHandlers(t);M(r.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),M(r.length<2,()=>`Copying failed because more than one (${r.length}) load handlers for source URL ${t}.`);let o=r[0],i=kn.getSaveHandlers(n);M(i.length>0,()=>`Copying failed because no save handler is found for destination URL ${n}.`),M(i.length<2,()=>`Copying failed because more than one (${r.length}) save handlers for destination URL ${n}.`);let s=i[0],a=Rb(t).scheme,l=Rb(t).path,c=a===Rb(t).scheme,u=await o.load();e&&c&&await Ci.getManager(a).removeModel(l);let d=await s.save(u);return e&&!c&&await Ci.getManager(a).removeModel(l),d.modelArtifactsInfo}async function Q$(){let t=Ci.getSchemes(),n={};for(let e of t){let r=await Ci.getManager(e).listModels();for(let o in r){let i=e+Qf+o;n[i]=r[o]}}return n}async function Z$(t){let n=Rb(t);return Ci.getManager(n.scheme).removeModel(n.path)}async function J$(t,n){return Y$(t,n,!1)}async function eL(t,n){return Y$(t,n,!0)}var wT=class{fetch(n,e){return fetch(n,e)}now(){return performance.now()}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(n)}decode(n,e){return new TextDecoder(e).decode(n)}};if(H().get("IS_BROWSER")){H().setPlatform("browser",new wT);try{Ci.registerManager(cd.URL_SCHEME,new Ab)}catch{}try{Ci.registerManager(ld.URL_SCHEME,new kb)}catch{}}var mie={importFetch:()=>nL()},CT;var ST=class{constructor(){this.util=rL(),this.textEncoder=new this.util.TextEncoder}fetch(n,e){return H().global.fetch!=null?H().global.fetch(n,e):(CT==null&&(CT=mie.importFetch()),CT(n,e))}now(){let n=process.hrtime();return n[0]*1e3+n[1]/1e6}encode(n,e){if(e!=="utf-8"&&e!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(n)}decode(n,e){return n.length===0?"":new this.util.TextDecoder(e).decode(n)}};H().get("IS_NODE")&&H().setPlatform("node",new ST);function Ie(t,n="float32",e){return n=n||"float32",Ag(t),new Et(t,n,e)}function hie(t,n){let e=N(t,"x","cast");if(!nT(n))throw new Error(`Failed to cast to unknown dtype ${n}`);if(n==="string"&&e.dtype!=="string"||n!=="string"&&e.dtype==="string")throw new Error("Only strings can be casted to strings");let r={x:e},o={dtype:n};return k.runKernel(es,r,o)}var le=A({cast_:hie});function gie(t){let e={x:N(t,"x","clone","string_or_numeric")};return k.runKernel(ts,e)}var Si=A({clone_:gie});function oL(t,n=!1){console.log(t.toString(n))}mT();var yie={buffer:Ie,cast:le,clone:Si,print:oL};D$(yie);var zo={};Fi(zo,{browserFiles:()=>sL,browserHTTPRequest:()=>uL,concatenateArrayBuffers:()=>Xf,copyModel:()=>J$,decodeWeights:()=>Nb,encodeWeights:()=>L$,fromMemory:()=>dL,getLoadHandlers:()=>G$,getModelArtifactsInfoForJSON:()=>os,getSaveHandlers:()=>j$,http:()=>Mb,isHTTPScheme:()=>Ob,listModels:()=>Q$,loadWeights:()=>aL,moveModel:()=>eL,registerLoadRouter:()=>U$,registerSaveRouter:()=>z$,removeModel:()=>Z$,weightsLoaderFactory:()=>DT,withSaveHandler:()=>pL});var xie="model",vie=".json",bie=".weights.bin";function iL(t){return new Promise(n=>setTimeout(n)).then(t)}var _T=(()=>{class t{constructor(e){if(!H().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),(e==null||e.length===0)&&(e=xie),this.modelTopologyFileName=e+vie,this.weightDataFileName=e+bie}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let o=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer);let s=window.URL.createObjectURL(new Blob([JSON.stringify(i)],{type:"application/json"})),a=this.jsonAnchor==null?document.createElement("a"):this.jsonAnchor;if(a.download=this.modelTopologyFileName,a.href=s,await iL(()=>a.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let l=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;l.download=this.weightDataFileName,l.href=r,await iL(()=>l.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:os(e)}}}}return t.URL_SCHEME="downloads://",t})(),IT=class{constructor(n){if(n==null||n.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${n}`);this.files=n}async load(){let n=this.files[0],e=this.files.slice(1);return new Promise((r,o)=>{let i=new FileReader;i.onload=s=>{let a=JSON.parse(s.target.result),l=a.modelTopology;if(l==null){o(new Error(`modelTopology field is missing from file ${n.name}`));return}e.length===0&&r({modelTopology:l});let c=a.weightsManifest;if(c==null){o(new Error(`weightManifest field is missing from file ${n.name}`));return}let u;try{u=this.checkManifestAndWeightFiles(c,e)}catch(m){o(m);return}let d=[],p=[],f=[];c.forEach(m=>{m.paths.forEach(h=>{p.push(h),f.push(null)}),d.push(...m.weights)}),c.forEach(m=>{m.paths.forEach(h=>{let g=new FileReader;g.onload=y=>{let v=y.target.result,S=p.indexOf(h);if(f[S]=v,f.indexOf(null)===-1){let C={modelTopology:l,weightSpecs:d,weightData:Xf(f),format:a.format,generatedBy:a.generatedBy,convertedBy:a.convertedBy};a.signature!=null&&(C.signature=a.signature),a.userDefinedMetadata!=null&&(C.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(C.modelInitializer=a.modelInitializer),r(C)}},g.onerror=y=>o(`Failed to weights data from file of path '${h}'.`),g.readAsArrayBuffer(u[h])})})},i.onerror=s=>o(`Failed to read model topology and weights manifest JSON from file '${n.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),i.readAsText(n)})}checkManifestAndWeightFiles(n,e){let r=[],o=e.map(s=>yT(s.name)),i={};for(let s of n)s.paths.forEach(a=>{let l=yT(a);if(r.indexOf(l)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${l}'`);if(r.push(l),o.indexOf(l)===-1)throw new Error(`Weight file with basename '${l}' is not provided.`);i[a]=e[o.indexOf(l)]});if(r.length!==e.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${e.length}).`);return i}},wie=t=>H().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(_T.URL_SCHEME)?Cie(t.slice(_T.URL_SCHEME.length)):null;kn.registerSaveRouter(wie);function Cie(t="model"){return new _T(t)}function sL(t){return new IT(t)}function ET(t,n,e,r){s(t),e=e??0,r=r??1,a(e,r);let o=0,i=l=>(l.then(c=>{let u=e+ ++o/t.length*(r-e);return n(u),c}),l);function s(l){M(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,c){M(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),M(c>=0&&c<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${c}`),M(c>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${c}`)}return Promise.all(t.map(i))}async function TT(t,n){n==null&&(n={});let e=n.fetchFunc==null?H().platform.fetch:n.fetchFunc,r=t.map(d=>e(d,n.requestInit,{isBinary:!0})),a=(n.onProgress==null?await Promise.all(r):await ET(r,n.onProgress,0,.5)).map(d=>d.arrayBuffer());return n.onProgress==null?await Promise.all(a):await ET(a,n.onProgress,.5,1)}async function aL(t,n="",e,r){return DT(s=>TT(s,{requestInit:r}))(t,n,e)}function DT(t){return async(n,e="",r)=>{let o=n.map(()=>!1),i={},s=r!=null?r.map(()=>!1):[],a=[];if(n.forEach((f,m)=>{let h=0;f.weights.forEach(g=>{let y="quantization"in g?g.quantization.dtype:g.dtype,v=Bg[y]*Rt(g.shape),S=()=>{o[m]=!0,i[m]==null&&(i[m]=[]),i[m].push({manifestEntry:g,groupOffset:h,sizeBytes:v})};r!=null?r.forEach((C,I)=>{C===g.name&&(S(),s[I]=!0)}):S(),a.push(g.name),h+=v})}),!s.every(f=>f)){let f=r.filter((m,h)=>!s[h]);throw new Error(`Could not find weights in manifest with names: ${f.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((f,m,h)=>(m&&f.push(h),f),[]),c=[];l.forEach(f=>{n[f].paths.forEach(m=>{let h=e+(e.endsWith("/")?"":"/")+m;c.push(h)})});let u=await t(c),d={},p=0;return l.forEach(f=>{let m=n[f].paths.length,h=0;for(let C=0;C<m;C++)h+=u[p+C].byteLength;let g=new ArrayBuffer(h),y=new Uint8Array(g),v=0;for(let C=0;C<m;C++){let I=new Uint8Array(u[p+C]);y.set(I,v),v+=I.byteLength}i[f].forEach(C=>{let I=g.slice(C.groupOffset,C.groupOffset+C.sizeBytes),E=Nb(I,[C.manifestEntry]);for(let D in E)d[D]=E[D]}),p+=m}),d}}var Sie="application/octet-stream",_ie="application/json",lL=(()=>{class t{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(M(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=H().platform.fetch,M(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&M(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let o=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],i={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:o};e.signature!=null&&(i.signature=e.signature),e.userDefinedMetadata!=null&&(i.userDefinedMetadata=e.userDefinedMetadata),e.modelInitializer!=null&&(i.modelInitializer=e.modelInitializer),r.body.append("model.json",new Blob([JSON.stringify(i)],{type:_ie}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:Sie}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:os(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let g=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?g+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":g+=" Please make sure the server is serving valid JSON for this request.",new Error(g)}let o=r.modelTopology,i=r.weightsManifest,s=r.generatedBy,a=r.convertedBy,l=r.format,c=r.signature,u=r.userDefinedMetadata;if(o==null&&i==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let d,p;i!=null&&([d,p]=await this.loadWeights(i));let f={modelTopology:o,weightSpecs:d,weightData:p,generatedBy:s,convertedBy:a,format:l};c!=null&&(f.signature=c),u!=null&&(f.userDefinedMetadata=u);let m=r.modelInitializer;return m&&(f.modelInitializer=m),f}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[o,i]=Iie(r),s=this.weightPathPrefix||o,a=[];for(let d of e)a.push(...d.weights);let l=[],c=[];for(let d of e)for(let p of d.paths)this.weightUrlConverter!=null?c.push(this.weightUrlConverter(p)):l.push(s+p+i);this.weightUrlConverter&&l.push(...await Promise.all(c));let u=await TT(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[a,Xf(u)]}}return t.URL_SCHEME_REGEX=/^https?:\/\//,t})();function Iie(t){let n=t.lastIndexOf("/"),e=t.lastIndexOf("?"),r=t.substring(0,n),o=e>n?t.substring(e):"";return[r+"/",o]}function Ob(t){return t.match(lL.URL_SCHEME_REGEX)!=null}var cL=(t,n)=>{if(typeof fetch>"u"&&(n==null||n.fetchFunc==null))return null;{let e=!0;if(Array.isArray(t)?e=t.every(r=>Ob(r)):e=Ob(t),e)return Mb(t,n)}return null};kn.registerSaveRouter(cL);kn.registerLoadRouter(cL);function Mb(t,n){return new lL(t,n)}function uL(t,n){return Mb(t,n)}var zg=class{constructor(n){this.modelArtifacts=n}async load(){return this.modelArtifacts}},NT=class{constructor(n){this.saveHandler=n}async save(n){return this.saveHandler(n)}};function dL(t,n,e,r){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new zg(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zg({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new zg({modelTopology:t,weightSpecs:n,weightData:e,trainingConfig:r}))}function pL(t){return new NT(t)}function Eie(t,n,e=!1,r=!1){let o=N(t,"a","matMul"),i=N(n,"b","matMul");[o,i]=Xe(o,i);let s={a:o,b:i},a={transposeA:e,transposeB:r};return k.runKernel(Wl,s,a)}var gt=A({matMul_:Eie});function Tie(t,n,e=1,r=0){if(n<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${n}`);let i={indices:N(t,"indices","oneHot","int32")},s={depth:n,onValue:e,offValue:r};return k.runKernel(mc,i,s)}var Jf=A({oneHot_:Tie});function Die(t,n){let e=N(t,"x","transpose");if(n==null&&(n=e.shape.map((i,s)=>s).reverse()),M(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of perm ${n}.`),n.forEach(i=>{M(i>=0&&i<e.rank,()=>`All entries in 'perm' must be between 0 and ${e.rank-1} but got ${n}`)}),e.rank<=1)return e.clone();let r={x:e},o={perm:n};return k.runKernel(Dc,r,o)}var ot=A({transpose_:Die});function Nie(t,n){let e=t.shape.length,r=n.shape.length;if(e<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${e}.`);if(r<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${r}.`);if(n.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${n.dtype}.`);if(n.shape[r-1]>e)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${n.shape[r-1]} vs. ${e}`);if(Rt(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=n.shape,i=o[o.length-1],s=1;for(let d=0;d<o.length-1;++d)s*=o[d];let a=t.shape,l=o.slice();l.pop();let c=1;for(let d=i;d<e;++d)c*=a[d],l.push(a[d]);let u=[...Ji(t.shape).map(d=>d/c),1].slice(0,i);return[l,s,c,u]}function fL(t,n,e){let r=n.rank>1?n.shape[n.rank-1]:1,o=n.rank>1?n.rank-1:1,i=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${e.shape}, indices.shape: ${n.shape}, shape: ${t}, sliceDim: ${r}, and batchDim: ${o}.`;if(e.rank<o)throw new Error(i+` update.rank < ${o}. `);if(t.length<r+(e.rank-o))throw new Error(i+` Output shape length < ${r+(e.rank-o)}`);if(e.rank!==o+t.length-r)throw new Error(i+` update.rank != ${o+t.length-r}`);for(let s=0;s<o;++s)if(e.shape[s]!==n.shape[s])throw new Error(i+` updates.shape[${s}] (${e.shape[s]}) != indices.shape[${s}] (${n.shape[s]}).`);for(let s=0;s<e.rank-o;++s)if(e.shape[s+o]!==t[s+r])throw new Error(i+` updates.shape[${s+o}] (${e.shape[s+o]}) != shape[${s+o}] (${t[s+o]})`)}function kie(t,n,e){if(n.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${n.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(n.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${n.dtype}`);if(e.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${e}`);if(e.length===0){if(n.size===0)throw new Error(`Indices specified for empty output. indices shape: ${n.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}fL(e,n,t)}function Aie(t,n,e){let r=n.shape.length,o=r>1?n.shape[r-1]:1,i=e.length,s=1;for(let d=o;d<i;++d)s*=e[d];let a=o<1?1:o,l=Rt(n.shape)/a,c=[...Ji(e.slice(0,o)),1],u=Rt(e);return{sliceRank:o,numUpdates:l,sliceSize:s,strides:c,outputSize:u}}var qn={};Fi(qn,{assertParamsValid:()=>Rie,computeFlatOffset:()=>Mie,computeOutShape:()=>mL,getNormalizedAxes:()=>xL,isSliceContinous:()=>Oie,maskToAxes:()=>Fb,parseSliceParams:()=>kT,sliceInfo:()=>Fie,startForAxis:()=>CL,startIndicesWithElidedDims:()=>vL,stopForAxis:()=>SL,stopIndicesWithElidedDims:()=>bL,stridesForAxis:()=>wL,stridesWithElidedDims:()=>hL});function Rie(t,n,e){let r=t.shape.length;M(r===n.length,()=>`Error in slice${r}D: Length of begin ${n} must match the rank of the array (${r}).`),M(r===e.length,()=>`Error in slice${r}D: Length of size ${e} must match the rank of the array (${r}).`);for(let o=0;o<r;++o)M(n[o]+e[o]<=t.shape[o],()=>`Error in slice${r}D: begin[${o}] + size[${o}] (${n[o]+e[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function Fb(t){let n=[],e=0;for(;t>0;)t&1&&n.push(e),t/=2,e++;return n}function mL(t,n,e){let r=[];for(let o=0;o<t.length;o++)r[o]=Math.ceil((n[o]-t[o])/e[o]);return r}function hL(t,n,e,r){let o=[...t];for(let i=o.length;i<r.length;i++)o.push(1);for(let i=0;i<e;i++)i===0?o[n]=1:(o.splice(n,0,1),o.pop());return o}function gL(t,n,e){return e<=t?e:e-(n-1)}function yL(t,n){let e=[];for(let r=0;r<t;r++)e.push(n+r);return e}function xL(t,n,e,r,o,i,s,a,l){let c=t.length,u=new Array(c),d=new Array(c),p=new Array(c);if(n.length&&e>0){let f=n[0],m=e+1;u=vL(s,f,m,r,t),d=bL(a,f,m,o,t),p=hL(i,f,m,t)}else for(let f=0;f<c;f++)u[f]=CL(s,r,i,t,f,l),d[f]=SL(a,o,i,t,f,l),p[f]=wL(i,f,l);return{begin:u,end:d,strides:p}}function vL(t,n,e,r,o){let i=[...o],s=yL(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=0;else{let l=gL(n,e,a),c=r[l];t&1<<l&&(c=0),i[a]=c}return i}function bL(t,n,e,r,o){let i=[...o],s=yL(e,n);for(let a=0;a<i.length;a++)if(s.indexOf(a)>-1)i[a]=Number.MAX_SAFE_INTEGER;else{let l=gL(n,e,a),c=r[l];t&1<<l&&(c=Number.MAX_SAFE_INTEGER),i[a]=c}for(let a=0;a<i.length;a++){let l=o[a];i[a]<0&&(i[a]+=l),i[a]=uf(0,i[a],o[a])}return i}function wL(t,n,e){let r=t[n];return(e&1<<n||r==null)&&(r=1),r}function CL(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MIN_SAFE_INTEGER:s=Number.MAX_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),s=uf(0,s,l-1),s}function SL(t,n,e,r,o,i){let s=n[o],a=e[o]||1;(t&1<<o||i&1<<o||s==null)&&(a>0?s=Number.MAX_SAFE_INTEGER:s=Number.MIN_SAFE_INTEGER);let l=r[o];return s<0&&(s+=l),a>0?s=uf(0,s,l):s=uf(-1,s,l-1),s}function Oie(t,n,e){let r=e.length;for(let o=0;o<e.length;o++)if(e[o]>1){r=o;break}for(let o=r+1;o<e.length;o++)if(n[o]>0||e[o]!==t[o])return!1;return!0}function Mie(t,n){let e=t.length>0?t[t.length-1]:1;for(let r=0;r<t.length-1;r++)e+=t[r]*n[r];return e}function kT(t,n,e){let r,o=t.shape.length;typeof n=="number"?r=[n,...new Array(o-1).fill(0)]:n.length<o?r=n.concat(new Array(o-n.length).fill(0)):r=n.slice(),r.forEach(s=>{M(s!==-1,()=>"slice() does not support negative begin indexing.")});let i;return e==null?i=new Array(o).fill(-1):typeof e=="number"?i=[e,...new Array(o-1).fill(-1)]:e.length<o?i=e.concat(new Array(o-e.length).fill(-1)):i=e,i=i.map((s,a)=>s>=0?s:(M(s===-1,()=>`Negative size values should be exactly -1 but got ${s} for the slice() size at index ${a}.`),t.shape[a]-r[a])),[r,i]}function Fie(t,n,e,r,o,i,s,a,l){let c=n.slice(),u=e.slice(),d=r;r==null&&(d=new Array(c.length));let p=Fb(s);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(s!==0&&a!==0)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(s!==0&&l!==0)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");let f=t.length-c.length,m=Fb(a),h=t.slice();m.forEach(D=>{c[D]=0,u[D]=1,h.splice(D,0,1)});let{begin:g,end:y,strides:v}=xL(h,p,f,c,u,d,o,i,s);c=g,u=y,d=v;let S=Fb(l);S.forEach(D=>{u[D]=c[D]+1,d[D]=1});let C=mL(c,u,d),I=C.filter((D,O)=>S.indexOf(O)===-1);return{nonStrided:d.every(D=>D===1),$begin:c,$end:u,$strides:d,size:C,newShape:h,outShape:I}}var Q={};Fi(Q,{Serializable:()=>Ug,SerializationMap:()=>Pb,registerClass:()=>kr});var Ug=class{getClassName(){return this.constructor.className}static fromConfig(n,e){return new n(e)}},Pb=class t{constructor(){this.classNameMap={}}static getMap(){return t.instance==null&&(t.instance=new t),t.instance}static register(n){t.getMap().classNameMap[n.className]=[n,n.fromConfig]}};function kr(t){M(t.className!=null,()=>"Class being registered does not have the static className property defined."),M(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),M(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Pb.register(t)}function Pie(t){H().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}N$(Pie);function Ua(){return k}function jg(){return k.memory()}function z(t,n){return k.tidy(t,n)}function Fe(t){Ib(t).forEach(e=>e.dispose())}function An(t){return k.keep(t)}function $b(t,n,e=1){return k.registerBackend(t,n,e)}function _L(){return k.backend}function $ie(t,n){let e=N(t,"a","add"),r=N(n,"b","add");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(vi,o)}var ee=A({add_:$ie});function Lie(t,n){let e=N(t,"a","floorDiv"),r=N(n,"b","floorDiv");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(da,o)}var Lb=A({floorDiv_:Lie});function Vie(t,n){let e=N(t,"a","div"),r=N(n,"b","div");if([e,r]=Xe(e,r),e.dtype==="int32"&&r.dtype==="int32")return Lb(e,r);let o={a:e,b:r},i={};return k.runKernel(ia,o,i)}var me=A({div_:Vie});function Bie(t,n){let e=N(t,"a","mul"),r=N(n,"b","mul");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(wa,o)}var V=A({mul_:Bie});function zie(t){let n=N(t,"x","abs");if(n.dtype==="complex64"){let e={x:n};return k.runKernel(ql,e)}else{let e={x:n};return k.runKernel(Bl,e)}}var bn=A({abs_:zie});function Uie(t){let e={x:N(t,"x","acos")};return k.runKernel(Ks,e)}var AT=A({acos_:Uie});function jie(t){let e={x:N(t,"x","acosh")};return k.runKernel(Xs,e)}var RT=A({acosh_:jie});function Gie(t,n=null,e=!1){let o={x:N(t,"x","all","bool")},i={axis:n,keepDims:e};return k.runKernel(yf,o,i)}var Gg=A({all_:Gie});function Wie(t,n=null,e=!1){let o={x:N(t,"x","any","bool")},i={axis:n,keepDims:e};return k.runKernel(xf,o,i)}var em=A({any_:Wie});function Hie(t,n=0){let r={x:N(t,"x","argMax")},o={axis:n};return k.runKernel(zl,r,o)}var tm=A({argMax_:Hie});function qie(t,n=0){let r={x:N(t,"x","argMin")},o={axis:n};return k.runKernel(Ul,r,o)}var IL=A({argMin_:qie});function Kie(t){let e={x:N(t,"x","asin")};return k.runKernel(Ys,e)}var OT=A({asin_:Kie});function Xie(t){let e={x:N(t,"x","asinh")};return k.runKernel(Qs,e)}var MT=A({asinh_:Xie});function Yie(t){let e={x:N(t,"x","atan")};return k.runKernel(Zs,e)}var FT=A({atan_:Yie});function Qie(t,n){let e=N(t,"a","atan2"),r=N(n,"b","atan2");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(ea,o)}var EL=A({atan2_:Qie});function Zie(t){let e={x:N(t,"x","atanh")};return k.runKernel(Js,e)}var PT=A({atanh_:Zie});function Jie(t,n,e,r,o="NHWC",i){let s=t[3],a=[...n,s],l=DL(o);return pd(t,a,e,i,r,null,null,l)}function LT(t,n,e,r,o,i,s="channelsLast"){let[a,l]=Vb(n),c;if(s==="channelsLast")c=[a,l,t[3],t[3]];else if(s==="channelsFirst")c=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return pd(t,c,e,r,o,i,!1,s)}function ese(t,n,e,r,o,i,s="NDHWC"){let[a,l,c]=$T(n),u,d;if(s==="NDHWC")d="channelsLast",u=[a,l,c,t[4],t[4]];else if(s==="NCDHW")d="channelsFirst",u=[a,l,c,t[1],t[1]];else throw new Error(`Unknown dataFormat ${s}`);return TL(t,u,e,r,o,!1,d,i)}function pd(t,n,e,r,o,i,s=!1,a="channelsLast"){let[l,c,u,d]=[-1,-1,-1,-1];if(a==="channelsLast")[l,c,u,d]=t;else if(a==="channelsFirst")[l,d,c,u]=t;else throw new Error(`Unknown dataFormat ${a}`);let[p,f,,m]=n,[h,g]=Vb(e),[y,v]=Vb(r),S=nm(p,y),C=nm(f,v),{padInfo:I,outHeight:E,outWidth:D}=rse(o,c,u,h,g,S,C,i,a),O=s?m*d:m,R;return a==="channelsFirst"?R=[l,O,E,D]:a==="channelsLast"&&(R=[l,E,D,O]),{batchSize:l,dataFormat:a,inHeight:c,inWidth:u,inChannels:d,outHeight:E,outWidth:D,outChannels:O,padInfo:I,strideHeight:h,strideWidth:g,filterHeight:p,filterWidth:f,effectiveFilterHeight:S,effectiveFilterWidth:C,dilationHeight:y,dilationWidth:v,inShape:t,outShape:R,filterShape:n}}function TL(t,n,e,r,o,i=!1,s="channelsLast",a){let[l,c,u,d,p]=[-1,-1,-1,-1,-1];if(s==="channelsLast")[l,c,u,d,p]=t;else if(s==="channelsFirst")[l,p,c,u,d]=t;else throw new Error(`Unknown dataFormat ${s}`);let[f,m,h,,g]=n,[y,v,S]=$T(e),[C,I,E]=$T(r),D=nm(f,C),O=nm(m,I),R=nm(h,E),{padInfo:P,outDepth:U,outHeight:G,outWidth:q}=ose(o,c,u,d,y,v,S,D,O,R,a),X=i?g*p:g,K;return s==="channelsFirst"?K=[l,X,U,G,q]:s==="channelsLast"&&(K=[l,U,G,q,X]),{batchSize:l,dataFormat:s,inDepth:c,inHeight:u,inWidth:d,inChannels:p,outDepth:U,outHeight:G,outWidth:q,outChannels:X,padInfo:P,strideDepth:y,strideHeight:v,strideWidth:S,filterDepth:f,filterHeight:m,filterWidth:h,effectiveFilterDepth:D,effectiveFilterHeight:O,effectiveFilterWidth:R,dilationDepth:C,dilationHeight:I,dilationWidth:E,inShape:t,outShape:K,filterShape:n}}function tse(t,n,e,r,o){r==null&&(r=VT(t,n,e));let i=t[0],s=t[1],a=dd((i-n+2*r)/e+1,o),l=dd((s-n+2*r)/e+1,o);return[a,l]}function nse(t,n,e,r,o,i){o==null&&(o=VT(t,n,r));let s=t[0],a=t[1],l=t[2],c=dd((s-n+2*o)/r+1,i),u=dd((a-n+2*o)/r+1,i),d=dd((l-n+2*o)/r+1,i);return[c,u,d,e]}function VT(t,n,e,r=1){let o=nm(n,r);return Math.floor((t[0]*(e-1)-e+o)/2)}function Vb(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function $T(t){return typeof t=="number"?[t,t,t]:t}function nm(t,n){return n<=1?t:t+(t-1)*(n-1)}function rse(t,n,e,r,o,i,s,a,l){let c,u,d;if(typeof t=="number"){c={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let f=tse([n,e],i,r,t,a);u=f[0],d=f[1]}else if(t==="same"){u=Math.ceil(n/r),d=Math.ceil(e/o);let p=Math.max(0,(u-1)*r+i-n),f=Math.max(0,(d-1)*o+s-e),m=Math.floor(p/2),h=p-m,g=Math.floor(f/2),y=f-g;c={top:m,bottom:h,left:g,right:y,type:"SAME"}}else if(t==="valid")c={top:0,bottom:0,left:0,right:0,type:"VALID"},u=Math.ceil((n-i+1)/r),d=Math.ceil((e-s+1)/o);else if(typeof t=="object"){let p=l==="channelsLast"?t[1][0]:t[2][0],f=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];c={top:p,bottom:f,left:m,right:h,type:p===0&&f===0&&m===0&&h===0?"VALID":"EXPLICIT"},u=dd((n-i+p+f)/r+1,a),d=dd((e-s+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:c,outHeight:u,outWidth:d}}function ose(t,n,e,r,o,i,s,a,l,c,u){let d,p,f,m;if(typeof t=="number"){d={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=nse([n,e,r,1],a,1,o,t,u);p=g[0],f=g[1],m=g[2]}else if(t==="same"){p=Math.ceil(n/o),f=Math.ceil(e/i),m=Math.ceil(r/s);let h=(p-1)*o+a-n,g=(f-1)*i+l-e,y=(m-1)*s+c-r,v=Math.floor(h/2),S=h-v,C=Math.floor(g/2),I=g-C,E=Math.floor(y/2),D=y-E;d={top:C,bottom:I,left:E,right:D,front:v,back:S,type:"SAME"}}else if(t==="valid")d={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((n-a+1)/o),f=Math.ceil((e-l+1)/i),m=Math.ceil((r-c+1)/s);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:d,outDepth:p,outHeight:f,outWidth:m}}function dd(t,n){if(!n)return Math.trunc(t);switch(n){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${n}`)}}function xo(t){let[n,e,r]=Vb(t);return n===1&&e===1&&r===1}function Ln(t,n){return xo(t)||xo(n)}function DL(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function ise(t,n){let r={x:N(t,"x","reshape","string_or_numeric")},o={shape:n};return k.runKernel(xc,r,o)}var B=A({reshape_:ise});function sse(t,n,e,r,o){let i=N(t,"x","avgPool","float32"),s=1;M(Ln(e,s),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`);let a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),o!=null&&M(ht(r),()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(jl,c,u);return d=le(d,i.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var fd=A({avgPool_:sse});function ase(t,n,e,r,o,i="NDHWC"){let s=N(t,"x","avgPool3d","float32"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&M(ht(r),()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(Gl,c,u);return d=le(d,a.dtype),l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var BT=A({avgPool3d_:ase});function lse(t,n=0){M(t.length>=1,()=>"Pass at least one tensor to concat");let e=Tb(t,"tensors","concat","string_or_numeric");if(e[0].dtype==="complex64"&&e.forEach(i=>{if(i.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${i.dtype}. `)}),e.length===1)return Si(e[0]);let r=e,o={axis:n};return k.runKernel(Kl,r,o)}var Lt=A({concat_:lse});function cse(t){let e={x:N(t,"x","sigmoid")};return k.runKernel(Ra,e)}var Uo=A({sigmoid_:cse});function use(t,n,e){let r=N(t,"x","slice","string_or_numeric");if(r.rank===0)throw new Error("Slicing scalar is not possible");let o={x:r},i={begin:n,size:e};return k.runKernel(Sc,o,i)}var it=A({slice_:use});function dse(t){let e={x:N(t,"x","tanh")};return k.runKernel(La,e)}var rm=A({tanh_:dse});function pse(t,n,e){let r=N(t,"x","batchToSpaceND"),o=n.reduce((a,l)=>a*l);M(r.rank>=1+n.length,()=>`input rank is ${r.rank} but should be > than blockShape.length ${n.length}`),M(e.length===n.length,()=>`crops.length is ${e.length} but should be equal to blockShape.length  ${n.length}`),M(r.shape[0]%o===0,()=>`input tensor batch is ${r.shape[0]} but is not divisible by the product of the elements of blockShape ${n.join(" * ")} === ${o}`);let i={x:r},s={blockShape:n,crops:e};return k.runKernel(Hl,i,s)}var om=A({batchToSpaceND_:pse});function NL(t){let n;return t.rank===0||t.rank===1?n=B(t,[1,1,1,t.size]):t.rank===2?n=B(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?n=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]):n=t,n}function fse(t,n,e,r,o,i){i==null&&(i=.001);let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;r!=null&&(u=N(r,"offset","batchNorm")),M(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),M(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),M(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let p={x:NL(s),scale:c,offset:u,mean:a,variance:l},f={varianceEpsilon:i},m=k.runKernel(nc,p,f);return B(m,s.shape)}var Pc=A({batchNorm_:fse});function mse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${s.rank}.`),M(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),M(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${u.rank}.`),Pc(s,a,l,u,c,i)}var zT=A({batchNorm2d_:mse});function hse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${s.rank}.`),M(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),M(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${u.rank}.`),Pc(s,a,l,u,c,i)}var UT=A({batchNorm3d_:hse});function gse(t,n,e,r,o,i){let s=N(t,"x","batchNorm"),a=N(n,"mean","batchNorm"),l=N(e,"variance","batchNorm"),c;o!=null&&(c=N(o,"scale","batchNorm"));let u;return r!=null&&(u=N(r,"offset","batchNorm")),M(s.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${s.rank}.`),M(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),M(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),c!=null&&M(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`),u!=null&&M(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${u.rank}.`),Pc(s,a,l,u,c,i)}var jT=A({batchNorm4d_:gse});function yse(t,n){let e=N(t,"broadcastTo","x"),r=e.shape;if(n.some(c=>!(c>0)||c%1!==0))throw new Error(`broadcastTo(): Invalid broadcast shape [${n}].`);if(n.length<e.rank)throw new Error(`broadcastTo(): shape.length=${n.length} < input.rank=${e.rank}.`);if(n.length>e.rank){let c=e.shape.slice();for(;c.length<n.length;)c.unshift(1);e=B(e,c)}let o=e.shape,i=Array.from(n);for(let c=n.length-1;c>=0;c--)if(o[c]===n[c])i[c]=1;else if(e.shape[c]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${n}].`);if(i.map((c,u)=>c>1?u:-1).filter(c=>c>=0).length===0)return Si(e);let a={x:e},l={reps:i};return k.runKernel(ns,a,l)}var im=A({broadcastTo_:yse});function xse(t){let e={x:N(t,"x","ceil")};return k.runKernel(ta,e)}var GT=A({ceil_:xse});function vse(t,n,e){let r=N(t,"x","clipByValue");M(n<=e,()=>`Error in clip: min (${n}) must be less than or equal to max (${e}).`);let o={x:r},i={clipValueMin:n,clipValueMax:e};return k.runKernel(na,o,i)}var Vn=A({clipByValue_:vse});function bse(t){return Lt(t,0)}var WT=A({concat1d_:bse});function wse(t,n){return Lt(t,n)}var HT=A({concat2d_:wse});function Cse(t,n){return Lt(t,n)}var qT=A({concat3d_:Cse});function Sse(t,n){return Lt(t,n)}var KT=A({concat4d_:Sse});function _se(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","conv2d"),l=N(n,"filter","conv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(c.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),s!=null&&M(ht(r),()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d=o==="NHWC"?c.shape[3]:c.shape[1];M(d===l.shape[2],()=>`Error in conv2d: depth of input (${d}) must match input depth for filter ${l.shape[2]}.`),M(Ln(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`);let p={x:c,filter:l},f={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},m=k.runKernel(Xl,p,f);return u?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Zr=A({conv2d_:_se});function Ise(t,n,e,r,o="NWC",i=1,s){let a=N(t,"x","conv1d"),l=N(n,"filter","conv1d"),c=a,u=!1;a.rank===2&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1]])),M(c.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`),M(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),s!=null&&M(ht(r),()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),M(c.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${l.shape[1]}.`),M(Ln(e,i),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${e} and dilation '${i}'`),M(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let d=B(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=B(c,[c.shape[0],1,c.shape[1],c.shape[2]]),g=Zr(p,d,[1,e],r,"NHWC",[1,i],s);return u?B(g,[g.shape[2],g.shape[3]]):B(g,[g.shape[0],g.shape[2],g.shape[3]])}var Wg=A({conv1d_:Ise});function Ese(t,n,e,r,o,i="NHWC",s){M(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let a=t,l=n,c=!1;n.rank===3&&(c=!0,l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]),a=[1,t[0],t[1],t[2]]),M(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),M(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),M(e.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${e.rank}`);let u=i==="NHWC"?a[3]:a[1],d=i==="NHWC"?l.shape[3]:l.shape[1];M(u===e.shape[2],()=>`Error in conv2dDerInput: depth of input (${u}) must match input depth for filter ${e.shape[2]}.`),M(d===e.shape[3],()=>`Error in conv2dDerInput: depth of output (${d}) must match output depth for filter ${e.shape[3]}.`),s!=null&&M(ht(o),()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let p={dy:l,filter:e},f={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,inputShape:a},m=k.runKernel(Yl,p,f);return c?B(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var sm=A({conv2DBackpropInput_:Ese});function Tse(t,n,e,r,o,i){let s=N(t,"x","conv2dTranspose"),a=N(n,"filter","conv2dTranspose");return sm(e,s,a,r,o,"NHWC",i)}var Hg=A({conv2dTranspose_:Tse});function Dse(t,n,e,r,o="NDHWC",i=[1,1,1]){let s=N(t,"x","conv3d"),a=N(n,"filter","conv3d"),l=s,c=!1;s.rank===4&&(c=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),M(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),M(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),M(Ln(e,i),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),M(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let u={x:l,filter:a},d={strides:e,pad:r,dataFormat:o,dilations:i},p=k.runKernel(Ql,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var XT=A({conv3d_:Dse});function Nse(t,n,e,r,o){M(t.length===n.rank,()=>`Length of inShape (${t.length}) and rank of dy (${n.rank}) must match`);let i=t,s=n,a=!1;n.rank===4&&(a=!0,s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]),i=[1,t[0],t[1],t[2],t[3]]);let l=i[4],c=s.shape[4];M(i.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${i.length}.`),M(s.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${s.rank}`),M(e.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${e.rank}`),M(l===e.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${e.shape[3]}.`),M(c===e.shape[4],()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${e.shape[4]}.`);let u={dy:s,filter:e},d={pad:o,strides:r,inputShape:i},p=k.runKernel(_f,u,d);return a?B(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var Bb=A({conv3DBackpropInput_:Nse});function kse(t,n,e,r,o){let i=N(t,"x","conv3dTranspose"),s=N(n,"filter","conv3dTranspose");return Bb(e,i,s,r,o)}var YT=A({conv3dTranspose_:kse});function Ase(t){let e={x:N(t,"x","cos")};return k.runKernel(ra,e)}var md=A({cos_:Ase});function Rse(t){let e={x:N(t,"x","cosh")};return k.runKernel(oa,e)}var qg=A({cosh_:Rse});function Ose(t,n=0,e=!1,r=!1){let i={x:N(t,"x","cumsum")},s={axis:n,exclusive:e,reverse:r};return k.runKernel(Zl,i,s)}var zb=A({cumsum_:Ose});function Mse(t,n,e="NHWC"){let r=N(t,"x","depthToSpace"),o=e==="NHWC"?r.shape[1]:r.shape[2],i=e==="NHWC"?r.shape[2]:r.shape[3],s=e==="NHWC"?r.shape[3]:r.shape[1];M(o*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${n}  for depthToSpace with input shape
    ${r.shape}`),M(i*n>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${i} and ${n} for depthToSpace with input shape
        ${r.shape}`),M(s%(n*n)===0,()=>`Dimension size must be evenly divisible by ${n*n} but is ${s} for depthToSpace with input shape ${r.shape}`);let a={x:r},l={blockSize:n,dataFormat:e};return k.runKernel(If,a,l)}var kL=A({depthToSpace_:Mse});function Fse(t,n,e,r,o="NHWC",i=[1,1],s){let a=N(t,"x","depthwiseConv2d"),l=N(n,"filter","depthwiseConv2d"),c=a,u=!1;a.rank===3&&(u=!0,c=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),M(c.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`),M(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`),M(c.shape[3]===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${l.shape[2]}.`),s!=null&&M(ht(r),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`);let d={x:c,filter:l},p={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s},f=k.runKernel(Jl,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var Ga=A({depthwiseConv2d_:Fse});function Pse(t,n,e,r,o=[1,1],i="NHWC"){let s=N(t,"x","dilation2d"),a=N(n,"filter","dilation2d");M(s.rank===3||s.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${s.rank}.`),M(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),M(i==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${i}`);let l=s,c=!1;s.rank===3&&(l=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),c=!0);let u={x:l,filter:a},d={strides:e,pad:r,dilations:o},p=k.runKernel(ec,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var AL=A({dilation2d_:Pse});function $se(t,n){let e=t.length,r=[];for(let o=0;o<e;o++){let i=e-1-o,s=t[i]||1;(n[n.length-1-o]||1)>1&&s===1&&r.unshift(i)}return r}function Ot(t,n){let e=[];for(let r=0;r<n.length;r++){let o=t[t.length-r-1],i=n.length-r-1,s=n[i];(o==null||o===1&&s>1)&&e.unshift(i)}return e}function Ue(t,n){let e=[],r=Math.max(t.length,n.length);for(let o=0;o<r;o++){let i=t[t.length-o-1];i==null&&(i=1);let s=n[n.length-o-1];if(s==null&&(s=1),i===1)e.unshift(s);else if(s===1)e.unshift(i);else if(i!==s){let a=`Operands could not be broadcast together with shapes ${t} and ${n}.`;throw Error(a)}else e.unshift(i)}return e}function Lse(t,n){let e=N(t,"a","equal"),r=N(n,"b","equal");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(qu,o)}var jo=A({equal_:Lse});function Vse(t,n,e){let r=N(n,"a","where"),o=N(e,"b","where"),i=N(t,"condition","where","bool"),s=Ue(Ue(i.shape,r.shape),o.shape),a=im(i,s),l=im(r,s),c=im(o,s),u={condition:a,t:l,e:c};return k.runKernel(Cc,u)}var an=A({where_:Vse});function Bse(t){let e={x:N(t,"x","zerosLike")};return k.runKernel(Ac,e)}var Ee=A({zerosLike_:Bse});function zse(t,n){let e=N(t,"a","div"),r=N(n,"b","div");[e,r]=Xe(e,r);let o=me(e,r),i=Ee(o),s=jo(r,i);return an(s,i,o)}var RL=A({divNoNan_:zse});function Use(t,n){let e=N(t,"t1","dot"),r=N(n,"t2","dot");M((e.rank===1||e.rank===2)&&(r.rank===1||r.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${e.rank} and ${r.rank}.`);let o=e.rank===1?e.size:e.shape[1],i=r.rank===1?r.size:r.shape[0];if(M(o===i,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${i}.`),e.rank===1&&r.rank===1){let s=B(e,[1,-1]),a=B(r,[-1,1]),l=gt(s,a);return B(l,[])}else if(e.rank===1&&r.rank===2){let s=B(e,[1,-1]),a=B(r,[r.shape[0],r.shape[1]]),l=gt(s,a);return B(l,[l.size])}else if(e.rank===2&&r.rank===1){let s=B(r,[-1,1]),a=gt(e,s);return B(a,[a.size])}else{let s=B(r,[r.shape[0],r.shape[1]]);return gt(e,s)}}var OL=A({dot_:Use});function jse(t){let e={x:N(t,"x","elu")};return k.runKernel(sa,e)}var Wa=A({elu_:jse});function Gse(t){let n=N(t,"x","erf");M(n.dtype==="int32"||n.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),n.dtype==="int32"&&(n=le(n,"float32"));let e={x:n};return k.runKernel(aa,e)}var QT=A({erf_:Gse});function Wse(t){let e={x:N(t,"x","exp")};return k.runKernel(la,e)}var fr=A({exp_:Wse});function Hse(t,n=0){let e=N(t,"x","expandDims","string_or_numeric");M(n<=e.rank,()=>"Axis must be <= rank of the tensor");let r={input:e},o={dim:n};return k.runKernel(tc,r,o)}var Kn=A({expandDims_:Hse});function qse(t){let e={x:N(t,"x","expm1")};return k.runKernel(ca,e)}var ZT=A({expm1_:qse});function Kse(t,n){let e=N(t,"x","tile","string_or_numeric");M(e.rank===n.length,()=>`Error in transpose: rank of input ${e.rank} must match length of reps ${n}.`);let r={x:e},o={reps:n};return k.runKernel(ns,r,o)}var _i=A({tile_:Kse});function Xse(t,n,e,r="float32"){n==null&&(n=t);let o=Ie([t,n],r),i=t<=n?t:n;for(let a=0;a<i;++a)o.set(1,a,a);let s=B(o.toTensor(),[t,n]);if(e==null)return s;if(e.length===1)return _i(Kn(s,0),[e[0],1,1]);if(e.length===2)return _i(Kn(Kn(s,0),0),[e[0],e[1],1,1]);if(e.length===3)return _i(Kn(Kn(Kn(s,0),0),0),[e[0],e[1],e[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${e.length}D.`)}var am=A({eye_:Xse});function Kg(t,n,e){let r={shape:t,value:n,dtype:e};return k.runKernel(kf,{},r)}function Yse(t){let e={x:N(t,"x","floor")};return k.runKernel(ua,e)}var Ha=A({floor_:Yse});function Qse(t,n,e=0,r=0){let o=N(t,"x","gather"),i=N(n,"indices","gather","int32"),s={x:o,indices:i},a={axis:e,batchDims:r};return k.runKernel(rc,s,a)}var hd=A({gather_:Qse});function Zse(t,n){let e=N(t,"a","greater"),r=N(n,"b","greater");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Ku,o)}var Bn=A({greater_:Zse});function Jse(t,n){let e=N(t,"a","greaterEqual"),r=N(n,"b","greaterEqual");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(pa,o)}var vo=A({greaterEqual_:Jse});function eae(t){let e={input:N(t,"input","imag")};return k.runKernel(Rf,e)}var Ub=A({imag_:eae});function tae(t){let e={x:N(t,"x","isFinite")};return k.runKernel(fa,e)}var JT=A({isFinite_:tae});function nae(t){let e={x:N(t,"x","isInf")};return k.runKernel(ma,e)}var eD=A({isInf_:nae});function rae(t){let e={x:N(t,"x","isNaN")};return k.runKernel(ha,e)}var tD=A({isNaN_:rae});function oae(t,n=.2){let r={x:N(t,"x","leakyRelu")},o={alpha:n};return k.runKernel(oc,r,o)}var gd=A({leakyRelu_:oae});function iae(t,n){let e=N(t,"a","less"),r=N(n,"b","less");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Xu,o)}var jb=A({less_:iae});function sae(t,n){let e=N(t,"a","lessEqual"),r=N(n,"b","lessEqual");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Yu,o)}var is=A({lessEqual_:sae});function aae(t,n=5,e=1,r=1,o=.5){let i=N(t,"x","localResponseNormalization");M(i.rank===4||i.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${i.rank}.`),M(ht(n),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${n}.`);let s=i,a=!1;i.rank===3&&(a=!0,s=B(i,[1,i.shape[0],i.shape[1],i.shape[2]]));let l={x:s},c={depthRadius:n,bias:e,alpha:r,beta:o},u=k.runKernel(ic,l,c);return a?B(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var ML=A({localResponseNormalization_:aae});function lae(t){let e={x:N(t,"x","log")};return k.runKernel(ga,e)}var mr=A({log_:lae});function cae(t){let e={x:N(t,"x","log1p")};return k.runKernel(ya,e)}var nD=A({log1p_:cae});function rD(t,n){M(ff(t),()=>"The f passed in variableGrads(f) must be a function"),M(n==null||Array.isArray(n)&&n.every(c=>c instanceof Ba),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let e=n!=null;if(!e){n=[];for(let c in k.registeredVariables)n.push(k.registeredVariables[c])}let r=e?n.filter(c=>!c.trainable):null,o=n.length;n=n.filter(c=>c.trainable),M(n.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let i=!0,{value:s,grads:a}=k.gradients(t,n,null,i);M(a.some(c=>c!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),M(s.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${s.rank} tensor`);let l={};return n.forEach((c,u)=>{a[u]!=null&&(l[c.name]=a[u])}),r?.forEach(c=>l[c.name]=null),{value:s,grads:l}}function bo(t){return k.customGrad(t)}function uae(t){let e={x:N(t,"x","neg")};return k.runKernel(pc,e)}var yt=A({neg_:uae});function dae(t){let e={x:N(t,"x","softplus")};return k.runKernel(Oa,e)}var ss=A({softplus_:dae});function pae(t){let n=N(t,"x","logSigmoid");return bo(r=>({value:yt(ss(yt(r))),gradFunc:s=>V(s,Uo(yt(r)))}))(n)}var oD=A({logSigmoid_:pae});function fae(t,n=null,e=!1){let o={x:N(t,"x","max")},i={reductionIndices:n,keepDims:e};return k.runKernel(sc,o,i)}var zn=A({max_:fae});function mae(t,n){let e=N(t,"a","sub"),r=N(n,"b","sub");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(Pa,o)}var we=A({sub_:mae});function hae(t,n=null,e=!1){let r=N(t,"x","sum");r.dtype==="bool"&&(r=le(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(_c,o,i)}var ve=A({sum_:hae});function gae(t,n=-1){let e=N(t,"logits","logSoftmax");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and axis was ${n}`);return bo((o,i)=>{let a=zn(o,n,!0),l=we(o,a),c=we(le(l,"float32"),mr(ve(fr(l),n,!0)));return i([c]),{value:c,gradFunc:(d,p)=>{let[f]=p,m=!0,h=fr(f);return we(d,V(ve(d,n,m),h))}}})(e)}var Xg=A({logSoftmax_:gae});function iD(t,n){for(let e=0;e<t.length;++e)if(t[t.length-e-1]!==n-1-e)return!1;return!0}function FL(t,n,e){let r=t.length+n.length,o=[],i=0,s=0;for(let a=0;a<r;a++)e.indexOf(a)===-1?o.push(t[i++]):o.push(n[s++]);return o}function sD(t,n){let e=[],r=t.length;for(let i=0;i<r;i++)n.indexOf(i)===-1&&e.push(t[i]);let o=n.map(i=>t[i]);return[e,o]}function as(t,n){let e=n.map(r=>1);return FL(t,e,n)}function yae(t,n,e){M(iD(n,e),()=>`${t} supports only inner-most axes for now. Got axes ${n} and rank-${e} input.`)}function aD(t,n){if(iD(t,n))return null;let e=[];for(let r=0;r<n;++r)t.indexOf(r)===-1&&e.push(r);return t.forEach(r=>e.push(r)),e}function Yg(t){return t.map((n,e)=>[e,n]).sort((n,e)=>n[1]-e[1]).map(n=>n[0])}function xae(t,n){let e=[];for(let r=n-t;r<n;++r)e.push(r);return e}function vae(t,n=null,e=!1){let r=N(t,"x","logSumExp"),o=vn(n,r.shape),i=zn(r,o,!0),s=we(r,i),a=fr(s),l=ve(a,o),c=mr(l),u=ee(B(i,c.shape),c);if(e){let d=as(u.shape,o);return B(u,d)}return u}var PL=A({logSumExp_:vae});function bae(t,n){let e=N(t,"a","logicalAnd","bool"),r=N(n,"b","logicalAnd","bool");Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Qu,o)}var ar=A({logicalAnd_:bae});function wae(t){let e={x:N(t,"x","logicalNot","bool")};return k.runKernel(Zu,e)}var lm=A({logicalNot_:wae});function Cae(t,n){let e=N(t,"a","logicalOr","bool"),r=N(n,"b","logicalOr","bool");Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(Ju,o)}var Gb=A({logicalOr_:Cae});function Sae(t,n){let e=N(t,"a","logicalXor","bool"),r=N(n,"b","logicalXor","bool");return Ue(e.shape,r.shape),ar(Gb(t,n),lm(ar(t,n)))}var $L=A({logicalXor_:Sae});function _ae(t,n,e,r,o){let i=N(t,"x","maxPool"),s=1,a=i,l=!1;i.rank===3&&(l=!0,a=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),M(Ln(e,s),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${e} and dilations '${s}'`),o!=null&&M(ht(r),()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o},d=k.runKernel(ac,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var yd=A({maxPool_:_ae});function Iae(t,n=[1,1,1],e,r,o,i="NDHWC"){let s=N(t,"x","maxPool3d"),a=s,l=!1;s.rank===4&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),M(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),M(i==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${i}`),o!=null&&M(ht(r),()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`);let c={x:a},u={filterSize:n,strides:e,pad:r,dimRoundingMode:o,dataFormat:i},d=k.runKernel(lc,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var cD=A({maxPool3d_:Iae});function Eae(t,n){let e=N(t,"a","maximum"),r=N(n,"b","maximum");[e,r]=Xe(e,r),e.dtype==="bool"&&(e=le(e,"int32"),r=le(r,"int32")),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(xa,o)}var Jr=A({maximum_:Eae});function Tae(t,n=null,e=!1){let o={x:N(t,"x","mean")},i={axis:n,keepDims:e};return k.runKernel(cc,o,i)}var Gt=A({mean_:Tae});function Vt(t,n="float32"){if(n==="complex64"){let r=Vt(t,"float32"),o=Vt(t,"float32");return wi(r,o)}let e=hf(Rt(t),n);return k.makeTensor(e,t,n)}function eo(t,n="float32"){if(n==="complex64"){let r=eo(t,"float32"),o=Vt(t,"float32");return wi(r,o)}let e=kg(Rt(t),n);return k.makeTensor(e,t,n)}function Dae(t,n=null,e=!1){let o={x:N(t,"x","min")},i={axis:n,keepDims:e};return k.runKernel(uc,o,i)}var Lc=A({min_:Dae});function Nae(t,n){let e=N(t,"a","minimum"),r=N(n,"b","minimum");[e,r]=Xe(e,r),e.dtype==="bool"&&(e=le(e,"int32"),r=le(r,"int32")),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(va,o)}var xd=A({minimum_:Nae});function kae(t,n,e){M(e==="reflect"||e==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${e}.`);let r=N(t,"x","mirrorPad");if(r.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");M(n.length===r.rank,()=>`Padding doesn't match input. Must be ${r.rank}. Got ${n.length}.`);let o=e==="reflect"?1:0;for(let a=0;a<r.rank;a++)M(n[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),M(n[a][0]>=0&&n[a][0]<=r.shape[a]-o&&n[a][1]>=0&&n[a][1]<=r.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${r.shape[a]-o} or less than 0 for input of shape ${r.shape}`);let i={paddings:n,mode:e},s={x:r};return k.runKernel(dc,s,i)}var LL=A({mirrorPad_:kae});function Aae(t,n){let e=N(t,"a","mod"),r=N(n,"b","mod");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(ba,o)}var VL=A({mod_:Aae});function Rae(t){let n=N(t,"x","square"),e={};return k.runKernel("Square",{x:n},e)}var We=A({square_:Rae});function Oae(t,n=null,e=!1){t=N(t,"x","moments");let r=vn(n,t.shape),o=Gt(t,r,e),i=o.shape;e||(i=as(o.shape,r));let s=We(we(le(t,"float32"),B(o,i))),a=Gt(s,r,e);return{mean:o,variance:a}}var cm=A({moments_:Oae});function Mae(t,n){let e=N(t,"a","notEqual"),r=N(n,"b","notEqual");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r};return k.runKernel(ed,o)}var Vc=A({notEqual_:Mae});function Fae(t){let e={x:N(t,"x","onesLike")};return k.runKernel(fc,e)}var Rn=A({onesLike_:Fae});function Pae(t,n,e=0){let r=N(t,"x","pad");if(r.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:n,constantValue:e},i={x:r};return k.runKernel(gc,i,o)}var vd=A({pad_:Pae});function $ae(t,n,e){let r=N(t,"x","spaceToBatchND");M(r.rank>=1+n.length,()=>`input rank ${r.rank} should be > than [blockShape] ${n.length}`),M(e.length===n.length,()=>`paddings.shape[0] ${e.length} must be equal to [blockShape] ${n.length}`),M(r.shape.reduce((s,a,l)=>l>0&&l<=n.length?s&&(a+e[l-1][0]+e[l-1][1])%n[l-1]===0:s,!0),()=>`input spatial dimensions ${r.shape.slice(1)} with paddings ${e.toString()} must be divisible by blockShapes ${n.toString()}`);let o={x:r},i={blockShape:n,paddings:e};return k.runKernel(Ic,o,i)}var um=A({spaceToBatchND_:$ae});function Lae(t,n,e,r,o,i){o==null&&(o=[1,1]),i==null&&(i=1),r===0&&(r="valid");let s=N(t,"x","maxPool"),a=s,l=!1;s.rank===3&&(l=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]])),M(Ln(i,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${i} and dilations '${o}'`);let c=LT(a.shape,n,i,o,r),u=[c.dilationHeight,c.dilationWidth],d;r==="same"?d=Bae([c.filterHeight,c.filterWidth],u):d=[[0,0],[0,0]];let p=u[0]===1&&u[1]===1,[f,m]=Vae([c.inHeight,c.inWidth],u,d),h=p?r:"valid",g=p?a:um(a,u,f),v=(e==="avg"?()=>fd(g,n,i,h):()=>yd(g,n,i,h))(),S=p?v:om(v,u,m);return l?B(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function Vae(t,n,e){let r=e.map(u=>u[0]),o=e.map(u=>u[1]),i=t.concat(r,o),s=n.map((u,d)=>(u-i[d]%u)%u),a=o.map((u,d)=>u+s[d]),l=n.map((u,d)=>[r[d],a[d]]),c=n.map((u,d)=>[0,s[d]]);return[l,c]}function Bae(t,n){let r=t.map((s,a)=>s+(s-1)*(n[a]-1)).map(s=>s-1),o=r.map(s=>Math.floor(s/2)),i=r.map((s,a)=>s-o[a]);return r.map((s,a)=>[o[a],i[a]])}var BL=A({pool_:Lae});function zae(t,n){let e=N(t,"base","pow"),r=N(n,"exp","pow");[e,r]=Xe(e,r);let o={a:e,b:r};return k.runKernel(Ca,o)}var Go=A({pow_:zae});function Uae(t,n){let e=N(t,"x","prelu"),r=N(n,"alpha","prelu"),o={x:e,alpha:r};return k.runKernel(yc,o)}var bd=A({prelu_:Uae});function jae(t,n=null,e=!1){let r=N(t,"x","prod");r.dtype==="bool"&&(r=le(r,"int32"));let o={x:r},i={axis:n,keepDims:e};return k.runKernel(Pf,o,i)}var zL=A({prod_:jae});var gD=Ym(nV());var dm=class{constructor(n,e,r,o,i){this.mean=n,this.stdDev=e,this.dtype=r,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let s=i||Math.random();this.random=gD.alea(s.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let n,e,r=!1;for(;!r;){let o,i,s;do o=2*this.random()-1,i=2*this.random()-1,s=o*o+i*i;while(s>=1||s===0);let a=Math.sqrt(-2*Math.log(s)/s);n=this.mean+this.stdDev*o*a,e=this.mean+this.stdDev*i*a,(!this.truncated||this.isValidTruncated(n))&&(r=!0)}return(!this.truncated||this.isValidTruncated(e))&&(this.nextVal=this.convertValue(e)),this.convertValue(n)}convertValue(n){return this.dtype==null||this.dtype==="float32"?n:Math.round(n)}isValidTruncated(n){return n<=this.upper&&n>=this.lower}};var qb=class{constructor(n=0,e=1,r,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=n,this.range=e-n,this.dtype=r,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${n} - ${e} <= 1 and dtype is not float`);this.random=gD.alea(o)}convertValue(n){return this.canReturnFloat()?n:Math.round(n)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Yae(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error(`Unsupported data type ${r}`);let i=new dm(n,e,r,!1,o),s=Ie(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Kb=A({randomNormal_:Yae});function Qae(t,n=0,e=1,r="float32",o){let i=Ie(t,r),s=new qb(n,e,null,o);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var qa=A({randomUniform_:Qae});function yD(t,n,e=1,r="float32"){if(e===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:n,step:e,dtype:r};return k.runKernel($f,{},o)}function Zae(t){let e={input:N(t,"input","real")};return k.runKernel(Lf,e)}var Qg=A({real_:Zae});function Jae(t){let e={x:N(t,"x","reciprocal")};return k.runKernel(Sa,e)}var xD=A({reciprocal_:Jae});function ele(t){let e={x:N(t,"x","relu")};return k.runKernel(_a,e)}var Wo=A({relu_:ele});function tle(t){let e={x:N(t,"x","relu6")};return k.runKernel(Ia,e)}var Xb=A({relu6_:tle});function nle(t,n){let r={x:N(t,"x","reverse")},o={dims:n};return k.runKernel(wc,r,o)}var wo=A({reverse_:nle});function rle(t){let e={x:N(t,"x","round")};return k.runKernel(Ea,e)}var vD=A({round_:rle});function ole(t){let e={x:N(t,"x","rsqrt")};return k.runKernel(Ta,e)}var Zg=A({rsqrt_:ole});function Ae(t,n){if((Qr(t)&&n!=="string"||Array.isArray(t))&&n!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(n==="string"&&Qr(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Oc(t,[],[],n)}function ile(t){let e={x:N(t,"x","selu")};return k.runKernel(Da,e)}var Jg=A({selu_:ile});function sle(t,n,e,r,o,i=[1,1],s="NHWC"){let a=N(t,"x","separableConv2d"),l=N(n,"depthwiseFilter","separableConv2d"),c=N(e,"pointwiseFilter","separableConv2d"),u=a,d=!1;if(a.rank===3&&(d=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2]])),s==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");M(u.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${u.rank}.`),M(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),M(c.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),M(c.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`),M(c.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`);let p=l.shape[2],f=l.shape[3];M(c.shape[2]===p*f,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*f}, but got ${c.shape[2]}.`);let m=Ga(u,l,r,o,s,i),g=Zr(m,c,1,"valid",s);return d?B(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var ey=A({separableConv2d_:sle});function ale(t){let e={x:N(t,"x","sign")};return k.runKernel(Aa,e)}var bD=A({sign_:ale});function lle(t){let e={x:N(t,"x","sin")};return k.runKernel(Na,e)}var ty=A({sin_:lle});function cle(t){let e={x:N(t,"x","sinh")};return k.runKernel(ka,e)}var ny=A({sinh_:cle});function ule(t,n,e){let r=N(t,"x","slice1d");return M(r.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${r.rank} tensor`),it(r,[n],[e])}var ry=A({slice1d_:ule});function dle(t,n,e){let r=N(t,"x","slice2d");return M(r.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${r.rank} tensor`),it(r,n,e)}var Yb=A({slice2d_:dle});function ple(t,n,e){let r=N(t,"x","slice3d");return M(r.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${r.rank} tensor`),it(r,n,e)}var oy=A({slice3d_:ple});function fle(t,n,e){let r=N(t,"x","slice4d");return M(r.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${r.rank} tensor`),it(r,n,e)}var pm=A({slice4d_:fle});function mle(t,n=-1){let e=N(t,"logits","softmax","float32");if(n===-1&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${e.rank} and dim was ${n}`);let r={logits:e},o={dim:n};return k.runKernel(Tc,r,o)}var Cd=A({softmax_:mle});function hle(t){M(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Nf,n)}var iy=A({fft_:hle});function gle(t){M(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let n={input:t};return k.runKernel(Af,n)}var fm=A({ifft_:gle});function yle(t){let n=t.shape[t.shape.length-1],e=t.size/n,r;if(n<=2){let o=B(t,[e,n]);r=fm(o)}else{let o=[e,2*(n-1)],i=B(Qg(t),[e,n]),s=B(Ub(t),[e,n]),a=wo(it(i,[0,1],[e,n-2]),1),l=V(wo(it(s,[0,1],[e,n-2]),1),Ae(-1)),c=Lt([i,a],1),u=Lt([s,l],1),d=B(wi(c,u),[o[0],o[1]]);r=fm(d)}if(r=Qg(r),t.rank===3&&t.shape[0]!==0){let o=r,i=t.shape[0];r=B(r,[i,r.shape[0]/i,r.shape[1]]),o.dispose()}return r}var wD=A({irfft_:yle});function xle(t,n,e=0){let o={x:N(t,"x","split")},i={numOrSizeSplits:n,axis:e};return k.runKernel(Ec,o,i)}var Un=A({split_:xle});function vle(t,n){M(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let e=t.shape[t.shape.length-1],r=t.size/e,o;if(n!=null&&n<e){let m=t.shape.map(g=>0),h=t.shape.map(g=>g);h[t.shape.length-1]=n,o=it(t,m,h),e=n}else if(n!=null&&n>e){let m=t.shape.map(h=>h);m[t.shape.length-1]=n-e,o=Lt([t,Vt(m)],t.shape.length-1),e=n}else o=t;let i=Ee(o),s=B(wi(o,i),[r,e]),a=iy(s),l=Math.floor(e/2)+1,c=Qg(a),u=Ub(a),d=Un(c,[l,e-l],c.shape.length-1),p=Un(u,[l,e-l],u.shape.length-1),f=o.shape.slice();return f[o.shape.length-1]=l,B(wi(d[0],p[0]),f)}var CD=A({rfft_:vle});function ble(t){let e={x:N(t,"x","sqrt")};return k.runKernel(Ma,e)}var Bt=A({sqrt_:ble});function wle(t,n){let e=N(t,"a","squaredDifference"),r=N(n,"b","squaredDifference");[e,r]=Xe(e,r),Ue(e.shape,r.shape);let o={a:e,b:r},i={};return k.runKernel(Fa,o,i)}var rV=A({squaredDifference_:wle});function Cle(t,n){let e=N(t,"x","squeeze");return B(e,J1(e.shape,n).newShape)}var Sd=A({squeeze_:Cle});function Sle(t,n=0){let e=Tb(t,"tensors","stack","string_or_numeric");M(e.length>=1,()=>"Pass at least one tensor to tf.stack"),e.length>0&&M(n<=e[0].rank,()=>"Axis must be <= rank of the tensor");let r=e,o={axis:n};return k.runKernel(hc,r,o)}var Xn=A({stack_:Sle});function _le(t,n=0){let r={x:N(t,"x","step")},o={alpha:n};return k.runKernel(Va,r,o)}var Ii=A({step_:_le});function Ile(t,n,e,r,o=0,i=0,s=0,a=0,l=0){let u={x:N(t,"x","stridedSlice")},d={begin:n,end:e,strides:r,beginMask:o,endMask:i,ellipsisMask:s,newAxisMask:a,shrinkAxisMask:l};return k.runKernel(Uf,u,d)}var SD=A({stridedSlice_:Ile});function Ele(t){let e={x:N(t,"x","tan")};return k.runKernel($a,e)}var _D=A({tan_:Ele});function Ho(t,n){Ng(t);let e=sd(t,n);if(e.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Oc(t,null,e,n)}function Bc(t,n,e){if(Ng(t),n!=null&&n.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let r=sd(t,e);if(r.length!==2&&r.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(r.length===1&&n==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Oc(t,n,r,e)}function Tle(t,n=1,e=!0){let r=N(t,"x","topk");if(r.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=r.shape[r.shape.length-1];if(n>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${n}`);let i={x:r},s={k:n,sorted:e},[a,l]=k.runKernel(jf,i,s);return{values:a,indices:l}}var oV=A({topk_:Tle});function Dle(t,n=0,e=1,r,o){if(r!=null&&r==="bool")throw new Error("Unsupported data type $ { dtype }");let i=new dm(n,e,r,!0,o),s=Ie(t,r);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var sy=A({truncatedNormal_:Dle});function Nle(t,n=0){let e=N(t,"x","unique","string_or_numeric");M(e.rank>0,()=>"The input tensor must be at least 1D");let r={x:e},o={axis:n},[i,s]=k.runKernel(Gf,r,o);return{values:i,indices:s}}var iV=A({unique_:Nle});function kle(t,n,e){let r=N(t,"x","unsortedSegmentSum"),o=N(n,"segmentIds","unsortedSegmentSum","int32");M(ht(e),()=>"numSegments must be of dtype int");let i={x:r,segmentIds:o},s={numSegments:e};return k.runKernel(kc,i,s)}var Qb=A({unsortedSegmentSum_:kle});function Ale(t,n=0){let e=N(t,"x","unstack","string_or_numeric");M(n>=-e.shape.length&&n<e.shape.length,()=>`Axis = ${n} is not in [-${e.shape.length}, ${e.shape.length})`);let r={value:e},o={axis:n};return k.runKernel(Nc,r,o)}var Ar=A({unstack_:Ale});function ID(t,n=!0,e,r){return k.makeVariable(t,n,e,r)}function sV(t,n){let e=[];for(let i=0;i<n.length;i++)n[i]&&e.push(i);let r=Ie(t,"int32"),o=Ie([e.length,t.length],"int32");for(let i=0;i<e.length;i++){let s=r.indexToLoc(e[i]),a=i*t.length;o.values.set(s,a)}return o.toTensor()}function Rle(t,n="euclidean",e=null,r=!1){t=N(t,"x","norm");let o=aV(t,n,e),i=o.shape;if(r){let s=vn(e,t.shape);i=as(o.shape,s)}return B(o,i)}function aV(t,n,e=null){if(t.rank===0)return bn(t);if(t.rank!==1&&e===null)return aV(B(t,[-1]),n,e);if(t.rank===1||typeof e=="number"||Array.isArray(e)&&e.length===1){if(n===1)return ve(bn(t),e);if(n===1/0)return zn(bn(t),e);if(n===-1/0)return Lc(bn(t),e);if(n==="euclidean"||n===2)return Bt(ve(Go(bn(t),Ae(2,"int32")),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}if(Array.isArray(e)&&e.length===2){if(n===1)return zn(ve(bn(t),e[0]),e[1]-1);if(n===1/0)return zn(ve(bn(t),e[1]),e[0]);if(n===-1/0)return Lc(ve(bn(t),e[1]),e[0]);if(n==="fro"||n==="euclidean")return Bt(ve(We(t),e));throw new Error(`Error in norm: invalid ord value: ${n}`)}throw new Error(`Error in norm: invalid axis: ${e}`)}var mm=A({norm_:Rle});function lV(t,n){if(n==null)return t.shape.slice();if(Zi(t.shape,n))return n;if(t.shape.length===n.length){let e=[];for(let r=0;r<t.shape.length;r++)n[r]==null&&t.shape[r]!=null?e.push(t.shape[r]):e.push(n[r]);return e}return n}function Ole(t,n,e,r){let o=N(t,"x","dropout");if(M(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),M(n>=0&&n<1,()=>`rate must be a float in the range [0, 1), but got ${n}.`),n===0)return t instanceof ct?o.clone():o;let i=lV(o,e),s=1-n,a=me(Ha(ee(qa(i,0,1,"float32",r),s)),s);return V(o,a)}var cV=A({dropout_:Ole});var Dd={};Fi(Dd,{conv2d:()=>uV,depthwiseConv2d:()=>dV,matMul:()=>pV});function Mle(t,n,e,r,o,i="NHWC",s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]])),M(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),M(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),M(e.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${e}.`);let c=i==="NHWC"?a.shape[3]:a.shape[1],u=i==="NHWC"?l.shape[3]:l.shape[1];M(c===e[2],()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${e[2]}.`),M(u===e[3],()=>`Error in conv2dDerFilter: depth of dy (${u}) must match output depth for filter (${e[3]}).`),s!=null&&M(ht(o),()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${s} but got pad ${o}.`);let d={x:a,dy:l},p={strides:r,pad:o,dataFormat:i,dimRoundingMode:s,filterShape:e};return k.runKernel(Cf,d,p)}var hm=A({conv2DBackpropFilter_:Mle});function _d(t,n,e){if(e==null||e==="linear")return t;if(e==="relu")return V(t,Ii(n));throw new Error(`Cannot compute gradient for fused activation ${e}.`)}function Id(t,n){let e=n,r=Ot(t.shape,n.shape);return r.length>0&&(e=ve(e,r)),B(e,t.shape)}function Ed(t,n,e,r){if(n==="linear")return t;if(n==="relu")return Wo(t);if(n==="elu")return Wa(t);if(n==="relu6")return Xb(t);if(n==="prelu")return bd(t,e);if(n==="leakyrelu")return gd(t,r);if(n==="sigmoid")return Uo(t);throw new Error(`Unknown fused activation ${n}.`)}var Td=(t,n)=>!(t>0)||n==="linear";function Fle({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(l=l||"linear",Td(k.state.gradientDepth,l)===!1){let I=Zr(t,n,e,r,o,i,s);return a!=null&&(I=ee(I,a)),Ed(I,l,c,u)}let d=N(t,"x","conv2d"),p=N(n,"filter","conv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),M(f.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${f.rank}.`),M(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),s!=null&&M(ht(r),()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${r}.`),M(f.shape[3]===p.shape[2],()=>`Error in conv2d: depth of input (${f.shape[3]}) must match input depth for filter ${p.shape[2]}.`),M(Ln(e,i),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),M(o==="NHWC",()=>`Error in conv2d: got dataFormat of ${o} but only NHWC is currently supported.`);let h=pd(f.shape,p.shape,e,i,r,s),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Xe(g,d),Ue(h.outShape,g.shape));let y;c!=null&&(y=N(c,"prelu weights","fused conv2d"));let v=(I,E)=>{let[D,O,R,P]=E,U=_d(I,R,l);M(xo(i),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`);let G=sm(O.shape,U,D,e,r),q=hm(O,U,D.shape,e,r),X=[G,q];if(P!=null){let K=Id(P,U);X.push(K)}return X},S={x:f,filter:p,bias:g,preluActivationWeights:y},C={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?bo((E,D,O)=>{let R=k.runKernel(nd,S,C);return O([D,E,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:v}})(f,p):bo((E,D,O,R)=>{let P=k.runKernel(nd,S,C);return R([D,E,P,O]),m&&(P=B(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:v}})(f,p,g)}var uV=A({fusedConv2d_:Fle});function Ple(t,n,e,r,o,i=[1,1],s){let a=t;t.rank===3&&(a=B(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=n;l.rank===3&&(l=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={x:a,dy:l},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,filterShape:e};return k.runKernel(Ef,c,u)}var Zb=A({depthwiseConv2dNativeBackpropFilter_:Ple});function $le(t,n,e,r,o,i=[1,1],s){let a=n,l=!1;n.rank===3&&(l=!0,a=B(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let c={dy:a,filter:e},u={strides:r,pad:o,dimRoundingMode:s,dilations:i,inputShape:t},d=k.runKernel(Tf,c,u);return l?B(d,[d.shape[1],d.shape[2],d.shape[3]]):d}var Jb=A({depthwiseConv2dNativeBackpropInput_:$le});function Lle({x:t,filter:n,strides:e,pad:r,dataFormat:o="NHWC",dilations:i=[1,1],dimRoundingMode:s,bias:a,activation:l="linear",preluActivationWeights:c,leakyreluAlpha:u}){if(Td(k.state.gradientDepth,l)===!1){let I=Ga(t,n,e,r,o,i,s);return a!=null&&(I=ee(I,a)),Ed(I,l,c,u)}let d=N(t,"x","depthwiseConv2d"),p=N(n,"filter","depthwiseConv2d"),f=d,m=!1;d.rank===3&&(m=!0,f=B(d,[1,d.shape[0],d.shape[1],d.shape[2]])),M(f.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${f.rank}.`),M(p.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`),M(f.shape[3]===p.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${f.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`),i==null&&(i=[1,1]),M(Ln(e,i),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${e} and dilations '${i}'`),s!=null&&M(ht(r),()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${s} but got pad ${r}.`);let h=pd(f.shape,p.shape,e,i,r,s,!0),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Xe(g,d),Ue(h.outShape,g.shape));let y;c!=null&&(y=N(c,"prelu weights","fused depthwiseConv2d"));let v=(I,E)=>{M(xo(i),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${i}'`);let[D,O,R,P]=E,U=_d(I,R,l),G=Jb(O.shape,U,D,e,r,i,s),q=Zb(O,U,D.shape,e,r,i,s);if(P!=null){let X=Id(g,U);return[G,q,X]}return[G,q]},S={x:f,filter:p,bias:g,preluActivationWeights:y},C={strides:e,pad:r,dataFormat:o,dilations:i,dimRoundingMode:s,activation:l,leakyreluAlpha:u};return a==null?bo((E,D,O)=>{let R=k.runKernel(rd,S,C);return O([D,E,R]),m&&(R=B(R,[R.shape[1],R.shape[2],R.shape[3]])),{value:R,gradFunc:v}})(f,p):bo((E,D,O,R)=>{let P=k.runKernel(rd,S,C);return R([D,E,P,O]),m&&(P=B(P,[P.shape[1],P.shape[2],P.shape[3]])),{value:P,gradFunc:v}})(f,p,g)}var dV=A({fusedDepthwiseConv2d_:Lle});function Vle({a:t,b:n,transposeA:e=!1,transposeB:r=!1,bias:o,activation:i="linear",preluActivationWeights:s,leakyreluAlpha:a}){if(Td(k.state.gradientDepth,i)===!1){let P=gt(t,n,e,r);return o!=null&&(P=ee(P,o)),Ed(P,i,s,a)}let l=N(t,"a","fused matMul"),c=N(n,"b","fused matMul");[l,c]=Xe(l,c);let u=e?l.shape[l.rank-2]:l.shape[l.rank-1],d=r?c.shape[c.rank-1]:c.shape[c.rank-2],p=e?l.shape[l.rank-1]:l.shape[l.rank-2],f=r?c.shape[c.rank-2]:c.shape[c.rank-1],m=l.shape.slice(0,-2),h=c.shape.slice(0,-2),g=Rt(m),y=Rt(h);M(l.rank>=2&&c.rank>=2&&l.rank===c.rank,()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${l.rank} and ${c.rank}.`),M(Zi(m,h),()=>`Error in fused matMul: outer dimensions (${m}) and (${h}) of Tensors with shapes ${l.shape} and ${c.shape} must match.`),M(u===d,()=>`Error in fused matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${l.shape} and ${c.shape} and transposeA=${e} and transposeB=${r} must match.`);let v=l.shape.slice(0,-2).concat([p,f]),S=e?B(l,[g,u,p]):B(l,[g,p,u]),C=r?B(c,[y,f,d]):B(c,[y,d,f]),I;o!=null&&(I=N(o,"bias","fused matMul"),[I]=Xe(I,l),Ue(v,I.shape));let E;s!=null&&(E=N(s,"prelu weights","fused matMul"));let D=(P,U)=>{let[G,q,X,K]=U,Y=_d(B(P,X.shape),X,i),ne,J;if(!e&&!r?(ne=gt(Y,q,!1,!0),J=gt(G,Y,!0,!1)):!e&&r?(ne=gt(Y,q,!1,!1),J=gt(Y,G,!0,!1)):e&&!r?(ne=gt(q,Y,!1,!0),J=gt(G,Y,!1,!1)):(ne=gt(q,Y,!0,!0),J=gt(Y,G,!0,!0)),o!=null){let te=Id(K,Y);return[ne,J,te]}else return[ne,J]},O={a:S,b:C,bias:I,preluActivationWeights:E},R={transposeA:e,transposeB:r,activation:i,leakyreluAlpha:a};return o==null?bo((U,G,q)=>{let X=k.runKernel(td,O,R);return q([U,G,X]),{value:B(X,v),gradFunc:D}})(S,C):bo((U,G,q,X)=>{let K=k.runKernel(td,O,R);return X([U,G,K,q]),{value:B(K,v),gradFunc:D}})(S,C,I)}var pV=A({fusedMatMul_:Vle});function fV(t,n,e){let r=Ble(t,n,e),o=r<0?-(r+1):r;t.splice(o,0,n)}function Ble(t,n,e){return Ule(t,n,e||zle)}function zle(t,n){return t>n?1:t<n?-1:0}function Ule(t,n,e){let r=0,o=t.length,i=0,s=!1;for(;r<o;){i=r+(o-r>>>1);let a=e(n,t[i]);a>0?r=i+1:(o=i,s=!a)}return s?r:-r-1}function hV(t,n,e,r,o){return ED(t,n,e,r,o,0)}function gV(t,n,e,r,o,i){return ED(t,n,e,r,o,0,!1,i,!0)}function yV(t,n,e,r,o,i){return ED(t,n,e,r,o,i,!0)}function ED(t,n,e,r,o,i,s=!1,a=!1,l=!1){let c=[];for(let g=0;g<n.length;g++)n[g]>o&&c.push({score:n[g],boxIndex:g,suppressBeginIndex:0});c.sort(mV);let u=i>0?-.5/i:0,d=[],p=[];for(;d.length<e&&c.length>0;){let g=c.pop(),{score:y,boxIndex:v,suppressBeginIndex:S}=g;if(y<o)break;let C=!1;for(let I=d.length-1;I>=S;--I){let E=jle(t,v,d[I]);if(E>=r){C=!0;break}if(g.score=g.score*Gle(r,u,E),g.score<=o)break}g.suppressBeginIndex=d.length,C||(g.score===y?(d.push(v),p.push(g.score)):g.score>o&&fV(c,g,mV))}let f=d.length,m=e-f;a&&m>0&&(d.push(...new Array(m).fill(0)),p.push(...new Array(m).fill(0)));let h={selectedIndices:d};return s&&(h.selectedScores=p),l&&(h.validOutputs=f),h}function jle(t,n,e){let r=t.subarray(n*4,n*4+4),o=t.subarray(e*4,e*4+4),i=Math.min(r[0],r[2]),s=Math.min(r[1],r[3]),a=Math.max(r[0],r[2]),l=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),u=Math.min(o[1],o[3]),d=Math.max(o[0],o[2]),p=Math.max(o[1],o[3]),f=(a-i)*(l-s),m=(d-c)*(p-u);if(f<=0||m<=0)return 0;let h=Math.max(i,c),g=Math.max(s,u),y=Math.min(a,d),v=Math.min(l,p),S=Math.max(y-h,0)*Math.max(v-g,0);return S/(f+m-S)}function Gle(t,n,e){let r=Math.exp(n*e*e);return e<=t?r:0}function mV(t,n){return t.score-n.score||t.score===n.score&&n.boxIndex-t.boxIndex}function Wle(t,n,e=!1,r=!1){let o=N(t,"images","resizeBilinear");M(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),M(n.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${n}.`),M(r===!1||e===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(bc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var xV=A({resizeBilinear_:Wle});function Hle(t,n,e=!1,r=!1){let o=N(t,"images","resizeNearestNeighbor");M(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),M(n.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${n}.`),M(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),M(r===!1||e===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let i=o,s=!1;o.rank===3&&(s=!0,i=B(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=n,a={images:i},l={alignCorners:e,halfPixelCenters:r,size:n},c=k.runKernel(vc,a,l);return s?B(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var vV=A({resizeNearestNeighbor_:Hle});function qle(t,n,e){M(n%1===0,()=>`bandPart(): numLower must be an integer, got ${n}.`),M(e%1===0,()=>`bandPart(): numUpper must be an integer, got ${e}.`);let r=N(t,"a","bandPart");M(r.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${r.rank}.`);let o=r.shape,[i,s]=r.shape.slice(-2);if(!(n<=i))throw new Error(`bandPart(): numLower (${n}) must not be greater than the number of rows (${i}).`);if(!(e<=s))throw new Error(`bandPart(): numUpper (${e}) must not be greater than the number of columns (${s}).`);n<0&&(n=i),e<0&&(e=s);let a=B(yD(0,i,1,"int32"),[-1,1]),l=yD(0,s,1,"int32"),c=we(a,l),u=ar(is(c,Ae(+n,"int32")),vo(c,Ae(-e,"int32"))),d=Vt([i,s],r.dtype);return B(Xn(Ar(B(r,[-1,i,s])).map(p=>an(u,p,d))),o)}var bV=A({bandPart_:qle});function Kle(t){let n;if(Array.isArray(t)){n=!1,M(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let i=1;i<t.length;++i)M(t[i].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[i].shape[0]} vs. ${o})`)}else n=!0,t=Un(t,t.shape[0],0).map(o=>Sd(o,[0]));M(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let e=[],r=t;for(let o=0;o<t.length;++o)e.push(k.tidy(()=>{let i=r[o];if(o>0)for(let s=0;s<o;++s){let a=V(ve(V(e[s],i)),e[s]);i=we(i,a)}return me(i,mm(i,"euclidean"))}));return n?Xn(e,0):e}var wV=A({gramSchmidt_:Kle});function Xle(t,n=!1){if(M(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return CV(t,n);{let e=t.shape.slice(0,t.shape.length-2).reduce((l,c)=>l*c),r=Ar(B(t,[e,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],i=[];r.forEach(l=>{let[c,u]=CV(l,n);o.push(c),i.push(u)});let s=B(Xn(o,0),t.shape),a=B(Xn(i,0),t.shape);return[s,a]}}function CV(t,n=!1){return k.tidy(()=>{M(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let e=t.shape[0],r=t.shape[1],o=am(e),i=Si(t),s=Bc([[1]],[1,1]),a=Si(s),l=e>=r?r:e;for(let c=0;c<l;++c){let u=i,d=a,p=o;[a,i,o]=k.tidy(()=>{let f=it(i,[c,c],[e-c,1]),m=mm(f),h=it(i,[c,c],[1,1]),g=an(Bn(h,0),Bc([[-1]]),Bc([[1]])),y=we(h,V(g,m)),v=me(f,y);v.shape[0]===1?a=Si(s):a=Lt([s,it(v,[1,0],[v.shape[0]-1,v.shape[1]])],0);let S=yt(me(gt(g,y),m)),C=it(i,[c,0],[e-c,r]),I=V(S,a),E=ot(a);if(c===0)i=we(C,gt(I,gt(E,C)));else{let R=we(C,gt(I,gt(E,C)));i=Lt([it(i,[0,0],[c,r]),R],0)}let D=ot(I),O=it(o,[0,c],[e,o.shape[1]-c]);if(c===0)o=we(O,gt(gt(O,a),D));else{let R=we(O,gt(gt(O,a),D));o=Lt([it(o,[0,0],[e,c]),R],1)}return[a,i,o]}),Fe([u,d,p])}return!n&&e>r&&(o=it(o,[0,0],[e,r]),i=it(i,[0,0],[r,r])),[o,i]})}var SV=A({qr_:Xle});var _V={bandPart:bV,gramSchmidt:wV,qr:SV};var Yn=class extends Ug{minimize(n,e=!1,r){let{value:o,grads:i}=this.computeGradients(n,r);if(r!=null){let s=r.map(a=>({name:a.name,tensor:i[a.name]}));this.applyGradients(s)}else this.applyGradients(i);return Fe(i),e?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(n,e){return rD(n,e)}dispose(){this.iterations_!=null&&Fe(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Ae(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(n){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(n){return this.iterations_=(await n[0].tensor.data())[0],n.slice(1)}};Object.defineProperty(Yn,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var TD=(()=>{class t extends Yn{constructor(e,r,o=null){super(),this.learningRate=e,this.rho=r,this.epsilon=o,this.accumulatedGrads=[],this.accumulatedUpdates=[],o==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accum_grad`,variable:z(()=>Ee(s).variable(a))}),this.accumulatedUpdates[i]==null&&(this.accumulatedUpdates[i]={originalName:`${o}/accum_var`,variable:z(()=>Ee(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedGrads[i].variable,u=this.accumulatedUpdates[i].variable;z(()=>{let d=ee(V(c,this.rho),V(We(l),1-this.rho)),p=V(me(Bt(ee(u,this.epsilon)),Bt(ee(c,this.epsilon))),l),f=ee(V(u,this.rho),V(We(p),1-this.rho));c.assign(d),u.assign(f);let m=ee(V(p,-this.learningRate),s);s.assign(m)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Fe(this.accumulatedGrads.map(e=>e.variable)),Fe(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,o=!1;this.accumulatedGrads=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedUpdates=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}}return t.className="Adadelta",t})();kr(TD);var DD=(()=>{class t extends Yn{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulatedGrads[i]==null&&(this.accumulatedGrads[i]={originalName:`${o}/accumulator`,variable:z(()=>Kg(s.shape,this.initialAccumulatorValue).variable(!1))});let a=Array.isArray(e)?e[i].tensor:e[o];if(a==null)return;let l=this.accumulatedGrads[i].variable;z(()=>{let c=ee(l,We(a));l.assign(c);let u=ee(V(me(a,Bt(ee(c,k.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Fe(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}}return t.className="Adagrad",t})();kr(DD);var ND=(()=>{class t extends Yn{constructor(e,r,o,i=null){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],z(()=>{this.accBeta1=Ae(r).variable(),this.accBeta2=Ae(o).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);z(()=>{let o=we(1,this.accBeta1),i=we(1,this.accBeta2);r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:z(()=>Ee(l).variable(c))}),this.accumulatedSecondMoment[a]==null&&(this.accumulatedSecondMoment[a]={originalName:`${s}/v`,variable:z(()=>Ee(l).variable(c))});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedSecondMoment[a].variable,f=ee(V(d,this.beta1),V(u,1-this.beta1)),m=ee(V(p,this.beta2),V(We(u),1-this.beta2)),h=me(f,o),g=me(m,i);d.assign(f),p.assign(m);let y=ee(V(me(h,ee(Bt(g),this.epsilon)),-this.learningRate),l);l.assign(y)}),this.accBeta1.assign(V(this.accBeta1,this.beta1)),this.accBeta2.assign(V(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Fe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Fe(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),z(()=>{this.accBeta1.assign(Go(this.beta1,this.iterations_+1)),this.accBeta2.assign(Go(this.beta2,this.iterations_+1))});let r=e.length/2,o=!1;this.accumulatedFirstMoment=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}}return t.className="Adam",t})();kr(ND);var kD=(()=>{class t extends Yn{constructor(e,r,o,i=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=o,this.epsilon=i,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],z(()=>{this.iteration=Ae(0).variable(),this.accBeta1=Ae(r).variable()}),i==null&&(this.epsilon=k.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(o=>o.name):Object.keys(e);z(()=>{let o=we(1,this.accBeta1),i=me(-this.learningRate,ee(V(this.iteration,this.decay),1));r.forEach((s,a)=>{let l=k.registeredVariables[s],c=!1;this.accumulatedFirstMoment[a]==null&&(this.accumulatedFirstMoment[a]={originalName:`${s}/m`,variable:Ee(l).variable(c)}),this.accumulatedWeightedInfNorm[a]==null&&(this.accumulatedWeightedInfNorm[a]={originalName:`${s}/v`,variable:Ee(l).variable(c)});let u=Array.isArray(e)?e[a].tensor:e[s];if(u==null)return;let d=this.accumulatedFirstMoment[a].variable,p=this.accumulatedWeightedInfNorm[a].variable,f=ee(V(d,this.beta1),V(u,1-this.beta1)),m=V(p,this.beta2),h=bn(u),g=Jr(m,h);d.assign(f),p.assign(g);let y=ee(V(me(i,o),me(f,ee(g,this.epsilon))),l);l.assign(y)}),this.iteration.assign(ee(this.iteration,1)),this.accBeta1.assign(V(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Fe(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Fe(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}}return t.className="Adamax",t})();kr(kD);var ay=(()=>{class t extends Yn{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=Array.isArray(e)?e[i].tensor:e[o];if(s==null)return;let a=k.registeredVariables[o];z(()=>{let l=ee(V(this.c,s),a);a.assign(l)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=An(Ae(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}}return t.className="SGD",t})();kr(ay);var AD=(()=>{class t extends ay{constructor(e,r,o=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=o,this.accumulations=[],this.m=Ae(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o];this.accumulations[i]==null&&(this.accumulations[i]={originalName:`${o}/momentum`,variable:z(()=>Ee(s).variable(!1))});let a=this.accumulations[i].variable,l=Array.isArray(e)?e[i].tensor:e[o];l!=null&&z(()=>{let c,u=ee(V(this.m,a),l);this.useNesterov?c=ee(V(this.c,ee(l,V(u,this.m))),s):c=ee(V(this.c,u),s),a.assign(u),s.assign(c)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Fe(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(o=>({originalName:o.name,variable:o.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}}return t.className="Momentum",t})();kr(AD);var RD=(()=>{class t extends Yn{constructor(e,r=.9,o=0,i=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=o,this.epsilon=i,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,i==null&&(this.epsilon=k.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(o=>o.name):Object.keys(e)).forEach((o,i)=>{let s=k.registeredVariables[o],a=!1;this.accumulatedMeanSquares[i]==null&&(this.accumulatedMeanSquares[i]={originalName:`${o}/rms`,variable:z(()=>Ee(s).variable(a))}),this.accumulatedMoments[i]==null&&(this.accumulatedMoments[i]={originalName:`${o}/momentum`,variable:z(()=>Ee(s).variable(a))}),this.accumulatedMeanGrads[i]==null&&this.centered&&(this.accumulatedMeanGrads[i]={originalName:`${o}/mg`,variable:z(()=>Ee(s).variable(a))});let l=Array.isArray(e)?e[i].tensor:e[o];if(l==null)return;let c=this.accumulatedMeanSquares[i].variable,u=this.accumulatedMoments[i].variable;z(()=>{let d=ee(V(c,this.decay),V(We(l),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[i].variable,f=ee(V(p,this.decay),V(l,1-this.decay)),m=me(V(l,this.learningRate),Bt(we(d,ee(We(f),this.epsilon)))),h=ee(V(u,this.momentum),m);c.assign(d),p.assign(f),u.assign(h);let g=we(s,h);s.assign(g)}else{let p=ee(V(c,this.decay),V(We(l),1-this.decay)),f=ee(V(u,this.momentum),me(V(l,this.learningRate),Bt(ee(p,this.epsilon))));c.assign(p),u.assign(f);let m=we(s,f);s.assign(m)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Fe(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Fe(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Fe(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,o=!1;this.accumulatedMeanSquares=e.slice(0,r).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.accumulatedMoments=e.slice(r,r*2).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(i=>({originalName:i.name,variable:i.tensor.variable(o)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}}return t.className="RMSProp",t})();kr(RD);var ls=class{static sgd(n){return new ay(n)}static momentum(n,e,r=!1){return new AD(n,e,r)}static rmsprop(n,e=.9,r=0,o=null,i=!1){return new RD(n,e,r,o,i)}static adam(n=.001,e=.9,r=.999,o=null){return new ND(n,e,r,o)}static adadelta(n=.001,e=.95,r=null){return new TD(n,e,r)}static adamax(n=.002,e=.9,r=.999,o=null,i=0){return new kD(n,e,r,o,i)}static adagrad(n,e=.1){return new DD(n,e)}};var Nd={sgd:ls.sgd,momentum:ls.momentum,adadelta:ls.adadelta,adagrad:ls.adagrad,rmsprop:ls.rmsprop,adamax:ls.adamax,adam:ls.adam};var Yle=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t();function ly(){return new Promise(t=>Yle(()=>t()))}var T={};Fi(T,{ERF_A1:()=>ace,ERF_A2:()=>lce,ERF_A3:()=>cce,ERF_A4:()=>uce,ERF_A5:()=>dce,ERF_P:()=>sce,PARALLELIZE_THRESHOLD:()=>ew,SELU_SCALE:()=>MD,SELU_SCALEALPHA:()=>OD,applyActivation:()=>Ed,assertAndGetBroadcastShape:()=>Ue,assertAxesAreInnerMostDims:()=>yae,assertParamsConsistent:()=>Qle,assignToTypedArray:()=>vce,axesAreInnerMostDims:()=>iD,calculateShapes:()=>Aie,checkEinsumDimSizes:()=>Ice,combineLocations:()=>FL,complexWithEvenIndex:()=>gce,complexWithOddIndex:()=>yce,computeConv2DInfo:()=>pd,computeConv3DInfo:()=>TL,computeDefaultPad:()=>VT,computeDilation2DInfo:()=>Jie,computeOptimalWindowSize:()=>Jle,computeOutAndReduceShapes:()=>sD,computeOutShape:()=>Zle,computePool2DInfo:()=>LT,computePool3DInfo:()=>ese,convertConv2DDataFormat:()=>DL,decodeEinsumEquation:()=>Sce,eitherStridesOrDilationsAreOne:()=>Ln,expandShapeToKeepDim:()=>as,exponent:()=>wce,exponents:()=>bce,fromStringArrayToUint8:()=>Mce,fromUint8ToStringArray:()=>Oce,getAxesPermutation:()=>aD,getBroadcastDims:()=>$se,getComplexWithIndex:()=>xce,getEinsumComputePath:()=>Ece,getEinsumPermutation:()=>_ce,getFusedBiasGradient:()=>Id,getFusedDyActivation:()=>_d,getImageCenter:()=>ece,getInnerMostAxes:()=>xae,getPermuted:()=>nce,getReductionAxes:()=>Ot,getReshaped:()=>tce,getReshapedPermuted:()=>rce,getSliceBeginCoords:()=>oce,getSliceSize:()=>ice,getUndoAxesPermutation:()=>Yg,isIdentityPermutation:()=>Tce,log:()=>fce,mergeRealAndImagArrays:()=>mce,prepareAndValidate:()=>Nie,prepareSplitSize:()=>Nce,segment_util:()=>PD,shouldFuse:()=>Td,slice_util:()=>qn,splitRealAndImagArrays:()=>hce,tupleValuesAreOne:()=>xo,upcastType:()=>Cn,validateInput:()=>kie,validateUpdateShape:()=>fL,warn:()=>pce});function Qle(t,n){let e=t[0].length;t.forEach((o,i)=>{M(o.length===e,()=>`Error in concat${e}D: rank of tensors[${i}] must be the same as the rank of the rest (${e})`)}),M(n>=0&&n<e,()=>`Error in concat${e}D: axis must be between 0 and ${e-1}.`);let r=t[0];t.forEach((o,i)=>{for(let s=0;s<e;s++)M(s===n||o[s]===r[s],()=>`Error in concat${e}D: Shape of tensors[${i}] (${o}) does not match the shape of the rest (${r}) along the non-concatenated axis ${i}.`)})}function Zle(t,n){let e=t[0].slice();for(let r=1;r<t.length;r++)e[n]+=t[r][n];return e}var ew=30;function Jle(t){return t<=ew?t:mf(t,Math.floor(Math.sqrt(t)))}function ece(t,n,e){let r=e*(typeof t=="number"?t:t[0]),o=n*(typeof t=="number"?t:t[1]);return[r,o]}function tce(t,n,e,r=!0){let o=[];if(r)o=o.concat(n.slice(0)),o.push(t[0]/e),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let i=n.length;for(let s=0;s<i;++s)o=o.concat([t[s+1]/n[s],n[s]]);o=o.concat(t.slice(i+1))}return o}function nce(t,n,e=!0){let r=[];if(e){r.push(n);for(let o=n+1;o<t;++o)o<=2*n?(r.push(o),r.push(o-(n+1))):r.push(o)}else{let o=[],i=[];for(let s=1;s<t;++s)s>=n*2+1||s%2===1?i.push(s):o.push(s);r.push(...o),r.push(0),r.push(...i)}return r}function rce(t,n,e,r=!0){let o=[];r?o.push(t[0]/e):o.push(t[0]*e);for(let i=1;i<t.length;++i)i<=n.length?r?o.push(n[i-1]*t[i]):o.push(t[i]/n[i-1]):o.push(t[i]);return o}function oce(t,n){let e=[0];for(let r=0;r<n;++r)e.push(t[r][0]);return e}function ice(t,n,e){let r=t.slice(0,1);for(let o=0;o<e;++o)r.push(t[o+1]-n[o][0]-n[o][1]);return r}var OD=1.7580993408473768,MD=1.0507009873554805;var sce=.3275911,ace=.254829592,lce=-.284496736,cce=1.421413741,uce=-1.453152027,dce=1.061405429;function pce(...t){H().getBool("IS_TEST")||console.warn(...t)}function fce(...t){H().getBool("IS_TEST")||console.log(...t)}function mce(t,n){if(t.length!==n.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${n.length}.`);let e=new Float32Array(t.length*2);for(let r=0;r<e.length;r+=2)e[r]=t[r/2],e[r+1]=n[r/2];return e}function hce(t){let n=new Float32Array(t.length/2),e=new Float32Array(t.length/2);for(let r=0;r<t.length;r+=2)n[r/2]=t[r],e[r/2]=t[r+1];return{real:n,imag:e}}function gce(t){let n=Math.ceil(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=0;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function yce(t){let n=Math.floor(t.length/4),e=new Float32Array(n),r=new Float32Array(n);for(let o=2;o<t.length;o+=4)e[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:e,imag:r}}function xce(t,n){let e=t[n*2],r=t[n*2+1];return{real:e,imag:r}}function vce(t,n,e,r){t[r*2]=n,t[r*2+1]=e}function bce(t,n){let e=new Float32Array(t/2),r=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let i=(n?2:-2)*Math.PI*(o/t);e[o]=Math.cos(i),r[o]=Math.sin(i)}return{real:e,imag:r}}function wce(t,n,e){let r=(e?2:-2)*Math.PI*(t/n),o=Math.cos(r),i=Math.sin(r);return{real:o,imag:i}}var FD="->",Cce=/->/g,IV=",",EV="...";function Sce(t,n){t=t.replace(/\s/g,"");let e=(t.length-t.replace(Cce,"").length)/FD.length;if(e<1)throw new Error("Equations without an arrow are not supported.");if(e>1)throw new Error(`Equation must contain exactly one arrow ("${FD}").`);let[r,o]=t.split(FD);M(r.indexOf(EV)===-1,()=>`The ellipsis notation ("${EV}") is not supported yet.`);let i=r.split(IV),s=i.length;if(n!==s)throw new Error(`Expected ${s} input tensors, received ${n}`);if(s>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let p=0;p<o.length;++p){let f=o[p];if(!i.some(m=>m.indexOf(f)!==-1))throw new Error(`Output subscripts contain the label ${f} not present in the input subscripts.`);a.indexOf(f)===-1&&a.push(f)}for(let p=0;p<r.length;++p){let f=r[p];a.indexOf(f)===-1&&f!==IV&&a.push(f)}let l=new Array(i.length);for(let p=0;p<s;++p){if(new Set(i[p].split("")).size!==i[p].length)throw new Error(`Found duplicate axes in input component ${i[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let f=0;f<i[p].length;++f)l[p].push(a.indexOf(i[p][f]))}let c=a.length,u=o.length,d=[];for(let p=u;p<c;++p)d.push(p);return{allDims:a,summedDims:d,idDims:l}}function _ce(t,n){let e=new Array(t);e.fill(-1);for(let o=0;o<n.length;++o)e[n[o]]=o;let r=[];for(let o=0;o<t;++o)e[o]===-1&&r.push(o);return e=e.filter(o=>o!==-1),{permutationIndices:e,expandDims:r}}function Ice(t,n,e){let r=new Array(t);for(let o=0;o<e.length;++o){let i=e[o].shape;for(let s=0;s<n[o].length;++s)r[n[o][s]]===void 0?r[n[o][s]]=i[s]:M(r[n[o][s]]===i[s],()=>`Expected dimension ${r[n[o][s]]} at axis ${s} of input shaped ${JSON.stringify(i)}, but got dimension ${i[s]}`)}}function Ece(t,n){let e=t,r=[],o=0;t.length===0&&e.push(-1),o=t.length+1;for(let s=0;s<o;++s)r.push([]);let i=[];for(let s=0;s<e.length;++s){let a=e[s],l=Dce(n,a);for(let c of l)i.indexOf(c)===-1&&(r[s].push(c),i.push(c))}return{path:e,steps:r}}function Tce(t){return t.every((n,e)=>n===e)}function Dce(t,n){let e=[];for(let r=0;r<t.length;++r)(t[r].length===0||t[r].indexOf(n)!==-1||n===-1)&&e.push(r);return e}function Nce(t,n,e=0){let r=[];if(typeof n=="number")M(t.shape[e]%n===0,()=>"Number of splits must evenly divide the axis."),r=new Array(n).fill(t.shape[e]/n);else{let o=n.reduce((s,a)=>(a===-1&&(s+=1),s),0);M(o<=1,()=>"There should be only one negative value in split array.");let i=n.indexOf(-1);if(i!==-1){let s=n.reduce((a,l)=>l>0?a+l:a);n[i]=t.shape[e]-s}M(t.shape[e]===n.reduce((s,a)=>s+a),()=>"The sum of sizes must match the size of the axis dimension."),r=n}return r}var PD={};Fi(PD,{collectGatherOpShapeInfo:()=>Rce,computeOutShape:()=>Ace,segOpComputeOptimalWindowSize:()=>kce});function kce(t,n){let e=!1,r;for(t<=ew?(r=t,e=!0):r=mf(t,Math.floor(Math.sqrt(t)));!e;)r>n||r===t?e=!0:r=mf(t,r+1);return r}function Ace(t,n,e){let r=[],o=t.length;for(let i=0;i<o;i++)i!==n?r.push(t[i]):r.push(e);return r}function Rce(t,n,e,r){let o=n.shape.length,i=t.shape.length;if(r!==0&&(r<-o||r>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${r}`);if(r<0&&(r+=o),r>i)throw new Error(`batchDims (${r}) must be less than rank(x) (
    ${i}).`);if(e<r)throw new Error(`batchDims (${r}) must be less than or equal to axis (${e}).`);for(let d=0;d<r;++d)if(t.shape[d]!==n.shape[d])throw new Error(`x.shape[${d}]: ${t.shape[d]} should be equal to indices.shape[${d}]: ${n.shape[d]}.`);let s=t.shape[e],a=[],l=1,c=1,u=1;for(let d=0;d<r;++d)a.push(t.shape[d]),l*=t.shape[d];for(let d=r;d<e;d++)a.push(t.shape[d]),c*=t.shape[d];for(let d=r;d<o;d++)a.push(n.shape[d]);for(let d=e+1;d<i;d++)a.push(t.shape[d]),u*=t.shape[d];return{batchSize:l,sliceSize:u,outerSize:c,dimSize:s,outputShape:a}}function Oce(t){try{return t.map(n=>qf(n))}catch(n){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${n}`)}}function Mce(t){return t.map(n=>Hf(n))}var Qn={};Fi(Qn,{nonMaxSuppressionV3Impl:()=>hV,nonMaxSuppressionV4Impl:()=>gV,nonMaxSuppressionV5Impl:()=>yV,whereImpl:()=>sV});var tw={kernelName:Bl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Ii(le(e,"float32"),-1))}}};var TV={kernelName:Ks,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=We(le(e,"float32")),o=Bt(we(Ae(1),r));return yt(me(t,o))}}}};var DV={kernelName:Xs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Bt(we(We(le(e,"float32")),1));return me(t,r)}}}};var NV={kernelName:vi,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=t,l=Ot(e.shape,o);return l.length>0&&(a=ve(a,l)),B(a,e.shape)},b:()=>{let a=t,l=Ot(r.shape,o);return l.length>0&&(a=ve(a,l)),B(a,r.shape)}}}};var kV={kernelName:gf,saveAllInputs:!0,gradFunc:(t,n)=>{let e={};return n.forEach((r,o)=>{e[o]=()=>t.clone()}),e}};var AV={kernelName:zl,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Ee(e)}}};var RV={kernelName:Ul,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>Ee(e)}}};var OV={kernelName:Ys,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,Bt(we(Ae(1),We(le(e,"float32")))))}}};var MV={kernelName:Qs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Bt(ee(Ae(1),We(le(e,"float32"))));return me(t,r)}}}};var FV={kernelName:ea,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=ee(We(e),We(r)),l=V(t,me(r,a)),c=Ot(e.shape,o);return c.length>0&&(l=ve(l,c)),B(l,e.shape)},b:()=>{let a=ee(We(e),We(r)),l=yt(V(t,me(e,a))),c=Ot(r.shape,o);return c.length>0&&(l=ve(l,c)),B(l,r.shape)}}}};var PV={kernelName:Zs,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,ee(We(le(e,"float32")),1))}}};var $V={kernelName:Js,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,we(Ae(1),We(le(e,"float32"))))}}};function Fce(t,n,e,r,o,i){let s=N(t,"dy","avgPool3dGrad"),a=N(n,"input","avgPool3dGrad"),l=s,c=a,u=!1;a.rank===4&&(u=!0,l=B(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),c=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),M(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),M(c.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${c.rank}.`),i!=null&&M(ht(o),()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${i} but got pad ${o}.`);let d={dy:l,input:c},p={filterSize:e,strides:r,pad:o,dimRoundingMode:i},f=k.runKernel(bf,d,p);return u?B(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var LV=A({avgPool3dGrad_:Fce});var VV={kernelName:Gl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s,dimRoundingMode:a}=e;return{x:()=>LV(t,r,o,i,s,a)}}};function Pce(t,n,e,r,o){let i=N(t,"dy","avgPoolGrad"),s=N(n,"input","avgPoolGrad");M(s.rank===i.rank,()=>`Rank of input (${s.rank}) does not match rank of dy (${i.rank})`);let a=s,l=i,c=!1;s.rank===3&&(c=!0,a=B(s,[1,s.shape[0],s.shape[1],s.shape[2]]),l=B(i,[1,i.shape[0],i.shape[1],i.shape[2]])),M(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),M(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let u={dy:l,input:a},d={filterSize:e,strides:r,pad:o},p=k.runKernel(vf,u,d);return c?B(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var BV=A({avgPoolGrad_:Pce});var zV={kernelName:jl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{filterSize:o,strides:i,pad:s}=e;return{x:()=>BV(t,r,o,i,s)}}};var UV={kernelName:Wl,inputsToSave:["a","b"],gradFunc:(t,n,e)=>{let[r,o]=n,{transposeA:i,transposeB:s}=e;return!i&&!s?{a:()=>gt(t,o,!1,!0),b:()=>gt(r,t,!0,!1)}:!i&&s?{a:()=>gt(t,o,!1,!1),b:()=>gt(t,r,!0,!1)}:i&&!s?{a:()=>gt(o,t,!1,!0),b:()=>gt(r,t,!1,!1)}:{a:()=>gt(o,t,!0,!0),b:()=>gt(t,r,!0,!0)}}};var jV={kernelName:Hl,gradFunc:(t,n,e)=>{let{blockShape:r,crops:o}=e;return{x:()=>um(t,r,o)}}};var GV={kernelName:y$,gradFunc:(t,n,e)=>{let r=e,o=r.inputShape,i=r.shape,s=Array.from(i);for(let l=o.length-1;l>=0;l--)if(o[l]===i[l])s[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${i}].`);let a=[];for(let l=0;l<s.length;l++)s[l]>1&&a.push(l);return{x:()=>ve(t,a,!0)}}};var WV={kernelName:es,gradFunc:t=>({x:()=>t.clone()})};var HV={kernelName:ta,gradFunc:t=>({x:()=>Ee(t)})};var qV={kernelName:na,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{clipValueMin:o,clipValueMax:i}=e;return{x:()=>an(ar(vo(r,o),is(r,i)),t,Ee(t))}}};var KV={kernelName:ql,inputsToSave:["x"],gradFunc:tw.gradFunc};var XV={kernelName:Kl,saveAllInputs:!0,gradFunc:(t,n,e)=>{let r=n.map(l=>l.shape),{axis:o}=e,i=vn(o,n[0].shape)[0],s=r.map(l=>l[i]);return Un(t,s,i).map(l=>()=>l)}};var YV={kernelName:Xl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{dilations:i,strides:s,pad:a,dataFormat:l}=e;return M(xo(i),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${i}'`),{x:()=>sm(r.shape,t,o,s,a,l),filter:()=>hm(r,t,o.shape,s,a,l)}}};var QV={kernelName:Yl,inputsToSave:["dy","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,{strides:i,pad:s,dataFormat:a,dimRoundingMode:l}=e;return{dy:()=>Zr(t,o,i,s,a,1,l),filter:()=>hm(t,r,o.shape,i,s,a,l)}}};function $ce(t,n,e,r,o){let i=t;t.rank===4&&(i=B(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let s=n;s.rank===4&&(s=B(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]])),M(i.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${i.shape}.`),M(s.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${s.shape}.`),M(e.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${e}.`),M(i.shape[4]===e[3],()=>`Error in conv3dDerFilter: depth of input ${i.shape[4]}) must match input depth in filter (${e[3]}.`),M(s.shape[4]===e[4],()=>`Error in conv3dDerFilter: depth of dy (${s.shape[4]}) must match output depth for filter (${e[4]}).`);let a={x:i,dy:s},l={strides:r,pad:o,filterShape:e};return k.runKernel(Sf,a,l)}var ZV=A({conv3DBackpropFilter_:$ce});var JV={kernelName:Ql,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i}=e;M(xo(r),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`);let[s,a]=n;return{x:()=>Bb(s.shape,t,a,o,i),filter:()=>ZV(s,t,a.shape,o,i)}}};var e3={kernelName:ra,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(yt(ty(le(e,"float32"))),t)}}};var t3={kernelName:oa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(ny(le(e,"float32")),t)}}};var n3={kernelName:Zl,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o,exclusive:i,reverse:s}=e;return{x:()=>{let a=aD([o],r.rank),l=zb(t,o,i,!s);return a!=null&&(l=ot(l,a)),l}}}};var r3={kernelName:Jl,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let{dilations:r,strides:o,pad:i,dimRoundingMode:s}=e,a=r??[1,1];M(xo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,c]=n;return M(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),M(c.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`),M(l.shape[3]===c.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`),M(Ln(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),s!=null&&M(ht(i),()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`),{x:()=>Jb(l.shape,t,c,o,i,r,s),filter:()=>Zb(l,t,c.shape,o,i,r,s)}}};var o3={kernelName:ec,inputsToSave:["x","filter"],gradFunc:(t,n,e)=>{let[r,o]=n,i={x:r,filter:o,dy:t},s={x:r,filter:o,dy:t};return{x:()=>k.runKernel(Fg,i,e),filter:()=>k.runKernel(Pg,s,e)}}};var i3={kernelName:sa,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n,r={dy:t,y:e};return{x:()=>k.runKernel(Df,r)}}};var s3={kernelName:aa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(fr(yt(We(e))),2/Math.sqrt(Math.PI));return{x:()=>V(t,r)}}};var a3={kernelName:la,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,e)}}};var l3={kernelName:tc,inputsToSave:["input"],gradFunc:(t,n)=>{let[e]=n;return{input:()=>B(t,e.shape)}}};var c3={kernelName:ca,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,fr(e))}}};var u3={kernelName:ua,gradFunc:t=>({x:()=>Ee(t)})};var d3={kernelName:da,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=me(t,le(r,"float32")),l=Ot(e.shape,o);return l.length>0?B(ve(a,l),e.shape):a},b:()=>{let a=V(t,le(e,"float32")),l=Ot(r.shape,o);l.length>0&&(a=B(ve(a,l),r.shape));let c=We(r);return yt(me(a,le(c,"float32")))}}}};var p3={kernelName:nc,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,n,e)=>{let{varianceEpsilon:r}=e,[o,i,s,a]=n,l=a??Ae(1),c=Ot(i.shape,o.shape),u=[];if(i.rank===1){for(let C=0;C<o.shape.length-1;++C)u.push(o.shape[C]);u.push(1)}let d=we(o,i),p=V(t,l),f=Zg(ee(s,Ae(r))),m=V(V(V(f,f),f),Ae(-.5));return{x:()=>i.rank===1?B(V(V(t,_i(B(f,[1,1,1,i.shape[0]]),u)),l),o.shape):B(V(V(t,f),l),o.shape),mean:()=>{let C=V(V(f,Ae(-1)),p);return i.rank===1&&(C=ve(C,c)),B(C,i.shape)},variance:()=>{let C=V(V(m,d),p);return i.rank===1&&(C=ve(C,c)),B(C,i.shape)},scale:()=>{let C=V(d,f),I=V(t,C);return i.rank===1&&(I=ve(I,c)),B(I,i.shape)},offset:()=>{let C=t;return i.rank===1&&(C=ve(C,c)),B(C,i.shape)}}}};var h3={kernelName:rc,inputsToSave:["x","indices"],gradFunc:(t,n,e)=>{let[r,o]=n,{axis:i}=e,s=vn(i,r.shape)[0];return{x:()=>{let l=r.shape,c=o.size,u=l.slice(0,s),d=u.length,p=l.slice(i,l.length).slice(1),f=p.length,m=f3(0,d),h=f3(d+1,d+1+f),g=m3([u,[c],p]),y=B(t,g),v=B(o,[c]),S=m3([[d],m,h]),C=ot(y,S),I=Qb(C,v,r.shape[s]),E=Yg(S);return I=ot(I,E),I},indices:()=>o}}};function f3(t,n){let e=[];for(let r=t;r<n;++r)e.push(r);return e}function m3(t){let n=[];for(let e=0;e<t.length;++e)for(let r=0;r<t[e].length;++r)n.push(t[e][r]);return n}var g3={kernelName:pa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>Ee(e),b:()=>Ee(r)}}};var y3={kernelName:ts,gradFunc:t=>({x:()=>le(t,"float32")})};var x3={kernelName:fa,gradFunc:t=>({x:()=>Ee(t)})};var v3={kernelName:ma,gradFunc:t=>({x:()=>Ee(t)})};var b3={kernelName:ha,gradFunc:t=>({x:()=>Ee(t)})};var w3={kernelName:oc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{alpha:o}=e,i=Bn(r,0);return{x:()=>an(i,t,V(t,o))}}};var C3={kernelName:ya,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,ee(e,1))}}};var S3={kernelName:ga,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,le(e,"float32"))}}};var _3={kernelName:x$,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e;return{logits:()=>{let s=fr(r);return we(t,V(ve(t,o,!0),s))}}}};function Lce(t,n,e,r=5,o=1,i=1,s=.5){let a={x:t,y:n,dy:e},l={depthRadius:r,bias:o,alpha:i,beta:s};return k.runKernel(Of,a,l)}var I3=A({localResponseNormalizationBackprop_:Lce});var E3={kernelName:ic,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{depthRadius:i,bias:s,alpha:a,beta:l}=e;return{x:()=>I3(r,o,t,i,s,a,l)}}};function nw(t,n,e,r){return n.rank<e.rank&&(n=B(n,as(n.shape,r))),t.rank<e.rank&&(t=B(t,as(t.shape,r))),{x:()=>V(t,le(jo(e,n),t.dtype))}}var $D={kernelName:sc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{reductionIndices:o}=r,i=n[0],s=n[1],a=vn(o,i.shape),l=nw(t,s,i,a);return{x:()=>l.x()}}};var T3={kernelName:xa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,le(vo(e,r),"float32")),b:()=>V(t,le(jb(e,r),"float32"))}}};function Vce(t,n,e,r,o,i,s){let a=N(t,"dy","maxPool3dGrad"),l=N(n,"input","maxPool3dGrad"),c=N(e,"output","maxPool3dGrad"),u=a,d=l,p=c,f=!1;l.rank===4&&(f=!0,u=B(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),d=B(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=B(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),M(u.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${u.rank}.`),M(d.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${d.rank}.`),M(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),s!=null&&M(ht(i),()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let m={dy:u,input:d,output:p},h={filterSize:r,strides:o,pad:i,dimRoundingMode:s},g=k.runKernel(Ff,m,h);return f?B(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var D3=A({maxPool3dGrad_:Vce});var N3={kernelName:lc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=e;return{x:()=>D3(t,r,o,i,s,a,l)}}};function Bce(t,n,e,r,o,i,s){let a=N(t,"dy","maxPoolGrad"),l=N(n,"input","maxPoolGrad"),c=N(e,"output","maxPoolGrad");M(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),M(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),M(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),s!=null&&M(ht(i),()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${s} but got pad ${i}.`);let u={dy:a,input:l,output:c},d={filterSize:r,strides:o,pad:i,dimRoundingMode:s};return k.runKernel(Mf,u,d)}var k3=A({maxPoolGrad_:Bce});var A3={kernelName:ac,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r,o]=n,{filterSize:i,strides:s,pad:a}=e;return{x:()=>k3(t,r,o,i,s,a)}}};var R3={kernelName:cc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{axis:o}=e,i=vn(o,r.shape),a=sD(r.shape,i)[1],l=Rt(a);return{x:()=>{let u=r.shape.slice();i.forEach(f=>{u[f]=1});let d=B(t,u);return me(V(d,eo(r.shape,"float32")),l)}}}};var O3={kernelName:uc,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,n,e)=>{let r=e,{axis:o}=r,[i,s]=n,a=vn(o,i.shape),l=nw(t,s,i,a);return{x:()=>l.x()}}};var M3={kernelName:va,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n;return{a:()=>V(t,le(is(e,r),"float32")),b:()=>V(t,le(Bn(e,r),"float32"))}}};var F3={kernelName:dc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>it(t,i,r.shape)}}};var P3={kernelName:ba,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=Ot(e.shape,o);return a.length>0?B(ve(t,a),e.shape):t},b:()=>{let a=V(t,yt(Ha(me(e,r)))),l=Ot(r.shape,o);return l.length>0?B(ve(a,l),r.shape):a}}}};var $3={kernelName:wa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=V(t,le(r,"float32")),l=Ot(e.shape,o);return l.length>0?B(ve(a,l),e.shape):a},b:()=>{let a=V(t,le(e,"float32")),l=Ot(r.shape,o);return l.length>0?B(ve(a,l),r.shape):a}}}};var L3={kernelName:pc,gradFunc:t=>({x:()=>yt(t)})};var V3={kernelName:mc,inputsToSave:["indices"],gradFunc:(t,n)=>{let e=n[0];return{indices:()=>Vt(e.shape,"float32")}}};var B3={kernelName:fc,gradFunc:t=>({x:()=>Ee(t)})};var z3={kernelName:hc,saveAllInputs:!0,gradFunc:(t,n,e)=>{let{axis:r}=e;return Ar(t,r).map(i=>()=>i)}};var LD={kernelName:gc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let r=n[0],{paddings:o}=e,i=o.map(s=>s[0]);return{x:()=>it(t,i,r.shape)}}};var U3={kernelName:Ca,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,n)=>{let[e,r,o]=n,i=e,s=r,a=Ue(i.shape,s.shape);return{a:()=>{let u=le(s,"float32"),d=V(t,V(u,Go(i,we(u,Ae(1))))),p=Ot(i.shape,a);return p.length>0&&(d=ve(d,p)),B(d,i.shape)},b:()=>{let u=Bn(i,0),d=an(u,mr(i),Ee(i)),p=V(t,V(o,d)),f=Ot(s.shape,a);return f.length>0&&(p=ve(p,f)),B(p,s.shape)}}}};var j3={kernelName:yc,inputsToSave:["x","alpha"],gradFunc:(t,n)=>{let[e,r]=n,o=Bn(e,0);return{x:()=>an(o,t,V(t,r)),alpha:()=>{let i=an(o,Ee(t),V(t,e)),s=Ot(r.shape,t.shape);return s.length>0&&(i=ve(i,s)),B(i,r.shape)}}}};var G3={kernelName:ia,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=me(t,le(r,"float32")),l=Ot(e.shape,o);return l.length>0?B(ve(a,l),e.shape):a},b:()=>{let a=V(t,le(e,"float32")),l=Ot(r.shape,o);l.length>0&&(a=B(ve(a,l),r.shape));let c=We(r);return yt(me(a,le(c,"float32")))}}}};var W3={kernelName:Sa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,yt(We(e)))}}};var H3={kernelName:Ia,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n,r=V(is(e,6),Ii(e));return{x:()=>V(t,le(r,"float32"))}}};var q3={kernelName:_a,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,le(Ii(e),"float32"))}}};var K3={kernelName:xc,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>B(t,e.shape)}}};var X3={kernelName:bc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(Bf,o,e)}}};var Y3={kernelName:vc,inputsToSave:["images"],gradFunc:(t,n,e)=>{let[r]=n,o={dy:t,images:r};return{images:()=>k.runKernel(Vf,o,e)}}};var Q3={kernelName:wc,gradFunc:(t,n,e)=>{let{dims:r}=e,o=vn(r,t.shape);return{x:()=>wo(t,o)}}};var Z3={kernelName:Ea,gradFunc:t=>({x:()=>Ee(t)})};var J3={kernelName:Ta,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>yt(me(t,V(Go(e,1.5),2)))}}};var eB={kernelName:Cc,inputsToSave:["condition"],gradFunc:(t,n)=>{let[e]=n;return{condition:()=>le(Ee(e),"float32"),t:()=>V(t,le(e,t.dtype)),e:()=>V(t,le(lm(e),t.dtype))}}};var tB={kernelName:Da,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>{let r=Bn(e,Ae(0)),o=Ae(OD),i=Ae(MD),s=V(t,i),a=V(V(t,o),fr(le(e,"float32")));return an(r,s,a)}}}};var nB={kernelName:Ra,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(e,we(Ae(1),e)))}}};var rB={kernelName:Aa,gradFunc:t=>({x:()=>Ee(t)})};var oB={kernelName:Na,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(md(le(e,"float32")),t)}}};var iB={kernelName:ka,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(qg(le(e,"float32")),t)}}};var sB={kernelName:Sc,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{begin:o,size:i}=e,s=r.shape,[a,l]=kT(r,o,i),c=[];for(let u=0;u<t.rank;u++)c.push([a[u],s[u]-a[u]-l[u]]);return{x:()=>vd(t,c)}}};var aB={kernelName:Tc,outputsToSave:[!0],gradFunc:(t,n,e)=>{let[r]=n,{dim:o}=e,i=!0,s=V(t,r);return{logits:()=>we(s,V(ve(s,[o],i),r))}}};var lB={kernelName:Oa,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,Uo(e))}}};var VD={kernelName:Ic,gradFunc:(t,n,e)=>{let{blockShape:r,paddings:o}=e;return{x:()=>om(t,r,o)}}};var BD={kernelName:Ec,gradFunc:(t,n,e)=>{let{axis:r}=e;return{x:()=>Lt(t,r)}}};var cB={kernelName:Ma,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,V(Bt(le(e,"float32")),2))}}};var uB={kernelName:zf,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(t,V(le(e,"float32"),2))}}};var dB={kernelName:Fa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ae(2);return{a:()=>V(t,V(o,we(e,r))),b:()=>V(t,V(o,we(r,e)))}}};var pB={kernelName:Va,gradFunc:t=>({x:()=>Ee(t)})};var fB={kernelName:Pa,inputsToSave:["a","b"],gradFunc:(t,n)=>{let[e,r]=n,o=Ue(e.shape,r.shape);return{a:()=>{let a=t,l=Ot(e.shape,o);return l.length>0&&(a=ve(a,l)),B(a,e.shape)},b:()=>{let a=t,l=Ot(r.shape,o);return l.length>0&&(a=ve(a,l)),B(yt(a),r.shape)}}}};var mB={kernelName:_c,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,o=r.shape.slice(),{axis:i}=e;vn(i,r.shape).forEach(c=>{o[c]=1});let a=B(t,o),l=V(a,eo(r.shape,"float32"));return{x:()=>l}}};var hB={kernelName:$a,inputsToSave:["x"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>me(t,We(md(e)))}}};var gB={kernelName:La,outputsToSave:[!0],gradFunc:(t,n)=>{let[e]=n;return{x:()=>V(we(Ae(1),We(e)),t)}}};var yB={kernelName:ns,inputsToSave:["x"],gradFunc:(t,n,e)=>{let[r]=n,{reps:o}=e;return{x:()=>{let s=Ee(r);if(r.rank===1)for(let a=0;a<o[0];++a)s=ee(s,it(t,[a*r.shape[0]],[r.shape[0]]));else if(r.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)s=ee(s,it(t,[a*r.shape[0],l*r.shape[1]],[r.shape[0],r.shape[1]]));else if(r.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)s=ee(s,it(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else if(r.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let c=0;c<o[2];++c)for(let u=0;u<o[3];++u)s=ee(s,it(t,[a*r.shape[0],l*r.shape[1],c*r.shape[2],u*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${r.rank} tensors yet.`);return s}}}};var xB={kernelName:Dc,gradFunc:(t,n,e)=>{let r=e,{perm:o}=r,i=Yg(o);return{x:()=>ot(t,i)}}};var vB={kernelName:Nc,gradFunc:(t,n,e)=>{let r=e,{axis:o}=r;return{value:()=>Xn(t,o)}}};var bB={kernelName:kc,inputsToSave:["segmentIds"],gradFunc:(t,n)=>{let[e]=n;return{x:()=>zce(t,e)}}};function zce(t,n){let e=Jr(n,Ee(n)),r=hd(t,e),o=vo(n,Ae(0,"int32")),i=r.rank-o.rank;for(let a=0;a<i;++a)o=Kn(o,a+1);o=ar(o,eo(r.shape,"bool"));let s=Ee(r);return an(o,r,s)}var wB={kernelName:Ac,gradFunc:t=>({x:()=>Ee(t)})};var Uce=[tw,TV,DV,NV,kV,AV,RV,OV,MV,FV,PV,$V,VV,zV,UV,jV,GV,WV,HV,qV,KV,XV,QV,YV,JV,e3,t3,n3,r3,o3,G3,i3,s3,a3,l3,c3,d3,u3,p3,h3,g3,y3,x3,v3,b3,w3,C3,S3,_3,E3,$D,$D,T3,N3,A3,R3,O3,M3,F3,P3,$3,L3,V3,B3,z3,LD,LD,U3,j3,W3,H3,q3,K3,X3,Y3,Q3,Z3,J3,eB,tB,nB,rB,oB,iB,sB,aB,lB,VD,VD,BD,BD,cB,dB,uB,pB,fB,mB,hB,gB,yB,xB,vB,bB,wB];for(let t of Uce)b$(t);F().prototype.abs=function(){return this.throwIfDisposed(),bn(this)};F().prototype.acos=function(){return this.throwIfDisposed(),AT(this)};F().prototype.acosh=function(){return this.throwIfDisposed(),RT(this)};F().prototype.add=function(t){return this.throwIfDisposed(),ee(this,t)};F().prototype.all=function(t,n){return this.throwIfDisposed(),Gg(this,t,n)};F().prototype.any=function(t,n){return this.throwIfDisposed(),em(this,t,n)};F().prototype.argMax=function(t){return this.throwIfDisposed(),tm(this,t)};F().prototype.argMin=function(t){return this.throwIfDisposed(),IL(this,t)};F().prototype.asScalar=function(){return this.throwIfDisposed(),M(this.size===1,()=>"The array must have only 1 element."),B(this,[])};F().prototype.asType=function(t){return this.throwIfDisposed(),le(this,t)};F().prototype.as1D=function(){return this.throwIfDisposed(),B(this,[this.size])};F().prototype.as2D=function(t,n){return this.throwIfDisposed(),B(this,[t,n])};F().prototype.as3D=function(t,n,e){return this.throwIfDisposed(),B(this,[t,n,e])};F().prototype.as4D=function(t,n,e,r){return this.throwIfDisposed(),B(this,[t,n,e,r])};F().prototype.as5D=function(t,n,e,r,o){return this.throwIfDisposed(),B(this,[t,n,e,r,o])};F().prototype.asin=function(){return this.throwIfDisposed(),OT(this)};F().prototype.asinh=function(){return this.throwIfDisposed(),MT(this)};F().prototype.atan=function(){return this.throwIfDisposed(),FT(this)};F().prototype.atan2=function(t){return this.throwIfDisposed(),EL(this,t)};F().prototype.atanh=function(){return this.throwIfDisposed(),PT(this)};F().prototype.avgPool=function(t,n,e,r){return this.throwIfDisposed(),fd(this,t,n,e,r)};F().prototype.batchToSpaceND=function(t,n){return this.throwIfDisposed(),om(this,t,n)};F().prototype.batchNorm=function(t,n,e,r,o){return this.throwIfDisposed(),Pc(this,t,n,e,r,o)};F().prototype.broadcastTo=function(t){return this.throwIfDisposed(),im(this,t)};F().prototype.cast=function(t){return this.throwIfDisposed(),le(this,t)};F().prototype.ceil=function(){return this.throwIfDisposed(),GT(this)};F().prototype.clipByValue=function(t,n){return this.throwIfDisposed(),Vn(this,t,n)};F().prototype.concat=function(t,n){return this.throwIfDisposed(),t instanceof ct&&(t=[t]),Lt([this,...t],n)};F().prototype.conv1d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Wg(this,t,n,e,r,o,i)};F().prototype.conv2dTranspose=function(t,n,e,r,o){return this.throwIfDisposed(),Hg(this,t,n,e,r,o)};F().prototype.conv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Zr(this,t,n,e,r,o,i)};F().prototype.cos=function(){return this.throwIfDisposed(),md(this)};F().prototype.cosh=function(){return this.throwIfDisposed(),qg(this)};F().prototype.cumsum=function(t,n,e){return this.throwIfDisposed(),zb(this,t,n,e)};F().prototype.depthToSpace=function(t,n){return this.throwIfDisposed(),kL(this,t,n)};F().prototype.depthwiseConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),Ga(this,t,n,e,r,o,i)};F().prototype.dilation2d=function(t,n,e,r,o){return this.throwIfDisposed(),AL(this,t,n,e,r,o)};F().prototype.divNoNan=function(t){return this.throwIfDisposed(),RL(this,t)};F().prototype.div=function(t){return this.throwIfDisposed(),me(this,t)};F().prototype.dot=function(t){return this.throwIfDisposed(),OL(this,t)};F().prototype.elu=function(){return this.throwIfDisposed(),Wa(this)};F().prototype.equal=function(t){return this.throwIfDisposed(),jo(this,t)};F().prototype.erf=function(){return this.throwIfDisposed(),QT(this)};F().prototype.exp=function(){return this.throwIfDisposed(),fr(this)};F().prototype.expandDims=function(t){return this.throwIfDisposed(),Kn(this,t)};F().prototype.expm1=function(){return this.throwIfDisposed(),ZT(this)};F().prototype.fft=function(){return this.throwIfDisposed(),iy(this)};F().prototype.flatten=function(){return this.throwIfDisposed(),B(this,[this.size])};F().prototype.floor=function(){return this.throwIfDisposed(),Ha(this)};F().prototype.floorDiv=function(t){return this.throwIfDisposed(),Lb(this,t)};F().prototype.gather=function(t,n){return this.throwIfDisposed(),hd(this,t,n)};F().prototype.greaterEqual=function(t){return this.throwIfDisposed(),vo(this,t)};F().prototype.greater=function(t){return this.throwIfDisposed(),Bn(this,t)};F().prototype.ifft=function(){return this.throwIfDisposed(),fm(this)};F().prototype.irfft=function(){return this.throwIfDisposed(),wD(this)};F().prototype.isFinite=function(){return this.throwIfDisposed(),JT(this)};F().prototype.isInf=function(){return this.throwIfDisposed(),eD(this)};F().prototype.isNaN=function(){return this.throwIfDisposed(),tD(this)};F().prototype.leakyRelu=function(t){return this.throwIfDisposed(),gd(this,t)};F().prototype.lessEqual=function(t){return this.throwIfDisposed(),is(this,t)};F().prototype.less=function(t){return this.throwIfDisposed(),jb(this,t)};F().prototype.localResponseNormalization=function(t,n,e,r){return this.throwIfDisposed(),ML(this,t,n,e,r)};F().prototype.logSigmoid=function(){return this.throwIfDisposed(),oD(this)};F().prototype.logSoftmax=function(t){return this.throwIfDisposed(),Xg(this,t)};F().prototype.logSumExp=function(t,n){return this.throwIfDisposed(),PL(this,t,n)};F().prototype.log=function(){return this.throwIfDisposed(),mr(this)};F().prototype.log1p=function(){return this.throwIfDisposed(),nD(this)};F().prototype.logicalAnd=function(t){return this.throwIfDisposed(),ar(this,t)};F().prototype.logicalNot=function(){return this.throwIfDisposed(),lm(this)};F().prototype.logicalOr=function(t){return this.throwIfDisposed(),Gb(this,t)};F().prototype.logicalXor=function(t){return this.throwIfDisposed(),$L(this,t)};F().prototype.matMul=function(t,n,e){return this.throwIfDisposed(),gt(this,t,n,e)};F().prototype.maxPool=function(t,n,e,r){return this.throwIfDisposed(),yd(this,t,n,e,r)};F().prototype.max=function(t,n){return this.throwIfDisposed(),zn(this,t,n)};F().prototype.maximum=function(t){return this.throwIfDisposed(),Jr(this,t)};F().prototype.mean=function(t,n){return this.throwIfDisposed(),Gt(this,t,n)};F().prototype.min=function(t,n){return this.throwIfDisposed(),Lc(this,t,n)};F().prototype.minimum=function(t){return this.throwIfDisposed(),xd(this,t)};F().prototype.mirrorPad=function(t,n){return this.throwIfDisposed(),LL(this,t,n)};F().prototype.mod=function(t){return this.throwIfDisposed(),VL(this,t)};F().prototype.mul=function(t){return this.throwIfDisposed(),V(this,t)};F().prototype.neg=function(){return this.throwIfDisposed(),yt(this)};F().prototype.norm=function(t,n,e){return this.throwIfDisposed(),mm(this,t,n,e)};F().prototype.notEqual=function(t){return this.throwIfDisposed(),Vc(this,t)};F().prototype.oneHot=function(t,n=1,e=0){return this.throwIfDisposed(),Jf(this,t,n,e)};F().prototype.onesLike=function(){return this.throwIfDisposed(),Rn(this)};F().prototype.pad=function(t,n){return this.throwIfDisposed(),vd(this,t,n)};F().prototype.pool=function(t,n,e,r,o){return this.throwIfDisposed(),BL(this,t,n,e,r,o)};F().prototype.pow=function(t){return this.throwIfDisposed(),Go(this,t)};F().prototype.prelu=function(t){return this.throwIfDisposed(),bd(this,t)};F().prototype.prod=function(t,n){return this.throwIfDisposed(),zL(this,t,n)};F().prototype.reciprocal=function(){return this.throwIfDisposed(),xD(this)};F().prototype.relu=function(){return this.throwIfDisposed(),Wo(this)};F().prototype.relu6=function(){return this.throwIfDisposed(),Xb(this)};F().prototype.reshapeAs=function(t){return this.throwIfDisposed(),B(this,t.shape)};F().prototype.reshape=function(t){return this.throwIfDisposed(),B(this,t)};F().prototype.resizeBilinear=function(t,n,e){return this.throwIfDisposed(),xV(this,t,n,e)};F().prototype.resizeNearestNeighbor=function(t,n,e){return this.throwIfDisposed(),vV(this,t,n,e)};F().prototype.reverse=function(t){return this.throwIfDisposed(),wo(this,t)};F().prototype.rfft=function(){return this.throwIfDisposed(),CD(this)};F().prototype.round=function(){return this.throwIfDisposed(),vD(this)};F().prototype.rsqrt=function(){return this.throwIfDisposed(),Zg(this)};F().prototype.selu=function(){return this.throwIfDisposed(),Jg(this)};F().prototype.separableConv2d=function(t,n,e,r,o,i){return this.throwIfDisposed(),ey(this,t,n,e,r,o,i)};F().prototype.sigmoid=function(){return this.throwIfDisposed(),Uo(this)};F().prototype.sign=function(){return this.throwIfDisposed(),bD(this)};F().prototype.sin=function(){return this.throwIfDisposed(),ty(this)};F().prototype.sinh=function(){return this.throwIfDisposed(),ny(this)};F().prototype.slice=function(t,n){return this.throwIfDisposed(),it(this,t,n)};F().prototype.softmax=function(t){return this.throwIfDisposed(),Cd(this,t)};F().prototype.softplus=function(){return this.throwIfDisposed(),ss(this)};F().prototype.spaceToBatchND=function(t,n){return this.throwIfDisposed(),um(this,t,n)};F().prototype.split=function(t,n){return this.throwIfDisposed(),Un(this,t,n)};F().prototype.sqrt=function(){return this.throwIfDisposed(),Bt(this)};F().prototype.square=function(){return this.throwIfDisposed(),We(this)};F().prototype.squaredDifference=function(t){return this.throwIfDisposed(),rV(this,t)};F().prototype.squeeze=function(t){return this.throwIfDisposed(),Sd(this,t)};F().prototype.stack=function(t,n){this.throwIfDisposed();let e=t instanceof ct?[this,t]:[this,...t];return Xn(e,n)};F().prototype.step=function(t){return this.throwIfDisposed(),Ii(this,t)};F().prototype.stridedSlice=function(t,n,e,r,o,i,s,a){return this.throwIfDisposed(),SD(this,t,n,e,r,o,i,s,a)};F().prototype.sub=function(t){return this.throwIfDisposed(),we(this,t)};F().prototype.sum=function(t,n){return this.throwIfDisposed(),ve(this,t,n)};F().prototype.tan=function(){return this.throwIfDisposed(),_D(this)};F().prototype.tanh=function(){return this.throwIfDisposed(),rm(this)};F().prototype.tile=function(t){return this.throwIfDisposed(),_i(this,t)};F().prototype.toBool=function(){return this.throwIfDisposed(),le(this,"bool")};F().prototype.toFloat=function(){return this.throwIfDisposed(),le(this,"float32")};F().prototype.toInt=function(){return this.throwIfDisposed(),le(this,"int32")};F().prototype.topk=function(t,n){return this.throwIfDisposed(),oV(this,t,n)};F().prototype.transpose=function(t){return this.throwIfDisposed(),ot(this,t)};F().prototype.unique=function(t){return this.throwIfDisposed(),iV(this,t)};F().prototype.unsortedSegmentSum=function(t,n){return this.throwIfDisposed(),Qb(this,t,n)};F().prototype.unstack=function(t){return this.throwIfDisposed(),Ar(this,t)};F().prototype.where=function(t,n){return this.throwIfDisposed(),an(t,this,n)};F().prototype.zerosLike=function(){return this.throwIfDisposed(),Ee(this)};var zD;function mn(){return zD==null&&(zD=_L().epsilon()),zD}function hr(){return"channelsLast"}var Co=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},gr=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},L=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},Ne=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}},rw=class t extends Error{constructor(n){super(n),Object.setPrototypeOf(this,t.prototype)}};function Ko(t,n){if(Array.isArray(t)){let e=[];for(let r=0;r<n;r++)e=e.concat(t);return e}else{let e=new Array(n);return e.fill(t),e}}function So(t,n){if(!t)throw new rw(n)}function jD(t,n){let e=0;for(let r of t)r===n&&e++;return e}function On(t){return t.length===1?t[0]:t}function Tt(t){return Array.isArray(t)?t:[t]}function Xo(t){let e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return e[0]!=="_"?e:"private"+e}function Ka(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(n,e)=>e.toUpperCase())}var qo={};function gm(t){if(t==null)return null;let n={};return n.className=t.getClassName(),n.config=t.getConfig(),n}function UD(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(n=>UD(n));else{let n=Object.keys(t);for(let e of n){let r=t[e];r!=null&&typeof r=="object"&&(!Array.isArray(r)&&r.type==="ndarray"&&typeof r.value=="number"?t[e]=r.value:UD(r))}}}function cs(t,n={},e={},r="object",o=!1){if(typeof t=="string"){let i=t,s;if(i in e)s=e[i];else if(i in qo)s=qo[i];else if(s=n[i],s==null)throw new L(`Unknown ${r}: ${t}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return s}else{let i=t;if(i.className==null||i.config==null)throw new L(`${r}: Improper config format: ${JSON.stringify(i)}.
'className' and 'config' must set.`);let s=i.className,a,l;if(s in e?[a,l]=e[s]:s in qo?[a,l]=qo.className:s in n&&([a,l]=n[s]),a==null)throw new L(`Unknown ${r}: ${s}. This may be due to one of the following reasons:
1. The ${r} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${r} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let c={};for(let f of Object.keys(qo))c[f]=qo[f];for(let f of Object.keys(e))c[f]=e[f];let u=i.config;u.customObjects=c;let d=Object.assign({},qo);for(let f of Object.keys(e))qo[f]=e[f];UD(i.config);let p=l(a,i.config,e,o);return qo=Object.assign({},d),p}else{let c=Object.assign({},qo);for(let d of Object.keys(e))qo[d]=e[d];let u=new a(i.config);return qo=Object.assign({},c),u}}}function jce(t,n){return t<n?-1:t>n?1:0}function cy(t,n){return-1*jce(t,n)}function Yo(t){if(t==null)return t;let n=[];for(let e of t)n.indexOf(e)===-1&&n.push(e);return n}function CB(t){if(t==null)throw new L(`Invalid value in obj: ${JSON.stringify(t)}`);for(let n in t)if(t.hasOwnProperty(n))return!1;return!0}function us(t,n,e){if(e!=null&&t.indexOf(e)<0)throw new L(`${e} is not a valid ${n}.  Valid values are ${t} or null/undefined.`)}function ow(t,n,e=0,r=1/0){return So(e>=0),So(r>=e),Array.isArray(t)&&t.length>=e&&t.length<=r&&t.every(o=>typeof o===n)}function ln(t,n){Array.isArray(t)?(b.assert(t.length>0,()=>`${n} is unexpectedly an empty array.`),t.forEach((e,r)=>ln(e,`element ${r+1} of ${n}`))):b.assert(Number.isInteger(t)&&t>0,()=>`Expected ${n} to be a positive integer, but got ${SB(t)}.`)}function SB(t){return t===null?"null":Array.isArray(t)?"["+t.map(n=>SB(n)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function _B(t,n){let e=b.now(),r;return(...i)=>{let s=b.now();return s-e<n||(e=s,r=t(...i)),r}}function iw(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}function GD(t,n){return z(()=>Bt(ve(V(t,t),n,!0)))}var kd=class extends Q.Serializable{getConfig(){return{}}},TB=(()=>{class t extends kd{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>{let r=GD(e,this.axis),o=Vn(r,0,this.maxValue);return V(e,me(o,ee(mn(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}return t.className="MaxNorm",t})();Q.registerClass(TB);var DB=(()=>{class t extends kd{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>me(e,ee(mn(),GD(e,this.axis))))}getConfig(){return{axis:this.axis}}}return t.className="UnitNorm",t})();Q.registerClass(DB);var NB=(()=>{class t extends kd{apply(e){return Wo(e)}}return t.className="NonNeg",t})();Q.registerClass(NB);var kB=(()=>{class t extends kd{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return z(()=>{let r=GD(e,this.axis),o=ee(V(this.rate,Vn(r,this.minValue,this.maxValue)),V(1-this.rate,r));return V(e,me(o,ee(mn(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}return t.className="MinMaxNorm",t})();Q.registerClass(kB);var IB={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Qt(t){return gm(t)}function EB(t,n={}){return cs(t,Q.SerializationMap.getMap().classNameMap,n,"constraint")}function Zt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in IB?IB[t]:t,config:{}};return EB(e)}else return t instanceof kd?t:EB(t)}var AB=["channelsFirst","channelsLast"],RB=["nearest","bilinear"],OB=["valid","same","causal"],MB=["max","avg"],FB=["sum","mul","concat","ave"];var ym=new Map;function Wt(t){us(AB,"DataFormat",t)}function $B(t){us(RB,"InterpolationFormat",t)}function yr(t){us(OB,"PaddingMode",t)}function WD(t){us(MB,"PoolMode",t)}var uy=[],PB="/";function Ti(t,n){uy.push(t);try{let e=n();return uy.pop(),e}catch(e){throw uy.pop(),e}}function Wce(){return uy.length===0?"":uy.join(PB)+PB}function sw(t){if(!LB(t))throw new Error("Not a valid tensor name: '"+t+"'");return Wce()+t}function aw(t){if(!LB(t))throw new Error("Not a valid tensor name: '"+t+"'");ym.has(t)||ym.set(t,0);let n=ym.get(t);if(ym.set(t,ym.get(t)+1),n>0){let e=`${t}_${n}`;return ym.set(e,1),e}else return t}var Hce=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function LB(t){return!!t.match(Hce)}function VB(t){return t===parseInt(t.toString(),10)}function Qo(t,n,e){n==null&&(n=0),e==null&&(e=t.length);let r=1;for(let o=n;o<e;++o)r*=t[o];return r}function BB(t){return t=Array.isArray(t)?new Float32Array(t):t,Ho(t)}function Ad(t){return Lc(BB(t)).dataSync()[0]}function Di(t){return zn(BB(t)).dataSync()[0]}function lr(t,n){if(n<t)throw new L(`end (${n}) < begin (${t}) is forbidden.`);let e=[];for(let r=t;r<n;++r)e.push(r);return e}function Ya(t,n){return t.asType(n)}function Qa(t,n=-1){let e=t.shape.slice();return n<0&&(n=e.length+n+1),e.splice(n,0,1),t.reshape(e)}function zB(t,n){return z(()=>{if(t.shape.length!==2)throw new L(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let e=Qa(t,1);return cw(e,[1,n,1])})}function UB(t){let n=[Qo(t.shape)];return t.reshape(n)}function jB(t){if(t.rank<=1)throw new L(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let n=[t.shape[0],Qo(t.shape,1)];return t.reshape(n)}function Xa(t,n,e){return z(()=>{switch(t.rank){case 1:return ry(t,n,e);case 2:return Yb(t,[n,0],[e,t.shape[1]]);case 3:return oy(t,[n,0,0],[e,t.shape[1],t.shape[2]]);case 4:return pm(t,[n,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3]]);case 5:return it(t,[n,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return it(t,[n,0,0,0,0,0],[e,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new L(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function HD(t,n,e){return z(()=>{switch(t.rank){case 1:return ry(t,n,e);case 2:return Yb(t,[0,n],[t.shape[0],e]);case 3:return oy(t,[0,0,n],[t.shape[0],t.shape[1],e]);case 4:return pm(t,[0,0,0,n],[t.shape[0],t.shape[1],t.shape[2],e]);default:throw new L(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function dy(t,n,e,r){return z(()=>{switch(t.rank){case 1:return ry(t,n,e);case 2:switch(r){case 1:return Xa(t,n,e);case 2:return HD(t,n,e);default:throw new L(`The axis is not within the rank of the tensor ${r}`)}case 3:switch(r){case 1:return Xa(t,n,e);case 2:return oy(t,[0,n,0],[t.shape[0],e,t.shape[2]]);case 3:return HD(t,n,e);default:throw new L(`The axis is not within the rank of the tensor ${r}`)}case 4:switch(r){case 1:return Xa(t,n,e);case 2:return pm(t,[0,n,0,0],[t.shape[0],e,t.shape[2],t.shape[3]]);case 3:return pm(t,[0,0,n,0],[t.shape[0],t.shape[1],e,t.shape[3]]);case 4:return HD(t,n,e);default:throw new L(`The axis is not within the rank of the tensor ${r}`)}default:throw new L(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function xm(t,n=-1){let e;return n<0&&(e=t[0].rank,e!==0?n=e:n=0),n===t[0].rank&&(n=-1),Lt(t,n)}function KD(t,n){switch(t.rank){case 1:return WT([t,n]);case 2:return HT([t,n],0);case 3:return qT([t,n],0);case 4:return KT([t,n],0);default:throw new L(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function cw(t,n){if(Array.isArray(n)||(n=[n]),t.rank!==n.length)throw new L(`The length of input n (${n.length}) does not match the number of dimensions in input x (${t.rank})`);return _i(t,n)}function vm(t,n=0,e=1,r,o){return Kb(t,n,e,r,o)}function Zo(t,n,e,r){if(t.rank<2||n.rank<2)throw new Ne(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${n.shape}`);if(n.rank>=3){let o=t.shape.slice(-1)[0],i=n.shape.slice(-2)[0];if(o!==i)throw new Ne(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${n.shape}`)}if(t.rank===2&&n.rank===2)return Dd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?qD(t.rank,r,hr()):null,activation:e});{let o=t.shape.slice(),i=o.pop();t=t.reshape([-1,i]);let s=n.shape.slice(),a=s.pop(),l=s.pop(),c=[...s,a],u=Array.from({length:n.rank},(m,h)=>h===0?n.rank-2:h<=n.rank-2?h-1:h);n=n.transpose(u).reshape([l,-1]);let d=[...o,...c];return Dd.matMul({a:t,b:n,transposeA:!1,transposeB:!1,bias:r?qD(t.rank,r,hr()):null,activation:e}).reshape(d)}}function uw(t,n,e){return z(()=>(Array.isArray(n)?n=Ho(n,"int32"):n=n.toInt(),hd(t,n,e)))}function Rd(t){return V(t,t)}function qD(t,n,e){let r=n.shape;if(n.rank!==1&&n.rank!==t)throw new L(`Unexpected bias dimensions: ${n.rank}; expected it to be 1 or ${t}`);if(t===5){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1,1]):n.reshape([1,r[3],r[0],r[1],r[2]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===4){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1,1]):n.reshape([1,r[2],r[0],r[1]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,1,r[0]]):n.reshape([1].concat(r))}else if(t===3){if(e==="channelsFirst")return r.length===1?n.reshape([1,r[0],1]):n.reshape([1,r[1],r[0]]);if(e==="channelsLast")return r.length===1?n.reshape([1,1,r[0]]):n.reshape([1].concat(r))}else if(t<3)return n;throw new L(`Unsupported input rank by biasAdd: ${n.rank}`)}function xr(t,n,e){return z(()=>(e==null&&(e=hr()),Wt(e),t.add(qD(t.rank,n,e))))}function GB(t,n=1){if(n!==1)throw new Ne(`Support for alpha values other than 1 (${n}) is not implemented yet.`);return Wa(t)}function WB(t){return z(()=>me(t,bn(t).add(1)))}function dw(t,n,e,r){return z(()=>cV(t,n,e,r))}function HB(t){return z(()=>{let n=ee(.5,V(.2,t));return Vn(n,0,1)})}function zc(t,n,e=!1){return e?t():n()}var qB=["fanIn","fanOut","fanAvg"],KB=["normal","uniform","truncatedNormal"];function qce(t){us(qB,"FanMode",t)}function Kce(t){us(KB,"Distribution",t)}var br=class extends Q.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},QB=(()=>{class t extends br{apply(e,r){return Vt(e,r)}}return t.className="Zeros",t})();Q.registerClass(QB);var pw=(()=>{class t extends br{apply(e,r){return eo(e,r)}}return t.className="Ones",t})();Q.registerClass(pw);var ZB=(()=>{class t extends br{constructor(e){if(super(),typeof e!="object")throw new L(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new L(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return z(()=>V(Ae(this.value),eo(e,r)))}getConfig(){return{value:this.value}}}return t.className="Constant",t})();Q.registerClass(ZB);var JB=(()=>{class t extends br{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return qa(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}return t.className="RandomUniform",t})();Q.registerClass(JB);var ez=(()=>{class t extends br{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ne(`randomNormal does not support dType ${r}.`);return vm(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="RandomNormal",t})();Q.registerClass(ez);var tz=(()=>{class t extends br{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ne(`truncatedNormal does not support dType ${r}.`);return sy(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}return t.className="TruncatedNormal",t})();Q.registerClass(tz);var nz=(()=>{class t extends br{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return z(()=>{if(e.length!==2||e[0]!==e[1])throw new L("Identity matrix initializer can only be used for 2D square matrices.");return V(this.gain,am(e[0]))})}getConfig(){return{gain:this.gain}}}return t.className="Identity",t})();Q.registerClass(nz);function Xce(t,n="channelsLast"){let e,r;if(Wt(n),t.length===2)e=t[0],r=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(n==="channelsFirst"){let o=Qo(t,2);e=t[1]*o,r=t[0]*o}else if(n==="channelsLast"){let o=Qo(t,0,t.length-2);e=t[t.length-2]*o,r=t[t.length-1]*o}}else{let o=Qo(t);e=Math.sqrt(o),r=Math.sqrt(o)}return[e,r]}var to=(()=>{class t extends br{constructor(e){if(super(),e.scale<0)throw new L(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,qce(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Kce(this.distribution),this.seed=e.seed}apply(e,r){let o=Xce(e),i=o[0],s=o[1],a=this.scale;if(this.mode==="fanIn"?a/=Math.max(1,i):this.mode==="fanOut"?a/=Math.max(1,s):a/=Math.max(1,(i+s)/2),this.distribution==="normal"){let l=Math.sqrt(a);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new Ne(`${this.getClassName()} does not support dType ${r}.`);return sy(e,0,l,r,this.seed)}else{let l=Math.sqrt(3*a);return qa(e,-l,l,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}return t.className="VarianceScaling",t})();Q.registerClass(to);var XD=(()=>{class t extends to{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return to.className}}return t.className="GlorotUniform",t})();Q.registerClass(XD);var YD=(()=>{class t extends to{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return to.className}}return t.className="GlorotNormal",t})();Q.registerClass(YD);var QD=(()=>{class t extends to{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return to.className}}return t.className="HeNormal",t})();Q.registerClass(QD);var ZD=(()=>{class t extends to{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return to.className}}return t.className="HeUniform",t})();Q.registerClass(ZD);var JD=(()=>{class t extends to{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return to.className}}return t.className="LeCunNormal",t})();Q.registerClass(JD);var eN=(()=>{class t extends to{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return to.className}}return t.className="LeCunNormal",t})();Q.registerClass(eN);var rz=(()=>{class t extends br{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new Ne("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return z(()=>{if(e.length<2)throw new Ne("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let o=e[0]>e[1]?[e[1],e[0]]:e,i=vm(o,0,1,"float32"),s=_V.gramSchmidt(i);return e[0]>e[1]&&(s=s.transpose()),V(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}}return t.className="Orthogonal",t})();Q.registerClass(rz);var XB={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function YB(t,n={}){return cs(t,Q.SerializationMap.getMap().classNameMap,n,"initializer")}function Mt(t){return gm(t)}function It(t){if(typeof t=="string"){let n=t in XB?XB[t]:t;if(n==="GlorotNormal")return new YD;if(n==="GlorotUniform")return new XD;if(n==="HeNormal")return new QD;if(n==="HeUniform")return new ZD;if(n==="LeCunNormal")return new JD;if(n==="LeCunUniform")return new eN;{let e={};return e.className=n,e.config={},YB(e)}}else return t instanceof br?t:YB(t)}var Qce=0;function mw(){return Qce++}var fw={};function Uc(t=""){return t in fw||(fw[t]=0),fw[t]+=1,t+fw[t].toString()}function hw(t){return Array.isArray(t)&&Array.isArray(t[0])}function bm(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Le(t){let n;if(Array.isArray(t)){if(t.length!==1)throw new L(`Expected Tensor length to be 1; got ${t.length}`);n=t[0]}else n=t;return n}function Qe(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new L(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function wm(t){let n=0;for(let e of t)e.shape.length===0?n+=1:n+=e.shape.reduce((r,o)=>r*o);return n}var iz="Variable",py=class{constructor(n,e="float32",r=iz,o=!0,i=null){this.dtype=e??"float32",this.shape=n.shape,this.id=mw(),r=r??iz,this.originalName=sw(r),this.name=aw(this.originalName),this.trainable_=o,this.constraint=i,this.val=ID(n,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(n){return this.assertNotDisposed(),Jce(this.val,n),this.val.id!==n.id&&(this.val.assign(n),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(n){this.trainable_=n,this.val.trainable=n}};function Jce(t,n){if(t.shape.toString()!==n.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(n.shape))}function fy(t){return t.map(n=>n.read())}function Cm(t){t.forEach(n=>{n[0].write(n[1])})}var Dt=class{constructor(n){this.dtype=n.dtype,this.shape=n.shape,n.shape!=null?this.ndim=n.shape.length:this.ndim=n.ndim,this.maxNDim=n.maxNDim,this.minNDim=n.minNDim,this.axes=n.axes||{}}},cr=class{constructor(n,e,r,o,i,s,a){this.dtype=n,this.shape=e,this.sourceLayer=r,this.inputs=o,this.callArgs=i,this.outputTensorIndex=a,this.id=mw(),s!=null&&(this.originalName=sw(s),this.name=aw(this.originalName)),this.rank=e.length}},eue=0,Za=class{constructor(n,e){this.callArgs=e,this.id=eue++,this.outboundLayer=n.outboundLayer,this.inboundLayers=n.inboundLayers,this.nodeIndices=n.nodeIndices,this.tensorIndices=n.tensorIndices,this.inputTensors=n.inputTensors,this.outputTensors=n.outputTensors,this.inputMasks=n.inputMasks,this.outputMasks=n.outputMasks,this.inputShapes=n.inputShapes,this.outputShapes=n.outputShapes;for(let r of n.inboundLayers)r?.outboundNodes.push(this);n.outboundLayer.inboundNodes.push(this)}getConfig(){let n=[];for(let e of this.inboundLayers)e!=null?n.push(e.name):n.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:n,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},tue=0,ze=class extends Q.Serializable{constructor(n={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=tue++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=n.name;if(!e){let r=this.getClassName();e=Xo(r)+"_"+Uc(r)}if(this.name=e,this.trainable_=n.trainable==null?!0:n.trainable,n.inputShape!=null||n.batchInputShape!=null){let r;if(n.batchInputShape!=null)r=n.batchInputShape;else if(n.inputShape!=null){let i=null;n.batchSize!=null&&(i=n.batchSize),r=[i].concat(n.inputShape)}this.batchInputShape=r;let o=n.dtype;o==null&&(o=n.inputDType),o==null&&(o="float32"),this.dtype=o}n.weights!=null?this.initialWeights=n.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(n,e){return n.name+"_ib-"+e.toString()}getNodeAtIndex(n,e){if(this.inboundNodes.length===0)throw new gr(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=n)throw new L(`Asked to get ${e} at node ${n}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[n]}getInputAt(n){return On(this.getNodeAtIndex(n,"input").inputTensors)}getOutputAt(n){return On(this.getNodeAtIndex(n,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Co(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new Co(`Layer ${this.name} is not connected, no input to return.`);return On(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new Co(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Co(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return On(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(n=>n())}get updates(){return this._updates}get built(){return this._built}set built(n){this._built=n}get trainable(){return this.trainable_}set trainable(n){this._trainableWeights.forEach(e=>e.trainable=n),this.trainable_=n}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(n=>n.trainable):[]}set trainableWeights(n){this._trainableWeights=n}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(n=>!n.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(n){this._nonTrainableWeights=n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(n){if(n=Tt(n),this.inputSpec==null||this.inputSpec.length===0)return;let e=Tt(this.inputSpec);if(n.length!==e.length)throw new L(`Layer ${this.name} expects ${e.length} inputs, but it received ${n.length} input tensors. Input received: ${n}`);for(let r=0;r<n.length;r++){let o=n[r],i=e[r];if(i==null)continue;let s=o.rank;if(i.ndim!=null&&s!==i.ndim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${s}`);if(i.maxNDim!=null&&s>i.maxNDim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${s}`);if(i.minNDim!=null&&s<i.minNDim)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${s}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new L(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){let a=o.shape;for(let l in i.axes){let c=Number(l),u=i.axes[l],d=c>=0?a[c]:a[a.length+c];if(u!=null&&[u,null].indexOf(d)===-1)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected axis ${c} of input shape to have value ${u} but got shape ${a}.`)}}if(i.shape!=null)for(let a=0;a<i.shape.length;++a){let l=i.shape[a],c=o.shape[a];if(l!=null&&c!=null&&l!==c)throw new L(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(n,e){return n}invokeCallHook(n,e){this._callHook!=null&&this._callHook(n,e)}setCallHook(n){this._callHook=n}clearCallHook(){this._callHook=null}apply(n,e){e=e||{},this.assertNotDisposed();let r=Tt(n),o=!0;for(let s of r)if(!(s instanceof cr)){o=!1;break}let i=!0;for(let s of r)if(s instanceof cr){i=!1;break}if(o===i)throw new L("Arguments to apply() must be all SymbolicTensors or all Tensors");return Ti(this.name,()=>{if(!this.built){this.assertInputCompatibility(n);let s=[];for(let a of Tt(n))s.push(a.shape);this.build(On(s)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&i&&(this._refCount=1)}if(this.assertInputCompatibility(n),i){let s=this.call(n,e),a=Tt(s),l=[];for(let c of a)r.indexOf(c)!==-1&&(c=c.clone()),l.push(c);if(s=On(l),this.activityRegularizer!=null)throw new Ne("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}else{let s=nue(n),a=this.computeOutputShape(s),l,c=rue(n);if(this.warnOnIncompatibleInputShape(Array.isArray(n)?s[0]:s),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((u,d)=>new cr(c,u,this,Tt(n),e,this.name,d)):l=new cr(c,a,this,Tt(n),e,this.name),this.addInboundNode(n,l,null,null,s,a,e),this._refCount++,this.activityRegularizer!=null)throw new Ne("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(n){if(this.batchInputShape!=null)if(n.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(n)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach((r,o)=>{r!=null&&n[o]!=null&&n[o]!==r&&(e=!0)}),e&&console.warn(`The shape of the input tensor (${JSON.stringify(n)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new Co(`The layer ${this.name} has never been called and thus has no defined output shape.`);let n=[];for(let e of this.inboundNodes){let r=JSON.stringify(e.outputShapes);n.indexOf(r)===-1&&n.push(r)}if(n.length===1){let e=this.inboundNodes[0].outputShapes;return Array.isArray(e)&&Array.isArray(e[0])&&e.length===1?e[0]:e}else throw new Co(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new gr(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return wm(this.weights)}build(n){this.built=!0}getWeights(n=!1){return fy(n?this.trainableWeights:this.weights)}setWeights(n){z(()=>{let e=this.weights;if(e.length!==n.length)throw new L(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${n.length}, but the layer was expecting ${e.length} weights. Provided weights: ${n}...`);if(e.length===0)return;let r=[],o=fy(e);for(let i=0;i<o.length;++i){let s=o[i],a=e[i],l=n[i];if(!b.arraysEqual(s.shape,l.shape))throw new L(`Layer weight shape ${s.shape} not compatible with provided weight shape ${l.shape}`);r.push([a,l])}Cm(r)})}addWeight(n,e,r,o,i,s,a){if(this._addedWeightNames.indexOf(n)!==-1)throw new L(`Duplicate weight name ${n} for layer ${this.name}`);this._addedWeightNames.push(n),r==null&&(r="float32"),this.fastWeightInitDuringBuild&&(o=It("zeros"));let l=o.apply(e,r),c=new py(l,r,n,s,a);return l.dispose(),i!=null&&this.addLoss(()=>i.apply(c.read())),s==null&&(s=!0),s?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(n){this.fastWeightInitDuringBuild=n}addLoss(n){n==null||Array.isArray(n)&&n.length===0||(n=Tt(n),this._losses!==void 0&&this._losses!==null&&this.losses.push(...n))}computeOutputShape(n){return n}computeMask(n,e){if(!this.supportsMasking){if(e!=null)if(Array.isArray(e))e.forEach(r=>{if(r!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return e}addInboundNode(n,e,r,o,i,s,a=null){let l=Tt(n);e=Tt(e),r=Tt(r),o=Tt(o),i=bm(i),s=bm(s);let c=[],u=[],d=[];for(let p of l)c.push(p.sourceLayer),u.push(p.nodeIndex),d.push(p.tensorIndex);new Za({outboundLayer:this,inboundLayers:c,nodeIndices:u,tensorIndices:d,inputTensors:l,outputTensors:e,inputMasks:r,outputMasks:o,inputShapes:i,outputShapes:s},a);for(let p=0;p<e.length;p++)e[p].sourceLayer=this,e[p].nodeIndex=this.inboundNodes.length-1,e[p].tensorIndex=p}getConfig(){let n={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(n.batchInputShape=this.batchInputShape),this.dtype!=null&&(n.dtype=this.dtype),n}disposeWeights(){return this.weights.forEach(n=>n.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let n=0;return--this._refCount===0&&(n=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:n}}};function nue(t){t=Tt(t);let n=[];for(let e of t)n.push(e.shape);return On(n)}function rue(t){return"float32"}function tN(t,n,e){if((n==null||e!=null&&e>0)&&(n=t.sourceLayer,e=t.nodeIndex),n.inboundNodes.length===0)return[t];{let r=n.inboundNodes[e];if(r.inboundLayers.length===0)return r.inputTensors;{let o=[];for(let i=0;i<r.inboundLayers.length;i++){let s=r.inputTensors[i],a=r.inboundLayers[i],l=r.nodeIndices[i],c=tN(s,a,l);for(let u of c)o.indexOf(u)===-1&&o.push(u)}return o}}}var Od=(()=>{class t extends ze{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Uc("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new L("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new L("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new L("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let o=e.dtype||"float32";this.batchInputShape=r,this.dtype=o,this.inputSpec=[{shape:r}];let i=new cr(this.dtype,this.batchInputShape,this,[],{},this.name);i.nodeIndex=0,i.tensorIndex=0,new Za({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[i],outputTensors:[i],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new L(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}return t.className="InputLayer",t})();Q.registerClass(Od);function nN(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new L("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let n=t.batchShape;t.shape!=null&&n==null&&(n=[null].concat(t.shape));let e=t.dtype;return e==null&&(e="float32"),new Od({batchInputShape:n,name:t.name,dtype:e,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}async function Ja(t){if(t==null)return;let n=[],e=[],r=[];for(let o in t){let i=t[o];if(typeof i!="number"){let s=i;n.push(s.data()),e.push(o),r.push(s)}}if(n.length>0){let o=await Promise.all(n);for(let i=0;i<o.length;++i)t[e[i]]=o[i][0];Fe(r)}}function gw(t){if(t!=null)for(let n in t){let e=t[n];typeof e!="number"&&e.dispose()}}var oue=125,jc=class{constructor(){this.validationData=null}setParams(n){this.params=n}async onEpochBegin(n,e){}async onEpochEnd(n,e){}async onBatchBegin(n,e){}async onBatchEnd(n,e){}async onTrainBegin(n){}async onTrainEnd(n){}setModel(n){}},yw=class{constructor(n,e=10){n==null&&(n=[]),this.callbacks=n,this.queueLength=e}append(n){this.callbacks.push(n)}setParams(n){for(let e of this.callbacks)e.setParams(n)}setModel(n){for(let e of this.callbacks)e.setModel(n)}async onEpochBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochBegin(n,e)}async onEpochEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onEpochEnd(n,e)}async onBatchBegin(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchBegin(n,e)}async onBatchEnd(n,e){e==null&&(e={});for(let r of this.callbacks)await r.onBatchEnd(n,e)}async onTrainBegin(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainBegin(n)}async onTrainEnd(n){n==null&&(n={});for(let e of this.callbacks)await e.onTrainEnd(n)}},rN=class extends jc{constructor(){super()}async onEpochBegin(n){this.seen=0,this.totals={}}async onBatchEnd(n,e){e==null&&(e={});let r=e.size==null?0:e.size;this.seen+=r;for(let o in e){let i=e[o];if(typeof i=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+i*r;else{let s;o in this.totals?s=this.totals[o]:this.totals[o]=0;let a=z(()=>ee(this.totals[o],V(i,r)));this.totals[o]=a,s?.dispose()}}}async onEpochEnd(n,e){if(e!=null)for(let r of this.params.metrics)this.totals[r]!=null&&(typeof this.totals[r]=="number"?e[r]=this.totals[r]/this.seen:z(()=>{let o=V(me(1,this.seen),this.totals[r]);e[r]=o,this.totals[r].dispose(),An(e[r])}))}},xw=class extends jc{async onTrainBegin(n){this.epoch=[],this.history={}}async onEpochEnd(n,e){e==null&&(e={}),this.epoch.push(n);for(let r in e)this.history[r]==null&&(this.history[r]=[]),this.history[r].push(e[r])}async syncData(){let n=[],e=[],r=[];for(let i in this.history){let s=this.history[i];for(let a=0;a<s.length;++a)if(typeof s[a]!="number"){let l=s[a];n.push(l.data()),e.push(i),r.push(a)}}let o=await Promise.all(n);for(let i=0;i<o.length;++i)this.history[e[i]][r[i]].dispose(),this.history[e[i]][r[i]]=o[i][0]}},vw=class extends jc{constructor(n,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=oue),this.yieldEvery==="never"&&n.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");b.isNumber(this.yieldEvery)&&(this.maybeWait=_B(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=n.onTrainBegin,this.trainEnd=n.onTrainEnd,this.epochBegin=n.onEpochBegin,this.epochEnd=n.onEpochEnd,this.batchBegin=n.onBatchBegin,this.batchEnd=n.onBatchEnd,this.yield=n.onYield}async maybeWait(n,e,r){let o=[];this.yield!=null&&(await Ja(r),o.push(this.yield(n,e,r))),o.push(ly()),await Promise.all(o)}async onEpochBegin(n,e){this.currentEpoch=n,this.epochBegin!=null&&(await Ja(e),await this.epochBegin(n,e))}async onEpochEnd(n,e){let r=[];this.epochEnd!=null&&(await Ja(e),r.push(this.epochEnd(n,e))),this.yieldEvery==="epoch"&&r.push(ly()),await Promise.all(r)}async onBatchBegin(n,e){this.batchBegin!=null&&(await Ja(e),await this.batchBegin(n,e))}async onBatchEnd(n,e){let r=[];this.batchEnd!=null&&(await Ja(e),r.push(this.batchEnd(n,e))),this.yieldEvery==="batch"?r.push(ly()):b.isNumber(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,n,e)),await Promise.all(r)}async onTrainBegin(n){this.trainBegin!=null&&(await Ja(n),await this.trainBegin(n))}async onTrainEnd(n){this.trainEnd!=null&&(await Ja(n),await this.trainEnd(n))}};function bw(t,n){return t==null&&(t={}),t instanceof jc?[t]:Array.isArray(t)&&t[0]instanceof jc?t:Tt(t).map(r=>new vw(r,n))}var sz=(()=>{class t{constructor(){}static registerCallbackConstructor(e,r){b.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),t.checkForDuplicate(r),t.constructors[e]==null&&(t.constructors[e]=[]),t.constructors[e].push(r)}static checkForDuplicate(e){for(let r in t.constructors)t.constructors[+r].forEach(i=>{if(i===e)throw new L("Duplicate callback constructor.")})}static clear(){t.constructors={}}static createCallbacks(e){let r=[];for(let o in t.constructors){let i=+o;e>=i&&r.push(...t.constructors[i])}return r.map(o=>new o)}}return t.constructors={},t})();function ww(t,n,e,r,o,i,s,a,l){let c=new xw,u=[new rN,...sz.createCallbacks(n)];t!=null&&u.push(...t),u.push(c);let d=new yw(u);return d.setParams({epochs:e,initialEpoch:r,samples:o,steps:i,batchSize:s,verbose:n,doValidation:a,metrics:l}),{callbackList:d,history:c}}function Rr(t,n={},e=!1){return cs(t,Q.SerializationMap.getMap().classNameMap,n,"layer",e)}function my(t,n){return z(()=>{t.dtype!=="float32"&&(t=t.asType("float32"));let e=ve(Rd(t),n,!0),r=Kg(e.shape,mn()),o=Bt(Jr(e,r));return me(t,o)})}function Md(t,n){return z(()=>Gt(Rd(we(n,t)),-1))}function gy(t,n){return z(()=>Gt(bn(we(n,t)),-1))}function yy(t,n){return z(()=>{let e=we(t,n),r=Vn(bn(t),mn(),Number.MAX_VALUE),o=bn(me(e,r));return V(100,Gt(o,-1))})}function iue(t,n){return z(()=>{let e=Vn(n,mn(),Number.MAX_VALUE),r=mr(ee(1,e)),o=Vn(t,mn(),Number.MAX_VALUE),i=mr(ee(1,o));return Gt(Rd(we(r,i)),-1)})}function sue(t,n){return z(()=>{let e=Jr(0,we(1,V(t,n)));return Gt(Rd(e),-1)})}function aue(t,n){return z(()=>{let e=Jr(0,we(1,V(t,n)));return Gt(e,-1)})}function lue(t,n){return z(()=>{let e=ve(V(t,n),-1),r=zn(V(we(1,t),n),-1);return Jr(0,ee(1,we(r,e)))})}function cue(t,n){return z(()=>{let e=Math.log(2),r=we(n,t),o=we(ee(r,ss(V(-2,r))),e);return Gt(o,-1)})}function Fd(t,n,e=!1){return z(()=>{if(e)n=Cd(n);else{let r=ve(n,n.shape.length-1,!0);n=me(n,r)}return n=Vn(n,mn(),1-mn()),yt(ve(V(t.toFloat(),mr(n)),n.shape.length-1))})}function Sm(t,n,e=!1){return z(()=>{let r=Ha(UB(t)).toInt();n=Vn(n,mn(),1-mn());let o=n.shape,i=Jf(r,o[o.length-1]).reshape(o);return Fd(i,n,e)})}function uue(t,n){if(!b.arraysEqual(t.shape,n.shape))throw new L(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(n.shape)}`);return z(()=>{let e=n.relu(),r=n.abs().neg();return e.sub(n.mul(t)).add(r.exp().log1p())})}function _m(t,n){return z(()=>{let e;return e=Vn(n,mn(),1-mn()),e=mr(me(e,we(1,e))),Gt(uue(t,e),-1)})}function due(t,n){return z(()=>{let e=Vn(t,mn(),1),r=Vn(n,mn(),1);return ve(V(t,mr(me(e,r))),-1)})}function pue(t,n){return z(()=>{let e=mr(ee(mn(),n));return Gt(we(n,V(t,e)),-1)})}function Cw(t,n){return z(()=>{let e=my(t,-1),r=my(n,-1),o=V(e,r);return yt(ve(o,-1))})}var hy={meanSquaredError:Md,meanAbsoluteError:gy,meanAbsolutePercentageError:yy,meanSquaredLogarithmicError:iue,squaredHinge:sue,hinge:aue,categoricalHinge:lue,logcosh:cue,categoricalCrossentropy:Fd,sparseCategoricalCrossentropy:Sm,binaryCrossentropy:_m,kullbackLeiblerDivergence:due,poisson:pue,cosineProximity:Cw};function Sw(t){if(typeof t=="string"){if(t in hy)return hy[t];let n=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(n=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new L(n)}else return t}function Iw(t,n){return z(()=>{let e=V(.5,Rn(n)),r=Ya(Bn(n,e),t.dtype);return Gt(jo(t,r),-1)})}function Ew(t,n){return z(()=>Ya(jo(tm(t,-1),tm(n,-1)),"float32"))}function fue(t,n){return z(()=>ar(t.equal(1),n.equal(1)).sum().cast("float32"))}function mue(t,n){return z(()=>ar(t.equal(0),n.equal(1)).sum().cast("float32"))}function lz(t,n){return z(()=>{let e=fue(t,n),r=mue(t,n),o=e.add(r);return an(Bn(o,0),e.div(o),0).cast("float32")})}function oN(t,n){return _m(t,n)}function iN(t,n){return t.rank===n.rank&&(t=t.squeeze([t.rank-1])),n=n.argMax(-1),n.dtype!==t.dtype&&(n=n.asType(t.dtype)),jo(t,n).asType("float32")}var hue=Md,gue=Md,yue=gy,xue=gy,vue=yy,bue=yy,Tw=Fd,wue=Cw,sN=Sm,_w={binaryAccuracy:Iw,categoricalAccuracy:Ew,precision:lz,categoricalCrossentropy:Tw,sparseCategoricalCrossentropy:sN,mse:hue,MSE:gue,mae:yue,MAE:xue,mape:vue,MAPE:bue,cosine:wue};function cz(t){if(typeof t=="string"&&t in _w)return _w[t];if(typeof t!="string"&&t!=null)return t;throw new L(`Unknown metric ${t}`)}function xy(t){if(So(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let n;for(let e of Object.keys(hy))if(hy[e]===t){n=e;break}if(n!==void 0)return n;for(let e of Object.keys(_w))if(_w[e]===t){n=e;break}return n!==void 0?n:t.name}}function dz(t){let n={Adagrad:()=>Nd.adagrad(.01),Adadelta:()=>Nd.adadelta(1,.95,mn()),Adam:()=>Nd.adam(.001,.9,.999,mn()),Adamax:()=>Nd.adamax(.002,.9,.999,mn(),0),RMSProp:()=>Nd.rmsprop(.001,.9,0,mn()),SGD:()=>Nd.sgd(.01)};if(n.adagrad=n.Adagrad,n.adadelta=n.Adadelta,n.adam=n.Adam,n.adamax=n.Adamax,n.rmsprop=n.RMSProp,n.sgd=n.SGD,t in n)return n[t]();throw new L(`Unknown Optimizer ${t}`)}function lN(t,n,e=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!aN(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(e){let r=JSON.stringify(t);r.length>1048576&&console.warn(`User-defined metadata of model "${n}" is too large in size (length=${r.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= 1048576.`)}}function aN(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let n=Object.keys(t);for(let e of n)if(typeof e!="string"||!aN(t[e]))return!1;return!0}else if(Array.isArray(t)){for(let n of t)if(!aN(n))return!1;return!0}else return!1;else{let n=typeof t;return n==="string"||n==="number"||n==="boolean"}}function pz(t,n,e,r=console.log){let o=_ue(t),i=["Layer (type)","Output shape","Param #"];o?(n=n||65,e=e||[.45,.85,1]):(n=n||98,e=e||[.33,.55,.67,1]),e[e.length-1]<=1&&(e=e.map(u=>Math.floor(n*u)));let s;if(!o){i.push("Receives inputs"),s=[];for(let u in t.nodesByDepth)s.push(...t.nodesByDepth[u])}r("_".repeat(n)),Dw(i,e,r),r("=".repeat(n));let a=t.layers;for(let u=0;u<a.length;++u)o?Iue(a[u],e,r):Eue(a[u],e,s,r),r((u===a.length-1?"=":"_").repeat(n));t.checkTrainableWeightsConsistency();let l=Sue(t),c=wm(t.nonTrainableWeights);r(`Total params: ${l+c}`),r(`Trainable params: ${l}`),r(`Non-trainable params: ${c}`),r("_".repeat(n))}function Sue(t){let n;return t.collectedTrainableWeights!=null?n=wm(t.collectedTrainableWeights):n=wm(t.trainableWeights),n}function _ue(t){let n=!0,e=[],r=[];for(let o in t.nodesByDepth)e.push(t.nodesByDepth[o]);for(let o of e){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){n=!1;break}r.push(...o)}if(n)for(let o of t.layers){let i=!1;for(let s of o.inboundNodes)if(r.indexOf(s)!==-1)if(i){n=!1;break}else i=!0;if(!n)break}return n}function Dw(t,n,e=console.log){let r="";for(let o=0;o<t.length;++o)o>0&&(r=r.slice(0,r.length-1)+" "),r+=t[o],r=r.slice(0,n[o]),r+=" ".repeat(n[o]-r.length);e(r)}function Iue(t,n,e){let r;try{r=JSON.stringify(t.outputShape)}catch{r="multiple"}let o=t.name,i=t.getClassName(),s=[`${o} (${i})`,r,t.countParams().toString()];Dw(s,n,e)}function Eue(t,n,e,r){let o;try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let u of t.inboundNodes)if(!(e!=null&&e.length>0&&e.indexOf(u)===-1))for(let d=0;d<u.inboundLayers.length;++d){let p=u.inboundLayers[d].name,f=u.nodeIndices[d],m=u.tensorIndices[d];i.push(`${p}[${f}][${m}]`)}let s=t.name,a=t.getClassName(),l=i.length===0?"":i[0],c=[`${s} (${a})`,o,t.countParams().toString(),l];Dw(c,n,r);for(let u=1;u<i.length;++u)Dw(["","","",i[u]],n,r)}function fz(t,n,e){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&n===0&&typeof e=="string"}function Im(t,n){if(t===null)return null;if(typeof t=="string")return Ka(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];fz(n,o,i)?e.push(i):e.push(Im(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r];if(r==="name"&&typeof o=="string")e[r]=o;else{let i=Ka(r);e[i]=Im(o,i)}}return e}}function Nw(t,n){if(t==null)return null;if(typeof t=="string")return Xo(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let e=[],r=t.length;for(let o=0;o<r;++o){let i=t[o];fz(n,o,i)?e.push(i):e.push(Nw(i,n))}return e}else{let e={};for(let r of Object.keys(t)){let o=t[r],i=Xo(r);(r==="name"||r==="className")&&typeof o=="string"?e[i]=o:e[i]=Nw(o,r)}return e}}var Em="3.6.0";function Tue(t,n){if(t.dtype==null||t.dtype===n.dtype)return n;try{return le(n,t.dtype)}catch{throw new L(`The dtype of the feed (${n.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var ds=class t{constructor(n){if(this.id2Value={},this.id2Mask={},this.name2Id={},n instanceof t)for(let e in n.id2Value)this.id2Value[e]=n.id2Value[e],e in n.id2Mask&&(this.id2Mask[e]=n.id2Mask[e]);else{if(n==null)return;for(let e of n)this.add(e.key,e.value)}}add(n,e,r){if(this.id2Value[n.id]==null)this.id2Value[n.id]=Tue(n,e),this.name2Id[n.name]=n.id,r!=null&&(this.id2Mask[n.id]=r);else throw new L(`Duplicate key: name=${n.name}, id=${n.id}`);return this}addFeed(n){this.add(n.key,n.value)}hasKey(n){return this.id2Value[n.id]!=null}names(){return Object.keys(this.name2Id)}getValue(n){if(n instanceof cr){if(this.id2Value[n.id]==null)throw new L(`Nonexistent key: ${n.name}`);return this.id2Value[n.id]}else{let e=this.name2Id[n];if(e==null)throw new L(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Value[e]}}getMask(n){if(n instanceof cr){if(this.id2Value[n.id]==null)throw new L(`Nonexistent key: ${n.name}`);return this.id2Mask[n.id]}else{let e=this.name2Id[n];if(e==null)throw new L(`Feed dict has no SymbolicTensor name: ${n}`);return this.id2Mask[e]}}disposeMasks(){this.id2Mask!=null&&Fe(this.id2Mask)}},cN={},mz={};function Pd(t,n,e,r){let o=e==null?!1:e.training,i=Array.isArray(t),s=i?t:[t],a=s.map(m=>m.name),l=[],c=n.names();for(let m of a)c.indexOf(m)!==-1?l.push(n.getValue(m)):l.push(null);r!=null&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);let u=a.join(",")+"|"+n.names().join(","),d,p;if(cN[u]==null){let m=Due(s,n);d=m.sorted,p=m.recipientCounts,cN[u]=d,mz[u]=p}d=cN[u],p={},o||Object.assign(p,mz[u]);let f=new ds(n);for(let m=0;m<d.length;++m){if(r!=null){let R=jg().numTensors;R>r.maxNumTensors&&(r.maxNumTensors=R),R<r.minNumTensors&&(r.minNumTensors=R)}let h=d[m],g=h.sourceLayer;if(g instanceof Od)continue;let y=[],v=[],S=[],C=!1;for(let R of h.inputs){let P=f.getValue(R),U=f.getMask(R);y.push(P),v.push(U),U!=null&&(C=!0),o||(p[R.name]--,p[R.name]===0&&!n.hasKey(R)&&a.indexOf(R.name)===-1&&!P.isDisposed&&R.sourceLayer.stateful!==!0&&S.push(P))}C&&(e=e||{},e.mask=v[0]);let I=Tt(g.apply(y,e)),E=null;g.supportsMasking&&(E=g.computeMask(y,v));let D=kue(h),O=Array.isArray(D)?D:[D];for(let R=0;R<O.length;++R){f.hasKey(O[R])||f.add(O[R],I[R],Array.isArray(E)?E[0]:E);let P=a.indexOf(O[R].name);P!==-1&&(l[P]=I[R])}o||Fe(S)}return f.disposeMasks(),i?l:l[0]}function Due(t,n){b.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let e=[],r={};if(t.length===1){let o=hz(t[0],n);e=o.sorted,r=o.recipientMap}else{let o=new Set;for(let i of t){let{sorted:s,recipientMap:a}=hz(i,n);for(let l of s)o.has(l.name)||(e.push(l),o.add(l.name));for(let l in a)r[l]==null&&(r[l]=new Set),a[l].forEach(c=>r[l].add(c))}}return{sorted:e,recipientCounts:Nue(r)}}function Nue(t){let n={};for(let e in t)n[e]=t[e].size;return n}function hz(t,n){let e=new Set,r=[],o={};for(let a of n.names())e.add(a);let i=[],s=[];for(i.push(t);i.length>0;){let a=i[i.length-1];if(e.has(a.name)){i.pop();continue}let l=s[s.length-1]===i.length-1;if(a.inputs.length===0||l)i.pop(),r.push(a),e.add(a.name),l&&s.pop();else{s.push(i.length-1);for(let c of a.inputs)o[c.name]==null&&(o[c.name]=new Set),o[c.name].add(a.name),!e.has(c.name)&&i.push(c)}}return{sorted:r,recipientMap:o}}function kue(t){let n;if(t.sourceLayer.inboundNodes.length===1)n=t.sourceLayer.output;else{let e=null;for(let r=0;r<t.sourceLayer.inboundNodes.length;++r)for(let o of t.sourceLayer.inboundNodes[r].outputTensors)if(o.id===t.id){e=r;break}n=t.sourceLayer.getOutputAt(e)}return n}var kw=class t extends ze{constructor(n){if(super({}),this.containerNodes=new Set,this.name=n.name,this.name==null){let v=this.getClassName().toLowerCase();this.name=Uc(v)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(n.inputs)?this.inputs=n.inputs.slice():this.inputs=[n.inputs],Array.isArray(n.outputs)?this.outputs=n.outputs.slice():this.outputs=[n.outputs],Yo(this.inputs).length!==this.inputs.length)throw new L(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(v=>v.name)}`);Yo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(v=>v.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let v of this.outputs){let S=v.sourceLayer,C=v.nodeIndex,I=v.tensorIndex;this.outputLayers.push(S),this.outputLayersNodeIndices.push(C),this.outputLayersTensorIndices.push(I)}for(let v of this.inputs){let S=v.sourceLayer,C=v.nodeIndex,I=v.tensorIndex;So(C===0,"input layer has >1 nodes"),So(I===0,"input layer has >1 tensors"),this.inputLayers.push(S),this.inputLayersNodeIndices.push(C),this.inputLayersTensorIndices.push(I)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let v=0;v<this.inputLayers.length;v++){let S=this.inputLayers[v];if(!(S instanceof Od))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${n.inputs}. Input ${v} (0-based) originates from layer type ${S.getClassName()}.`);this.inputNames.push(S.name),this.feedInputShapes.push(S.batchInputShape),this.feedInputNames.push(S.name)}for(let v of this.outputLayers)this.outputNames.push(v.name);this.internalInputShapes=this.inputs.map(v=>v.shape),this.internalOutputShapes=this.outputs.map(v=>v.shape);let e={},r={},o={},i={},s={},a=[],l=(v,S,C,I,E,D)=>{(I==null||E==null||D==null)&&(I=v.sourceLayer,E=v.nodeIndex,D=v.tensorIndex);let O=I.inboundNodes[E];if(C.indexOf(O)!==-1)throw new gr(`The tensor ${v.name} at layer "${I.name}" is part of a cycle.`);if(S.indexOf(O)!==-1)return;this.containerNodes.add(t.nodeKey(I,E)),I.id in s||(s[I.id]=Object.keys(s).length),C.indexOf(O)===-1&&C.push(O);let R=O.inboundLayers.length;for(let P=0;P<R;P++){let U=O.inputTensors[P],G=O.inboundLayers[P],q=O.nodeIndices[P],X=O.tensorIndices[P];l(U,S,C,G,q,X)}for(S.push(O);C.indexOf(O)>=0;)C.splice(C.indexOf(O),1);a.push(O)},c=[],u=[];for(let v of this.outputs)l(v,c,u);let d=a.slice().reverse();for(let v of d){r[v.id]=v,v.id in e||(e[v.id]=0);let S=e[v.id],C=o[v.outboundLayer.id]==null?0:o[v.outboundLayer.id];S=Math.max(S,C),o[v.outboundLayer.id]=S,i[v.outboundLayer.id]=v.outboundLayer,e[v.id]=S;for(let I=0;I<v.inboundLayers.length;I++){let E=v.inboundLayers[I],D=v.nodeIndices[I],O=E.inboundNodes[D],R=e[O.id]==null?0:e[O.id];e[O.id]=Math.max(S+1,R),r[O.id]=O}}let p={};for(let v in e){let S=e[v];S in p||(p[S]=[]),p[S].push(r[v])}let f={};for(let v in o){let S=o[v];S in f||(f[S]=[]),f[S].push(i[v])}let m=Object.keys(f).map(v=>parseInt(v,10)).sort(cy);this.layers=[];for(let v of m){let S=f[v];S.sort((C,I)=>{let E=s[C.id],D=s[I.id];return E<D?-1:E>D?1:0});for(let C of S)C instanceof t&&this.internalContainerRefs.push(C),this.layers.push(C)}this.layersByDepth=f,m=Object.keys(p).map(v=>parseInt(v,10)).sort(cy);let h=this.inputs.slice(),g=[];for(let v of m)for(let S of p[v]){let C=S.outboundLayer;if(C!=null){for(let I of S.inputTensors)if(h.indexOf(I)===-1)throw new gr(`Graph disconnected: cannot obtain value for tensor ${I} at layer "${C.name}". The following previous layers were accessed without issue: ${g}`);for(let I of S.outputTensors)h.push(I);g.push(C.name)}}this.nodesByDepth=p;let y=this.layers.map(v=>v.name);for(let v of y){let S=y.filter(C=>C===v).length;if(S!==1)throw new gr(`The name "${v}" is used ${S} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(y))}this.outboundNodes=[],this.inboundNodes=[],new Za({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(v=>null),outputMasks:this.outputs.map(v=>null),inputShapes:this.inputs.map(v=>v.shape),outputShapes:this.outputs.map(v=>v.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let n={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let e of this.layers)n.numDisposedVariables+=e.dispose().numDisposedVariables;for(let e of this.internalContainerRefs)n.numDisposedVariables+=e.dispose().numDisposedVariables}return n.refCountAfterDispose=this._refCount,n}get trainable(){return this.trainable_}set trainable(n){this.layers.forEach(e=>{e._trainableWeights.forEach(r=>r.trainable=n)}),this.trainable_=n}get trainableWeights(){if(this._trainableWeights.length>0)throw new L("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let n=[];for(let e of this.layers)n=n.concat(e.trainableWeights);return n}get nonTrainableWeights(){let n=[];for(let e of this.layers)n.push(...e.nonTrainableWeights);if(!this.trainable){let e=[];for(let r of this.layers)e.push(...r.trainableWeights);return e.concat(n)}return n}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(n,e=!0){let r={},o=0;for(let s of this.layers)for(let a of s.weights){if(r[a.originalName]!=null)throw new L(`Duplicate weight name: ${a.originalName}`);r[a.originalName]=a,o++}let i=[];for(let s in n){let a=s;if(r[s]==null){let l=s.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(r[a]!=null)i.push([r[a],n[s]]);else if(e)throw new L(`Provided weight data has no target variable: ${s}`);delete r[a]}if(e){let s=[];for(let a in r)s.push(a);if(s.length>0)throw new L(`${s.length} of ${o} weights are not set: ${s}`)}Cm(i)}updatedConfig(){let n=this.getConfig(),e={};return e.className=this.getClassName(),e.config=n,e.kerasVersion=`tfjs-layers ${Em}`,e.backend="TensorFlow.js",e}toJSON(n,e=!0){let r=Nw(this.updatedConfig());return e?JSON.stringify(r):r}call(n,e){return z(()=>{n=Tt(n);let r=new ds;for(let o=0;o<this.inputs.length;++o)r.add(this.inputs[o],n[o]);return Pd(this.outputs,r,e)})}computeMask(n,e){return z(()=>{n=Tt(n);let r;return e==null?r=Ko(null,n.length):r=Tt(e),this.runInternalGraph(n,r)[1]})}computeOutputShape(n){let e=bm(n);if(e.length!==this.inputLayers.length)throw new L(`Invalid inputShape argument ${n}: model has ${this.inputLayers.length} tensor inputs.`);let r={};for(let a=0;a<e.length;a++){let l=this.inputLayers[a],c=e[a],u=l.name+"_0_0";r[u]=c}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(cy);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let c of l){let u=c.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(u.id)!==-1)continue;let d=[];for(let h=0;h<c.inboundLayers.length;h++){let g=c.inboundLayers[h],y=c.nodeIndices[h],v=c.tensorIndices[h],S=`${g.name}_${y}_${v}`,C=r[S];d.push(C)}let p=u.computeOutputShape(On(d)),f=bm(p),m=u.inboundNodes.indexOf(c);for(let h=0;h<f.length;h++){let g=`${u.name}_${m}_${h}`;r[g]=f[h]}}}let i=[],s=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],c=this.outputLayersNodeIndices[a],u=this.outputLayersTensorIndices[a],d=`${l.name}_${c}_${u}`;s.push(d)}for(let a=0;a<s.length;a++){let l=s[a];So(l in r),i.push(r[l])}return On(i)}runInternalGraph(n,e){e==null&&(e=Ko(null,n.length));let r={};for(let l=0;l<this.inputs.length;++l){let c=this.inputs[l],u=n[l],d=e[l];r[c.id]=[u,d]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(cy);for(let l of o){let c=this.nodesByDepth[l];for(let u of c){let d=u.outboundLayer,p=u.inputTensors,f=u.outputTensors,m=new Array;for(let h of p)h.id in r&&m.push(r[h.id]);if(m.length===p.length){let h={},g,y,v,S;if(u.callArgs!=null&&(h=u.callArgs),m.length===1){let[C,I]=m[0];h.mask==null&&(h.mask=I),v=Tt(d.call(C,h)),S=Tt(d.computeMask(C,I)),g=[C],y=[I]}else g=m.map(C=>C[0]),y=m.map(C=>C[1]),h.mask==null&&(h.mask=y),v=Tt(d.call(g,h)),S=Tt(d.computeMask(g,y));if(d.activityRegularizer)throw new Ne("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let C=0;C<f.length;++C){let I=f[C],E=v[C],D=S[C];r[I.id]=[E,D]}}}}let i=[],s=[],a=[];for(let l of this.outputs){So(l.id in r,`Could not compute output ${l.name} : ${l.id}`);let[c,u]=r[l.id];a.push(c.shape),i.push(c),s.push(u)}return[i,s,a]}buildNodeConversionMap(n){let e={},r;for(let o of this.layers){r=o instanceof t?1:0;for(let i=0;i<o.inboundNodes.length;i++){let s=t.nodeKey(o,i);this.containerNodes.has(s)&&(e[s]=r,r+=1)}}return e}getLayer(n,e){if(e!=null){if(this.layers.length<=e)throw new L(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}else if(n==null)throw new L("Provide either a layer name or layer index");for(let r of this.layers)if(r.name===n)return r;throw new L(`No such layer: ${n}`)}calculateLosses(){return z(()=>{let n=[];for(let e of this.layers)for(let r=0;r<e.inboundNodes.length;++r){let o=t.nodeKey(e,r);this.containerNodes.has(o)&&n.push(...e.calculateLosses())}return n})}getConfig(){let n={name:this.name},e=this.buildNodeConversionMap(this.layers),r=[];for(let s of this.layers){let a=s.getClassName(),l=s.getConfig(),c=[];for(let d=0;d<s.inboundNodes.length;d++){let p=s.inboundNodes[d],f=t.nodeKey(s,d),m={};if(this.containerNodes.has(f)){if(p.callArgs)try{JSON.stringify(p.callArgs),m=p.callArgs}catch{console.warn(`Layer ${s.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(p.inboundLayers.length>0){let h=[];for(let g=0;g<p.inboundLayers.length;g++){let y=p.inboundLayers[g],v=p.nodeIndices[g],S=p.tensorIndices[g],C=t.nodeKey(y,v),I=e[C];I==null&&(I=0),h.push([y.name,I,S,m])}c.push(h)}}}let u={};u.name=s.name,u.className=a,u.config=l,u.inboundNodes=c,r.push(u)}n.layers=r;let o=[];for(let s=0;s<this.inputLayers.length;s++){let a=this.inputLayers[s],l=this.inputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.inputLayersTensorIndices[s];o.push([a.name,u,d])}n.inputLayers=o;let i=[];for(let s=0;s<this.outputLayers.length;s++){let a=this.outputLayers[s],l=this.outputLayersNodeIndices[s],c=t.nodeKey(a,l);if(!this.containerNodes.has(c))continue;let u=e[c];u==null&&(u=0);let d=this.outputLayersTensorIndices[s];i.push([a.name,u,d])}return n.outputLayers=i,n}static fromConfig(n,e,r={},o=!1){let i={},s={};function a(g,y){g.name in s?s[g.name].push(y):s[g.name]=[y]}function l(g,y){let v=[],S;for(let C of y){let I=C[0],E=C[1],D=C[2];if(S=C[3]==null?{}:C[3],!(I in i)){a(g,y);return}let O=i[I];if(O.inboundNodes.length<=E){a(g,y);return}let R=O.inboundNodes[E];v.push(R.outputTensors[D])}v.length>0&&g.apply(On(v),S)}function c(g){let y=g.name,v=Rr(g,e.customObjects!=null?e.customObjects:{});v.setFastWeightInitDuringBuild(o),i[y]=v,g.inboundNodes.forEach(C=>{if(!(C instanceof Array))throw new L(`Corrupted configuration, expected array for nodeData: ${C}`);a(v,C)})}let u=e.name,d=e.layers;for(let g of d)c(g);for(;!CB(s);)for(let g of d){let y=i[g.name];if(y.name in s){let v=s[y.name];delete s[y.name];for(let S of v)l(y,S)}}let p=[],f=[],m=e.inputLayers;for(let g of m){let y=g[0],v=g[1],S=g[2];So(y in i);let I=i[y].inboundNodes[v].outputTensors;p.push(I[S])}let h=e.outputLayers;for(let g of h){let y=g[0],v=g[1],S=g[2];So(y in i);let I=i[y].inboundNodes[v].outputTensors;f.push(I[S])}return new n({inputs:p,outputs:f,name:u})}get stateful(){if(this._stateful)throw new L("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let n of this.layers)if(n.stateful)return!0;return!1}resetStates(){z(()=>{this.layers.forEach(n=>{n.stateful&&n.resetStates()})})}};function Aue(t,n,e){let r=n.length;if(t==null||Array.isArray(t)&&t.length===0)return n.map(o=>null);if(r===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&n[0]in t?[t[n[0]]]:[t];if(Array.isArray(t)){if(t.length!==r)throw new Error(`Provided ${e} is an array of ${t.length} element(s), but the model has ${r} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return n.forEach(i=>{i in t?o.push(t[i]):o.push(null)}),o}else throw new Error(`The model has multiple (${r}) outputs, so ${e} must be either an array with ${r} elements or an object with ${n} keys. Provided ${e} not understood: ${JSON.stringify(t)}`)}function Aw(t,n){return Aue(t,n,"classWeight")}async function Rw(t,n,e,r){if(n!=null||r!=null)throw new Error("Support sampleWeight is not implemented yet");if(e!=null){let o=z(()=>{if(t.shape.length===1)return t.clone();if(t.shape.length===2){if(t.shape[1]>1)return t.argMax(1);if(t.shape[1]===1)return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),i=Array.from(await o.data());Fe(o);let s=[];return i.forEach(a=>{if(e[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);s.push(e[a])}),Ho(s,"float32")}else return null}function gz(t,n){return V(t,n)}var Rue=32;function vz(t,n){let e,r,o=n;e=o.xs,r=o.ys,b.assert(e!=null&&r!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${n}`);let i=yz("input",t.inputNames,e),s=yz("output",t.outputNames,r),a=i[0].shape[0];b.assert(i.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${i.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),b.assert(s.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${s.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<i.length;l++)b.assert(i[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<s.length;l++)b.assert(s[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:i,ys:s}}function yz(t,n,e){if(e instanceof ct)return[e];if(Array.isArray(e))return b.assert(e.length===n.length,()=>`Received an array of ${e.length} Tensors, but expected ${n.length} to match the ${t} keys ${n}.`),e;{let r=[];for(let o of n){if(e[o]==null)throw new L(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);r.push(e[o])}return r}}function Oue(t){if(t.length===3)throw new Ne("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function bz(t,n,e){let r=e.batchesPerEpoch!=null;if(b.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),b.assert(e!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),b.assert(e.epochs!=null&&e.epochs>0&&Number.isInteger(e.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${e.epochs}`),b.assert(!r||e.batchesPerEpoch>0&&Number.isInteger(e.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${e.batchesPerEpoch}`),b.assert(e.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=e.validationData!=null,i,s;if(o)if(xz(e.validationData))b.assert(e.validationBatches==null||e.validationBatches>0&&Number.isInteger(e.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${e.validationBatches}`);else{let g=Oue(e.validationData);i=g.xs,s=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),c;o?c=l.slice().concat(l.map(g=>"val_"+g)):c=l.slice();let u=bw(e.callbacks,e.yieldEvery),d=e.verbose==null?1:e.verbose,{callbackList:p,history:f}=ww(u,d,e.epochs,null,null,Mue(n,e),null,o,c);p.setModel(t),t.history=f,await p.onTrainBegin(),t.stopTraining_=!1;let m=e.initialEpoch==null?0:e.initialEpoch,h=await n.iterator();for(;m<e.epochs;){let g={};await p.onEpochBegin(m);let y=0,v=0;for(r||(h=await n.iterator());!r||y<e.batchesPerEpoch;){let S=await h.next();if(r&&S.done){console.warn(`You provided \`batchesPerEpoch\` as ${e.batchesPerEpoch}, but your dataset iterator ran out of data after ${y} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${e.batchesPerEpoch*e.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(S.value!=null){let{xs:C,ys:I}=vz(t,S.value),E={};E.batch=v,E.size=C[0].shape[0],await p.onBatchBegin(v,E);let D=[];if(e.classWeight!=null){let P=Aw(e.classWeight,t.outputNames);for(let U=0;U<P.length;++U)D.push(await Rw(I[U],null,P[U]))}let O=C.concat(I).concat(D),R=a(O);Fe(O);for(let P=0;P<l.length;++P){let U=l[P],G=R[P];E[U]=G,An(G)}await p.onBatchEnd(v,E),gw(E),v++,y++}if(r?y>=e.batchesPerEpoch:S.done){if(o){let C;xz(e.validationData)?C=Tt(await t.evaluateDataset(e.validationData,{batches:e.validationBatches})):C=Tt(t.evaluate(i,s,{batchSize:e.validationBatchSize==null?Rue:e.validationBatchSize,verbose:0}));for(let I=0;I<t.metricsNames.length;++I)g[`val_${t.metricsNames[I]}`]=C[I]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(m,g),m++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Mue(t,n){let e=null;return n.batchesPerEpoch!=null?e=n.batchesPerEpoch:Number.isFinite(t.size)&&(e=t.size),e}function xz(t){return typeof t.iterator=="function"}function Fue(t){return typeof t.next=="function"}async function wz(t,n,e){e=e||{};let r=e.batches!=null,o=t.testFunction,i=[];if(e.verbose>0)throw new Ne("Verbose mode is not implemented yet.");b.assert(!r||e.batches>0&&Number.isInteger(e.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(e.batches)}`);let s=Fue(n)?n:await n.iterator(),a=0,l=0;for(;!r||l<e.batches;){let c=await s.next();if(i=z(()=>{if(c.value){let{xs:u,ys:d}=vz(t,c.value),p=u.concat(d),f=z(()=>o(p));if(Fe(p),l===0)for(let h=0;h<f.length;++h)i.push(Ae(0));let m=p[0].shape[0];for(let h=0;h<f.length;++h){let g=f[h],y=i[h];i[h]=z(()=>ee(i[h],V(m,g))),l>0&&Fe(y)}Fe(f),a+=m,++l}return i}),c.done){r&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${e.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<i.length;++c){let u=i[c];i[c]=me(i[c],a),Fe(u)}return On(i)}function Ow(t){b.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function Tm(t,n,e){return t==null?[null]:Array.isArray(t)?t.map(r=>Xa(r,n,e-n)):Xa(t,n,e-n)}function Mw(t,n){return z(()=>t==null?null:Array.isArray(t)?t.map(e=>Mw(e,n)):uw(t,n.dtype==="int32"?n:n.toInt()))}function Fw(t,n){let e=[],r=0,o=null;for(;r<t;)o=r+n,o>=t&&(o=t),e.push([r,o]),r=o;return e}async function Pue(t,n,e,r,o,i,s,a,l,c,u,d,p,f,m){o==null&&(o=32),i==null&&(i=1),u==null&&(u=!0),p==null&&(p=0);let h=!1;if(l!=null&&c!=null&&(h=!0),m!=null&&(h=!0,f==null))throw new L("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=t.checkNumSamples(e,o,f,"steps_per_epoch"),y;g!=null&&(y=lr(0,g)),s==null&&(s=1);let{callbackList:v,history:S}=ww(a,s,i,p,g,f,o,h,d);v.setModel(t),t.history=S,await v.onTrainBegin(),t.stopTraining_=!1;for(let C=p;C<i;++C){await v.onEpochBegin(C);let I={};if(f!=null)throw new Ne("stepsPerEpoch mode is not implemented yet.");{if(u==="batch")throw new Ne("batch shuffling is not implemneted yet");u&&b.shuffle(y);let E=Ho(y),D=Fw(g,o);for(let O=0;O<D.length;++O){let R={};if(await v.onBatchBegin(O,R),z(()=>{let P=D[O][0],U=D[O][1],G=Xa(E,P,U-P);R.batch=O,R.size=U-P;let q=Mw(e,G),X=n(q);for(let K=0;K<r.length;++K){let Y=r[K],ne=X[K];R[Y]=ne,An(ne)}if(O===D.length-1&&h){let K=t.testLoop(l,c,o);for(let Y=0;Y<r.length;++Y){let ne=r[Y],J=K[Y];An(J),I["val_"+ne]=J}}}),await v.onBatchEnd(O,R),gw(R),t.stopTraining_)break}E.dispose()}if(await v.onEpochEnd(C,I),t.stopTraining_)break}return await v.onTrainEnd(),await t.history.syncData(),t.history}async function Cz(t,n,e,r={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;let o,i,s,a,l,c,u;try{let d=r.batchSize==null?32:r.batchSize;Ow(d);let f=await t.standardizeUserData(n,e,r.sampleWeight,r.classWeight,!1,d);o=f[0],i=f[1],u=f[2];let m=!1,h;if(r.validationData!=null&&r.validationData.length>0){if(m=!0,r.validationData.length===2)s=r.validationData[0],a=r.validationData[1];else throw r.validationData.length===3?new Ne("validationData including sample weights is not supported yet."):new L(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${r.validationData} is invalid.`);let O=await t.standardizeUserData(s,a,null,null,!0,d);l=O[0],c=O[1],h=l.concat(c)}else if(r.validationSplit!=null&&r.validationSplit>0&&r.validationSplit<1){m=!0;let D=Math.floor(o[0].shape[0]*(1-r.validationSplit)),O=o[0].shape[0];l=Tm(o,D,O),o=Tm(o,0,D),c=Tm(i,D,O),i=Tm(i,0,D),h=l.concat(c)}else r.validationSteps!=null&&(m=!0);let g=o.concat(i).concat(u);t.checkTrainableWeightsConsistency();let y=t.makeTrainFunction(),v=t.getDedupedMetricsNames(),S,C;m?(t.makeTestFunction(),S=t.testFunction,C=v.slice().concat(v.map(D=>"val_"+D))):(S=null,h=[],C=v.slice());let I=bw(r.callbacks,r.yieldEvery);return await Pue(t,y,g,v,d,r.epochs,r.verbose,I,S,h,r.shuffle,C,r.initialEpoch,null,null)}finally{t.isTraining=!1,Gc(o,n),Gc(i,e),Gc(l,s),Gc(c,a),u!=null&&Fe(u)}}function uN(t){let n=[];t instanceof ct&&(t=[t]);for(let e=0;e<t.length;++e){let r=t[e];if(r.rank===1)n.push(Qa(r,1));else{if(r.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");n.push(r)}}return n}function Gc(t,n){if(t==null)return;let e=[];if(n instanceof ct)e.push(n.id);else if(Array.isArray(n))n.forEach(o=>e.push(o.id));else if(n!=null)for(let o in n){let i=n[o];e.push(i.id)}let r=[];if(t instanceof ct)e.indexOf(t.id)===-1&&r.push(t);else if(Array.isArray(t))t.forEach(o=>{e.indexOf(o.id)===-1&&r.push(o)});else if(t!=null)for(let o in t){let i=t[o];e.indexOf(i.id)===-1&&r.push(i)}r.forEach(o=>{o.isDisposed||o.dispose()})}function $ue(t){return t instanceof ct}function dN(t){return Array.isArray(t)}function Sz(t){return!$ue(t)&&!dN(t)}function _z(t,n,e,r=!0,o=""){if(n==null||n.length===0){if(t!=null){let s=!1;if(dN(t)&&t.length>0)s=!0;else if(Sz(t)){for(let a in t)if(t.hasOwnProperty(a)){s=!0;break}}else s=!0;if(s)throw new L(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return n.map(s=>null);let i;if(Sz(t)){t=t,i=[];for(let s of n){if(t[s]==null)throw new L(`No data provided for "${s}". Need data for each key in: ${n}`);i.push(t[s])}}else if(dN(t)){if(t=t,t.length!==n.length)throw new L(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${n.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);i=t}else{if(t=t,n.length>1)throw new L(`The model ${o} expects ${n.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);i=[t]}if(i=uN(i),e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new L(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u>=0&&c!==u)throw new L(`Error when checking ${o}: expected ${n[s]} to have shape [${e[s]}], but got array with shape [${a.shape}].`)}}return i}function Lue(t,n,e){let r=Yo(t.map(i=>i.shape[0]));r.sort();let o=Yo(n.map(i=>i.shape[0]));if(o.sort(),r.length>1)throw new L(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(i=>i.shape))}`);if(o.length>1)throw new L(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(i=>i.shape))}`);if(r.length>0&&o.length>0&&!b.arraysEqual(r,o))throw new L(`Input Tensors should have the same number of samples as target Tensors. Found ${r[0]} input sample(s) and ${o[0]} target sample(s).`)}function Vue(t,n,e){let r=[Md,_m,Fd];for(let o=0;o<t.length;++o){let i=t[o],s=n[o],a=e[o];if(s!=null){if(s===Fd&&i.shape[i.shape.length-1]===1)throw new L(`You are passing a target array of shape ${i.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(r.indexOf(s)!==-1){let l=i.shape.slice(1),c=a.slice(1);for(let u=0;u<l.length;++u){let d=l[u],p=c[u];if(p!=null&&d!==p)throw new L(`A target Tensor with shape ${i.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Iz(t,n,e,r=!0,o=""){let i;if(Array.isArray(t)){if(t.length!==n.length)throw new L(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${n.length} Tensor(s), but instead got ${t.length} Tensors(s).`);i=t}else{if(n.length>1)throw new L(`The model expects ${n.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);i=[t]}if(e!=null)for(let s=0;s<n.length;++s){if(e[s]==null)continue;let a=i[s];if(a.shape.length!==e[s].length)throw new L(`Error when checking ${o}: expected ${n[s]} to have ${e[s].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<e[s].length;++l){if(l===0&&!r)continue;let c=a.shape[l],u=e[s][l];if(u!=null&&u!==c)throw new L(`Error when checking ${o}: expected ${n[s]} to have shape ${JSON.stringify(e[s])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Bue(t,n){if(t==null||Array.isArray(t)&&t.length===0)return n.map(r=>[]);let e;if(typeof t=="string"||typeof t=="function")e=[t];else if(Array.isArray(t)||typeof t=="object")e=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(e))return n.map(r=>e);{let r=[];for(let o of n){let i=e.hasOwnProperty(o)?e[o]:[];Array.isArray(i)||(i=[i]),r.push(i)}return r}}var zue="layers-model",el=(()=>{class t extends kw{constructor(e){super(e),this.isTraining=!1}summary(e,r,o=console.log){if(!this.built)throw new L("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");pz(this,e,r,o)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=dz(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Yn))throw new L("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let a in e.loss)if(this.outputNames.indexOf(a)===-1)throw new L(`Unknown entry in loss dictionary: "${a}". Only expected the following keys: ${this.outputNames}`);for(let a of this.outputNames)e.loss[a]==null&&console.warn(`Output "${a}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${a} during training`),r.push(Sw(e.loss[a]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new L(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(l=>Sw(l))}else{let a=Sw(e.loss);this.outputs.forEach(l=>{r.push(a)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let a=0;a<this.outputs.length;++a){let l=this.internalOutputShapes[a],c=this.outputNames[a];this.feedOutputNames.push(c),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[a])}let o=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],Ti("loss",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=this.lossFunctions[a];this.outputs.length>1&&(this.metricsTensors.push([l,a]),this.metricsNames.push(this.outputNames[a]+"_loss"))}});let i=Bue(e.metrics,this.outputNames),s=(a,l,c)=>{this.outputNames.length>1&&(l=this.outputNames[a]+"_"+l),this.metricsNames.push(l),this.metricsTensors.push([c,a])};Ti("metric",()=>{for(let a=0;a<this.outputs.length;++a){if(o.indexOf(a)!==-1)continue;let l=i[a];(u=>{let d="",p,f,m;for(let h of u){if(typeof h=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(h)!==-1){let y=this.internalOutputShapes[a];y[y.length-1]===1||this.lossFunctions[a]===_m?["accuracy","acc"].indexOf(h)!==-1?f=Iw:["crossentropy","ce"].indexOf(h)!==-1&&(f=oN):this.lossFunctions[a]===Sm?["accuracy","acc"].indexOf(h)!==-1?f=iN:["crossentropy","ce"].indexOf(h)!==-1&&(f=sN):["accuracy","acc"].indexOf(h)!==-1?f=Ew:["crossentropy","ce"].indexOf(h)!==-1&&(f=Tw);let v;["accuracy","acc"].indexOf(h)!==-1?v="acc":["crossentropy","ce"].indexOf(h)!==-1&&(v="ce"),m=f,p=d+v}else m=cz(h),p=d+xy(h);let g;Ti(p,()=>{g=m}),s(a,p,g)}})(l)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,o={}){let i=o.batchSize==null?32:o.batchSize;Ow(i);let a=this.standardizeUserDataXY(e,r,!0,i);try{let l=a[0].concat(a[1]);this.makeTestFunction();let c=this.testFunction,u=this.testLoop(c,l,i,o.verbose,o.steps);return On(u)}finally{Gc(a[0],e),Gc(a[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),wz(this,e,r)}checkNumSamples(e,r,o,i="steps"){let s;if(o!=null){if(s=null,r!=null)throw new L(`If ${i} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new L(`Either the input data should have a defined shape, or ${i} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new L("`outputs` is an empty Array, which is not allowed.");let o=Array.isArray(r),i=o?r:[r],s=this.retrieveSymbolicTensors(i),a=new ds;if(e instanceof ct&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new L(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let c=0;c<this.inputs.length;++c)a.add(this.inputs[c],e[c])}else for(let c of this.inputs){let u=e[c.name];if(u==null)throw new L(`No value is provided for the model's input ${c.name}`);a.add(c,u)}let l=Pd(s,a);return o?l:l[0]}retrieveSymbolicTensors(e){let r=Ko(null,e.length),o=e.length;for(let i of this.layers){let s=Array.isArray(i.output)?i.output:[i.output],a=s.map(l=>l.name);for(let l=0;l<e.length;++l){let c=a.indexOf(e[l]);if(c!==-1&&(r[l]=s[c],o--),o===0)break}if(o===0)break}if(o>0){let i=[];throw r.forEach((s,a)=>{s==null&&i.push(e[a])}),new L(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(i)}`)}return r}predictLoop(e,r=32,o=!1){return z(()=>{let i=this.checkNumSamples(e);if(o)throw new Ne("Verbose predictLoop() is not implemented yet.");let s=Fw(i,r),a=this.outputs.map(l=>[]);for(let l=0;l<s.length;++l)z(()=>{let u=s[l][0],d=s[l][1],p=Tm(e,u,d),f=[];if(Array.isArray(p))for(let h=0;h<p.length;++h)f.push({key:this.inputs[h],value:p[h]});else f.push({key:this.inputs[0],value:p});let m=new ds(f);return Pd(this.outputs,m)}).forEach((u,d)=>a[d].push(u));return On(a.map(l=>Lt(l,0)))})}predict(e,r={}){let o=uN(e);Iz(o,this.inputNames,this.feedInputShapes,!1);try{let i=r.batchSize==null?32:r.batchSize;return Ow(i),this.predictLoop(o,i)}finally{Gc(o,e)}}predictOnBatch(e){Iz(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,o=!0,i){if(this.optimizer_==null)throw new gr("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let a=0;a<this.feedOutputShapes.length;++a){let l=this.feedOutputShapes[a];this.feedLossFns[a]===Sm?s.push(l.slice(0,l.length-1).concat([1])):s.push(l)}if(e=_z(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=_z(r,this.feedOutputNames,s,!1,"target"),Lue(e,r,null),Vue(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&i!=null&&i>0&&e[0].shape[0]%i!==0)throw new L(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${i}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,o,i,s=!0,a){let[l,c]=this.standardizeUserDataXY(e,r,s,a);if(o!=null)throw new Error("sample weight is not supported yet.");let u=null;if(i!=null){let d=Aw(i,this.outputNames);u=[];for(let p=0;p<d.length;++p)u.push(await Rw(c[p],null,d[p]))}return[l,c,u]}testLoop(e,r,o,i=0,s){return z(()=>{let a=this.checkNumSamples(r,o,s,"steps"),l=[];if(i>0)throw new Ne("Verbose mode is not implemented yet.");if(s!=null)throw new Ne("steps mode in testLoop() is not implemented yet");{let c=Fw(a,o),u=Ho(lr(0,a));for(let d=0;d<c.length;++d){let p=c[d][0],f=c[d][1],m=Xa(u,p,f-p),h=Mw(r,m),g=e(h);if(d===0)for(let y=0;y<g.length;++y)l.push(Ae(0));for(let y=0;y<g.length;++y){let v=g[y];l[y]=ee(l[y],V(f-p,v))}}for(let d=0;d<l.length;++d)l[d]=me(l[d],a)}return l})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let o=0;o<e.length;++o){let i=e[o],s=i;if(jD(e,i)>1){let a=jD(e.slice(0,o),i);s+=`_${a}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],o=e.slice(0,this.inputs.length),i=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),a=[],l=()=>{let p=[];for(let g=0;g<this.inputs.length;++g)p.push({key:this.inputs[g],value:o[g]});let f=new ds(p),m=Pd(this.outputs,f,{training:!0}),h;for(let g=0;g<this.lossFunctions.length;++g){let y=this.lossFunctions[g],v=y(i[g],m[g]);s[g]!=null&&(v=gz(v,s[g]));let S=Gt(v);r.push(S),g===0?h=v:h=ee(h,v)}for(let g=0;g<this.metricsTensors.length;++g){let y;if(this.outputs.length>1&&g<this.outputs.length)y=r[g];else{let v=this.metricsTensors[g][0],S=this.metricsTensors[g][1];y=Gt(v(i[S],m[S]))}An(y),a.push(y)}return h=Gt(h),this.calculateLosses().forEach(g=>{h=ee(h,g)}),h},c=this.collectedTrainableWeights.map(p=>p.read());return[this.optimizer_.minimize(l,!0,c)].concat(a)}}makeTestFunction(){this.testFunction=e=>z(()=>{let r=[],o,i=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),a=[];for(let u=0;u<this.inputs.length;++u)a.push({key:this.inputs[u],value:i[u]});let l=new ds(a),c=Pd(this.outputs,l);for(let u=0;u<this.lossFunctions.length;++u){let d=this.lossFunctions[u],p=Gt(d(s[u],c[u]));u===0?o=p:o=ee(o,p),r.push(o)}for(let u=0;u<this.metricsTensors.length;++u){let d=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=Gt(d(s[p],c[p]));r.push(f)}return r})}async fit(e,r,o={}){return Cz(this,e,r,o)}async fitDataset(e,r){return bz(this,e,r)}async trainOnBatch(e,r){let o=await this.standardizeUserData(e,r),i=o[0],s=o[1],l=this.makeTrainFunction()(i.concat(s)),c=[];for(let u of l){let d=await u.data();c.push(d[0])}return Fe(l),On(c)}getNamedWeights(e){let r=[],o=e!=null&&e.trainableOnly,i=o?this.trainableWeights:this.weights,s=this.getWeights(o);for(let a=0;a<i.length;++a)o&&!i[a].trainable||r.push({name:i[a].originalName,tensor:s[a]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=jg().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-jg().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Xo(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>Xo(r))}else{let r=Object.keys(this.loss);e={};let o=this.loss;for(let i of r)if(typeof o[i]=="string")e[i]=Xo(o[i]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Xo(xy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Xo(xy(e)));{let e={};for(let r in this.metrics)e[r]=Xo(xy(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=Im(e.optimizer_config),o=Rr(r),i;if(typeof e.loss=="string")i=Ka(e.loss);else if(Array.isArray(e.loss))i=e.loss.map(a=>Ka(a));else if(e.loss!=null){i={};for(let a in e.loss)i[a]=Ka(e.loss[a])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(a=>Ka(a));else if(e.metrics!=null){s={};for(let a in e.metrics)s[a]=Ka(e.metrics[a])}this.compile({loss:i,metrics:s,optimizer:o})}async save(e,r){if(typeof e=="string"){let u=zo.getSaveHandlers(e);if(u.length===0)throw new L(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new L(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new L("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let o=await zo.encodeWeights(this.getNamedWeights(r)),l={modelTopology:this.toJSON(null,!1),format:zue,generatedBy:`TensorFlow.js tfjs-layers v${Em}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){l.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:d,specs:p}=await zo.encodeWeights(await this.optimizer.getWeights(),u);o.specs.push(...p),o.data=zo.concatenateArrayBuffers([o.data,d])}return this.userDefinedMetadata!=null&&(lN(this.userDefinedMetadata,this.name,!0),l.userDefinedMetadata=this.userDefinedMetadata),l.weightData=o.data,l.weightSpecs=o.specs,e.save(l)}setUserDefinedMetadata(e){lN(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}return t.className="Model",t})();Q.registerClass(el);var Uue=(()=>{class t extends el{}return t.className="Functional",t})();Q.registerClass(Uue);async function Ez(t,n){if(n==null&&(n={}),typeof t=="string"){let e=zo.getLoadHandlers(t,n);if(e.length===0)e.push(zo.browserHTTPRequest(t,n));else if(e.length>1)throw new L(`Found more than one (${e.length}) load handlers for URL '${t}'`);t=e[0]}return jue(t,void 0,n)}async function jue(t,n,e){if(e==null&&(e={}),t.load==null)throw new L("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");let r=await t.load(),o=r.modelTopology;o.model_config!=null&&(o=o.model_config);let i=e.strict==null?!0:e.strict,s=r.weightData!=null&&r.weightSpecs!=null&&i,a=Rr(Im(o),n,s),l=r.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),r.userDefinedMetadata!=null&&a.setUserDefinedMetadata(r.userDefinedMetadata),r.weightData!=null){if(r.weightSpecs==null)throw new L("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");let{modelWeights:c,optimizerWeights:u}=Gue(r.weightData,r.weightSpecs);a.loadWeights(c,i),a.optimizer!=null&&u.length>0&&await a.optimizer.setWeights(u),Fe(c),Fe(u.map(d=>d.tensor))}return a}function Gue(t,n){let e=zo.decodeWeights(t,n),r={},o=[];return n.forEach(i=>{i.group==="optimizer"?o.push({name:i.name,tensor:e[i.name]}):r[i.name]=e[i.name]}),{modelWeights:r,optimizerWeights:o}}var pN=(()=>{class t extends el{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Uc("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(o=>o<0))throw new L(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof t||e instanceof el,o;if(r){if(o=e,o.outputs.length!==1)throw new L("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(o.inputs.length!==1)throw new L("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new L("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let i=nN({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(i)}if(r)this.outputs=o.outputs,this.inputs=o.inputs;else{if(e.inboundNodes.length!==1)throw new L(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new L("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=tN(this.outputs[0])}this.inboundNodes=[],new Za({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ko(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(i=>i.shape),outputShapes:this.outputs[0].shape})}else{let i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Qe(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new el({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,o=console.log){this.built||this.build(),super.summary(e,r,o)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,o={}){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.evaluate(e,r,o)}async evaluateDataset(e,r){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,o={}){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.fit(e,r,o)}async fitDataset(e,r){if(!this.built)throw new gr("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,o={},i=!1){let s,a={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new L("Legacy serialization format not supported yet.");s=r}else b.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,a=r;let l=new e(a);if(!(l instanceof t))throw new Ne(`Sequential.fromConfig called on non-Sequential input: ${l}`);for(let c of s){let d=Rr(c,void 0,i);i&&d.setFastWeightInitDuringBuild(!0),l.add(d)}return l}set stopTraining(e){if(this.model==null)throw new L("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new L("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let o={};o.className=r.getClassName(),o.config=r.getConfig(),e.push(o)}return{name:this.name,layers:e}}}return t.className="Sequential",t})();Q.registerClass(pN);function fN(t,n){return n==null&&(n={}),Ez(t,n)}var ur=class extends Q.Serializable{getConfig(){return{}}},Wue=(()=>{class t extends ur{apply(e,r=1){return GB(e,r)}}return t.className="elu",t})();Q.registerClass(Wue);var Hue=(()=>{class t extends ur{apply(e){return Jg(e)}}return t.className="selu",t})();Q.registerClass(Hue);var que=(()=>{class t extends ur{apply(e){return Wo(e)}}return t.className="relu",t})();Q.registerClass(que);var Kue=(()=>{class t extends ur{apply(e){return z(()=>xd(6,Wo(e)))}}return t.className="relu6",t})();Q.registerClass(Kue);var Xue=(()=>{class t extends ur{apply(e){return e}}return t.className="linear",t})();Q.registerClass(Xue);var Yue=(()=>{class t extends ur{apply(e){return Uo(e)}}return t.className="sigmoid",t})();Q.registerClass(Yue);var Que=(()=>{class t extends ur{apply(e){return HB(e)}}return t.className="hardSigmoid",t})();Q.registerClass(Que);var Zue=(()=>{class t extends ur{apply(e){return ss(e)}}return t.className="softplus",t})();Q.registerClass(Zue);var Jue=(()=>{class t extends ur{apply(e){return WB(e)}}return t.className="softsign",t})();Q.registerClass(Jue);var ede=(()=>{class t extends ur{apply(e){return rm(e)}}return t.className="tanh",t})();Q.registerClass(ede);var hN=(()=>{class t extends ur{apply(e,r=-1){return Cd(e,r)}}return t.className="softmax",t})();Q.registerClass(hN);var tde=(()=>{class t extends ur{apply(e,r=-1){return Xg(e,r)}}return t.className="logSoftmax",t})();Q.registerClass(tde);var nde=(()=>{class t extends ur{apply(e,r=1){return z(()=>Uo(e.mul(r)).mul(e))}}return t.className="swish",t})();Q.registerClass(nde);var rde=(()=>{class t extends ur{apply(e){return z(()=>V(e,rm(ss(e))))}}return t.className="mish",t})();Q.registerClass(rde);function Ni(t){return t.getClassName()}function mN(t,n={}){return cs(t,Q.SerializationMap.getMap().classNameMap,n,"activation")}function ki(t){if(t==null){let n={};return n.className="linear",n.config={},mN(n)}if(typeof t=="string"){let n={};return n.className=t,n.config={},mN(n)}else return t instanceof ur?t:mN(t)}function ode(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var Pw=class extends Q.Serializable{},Nz=(()=>{class t extends Pw{constructor(e){super(),ode(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return z(()=>{let r=Vt([1]);return this.hasL1&&(r=ee(r,ve(V(this.l1,bn(e))))),this.hasL2&&(r=ee(r,ve(V(this.l2,Rd(e))))),r.asScalar()})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}}return t.className="L1L2",t})();Q.registerClass(Nz);var Tz={l1l2:"L1L2"};function vt(t){return gm(t)}function Dz(t,n={}){return cs(t,Q.SerializationMap.getMap().classNameMap,n,"regularizer")}function Nt(t){if(t==null)return null;if(typeof t=="string"){let e={className:t in Tz?Tz[t]:t,config:{}};return Dz(e)}else return t instanceof Pw?t:Dz(t)}var kz=(()=>{class t extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=Le(e);let o=Wo(e);return this.maxValue!=null&&(o=Vn(o,0,this.maxValue)),o}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ReLU",t})();Q.registerClass(kz);var Az=(()=>{class t extends ze{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Le(e);return gd(o,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LeakyReLU",t})();Q.registerClass(Az);var Rz=(()=>{class t extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=It(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Nt(e.alphaRegularizer),this.alphaConstraint=Zt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new L(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Qe(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let i of this.sharedAxes)r[i-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let o={};if(this.sharedAxes!=null)for(let i=1;i<e.length;++i)o[i]=e[i];this.inputSpec=[new Dt({ndim:e.length,axes:o})],this.built=!0}call(e,r){return e=Le(e),bd(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Mt(this.alphaInitializer),alphaRegularizer:vt(this.alphaRegularizer),alphaConstraint:Qt(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}}return t.className="PReLU",t})();Q.registerClass(Rz);var Oz=(()=>{class t extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new Ne(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let o=Le(e);return Wa(o)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ELU",t})();Q.registerClass(Oz);var Mz=(()=>{class t extends ze{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let o=Le(e);return o.mul(Ya(o.greater(this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ThresholdedReLU",t})();Q.registerClass(Mz);var Fz=(()=>{class t extends ze{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new hN().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let o=Le(e);return this.softmax(o,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Softmax",t})();Q.registerClass(Fz);function Wc(t,n,e){if(typeof t=="number")return Ko(t,n);if(t.length!==n)throw new L(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${t.length} elements.`);for(let r=0;r<n;++r){let o=t[r];if(!VB(o))throw new L(`The ${e} argument must be an integer or tuple of ${n} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function Or(t,n,e,r,o=1){if(t==null)return t;let i=n+(n-1)*(o-1),s;return e==="same"?s=t:s=t-i+1,Math.floor((s+r-1)/r)}function Ai(t,n,e,r){if(t==null)return null;if(r==="valid")t=t*n+Di([e-n,0]);else if(r==="same")t=t*n;else throw new L(`Unsupport padding mode: ${r}.`);return t}function by(t,n){return z(()=>(Wt(n),n==="channelsFirst"?ot(t,[0,2,3,1]):t))}function gN(t,n){return z(()=>(Wt(n),n==="channelsFirst"?ot(t,[0,2,3,4,1]):t))}function sde(t,n,e,r=1,o="valid",i,s=1){return z(()=>{if(i==null&&(i=hr()),Wt(i),t.shape.length!==3)throw new L(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(n.shape.length!==3)throw new L(`The kernel for a conv1dWithBias operation should be 3, but is ${n.shape.length} instead`);if(e!=null&&e.shape.length!==1)throw new L(`The bias for a conv1dWithBias operation should be 1, but is ${n.shape.length} instead`);if(i==="channelsFirst"&&(t=ot(t,[0,2,1])),o==="causal")throw new Ne("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Wg(t,n,r,o==="same"?"same":"valid","NWC",s);return e!=null&&(a=xr(a,e)),a})}function Pz(t,n,e,r=[1,1],o="valid",i,s,a=null){return z(()=>{if(i==null&&(i=hr()),Wt(i),t.rank!==3&&t.rank!==4)throw new L(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(n.rank!==3&&n.rank!==4)throw new L(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=by(t,i);if(o==="causal")throw new Ne("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=Dd.conv2d({x:l,filter:n,strides:r,pad:o==="same"?"same":"valid",dilations:s,dataFormat:"NHWC",bias:e,activation:a}),i==="channelsFirst"&&(l=ot(l,[0,3,1,2])),l})}function ade(t,n,e,r=[1,1,1],o="valid",i,s){return z(()=>{if(i==null&&(i=hr()),Wt(i),t.rank!==4&&t.rank!==5)throw new L(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(n.rank!==4&&n.rank!==5)throw new L(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=gN(t,i);if(o==="causal")throw new Ne("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=XT(a,n,r,o==="same"?"same":"valid","NDHWC",s),e!=null&&(a=xr(a,e)),i==="channelsFirst"&&(a=ot(a,[0,4,1,2,3])),a})}var vy=class t extends ze{constructor(n,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.verifyArgs(e),this.rank=n,ln(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new Ne(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Wc(e.kernelSize,n,"kernelSize"),this.strides=Wc(e.strides==null?1:e.strides,n,"strides"),this.padding=e.padding==null?"valid":e.padding,yr(this.padding),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),this.activation=ki(e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Zt(e.biasConstraint),this.biasRegularizer=Nt(e.biasRegularizer),this.activityRegularizer=Nt(e.activityRegularizer),this.dilationRate=Wc(e.dilationRate==null?1:e.dilationRate,n,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new L(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new L(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new L(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(n){if(So("kernelSize"in n,"required key 'kernelSize' not in config"),typeof n.kernelSize!="number"&&!ow(n.kernelSize,"number",1,3))throw new L(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(n.kernelSize)}.`)}getConfig(){let n={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Ni(this.activation),useBias:this.useBias,biasInitializer:Mt(this.biasInitializer),biasRegularizer:vt(this.biasRegularizer),activityRegularizer:vt(this.activityRegularizer),biasConstraint:Qt(this.biasConstraint)},e=super.getConfig();return Object.assign(n,e),n}},Dm=class t extends vy{constructor(n,e){super(n,e),this.kernel=null,t.verifyArgs(e),this.filters=e.filters,ln(this.filters,"filters"),this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Zt(e.kernelConstraint),this.kernelRegularizer=Nt(e.kernelRegularizer)}build(n){n=Qe(n);let e=this.dataFormat==="channelsFirst"?1:n.length-1;if(n[e]==null)throw new L(`The channel dimension of the input should be defined. Found ${n[e]}`);let r=n[e],o=this.kernelSize.concat([r,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:r}}],this.built=!0}call(n,e){return z(()=>{n=Le(n);let r,o=this.bias==null?null:this.bias.read(),i=iw(this.activation.getClassName());if(i!=null&&this.rank===2)r=Pz(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,i);else{if(this.rank===1)r=sde(n,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)r=Pz(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)r=ade(n,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new Ne("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(r=this.activation.apply(r))}return r})}computeOutputShape(n){n=Qe(n);let e=[],r=this.dataFormat==="channelsLast"?n.slice(1,n.length-1):n.slice(2);for(let i=0;i<r.length;++i){let s=Or(r[i],this.kernelSize[i],this.padding,this.strides[i],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[i]);e.push(s)}let o=[n[0]];return this.dataFormat==="channelsLast"?(o=o.concat(e),o.push(this.filters)):(o.push(this.filters),o=o.concat(e)),o}getConfig(){let n={filters:this.filters,kernelInitializer:Mt(this.kernelInitializer),kernelRegularizer:vt(this.kernelRegularizer),kernelConstraint:Qt(this.kernelConstraint)},e=super.getConfig();return Object.assign(n,e),n}static verifyArgs(n){if(!("filters"in n)||typeof n.filters!="number"||n.filters<1)throw new L(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(n.filters)}`)}},yN=(()=>{class t extends Dm{constructor(e){super(2,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!ow(e.kernelSize,"number",1,2))throw new L(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv2D",t})();Q.registerClass(yN);var xN=(()=>{class t extends Dm{constructor(e){super(3,e),t.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new L(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv3D",t})();Q.registerClass(xN);var $z=(()=>{class t extends yN{constructor(e){if(super(e),this.inputSpec=[new Dt({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new L(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qe(e),e.length!==4)throw new L("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new L("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dt({ndim:4,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{let o=Le(e);if(o.shape.length!==4)throw new L(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l;this.dataFormat==="channelsFirst"?(a=2,l=3):(a=1,l=2);let c=i[a],u=i[l],d=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],m=this.strides[1],h=Ai(c,f,d,this.padding),g=Ai(u,m,p,this.padding),y=[s,h,g,this.filters];this.dataFormat!=="channelsLast"&&(o=ot(o,[0,2,3,1]));let v=Hg(o,this.kernel.read(),y,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(v=ot(v,[0,3,1,2])),this.bias!=null&&(v=xr(v,this.bias.read(),this.dataFormat)),this.activation!=null&&(v=this.activation.apply(v)),v})}computeOutputShape(e){e=Qe(e);let r=e.slice(),o,i,s;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3):(o=3,i=1,s=2);let a=this.kernelSize[0],l=this.kernelSize[1],c=this.strides[0],u=this.strides[1];return r[o]=this.filters,r[i]=Ai(r[i],c,a,this.padding),r[s]=Ai(r[s],u,l,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv2DTranspose",t})();Q.registerClass($z);var Lz=(()=>{class t extends xN{constructor(e){if(super(e),this.inputSpec=[new Dt({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new L(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Qe(e),e.length!==5)throw new L("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new L("The channel dimension of the inputs should be defined. Found `None`.");let o=e[r],i=this.kernelSize.concat([this.filters,o]);this.kernel=this.addWeight("kernel",i,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Dt({ndim:5,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{let o=Le(e);if(o.shape.length!==5)throw new L(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${o.shape.length}`);let i=o.shape,s=i[0],a,l,c;this.dataFormat==="channelsFirst"?(c=2,a=3,l=4):(c=1,a=2,l=3);let u=i[c],d=i[a],p=i[l],f=this.kernelSize[0],m=this.kernelSize[1],h=this.kernelSize[2],g=this.strides[0],y=this.strides[1],v=this.strides[2],S=Ai(u,g,f,this.padding),C=Ai(d,y,m,this.padding),I=Ai(p,v,h,this.padding),E=[s,S,C,I,this.filters];this.dataFormat!=="channelsLast"&&(o=ot(o,[0,2,3,4,1]));let D=YT(o,this.kernel.read(),E,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(D=ot(D,[0,4,1,2,3])),this.bias!==null&&(D=xr(D,this.bias.read(),this.dataFormat)),this.activation!==null&&(D=this.activation.apply(D)),D})}computeOutputShape(e){e=Qe(e);let r=e.slice(),o,i,s,a;this.dataFormat==="channelsFirst"?(o=1,i=2,s=3,a=4):(o=4,i=1,s=2,a=3);let l=this.kernelSize[0],c=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],p=this.strides[1],f=this.strides[2];return r[o]=this.filters,r[i]=Ai(r[i],d,l,this.padding),r[s]=Ai(r[s],p,c,this.padding),r[a]=Ai(r[a],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}}return t.className="Conv3DTranspose",t})();Q.registerClass(Lz);var lde=(()=>{class t extends Dm{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new L("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new L("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new L(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=It(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Nt(r.depthwiseRegularizer),this.depthwiseConstraint=Zt(r.depthwiseConstraint),this.pointwiseInitializer=It(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Nt(r.pointwiseRegularizer),this.pointwiseConstraint=Zt(r.pointwiseConstraint)}build(e){if(e=Qe(e),e.length<this.rank+2)throw new L(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new L(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let o=e[r],i=this.kernelSize.concat([o,this.depthMultiplier]),s=[];for(let l=0;l<this.rank;++l)s.push(1);s.push(o*this.depthMultiplier,this.filters);let a=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",i,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,a,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,a,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,a,this.biasConstraint):this.bias=null,this.inputSpec=[new Dt({ndim:this.rank+2,axes:{[r]:o}})],this.built=!0}call(e,r){return z(()=>{e=Le(e);let o;if(this.rank===1)throw new Ne("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ot(e,[0,2,3,1])),o=ey(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(o=xr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),this.dataFormat==="channelsFirst"&&(o=ot(o,[0,3,1,2])),o})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Mt(this.depthwiseInitializer),e.pointwiseInitializer=Mt(this.pointwiseInitializer),e.depthwiseRegularizer=vt(this.depthwiseRegularizer),e.pointwiseRegularizer=vt(this.pointwiseRegularizer),e.depthwiseConstraint=Qt(this.depthwiseConstraint),e.pointwiseConstraint=Qt(this.pointwiseConstraint),e}}return t.className="SeparableConv",t})(),Vz=(()=>{class t extends lde{constructor(e){super(2,e)}}return t.className="SeparableConv2D",t})();Q.registerClass(Vz);var Bz=(()=>{class t extends Dm{constructor(e){super(1,e),t.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!ow(e.kernelSize,"number",1,1))throw new L(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}return t.className="Conv1D",t})();Q.registerClass(Bz);var zz=(()=>{class t extends ze{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return z(()=>{if(e=Le(e),this.dataFormat==="channelsLast"){let o=dy(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return dy(o,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let o=dy(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return dy(o,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Cropping2D",t})();Q.registerClass(zz);var Uz=(()=>{class t extends ze{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,$B(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],o=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,o]}else{let r=e[1]==null?null:this.size[0]*e[1],o=e[2]==null?null:this.size[1]*e[2];return[e[0],r,o,e[3]]}}call(e,r){return z(()=>{let o=Le(e),i=o.shape;if(this.dataFormat==="channelsFirst"){o=ot(o,[0,2,3,1]);let s=this.size[0]*i[2],a=this.size[1]*i[3],l=this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a]);return ot(l,[0,3,1,2])}else{let s=this.size[0]*i[1],a=this.size[1]*i[2];return this.interpolation==="nearest"?o.resizeNearestNeighbor([s,a]):o.resizeBilinear([s,a])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="UpSampling2D",t})();Q.registerClass(Uz);function cde(t,n,e=[1,1],r="valid",o,i){return z(()=>{o==null&&(o=hr()),Wt(o);let s=by(t,o);if(t.rank!==4)throw new L(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(n.rank!==4)throw new L(`depthwiseKernel is required to be 4-D, but is instead ${n.rank}-D`);return s=Ga(s,n,e,r==="same"?"same":"valid","NHWC",i),o==="channelsFirst"&&(s=ot(s,[0,3,1,2])),s})}var jz=(()=>{class t extends vy{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=It(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Zt(e.depthwiseConstraint),this.depthwiseRegularizer=Nt(e.depthwiseRegularizer)}build(e){if(e=Qe(e),e.length<4)throw new L(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new L(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let o=e[r],i=[this.kernelSize[0],this.kernelSize[1],o,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",i,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[o*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{e=Le(e);let o=cde(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(o=xr(o,this.bias.read(),this.dataFormat)),this.activation!=null&&(o=this.activation.apply(o)),o})}computeOutputShape(e){e=Qe(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],o=this.dataFormat==="channelsFirst"?e[3]:e[2],i=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=Or(r,this.kernelSize[0],this.padding,this.strides[0]),a=Or(o,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],i,s,a]:[e[0],s,a,i]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Mt(this.depthwiseInitializer),e.depthwiseRegularizer=vt(this.depthwiseRegularizer),e.depthwiseConstraint=Qt(this.depthwiseRegularizer),e}}return t.className="DepthwiseConv2D",t})();Q.registerClass(jz);function vN(t,n,e,r){if(Array.isArray(t)){if(n!=null||e!=null)throw new L("When inputs is an array, neither initialState or constants should be provided");r!=null&&(e=t.slice(t.length-r,t.length),t=t.slice(0,t.length-r)),t.length>1&&(n=t.slice(1,t.length)),t=t[0]}function o(i){return i==null||Array.isArray(i)?i:[i]}return n=o(n),e=o(e),{inputs:t,initialState:n,constants:e}}function bN(t,n,e,r=!1,o,i,s=!1,a=!1){return z(()=>{let l=n.shape.length;if(l<3)throw new L(`Input should be at least 3D, but is ${l}D.`);let c=[1,0].concat(lr(2,l));if(n=ot(n,c),i!=null)throw new Ne("The rnn() functoin of the deeplearn.js backend does not support constants yet.");s&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=o.asType("bool").asType("float32"),o.rank===l-1&&(o=Kn(o,-1)),o=ot(o,c)),r&&(n=wo(n,0),o!=null&&(o=wo(o,0)));let u=[],d,p=e,f=n.shape[0],m=Ar(n),h;o!=null&&(h=Ar(o));for(let y=0;y<f;++y){let v=m[y],S=z(()=>t(v,p));if(o==null)d=S[0],p=S[1];else{let C=z(()=>{let I=h[y],E=Rn(I).sub(I),D=S[0].mul(I).add(p[0].mul(E)),O=p.map((R,P)=>S[1][P].mul(I).add(R.mul(E)));return{output:D,newStates:O}});d=C.output,p=C.newStates}a&&u.push(d)}let g;return a&&(g=Xn(u,1)),[d,g,p]})}var qc=(()=>{class t extends ze{constructor(e){super(e);let r;if(e.cell==null)throw new L("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new SN({cells:e.cell}):r=e.cell,r.stateSize==null)throw new L("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Dt({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return lr(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){hw(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let o=r[0],i;if(this.returnSequences?i=[e[0],e[1],o]:i=[e[0],o],this.returnState){let s=[];for(let a of r)s.push([e[0],a]);return[i].concat(s)}else return i}computeMask(e,r){return z(()=>{Array.isArray(r)&&(r=r[0]);let o=this.returnSequences?r:null;if(this.returnState){let i=this.states.map(s=>null);return[o].concat(i)}else return o})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let o=0;o<e;++o)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new Ne("Constants support is not implemented in RNN yet.");hw(e)&&(e=e[0]),e=e;let o=this.stateful?e[0]:null,i=e.slice(2);this.inputSpec[0]=new Dt({shape:[o,null,...i]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let a;if(Array.isArray(this.cell.stateSize)?a=this.cell.stateSize:a=[this.cell.stateSize],this.stateSpec!=null){if(!b.arraysEqual(this.stateSpec.map(l=>l.shape[l.shape.length-1]),a))throw new L(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=a.map(l=>new Dt({shape:[null,l]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){z(()=>{if(!this.stateful)throw new Co("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape[0];if(o==null)throw new L("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Vt([o,i])):this.states_=[Vt([o,this.cell.stateSize])];else if(e==null)Fe(this.states_),this.keptStates!=null&&(Fe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(i=>Vt([o,i])):this.states_[0]=Vt([o,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new L(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Fe(this.states_);for(let i=0;i<this.states_.length;++i){let s=e[i],a=Array.isArray(this.cell.stateSize)?this.cell.stateSize[i]:this.cell.stateSize,l=[o,a];if(!b.arraysEqual(s.shape,l))throw new L(`State ${i} is incompatible with layer ${this.name}: expected shape=${l}, received shape=${s.shape}`);this.states_[i]=s}}this.states_=this.states_.map(i=>An(i.clone()))})}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=vN(e,o,i,this.numConstants);e=s.inputs,o=s.initialState,i=s.constants;let a=[],l=[];if(o!=null){r.initialState=o,a=a.concat(o),this.stateSpec=[];for(let u of o)this.stateSpec.push(new Dt({shape:u.shape}));l=l.concat(this.stateSpec)}if(i!=null&&(r.constants=i,a=a.concat(i),this.numConstants=i.length),a[0]instanceof cr){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return z(()=>{let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;e=Le(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let a=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==a)throw new L(`RNN Layer has ${a} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let l={training:i},u=bN((h,g)=>{let y=this.cell.call([h].concat(g),l);return[y[0],y.slice(1)]},e,s,this.goBackwards,o,null,this.unroll,this.returnSequences),d=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,i);let m=this.returnSequences?p:d;return this.returnState?[m].concat(f):m})}getInitialState(e){return z(()=>{let r=Vt(e.shape);return r=ve(r,[1,2]),r=Qa(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(o=>o>1?cw(r,[1,o]):r):this.cell.stateSize>1?[cw(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let o=this.cell.getConfig();return this.getClassName()===t.className&&(r.cell={className:this.cell.getClassName(),config:o}),Object.assign({},o,e,r)}static fromConfig(e,r,o={}){let i=r.cell,s=Rr(i,o);return new e(Object.assign(r,{cell:s}))}}return t.className="RNN",t})();Q.registerClass(qc);var Hc=class extends ze{},wN=(()=>{class t extends Hc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ln(this.units,"units"),this.activation=ki(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Nt(e.kernelRegularizer),this.recurrentRegularizer=Nt(e.recurrentRegularizer),this.biasRegularizer=Nt(e.biasRegularizer),this.kernelConstraint=Zt(e.kernelConstraint),this.recurrentConstraint=Zt(e.recurrentConstraint),this.biasConstraint=Zt(e.biasConstraint),this.dropout=Ad([1,Di([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ad([1,Di([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qe(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{if(e=e,e.length!==2)throw new L(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let o=e[1];e=e[0];let i=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=tl({ones:()=>Rn(e),rate:this.dropout,training:i})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=tl({ones:()=>Rn(o),rate:this.recurrentDropout,training:i}));let s,a=this.dropoutMask,l=this.recurrentDropoutMask;a!=null?s=Zo(V(e,a),this.kernel.read()):s=Zo(e,this.kernel.read()),this.bias!=null&&(s=xr(s,this.bias.read())),l!=null&&(o=V(o,l));let c=ee(s,Zo(o,this.recurrentKernel.read()));return this.activation!=null&&(c=this.activation.apply(c)),[c,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Ni(this.activation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:vt(this.kernelRegularizer),recurrentRegularizer:vt(this.recurrentRegularizer),biasRegularizer:vt(this.biasRegularizer),activityRegularizer:vt(this.activityRegularizer),kernelConstraint:Qt(this.kernelConstraint),recurrentConstraint:Qt(this.recurrentConstraint),biasConstraint:Qt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,r)}}return t.className="SimpleRNNCell",t})();Q.registerClass(wN);var Gz=(()=>{class t extends qc{constructor(e){e.cell=new wN(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return new e(r)}}return t.className="SimpleRNN",t})();Q.registerClass(Gz);var CN=(()=>{class t extends Hc{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new L("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ln(this.units,"units"),this.activation=ki(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ki(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Nt(e.kernelRegularizer),this.recurrentRegularizer=Nt(e.recurrentRegularizer),this.biasRegularizer=Nt(e.biasRegularizer),this.kernelConstraint=Zt(e.kernelConstraint),this.recurrentConstraint=Zt(e.recurrentConstraint),this.biasConstraint=Zt(e.biasConstraint),this.dropout=Ad([1,Di([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ad([1,Di([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Qe(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return z(()=>{if(e=e,e.length!==2)throw new L(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training==null?!1:r.training,i=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=tl({ones:()=>Rn(e),rate:this.dropout,training:o,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=tl({ones:()=>Rn(i),rate:this.recurrentDropout,training:o,count:3}));let s=this.dropoutMask,a=this.recurrentDropoutMask,l,c,u;0<this.dropout&&this.dropout<1&&(e=V(e,s[0]));let d=Zo(e,this.kernel.read());this.useBias&&(d=xr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,a[0]));let p=this.recurrentKernel.read(),[f,m]=Un(p,[2*this.units,this.units],p.rank-1),h=Zo(i,f),[g,y,v]=Un(d,3,d.rank-1),[S,C]=Un(h,2,h.rank-1);l=this.recurrentActivation.apply(ee(g,S)),c=this.recurrentActivation.apply(ee(y,C));let I=Zo(V(c,i),m);u=this.activation.apply(ee(v,I));let E=ee(V(l,i),V(ee(1,yt(l)),u));return[E,E]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Ni(this.activation),recurrentActivation:Ni(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:vt(this.kernelRegularizer),recurrentRegularizer:vt(this.recurrentRegularizer),biasRegularizer:vt(this.biasRegularizer),activityRegularizer:vt(this.activityRegularizer),kernelConstraint:Qt(this.kernelConstraint),recurrentConstraint:Qt(this.recurrentConstraint),biasConstraint:Qt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,r)}}return t.className="GRUCell",t})();Q.registerClass(CN);var Wz=(()=>{class t extends qc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new CN(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="GRU",t})();Q.registerClass(Wz);var wy=(()=>{class t extends Hc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ln(this.units,"units"),this.activation=ki(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ki(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=It(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Nt(e.kernelRegularizer),this.recurrentRegularizer=Nt(e.recurrentRegularizer),this.biasRegularizer=Nt(e.biasRegularizer),this.kernelConstraint=Zt(e.kernelConstraint),this.recurrentConstraint=Zt(e.recurrentConstraint),this.biasConstraint=Zt(e.biasConstraint),this.dropout=Ad([1,Di([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=Ad([1,Di([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Qe(e);let o=e[e.length-1];this.kernel=this.addWeight("kernel",[o,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let i;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,a=this.units;i=new(r=class extends br{apply(c,u){let d=s.apply([a]),p=new pw().apply([a]),f=s.apply([a*2]);return KD(KD(d,p),f)}},r.className="CustomInit",r)}else i=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,i,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return z(()=>{let o=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new L(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let i=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=tl({ones:()=>Rn(e),rate:this.dropout,training:o,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=tl({ones:()=>Rn(i),rate:this.recurrentDropout,training:o,count:4}));let a=this.dropoutMask,l=this.recurrentDropoutMask,c,u,d,p;0<this.dropout&&this.dropout<1&&(e=V(e,a[0]));let f=Zo(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(i=V(i,l[0])),f=ee(f,Zo(i,this.recurrentKernel.read())),this.useBias&&(f=xr(f,this.bias.read()));let[m,h,g,y]=Un(f,4,f.rank-1);c=this.recurrentActivation.apply(m),u=this.recurrentActivation.apply(h),d=ee(V(u,s),V(c,this.activation.apply(g))),p=this.recurrentActivation.apply(y);let v=V(p,this.activation.apply(d));return[v,v,d]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:Ni(this.activation),recurrentActivation:Ni(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),recurrentInitializer:Mt(this.recurrentInitializer),biasInitializer:Mt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:vt(this.kernelRegularizer),recurrentRegularizer:vt(this.recurrentRegularizer),biasRegularizer:vt(this.biasRegularizer),activityRegularizer:vt(this.activityRegularizer),kernelConstraint:Qt(this.kernelConstraint),recurrentConstraint:Qt(this.recurrentConstraint),biasConstraint:Qt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,r)}}return t.className="LSTMCell",t})();Q.registerClass(wy);var Hz=(()=>{class t extends qc{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new wy(e),super(e)}call(e,r){return z(()=>{this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}}return t.className="LSTM",t})();Q.registerClass(Hz);var SN=(()=>{class t extends Hc{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return z(()=>{e=e;let o=e.slice(1),i=[];for(let l of this.cells.slice().reverse())Array.isArray(l.stateSize)?i.push(o.splice(0,l.stateSize.length)):i.push(o.splice(0,1));i.reverse();let s=[],a;for(let l=0;l<this.cells.length;++l){let c=this.cells[l];o=i[l],l===0?a=[e[0]].concat(o):a=[a[0]].concat(o),a=c.call(a,r),s.push(a.slice(1))}o=[];for(let l of s.slice().reverse())o.push(...l);return[a[0]].concat(o)})}build(e){hw(e)&&(e=e[0]),e=e;let r;this.cells.forEach((o,i)=>{Ti(`RNNCell_${i}`,()=>{o.build(e),Array.isArray(o.stateSize)?r=o.stateSize[0]:r=o.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),i={cells:this.cells.map(r)};return Object.assign({},e,i)}static fromConfig(e,r,o={}){let i=[];for(let s of r.cells)i.push(Rr(s,o));return new e({cells:i})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let o of this.cells)r.push(...o.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return fy(e)}setWeights(e){let r=[];for(let o of this.cells){let i=o.weights.length,s=e.splice(i);for(let a=0;a<o.weights.length;++a)r.push([o.weights[a],s[a]])}Cm(r)}}return t.className="StackedRNNCells",t})();Q.registerClass(SN);function tl(t){let{ones:n,rate:e,training:r=!1,count:o=1}=t,i=()=>dw(n(),e),s=()=>zc(i,n,r);return!o||o<=1?An(s().clone()):Array(o).fill(void 0).map(s).map(l=>An(l.clone()))}var ude=function(t,n){var e={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&n.indexOf(r)<0&&(e[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,r=Object.getOwnPropertySymbols(t);o<r.length;o++)n.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(t,r[o])&&(e[r[o]]=t[r[o]]);return e};var dde=(()=>{class t extends qc{constructor(e){if(e.unroll)throw new Ne("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new Ne("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Dt({ndim:5})]}call(e,r){return z(()=>{if(this.cell.dropoutMask!=null&&(Fe(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Fe(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new L("ConvRNN2D cell does not support constants");let o=r==null?null:r.mask,i=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:o,training:i,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return z(()=>{let{stateSize:r}=this.cell,o=e.shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)],a=Vt(s);return Array.isArray(r)?Array(r.length).fill(a):[a]})}resetStates(e,r=!1){z(()=>{if(!this.stateful)throw new Co("Cannot call resetStates() on an RNN Layer that is not stateful.");let o=this.inputSpec[0].shape,i=this.computeSingleOutputShape(o),s=[i[0],...i.slice(2)];if(o[0]==null)throw new L("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Vt(s)):this.states_=[Vt(s)];else if(e==null)Fe(this.states_),this.keptStates!=null&&(Fe(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Vt(s)):this.states_[0]=Vt(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new L(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Fe(this.states_);for(let l=0;l<this.states_.length;++l){let c=e[l],u=s;if(!b.arraysEqual(c.shape,u))throw new L(`State ${l} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${c.shape}`);this.states_[l]=c}}this.states_=this.states_.map(l=>An(l.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:o,kernelSize:i,padding:s,strides:a,dilationRate:l}=this.cell,c=r==="channelsFirst",u=e[c?3:2],d=e[c?4:3],p=Or(u,i[0],s,a[0],l[0]),f=Or(d,i[1],s,a[1],l[1]);return[...e.slice(0,2),...c?[o,p,f]:[p,f,o]]}}return t.className="ConvRNN2D",t})(),_N=(()=>{class t extends wy{constructor(e){let{filters:r,kernelSize:o,strides:i,padding:s,dataFormat:a,dilationRate:l}=e;super(Object.assign({},e,{units:r})),this.filters=r,ln(this.filters,"filters"),this.kernelSize=Wc(o,2,"kernelSize"),this.kernelSize.forEach(c=>ln(c,"kernelSize")),this.strides=Wc(i||1,2,"strides"),this.strides.forEach(c=>ln(c,"strides")),this.padding=s||"valid",yr(this.padding),this.dataFormat=a||"channelsLast",Wt(this.dataFormat),this.dilationRate=Wc(l||1,2,"dilationRate"),this.dilationRate.forEach(c=>ln(c,"dilationRate"))}build(e){var r;e=Qe(e);let o=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[o]==null)throw new L(`The channel dimension of the input should be defined. Found ${e[o]}`);let i=e[o],s=4,a=this.kernelSize.concat([i,this.filters*s]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let l=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",l,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let c;if(this.unitForgetBias){let u=this.biasInitializer,d=this.filters;c=new(r=class extends br{apply(f,m){let h=u.apply([d]),g=eo([d]),y=u.apply([d*2]);return xm([h,g,y])}},r.className="CustomInit",r)}else c=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,c,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return z(()=>{if(e.length!==3)throw new L(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=r.training||!1,i=e[0],s=e[1],a=e[2],l=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=tl({ones:()=>Rn(i),rate:this.dropout,training:o,count:l}));let c=this.dropoutMask,u=(ce,pe,ue)=>!pe||!pe[ue]?ce:V(pe[ue],ce),d=u(i,c,0),p=u(i,c,1),f=u(i,c,2),m=u(i,c,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=tl({ones:()=>Rn(s),rate:this.recurrentDropout,training:o,count:l}));let h=this.recurrentDropoutMask,g=u(s,h,0),y=u(s,h,1),v=u(s,h,2),S=u(s,h,3),C=3,[I,E,D,O]=Un(this.kernel.read(),l,C),[R,P,U,G]=this.useBias?Un(this.bias.read(),l):[null,null,null,null];d=this.inputConv(d,I,R,this.padding),p=this.inputConv(p,E,P,this.padding),f=this.inputConv(f,D,U,this.padding),m=this.inputConv(m,O,G,this.padding);let[q,X,K,Y]=Un(this.recurrentKernel.read(),l,C);g=this.recurrentConv(g,q),y=this.recurrentConv(y,X),v=this.recurrentConv(v,K),S=this.recurrentConv(S,Y);let ne=this.recurrentActivation.apply(ee(d,g)),J=this.recurrentActivation.apply(ee(p,y)),te=ee(V(J,a),V(ne,this.activation.apply(ee(f,v)))),ie=V(this.recurrentActivation.apply(ee(m,S)),this.activation.apply(te));return[ie,ie,te]})}getConfig(){let e=super.getConfig(),{units:r}=e,o=ude(e,["units"]),i={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},o,i)}inputConv(e,r,o,i){let s=Zr(e,r,this.strides,i||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return o?xr(s,o,this.dataFormat):s}recurrentConv(e,r){return Zr(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}return t.className="ConvLSTM2DCell",t})();Q.registerClass(_N);var qz=(()=>{class t extends dde{constructor(e){let r=new _N(e);super(Object.assign({},e,{cell:r}))}static fromConfig(e,r){return new e(r)}}return t.className="ConvLSTM2D",t})();Q.registerClass(qz);var IN=(()=>{class t extends ze{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,o=[];for(let i=0;i<this.noiseShape.length;++i)o.push(this.noiseShape[i]==null?r[i]:this.noiseShape[i]);return o}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);if(0<this.rate&&this.rate<1){let i=r.training==null?!1:r.training,s=this.getNoiseShape(o);return zc(()=>dw(o,this.rate,s,this.seed),()=>o,i)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}}return t.className="Dropout",t})();Q.registerClass(IN);var Kz=(()=>{class t extends IN{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}}return t.className="SpatialDropout1D",t})();Q.registerClass(Kz);var Xz=(()=>{class t extends ze{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,ln(this.units,"units"),this.activation=ki(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=It(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=It(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Zt(e.kernelConstraint),this.biasConstraint=Zt(e.biasConstraint),this.kernelRegularizer=Nt(e.kernelRegularizer),this.biasRegularizer=Nt(e.biasRegularizer),this.activityRegularizer=Nt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Qe(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Qe(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),i=iw(this.activation.getClassName()),s;return i!=null?s=Zo(o,this.kernel.read(),i,this.bias?this.bias.read():null):(s=Zo(o,this.kernel.read()),this.bias!=null&&(s=xr(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:Ni(this.activation),useBias:this.useBias,kernelInitializer:Mt(this.kernelInitializer),biasInitializer:Mt(this.biasInitializer),kernelRegularizer:vt(this.kernelRegularizer),biasRegularizer:vt(this.biasRegularizer),activityRegularizer:vt(this.activityRegularizer),kernelConstraint:Qt(this.kernelConstraint),biasConstraint:Qt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dense",t})();Q.registerClass(Xz);var Yz=(()=>{class t extends ze{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Qe(e);for(let r of e.slice(1))if(r==null)throw new L(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Qo(e,1)]}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);if(this.dataFormat==="channelsFirst"&&o.rank>1){let i=[0];for(let s=2;s<o.rank;++s)i.push(s);i.push(1),o=o.transpose(i)}return jB(o)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}}return t.className="Flatten",t})();Q.registerClass(Yz);var Qz=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.activation=ki(e.activation)}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return this.activation.apply(o)})}getConfig(){let e={activation:Ni(this.activation)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Activation",t})();Q.registerClass(Qz);var Zz=(()=>{class t extends ze{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return z(()=>(e=Le(e),zB(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}}return t.className="RepeatVector",t})();Q.registerClass(Zz);var Jz=(()=>{class t extends ze{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let o="Total size of new array must be unchanged.",i=r.slice(),s=1,a=null;for(let c=0;c<i.length;++c){let u=i[c];if(this.isUnknown(u))if(a===null)a=c;else throw new L("Can only specifiy one unknown dimension.");else s*=u}let l=Qo(e);if(a!==null){if(s===0||l%s!==0)throw new L(o);i[a]=l/s}else if(l!==s)throw new L(o);return i}computeOutputShape(e){let r=!1;for(let o=0;o<e.length;++o)if(this.isUnknown(e[o])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),i=o.shape,s=i.slice(0,1).concat(this.fixUnknownDimension(i.slice(1),this.targetShape));return o.reshape(s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Reshape",t})();Q.registerClass(Jz);var e4=(()=>{class t extends ze{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=lr(1,e.dims.length+1);if(!b.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Dt({ndim:this.dims.length+1})]}computeOutputShape(e){e=Qe(e);let r=e.slice();return this.dims.forEach((o,i)=>{r[i+1]=e[o]}),r}call(e,r){return ot(Le(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Permute",t})();Q.registerClass(e4);var t4=(()=>{class t extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let o=Le(e);return em(Vc(o,this.maskValue),-1)}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e),a=em(Vc(o,this.maskValue),-1,!0);return o.mul(a.asType(o.dtype))})}}return t.className="Masking",t})();Q.registerClass(t4);var n4=(()=>{class t extends ze{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(Tt(e.inputLength))}this.inputDim=e.inputDim,ln(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ln(this.outputDim,"outputDim"),this.embeddingsInitializer=It(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Nt(e.embeddingsRegularizer),this.activityRegularizer=Nt(e.activityRegularizer),this.embeddingsConstraint=Zt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return z(()=>this.maskZero?(e=Le(e),Vc(e,Ee(e))):null)}computeOutputShape(e){if(e=Qe(e),this.inputLength==null)return[...e,this.outputDim];let r=Tt(this.inputLength);if(r.length!==e.length-1)throw new L(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let o=0;for(let i=0;i<r.length;++i){let s=r[i],a=e[i+1];if(s!=null&&a!=null&&s!==a)throw new L(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[o]=a),o++}}return[e[0],...r,this.outputDim]}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return o.dtype!=="int32"&&(o=Ya(o,"int32")),uw(this.embeddings.read(),o.as1D()).reshape(Qe(this.computeOutputShape(o.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Mt(this.embeddingsInitializer),embeddingsRegularizer:vt(this.embeddingsRegularizer),activityRegularizer:vt(this.activityRegularizer),embeddingsConstraint:Qt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Embedding",t})();Q.registerClass(n4);var nl=class extends ze{constructor(n){super(n||{}),this.supportsMasking=!0}mergeFunction(n){throw new Ne}computeElementwiseOpOutputShape(n,e){if(n==null||e==null)return null;if(n.length<e.length)return this.computeElementwiseOpOutputShape(e,n);if(e.length===0)return n;let r=n.slice(0,n.length-e.length);for(let o=0;o<e.length;++o){let i=n[n.length-e.length+o],s=e[o];if(i==null||s==null||i<0||s<0)r.push(null);else if(i===1)r.push(s);else if(s===1)r.push(i);else{if(i!==s)throw new L("Operands could not be broadcast together with shapes "+JSON.stringify(n)+" "+JSON.stringify(e));r.push(i)}}return r}build(n){if(Array.isArray(n)&&!Array.isArray(n[0])&&(n=[Qe(n)]),n=n,n.length<2)throw new L(`A merge layer should be called on an Array of at least 2 inputs. Got ${n.length} input(s).`);let e=[];for(let i of n)i!=null&&i[0]!==null&&e.push(i[0]);if(e=Yo(e),e.length>1)throw new L(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(n)}.`);let r=n[0]==null?null:n[0].slice(1);for(let i=1;i<n.length;++i){let s=n[i]==null?null:n[i].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let o=n.map(i=>i.length);n.indexOf(null)===-1&&Yo(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(n,e){return z(()=>{if(n=n,this.reshapeRequired){let r=[],o=n.map(i=>i.rank);if(o.indexOf(null)===-1){let i=Di(o);for(let s of n){let a=s.rank;for(let l=0;l<i-a;++l)s=Qa(s,1);r.push(s)}return this.mergeFunction(r)}else{let i=!1;for(let l of n){let c=l.rank;if(c==null){let u=l.shape,d=u[0],p=u.slice(1).concat([d]),f=l.reshape([d].concat(Qo(u.slice(1))));f=ot(f,[1,0]),f=f.reshape(p),r.push(f),i=!0}else if(c>1){let u=lr(1,c).concat([0]);r.push(ot(l,u)),i=!0}else r.push(l)}let s=this.mergeFunction(r),a=s.rank;if(i){if(a==null){let l=s.shape,c=l.length,u=l[c-1],d=[u].concat(l.slice(0,l.length-1));s=ot(s.reshape([-1,u]),[1,0]).reshape(d)}else if(a>1){let l=[a-1].concat(lr(0,a-1));s=ot(s,l)}}return s}}else return this.mergeFunction(n)})}computeOutputShape(n){n=n;let e;n[0]==null?e=null:e=n[0].slice(1);for(let o=1;o<n.length;++o){let i=n[o]==null?null:n[o].slice(1);e=this.computeElementwiseOpOutputShape(e,i)}let r=[];for(let o of n)o!=null&&o[0]!==null&&r.push(o[0]);return r=Yo(r),r.length===1?e=r.concat(e):e=[null].concat(e),e}computeMask(n,e){return z(()=>{if(e==null)return null;if(!Array.isArray(e))throw new L("`mask` should be an Array");if(!Array.isArray(n))throw new L("`inputs` should be an Array");if(e.length!==n.length)throw new L(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${n.length} vs ${e.length})`);if(e.every(o=>o==null))return null;e=e.map(o=>o==null?o:Kn(o,0));let r=e[0];for(let o=1;o<e.length-1;++o)r=ar(r,e[o]);return r})}},r4=(()=>{class t extends nl{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=ee(r,e[o]);return r})}}return t.className="Add",t})();Q.registerClass(r4);var o4=(()=>{class t extends nl{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=V(r,e[o]);return r})}}return t.className="Multiply",t})();Q.registerClass(o4);var i4=(()=>{class t extends nl{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0].clone();for(let o=1;o<e.length;++o)r=ee(r,e[o]);return V(1/e.length,r)})}}return t.className="Average",t})();Q.registerClass(i4);var s4=(()=>{class t extends nl{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=Jr(r,e[o]);return r})}}return t.className="Maximum",t})();Q.registerClass(s4);var a4=(()=>{class t extends nl{constructor(e){super(e)}mergeFunction(e){return z(()=>{let r=e[0];for(let o=1;o<e.length;++o)r=xd(r,e[o]);return r})}}return t.className="Minimum",t})();Q.registerClass(a4);var l4=(()=>{class t extends nl{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new L("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let i of e)if(i!=null){r=!1;break}if(r)return;let o=[];for(let i=0;i<e.length;++i){let s=e[i].slice();s.splice(this.axis,1);let a=!1;for(let l of o)if(b.arraysEqual(l,s)){a=!0;break}a||o.push(s)}if(o.length>1)throw new L("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return z(()=>xm(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new L("A `Concatenate` layer should be called on a list of inputs.");let r=e,o=r[0].slice(),i=this.axis<0?o.length+this.axis:this.axis;for(let s of r.slice(1)){if(o[i]==null||s[i]==null){o[i]=null;break}o[i]+=s[i]}return o}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new L("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new L("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new L(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return z(()=>{let o=!0;if(r.forEach(a=>{if(a!=null){o=!1;return}}),o)return null;let i=[];for(let a=0;a<e.length;++a)r[a]==null?i.push(Rn(e[a]).asType("bool")):r[a].rank<e[a].rank?i.push(Kn(r[a],-1)):i.push(r[a]);let s=Lt(i,this.axis);return Gg(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Concatenate",t})();Q.registerClass(l4);function Cy(t,n){for(;t<0;)t+=n;return t}function pde(t,n,e){if(t.shape.length>3||n.shape.length>3)throw new Ne("batchDot is not implemented for tensors of 4D or higher rank yet");if(b.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),b.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${n.shape.length}`),typeof e=="number"&&(e=[e,e]),t.dtype==="complex64"||n.dtype==="complex64")throw new Ne("batchDot is not implemented for complex64-type Tensors yet.");let r=t.shape.length,o=n.shape.length;e==null&&(e=[r-1,o-2]);let i=e;return z(()=>{let s;if(r>o){s=r-o;let l=[];for(let c=0;c<s;++c)l.push(1);n=n.reshape(n.shape.concat(l))}else if(o>r){s=o-r;let l=[];for(let c=0;c<s;++c)l.push(1);t=t.reshape(t.shape.concat(l))}else s=0;let a;if(t.shape.length===2&&n.shape.length===2)i[0]===i[1]?a=t.mul(n).sum(i[0]):a=t.transpose([1,0]).mul(n).sum(i[1]);else{let l=i[0]!==t.shape.length-1,c=i[1]===n.shape.length-1;a=t.matMul(n,l,c)}if(s>0){let l;r>o?l=r+o-3:l=r-1;let c=[];for(let u=l;u<l+s;++u)c.push(u);a=a.squeeze(c)}return a.shape.length===1&&(a=a.expandDims(1)),a})}var c4=(()=>{class t extends nl{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){b.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],o=e[1];if(r.length>3||o.length>3)throw new Ne("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);if(r[i[0]]!==o[i[1]])throw new L(`Dimension incompatibility: ${r[i[0]]} !== ${o[i[1]]}`)}mergeFunction(e){if(e.length!==2)throw new L(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],o=e[1],i;return Array.isArray(this.axes)?i=this.axes.map((s,a)=>Cy(s,e[a].shape.length)):i=[Cy(this.axes,r.shape.length),Cy(this.axes,o.shape.length)],this.normalize&&(r=my(r,i[0]),o=my(o,i[1])),pde(r,o,i)}interpretAxes(e,r){let o;return Array.isArray(this.axes)?o=this.axes:o=[Cy(this.axes,e.length),Cy(this.axes,r.length)],o}computeOutputShape(e){b.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),o=e[1].slice();if(r.length>3||o.length>3)throw new Ne("Dot layer does not support tensors of 4D or higher rank yet.");let i=this.interpretAxes(r,o);r.splice(i[0],1),o.splice(i[1],1),o.splice(0,1);let s=r.concat(o);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}}return t.className="Dot",t})();Q.registerClass(c4);var u4=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return zc(()=>vm(o.shape,0,this.stddev).add(o),()=>o,r.training||!1)})}}return t.className="GaussianNoise",t})();Q.registerClass(u4);var d4=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return z(()=>{this.invokeCallHook(e,r);let o=Le(e);return this.rate>0&&this.rate<1?zc(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return o.mul(vm(o.shape,1,s))},()=>o,r.training||!1):o})}}return t.className="GaussianDropout",t})();Q.registerClass(d4);var p4=(()=>{class t extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Le(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return z(()=>{if(this.rate<1&&this.rate>0){let o=this._getNoiseShape(e);return zc(()=>{let s=Le(e),c=-1.6732632423543772*1.0507009873554805,u=vo(qa(o),this.rate);u=Ya(u,"float32");let d=((1-this.rate)*(1+this.rate*c**2))**-.5,p=-d*c*this.rate;return s.mul(u).add(u.add(-1).mul(c)).mul(d).add(p)},()=>Le(e),r.training||!1)}return e})}}return t.className="AlphaDropout",t})();Q.registerClass(p4);function Sy(t,n,e,r,o,i=.001){let s;if(t.rank===2)s=zT(t,n,e,r,o,i);else if(t.rank===3)s=UT(t,n,e,r,o,i);else if(t.rank===4)s=jT(t,n,e,r,o,i);else throw new Ne(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return s}function fde(t,n,e,r,o=.001){return z(()=>{let i=cm(t,r),s=i.mean,a=i.variance;return[Sy(t,s,a,e,n,o),s,a]})}function mde(t,n,e,r,o=.001){return z(()=>{let i=cm(t,r),s=i.mean,a=i.variance,l=[];for(let m of lr(0,t.rank))r.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let c=s.reshape(l),u=a.reshape(l),d=n==null?null:n.reshape(l),p=e==null?null:e.reshape(l);return[Sy(t,c,u,p,d,o),s,a]})}function hde(t,n,e,r,o=.001){return b.arraysEqual(r.slice().sort(),lr(0,t.rank-1))?fde(t,n,e,r,o):mde(t,n,e,r,o)}var f4=(()=>{class t extends ze{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=It(e.betaInitializer||"zeros"),this.gammaInitializer=It(e.gammaInitializer||"ones"),this.movingMeanInitializer=It(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=It(e.movingVarianceInitializer||"ones"),this.betaConstraint=Zt(e.betaConstraint),this.gammaConstraint=Zt(e.gammaConstraint),this.betaRegularizer=Nt(e.betaRegularizer),this.gammaRegularizer=Nt(e.gammaRegularizer)}build(e){e=Qe(e);let r=this.axis>=0?this.axis:this.axis+e.length,o=e[r];if(o==null)throw new L(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Dt({ndim:e.length,axes:{[r]:o}})];let i=[o];this.scale&&(this.gamma=this.addWeight("gamma",i,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",i,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",i,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",i,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return z(()=>{let o=r.training==null?!1:r.training,i=Le(e),s=i.shape,a=s.length,l=lr(0,a),c=this.axis>=0?this.axis:this.axis+a;l.splice(c,1);let u=Ko(1,a);u[c]=s[c];let d=l.slice();d.sort();let p=!b.arraysEqual(d,lr(0,a).slice(0,a-1)),f=()=>{if(p){let S=this.movingMean.read().reshape(u),C=this.movingVariance.read().reshape(u),I=this.center?this.beta.read().reshape(u):null,E=this.scale?this.gamma.read().reshape(u):null;return Sy(i,S,C,I,E,this.epsilon)}else return Sy(i,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!o)return f();let[m,h,g]=hde(i,this.gamma.read(),this.beta.read(),l,this.epsilon),y=(S,C,I)=>{z(()=>{let E=1-I,D=S.read(),O=D.sub(C).mul(E);S.write(D.sub(O))})};return(()=>{y(this.movingMean,h,this.momentum),y(this.movingVariance,g,this.momentum)})(),m})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mt(this.betaInitializer),gammaInitializer:Mt(this.gammaInitializer),movingMeanInitializer:Mt(this.movingMeanInitializer),movingVarianceInitializer:Mt(this.movingVarianceInitializer),betaRegularizer:vt(this.betaRegularizer),gammaRegularizer:vt(this.gammaRegularizer),betaConstraint:Qt(this.betaConstraint),gammaConstraint:Qt(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="BatchNormalization",t})();Q.registerClass(f4);var m4=(()=>{class t extends ze{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=It(e.betaInitializer||"zeros"),this.gammaInitializer=It(e.gammaInitializer||"ones"),this.betaRegularizer=Nt(e.betaRegularizer),this.gammaRegularizer=Nt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Qe(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Yo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let o=this.axis.map(s=>e[s]),i=!0;this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,i):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,i):this.beta=null,this.built=!0}call(e,r){let o=Le(e),i=o.shape,s=i.length;return z(()=>{let{mean:l,variance:c}=cm(o,this.axis,!0),u=Ko(1,s);for(let g of this.axis)u[g]=i[g];let d=g=>g!=null&&g.shape.length!==s&&this.axis!==[s-1]?g.reshape(u):g,p=d(this.gamma.read()),f=d(this.beta.read()),m=[],h=[];for(let g=0;g<s;++g)this.axis.indexOf(g)!==-1?(m.push(i[g]),h.push(1)):(m.push(1),h.push(i[g]));return l=l.tile(m),c=c.tile(m),p=p.tile(h),f=f.tile(h),Sy(o,l,c,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Mt(this.betaInitializer),gammaInitializer:Mt(this.gammaInitializer),betaRegularizer:vt(this.betaRegularizer),gammaRegularizer:vt(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}}return t.className="LayerNormalization",t})();Q.registerClass(m4);function gde(t,n,e){return z(()=>{if(t.rank!==4)throw new L(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(n==null&&(n=[[1,1],[1,1]]),n.length!==2||n[0].length!==2||n[1].length!==2)throw new L("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(e==null&&(e=hr()),e!=="channelsLast"&&e!=="channelsFirst")throw new L(`Unknown data format: ${e}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let r;return e==="channelsFirst"?r=[[0,0],[0,0],n[0],n[1]]:r=[[0,0],n[0],n[1],[0,0]],vd(t,r)})}var h4=(()=>{class t extends ze{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?hr():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new L(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,o;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],o=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new L(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new L(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);o=e.padding[1]}this.padding=[r,o]}this.inputSpec=[new Dt({ndim:4})]}computeOutputShape(e){e=Qe(e);let r,o;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?o=e[3]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],e[1],r,o]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?o=e[2]+this.padding[1][0]+this.padding[1][1]:o=null,[e[0],r,o,e[3]])}call(e,r){return z(()=>gde(Le(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}}return t.className="ZeroPadding2D",t})();Q.registerClass(h4);function Uw(t,n,e,r,o,i){return z(()=>{Wt(o),WD(i),yr(r),e==null&&(e=[1,1]),r==null&&(r="valid"),o==null&&(o=hr()),i==null&&(i="max"),t=by(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=yd(t,n,e,a):s=fd(t,n,e,a),o==="channelsFirst"&&(s=ot(s,[0,3,1,2])),s})}function g4(t,n,e,r,o,i){return z(()=>{Wt(o),WD(i),yr(r),e==null&&(e=[1,1,1]),r==null&&(r="valid"),o==null&&(o=hr()),i==null&&(i="max"),t=gN(t,o);let s,a=r==="same"?"same":"valid";return i==="max"?s=cD(t,n,e,a):s=BT(t,n,e,a),o==="channelsFirst"&&(s=ot(s,[0,4,1,2,3])),s})}var $w=class extends ze{constructor(n){if(n.poolSize==null&&(n.poolSize=2),super(n),typeof n.poolSize=="number")this.poolSize=[n.poolSize];else if(Array.isArray(n.poolSize)&&n.poolSize.length===1&&typeof n.poolSize[0]=="number")this.poolSize=n.poolSize;else throw new L(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.poolSize)}`);if(ln(this.poolSize,"poolSize"),n.strides==null)this.strides=this.poolSize;else if(typeof n.strides=="number")this.strides=[n.strides];else if(Array.isArray(n.strides)&&n.strides.length===1&&typeof n.strides[0]=="number")this.strides=n.strides;else throw new L(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(n.strides)}`);ln(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,yr(this.padding),this.inputSpec=[new Dt({ndim:3})]}computeOutputShape(n){n=Qe(n);let e=Or(n[1],this.poolSize[0],this.padding,this.strides[0]);return[n[0],e,n[2]]}call(n,e){return z(()=>{this.invokeCallHook(n,e),n=Qa(Le(n),2);let r=this.poolingFunction(Le(n),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Sd(r,[2])})}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(n,e),n}},y4=(()=>{class t extends $w{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),yr(i),Uw(e,r,o,i,s,"max")}}return t.className="MaxPooling1D",t})();Q.registerClass(y4);var x4=(()=>{class t extends $w{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),yr(i),Uw(e,r,o,i,s,"avg")}}return t.className="AveragePooling1D",t})();Q.registerClass(x4);var Lw=class extends ze{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==2)throw new L(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides];ln(this.poolSize,"poolSize"),ln(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Wt(this.dataFormat),yr(this.padding),this.inputSpec=[new Dt({ndim:4})]}computeOutputShape(n){n=Qe(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2];return e=Or(e,this.poolSize[0],this.padding,this.strides[0]),r=Or(r,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r]:[n[0],e,r,n[3]]}call(n,e){return z(()=>(this.invokeCallHook(n,e),this.poolingFunction(Le(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},v4=(()=>{class t extends Lw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),yr(i),Uw(e,r,o,i,s,"max")}}return t.className="MaxPooling2D",t})();Q.registerClass(v4);var b4=(()=>{class t extends Lw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),yr(i),Uw(e,r,o,i,s,"avg")}}return t.className="AveragePooling2D",t})();Q.registerClass(b4);var Vw=class extends ze{constructor(n){if(n.poolSize==null&&(n.poolSize=[2,2,2]),super(n),this.poolSize=Array.isArray(n.poolSize)?n.poolSize:[n.poolSize,n.poolSize,n.poolSize],n.strides==null)this.strides=this.poolSize;else if(Array.isArray(n.strides)){if(n.strides.length!==3)throw new L(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${n.strides.length}.`);this.strides=n.strides}else this.strides=[n.strides,n.strides,n.strides];ln(this.poolSize,"poolSize"),ln(this.strides,"strides"),this.padding=n.padding==null?"valid":n.padding,this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Wt(this.dataFormat),yr(this.padding),this.inputSpec=[new Dt({ndim:5})]}computeOutputShape(n){n=Qe(n);let e=this.dataFormat==="channelsFirst"?n[2]:n[1],r=this.dataFormat==="channelsFirst"?n[3]:n[2],o=this.dataFormat==="channelsFirst"?n[4]:n[3];return e=Or(e,this.poolSize[0],this.padding,this.strides[0]),r=Or(r,this.poolSize[1],this.padding,this.strides[1]),o=Or(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[n[0],n[1],e,r,o]:[n[0],e,r,o,n[4]]}call(n,e){return z(()=>(this.invokeCallHook(n,e),this.poolingFunction(Le(n),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let n={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},w4=(()=>{class t extends Vw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),yr(i),g4(e,r,o,i,s,"max")}}return t.className="MaxPooling3D",t})();Q.registerClass(w4);var C4=(()=>{class t extends Vw{constructor(e){super(e)}poolingFunction(e,r,o,i,s){return Wt(s),yr(i),g4(e,r,o,i,s,"avg")}}return t.className="AveragePooling3D",t})();Q.registerClass(C4);var Bw=class extends ze{constructor(n){super(n),this.inputSpec=[new Dt({ndim:3})]}computeOutputShape(n){return[n[0],n[2]]}call(n,e){throw new Ne}},S4=(()=>{class t extends Bw{constructor(e){super(e||{})}call(e,r){return z(()=>{let o=Le(e);return Gt(o,1)})}}return t.className="GlobalAveragePooling1D",t})();Q.registerClass(S4);var _4=(()=>{class t extends Bw{constructor(e){super(e||{})}call(e,r){return z(()=>{let o=Le(e);return zn(o,1)})}}return t.className="GlobalMaxPooling1D",t})();Q.registerClass(_4);var zw=class extends ze{constructor(n){super(n),this.dataFormat=n.dataFormat==null?"channelsLast":n.dataFormat,Wt(this.dataFormat),this.inputSpec=[new Dt({ndim:4})]}computeOutputShape(n){return n=n,this.dataFormat==="channelsLast"?[n[0],n[3]]:[n[0],n[1]]}call(n,e){throw new Ne}getConfig(){let n={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(n,e),n}},I4=(()=>{class t extends zw{call(e,r){return z(()=>{let o=Le(e);return this.dataFormat==="channelsLast"?Gt(o,[1,2]):Gt(o,[2,3])})}}return t.className="GlobalAveragePooling2D",t})();Q.registerClass(I4);var E4=(()=>{class t extends zw{call(e,r){return z(()=>{let o=Le(e);return this.dataFormat==="channelsLast"?zn(o,[1,2]):zn(o,[2,3])})}}return t.className="GlobalMaxPooling2D",t})();Q.registerClass(E4);var jw=class extends ze{constructor(n){super(n),this.layer=n.layer}build(n){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(n){this.layer!=null&&(this.layer.trainable=n)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(n){this.layer.setWeights(n)}getConfig(){let n={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(n,e),n}setFastWeightInitDuringBuild(n){super.setFastWeightInitDuringBuild(n),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(n)}static fromConfig(n,e,r={}){let o=e.layer,i=Rr(o,r);delete e.layer;let s={layer:i};return Object.assign(s,e),new n(s)}},T4=(()=>{class t extends jw{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Qe(e),e.length<3)throw new L(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Qe(e);let r=[e[0]].concat(e.slice(2)),o=this.layer.computeOutputShape(r),i=e[1];return[o[0],i].concat(o.slice(1))}call(e,r){return z(()=>(e=Le(e),bN((a,l)=>[Le(this.layer.call(a,r)),[]],e,[],!1,null,null,!1,!0)[1]))}}return t.className="TimeDistributed",t})();Q.registerClass(T4);function yde(t){us(FB,"BidirectionalMergeMode",t)}var xde="concat",D4=(()=>{class t extends jw{constructor(e){super(e);let r=e.layer.getConfig(),o={};o.className=e.layer.getClassName(),o.config=r,this.forwardLayer=Rr(o),r.goBackwards=r.goBackwards!==!0;let i={};if(i.className=e.layer.getClassName(),i.config=r,this.backwardLayer=Rr(i),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?xde:e.mergeMode,yde(this.mergeMode),e.weights)throw new Ne("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,o=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,o)),this.backwardLayer.setWeights(e.slice(o))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let o,i,s;return this.returnState&&(s=r.slice(1)),o=r[0],o=o,this.mergeMode==="concat"?(o[o.length-1]*=2,i=[o]):this.mergeMode==null?i=[o,o.slice()]:i=[o],this.returnState?this.mergeMode==null?i.concat(s).concat(s.slice()):[o].concat(s).concat(s.slice()):On(i)}apply(e,r){let o=r==null?null:r.initialState,i=r==null?null:r.constants;r==null&&(r={});let s=vN(e,o,i,this.numConstants);if(e=s.inputs,o=s.initialState,i=s.constants,Array.isArray(e)&&(o=e.slice(1),e=e[0]),(o==null||o.length===0)&&i==null)return super.apply(e,r);let a=[],l=[];if(o!=null){let u=o.length;if(u%2>0)throw new L("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=o,a.push(...o);let d=o.map(p=>new Dt({shape:p.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),l.push(...d)}if(i!=null)throw new Ne("Support for constants in Bidirectional layers is not implemented yet.");let c=a[0]instanceof cr;for(let u of a)if(u instanceof cr!==c)throw new L("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(c){let u=[e].concat(a),d=this.inputSpec.concat(l),p=this.inputSpec;this.inputSpec=d;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return z(()=>{let o=r.initialState,i,s;if(o==null)i=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let c=o.slice(0,o.length/2),u=o.slice(o.length/2);i=this.forwardLayer.call(e,Object.assign(r,{initialState:c})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let a;this.returnState&&(Array.isArray(i)&&(a=i.slice(1).concat(s.slice(1))),i=i[0],s=s[0]),this.returnSequences&&(s=wo(s,1));let l;return this.mergeMode==="concat"?l=xm([i,s]):this.mergeMode==="sum"?l=ee(i,s):this.mergeMode==="ave"?l=V(.5,ee(i,s)):this.mergeMode==="mul"?l=V(i,s):this.mergeMode==null&&(l=[i,s]),this.returnState?this.mergeMode==null?l.concat(a):[l].concat(a):l})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){Ti(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),Ti(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let o;if(this.returnSequences?this.mergeMode==null?o=[r,r]:o=r:this.mergeMode==null?o=[null,null]:o=null,this.returnState){let s=this.forwardLayer.states.map(a=>null);return Array.isArray(o)?o.concat(s).concat(s):[o].concat(s).concat(s)}else return o}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let o=Rr(r.layer);if(delete r.layer,r.numConstants!=null)throw new Ne("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let i=r;return i.layer=o,new e(i)}}return t.className="Bidirectional",t})();Q.registerClass(D4);var N4;(function(t){let n;(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(N4||(N4={}));var Spe=Ym(RN());var wpe=Ym(RN());var qwt=Symbol("out"),Kwt=Symbol("field"),Xwt=Symbol("quote"),Ywt=Symbol("quoteafterquote"),Qwt=Symbol("quoteinquote");function Z(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&b.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the CPU backend.`)})}var Mpe=Qn.whereImpl,W4=(()=>{class t extends qs{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new Gu(this,Ua())}nextDataId(){return t.nextDataId++}write(e,r,o){this.firstUse&&(this.firstUse=!1,H().get("IS_NODE")&&T.warn(`
============================
Hi there \u{1F44B}. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.
============================`));let i={id:this.nextDataId()};return this.data.set(i,{values:e,dtype:o,refCount:1}),i}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&b.isString(o[0])){let s=o.map(a=>b.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return{dataId:i,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,o,i,s){this.data.set(e,{values:r,dtype:i,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:o}=this.data.get(e);if(r==="complex64"){let i=this.readSync(o.real.dataId),s=this.readSync(o.imag.dataId);return T.mergeRealAndImagArrays(i,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>b.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ie(e.shape,e.dtype,o)}makeOutput(e,r,o){let i=this.write(e,r,o);return Ua().makeTensorFromDataId(i,r,o,this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:o}=this.data.get(e);o!=null&&(this.disposeData(o.real.dataId,!0),this.disposeData(o.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=b.now();return e(),{kernelMs:b.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Z([e],"where");let r=this.readSync(e.dataId);return Mpe(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}return t.nextDataId=0,t})();var JN={};Fi(JN,{addImpl:()=>FN,bincountImpl:()=>Am,bincountReduceImpl:()=>Hw,ceilImpl:()=>PN,concatImpl:()=>qw,expImpl:()=>$N,expm1Impl:()=>VN,floorImpl:()=>BN,gatherV2Impl:()=>Kw,greaterImpl:()=>zN,lessImpl:()=>UN,linSpaceImpl:()=>Xw,logImpl:()=>jN,maxImpl:()=>Yw,maximumImpl:()=>GN,minimumImpl:()=>WN,multiplyImpl:()=>_y,negImpl:()=>HN,notEqualImpl:()=>qN,prodImpl:()=>KN,rangeImpl:()=>Qw,rsqrtImpl:()=>XN,simpleAbsImpl:()=>MN,sliceImpl:()=>YN,sparseFillEmptyRowsImpl:()=>Zw,sparseReshapeImpl:()=>Jw,squaredDifferenceImpl:()=>QN,stridedSliceImpl:()=>eC,subImpl:()=>ZN,tileImpl:()=>tC,topKImpl:()=>nC,transposeImpl:()=>Rm,uniqueImpl:()=>rC});function MN(t){let n=new Float32Array(t.length);for(let e=0;e<t.length;++e)n[e]=Math.abs(t[e]);return n}var Fpe=t=>{let{x:n}=t.inputs,e=t.backend;Z(n,"abs");let r=new Float32Array(b.sizeFromShape(n.shape)),o=e.data.get(n.dataId).values;return r=MN(o),e.makeOutput(r,n.shape,"float32")},H4={kernelName:Bl,backendName:"cpu",kernelFunc:Fpe};function et(t){return(n,e,r,o,i)=>{let s=T.assertAndGetBroadcastShape(n,e),a=s.length,l=b.computeStrides(s),c=b.sizeFromShape(s),u=b.getTypedArrayFromDType(i,c),d=n.length,p=e.length,f=b.computeStrides(n),m=b.computeStrides(e),h=T.getBroadcastDims(n,s),g=T.getBroadcastDims(e,s);if(h.length+g.length===0)for(let y=0;y<u.length;++y)u[y]=t(r[y%r.length],o[y%o.length]);else for(let y=0;y<u.length;++y){let v=b.indexToLoc(y,a,l),S=v.slice(-d);h.forEach(D=>S[D]=0);let C=b.locToIndex(S,d,f),I=v.slice(-p);g.forEach(D=>I[D]=0);let E=b.locToIndex(I,p,m);u[y]=t(r[C],o[E])}return[u,s]}}function Sn(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,a=e.makeTensorInfo(r.shape,"complex64"),l=e.data.get(a.dataId);return l.complexTensorInfos={real:e.makeTensorInfo(r.shape,"float32",i),imag:e.makeTensorInfo(o.shape,"float32",s)},a}var q4={kernelName:wf,backendName:"cpu",kernelFunc:Sn};function Nm(t,n,e="float32"){if(e==="complex64"){let o=Nm(t,n,"float32"),i=Nm(t,n,"float32");return Sn({inputs:{real:o,imag:i},backend:t})}let r=b.makeZerosTypedArray(b.sizeFromShape(n),e);return t.makeTensorInfo(n,e,r)}function Jn(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var K4={kernelName:ts,backendName:"cpu",kernelFunc:Jn};function Jo(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.real,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var X4={kernelName:Lf,backendName:"cpu",kernelFunc:Jo};function ei(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return Jn({inputs:{x:o},backend:e});let s=Nm(e,o.shape,o.dtype),a=ei({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Sn({inputs:{real:a,imag:s},backend:e});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=Jo({inputs:{input:o},backend:e}),a=ei({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!b.hasEncodingLoss(o.dtype,i)){let s=Jn({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32"){let s=e.data.get(o.dataId).values,a=Int32Array.from(s);return e.makeTensorInfo(o.shape,"int32",a)}if(i==="bool"){let s=e.data.get(o.dataId).values,a=b.toTypedArray([0],o.dtype),[l,c]=et((u,d)=>u!==d?1:0)(o.shape,[],s,a,"bool");return e.makeTensorInfo(c,"bool",l)}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var Y4={kernelName:es,backendName:"cpu",kernelFunc:ei};function ut(t,n,e,r){return e==null?({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;Z([s,a],t);let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}:({inputs:o,backend:i})=>{let{a:s,b:a}=o,l=i;if(s.dtype==="complex64"||a.dtype==="complex64"){let c=ei({inputs:{x:s},backend:l,attrs:{dtype:"complex64"}}),u=l.data.get(c.dataId),d=u.complexTensorInfos.real,p=u.complexTensorInfos.imag,f=l.data.get(d.dataId).values,m=l.data.get(p.dataId).values,h=ei({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(h.dataId),y=g.complexTensorInfos.real,v=g.complexTensorInfos.imag,S=l.data.get(y.dataId).values,C=l.data.get(v.dataId).values,[I,E,D]=e(s.shape,a.shape,f,m,S,C),O=l.makeTensorInfo(D,"float32",I),R=l.makeTensorInfo(D,"float32",E),P=Sn({inputs:{real:O,imag:R},backend:l});return l.disposeIntermediateTensorInfo(c),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(O),l.disposeIntermediateTensorInfo(R),P}else{let c=l.data.get(s.dataId).values,u=l.data.get(a.dataId).values,d=r||s.dtype,[p,f]=n(s.shape,a.shape,c,u,d);return l.makeTensorInfo(f,d,p)}}}function km(t){return(n,e,r,o,i,s)=>{let a=T.assertAndGetBroadcastShape(n,e),l=b.sizeFromShape(a),c=a.length,u=b.computeStrides(a),d=b.getTypedArrayFromDType("float32",l),p=b.getTypedArrayFromDType("float32",l),f=T.getBroadcastDims(n,a),m=T.getBroadcastDims(e,a),h=T.mergeRealAndImagArrays(r,o),g=T.mergeRealAndImagArrays(i,s),y=n.length,v=b.computeStrides(n),S=e.length,C=b.computeStrides(e);if(f.length+m.length===0)for(let I=0;I<d.length;I++){let E=I%h.length,D=I%g.length,O=t(h[E*2],h[E*2+1],g[D*2],g[D*2+1]);d[I]=O.real,p[I]=O.imag}else for(let I=0;I<d.length;I++){let E=b.indexToLoc(I,c,u),D=E.slice(-y);f.forEach(G=>D[G]=0);let O=b.locToIndex(D,y,v),R=E.slice(-S);m.forEach(G=>R[G]=0);let P=b.locToIndex(R,S,C),U=t(h[O*2],h[O*2+1],g[P*2],g[P*2+1]);d[I]=U.real,p[I]=U.imag}return[d,p,a]}}var FN=et((t,n)=>t+n),Ppe=km((t,n,e,r)=>({real:t+e,imag:n+r})),rl=ut(vi,FN,Ppe),Q4={kernelName:vi,backendName:"cpu",kernelFunc:rl};function Am(t,n,e,r,o){let i=b.sizeFromShape(r),s=b.makeZerosTypedArray(o,e);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(i>0?s[l]+=n[a]:s[l]+=1)}return s}function Hw(t,n,e,r=!1){let o=t.shape[0],i=t.shape[1],s=Ie([o,e],n.dtype);for(let a=0;a<o;a++)for(let l=0;l<i;l++){let c=t.get(a,l);if(c<0)throw new Error("Input x must be non-negative!");c>=e||(r?s.set(1,a,c):n.size>0?s.set(s.get(a,c)+n.get(a,l),a,c):s.set(s.get(a,c)+1,a,c))}return s}function ti(t){return(n,e,r)=>{let o=b.getTypedArrayFromDType(e,n.length);for(let i=0;i<n.length;++i)o[i]=t(n[i],r);return o}}function Oe(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(Z(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=b.sizeFromShape(s.shape),u=e||s.dtype,d=b.getArrayFromDType(u,c);for(let p=0;p<c;++p)d[p]=n(l[p],o);return a.makeTensorInfo(s.shape,u,d)}}function ni(t,n,e){return({inputs:r,attrs:o,backend:i})=>{let{x:s}=r;if(Z(s,t),s.dtype==="string"||e==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=i,l=a.data.get(s.dataId).values,c=e||s.dtype,u=n(l,c,o);return a.makeTensorInfo(s.shape,c,u)}}var PN=ti(t=>Math.ceil(t)),$pe=ni(ta,PN),Z4={kernelName:ta,backendName:"cpu",kernelFunc:$pe};function qw(t,n,e,r){let o=b.getArrayFromDType(e,b.sizeFromShape(n));if(r&&e!=="string"){let i=0;t.forEach(s=>{let a=b.sizeFromShape(s.shape);o.set(s.vals,i),i+=a})}else{let i=0;t.forEach(s=>{let a=e==="string"?T.fromUint8ToStringArray(s.vals):s.vals,l=0;for(let c=0;c<s.shape[0];++c){let u=c*n[1]+i;for(let d=0;d<s.shape[1];++d)o[u+d]=a[l++]}i+=s.shape[1]})}return o}var $N=ti(t=>Math.exp(t)),LN=ni(la,$N),J4={kernelName:la,backendName:"cpu",kernelFunc:LN};var VN=ti(t=>Math.expm1(t)),Lpe=ni(ca,VN),eU={kernelName:ca,backendName:"cpu",kernelFunc:Lpe};var BN=ti(t=>Math.floor(t)),Vpe=ni(ua,BN),tU={kernelName:ua,backendName:"cpu",kernelFunc:Vpe};function Kw(t,n,e){let r=Ie(e,t.dtype);for(let o=0;o<r.size;++o){let s=r.indexToLoc(o).slice(),a=s[0],l=s[2],c=n.locToIndex([a,l]);s[2]=n.values[c];let u=t.locToIndex(s);r.values[o]=t.values[u]}return r}var zN=et((t,n)=>t>n?1:0),Bpe=ut(Ku,zN,null,"bool"),nU={kernelName:Ku,backendName:"cpu",kernelFunc:Bpe};var UN=et((t,n)=>t<n?1:0),zpe=ut(Xu,UN,null,"bool"),rU={kernelName:Xu,backendName:"cpu",kernelFunc:zpe};function Xw(t,n,e){let r=(n-t)/(e-1),o=b.makeZerosTypedArray(e,"float32");o[0]=t;for(let i=1;i<o.length;i++)o[i]=o[i-1]+r;return o}var jN=ti(t=>Math.log(t)),Upe=ni(ga,jN),oU={kernelName:ga,backendName:"cpu",kernelFunc:Upe};function Yw(t,n,e,r){let o=b.getTypedArrayFromDType(r,b.sizeFromShape(e));for(let i=0;i<o.length;++i){let s=i*n,a=t[s];for(let l=0;l<n;++l){let c=t[s+l];c>a&&(a=c)}o[i]=a}return o}var GN=et((t,n)=>Math.max(t,n)),jpe=ut(xa,GN),iU={kernelName:xa,backendName:"cpu",kernelFunc:jpe};var WN=et((t,n)=>Math.min(t,n)),Gpe=ut(va,WN),sU={kernelName:va,backendName:"cpu",kernelFunc:Gpe};var _y=et((t,n)=>t*n),Wpe=km((t,n,e,r)=>({real:t*e-n*r,imag:t*r+n*e})),Ld=ut(wa,_y,Wpe),aU={kernelName:wa,backendName:"cpu",kernelFunc:Ld};function HN(t,n,e){let r=b.createScalarValue(-1,e);return _y([],n,r,t,e)}function Hpe(t){let{inputs:n,backend:e}=t,{x:r}=n;Z(r,"neg");let o=e.data.get(r.dataId).values,[i,s]=HN(o,r.shape,r.dtype);return e.makeTensorInfo(s,r.dtype,i)}var lU={kernelName:pc,backendName:"cpu",kernelFunc:Hpe};var qN=et((t,n)=>t!==n?1:0),qpe=ut(ed,qN,null,"bool"),cU={kernelName:ed,backendName:"cpu",kernelFunc:qpe};function Rm(t,n,e,r,o){let i=n.length,s=b.sizeFromShape(n),a=b.computeStrides(n),l=b.computeStrides(o),c=b.getTypedArrayFromDType(e,b.sizeFromShape(o));for(let u=0;u<s;++u){let d=b.indexToLoc(u,i,a),p=new Array(d.length);for(let m=0;m<p.length;m++)p[m]=d[r[m]];let f=b.locToIndex(p,i,l);c[f]=t[u]}return c}function pn(t){let{inputs:n,attrs:e,backend:r}=t,{x:o}=n,{perm:i}=e;Z(o,"transpose");let s=o.shape.length,a=new Array(s);for(let d=0;d<a.length;d++)a[d]=o.shape[i[d]];let l=r.data.get(o.dataId).values,c=Rm(l,o.shape,o.dtype,i,a);return{dataId:r.write(c,a,o.dtype),shape:a,dtype:o.dtype}}var uU={kernelName:Dc,backendName:"cpu",kernelFunc:pn};function KN(t,n,e,r){let[o,i]=T.computeOutAndReduceShapes(t,r),s=Cn(n,"int32"),a=b.makeZerosTypedArray(b.sizeFromShape(o),s),l=b.sizeFromShape(i);for(let c=0;c<a.length;++c){let u=c*l,d=1;for(let p=0;p<l;++p)d*=e[u+p];a[c]=d}return{outVals:a,outShape:o,outDtype:s}}function Kpe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"prod");let a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=T.getAxesPermutation(l,a),u=l,d=o,p=[];c!=null&&(d=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),p.push(d),u=T.getInnerMostAxes(u.length,a));let f=e.data.get(d.dataId).values,{outVals:m,outShape:h,outDtype:g}=KN(d.shape,d.dtype,f,u),y=h;return s&&(y=T.expandShapeToKeepDim(h,l)),p.forEach(v=>e.disposeIntermediateTensorInfo(v)),e.makeTensorInfo(y,g,m)}var dU={kernelName:Pf,backendName:"cpu",kernelFunc:Kpe};function Qw(t,n,e,r){let o=t===n,i=t<n&&e<0,s=n<t&&e>1;if(o||i||s)return b.makeZerosTypedArray(0,r);let a=Math.abs(Math.ceil((n-t)/e)),l=b.makeZerosTypedArray(a,r);n<t&&e===1&&(e=-1),l[0]=t;for(let c=1;c<l.length;c++)l[c]=l[c-1]+e;return l}var XN=ti(t=>1/Math.sqrt(t)),Xpe=ni(Ta,XN),pU={kernelName:Ta,backendName:"cpu",kernelFunc:Xpe};function YN(t,n,e,r,o){let i=qn.isSliceContinous(r,n,e),s=b.sizeFromShape(e),a=b.computeStrides(r);if(i){let d=qn.computeFlatOffset(n,a);return o==="string"?t.slice(d,d+s):t.subarray(d,d+s)}let l=o==="string"?T.fromUint8ToStringArray(t):t,c=Ie(r,o,l),u=Ie(e,o);for(let d=0;d<u.size;++d){let p=u.indexToLoc(d),f=p.map((m,h)=>m+n[h]);u.set(c.get(...f),...p)}return o==="string"?T.fromStringArrayToUint8(u.values):u.values}function ri(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r;Z(o,"slice");let[a,l]=qn.parseSliceParams(o,i,s);qn.assertParamsValid(o,a,l);let c=e.data.get(o.dataId).values,u=YN(c,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,u)}var fU={kernelName:Sc,backendName:"cpu",kernelFunc:ri};function Zw(t,n,e,r,o,i,s){let a=n[0],l=i[0],c=new Array(l),u=new Array(a),d=n[1];if(l===0){if(a!==0)throw new Error(`Received SparseTensor with denseShape[0] = 0 but
         indices.shape[0] = ${a}`);let g=b.getArrayFromDType(e,0),y=b.getArrayFromDType(o,0);return[g,[0,d],y,c,u]}let p=!0,f=0,m=new Array(l).fill(0);for(let g=0;g<a;++g){let y=t[g*d];if(y<0)throw new Error(`indices(${g}, 0) is invalid: ${y} < 0`);if(y>=l)throw new Error(`indices(${g}, 0) is invalid: ${y} >= ${l}`);++m[y],p=p&&y>=f,f=y}let h=!0;for(let g=0;g<l;++g){let y=m[g]===0;c[g]=y,h=h&&!y,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(h&&p){let g=t,y=r;for(let v=0;v<a;++v)u[v]=v;return[g,[a,d],y,c,u]}else{let g=m[l-1],y=b.getArrayFromDType(e,g*d),v=b.getArrayFromDType(o,g),S=new Array(l).fill(0);for(let C=0;C<a;++C){let I=t[C*d],E=S[I],D=(I===0?0:m[I-1])+E;S[I]++;for(let O=0;O<d;++O)y[D*d+O]=t[C*d+O];v[D]=r[C],u[C]=D}for(let C=0;C<l;++C)if(S[C]===0){let E=C===0?0:m[C-1];y[E*d+0]=C;for(let D=1;D<d;++D)y[E*d+D]=0;v[E]=s}return[y,[a,d],v,c,u]}}function Jw(t,n,e,r,o){let i=b.sizeFromShape(r),s=n[0],a=o.length,l=[],c=1,u=-1;for(let g=0;g<a;++g){let y=o[g];if(y===-1){if(u!==-1)throw new Error(`only one output dimension may be -1, not both ${u} and ${g}`);u=g,l.push(1)}else{if(y<0)throw new Error(`size ${g} must be non-negative, not ${y}`);c*=y,l.push(y)}}if(u!==-1){if(c<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");let g=Math.trunc(i/c);if(c*g!==i)throw new Error(`Input to reshape is a SparseTensor with ${i}
          dense values, but the requested shape requires a multiple of ${c}. inputShape=${r} outputShape= ${l}`);l[u]=g}let d=b.sizeFromShape(l);if(d!==i)throw new Error(`Input to reshape is a tensor with ${i} dense values, but the requested shape has ${d}. inputShape=${r} outputShape=${l}`);let p=r.length,f=[];if(p>0){f[p-1]=1;for(let g=p-2;g>=0;--g)f[g]=f[g+1]*r[g+1]}let m=[];if(a>0){m[a-1]=1;for(let g=a-2;g>=0;--g)m[g]=m[g+1]*l[g+1]}let h=b.getArrayFromDType(e,s*a);for(let g=0;g<s;++g){let y=0;for(let v=0;v<p;++v)y+=t[g*p+v]*f[v];for(let v=0;v<a;++v)h[g*a+v]=Math.trunc(y/m[v]),y%=m[v]}return[h,[s,a],l]}var QN=et((t,n)=>{let e=t-n;return e*e}),Ype=ut(Fa,QN),mU={kernelName:Fa,backendName:"cpu",kernelFunc:Ype};function eC(t,n,e,r){let o=Ie(t,n.dtype);for(let i=0;i<o.size;i++){let s=o.indexToLoc(i),a=new Array(s.length);for(let l=0;l<a.length;l++)a[l]=s[l]*e[l]+r[l];o.set(n.get(...a),...s)}return o}var ZN=et((t,n)=>t-n),Qpe=km((t,n,e,r)=>({real:t-e,imag:n-r})),Iy=ut(Pa,ZN,Qpe),hU={kernelName:Pa,backendName:"cpu",kernelFunc:Iy};function tC(t,n){let e=new Array(t.rank);for(let o=0;o<e.length;o++)e[o]=t.shape[o]*n[o];let r=Ie(e,t.dtype);for(let o=0;o<r.values.length;++o){let i=r.indexToLoc(o),s=new Array(t.rank);for(let l=0;l<s.length;l++)s[l]=i[l]%t.shape[l];let a=t.locToIndex(s);r.values[o]=t.values[a]}return r}function nC(t,n,e,r,o){let i=n[n.length-1],[s,a]=[t.length/i,i],l=b.getTypedArrayFromDType(e,s*r),c=b.getTypedArrayFromDType("int32",s*r);for(let d=0;d<s;d++){let p=d*a,f=t.subarray(p,p+a),m=[];for(let v=0;v<f.length;v++)m.push({value:f[v],index:v});m.sort((v,S)=>S.value-v.value);let h=d*r,g=l.subarray(h,h+r),y=c.subarray(h,h+r);for(let v=0;v<r;v++)g[v]=m[v].value,y[v]=m[v].index}let u=n.slice();return u[u.length-1]=r,[Ie(u,e,l),Ie(u,"int32",c)]}function rC(t,n,e,r){let o=b.parseAxisParam(n,e)[0],i=[1,e[0],1];for(let m=0;m<o;m++)i[0]*=e[m];i[1]=e[o];for(let m=o+1;m<e.length;m++)i[2]*=e[m];let s={},a=new Int32Array(e[o]),l=new Et(i,r,t),c=[],u=i[0]===1&&i[2]===1;for(let m=0;m<e[o];m++){let h;if(u)h=t[m].toString();else{let g=[];for(let y=0;y<i[0];y++)for(let v=0;v<i[2];v++)g.push(l.get(y,m,v));h=g.join(",")}if(s[h]!==void 0)a[m]=s[h];else{let g=Object.keys(s).length;s[h]=g,a[m]=g,c.push(m)}}let d=i.slice();d[1]=Object.keys(s).length;let p=new Et(d,r);c.forEach((m,h)=>{for(let g=0;g<i[0];g++)for(let y=0;y<i[2];y++)p.set(l.get(g,m,y),g,h,y)});let f=e.slice();return f[o]=d[1],{outputValues:p.values,outputShape:f,indices:a}}$b("cpu",()=>new W4,1);var ek=Oe(sa,t=>t>=0?t:Math.exp(t)-1),gU={kernelName:sa,backendName:"cpu",kernelFunc:ek};function tk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r;Z([o],"leakyRelu");let s=b.sizeFromShape(o.shape),a=e.data.get(o.dataId).values,l=b.getTypedArrayFromDType("float32",s);for(let c=0;c<a.length;c++)l[c]=a[c]<0?i*a[c]:a[c];return e.makeTensorInfo(o.shape,"float32",l)}var yU={kernelName:oc,backendName:"cpu",kernelFunc:tk};var Zpe=et((t,n)=>t<0?n*t:t);function nk(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n;Z([r,o],"prelu");let i=e.data.get(r.dataId).values,s=e.data.get(o.dataId).values,[a,l]=Zpe(r.shape,o.shape,i,s,r.dtype);return e.makeTensorInfo(l,r.dtype,a)}var xU={kernelName:yc,backendName:"cpu",kernelFunc:nk};var rk=Oe(_a,t=>Math.max(0,t)),vU={kernelName:_a,backendName:"cpu",kernelFunc:rk};var ok=Oe(Ia,t=>Math.min(Math.max(0,t),6)),bU={kernelName:Ia,backendName:"cpu",kernelFunc:ok};var ik=Oe(Ra,t=>1/(1+Math.exp(-t))),wU={kernelName:Ra,backendName:"cpu",kernelFunc:ik};function Om(t,n,e,r,o){if(e==="linear")return Jn({inputs:{x:n},backend:t});if(e==="relu")return rk({inputs:{x:n},backend:t});if(e==="elu")return ek({inputs:{x:n},backend:t});if(e==="relu6")return ok({inputs:{x:n},backend:t});if(e==="prelu")return nk({inputs:{x:n,alpha:r},backend:t});if(e==="leakyrelu")return tk({inputs:{x:n},backend:t,attrs:{alpha:o}});if(e==="sigmoid")return ik({inputs:{x:n},backend:t});throw new Error(`Activation ${e} has not been implemented for the CPU backend.`)}function tt(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=b.sizeFromShape(o.shape),a=b.inferFromImplicitShape(i,s),l=b.sizeFromShape(a);b.assert(s===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${s} elements. The new shape and old shape must have the same number of elements.`),e.incRef(o.dataId);let c=e.data.get(o.dataId);if(c.complexTensorInfos!=null){let u=c.complexTensorInfos.real,d=c.complexTensorInfos.imag;u.shape=a,d.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var CU={kernelName:xc,backendName:"cpu",kernelFunc:tt};function sk(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;Z([o,i],"matMul");let l=o.shape.length,c=i.shape.length,u=s?o.shape[l-2]:o.shape[l-1],d=a?i.shape[c-1]:i.shape[c-2],p=s?o.shape[l-1]:o.shape[l-2],f=a?i.shape[c-2]:i.shape[c-1],m=o.shape.slice(0,-2),h=i.shape.slice(0,-2),g=b.sizeFromShape(m),y=b.sizeFromShape(h),v=g===y||g===1||y===1;b.assert(l>=2&&c>=2&&v,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${h}).`);let C=(g>y?o.shape.slice(0,-2):i.shape.slice(0,-2)).concat([p,f]);b.assert(u===d,()=>`Error in matMul: inner shapes (${u}) and (${d}) of Tensors with shapes ${o.shape} and ${i.shape} and transposeA=${s} and transposeB=${a} must match.`);let I=s?[g,u,p]:[g,p,u],E=a?[y,f,d]:[y,d,f],D=tt({inputs:{x:o},backend:e,attrs:{shape:I}}),O=tt({inputs:{x:i},backend:e,attrs:{shape:E}}),R=s?D.shape[1]:D.shape[2],P=s?D.shape[2]:D.shape[1],U=a?O.shape[1]:O.shape[2],G=Math.max(g,y),q=e.data.get(D.dataId).values,X=e.data.get(O.dataId).values,K=b.computeStrides(D.shape),Y=b.computeStrides(O.shape),[ne,J,te]=s?[K[0],1,K[1]]:[K[0],K[1],1],[ie,ce,pe]=a?[1,Y[1],Y[0]]:[Y[1],1,Y[0]],ue=P*U,ge=Ie([G,P,U],D.dtype),ye=ge.values,xe=e.blockSize;for(let Te=0;Te<G;Te++)for(let Pe=0;Pe<P;Pe+=xe)for(let Ve=0;Ve<U;Ve+=xe)for(let He=0;He<R;He+=xe){let at=Math.min(Pe+xe,P),Ft=Math.min(Ve+xe,U),dn=Math.min(He+xe,R);for(let en=Pe;en<at;en++)for(let qt=Ve;qt<Ft;qt++){let Kt=0;for(let tn=He;tn<dn;tn++){let hn=Math.min(Te,g-1)*ne,hs=Math.min(Te,y-1)*pe,jn=q[hn+en*J+tn*te],Mi=X[tn*ie+qt*ce+hs];Kt+=jn*Mi}ye[Te*ue+(en*U+qt)]+=Kt}}return e.disposeIntermediateTensorInfo(D),e.disposeIntermediateTensorInfo(O),e.makeTensorInfo(C,ge.dtype,ge.values)}var SU={kernelName:Wl,backendName:"cpu",kernelFunc:sk};function Jpe(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r,p,f,m,h=[];p=sk({inputs:{a:o,b:i},attrs:{transposeA:l,transposeB:c},backend:e}),s&&(f=rl({inputs:{a:p,b:s},backend:e}),h.push(p),p=f),u&&(m=Om(e,p,u,a,d),h.push(p),p=m);for(let y of h)e.disposeIntermediateTensorInfo(y);return p}var _U={kernelName:td,backendName:"cpu",kernelFunc:Jpe};var efe=Oe(Ks,t=>Math.acos(t)),IU={kernelName:Ks,backendName:"cpu",kernelFunc:efe};var tfe=Oe(Xs,t=>Math.acosh(t)),EU={kernelName:Xs,backendName:"cpu",kernelFunc:tfe};function nfe(t){let{inputs:n,backend:e}=t,r=n;Z(n,"addN");let o=r.map(a=>e.data.get(a.dataId).values),i=Ie(r[0].shape,r[0].dtype),s=i.values;for(let a=0;a<r.length;a++){let l=o[a];for(let c=0;c<s.length;c++)s[c]+=l[c]}return e.makeTensorInfo(i.shape,i.dtype,i.values)}var TU={kernelName:gf,backendName:"cpu",kernelFunc:nfe};function rfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"all");let a=b.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=b.sizeFromShape(p),m=b.makeZerosTypedArray(b.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){let v=y*f,S=h[v];for(let C=0;C<f;++C){let I=h[v+C];S=S&&I}m[y]=S}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let y=T.expandShapeToKeepDim(d,a),v=tt({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),v}return g}var DU={kernelName:yf,backendName:"cpu",kernelFunc:rfe};function ofe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"any");let a=b.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=b.sizeFromShape(p),m=b.makeZerosTypedArray(b.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){let v=y*f,S=h[v];for(let C=0;C<f;++C){let I=h[v+C];S=S||I}m[y]=S}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let y=T.expandShapeToKeepDim(d,a),v=tt({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),v}return g}var NU={kernelName:xf,backendName:"cpu",kernelFunc:ofe};function ife(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Z(o,"argMax");let s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=pn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMax",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=b.sizeFromShape(u),f=b.makeZerosTypedArray(p,"int32"),m=b.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let y=g*m,v=h[y],S=0;for(let C=0;C<m;++C){let I=h[y+C];I>v&&(v=I,S=C)}f[g]=S}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var kU={kernelName:zl,backendName:"cpu",kernelFunc:ife};function sfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r;Z(o,"argMin");let s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=pn({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),s=[s[0]],T.assertAxesAreInnerMostDims("argMin",s,l.shape.length);let[u,d]=T.computeOutAndReduceShapes(l.shape,s),p=b.sizeFromShape(u),f=b.makeZerosTypedArray(p,"int32"),m=b.sizeFromShape(d),h=e.data.get(l.dataId).values;for(let g=0;g<f.length;++g){let y=g*m,v=h[y],S=0;for(let C=0;C<m;++C){let I=h[y+C];I<v&&(v=I,S=C)}f[g]=S}return c.forEach(g=>e.disposeIntermediateTensorInfo(g)),e.makeTensorInfo(u,"int32",f)}var AU={kernelName:Ul,backendName:"cpu",kernelFunc:sfe};var afe=Oe(Ys,t=>Math.asin(t)),RU={kernelName:Ys,backendName:"cpu",kernelFunc:afe};var lfe=Oe(Qs,t=>Math.asinh(t)),OU={kernelName:Qs,backendName:"cpu",kernelFunc:lfe};var cfe=Oe(Zs,t=>Math.atan(t)),MU={kernelName:Zs,backendName:"cpu",kernelFunc:cfe};var ufe=et((t,n)=>Math.atan2(t,n)),dfe=ut(ea,ufe),FU={kernelName:ea,backendName:"cpu",kernelFunc:dfe};var pfe=Oe(Js,t=>Math.atanh(t)),PU={kernelName:Js,backendName:"cpu",kernelFunc:pfe};function Mm(t,n,e,r,o,i){let s=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,c=o.dilationWidth,u=o.effectiveFilterHeight,d=o.effectiveFilterWidth,p=o.padInfo.top,f=o.padInfo.left,m=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Ie(o.outShape,e),g=h.values,y=o.outShape[1]*o.outShape[2]*o.outShape[3],v=o.outShape[2]*o.outShape[3],S=o.outShape[3];for(let C=0;C<o.batchSize;++C){let I=C*y,E=C*r[0];for(let D=0;D<o.inChannels;++D)for(let O=0;O<o.outHeight;++O){let R=O*s-p,P=Math.max(0,R),U=Math.min(o.inHeight,u+R),G=I+O*v;for(let q=0;q<o.outWidth;++q){let X=q*a-f,K=Math.max(0,X),Y=Math.min(o.inWidth,d+X),ne=m,J=0,te=0;for(let ce=P;ce<U;ce+=l){let pe=E+ce*r[1];for(let ue=K;ue<Y;ue+=c){let ge=pe+ue*r[2],ye=t[ge+D];i==="max"&&ye>ne?ne=ye:i==="avg"&&(J+=ye,te++)}if(isNaN(ne))break}let ie=G+q*S+D;g[ie]=i==="avg"?J/te:ne}}}return h}function oC(t,n,e,r,o=!1,i=!1){let s=Ie(r.outShape,"int32"),a=r.strideHeight,l=r.strideWidth,c=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,p=r.effectiveFilterWidth,f=r.padInfo.top,m=r.padInfo.left,h=Ie(n,e,t);for(let g=0;g<r.batchSize;++g)for(let y=0;y<r.inChannels;++y)for(let v=0;v<r.outHeight;++v){let S=v*a-f,C=S;for(;C<0;)C+=c;let I=Math.min(r.inHeight,d+S);for(let E=0;E<r.outWidth;++E){let D=E*l-m,O=D;for(;O<0;)O+=u;let R=Math.min(r.inWidth,p+D),P=Number.NEGATIVE_INFINITY,U=-1;for(let G=C;G<I;G+=c){let q=G-S;for(let X=O;X<R;X+=u){let K=X-D,Y=h.get(g,G,X,y);Y>P&&(P=Y,o?U=i?((g*r.inHeight+G)*r.inWidth+X)*r.inChannels+y:(G*r.inWidth+X)*r.inChannels+y:U=q*p+K)}}s.set(U,g,v,E,y)}}return s}function iC(t,n,e,r,o,i){let s=o.strideDepth,a=o.strideHeight,l=o.strideWidth,c=o.dilationDepth,u=o.dilationHeight,d=o.dilationWidth,p=o.effectiveFilterDepth,f=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,g=o.padInfo.top,y=o.padInfo.left,v=i==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,S=Ie(o.outShape,e),C=S.values,I=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],E=o.outShape[2]*o.outShape[3]*o.outShape[4],D=o.outShape[3]*o.outShape[4],O=o.outShape[4];for(let R=0;R<o.batchSize;++R){let P=R*I,U=R*r[0];for(let G=0;G<o.inChannels;++G)for(let q=0;q<o.outDepth;++q){let X=q*s-h,K=X;for(;K<0;)K+=c;let Y=Math.min(o.inDepth,p+X),ne=P+q*E;for(let J=0;J<o.outHeight;++J){let te=J*a-g,ie=te;for(;ie<0;)ie+=u;let ce=Math.min(o.inHeight,f+te),pe=ne+J*D;for(let ue=0;ue<o.outWidth;++ue){let ge=ue*l-y,ye=ge;for(;ye<0;)ye+=d;let xe=Math.min(o.inWidth,m+ge),Te=pe+ue*O,Pe=v,Ve=0,He=0;for(let Ft=K;Ft<Y;Ft+=c){let dn=U+Ft*r[1];for(let en=ie;en<ce;en+=u){let qt=dn+en*r[2];for(let Kt=ye;Kt<xe;Kt+=d){let tn=qt+Kt*r[3],hn=t[tn+G];if(i==="max"&&hn>Pe?Pe=hn:i==="avg"&&(Ve+=hn,He++),isNaN(Pe))break}if(isNaN(Pe))break}if(isNaN(Pe))break}let at=Te+G;C[at]=i==="avg"?Ve/He:Pe}}}}return S}function $U(t,n){let e=Ie(n.outShape,"int32"),r=n.strideDepth,o=n.strideHeight,i=n.strideWidth,s=n.dilationDepth,a=n.dilationHeight,l=n.dilationWidth,c=n.effectiveFilterDepth,u=n.effectiveFilterHeight,d=n.effectiveFilterWidth,p=n.padInfo.front,f=n.padInfo.top,m=n.padInfo.left;for(let h=0;h<n.batchSize;++h)for(let g=0;g<n.inChannels;++g)for(let y=0;y<n.outDepth;++y){let v=y*r-p,S=v;for(;S<0;)S+=s;let C=Math.min(n.inDepth,c+v);for(let I=0;I<n.outHeight;++I){let E=I*o-f,D=E;for(;D<0;)D+=a;let O=Math.min(n.inHeight,u+E);for(let R=0;R<n.outWidth;++R){let P=R*i-m,U=P;for(;U<0;)U+=l;let G=Math.min(n.inWidth,d+P),q=Number.NEGATIVE_INFINITY,X=-1;for(let K=S;K<C;K+=s){let Y=K-v;for(let ne=D;ne<O;ne+=a){let J=ne-E;for(let te=U;te<G;te+=l){let ie=te-P,ce=t.get(h,K,ne,te,g);ce>=q&&(q=ce,X=Y*u*d+J*u+ie)}}}e.set(X,h,y,I,R,g)}}}return e}function ffe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Z(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))d=Jn({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=b.computeStrides(o.shape),m=Mm(p,o.shape,o.dtype,f,u,"avg");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var LU={kernelName:jl,backendName:"cpu",kernelFunc:ffe};function mfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;Z(o,"avgPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=iC(d,o.shape,o.dtype,b.computeStrides(o.shape),u,"avg");return e.makeTensorInfo(p.shape,"float32",p.values)}var VU={kernelName:Gl,backendName:"cpu",kernelFunc:mfe};function hfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;Z([o,i],"avgPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=u.strideDepth,p=u.strideHeight,f=u.strideWidth,m=u.filterDepth,h=u.filterHeight,g=u.filterWidth,y=u.dilationDepth,v=u.dilationHeight,S=u.dilationWidth,C=u.effectiveFilterDepth,I=u.effectiveFilterHeight,E=u.effectiveFilterWidth,D=C-1-u.padInfo.front,O=E-1-u.padInfo.left,R=I-1-u.padInfo.top,P=Ie(i.shape,"float32"),U=1/(m*h*g),G=e.bufferSync(o);for(let q=0;q<u.batchSize;++q)for(let X=0;X<u.inChannels;++X)for(let K=0;K<u.inDepth;++K)for(let Y=0;Y<u.inHeight;++Y)for(let ne=0;ne<u.inWidth;++ne){let J=K-D,te=Y-R,ie=ne-O,ce=0;for(let pe=0;pe<C;pe+=y){let ue=(J+pe)/d;if(!(ue<0||ue>=u.outDepth||Math.floor(ue)!==ue))for(let ge=0;ge<I;ge+=v){let ye=(te+ge)/p;if(!(ye<0||ye>=u.outHeight||Math.floor(ye)!==ye))for(let xe=0;xe<E;xe+=S){let Te=(ie+xe)/f;if(Te<0||Te>=u.outWidth||Math.floor(Te)!==Te)continue;let Pe=G.get(q,ue,ye,Te,X);ce+=Pe}}}P.set(ce*U,q,K,Y,ne,X)}return e.makeTensorInfo(P.shape,P.dtype,P.values)}var BU={kernelName:bf,backendName:"cpu",kernelFunc:hfe};function gfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;Z([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=u.strideHeight,p=u.strideWidth,f=u.filterHeight,m=u.filterWidth,h=u.dilationHeight,g=u.dilationWidth,y=u.effectiveFilterHeight,v=u.effectiveFilterWidth,S=v-1-u.padInfo.left,C=y-1-u.padInfo.top,I=Ie(s.shape,"float32"),E=1/(f*m),D=e.data.get(o.dataId).values,O=Ie(o.shape,"float32",D);for(let R=0;R<u.batchSize;++R)for(let P=0;P<u.inChannels;++P)for(let U=0;U<u.inHeight;++U)for(let G=0;G<u.inWidth;++G){let q=U-C,X=G-S,K=0;for(let Y=0;Y<y;Y+=h){let ne=(q+Y)/d;if(!(ne<0||ne>=u.outHeight||Math.floor(ne)!==ne))for(let J=0;J<v;J+=g){let te=(X+J)/p;if(te<0||te>=u.outWidth||Math.floor(te)!==te)continue;let ie=O.get(R,ne,te,P);K+=ie}}I.set(K*E,R,U,G,P)}return e.makeTensorInfo(I.shape,I.dtype,I.values)}var zU={kernelName:vf,backendName:"cpu",kernelFunc:gfe};function yfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,scale:i,offset:s,mean:a,variance:l}=n;b.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Z([o,a,l,i,s],"batchNorm");let{varianceEpsilon:c}=r;c==null&&(c=.001);let u=e.data.get(o.dataId).values,d=e.data.get(a.dataId).values,p=e.data.get(l.dataId).values,f=i?e.data.get(i.dataId).values:new Float32Array([1]),m=s?e.data.get(s.dataId).values:new Float32Array([0]),h=new Float32Array(u.length),g=m.length,y=f.length,v=p.length,S=d.length,C=0,I=0,E=0,D=0;for(let O=0;O<u.length;++O)h[O]=m[C++]+(u[O]-d[I++])*f[E++]/Math.sqrt(p[D++]+c),C>=g&&(C=0),I>=S&&(I=0),E>=y&&(E=0),D>=v&&(D=0);return e.makeTensorInfo(o.shape,o.dtype,h)}var UU={kernelName:nc,backendName:"cpu",kernelFunc:yfe};function xfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;Z([o],"batchToSpaceND");let a=i.reduce((y,v)=>y*v),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=tt({inputs:{x:o},backend:e,attrs:{shape:l}}),m=pn({inputs:{x:f},backend:e,attrs:{perm:c}}),h=tt({inputs:{x:m},backend:e,attrs:{shape:u}}),g=ri({inputs:{x:h},backend:e,attrs:{begin:d,size:p}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var jU={kernelName:Hl,backendName:"cpu",kernelFunc:xfe};function vfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.data.get(o.dataId).values,l=e.data.get(i.dataId).values,c=Am(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var GU={kernelName:nb,backendName:"cpu",kernelFunc:vfe};var bfe=Oe(na,(t,n)=>{let e=n;return t>e.clipValueMax?e.clipValueMax:t<e.clipValueMin?e.clipValueMin:t}),WU={kernelName:na,backendName:"cpu",kernelFunc:bfe};var wfe=t=>{let{x:n}=t.inputs,e=t.backend,r=new Float32Array(b.sizeFromShape(n.shape)),o=e.data.get(n.dataId),i=o.complexTensorInfos.real,s=o.complexTensorInfos.imag,a=e.data.get(i.dataId).values,l=e.data.get(s.dataId).values;for(let c=0;c<a.length;c++){let u=a[c],d=l[c];r[c]=Math.hypot(u,d)}return e.makeOutput(r,n.shape,"float32")},HU={kernelName:ql,backendName:"cpu",kernelFunc:wfe};function ps(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.data.get(r.dataId).complexTensorInfos.imag,i=e.data.get(o.dataId).values;return e.makeTensorInfo(o.shape,o.dtype,i)}var qU={kernelName:Rf,backendName:"cpu",kernelFunc:ps};function Kc(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=b.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(h=>h.shape),i);if(b.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(h=>b.sizeFromShape(h.shape)>0);if(a.length===1)return Jn({inputs:{x:a[0]},backend:e});let l=a.map(h=>h.shape);if(T.assertParamsConsistent(l,i),a[0].dtype==="complex64"){let h=a.map(C=>Jo({inputs:{input:C},backend:e})),g=a.map(C=>ps({inputs:{input:C},backend:e})),y=Kc({inputs:h,backend:e,attrs:{axis:i}}),v=Kc({inputs:g,backend:e,attrs:{axis:i}}),S=Sn({inputs:{real:y,imag:v},backend:e});return h.forEach(C=>e.disposeIntermediateTensorInfo(C)),g.forEach(C=>e.disposeIntermediateTensorInfo(C)),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),S}let c=a.map(h=>{let y=[-1,b.sizeFromShape(h.shape.slice(i))];return tt({inputs:{x:h},backend:e,attrs:{shape:y}})}),u=c.map(h=>({vals:e.data.get(h.dataId).values,shape:h.shape}));s=T.computeOutShape(c.map(h=>h.shape),1);let d=c[0].shape[0]===1,p=qw(u,s,n[0].dtype,d),f=T.computeOutShape(a.map(h=>h.shape),i),m=e.makeTensorInfo(f,n[0].dtype,p);return c.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var KU={kernelName:Kl,backendName:"cpu",kernelFunc:Kc};function ak(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r;Z([o,i],"conv2d");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f=p.filterHeight,m=p.filterWidth,h=p.dilationHeight,g=p.dilationWidth,y=p.padInfo.left,v=p.padInfo.top,S=p.dataFormat==="channelsLast",C=new Et(p.outShape,o.dtype),I=b.computeStrides(o.shape),E=b.computeStrides(i.shape),D=I[0],O=S?I[1]:I[2],R=S?I[2]:1,P=S?1:I[1],U=C.strides[0],G=S?C.strides[1]:C.strides[2],q=S?C.strides[2]:1,X=S?1:C.strides[1],K=e.data.get(o.dataId).values,Y=e.data.get(i.dataId).values,ne=C.values;for(let J=0;J<p.batchSize;++J){let te=J*D,ie=J*U;for(let ce=0;ce<p.outHeight;++ce){let pe=ie+ce*G,ue=ce*p.strideHeight-v;for(let ge=0;ge<f;++ge){let ye=ue+ge*h;if(ye<0||ye>=p.inHeight)continue;let xe=ge*E[0],Te=te+ye*O;for(let Pe=0;Pe<p.outWidth;++Pe){let Ve=pe+Pe*q,He=Pe*p.strideWidth-y;for(let at=0;at<m;++at){let Ft=He+at*g;if(Ft<0||Ft>=p.inWidth)continue;let dn=xe+at*E[1],en=Te+Ft*R,qt=dn;for(let Kt=0;Kt<p.inChannels;++Kt){let tn=K[en+Kt*P];for(let hn=0;hn<p.outChannels;++hn)ne[Ve+hn*X]+=tn*Y[qt+hn];qt+=p.outChannels}}}}}}return e.makeTensorInfo(C.shape,C.dtype,ne)}var XU={kernelName:Xl,backendName:"cpu",kernelFunc:ak};function Cfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r;Z([o,i],"conv2dBackpropFilter");let d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),{strideHeight:f,strideWidth:m,filterHeight:h,filterWidth:g}=p,y=p.dataFormat==="channelsLast",v=new Et(p.filterShape,"float32"),S=p.padInfo.left,C=p.padInfo.top,I=e.data.get(o.dataId).values,E=e.data.get(i.dataId).values,D=new Et(o.shape,o.dtype,I),O=new Et(i.shape,i.dtype,E);for(let R=0;R<h;++R){let P=Math.max(0,Math.ceil((C-R)/f)),U=Math.min(p.outHeight,(p.inHeight+C-R)/f);for(let G=0;G<g;++G){let q=Math.max(0,Math.ceil((S-G)/m)),X=Math.min(p.outWidth,(p.inWidth+S-G)/m);for(let K=0;K<p.inChannels;++K)for(let Y=0;Y<p.outChannels;++Y){let ne=0;for(let J=0;J<p.batchSize;++J)for(let te=P;te<U;++te){let ie=R+te*f-C;for(let ce=q;ce<X;++ce){let pe=G+ce*m-S;y?ne+=D.get(J,ie,pe,K)*O.get(J,te,ce,Y):ne+=D.get(J,K,ie,pe)*O.get(J,Y,te,ce)}}v.set(ne,R,G,K,Y)}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}var YU={kernelName:Cf,backendName:"cpu",kernelFunc:Cfe};function Sfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r;Z([o,i],"conv2dBackpropInput");let d=b.computeStrides(i.shape),p=b.computeStrides(o.shape),f=T.convertConv2DDataFormat(c),m=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,f),h=new Et(m.inShape,"float32"),g=h.values,y=e.data.get(o.dataId).values,v=e.data.get(i.dataId).values,[S,C,I]=d,{batchSize:E,filterHeight:D,filterWidth:O,inChannels:R,inHeight:P,inWidth:U,outChannels:G,outHeight:q,outWidth:X,strideHeight:K,strideWidth:Y}=m;f=m.dataFormat;let ne=D-1-m.padInfo.top,J=O-1-m.padInfo.left,te=f==="channelsLast",ie=h.strides[0],ce=te?h.strides[1]:h.strides[2],pe=te?h.strides[2]:1,ue=te?1:h.strides[1],ge=p[0],ye=te?p[1]:p[2],xe=te?p[2]:1,Te=te?1:p[1];for(let Pe=0;Pe<E;++Pe)for(let Ve=0;Ve<R;++Ve)for(let He=0;He<P;++He){let at=He-ne,Ft=Math.max(0,Math.ceil(at/K)),dn=Math.min(q,(D+at)/K);for(let en=0;en<U;++en){let qt=en-J,Kt=Math.max(0,Math.ceil(qt/Y)),tn=Math.min(X,(O+qt)/Y),hn=0;for(let jn=Ft;jn<dn;++jn){let Mi=jn*K-at;for(let ro=Kt;ro<tn;++ro){let nu=ro*Y-qt,si=ge*Pe+ye*jn+xe*ro,gs=S*(D-1-Mi)+C*(O-1-nu)+I*Ve;for(let ll=0;ll<G;++ll){let cl=y[si+Te*ll],ul=v[gs+ll];hn+=cl*ul}}}let hs=ie*Pe+ce*He+pe*en+ue*Ve;g[hs]=hn}}return e.makeTensorInfo(h.shape,h.dtype,h.values)}var QU={kernelName:Yl,backendName:"cpu",kernelFunc:Sfe};function _fe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r;Z([o,i],"conv3d");let c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),{filterDepth:u,filterHeight:d,filterWidth:p,dilationDepth:f,dilationHeight:m,dilationWidth:h,padInfo:g}=c,y=g.front,v=g.left,S=g.top,C=new Et(c.outShape,o.dtype),I=e.data.get(o.dataId).values,E=e.data.get(i.dataId).values,D=C.values,O=b.computeStrides(o.shape),R=b.computeStrides(i.shape);for(let P=0;P<c.batchSize;++P){let U=P*O[0],G=P*C.strides[0];for(let q=0;q<c.outDepth;++q){let X=G+q*C.strides[1],K=q*c.strideDepth-y;for(let Y=0;Y<u;++Y){let ne=K+Y*f;if(ne<0||ne>=c.inDepth)continue;let J=Y*R[0],te=U+ne*O[1];for(let ie=0;ie<c.outHeight;++ie){let ce=X+ie*C.strides[2],pe=ie*c.strideHeight-S;for(let ue=0;ue<d;++ue){let ge=pe+ue*m;if(ge<0||ge>=c.inHeight)continue;let ye=J+ue*R[1],xe=te+ge*O[2];for(let Te=0;Te<c.outWidth;++Te){let Pe=ce+Te*c.outChannels,Ve=Te*c.strideWidth-v;for(let He=0;He<p;++He){let at=Ve+He*h;if(at<0||at>=c.inWidth)continue;let Ft=ye+He*R[2],dn=xe+at*c.inChannels,en=Ft;for(let qt=0;qt<c.inChannels;++qt){let Kt=I[dn+qt];for(let tn=0;tn<c.outChannels;++tn)D[Pe+tn]+=Kt*E[en+tn];en+=c.outChannels}}}}}}}}return e.makeTensorInfo(C.shape,C.dtype,C.values)}var ZU={kernelName:Ql,backendName:"cpu",kernelFunc:_fe};function Ife(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r;Z([o,i],"conv3dBackpropFilterV2");let c=b.computeStrides(o.shape),u=b.computeStrides(i.shape),d=T.computeConv3DInfo(o.shape,l,s,1,a),p=d.strideDepth,f=d.strideHeight,m=d.strideWidth,h=d.filterDepth,g=d.filterHeight,y=d.filterWidth,v=new Et(d.filterShape,"float32"),S=v.values,[C,I,E,D]=v.strides,O=e.data.get(i.dataId).values,[R,P,U,G]=u,q=e.data.get(o.dataId).values,[X,K,Y,ne]=c,J=d.padInfo.front,te=d.padInfo.left,ie=d.padInfo.top;for(let ce=0;ce<h;++ce){let pe=Math.max(0,Math.ceil((J-ce)/p)),ue=Math.min(d.outDepth,(d.inDepth+J-ce)/p),ge=ce*C;for(let ye=0;ye<g;++ye){let xe=Math.max(0,Math.ceil((ie-ye)/f)),Te=Math.min(d.outHeight,(d.inHeight+ie-ye)/f),Pe=ye*I+ge;for(let Ve=0;Ve<y;++Ve){let He=Math.max(0,Math.ceil((te-Ve)/m)),at=Math.min(d.outWidth,(d.inWidth+te-Ve)/m),Ft=Ve*E+Pe;for(let dn=0;dn<d.inChannels;++dn){let en=dn*D+Ft;for(let qt=0;qt<d.outChannels;++qt){let Kt=0;for(let tn=0;tn<d.batchSize;++tn){let hn=tn*X,hs=tn*R;for(let jn=pe;jn<ue;++jn){let ro=(ce+jn*p-J)*K+hn,nu=jn*P+hs;for(let si=xe;si<Te;++si){let ll=(ye+si*f-ie)*Y+ro,cl=si*U+nu;for(let ul=He;ul<at;++ul){let qS=(Ve+ul*m-te)*ne+ll,KS=ul*G+cl;Kt+=q[qS+dn]*O[KS+qt]}}}}S[en+qt]=Kt}}}}}return e.makeTensorInfo(v.shape,v.dtype,v.values)}var JU={kernelName:Sf,backendName:"cpu",kernelFunc:Ife};function Efe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r;Z([o],"conv3dBackpropInputV2");let c=b.computeStrides(o.shape),u=b.computeStrides(i.shape),d=T.computeConv3DInfo(l,i.shape,a,1,s),p=new Et(d.inShape,"float32"),f=p.values,[m,h,g,y]=p.strides,v=e.data.get(o.dataId).values,[S,C,I,E]=c,D=e.data.get(i.dataId).values,[O,R,P,U]=u,{batchSize:G,filterDepth:q,filterHeight:X,filterWidth:K,inChannels:Y,inDepth:ne,inHeight:J,inWidth:te,outChannels:ie,outDepth:ce,outHeight:pe,outWidth:ue,strideDepth:ge,strideHeight:ye,strideWidth:xe}=d,Te=q-1-d.padInfo.front,Pe=X-1-d.padInfo.top,Ve=K-1-d.padInfo.left;for(let He=0;He<G;++He)for(let at=0;at<Y;++at)for(let Ft=0;Ft<ne;++Ft){let dn=Ft-Te,en=Math.max(0,Math.ceil(dn/ge)),qt=Math.min(ce,(q+dn)/ge);for(let Kt=0;Kt<J;++Kt){let tn=Kt-Pe,hn=Math.max(0,Math.ceil(tn/ye)),hs=Math.min(pe,(X+tn)/ye);for(let jn=0;jn<te;++jn){let Mi=jn-Ve,ro=Math.max(0,Math.ceil(Mi/xe)),nu=Math.min(ue,(K+Mi)/xe),si=0;for(let gs=en;gs<qt;++gs){let ll=gs*ge-dn;for(let cl=hn;cl<hs;++cl){let ul=cl*ye-tn;for(let Xm=ro;Xm<nu;++Xm){let qS=Xm*xe-Mi,KS=S*He+C*gs+I*cl+E*Xm,c6=O*(q-1-ll)+R*(X-1-ul)+P*(K-1-qS)+U*at;for(let jy=0;jy<ie;++jy){let u6=v[KS+jy],d6=D[c6+jy];si+=u6*d6}}}}f[m*He+h*Ft+g*Kt+y*jn+at]=si}}}return e.makeTensorInfo(p.shape,p.dtype,p.values)}var ej={kernelName:_f,backendName:"cpu",kernelFunc:Efe};var Tfe=Oe(ra,t=>Math.cos(t)),tj={kernelName:ra,backendName:"cpu",kernelFunc:Tfe};var Dfe=Oe(oa,t=>Math.cosh(t)),nj={kernelName:oa,backendName:"cpu",kernelFunc:Dfe};function Nfe(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,[u,d,p,f]=o.shape,m=i.shape[0],[h,g]=a,y=Ie([m,h,g,f],"float32"),v=e.data.get(i.dataId).values,S=e.data.get(s.dataId).values,C=e.data.get(o.dataId).values,I=b.computeStrides(o.shape),E=b.computeStrides(y.shape);for(let D=0;D<m;D++){let O=D*4,R=v[O],P=v[O+1],U=v[O+2],G=v[O+3],q=S[D];if(q>=u)continue;let X=h>1?(U-R)*(d-1)/(h-1):0,K=g>1?(G-P)*(p-1)/(g-1):0;for(let Y=0;Y<h;Y++){let ne=h>1?R*(d-1)+Y*X:.5*(R+U)*(d-1);if(ne<0||ne>d-1){for(let J=0;J<g;J++)for(let te=0;te<f;te++){let ie=te+J*E[2]+Y*E[1]+D*E[0];y.values[ie]=c}continue}if(l==="bilinear"){let J=Math.floor(ne),te=Math.ceil(ne),ie=ne-J;for(let ce=0;ce<g;ce++){let pe=g>1?P*(p-1)+ce*K:.5*(P+G)*(p-1);if(pe<0||pe>p-1){for(let xe=0;xe<f;xe++){let Te=xe+ce*E[2]+Y*E[1]+D*E[0];y.values[Te]=c}continue}let ue=Math.floor(pe),ge=Math.ceil(pe),ye=pe-ue;for(let xe=0;xe<f;xe++){let Te=xe+ue*I[2]+J*I[1]+q*I[0],Pe=C[Te];Te=xe+ge*I[2]+J*I[1]+q*I[0];let Ve=C[Te];Te=xe+ue*I[2]+te*I[1]+q*I[0];let He=C[Te];Te=xe+ge*I[2]+te*I[1]+q*I[0];let at=C[Te],Ft=Pe+(Ve-Pe)*ye,dn=He+(at-He)*ye;Te=xe+ce*E[2]+Y*E[1]+D*E[0],y.values[Te]=Ft+(dn-Ft)*ie}}}else for(let J=0;J<g;++J){let te=g>1?P*(p-1)+J*K:.5*(P+G)*(p-1);if(te<0||te>p-1){for(let pe=0;pe<f;pe++){let ue=pe+J*E[2]+Y*E[1]+D*E[0];y.values[ue]=c}continue}let ie=Math.round(te),ce=Math.round(ne);for(let pe=0;pe<f;pe++){let ue=pe+ie*I[2]+ce*I[1]+q*I[0],ge=pe+J*E[2]+Y*E[1]+D*E[0];y.values[ge]=C[ue]}}}}return e.makeTensorInfo(y.shape,y.dtype,y.values)}var rj={kernelName:rb,backendName:"cpu",kernelFunc:Nfe};function kfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r;Z(o,"cumsum");let l=T.getAxesPermutation([i],o.shape.length),c=o;l!=null&&(c=pn({inputs:{x:o},backend:e,attrs:{perm:l}}));let u=T.getInnerMostAxes(1,o.shape.length)[0];if(u!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${u}`);let d=Cn(c.dtype,"int32"),p=b.makeZerosTypedArray(b.sizeFromShape(c.shape),d),f=e.data.get(c.dataId).values,m=c.shape[c.shape.length-1],h=a?(y,v)=>y+m-v-1:(y,v)=>y+v;for(let y=0;y<f.length;y+=m)for(let v=0;v<m;v++){let S=h(y,v);if(v===0)p[S]=s?0:f[S];else{let C=h(y,v-1);p[S]=s?f[C]+p[C]:f[S]+p[C]}}let g=e.makeTensorInfo(c.shape,d,p);if(l!=null){let y=T.getUndoAxesPermutation(l),v=pn({inputs:{x:g},backend:e,attrs:{perm:y}});return e.disposeIntermediateTensorInfo(g),e.disposeIntermediateTensorInfo(c),v}return g}var oj={kernelName:Zl,backendName:"cpu",kernelFunc:kfe};function Afe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Am(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=Hw(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var ij={kernelName:ob,backendName:"cpu",kernelFunc:Afe};function Rfe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;b.assert(s==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${s}`),b.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=o.shape[1],c=o.shape[2],u=o.shape[3],d=l*i,p=c*i,f=u/(i*i),m=e.data.get(o.dataId).values,h=new Float32Array(a*d*p*f),g=0;for(let y=0;y<a;++y)for(let v=0;v<d;++v){let S=Math.floor(v/i),C=v%i;for(let I=0;I<p;++I){let E=Math.floor(I/i),D=I%i,O=(C*i+D)*f;for(let R=0;R<f;++R){let U=R+O+u*(E+c*(S+l*y));h[g++]=m[U]}}}return e.makeTensorInfo([a,d,p,f],o.dtype,h)}var sj={kernelName:If,backendName:"cpu",kernelFunc:Rfe};function lk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r;Z([o,i],"depthwiseConv2DNative");let u=b.computeStrides(o.shape),d=b.computeStrides(i.shape),p=l;p==null&&(p=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(s,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${p}'`);let f=T.computeConv2DInfo(o.shape,i.shape,s,p,a,c,!0),{filterHeight:m,filterWidth:h,dilationHeight:g,dilationWidth:y,padInfo:v}=f,S=v.left,C=v.top,I=f.outChannels/f.inChannels,E=new Et(f.outShape,o.dtype),D=e.data.get(o.dataId).values,O=e.data.get(i.dataId).values,R=E.values;for(let P=0;P<f.batchSize;++P){let U=P*u[0],G=P*E.strides[0];for(let q=0;q<f.outHeight;++q){let X=G+q*E.strides[1],K=q*f.strideHeight-C;for(let Y=0;Y<m;++Y){let ne=K+Y*g;if(ne<0||ne>=f.inHeight)continue;let J=Y*d[0],te=U+ne*u[1];for(let ie=0;ie<f.outWidth;++ie){let ce=X+ie*E.strides[2],pe=ie*f.strideWidth-S;for(let ue=0;ue<h;++ue){let ge=pe+ue*y;if(ge<0||ge>=f.inWidth)continue;let ye=J+ue*d[1],xe=te+ge*f.inChannels,Te=ce,Pe=ye;for(let Ve=0;Ve<f.inChannels;++Ve){let He=D[xe+Ve];for(let at=0;at<I;++at)R[Te+at]+=He*O[Pe+at];Te+=I,Pe+=I}}}}}}return e.makeTensorInfo(E.shape,E.dtype,E.values)}var aj={kernelName:Jl,backendName:"cpu",kernelFunc:lk};function Ofe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r;Z([o,i],"depthwiseConv2dNativeBackpropFilter");let d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),{strideHeight:p,strideWidth:f,filterHeight:m,filterWidth:h}=d,g=new Et(d.filterShape,"float32"),y=d.padInfo.left,v=d.padInfo.top,S=d.outChannels/d.inChannels,C=e.data.get(o.dataId).values,I=new Et(o.shape,o.dtype,C),E=e.data.get(i.dataId).values,D=new Et(i.shape,i.dtype,E);for(let O=0;O<m;++O){let R=Math.max(0,Math.ceil((v-O)/p)),P=Math.min(d.outHeight,(d.inHeight+v-O)/p);for(let U=0;U<h;++U){let G=Math.max(0,Math.ceil((y-U)/f)),q=Math.min(d.outWidth,(d.inWidth+y-U)/f);for(let X=0;X<d.outChannels;++X){let K=Math.trunc(X/S),Y=X%S,ne=0;for(let J=0;J<d.batchSize;++J)for(let te=R;te<P;++te){let ie=O+te*p-v;for(let ce=G;ce<q;++ce){let pe=U+ce*f-y;ne+=I.get(J,ie,pe,K)*D.get(J,te,ce,X)}}g.set(ne,O,U,K,Y)}}}return e.makeTensorInfo(g.shape,g.dtype,g.values)}var lj={kernelName:Ef,backendName:"cpu",kernelFunc:Ofe};function Mfe(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r;Z([o,i],"depthwiseConv2DNativeBackpropInput");let d=b.computeStrides(o.shape),p=b.computeStrides(i.shape),f=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),m=new Et(f.inShape,"float32"),h=m.values,[g,y,v]=m.strides,S=e.data.get(o.dataId).values,[C,I,E]=d,D=e.data.get(i.dataId).values,[O,R,P]=p,{batchSize:U,filterHeight:G,filterWidth:q,inChannels:X,inHeight:K,inWidth:Y,outChannels:ne,outHeight:J,outWidth:te,strideHeight:ie,strideWidth:ce}=f,pe=G-1-f.padInfo.top,ue=q-1-f.padInfo.left,ge=ne/X;for(let ye=0;ye<U;++ye)for(let xe=0;xe<X;++xe)for(let Te=0;Te<K;++Te){let Pe=Te-pe,Ve=Math.max(0,Math.ceil(Pe/ie)),He=Math.min(J,(G+Pe)/ie);for(let at=0;at<Y;++at){let Ft=at-ue,dn=Math.max(0,Math.ceil(Ft/ce)),en=Math.min(te,(q+Ft)/ce),qt=0;for(let Kt=Ve;Kt<He;++Kt){let tn=Kt*ie-Pe;for(let hn=dn;hn<en;++hn){let hs=hn*ce-Ft,jn=C*ye+I*Kt+E*hn,Mi=O*(G-1-tn)+R*(q-1-hs)+P*xe;for(let ro=0;ro<ge;++ro){let nu=xe*ge+ro,si=S[jn+nu],gs=D[Mi+ro];qt+=si*gs}}}h[g*ye+y*Te+v*at+xe]=qt}}return e.makeTensorInfo(m.shape,m.dtype,m.values)}var cj={kernelName:Tf,backendName:"cpu",kernelFunc:Mfe};function Ffe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=b.sizeFromShape(r.shape),i=e.data.get(r.dataId).values,s=Ie([o,o],r.dtype),a=s.values;for(let c=0;c<i.length;c++)a[c*o+c]=i[c];let l=[...r.shape,...r.shape];return e.makeTensorInfo(l,s.dtype,s.values)}var uj={kernelName:ib,backendName:"cpu",kernelFunc:Ffe};var dj={kernelName:ec,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o}=t,{strides:i,pad:s,dilations:a}=e,l=n,c=l.data.get(r.dataId).values,u=r.shape.length,d=l.data.get(o.dataId).values,p=o.shape.length,{batchSize:f,inHeight:m,inWidth:h,inChannels:g,outHeight:y,outWidth:v,padInfo:S,strideHeight:C,strideWidth:I,filterHeight:E,filterWidth:D,dilationHeight:O,dilationWidth:R,outShape:P}=T.computeDilation2DInfo(r.shape,o.shape,i,s,"NHWC",a),U=b.sizeFromShape(P),G=P.length,q=b.getArrayFromDType(r.dtype,U);for(let K=0;K<f;++K)for(let Y=0;Y<y;++Y){let ne=Y*C-S.top;for(let J=0;J<v;++J){let te=J*I-S.left;for(let ie=0;ie<g;++ie){let ce=Number.MIN_SAFE_INTEGER;for(let ue=0;ue<E;++ue){let ge=ne+ue*O;if(ge>=0&&ge<m)for(let ye=0;ye<D;++ye){let xe=te+ye*R;if(xe>=0&&xe<h){let Te=b.locToIndex([K,ge,xe,ie],u,b.computeStrides(r.shape)),Pe=b.locToIndex([ue,ye,ie],p,b.computeStrides(o.shape)),Ve=c[Te]+d[Pe];Ve>ce&&(ce=Ve)}}}let pe=b.locToIndex([K,Y,J,ie],G,b.computeStrides(P));q[pe]=ce}}}return{dataId:l.write(b.toTypedArray(q,r.dtype),P,r.dtype),shape:P,dtype:r.dtype}}};var pj={kernelName:Pg,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=b.toNestedArray(r.shape,c.data.get(r.dataId).values),d=b.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:y,padInfo:v,strideHeight:S,strideWidth:C,filterHeight:I,filterWidth:E,dilationHeight:D,dilationWidth:O,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);b.assert(i.rank===R.length,()=>`Error in ${Pg}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let P=b.toNestedArray(R,c.data.get(i.dataId).values),U=b.makeZerosNestedTypedArray(o.shape,o.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*S-v.top;for(let Y=0;Y<y;++Y){let ne=Y*C-v.left;for(let J=0;J<h;++J){let te=Number.MIN_SAFE_INTEGER,ie=0,ce=0;for(let pe=0;pe<I;++pe){let ue=K+pe*D;if(ue>=0&&ue<f)for(let ge=0;ge<E;++ge){let ye=ne+ge*O;if(ye>=0&&ye<m){let xe=u[q][ue][ye][J]+d[pe][ge][J];xe>te&&(te=xe,ie=pe,ce=ge)}}}U[ie][ce][J]+=P[q][X][Y][J]}}}return{dataId:c.write(b.toTypedArray(U,r.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var fj={kernelName:Fg,backendName:"cpu",kernelFunc:({inputs:t,backend:n,attrs:e})=>{let{x:r,filter:o,dy:i}=t,{strides:s,pad:a,dilations:l}=e,c=n,u=b.toNestedArray(r.shape,c.data.get(r.dataId).values),d=b.toNestedArray(o.shape,c.data.get(o.dataId).values),{batchSize:p,inHeight:f,inWidth:m,inChannels:h,outHeight:g,outWidth:y,padInfo:v,strideHeight:S,strideWidth:C,filterHeight:I,filterWidth:E,dilationHeight:D,dilationWidth:O,outShape:R}=T.computeDilation2DInfo(r.shape,o.shape,s,a,"NHWC",l);b.assert(i.rank===R.length,()=>`Error in ${Fg}, dy must have the same rank as output ${R.length}, but got ${i.rank}`);let P=b.toNestedArray(R,c.data.get(i.dataId).values),U=b.makeZerosNestedTypedArray(r.shape,r.dtype);for(let q=0;q<p;++q)for(let X=0;X<g;++X){let K=X*S-v.top;for(let Y=0;Y<y;++Y){let ne=Y*C-v.left;for(let J=0;J<h;++J){let te=Number.MIN_SAFE_INTEGER,ie=K<0?0:K,ce=ne<0?0:ne;for(let pe=0;pe<I;++pe){let ue=K+pe*D;if(ue>=0&&ue<f)for(let ge=0;ge<E;++ge){let ye=ne+ge*O;if(ye>=0&&ye<m){let xe=u[q][ue][ye][J]+d[pe][ge][J];xe>te&&(te=xe,ie=ue,ce=ye)}}}U[q][ie][ce][J]+=P[q][X][Y][J]}}}return{dataId:c.write(b.toTypedArray(U,r.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};function ol(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"sum");let a;o.dtype==="bool"?a=ei({inputs:{x:o},backend:e,attrs:{dtype:"int32"}}):a=Jn({inputs:{x:o},backend:e});let l=a.shape.length,c=b.parseAxisParam(i,a.shape),u=T.getAxesPermutation(c,l),d=c,p=a;u!=null&&(p=pn({inputs:{x:a},backend:e,attrs:{perm:u}}),d=T.getInnerMostAxes(d.length,l)),T.assertAxesAreInnerMostDims("sum",d,p.shape.length);let[f,m]=T.computeOutAndReduceShapes(p.shape,d),h=T.upcastType(p.dtype,"int32"),g=Nm(e,f,h),y=b.sizeFromShape(m),v=e.data.get(g.dataId).values,S=e.data.get(p.dataId).values;for(let C=0;C<v.length;++C){let I=C*y,E=0;for(let D=0;D<y;++D)E+=S[I+D];v[C]=E}if(s){let C=T.expandShapeToKeepDim(g.shape,c),I=g;g=tt({inputs:{x:g},backend:e,attrs:{shape:C}}),e.disposeIntermediateTensorInfo(I)}return e.disposeIntermediateTensorInfo(a),u!=null&&e.disposeIntermediateTensorInfo(p),g}var mj={kernelName:_c,backendName:"cpu",kernelFunc:ol};function Pfe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:y,expandDims:v}=T.getEinsumPermutation(f,l[g]),S;T.isIdentityPermutation(y)?S=i[g]:(S=pn({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),m.push(S));let C=S.shape.slice();for(let I=0;I<v.length;++I)C.splice(v[I],0,1);b.arraysEqual(S.shape,C)||(S=tt({inputs:{x:S},backend:e,attrs:{shape:C}}),m.push(S)),p===null?p=S:(p=Ld({inputs:{a:S,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=ol({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var hj={kernelName:sb,backendName:"cpu",kernelFunc:Pfe};function $fe(t){let{inputs:n,backend:e}=t,{dy:r,y:o}=n;Z([r,o],"eluGrad");let i=new Float32Array(b.sizeFromShape(o.shape)),s=e.data.get(o.dataId).values,a=e.data.get(r.dataId).values;for(let l=0;l<s.length;++l){let c=s[l];c>=1?i[l]=a[l]:i[l]=a[l]*(c+1)}return e.makeTensorInfo(o.shape,"float32",i)}var gj={kernelName:Df,backendName:"cpu",kernelFunc:$fe};var Lfe=et((t,n)=>t===n?1:0),ck=ut(qu,Lfe,null,"bool"),yj={kernelName:qu,backendName:"cpu",kernelFunc:ck};var Vfe=T.ERF_P,Bfe=T.ERF_A1,zfe=T.ERF_A2,Ufe=T.ERF_A3,jfe=T.ERF_A4,Gfe=T.ERF_A5,Wfe=Oe(aa,t=>{let n=Math.sign(t),e=Math.abs(t),r=1/(1+Vfe*e);return n*(1-((((Gfe*r+jfe)*r+Ufe)*r+zfe)*r+Bfe)*r*Math.exp(-e*e))}),xj={kernelName:aa,backendName:"cpu",kernelFunc:Wfe};function Fm(t){let{inputs:n,backend:e,attrs:r}=t,{input:o}=n,{dim:i}=r,s=o.shape.length,a=o.shape.slice(),l=i;return i<0&&(b.assert(-(s+1)<=i,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+i+1),a.splice(l,0,1),tt({inputs:{x:o},backend:e,attrs:{shape:a}})}var vj={kernelName:tc,backendName:"cpu",kernelFunc:Fm};var Hfe=et((t,n)=>t/n),Ey=ut(ia,Hfe),Ty={kernelName:ia,backendName:"cpu",kernelFunc:Ey};function sC(t,n,e){let r=t.shape,o=r[0],i=r[1],s=e.data.get(t.dataId),a=s.complexTensorInfos.real,l=s.complexTensorInfos.imag,c=[o,i],u=b.sizeFromShape(c),d=b.getTypedArrayFromDType("float32",u),p=b.getTypedArrayFromDType("float32",u);for(let g=0;g<o;g++){let y=ri({inputs:{x:a},backend:e,attrs:{begin:[g,0],size:[1,i]}}),v=ri({inputs:{x:l},backend:e,attrs:{begin:[g,0],size:[1,i]}}),S=Sn({inputs:{real:y,imag:v},backend:e}),{real:C,imag:I}=qfe(S,n,e),E=T.mergeRealAndImagArrays(C,I);for(let D=0;D<i;D++){let O=T.getComplexWithIndex(E,D);d[g*i+D]=O.real,p[g*i+D]=O.imag}e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(v),e.disposeIntermediateTensorInfo(S)}let f=e.makeTensorInfo(c,"float32",d),m=e.makeTensorInfo(c,"float32",p),h=Sn({inputs:{real:f,imag:m},backend:e});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),h}function qfe(t,n,e){let r=b.sizeFromShape(t.shape),o=e.data.get(t.dataId),i=e.data.get(o.complexTensorInfos.real.dataId).values,s=e.data.get(o.complexTensorInfos.imag.dataId).values;if(Kfe(r)){let a=uk(i,s,r,n,e),l=[t.shape[0],t.shape[1]];if(n){let c=e.makeTensorInfo(l,"float32",a.real),u=e.makeTensorInfo(l,"float32",a.imag),d=e.makeTensorInfo([],"float32",b.createScalarValue(r,"float32")),p=Jn({inputs:{x:d},backend:e}),f=Ty.kernelFunc({inputs:{a:c,b:d},backend:e}),m=Ty.kernelFunc({inputs:{a:u,b:p},backend:e}),h=e.data.get(f.dataId).values,g=e.data.get(m.dataId).values;return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),{real:h,imag:g}}return a}else{let a=T.mergeRealAndImagArrays(i,s),l=Xfe(a,r,n);return T.splitRealAndImagArrays(l)}}function Kfe(t){return(t&t-1)===0}function uk(t,n,e,r,o){if(e===1)return{real:t,imag:n};let i=T.mergeRealAndImagArrays(t,n),s=e/2,a=T.complexWithEvenIndex(i),l=a.real,c=a.imag,u=[l.length],d=o.makeTensorInfo(u,"float32",l),p=o.makeTensorInfo(u,"float32",c),f=Sn({inputs:{real:d,imag:p},backend:o}),m=T.complexWithOddIndex(i),h=m.real,g=m.imag,y=[h.length],v=o.makeTensorInfo(y,"float32",h),S=o.makeTensorInfo(y,"float32",g),C=Sn({inputs:{real:v,imag:S},backend:o}),I=uk(l,c,s,r,o),E=I.real,D=I.imag,O=[E.length],R=o.makeTensorInfo(O,"float32",E),P=o.makeTensorInfo(O,"float32",D),U=Sn({inputs:{real:R,imag:P},backend:o}),G=uk(h,g,s,r,o),q=G.real,X=G.imag,K=[q.length],Y=o.makeTensorInfo(K,"float32",q),ne=o.makeTensorInfo(K,"float32",X),J=Sn({inputs:{real:Y,imag:ne},backend:o}),te=T.exponents(e,r),ie=[te.real.length],ce=o.makeTensorInfo(ie,"float32",te.real),pe=o.makeTensorInfo(ie,"float32",te.imag),ue=Sn({inputs:{real:ce,imag:pe},backend:o}),ge=Ld({inputs:{a:ue,b:J},backend:o}),ye=rl({inputs:{a:U,b:ge},backend:o}),xe=Iy({inputs:{a:U,b:ge},backend:o}),Te=Jo({inputs:{input:ye},backend:o}),Pe=Jo({inputs:{input:xe},backend:o}),Ve=ps({inputs:{input:ye},backend:o}),He=ps({inputs:{input:xe},backend:o}),at=Kc({inputs:[Te,Pe],backend:o,attrs:{axis:0}}),Ft=Kc({inputs:[Ve,He],backend:o,attrs:{axis:0}}),dn=o.data.get(at.dataId).values,en=o.data.get(Ft.dataId).values;return o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(S),o.disposeIntermediateTensorInfo(C),o.disposeIntermediateTensorInfo(R),o.disposeIntermediateTensorInfo(P),o.disposeIntermediateTensorInfo(U),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(ne),o.disposeIntermediateTensorInfo(J),o.disposeIntermediateTensorInfo(ce),o.disposeIntermediateTensorInfo(pe),o.disposeIntermediateTensorInfo(ue),o.disposeIntermediateTensorInfo(ge),o.disposeIntermediateTensorInfo(ye),o.disposeIntermediateTensorInfo(xe),o.disposeIntermediateTensorInfo(Te),o.disposeIntermediateTensorInfo(Ve),o.disposeIntermediateTensorInfo(Pe),o.disposeIntermediateTensorInfo(He),o.disposeIntermediateTensorInfo(at),o.disposeIntermediateTensorInfo(Ft),{real:dn,imag:en}}function Xfe(t,n,e){let r=new Float32Array(n*2);for(let o=0;o<n;o++){let i=0,s=0;for(let a=0;a<n;a++){let l=T.exponent(o*a,n,e),c=T.getComplexWithIndex(t,a);i+=c.real*l.real-c.imag*l.imag,s+=c.real*l.imag+c.imag*l.real}e&&(i/=n,s/=n),T.assignToTypedArray(r,i,s,o)}return r}function Yfe(t){let{inputs:n,backend:e}=t,{input:r}=n,o=b.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=tt({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=sC(a,!1,e),c=tt({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var bj={kernelName:Nf,backendName:"cpu",kernelFunc:Yfe};function Dy(t){let{backend:n,attrs:e}=t,{shape:r,value:o,dtype:i}=e,s=i||b.inferDtype(o),a=b.getArrayFromDType(s,b.sizeFromShape(r));return Qfe(a,o,s),n.makeTensorInfo(r,s,a)}var wj={kernelName:kf,backendName:"cpu",kernelFunc:Dy};function Qfe(t,n,e){t.fill(n)}var Cj={kernelName:ab,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,o=e,i=b.getTypedArrayFromDType(r.dtype,b.sizeFromShape(r.shape)),[s,a,l,c]=r.shape,u=o.data.get(r.dataId).values;for(let p=0;p<s;p++){let f=p*l*a*c;for(let m=0;m<a;m++){let h=m*(l*c);for(let g=0;g<l;g++){let y=g*c;for(let v=0;v<c;v++){let C=[s,m,g,v][2],I=Math.round(l-C),E=f+h+y+v,D=u[E];if(I>=0&&I<l){let O=I*c,R=f+h+O+v;D=u[R]}i[E]=D}}}}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var Zfe=et((t,n)=>Math.floor(t/n)),Jfe=ut(da,Zfe,null,"int32"),Sj={kernelName:da,backendName:"cpu",kernelFunc:Jfe};function eme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=ak({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=rl({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=Om(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var _j={kernelName:nd,backendName:"cpu",kernelFunc:eme};function tme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=lk({inputs:{x:o,filter:i},backend:e,attrs:{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p}});if(s){let g=h;h=rl({inputs:{a:h,b:s},backend:e}),e.disposeIntermediateTensorInfo(g)}if(f){let g=h;h=Om(e,h,f,a,m),e.disposeIntermediateTensorInfo(g)}return h}var Ij={kernelName:rd,backendName:"cpu",kernelFunc:tme};function nme(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=b.sizeFromShape(r.shape),s=o.shape,a=s[s.length-1],[l,c,u,d]=T.prepareAndValidate(r,o);if(c===0)return e.makeTensorInfo(l,r.dtype,[]);let p=Ie([c,u],r.dtype),f=e.data.get(o.dataId).values,m=e.data.get(r.dataId).values;for(let h=0;h<c;h++){let g=[],y=0;for(let v=0;v<a;v++){let S=f[h*a+v];y+=S*d[v],g.push(S)}if(y<0||y>=i/u)throw new Error(`Invalid indices: ${g} does not index into ${r.shape}`);for(let v=0;v<u;v++)p.values[h*u+v]=m[y*u+v]}return e.makeTensorInfo(l,p.dtype,p.values)}var Ej={kernelName:lb,backendName:"cpu",kernelFunc:nme};function rme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r;Z([o,i],"gatherV2");let l=a;a==null&&(l=0);let c=b.sizeFromShape(i.shape),u=b.parseAxisParam(s,o.shape)[0],d=T.segment_util.collectGatherOpShapeInfo(o,i,u,l),p=tt({inputs:{x:o},backend:e,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),f=tt({inputs:{x:i},backend:e,attrs:{shape:[d.batchSize,c/d.batchSize]}}),m=[d.batchSize,d.outerSize,c/d.batchSize,d.sliceSize],h=e.bufferSync(f),g=e.bufferSync(p),y=Kw(g,h,m);return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.makeTensorInfo(d.outputShape,y.dtype,y.values)}var Tj={kernelName:rc,backendName:"cpu",kernelFunc:rme};var ome=et((t,n)=>t>=n?1:0),ime=ut(pa,ome,null,"bool"),Dj={kernelName:pa,backendName:"cpu",kernelFunc:ime};function sme(t){let{inputs:n,backend:e}=t,{input:r}=n,o=b.sizeFromShape(r.shape),i=r.shape[r.shape.length-1],s=o/i,a=tt({inputs:{x:r},backend:e,attrs:{shape:[s,i]}}),l=sC(a,!0,e),c=tt({inputs:{x:l},backend:e,attrs:{shape:r.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(l),c}var Nj={kernelName:Af,backendName:"cpu",kernelFunc:sme};var ame=Oe(fa,t=>Number.isFinite(t)?1:0,"bool"),kj={kernelName:fa,backendName:"cpu",kernelFunc:ame};var lme=Oe(ma,t=>Math.abs(t)===1/0?1:0,"bool"),Aj={kernelName:ma,backendName:"cpu",kernelFunc:lme};var cme=Oe(ha,t=>Number.isNaN(t)?1:0,"bool"),Rj={kernelName:ha,backendName:"cpu",kernelFunc:cme};var ume=et((t,n)=>t<=n?1:0),dme=ut(Yu,ume,null,"bool"),Oj={kernelName:Yu,backendName:"cpu",kernelFunc:dme};function pme(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=Xw(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var Mj={kernelName:cb,backendName:"cpu",kernelFunc:pme};var fme=Oe(ya,t=>Math.log1p(t)),Fj={kernelName:ya,backendName:"cpu",kernelFunc:fme};var mme=et((t,n)=>t&&n),hme=ut(Qu,mme,null,"bool"),Pj={kernelName:Qu,backendName:"cpu",kernelFunc:hme};var gme=Oe(Zu,t=>t?0:1,"bool"),$j={kernelName:Zu,backendName:"cpu",kernelFunc:gme};var yme=et((t,n)=>t||n),xme=ut(Ju,yme,null,"bool"),Lj={kernelName:Ju,backendName:"cpu",kernelFunc:xme};function vme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r;Z(o,"LRN");let c=o.shape[3],u=c-1,d=e.data.get(o.dataId).values,p=b.sizeFromShape(o.shape),f=new Float32Array(p);function m(h){let g=h%c,y=h-g+Math.max(0,g-i),v=h-g+Math.min(g+i,u),S=0;for(;y<=v;y++){let C=d[y];S+=C*C}return S}for(let h=0;h<p;h++){let g=m(h),y=d[h]*Math.pow(s+a*g,-l);f[h]=y}return e.makeTensorInfo(o.shape,o.dtype,f)}var Vj={kernelName:ic,backendName:"cpu",kernelFunc:vme};function bme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r;Z(s,"LRNGrad");let d=b.sizeFromShape(s.shape),p=s.shape[3],f=e.data.get(s.dataId).values,m=e.data.get(o.dataId).values,h=e.data.get(i.dataId).values,g=new Float32Array(d),y=d;for(let v=0;v<y;v++){let S=v%p,C=v-S+Math.max(0,S-a),I=v-S+Math.min(p,S+a+1),E=0;for(let D=C;D<I;D++)E+=Math.pow(m[D],2);E=c*E+l;for(let D=C;D<I;D++){let O=-2*c*u*m[D]*h[v]/E;v===D&&(O+=Math.pow(E,-u)),O*=f[v],g[D]+=O}}return e.makeTensorInfo(s.shape,o.dtype,g)}var Bj={kernelName:Of,backendName:"cpu",kernelFunc:bme};function dk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=e,l=o.shape,c=l.length,u=b.parseAxisParam(i,l),d=u,p=T.getAxesPermutation(d,c),f=a.data.get(o.dataId).values;if(p!=null){let C=new Array(c);for(let I=0;I<C.length;I++)C[I]=l[p[I]];f=Rm(f,l,o.dtype,p,C),d=T.getInnerMostAxes(d.length,c),l=C}Z(o,"max"),T.assertAxesAreInnerMostDims("max",d,c);let[m,h]=T.computeOutAndReduceShapes(l,d),g=b.sizeFromShape(h),y=Yw(f,g,m,o.dtype),v=a.write(y,m,o.dtype),S=m;return s&&(S=T.expandShapeToKeepDim(m,u)),{dataId:v,shape:S,dtype:o.dtype}}var zj={kernelName:sc,backendName:"cpu",kernelFunc:dk};function wme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;Z(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l),d;if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))d=Jn({inputs:{x:o},backend:e});else{let p=e.data.get(o.dataId).values,f=b.computeStrides(o.shape),m=Mm(p,o.shape,o.dtype,f,u,"max");d=e.makeTensorInfo(u.outShape,o.dtype,m.values)}return d}var Uj={kernelName:ac,backendName:"cpu",kernelFunc:wme};function Cme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r;Z(o,"maxPool3d");let u=T.computePool3DInfo(o.shape,i,s,1,a,l,c),d=e.data.get(o.dataId).values,p=iC(d,o.shape,o.dtype,b.computeStrides(o.shape),u,"max");return e.makeTensorInfo(p.shape,"float32",p.values)}var jj={kernelName:lc,backendName:"cpu",kernelFunc:Cme};function Sme(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,{filterSize:s,strides:a,pad:l,dimRoundingMode:c}=r;Z([o,i],"maxPool3DGrad");let u=T.computePool3DInfo(i.shape,s,a,1,l,c),d=e.bufferSync(i),p=$U(d,u),f=u.strideDepth,m=u.strideHeight,h=u.strideWidth,g=u.dilationDepth,y=u.dilationHeight,v=u.dilationWidth,S=u.effectiveFilterDepth,C=u.effectiveFilterHeight,I=u.effectiveFilterWidth,E=S-1-u.padInfo.front,D=I-1-u.padInfo.left,O=C-1-u.padInfo.top,R=Ie(i.shape,"float32"),P=e.bufferSync(o);for(let U=0;U<u.batchSize;++U)for(let G=0;G<u.inChannels;++G)for(let q=0;q<u.inDepth;++q)for(let X=0;X<u.inHeight;++X)for(let K=0;K<u.inWidth;++K){let Y=q-E,ne=X-O,J=K-D,te=0;for(let ie=0;ie<S;ie+=g){let ce=(Y+ie)/f;if(!(ce<0||ce>=u.outDepth||Math.floor(ce)!==ce))for(let pe=0;pe<C;pe+=y){let ue=(ne+pe)/m;if(!(ue<0||ue>=u.outHeight||Math.floor(ue)!==ue))for(let ge=0;ge<I;ge+=v){let ye=(J+ge)/h;if(ye<0||ye>=u.outWidth||Math.floor(ye)!==ye)continue;let xe=S*C*I-1-p.get(U,ce,ue,ye,G),Te=ie*C*I+pe*I+ge,Pe=xe===Te?1:0;if(Pe===0)continue;let Ve=P.get(U,ce,ue,ye,G);te+=Ve*Pe}}}R.set(te,U,q,X,K,G)}return e.makeTensorInfo(R.shape,R.dtype,R.values)}var Gj={kernelName:Ff,backendName:"cpu",kernelFunc:Sme};function _me(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;Z([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=e.data.get(a.dataId).values,m=Ie(p.outShape,a.dtype,oC(f,a.shape,a.dtype,p).values),h=p.strideHeight,g=p.strideWidth,y=p.dilationHeight,v=p.dilationWidth,S=p.effectiveFilterHeight,C=p.effectiveFilterWidth,I=C-1-p.padInfo.left,E=S-1-p.padInfo.top,D=Ie(a.shape,"float32"),O=e.data.get(o.dataId).values,R=Ie(o.shape,"float32",O);for(let P=0;P<p.batchSize;++P)for(let U=0;U<p.inChannels;++U)for(let G=0;G<p.inHeight;++G)for(let q=0;q<p.inWidth;++q){let X=G-E,K=q-I,Y=0;for(let ne=0;ne<S;ne+=y){let J=(X+ne)/h;if(!(J<0||J>=p.outHeight||Math.floor(J)!==J))for(let te=0;te<C;te+=v){let ie=(K+te)/g;if(ie<0||ie>=p.outWidth||Math.floor(ie)!==ie)continue;let ce=S*C-1-m.get(P,J,ie,U),pe=ne*C+te,ue=ce===pe?1:0;if(ue===0)continue;let ge=R.get(P,J,ie,U);Y+=ge*ue}}D.set(Y,P,G,q,U)}return e.makeTensorInfo(D.shape,D.dtype,D.values)}var Wj={kernelName:Mf,backendName:"cpu",kernelFunc:_me};function Hj(t,n,e,r,o){let i=b.computeStrides(n),s=Mm(t,n,e,i,o,"max"),a=oC(t,n,e,o,!0,r);return[s.values,a.values]}var qj={kernelName:ub,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;Z(r,"MaxPoolWithArgmax");let c=l.data.get(r.dataId).values,u=T.computePool2DInfo(r.shape,o,i,[1,1],s),[d,p]=Hj(c,r.shape,r.dtype,a,u),f=l.write(d,u.outShape,r.dtype),m=l.write(p,u.outShape,r.dtype);return[{dataId:f,shape:u.outShape,dtype:r.dtype},{dataId:m,shape:u.outShape,dtype:"int32"}]}};function Ime(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=b.parseAxisParam(i,o.shape),c=T.computeOutAndReduceShapes(o.shape,a)[1],u=b.sizeFromShape(c),d=[],p=e.makeTensorInfo([],"float32",new Float32Array([u]));d.push(p);let f=ei({inputs:{x:o},backend:e,attrs:{dtype:"float32"}});d.push(f);let m=Ey({inputs:{a:f,b:p},backend:e});d.push(m);let h=ol({inputs:{x:m},backend:e,attrs:{axis:i,keepDims:s}});return d.forEach(g=>e.disposeIntermediateTensorInfo(g)),h}var Kj={kernelName:cc,backendName:"cpu",kernelFunc:Ime};function Eme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;Z(o,"min");let a=b.parseAxisParam(i,o.shape),l=a,c=T.getAxesPermutation(l,o.shape.length),u=o;c!=null&&(u=pn({inputs:{x:o},backend:e,attrs:{perm:c}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,u.shape.length);let[d,p]=T.computeOutAndReduceShapes(u.shape,l),f=b.sizeFromShape(p),m=b.makeZerosTypedArray(b.sizeFromShape(d),u.dtype),h=e.data.get(u.dataId).values;for(let y=0;y<m.length;++y){let v=y*f,S=h[v];for(let C=0;C<f;++C){let I=h[v+C];I<S&&(S=I)}m[y]=S}c!=null&&e.disposeIntermediateTensorInfo(u);let g=e.makeTensorInfo(d,u.dtype,m);if(s){let y=T.expandShapeToKeepDim(d,a),v=tt({inputs:{x:g},backend:e,attrs:{shape:y}});return e.disposeIntermediateTensorInfo(g),v}return g}var Xj={kernelName:uc,backendName:"cpu",kernelFunc:Eme};function Tme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,mode:s}=r;Z(o,"mirrorPad");let a=i.map((S,C)=>S[0]+o.shape[C]+S[1]),l=i.map(S=>S[0]),c=i.map((S,C)=>S[0]+o.shape[C]),u=s==="reflect"?0:1,d=e.data.get(o.dataId).values,p=o.shape.length,f=b.computeStrides(o.shape),m=b.sizeFromShape(a),h=a.length,g=b.computeStrides(a),y=b.getTypedArrayFromDType(o.dtype,m);for(let S=0;S<m;S++){let C=b.indexToLoc(S,h,g);for(let E=0;E<h;E++)C[E]<l[E]?C[E]=l[E]*2-C[E]-u:C[E]>=c[E]&&(C[E]=(c[E]-1)*2-C[E]+u);C=C.map((E,D)=>E-l[D]);let I=b.locToIndex(C,p,f);y[S]=d[I]}return{dataId:e.write(y,a,o.dtype),shape:a,dtype:o.dtype}}var Yj={kernelName:dc,backendName:"cpu",kernelFunc:Tme};var Dme=et((t,n)=>{let e=t%n;return t<0&&n<0||t>=0&&n>=0?e:(e+n)%n}),Nme=ut(ba,Dme),Qj={kernelName:ba,backendName:"cpu",kernelFunc:Nme};var mG=Ym(pG());function xk(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=o.shape.length,a=i;if(a===-1&&(a=s-1),a!==s-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${s} and dim was ${a}`);let l=b.parseAxisParam([a],o.shape),c=dk({inputs:{x:o},backend:e,attrs:{reductionIndices:l,keepDims:!1}}),u=T.expandShapeToKeepDim(c.shape,l),d=tt({inputs:{x:c},backend:e,attrs:{shape:u}}),p=Iy({inputs:{a:o,b:d},backend:e}),f=LN({inputs:{x:p},backend:e}),m=ol({inputs:{x:f},backend:e,attrs:{axis:l,keepDims:!1}}),h=tt({inputs:{x:m},backend:e,attrs:{shape:u}}),g=Ey({inputs:{a:f,b:h},backend:e});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(h),g}var fG={kernelName:Tc,backendName:"cpu",kernelFunc:xk};function Pme(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r;Z(o,"multinomial");let l=a?o:xk({inputs:{logits:o},backend:e,attrs:{dim:-1}}),c=l.shape[0],u=l.shape[1],d=e.data.get(l.dataId).values,p=[c,i],f=b.makeZerosTypedArray(b.sizeFromShape(p),"int32");for(let m=0;m<c;++m){let h=m*u,g=new Float32Array(u-1);g[0]=d[h];for(let S=1;S<g.length;++S)g[S]=g[S-1]+d[h+S];let y=mG.alea(s.toString()),v=m*i;for(let S=0;S<i;++S){let C=y();f[v+S]=g.length;for(let I=0;I<g.length;I++)if(C<g[I]){f[v+S]=I;break}}}return a||e.disposeIntermediateTensorInfo(l),e.makeTensorInfo(p,"int32",f)}var hG={kernelName:db,backendName:"cpu",kernelFunc:Pme};var $me=Qn.nonMaxSuppressionV3Impl;function Lme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r;Z(o,"NonMaxSuppression");let c=e.data.get(o.dataId).values,u=e.data.get(i.dataId).values,{selectedIndices:d}=$me(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var gG={kernelName:pb,backendName:"cpu",kernelFunc:Lme};var Vme=Qn.nonMaxSuppressionV4Impl;function Bme(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r;Z(o,"NonMaxSuppressionPadded");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,{selectedIndices:p,validOutputs:f}=Vme(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var yG={kernelName:fb,backendName:"cpu",kernelFunc:Bme};var zme=Qn.nonMaxSuppressionV5Impl;function Ume(t){let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r;Z(o,"NonMaxSuppressionWithScore");let u=e.data.get(o.dataId).values,d=e.data.get(i.dataId).values,p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:y}=zme(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var xG={kernelName:mb,backendName:"cpu",kernelFunc:Ume};function jme(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r;Z(o,"oneHot");let l=b.sizeFromShape(o.shape),c=new Float32Array(l*i);c.fill(a);let u=e.data.get(o.dataId).values;for(let d=0;d<l;++d)u[d]>=0&&u[d]<i&&(c[d*i+u[d]]=s);return e.makeTensorInfo([...o.shape,i],"int32",c)}var vG={kernelName:mc,backendName:"cpu",kernelFunc:jme};function Ny(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(r.dtype==="complex64"){let o=Jo({inputs:{input:r},backend:e}),i=Ny({inputs:{x:o},backend:e}),s=ps({inputs:{input:r},backend:e}),a=Ny({inputs:{x:s},backend:e}),l=Sn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Dy({backend:e,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var bG={kernelName:Ac,backendName:"cpu",kernelFunc:Ny};function wG(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(r.dtype==="complex64"){let o=Jo({inputs:{input:r},backend:e}),i=wG({inputs:{x:o},backend:e}),s=ps({inputs:{input:r},backend:e}),a=Ny({inputs:{x:s},backend:e}),l=Sn({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return Dy({backend:e,attrs:{shape:r.shape,value:1,dtype:r.dtype}})}var CG={kernelName:fc,backendName:"cpu",kernelFunc:wG};function vk(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return Fm({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{b.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),b.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=Fm({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Kc({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var SG={kernelName:hc,backendName:"cpu",kernelFunc:vk};function Gme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r;Z(o,"pad");let a=i.map((v,S)=>v[0]+o.shape[S]+v[1]),l=i.map(v=>v[0]),c=e.data.get(o.dataId).values,u=b.sizeFromShape(o.shape),d=o.shape.length,p=b.computeStrides(o.shape),f=b.sizeFromShape(a),m=a.length,h=b.computeStrides(a),g=b.getTypedArrayFromDType(o.dtype,f);s!==0&&g.fill(s);for(let v=0;v<u;v++){let C=b.indexToLoc(v,d,p).map((E,D)=>E+l[D]),I=b.locToIndex(C,m,h);g[I]=c[v]}return{dataId:e.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var lC={kernelName:gc,backendName:"cpu",kernelFunc:Gme};var Wme=et((t,n)=>Math.pow(t,n)),Hme=ut(Ca,Wme),_G={kernelName:Ca,backendName:"cpu",kernelFunc:Hme};function qme(t){let{backend:n,attrs:e}=t,{start:r,stop:o,dtype:i,step:s}=e,a=Qw(r,o,s,i);return n.makeTensorInfo([a.length],i,a)}var IG={kernelName:$f,backendName:"cpu",kernelFunc:qme};var Kme=Oe(Sa,t=>1/t),EG={kernelName:Sa,backendName:"cpu",kernelFunc:Kme};function Xme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Z(o,"resizeBilinear");let l=b.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(b.sizeFromShape([d,c,u,m])),y=[i&&c>1?p-1:p,i&&u>1?f-1:f],v=[i&&c>1?c-1:c,i&&u>1?u-1:u],S=0,C=y[0]/v[0],I=y[1]/v[1];for(let E=0;E<d;E++)for(let D=0;D<c;D++){let O;s?O=C*(D+.5)-.5:O=C*D;let R=Math.max(0,Math.floor(O)),P=O-R,U=Math.min(p-1,Math.ceil(O)),G=E*l[0]+R*l[1],q=E*l[0]+U*l[1];for(let X=0;X<u;X++){let K;s?K=I*(X+.5)-.5:K=I*X;let Y=Math.max(0,Math.floor(K)),ne=K-Y,J=Math.min(f-1,Math.ceil(K)),te=G+Y*l[2],ie=q+Y*l[2],ce=G+J*l[2],pe=q+J*l[2];for(let ue=0;ue<m;ue++){let ge=h[te+ue],ye=h[ie+ue],xe=h[ce+ue],Te=h[pe+ue],Pe=ge+(xe-ge)*ne,Ve=ye+(Te-ye)*ne,He=Pe+(Ve-Pe)*P;g[S++]=He}}}return e.makeTensorInfo([d,c,u,m],"float32",g)}var TG={kernelName:bc,backendName:"cpu",kernelFunc:Xme};function Yme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Z([i,o],"resizeBilinearGrad");let a=b.computeStrides(o.shape),[l,c,u,d]=o.shape,[,p,f]=i.shape,m=new Float32Array(l*c*u*d),h=[s&&p>1?c-1:c,s&&f>1?u-1:u],g=[s&&p>1?p-1:p,s&&f>1?f-1:f],y=h[0]/g[0],v=h[1]/g[1],S=e.data.get(i.dataId).values,C=0;for(let I=0;I<l;I++){let E=I*a[0];for(let D=0;D<p;D++){let O=D*y,R=Math.floor(O),P=Math.min(Math.ceil(O),c-1),U=E+R*a[1],G=E+P*a[1],q=O-R,X=1-q;for(let K=0;K<f;K++){let Y=K*v,ne=Math.floor(Y),J=Math.min(Math.ceil(Y),u-1),te=Y-ne,ie=1-te,ce=U+ne*a[2],pe=U+J*a[2],ue=G+ne*a[2],ge=G+J*a[2],ye=X*ie,xe=X*te,Te=q*ie,Pe=q*te;for(let Ve=0;Ve<d;Ve++){let He=S[C++];m[ce+Ve]+=He*ye,m[pe+Ve]+=He*xe,m[ue+Ve]+=He*Te,m[ge+Ve]+=He*Pe}}}}return e.makeTensorInfo([l,u,c,d],"float32",m)}var DG={kernelName:Bf,backendName:"cpu",kernelFunc:Yme};function Qme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r;Z(o,"resizeNearestNeighbor");let l=b.computeStrides(o.shape),[c,u]=a,[d,p,f,m]=o.shape,h=e.data.get(o.dataId).values,g=new Float32Array(d*c*u*m),y=[i&&c>1?p-1:p,i&&u>1?f-1:f],v=[i&&c>1?c-1:c,i&&u>1?u-1:u],S=y[0]/v[0],C=y[1]/v[1],I=0;for(let E=0;E<d;E++){let D=E*l[0];for(let O=0;O<c;O++){let R=s?S*(O+.5):S*O,P=Math.min(p-1,i?Math.round(R):Math.floor(R));s&&(P=Math.max(0,P));let U=D+P*l[1];for(let G=0;G<u;G++){let q=s?C*(G+.5):C*G,X=Math.min(f-1,i?Math.round(q):Math.floor(q));s&&(X=Math.max(0,X));let K=U+X*l[2];for(let Y=0;Y<m;Y++){let ne=h[K+Y];g[I++]=ne}}}}return e.makeTensorInfo([d,c,u,m],o.dtype,g)}var NG={kernelName:vc,backendName:"cpu",kernelFunc:Qme};function Zme(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r;Z([i,o],"resizeNearestNeighborGrad");let a=b.computeStrides(o.shape),l=b.computeStrides(i.shape),[c,u,d,p]=o.shape,[,f,m]=i.shape,h=new Float32Array(c*u*d*p),g=e.data.get(i.dataId).values,y=[s&&f>1?u-1:u,s&&m>1?d-1:d],v=[s&&f>1?f-1:f,s&&m>1?m-1:m],S=y[0]/v[0],C=y[1]/v[1],I=1/S,E=1/C,D=Math.ceil(I)*2+2,O=Math.ceil(E)*2+2;for(let R=0;R<c;R++){let P=R*a[0];for(let U=0;U<u;U++){let G=P+U*a[1],q=Math.floor(U*I),X=Math.floor(q-D/2);for(let K=0;K<d;K++){let Y=G+K*a[2],ne=Math.floor(K*E),J=Math.floor(ne-O/2);for(let te=0;te<p;te++){let ie=0;for(let ce=0;ce<D;ce++){let pe=ce+X;if(pe<0||pe>=f)continue;let ue=P+pe*l[1],ge=pe*S,ye=Math.min(u-1,s?Math.round(ge):Math.floor(ge));if(U===ye)for(let xe=0;xe<O;xe++){let Te=xe+J;if(Te<0||Te>=m)continue;let Pe=ue+Te*l[2],Ve=Te*C,He=Math.min(d-1,s?Math.round(Ve):Math.floor(Ve));K===He&&(ie+=g[Pe+te])}}h[Y+te]=ie}}}}return e.makeTensorInfo(o.shape,o.dtype,h)}var kG={kernelName:Vf,backendName:"cpu",kernelFunc:Zme};function Jme(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r;Z(o,"reverse");let s=o.shape.length,a=b.parseAxisParam(i,o.shape);if(s===0)return Jn({inputs:{x:o},backend:e});let l=new Et(o.shape,o.dtype),c=e.bufferSync(o);for(let u=0;u<l.size;u++){let d=l.indexToLoc(u),p=d.slice();a.forEach(f=>p[f]=o.shape[f]-1-p[f]),l.set(c.get(...p),...d)}return e.makeTensorInfo(l.shape,l.dtype,l.values)}var AG={kernelName:wc,backendName:"cpu",kernelFunc:Jme};var RG={kernelName:bb,backendName:"cpu",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=b.getTypedArrayFromDType(r.dtype,b.sizeFromShape(r.shape)),[c,u,d,p]=r.shape,[f,m]=T.getImageCenter(s,u,d),h=255,g=Math.sin(o),y=Math.cos(o),v=a.data.get(r.dataId).values;for(let C=0;C<c;C++){let I=C*d*u*p;for(let E=0;E<u;E++){let D=E*(d*p);for(let O=0;O<d;O++){let R=O*p;for(let P=0;P<p;P++){let U=[c,E,O,P],G=U[2],q=U[1],X=(G-f)*y-(q-m)*g,K=(G-f)*g+(q-m)*y;X=Math.round(X+f),K=Math.round(K+m);let Y=i;if(typeof i!="number"&&(P===3?Y=h:Y=i[P]),X>=0&&X<d&&K>=0&&K<u){let J=K*(d*p),te=X*p,ie=I+J+te+P;Y=v[ie]}let ne=I+D+R+P;l[ne]=Y}}}}return{dataId:a.write(l,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var ehe=Oe(Ea,t=>{let n=Math.floor(t);return t-n<.5?Math.floor(t):t-n>.5?Math.ceil(t):n%2===0?n:n+1}),OG={kernelName:Ea,backendName:"cpu",kernelFunc:ehe};function cC(t,n,e,r,o,i,s,a,l,c){let u=[r/o,o],d=t.values,p=n.values;if(r===0)return Ie(e,n.dtype);let f=Ie(u,n.dtype);f.values.fill(l);for(let m=0;m<i;m++){let h=[],g=0;for(let y=0;y<s;y++){let v=d[m*s+y];h.push(v),g+=v*a[y]}if(g<0||g>=r/o)throw new Error(`Invalid indices: ${h} does not index into ${e}`);for(let y=0;y<o;y++)c?f.values[g*o+y]+=p[m*o+y]:f.values[g*o+y]=n.rank===0?p[0]:p[m*o+y]}return f}function the(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=!0,f=e.bufferSync(o),m=e.bufferSync(i),h=cC(f,m,s,d,c,l,a,u,0,p);return e.makeTensorInfo(s,h.dtype,h.values)}var MG={kernelName:hb,backendName:"cpu",kernelFunc:the};function nhe(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n;Z([r,o,i],"select");let s=r.shape.length,a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=Cn(o.dtype,i.dtype),d=b.makeZerosTypedArray(b.sizeFromShape(o.shape),u),p=0,f=s===0||s>1||o.shape.length===1?1:b.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<f;h++)a[m]===1?d[p++]=l[m]:d[p++]=c[m];return e.makeTensorInfo(o.shape,u,d)}var FG={kernelName:Cc,backendName:"cpu",kernelFunc:nhe};var rhe=T.SELU_SCALEALPHA,ohe=T.SELU_SCALE,ihe=Oe(Da,t=>t>=0?ohe*t:rhe*(Math.exp(t)-1)),PG={kernelName:Da,backendName:"cpu",kernelFunc:ihe};var she=Oe(Aa,t=>t<0?-1:t>0?1:0),$G={kernelName:Aa,backendName:"cpu",kernelFunc:she};var ahe=Oe(Na,t=>Math.sin(t)),LG={kernelName:Na,backendName:"cpu",kernelFunc:ahe};var lhe=Oe(ka,t=>Math.sinh(t)),VG={kernelName:ka,backendName:"cpu",kernelFunc:lhe};var che=11920928955078125e-23,BG=Math.log(che)+2,uhe=Oe(Oa,t=>{let n=t>-BG,e=t<BG,r=Math.exp(t),o;return e?o=r:n?o=t:o=Math.log(1+r),o}),zG={kernelName:Oa,backendName:"cpu",kernelFunc:uhe};function dhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;Z([o],"spaceToBatchND");let a=b.sizeFromShape(i),l=[[0,0]];l.push(...s);for(let E=1+i.length;E<o.shape.length;++E)l.push([0,0]);let c=lC.kernelFunc({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),u=T.getReshaped(c.shape,i,a,!1),d=T.getPermuted(u.length,i.length,!1),p=T.getReshapedPermuted(c.shape,i,a,!1),h=tt({inputs:{x:c},backend:e,attrs:{shape:u}}),v=pn({inputs:{x:h},backend:e,attrs:{perm:d}}),I=tt({inputs:{x:v},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(v),I}var UG={kernelName:Ic,backendName:"cpu",kernelFunc:dhe};function phe(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.data.get(r.dataId).values,l=e.data.get(o.dataId).values,c=e.data.get(i.dataId).values,u=e.data.get(s.dataId).values[0],[d,p,f,m,h]=Zw(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var jG={kernelName:gb,backendName:"cpu",kernelFunc:phe};function fhe(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.data.get(o.dataId).values),a=e.data.get(r.dataId).values,l=Array.from(e.data.get(i.dataId).values),[c,u,d]=Jw(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var GG={kernelName:yb,backendName:"cpu",kernelFunc:fhe};function mhe(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,sliceSize:u,strides:d,outputSize:p}=T.calculateShapes(i,o,a),f=!1,m=e.bufferSync(o),h=e.bufferSync(i),g=e.data.get(s.dataId).values[0],y=cC(m,h,a,p,u,c,l,d,g,f);return e.makeTensorInfo(a,y.dtype,y.values)}var WG={kernelName:xb,backendName:"cpu",kernelFunc:mhe};function hhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=b.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=new Array(o.shape.length).fill(0),u=o.shape.slice();return l.map(d=>{let p=[...u];p[a]=d;let f=ri({inputs:{x:o},backend:e,attrs:{begin:c,size:p}});return c[a]+=d,f})}var HG={kernelName:Ec,backendName:"cpu",kernelFunc:hhe};var ghe=Oe(Ma,t=>Math.sqrt(t)),qG={kernelName:Ma,backendName:"cpu",kernelFunc:ghe};var KG={kernelName:zf,backendName:"cpu",kernelFunc:({inputs:t,backend:n})=>{let{x:e}=t,r=n;Z(e,"square");let o=r.data.get(e.dataId).values,i=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];i[a]=l*l}return{dataId:r.write(i,e.shape,e.dtype),shape:e.shape,dtype:e.dtype}}};var yhe=Oe(Va,(t,n)=>{let e=n;return isNaN(t)?NaN:t>0?1:e.alpha}),XG={kernelName:Va,backendName:"cpu",kernelFunc:yhe};function xhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r;Z(o,"stridedSlice");let{nonStrided:f,$begin:m,$strides:h,size:g,newShape:y,outShape:v}=qn.sliceInfo(o.shape,i,s,a,l,c,u,d,p),S=tt({inputs:{x:o},backend:e,attrs:{shape:y}}),C;if(f){let E=ri({inputs:{x:S},backend:e,attrs:{begin:m,size:g}});C=tt({inputs:{x:E},backend:e,attrs:{shape:v}}),e.disposeIntermediateTensorInfo(E)}else if(v.some(E=>E===0))C=e.makeTensorInfo(v,o.dtype,[]);else{let E=e.bufferSync(S),D=eC(v,E,h,m);C=e.makeTensorInfo(D.shape,D.dtype,D.values)}let I=tt({inputs:{x:C},backend:e,attrs:{shape:v}});return e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(C),I}var YG={kernelName:Uf,backendName:"cpu",kernelFunc:xhe};var vhe=Oe($a,t=>Math.tan(t)),QG={kernelName:$a,backendName:"cpu",kernelFunc:vhe};var bhe=Oe(La,t=>Math.tanh(t)),ZG={kernelName:La,backendName:"cpu",kernelFunc:bhe};function whe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;Z(o,"tile");let s=tC(e.bufferSync(o),i);return e.makeTensorInfo(s.shape,s.dtype,s.values)}var JG={kernelName:ns,backendName:"cpu",kernelFunc:whe};function Che(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r;Z(o,"topk");let a=e.data.get(o.dataId).values,[l,c]=nC(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var eW={kernelName:jf,backendName:"cpu",kernelFunc:Che};function She(t){let{inputs:n,attrs:e,backend:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=e,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],y=b.computeStrides(o.shape),v=y[0],S=y[1],C=y[2],I=b.getTypedArrayFromDType(o.dtype,b.sizeFromShape(g));I.fill(l);let E=r.data.get(o.dataId).values,D=r.data.get(i.dataId).values;for(let R=0;R<u;++R){let P=i.shape[0]===1?D:D.subarray(R*8,R*8+8);for(let U=0;U<m;++U)for(let G=0;G<h;++G)for(let q=0;q<f;++q){let X,K=P[6]*G+P[7]*U+1;if(K===0)continue;let Y=(P[0]*G+P[1]*U+P[2])/K,ne=(P[3]*G+P[4]*U+P[5])/K,J=tW(Y,p,a),te=tW(ne,d,a);switch(s){case"nearest":X=Dhe(E,d,p,v,S,C,R,te,J,q,l);break;case"bilinear":X=Nhe(E,d,p,v,S,C,R,te,J,q,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${s}`)}let ie=R*v+U*S+G*C+q;I[ie]=X}return r.makeTensorInfo(g,o.dtype,I)}return{dataId:r.write(I,g,o.dtype),shape:o.shape,dtype:o.dtype}}var nW={kernelName:vb,backendName:"cpu",kernelFunc:She};function tW(t,n,e){switch(e){case"reflect":return _he(t,n);case"wrap":return Ihe(t,n);case"nearest":return The(t,n);case"constant":default:return Ehe(t,n)}}function _he(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=2*n;e<r&&(e=r*Math.trunc(-e/r)+e),e=e<-n?e+r:-e-1}else if(e>n-1)if(n<=1)e=0;else{let r=2*n;e-=r*Math.trunc(e/r),e>=n&&(e=r-e-1)}return b.clamp(0,e,n-1)}function Ihe(t,n){let e=t;if(e<0)if(n<=1)e=0;else{let r=n-1;e+=n*(Math.trunc(-e/r)+1)}else if(e>n-1)if(n<=1)e=0;else{let r=n-1;e-=n*Math.trunc(e/r)}return b.clamp(0,e,n-1)}function Ehe(t,n){return t}function The(t,n){return b.clamp(0,t,n-1)}function ky(t,n,e,r,o,i,s,a,l,c,u){let d=s*r+a*o+l*i+c;return 0<=a&&a<n&&0<=l&&l<e?t[d]:u}function Dhe(t,n,e,r,o,i,s,a,l,c,u){let d=Math.round(a),p=Math.round(l);return ky(t,n,e,r,o,i,s,d,p,c,u)}function Nhe(t,n,e,r,o,i,s,a,l,c,u){let d=Math.floor(a),p=Math.floor(l),f=d+1,m=p+1,h=(m-l)*ky(t,n,e,r,o,i,s,d,p,c,u)+(l-p)*ky(t,n,e,r,o,i,s,d,m,c,u),g=(m-l)*ky(t,n,e,r,o,i,s,f,p,c,u)+(l-p)*ky(t,n,e,r,o,i,s,f,m,c,u);return(f-a)*h+(a-d)*g}function khe(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;Z(i,"unique");let s=r.data.get(i.dataId).values,{outputValues:a,outputShape:l,indices:c}=rC(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var rW={kernelName:Gf,backendName:"cpu",kernelFunc:khe};function Ahe(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o.shape.length,a=o.shape[i],l=new Array(s-1),c=0;for(let f=0;f<s;f++)f!==i&&(l[c++]=o.shape[f]);let u=new Array(s).fill(0),d=o.shape.slice();d[i]=1;let p=new Array(a);for(let f=0;f<p.length;f++){u[i]=f;let m=ri({inputs:{x:o},backend:e,attrs:{begin:u,size:d}});p[f]=tt({inputs:{x:m},backend:e,attrs:{shape:l}}),e.disposeIntermediateTensorInfo(m)}return p}var oW={kernelName:Nc,backendName:"cpu",kernelFunc:Ahe};function Rhe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r;Z(o,"unsortedSegmentSum");let a=o.shape.length,l=i.shape.length,c=[],u=[],d=a-l,p=i;for(let m=0;m<d;++m){let h=Fm({inputs:{input:p},backend:e,attrs:{dim:m+1}});p=h,u.push(h)}for(let m=0;m<s;++m){let h=b.createScalarValue(m,"int32"),g=e.makeTensorInfo([],"int32",h),y=ck({inputs:{a:g,b:p},backend:e}),v=ei({inputs:{x:y},backend:e,attrs:{dtype:"float32"}}),S=Ld({inputs:{a:v,b:o},backend:e}),C=ol({inputs:{x:S},backend:e,attrs:{axis:0,keepDims:!1}});c.push(C),u.push(g),u.push(y),u.push(v),u.push(S),u.push(C)}let f=vk({inputs:c,backend:e,attrs:{axis:0}});return u.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var iW={kernelName:kc,backendName:"cpu",kernelFunc:Rhe};var Ohe=[_U,H4,IU,EU,Q4,TU,DU,NU,kU,AU,RU,OU,MU,FU,PU,LU,VU,BU,zU,SU,UU,jU,GU,Y4,Z4,WU,q4,HU,KU,YU,QU,XU,JU,ej,ZU,tj,nj,rj,oj,ij,sj,aj,lj,cj,uj,dj,fj,pj,Ty,hj,gU,gj,yj,xj,J4,vj,eU,bj,wj,Cj,tU,Sj,_j,Ij,Ej,Tj,nU,Dj,K4,Nj,qU,kj,Aj,Rj,yU,rU,Oj,Mj,oU,Fj,Pj,$j,Lj,Vj,Bj,iU,Uj,jj,Gj,Wj,qj,zj,Kj,Xj,sU,Yj,Qj,hG,aU,lU,gG,yG,xG,cU,vG,CG,SG,lC,_G,xU,dU,IG,X4,EG,vU,bU,CU,TG,DG,NG,kG,AG,RG,OG,pU,MG,FG,PG,wU,$G,LG,VG,fU,fG,zG,UG,jG,GG,WG,HG,qG,KG,mU,XG,YG,hU,mj,QG,ZG,JG,eW,uU,nW,rW,oW,iW,bG];for(let t of Ohe)Cb(t);var Bd={},bk={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function sW(t,n){Bd[t]=n}function _o(t){if(!(t in Bd)){let e=Fhe(t);if(e!==null)Bd[t]=e;else return console.log("Could not get context for WebGL version",t),null}let n=Bd[t];return n.isContextLost()?(delete Bd[t],_o(t)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Bd[t])}function Mhe(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Fhe(t){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let n=Mhe(t);return n.addEventListener("webglcontextlost",e=>{e.preventDefault(),delete Bd[t]},!1),t===1?n.getContext("webgl",bk)||n.getContext("experimental-webgl",bk):n.getContext("webgl2",bk)}var zd=function(t){return t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH",t}(zd||{}),dr=function(t){return t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD",t}(dr||{}),er=function(t){return t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16",t}(er||{});function Ud(t,n){return[n,t]}function aW(t,n){return t*n}function Xc(t){let n=b.sizeFromShape(t),e=Math.ceil(n/4);return b.sizeToSquarishShape(e)}function fs(t,n){return[Math.max(1,Math.ceil(n/2)),Math.max(1,Math.ceil(t/2))]}function lW(t,n){let[e,r]=fs(t,n);return e*r*4}function Ay(t,n){let e=t,r,o,i,s,a,l,c,u,d,p;return H().getNumber("WEBGL_VERSION")===2?(r=e.R32F,o=e.R16F,i=e.RGBA16F,s=e.RGBA32F,a=e.RED,c=4,u=1,d=e.HALF_FLOAT,p=e.FLOAT):(r=t.RGBA,o=t.RGBA,i=t.RGBA,s=e.RGBA,a=t.RGBA,c=4,u=4,d=n!=null?n.HALF_FLOAT_OES:null,p=t.FLOAT),l=t.RGBA,{internalFormatFloat:r,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:i,internalFormatPackedFloat:s,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:c,defaultNumChannels:u,textureTypeHalfFloat:d,textureTypeFloat:p}}function ke(t,n){let e=n();return H().getBool("DEBUG")&&Phe(t),e}function Phe(t){let n=t.getError();if(n!==t.NO_ERROR)throw new Error("WebGL Error: "+Vhe(t,n))}var $he=596e-10,Lhe=65504;function cW(t){return!!(H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||$he<Math.abs(t)&&Math.abs(t)<Lhe)}function Vhe(t,n){switch(n){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${n}`}}function Ry(t,n){return il(t,()=>t.getExtension(n),'Extension "'+n+'" not supported on this browser.')}function uW(t,n){let e=il(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(ke(t,()=>t.shaderSource(e,n)),ke(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(e)),new Error("Failed to compile vertex shader.");return e}function dW(t,n){let e=il(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(ke(t,()=>t.shaderSource(e,n)),ke(t,()=>t.compileShader(e)),t.getShaderParameter(e,t.COMPILE_STATUS)===!1)throw zhe(n,t.getShaderInfoLog(e)),new Error("Failed to compile fragment shader.");return e}var Bhe=/ERROR: [0-9]+:([0-9]+):/g;function zhe(t,n){let e=Bhe.exec(n);if(e==null){console.log(`Couldn't parse line number in error: ${n}`),console.log(t);return}let r=+e[1],o=t.split(`
`),i=o.length.toString().length+2,s=o.map((d,p)=>b.rightPad((p+1).toString(),i)+d),a=0;for(let d=0;d<s.length;d++)a=Math.max(s[d].length,a);let l=s.slice(0,r-1),c=s.slice(r-1,r),u=s.slice(r);console.log(l.join(`
`)),console.log(n.split(`
`)[0]),console.log(`%c ${b.rightPad(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(u.join(`
`))}function pW(t){return il(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function fW(t,n){if(ke(t,()=>t.linkProgram(n)),t.getProgramParameter(n,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function dC(t,n){if(ke(t,()=>t.validateProgram(n)),t.getProgramParameter(n,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function mW(t,n){let e=il(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),ke(t,()=>t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function hW(t,n){let e=il(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return ke(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e)),ke(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)),e}function gW(t){return il(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function yW(t,n){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||n<=0){let r=`[${t}x${n}]`;throw new Error("Requested texture size "+r+" is invalid.")}if(t>e||n>e){let r=`[${t}x${n}]`,o=`[${e}x${e}]`;throw new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU "+o+".")}}function xW(t){return il(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function Ik(t,n,e,r,o,i,s){let a=t.getAttribLocation(n,e);return a===-1?!1:(ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),ke(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,i,s)),ke(t,()=>t.enableVertexAttribArray(a)),!0)}function Uhe(t,n,e){Ghe(t,e),ke(t,()=>t.activeTexture(t.TEXTURE0+e)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,n))}function vW(t,n,e){return il(t,()=>t.getUniformLocation(n,e),'uniform "'+e+'" not present in program.')}function bW(t,n,e){return t.getUniformLocation(n,e)}function wW(t,n,e,r){ke(t,()=>Uhe(t,n,r)),ke(t,()=>t.uniform1i(e,r))}function pC(t,n,e){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0))}function Ek(t,n){ke(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,n)),ke(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function Oy(t){let n=t.checkFramebufferStatus(t.FRAMEBUFFER);if(n!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+jhe(t,n))}function jhe(t,n){switch(n){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${n}`}}function il(t,n,e){let r=ke(t,()=>n());if(r==null)throw new Error(e);return r}function Ghe(t,n){let e=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=n+t.TEXTURE0;if(r<t.TEXTURE0||r>e){let o=`[gl.TEXTURE0, gl.TEXTURE${e}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Yc(t,n=2){return b.sizeFromShape(t.slice(0,t.length-n))}function Qc(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function fC(t){let n=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(n=[Yc(t),...Qc(t)]),n}function CW(t,n=!1){let e=H().getNumber("WEBGL_MAX_TEXTURE_SIZE");n&&(e=e*2,t=t.map((o,i)=>i>=t.length-2?b.nearestLargerEven(t[i]):t[i]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=b.squeezeShape(t).newShape);let r=b.sizeFromShape(t);if(t.length<=1&&r<=e)return[1,r];if(t.length===2&&t[0]<=e&&t[1]<=e)return t;if(t.length===3&&t[0]*t[1]<=e&&t[2]<=e)return[t[0]*t[1],t[2]];if(t.length===3&&t[0]<=e&&t[1]*t[2]<=e)return[t[0],t[1]*t[2]];if(t.length===4&&t[0]*t[1]*t[2]<=e&&t[3]<=e)return[t[0]*t[1]*t[2],t[3]];if(t.length===4&&t[0]<=e&&t[1]*t[2]*t[3]<=e)return[t[0],t[1]*t[2]*t[3]];if(n){let o=Yc(t),i=2,s=2;return t.length&&([i,s]=Qc(t)),r=o*(i/2)*(s/2),b.sizeToSquarishShape(r).map(a=>a*2)}return b.sizeToSquarishShape(r)}function uC(t){return t%2===0}function jd(t,n){if(t=t.slice(-2),n=n.slice(-2),b.arraysEqual(t,n)||!t.length||!n.length||t[0]===0||t[1]===0||n[0]===0||n[1]===0)return!0;if(t.length!==n.length){let e=t.slice(-1)[0],r=n.slice(-1)[0];if(e===r||uC(e)&&uC(r)&&(t[0]===1||n[0]===1))return!0}return t[1]===n[1]&&uC(t[0])&&uC(n[0])}var Ck,Sk;function SW(t){if(Ck==null){let n=_o(t);Ck=n.getParameter(n.MAX_TEXTURE_SIZE)}return Ck}function _W(t){if(Sk==null){let n=_o(t);Sk=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Sk)}function IW(t){if(t===0)return 0;let n,e=_o(t);return Io(e,"EXT_disjoint_timer_query_webgl2")&&t===2?n=2:Io(e,"EXT_disjoint_timer_query")?n=1:n=0,n}function Io(t,n){return t.getExtension(n)!=null}function Tk(t){try{if(_o(t)!=null)return!0}catch(n){return console.log("Error when getting WebGL context: ",n),!1}return!1}function EW(t){if(t===0)return!1;let n=_o(t);if(t===1){if(!Io(n,"OES_texture_float"))return!1}else if(!Io(n,"EXT_color_buffer_float"))return!1;return _k(n)}function TW(t){if(t===0)return!1;let n=_o(t);if(t===1){if(!Io(n,"OES_texture_float")||!Io(n,"WEBGL_color_buffer_float"))return!1}else{if(Io(n,"EXT_color_buffer_float"))return _k(n);let r="EXT_color_buffer_half_float";if(Io(n,r)){let o=n.getExtension(r);return Whe(n,o)}return!1}return _k(n)}function _k(t){let n=Ay(t),e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatFloat,1,1,0,n.textureFormatFloat,n.textureTypeFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0);let s=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(e),t.deleteFramebuffer(i),s}function Whe(t,n){let e=Ay(t,n),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatHalfFloat,1,1,0,e.textureFormatFloat,e.textureTypeHalfFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),a}function DW(t){return t!==2?!1:_o(t).fenceSync!=null}function ms(t,n){Array.isArray(t)||(t=[t]),t.forEach(e=>{e!=null&&b.assert(e.dtype!=="complex64",()=>`${n} does not support complex64 tensors in the WebGL backend.`)})}var Be=H();Be.registerFlag("HAS_WEBGL",()=>Be.getNumber("WEBGL_VERSION")>0);Be.registerFlag("WEBGL_VERSION",()=>Tk(2)?2:Tk(1)?1:0);Be.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Be.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Be.get("WEBGL_VERSION")===2);Be.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Be.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Be.registerFlag("WEBGL_PACK",()=>Be.getBool("HAS_WEBGL"));Be.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_CLIP",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_PACK_REDUCE",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_LAZILY_UNPACK",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_CONV_IM2COL",()=>Be.getBool("WEBGL_PACK"));Be.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>SW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>_W(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=Be.getNumber("WEBGL_VERSION");return t===0?0:IW(t)});Be.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Be.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Rc.isMobile());Be.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>EW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Be.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Be.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Be.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>TW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_FENCE_API_ENABLED",()=>DW(Be.getNumber("WEBGL_VERSION")));Be.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Be.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Be.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Be.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>Rc.isMobile()&&Be.getBool("IS_CHROME")?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});function Jt(){let t,n,e,r,o,i,s,a,l,c;return H().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",n="in",e="out",r="in",o="texture",i="outputColor",s="out vec4 outputColor;",a=`
      bool isnan_custom(float val) {
        return (val > 0.0 || val < 0.0) ? false : val != 0.0;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `,l="",c=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",n="attribute",e="varying",r="varying",o="texture2D",i="gl_FragColor",s="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,c=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:n,varyingVs:e,varyingFs:r,texture2D:o,output:i,defineOutput:s,defineSpecialNaN:a,defineSpecialInf:l,defineRound:c}}function Ri(t,n,e="index"){let r=b.computeStrides(n);return r.map((o,i)=>{let s=`int ${t[i]} = ${e} / ${o}`,a=i===r.length-1?`int ${t[i+1]} = ${e} - ${t[i]} * ${o}`:`index -= ${t[i]} * ${o}`;return`${s}; ${a};`}).join("")}function Pm(t){let n=b.computeStrides(t).map(e=>e.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${n[0]} + coords.y * ${n[1]} + coords.z;
  }
`}var hC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var gC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=zd.DENSE;let e=Xc(n),r=Jt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Ri(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var yC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=zd.DENSE;let e=Xc(n),r=Jt();this.outputShape=n,this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${Ri(["r","c","d"],n)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx *
          vec2(${e[0]}, ${e[1]}));
        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var xC=class{constructor(n){this.variableNames=["A"],this.outTexUsage=dr.DOWNLOAD;let e=Jt();this.outputShape=n,this.userCode=`
      ${hC}

      void main() {
        float x = getAAtOutCoords();
        ${e.output} = encode_float(x);
      }
    `}};var vC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=dr.DOWNLOAD;let e=Jt();this.outputShape=n,this.userCode=`
      ${hC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${e.output} = encode_float(x);
      }
    `}};var bC=class{constructor(n,e,r=!1){this.variableNames=["A"];let o=Jt(),[i,s]=e;this.outputShape=n;let a="result";r&&(a="floor(result * 255. + 0.5)"),this.userCode=`
      ${Pm(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        int flatIndex = getFlatIndex(coords);
        int offset = imod(flatIndex, 4);

        flatIndex = idiv(flatIndex, 4, 1.);

        int r = flatIndex / ${s};
        int c = imod(flatIndex, ${s});
        vec2 uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
        vec4 values = ${o.texture2D}(A, uv);

        float result;

        if(offset == 0) {
          result = values[0];
        } else if(offset == 1) {
          result = values[1];
        } else if(offset == 2) {
          result = values[2];
        } else {
          result = values[3];
        }

        ${o.output} = vec4(${a}, 0., 0., 0.);
      }
    `}};var wC=class{constructor(n,e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let o=Jt(),[i,s]=e;this.outputShape=n;let a="",l="result";r&&(l="floor(result * 255. + 0.5)");for(let c=0;c<=1;c++)for(let u=0;u<=1;u++){let d=c*2+u;a+=`
          localCoords = coords;
          if(localCoords[2] + ${u} < ${n[2]}) {
            localCoords[2] += ${u};
            if(localCoords[1] + ${c} < ${n[1]}) {
              localCoords[1] += ${c};

              flatIndex = getFlatIndex(localCoords);
              offset = imod(flatIndex, 4);

              flatIndex = idiv(flatIndex, 4, 1.);

              r = flatIndex / ${s};
              c = imod(flatIndex, ${s});
              uv = (vec2(c, r) + halfCR) / vec2(${s}.0, ${i}.0);
              values = ${o.texture2D}(A, uv);

              if(offset == 0) {
                result[${d}] = values[0];
              } else if(offset == 1) {
                result[${d}] = values[1];
              } else if(offset == 2) {
                result[${d}] = values[2];
              } else {
                result[${d}] = values[3];
              }
            }
          }
        `}this.userCode=`
      ${Pm(n)}

      void main() {
        ivec3 coords = getOutputCoords();

        vec4 result = vec4(0.);
        int flatIndex, r, c, offset;
        ivec3 localCoords;
        vec2 uv;
        vec4 values;

        ${a}

        ${o.output} = ${l};
      }
    `}};function NW(t){let n=Jt(),e=`${n.version}
    precision highp float;
    ${n.attribute} vec3 clipSpacePos;
    ${n.attribute} vec2 uv;
    ${n.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return uW(t,e)}function kW(t){let n=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return mW(t,n)}function AW(t){let n=new Uint16Array([0,1,2,2,1,3]);return hW(t,n)}function My(t,n,e,r,o,i){yW(n,e);let s=gW(t),a=t.TEXTURE_2D;return ke(t,()=>t.bindTexture(a,s)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),ke(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),ke(t,()=>t.texImage2D(a,0,r,n,e,0,o,i,null)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null)),s}function Dk(t){return t.internalFormatFloat}function RW(t,n,e,r){let[o,i]=Ud(n,e);return My(t,o,i,Dk(r),r.textureFormatFloat,t.FLOAT)}function Nk(t){return t.internalFormatHalfFloat}function OW(t,n,e,r){let[o,i]=Ud(n,e);return My(t,o,i,Nk(r),r.textureFormatFloat,r.textureTypeHalfFloat)}function kk(t){return t.downloadTextureFormat}function MW(t,n,e,r){let[o,i]=Ud(n,e);return My(t,o,i,kk(r),t.RGBA,t.UNSIGNED_BYTE)}function Ak(t){return t.internalFormatPackedFloat}function FW(t,n,e,r){let[o,i]=fs(n,e);return My(t,o,i,Ak(r),t.RGBA,t.FLOAT)}function Rk(t){return t.internalFormatPackedHalfFloat}function PW(t,n,e,r){let[o,i]=fs(n,e);return My(t,o,i,Rk(r),t.RGBA,r.textureTypeHalfFloat)}function $W(t,n,e){return ke(t,()=>t.bindBuffer(t.ARRAY_BUFFER,e)),Ik(t,n,"clipSpacePos",e,3,20,0)&&Ik(t,n,"uv",e,2,20,12)}function LW(t,n,e,r,o,i){ke(t,()=>t.bindTexture(t.TEXTURE_2D,n));let s,a,l;o instanceof Uint8Array?(s=new Uint8Array(e*r*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(s=new Float32Array(e*r*4),a=t.FLOAT,l=i.internalFormatPackedFloat),s.set(o),ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,e,r,0,t.RGBA,a,s)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function VW(t,n,e){ke(t,()=>t.bindTexture(t.TEXTURE_2D,n)),e.data instanceof Uint8Array?ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,e.data)):ke(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)),ke(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function BW(t,n,e,r){let o=t.createBuffer();ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*n*e;return ke(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),ke(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,0)),ke(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function zW(t,n,e){let r=t,o=new Float32Array(e);return r.bindBuffer(r.PIXEL_PACK_BUFFER,n),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function UW(t,n,e,r){let[o,i]=Ud(n,e),s=4,a=new Uint8Array(aW(n*e,s));return ke(t,()=>t.readPixels(0,0,o,i,r.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function jW(t,n,e,r,o,i,s,a){let l=t,c=new Float32Array(lW(i,s));return l.bindBuffer(l.PIXEL_PACK_BUFFER,n),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,c),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),c}function GW(t,n,e){let r=new Float32Array(n*e*4);return ke(t,()=>t.readPixels(0,0,e,n,t.RGBA,t.FLOAT,r)),r}var CC=class{constructor(n){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];let e=H().getNumber("WEBGL_VERSION");n!=null?(this.gl=n,sW(e,n)):this.gl=_o(e);let r="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(H().getNumber("WEBGL_VERSION")===1){let i="OES_texture_float",s="OES_texture_half_float";if(this.textureFloatExtension=Ry(this.gl,i),Io(this.gl,s))this.textureHalfFloatExtension=Ry(this.gl,s);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),Io(this.gl,o))this.colorBufferHalfFloatExtension=Ry(this.gl,o);else if(H().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",Io(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else if(Io(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=kW(this.gl),this.indexBuffer=AW(this.gl),this.framebuffer=xW(this.gl),this.textureConfig=Ay(this.gl,this.textureHalfFloatExtension)}get debug(){return H().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let n=this.gl;ke(n,()=>n.finish()),ke(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,null)),ke(n,()=>n.deleteFramebuffer(this.framebuffer)),ke(n,()=>n.bindBuffer(n.ARRAY_BUFFER,null)),ke(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null)),ke(n,()=>n.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(n,e){return this.throwIfDisposed(),RW(this.gl,n,e,this.textureConfig)}createFloat16MatrixTexture(n,e){return this.throwIfDisposed(),OW(this.gl,n,e,this.textureConfig)}createUnsignedBytesMatrixTexture(n,e){return this.throwIfDisposed(),MW(this.gl,n,e,this.textureConfig)}uploadPixelDataToTexture(n,e){this.throwIfDisposed(),VW(this.gl,n,e)}uploadDenseMatrixToTexture(n,e,r,o){this.throwIfDisposed(),LW(this.gl,n,e,r,o,this.textureConfig)}createFloat16PackedMatrixTexture(n,e){return this.throwIfDisposed(),PW(this.gl,n,e,this.textureConfig)}createPackedMatrixTexture(n,e){return this.throwIfDisposed(),FW(this.gl,n,e,this.textureConfig)}deleteMatrixTexture(n){this.throwIfDisposed(),this.outputTexture===n&&(Ek(this.gl,this.framebuffer),this.outputTexture=null),ke(this.gl,()=>this.gl.deleteTexture(n))}downloadByteEncodedFloatMatrixFromOutputTexture(n,e,r){return this.downloadMatrixDriver(n,()=>UW(this.gl,e,r,this.textureConfig))}downloadPackedMatrixFromBuffer(n,e,r,o,i,s){return jW(this.gl,n,e,r,o,i,s,this.textureConfig)}downloadFloat32MatrixFromBuffer(n,e){return zW(this.gl,n,e)}createBufferFromTexture(n,e,r){this.bindTextureToFrameBuffer(n);let o=BW(this.gl,e,r,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let n=this.createFence(this.gl);return this.pollFence(n)}createFence(n){let e,r;if(H().getBool("WEBGL_FENCE_API_ENABLED")){let o=n,i=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);n.flush(),r=()=>{let s=o.clientWaitSync(i,0,0);return s===o.ALREADY_SIGNALED||s===o.CONDITION_SATISFIED},e=i}else H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),r=()=>this.isQueryAvailable(e,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):r=()=>!0;return{query:e,isFencePassed:r}}downloadMatrixFromPackedTexture(n,e,r){return this.downloadMatrixDriver(n,()=>GW(this.gl,e,r))}createProgram(n){this.throwIfDisposed();let e=this.gl,r=dW(e,n);this.vertexShader==null&&(this.vertexShader=NW(e));let o=pW(e);return ke(e,()=>e.attachShader(o,this.vertexShader)),ke(e,()=>e.attachShader(o,r)),fW(e,o),this.debug&&dC(e,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=$W(e,this.program,this.vertexBuffer)),o}deleteProgram(n){this.throwIfDisposed(),n===this.program&&(this.program=null),n!=null&&ke(this.gl,()=>this.gl.deleteProgram(n))}setProgram(n){this.throwIfDisposed(),this.program=n,this.program!=null&&this.debug&&dC(this.gl,this.program),ke(this.gl,()=>this.gl.useProgram(n))}getUniformLocation(n,e,r=!0){return this.throwIfDisposed(),r?vW(this.gl,n,e):bW(this.gl,n,e)}getAttributeLocation(n,e){return this.throwIfDisposed(),ke(this.gl,()=>this.gl.getAttribLocation(n,e))}getUniformLocationNoThrow(n,e){return this.throwIfDisposed(),this.gl.getUniformLocation(n,e)}setInputMatrixTexture(n,e,r){this.throwIfDisposed(),this.throwIfNoProgram(),wW(this.gl,n,e,r)}setOutputMatrixTexture(n,e,r){this.setOutputMatrixTextureDriver(n,r,e)}setOutputPackedMatrixTexture(n,e,r){this.throwIfDisposed();let[o,i]=fs(e,r);this.setOutputMatrixTextureDriver(n,o,i)}setOutputMatrixWriteRegion(n,e,r,o){this.setOutputMatrixWriteRegionDriver(r,n,o,e)}setOutputPackedMatrixWriteRegion(n,e,r,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&dC(this.gl,this.program),Oy(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let n=this.gl;this.debug&&this.debugValidate(),ke(n,()=>n.drawElements(n.TRIANGLES,6,n.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),ke(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Ry(this.gl,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.createQuery();return r.beginQuery(o.TIME_ELAPSED_EXT,i),i}let n=this.getQueryTimerExtensionWebGL1(),e=n.createQueryEXT();return n.beginQueryEXT(n.TIME_ELAPSED_EXT,e),e}endQuery(){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let e=this.gl,r=this.getQueryTimerExtensionWebGL2();e.endQuery(r.TIME_ELAPSED_EXT);return}let n=this.getQueryTimerExtensionWebGL1();n.endQueryEXT(n.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(n){return await b.repeatedTry(()=>this.disposed||this.isQueryAvailable(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(n,H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(n,e){if(e===0)return null;if(e===2){let r=this.gl;return r.getQueryParameter(n,r.QUERY_RESULT)/1e6}else{let r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(n,e){if(e===0)return!0;if(e===2){let r=this.gl,o=this.getQueryTimerExtensionWebGL2(),i=r.getQueryParameter(n,r.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),i&&!this.disjoint}else{let r=this.getQueryTimerExtensionWebGL1(),o=r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(n){return new Promise(e=>{this.addItemToPoll(()=>n.isFencePassed(),()=>e())})}pollItems(){let n=qhe(this.itemsToPoll.map(e=>e.isDoneFn));for(let e=0;e<=n;++e){let{resolveFn:r}=this.itemsToPoll[e];r()}this.itemsToPoll=this.itemsToPoll.slice(n+1)}addItemToPoll(n,e){this.itemsToPoll.push({isDoneFn:n,resolveFn:e}),!(this.itemsToPoll.length>1)&&b.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0))}bindTextureToFrameBuffer(n){this.throwIfDisposed(),pC(this.gl,n,this.framebuffer),this.debug&&Oy(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(pC(this.gl,this.outputTexture,this.framebuffer),this.debug&&Oy(this.gl)):Ek(this.gl,this.framebuffer)}downloadMatrixDriver(n,e){this.bindTextureToFrameBuffer(n);let r=e();return this.unbindTextureToFrameBuffer(),r}setOutputMatrixTextureDriver(n,e,r){this.throwIfDisposed();let o=this.gl;pC(o,n,this.framebuffer),this.debug&&Oy(o),this.outputTexture=n,ke(o,()=>o.viewport(0,0,e,r)),ke(o,()=>o.scissor(0,0,e,r))}setOutputMatrixWriteRegionDriver(n,e,r,o){this.throwIfDisposed(),ke(this.gl,()=>this.gl.scissor(n,e,r,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function qhe(t){let n=0;for(;n<t.length&&t[n]();++n);return n-1}var{getBroadcastDims:WW}=T;function HW(t,n,e,r){let o=[];t.forEach(m=>{let h=b.sizeFromShape(m.shapeInfo.logicalShape);m.shapeInfo.isUniform?o.push(`uniform float ${m.name}${h>1?`[${h}]`:""};`):(o.push(`uniform sampler2D ${m.name};`),o.push(`uniform int offset${m.name};`))});let i=o.join(`
`),s=t.map(m=>Khe(m,n,r)).join(`
`),a=n.texShape,l=Jt(),c=Qhe(l),u,d,p=ege(l);return n.isPacked?(u=Xhe(n.logicalShape,a),d=Jhe(l)):(u=Yhe(n.logicalShape,a),d=Zhe(l)),r&&(p+=oge),[p,c,d,i,u,s,e].join(`
`)}function Lm(t){let n=t.shapeInfo.logicalShape;switch(n.length){case 0:return gge(t);case 1:return xge(t);case 2:return bge(t);case 3:return Cge(t);case 4:return _ge(t);case 5:return Ige(t);case 6:return Ege(t);default:throw new Error(`${n.length}-D input sampling is not yet supported`)}}function qW(t){switch(t.shapeInfo.logicalShape.length){case 0:return hge(t);case 1:return yge(t);case 2:return vge(t);case 3:return wge(t);default:return Sge(t)}}function Khe(t,n,e=!1){let r="";e?r+=qW(t):r+=Lm(t);let o=t.shapeInfo.logicalShape,i=n.logicalShape;return o.length<=i.length&&(e?r+=Tge(t,n):r+=Dge(t,n)),r}function Xhe(t,n){switch(t.length){case 0:return KW();case 1:return ige(t,n);case 2:return fge(t,n);case 3:return age(t,n);default:return cge(t,n)}}function Yhe(t,n){switch(t.length){case 0:return KW();case 1:return sge(t,n);case 2:return mge(t,n);case 3:return lge(t,n);case 4:return uge(t,n);case 5:return dge(t,n);case 6:return pge(t,n);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Qhe(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Zhe(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Jhe(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function ege(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${tge}
    ${nge}
    ${rge}
  `}var tge=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,nge=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,rge=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,oge=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function KW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function ige(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];return e[0]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${e[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return 2 * (resTexRC.x * ${e[1]} + resTexRC.y);
    }
  `}function sge(t,n){return n[0]===1?`
      int getOutputCoords() {
        return int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?`
      int getOutputCoords() {
        return int(resultUV.y * ${n[0]}.0);
      }
    `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return resTexRC.x * ${n[1]} + resTexRC.y;
    }
  `}function age(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[2]/2),o=r*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function lge(t,n){let e=Ri(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec3(r, c, d);
    }
  `}function cge(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),i=o,s="",a="b, r, c";for(let l=2;l<t.length-1;l++)i*=t[t.length-l-1],s=`
      int b${l} = index / ${i};
      index -= b${l} * ${i};
    `+s,a=`b${l}, `+a;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${s}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${t.length}(${a});
    }
  `}function uge(t,n){let e=Ri(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      ${e}
      return ivec4(r, c, d, d2);
    }
  `}function dge(t,n){let e=Ri(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${n[0]},
                             ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function pge(t,n){let e=Ri(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${e}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function fge(t,n){let e=[Math.ceil(n[0]/2),Math.ceil(n[1]/2)];if(b.arraysEqual(t,n))return`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `;let r=Math.ceil(t[1]/2);return`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function mge(t,n){return b.arraysEqual(t,n)?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `:t[1]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${n[0]}, ${n[1]}));
        int index = resTexRC.x * ${n[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Gd(t){return`offset${t}`}function hge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=Jt();return`
    vec4 ${e}() {
      return ${r.texture2D}(${n}, halfCR);
    }
  `}function gge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`float ${e}() {return ${n};}`;let[r,o]=t.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${e}() {
        return sampleTexture(${n}, halfCR);
      }
    `;let[i,s]=t.shapeInfo.texShape,a=Gd(n);return`
    float ${e}() {
      vec2 uv = uvFromFlat(${i}, ${s}, ${a});
      return sampleTexture(${n}, uv);
    }
  `}function yge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=Jt();return`
    vec4 ${e}(int index) {
      vec2 uv = packedUVfrom1D(
        ${o[0]}, ${o[1]}, index);
      return ${i.texture2D}(${n}, uv);
    }
  `}function xge(t){let n=t.name,e="get"+n.charAt(0).toUpperCase()+n.slice(1);if(t.shapeInfo.isUniform)return`
      float ${e}(int index) {
        ${Vm(t)}
      }
    `;let r=t.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${e}(int index) {
        return sampleTexture(${n}, halfCR);
      }
    `;let s=Gd(n);return i===1?`
      float ${e}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${s}) + 0.5) / ${o}.0);
        return sampleTexture(${n}, uv);
      }
    `:o===1?`
      float ${e}(int index) {
        vec2 uv = vec2((float(index + ${s}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${e}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${s});
      return sampleTexture(${n}, uv);
    }
  `}function vge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=o[0],s=o[1],a=Jt();if(o!=null&&b.arraysEqual(n,o))return`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}.0, ${i}.0);

        return ${a.texture2D}(${e}, uv);
      }
    `;let l=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],c=Math.ceil(n[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${l[0]}, ${l[1]}, row, col);
      return ${a.texture2D}(${e}, uv);
    }
  `}function bge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape;if(o!=null&&b.arraysEqual(n,o)){let d=o[0],p=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${p}.0, ${d}.0);
      return sampleTexture(${e}, uv);
    }
  `}let{newShape:i,keptDims:s}=b.squeezeShape(n),a=i;if(a.length<n.length){let d=Bm(t,a),p=["row","col"];return`
      ${Lm(d)}
      float ${r}(int row, int col) {
        return ${r}(${zm(p,s)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${n[1]}, 1)));
        ${Vm(t)}
      }
    `;let l=o[0],c=o[1],u=Gd(e);return c===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${l}.0);
      return sampleTexture(${e}, uv);
    }
  `:l===1?`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${u}), vec3(${n[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${e}, uv);
    }
  `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${n[1]} + col + ${u};
    vec2 uv = uvFromFlat(${l}, ${c}, index);
    return sampleTexture(${e}, uv);
  }
`}function wge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=t.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(n[0]===1){let d=n.slice(1),p=[1,2],f=Bm(t,d),m=["b","row","col"];return`
        ${qW(f)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${zm(m,p)});
        }
      `}let s=i[0],a=i[1],l=Math.ceil(n[2]/2),c=l*Math.ceil(n[1]/2),u=Jt();return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${s}, ${a}, ${c}, ${l}, b, row, col);
      return ${u.texture2D}(${e}, uv);
    }
  `}function Cge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[1]*n[2],i=n[2],{newShape:s,keptDims:a}=b.squeezeShape(n),l=s;if(l.length<n.length){let m=Bm(t,l),h=["row","col","depth"];return`
        ${Lm(m)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${zm(h,a)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Vm(t)}
      }
    `;let c=t.shapeInfo.texShape,u=c[0],d=c[1],p=t.shapeInfo.flatOffset;if(d===o&&p==null)return`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${d}.0, ${u}.0);
          return sampleTexture(${e}, uv);
        }
      `;if(d===i&&p==null)return`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${n[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}.0, ${u}.0);
      return sampleTexture(${e}, uv);
    }
  `;let f=Gd(e);return`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${f};
        vec2 uv = uvFromFlat(${u}, ${d}, index);
        return sampleTexture(${e}, uv);
      }
  `}function Sge(t){let n=t.shapeInfo.logicalShape,e=n.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),i=t.shapeInfo.texShape,s=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],a=s[0],l=s[1],c=Math.ceil(n[e-1]/2),u=c*Math.ceil(n[e-2]/2),d="int b, int row, int col",p=`b * ${u} + (row / 2) * ${c} + (col / 2)`;for(let m=2;m<e-1;m++)d=`int b${m}, `+d,u*=n[e-m-1],p=`b${m} * ${u} + `+p;let f=Jt();return`
    vec4 ${o}(${d}) {
      int index = ${p};
      int texR = index / ${l};
      int texC = index - texR * ${l};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${l}, ${a});
      return ${f.texture2D}(${r}, uv);
    }
  `}function _ge(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[3],i=n[2]*o,s=n[1]*i,{newShape:a,keptDims:l}=b.squeezeShape(n);if(a.length<n.length){let m=Bm(t,a),h=["row","col","depth","depth2"];return`
      ${Lm(m)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${zm(h,l)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${s}, ${i}, ${o}, 1)));
        ${Vm(t)}
      }
    `;let c=t.shapeInfo.flatOffset,u=t.shapeInfo.texShape,d=u[0],p=u[1];if(p===s&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(p===o&&c==null)return`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n[1]*n[2]}, ${n[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${p}.0, ${d}.0);
        return sampleTexture(${e}, uv);
      }
    `;let f=Gd(e);return`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${s} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${d}, ${p}, index + ${f});
      return sampleTexture(${e}, uv);
    }
  `}function Ige(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),o=n[4],i=n[3]*o,s=n[2]*i,a=n[1]*s,{newShape:l,keptDims:c}=b.squeezeShape(n);if(l.length<n.length){let h=Bm(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Lm(h)}
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        return ${r}(${zm(g,c)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${s}, ${i}, ${o})) +
          depth3;
        ${Vm(t)}
      }
    `;let u=t.shapeInfo.flatOffset,d=t.shapeInfo.texShape,p=d[0],f=d[1];if(f===a&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${s}, ${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(f===o&&u==null)return`
      float ${r}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]},
               ${n[2]*n[3]}, ${n[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${f}.0, ${p}.0);
        return sampleTexture(${e}, uv);
      }
    `;let m=Gd(e);return`
    float ${r}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${s} + depth * ${i} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${p}, ${f}, index);
      return sampleTexture(${e}, uv);
    }
  `}function Ege(t){let n=t.shapeInfo.logicalShape,e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),{newShape:o,keptDims:i}=b.squeezeShape(n);if(o.length<n.length){let g=Bm(t,o),y=["row","col","depth","depth2","depth3","depth4"];return`
      ${Lm(g)}
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${r}(${zm(y,i)});
      }
    `}let s=n[5],a=n[4]*s,l=n[3]*a,c=n[2]*l,u=n[1]*c;if(t.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${u}, ${c}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${s}, 1)));
        ${Vm(t)}
      }
    `;let d=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],m=p[1];if(m===u&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${c}, ${l}, ${a}, ${s})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;if(m===s&&d==null)return`
      float ${r}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${n[1]*n[2]*n[3]*n[4]},
               ${n[2]*n[3]*n[4]},
               ${n[3]*n[4]},
               ${n[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${f}.0);
        return sampleTexture(${e}, uv);
      }
    `;let h=Gd(e);return`
    float ${r}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${u} + col * ${c} + depth * ${l} +
          depth2 * ${a} + depth3 * ${s} + depth4 + ${h};
      vec2 uv = uvFromFlat(${f}, ${m}, index);
      return sampleTexture(${e}, uv);
    }
  `}function Vm(t){let n=t.name,e=b.sizeFromShape(t.shapeInfo.logicalShape);return e<2?`return ${n};`:`
    for (int i = 0; i < ${e}; i++) {
      if (i == index) {
        return ${n}[i];
      }
    }
  `}function Tge(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=n.logicalShape.length,a=WW(t.shapeInfo.logicalShape,n.logicalShape),l=je(s),c=s-i,u,d=["x","y","z","w","u","v"];i===0?u="":s<2&&a.length>=1?u="coords = 0;":u=a.map(v=>`coords.${d[v+c]} = 0;`).join(`
`);let p="";s<2&&i>0?p="coords":p=t.shapeInfo.logicalShape.map((v,S)=>`coords.${d[S+c]}`).join(", ");let f="return outputValue;",h=b.sizeFromShape(t.shapeInfo.logicalShape)===1,y=b.sizeFromShape(n.logicalShape)===1;if(i===1&&!h&&!y)f=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!y)s===1?f=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:f=`
        return vec4(outputValue.x);
      `;else if(a.length){let v=i-2,S=i-1;a.indexOf(v)>-1&&a.indexOf(S)>-1?f="return vec4(outputValue.x);":a.indexOf(v)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(S)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${u}
      vec4 outputValue = get${r}(${p});
      ${f}
    }
  `}function Dge(t,n){let e=t.name,r=e.charAt(0).toUpperCase()+e.slice(1),o="get"+r+"AtOutCoords",i=n.texShape,s=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=n.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&b.arraysEqual(s,i))return`
      float ${o}() {
        return sampleTexture(${e}, resultUV);
      }
    `;let c=je(l),u=WW(t.shapeInfo.logicalShape,n.logicalShape),d=l-a,p,f=["x","y","z","w","u","v"];a===0?p="":l<2&&u.length>=1?p="coords = 0;":p=u.map(h=>`coords.${f[h+d]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,g)=>`coords.${f[g+d]}`).join(", "),`
    float ${o}() {
      ${c} coords = getOutputCoords();
      ${p}
      return get${r}(${m});
    }
  `}function je(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function Bm(t,n){let e=JSON.parse(JSON.stringify(t));return e.shapeInfo.logicalShape=n,e}function zm(t,n){return n.map(e=>t[e]).join(", ")}function YW(t,n,e,r){let o=n.userCode,i=e.map((f,m)=>{let h={logicalShape:f.shape,texShape:f.isUniform?null:f.texData.texShape,isUniform:f.isUniform,isPacked:f.isUniform?!1:f.texData.isPacked,flatOffset:null};return f.texData!=null&&f.texData.slice!=null&&f.texData.slice.flatOffset>0&&(h.flatOffset=f.texData.slice.flatOffset),{name:n.variableNames[m],shapeInfo:h}}),s=i.map(f=>f.shapeInfo),a={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},l=HW(i,a,o,n.packedInputs),c=t.createProgram(l),u=null,d=t.getUniformLocation(c,"NAN",!1);H().getNumber("WEBGL_VERSION")===1&&(u=t.getUniformLocation(c,"INFINITY",!1));let p={};for(let f=0;f<n.variableNames.length;f++){let m=n.variableNames[f],h=!1;p[m]=t.getUniformLocation(c,m,h),p[`offset${m}`]=t.getUniformLocation(c,`offset${m}`,h)}return{program:n,source:l,webGLProgram:c,uniformLocations:p,inShapeInfos:s,outShapeInfo:a,infLoc:u,nanLoc:d}}function XW(t,n){if(t.length!==n.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${n.length} inputs`);t.forEach((e,r)=>{let o=e.logicalShape,i=n[r],s=i.shape;if(!b.arraysEqual(o,s))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${s} must match`);if(e.isUniform&&i.isUniform)return;let a=e.texShape,l=i.isUniform?null:i.texData.texShape;if(!b.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function QW(t,n,e,r,o){XW(n.inShapeInfos,e),XW([n.outShapeInfo],[r]);let i=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(i,s[0],s[1]):t.setOutputMatrixTexture(i,s[0],s[1]),t.setProgram(n.webGLProgram),H().getNumber("WEBGL_VERSION")===1&&n.infLoc!==null&&t.gl.uniform1f(n.infLoc,1/0),n.nanLoc!==null&&t.gl.uniform1f(n.nanLoc,NaN),e.forEach((a,l)=>{let c=n.program.variableNames[l],u=n.uniformLocations[c],d=n.uniformLocations[`offset${c}`];if(u!=null){if(a.isUniform){if(b.sizeFromShape(a.shape)<2)t.gl.uniform1f(u,a.uniformValues[0]);else{let p=a.uniformValues;p instanceof Float32Array||(p=new Float32Array(p)),t.gl.uniform1fv(u,p)}return}a.texData.slice!=null&&d!=null&&t.gl.uniform1i(d,a.texData.slice.flatOffset),t.setInputMatrixTexture(a.texData.texture,u,l)}}),o?.(t,n.webGLProgram),t.executeProgram()}function ZW(t,n,e){let r="";n.concat(e).forEach(s=>{let a=s.texData!=null&&s.texData.slice!=null&&s.texData.slice.flatOffset>0,l=s.isUniform?"uniform":s.texData.texShape;r+=`${s.shape}_${l}_${a}`});let o=t.userCode,i=t.constructor.name;return i+="_"+r+"_"+o,i}var{addImpl:JW,bincountImpl:SC,bincountReduceImpl:eH,ceilImpl:tH,concatImpl:nH,expImpl:rH,expm1Impl:oH,floorImpl:iH,gatherV2Impl:sH,greaterImpl:aH,lessImpl:lH,linSpaceImpl:cH,logImpl:uH,maxImpl:dH,maximumImpl:pH,minimumImpl:fH,multiplyImpl:mH,negImpl:hH,prodImpl:gH,rangeImpl:yH,rsqrtImpl:xH,simpleAbsImpl:_C,sliceImpl:vH,sparseFillEmptyRowsImpl:bH,sparseReshapeImpl:wH,stridedSliceImpl:CH,subImpl:SH,tileImpl:_H,topKImpl:IH,transposeImpl:Wd,uniqueImpl:EH}=JN;function Ok(t,n){return["x","y","z","w","u","v"].slice(0,n).map(e=>`${t}.${e}`)}function cn(t,n){return n===1?[t]:Ok(t,n)}function TH(t,n){if(t===1)return"rc";let e="";for(let r=0;r<t;r++)e+=n[r],r<t-1&&(e+=",");return e}var IC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=n;let e=n.length;if(e===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=cn("rc",e),o=je(e),i=Rge(e,n,r),s=Oge(e,n[n.length-1],n[n.length-2],r),a=Mge(n,r);this.userCode=`
        void main() {
          ${o} rc = getOutputCoords();

          if(${i}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${a}));
          }
        }
      `}}};function Age(t,n){let e=[];for(let r=0;r<=1;r++)for(let o=0;o<=1;o++){let i=`${r===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let s=2;s<t;s++)i=`${n[n.length-1-s]},`+i;e.push(i)}return e}function Rge(t,n,e){if(t===1)return`rc > ${n[0]}`;let r="";for(let o=t-2;o<t;o++)r+=`${e[o]} >= ${n[o]}`,o<t-1&&(r+="||");return r}function Oge(t,n,e,r){if(t===1)return"";let o=r.slice(-2);return`
    int r = ${o[0]};
    int c = ${o[1]};
    int rp1 = r + 1;
    int cp1 = c + 1;

    bool cEdge = cp1 >= ${n};
    bool rEdge = rp1 >= ${e};
  `}function Mge(t,n){let e=t.length,r=Age(e,n);return e===1?`getA(rc),
            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),
            0, 0`:`getA(${r[0]}),
          cEdge ? 0. : getA(${r[1]}),
          rEdge ? 0. : getA(${r[2]}),
          rEdge || cEdge ? 0. : getA(${r[3]})`}var Um=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let r="";for(let o=0;o<4;o++){let i="thisRC = rc;";o%2===1&&(i+="thisRC.z += 1;"),o>1&&(i+="thisRC.y += 1;"),r+=`
        ${i}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${Fge(e)}
      ${Pm(n)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${n[1]};
        int cols = ${n[2]};

        ${r}

        setOutput(result);
      }
    `}};function Fge(t){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${Ri(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var EC=class{constructor(n){this.gpgpu=n,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(n,e,r){let o=NH(e,r),i=kH(n,o,r);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);let s=DH(n,o,this.gpgpu.gl,this.gpgpu.textureConfig,r);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=s,this.log();let l=this.freeTextures[i].shift();return this.usedTextures[i].push(l),l}let a;return o===er.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(n[0],n[1]):o===er.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(n[0],n[1]):o===er.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(n[0],n[1]):o===er.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(n[0],n[1]):o===er.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(n[0],n[1])),this.usedTextures[i].push(a),this.numUsedTextures++,this._numBytesAllocated+=s,this.log(),a}releaseTexture(n,e,r,o){if(this.freeTextures==null)return;let i=NH(r,o),s=kH(e,i,o);s in this.freeTextures||(this.freeTextures[s]=[]);let a=DH(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=H().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(n),this._numBytesAllocated-=a):(this.freeTextures[s].push(n),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let c=this.usedTextures[s],u=c.indexOf(n);if(u<0)throw new Error("Cannot release a texture that was never provided by this texture manager");c.splice(u,1),this.log()}log(){if(!this.logEnabled)return;let n=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${n})`);let e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let n in this.freeTextures)this.freeTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});for(let n in this.usedTextures)this.usedTextures[n].forEach(e=>{this.gpgpu.deleteMatrixTexture(e)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function Pge(t,n){let e=t;if(n===e.R32F)return 4;if(n===e.R16F)return 2;if(n===e.RGBA32F)return 16;if(n===t.RGBA)return 16;if(n===e.RGBA16F)return 8;throw new Error(`Unknown internal format ${n}`)}function DH(t,n,e,r,o){let i=$ge(n,r),s;if(o){let[l,c]=fs(t[0],t[1]);s=l*c}else{let[l,c]=Ud(t[0],t[1]);s=l*c}let a=Pge(e,i);return s*a}function $ge(t,n){switch(t){case er.PACKED_2X2_FLOAT32:return Ak(n);case er.PACKED_2X2_FLOAT16:return Rk(n);case er.UNPACKED_FLOAT32:return Dk(n);case er.UNPACKED_FLOAT16:return Nk(n);case er.PACKED_4X1_UNSIGNED_BYTE:return kk(n);default:throw new Error(`Unknown physical texture type ${t}`)}}function Lge(t){return H().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?er.PACKED_2X2_FLOAT32:er.UNPACKED_FLOAT32:t?er.PACKED_2X2_FLOAT16:er.UNPACKED_FLOAT16}function NH(t,n){if(t===dr.UPLOAD)return er.PACKED_2X2_FLOAT32;if(t===dr.RENDER||t==null)return Lge(n);if(t===dr.DOWNLOAD||t===dr.PIXELS)return er.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function kH(t,n,e){return`${t[0]}_${t[1]}_${n}_${e}`}var wr=class{constructor(n,e){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      float unaryOperation(float x) {
        ${e}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Mn="if (isnan(x)) return x;",AH="return x;",Mk="return abs(x);";var RH="return (x >= 0.0) ? x : (exp(x) - 1.0);",OH=Mn+`
  return (x < 0.0) ? 0.0 : x;
`,MH=Mn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Fy="return x;",FH="return 1.0 / (1.0 + exp(-1.0 * x));";var $H="return x;",LH=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,VH=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,BH=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,zH="return 1.0 / (1.0 + exp(-1.0 * x));",oi=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${e}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var TC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=n;let e=n.length,r=cn("rc",e),o=je(e),i=TH(e,r),s=r.slice(-2),a=e<=1?"rc":`vec2(${s.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${i});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Bge=Qn.whereImpl,zge=1e-7,Uge=1e-4,DC={};function jge(t){return t in DC||(DC[t]={}),DC[t]}var Gge=128,Wge=600;function Hge(){return H().global.screen==null?1024:H().global.screen.height*H().global.screen.width*window.devicePixelRatio*Wge/1024/1024}var UH=(()=>{class t extends qs{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!H().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(e==null){let r=_o(H().getNumber("WEBGL_VERSION"));this.binaryCache=jge(H().getNumber("WEBGL_VERSION")),this.gpgpu=new CC(r),this.canvas=r.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=e,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=e.gl.canvas;this.textureManager=new EC(this.gpgpu),this.numMBBeforeWarning=Hge(),this.texData=new Gu(this,Ua())}nextDataId(){return t.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}write(e,r,o){if((H().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||H().getBool("DEBUG"))&&this.checkNumericalProblems(e),o==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let i={id:this.nextDataId()};return this.texData.set(i,{shape:r,dtype:o,values:e,usage:dr.UPLOAD,refCount:1}),i}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,o,i,s){if(H().getBool("DEBUG")&&this.checkNumericalProblems(r),i==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:o,dtype:i,values:r,usage:dr.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:o,dtype:i,complexTensorInfos:s,slice:a,shape:l,isPacked:c}=r;if(a!=null){let f;c?f=new oi(l,Fy):f=new wr(l,Fy);let m=this.runWebGLProgram(f,[{dataId:e,shape:l,dtype:i}],i),h=this.readSync(m.dataId);return this.disposeIntermediateTensorInfo(m),h}if(o!=null)return this.convertAndCacheOnCPU(e);if(i==="string")return o;let u=this.activeTimers!=null,d;u&&(d=b.now());let p;if(i==="complex64"){let f=this.readSync(s.real.dataId),m=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,m)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=b.now()-d),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let h=this.pendingRead.get(e);return new Promise(g=>h.push(g))}let r=this.texData.get(e),{values:o,shape:i,slice:s,dtype:a,complexTensorInfos:l,isPacked:c}=r;if(s!=null){let h;c?h=new oi(i,Fy):h=new wr(i,Fy);let g=this.runWebGLProgram(h,[{dataId:e,shape:i,dtype:a}],a),y=this.read(g.dataId);return this.disposeIntermediateTensorInfo(g),y}if(o!=null)return this.convertAndCacheOnCPU(e);if(!H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&H().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(a!=="complex64"&&H().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);let h=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(h.texture,...Xc(i))}this.pendingRead.set(e,[]),a!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(a==="complex64"){let h=await Promise.all([this.read(l.real.dataId),this.read(l.imag.dataId)]),g=h[0],y=h[1];p=T.mergeRealAndImagArrays(g,y)}else if(u==null)p=this.getValuesFromTexture(e);else{let h=b.sizeFromShape(i);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,h)}d!=null&&this.disposeIntermediateTensorInfo(d);let f=this.convertAndCacheOnCPU(e,p),m=this.pendingRead.get(e);return this.pendingRead.delete(e),m.forEach(h=>h(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Ua().removeDataId(e,this),this.pendingDeletes--),f}bufferSync(e){let r=this.readSync(e.dataId),o=r;if(e.dtype==="string")try{o=r.map(i=>b.decodeString(i))}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ie(e.shape,e.dtype,o)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let o=e[r];if(!cW(o))throw H().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${o} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${o} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:o,isPacked:i}=this.texData.get(e),s=b.sizeFromShape(r);if(H().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),m=this.texData.get(f.dataId),h=this.gpgpu.downloadMatrixFromPackedTexture(m.texture,...Xc(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),h}let a=H().getBool("WEBGL_PACK")&&i===!0,l=a?fC(r):r,c=a?new vC(l):new xC(l),u=this.runWebGLProgram(c,[{shape:l,dtype:o,dataId:e}],"float32"),d=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture,d.texShape[0],d.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}async time(e){let r=this.activeTimers,o=[],i=!1;this.programTimersStack==null?(this.programTimersStack=o,i=!0):this.activeTimers.push(o),this.activeTimers=o,e();let s=b.flatten(this.activeTimers.map(c=>c.query)).filter(c=>c!=null),a=b.flatten(this.activeTimers.map(c=>c.name)).filter(c=>c!=null);this.activeTimers=r,i&&(this.programTimersStack=null);let l={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let c=await Promise.all(s);l.kernelMs=b.sum(c),l.getExtraProfileInfo=()=>c.map((u,d)=>({name:a[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else l.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,l}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:b.now(),endMs:null}}endTimer(e){return H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=b.now(),e)}async getQueryTime(e){if(H().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:o}=this.texData.get(e);return o!=null&&(this.disposeData(o.real.dataId,r),this.disposeData(o.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:o,texShape:i,usage:s,isPacked:a,slice:l}=this.texData.get(e),c=l&&l.origDataId||e,u=this.dataRefCount.get(c);u>1?this.dataRefCount.set(c,u-1):(this.dataRefCount.delete(c),r!=null&&(this.numBytesInGPU-=this.computeBytes(i,o),this.textureManager.releaseTexture(r,i,s,a)));let d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=Gge){return H().getBool("WEBGL_CPU_FORWARD")&&e.every(o=>this.texData.get(o.dataId).texture==null&&b.sizeFromShape(o.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Bge(e.shape,r)}packedUnaryOp(e,r,o){let i=new oi(e.shape,r),s=this.compileAndRun(i,[e],o);return Ua().makeTensorFromDataId(s.dataId,s.shape,s.dtype)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let i=_C(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,i)}if(H().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Mk,e.dtype);let r=new wr(e.shape,Mk),o=this.compileAndRun(r,[e]);return Ua().makeTensorFromDataId(o.dataId,o.shape,o.dtype)}makeTensorInfo(e,r,o){let i;if(r==="string"&&o!=null&&o.length>0&&b.isString(o[0])){let s=o.map(a=>b.encodeString(a));i=this.write(s,e,r)}else i=this.write(o,e,r);return this.texData.get(i).usage=null,{dataId:i,shape:e,dtype:r}}makeOutput(e,r,o){let{dataId:i}=this.makeTensorInfo(e,r,o);return Ua().makeTensorFromDataId(i,e,r,this)}unpackTensor(e){let r=new TC(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new IC(e.shape);return this.runWebGLProgram(r,[e],e.dtype,null,!0)}packedReshape(e,r){let o=[Yc(e.shape),...Qc(e.shape)],i={dtype:e.dtype,shape:o,dataId:e.dataId},s=[Yc(r),...Qc(r)],a=new Um(s,o),c=this.runWebGLProgram(a,[i],e.dtype,null,!0);return{dataId:c.dataId,shape:r,dtype:c.dtype}}decode(e){let r=this.texData.get(e),{isPacked:o,shape:i,dtype:s}=r,a=fC(i),l;o?l=new yC(a):l=new gC(a);let u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],s,null,!0);return{dtype:s,shape:i,dataId:u.dataId}}runWebGLProgram(e,r,o,i,s=!1){let a=this.makeTensorInfo(e.outputShape,o),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===zd.DENSE){let y=Xc(e.outputShape);l.texShape=y.map(v=>v*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),b.sizeFromShape(a.shape)===0)return l.values=b.getTypedArrayFromDType(a.dtype,0),a;let c=[],u=r.map(y=>{if(y.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let v=this.texData.get(y.dataId);if(v.texture==null){if(!e.packedInputs&&b.sizeFromShape(y.shape)<=H().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:y.shape,texData:null,isUniform:!0,uniformValues:v.values};e.packedInputs&&(v.isPacked=!0,v.shape=y.shape)}else if(!!v.isPacked!=!!e.packedInputs)y=v.isPacked?this.unpackTensor(y):this.packTensor(y),c.push(y),v=this.texData.get(y.dataId);else if(v.isPacked&&!jd(v.shape,y.shape)){let S=y,C=y.shape;y.shape=v.shape,y=this.packedReshape(y,C),c.push(y),v=this.texData.get(y.dataId),S.shape=C}return this.uploadToGPU(y.dataId),{shape:y.shape,texData:v,isUniform:!1}});this.uploadToGPU(a.dataId);let d={shape:a.shape,texData:l,isUniform:!1},p=ZW(e,u,d),f=this.getAndSaveBinary(p,()=>YW(this.gpgpu,e,u,d)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),QW(this.gpgpu,f,u,d,i),c.forEach(y=>this.disposeIntermediateTensorInfo(y)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let g=H().get("WEBGL_FLUSH_THRESHOLD");if(g>0){let y=b.now();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!H().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let y=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),y}return a}compileAndRun(e,r,o,i,s=!1){return o=o||r[0].dtype,this.runWebGLProgram(e,r,o,i,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(H().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=z(()=>{if(!H().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=H().getBool("DEBUG");H().set("DEBUG",!1);let r=this.abs(Ae(1e-8)).dataSync()[0];if(H().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?zge:Uge}uploadToGPU(e){let r=this.texData.get(e),{shape:o,dtype:i,values:s,texture:a,usage:l,isPacked:c}=r;if(a!=null)return;let u=this.activeTimers!=null,d;u&&(d=b.now());let p=r.texShape;if(p==null&&(p=CW(o,c),r.texShape=p),s!=null){let f=fC(o),m,h=p[1],g=p[0],y=s instanceof Uint8Array;c?([h,g]=fs(p[0],p[1]),m=new wC(f,[g,h],y)):m=new bC(f,[g,h],y);let v=this.makeTensorInfo([g,h],i);y?this.texData.get(v.dataId).usage=dr.PIXELS:this.texData.get(v.dataId).usage=dr.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),h,g,s);let C=this.runWebGLProgram(m,[v],i,null,!0),I=this.texData.get(C.dataId);r.texture=I.texture,r.texShape=I.texShape,r.isPacked=I.isPacked,r.usage=I.usage,this.disposeIntermediateTensorInfo(v),this.texData.delete(C.dataId),r.values=null,u&&(this.uploadWaitMs+=b.now()-d)}else{let f=this.acquireTexture(p,l,i,c);r.texture=f}}convertAndCacheOnCPU(e,r){let o=this.texData.get(e),{dtype:i}=o;return this.releaseGPUData(e),r!=null&&(o.values=qge(r,i)),o.values}acquireTexture(e,r,o,i){if(this.numBytesInGPU+=this.computeBytes(e,o),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,i)}computeBytes(e,r){return e[0]*e[1]*b.bytesPerElement(r)}}return t.nextDataId=0,t})();function qge(t,n){if(n==="float32"||n==="complex64")return t;if(n==="int32"||n==="bool"){let e=n==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let r=0;r<e.length;++r)e[r]=Math.round(t[r]);return e}else throw new Error(`Unknown dtype ${n}`)}Rc.isBrowser()&&$b("webgl",()=>new UH,2);var NC=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var Eo=class{constructor(n,e,r){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOperation(float a, float b) {
        ${n}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var Zc=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;var ii=class{constructor(n,e,r,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(e,r);let i=this.outputShape.length,s="";if(o)if(i===0||b.sizeFromShape(this.outputShape)===1)s=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(s=`
          ${je(i)} coords = getOutputCoords();
        `,i===1)s+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=cn("coords",i);s+=`
            bool nextRowOutOfBounds =
              (${l[i-2]} + 1) >= ${this.outputShape[i-2]};
            bool nextColOutOfBounds =
              (${l[i-1]} + 1) >= ${this.outputShape[i-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${n}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${s}

        setOutput(result);
      }
    `}};function un(t){let{inputs:n,backend:e}=t,{x:r}=n;return e.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var jH={kernelName:ts,backendName:"webgl",kernelFunc:un};function Mr(t){let{inputs:n,backend:e}=t,{real:r,imag:o}=n,i=e.makeTensorInfo(r.shape,"complex64"),s=e.texData.get(i.dataId),a=un({inputs:{x:r},backend:e}),l=un({inputs:{x:o},backend:e});return s.complexTensorInfos={real:a,imag:l},i}var GH={kernelName:wf,backendName:"webgl",kernelFunc:Mr};var Fk="return (a < 0.) ? b * a : a;",Pk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Kge(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{alpha:i}=r,s=e.makeTensorInfo([],"float32",b.createScalarValue(i,"float32")),a=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(Pk,o.shape,s.shape):new Eo(Fk,o.shape,s.shape),l=e.runWebGLProgram(a,[o,s],o.dtype);return e.disposeIntermediateTensorInfo(s),l}var WH={kernelName:oc,backendName:"webgl",kernelFunc:Kge};var $k="return (a < 0.) ? b * a : a;",Lk=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Xge(t){let{inputs:n,backend:e}=t,{x:r,alpha:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(Lk,r.shape,o.shape):new Eo($k,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)}var HH={kernelName:yc,backendName:"webgl",kernelFunc:Xge};var kC="if (isnan(x)) return x;",qH=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`,KH=`
  result.r = isNaN.r > 0. ? NAN : result.r;
  result.g = isNaN.g > 0. ? NAN : result.g;
  result.b = isNaN.b > 0. ? NAN : result.b;
  result.a = isNaN.a > 0. ? NAN : result.a;
`;function be({opSnippet:t,packedOpSnippet:n,cpuKernelImpl:e,dtype:r}){return({inputs:o,backend:i})=>{let{x:s}=o,a=i,l=r||s.dtype;if(a.shouldExecuteOnCPU([s])&&e!=null){let d=a.texData.get(s.dataId),p=e(d.values,l);return a.makeTensorInfo(s.shape,l,p)}let c=H().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&n!=null,u;return c?u=new oi(s.shape,n):u=new wr(s.shape,t),a.runWebGLProgram(u,[s],l)}}function xt({opSnippet:t,packedOpSnippet:n,checkOutOfBounds:e=!1,supportsComplex:r=!1,cpuKernelImpl:o,dtype:i}){return({inputs:s,backend:a})=>{let{a:l,b:c}=s,u=a;if(r&&l.dtype==="complex64"){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,y]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(S=>{let[C,I]=S,E={dataId:C.dataId,dtype:C.dtype,shape:l.shape},D={dataId:I.dataId,dtype:I.dtype,shape:c.shape},O=new Eo(t,l.shape,c.shape);return u.runWebGLProgram(O,[E,D],Cn(C.dtype,I.dtype))}),v=Mr({inputs:{real:g,imag:y},backend:u});return u.disposeIntermediateTensorInfo(g),u.disposeIntermediateTensorInfo(y),v}let d=i||Cn(l.dtype,c.dtype);if(u.shouldExecuteOnCPU([l,c])&&o!=null){let m=u.texData.get(l.dataId),h=u.texData.get(c.dataId),[g,y]=o(l.shape,c.shape,m.values,h.values,d),v=u.makeTensorInfo(y,d),S=u.texData.get(v.dataId);return S.values=g,v}let p=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&n!=null,f;return p?f=new ii(n,l.shape,c.shape,e):f=new Eo(t,l.shape,c.shape),u.runWebGLProgram(f,[l,c],d)}}function Jc(t,n=!1){if(t==="linear")return n?$H:AH;if(t==="relu")return n?VH:OH;if(t==="elu")return n?LH:RH;if(t==="relu6")return n?BH:MH;if(t==="prelu")return n?Lk:$k;if(t==="leakyrelu")return n?Pk:Fk;if(t==="sigmoid")return n?zH:FH;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var jm=class{constructor(n,e,r,o=!1,i=!1,s=!1,a=null,l=!1,c=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;let u=o?n[1]:n[2],d=Math.ceil(u/2),p=o?"i * 2, rc.y":"rc.y, i * 2",f=i?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:c?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,y="result = activation(result);");let v=s?"result += getBiasAtOutCoords();":"";s&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");let S="rc.x",C="rc.x";n[0]<e[0]?S=`int(min(float(rc.x), ${n[0]-1}.))`:e[0]<n[0]&&(C=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`
      ${g}

      const float sharedDimension = ${d}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${d}; i++) {
          int batchA = ${S};
          int batchB = ${C};
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${f});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${v}

        ${y}

        setOutput(result);
      }
    `}};var Vk={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},Py=class{constructor(n,e,r){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(e,r),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${n}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var XH="return a * b;";function $y(t){let{inputs:n,backend:e}=t,{a:r,b:o}=n,i=T.upcastType(r.dtype,o.dtype);if(r.dtype==="complex64"){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),c=new Py(Vk.REAL,r.shape,o.shape),u=new Py(Vk.IMAG,r.shape,o.shape),d=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:r.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:r.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Mr({inputs:{real:p,imag:f},backend:e});return e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}if(e.shouldExecuteOnCPU([r,o])){let a=e.texData.get(r.dataId),l=e.texData.get(o.dataId),[c,u]=mH(r.shape,o.shape,a.values,l.values,i),d=e.makeTensorInfo(u,i),p=e.texData.get(d.dataId);return p.values=c,d}let s;return H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?s=new ii(XH,r.shape,o.shape):s=new Eo(XH,r.shape,o.shape),e.runWebGLProgram(s,[r,o],i)}var YH={kernelName:wa,backendName:"webgl",kernelFunc:$y};function QH(t,n,e){let r=[Yc(t.shape),...Qc(t.shape)],o={dtype:t.dtype,shape:r,dataId:t.dataId},i=[Yc(n),...Qc(n)],s=new Um(i,r),l=e.runWebGLProgram(s,[o],t.dtype,null,!0);return{dataId:l.dataId,shape:n,dtype:l.dtype}}function se(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{shape:i}=r,s=e,a=b.sizeFromShape(o.shape),l=b.inferFromImplicitShape(i,a),c=b.sizeFromShape(l);b.assert(a===c,()=>`The new shape (${l}) has ${c} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let u=s.texData.get(o.dataId);return u.isPacked&&!jd(o.shape,l)&&!(u.texture!==null&&jd(u.shape,l))?QH(o,l,s):(s.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var ZH={kernelName:xc,backendName:"webgl",kernelFunc:se};var Ly=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a=Math.floor(r/4)*4,l=r%4,c="sumValue += dot(values, ones);";if(e!=null){let d=1/e;c=`sumValue += dot(values * ${b.isInt(d)?d.toPrecision(2):d}, ones);`}let u="";i%r>0&&(u=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${u}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${c}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${c}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${c}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${c}
        }
        setOutput(sumValue);
      }
    `}};var AC=class{constructor(n,e){this.variableNames=["x"];let{windowSize:r,batchSize:o,inSize:i,outSize:s}=n;this.outputShape=[o,s];let a="0.0",l="";e==="prod"?a="1.0":e==="min"?(a="1.0 / 1e-20",l="min"):e==="max"&&(a="-1.0 / 1e-20",l="max");let c=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="sum"?c="sumValue":e==="prod"?c="prodValue":e==="all"?c="allValue":e==="any"&&(c="anyValue");let u=Math.floor(r/4)*4,d=r%4,p=`
      if (${e==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${e==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
      }
    `,f="vec4";e==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,f="bvec4"):e==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,f="bvec4");let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===2}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${d===3}) {
          ${f} values = ${f}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function Qge(t){let n=[];for(;n.length===0||n[n.length-1].outSize!==1;){let e=n.length?n[n.length-1].outSize:t[1],r=T.computeOptimalWindowSize(e);n.push({inSize:e,windowSize:r,outSize:Math.ceil(e/r)})}return n}function no(t,n,e,r){let o=Qge(t.shape),i=t;for(let s=0;s<o.length;s++){let{inSize:a,windowSize:l,outSize:c}=o[s],u,d;e==="mean"?u=s===0?new Ly({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},a):new Ly({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c}):u=new AC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:c},e),d=i,i=r.runWebGLProgram(u,[i],n),d.dataId!==t.dataId&&r.disposeIntermediateTensorInfo(d)}return i}var RC=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[e[s]];this.outputShape=r,this.rank=r.length;let o=je(this.rank),i=Zge(e);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${i}));
    }
    `}};function Zge(t){let n=t.length;if(n>6)throw Error(`Transpose for rank ${n} is not yet supported`);let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(n);for(let o=0;o<t.length;o++)r[t[o]]=e[o];return r.join()}var OC=class{constructor(n,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let r=new Array(n.length);for(let u=0;u<r.length;u++)r[u]=n[e[u]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=je(this.rank),i=Ok("rc",this.rank),s=new Array(this.rank);for(let u=0;u<e.length;u++)s[e[u]]=i[u];let a=`vec2(${s.slice(-2).join()})`,l=`++${i[this.rank-1]} < ${r[this.rank-1]}`,c=`getChannel(getA(${s.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${c};
      if(${l}) {
        result[1] = ${c};
      }
      --${i[this.rank-1]};
      if(++${i[this.rank-2]} < ${r[this.rank-2]}) {
        result[2] = ${c};
        if(${l}) {
          result[3] = ${c};
        }
      }
      setOutput(result);
    }
    `}};function eu(t,n,e){let r=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new OC(t.shape,n):new RC(t.shape,n);return e.runWebGLProgram(r,[t],t.dtype)}function JH(t,n,e,r){let o=n,i=t.shape.length,s=b.parseAxisParam(o,t.shape),a=s,l=T.getAxesPermutation(a,i),c=l!=null,u=t;c&&(u=eu(t,l,r),a=T.getInnerMostAxes(a.length,i)),T.assertAxesAreInnerMostDims("sum",a,i);let[d,p]=T.computeOutAndReduceShapes(u.shape,a),f=d;e&&(f=T.expandShapeToKeepDim(d,s));let m=b.sizeFromShape(p),g=b.sizeFromShape(t.shape)/m,y=se({inputs:{x:u},attrs:{shape:[g,m]},backend:r}),v=id(t.dtype),S=no(y,v,"sum",r),C=se({inputs:{x:S},attrs:{shape:f},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(S),c&&r.disposeIntermediateTensorInfo(u),C}function Hd(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r;return JH(o,i,s,e)}var eq={kernelName:_c,backendName:"webgl",kernelFunc:Hd};function Ht(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{perm:i}=r,s=e,a=o.shape.length,l=new Array(a);for(let u=0;u<l.length;u++)l[u]=o.shape[i[u]];let c;if(s.shouldExecuteOnCPU([o])){let d=s.texData.get(o.dataId).values,p=Wd(d,o.shape,o.dtype,i,l);c=s.makeTensorInfo(l,o.dtype);let f=s.texData.get(c.dataId);f.values=p}else c=eu(o,i,s);return c}var tq={kernelName:Dc,backendName:"webgl",kernelFunc:Ht};var Bk=1e3;function qd({a:t,b:n,transposeA:e,transposeB:r,backend:o,bias:i=null,preluActivationWeights:s=null,leakyreluAlpha:a=0,activation:l=null}){let c=t.shape.length,u=n.shape.length,d=e?t.shape[c-2]:t.shape[c-1],p=r?n.shape[u-1]:n.shape[u-2],f=e?t.shape[c-1]:t.shape[c-2],m=r?n.shape[u-2]:n.shape[u-1],h=t.shape.slice(0,-2),g=n.shape.slice(0,-2),y=b.sizeFromShape(h),v=b.sizeFromShape(g),S=y===v||y===1||v===1;b.assert(c>=2&&u>=2&&S,()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${h}) and (${g}).`);let I=(y>v?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([f,m]);b.assert(d===p,()=>`Error in matMul: inner shapes (${d}) and (${p}) of Tensors with shapes ${t.shape} and ${n.shape} and transposeA=${e} and transposeB=${r} must match.`);let E=e?[y,d,f]:[y,f,d],D=r?[v,m,p]:[v,p,m],O=se({inputs:{x:t},backend:o,attrs:{shape:E}}),R=se({inputs:{x:n},backend:o,attrs:{shape:D}}),P=[O,R],U=Math.max(y,v),G=e?O.shape[1]:O.shape[2],q=i!=null,X=s!=null,K=l==="leakyrelu",Y=l!=null?Jc(l,!0):null,ne=q||X||K||Y!=null,J;if((f===1||m===1)&&G>Bk&&ne===!1){let ie=O,ce=R;e&&(ie=Ht({inputs:{x:O},backend:o,attrs:{perm:[0,2,1]}}),P.push(ie)),r&&(ce=Ht({inputs:{x:R},backend:o,attrs:{perm:[0,2,1]}}),P.push(ce));let pe=m!==1,ue=m===1,ge=ie;pe&&(ge=se({inputs:{x:ie},backend:o,attrs:{shape:[U,G,1]}}),P.push(ge));let ye=m===1?2:1,xe=ce;ue&&(xe=se({inputs:{x:ce},backend:o,attrs:{shape:[U,1,G]}}),P.push(xe));let Te=$y({inputs:{a:ge,b:xe},backend:o});J=Hd({inputs:{x:Te},backend:o,attrs:{axis:ye,keepDims:!0}}),P.push(Te)}else{let ie=Cn(t.dtype,n.dtype),ce=new jm(E,D,[U,f,m],e,r,q,Y,X,K),pe=[O,R];if(i!=null&&pe.push(i),X&&pe.push(s),K){let ue=o.makeTensorInfo([],"float32",b.createScalarValue(a,"float32"));pe.push(ue),P.push(ue)}J=o.runWebGLProgram(ce,pe,ie)}let te=se({inputs:{x:J},backend:o,attrs:{shape:I}});P.push(J);for(let ie of P)o.disposeIntermediateTensorInfo(ie);return te}function Jge(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i,bias:s,preluActivationWeights:a}=n,{transposeA:l,transposeB:c,activation:u,leakyreluAlpha:d}=r;return qd({a:o,b:i,transposeA:l,transposeB:c,backend:e,bias:s,preluActivationWeights:a,leakyreluAlpha:d,activation:u})}var nq={kernelName:td,backendName:"webgl",kernelFunc:Jge};var rq="return abs(x);";function eye(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])&&r.dtype!=="complex64"){let i=e.texData.get(r.dataId),s=_C(i.values);return e.makeTensorInfo(r.shape,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new oi(r.shape,rq):o=new wr(r.shape,rq),e.runWebGLProgram(o,[r],r.dtype)}var oq={kernelName:Bl,backendName:"webgl",kernelFunc:eye};var tye=Mn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,nye=be({opSnippet:tye}),iq={kernelName:Ks,backendName:"webgl",kernelFunc:nye};var rye=Mn+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,oye=be({opSnippet:rye}),sq={kernelName:Xs,backendName:"webgl",kernelFunc:oye};var aq="return a + b;",iye=xt({opSnippet:aq,packedOpSnippet:aq,supportsComplex:!0,cpuKernelImpl:JW}),lq={kernelName:vi,backendName:"webgl",kernelFunc:iye};var MC=class{constructor(n,e){this.outputShape=[],this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`float v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var FC=class{constructor(n,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.variableNames=e.map((i,s)=>`T${s}`);let r=[];this.variableNames.forEach(i=>{r.push(`vec4 v${i} = get${i}AtOutCoords();`)});let o=this.variableNames.map(i=>`v${i}`).join(" + ");this.userCode=`
      void main() {
        ${r.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function PC(t){let{inputs:n,backend:e}=t,r=n;if(r.length===1)return un({inputs:{x:r[0]},backend:e});if(r.length>H().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(r.length/2),c=PC({inputs:r.slice(0,l),backend:e}),u=PC({inputs:r.slice(l),backend:e});return PC({inputs:[c,u],backend:e})}let o=r.map(l=>l.dtype).reduce((l,c)=>Cn(l,c)),i=r.map(l=>l.shape),a=H().getBool("WEBGL_PACK")?new FC(r[0].shape,i):new MC(r[0].shape,i);return e.runWebGLProgram(a,r,o)}var cq={kernelName:gf,backendName:"webgl",kernelFunc:PC};function sye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("all",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=b.sizeFromShape(f),h=se({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=no(h,h.dtype,"all",e),y;if(s){let v=T.expandShapeToKeepDim(p,l);y=se({inputs:{x:g},backend:e,attrs:{shape:v}})}else y=se({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var uq={kernelName:yf,backendName:"webgl",kernelFunc:sye};function aye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,a)),T.assertAxesAreInnerMostDims("any",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=b.sizeFromShape(f),h=se({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=no(h,h.dtype,"any",e),y;if(s){let v=T.expandShapeToKeepDim(p,l);y=se({inputs:{x:g},backend:e,attrs:{shape:v}})}else y=se({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var dq={kernelName:xf,backendName:"webgl",kernelFunc:aye};var $C=class{constructor(n,e,r){this.variableNames=["A"];let{windowSize:o,batchSize:i,outSize:s}=n;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,s];let a=e==="max"?">":"<",l=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var LC=class{constructor(n,e,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,b.assert(n.length>2,()=>`Packed arg${r.charAt(0).toUpperCase()+r.slice(1)} supports only inputs with rank above 2.`);let i=n[n.length-1],s=Math.ceil(i/e);this.outputShape=n.slice(0,-1),s>1&&this.outputShape.push(s),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,c=je(l),u=cn("coords",l),d,p;if(s===1){p=l+1;let O=je(p);d=`
        ${O} sourceLocR = ${O}(${u.join()}, 0);
        ++${u[l-1]};
        ${O} sourceLocG = ${O}(${u.join()}, 0);
        ++${u[l-2]};
        ${O} sourceLocA = ${O}(${u.join()}, 0);
        --${u[l-1]};
        ${O} sourceLocB = ${O}(${u.join()}, 0);
        --${u[l-2]};`}else p=l,d=`
        ${c} sourceLocR = coords;
        ++${u[l-1]};
        ${c} sourceLocG = coords;
        ++${u[l-2]};
        ${c} sourceLocA = coords;
        --${u[l-1]};
        ${c} sourceLocB = coords;
        --${u[l-2]};`;let f=["x","y","z","w","u","v"].slice(0,p),m="."+f[p-1],h=f.map(O=>"int "+O),g=cn("sourceLocR",p-1).concat("inIdx.r"),y=cn("sourceLocG",p-1).concat("inIdx.g"),v=cn("sourceLocB",p-1).concat("inIdx.b"),S=cn("sourceLocA",p-1).concat("inIdx.a"),C=r==="max"?"greaterThan":"lessThan",I=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${S.join()})));`,E=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${y.join()}) : 0.,
            hasNextRow ? getAChannel(${v.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${S.join()}) : 0.)`,D=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${f.join()}),
                                          vec2(${f.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${f.join()}),
                               vec2(${f.slice(-2).join()}));
      }
      ${D}
      void main() {
        ${c} coords = getOutputCoords();
        bool hasNextCol = ${u[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${u[l-2]} < ${a[l-2]-1};
        ${d}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${e};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${E};

        for (int i = 0; i < ${e}; i++) {
          inIdx = srcIdx;
          ${I}
          vec4 candidate = ${E};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${C}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function pq(t,n,e,r=null){let o=n.shape[0],i=n.shape[1];r!=null&&(o=r.shape[0],i=r.shape[1]);let s=T.computeOptimalWindowSize(i),a={windowSize:s,inSize:i,batchSize:o,outSize:Math.ceil(i/s)},l=new $C(a,e,r==null),c=[n];r!=null&&c.push(r);let u=t.runWebGLProgram(l,c,"int32");if(u.shape[1]===1)return u;let d=pq(t,n,e,u);return t.disposeIntermediateTensorInfo(u),d}function fq(t,n,e,r=null){let o=r!=null?r.shape:n.shape,i=o[o.length-1],s=T.computeOptimalWindowSize(i),a=new LC(o,s,e,r==null),l=r==null?[n]:[n,r],c=t.runWebGLProgram(a,l,"int32");if(c.shape.length===n.shape.length){let u=fq(t,n,e,c);return t.disposeIntermediateTensorInfo(c),u}return c}function VC(t,n,e,r){let o=[e];if(T.assertAxesAreInnerMostDims("arg"+r.charAt(0).toUpperCase()+r.slice(1),o,n.shape.length),!H().getBool("WEBGL_PACK_REDUCE")||n.shape.length<=2){let i=[],[s,a]=T.computeOutAndReduceShapes(n.shape,o),l=b.sizeFromShape(a),c=se({inputs:{x:n},backend:t,attrs:{shape:[-1,l]}});i.push(c);let u=pq(t,c,r);i.push(u);let d=se({inputs:{x:u},backend:t,attrs:{shape:s}});return i.forEach(p=>t.disposeIntermediateTensorInfo(p)),d}return fq(t,n,r)}function lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Ht({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[s[0]],l.shape.length);let u=VC(e,l,s[0],"max");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var mq={kernelName:zl,backendName:"webgl",kernelFunc:lye};function cye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i}=r,s=b.parseAxisParam(i,o.shape),a=T.getAxesPermutation(s,o.shape.length),l=o,c=[];a!=null&&(l=Ht({inputs:{x:o},backend:e,attrs:{perm:a}}),c.push(l),s=T.getInnerMostAxes(s.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[s[0]],l.shape.length);let u=VC(e,l,s[0],"min");return c.forEach(d=>e.disposeIntermediateTensorInfo(d)),u}var hq={kernelName:Ul,backendName:"webgl",kernelFunc:cye};var uye=Mn+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,dye=be({opSnippet:uye}),gq={kernelName:Ys,backendName:"webgl",kernelFunc:dye};var pye=Mn+"return log(x + sqrt(x * x + 1.0));",fye=be({opSnippet:pye}),yq={kernelName:Qs,backendName:"webgl",kernelFunc:fye};var mye=Mn+`
  return atan(x);
`,hye=be({opSnippet:mye}),xq={kernelName:Zs,backendName:"webgl",kernelFunc:hye};var gye=qH+`
  return atan(a, b);
`,yye=`
  vec4 result = atan(a, b);
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+KH+`
  return result;
`,xye=xt({opSnippet:gye,packedOpSnippet:yye}),vq={kernelName:ea,backendName:"webgl",kernelFunc:xye};var vye=Mn+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,bye=be({opSnippet:vye}),bq={kernelName:Js,backendName:"webgl",kernelFunc:bye};var Oi=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideHeight,l=n.strideWidth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterHeight,p=n.effectiveFilterWidth,f=n.padInfo.top,m=n.padInfo.left;this.outputShape=n.outShape;let h=e==="avg",g=`((batch  * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + d`,y=`(xR * ${n.inWidth} + xC) * ${n.inChannels} + d`,v="0.0";if(h||(v="-1.0 / 1e-20"),r){let O=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${f}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${d};
              wR += ${c}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${u}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${O} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?i?g:y:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let S="max",C=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(C="avgValue / count");let I=Math.floor(s/4)*4,E=s%4,D=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${S}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${f}, ${m});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${d};
            wR += ${c}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${I}; wC += 4) {
            int xC = xCCorner + wC * ${u};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              getValue(batch, xR, xC + 3 * ${u}, d)
            );

            ${D}
          }

          int xC = xCCorner + ${I};
          if (${E===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${E===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              initializationValue,
              initializationValue
            );

            ${D}
          } else if (${E===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${u}, d),
              getValue(batch, xR, xC + 2 * ${u}, d),
              initializationValue
            );

            ${D}
          }
        }
        setOutput(${C});
      }
    `}},tu=class{constructor(n,e,r,o=!1,i=!1){if(this.variableNames=["x"],e==="avg"&&r)throw new Error("Cannot compute positions for average pool.");let s=n.filterWidth,a=n.strideDepth,l=n.strideHeight,c=n.strideWidth,u=n.dilationDepth,d=n.dilationHeight,p=n.dilationWidth,f=n.effectiveFilterDepth,m=n.effectiveFilterHeight,h=n.effectiveFilterWidth,g=n.padInfo.front,y=n.padInfo.top,v=n.padInfo.left;this.outputShape=n.outShape;let S=e==="avg",C="0.0";if(S||(C="-1.0 / 1e-20"),r){let P=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${c});
        const ivec3 pads = ivec3(${g}, ${y}, ${v});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${f};
              wD += ${u}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${n.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${d}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${P} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?i?`(((batch * ${n.inDepth} + xD) * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`((xD * ${n.inHeight} + xR) * ${n.inWidth} + xC) * ${n.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let I="max",E=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;e==="avg"&&(E="avgValue / count");let D=Math.floor(s/4)*4,O=s%4,R=`
      if (${S}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${I}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${c});
      const ivec3 pads = ivec3(${g}, ${y}, ${v});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${n.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${u}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${d}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${D}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${R}
            }

            int xC = xCCorner + ${D};
            if (${O===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${O===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${R}
            } else if (${O===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${R}
            }
          }
          setOutput(${E});
        }
      }
    `}};function wye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;ms(o,"avgPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))return un({inputs:{x:o},backend:e});let d=new Oi(u,"avg",!1);return e.runWebGLProgram(d,[o],"float32")}var wq={kernelName:jl,backendName:"webgl",kernelFunc:wye};function Cye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dimRoundingMode:l,dataFormat:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,l,c),p=new tu(d,"avg",!1);return e.runWebGLProgram(p,[o],"float32")}var Cq={kernelName:Gl,backendName:"webgl",kernelFunc:Cye};var BC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterHeight,c=n.effectiveFilterWidth,u=l-1-n.padInfo.top,d=c-1-n.padInfo.left,p=1/(e*r);this.userCode=`
      const ivec2 pads = ivec2(${u}, ${d});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${s}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${c};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},zC=class{constructor(n){this.variableNames=["dy"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.effectiveFilterDepth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,m=d-1-n.padInfo.front,h=p-1-n.padInfo.top,g=f-1-n.padInfo.left,y=1/(e*r*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${g});
      const float avgMultiplier = float(${y});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${i}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${c}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${f};
                wC += ${u}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Sye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new zC(p);return e.runWebGLProgram(f,[o],s.dtype)}var Sq={kernelName:bf,backendName:"webgl",kernelFunc:Sye};function _ye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i;ms([o,i],"avgPoolGrad");let{filterSize:a,strides:l,pad:c}=r,u=T.computePool2DInfo(s.shape,a,l,1,c),d=new BC(u);return e.runWebGLProgram(d,[o],s.dtype)}var _q={kernelName:vf,backendName:"webgl",kernelFunc:_ye};function Iye(t){let{inputs:n,backend:e,attrs:r}=t,{a:o,b:i}=n,{transposeA:s,transposeB:a}=r;return qd({a:o,b:i,transposeA:s,transposeB:a,backend:e})}var Iq={kernelName:Wl,backendName:"webgl",kernelFunc:Iye};var UC=class{constructor(n,e,r,o,i,s){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${s}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var jC=class{constructor(n,e,r,o,i,s){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(n,e),T.assertAndGetBroadcastShape(n,r);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(n,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";i!=null&&(T.assertAndGetBroadcastShape(n,i),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=n,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${s}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var Eye=({inputs:t,backend:n,attrs:e})=>{let{x:r,mean:o,variance:i,offset:s,scale:a}=t;b.assert(o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),b.assert(s==null||o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),b.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=e;l==null&&(l=.001);let c=[r,o,i],u=null;s!=null&&(u=s.shape,c.push(s));let d=null;a!=null&&(d=a.shape,c.push(a));let p=H().getBool("WEBGL_PACK_NORMALIZATION")?new jC(r.shape,o.shape,i.shape,u,d,l):new UC(r.shape,o.shape,i.shape,u,d,l);return n.runWebGLProgram(p,c,c[0].dtype)},Eq={kernelName:nc,backendName:"webgl",kernelFunc:Eye};var GC=class{constructor(n){this.variableNames=["source"],this.outputShape=n,this.rank=n.length;let e=je(this.rank),r=`uniform int start[${this.rank}];`,o=Tye(this.rank),i,s=n.map((a,l)=>`sourceLoc.${zk[l]} = start[${l}] + coords.${zk[l]};`);i=`
        ${e} sourceLoc;
        ${e} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      ${r}
      void main() {
        ${i}
        setOutput(getSource(${o}));
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}},zk=["x","y","z","w","u","v"];function Tye(t){if(t===1)return"sourceLoc";if(t<=6)return zk.slice(0,t).map(n=>"sourceLoc."+n).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var WC=class{constructor(n){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.rank=n.length;let e=je(this.rank),r=cn("coords",this.rank),o=cn("sourceLoc",this.rank),i=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,s=`getChannel(getSource(${o.join()}), ${i})`,a=`
      result.x = ${s};
      if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${s};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${r[this.rank-1]};
      if (++${r[this.rank-2]} < ${n[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${s};
        if (++${r[this.rank-1]} < ${n[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${s};
        }
      }
    `,c=this.rank<=4?`sourceLoc = coords +
            ${e}(${n.map((u,d)=>`start[${d}]`).join()});`:n.map((u,d)=>`${o[d]} = ${r[d]} + start[${d}];`).join(`
`);this.userCode=`
      uniform int start[${this.rank}];
      void main() {
        ${e} coords = getOutputCoords();
        ${e} sourceLoc;
        ${c}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){if(n.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${n.length})`);return(e,r)=>{this.startLoc==null&&(this.startLoc=e.getUniformLocationNoThrow(r,"start"),this.startLoc==null)||e.gl.uniform1iv(this.startLoc,n)}}};function Dye(t,n,e,r){let o=r.texData.get(t.dataId),i=r.makeTensorInfo(e,t.dtype),s=r.texData.get(i.dataId);Object.assign(s,o),s.refCount=1,s.shape=e,s.dtype=t.dtype;let a=qn.computeFlatOffset(n,b.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),s.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=r.dataRefCount.get(s.slice.origDataId)||1;return r.dataRefCount.set(s.slice.origDataId,l+1),i}function sl(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,size:s}=r,[a,l]=qn.parseSliceParams(o,i,s);if(qn.assertParamsValid(o,a,l),b.sizeFromShape(l)===0)return e.makeTensorInfo(l,o.dtype,[]);if(e.shouldExecuteOnCPU([o])||o.dtype==="string"){let d=e.texData.get(o.dataId),p=vH(d.values,a,l,o.shape,o.dtype);return e.makeTensorInfo(l,o.dtype,p)}let{isPacked:c}=e.texData.get(o.dataId),u=qn.isSliceContinous(o.shape,a,l);if(c||!u){let d=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new WC(l):new GC(l),p=d.getCustomSetupFunc(a);return e.runWebGLProgram(d,[o],o.dtype,p)}return e.uploadToGPU(o.dataId),Dye(o,a,l,e)}var Tq={kernelName:Sc,backendName:"webgl",kernelFunc:sl};var Nye=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,crops:s}=r;b.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((v,S)=>v*S),l=T.getReshaped(o.shape,i,a),c=T.getPermuted(l.length,i.length),u=T.getReshapedPermuted(o.shape,i,a),d=T.getSliceBeginCoords(s,i.length),p=T.getSliceSize(u,s,i.length),f=[],m=se({inputs:{x:o},backend:e,attrs:{shape:l}}),h=Ht({inputs:{x:m},backend:e,attrs:{perm:c}}),g=se({inputs:{x:h},backend:e,attrs:{shape:u}}),y=sl({inputs:{x:g},backend:e,attrs:{begin:d,size:p}});return f.push(m),f.push(h),f.push(g),f.forEach(v=>e.disposeIntermediateTensorInfo(v)),y},Dq={kernelName:Hl,backendName:"webgl",kernelFunc:Nye};function kye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s}=r,a=e.readSync(o.dataId),l=e.readSync(i.dataId),c=SC(a,l,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,c)}var Nq={kernelName:nb,backendName:"webgl",kernelFunc:kye};var Aye="return float(a != b);",Uk=xt({opSnippet:Aye,dtype:"bool"}),kq={kernelName:ed,backendName:"webgl",kernelFunc:Uk};function al(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return un({inputs:{x:o.complexTensorInfos.real},backend:e})}var Aq={kernelName:Lf,backendName:"webgl",kernelFunc:al};var Rye="return float(int(x));";function Rq(t,n){let e=new wr(t.shape,Rye),r=n.runWebGLProgram(e,[t],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}function jk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dtype:i}=r;if(i==="complex64"){if(o.dtype==="complex64")return un({inputs:{x:o},backend:e});let s=Vt(o.shape),a=jk({inputs:{x:o},backend:e,attrs:{dtype:"float32"}}),l=Mr({inputs:{real:a,imag:s},backend:e});return s.dispose(),e.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let s=al({inputs:{input:o},backend:e}),a=jk({inputs:{x:s},backend:e,attrs:{dtype:i}});return e.disposeIntermediateTensorInfo(s),a}if(!b.hasEncodingLoss(o.dtype,i)){let s=un({inputs:{x:o},backend:e});return{dataId:s.dataId,shape:s.shape,dtype:i}}if(i==="int32")return Rq(o,e);if(i==="bool"){let s=e.makeTensorInfo([],"bool",b.getTypedArrayFromDType("bool",1)),l=Uk({inputs:{a:o,b:s},backend:e});return e.disposeIntermediateTensorInfo(s),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${i}`)}var Oq={kernelName:es,backendName:"webgl",kernelFunc:jk};var Mq="return ceil(x);",Oye=be({opSnippet:Mq,packedOpSnippet:Mq,cpuKernelImpl:tH}),Fq={kernelName:ta,backendName:"webgl",kernelFunc:Oye};var HC=class{constructor(n){this.variableNames=["A"],this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};var qC=class{constructor(n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.userCode=`
      uniform float minVal;
      uniform float maxVal;

      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}getCustomSetupFunc(n,e){return(r,o)=>{this.minLoc==null&&(this.minLoc=r.getUniformLocationNoThrow(o,"minVal"),this.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(this.minLoc,n),r.gl.uniform1f(this.maxLoc,e)}}};function Mye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{clipValueMin:i,clipValueMax:s}=r,a;H().getBool("WEBGL_PACK_CLIP")?a=new qC(o.shape):a=new HC(o.shape);let l=a.getCustomSetupFunc(i,s);return e.runWebGLProgram(a,[o],o.dtype,l)}var Pq={kernelName:na,backendName:"webgl",kernelFunc:Mye};var KC=class{constructor(n){this.variableNames=["real","imag"],this.outputShape=n,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function $q(t,n){return{dataId:n.dataId,dtype:n.dtype,shape:t.shape}}function Fye(t){let{inputs:n,backend:e}=t,{x:r}=n,o=e.texData.get(r.dataId),i=new KC(r.shape),s=[$q(r,o.complexTensorInfos.real),$q(r,o.complexTensorInfos.imag)];return e.runWebGLProgram(i,s,s[0].dtype)}var Lq={kernelName:ql,backendName:"webgl",kernelFunc:Fye};var XC=class{constructor(n){this.outputShape=[],this.outputShape=T.computeOutShape(n,1),this.variableNames=n.map((s,a)=>`T${a}`);let e=new Array(n.length-1);e[0]=n[0][1];for(let s=1;s<e.length;s++)e[s]=e[s-1]+n[s][1];let r=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let s=1;s<e.length;s++){let a=e[s-1];r.push(`else if (yC < ${e[s]}) setOutput(getT${s}(yR, yC-${a}));`)}let o=e.length,i=e[e.length-1];r.push(`else setOutput(getT${o}(yR, yC-${i}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${r.join(`
        `)}
      }
    `}};var QC=class{constructor(n,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(n,e);let r=this.outputShape,o=r.length,i=je(o),s=cn("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=n.map((h,g)=>`T${g}`);let l=new Array(n.length-1);l[0]=n[0][e];for(let h=1;h<l.length;h++)l[h]=l[h-1]+n[h][e];let c=a[e],u=a.slice(-2),d=a.join(),p=`if (${c} < ${l[0]}) {
        return getChannel(
            getT0(${d}), vec2(${u.join()}));
        }`;for(let h=1;h<l.length;h++){let g=l[h-1];p+=`
        if (${c} < ${l[h]}  && ${c} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${YC(a,c,g)}),
            vec2(${YC(u,c,g)}));
        }`}let f=l.length,m=l[l.length-1];p+=`
        return getChannel(
          getT${f}(${YC(a,c,m)}),
          vec2(${YC(u,c,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${p}
      }

      void main() {
        ${i} coords = getOutputCoords();
        vec4 result = vec4(getValue(${s}), 0., 0., 0.);

        ${s[o-1]} = ${s[o-1]} + 1;
        if (${s[o-1]} < ${r[o-1]}) {
          result.g = getValue(${s});
        }

        ${s[o-2]} = ${s[o-2]} + 1;
        if (${s[o-2]} < ${r[o-2]}) {
          result.a = getValue(${s});
        }

        ${s[o-1]} = ${s[o-1]} - 1;
        if (${s[o-2]} < ${r[o-2]} &&
            ${s[o-1]} < ${r[o-1]}) {
          result.b = getValue(${s});
        }
        setOutput(result);
      }
    `}};function YC(t,n,e){let r=t.indexOf(n);return t.map((i,s)=>s===r?`${i} - ${e}`:i).join()}function Kd(t){let{inputs:n,backend:e}=t,{input:r}=n,o=e.texData.get(r.dataId);return un({inputs:{x:o.complexTensorInfos.imag},backend:e})}var Vq={kernelName:Rf,backendName:"webgl",kernelFunc:Kd};function Xd(t,n,e){let r=t[0].dtype;if(r==="complex64"){let u=t.map(h=>al({inputs:{input:h},backend:e})),d=t.map(h=>Kd({inputs:{input:h},backend:e})),p=Xd(u,n,e),f=Xd(d,n,e),m=Mr({inputs:{real:p,imag:f},backend:e});return u.forEach(h=>e.disposeIntermediateTensorInfo(h)),d.forEach(h=>e.disposeIntermediateTensorInfo(h)),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}let o=e.shouldExecuteOnCPU(t);if(r==="string"&&(o=!0),o){let u=t.map(y=>{let S=[-1,b.sizeFromShape(y.shape.slice(n))];return se({inputs:{x:y},backend:e,attrs:{shape:S}})}),d=u.map(y=>({vals:e.readSync(y.dataId),shape:y.shape})),p=T.computeOutShape(u.map(y=>y.shape),1),f=u[0].shape[0]===1,m=nH(d,p,r,f),h=T.computeOutShape(t.map(y=>y.shape),n),g=e.makeTensorInfo(h,r,m);return u.forEach(y=>e.disposeIntermediateTensorInfo(y)),g}if(t.length>H().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){let u=Math.floor(t.length/2),d=Xd(t.slice(0,u),n,e),p=Xd(t.slice(u),n,e),f=Xd([d,p],n,e);return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),f}if(H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){let u=new QC(t.map(d=>d.shape),n);return e.runWebGLProgram(u,t,r)}let{tensors2D:i,outShape:s}=Pye(t,n,e),a=new XC(i.map(u=>u.shape)),l=e.runWebGLProgram(a,i,r);i.forEach(u=>e.disposeIntermediateTensorInfo(u));let c=se({inputs:{x:l},attrs:{shape:s},backend:e});return e.disposeIntermediateTensorInfo(l),c}function Pye(t,n,e){let r=T.computeOutShape(t.map(i=>i.shape),n);return{tensors2D:t.map(i=>se({inputs:{x:i},attrs:{shape:[-1,b.sizeFromShape(i.shape.slice(n))]},backend:e})),outShape:r}}function Gk(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r,i=b.parseAxisParam(o,n[0].shape)[0],s=T.computeOutShape(n.map(c=>c.shape),i);if(b.sizeFromShape(s)===0)return e.makeTensorInfo(s,n[0].dtype,[]);let a=n.filter(c=>b.sizeFromShape(c.shape)>0);if(a.length===1)return un({inputs:{x:a[0]},backend:e});let l=a.map(c=>c.shape);return T.assertParamsConsistent(l,i),Xd(a,i,e)}var Bq={kernelName:Kl,backendName:"webgl",kernelFunc:Gk};var Gm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.padInfo.top,a=n.padInfo.left,l=n.strideHeight,c=n.strideWidth,u=n.dilationHeight,d=n.dilationWidth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4,g=n.dataFormat==="channelsLast",y=g?1:2,v=g?2:3,S=g?3:1,C="",I="";r&&(o?C=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?C=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:C=`
          float activation(float x) {
            ${r}
          }
        `,I="result = activation(result);");let E=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${C}

      const ivec2 strides = ivec2(${l}, ${c});
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${S}];

        ivec2 xRCCorner =
            ivec2(coords[${y}], coords[${v}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${u};

          if (xR < 0 || xR >= ${n.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${f}; wC++) {
            int xC = xCCorner + wC * ${d};

            if (xC < 0 || xC >= ${n.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${E}
        ${I}
        setOutput(result);
      }
    `}},ZC=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let e=n.padInfo.front,r=n.padInfo.top,o=n.padInfo.left,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=n.dilationDepth,c=n.dilationHeight,u=n.dilationWidth,d=n.filterDepth,p=n.filterHeight,f=n.filterWidth,m=Math.floor(n.inChannels/4)*4,h=n.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${i}, ${s}, ${a});
      const ivec3 pads = ivec3(${e}, ${r}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${d}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${n.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${c};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f}; wC++) {
              int xC = xCCorner + wC * ${u};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var JC=class{constructor(n,e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;let{filterWidth:o,inChannels:i,strideWidth:s,strideHeight:a,padInfo:l,outWidth:c,dilationWidth:u,dilationHeight:d,dataFormat:p}=r,{left:f,top:m}=l,h=i*o,g=Jt(),y=p==="channelsLast",v=y?0:1,S=y?1:2,C="";for(let I=0;I<=1;I++)for(let E=0;E<=1;E++)C+=`
          blockIndex = rc.y + ${E};
          pos = rc.x + ${I};

          if(blockIndex < ${n[1]} && pos < ${n[0]}) {
            offsetY = int(blockIndex / (${c})) * ${a} - ${m};
            d0 = offsetY + ${d} * (pos / ${h});

            if(d0 < ${e[v]} && d0 >= 0) {

              offsetX = int(mod(float(blockIndex), ${c}.) * ${s}. - ${f}.);
              d1 = offsetX + ${u} * (int(mod(float(pos), ${h}.) / ${i}.));

              if(d1 < ${e[S]} && d1 >= 0) {

                ch = int(mod(float(pos), ${i}.));

                if (${y}) {
                  innerDims = vec2(d1, ch);
                  result[${I*2+E}] = getChannel(
                    getA(d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${I*2+E}] = getChannel(
                    getA(ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec2 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${C}

        ${g.output} = result;
      }
    `}};function eS({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let l=t.shape,c=r.texData.get(t.dataId),u=e.inChannels,d=l[0]*l[1]*l[2],p=e.outChannels,f=e.dataFormat==="channelsLast",m=!1,h=!1,g,y=[],v=(d===1||p===1)&&u>Bk,S=l[2]%2!==0&&!!c.isPacked;if(v||!H().getBool("WEBGL_LAZILY_UNPACK")||!H().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!S){let C=f?l[0]*l[1]*l[2]:l[0]*l[2]*l[3],I=se({inputs:{x:t},backend:r,attrs:{shape:[1,C,e.inChannels]}}),E=se({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}}),D=qd({a:I,b:E,transposeA:m,transposeB:h,backend:r,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s});g=se({inputs:{x:D},backend:r,attrs:{shape:e.outShape}}),y.push(I),y.push(E),y.push(D)}else{let C=f?l[0]*l[1]*(l[2]+1):l[0]*l[2]*(l[3]+1),I={dataId:t.dataId,shape:[1,C,e.inChannels],dtype:t.dtype},E=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,b.assert(jd(c.shape,I.shape),()=>`packed reshape ${c.shape} to ${I.shape} isn't free`);let D=se({inputs:{x:n},backend:r,attrs:{shape:[1,e.inChannels,e.outChannels]}});y.push(D);let O=qd({a:I,b:D,backend:r,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:i,leakyreluAlpha:s}),R=r.texData.get(O.dataId);b.assert(R.isPacked,()=>"batchMatMul result is expected to be packed"),c.shape=E,R.shape=e.outShape,g=un({inputs:{x:O},backend:r}),g.shape=e.outShape,y.push(O)}for(let C of y)r.disposeIntermediateTensorInfo(C);return g}function tS({x:t,filter:n,convInfo:e,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:s=0,activation:a=null}){let{filterWidth:l,filterHeight:c,inChannels:u,outWidth:d,outHeight:p,dataFormat:f}=e,m=f==="channelsLast",h=l*c*u,g=p*d,y=[h,g],v=!0,S=!1,C=[],I=se({inputs:{x:t},backend:r,attrs:{shape:t.shape.slice(1)}}),E=se({inputs:{x:n},backend:r,attrs:{shape:[1,h,b.sizeFromShape(n.shape)/h]}});C.push(I),C.push(E);let D=new JC(y,I.shape,e),O=r.runWebGLProgram(D,[I],"float32"),R=se({inputs:{x:O},backend:r,attrs:{shape:[1,y[0],y[1]]}});C.push(O),C.push(R);let P=o!=null,U=i!=null,G=a==="leakyrelu",q=a?Jc(a,!0):null,X=new jm(R.shape,E.shape,[1,g,e.outChannels],v,S,P,q,U,G),K=[R,E];if(o&&K.push(o),U&&K.push(i),G){let te=r.makeTensorInfo([],"float32",b.createScalarValue(s,"float32"));K.push(te),C.push(te)}let Y=r.runWebGLProgram(X,K,"float32"),ne=m?[1,p,d,e.outChannels]:[1,e.outChannels,p,d],J=se({inputs:{x:Y},backend:r,attrs:{shape:ne}});C.push(Y);for(let te of C)r.disposeIntermediateTensorInfo(te);return J}function $ye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dataFormat:l,dilations:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,i.shape,s,c,a,u,!1,d),f;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))f=eS({x:o,filter:i,convInfo:p,backend:e});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)f=tS({x:o,filter:i,convInfo:p,backend:e});else{let h=new Gm(p);f=e.runWebGLProgram(h,[o,i],"float32")}let m=se({inputs:{x:f},backend:e,attrs:{shape:p.outShape}});return e.disposeIntermediateTensorInfo(f),m}var zq={kernelName:Xl,backendName:"webgl",kernelFunc:$ye};var nS=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              if (${s}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},rS=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=n.dataFormat==="channelsLast",a=e-1-n.padInfo.top,l=r-1-n.padInfo.left,c=s?1:2,u=s?2:3,d=s?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${d}];

        ivec2 dyCorner = ivec2(coords[${c}], coords[${u}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            for (int d2 = 0; d2 < ${n.outChannels}; d2++) {

              if (${s}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},oS=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.padInfo.front,s=n.padInfo.top,a=n.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yF = 0; yF < ${n.outDepth}; yF++) {
            int xF = wF + yF * ${e} - ${i};

            if (xF < 0 || xF >= ${n.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${n.outHeight}; yR++) {
              int xR = wR + yR * ${r} - ${s};

              if (xR < 0 || xR >= ${n.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${n.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${n.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},iS=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterDepth,r=n.filterHeight,o=n.filterWidth,i=n.strideDepth,s=n.strideHeight,a=n.strideWidth,l=e-1-n.padInfo.front,c=r-1-n.padInfo.top,u=o-1-n.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${c}, ${u});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${e}; wF++) {
          float dyF = float(dyFCorner + wF) / ${i}.0;

          if (dyF < 0.0 || dyF >= ${n.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${e} - 1 - wF;

          for (int wR = 0; wR < ${r}; wR++) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${r} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${n.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Lye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,dataFormat:l,dimRoundingMode:c,filterShape:u}=r,d=T.convertConv2DDataFormat(l),p=T.computeConv2DInfo(o.shape,u,s,1,a,c,!1,d),f=new nS(p);return e.runWebGLProgram(f,[o,i],"float32")}var Uq={kernelName:Cf,backendName:"webgl",kernelFunc:Lye};function Vye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{inputShape:s,strides:a,pad:l,dataFormat:c,dimRoundingMode:u}=r,d=T.convertConv2DDataFormat(c),p=T.computeConv2DInfo(s,i.shape,a,1,l,u,!1,d),f=new rS(p);return e.runWebGLProgram(f,[o,i],"float32")}var jq={kernelName:Yl,backendName:"webgl",kernelFunc:Vye};function Bye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeConv3DInfo(o.shape,i.shape,s,l,a),u=new ZC(c);return e.runWebGLProgram(u,[o,i],"float32")}var Gq={kernelName:Ql,backendName:"webgl",kernelFunc:Bye};function zye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,pad:a,filterShape:l}=r,c=T.computeConv3DInfo(o.shape,l,s,1,a),u=new oS(c);return e.runWebGLProgram(u,[o,i],"float32")}var Wq={kernelName:Sf,backendName:"webgl",kernelFunc:zye};function Uye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{pad:s,strides:a,inputShape:l}=r,c=T.computeConv3DInfo(l,i.shape,a,1,s),u=new iS(c);return e.runWebGLProgram(u,[o,i],"float32")}var Hq={kernelName:_f,backendName:"webgl",kernelFunc:Uye};var jye=kC+`
  return cos(x);
`,Gye=be({opSnippet:jye}),qq={kernelName:ra,backendName:"webgl",kernelFunc:Gye};var Wye=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Hye=be({opSnippet:Wye}),Kq={kernelName:oa,backendName:"webgl",kernelFunc:Hye};var sS=class{constructor(n,e,r,o,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[s,a,l,c]=n,[u]=e,[d,p]=r;this.outputShape=[u,d,p,c];let f=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[g,y,v]=d>1?[`${(a-1)/(d-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[S,C,I]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${S});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${s}) {
          return;
        }

        float height_scale = ${y};
        float width_scale = ${C};

        float in_y = ${v};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${i}));
          return;
        }
        float in_x = ${I};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${i}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${f} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var qye=t=>{let{inputs:n,backend:e,attrs:r}=t,{image:o,boxes:i,boxInd:s}=n,{cropSize:a,method:l,extrapolationValue:c}=r,u=new sS(o.shape,i.shape,a,l,c);return e.runWebGLProgram(u,[o,i,s],"float32")},Xq={kernelName:rb,backendName:"webgl",kernelFunc:qye};var Vy=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=n;let o=n.length,i=e?"0.0":`getX(${Yq(o,"coords")})`,s=n[n.length-1],a="",l="";e?(a=r?`end != ${s-1}`:"end != 0",l=r?"end + 1":"end - 1"):(a=r?`end + pow2 < ${s}`:"end >= pow2",l=r?"end + pow2":"end - pow2"),this.userCode=`
      uniform float index;
      void main() {
        ${je(o)} coords = getOutputCoords();
        int end = ${Qq(o,"coords")};
        float val = ${i};
        int pow2 = int(pow(2.0, index));
        if (${a}) {
          int idx = ${l};
          ${Qq(o,"coords")} = idx;
          val += getX(${Yq(o,"coords")});
        }
        setOutput(val);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.index==null&&(this.index=e.getUniformLocation(r,"index")),e.gl.uniform1f(this.index,n)}}};function Yq(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.x, ${n}.y`;if(t===3)return`${n}.x, ${n}.y, ${n}.z`;if(t===4)return`${n}.x, ${n}.y, ${n}.z, ${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Qq(t,n){if(t===1)return`${n}`;if(t===2)return`${n}.y`;if(t===3)return`${n}.z`;if(t===4)return`${n}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function Kye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,exclusive:s,reverse:a}=r,l=o.shape.length,c=T.getAxesPermutation([i],l),u=o;c!=null&&(u=Ht({inputs:{x:o},backend:e,attrs:{perm:c}}));let d=T.getInnerMostAxes(1,l)[0];if(d!==l-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${o.shape.length-1} but got axis=${i}`);let p=u.shape[d],f=un({inputs:{x:u},backend:e});for(let m=0;m<=Math.ceil(Math.log2(p))-1;m++){let h=new Vy(u.shape,!1,a),g=h.getCustomSetupFunc(m),y=f;f=e.runWebGLProgram(h,[f],f.dtype,g),e.disposeIntermediateTensorInfo(y)}if(s){let m=new Vy(u.shape,s,a),h=f;f=e.runWebGLProgram(m,[f],f.dtype),e.disposeIntermediateTensorInfo(h)}if(c!=null){let m=T.getUndoAxesPermutation(c),h=Ht({inputs:{x:f},backend:e,attrs:{perm:m}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(u),h}return f}var Zq={kernelName:Zl,backendName:"webgl",kernelFunc:Kye};function Xye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,weights:i}=n,{size:s,binaryOutput:a}=r;if(o.shape.length===1){let l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=SC(l,c,i.dtype,i.shape,s);return e.makeTensorInfo([s],i.dtype,u)}else if(o.shape.length===2){let l=e.bufferSync(o),c=e.bufferSync(i),u=eH(l,c,s,a);return e.makeTensorInfo(u.shape,i.dtype,u.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var Jq={kernelName:ob,backendName:"webgl",kernelFunc:Xye};var aS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=[],this.outputShape=n,this.blockSize=e,this.dataFormat=r,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${e};
      int offset_h = imod(h, ${e});
      int in_w = w / ${e};
      int offset_w = imod(w, ${e});
      int offset_d = (offset_h * ${e} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Yye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockSize:i,dataFormat:s}=r;b.assert(i>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${i}`);let a=o.shape[0],l=s==="NHWC"?o.shape[1]:o.shape[2],c=s==="NHWC"?o.shape[2]:o.shape[3],u=s==="NHWC"?o.shape[3]:o.shape[1],d=l*i,p=c*i,f=u/(i*i),m=s==="NHWC"?[a,d,p,f]:[a,f,d,p],h=new aS(m,i,s);return e.runWebGLProgram(h,[o],o.dtype)}var e5={kernelName:If,backendName:"webgl",kernelFunc:Yye};var Wm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.outputShape=n.outShape;let s=n.inHeight,a=n.inWidth,l=n.padInfo.top,c=n.padInfo.left,u=n.strideHeight,d=n.strideWidth,p=n.dilationHeight,f=n.dilationWidth,m=n.filterHeight,h=n.filterWidth,g=n.outChannels/n.inChannels,y="",v="";r&&(o?y=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?y=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:y=`
          float activation(float x) {
            ${r}
          }
        `,v="result = activation(result);");let S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${y}

      const ivec2 strides = ivec2(${u}, ${d});
      const ivec2 pads = ivec2(${l}, ${c});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${g};
        int q = d2 - d1 * ${g};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${m}; wR++) {
          int xR = xRCorner + wR * ${p};

          if (xR < 0 || xR >= ${s}) {
            continue;
          }

          for (int wC = 0; wC < ${h}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${a}) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${S}
        ${v}
        setOutput(result);
      }
    `}};var Hm=class{constructor(n,e=!1,r=null,o=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.outShape;let s=n.outChannels/n.inChannels,a=n.inHeight,l=n.inWidth,c=n.padInfo.top,u=n.padInfo.left,d=n.strideHeight,p=n.strideWidth,f=n.dilationHeight,m=n.dilationWidth,h=n.filterHeight,g=n.filterWidth,y=g,v=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let E=0;E<g;E++)v+=`
          vec4 xTexelC${E*2};
          int xTexelC${E*2}Ready;
          vec4 xC${E};`;for(let E=0;E<h;E++){for(let D=0;D<g;D++)v+=`
          xTexelC${D*2} = vec4(0.0);
          xTexelC${D*2}Ready = 0;
          xC${D} = vec4(0.0);`;v+=`
        xR = xRCorner + ${E*f};
        if (xR >=0 && xR < ${a}) {
      `;for(let D=0;D<(y+1)/2;D++){let O=D*2,R=O*m;if(v+=`
          xC = xCCorner + ${R};
          `,p===1){if(O<g&&(u%2===1?(v+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }
              `,m===1&&R>0?v+=`
                xC${O} = vec4(xTexelC${R-2}.zw, xTexelC${R}.xy);
                `:v+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < ${l}) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      previous.zw = vec2(0.0);
                    }

                    xC${O} = vec4(previous.zw, xTexelC${R}.xy);
                  } else {
                    xC${O} = vec4(0.0, 0.0, xTexelC${R}.xy);
                  }
                  `):v+=`
                if (xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xC${O} = xTexelC${R};
                `,R+1<g)){let P=u%2===0?b.nearestLargerEven(m):m;m%2===0&&u%2===1||m%2!==0&&u%2!==1?(v+=`
                  xCOffset = xC + ${u%2} + ${P};

                  if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                    xTexelC${R+2} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= ${l}) {
                      xTexelC${R+2}.zw = vec2(0.0);
                    }
                    xTexelC${R+2}Ready = 1;
                  }
                  `,m>1&&(v+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                      xTexelC${R} = getX(batch, xR, xCOffset, d1);
                      xTexelC${R}Ready = 1;
                    }
                    `),v+=`
                  xC${O+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.xy);
                  `):P===1?v+=`
                    xC${O+1} = xTexelC${R};
                    `:v+=`
                    xCOffset = xC + ${P};

                    if (xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                      xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= ${l}) {
                        xTexelC${R+2}.zw = vec2(0.0);
                      }
                      xTexelC${R+2}Ready = 1;
                    }

                    xC${O+1} = xTexelC${R+2};
                    `}}else R<g&&(u%2===1?(v+=`
                xCOffset = xC + 1 - ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.0);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${O} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
              `,R+1<g&&(v+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + ${p};
                  if(xCOffset >= 0 && xCOffset < ${l}) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${O+1} = vec4(xTexelC${R+2}.xy, final.xy);
                `)):(v+=`
                if(xC >= 0 && xC < ${l} && xTexelC${R}Ready == 0) {
                  xTexelC${R} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= ${l}) {
                    xTexelC${R}.zw = vec2(0.0);
                  }
                  xTexelC${R}Ready = 1;
                }

                xCOffset = xC + ${p};
                if(xCOffset >= 0 && xCOffset < ${l} && xTexelC${R+2}Ready == 0) {
                  xTexelC${R+2} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= ${l}) {
                    xTexelC${R+2}.zw = vec2(0.);
                  }
                  xTexelC${R+2}Ready = 1;
                }

                xC${O} = vec4(
                  xTexelC${R}.xy, xTexelC${R+2}.xy);
              `,R+1<g&&(v+=`
                  xC${O+1} = vec4(xTexelC${R}.zw, xTexelC${R+2}.zw);
                `)));O<g&&(v+=`
            wTexel = getW(${E}, ${R}, d1, q);
            dotProd += xC${O} * vec4(wTexel.xz, wTexel.xz);
          `,R+1<g&&(v+=`
              wTexel = getW(${E}, ${R+1}, d1, q);
              dotProd += xC${O+1} * vec4(wTexel.xz, wTexel.xz);
            `))}v+=`
        }
      `}let S="",C="";r&&(o?S=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${r}
        }`:i?S=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${r}
        }`:S=`vec4 activation(vec4 x) {
          ${r}
        }`,C="result = activation(result);");let I=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${d}, ${p});
      const ivec2 pads = ivec2(${c}, ${u});

      void main() {

        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${s};
        int q = d2 - d1 * ${s};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${v}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${I}
        ${C}
        setOutput(result);
      }
    `}};function Qye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l,dimRoundingMode:c}=r,u=l;u==null&&(u=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let d=T.computeConv2DInfo(o.shape,i.shape,s,u,a,c,!0),p;return H().getBool("WEBGL_PACK_DEPTHWISECONV")&&d.strideWidth<=2&&d.outChannels/d.inChannels===1?p=new Hm(d):p=new Wm(d),e.runWebGLProgram(p,[o,i],"float32")}var t5={kernelName:Jl,backendName:"webgl",kernelFunc:Qye};var lS=class{constructor(n){this.variableNames=["x","dy"],this.outputShape=n.filterShape;let e=n.strideHeight,r=n.strideWidth,o=n.padInfo.top,i=n.padInfo.left,s=n.outChannels/n.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${s} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${n.batchSize}; b++) {
          for (int yR = 0; yR < ${n.outHeight}; yR++) {
            int xR = wR + yR * ${e} - ${o};

            if (xR < 0 || xR >= ${n.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${n.outWidth}; yC++) {
              int xC = wC + yC * ${r} - ${i};

              if (xC < 0 || xC >= ${n.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},cS=class{constructor(n){this.variableNames=["dy","W"],this.outputShape=n.inShape;let e=n.filterHeight,r=n.filterWidth,o=n.strideHeight,i=n.strideWidth,s=e-1-n.padInfo.top,a=r-1-n.padInfo.left,l=n.outChannels/n.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${s}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${e}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${e} - 1 - wR;

          for (int wC = 0; wC < ${r}; wC++) {
            float dyC = float(dyCCorner + wC) / ${i}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${r} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Zye(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,dy:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,filterShape:u}=r,d=T.computeConv2DInfo(o.shape,u,s,a,l,c,!0),p=new lS(d);return e.runWebGLProgram(p,[o,i],"float32")}var n5={kernelName:Ef,backendName:"webgl",kernelFunc:Zye};function Jye(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,filter:i}=n,{strides:s,dilations:a,pad:l,dimRoundingMode:c,inputShape:u}=r,d=T.computeConv2DInfo(u,i.shape,s,a,l,c,!0),p=new cS(d);return e.runWebGLProgram(p,[o,i],"float32")}var r5={kernelName:Tf,backendName:"webgl",kernelFunc:Jye};var uS=class{constructor(n){this.variableNames=["X"],this.outputShape=[n,n],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function exe(t){let{inputs:n,backend:e}=t,{x:r}=n,o=[...r.shape,...r.shape],i=b.sizeFromShape(r.shape),s=se({inputs:{x:r},backend:e,attrs:{shape:[i]}}),a=new uS(i),l=e.runWebGLProgram(a,[s],s.dtype),c=se({inputs:{x:l},backend:e,attrs:{shape:o}});return e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(l),c}var o5={kernelName:ib,backendName:"webgl",kernelFunc:exe};var dS=class{constructor(n){this.variableNames=["x","W"],this.outputShape=n.outShape;let{inHeight:e,inWidth:r,padInfo:o,strideHeight:i,strideWidth:s,filterHeight:a,filterWidth:l,dilationHeight:c,dilationWidth:u}=n,{top:d,left:p}=o;this.userCode=`
      const ivec2 strides = ivec2(${i}, ${s});
      const ivec2 pads = ivec2(${d}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${c};

          if (hIn >= 0 && hIn < ${e}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${u};

              if (wIn >= 0 && wIn < ${r}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function txe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i}=n,{strides:s,pad:a,dilations:l}=r,c=T.computeDilation2DInfo(o.shape,i.shape,s,a,"NHWC",l),u,d=new dS(c);u=e.runWebGLProgram(d,[o,i],"float32");let p=se({inputs:{x:u},backend:e,attrs:{shape:c.outShape}});return e.disposeIntermediateTensorInfo(u),p}var i5={kernelName:ec,backendName:"webgl",kernelFunc:txe};function nxe(t){let{inputs:n,backend:e,attrs:r}=t,{equation:o}=r,i=n,{allDims:s,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,i.length);T.checkEinsumDimSizes(s.length,l,i);let{path:c,steps:u}=T.getEinsumComputePath(a,l),d=u.length,p=null,f=s.length,m=[];for(let h=0;h<d;++h){for(let g of u[h]){let{permutationIndices:y,expandDims:v}=T.getEinsumPermutation(f,l[g]),S;T.isIdentityPermutation(y)?S=i[g]:(S=Ht({inputs:{x:i[g]},backend:e,attrs:{perm:y}}),m.push(S));let C=S.shape.slice();for(let I=0;I<v.length;++I)C.splice(v[I],0,1);b.arraysEqual(S.shape,C)||(S=se({inputs:{x:S},backend:e,attrs:{shape:C}}),m.push(S)),p===null?p=S:(p=$y({inputs:{a:S,b:p},backend:e}),m.push(p))}h<d-1&&(c[h]>=0&&(p=Hd({inputs:{x:p},backend:e,attrs:{axis:c[h]-(s.length-f),keepDims:!1}}),m.push(p)),f--)}for(let h of m)h!==p&&e.disposeIntermediateTensorInfo(h);return p}var s5={kernelName:sb,backendName:"webgl",kernelFunc:nxe};var rxe="return (x >= 0.0) ? x : (exp(x) - 1.0);",oxe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,ixe=be({opSnippet:rxe,packedOpSnippet:oxe}),a5={kernelName:sa,backendName:"webgl",kernelFunc:ixe};var sxe="return (b >= 1.0) ? a : a * (b + 1.0);",axe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,lxe=t=>{let{inputs:n,backend:e}=t,{dy:r,y:o}=n,i=H().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ii(axe,r.shape,o.shape):new Eo(sxe,r.shape,o.shape);return e.runWebGLProgram(i,[r,o],r.dtype)},l5={kernelName:Df,backendName:"webgl",kernelFunc:lxe};var cxe=`
  return vec4(equal(a, b));
`,uxe="return float(a == b);",dxe=xt({opSnippet:uxe,packedOpSnippet:cxe,dtype:"bool"}),c5={kernelName:qu,backendName:"webgl",kernelFunc:dxe};var pxe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,fxe=be({opSnippet:pxe}),u5={kernelName:aa,backendName:"webgl",kernelFunc:fxe};var d5="return exp(x);",Wk=be({opSnippet:d5,packedOpSnippet:d5,cpuKernelImpl:rH}),p5={kernelName:la,backendName:"webgl",kernelFunc:Wk};function pS(t){let{inputs:n,attrs:e,backend:r}=t,{dim:o}=e,{input:i}=n,s=i.shape.length,a=i.shape.slice(),l=o;return o<0&&(b.assert(-(s+1)<=o,()=>`Axis must be in the interval [${-(s+1)}, ${s}]`),l=s+o+1),a.splice(l,0,1),se({inputs:{x:i},backend:r,attrs:{shape:a}})}var f5={kernelName:tc,backendName:"webgl",kernelFunc:pS};var m5="return exp(x) - 1.0;",mxe=be({opSnippet:m5,packedOpSnippet:m5,cpuKernelImpl:oH}),h5={kernelName:ca,backendName:"webgl",kernelFunc:mxe};var By=class{constructor(n,e,r){this.variableNames=["real","imag"];let o=e[1];this.outputShape=e;let i=r?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,s=r?`${o}.0`:"1.0",a;if(n==="real")a="return real * expR - imag * expI;";else if(n==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${n}.`);this.userCode=`
      const float exponentMultiplier = ${i};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${s};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function fS(t,n,e){let r=e.texData.get(t.dataId),o=b.sizeFromShape(t.shape),i=t.shape[t.shape.length-1],s=o/i,a=se({inputs:{x:t},backend:e,attrs:{shape:[s,i]}}),l=a.shape,c=new By("real",l,n),u=new By("imag",l,n),d=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:l},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:l}],p=e.runWebGLProgram(c,d,"float32"),f=e.runWebGLProgram(u,d,"float32"),m=Mr({inputs:{real:p,imag:f},backend:e});e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f);let h=se({inputs:{x:m},backend:e,attrs:{shape:t.shape}});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(m),h}function hxe(t){let{inputs:n,backend:e}=t,{input:r}=n;return fS(r,!1,e)}var g5={kernelName:Nf,backendName:"webgl",kernelFunc:hxe};var mS=class{constructor(n,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=n,this.userCode=`
      uniform float value;
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};function zy(t){let{backend:n,attrs:e}=t,{shape:r,value:o}=e,{dtype:i}=e;if(i=i||b.inferDtype(o),i==="string"){let s=b.getArrayFromDType(i,b.sizeFromShape(r));return s.fill(o),n.makeTensorInfo(r,i,s)}else{let s=new mS(r,o),a=s.getCustomSetupFunc(o);return n.runWebGLProgram(s,[],i,a)}}var y5={kernelName:kf,backendName:"webgl",kernelFunc:zy};var hS=class{constructor(n){this.variableNames=["Image"],this.outputShape=[];let e=n[2];this.outputShape=n,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${e} - x;
          float outputValue;
          if(coordX >= 0 && coordX < ${e}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var x5={kernelName:ab,backendName:"webgl",kernelFunc:({inputs:t,backend:n})=>{let{image:e}=t,r=n,o=new hS(e.shape);return r.runWebGLProgram(o,[e],e.dtype)}};var v5="return floor(x);",gxe=be({opSnippet:v5,packedOpSnippet:v5,cpuKernelImpl:iH}),b5={kernelName:ua,backendName:"webgl",kernelFunc:gxe};var yxe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,xxe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,vxe=xt({opSnippet:yxe,packedOpSnippet:xxe,dtype:"int32"}),w5={kernelName:da,backendName:"webgl",kernelFunc:vxe};var gS=class{constructor(n){this.variableNames=["A"];let e=Jt(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${r}.0);

        vec4 values = ${e.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var yS=class{constructor(n){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let e=Jt(),[r,o]=n;this.outputShape=n,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${r}.0);
            vec4 values = ${e.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${e.output} = result;
      }
    `}};var C5={kernelName:v$,backendName:"webgl",kernelFunc:bxe},qm;function bxe(t){let{inputs:n,backend:e,attrs:r}=t,{pixels:o}=n,{numChannels:i}=r,s=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,c]=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],u=[c,l],d=[c,l,i];(a||s)&&(qm==null&&(qm=document.createElement("canvas").getContext("2d")),qm.canvas.width=l,qm.canvas.height=c,qm.drawImage(o,0,0,l,c),o=qm.canvas);let p=e.makeTensorInfo(u,"int32");e.texData.get(p.dataId).usage=dr.PIXELS,e.gpgpu.uploadPixelDataToTexture(e.getTexture(p.dataId),o);let f=H().getBool("WEBGL_PACK")?new yS(d):new gS(d),m=e.runWebGLProgram(f,[p],"int32");return e.disposeData(p.dataId),m}function wxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dataFormat:u,dilations:d,dimRoundingMode:p,activation:f,leakyreluAlpha:m}=r,h=T.convertConv2DDataFormat(u),g=T.computeConv2DInfo(o.shape,i.shape,l,d,c,p,!1,h),y,v=[];if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))y=eS({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else if(H().getBool("WEBGL_CONV_IM2COL")&&o.shape[0]===1)y=tS({x:o,filter:i,convInfo:g,backend:e,bias:s,activation:f,preluActivationWeights:a,leakyreluAlpha:m});else{let C=s!=null,I=a!=null,E=f==="leakyrelu",D=f?Jc(f,!1):null,O=new Gm(g,C,D,I,E),R=[o,i];if(s&&R.push(s),a&&R.push(a),E){let P=e.makeTensorInfo([],"float32",b.createScalarValue(m,"float32"));R.push(P),v.push(P)}y=e.runWebGLProgram(O,R,"float32")}let S=se({inputs:{x:y},backend:e,attrs:{shape:g.outShape}});return v.push(y),v.forEach(C=>e.disposeIntermediateTensorInfo(C)),S}var S5={kernelName:nd,backendName:"webgl",kernelFunc:wxe};function Cxe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,filter:i,bias:s,preluActivationWeights:a}=n,{strides:l,pad:c,dilations:u,dimRoundingMode:d,activation:p,leakyreluAlpha:f}=r,m=[],h=u;h==null&&(h=[1,1]),b.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let g=T.computeConv2DInfo(o.shape,i.shape,l,h,c,d,!0),y=H().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,v=p?Jc(p,y):null,S=[o,i],C=s!=null,I=a!=null,E=p==="leakyrelu";if(C&&S.push(s),I&&S.push(a),E){let R=e.makeTensorInfo([],"float32",b.createScalarValue(f,"float32"));S.push(R),m.push(R)}let D;y?D=new Hm(g,C,v,I,E):D=new Wm(g,C,v,I,E);let O=e.runWebGLProgram(D,S,"float32");return m.forEach(R=>e.disposeIntermediateTensorInfo(R)),O}var _5={kernelName:rd,backendName:"webgl",kernelFunc:Cxe};var xS=class{constructor(n,e,r){this.sliceDim=n,this.strides=e,this.variableNames=["x","indices"],this.outputShape=r;let o=je(e.length),i=je(r.length),s=this.sliceDim>1?"strides[j]":"strides";this.userCode=`
        ${o} strides = ${o}(${this.strides});
         void main() {
          ${i} coords = getOutputCoords();
          int flattenIndex = 0;
          for (int j = 0; j < ${this.sliceDim}; j++) {
            int index = round(getIndices(coords[0], j));
            flattenIndex += index * ${s};
          }
          setOutput(getX(flattenIndex, coords[1]));
        }
      `}};function Sxe(t){let{inputs:n,backend:e}=t,{params:r,indices:o}=n,i=o.shape,s=i[i.length-1],[a,l,c,u]=T.prepareAndValidate(r,o),d=se({inputs:{x:o},backend:e,attrs:{shape:[l,s]}}),p=se({inputs:{x:r},backend:e,attrs:{shape:[b.sizeFromShape(r.shape)/c,c]}}),f=new xS(s,u,[l,c]),m=e.runWebGLProgram(f,[p,d],p.dtype),h=se({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(m),h}var I5={kernelName:lb,backendName:"webgl",kernelFunc:Sxe};var vS=class{constructor(n,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;let r=je(this.rank),o=_xe(n,2);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}};function _xe(t,n){let e=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[];for(let o=0;o<t.length;o++)o===2?r.push("int(getIndices(resRC.x, resRC.z))"):r.push(`${e[o]}`);return r.join()}function Ixe(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,indices:i}=n,{axis:s,batchDims:a}=r,l=b.parseAxisParam(s,o.shape)[0],c=T.segment_util.collectGatherOpShapeInfo(o,i,l,a),u=b.sizeFromShape(i.shape),d=[],p=se({inputs:{x:o},backend:e,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),f=se({inputs:{x:i},backend:e,attrs:{shape:[c.batchSize,u/c.batchSize]}});d.push(p),d.push(f);let m=[c.batchSize,c.outerSize,u/c.batchSize,c.sliceSize];if(e.shouldExecuteOnCPU([o,i])||o.dtype==="string"){let v=e.bufferSync(f),S=e.bufferSync(p),C=sH(S,v,m);return d.forEach(I=>e.disposeIntermediateTensorInfo(I)),e.makeTensorInfo(c.outputShape,C.dtype,C.values)}let h=new vS(p.shape,m),g=e.runWebGLProgram(h,[p,f],p.dtype);d.push(g);let y=se({inputs:{x:g},backend:e,attrs:{shape:c.outputShape}});return d.forEach(v=>e.disposeIntermediateTensorInfo(v)),y}var E5={kernelName:rc,backendName:"webgl",kernelFunc:Ixe};var Exe="return float(a > b);",Txe=`
  return vec4(greaterThan(a, b));
`,Dxe=xt({opSnippet:Exe,packedOpSnippet:Txe,cpuKernelImpl:aH,dtype:"bool"}),T5={kernelName:Ku,backendName:"webgl",kernelFunc:Dxe};var Nxe="return float(a >= b);",kxe=`
  return vec4(greaterThanEqual(a, b));
`,Axe=xt({opSnippet:Nxe,packedOpSnippet:kxe,dtype:"bool"}),D5={kernelName:pa,backendName:"webgl",kernelFunc:Axe};function Rxe(t){let{inputs:n,backend:e}=t,{input:r}=n;return fS(r,!0,e)}var N5={kernelName:Af,backendName:"webgl",kernelFunc:Rxe};var Oxe="return float(!isnan(x) && !isinf(x));",Mxe=be({opSnippet:Oxe,dtype:"bool"}),k5={kernelName:fa,backendName:"webgl",kernelFunc:Mxe};var Fxe="return float(isinf(x));",Pxe=be({opSnippet:Fxe,dtype:"bool"}),A5={kernelName:ma,backendName:"webgl",kernelFunc:Pxe};var $xe="return float(isnan(x));",Lxe=be({opSnippet:$xe,dtype:"bool"}),R5={kernelName:ha,backendName:"webgl",kernelFunc:Lxe};var Vxe="return float(a < b);",Bxe=`
  return vec4(lessThan(a, b));
`,zxe=xt({opSnippet:Vxe,packedOpSnippet:Bxe,cpuKernelImpl:lH,dtype:"bool"}),O5={kernelName:Xu,backendName:"webgl",kernelFunc:zxe};var Uxe="return float(a <= b);",jxe=`
  return vec4(lessThanEqual(a, b));
`,Gxe=xt({opSnippet:Uxe,packedOpSnippet:jxe,dtype:"bool"}),M5={kernelName:Yu,backendName:"webgl",kernelFunc:Gxe};function Wxe(t){let{backend:n,attrs:e}=t,{start:r,stop:o,num:i}=e,s=cH(r,o,i);return n.makeTensorInfo([s.length],"float32",s)}var F5={kernelName:cb,backendName:"webgl",kernelFunc:Wxe};var Hxe=`if (x < 0.0) return NAN;
  return log(x);`,qxe=`
  vec4 result = log(x);
  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));
  result.r = isNaN.r == 1.0 ? NAN : result.r;
  result.g = isNaN.g == 1.0 ? NAN : result.g;
  result.b = isNaN.b == 1.0 ? NAN : result.b;
  result.a = isNaN.a == 1.0 ? NAN : result.a;

  return result;
`,Kxe=be({opSnippet:Hxe,packedOpSnippet:qxe,cpuKernelImpl:uH}),P5={kernelName:ga,backendName:"webgl",kernelFunc:Kxe};var Xxe="return log(1.0 + x);",Yxe=be({opSnippet:Xxe}),$5={kernelName:ya,backendName:"webgl",kernelFunc:Yxe};var Qxe="return float(a >= 1.0 && b >= 1.0);",Zxe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Jxe=xt({opSnippet:Qxe,packedOpSnippet:Zxe,dtype:"bool"}),L5={kernelName:Qu,backendName:"webgl",kernelFunc:Jxe};var e0e="return float(!(x >= 1.0));",t0e=be({opSnippet:e0e}),V5={kernelName:Zu,backendName:"webgl",kernelFunc:t0e};var n0e="return float(a >= 1.0 || b >= 1.0);",r0e=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,o0e=xt({opSnippet:n0e,packedOpSnippet:r0e,dtype:"bool"}),B5={kernelName:Ju,backendName:"webgl",kernelFunc:o0e};var bS=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[];let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${s}; j <= ${s}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var wS=class{constructor(n,e,r,o,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let s=e,a=n[3]-1;this.outputShape=n;let l,c=`float(${r}) + float(${o}) * sum`;i===.5?l=`inversesqrt(${c})`:i===1?l=`1.0/(${c})`:l=`exp(log(${c}) * float(-${i}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${s};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${s}; j <= ${s}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var i0e=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{depthRadius:i,bias:s,alpha:a,beta:l}=r,c=H().getBool("WEBGL_PACK_NORMALIZATION")?new wS(o.shape,i,s,a,l):new bS(o.shape,i,s,a,l);return e.runWebGLProgram(c,[o],o.dtype)},z5={kernelName:ic,backendName:"webgl",kernelFunc:i0e};var CS=class{constructor(n,e,r,o,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=n,this.depth=n[3],this.depthRadius=e,this.bias=r,this.alpha=o,this.beta=i,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${e})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${e} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${r});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${i})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${i});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var s0e=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o,y:i,dy:s}=n,{depthRadius:a,bias:l,alpha:c,beta:u}=r,d=new CS(o.shape,a,l,c,u);return e.runWebGLProgram(d,[o,i,s],o.dtype)},U5={kernelName:Of,backendName:"webgl",kernelFunc:s0e};function j5(t,n,e,r){let o=b.sizeFromShape(n),s=b.sizeFromShape(t.shape)/o,a=se({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=no(a,t.dtype,"max",r),c=se({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}function Hk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reductionIndices:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=e.shouldExecuteOnCPU([o]),f=o;if(d){if(p){let S=e.texData.get(f.dataId).values,C=new Array(a);for(let D=0;D<C.length;D++)C[D]=o.shape[u[D]];let I=Wd(S,o.shape,o.dtype,u,C);f=e.makeTensorInfo(C,o.dtype);let E=e.texData.get(f.dataId);E.values=I}else f=eu(o,u,e);c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("max",c,a);let[m,h]=T.computeOutAndReduceShapes(f.shape,c),g=m;s&&(g=T.expandShapeToKeepDim(m,l));let y;if(p){let S=e.texData.get(f.dataId).values,C=dH(S,b.sizeFromShape(h),g,o.dtype);y=e.makeTensorInfo(g,o.dtype);let I=e.texData.get(y.dataId);I.values=C}else y=j5(f,h,g,e);return d&&e.disposeIntermediateTensorInfo(f),y}var G5={kernelName:sc,backendName:"webgl",kernelFunc:Hk};var a0e=NC+`
  return max(a, b);
`,l0e=`
  vec4 result = vec4(max(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Zc+`
  return result;
`,c0e=xt({opSnippet:a0e,packedOpSnippet:l0e,cpuKernelImpl:pH}),W5={kernelName:xa,backendName:"webgl",kernelFunc:c0e};function u0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n;ms(o,"maxPool");let{filterSize:i,strides:s,pad:a,dimRoundingMode:l}=r,c=1;b.assert(T.eitherStridesOrDilationsAreOne(s,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${c}'`);let u=T.computePool2DInfo(o.shape,i,s,c,a,l);if(u.filterWidth===1&&u.filterHeight===1&&b.arraysEqual(u.inShape,u.outShape))return un({inputs:{x:o},backend:e});let d=new Oi(u,"max",!1);return e.runWebGLProgram(d,[o],o.dtype)}var H5={kernelName:ac,backendName:"webgl",kernelFunc:u0e};function d0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{filterSize:i,strides:s,pad:a,dataFormat:l,dimRoundingMode:c}=r,u=[1,1,1],d=T.computePool3DInfo(o.shape,i,s,u,a,c,l),p=new tu(d,"max",!1);return e.runWebGLProgram(p,[o],o.dtype)}var q5={kernelName:lc,backendName:"webgl",kernelFunc:d0e};var SS=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideHeight,r=n.strideWidth,o=n.dilationHeight,i=n.effectiveFilterHeight,s=n.effectiveFilterWidth,a=i-1-n.padInfo.top,l=s-1-n.padInfo.left,c=i*s-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${i};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${e}.0;

          if (dyR < 0.0 || dyR >= ${n.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${r}.0;

            if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${c} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${s} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},_S=class{constructor(n){this.variableNames=["dy","maxPos"],this.outputShape=n.inShape;let e=n.strideDepth,r=n.strideHeight,o=n.strideWidth,i=n.dilationDepth,s=n.dilationHeight,a=n.dilationWidth,l=n.effectiveFilterDepth,c=n.effectiveFilterHeight,u=n.effectiveFilterWidth,d=l-1-n.padInfo.front,p=c-1-n.padInfo.top,f=u-1-n.padInfo.left,m=l*c*u-1;this.userCode=`
      const ivec3 pads = ivec3(${d}, ${p}, ${f});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${i}) {
          float dyD = float(dyDCorner + wD) / ${e}.0;

          if (dyD < 0.0 || dyD >= ${n.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${c};
              wR += ${s}) {
            float dyR = float(dyRCorner + wR) / ${r}.0;

            if (dyR < 0.0 || dyR >= ${n.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${u};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${n.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${c} * ${u} +
                  wR * ${u} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function p0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i}=n,s=i,{filterSize:a,strides:l,pad:c,dimRoundingMode:u}=r,d=[1,1,1],p=T.computePool3DInfo(s.shape,a,l,d,c,u),f=new tu(p,"max",!0),m=e.runWebGLProgram(f,[s],s.dtype),h=new _S(p),g=e.runWebGLProgram(h,[o,m],s.dtype);return e.disposeIntermediateTensorInfo(m),g}var K5={kernelName:Ff,backendName:"webgl",kernelFunc:p0e};function f0e(t){let{inputs:n,backend:e,attrs:r}=t,{dy:o,input:i,output:s}=n,a=i;ms([i,s],"maxPoolGrad");let{filterSize:l,strides:c,pad:u,dimRoundingMode:d}=r,p=T.computePool2DInfo(a.shape,l,c,1,u,d),f=!0,m=new Oi(p,"max",f),h=e.runWebGLProgram(m,[a],a.dtype),g=new SS(p),y=e.runWebGLProgram(g,[o,h],a.dtype);return e.disposeIntermediateTensorInfo(h),y}var X5={kernelName:Mf,backendName:"webgl",kernelFunc:f0e};function Y5(t,n,e,r){let o=new Oi(e,"max",!1),i=r.runWebGLProgram(o,[t],"float32");o=new Oi(e,"max",!0,!0,n);let s=r.runWebGLProgram(o,[t],"float32");return[i,s]}var Q5={kernelName:ub,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{filterSize:o,strides:i,pad:s,includeBatchInIndex:a}=n,l=e;b.assert(r.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${r.shape.length}.`);let c=[1,1];b.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let u=T.computePool2DInfo(r.shape,o,i,c,s),[d,p]=Y5(r,a,u,l);return[d,p]}};function Z5(t,n,e,r){let o=b.sizeFromShape(n),s=b.sizeFromShape(t.shape)/o,a=se({inputs:{x:t},attrs:{shape:[s,o]},backend:r}),l=no(a,"float32","mean",r),c=se({inputs:{x:l},attrs:{shape:e},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),c}var J5={kernelName:cc,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{x:r}=t,{keepDims:o,axis:i}=n,s=e,a=r.shape.length,l=b.parseAxisParam(i,r.shape),c=l,u=T.getAxesPermutation(c,a),d=u!=null,p=s.shouldExecuteOnCPU([r]),f=[],m=r;if(d){if(p){let C=s.texData.get(m.dataId).values,I=new Array(a);for(let O=0;O<I.length;O++)I[O]=r.shape[u[O]];let E=Wd(C,r.shape,r.dtype,u,I);m=s.makeTensorInfo(I,r.dtype);let D=s.texData.get(m.dataId);D.values=E}else m=eu(r,u,s);f.push(m),c=T.getInnerMostAxes(c.length,a)}T.assertAxesAreInnerMostDims("sum",c,a);let[h,g]=T.computeOutAndReduceShapes(m.shape,c),y=h;o&&(y=T.expandShapeToKeepDim(h,l));let v=Z5(m,g,y,s);for(let S of f)s.disposeIntermediateTensorInfo(S);return v}};function m0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=b.parseAxisParam(i,o.shape),c=l,u=T.getAxesPermutation(c,a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),c=T.getInnerMostAxes(c.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",c,a);let[p,f]=T.computeOutAndReduceShapes(d.shape,c),m=b.sizeFromShape(f),h=se({inputs:{x:d},backend:e,attrs:{shape:[-1,m]}}),g=no(h,h.dtype,"min",e),y;if(s){let v=T.expandShapeToKeepDim(p,l);y=se({inputs:{x:g},backend:e,attrs:{shape:v}})}else y=se({inputs:{x:g},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(h),e.disposeIntermediateTensorInfo(g),u!=null&&e.disposeIntermediateTensorInfo(d),y}var e8={kernelName:uc,backendName:"webgl",kernelFunc:m0e};var h0e=NC+`
  return min(a, b);
`,g0e=`
  vec4 result = vec4(min(a, b));
  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));
  `+Zc+`
  return result;
`,y0e=xt({opSnippet:h0e,packedOpSnippet:g0e,cpuKernelImpl:fH}),t8={kernelName:va,backendName:"webgl",kernelFunc:y0e};var IS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((u,d)=>u[0]+n[d]+u[1]);let o=n.length,i=je(o),s=e.map(u=>u[0]).join(","),a=e.map((u,d)=>u[0]+n[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),c=r==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${c};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${c};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});

      void main() {
        ${i} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${c};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${c};
          }
        }
        ${i} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var ES=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((m,h)=>m[0]+n[h]+m[1]);let o=n.length,i=je(o),s=e.map(m=>m[0]).join(","),a=e.map((m,h)=>m[0]+n[h]).join(","),l=cn("rc",o),c=cn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=r==="reflect"?0:1,f="";if(o===1){let m=`
        ${i} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
      `}else{let m=`
        ${i} source = rc;
        ${i} lt = ${i}(lessThan(source, start));
        ${i} gte = ${i}(greaterThanEqual(source, end));
        ${i} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;f=`
        ${i} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${c.join()}), ${d});
        ${l[o-1]} += 1;
        if(${u}) {
          ${m}
          result[1] = getChannel(getX(${c.join()}), ${d});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${c.join()}), ${d});
          ${l[o-1]} += 1;
          if(${u}) {
            ${m}
            result[3] = getChannel(getX(${c.join()}), ${d});
          }
        }
      `}this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${f}
        setOutput(result);
      }
    `}};var x0e=({inputs:t,backend:n,attrs:e})=>{let{x:r}=t,{paddings:o,mode:i}=e,s=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ES(r.shape,o,i):new IS(r.shape,o,i);return n.runWebGLProgram(s,[r],r.dtype)},n8={kernelName:dc,backendName:"webgl",kernelFunc:x0e};var v0e=`if (b == 0.0) return NAN;
  return mod(a, b);`,b0e=`
  vec4 result = mod(a, b);
  vec4 isNaN = vec4(equal(b, vec4(0.0)));
  `+Zc+`
  return result;
`,w0e=xt({opSnippet:v0e,packedOpSnippet:b0e}),r8={kernelName:ba,backendName:"webgl",kernelFunc:w0e};var TS=class{constructor(n,e,r){this.variableNames=["probs"],this.outputShape=[n,r],this.userCode=`
      uniform float seed;

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${e-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${e-1}));
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.seedLoc==null&&(this.seedLoc=e.getUniformLocation(r,"seed")),e.gl.uniform1f(this.seedLoc,n)}}};var C0e=`
if (a == b) {
  return 1.0;
};
return a / b;`,S0e=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,qk=xt({opSnippet:C0e,packedOpSnippet:S0e,checkOutOfBounds:!0}),o8={kernelName:ia,backendName:"webgl",kernelFunc:qk};var i8="return a - b;",Kk=xt({opSnippet:i8,packedOpSnippet:i8,supportsComplex:!0,cpuKernelImpl:SH}),s8={kernelName:Pa,backendName:"webgl",kernelFunc:Kk};function Xk(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{dim:i}=r,s=b.parseAxisParam([i],o.shape),a=Hk({inputs:{x:o},backend:e,attrs:{reductionIndices:s,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,s),c=se({inputs:{x:a},backend:e,attrs:{shape:l}}),u=Kk({inputs:{a:o,b:c},backend:e}),d=Wk({inputs:{x:u},backend:e}),p=Hd({inputs:{x:d},backend:e,attrs:{axis:s,keepDims:!1}}),f=se({inputs:{x:p},backend:e,attrs:{shape:l}}),m=qk({inputs:{a:d,b:f},backend:e});return e.disposeIntermediateTensorInfo(a),e.disposeIntermediateTensorInfo(c),e.disposeIntermediateTensorInfo(u),e.disposeIntermediateTensorInfo(d),e.disposeIntermediateTensorInfo(p),e.disposeIntermediateTensorInfo(f),m}var a8={kernelName:Tc,backendName:"webgl",kernelFunc:Xk};function _0e(t){let{inputs:n,backend:e,attrs:r}=t,{logits:o}=n,{numSamples:i,seed:s,normalized:a}=r,l=a?o:Xk({inputs:{logits:o},backend:e,attrs:{dim:o.shape.length-1}}),c=l.shape[0],u=l.shape[1],d=new TS(c,u,i),p=d.getCustomSetupFunc(s),f=e.runWebGLProgram(d,[l],"int32",p);return a||e.disposeIntermediateTensorInfo(l),f}var l8={kernelName:db,backendName:"webgl",kernelFunc:_0e};var c8="return -x;";function I0e(t){let{inputs:n,backend:e}=t,{x:r}=n;if(e.shouldExecuteOnCPU([r])){let i=e.texData.get(r.dataId),[s,a]=hH(i.values,r.shape,r.dtype);return e.makeTensorInfo(a,r.dtype,s)}let o;return H().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new oi(r.shape,c8):o=new wr(r.shape,c8),e.runWebGLProgram(o,[r],r.dtype)}var u8={kernelName:pc,backendName:"webgl",kernelFunc:I0e};var E0e=Qn.nonMaxSuppressionV3Impl;function T0e(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l}=r,c=e.readSync(o.dataId),u=e.readSync(i.dataId),{selectedIndices:d}=E0e(c,u,s,a,l);return e.makeTensorInfo([d.length],"int32",new Int32Array(d))}var d8={kernelName:pb,backendName:"webgl",kernelFunc:T0e};var D0e=Qn.nonMaxSuppressionV4Impl;function N0e(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),{selectedIndices:p,validOutputs:f}=D0e(u,d,s,a,l,c);return[e.makeTensorInfo([p.length],"int32",new Int32Array(p)),e.makeTensorInfo([],"int32",new Int32Array([f]))]}var p8={kernelName:fb,backendName:"webgl",kernelFunc:N0e};var k0e=Qn.nonMaxSuppressionV5Impl;function A0e(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:n,backend:e,attrs:r}=t,{boxes:o,scores:i}=n,{maxOutputSize:s,iouThreshold:a,scoreThreshold:l,softNmsSigma:c}=r,u=e.readSync(o.dataId),d=e.readSync(i.dataId),p=s,f=a,m=l,h=c,{selectedIndices:g,selectedScores:y}=k0e(u,d,p,f,m,h);return[e.makeTensorInfo([g.length],"int32",new Int32Array(g)),e.makeTensorInfo([y.length],"float32",new Float32Array(y))]}var f8={kernelName:mb,backendName:"webgl",kernelFunc:A0e};var DS=class{constructor(n,e,r,o){this.variableNames=["indices"],this.outputShape=[n,e],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${r}),
                      float(index == coords.y)));
      }
    `}};var R0e=t=>{let{inputs:n,backend:e,attrs:r}=t,{indices:o}=n,{depth:i,onValue:s,offValue:a}=r,l=b.sizeFromShape(o.shape),c=new DS(l,i,s,a),u=se({inputs:{x:o},backend:e,attrs:{shape:[l]}}),d=e.runWebGLProgram(c,[u],o.dtype);e.disposeIntermediateTensorInfo(u);let p=[...o.shape,i],f=se({inputs:{x:d},backend:e,attrs:{shape:p}});return e.disposeIntermediateTensorInfo(d),f},m8={kernelName:mc,backendName:"webgl",kernelFunc:R0e};function Uy(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="complex64"){let o=al({inputs:{input:r},backend:e}),i=Uy({inputs:{x:o},backend:e}),s=Kd({inputs:{input:r},backend:e}),a=Uy({inputs:{x:s},backend:e}),l=Mr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return zy({attrs:{shape:r.shape,dtype:r.dtype,value:r.dtype==="string"?"":0},backend:e})}var h8={kernelName:Ac,backendName:"webgl",kernelFunc:Uy};function g8(t){let{inputs:n,backend:e}=t,{x:r}=n;if(r.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(r.dtype==="complex64"){let o=al({inputs:{input:r},backend:e}),i=g8({inputs:{x:o},backend:e}),s=Kd({inputs:{input:r},backend:e}),a=Uy({inputs:{x:s},backend:e}),l=Mr({inputs:{real:i,imag:a},backend:e});return e.disposeIntermediateTensorInfo(o),e.disposeIntermediateTensorInfo(i),e.disposeIntermediateTensorInfo(s),e.disposeIntermediateTensorInfo(a),l}else return zy({attrs:{shape:r.shape,dtype:r.dtype,value:1},backend:e})}var y8={kernelName:fc,backendName:"webgl",kernelFunc:g8};function O0e(t){let{inputs:n,backend:e,attrs:r}=t,{axis:o}=r;if(n.length===1)return pS({inputs:{input:n[0]},backend:e,attrs:{dim:o}});let i=n[0].shape,s=n[0].dtype;n.forEach(u=>{b.assertShapesMatch(i,u.shape,"All tensors passed to stack must have matching shapes"),b.assert(s===u.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=n.map(u=>{let d=pS({inputs:{input:u},backend:e,attrs:{dim:o}});return a.push(d),d}),c=Gk({inputs:l,backend:e,attrs:{axis:o}});return a.forEach(u=>e.disposeIntermediateTensorInfo(u)),c}var x8={kernelName:hc,backendName:"webgl",kernelFunc:O0e};var NS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=e.map((c,u)=>c[0]+n[u]+c[1]);let o=n.length,i=je(o),s=e.map(c=>c[0]).join(","),a=e.map((c,u)=>c[0]+n[u]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${s};
        int end = ${a};
        uniform float value;

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${i} start = ${i}(${s});
      ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${i} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var kS=class{constructor(n,e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((h,g)=>h[0]+n[g]+h[1]);let o=n.length,i=je(o),s=e.map(h=>h[0]).join(","),a=e.map((h,g)=>h[0]+n[g]).join(","),l=cn("rc",o),c=cn("source",o),u=`${l[o-1]} < ${this.outputShape[o-1]}`,d=o===1?"source":`vec2(${c.slice(-2).join()})`,p=[`${i} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${u}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${u}) {`],f=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,g=o===1?2:4;h<g;h++)m+=`
        ${p[h]}
        if (${f}) {
          result[${h}] = float(value);
        } else {
          ${i} source = rc - start;
          result[${h}] = getChannel(getX(${c.join()}), ${d});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${i} start = ${i}(${s});
      const ${i} end = ${i}(${a});
      uniform float value;

      void main() {
        ${i} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}getCustomSetupFunc(n){return(e,r)=>{this.valueLoc==null&&(this.valueLoc=e.getUniformLocationNoThrow(r,"value")),e.gl.uniform1f(this.valueLoc,n)}}};var Yk=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{paddings:i,constantValue:s}=r,a=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kS(o.shape,i,s):new NS(o.shape,i,s),l=a.getCustomSetupFunc(s);return e.runWebGLProgram(a,[o],o.dtype,l)},v8={kernelName:gc,backendName:"webgl",kernelFunc:Yk};var M0e=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,F0e=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));
  `+Zc+`
  return result;
`,P0e=xt({opSnippet:M0e,packedOpSnippet:F0e}),b8={kernelName:Ca,backendName:"webgl",kernelFunc:P0e};function $0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{axis:i,keepDims:s}=r,a=o.shape.length,l=[],c=b.parseAxisParam(i,o.shape),u=c,d=T.getAxesPermutation(u,a),p=o;d!=null&&(p=Ht({inputs:{x:o},backend:e,attrs:{perm:d}}),u=T.getInnerMostAxes(u.length,a),l.push(p)),T.assertAxesAreInnerMostDims("prod",u,a);let f;if(e.shouldExecuteOnCPU([p])){let m=e.texData.get(p.dataId).values,{outVals:h,outShape:g,outDtype:y}=gH(p.shape,p.dtype,m,u);f=e.makeTensorInfo(g,y,h)}else{let[m,h]=T.computeOutAndReduceShapes(p.shape,u),g=b.sizeFromShape(h),y=se({inputs:{x:p},backend:e,attrs:{shape:[-1,g]}}),v=id(o.dtype),S=no(y,v,"prod",e);f=se({inputs:{x:S},backend:e,attrs:{shape:m}}),l.push(y),l.push(S)}if(s){l.push(f);let m=T.expandShapeToKeepDim(f.shape,c);f=se({inputs:{x:f},backend:e,attrs:{shape:m}})}return l.forEach(m=>e.disposeIntermediateTensorInfo(m)),f}var w8={kernelName:Pf,backendName:"webgl",kernelFunc:$0e};var Qk=t=>{let{backend:n,attrs:e}=t,{start:r,stop:o,step:i,dtype:s}=e,a=yH(r,o,i,s);return n.makeTensorInfo([a.length],s,a)},C8={kernelName:$f,backendName:"webgl",kernelFunc:Qk};var L0e="return 1.0 / x;",V0e=be({opSnippet:L0e}),S8={kernelName:Sa,backendName:"webgl",kernelFunc:V0e};var B0e=Mn+`
  return (x < 0.0) ? 0.0 : x;
`,z0e=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,U0e=be({opSnippet:B0e,packedOpSnippet:z0e}),_8={kernelName:_a,backendName:"webgl",kernelFunc:U0e};var j0e=Mn+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,G0e=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,W0e=be({opSnippet:j0e,packedOpSnippet:G0e}),I8={kernelName:Ia,backendName:"webgl",kernelFunc:W0e};var AS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var RS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p;i?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function H0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new RS(o.shape,l,c,i,s):new AS(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],"float32")}var E8={kernelName:bc,backendName:"webgl",kernelFunc:H0e};var OS=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function q0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new OS(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var T8={kernelName:Bf,backendName:"webgl",kernelFunc:q0e};var MS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${u[0]/d[0]},
          ${u[1]/d[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var FS=class{constructor(n,e,r,o,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[s,a,l,c]=n;this.outputShape=[s,e,r,c];let u=[o&&e>1?a-1:a,o&&r>1?l-1:l],d=[o&&e>1?e-1:e,o&&r>1?r-1:r],p=o?"0.5":"0.0",f;i?f="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${u[0]/d[0]},
          ${u[1]/d[1]},
          ${u[1]/d[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${c-1};
        bool hasNextRow = coords.z < ${r-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function K0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o}=n,{alignCorners:i,halfPixelCenters:s,size:a}=r,[l,c]=a,u=H().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new FS(o.shape,l,c,i,s):new MS(o.shape,l,c,i,s);return e.runWebGLProgram(u,[o],o.dtype)}var D8={kernelName:vc,backendName:"webgl",kernelFunc:K0e};var PS=class{constructor(n,e,r){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;let[,o,i]=e,[,s,a]=n,l=[r&&s>1?o-1:o,r&&a>1?i-1:i],c=[r&&s>1?s-1:s,r&&a>1?a-1:a],u=l[0]/c[0],d=l[1]/c[1],p=1/u,f=1/d,m=Math.ceil(p)*2+2,h=Math.ceil(f)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${u});
        const float widthScale = float(${d});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${f});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${s}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${c[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${c[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${r} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${i}) - 1),
                ${r} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function X0e(t){let{inputs:n,backend:e,attrs:r}=t,{images:o,dy:i}=n,{alignCorners:s}=r,a=new PS(i.shape,o.shape,s);return e.runWebGLProgram(a,[i],i.dtype)}var N8={kernelName:Vf,backendName:"webgl",kernelFunc:X0e};var $S=class{constructor(n,e){this.variableNames=["x"];let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);if(this.outputShape=n,r===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${n[0]} - coord - 1));
        }
      `;return}let o=a=>e.indexOf(a)!==-1&&n[a]!==1?`${n[a]} - coords[${a}] - 1`:`coords[${a}]`,i=n.map((a,l)=>o(l)).join(","),s=je(r);this.userCode=`
      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${i}));
      }
    `}};var LS=class{constructor(n,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let r=n.length;if(r>4)throw new Error(`WebGL backend: Reverse of rank-${r} tensor is not yet supported`);this.outputShape=n;let o=cn("rc",r),i=`${o[r-1]} + 1 < ${this.outputShape[r-1]}`,s=`${o[r-2]} + 1 < ${this.outputShape[r-2]}`,a=je(r);r===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${n[0]} - rc - 1),
            ${n[0]} - rc - 1);
          if(${i}){
              result.g = getChannel(getX(${n[0]} - (rc  + 1) - 1),
                ${n[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${i}){
            result.g = ${c(o.slice())};
          }
          if(${s}) {
            result.b = ${u(o.slice())};
            if(${i}) {
              result.a = ${d(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return p(m)}function c(m){return m[r-1]="("+m[r-1]+" + 1)",p(m)}function u(m){return m[r-2]="("+m[r-2]+" + 1)",p(m)}function d(m){return m[r-1]="("+m[r-1]+" + 1)",m[r-2]="("+m[r-2]+" + 1)",p(m)}function p(m){let h=n.map((v,S)=>f(S,m)),g=h.join(","),y=h.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${y}))`}function f(m,h){return e.indexOf(m)!==-1&&n[m]!==1?`${n[m]} - ${h[m]} - 1`:`${h[m]}`}}};function Y0e(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{dims:i}=r,s=o.shape.length,a=b.parseAxisParam(i,o.shape);if(s===0)return un({inputs:{x:o},backend:e});let l=H().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LS(o.shape,a):new $S(o.shape,a);return e.runWebGLProgram(l,[o],o.dtype)}var k8={kernelName:wc,backendName:"webgl",kernelFunc:Y0e};var VS=class{constructor(n,e){this.variableNames=["Image"],this.outputShape=[];let r=n[1],o=n[2];this.outputShape=n;let i="";typeof e=="number"?i=`float outputValue = ${e.toFixed(2)};`:i=`
        vec3 fill = vec3(${e.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        uniform vec4 params;
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${i}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${r}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}getCustomSetupFunc(n,e,r,o){return(i,s)=>{this.paramsLoc==null&&(this.paramsLoc=i.getUniformLocationNoThrow(s,"params")),i.gl.uniform4f(this.paramsLoc,n,e,r,o)}}};var A8={kernelName:bb,backendName:"webgl",kernelFunc:({inputs:t,attrs:n,backend:e})=>{let{image:r}=t,{radians:o,fillValue:i,center:s}=n,a=e,l=new VS(r.shape,i),[c,u]=T.getImageCenter(s,r.shape[1],r.shape[2]),d=l.getCustomSetupFunc(c,u,Math.sin(o),Math.cos(o));return a.runWebGLProgram(l,[r],r.dtype,d)}};var Q0e=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Z0e=be({opSnippet:Q0e}),R8={kernelName:Ea,backendName:"webgl",kernelFunc:Z0e};var J0e="return inversesqrt(x);",eve=be({opSnippet:J0e,cpuKernelImpl:xH}),O8={kernelName:Ta,backendName:"webgl",kernelFunc:eve};var Km=class{constructor(n,e,r,o,i,s,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=s;let l=je(i.length),c=je(s.length),u="";r===1?u="i":r===2&&(u="i, j");let d=`getIndices(${u})`,p="";o===1?p="i":o===2&&(p="i, coords[1]");let f=`getUpdates(${p})`,m=e>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${i});

        void main() {
          ${c} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${n}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${e}; j++) {
              int index = round(${d});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${f};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function tve(t){let{inputs:n,backend:e,attrs:r}=t,{indices:o,updates:i}=n,{shape:s}=r,{sliceRank:a,numUpdates:l,sliceSize:c,strides:u,outputSize:d}=T.calculateShapes(i,o,s),p=[d/c,c];if(d===0)return e.makeTensorInfo(s,o.dtype);let f=se({inputs:{x:o},backend:e,attrs:{shape:[l,a]}}),m=se({inputs:{x:i},backend:e,attrs:{shape:[l,c]}}),h=e.makeTensorInfo([],"float32",new Float32Array([0])),g=new Km(l,a,f.shape.length,m.shape.length,u,p),y=e.runWebGLProgram(g,[m,f,h],m.dtype),v=se({inputs:{x:y},backend:e,attrs:{shape:s}});return e.disposeIntermediateTensorInfo(f),e.disposeIntermediateTensorInfo(m),e.disposeIntermediateTensorInfo(y),e.disposeIntermediateTensorInfo(h),v}var M8={kernelName:hb,backendName:"webgl",kernelFunc:tve};var BS=class{constructor(n,e,r){this.variableNames=["c","a","b"],this.outputShape=e;let o,i;if(r>4)throw Error(`Where for rank ${r} is not yet supported`);if(r===1)i="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],c=[];for(let u=0;u<e.length;u++)c.push(`${a[u]}`),u<n&&l.push(`${a[u]}`);o=l.join(),i=c.join()}let s=je(r);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${i}));
        } else {
          setOutput(getB(${i}));
        }
      }
    `}};function nve(t){let{inputs:n,backend:e}=t,{condition:r,t:o,e:i}=n,s=new BS(r.shape.length,o.shape,o.shape.length);return e.runWebGLProgram(s,[r,o,i],Cn(o.dtype,i.dtype))}var F8={kernelName:Cc,backendName:"webgl",kernelFunc:nve};var rve=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,ove=be({opSnippet:rve}),P8={kernelName:Da,backendName:"webgl",kernelFunc:ove};var ive="return 1.0 / (1.0 + exp(-1.0 * x));",sve=be({opSnippet:ive}),$8={kernelName:Ra,backendName:"webgl",kernelFunc:sve};var ave=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,lve=be({opSnippet:ave}),L8={kernelName:Aa,backendName:"webgl",kernelFunc:lve};var cve=kC+`
  return sin(x);
`,uve=be({opSnippet:cve}),V8={kernelName:Na,backendName:"webgl",kernelFunc:uve};var dve=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,pve=be({opSnippet:dve}),B8={kernelName:ka,backendName:"webgl",kernelFunc:pve};var fve=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,mve=be({opSnippet:fve}),z8={kernelName:Oa,backendName:"webgl",kernelFunc:mve};var hve=t=>{let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{blockShape:i,paddings:s}=r;b.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=i.reduce((y,v)=>y*v),l=[[0,0]];l.push(...s);for(let y=1+i.length;y<o.shape.length;++y)l.push([0,0]);let c=[],u=Yk({inputs:{x:o},backend:e,attrs:{paddings:l,constantValue:0}}),d=T.getReshaped(u.shape,i,a,!1),p=T.getPermuted(d.length,i.length,!1),f=T.getReshapedPermuted(u.shape,i,a,!1),m=se({inputs:{x:u},backend:e,attrs:{shape:d}}),h=Ht({inputs:{x:m},backend:e,attrs:{perm:p}}),g=se({inputs:{x:h},backend:e,attrs:{shape:f}});return c.push(u),c.push(m),c.push(h),c.forEach(y=>e.disposeIntermediateTensorInfo(y)),g},U8={kernelName:Ic,backendName:"webgl",kernelFunc:hve};function gve(t){let{inputs:n,backend:e}=t,{indices:r,values:o,denseShape:i,defaultValue:s}=n;if(i.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${i.shape}`);if(r.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${s.shape}`);let a=e.readSync(r.dataId),l=e.readSync(o.dataId),c=e.readSync(i.dataId),u=e.readSync(s.dataId)[0],[d,p,f,m,h]=bH(a,r.shape,r.dtype,l,o.dtype,c,u);return[e.makeTensorInfo(p,r.dtype,d),e.makeTensorInfo([p[0]],o.dtype,f),e.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),e.makeTensorInfo([h.length],r.dtype,new Int32Array(h))]}var j8={kernelName:gb,backendName:"webgl",kernelFunc:gve};function yve(t){let{inputs:n,backend:e}=t,{inputIndices:r,inputShape:o,newShape:i}=n;if(r.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(i.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${i.shape}`);let s=Array.from(e.readSync(o.dataId)),a=e.readSync(r.dataId),l=Array.from(e.readSync(i.dataId)),[c,u,d]=wH(a,r.shape,r.dtype,s,l);return[e.makeTensorInfo(u,r.dtype,c),e.makeTensorInfo([d.length],i.dtype,new Int32Array(d))]}var G8={kernelName:yb,backendName:"webgl",kernelFunc:yve};function xve(t){let{inputs:n,backend:e,attrs:r}=t,{sparseIndices:o,sparseValues:i,defaultValue:s}=n,{outputShape:a}=r,{sliceRank:l,numUpdates:c,strides:u,outputSize:d}=T.calculateShapes(i,o,a),p=!1,f=new Km(c,l,o.shape.length,i.shape.length,u,[d,1],p),m=e.runWebGLProgram(f,[i,o,s],i.dtype),h=se({inputs:{x:m},backend:e,attrs:{shape:a}});return e.disposeIntermediateTensorInfo(m),h}var W8={kernelName:xb,backendName:"webgl",kernelFunc:xve};function vve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{numOrSizeSplits:i,axis:s}=r,a=b.parseAxisParam(s,o.shape)[0],l=T.prepareSplitSize(o,i,a),c=o.shape.length,u=new Array(c).fill(0),d=o.shape.slice();return l.map(p=>{let f=[...d];f[a]=p;let m=sl({inputs:{x:o},backend:e,attrs:{begin:u,size:f}});return u[a]+=p,m})}var H8={kernelName:Ec,backendName:"webgl",kernelFunc:vve};var bve="return sqrt(x);",wve=be({opSnippet:bve}),q8={kernelName:Ma,backendName:"webgl",kernelFunc:wve};var Cve="return x * x;",Sve=be({opSnippet:Cve}),K8={kernelName:zf,backendName:"webgl",kernelFunc:Sve};var X8="return (a - b) * (a - b);",_ve=xt({opSnippet:X8,packedOpSnippet:X8}),Y8={kernelName:Fa,backendName:"webgl",kernelFunc:_ve};function Ive({inputs:t,attrs:n,backend:e}){let{x:r}=t,o=Mn+`
    return x > 0.0 ? 1.0 : float(${n.alpha});
  `,i=new wr(r.shape,o);return e.runWebGLProgram(i,[r],r.dtype)}var Q8={kernelName:Va,backendName:"webgl",kernelFunc:Ive};var zS=class{constructor(n,e,r){this.variableNames=["x"],this.outputShape=r;let o=r.length,i=je(r.length),s=je(r.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=r.map((c,u)=>(l++,r.length===1?`coords * strides[${u}] + begin[${u}]`:`coords[${l-1}] * strides[${u}] + begin[${u}]`)).join(",")}this.userCode=`
      ${i} begin = ${i}(${n});
      ${i} strides = ${i}(${e});

      void main() {
        ${s} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function Eve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{begin:i,end:s,strides:a,beginMask:l,endMask:c,ellipsisMask:u,newAxisMask:d,shrinkAxisMask:p}=r,{nonStrided:f,$begin:m,$strides:h,size:g,newShape:y,outShape:v}=qn.sliceInfo(o.shape,i,s,a,l,c,u,d,p),S=se({inputs:{x:o},backend:e,attrs:{shape:y}}),C;if(f){let E=sl({inputs:{x:S},backend:e,attrs:{begin:m,size:g}});C=se({inputs:{x:E},backend:e,attrs:{shape:v}}),e.disposeIntermediateTensorInfo(E)}else if(v.some(E=>E===0))C=e.makeTensorInfo(v,o.dtype,[]);else if(e.shouldExecuteOnCPU([S])){let O=e.texData.get(S.dataId).values,R=Ie(S.shape,S.dtype,O),P=CH(v,R,h,m);C=e.makeTensorInfo(v,S.dtype,P.values)}else{let D=new zS(m,h,v);C=e.runWebGLProgram(D,[S],S.dtype)}let I=se({inputs:{x:C},backend:e,attrs:{shape:v}});return e.disposeIntermediateTensorInfo(S),e.disposeIntermediateTensorInfo(C),I}var Z8={kernelName:Uf,backendName:"webgl",kernelFunc:Eve};var Tve="return tan(x);",Dve=be({opSnippet:Tve}),J8={kernelName:$a,backendName:"webgl",kernelFunc:Dve};var Nve=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,kve=be({opSnippet:Nve}),e6={kernelName:La,backendName:"webgl",kernelFunc:kve};var US=class{constructor(n,e){this.variableNames=["A"];let r=new Array(n.length);for(let s=0;s<r.length;s++)r[s]=n[s]*e[s];this.outputShape=r,this.rank=r.length;let o=je(this.rank),i=Ave(n);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${i}));
      }
    `}};function Ave(t){let n=t.length;if(n>5)throw Error(`Tile for rank ${n} is not yet supported`);if(n===1)return`imod(resRC, ${t[0]})`;let e=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[];for(let o=0;o<t.length;o++)r.push(`imod(${e[o]}, ${t[o]})`);return r.join()}function Zk(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{reps:i}=r;if(o.dtype==="string"||o.shape.length>5){let l=e.readSync(o.dataId),c=o.dtype==="string"?l.map(p=>b.decodeString(p)):l,u=Ie(o.shape,o.dtype,c),d=_H(u,i);return e.makeTensorInfo(d.shape,d.dtype,d.values)}let s=new US(o.shape,i);return e.runWebGLProgram(s,[o],o.dtype)}var t6={kernelName:ns,backendName:"webgl",kernelFunc:Zk};function Rve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o}=n,{k:i,sorted:s}=r,a=e.readSync(o.dataId),[l,c]=IH(a,o.shape,o.dtype,i,s);return[e.makeTensorInfo(l.shape,l.dtype,l.values),e.makeTensorInfo(c.shape,c.dtype,c.values)]}var n6={kernelName:jf,backendName:"webgl",kernelFunc:Rve};var jS=class{constructor(n,e,r,o,i,s){this.variableNames=["Image","Transforms"],this.outputShape=s;let a=r==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${n} && 0 <= coordX && coordX < ${e}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${i});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${i});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${e}));
                float mapY = mapCoord(inY, float(${n}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function Ove(t){let{inputs:n,backend:e,attrs:r}=t,{image:o,transforms:i}=n,{interpolation:s,fillMode:a,fillValue:l,outputShape:c}=r,[u,d,p,f]=o.shape,[m,h]=c??[d,p],g=[u,m,h,f],y=new jS(d,p,s,a,l,g);return e.runWebGLProgram(y,[o,i],"float32")}var r6={kernelName:vb,backendName:"webgl",kernelFunc:Ove};function Mve(t){let{inputs:n,attrs:e,backend:r}=t,{axis:o}=e,{x:i}=n;ms(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let s=r.readSync(i.dataId),{outputValues:a,outputShape:l,indices:c}=EH(s,o,i.shape,i.dtype);return[r.makeTensorInfo(l,i.dtype,a),r.makeTensorInfo([c.length],"int32",c)]}var o6={kernelName:Gf,backendName:"webgl",kernelFunc:Mve};function Fve(t){let{inputs:n,backend:e,attrs:r}=t,{value:o}=n,{axis:i}=r;i<0&&(i+=o.shape.length);let s=o,a=s.shape.length,l=o.shape[i],c=new Array(a-1),u=0;for(let h=0;h<a;h++)h!==i&&(c[u++]=s.shape[h]);let d=[],p=new Array(a).fill(0),f=s.shape.slice();f[i]=1;let m=new Array(l);for(let h=0;h<m.length;h++){p[i]=h;let g=sl({inputs:{x:s},backend:e,attrs:{begin:p,size:f}}),y=se({inputs:{x:g},backend:e,attrs:{shape:c}});m[h]=y,d.push(g)}return d.forEach(h=>e.disposeIntermediateTensorInfo(h)),m}var i6={kernelName:Nc,backendName:"webgl",kernelFunc:Fve};var GS=class{constructor(n,e){this.variableNames=["x","segmentIds"];let r=n.windowSize,o=n.batchSize,i=n.inSize,s=n.numSegments,a=s*Math.ceil(i/r);this.outputShape=[o,a];let l="0.0",c="sumValue",u=Math.floor(r/4)*4,d=r%4,p=`
        sumValue += dot(values, segFilter);
    `,f="";i%r>0&&(f=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return initializationValue;
        }
      `);let m="";i%r>0&&(m=`
        if (inIdx < 0 || inIdx >= ${i}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${f}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${s})) * float(${r}));
        int currentSeg = int(mod(float(outIdx), float(${s})));

        float sumValue = 0.0;

        for (int i = 0; i < ${u}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${u};
        if (${d===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${d===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${d===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${c});
      }
    `}};function Pve(t){let{inputs:n,backend:e,attrs:r}=t,{x:o,segmentIds:i}=n,{numSegments:s}=r,a=o.shape.length,l=[],c=0,u=T.getAxesPermutation([c],a),d=o;u!=null&&(d=Ht({inputs:{x:o},backend:e,attrs:{perm:u}}),l.push(d),c=T.getInnerMostAxes(1,a)[0]);let p=T.segment_util.computeOutShape(d.shape,c,s),f=b.sizeFromShape([d.shape[c]]),m=se({inputs:{x:d},backend:e,attrs:{shape:[-1,f]}});l.push(m);let h=id(o.dtype),g=(C,I,E,D,O)=>{let R=C.shape[0],P=C.shape[1],U=T.segment_util.segOpComputeOptimalWindowSize(P,O),G={windowSize:U,inSize:P,batchSize:R,numSegments:O},q=new GS(G,I),X=e.compileAndRun(q,[C,E],D);if(l.push(X),X.shape[1]===O)return X;let K=Qk({backend:e,attrs:{start:0,stop:O,step:1,dtype:"float32"}}),Y=Zk({inputs:{x:K},backend:e,attrs:{reps:[P/U]}});return l.push(K),l.push(Y),g(X,I,Y,D,O)},y=g(m,"unsortedSegmentSum",i,h,s),v=se({inputs:{x:y},backend:e,attrs:{shape:p}}),S=v;if(u!=null){l.push(v);let C=T.getUndoAxesPermutation(u);S=Ht({inputs:{x:S},backend:e,attrs:{perm:C}})}return l.forEach(C=>e.disposeIntermediateTensorInfo(C)),S}var s6={kernelName:kc,backendName:"webgl",kernelFunc:Pve};var $ve=[z5,U5,nq,oq,iq,sq,lq,cq,uq,dq,mq,hq,gq,yq,vq,xq,bq,Cq,wq,Sq,_q,Iq,Eq,Dq,Nq,Oq,Fq,Pq,Lq,GH,Bq,Uq,jq,zq,Wq,Hq,Gq,qq,Kq,Xq,Zq,Jq,e5,n5,r5,t5,o5,i5,s5,a5,l5,c5,u5,p5,f5,h5,g5,y5,x5,b5,w5,C5,S5,_5,I5,E5,T5,D5,jH,N5,Vq,k5,A5,R5,WH,O5,M5,F5,$5,P5,L5,V5,B5,G5,q5,H5,K5,X5,Q5,W5,J5,e8,t8,n8,r8,l8,YH,u8,d8,p8,f8,kq,m8,y8,x8,v8,b8,HH,w8,C8,Aq,o8,S8,I8,_8,ZH,E8,T8,D8,N8,k8,A8,R8,O8,M8,F8,P8,$8,L8,V8,B8,Tq,a8,z8,U8,j8,G8,W8,H8,q8,K8,Y8,Q8,Z8,s8,eq,J8,e6,t6,n6,r6,tq,o6,i6,s6,h8];for(let t of $ve)Cb(t);function Vve(t,n){if(t&1&&(w(0,"p",7),_(1," Predicted Emotion: "),w(2,"strong"),_(3),x()()),t&2){let e=re();$(3),At(e.predictedEmotion)}}var WS=class t{constructor(n){this.cdr=n;this.loadModel()}inputText="";predictedEmotion=null;model;tokenizer={};emotions=["admiration","amusement","anger","annoyance","approval","caring","confusion","curiosity","desire","disappointment","disapproval","disgust","embarrassment","excitement","fear","gratitude","grief","joy","love","nervousness","optimism","pride","realization","relief","remorse","sadness","surprise","neutral"];VOCAB_SIZE=1e3;MAX_LENGTH=50;OOV_INDEX=1;async loadModel(){this.model=await fN("/assets/models/model.json"),console.log("Model loaded successfully:"),this.model.summary();let n=await fetch("/assets/models/tokenizer.json");this.tokenizer=await n.json(),console.log("Tokenizer mapping loaded:",this.tokenizer)}textToSequence(n){let e=n.trim().toLowerCase().split(/\s+/),r=[];for(let o of e){let i=this.tokenizer[o];(!i||i>=this.VOCAB_SIZE)&&(i=this.OOV_INDEX),r.push(i)}return r}padSequence(n){if(n.length>this.MAX_LENGTH)return n.slice(0,this.MAX_LENGTH);for(;n.length<this.MAX_LENGTH;)n.push(0);return n}async predictEmotion(){if(console.log("button clicked"),!this.model){console.error("Model not loaded yet.");return}let n=this.textToSequence(this.inputText);n=this.padSequence(n);let e=Bc([n],[1,this.MAX_LENGTH],"int32"),o=await this.model.predict(e).data(),i=o.indexOf(Math.max(...o));this.predictedEmotion=this.emotions[i],this.cdr.markForCheck(),console.log("Predicted Emotion:",this.predictedEmotion)}static \u0275fac=function(e){return new(e||t)(oe(Ut))};static \u0275cmp=Pt({type:t,selectors:[["app-emotion-analyze-prototype"]],decls:10,vars:2,consts:[[1,"container","mt-5"],[1,"card","shadow-lg","p-4"],[1,"text-center","text-primary","mb-4"],[1,"form-group"],["rows","3","placeholder","Enter your text here...",1,"form-control","mb-3",3,"ngModelChange","ngModel"],[1,"btn","btn-primary","btn-block",3,"click"],["class","mt-3 alert alert-info text-center",4,"ngIf"],[1,"mt-3","alert","alert-info","text-center"]],template:function(e,r){e&1&&(w(0,"div",0)(1,"div",1)(2,"h2",2),_(3,"Emotion Classifier"),x(),w(4,"div",3)(5,"textarea",4),jr("ngModelChange",function(i){return co(r.inputText,i)||(r.inputText=i),i}),_(6,"            "),x()(),w(7,"button",5),fe("click",function(){return r.predictEmotion()}),_(8," Predict Emotion "),x(),ae(9,Vve,4,1,"p",6),x()()),e&2&&($(5),Ur("ngModel",r.inputText),$(4),W("ngIf",r.predictedEmotion))},dependencies:[on,xn,sf,pr,Yr,Bu],encapsulation:2})};var a6=[{path:"",component:Yv,canActivate:[Rv]},{path:"home",component:Av,canActivate:[Dr]},{path:"pretrades",component:Hv,canActivate:[Dr]},{path:"pretradelog",component:af,canActivate:[Dr]},{path:"posttrades",component:qv,canActivate:[Dr]},{path:"posttradelog",component:lf,canActivate:[Dr]},{path:"emotions",component:Xv,canActivate:[Dr]},{path:"tradejournal",component:Qv,canActivate:[Dr]},{path:"individualTrade",component:cf,canActivate:[Dr]},{path:"meditationhub",component:Zv,canActivate:[Dr]},{path:"analytics",component:Jv,canActivate:[Dr]},{path:"admin/emotionquestion",component:Kv,canActivate:[Dr]},{path:"mlemotion",component:WS,canActivate:[Dr]},{path:"**",redirectTo:""}];var l6={providers:[QO(),_F(a6),kM(AM())]};function Bve(t,n){t&1&&(Os(0),w(1,"div",1),j(2,"router-outlet"),x(),Ms())}function zve(t,n){if(t&1){let e=mt();w(0,"div",19)(1,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/home"))}),j(2,"i",21),_(3,"Dashboard"),x(),w(4,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/emotions"))}),j(5,"i",22),_(6,"Morning Check-In"),x(),w(7,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/tradejournal"))}),j(8,"i",23),_(9,"Trade Journal"),x(),w(10,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/meditationhub"))}),j(11,"i",24),_(12,"Meditation Hub"),x(),w(13,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/analytics"))}),j(14,"i",25),_(15,"Analytics"),x(),w(16,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/pretrades"))}),j(17,"i",26),_(18,"PreTrades"),x(),w(19,"a",20),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/posttrades"))}),j(20,"i",27),_(21,"PostTrades"),x()()}}function Uve(t,n){if(t&1){let e=mt();w(0,"div",28)(1,"div",29)(2,"button",30),j(3,"i",31),x(),_(4,"\xA0\xA0 "),w(5,"p",32),_(6),x()(),w(7,"button",33),fe("click",function(){Ce(e);let o=re(2);return Se(o.logOut())}),_(8,"Logout\xA0\xA0\xA0"),j(9,"i",34),x()()}if(t&2){let e=re(2);$(2),W("disabled",!0),$(4),Ge("Welcome, ",e.supabaseService.currentUsername(),"!")}}function jve(t,n){if(t&1){let e=mt();w(0,"button",35),fe("click",function(){Ce(e);let o=re(2);return Se(o.navigateToUrl("/home"))}),j(1,"img",36),x()}}function Gve(t,n){if(t&1){let e=mt();Os(0),w(1,"div",2)(2,"nav",3)(3,"div",4)(4,"div",5)(5,"button",6),fe("click",function(){Ce(e);let o=re();return Se(o.navigateToUrl("/home"))}),w(6,"img",7),fe("click",function(){Ce(e);let o=re();return Se(o.navigateToUrl("/home"))}),x()(),w(7,"button",8),fe("click",function(){Ce(e);let o=re();return Se(o.closeSidebar())}),x()(),ae(8,zve,22,0,"div",9),x(),ae(9,Uve,10,2,"div",10),x(),w(10,"div",11)(11,"nav",12)(12,"div",13)(13,"div",14)(14,"button",15),fe("click",function(){Ce(e);let o=re();return Se(o.toggleSidebar())}),j(15,"span",16),x(),ae(16,jve,2,0,"button",17),x()()(),w(17,"div",18),j(18,"router-outlet"),x()()(),Ms()}if(t&2){let e=re();$(2),zi("collapsed",e.sidebarCollapsed()),$(6),W("ngIf",e.loginStatus()),$(),W("ngIf",e.loginStatus()),$(),zi("expanded",e.sidebarCollapsed()),$(6),W("ngIf",e.sidebarCollapsed())}}var HS=class t{constructor(n,e,r,o,i){this.cdr=n;this.supabaseService=e;this.router=r;this.route=o;this.platformId=i;this.loginStatus=Cl(()=>e.loginStatus())}title="TR-prototype";loginStatus;sidebarCollapsed=lo(!1);isMobile=lo(!1);resizeObserver;ngOnInit(){this.checkScreenSize(),Hr(this.platformId)&&(this.sidebarCollapsed.set(this.isMobile()),this.resizeObserver=new ResizeObserver(()=>{this.checkScreenSize(),this.cdr.detectChanges()}),this.resizeObserver.observe(document.body),console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngAfterViewInit(){Hr(this.platformId)&&(console.log("supabase login status before in init: ",this.supabaseService.loginStatus()),setTimeout(()=>{console.log("supabase login status after in init: ",this.supabaseService.loginStatus()),this.supabaseService.loginStatus()&&this.route.queryParams.subscribe(n=>{let e=n.returnUrl;this.router.url==="/"?this.router.navigate(["/home"]):e?this.router.navigate([e]):this.router.navigate(["/default"])})},1e3))}ngOnDestroy(){Hr(this.platformId)&&this.resizeObserver&&this.resizeObserver.disconnect()}async logOut(){await this.supabaseService.signOut(),this.router.navigateByUrl("/")}toggleSidebar(){this.sidebarCollapsed.update(n=>!n),this.cdr.detectChanges()}navigateToUrl(n){this.router.navigateByUrl(n)}closeSidebar(){this.sidebarCollapsed.set(!0),this.cdr.detectChanges()}checkScreenSize(){Hr(this.platformId)&&this.isMobile.set(window.innerWidth<768)}static \u0275fac=function(e){return new(e||t)(oe(Ut),oe(jt),oe(mo),oe(yi),oe(Oo))};static \u0275cmp=Pt({type:t,selectors:[["app-root"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"container-fluid","p-0"],[1,"sidebar-container"],["id","sidebar",1,"d-flex","flex-column","h-100"],[1,"p-3","flex-grow-1"],[1,"mb-3","d-flex","align-items-center","justify-content-between"],[1,"text-decoration-none","me-auto","btn","btn-link","p-0","me-3",3,"click"],["src","/trading_rehab_main_logo.png",1,"img-fluid",2,"height","36px",3,"click"],["type","button",1,"btn-close","d-md-none",3,"click"],["class","nav flex-column",4,"ngIf"],["class","p-3 border-top mt-auto",4,"ngIf"],[1,"content"],[1,"navbar","navbar-expand-lg"],[1,"container-fluid"],[1,"d-flex","align-items-center"],[1,"btn","me-2",3,"click"],[1,"navbar-toggler-icon"],["class","btn navbar-branding text-decoration-none me-auto",3,"click",4,"ngIf"],[1,"container-fluid","p-4"],[1,"nav","flex-column"],[1,"nav-link",3,"click"],[1,"bi","bi-columns-gap","me-3"],[1,"bi","bi-brightness-high","me-3"],[1,"bi","bi-bookmark-check","me-3"],[1,"bi","bi-person-arms-up","me-3"],[1,"bi","bi-clipboard-data","me-3"],[1,"bi","bi-ui-checks-grid","me-3"],[1,"bi","bi-ui-checks","me-3"],[1,"p-3","border-top","mt-auto"],[1,"d-flex","align-items-center","mb-2"],["title","Profile",1,"btn","btn-link","p-0","me-2",3,"disabled"],[1,"bi","bi-person-circle","text-black",2,"font-size","30px"],[1,"text-black","mb-0"],[1,"btn","btn-outline-secondary","btn-tr","w-100",3,"click"],[1,"bi","bi-box-arrow-right"],[1,"btn","navbar-branding","text-decoration-none","me-auto",3,"click"],["src","/trading-rehab-logo.png","width","50px",1,"img-fluid"]],template:function(e,r){e&1&&ae(0,Bve,3,0,"ng-container",0)(1,Gve,19,7,"ng-container",0),e&2&&(W("ngIf",!r.supabaseService.loginStatus()),$(),W("ngIf",r.supabaseService.loginStatus()))},dependencies:[on,xn,s1],styles:[".sidebar-container[_ngcontent-%COMP%]{display:flex;width:100%;position:relative}#sidebar[_ngcontent-%COMP%]{width:250px;position:fixed;top:0;left:0;height:100vh;z-index:999;background:#634aff0d;-webkit-backdrop-filter:blur(50px);backdrop-filter:blur(50px);transition:all .3s;box-shadow:0 0 10px #0000001a}#sidebar.collapsed[_ngcontent-%COMP%]{margin-left:-250px}.content[_ngcontent-%COMP%]{width:calc(100% - 250px);margin-left:250px;transition:all .3s;min-height:100vh}.content.expanded[_ngcontent-%COMP%]{width:100%;margin-left:0}@media (max-width: 768px){#sidebar[_ngcontent-%COMP%]{margin-left:-250px}#sidebar[_ngcontent-%COMP%]:not(.collapsed){margin-left:0}.content[_ngcontent-%COMP%]{width:100%;margin-left:0}}.nav-link[_ngcontent-%COMP%]{padding:15px 20px;color:#333;border-bottom:1px solid #ddd}.nav-link[_ngcontent-%COMP%]:hover{background-color:#e9ecef}.navbar[_ngcontent-%COMP%]{padding:15px 10px}"]})};zM(HS,l6).catch(t=>console.error(t));
